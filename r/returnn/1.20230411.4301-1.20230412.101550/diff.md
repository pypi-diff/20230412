# Comparing `tmp/returnn-1.20230411.4301.tar.gz` & `tmp/returnn-1.20230412.101550.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/returnn-1.20230411.4301.tar", last modified: Mon Apr 10 23:03:27 2023, max compression
+gzip compressed data, was "dist/returnn-1.20230412.101550.tar", last modified: Wed Apr 12 08:31:25 2023, max compression
```

## Comparing `returnn-1.20230411.4301.tar` & `returnn-1.20230412.101550.tar`

### file list

```diff
@@ -1,410 +1,410 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/
--rw-r--r--   0 runner    (1001) docker     (123)      198 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/.editorconfig
--rw-r--r--   0 runner    (1001) docker     (123)      526 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)      828 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/.gitmodules
--rw-r--r--   0 runner    (1001) docker     (123)       79 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/.kateconfig
--rw-r--r--   0 runner    (1001) docker     (123)     8556 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/CHANGELOG.md
--rw-r--r--   0 runner    (1001) docker     (123)      704 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/CODEOWNERS
--rw-r--r--   0 runner    (1001) docker     (123)     4880 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/CONTRIBUTING.md
--rw-r--r--   0 runner    (1001) docker     (123)    10244 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)      579 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (123)     4716 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     3573 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/README.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1171 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)       77 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/_setup_info_generated.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/demos/
--rw-r--r--   0 runner    (1001) docker     (123)    36006 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/12AX.cluster_map
--rw-r--r--   0 runner    (1001) docker     (123)      476 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/_setup_returnn_env.py
--rw-r--r--   0 runner    (1001) docker     (123)     1174 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-fwd.config
--rw-r--r--   0 runner    (1001) docker     (123)     2703 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-horovod-mpi.py
--rw-r--r--   0 runner    (1001) docker     (123)      520 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-horovod-mpi.py.sh
--rwxr-xr-x   0 runner    (1001) docker     (123)      264 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-horovod-mpi.sh
--rw-r--r--   0 runner    (1001) docker     (123)     1756 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-hyper-param-tuning.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     2476 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-iter-dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     3635 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-list-devices.py
--rw-r--r--   0 runner    (1001) docker     (123)     2848 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-lua-torch-layer.config
--rw-r--r--   0 runner    (1001) docker     (123)      487 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-pretrain.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     2331 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-record-and-push-to-webserver.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1950 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-returnn-as-framework.py
--rw-r--r--   0 runner    (1001) docker     (123)     2286 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-rf.config
--rw-r--r--   0 runner    (1001) docker     (123)     2331 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-rhn-enwik8.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     1378 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-sprint-interface.py
--rw-r--r--   0 runner    (1001) docker     (123)     3147 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-att-copy.config
--rw-r--r--   0 runner    (1001) docker     (123)     2428 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-attention.config
--rw-r--r--   0 runner    (1001) docker     (123)     1481 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-chunking-blstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1416 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-contribrnn-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     3073 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-enc-dec.config
--rwxr-xr-x   0 runner    (1001) docker     (123)    11615 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-hard-att-copy.config
--rwxr-xr-x   0 runner    (1001) docker     (123)     7287 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-lstm-benchmark.py
--rw-r--r--   0 runner    (1001) docker     (123)     1527 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-maxgradnorm-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1413 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-native-lstm-lowmem.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1576 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-native-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1768 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-native-lstm2.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1075 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-native-lstm2.12ax.tuned.config
--rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-neural-transducer.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     1825 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-rec-explicit-lstm.config
--rw-r--r--   0 runner    (1001) docker     (123)     1202 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-rec-explicit-rnn.config
--rw-r--r--   0 runner    (1001) docker     (123)     2018 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-rec-self-att.config
--rw-r--r--   0 runner    (1001) docker     (123)     5188 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-search-compiled-graph.py
--rw-r--r--   0 runner    (1001) docker     (123)     1430 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-tf-vanilla-lstm.12ax.config
--rw-r--r--   0 runner    (1001) docker     (123)     4818 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-timit-lstm-ctc.config
--rw-r--r--   0 runner    (1001) docker     (123)     2363 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-torch.config
--rw-r--r--   0 runner    (1001) docker     (123)      766 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo-upd-mult-model.lstm.12ax.config
--rwxr-xr-x   0 runner    (1001) docker     (123)      651 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/demo.sh
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/demos/mdlstm/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/IAM_lines/
--rwxr-xr-x   0 runner    (1001) docker     (123)    43239 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png
--rwxr-xr-x   0 runner    (1001) docker     (123)    43552 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/IAM_lines/a01-007-04.png
--rwxr-xr-x   0 runner    (1001) docker     (123)    45111 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/IAM_lines/a01-007-06.png
--rw-r--r--   0 runner    (1001) docker     (123)     1709 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/README.txt
--rw-r--r--   0 runner    (1001) docker     (123)      158 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/chars.txt
--rw-r--r--   0 runner    (1001) docker     (123)     1896 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/config_demo
--rw-r--r--   0 runner    (1001) docker     (123)     1981 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/config_fwd
--rw-r--r--   0 runner    (1001) docker     (123)     1983 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/config_real
--rwxr-xr-x   0 runner    (1001) docker     (123)    10194 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/create_IAM_dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      749 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/decode.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/features/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/features/raw/
--rw-r--r--   0 runner    (1001) docker     (123)   248580 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/features/raw/demo.h5
--rwxr-xr-x   0 runner    (1001) docker     (123)       86 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/go.sh
--rw-r--r--   0 runner    (1001) docker     (123)      235 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/lines.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/split/
--rw-r--r--   0 runner    (1001) docker     (123)     2712 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/split/eval.txt
--rw-r--r--   0 runner    (1001) docker     (123)    69536 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/split/train.txt
--rw-r--r--   0 runner    (1001) docker     (123)      934 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/IAM/split/valid.txt
--rw-r--r--   0 runner    (1001) docker     (123)      230 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/demos/mdlstm/artificial/
--rwxr-xr-x   0 runner    (1001) docker     (123)     2804 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/artificial/create_test_h5.py
--rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/artificial/forwardconfig
--rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/artificial/go.sh
--rw-r--r--   0 runner    (1001) docker     (123)      970 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/artificial/trainconfig
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/demos/mdlstm/artificial_rgb/
--rwxr-xr-x   0 runner    (1001) docker     (123)     2966 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/artificial_rgb/create_test_h5.py
--rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/artificial_rgb/forwardconfig
--rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/artificial_rgb/go.sh
--rw-r--r--   0 runner    (1001) docker     (123)      970 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/demos/mdlstm/artificial_rgb/trainconfig
--rw-r--r--   0 runner    (1001) docker     (123)      463 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)       18 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/requirements.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/
--rw-r--r--   0 runner    (1001) docker     (123)     1012 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    24324 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/__main__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6981 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/__old_mod_loader__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4659 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/__setup__.py
--rw-r--r--   0 runner    (1001) docker     (123)    24267 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/config.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/datasets/
--rw-r--r--   0 runner    (1001) docker     (123)      390 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    18032 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/audio.py
--rw-r--r--   0 runner    (1001) docker     (123)    63018 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/bundle_file.py
--rw-r--r--   0 runner    (1001) docker     (123)    24892 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/cached.py
--rw-r--r--   0 runner    (1001) docker     (123)    11658 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/cached2.py
--rw-r--r--   0 runner    (1001) docker     (123)    94213 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/generating.py
--rw-r--r--   0 runner    (1001) docker     (123)    65108 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/hdf.py
--rw-r--r--   0 runner    (1001) docker     (123)    85120 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/lm.py
--rw-r--r--   0 runner    (1001) docker     (123)     9065 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/map.py
--rw-r--r--   0 runner    (1001) docker     (123)    75821 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/meta.py
--rw-r--r--   0 runner    (1001) docker     (123)    11167 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/multi_proc.py
--rw-r--r--   0 runner    (1001) docker     (123)    14607 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/normalization_data.py
--rw-r--r--   0 runner    (1001) docker     (123)     5291 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/numpy_dump.py
--rw-r--r--   0 runner    (1001) docker     (123)     9127 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/raw_wav.py
--rw-r--r--   0 runner    (1001) docker     (123)    56015 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/sprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    17608 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/stereo.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/datasets/util/
--rw-r--r--   0 runner    (1001) docker     (123)       52 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    23915 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/util/feature_extraction.py
--rw-r--r--   0 runner    (1001) docker     (123)    20445 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/datasets/util/vocabulary.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/engine/
--rw-r--r--   0 runner    (1001) docker     (123)      228 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/engine/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9591 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/engine/base.py
--rw-r--r--   0 runner    (1001) docker     (123)     9912 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/engine/batch.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/extern/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/
--rw-r--r--   0 runner    (1001) docker     (123)     4005 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4024 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/__main__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/
--rw-r--r--   0 runner    (1001) docker     (123)       65 2023-04-10 23:03:06.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/.git
--rw-r--r--   0 runner    (1001) docker     (123)        6 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1448 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/README.md
--rw-r--r--   0 runner    (1001) docker     (123)    13770 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/aligner.gif
--rw-r--r--   0 runner    (1001) docker     (123)    51077 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/check.png
--rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/core.cu
--rw-r--r--   0 runner    (1001) docker     (123)      975 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/core.h
--rw-r--r--   0 runner    (1001) docker     (123)     2512 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/core_cpu.cpp
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/
--rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)       70 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (123)     2089 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md
--rw-r--r--   0 runner    (1001) docker     (123)     3485 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp
--rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu
--rw-r--r--   0 runner    (1001) docker     (123)      975 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h
--rw-r--r--   0 runner    (1001) docker     (123)       28 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/requirements.txt
--rw-r--r--   0 runner    (1001) docker     (123)     2079 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/
--rw-r--r--   0 runner    (1001) docker     (123)     2885 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6961 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py
--rw-r--r--   0 runner    (1001) docker     (123)     4141 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/ref_rna.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/tensorflow_binding/
--rw-r--r--   0 runner    (1001) docker     (123)     6150 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/
--rw-r--r--   0 runner    (1001) docker     (123)     1693 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc
--rw-r--r--   0 runner    (1001) docker     (123)     6030 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/
--rw-r--r--   0 runner    (1001) docker     (123)     2076 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4252 2023-04-10 23:03:10.000000 returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/test.cpp
--rw-r--r--   0 runner    (1001) docker     (123)      135 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/extern/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/extern/graph_editor/
--rw-r--r--   0 runner    (1001) docker     (123)      257 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/extern/graph_editor/README.md
--rw-r--r--   0 runner    (1001) docker     (123)     1239 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/extern/graph_editor/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     8479 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/extern/graph_editor/edit.py
--rw-r--r--   0 runner    (1001) docker     (123)    19826 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/extern/graph_editor/reroute.py
--rw-r--r--   0 runner    (1001) docker     (123)    29772 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/extern/graph_editor/select.py
--rw-r--r--   0 runner    (1001) docker     (123)    26578 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/extern/graph_editor/subgraph.py
--rw-r--r--   0 runner    (1001) docker     (123)    30380 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/extern/graph_editor/transform.py
--rw-r--r--   0 runner    (1001) docker     (123)    18727 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/extern/graph_editor/util.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/frontend/
--rw-r--r--   0 runner    (1001) docker     (123)      829 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    25787 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     3345 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/_numpy_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     4570 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     6917 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/array_.py
--rw-r--r--   0 runner    (1001) docker     (123)     1776 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/const.py
--rw-r--r--   0 runner    (1001) docker     (123)      861 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/dims.py
--rw-r--r--   0 runner    (1001) docker     (123)      964 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/dtype.py
--rw-r--r--   0 runner    (1001) docker     (123)     5855 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/init.py
--rw-r--r--   0 runner    (1001) docker     (123)     2108 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/linear.py
--rw-r--r--   0 runner    (1001) docker     (123)     1898 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/loss.py
--rw-r--r--   0 runner    (1001) docker     (123)    10651 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/math_.py
--rw-r--r--   0 runner    (1001) docker     (123)     1670 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/matmul.py
--rw-r--r--   0 runner    (1001) docker     (123)     9877 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/module.py
--rw-r--r--   0 runner    (1001) docker     (123)     5832 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/parameter.py
--rw-r--r--   0 runner    (1001) docker     (123)     7705 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/rand.py
--rw-r--r--   0 runner    (1001) docker     (123)     5092 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/reduce.py
--rw-r--r--   0 runner    (1001) docker     (123)    11477 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/run_ctx.py
--rw-r--r--   0 runner    (1001) docker     (123)     2188 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/state.py
--rw-r--r--   0 runner    (1001) docker     (123)     1141 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/frontend/types.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/import_/
--rw-r--r--   0 runner    (1001) docker     (123)      243 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/import_/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     8148 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/import_/common.py
--rw-r--r--   0 runner    (1001) docker     (123)    13961 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/import_/git.py
--rw-r--r--   0 runner    (1001) docker     (123)      798 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/import_/import_.py
--rw-r--r--   0 runner    (1001) docker     (123)    33063 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/learning_rate_control.py
--rw-r--r--   0 runner    (1001) docker     (123)    11738 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/log.py
--rw-r--r--   0 runner    (1001) docker     (123)    35760 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/native_op.cpp
--rw-r--r--   0 runner    (1001) docker     (123)   244328 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/native_op.py
--rw-r--r--   0 runner    (1001) docker     (123)    23542 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/pretrain.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/sprint/
--rw-r--r--   0 runner    (1001) docker     (123)       64 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/sprint/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    31545 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/sprint/cache.py
--rw-r--r--   0 runner    (1001) docker     (123)    31137 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/sprint/control.py
--rw-r--r--   0 runner    (1001) docker     (123)    23313 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/sprint/error_signals.py
--rw-r--r--   0 runner    (1001) docker     (123)    12305 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/sprint/extern_interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    36530 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/sprint/interface.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/tensor/
--rw-r--r--   0 runner    (1001) docker     (123)      501 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tensor/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      154 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tensor/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    94908 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tensor/_dim_extra.py
--rw-r--r--   0 runner    (1001) docker     (123)   154928 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tensor/_tensor_extra.py
--rw-r--r--   0 runner    (1001) docker     (123)      643 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tensor/_tensor_mixin_base.py
--rw-r--r--   0 runner    (1001) docker     (123)     4331 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tensor/_tensor_op_overloads.py
--rw-r--r--   0 runner    (1001) docker     (123)     5125 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tensor/control_flow_ctx.py
--rw-r--r--   0 runner    (1001) docker     (123)     3884 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tensor/dim.py
--rw-r--r--   0 runner    (1001) docker     (123)     1884 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tensor/marked_dim.py
--rw-r--r--   0 runner    (1001) docker     (123)     6848 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tensor/tensor.py
--rw-r--r--   0 runner    (1001) docker     (123)     4187 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tensor/tensor_dict.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/tf/
--rw-r--r--   0 runner    (1001) docker     (123)       88 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1632 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/compat.py
--rw-r--r--   0 runner    (1001) docker     (123)    36628 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/data_pipeline.py
--rw-r--r--   0 runner    (1001) docker     (123)    15108 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/distributed.py
--rw-r--r--   0 runner    (1001) docker     (123)   150268 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/engine.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/tf/frontend_layers/
--rw-r--r--   0 runner    (1001) docker     (123)      397 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/frontend_layers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    17778 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/frontend_layers/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)      817 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/frontend_layers/_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     4174 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/frontend_layers/config_entry_points.py
--rw-r--r--   0 runner    (1001) docker     (123)      888 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/frontend_layers/debug_eager_mode.py
--rw-r--r--   0 runner    (1001) docker     (123)     5394 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/frontend_layers/dims.py
--rw-r--r--   0 runner    (1001) docker     (123)    69478 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/frontend_layers/layer.py
--rw-r--r--   0 runner    (1001) docker     (123)    13576 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/frontend_layers/make_layer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2239 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/frontend_layers/prev_tensor_ref.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/tf/frontend_low_level/
--rw-r--r--   0 runner    (1001) docker     (123)       62 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/frontend_low_level/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    19964 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/frontend_low_level/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     5404 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/horovod.py
--rw-r--r--   0 runner    (1001) docker     (123)    31611 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/hyper_param_tuning.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/tf/layers/
--rw-r--r--   0 runner    (1001) docker     (123)       72 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/layers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   148678 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/layers/base.py
--rw-r--r--   0 runner    (1001) docker     (123)   584733 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/layers/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)   538391 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/layers/rec.py
--rw-r--r--   0 runner    (1001) docker     (123)    21515 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/layers/segmental_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    52075 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/layers/signal_processing.py
--rw-r--r--   0 runner    (1001) docker     (123)    78675 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/native_op.py
--rw-r--r--   0 runner    (1001) docker     (123)   222275 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/network.py
--rw-r--r--   0 runner    (1001) docker     (123)     5471 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/sprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    71410 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/updater.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/tf/util/
--rw-r--r--   0 runner    (1001) docker     (123)       92 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   292981 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/util/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)    28839 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/util/data.py
--rw-r--r--   0 runner    (1001) docker     (123)    17333 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/util/ken_lm.py
--rw-r--r--   0 runner    (1001) docker     (123)    11277 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/tf/util/open_fst.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/torch/
--rw-r--r--   0 runner    (1001) docker     (123)       85 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/README.md
--rw-r--r--   0 runner    (1001) docker     (123)       24 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/torch/data/
--rw-r--r--   0 runner    (1001) docker     (123)      132 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9483 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/data/pipeline.py
--rw-r--r--   0 runner    (1001) docker     (123)     5410 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/data/returnn_dataset_wrapper.py
--rw-r--r--   0 runner    (1001) docker     (123)      970 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/data/tensor_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    18948 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/engine.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/torch/frontend/
--rw-r--r--   0 runner    (1001) docker     (123)       62 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/frontend/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    27399 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/frontend/_backend.py
--rw-r--r--   0 runner    (1001) docker     (123)     1830 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/frontend/_rand.py
--rw-r--r--   0 runner    (1001) docker     (123)     2714 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/frontend/bridge.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/torch/functional/
--rw-r--r--   0 runner    (1001) docker     (123)      193 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/functional/README.md
--rw-r--r--   0 runner    (1001) docker     (123)       26 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/functional/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    10594 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/torch/updater.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn/util/
--rw-r--r--   0 runner    (1001) docker     (123)      336 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   144495 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/basic.py
--rw-r--r--   0 runner    (1001) docker     (123)    59572 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/better_exchook.py
--rw-r--r--   0 runner    (1001) docker     (123)    17977 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/bpe.py
--rw-r--r--   0 runner    (1001) docker     (123)    15987 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/debug.py
--rw-r--r--   0 runner    (1001) docker     (123)     2905 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/debug_helpers.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    59177 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/fsa.py
--rw-r--r--   0 runner    (1001) docker     (123)     2009 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/literal_py_to_pickle.py
--rw-r--r--   0 runner    (1001) docker     (123)     8131 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/pprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    14846 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/py-to-pickle.cpp
--rwxr-xr-x   0 runner    (1001) docker     (123)     7273 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/sig_proc.py
--rw-r--r--   0 runner    (1001) docker     (123)    27230 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/returnn/util/task_system.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     4716 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    11427 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)        8 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/returnn.egg-info/top_level.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)      461 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/rnn.py
--rw-r--r--   0 runner    (1001) docker     (123)       38 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     4159 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/tests/
--rwxr-xr-x   0 runner    (1001) docker     (123)     3392 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/DummySprintExec.py
--rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm-inspection-profile.xml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/tests/PyCharm.idea/
--rw-r--r--   0 runner    (1001) docker     (123)       47 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm.idea/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)        8 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm.idea/.name
--rw-r--r--   0 runner    (1001) docker     (123)      512 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm.idea/codeStyleSettings.xml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/tests/PyCharm.idea/codeStyles/
--rw-r--r--   0 runner    (1001) docker     (123)      328 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm.idea/codeStyles/Project.xml
--rw-r--r--   0 runner    (1001) docker     (123)      142 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm.idea/codeStyles/codeStyleConfig.xml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/tests/PyCharm.idea/inspectionProfiles/
--rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml
--rw-r--r--   0 runner    (1001) docker     (123)      181 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm.idea/inspectionProfiles/profiles_settings.xml
--rw-r--r--   0 runner    (1001) docker     (123)      318 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm.idea/misc.xml
--rw-r--r--   0 runner    (1001) docker     (123)      267 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm.idea/modules.xml
--rw-r--r--   0 runner    (1001) docker     (123)      417 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm.idea/returnn.iml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/tests/PyCharm.idea/scopes/
--rw-r--r--   0 runner    (1001) docker     (123)      139 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/PyCharm.idea/scopes/scope_settings.xml
--rw-r--r--   0 runner    (1001) docker     (123)      871 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/_set_num_threads1.py
--rw-r--r--   0 runner    (1001) docker     (123)      476 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/_setup_returnn_env.py
--rw-r--r--   0 runner    (1001) docker     (123)     8617 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/_setup_test_env.py
--rw-r--r--   0 runner    (1001) docker     (123)      794 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/bpe-unicode-demo.codes
--rw-r--r--   0 runner    (1001) docker     (123)     2205 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/bpe-unicode-demo.vocab
--rw-r--r--   0 runner    (1001) docker     (123)      386 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/lexicon_opt.fst
--rw-r--r--   0 runner    (1001) docker     (123)      520 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/lexicon_opt.isyms
--rw-r--r--   0 runner    (1001) docker     (123)    34282 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/lexicon_opt.jpg
--rw-r--r--   0 runner    (1001) docker     (123)       41 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/lexicon_opt.osyms
--rw-r--r--   0 runner    (1001) docker     (123)     6880 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/lint_common.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    29203 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/pycharm-inspect.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2960 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/pylint.py
--rw-r--r--   0 runner    (1001) docker     (123)     2963 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/returnn-as-framework.py
--rw-r--r--   0 runner    (1001) docker     (123)     8774 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/rf_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      617 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/spelling.dic
--rw-r--r--   0 runner    (1001) docker     (123)     7845 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_Config.py
--rw-r--r--   0 runner    (1001) docker     (123)    18921 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_Dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    13634 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_Fsa.py
--rw-r--r--   0 runner    (1001) docker     (123)     8904 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_GeneratingDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)    32796 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_HDFDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)    10326 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_LearningRateControl.py
--rw-r--r--   0 runner    (1001) docker     (123)     7187 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_Log.py
--rw-r--r--   0 runner    (1001) docker     (123)     3635 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_MultiProcDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     3333 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_PTDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     2465 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_Pretrain.py
--rw-r--r--   0 runner    (1001) docker     (123)    21403 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_ResNet.py
--rw-r--r--   0 runner    (1001) docker     (123)     5014 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_SprintDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     3330 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_SprintInterface.py
--rw-r--r--   0 runner    (1001) docker     (123)   238053 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_TFEngine.py
--rw-r--r--   0 runner    (1001) docker     (123)   134969 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_TFNativeOp.py
--rw-r--r--   0 runner    (1001) docker     (123)   551303 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_TFNetworkLayer.py
--rw-r--r--   0 runner    (1001) docker     (123)   549696 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_TFNetworkRecLayer.py
--rw-r--r--   0 runner    (1001) docker     (123)    14485 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_TFNetworkSigProcLayer.py
--rw-r--r--   0 runner    (1001) docker     (123)    20440 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_TFUpdater.py
--rw-r--r--   0 runner    (1001) docker     (123)   187447 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_TFUtil.py
--rw-r--r--   0 runner    (1001) docker     (123)     3082 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_TF_determinism.py
--rw-r--r--   0 runner    (1001) docker     (123)     2156 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_TaskSystem.py
--rw-r--r--   0 runner    (1001) docker     (123)     5088 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_TaskSystem_SharedMem.py
--rw-r--r--   0 runner    (1001) docker     (123)     9378 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_TranslationDataset.py
--rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_Util.py
--rw-r--r--   0 runner    (1001) docker     (123)    10006 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_demos.py
--rw-r--r--   0 runner    (1001) docker     (123)     7375 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_fork_exec.py
--rw-r--r--   0 runner    (1001) docker     (123)     2893 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_hdf_dump.py
--rw-r--r--   0 runner    (1001) docker     (123)     5688 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_rf_base.py
--rw-r--r--   0 runner    (1001) docker     (123)     1135 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_tensor.py
--rw-r--r--   0 runner    (1001) docker     (123)     8435 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_tools.py
--rw-r--r--   0 runner    (1001) docker     (123)    11897 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_torch_frontend.py
--rw-r--r--   0 runner    (1001) docker     (123)    15534 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tests/test_torch_internal_frontend.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/tools/
--rw-r--r--   0 runner    (1001) docker     (123)      476 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/_setup_returnn_env.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     9650 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/analyze-dataset-batches.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     3943 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/bliss-collect-seq-lens.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      780 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/bliss-dump-text.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6608 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/bliss-get-segment-names.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    18221 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/bliss-to-ogg-zip.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     5644 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/bpe-create-lexicon.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    10532 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/calculate-word-error-rate.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1759 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/cleanup-old-models.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    10783 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/collect-orth-symbols.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6801 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/collect-words.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     4395 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/compile_native_op.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    81620 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/compile_tf_graph.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     8500 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/debug-dump-search-scores.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    47001 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/debug-plot-search-scores.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6048 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/dump-dataset-raw-strings.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    12524 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/dump-dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     5770 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/dump-forward-stats.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2576 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/dump-forward.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1596 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/dump-network-json.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      719 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/dump-pickle.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    16425 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/extract_state_tying_from_dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    14986 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/get-attention-weights.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2936 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/get-best-model-epoch.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     3900 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/hdf_dump.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    19622 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/hdf_dump_translation_dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    49563 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/import-blocks-mt-model.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    31498 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/import-t2t-mt-model.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/tools/lattice_rescorer/
--rw-r--r--   0 runner    (1001) docker     (123)       38 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)     2254 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/Makefile
--rw-r--r--   0 runner    (1001) docker     (123)     7825 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/tools/lattice_rescorer/example/
--rw-r--r--   0 runner    (1001) docker     (123)     1282 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/example/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      100 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/example/libs_list
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-10 23:03:27.000000 returnn-1.20230411.4301/tools/lattice_rescorer/example/network.040/
--rw-r--r--   0 runner    (1001) docker     (123)     5775 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config
--rw-r--r--   0 runner    (1001) docker     (123)     6110 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config
--rwxr-xr-x   0 runner    (1001) docker     (123)      800 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/example/rescore_lattice.sh
--rw-r--r--   0 runner    (1001) docker     (123)      296 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/example/state_vars_list
--rw-r--r--   0 runner    (1001) docker     (123)      155 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/example/tensor_names_list
--rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/file.h
--rw-r--r--   0 runner    (1001) docker     (123)    26055 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/htklatticerescorer.cc
--rw-r--r--   0 runner    (1001) docker     (123)    10856 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/htklatticerescorer.h
--rw-r--r--   0 runner    (1001) docker     (123)    12488 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/main.cc
--rw-r--r--   0 runner    (1001) docker     (123)     2184 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/rescorer.h
--rw-r--r--   0 runner    (1001) docker     (123)     5563 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/vocabulary.cc
--rw-r--r--   0 runner    (1001) docker     (123)     3023 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/lattice_rescorer/vocabulary.h
--rwxr-xr-x   0 runner    (1001) docker     (123)     5438 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/tf_avg_checkpoints.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     6269 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/tf_inspect_checkpoint.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     1288 2023-04-10 23:03:04.000000 returnn-1.20230411.4301/tools/tf_inspect_summary_log.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/
+-rw-r--r--   0 runner    (1001) docker     (123)      198 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/.editorconfig
+-rw-r--r--   0 runner    (1001) docker     (123)      526 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)      828 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/.gitmodules
+-rw-r--r--   0 runner    (1001) docker     (123)       79 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/.kateconfig
+-rw-r--r--   0 runner    (1001) docker     (123)     8556 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/CHANGELOG.md
+-rw-r--r--   0 runner    (1001) docker     (123)      704 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/CODEOWNERS
+-rw-r--r--   0 runner    (1001) docker     (123)     4880 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/CONTRIBUTING.md
+-rw-r--r--   0 runner    (1001) docker     (123)    10244 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)      579 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (123)     4718 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     3573 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/README.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1171 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)       77 2023-04-12 08:31:24.000000 returnn-1.20230412.101550/_setup_info_generated.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/demos/
+-rw-r--r--   0 runner    (1001) docker     (123)    36006 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/12AX.cluster_map
+-rw-r--r--   0 runner    (1001) docker     (123)      476 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/_setup_returnn_env.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1174 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-fwd.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2703 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-horovod-mpi.py
+-rw-r--r--   0 runner    (1001) docker     (123)      520 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-horovod-mpi.py.sh
+-rwxr-xr-x   0 runner    (1001) docker     (123)      264 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-horovod-mpi.sh
+-rw-r--r--   0 runner    (1001) docker     (123)     1756 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-hyper-param-tuning.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2435 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-iter-dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3635 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-list-devices.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2848 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-lua-torch-layer.config
+-rw-r--r--   0 runner    (1001) docker     (123)      487 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-pretrain.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2331 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-record-and-push-to-webserver.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1950 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-returnn-as-framework.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2440 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-rf.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2331 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-rhn-enwik8.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1378 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-sprint-interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3147 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-att-copy.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2428 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-attention.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1481 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-chunking-blstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1416 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-contribrnn-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     3073 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-enc-dec.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)    11615 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-hard-att-copy.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)     7287 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-lstm-benchmark.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1527 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-maxgradnorm-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1413 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-native-lstm-lowmem.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1576 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-native-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1768 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-native-lstm2.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1075 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-native-lstm2.12ax.tuned.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-neural-transducer.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1825 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-rec-explicit-lstm.config
+-rw-r--r--   0 runner    (1001) docker     (123)     1202 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-rec-explicit-rnn.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2018 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-rec-self-att.config
+-rw-r--r--   0 runner    (1001) docker     (123)     5188 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-search-compiled-graph.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1430 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-tf-vanilla-lstm.12ax.config
+-rw-r--r--   0 runner    (1001) docker     (123)     4818 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-timit-lstm-ctc.config
+-rw-r--r--   0 runner    (1001) docker     (123)     2363 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-torch.config
+-rw-r--r--   0 runner    (1001) docker     (123)      766 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo-upd-mult-model.lstm.12ax.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)      651 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/demo.sh
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/demos/mdlstm/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/IAM_lines/
+-rwxr-xr-x   0 runner    (1001) docker     (123)    43239 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png
+-rwxr-xr-x   0 runner    (1001) docker     (123)    43552 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/IAM_lines/a01-007-04.png
+-rwxr-xr-x   0 runner    (1001) docker     (123)    45111 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/IAM_lines/a01-007-06.png
+-rw-r--r--   0 runner    (1001) docker     (123)     1709 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/README.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      158 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/chars.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1896 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/config_demo
+-rw-r--r--   0 runner    (1001) docker     (123)     1981 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/config_fwd
+-rw-r--r--   0 runner    (1001) docker     (123)     1983 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/config_real
+-rwxr-xr-x   0 runner    (1001) docker     (123)    10194 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/create_IAM_dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      749 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/decode.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/features/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/features/raw/
+-rw-r--r--   0 runner    (1001) docker     (123)   248580 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/features/raw/demo.h5
+-rwxr-xr-x   0 runner    (1001) docker     (123)       86 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/go.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      235 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/lines.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/split/
+-rw-r--r--   0 runner    (1001) docker     (123)     2712 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/split/eval.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    69536 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/split/train.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      934 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/IAM/split/valid.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      230 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/demos/mdlstm/artificial/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2804 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/artificial/create_test_h5.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/artificial/forwardconfig
+-rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/artificial/go.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      970 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/artificial/trainconfig
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/demos/mdlstm/artificial_rgb/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2966 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/artificial_rgb/create_test_h5.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1055 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/artificial_rgb/forwardconfig
+-rwxr-xr-x   0 runner    (1001) docker     (123)      105 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/artificial_rgb/go.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      970 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/demos/mdlstm/artificial_rgb/trainconfig
+-rw-r--r--   0 runner    (1001) docker     (123)      463 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)       18 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/requirements.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/
+-rw-r--r--   0 runner    (1001) docker     (123)     1012 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24324 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/__main__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6981 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/__old_mod_loader__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4659 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/__setup__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24267 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/config.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/datasets/
+-rw-r--r--   0 runner    (1001) docker     (123)      390 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18032 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/audio.py
+-rw-r--r--   0 runner    (1001) docker     (123)    62931 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/bundle_file.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24892 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/cached.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11658 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/cached2.py
+-rw-r--r--   0 runner    (1001) docker     (123)    94213 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/generating.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65108 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/hdf.py
+-rw-r--r--   0 runner    (1001) docker     (123)    85120 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/lm.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9065 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/map.py
+-rw-r--r--   0 runner    (1001) docker     (123)    75821 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/meta.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11167 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/multi_proc.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14607 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/normalization_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5291 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/numpy_dump.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9127 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/raw_wav.py
+-rw-r--r--   0 runner    (1001) docker     (123)    56015 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/sprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17608 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/stereo.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/datasets/util/
+-rw-r--r--   0 runner    (1001) docker     (123)       52 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23915 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/util/feature_extraction.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20445 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/datasets/util/vocabulary.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/engine/
+-rw-r--r--   0 runner    (1001) docker     (123)      228 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/engine/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9325 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/engine/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9912 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/engine/batch.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/extern/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/
+-rw-r--r--   0 runner    (1001) docker     (123)     4005 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4024 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/__main__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/
+-rw-r--r--   0 runner    (1001) docker     (123)       65 2023-04-12 08:31:07.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/.git
+-rw-r--r--   0 runner    (1001) docker     (123)        6 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1448 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)    13770 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/aligner.gif
+-rw-r--r--   0 runner    (1001) docker     (123)    51077 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/check.png
+-rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/core.cu
+-rw-r--r--   0 runner    (1001) docker     (123)      975 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/core.h
+-rw-r--r--   0 runner    (1001) docker     (123)     2512 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/core_cpu.cpp
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/
+-rw-r--r--   0 runner    (1001) docker     (123)     1069 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)       70 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (123)     2089 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)     3485 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)    11544 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu
+-rw-r--r--   0 runner    (1001) docker     (123)      975 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h
+-rw-r--r--   0 runner    (1001) docker     (123)       28 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/requirements.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     2079 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/
+-rw-r--r--   0 runner    (1001) docker     (123)     2885 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6961 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4141 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/ref_rna.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/tensorflow_binding/
+-rw-r--r--   0 runner    (1001) docker     (123)     6150 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/
+-rw-r--r--   0 runner    (1001) docker     (123)     1693 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc
+-rw-r--r--   0 runner    (1001) docker     (123)     6030 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/
+-rw-r--r--   0 runner    (1001) docker     (123)     2076 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4252 2023-04-12 08:31:09.000000 returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/test.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)      135 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/extern/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/extern/graph_editor/
+-rw-r--r--   0 runner    (1001) docker     (123)      257 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/extern/graph_editor/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)     1239 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/extern/graph_editor/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8479 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/extern/graph_editor/edit.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19826 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/extern/graph_editor/reroute.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29772 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/extern/graph_editor/select.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26578 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/extern/graph_editor/subgraph.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30380 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/extern/graph_editor/transform.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18727 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/extern/graph_editor/util.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/frontend/
+-rw-r--r--   0 runner    (1001) docker     (123)      829 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25787 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3345 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/_numpy_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4624 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6917 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/array_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1776 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/const.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2081 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/dims.py
+-rw-r--r--   0 runner    (1001) docker     (123)      964 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/dtype.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5855 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/init.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2108 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/linear.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1898 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/loss.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10651 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/math_.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1670 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/matmul.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9877 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/module.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5832 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/parameter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7705 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/rand.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5092 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/reduce.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11477 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/run_ctx.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2188 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/state.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1141 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/frontend/types.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/import_/
+-rw-r--r--   0 runner    (1001) docker     (123)      243 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/import_/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8148 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/import_/common.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13961 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/import_/git.py
+-rw-r--r--   0 runner    (1001) docker     (123)      798 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/import_/import_.py
+-rw-r--r--   0 runner    (1001) docker     (123)    33063 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/learning_rate_control.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11738 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/log.py
+-rw-r--r--   0 runner    (1001) docker     (123)    35760 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/native_op.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)   244328 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/native_op.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23542 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/pretrain.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/sprint/
+-rw-r--r--   0 runner    (1001) docker     (123)       64 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/sprint/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31545 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/sprint/cache.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31137 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/sprint/control.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23313 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/sprint/error_signals.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12305 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/sprint/extern_interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    36475 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/sprint/interface.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/tensor/
+-rw-r--r--   0 runner    (1001) docker     (123)      501 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tensor/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      154 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tensor/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    94908 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tensor/_dim_extra.py
+-rw-r--r--   0 runner    (1001) docker     (123)   154798 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tensor/_tensor_extra.py
+-rw-r--r--   0 runner    (1001) docker     (123)      643 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tensor/_tensor_mixin_base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4331 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tensor/_tensor_op_overloads.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5125 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tensor/control_flow_ctx.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3884 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tensor/dim.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1884 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tensor/marked_dim.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6848 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tensor/tensor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4187 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tensor/tensor_dict.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/tf/
+-rw-r--r--   0 runner    (1001) docker     (123)       88 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1632 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/compat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    36852 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/data_pipeline.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15108 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/distributed.py
+-rw-r--r--   0 runner    (1001) docker     (123)   151442 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/engine.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/tf/frontend_layers/
+-rw-r--r--   0 runner    (1001) docker     (123)      432 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/frontend_layers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17778 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/frontend_layers/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)      817 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/frontend_layers/_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4203 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/frontend_layers/config_entry_points.py
+-rw-r--r--   0 runner    (1001) docker     (123)      888 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/frontend_layers/debug_eager_mode.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5394 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/frontend_layers/dims.py
+-rw-r--r--   0 runner    (1001) docker     (123)    69478 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/frontend_layers/layer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13576 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/frontend_layers/make_layer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2239 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/frontend_layers/prev_tensor_ref.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/tf/frontend_low_level/
+-rw-r--r--   0 runner    (1001) docker     (123)       62 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/frontend_low_level/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19964 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/frontend_low_level/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5404 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/horovod.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31611 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/hyper_param_tuning.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/tf/layers/
+-rw-r--r--   0 runner    (1001) docker     (123)       72 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/layers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   149447 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/layers/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)   585288 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/layers/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)   538391 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/layers/rec.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21515 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/layers/segmental_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52075 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/layers/signal_processing.py
+-rw-r--r--   0 runner    (1001) docker     (123)    78675 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/native_op.py
+-rw-r--r--   0 runner    (1001) docker     (123)   222275 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/network.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5471 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/sprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    71410 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/updater.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/tf/util/
+-rw-r--r--   0 runner    (1001) docker     (123)       92 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   292981 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/util/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28839 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/util/data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17333 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/util/ken_lm.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11277 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/tf/util/open_fst.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/torch/
+-rw-r--r--   0 runner    (1001) docker     (123)       85 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)       24 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/torch/data/
+-rw-r--r--   0 runner    (1001) docker     (123)      132 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9483 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/data/pipeline.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5410 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/data/returnn_dataset_wrapper.py
+-rw-r--r--   0 runner    (1001) docker     (123)      970 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/data/tensor_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18950 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/engine.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/torch/frontend/
+-rw-r--r--   0 runner    (1001) docker     (123)       62 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/frontend/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    27556 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/frontend/_backend.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1830 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/frontend/_rand.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2714 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/frontend/bridge.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/torch/functional/
+-rw-r--r--   0 runner    (1001) docker     (123)      193 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/functional/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)       26 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/functional/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10594 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/torch/updater.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn/util/
+-rw-r--r--   0 runner    (1001) docker     (123)      336 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   144505 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/basic.py
+-rw-r--r--   0 runner    (1001) docker     (123)    59572 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/better_exchook.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17977 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/bpe.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15987 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/debug.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2905 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/debug_helpers.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    59177 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/fsa.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2009 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/literal_py_to_pickle.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8131 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/pprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14846 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/py-to-pickle.cpp
+-rwxr-xr-x   0 runner    (1001) docker     (123)     7273 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/sig_proc.py
+-rw-r--r--   0 runner    (1001) docker     (123)    27230 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/returnn/util/task_system.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/returnn.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     4718 2023-04-12 08:31:24.000000 returnn-1.20230412.101550/returnn.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    11427 2023-04-12 08:31:24.000000 returnn-1.20230412.101550/returnn.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-12 08:31:24.000000 returnn-1.20230412.101550/returnn.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        8 2023-04-12 08:31:24.000000 returnn-1.20230412.101550/returnn.egg-info/top_level.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)      461 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/rnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)       38 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     4159 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/tests/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3392 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/DummySprintExec.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm-inspection-profile.xml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/tests/PyCharm.idea/
+-rw-r--r--   0 runner    (1001) docker     (123)       47 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm.idea/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)        8 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm.idea/.name
+-rw-r--r--   0 runner    (1001) docker     (123)      512 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm.idea/codeStyleSettings.xml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/tests/PyCharm.idea/codeStyles/
+-rw-r--r--   0 runner    (1001) docker     (123)      328 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm.idea/codeStyles/Project.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      142 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm.idea/codeStyles/codeStyleConfig.xml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/tests/PyCharm.idea/inspectionProfiles/
+-rw-r--r--   0 runner    (1001) docker     (123)     2671 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      181 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm.idea/inspectionProfiles/profiles_settings.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      318 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm.idea/misc.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      267 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm.idea/modules.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      417 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm.idea/returnn.iml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/tests/PyCharm.idea/scopes/
+-rw-r--r--   0 runner    (1001) docker     (123)      139 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/PyCharm.idea/scopes/scope_settings.xml
+-rw-r--r--   0 runner    (1001) docker     (123)      871 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/_set_num_threads1.py
+-rw-r--r--   0 runner    (1001) docker     (123)      476 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/_setup_returnn_env.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8763 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/_setup_test_env.py
+-rw-r--r--   0 runner    (1001) docker     (123)      794 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/bpe-unicode-demo.codes
+-rw-r--r--   0 runner    (1001) docker     (123)     2205 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/bpe-unicode-demo.vocab
+-rw-r--r--   0 runner    (1001) docker     (123)      386 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/lexicon_opt.fst
+-rw-r--r--   0 runner    (1001) docker     (123)      520 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/lexicon_opt.isyms
+-rw-r--r--   0 runner    (1001) docker     (123)    34282 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/lexicon_opt.jpg
+-rw-r--r--   0 runner    (1001) docker     (123)       41 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/lexicon_opt.osyms
+-rw-r--r--   0 runner    (1001) docker     (123)     6880 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/lint_common.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    29203 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/pycharm-inspect.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2960 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/pylint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2963 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/returnn-as-framework.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8774 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/rf_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      617 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/spelling.dic
+-rw-r--r--   0 runner    (1001) docker     (123)     7845 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_Config.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18921 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_Dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    13634 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_Fsa.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8904 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_GeneratingDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)    32796 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_HDFDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10326 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_LearningRateControl.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7187 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_Log.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3635 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_MultiProcDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3333 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_PTDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2465 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_Pretrain.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21403 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_ResNet.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5014 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_SprintDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3330 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_SprintInterface.py
+-rw-r--r--   0 runner    (1001) docker     (123)   238053 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_TFEngine.py
+-rw-r--r--   0 runner    (1001) docker     (123)   134969 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_TFNativeOp.py
+-rw-r--r--   0 runner    (1001) docker     (123)   551303 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_TFNetworkLayer.py
+-rw-r--r--   0 runner    (1001) docker     (123)   549696 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_TFNetworkRecLayer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14485 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_TFNetworkSigProcLayer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20440 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_TFUpdater.py
+-rw-r--r--   0 runner    (1001) docker     (123)   187471 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_TFUtil.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3082 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_TF_determinism.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2156 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_TaskSystem.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5088 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_TaskSystem_SharedMem.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9378 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_TranslationDataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_Util.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10519 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_demos.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7375 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_fork_exec.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2893 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_hdf_dump.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5688 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_rf_base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1135 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_tensor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8435 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_tools.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11897 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_torch_frontend.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15534 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tests/test_torch_internal_frontend.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/tools/
+-rw-r--r--   0 runner    (1001) docker     (123)      476 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/_setup_returnn_env.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     9650 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/analyze-dataset-batches.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3943 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/bliss-collect-seq-lens.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      780 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/bliss-dump-text.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6608 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/bliss-get-segment-names.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    18221 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/bliss-to-ogg-zip.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     5644 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/bpe-create-lexicon.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    10532 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/calculate-word-error-rate.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1759 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/cleanup-old-models.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    10783 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/collect-orth-symbols.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6801 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/collect-words.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     4395 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/compile_native_op.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    81620 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/compile_tf_graph.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     8500 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/debug-dump-search-scores.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    47001 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/debug-plot-search-scores.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6048 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/dump-dataset-raw-strings.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    12524 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/dump-dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     5770 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/dump-forward-stats.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2576 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/dump-forward.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1596 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/dump-network-json.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      719 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/dump-pickle.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    16425 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/extract_state_tying_from_dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    14986 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/get-attention-weights.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2936 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/get-best-model-epoch.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     3900 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/hdf_dump.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    19622 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/hdf_dump_translation_dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    49563 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/import-blocks-mt-model.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    31498 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/import-t2t-mt-model.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/tools/lattice_rescorer/
+-rw-r--r--   0 runner    (1001) docker     (123)       38 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)     2254 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/Makefile
+-rw-r--r--   0 runner    (1001) docker     (123)     7825 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/tools/lattice_rescorer/example/
+-rw-r--r--   0 runner    (1001) docker     (123)     1282 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/example/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      100 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/example/libs_list
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-12 08:31:25.000000 returnn-1.20230412.101550/tools/lattice_rescorer/example/network.040/
+-rw-r--r--   0 runner    (1001) docker     (123)     5775 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config
+-rw-r--r--   0 runner    (1001) docker     (123)     6110 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config
+-rwxr-xr-x   0 runner    (1001) docker     (123)      800 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/example/rescore_lattice.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      296 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/example/state_vars_list
+-rw-r--r--   0 runner    (1001) docker     (123)      155 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/example/tensor_names_list
+-rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/file.h
+-rw-r--r--   0 runner    (1001) docker     (123)    26055 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/htklatticerescorer.cc
+-rw-r--r--   0 runner    (1001) docker     (123)    10856 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/htklatticerescorer.h
+-rw-r--r--   0 runner    (1001) docker     (123)    12488 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/main.cc
+-rw-r--r--   0 runner    (1001) docker     (123)     2184 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/rescorer.h
+-rw-r--r--   0 runner    (1001) docker     (123)     5563 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/vocabulary.cc
+-rw-r--r--   0 runner    (1001) docker     (123)     3023 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/lattice_rescorer/vocabulary.h
+-rwxr-xr-x   0 runner    (1001) docker     (123)     5438 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/tf_avg_checkpoints.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     6269 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/tf_inspect_checkpoint.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1288 2023-04-12 08:31:06.000000 returnn-1.20230412.101550/tools/tf_inspect_summary_log.py
```

### Comparing `returnn-1.20230411.4301/.gitignore` & `returnn-1.20230412.101550/.gitignore`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/.gitmodules` & `returnn-1.20230412.101550/.gitmodules`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/CHANGELOG.md` & `returnn-1.20230412.101550/CHANGELOG.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/CODEOWNERS` & `returnn-1.20230412.101550/CODEOWNERS`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/CONTRIBUTING.md` & `returnn-1.20230412.101550/CONTRIBUTING.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/LICENSE` & `returnn-1.20230412.101550/LICENSE`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/MANIFEST.in` & `returnn-1.20230412.101550/MANIFEST.in`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/PKG-INFO` & `returnn-1.20230412.101550/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: returnn
-Version: 1.20230411.4301
+Version: 1.20230412.101550
 Summary: The RWTH extensible training framework for universal recurrent neural networks
 Home-page: https://github.com/rwth-i6/returnn/
 Author: Albert Zeyer
 Author-email: albzey@gmail.com
 License: RETURNN license
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Environment :: Console
```

### Comparing `returnn-1.20230411.4301/README.rst` & `returnn-1.20230412.101550/README.rst`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/__init__.py` & `returnn-1.20230412.101550/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/12AX.cluster_map` & `returnn-1.20230412.101550/demos/12AX.cluster_map`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-fwd.config` & `returnn-1.20230412.101550/demos/demo-fwd.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-horovod-mpi.py` & `returnn-1.20230412.101550/demos/demo-horovod-mpi.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-horovod-mpi.py.sh` & `returnn-1.20230412.101550/demos/demo-horovod-mpi.py.sh`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-hyper-param-tuning.config` & `returnn-1.20230412.101550/demos/demo-hyper-param-tuning.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-iter-dataset.py` & `returnn-1.20230412.101550/demos/demo-iter-dataset.py`

 * *Files 3% similar despite different names*

```diff
@@ -32,18 +32,18 @@
         batch_gen.advance(len(batches))
 
 
 def iterate_epochs():
     """
     Iterate through epochs.
     """
-    start_epoch, start_batch = EngineBase.get_train_start_epoch_batch(config)
+    start_epoch = EngineBase.get_train_start_epoch(config)
     final_epoch = EngineBase.config_get_final_epoch(config)
 
-    print("Starting with epoch %i, batch %i." % (start_epoch, start_batch), file=log.v3)
+    print("Starting with epoch %i." % (start_epoch,), file=log.v3)
     print("Final epoch is: %i" % final_epoch, file=log.v3)
 
     recurrent_net = "lstm" in config.value("hidden_type", "")  # good enough...
     batch_size = config.int("batch_size", 1)
     max_seqs = config.int("max_seqs", -1)
 
     for epoch in range(start_epoch, final_epoch + 1):
```

### Comparing `returnn-1.20230411.4301/demos/demo-list-devices.py` & `returnn-1.20230412.101550/demos/demo-list-devices.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-lua-torch-layer.config` & `returnn-1.20230412.101550/demos/demo-lua-torch-layer.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-record-and-push-to-webserver.py` & `returnn-1.20230412.101550/demos/demo-record-and-push-to-webserver.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-returnn-as-framework.py` & `returnn-1.20230412.101550/demos/demo-returnn-as-framework.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-rf.config` & `returnn-1.20230412.101550/demos/demo-rf.config`

 * *Files 12% similar despite different names*

```diff
@@ -50,14 +50,17 @@
     data = extern_data["data"]
     logits = model(data)
     logits_packed, pack_dim = rf.pack(logits, dims=(batch_dim, time_dim), enforce_sorted=False)
     targets = extern_data["classes"]
     targets_packed, _ = rf.pack(targets, dims=(batch_dim, time_dim), enforce_sorted=False, out_dim=pack_dim)
     loss = rf.cross_entropy(estimated=logits_packed, estimated_type="logits", target=targets_packed, axis=out_dim)
     loss.mark_as_loss(name="ce")
+    best = rf.reduce_argmax(logits_packed, axis=out_dim)
+    frame_error = best != targets_packed
+    frame_error.mark_as_loss(name="fer", as_error=True)
 
 
 # training
 optimizer = {"class": "adam"}
 
 learning_rate = 0.01
 learning_rate_control = "newbob"
```

### Comparing `returnn-1.20230411.4301/demos/demo-rhn-enwik8.config` & `returnn-1.20230412.101550/demos/demo-rhn-enwik8.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-sprint-interface.py` & `returnn-1.20230412.101550/demos/demo-sprint-interface.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-att-copy.config` & `returnn-1.20230412.101550/demos/demo-tf-att-copy.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-attention.config` & `returnn-1.20230412.101550/demos/demo-tf-attention.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-chunking-blstm.12ax.config` & `returnn-1.20230412.101550/demos/demo-tf-chunking-blstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-contribrnn-lstm.12ax.config` & `returnn-1.20230412.101550/demos/demo-tf-contribrnn-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-enc-dec.config` & `returnn-1.20230412.101550/demos/demo-tf-enc-dec.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-hard-att-copy.config` & `returnn-1.20230412.101550/demos/demo-tf-hard-att-copy.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-lstm-benchmark.py` & `returnn-1.20230412.101550/demos/demo-tf-lstm-benchmark.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-maxgradnorm-lstm.12ax.config` & `returnn-1.20230412.101550/demos/demo-tf-maxgradnorm-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-native-lstm-lowmem.12ax.config` & `returnn-1.20230412.101550/demos/demo-tf-native-lstm-lowmem.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-native-lstm.12ax.config` & `returnn-1.20230412.101550/demos/demo-tf-native-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-native-lstm2.12ax.config` & `returnn-1.20230412.101550/demos/demo-tf-native-lstm2.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-native-lstm2.12ax.tuned.config` & `returnn-1.20230412.101550/demos/demo-tf-native-lstm2.12ax.tuned.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-neural-transducer.12ax.config` & `returnn-1.20230412.101550/demos/demo-tf-neural-transducer.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-rec-explicit-lstm.config` & `returnn-1.20230412.101550/demos/demo-tf-rec-explicit-lstm.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-rec-explicit-rnn.config` & `returnn-1.20230412.101550/demos/demo-tf-rec-explicit-rnn.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-rec-self-att.config` & `returnn-1.20230412.101550/demos/demo-tf-rec-self-att.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-search-compiled-graph.py` & `returnn-1.20230412.101550/demos/demo-tf-search-compiled-graph.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-tf-vanilla-lstm.12ax.config` & `returnn-1.20230412.101550/demos/demo-tf-vanilla-lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-timit-lstm-ctc.config` & `returnn-1.20230412.101550/demos/demo-timit-lstm-ctc.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-torch.config` & `returnn-1.20230412.101550/demos/demo-torch.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo-upd-mult-model.lstm.12ax.config` & `returnn-1.20230412.101550/demos/demo-upd-mult-model.lstm.12ax.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/demo.sh` & `returnn-1.20230412.101550/demos/demo.sh`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png` & `returnn-1.20230412.101550/demos/mdlstm/IAM/IAM_lines/a01-000u-00.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/IAM_lines/a01-007-04.png` & `returnn-1.20230412.101550/demos/mdlstm/IAM/IAM_lines/a01-007-04.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/IAM_lines/a01-007-06.png` & `returnn-1.20230412.101550/demos/mdlstm/IAM/IAM_lines/a01-007-06.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/README.txt` & `returnn-1.20230412.101550/demos/mdlstm/IAM/README.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/config_demo` & `returnn-1.20230412.101550/demos/mdlstm/IAM/config_demo`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/config_fwd` & `returnn-1.20230412.101550/demos/mdlstm/IAM/config_fwd`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/config_real` & `returnn-1.20230412.101550/demos/mdlstm/IAM/config_real`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/create_IAM_dataset.py` & `returnn-1.20230412.101550/demos/mdlstm/IAM/create_IAM_dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/decode.py` & `returnn-1.20230412.101550/demos/mdlstm/IAM/decode.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/features/raw/demo.h5` & `returnn-1.20230412.101550/demos/mdlstm/IAM/features/raw/demo.h5`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/split/eval.txt` & `returnn-1.20230412.101550/demos/mdlstm/IAM/split/eval.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/split/train.txt` & `returnn-1.20230412.101550/demos/mdlstm/IAM/split/train.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/IAM/split/valid.txt` & `returnn-1.20230412.101550/demos/mdlstm/IAM/split/valid.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/artificial/create_test_h5.py` & `returnn-1.20230412.101550/demos/mdlstm/artificial/create_test_h5.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/artificial/forwardconfig` & `returnn-1.20230412.101550/demos/mdlstm/artificial/forwardconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/artificial/trainconfig` & `returnn-1.20230412.101550/demos/mdlstm/artificial/trainconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/artificial_rgb/create_test_h5.py` & `returnn-1.20230412.101550/demos/mdlstm/artificial_rgb/create_test_h5.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/artificial_rgb/forwardconfig` & `returnn-1.20230412.101550/demos/mdlstm/artificial_rgb/forwardconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/demos/mdlstm/artificial_rgb/trainconfig` & `returnn-1.20230412.101550/demos/mdlstm/artificial_rgb/trainconfig`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/__init__.py` & `returnn-1.20230412.101550/returnn/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/__main__.py` & `returnn-1.20230412.101550/returnn/__main__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/__old_mod_loader__.py` & `returnn-1.20230412.101550/returnn/__old_mod_loader__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/__setup__.py` & `returnn-1.20230412.101550/returnn/__setup__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/config.py` & `returnn-1.20230412.101550/returnn/config.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/audio.py` & `returnn-1.20230412.101550/returnn/datasets/audio.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/basic.py` & `returnn-1.20230412.101550/returnn/datasets/basic.py`

 * *Files 1% similar despite different names*

```diff
@@ -668,20 +668,19 @@
 
     def get_times(self, sorted_seq_idx):
         """
         :param int sorted_seq_idx:
         """
         raise OptionalNotImplementedError
 
-    def get_data(self, seq_idx, key):
+    def get_data(self, seq_idx, key) -> numpy.ndarray:
         """
         :param int seq_idx: sorted seq idx
         :param str key: data-key, e.g. "data" or "classes"
-        :rtype: numpy.ndarray
-        :returns features or targets: format 2d (time,feature) (float)
+        :return: features or targets: format 2d (time,feature) (float)
         """
         # Fallback implementation for old-style subclasses.
         if key == "data":
             return self.get_input_data(seq_idx)
         else:
             return self.get_targets(key, seq_idx)
 
@@ -1461,20 +1460,20 @@
         assert len(v) == 2
         assert isinstance(v[0], int)
         assert isinstance(v[1], int)
         assert 1 <= v[1]
     return data_dims
 
 
-def shapes_for_batches(batches, data_keys, dataset=None, extern_data=None, enforce_min_len1=False):
+def shapes_for_batches(batches, *, data_keys, dataset=None, extern_data, enforce_min_len1=False):
     """
     :param list[EngineBatch.Batch] batches:
     :param list[str] data_keys:
     :param Dataset dataset:
-    :param TFNetwork.ExternData extern_data: detailed data description. only used for TensorFlow
+    :param returnn.tf.network.ExternData extern_data: detailed data description
     :param bool enforce_min_len1:
     :rtype: dict[str,list[int]] | None
     """
     assert dataset or extern_data
     all_data_keys = set(data_keys)
 
     # The final device.data.shape is in format (time,batch,feature) in case of Theano.
@@ -1488,27 +1487,26 @@
     # We will just use one dummy frame in that case.
     # The index will stay zero in that case. (see EngineUtil.assign_dev_data())
     # However, also see the OutputLayer.output_index() behavior for forwarding.
     if not extern_data or enforce_min_len1:  # not needed if TensorFlow is used
         for k in all_data_keys:
             shape[0][k] = max(shape[0][k], 1)
 
-    if extern_data:
-        d = {}
-        for k in all_data_keys:
-            data_shape = list(extern_data.data[k].batch_shape)
-            data_shape[extern_data.data[k].batch_dim_axis] = shape[1]
-            if extern_data.data[k].have_time_axis():
-                data_shape[extern_data.data[k].time_dim_axis] = shape[0][k]
-            assert all([n is not None for n in data_shape]), "data %r" % extern_data.data[k]
-            d[k] = data_shape
-    else:  # shape via dataset
-        d = {k: [shape[0][k], shape[1]] for k in all_data_keys}
-        for k in all_data_keys:
-            d[k] += dataset.get_data_shape(k)
+    d = {}
+    for k in all_data_keys:
+        data = extern_data.data[k]
+        data_shape = list(data.batch_shape)
+        assert data.have_batch_axis()
+        data_shape[data.batch_dim_axis] = shape[1]
+        dyn_axes = data.get_dynamic_axes()
+        if dyn_axes:
+            assert len(dyn_axes) == 1, f"data {data} has multiple dynamic axes, not supported currently"
+            data_shape[dyn_axes[0]] = shape[0][k]
+        assert all([n is not None for n in data_shape]), f"data {data} leaves shape {data_shape} partially undefined"
+        d[k] = data_shape
     return d
 
 
 def set_config_extern_data_from_dataset(config, dataset):
     """
     :param returnn.config.Config config:
     :param Dataset dataset:
```

### Comparing `returnn-1.20230411.4301/returnn/datasets/bundle_file.py` & `returnn-1.20230412.101550/returnn/datasets/bundle_file.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/cached.py` & `returnn-1.20230412.101550/returnn/datasets/cached.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/cached2.py` & `returnn-1.20230412.101550/returnn/datasets/cached2.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/generating.py` & `returnn-1.20230412.101550/returnn/datasets/generating.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/hdf.py` & `returnn-1.20230412.101550/returnn/datasets/hdf.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/lm.py` & `returnn-1.20230412.101550/returnn/datasets/lm.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/map.py` & `returnn-1.20230412.101550/returnn/datasets/map.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/meta.py` & `returnn-1.20230412.101550/returnn/datasets/meta.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/multi_proc.py` & `returnn-1.20230412.101550/returnn/datasets/multi_proc.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/normalization_data.py` & `returnn-1.20230412.101550/returnn/datasets/normalization_data.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/numpy_dump.py` & `returnn-1.20230412.101550/returnn/datasets/numpy_dump.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/raw_wav.py` & `returnn-1.20230412.101550/returnn/datasets/raw_wav.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/sprint.py` & `returnn-1.20230412.101550/returnn/datasets/sprint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/stereo.py` & `returnn-1.20230412.101550/returnn/datasets/stereo.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/util/feature_extraction.py` & `returnn-1.20230412.101550/returnn/datasets/util/feature_extraction.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/datasets/util/vocabulary.py` & `returnn-1.20230412.101550/returnn/datasets/util/vocabulary.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/engine/base.py` & `returnn-1.20230412.101550/returnn/engine/base.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 """
 Provides :class:`EngineBase`.
 """
 
 from __future__ import annotations
 
+from typing import Optional
 import os
 import sys
-from typing import Optional
 
 from returnn.config import Config, get_global_config
 from returnn.learning_rate_control import load_learning_rate_control_from_config, LearningRateControl
 from returnn.log import log
 from returnn.pretrain import Pretrain
 from returnn.util import basic as util
 
@@ -24,14 +24,15 @@
         """
         :param config:
         """
         if config is None:
             config = get_global_config(auto_create=True)
         self.config = config
         self.epoch = 0
+        self.global_train_step = None  # type: Optional[int]
         self.pretrain = None  # type: Optional[Pretrain]
         self.model_filename = None  # type: Optional[str]
         self.learning_rate = 0.0  # set in init_train_epoch
         self.learning_rate_control = None  # type: Optional[LearningRateControl]
 
     def init_train_from_config(self, config: Optional[Config] = None):
         """
@@ -81,15 +82,15 @@
                         break
         return file_list
 
     @classmethod
     def get_epoch_model(cls, config):
         """
         :type config: returnn.config.Config
-        :returns (epoch, modelFilename)
+        :return: (epoch, model_filename). epoch is the epoch of the model filename.
         :rtype: (int|None, str|None)
         """
         start_epoch_mode = config.value("start_epoch", "auto")
         if start_epoch_mode == "auto":
             start_epoch = None
         else:
             start_epoch = int(start_epoch_mode)
@@ -160,43 +161,35 @@
                 if epoch_model[0] != start_epoch - 1:
                     print("warning: start_epoch %i but there is %s" % (start_epoch, epoch_model), file=log.v4)
                 epoch_model = start_epoch - 1, existing_models[start_epoch - 1]
 
         return epoch_model
 
     @classmethod
-    def get_train_start_epoch_batch(cls, config):
+    def get_train_start_epoch(cls, config: Config) -> int:
         """
         We will always automatically determine the best start (epoch,batch) tuple
         based on existing model files.
         This ensures that the files are present and enforces that there are
         no old outdated files which should be ignored.
         Note that epochs start at idx 1 and batches at idx 0.
-        :type config: returnn.config.Config
-        :returns (epoch,batch)
-        :rtype (int,int)
+
+        :param config:
+        :return: epoch
         """
         start_batch_mode = config.value("start_batch", "auto")
-        if start_batch_mode == "auto":
-            start_batch_config = None
-        else:
-            start_batch_config = int(start_batch_mode)
+        if start_batch_mode != "auto":
+            raise Exception(f"custom start_batch {start_batch_mode!r} not supported")
         last_epoch, _ = cls.get_epoch_model(config)
         if last_epoch is None:
             start_epoch = 1
-            start_batch = start_batch_config or 0
-        elif start_batch_config is not None:
-            # We specified a start batch. Stay in the same epoch, use that start batch.
-            start_epoch = last_epoch
-            start_batch = start_batch_config
         else:
             # Start with next epoch.
             start_epoch = last_epoch + 1
-            start_batch = 0
-        return start_epoch, start_batch
+        return start_epoch
 
     @classmethod
     def epoch_model_filename(cls, model_filename, epoch, is_pretrain):
         """
         :type model_filename: str
         :type epoch: int
         :type is_pretrain: bool
```

### Comparing `returnn-1.20230411.4301/returnn/engine/batch.py` & `returnn-1.20230412.101550/returnn/engine/batch.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/__init__.py` & `returnn-1.20230412.101550/returnn/extern/WarpRna/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/__main__.py` & `returnn-1.20230412.101550/returnn/extern/WarpRna/__main__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/LICENSE` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/LICENSE`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/README.md` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/aligner.gif` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/aligner.gif`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/check.png` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/check.png`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/core.cu` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/core.cu`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/core.h` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/core.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/core_cpu.cpp` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/core_cpu.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/LICENSE`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/binding.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.cu`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/core.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/setup.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/pytorch_binding/warp_rna/test.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/ref_rna.py` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/ref_rna.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/tensorflow_binding/setup.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/tensorflow_binding/src/warp_rna_op_kernel_tmpl.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/tensorflow_binding/warp_rna/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/WarpRna/warp-rna/test.cpp` & `returnn-1.20230412.101550/returnn/extern/WarpRna/warp-rna/test.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/graph_editor/__init__.py` & `returnn-1.20230412.101550/returnn/extern/graph_editor/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/graph_editor/edit.py` & `returnn-1.20230412.101550/returnn/extern/graph_editor/edit.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/graph_editor/reroute.py` & `returnn-1.20230412.101550/returnn/extern/graph_editor/reroute.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/graph_editor/select.py` & `returnn-1.20230412.101550/returnn/extern/graph_editor/select.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/graph_editor/subgraph.py` & `returnn-1.20230412.101550/returnn/extern/graph_editor/subgraph.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/graph_editor/transform.py` & `returnn-1.20230412.101550/returnn/extern/graph_editor/transform.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/extern/graph_editor/util.py` & `returnn-1.20230412.101550/returnn/extern/graph_editor/util.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/__init__.py` & `returnn-1.20230412.101550/returnn/frontend/__init__.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/_backend.py` & `returnn-1.20230412.101550/returnn/frontend/_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/_numpy_backend.py` & `returnn-1.20230412.101550/returnn/frontend/_numpy_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/_utils.py` & `returnn-1.20230412.101550/returnn/frontend/_utils.py`

 * *Files 2% similar despite different names*

```diff
@@ -82,15 +82,18 @@
         src_dtype = b.dtype
     a = rf.convert_to_tensor(a, dtype=src_dtype, _backend=backend)
     src_dtype = src_dtype or a.dtype
     b = rf.convert_to_tensor(b, dtype=src_dtype, _backend=backend)
     # sanity checks
     # noinspection PyProtectedMember
     assert a._raw_backend == b._raw_backend, "Cannot combine tensors from two different frontends, e.g. TF and PT"
-    assert a.dtype == b.dtype, f"For now only operations with Tensors of the same dtypes are supported, got {a} and {b}"
+    if res_dtype is None:
+        assert (
+            a.dtype == b.dtype
+        ), f"For now only operations with Tensors of the same dtypes are supported, got {a} and {b}"
     all_dims = []
     for dim in a.dims + b.dims:
         if dim in all_dims:
             continue
         # Not simply `all_dims.append(dim)`,
         # because a dim might occur multiple times in a.dims or b.dims
         # (with different match_priority),
```

### Comparing `returnn-1.20230411.4301/returnn/frontend/array_.py` & `returnn-1.20230412.101550/returnn/frontend/array_.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/const.py` & `returnn-1.20230412.101550/returnn/frontend/const.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/dtype.py` & `returnn-1.20230412.101550/returnn/frontend/dtype.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/init.py` & `returnn-1.20230412.101550/returnn/frontend/init.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/linear.py` & `returnn-1.20230412.101550/returnn/frontend/linear.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/loss.py` & `returnn-1.20230412.101550/returnn/frontend/loss.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/math_.py` & `returnn-1.20230412.101550/returnn/frontend/math_.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/matmul.py` & `returnn-1.20230412.101550/returnn/frontend/matmul.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/module.py` & `returnn-1.20230412.101550/returnn/frontend/module.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/parameter.py` & `returnn-1.20230412.101550/returnn/frontend/parameter.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/rand.py` & `returnn-1.20230412.101550/returnn/frontend/rand.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/reduce.py` & `returnn-1.20230412.101550/returnn/frontend/reduce.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/run_ctx.py` & `returnn-1.20230412.101550/returnn/frontend/run_ctx.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/state.py` & `returnn-1.20230412.101550/returnn/frontend/state.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/frontend/types.py` & `returnn-1.20230412.101550/returnn/frontend/types.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/import_/common.py` & `returnn-1.20230412.101550/returnn/import_/common.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/import_/git.py` & `returnn-1.20230412.101550/returnn/import_/git.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/import_/import_.py` & `returnn-1.20230412.101550/returnn/import_/import_.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/learning_rate_control.py` & `returnn-1.20230412.101550/returnn/learning_rate_control.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/log.py` & `returnn-1.20230412.101550/returnn/log.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/native_op.cpp` & `returnn-1.20230412.101550/returnn/native_op.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/native_op.py` & `returnn-1.20230412.101550/returnn/native_op.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/pretrain.py` & `returnn-1.20230412.101550/returnn/pretrain.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/sprint/cache.py` & `returnn-1.20230412.101550/returnn/sprint/cache.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/sprint/control.py` & `returnn-1.20230412.101550/returnn/sprint/control.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/sprint/error_signals.py` & `returnn-1.20230412.101550/returnn/sprint/error_signals.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/sprint/extern_interface.py` & `returnn-1.20230412.101550/returnn/sprint/extern_interface.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/sprint/interface.py` & `returnn-1.20230412.101550/returnn/sprint/interface.py`

 * *Files 1% similar despite different names*

```diff
@@ -351,16 +351,16 @@
     # Init what we need. These can be called multiple times.
     # If we use both the PythonSegmentOrder and the PythonTrainer, this will be called first.
     # The PythonTrainer will be called lazily once it gets the first data.
     _init_base(configfile=kwargs.get("config", None))
     sprintDataset.use_multiple_epochs()
 
     finalEpoch = get_final_epoch()
-    startEpoch, startSegmentIdx = Engine.get_train_start_epoch_batch(config)
-    print("Sprint: Starting with epoch %i, segment-idx %s." % (startEpoch, startSegmentIdx))
+    startEpoch = Engine.get_train_start_epoch(config)
+    print("Sprint: Starting with epoch %i." % (startEpoch,))
     print("Final epoch is: %i" % finalEpoch)
 
     # Loop over multiple epochs. Epochs start at 1.
     for curEpoch in range(startEpoch, finalEpoch + 1):
         if isTrainThreadStarted:
             # So that the RETURNN train thread always has the SprintDatasetBase in a sane state before we reset it.
             sprintDataset.wait_for_returnn_epoch(curEpoch)
```

### Comparing `returnn-1.20230411.4301/returnn/tensor/_dim_extra.py` & `returnn-1.20230412.101550/returnn/tensor/_dim_extra.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tensor/_tensor_extra.py` & `returnn-1.20230412.101550/returnn/tensor/_tensor_extra.py`

 * *Files 1% similar despite different names*

```diff
@@ -783,48 +783,59 @@
         :return: copy of self with feature_dim_axis being the very last axis
         """
         assert self.feature_dim_axis is not None
         return self.copy_with_feature_dim_axis(-1)
 
     def copy_add_batch_dim(self, batch_dim_axis, batch=None, dim_tag=None) -> _t.Tensor:
         """
-        Warning: Assumes TensorFlow.
-
         :param int batch_dim_axis:
         :param BatchInfo|None batch:
         :param Dim|None dim_tag:
         :return: copy of myself with added batch-dim
         """
         assert self.batch_dim_axis is None
-        if not batch:
-            from returnn.tf.layers.base import LayerBase
-
-            batch = LayerBase.get_recent_layer().get_batch_info()
         if batch_dim_axis < 0:
             assert batch_dim_axis + self.batch_ndim + 1 >= 0
             batch_dim_axis += self.batch_ndim + 1
         assert 0 <= batch_dim_axis <= self.batch_ndim
         data_opts = self.get_kwargs(include_special_axes=False)
         placeholder = self.placeholder
         if placeholder is not None:
             backend = self._raw_backend
             placeholder = backend.expand_dims_raw(placeholder, batch_dim_axis)
-            if not isinstance(batch.dim, int) or batch.dim != 1:
-                placeholder = backend.expand_raw(placeholder, batch_dim_axis, batch.dim)
+            if batch:
+                batch_dim_ = batch.dim
+            elif dim_tag:
+                if dim_tag.dyn_size_ext:
+                    assert dim_tag.dyn_size_ext.dims == ()
+                    assert dim_tag.dyn_size_ext.raw_tensor is not None
+                    batch_dim_ = dim_tag.dyn_size_ext.raw_tensor
+                elif dim_tag.dimension:
+                    batch_dim_ = dim_tag.dimension
+                else:
+                    raise Exception(f"{self} copy_add_batch_dim: unknown batch dim for {dim_tag!r}")
+            else:
+                raise Exception(f"{self} copy_add_batch_dim: unknown batch dim ")
+            if not isinstance(batch_dim_, int) or batch_dim_ != 1:
+                placeholder = backend.expand_raw(placeholder, batch_dim_axis, batch_dim_)
         dim_tags = list(self.dim_tags)
         if dim_tag:
             assert dim_tag.is_batch_dim()
-            assert dim_tag.dimension == batch.static_dim or dim_tag.dimension is None
             assert dim_tag.batch == batch
+            if batch:
+                assert dim_tag.dimension == batch.static_dim or dim_tag.dimension is None
         else:
-            dim_tag = Dim(kind=Dim.Types.Batch, description="batch", dimension=batch.static_dim, batch=batch)
+            dim_tag = Dim(
+                kind=Dim.Types.Batch, description="batch", dimension=batch.static_dim if batch else None, batch=batch
+            )
         dim_tags.insert(batch_dim_axis, dim_tag)
         data_opts["dims"] = dim_tags
-        data_opts["batch"] = batch
-        data_opts["beam"] = batch.beam
+        if batch:
+            data_opts["batch"] = batch
+            data_opts["beam"] = batch.beam
         other_special_axes = self.get_special_axes_dict(counted_with_batch_dim=True, only_available=True)
         for k, a in other_special_axes.items():
             data_opts[k] = a if (a < batch_dim_axis) else (a + 1)
         return _t.Tensor(placeholder=placeholder, **data_opts)
 
     def copy_add_spatial_dim(self, spatial_dim_axis=None, dim=1, auto_time_dim_axis=True) -> _t.Tensor:
         """
@@ -905,22 +916,25 @@
             axis += self.batch_ndim + 1
         assert 0 <= axis <= self.batch_ndim
 
         if dim_tag.is_batch_dim():
             if unbroadcast:
                 return self.copy_add_batch_dim(batch_dim_axis=axis, batch=dim_tag.batch, dim_tag=dim_tag)
             else:
-                from returnn.tf.util.data import BatchInfo
+                if dim_tag.batch or self.batch:
+                    from returnn.tf.util.data import BatchInfo
 
-                batch_info = BatchInfo.make_global_broadcast_batch_info()
-                return self.copy_add_batch_dim(
-                    batch_dim_axis=axis,
-                    batch=batch_info,
-                    dim_tag=dim_tag if (dim_tag.dimension == 1 and dim_tag.batch == batch_info) else None,
-                )
+                    batch_info = BatchInfo.make_global_broadcast_batch_info()
+                else:
+                    batch_info = None
+                if dim_tag and dim_tag.dimension == 1 and dim_tag.batch == batch_info:
+                    pass  # keep it
+                else:
+                    dim_tag = Dim(kind=Dim.Types.Batch, description="batch-broadcast", dimension=1, batch=batch_info)
+                return self.copy_add_batch_dim(batch_dim_axis=axis, batch=batch_info, dim_tag=dim_tag)
 
         data_opts = self.get_kwargs()
         # Note: if dim_tag is feature, but we are sparse, we just make it spatial
         if self.sparse and dim_tag.is_feature_dim():
             dim_tag = dim_tag.copy(same_as_self=True, kind=Dim.Types.Spatial)
         if not unbroadcast and dim_tag.dimension != 1:
             dim_tag = Dim(
@@ -2731,40 +2745,17 @@
         return tag.dyn_size_ext.copy_compatible_to(self, check_dtype=False, check_sparse=False).placeholder
 
     def num_elements(self: Tensor) -> Union[int, Tensor]:
         """
         :return: number of elements in this tensor, i.e. prod(self.shape)
         :rtype: tf.Tensor
         """
-        if all(dim.is_static() for dim in self.dims):
-            n = 1
-            for dim in self.dims:
-                n *= dim.dimension
-            return n
-
         import returnn.frontend as rf
 
-        n = 1
-        dims = list(self.dims)
-        dims.sort(key=lambda dim: -dim.dyn_size_ext.batch_ndim if dim.dyn_size_ext else 0)
-        while dims:
-            dim = dims.pop(0)
-            if dim.is_static():
-                n *= dim.dimension
-                continue
-            # E.g. dyn_size_ext is shape [B], and self has shape [B,T].
-            # Due to the sorting of dims above, dims will be [T,B], and we will first process T.
-            # We want to sum over dyn_size_ext, but then we need to remove the other dims it covers.
-            for dim_ in dim.dyn_size_ext.dims:
-                assert dim_ in dims  # num elements not really well-defined then
-                assert not dim_.need_masking()  # not implemented
-                dims.remove(dim_)
-            n_ = rf.reduce_sum(dim.dyn_size_ext, axis=dim.dyn_size_ext.dims)
-            n *= n_
-        return n
+        return rf.num_elements_of_shape(self.dims)
 
     def copy_masked(self: Tensor, mask_value) -> Tensor:
         """
         :param float|int|tf.Tensor|Tensor mask_value:
         """
         assert self.placeholder is not None
         if not any(dim.need_masking() for dim in self.dims):
@@ -2808,17 +2799,19 @@
         return self.dim_tags[self.batch_dim_axis]
 
     def get_static_batch_dim(self):
         """
         :rtype: int|None
         """
         # Do not fallback to get_batch_dim or get_recent_layer or so. This should be safe.
-        if not self.batch:
-            return None
-        return self.batch.static_dim
+        if self.batch:
+            return self.batch.static_dim
+        if self.have_batch_axis():
+            return self.get_batch_dim_tag().dimension
+        return None
 
     def get_spatial_batch_axes(self):
         """
         :rtype: list[int]
         :return: list of axes which are not batch axes and not feature or which are time axis or dynamic.
           counted with batch-dim.
         """
```

### Comparing `returnn-1.20230411.4301/returnn/tensor/_tensor_mixin_base.py` & `returnn-1.20230412.101550/returnn/tensor/_tensor_mixin_base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tensor/_tensor_op_overloads.py` & `returnn-1.20230412.101550/returnn/tensor/_tensor_op_overloads.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tensor/control_flow_ctx.py` & `returnn-1.20230412.101550/returnn/tensor/control_flow_ctx.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tensor/dim.py` & `returnn-1.20230412.101550/returnn/tensor/dim.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tensor/marked_dim.py` & `returnn-1.20230412.101550/returnn/tensor/marked_dim.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tensor/tensor.py` & `returnn-1.20230412.101550/returnn/tensor/tensor.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tensor/tensor_dict.py` & `returnn-1.20230412.101550/returnn/tensor/tensor_dict.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/compat.py` & `returnn-1.20230412.101550/returnn/tf/compat.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/data_pipeline.py` & `returnn-1.20230412.101550/returnn/tf/data_pipeline.py`

 * *Files 1% similar despite different names*

```diff
@@ -321,15 +321,15 @@
         }
         # Numpy cannot handle "string" dtype. Just make it a list[str], which is what TF can handle.
         data.update({k: [""] * batch.num_slices for k in self.data_keys if self.extern_data.data[k].dtype == "string"})
         data.update({"seq_idx": [-1] * batch.num_slices, "seq_tag": [""] * batch.num_slices})
         seq_lens = {
             k: numpy.zeros(shape=(shapes[k][0],), dtype=self.extern_data.data[k].size_dtype)
             for k in self.data_keys
-            if self.extern_data.data[k].have_time_axis()
+            if self.extern_data.data[k].get_dynamic_axes()
         }
         self.dataset.load_seqs(batch.start_seq, batch.end_seq)
         from returnn.util.basic import slice_pad_zeros
 
         with self.dataset.lock or contextlib.nullcontext():
             for seq in batch.seqs:
                 o = seq.batch_frame_offset
@@ -339,19 +339,23 @@
                 for k in self.data_keys:
                     # Some special cases first, such as "seq_idx" and "seq_tag".
                     # See also :func:`TFNetwork.get_extern_data`.
                     if k in ["seq_idx", "seq_tag"]:
                         continue  # handled below. will always be added
                     if k in self.extern_data.extra_added_keys:
                         continue
-                    if self.extern_data.data[k].have_time_axis():
+                    data_ = self.extern_data.data[k]
+                    # Do not rely on time_dim_axis but check for any dynamic axes.
+                    dyn_axes = data_.get_dynamic_axes()
+                    assert len(dyn_axes) <= 1, f"unexpected dynamic axes in data {k!r} {data_}"
+                    if dyn_axes:
                         if length.get(k) in [0, None]:
                             continue
                     v = self.dataset.get_data(seq.seq_idx, k)
-                    if self.extern_data.data[k].have_time_axis():
+                    if dyn_axes:
                         v = slice_pad_zeros(v, begin=seq.seq_start_frame[k], end=seq.seq_end_frame[k])
                         ls = v.shape[0]
                         if ls != length[k]:
                             raise Exception(
                                 "got shape[0]: %i, expected: %i, start/end: %r/%r, seq_idx: %i, seq len: %r"
                                 % (
                                     ls,
```

### Comparing `returnn-1.20230411.4301/returnn/tf/distributed.py` & `returnn-1.20230412.101550/returnn/tf/distributed.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/engine.py` & `returnn-1.20230412.101550/returnn/tf/engine.py`

 * *Files 1% similar despite different names*

```diff
@@ -8,35 +8,38 @@
 managing the data pipeline, etc.
 
 See :ref:`tech_overview` for an overview how it fits all together.
 """
 
 from __future__ import annotations
 
+from typing import Optional
+import typing
 import os
 import sys
 import time
-import typing
 import numpy
 import tensorflow as tf
 from tensorflow.python.client import timeline
 
 from returnn.engine.base import EngineBase
 from returnn.datasets.basic import Dataset, Batch, BatchSetGenerator, init_dataset
 from returnn.datasets.util.vocabulary import Vocabulary
 from returnn.learning_rate_control import load_learning_rate_control_from_config
 from returnn.log import log
 from returnn.pretrain import pretrain_from_config
+import returnn.tf.frontend_layers as rfl
 import returnn.tf.compat as tf_compat
 from returnn.tf.network import TFNetwork, ExternData, help_on_tf_exception
 from returnn.tf.util.data import Data
 from returnn.tf.layers.base import LayerBase
 from returnn.tf.updater import Updater
 from returnn.tf.data_pipeline import FeedDictDataProvider, DatasetDataProvider
 import returnn.tf.horovod as tf_horovod
+import returnn.util.basic as util
 from returnn.util.basic import hms, NumbersDict, BackendEngine, BehaviorVersion
 from pprint import pprint
 
 
 class CancelTrainingException(Exception):
     """
     Training was cancelled.
@@ -874,14 +877,15 @@
                 default_fallback_engine = BackendEngine.TensorFlowNetDict
             else:
                 default_fallback_engine = BackendEngine.TensorFlow
             BackendEngine.select_engine(default_fallback_engine=default_fallback_engine, config=self.config)
         assert BackendEngine.is_tensorflow_selected()
         self.orig_config = {}  # see _maybe_update_config
         self.custom_get_net_dict = None  # type: typing.Optional[typing.Callable]
+        self._have_rf_get_model_func = False
         self._check_devices()
         self.tf_session = None  # type: typing.Optional[tf.compat.v1.Session]
         self.network = None  # type: typing.Optional[TFNetwork]
         self.updater = None  # type: typing.Optional[Updater]
         self._checked_uninitialized_vars = False
         self._merge_all_summaries = None
         self.dataset_batches = {}  # type: typing.Dict[str,BatchSetGenerator]
@@ -1101,15 +1105,15 @@
         if dev_data:
             self.eval_datasets["dev"] = dev_data
         if eval_data:
             self.eval_datasets["eval"] = eval_data
         if config.has("eval_datasets"):
             for dataset_name, dataset_opts in config.typed_value("eval_datasets", {}).items():
                 self.eval_datasets[dataset_name] = init_dataset(dataset_opts, default_kwargs={"name": dataset_name})
-        self.start_epoch, self.start_batch = self.get_train_start_epoch_batch(config)
+        self.start_epoch = self.get_train_start_epoch(config)
         self.batch_size = config.typed_value("batch_size", 1)
         self.shuffle_batches = config.bool("shuffle_batches", False)
         self.update_batch_size = config.int("update_batch_size", 0)
         self.save_model_epoch_interval = config.int("save_interval", 1)
         self.save_epoch1_initial_model = config.bool("save_epoch1_initial_model", False)
         self.initial_learning_rate = self.learning_rate
         self.pretrain_learning_rate = config.float("pretrain_learning_rate", self.learning_rate)
@@ -1134,23 +1138,29 @@
         if isinstance(self.min_seq_length, dict):
             self.min_seq_length = NumbersDict(self.min_seq_length)
         assert isinstance(self.min_seq_length, (int, float, NumbersDict))
         self.max_pad_size = config.typed_value("max_pad_size", None)
         # And also initialize the network. That depends on some vars here such as pretrain.
         self.init_network_from_config(config)
 
-    def get_net_dict_for_epoch(self, epoch, config=None):
+    def get_net_dict_for_epoch(self, *, epoch: int, step: Optional[int] = None, config=None):
         """
-        :param int epoch:
+        :param epoch:
+        :param step:
         :param returnn.config.Config|None config:
         :rtype: dict[str]
         """
         if not config:
             config = self.config
-        if self.is_pretrain_epoch(epoch=epoch):
+        if self._have_rf_get_model_func:
+            assert BackendEngine.get_selected_engine() == BackendEngine.TensorFlowNetDict  # not implemented otherwise
+            assert not self.pretrain  # the RF API uses a different pretrain mechanism
+            assert epoch is not None and step is not None
+            net_dict = rfl.get_net_dict(epoch=epoch, step=step)
+        elif self.is_pretrain_epoch(epoch=epoch):
             # This would be obsolete if we don't want to load an existing model.
             # In self.init_train_epoch(), we initialize a new model.
             net_dict = self.pretrain.get_network_json_for_epoch(epoch)
         elif self.custom_get_net_dict:
             net_dict = self.custom_get_net_dict(epoch=epoch)
             assert isinstance(net_dict, dict), "%s should return dict but returned %s" % (
                 self.custom_get_net_dict,
@@ -1172,14 +1182,15 @@
         """
         if not config:
             config = self.config
         self.model_filename = config.value("model", None)
         self.preload_from_files = config.typed_value("preload_from_files", {})
         self.pretrain = pretrain_from_config(config)
         self.custom_get_net_dict = config.typed_value("get_network")
+        self._have_rf_get_model_func = bool(config.typed_value("get_model"))
         self.max_seqs = config.int("max_seqs", -1)
 
         epoch, model_epoch_filename = self.get_epoch_model(config)
         # Note that model_epoch_filename could be set but epoch could be None or 0.
         if not model_epoch_filename and not self.start_epoch:
             if self.config.bool("allow_random_model_init", False):
                 print("No model will be loaded. Randomly initializing model.", file=log.v2)
@@ -1191,20 +1202,28 @@
                 )
         # self.start_epoch is used as the start epoch in training.
         # If there is an existing model, it might be higher than 1.
         # In that case, epoch == self.start_epoch - 1.
         is_training = config.value("task", "train") == "train"
         is_first_train_epoch = not epoch and (is_training or config.value("task", "train") == "initialize_model")
         self.epoch = epoch
+        self.global_train_step = None
         if is_first_train_epoch:
             assert self.start_epoch >= 1
             self.epoch = self.start_epoch
+            self.global_train_step = 0
+        elif model_epoch_filename:
+            # read "global_step" from the model file
+            filepattern = util.get_checkpoint_filepattern(model_epoch_filename)
+            reader = tf_compat.v1.train.NewCheckpointReader(filepattern)
+            if reader.has_tensor("global_step"):
+                self.global_train_step = int(reader.get_tensor("global_step"))
         assert self.epoch, "task %r" % config.value("task", "train")
 
-        net_dict = self.get_net_dict_for_epoch(epoch=self.epoch, config=config)
+        net_dict = self.get_net_dict_for_epoch(epoch=self.epoch, step=self.global_train_step, config=config)
         if net_dict_post_proc:
             net_dict = net_dict_post_proc(net_dict)
 
         self._maybe_update_config(net_desc=net_dict, epoch=self.epoch)
         self._init_network(net_desc=net_dict, epoch=self.epoch)
 
         if self.preload_from_files:
@@ -1573,15 +1592,15 @@
             ignore_non_existing=self.is_pretrain_epoch() or self.custom_get_net_dict,
         )
 
     def train(self):
         """
         Does the whole training, i.e. the loop over all the epochs.
         """
-        print("start training at epoch %i and step %i" % (self.start_epoch, self.start_batch), file=log.v3)
+        print("start training at epoch %i" % (self.start_epoch,), file=log.v3)
         print("using batch size: %r, max seqs: %i" % (self.batch_size, self.max_seqs), file=log.v4)
         print("learning rate control:", self.learning_rate_control, file=log.v4)
         print("pretrain:", self.pretrain, file=log.v4)
         self.dataset_batches.clear()
 
         assert self.start_epoch >= 1, "Epochs start at 1."
         final_epoch = self.final_epoch if self.final_epoch != 0 else sys.maxsize
@@ -1738,14 +1757,16 @@
             if trainer.device_crash_batch is not None:  # Otherwise we got an unexpected exception - a bug in our code.
                 if self.model_filename:
                     self.save_model(self.get_epoch_model_filename() + ".crash_%i" % trainer.device_crash_batch)
             print("Trainer not finalized, quitting. (pid %i)" % os.getpid(), file=log.v1)
             trainer.exit_due_to_error()
 
         self._num_trained_epochs += 1
+        if self.global_train_step is not None:
+            self.global_train_step += trainer.num_steps
 
         if any(numpy.isinf(list(trainer.score.values()))) or any(numpy.isnan(list(trainer.score.values()))):
             print("Model seems broken, got inf or nan final score: %s" % trainer.score, file=log.v1)
             if self.config.bool("stop_on_nonfinite_train_score", True):
                 if self.model_filename:
                     self.save_model(self.get_epoch_model_filename() + ".broken")
                 sys.exit(1)
```

### Comparing `returnn-1.20230411.4301/returnn/tf/frontend_layers/_backend.py` & `returnn-1.20230412.101550/returnn/tf/frontend_layers/_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/frontend_layers/_utils.py` & `returnn-1.20230412.101550/returnn/tf/frontend_layers/_utils.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/frontend_layers/config_entry_points.py` & `returnn-1.20230412.101550/returnn/tf/frontend_layers/config_entry_points.py`

 * *Files 2% similar despite different names*

```diff
@@ -12,14 +12,17 @@
 from returnn.tensor import TensorDict, Tensor, Dim
 from returnn.config import get_global_config
 import returnn.frontend as rf
 from .. import frontend_layers as rfl
 from . import _utils
 
 
+__all__ = ["get_net_dict"]
+
+
 def get_net_dict(
     *,
     epoch: int,
     step: int,
 ) -> Dict[str, Any]:
     """called from the RETURNN config"""
     BehaviorVersion.set_min_behavior_version(rfl.min_returnn_behavior_version)
```

### Comparing `returnn-1.20230411.4301/returnn/tf/frontend_layers/debug_eager_mode.py` & `returnn-1.20230412.101550/returnn/tf/frontend_layers/debug_eager_mode.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/frontend_layers/dims.py` & `returnn-1.20230412.101550/returnn/tf/frontend_layers/dims.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/frontend_layers/layer.py` & `returnn-1.20230412.101550/returnn/tf/frontend_layers/layer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/frontend_layers/make_layer.py` & `returnn-1.20230412.101550/returnn/tf/frontend_layers/make_layer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/frontend_layers/prev_tensor_ref.py` & `returnn-1.20230412.101550/returnn/tf/frontend_layers/prev_tensor_ref.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/frontend_low_level/_backend.py` & `returnn-1.20230412.101550/returnn/tf/frontend_low_level/_backend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/horovod.py` & `returnn-1.20230412.101550/returnn/tf/horovod.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/hyper_param_tuning.py` & `returnn-1.20230412.101550/returnn/tf/hyper_param_tuning.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/layers/base.py` & `returnn-1.20230412.101550/returnn/tf/layers/base.py`

 * *Files 1% similar despite different names*

```diff
@@ -6,14 +6,15 @@
 
 from typing import Optional, Dict
 import typing
 import contextlib
 import numpy
 import tensorflow as tf
 from returnn.util.basic import NotSpecified, CollectionReadCheckCovered, BehaviorVersion
+import returnn.frontend as rf
 import returnn.tf.compat as tf_compat
 import returnn.tf.util.basic as tf_util
 from returnn.tf.util.data import Data, FeatureDim, Dim
 from returnn.tf.util.basic import OutputWithActivation, CustomUpdate, reuse_name_scope
 from returnn.log import log
 
 
@@ -2986,15 +2987,16 @@
             # Flat variants are with batch,time collapsed into one, masked via seq_lens.
             self.output_flat = None
             self.output_before_softmax_flat = None
             self.target_flat = None
             self.output_seq_lens = None
             self.target_seq_lens = None
             self.loss_norm_factor = 1.0
-            if self.output.have_time_axis():
+            out_dyn_axes = [axis for (axis, dim) in enumerate(self.output.batch_shape) if dim is None]
+            if self.output.have_time_axis() and self.output.have_batch_axis():
                 self.output_seq_lens = output.get_sequence_lengths()
                 time_and_batch_dims = (self.output.time_dim_axis, self.output.batch_dim_axis)
                 assert time_and_batch_dims in [(0, 1), (1, 0)], "output time-batch-dim unexpected: %r (target %r)" % (
                     self.output,
                     self.target,
                 )
                 if output_with_activation and output_with_activation.act_func is tf.nn.softmax:
@@ -3007,14 +3009,22 @@
                 if target:
                     assert target.have_time_axis()
                     self.target_seq_lens = target.get_sequence_lengths()
                     self.target_flat = self._flatten_or_merge(target)
                     self.loss_norm_factor = 1.0 / tf.cast(tf.reduce_sum(self.target_seq_lens), tf.float32)
                 else:
                     self.loss_norm_factor = 1.0 / tf.cast(tf.reduce_sum(self.output_seq_lens), tf.float32)
+            elif set(out_dyn_axes).difference([self.output.batch_dim_axis]):
+                # We have some dynamic axes (excl batch), but not the regular (batch,time)|(time,batch) dims.
+                assert len(out_dyn_axes) == 1, f"Loss flattening not implemented for {self.output}"
+                self.output_flat = output.placeholder
+                num_el = rf.num_elements_of_shape([self.output.dims[a] for a in out_dyn_axes])
+                if isinstance(num_el, Data):
+                    num_el = num_el.raw_tensor
+                self.loss_norm_factor = 1.0 / tf.cast(num_el, tf.float32)
             else:  # no time axis
                 if output_with_activation and output_with_activation.act_func is tf.nn.softmax:
                     self.output_before_softmax_flat = output_with_activation.x
                 else:
                     self.output_flat = output.placeholder
                 if self.output.have_batch_axis():
                     self.loss_norm_factor = 1.0 / tf.cast(
```

### Comparing `returnn-1.20230411.4301/returnn/tf/layers/basic.py` & `returnn-1.20230412.101550/returnn/tf/layers/basic.py`

 * *Files 0% similar despite different names*

```diff
@@ -2953,17 +2953,29 @@
                 # The underlying implementation in more recent TF versions uses gen_stateless_random_ops_v2
                 # which is good.
                 # Earlier TF versions uses gen_stateful_random_ops which requires a tf.Variable
                 # so we cannot use it.
                 # In that case, we can still do some fallback here for the case with a static seed.
                 if tf_util.tf_version_tuple() < (2, 6, 0):
                     assert algorithm is None, "%s: custom algorithm not supported on older TF version" % self
+                    if isinstance(seed, int):
+                        # Similar as in TF stateful_random_ops _make_1d_state:
+                        # Chop the Python integer (infinite precision) into chunks.
+                        ls = []
+                        for _ in range(2):  # need 2 chunks, see below
+                            ls.append(seed & (2**31 - 1))
+                            seed >>= 31
+                        seed = ls
                     for func_name in ["normal", "truncated_normal", "uniform"]:
                         func = getattr(tf.random, "stateless_" + func_name)
-                        setattr(self, func_name, lambda _func=func, **kwargs_: _func(seed=seed[:2], **kwargs_))
+                        setattr(
+                            self,
+                            func_name,
+                            lambda _func=func, **kwargs_: _func(seed=seed[:2], **kwargs_),
+                        )
 
         self.explicit_state = explicit_state
         if explicit_state is None:
             if static is None or static is False:
                 assert auto_update_state is None or auto_update_state is True, (
                     "%s: without explicit state, we always auto-update" % self
                 )
```

### Comparing `returnn-1.20230411.4301/returnn/tf/layers/rec.py` & `returnn-1.20230412.101550/returnn/tf/layers/rec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/layers/segmental_model.py` & `returnn-1.20230412.101550/returnn/tf/layers/segmental_model.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/layers/signal_processing.py` & `returnn-1.20230412.101550/returnn/tf/layers/signal_processing.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/native_op.py` & `returnn-1.20230412.101550/returnn/tf/native_op.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/network.py` & `returnn-1.20230412.101550/returnn/tf/network.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/sprint.py` & `returnn-1.20230412.101550/returnn/tf/sprint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/updater.py` & `returnn-1.20230412.101550/returnn/tf/updater.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/util/basic.py` & `returnn-1.20230412.101550/returnn/tf/util/basic.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/util/data.py` & `returnn-1.20230412.101550/returnn/tf/util/data.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/util/ken_lm.py` & `returnn-1.20230412.101550/returnn/tf/util/ken_lm.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/tf/util/open_fst.py` & `returnn-1.20230412.101550/returnn/tf/util/open_fst.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/torch/data/pipeline.py` & `returnn-1.20230412.101550/returnn/torch/data/pipeline.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/torch/data/returnn_dataset_wrapper.py` & `returnn-1.20230412.101550/returnn/torch/data/returnn_dataset_wrapper.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/torch/data/tensor_utils.py` & `returnn-1.20230412.101550/returnn/torch/data/tensor_utils.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/torch/engine.py` & `returnn-1.20230412.101550/returnn/torch/engine.py`

 * *Files 1% similar despite different names*

```diff
@@ -45,15 +45,14 @@
         self._train_dataloader = None  # type: Optional[DataLoader2]
         self._eval_dataloaders = {}  # type: Dict[str, DataLoader2]
 
         self._start_epoch = None  # type: Optional[int]
         self._final_epoch = None  # type: Optional[int]
         self._orig_model = None  # type: Optional[Union[rf.Module, torch.nn.Module]]
         self._pt_model = None  # type: Optional[torch.nn.Module]
-        self._train_step = 0
         self._train_step_func = None  # type: Optional[Callable]
         self._save_model_epoch_interval = 1
         self._updater = None  # type: Optional[Updater]
 
         self._device = "cuda" if torch.cuda.is_available() else "cpu"
 
     def init_train_from_config(
@@ -86,15 +85,15 @@
         extern_data.update(extern_data_dict, auto_convert=True)
         self.extern_data = extern_data
 
         self._train_dataloader = self._create_data_loader(train_data) if train_data else None
         for dataset_name, dataset in self.eval_datasets.items():
             self._eval_dataloaders[dataset_name] = self._create_data_loader(dataset)
 
-        self._start_epoch, _ = self.get_train_start_epoch_batch(self.config)
+        self._start_epoch = self.get_train_start_epoch(self.config)
         self._final_epoch = self.config_get_final_epoch(self.config)
 
         self._load_model(epoch=self._start_epoch)
         self._save_model_epoch_interval = config.int("save_interval", 1)
 
         self._updater = Updater(self.config, self._pt_model, self.learning_rate)
         self._updater.create_optimizer()
@@ -163,15 +162,15 @@
             self._updater.get_optimizer().step()
 
             accumulated_losses_dict += losses_dict
             accumulated_inv_norm_factors_dict += inv_norm_factors_dict
             print(f"step {step_idx}, loss: {dict(losses_dict / inv_norm_factors_dict)}", file=log.v4)
 
             step_idx += 1
-            self._train_step += 1
+            self.global_train_step += 1
 
         print("Trained %i steps" % step_idx)
 
         accumulated_losses_dict = accumulated_losses_dict / accumulated_inv_norm_factors_dict
         self.learning_rate_control.set_epoch_error(
             self.epoch, {f"train_loss_{k}": v for k, v in accumulated_losses_dict.items()}
         )
@@ -301,15 +300,15 @@
             filename = self.get_epoch_model_filename(epoch=epoch - 1) + util.get_model_filename_postfix()
             print("Load model %s" % (filename,), file=log.v4)
             checkpoint_state = torch.load(filename)
             assert checkpoint_state["epoch"] == epoch - 1
             step = checkpoint_state["step"]
         else:
             step = 0
-        self._train_step = step
+        self.global_train_step = step
 
         # See :mod:`rf.rand` docstring for an explanation of this logic.
         random_seed = self.config.int("random_seed", 42)
         random_seed = (epoch * 193939 + step * 19937 + random_seed * 27644437 + 479001599) % (2**31)
         rf.set_random_seed(random_seed)
 
         get_model_func = self.config.typed_value("get_model")
@@ -390,15 +389,17 @@
         """
         filename = self.get_epoch_model_filename() + util.get_model_filename_postfix()
         directory = os.path.dirname(filename)
         if not os.path.exists(directory):
             os.makedirs(directory, exist_ok=True)
 
         print("Save model under %s" % (filename,), file=log.v4)
-        torch.save({"model": self._pt_model.state_dict(), "epoch": self.epoch, "step": self._train_step}, filename)
+        torch.save(
+            {"model": self._pt_model.state_dict(), "epoch": self.epoch, "step": self.global_train_step}, filename
+        )
 
     def _load_optimizer(self, epoch):
         """
         Loads a torch.optim.Optimizer from disk and uses it as the optimizer.
         This function is a wrapper to Updater.load_optimizer().
 
         :param int epoch: Epoch from which to load the optimizer state.
```

### Comparing `returnn-1.20230411.4301/returnn/torch/frontend/_backend.py` & `returnn-1.20230412.101550/returnn/torch/frontend/_backend.py`

 * *Files 1% similar despite different names*

```diff
@@ -189,25 +189,27 @@
     def softmax(tensor: Tensor, *, axis: Dim) -> Tensor:
         """
         :param tensor:
         :param axis:
         :return: softmax over axis
         """
         out = tensor.copy_template("softmax")
+        assert not axis.need_masking(), "not implemented"
         out.raw_tensor = torch.softmax(tensor.raw_tensor, dim=tensor.dims.index(axis))
         return out
 
     @staticmethod
     def log_softmax(tensor: Tensor, *, axis: Dim) -> Tensor:
         """
         :param tensor:
         :param axis:
         :return: log_softmax over axis
         """
         out = tensor.copy_template("log_softmax")
+        assert not axis.need_masking(), "not implemented"
         out.raw_tensor = torch.log_softmax(tensor.raw_tensor, dim=tensor.dims.index(axis))
         return out
 
     @staticmethod
     def softmax_cross_entropy_with_logits(*, logits: Tensor, targets: Tensor, axis: Dim):
         """
         Efficient cross entropy. For PyTorch this is actually the default cross entropy function.
@@ -522,15 +524,15 @@
         else:
             assert mode == "sum"  # not implemented otherwise for multiple axes
             raw_result = func(source.raw_tensor, dim=raw_dims)
         res = Tensor(
             name=f"reduce_{mode}",
             raw_tensor=raw_result,
             dims=res_dims,
-            dtype=source.dtype,
+            dtype=TorchBackend.get_dtype_name_raw(raw_result),
             sparse_dim=source.sparse_dim,
         )
         return res
 
     @staticmethod
     @contextlib.contextmanager
     def random_journal_record() -> List[Dict[str, Any]]:
@@ -683,15 +685,15 @@
         tensor = tensor.copy_compatible_to(tensor_templ, add_dims=False)
         mask = mask.copy_compatible_to(tensor_templ, check_dtype=False, check_sparse=False)
         out_raw = torch.masked_select(tensor.raw_tensor, mask.raw_tensor)
         remaining_shape = [d.get_dim_value() for d in remaining_dims]
         remaining_num_elements = numpy.prod(remaining_shape) if remaining_shape else 1
         assert out_raw.numel() % remaining_num_elements == 0
         flattened_num_elements = out_raw.numel() // remaining_num_elements
-        out_raw = out_raw.resize(flattened_num_elements, *remaining_shape)
+        out_raw = torch.reshape(out_raw, [flattened_num_elements] + remaining_shape)
         if not out_dim:
             out_dim = TorchBackend.get_new_dim_raw(out_raw, 0, name="masked_select")
         out = Tensor(
             "masked_select",
             dims=(out_dim,) + tuple(remaining_dims),
             dtype=tensor.dtype,
             sparse_dim=tensor.sparse_dim,
```

### Comparing `returnn-1.20230411.4301/returnn/torch/frontend/_rand.py` & `returnn-1.20230412.101550/returnn/torch/frontend/_rand.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/torch/frontend/bridge.py` & `returnn-1.20230412.101550/returnn/torch/frontend/bridge.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/torch/updater.py` & `returnn-1.20230412.101550/returnn/torch/updater.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/util/basic.py` & `returnn-1.20230412.101550/returnn/util/basic.py`

 * *Files 0% similar despite different names*

```diff
@@ -17,9015 +17,9016 @@
 00000100: 6365 7373 4572 726f 720a 0a69 6d70 6f72  cessError..impor
 00000110: 7420 6835 7079 0a66 726f 6d20 636f 6c6c  t h5py.from coll
 00000120: 6563 7469 6f6e 7320 696d 706f 7274 2064  ections import d
 00000130: 6571 7565 0a69 6d70 6f72 7420 696e 7370  eque.import insp
 00000140: 6563 740a 696d 706f 7274 206f 730a 696d  ect.import os.im
 00000150: 706f 7274 2073 7973 0a69 6d70 6f72 7420  port sys.import 
 00000160: 7368 6c65 780a 696d 706f 7274 206d 6174  shlex.import mat
-00000170: 680a 696d 706f 7274 206e 756d 7079 2061  h.import numpy a
-00000180: 7320 6e70 0a69 6d70 6f72 7420 7265 0a69  s np.import re.i
-00000190: 6d70 6f72 7420 7469 6d65 0a69 6d70 6f72  mport time.impor
-000001a0: 7420 636f 6e74 6578 746c 6962 0a0a 7472  t contextlib..tr
-000001b0: 793a 0a20 2020 2069 6d70 6f72 7420 7468  y:.    import th
-000001c0: 7265 6164 0a65 7863 6570 7420 496d 706f  read.except Impo
-000001d0: 7274 4572 726f 723a 0a20 2020 2069 6d70  rtError:.    imp
-000001e0: 6f72 7420 5f74 6872 6561 6420 6173 2074  ort _thread as t
-000001f0: 6872 6561 640a 696d 706f 7274 2074 6872  hread.import thr
-00000200: 6561 6469 6e67 0a0a 6672 6f6d 2069 6f20  eading..from io 
-00000210: 696d 706f 7274 2042 7974 6573 494f 0a69  import BytesIO.i
-00000220: 6d70 6f72 7420 7479 7069 6e67 0a66 726f  mport typing.fro
-00000230: 6d20 7265 7475 726e 6e2e 6c6f 6720 696d  m returnn.log im
-00000240: 706f 7274 206c 6f67 0a69 6d70 6f72 7420  port log.import 
-00000250: 6275 696c 7469 6e73 0a0a 5059 3320 3d20  builtins..PY3 = 
-00000260: 7379 732e 7665 7273 696f 6e5f 696e 666f  sys.version_info
-00000270: 5b30 5d20 3e3d 2033 0a0a 756e 6963 6f64  [0] >= 3..unicod
-00000280: 6520 3d20 7374 720a 6c6f 6e67 203d 2069  e = str.long = i
-00000290: 6e74 0a23 206e 6f69 6e73 7065 6374 696f  nt.# noinspectio
-000002a0: 6e20 5079 5368 6164 6f77 696e 6742 7569  n PyShadowingBui
-000002b0: 6c74 696e 730a 696e 7075 7420 3d20 6275  ltins.input = bu
-000002c0: 696c 7469 6e73 2e69 6e70 7574 0a0a 0a54  iltins.input...T
-000002d0: 203d 2054 7970 6556 6172 2822 5422 290a   = TypeVar("T").
-000002e0: 4b20 3d20 5479 7065 5661 7228 224b 2229  K = TypeVar("K")
-000002f0: 0a56 203d 2054 7970 6556 6172 2822 5622  .V = TypeVar("V"
-00000300: 290a 0a72 6574 7572 6e6e 5f72 6f6f 745f  )..returnn_root_
-00000310: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
-00000320: 726e 616d 6528 6f73 2e70 6174 682e 6469  rname(os.path.di
-00000330: 726e 616d 6528 6f73 2e70 6174 682e 6469  rname(os.path.di
-00000340: 726e 616d 6528 6f73 2e70 6174 682e 6162  rname(os.path.ab
-00000350: 7370 6174 6828 5f5f 6669 6c65 5f5f 2929  spath(__file__))
-00000360: 2929 0a0a 0a63 6c61 7373 204e 6f74 5370  ))...class NotSp
-00000370: 6563 6966 6965 6428 6f62 6a65 6374 293a  ecified(object):
-00000380: 0a20 2020 2022 2222 0a20 2020 2054 6869  .    """.    Thi
-00000390: 7320 6973 206a 7573 7420 6120 706c 6163  s is just a plac
-000003a0: 6568 6f6c 6465 722c 2074 6f20 6265 2075  eholder, to be u
-000003b0: 7365 6420 6173 2064 6566 6175 6c74 2061  sed as default a
-000003c0: 7267 756d 656e 7420 746f 206d 6172 6b20  rgument to mark 
-000003d0: 7468 6174 2069 7420 6973 206e 6f74 2073  that it is not s
-000003e0: 7065 6369 6669 6564 2e0a 2020 2020 2222  pecified..    ""
-000003f0: 220a 0a20 2020 2064 6566 205f 5f73 7472  "..    def __str
-00000400: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-00000410: 2020 7265 7475 726e 2022 4e6f 7453 7065    return "NotSpe
-00000420: 6369 6669 6564 220a 0a20 2020 2064 6566  cified"..    def
-00000430: 205f 5f72 6570 725f 5f28 7365 6c66 293a   __repr__(self):
-00000440: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00000450: 223c 4e6f 7453 7065 6369 6669 6564 3e22  "<NotSpecified>"
-00000460: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00000470: 6f64 0a20 2020 2064 6566 2072 6573 6f6c  od.    def resol
-00000480: 7665 2863 6c73 2c20 7661 6c75 652c 2064  ve(cls, value, d
-00000490: 6566 6175 6c74 293a 0a20 2020 2020 2020  efault):.       
-000004a0: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
-000004b0: 7261 6d20 547c 4e6f 7453 7065 6369 6669  ram T|NotSpecifi
-000004c0: 6564 7c74 7970 655b 4e6f 7453 7065 6369  ed|type[NotSpeci
-000004d0: 6669 6564 5d20 7661 6c75 653a 0a20 2020  fied] value:.   
-000004e0: 2020 2020 203a 7061 7261 6d20 5520 6465       :param U de
-000004f0: 6661 756c 743a 0a20 2020 2020 2020 203a  fault:.        :
-00000500: 7274 7970 653a 2054 7c55 0a20 2020 2020  rtype: T|U.     
-00000510: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00000520: 6620 7661 6c75 6520 6973 204e 6f74 5370  f value is NotSp
-00000530: 6563 6966 6965 643a 0a20 2020 2020 2020  ecified:.       
-00000540: 2020 2020 2072 6574 7572 6e20 6465 6661       return defa
-00000550: 756c 740a 2020 2020 2020 2020 7265 7475  ult.        retu
-00000560: 726e 2076 616c 7565 0a0a 0a63 6c61 7373  rn value...class
-00000570: 2045 6e74 6974 793a 0a20 2020 2022 2222   Entity:.    """
-00000580: 0a20 2020 2054 6869 7320 6973 2061 2067  .    This is a g
-00000590: 656e 6572 6963 2070 6c61 6365 686f 6c64  eneric placehold
-000005a0: 6572 2077 6869 6368 2063 616e 2062 6520  er which can be 
-000005b0: 7573 6564 2066 6f72 2065 6e75 6d73 206f  used for enums o
-000005c0: 7220 6f74 6865 7220 6964 656e 7469 7469  r other identiti
-000005d0: 6573 2e0a 2020 2020 4279 2069 6e74 656e  es..    By inten
-000005e0: 7469 6f6e 2069 7420 7573 6573 206f 626a  tion it uses obj
-000005f0: 6563 742e 5f5f 6571 5f5f 2061 6e64 2063  ect.__eq__ and c
-00000600: 6f2c 2069 2e65 2e20 6060 6120 3d3d 2062  o, i.e. ``a == b
-00000610: 6060 2069 6666 2060 6061 2069 7320 6260  `` iff ``a is b`
-00000620: 602e 0a20 2020 2054 6865 206e 616d 6520  `..    The name 
-00000630: 6973 206a 7573 7420 666f 7220 6465 6275  is just for debu
-00000640: 6767 696e 6720 7075 7270 6f73 652e 0a20  gging purpose.. 
-00000650: 2020 2054 6869 7320 6973 206d 6f72 6520     This is more 
-00000660: 6566 6669 6369 656e 7420 7468 616e 2075  efficient than u
-00000670: 7369 6e67 206a 7573 7420 7468 6520 7374  sing just the st
-00000680: 7269 6e67 2064 6972 6563 746c 7920 696e  ring directly in
-00000690: 2061 6e20 656e 756d 2e0a 2020 2020 2222   an enum..    ""
-000006a0: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-000006b0: 745f 5f28 7365 6c66 2c20 6e61 6d65 3d4e  t__(self, name=N
-000006c0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-000006d0: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
-000006e0: 2073 7472 7c4e 6f6e 6520 6e61 6d65 3a0a   str|None name:.
-000006f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00000700: 2020 2020 7365 6c66 2e6e 616d 6520 3d20      self.name = 
-00000710: 6e61 6d65 0a0a 2020 2020 6465 6620 5f5f  name..    def __
-00000720: 7374 725f 5f28 7365 6c66 293a 0a20 2020  str__(self):.   
-00000730: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00000740: 2e6e 616d 650a 0a20 2020 2064 6566 205f  .name..    def _
-00000750: 5f72 6570 725f 5f28 7365 6c66 293a 0a20  _repr__(self):. 
-00000760: 2020 2020 2020 2072 6574 7572 6e20 223c         return "<
-00000770: 2573 3e22 2025 2073 656c 662e 6e61 6d65  %s>" % self.name
-00000780: 0a0a 2020 2020 6465 6620 5f5f 6765 7473  ..    def __gets
-00000790: 7461 7465 5f5f 2873 656c 6629 3a0a 2020  tate__(self):.  
-000007a0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-000007b0: 7074 696f 6e28 2243 616e 6e6f 7420 7069  ption("Cannot pi
-000007c0: 636b 6c65 2045 6e74 6974 7920 6f62 6a65  ckle Entity obje
-000007d0: 6374 2e20 2825 7229 2220 2520 7365 6c66  ct. (%r)" % self
-000007e0: 290a 0a0a 636c 6173 7320 4f70 7469 6f6e  )...class Option
-000007f0: 616c 4e6f 7449 6d70 6c65 6d65 6e74 6564  alNotImplemented
-00000800: 4572 726f 7228 4e6f 7449 6d70 6c65 6d65  Error(NotImpleme
-00000810: 6e74 6564 4572 726f 7229 3a0a 2020 2020  ntedError):.    
-00000820: 2222 220a 2020 2020 5468 6973 2063 616e  """.    This can
-00000830: 206f 7074 696f 6e61 6c6c 7920 6265 2069   optionally be i
-00000840: 6d70 6c65 6d65 6e74 6564 2c20 6275 7420  mplemented, but 
-00000850: 6974 2069 7320 6e6f 7420 7265 7175 6972  it is not requir
-00000860: 6564 2062 7920 7468 6520 4150 492e 0a20  ed by the API.. 
-00000870: 2020 2022 2222 0a0a 0a64 6566 2069 735f     """...def is_
-00000880: 3634 6269 745f 706c 6174 666f 726d 2829  64bit_platform()
-00000890: 3a0a 2020 2020 2222 220a 2020 2020 3a72  :.    """.    :r
-000008a0: 6574 7572 6e3a 2054 7275 6520 6966 2077  eturn: True if w
-000008b0: 6520 7275 6e20 6f6e 2036 3462 6974 2c20  e run on 64bit, 
-000008c0: 4661 6c73 6520 666f 7220 3332 6269 740a  False for 32bit.
-000008d0: 2020 2020 3a72 7479 7065 3a20 626f 6f6c      :rtype: bool
-000008e0: 0a20 2020 2068 7474 7073 3a2f 2f73 7461  .    https://sta
-000008f0: 636b 6f76 6572 666c 6f77 2e63 6f6d 2f71  ckoverflow.com/q
-00000900: 7565 7374 696f 6e73 2f31 3430 3539 3133  uestions/1405913
-00000910: 2f68 6f77 2d64 6f2d 692d 6465 7465 726d  /how-do-i-determ
-00000920: 696e 652d 6966 2d6d 792d 7079 7468 6f6e  ine-if-my-python
-00000930: 2d73 6865 6c6c 2d69 732d 6578 6563 7574  -shell-is-execut
-00000940: 696e 672d 696e 2d33 3262 6974 2d6f 722d  ing-in-32bit-or-
-00000950: 3634 6269 742d 6d6f 6465 2d6f 6e2d 6f73  64bit-mode-on-os
-00000960: 0a20 2020 2022 2222 0a20 2020 2072 6574  .    """.    ret
-00000970: 7572 6e20 7379 732e 6d61 7873 697a 6520  urn sys.maxsize 
-00000980: 3e20 322a 2a33 320a 0a0a 636c 6173 7320  > 2**32...class 
-00000990: 4261 636b 656e 6445 6e67 696e 653a 0a20  BackendEngine:. 
-000009a0: 2020 2022 2222 0a20 2020 2053 746f 7265     """.    Store
-000009b0: 7320 7768 6963 6820 6261 636b 656e 6420  s which backend 
-000009c0: 656e 6769 6e65 2077 6520 7573 6520 696e  engine we use in
-000009d0: 2052 4554 5552 4e4e 2e0a 2020 2020 452e   RETURNN..    E.
-000009e0: 672e 2054 656e 736f 7246 6c6f 7720 6f72  g. TensorFlow or
-000009f0: 2050 7954 6f72 6368 2e0a 2020 2020 2222   PyTorch..    ""
-00000a00: 220a 0a20 2020 2054 656e 736f 7246 6c6f  "..    TensorFlo
-00000a10: 774e 6574 4469 6374 203d 2031 0a20 2020  wNetDict = 1.   
-00000a20: 2054 656e 736f 7246 6c6f 7720 3d20 320a   TensorFlow = 2.
-00000a30: 2020 2020 546f 7263 6820 3d20 3320 2023      Torch = 3  #
-00000a40: 2050 7954 6f72 6368 0a20 2020 2073 656c   PyTorch.    sel
-00000a50: 6563 7465 645f 656e 6769 6e65 203d 204e  ected_engine = N
-00000a60: 6f6e 6520 2023 2074 7970 653a 2074 7970  one  # type: typ
-00000a70: 696e 672e 4f70 7469 6f6e 616c 5b69 6e74  ing.Optional[int
-00000a80: 5d20 2023 204f 6e65 206f 6620 7468 6520  ]  # One of the 
-00000a90: 706f 7373 6962 6c65 2065 6e67 696e 6573  possible engines
-00000aa0: 2e0a 0a20 2020 2040 636c 6173 736d 6574  ...    @classmet
-00000ab0: 686f 640a 2020 2020 6465 6620 7365 6c65  hod.    def sele
-00000ac0: 6374 5f65 6e67 696e 6528 636c 732c 202a  ct_engine(cls, *
-00000ad0: 2c20 656e 6769 6e65 3d4e 6f6e 652c 2064  , engine=None, d
-00000ae0: 6566 6175 6c74 5f66 616c 6c62 6163 6b5f  efault_fallback_
-00000af0: 656e 6769 6e65 3d4e 6f6e 652c 2063 6f6e  engine=None, con
-00000b00: 6669 673d 4e6f 6e65 293a 0a20 2020 2020  fig=None):.     
-00000b10: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
-00000b20: 7061 7261 6d20 696e 7420 656e 6769 6e65  param int engine
-00000b30: 3a20 7365 6520 7468 6520 676c 6f62 616c  : see the global
-00000b40: 2063 6c61 7373 2061 7474 7269 6273 2066   class attribs f
-00000b50: 6f72 2070 6f73 7369 626c 6520 7661 6c75  or possible valu
-00000b60: 6573 0a20 2020 2020 2020 203a 7061 7261  es.        :para
-00000b70: 6d20 696e 747c 4e6f 6e65 2064 6566 6175  m int|None defau
-00000b80: 6c74 5f66 616c 6c62 6163 6b5f 656e 6769  lt_fallback_engi
-00000b90: 6e65 3a20 6966 2065 6e67 696e 6520 6973  ne: if engine is
-00000ba0: 204e 6f6e 6520 616e 6420 6e6f 7420 6465   None and not de
-00000bb0: 6669 6e65 6420 696e 2063 6f6e 6669 672c  fined in config,
-00000bc0: 2075 7365 2074 6869 730a 2020 2020 2020   use this.      
-00000bd0: 2020 3a70 6172 616d 2072 6574 7572 6e6e    :param returnn
-00000be0: 2e63 6f6e 6669 672e 436f 6e66 6967 2063  .config.Config c
-00000bf0: 6f6e 6669 673a 0a20 2020 2020 2020 2022  onfig:.        "
-00000c00: 2222 0a20 2020 2020 2020 2061 7373 6572  "".        asser
-00000c10: 7420 636c 732e 7365 6c65 6374 6564 5f65  t cls.selected_e
-00000c20: 6e67 696e 6520 6973 204e 6f6e 652c 2022  ngine is None, "
-00000c30: 616c 7265 6164 7920 7365 7422 0a20 2020  already set".   
-00000c40: 2020 2020 2069 6620 656e 6769 6e65 2069       if engine i
-00000c50: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00000c60: 2020 2020 6966 2063 6f6e 6669 6720 6973      if config is
-00000c70: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00000c80: 2020 2020 2020 2066 726f 6d20 7265 7475         from retu
-00000c90: 726e 6e2e 636f 6e66 6967 2069 6d70 6f72  rnn.config impor
-00000ca0: 7420 6765 745f 676c 6f62 616c 5f63 6f6e  t get_global_con
-00000cb0: 6669 670a 0a20 2020 2020 2020 2020 2020  fig..           
-00000cc0: 2020 2020 2063 6f6e 6669 6720 3d20 6765       config = ge
-00000cd0: 745f 676c 6f62 616c 5f63 6f6e 6669 6728  t_global_config(
-00000ce0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00000cf0: 2063 6f6e 6669 672e 626f 6f6c 2822 7573   config.bool("us
-00000d00: 655f 7465 6e73 6f72 666c 6f77 222c 2046  e_tensorflow", F
-00000d10: 616c 7365 293a 0a20 2020 2020 2020 2020  alse):.         
-00000d20: 2020 2020 2020 2065 6e67 696e 6520 3d20         engine = 
-00000d30: 636c 732e 5465 6e73 6f72 466c 6f77 4e65  cls.TensorFlowNe
-00000d40: 7444 6963 740a 2020 2020 2020 2020 2020  tDict.          
-00000d50: 2020 6966 2063 6f6e 6669 672e 7661 6c75    if config.valu
-00000d60: 6528 2262 6163 6b65 6e64 222c 204e 6f6e  e("backend", Non
-00000d70: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00000d80: 2020 2020 6261 636b 656e 6420 3d20 636f      backend = co
-00000d90: 6e66 6967 2e76 616c 7565 2822 6261 636b  nfig.value("back
-00000da0: 656e 6422 2c20 4e6f 6e65 290a 2020 2020  end", None).    
-00000db0: 2020 2020 2020 2020 2020 2020 656e 6769              engi
-00000dc0: 6e65 203d 207b 0a20 2020 2020 2020 2020  ne = {.         
-00000dd0: 2020 2020 2020 2020 2020 2022 7465 6e73             "tens
-00000de0: 6f72 666c 6f77 2d6e 6574 2d64 6963 7422  orflow-net-dict"
-00000df0: 3a20 636c 732e 5465 6e73 6f72 466c 6f77  : cls.TensorFlow
-00000e00: 4e65 7444 6963 742c 0a20 2020 2020 2020  NetDict,.       
-00000e10: 2020 2020 2020 2020 2020 2020 2022 7465               "te
-00000e20: 6e73 6f72 666c 6f77 223a 2063 6c73 2e54  nsorflow": cls.T
-00000e30: 656e 736f 7246 6c6f 772c 0a20 2020 2020  ensorFlow,.     
-00000e40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00000e50: 746f 7263 6822 3a20 636c 732e 546f 7263  torch": cls.Torc
-00000e60: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
-00000e70: 2020 207d 5b62 6163 6b65 6e64 5d0a 2020     }[backend].  
-00000e80: 2020 2020 2020 2020 2020 6966 2065 6e67            if eng
-00000e90: 696e 6520 6973 204e 6f6e 653a 0a20 2020  ine is None:.   
-00000ea0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00000eb0: 6465 6661 756c 745f 6661 6c6c 6261 636b  default_fallback
-00000ec0: 5f65 6e67 696e 6520 6973 206e 6f74 204e  _engine is not N
-00000ed0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00000ee0: 2020 2020 2020 2020 2065 6e67 696e 6520           engine 
-00000ef0: 3d20 6465 6661 756c 745f 6661 6c6c 6261  = default_fallba
-00000f00: 636b 5f65 6e67 696e 650a 2020 2020 2020  ck_engine.      
-00000f10: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00000f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000f30: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-00000f40: 696f 6e28 224e 6f20 6261 636b 656e 6420  ion("No backend 
-00000f50: 6465 6669 6e65 642e 2050 6c65 6173 6520  defined. Please 
-00000f60: 7365 7420 7468 6520 636f 6e66 6967 206f  set the config o
-00000f70: 7074 696f 6e20 2762 6163 6b65 6e64 272e  ption 'backend'.
-00000f80: 2229 0a0a 2020 2020 2020 2020 2320 6e6f  ")..        # no
-00000f90: 696e 7370 6563 7469 6f6e 2050 7950 726f  inspection PyPro
-00000fa0: 7465 6374 6564 4d65 6d62 6572 0a20 2020  tectedMember.   
-00000fb0: 2020 2020 2066 726f 6d20 7265 7475 726e       from return
-00000fc0: 6e2e 6672 6f6e 7465 6e64 2069 6d70 6f72  n.frontend impor
-00000fd0: 7420 5f62 6163 6b65 6e64 0a0a 2020 2020  t _backend..    
-00000fe0: 2020 2020 6966 2065 6e67 696e 6520 3d3d      if engine ==
-00000ff0: 2063 6c73 2e54 656e 736f 7246 6c6f 773a   cls.TensorFlow:
-00001000: 0a20 2020 2020 2020 2020 2020 205f 6261  .            _ba
-00001010: 636b 656e 642e 7365 6c65 6374 5f62 6163  ckend.select_bac
-00001020: 6b65 6e64 5f74 6628 290a 2020 2020 2020  kend_tf().      
-00001030: 2020 656c 6966 2065 6e67 696e 6520 3d3d    elif engine ==
-00001040: 2063 6c73 2e54 656e 736f 7246 6c6f 774e   cls.TensorFlowN
-00001050: 6574 4469 6374 3a0a 2020 2020 2020 2020  etDict:.        
-00001060: 2020 2020 2320 4e6f 7465 2074 6861 7420      # Note that 
-00001070: 7765 2061 7373 756d 6520 7468 6174 2074  we assume that t
-00001080: 6865 2075 7365 7220 7761 6e74 7320 7468  he user wants th
-00001090: 6520 5245 5455 524e 4e20 6c61 7965 7273  e RETURNN layers
-000010a0: 2066 726f 6e74 656e 6420 2854 462d 6261   frontend (TF-ba
-000010b0: 7365 6429 0a20 2020 2020 2020 2020 2020  sed).           
-000010c0: 2023 2061 6e64 206e 6f74 2074 6865 206c   # and not the l
-000010d0: 6f77 2d6c 6576 656c 2054 4620 6672 6f6e  ow-level TF fron
-000010e0: 7465 6e64 2e0a 2020 2020 2020 2020 2020  tend..          
-000010f0: 2020 2320 4966 2077 6520 7761 6e74 2074    # If we want t
-00001100: 6f20 6578 706f 7365 2074 6865 206c 6f77  o expose the low
-00001110: 2d6c 6576 656c 2054 4620 6672 6f6e 7465  -level TF fronte
-00001120: 6e64 2074 6f20 7468 6520 7573 6572 2064  nd to the user d
-00001130: 6972 6563 746c 7920 6174 2073 6f6d 6520  irectly at some 
-00001140: 706f 696e 742c 0a20 2020 2020 2020 2020  point,.         
-00001150: 2020 2023 2077 6520 776f 756c 6420 6e65     # we would ne
-00001160: 6564 2061 206e 6577 2063 6f6e 6669 6720  ed a new config 
-00001170: 6f70 7469 6f6e 2e0a 2020 2020 2020 2020  option..        
-00001180: 2020 2020 5f62 6163 6b65 6e64 2e73 656c      _backend.sel
-00001190: 6563 745f 6261 636b 656e 645f 7265 7475  ect_backend_retu
-000011a0: 726e 6e5f 6c61 7965 7273 5f74 6628 290a  rnn_layers_tf().
-000011b0: 2020 2020 2020 2020 656c 6966 2065 6e67          elif eng
-000011c0: 696e 6520 3d3d 2063 6c73 2e54 6f72 6368  ine == cls.Torch
-000011d0: 3a0a 2020 2020 2020 2020 2020 2020 5f62  :.            _b
-000011e0: 6163 6b65 6e64 2e73 656c 6563 745f 6261  ackend.select_ba
-000011f0: 636b 656e 645f 746f 7263 6828 290a 2020  ckend_torch().  
-00001200: 2020 2020 2020 636c 732e 7365 6c65 6374        cls.select
-00001210: 6564 5f65 6e67 696e 6520 3d20 656e 6769  ed_engine = engi
-00001220: 6e65 0a0a 2020 2020 4063 6c61 7373 6d65  ne..    @classme
-00001230: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-00001240: 5f73 656c 6563 7465 645f 656e 6769 6e65  _selected_engine
-00001250: 2863 6c73 2920 2d3e 2069 6e74 3a0a 2020  (cls) -> int:.  
-00001260: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00001270: 2020 3a72 6574 7572 6e3a 206f 6e65 206f    :return: one o
-00001280: 6620 7468 6520 636f 6e73 7461 6e74 7320  f the constants 
-00001290: 5465 6e73 6f72 466c 6f77 4e65 7444 6963  TensorFlowNetDic
-000012a0: 742c 2054 656e 736f 7246 6c6f 772c 2054  t, TensorFlow, T
-000012b0: 6f72 6368 0a20 2020 2020 2020 2022 2222  orch.        """
-000012c0: 0a20 2020 2020 2020 2069 6620 636c 732e  .        if cls.
-000012d0: 7365 6c65 6374 6564 5f65 6e67 696e 6520  selected_engine 
-000012e0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000012f0: 2020 2020 2070 7269 6e74 2822 5741 524e       print("WARN
-00001300: 494e 473a 2042 6163 6b65 6e64 456e 6769  ING: BackendEngi
-00001310: 6e65 2e67 6574 5f73 656c 6563 7465 645f  ne.get_selected_
-00001320: 656e 6769 6e65 2829 2063 616c 6c65 6420  engine() called 
-00001330: 6265 666f 7265 2073 656c 6563 745f 656e  before select_en
-00001340: 6769 6e65 2829 2e22 2c20 6669 6c65 3d6c  gine().", file=l
-00001350: 6f67 2e76 3329 0a20 2020 2020 2020 2020  og.v3).         
-00001360: 2020 2063 6c73 2e73 656c 6563 745f 656e     cls.select_en
-00001370: 6769 6e65 2829 0a20 2020 2020 2020 2072  gine().        r
-00001380: 6574 7572 6e20 636c 732e 7365 6c65 6374  eturn cls.select
-00001390: 6564 5f65 6e67 696e 650a 0a20 2020 2040  ed_engine..    @
-000013a0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-000013b0: 6465 6620 6973 5f74 656e 736f 7266 6c6f  def is_tensorflo
-000013c0: 775f 7365 6c65 6374 6564 2863 6c73 293a  w_selected(cls):
-000013d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000013e0: 2020 2020 203a 7274 7970 653a 2062 6f6f       :rtype: boo
-000013f0: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
-00001400: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
-00001410: 2e67 6574 5f73 656c 6563 7465 645f 656e  .get_selected_en
-00001420: 6769 6e65 2829 2069 6e20 7b63 6c73 2e54  gine() in {cls.T
-00001430: 656e 736f 7246 6c6f 774e 6574 4469 6374  ensorFlowNetDict
-00001440: 2c20 636c 732e 5465 6e73 6f72 466c 6f77  , cls.TensorFlow
-00001450: 7d0a 0a20 2020 2040 636c 6173 736d 6574  }..    @classmet
-00001460: 686f 640a 2020 2020 6465 6620 6973 5f74  hod.    def is_t
-00001470: 6f72 6368 5f73 656c 6563 7465 6428 636c  orch_selected(cl
-00001480: 7329 3a0a 2020 2020 2020 2020 2222 220a  s):.        """.
-00001490: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-000014a0: 626f 6f6c 0a20 2020 2020 2020 2022 2222  bool.        """
-000014b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000014c0: 636c 732e 6765 745f 7365 6c65 6374 6564  cls.get_selected
-000014d0: 5f65 6e67 696e 6528 2920 3d3d 2063 6c73  _engine() == cls
-000014e0: 2e54 6f72 6368 0a0a 0a63 6c61 7373 2042  .Torch...class B
-000014f0: 6568 6176 696f 7256 6572 7369 6f6e 3a0a  ehaviorVersion:.
-00001500: 2020 2020 2222 220a 2020 2020 5374 6f72      """.    Stor
-00001510: 6573 2074 6865 2067 6c6f 6261 6c20 6265  es the global be
-00001520: 6861 7669 6f72 5f76 6572 7369 6f6e 0a0a  havior_version..
-00001530: 2020 2020 5468 6520 7665 7273 696f 6e20      The version 
-00001540: 7769 6c6c 2062 6520 7365 7420 6166 7465  will be set afte
-00001550: 7220 7468 6520 636f 6e66 6967 2069 7320  r the config is 
-00001560: 6465 6669 6e65 6420 6174 205f 5f6d 6169  defined at __mai
-00001570: 6e5f 5f2e 696e 6974 5f63 6f6e 6669 6728  n__.init_config(
-00001580: 2920 6f72 2045 6e67 696e 652e 5f5f 696e  ) or Engine.__in
-00001590: 6974 5f5f 2829 0a20 2020 2022 2222 0a0a  it__().    """..
-000015a0: 2020 2020 5f6c 6174 6573 745f 6265 6861      _latest_beha
-000015b0: 7669 6f72 5f76 6572 7369 6f6e 203d 2031  vior_version = 1
-000015c0: 360a 2020 2020 5f62 6568 6176 696f 725f  6.    _behavior_
-000015d0: 7665 7273 696f 6e20 3d20 4e6f 6e65 2020  version = None  
-000015e0: 2320 7479 7065 3a20 7479 7069 6e67 2e4f  # type: typing.O
-000015f0: 7074 696f 6e61 6c5b 696e 745d 0a20 2020  ptional[int].   
-00001600: 205f 6d69 6e5f 6265 6861 7669 6f72 5f76   _min_behavior_v
-00001610: 6572 7369 6f6e 203d 2030 2020 2320 7479  ersion = 0  # ty
-00001620: 7065 3a20 696e 740a 0a20 2020 2040 636c  pe: int..    @cl
-00001630: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00001640: 6620 7365 7428 636c 732c 2076 6572 7369  f set(cls, versi
-00001650: 6f6e 293a 0a20 2020 2020 2020 2022 2222  on):.        """
-00001660: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00001670: 696e 747c 4e6f 6e65 2076 6572 7369 6f6e  int|None version
-00001680: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00001690: 2020 2020 2020 6966 2076 6572 7369 6f6e        if version
-000016a0: 203d 3d20 636c 732e 5f62 6568 6176 696f   == cls._behavio
-000016b0: 725f 7665 7273 696f 6e3a 0a20 2020 2020  r_version:.     
-000016c0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-000016d0: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
-000016e0: 2063 6c73 2e69 735f 7365 7428 292c 2022   cls.is_set(), "
-000016f0: 6265 6861 7669 6f72 5f76 6572 7369 6f6e  behavior_version
-00001700: 2061 6c72 6561 6479 2073 6574 2074 6f20   already set to 
-00001710: 2573 2c20 6361 6e6e 6f74 2072 6573 6574  %s, cannot reset
-00001720: 2074 6f20 2569 2220 2520 280a 2020 2020   to %i" % (.    
-00001730: 2020 2020 2020 2020 636c 732e 5f62 6568          cls._beh
-00001740: 6176 696f 725f 7665 7273 696f 6e2c 0a20  avior_version,. 
-00001750: 2020 2020 2020 2020 2020 2076 6572 7369             versi
-00001760: 6f6e 2c0a 2020 2020 2020 2020 290a 2020  on,.        ).  
-00001770: 2020 2020 2020 6173 7365 7274 2076 6572        assert ver
-00001780: 7369 6f6e 203e 3d20 636c 732e 5f6d 696e  sion >= cls._min
-00001790: 5f62 6568 6176 696f 725f 7665 7273 696f  _behavior_versio
-000017a0: 6e0a 2020 2020 2020 2020 6966 2076 6572  n.        if ver
-000017b0: 7369 6f6e 203e 2063 6c73 2e5f 6c61 7465  sion > cls._late
-000017c0: 7374 5f62 6568 6176 696f 725f 7665 7273  st_behavior_vers
-000017d0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-000017e0: 2066 726f 6d20 7265 7475 726e 6e20 696d   from returnn im
-000017f0: 706f 7274 205f 5f6c 6f6e 675f 7665 7273  port __long_vers
-00001800: 696f 6e5f 5f0a 0a20 2020 2020 2020 2020  ion__..         
-00001810: 2020 206c 6f67 2e70 7269 6e74 5f77 6172     log.print_war
-00001820: 6e69 6e67 280a 2020 2020 2020 2020 2020  ning(.          
-00001830: 2020 2020 2020 2262 6568 6176 696f 725f        "behavior_
-00001840: 7665 7273 696f 6e20 2569 203e 206c 6174  version %i > lat
-00001850: 6573 7420 6b6e 6f77 6e20 6265 6861 7669  est known behavi
-00001860: 6f72 5f76 6572 7369 6f6e 2025 692e 2022  or_version %i. "
-00001870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001880: 2022 596f 7572 2052 4554 5552 4e4e 2076   "Your RETURNN v
-00001890: 6572 7369 6f6e 2069 7320 746f 6f20 6f6c  ersion is too ol
-000018a0: 6420 2825 7329 2e22 2025 2028 7665 7273  d (%s)." % (vers
-000018b0: 696f 6e2c 2063 6c73 2e5f 6c61 7465 7374  ion, cls._latest
-000018c0: 5f62 6568 6176 696f 725f 7665 7273 696f  _behavior_versio
-000018d0: 6e2c 205f 5f6c 6f6e 675f 7665 7273 696f  n, __long_versio
-000018e0: 6e5f 5f29 0a20 2020 2020 2020 2020 2020  n__).           
-000018f0: 2029 0a20 2020 2020 2020 2063 6c73 2e5f   ).        cls._
-00001900: 6265 6861 7669 6f72 5f76 6572 7369 6f6e  behavior_version
-00001910: 203d 2076 6572 7369 6f6e 0a0a 2020 2020   = version..    
-00001920: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00001930: 2064 6566 2067 6574 2863 6c73 293a 0a20   def get(cls):. 
-00001940: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00001950: 2020 203a 7274 7970 653a 2069 6e74 0a20     :rtype: int. 
-00001960: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00001970: 2020 2069 6620 636c 732e 5f62 6568 6176     if cls._behav
-00001980: 696f 725f 7665 7273 696f 6e20 6973 206e  ior_version is n
-00001990: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000019a0: 2020 2020 2072 6574 7572 6e20 636c 732e       return cls.
-000019b0: 5f62 6568 6176 696f 725f 7665 7273 696f  _behavior_versio
-000019c0: 6e0a 2020 2020 2020 2020 7265 7475 726e  n.        return
-000019d0: 2063 6c73 2e67 6574 5f64 6566 6175 6c74   cls.get_default
-000019e0: 2829 0a0a 2020 2020 4063 6c61 7373 6d65  ()..    @classme
-000019f0: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-00001a00: 5f64 6566 6175 6c74 2863 6c73 293a 0a20  _default(cls):. 
-00001a10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00001a20: 2020 203a 7265 7475 726e 3a20 6465 6661     :return: defa
-00001a30: 756c 7420 6265 6861 7669 6f72 5f76 6572  ult behavior_ver
-00001a40: 7369 6f6e 2e20 7573 7561 6c6c 7920 3020  sion. usually 0 
-00001a50: 6275 7420 6d69 6768 7420 6265 2064 6966  but might be dif
-00001a60: 6665 7265 6e74 2069 6e20 7465 7374 2065  ferent in test e
-00001a70: 6e76 6972 6f6e 6d65 6e74 0a20 2020 2020  nvironment.     
-00001a80: 2020 203a 7274 7970 653a 2069 6e74 0a20     :rtype: int. 
-00001a90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00001aa0: 2020 2069 6620 6f73 2e65 6e76 6972 6f6e     if os.environ
-00001ab0: 2e67 6574 2822 5245 5455 524e 4e5f 5445  .get("RETURNN_TE
-00001ac0: 5354 2229 2061 6e64 2074 6f5f 626f 6f6c  ST") and to_bool
-00001ad0: 286f 732e 656e 7669 726f 6e2e 6765 7428  (os.environ.get(
-00001ae0: 2252 4554 5552 4e4e 5f54 4553 5422 2929  "RETURNN_TEST"))
-00001af0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00001b00: 7475 726e 2063 6c73 2e5f 6c61 7465 7374  turn cls._latest
-00001b10: 5f62 6568 6176 696f 725f 7665 7273 696f  _behavior_versio
-00001b20: 6e0a 2020 2020 2020 2020 7265 7475 726e  n.        return
-00001b30: 2063 6c73 2e5f 6d69 6e5f 6265 6861 7669   cls._min_behavi
-00001b40: 6f72 5f76 6572 7369 6f6e 0a0a 2020 2020  or_version..    
-00001b50: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00001b60: 2064 6566 2073 6574 5f6d 696e 5f62 6568   def set_min_beh
-00001b70: 6176 696f 725f 7665 7273 696f 6e28 636c  avior_version(cl
-00001b80: 732c 206d 696e 5f62 6568 6176 696f 725f  s, min_behavior_
-00001b90: 7665 7273 696f 6e3a 2069 6e74 293a 0a20  version: int):. 
-00001ba0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00001bb0: 2020 2054 6865 7265 2061 7265 2073 6f6d     There are som
-00001bc0: 6520 5245 5455 524e 4e20 6665 6174 7572  e RETURNN featur
-00001bd0: 6573 2077 6869 6368 2074 7269 6767 6572  es which trigger
-00001be0: 2061 2068 6967 6865 7220 6d69 6e20 6265   a higher min be
-00001bf0: 6861 7669 6f72 2076 6572 7369 6f6e 2e0a  havior version..
-00001c00: 2020 2020 2020 2020 5468 6520 6d69 6e20          The min 
-00001c10: 6265 6861 7669 6f72 2076 6572 7369 6f6e  behavior version
-00001c20: 2069 7320 7573 6564 2077 6865 6e20 6e6f   is used when no
-00001c30: 2062 6568 6176 696f 7220 7665 7273 696f   behavior versio
-00001c40: 6e20 6973 2065 7870 6c69 6369 746c 7920  n is explicitly 
-00001c50: 7365 742e 0a20 2020 2020 2020 2042 7574  set..        But
-00001c60: 2069 7420 6973 2061 6c73 6f20 616e 2065   it is also an e
-00001c70: 7272 6f72 2069 6620 6120 6265 6861 7669  rror if a behavi
-00001c80: 6f72 2076 6572 7369 6f6e 2069 7320 7365  or version is se
-00001c90: 742c 2062 7574 2069 7420 6973 206c 6f77  t, but it is low
-00001ca0: 6572 2074 6861 6e20 7468 6520 6d69 6e20  er than the min 
-00001cb0: 6265 6861 7669 6f72 2076 6572 7369 6f6e  behavior version
-00001cc0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00001cd0: 6d20 6d69 6e5f 6265 6861 7669 6f72 5f76  m min_behavior_v
-00001ce0: 6572 7369 6f6e 3a0a 2020 2020 2020 2020  ersion:.        
-00001cf0: 2222 220a 2020 2020 2020 2020 6173 7365  """.        asse
-00001d00: 7274 2063 6c73 2e5f 6d69 6e5f 6265 6861  rt cls._min_beha
-00001d10: 7669 6f72 5f76 6572 7369 6f6e 203c 3d20  vior_version <= 
-00001d20: 6d69 6e5f 6265 6861 7669 6f72 5f76 6572  min_behavior_ver
-00001d30: 7369 6f6e 203c 3d20 636c 732e 5f6c 6174  sion <= cls._lat
-00001d40: 6573 745f 6265 6861 7669 6f72 5f76 6572  est_behavior_ver
-00001d50: 7369 6f6e 0a20 2020 2020 2020 2069 6620  sion.        if 
-00001d60: 636c 732e 5f62 6568 6176 696f 725f 7665  cls._behavior_ve
-00001d70: 7273 696f 6e20 6973 206e 6f74 204e 6f6e  rsion is not Non
-00001d80: 653a 0a20 2020 2020 2020 2020 2020 2061  e:.            a
-00001d90: 7373 6572 7420 636c 732e 5f62 6568 6176  ssert cls._behav
-00001da0: 696f 725f 7665 7273 696f 6e20 3e3d 206d  ior_version >= m
-00001db0: 696e 5f62 6568 6176 696f 725f 7665 7273  in_behavior_vers
-00001dc0: 696f 6e0a 2020 2020 2020 2020 636c 732e  ion.        cls.
-00001dd0: 5f6d 696e 5f62 6568 6176 696f 725f 7665  _min_behavior_ve
-00001de0: 7273 696f 6e20 3d20 6d69 6e5f 6265 6861  rsion = min_beha
-00001df0: 7669 6f72 5f76 6572 7369 6f6e 0a0a 2020  vior_version..  
-00001e00: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00001e10: 2020 2064 6566 2069 735f 7365 7428 636c     def is_set(cl
-00001e20: 7329 3a0a 2020 2020 2020 2020 2222 220a  s):.        """.
-00001e30: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-00001e40: 626f 6f6c 0a20 2020 2020 2020 2022 2222  bool.        """
-00001e50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00001e60: 636c 732e 5f62 6568 6176 696f 725f 7665  cls._behavior_ve
-00001e70: 7273 696f 6e20 6973 206e 6f74 204e 6f6e  rsion is not Non
-00001e80: 650a 0a20 2020 2063 6c61 7373 2052 6571  e..    class Req
-00001e90: 7569 7265 6d65 6e74 4e6f 7453 6174 6973  uirementNotSatis
-00001ea0: 6669 6564 2845 7863 6570 7469 6f6e 293a  fied(Exception):
-00001eb0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00001ec0: 2020 2020 2042 6568 6176 696f 7220 7665       Behavior ve
-00001ed0: 7273 696f 6e20 7265 7175 6972 656d 656e  rsion requiremen
-00001ee0: 7420 6973 206e 6f74 2073 6174 6973 6669  t is not satisfi
-00001ef0: 6564 0a20 2020 2020 2020 2022 2222 0a0a  ed.        """..
-00001f00: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00001f10: 0a20 2020 2064 6566 2072 6571 7569 7265  .    def require
-00001f20: 2863 6c73 2c20 636f 6e64 6974 696f 6e2c  (cls, condition,
-00001f30: 206d 6573 7361 6765 2c20 7665 7273 696f   message, versio
-00001f40: 6e29 3a0a 2020 2020 2020 2020 2222 220a  n):.        """.
-00001f50: 2020 2020 2020 2020 3a70 6172 616d 2062          :param b
-00001f60: 6f6f 6c20 636f 6e64 6974 696f 6e3a 0a20  ool condition:. 
-00001f70: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-00001f80: 7220 6d65 7373 6167 653a 0a20 2020 2020  r message:.     
-00001f90: 2020 203a 7061 7261 6d20 696e 7420 7665     :param int ve
-00001fa0: 7273 696f 6e3a 0a20 2020 2020 2020 2022  rsion:.        "
-00001fb0: 2222 0a20 2020 2020 2020 2061 7373 6572  "".        asser
-00001fc0: 7420 7665 7273 696f 6e20 3c3d 2063 6c73  t version <= cls
-00001fd0: 2e5f 6c61 7465 7374 5f62 6568 6176 696f  ._latest_behavio
-00001fe0: 725f 7665 7273 696f 6e0a 2020 2020 2020  r_version.      
-00001ff0: 2020 6966 206e 6f74 2063 6f6e 6469 7469    if not conditi
-00002000: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-00002010: 6966 2042 6568 6176 696f 7256 6572 7369  if BehaviorVersi
-00002020: 6f6e 2e67 6574 2829 203e 3d20 7665 7273  on.get() >= vers
-00002030: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-00002040: 2020 2020 2072 6169 7365 2042 6568 6176       raise Behav
-00002050: 696f 7256 6572 7369 6f6e 2e52 6571 7569  iorVersion.Requi
-00002060: 7265 6d65 6e74 4e6f 7453 6174 6973 6669  rementNotSatisfi
-00002070: 6564 280a 2020 2020 2020 2020 2020 2020  ed(.            
-00002080: 2020 2020 2020 2020 2225 7320 2872 6571          "%s (req
-00002090: 7569 7265 6420 7369 6e63 6520 6265 6861  uired since beha
-000020a0: 7669 6f72 5f76 6572 7369 6f6e 203e 3d20  vior_version >= 
-000020b0: 2569 2922 2025 2028 6d65 7373 6167 652c  %i)" % (message,
-000020c0: 2076 6572 7369 6f6e 290a 2020 2020 2020   version).      
-000020d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000020e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000020f0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00002100: 672e 7072 696e 745f 6465 7072 6563 6174  g.print_deprecat
-00002110: 696f 6e5f 7761 726e 696e 6728 6d65 7373  ion_warning(mess
-00002120: 6167 652c 2062 6568 6176 696f 725f 7665  age, behavior_ve
-00002130: 7273 696f 6e3d 7665 7273 696f 6e29 0a0a  rsion=version)..
-00002140: 0a64 6566 2067 6574 5f6d 6f64 656c 5f66  .def get_model_f
-00002150: 696c 656e 616d 655f 706f 7374 6669 7828  ilename_postfix(
-00002160: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00002170: 7265 7475 726e 3a20 6f6e 6520 706f 7373  return: one poss
-00002180: 6962 6c65 2070 6f73 7466 6978 206f 6620  ible postfix of 
-00002190: 6120 6669 6c65 2077 6869 6368 2077 696c  a file which wil
-000021a0: 6c20 6265 2070 7265 7365 6e74 2077 6865  l be present whe
-000021b0: 6e20 7468 6520 6d6f 6465 6c20 6973 2073  n the model is s
-000021c0: 6176 6564 0a20 2020 203a 7274 7970 653a  aved.    :rtype:
-000021d0: 2073 7472 0a20 2020 2022 2222 0a20 2020   str.    """.   
-000021e0: 2061 7373 6572 7420 4261 636b 656e 6445   assert BackendE
-000021f0: 6e67 696e 652e 7365 6c65 6374 6564 5f65  ngine.selected_e
-00002200: 6e67 696e 6520 6973 206e 6f74 204e 6f6e  ngine is not Non
-00002210: 650a 2020 2020 6966 2042 6163 6b65 6e64  e.    if Backend
-00002220: 456e 6769 6e65 2e69 735f 7465 6e73 6f72  Engine.is_tensor
-00002230: 666c 6f77 5f73 656c 6563 7465 6428 293a  flow_selected():
-00002240: 0a20 2020 2020 2020 2023 2054 6865 7265  .        # There
-00002250: 2077 696c 6c20 6265 206d 756c 7469 706c   will be multipl
-00002260: 6520 6669 6c65 7320 6275 7420 6120 2a2e  e files but a *.
-00002270: 6d65 7461 2066 696c 6520 7769 6c6c 2061  meta file will a
-00002280: 6c77 6179 7320 6265 2070 7265 7365 6e74  lways be present
-00002290: 2e0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000022a0: 2022 2e6d 6574 6122 0a20 2020 2069 6620   ".meta".    if 
-000022b0: 4261 636b 656e 6445 6e67 696e 652e 6973  BackendEngine.is
-000022c0: 5f74 6f72 6368 5f73 656c 6563 7465 6428  _torch_selected(
-000022d0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000022e0: 6e20 222e 7074 220a 2020 2020 7265 7475  n ".pt".    retu
-000022f0: 726e 2022 220a 0a0a 6465 6620 6765 745f  rn ""...def get_
-00002300: 6368 6563 6b70 6f69 6e74 5f66 696c 6570  checkpoint_filep
-00002310: 6174 7465 726e 2866 696c 6570 6174 6829  attern(filepath)
-00002320: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
-00002330: 6d6f 7665 7320 6f70 7469 6f6e 616c 202e  moves optional .
-00002340: 696e 6465 7820 6f72 202e 6d65 7461 2065  index or .meta e
-00002350: 7874 656e 7369 6f6e 0a0a 2020 2020 3a70  xtension..    :p
-00002360: 6172 616d 2073 7472 2066 696c 6570 6174  aram str filepat
-00002370: 683a 0a20 2020 203a 7265 7475 726e 3a20  h:.    :return: 
-00002380: 4368 6563 6b70 6f69 6e74 4c6f 6164 6572  CheckpointLoader
-00002390: 2063 6f6d 7061 7469 626c 6520 6669 6c65   compatible file
-000023a0: 7061 7474 6572 6e0a 2020 2020 3a72 7479  pattern.    :rty
-000023b0: 7065 3a20 7374 720a 2020 2020 2222 220a  pe: str.    """.
-000023c0: 2020 2020 6966 2066 696c 6570 6174 682e      if filepath.
-000023d0: 656e 6473 7769 7468 2822 2e6d 6574 6122  endswith(".meta"
-000023e0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000023f0: 6e20 6669 6c65 7061 7468 5b3a 202d 6c65  n filepath[: -le
-00002400: 6e28 222e 6d65 7461 2229 5d0a 2020 2020  n(".meta")].    
-00002410: 656c 6966 2066 696c 6570 6174 682e 656e  elif filepath.en
-00002420: 6473 7769 7468 2822 2e69 6e64 6578 2229  dswith(".index")
-00002430: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00002440: 2066 696c 6570 6174 685b 3a20 2d6c 656e   filepath[: -len
-00002450: 2822 2e69 6e64 6578 2229 5d0a 2020 2020  (".index")].    
-00002460: 656c 6966 2066 696c 6570 6174 682e 656e  elif filepath.en
-00002470: 6473 7769 7468 2822 2e70 7422 293a 0a20  dswith(".pt"):. 
-00002480: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
-00002490: 6c65 7061 7468 5b3a 202d 6c65 6e28 222e  lepath[: -len(".
-000024a0: 7074 2229 5d0a 2020 2020 7265 7475 726e  pt")].    return
-000024b0: 2066 696c 6570 6174 680a 0a0a 6465 6620   filepath...def 
-000024c0: 7379 735f 636d 645f 6f75 745f 6c69 6e65  sys_cmd_out_line
-000024d0: 7328 7329 3a0a 2020 2020 2222 220a 2020  s(s):.    """.  
-000024e0: 2020 3a70 6172 616d 2073 7472 2073 3a20    :param str s: 
-000024f0: 7368 656c 6c20 636f 6d6d 616e 640a 2020  shell command.  
-00002500: 2020 3a72 7479 7065 3a20 6c69 7374 5b73    :rtype: list[s
-00002510: 7472 5d0a 2020 2020 3a72 6574 7572 6e3a  tr].    :return:
-00002520: 2061 6c6c 2073 7464 6f75 7420 7370 6c69   all stdout spli
-00002530: 7420 6279 206e 6577 6c69 6e65 2e20 446f  t by newline. Do
-00002540: 6573 206e 6f74 2063 6f76 6572 2073 7464  es not cover std
-00002550: 6572 722e 0a20 2020 2052 6169 7365 7320  err..    Raises 
-00002560: 4361 6c6c 6564 5072 6f63 6573 7345 7272  CalledProcessErr
-00002570: 6f72 206f 6e20 6572 726f 722e 0a20 2020  or on error..   
-00002580: 2022 2222 0a20 2020 2070 203d 2073 7562   """.    p = sub
-00002590: 7072 6f63 6573 732e 506f 7065 6e28 0a20  process.Popen(. 
-000025a0: 2020 2020 2020 2073 2c0a 2020 2020 2020         s,.      
-000025b0: 2020 7374 646f 7574 3d73 7562 7072 6f63    stdout=subproc
-000025c0: 6573 732e 5049 5045 2c0a 2020 2020 2020  ess.PIPE,.      
-000025d0: 2020 7368 656c 6c3d 5472 7565 2c0a 2020    shell=True,.  
-000025e0: 2020 2020 2020 636c 6f73 655f 6664 733d        close_fds=
-000025f0: 5472 7565 2c0a 2020 2020 2020 2020 656e  True,.        en
-00002600: 763d 6469 6374 286f 732e 656e 7669 726f  v=dict(os.enviro
-00002610: 6e2c 204c 414e 473d 2265 6e5f 5553 2e55  n, LANG="en_US.U
-00002620: 5446 2d38 222c 204c 435f 414c 4c3d 2265  TF-8", LC_ALL="e
-00002630: 6e5f 5553 2e55 5446 2d38 2229 2c0a 2020  n_US.UTF-8"),.  
-00002640: 2020 290a 2020 2020 7374 646f 7574 203d    ).    stdout =
-00002650: 2070 2e63 6f6d 6d75 6e69 6361 7465 2829   p.communicate()
-00002660: 5b30 5d0a 2020 2020 6966 2050 5933 3a0a  [0].    if PY3:.
-00002670: 2020 2020 2020 2020 7374 646f 7574 203d          stdout =
-00002680: 2073 7464 6f75 742e 6465 636f 6465 2822   stdout.decode("
-00002690: 7574 6638 2229 0a20 2020 2072 6573 756c  utf8").    resul
-000026a0: 7420 3d20 5b6c 696e 652e 7374 7269 7028  t = [line.strip(
-000026b0: 2920 666f 7220 6c69 6e65 2069 6e20 7374  ) for line in st
-000026c0: 646f 7574 2e73 706c 6974 2822 5c6e 2229  dout.split("\n")
-000026d0: 5b3a 2d31 5d5d 0a20 2020 2070 2e73 7464  [:-1]].    p.std
-000026e0: 6f75 742e 636c 6f73 6528 290a 2020 2020  out.close().    
-000026f0: 6966 2070 2e72 6574 7572 6e63 6f64 6520  if p.returncode 
-00002700: 213d 2030 3a0a 2020 2020 2020 2020 7261  != 0:.        ra
-00002710: 6973 6520 4361 6c6c 6564 5072 6f63 6573  ise CalledProces
-00002720: 7345 7272 6f72 2870 2e72 6574 7572 6e63  sError(p.returnc
-00002730: 6f64 652c 2073 2c20 7374 646f 7574 290a  ode, s, stdout).
-00002740: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-00002750: 740a 0a0a 6465 6620 7379 735f 6578 6563  t...def sys_exec
-00002760: 5f6f 7574 282a 6172 6773 2c20 2a2a 6b77  _out(*args, **kw
-00002770: 6172 6773 293a 0a20 2020 2022 2222 0a20  args):.    """. 
-00002780: 2020 203a 7061 7261 6d20 7374 7220 6172     :param str ar
-00002790: 6773 3a20 666f 7220 7375 6270 726f 6365  gs: for subproce
-000027a0: 7373 2e50 6f70 656e 0a20 2020 203a 7061  ss.Popen.    :pa
-000027b0: 7261 6d20 6b77 6172 6773 3a20 666f 7220  ram kwargs: for 
-000027c0: 7375 6270 726f 6365 7373 2e50 6f70 656e  subprocess.Popen
-000027d0: 0a20 2020 203a 7265 7475 726e 3a20 7374  .    :return: st
-000027e0: 646f 7574 2061 7320 7374 7220 2861 7373  dout as str (ass
-000027f0: 756d 6573 2075 7466 3829 0a20 2020 203a  umes utf8).    :
-00002800: 7274 7970 653a 2073 7472 0a20 2020 2022  rtype: str.    "
-00002810: 2222 0a20 2020 2066 726f 6d20 7375 6270  "".    from subp
-00002820: 726f 6365 7373 2069 6d70 6f72 7420 506f  rocess import Po
-00002830: 7065 6e2c 2050 4950 450a 0a20 2020 206b  pen, PIPE..    k
-00002840: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
-00002850: 2822 7368 656c 6c22 2c20 4661 6c73 6529  ("shell", False)
-00002860: 0a20 2020 2070 203d 2050 6f70 656e 2861  .    p = Popen(a
-00002870: 7267 732c 2073 7464 696e 3d50 4950 452c  rgs, stdin=PIPE,
-00002880: 2073 7464 6f75 743d 5049 5045 2c20 2a2a   stdout=PIPE, **
-00002890: 6b77 6172 6773 290a 2020 2020 6f75 742c  kwargs).    out,
-000028a0: 205f 203d 2070 2e63 6f6d 6d75 6e69 6361   _ = p.communica
-000028b0: 7465 2829 0a20 2020 2069 6620 702e 7265  te().    if p.re
-000028c0: 7475 726e 636f 6465 2021 3d20 303a 0a20  turncode != 0:. 
-000028d0: 2020 2020 2020 2072 6169 7365 2043 616c         raise Cal
-000028e0: 6c65 6450 726f 6365 7373 4572 726f 7228  ledProcessError(
-000028f0: 702e 7265 7475 726e 636f 6465 2c20 6172  p.returncode, ar
-00002900: 6773 290a 2020 2020 6f75 7420 3d20 756e  gs).    out = un
-00002910: 6963 6f64 655f 746f 5f73 7472 286f 7574  icode_to_str(out
-00002920: 290a 2020 2020 7265 7475 726e 206f 7574  ).    return out
-00002930: 0a0a 0a64 6566 2073 7973 5f65 7865 635f  ...def sys_exec_
-00002940: 7265 745f 636f 6465 282a 6172 6773 2c20  ret_code(*args, 
-00002950: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
-00002960: 2222 0a20 2020 203a 7061 7261 6d20 7374  "".    :param st
-00002970: 7220 6172 6773 3a20 666f 7220 7375 6270  r args: for subp
-00002980: 726f 6365 7373 2e63 616c 6c0a 2020 2020  rocess.call.    
-00002990: 3a70 6172 616d 206b 7761 7267 733a 2066  :param kwargs: f
-000029a0: 6f72 2073 7562 7072 6f63 6573 732e 6361  or subprocess.ca
-000029b0: 6c6c 0a20 2020 203a 7265 7475 726e 3a20  ll.    :return: 
-000029c0: 7265 7475 726e 2063 6f64 650a 2020 2020  return code.    
-000029d0: 3a72 7479 7065 3a20 696e 740a 2020 2020  :rtype: int.    
-000029e0: 2222 220a 2020 2020 696d 706f 7274 2073  """.    import s
-000029f0: 7562 7072 6f63 6573 730a 0a20 2020 2072  ubprocess..    r
-00002a00: 6573 203d 2073 7562 7072 6f63 6573 732e  es = subprocess.
-00002a10: 6361 6c6c 2861 7267 732c 2073 6865 6c6c  call(args, shell
-00002a20: 3d46 616c 7365 2c20 2a2a 6b77 6172 6773  =False, **kwargs
-00002a30: 290a 2020 2020 7661 6c69 6420 3d20 6b77  ).    valid = kw
-00002a40: 6172 6773 2e67 6574 2822 7661 6c69 6422  args.get("valid"
-00002a50: 2c20 2830 2c20 3129 290a 2020 2020 6966  , (0, 1)).    if
-00002a60: 2076 616c 6964 2069 7320 6e6f 7420 4e6f   valid is not No
-00002a70: 6e65 3a0a 2020 2020 2020 2020 6966 2072  ne:.        if r
-00002a80: 6573 206e 6f74 2069 6e20 7661 6c69 643a  es not in valid:
-00002a90: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00002aa0: 7365 2043 616c 6c65 6450 726f 6365 7373  se CalledProcess
-00002ab0: 4572 726f 7228 7265 732c 2061 7267 7329  Error(res, args)
-00002ac0: 0a20 2020 2072 6574 7572 6e20 7265 730a  .    return res.
-00002ad0: 0a0a 6465 6620 6769 745f 636f 6d6d 6974  ..def git_commit
-00002ae0: 5f72 6576 2863 6f6d 6d69 743d 2248 4541  _rev(commit="HEA
-00002af0: 4422 2c20 6769 745f 6469 723d 222e 222c  D", git_dir=".",
-00002b00: 206c 656e 6774 683d 4e6f 6e65 293a 0a20   length=None):. 
-00002b10: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
-00002b20: 6d20 7374 7220 636f 6d6d 6974 3a0a 2020  m str commit:.  
-00002b30: 2020 3a70 6172 616d 2073 7472 2067 6974    :param str git
-00002b40: 5f64 6972 3a0a 2020 2020 3a70 6172 616d  _dir:.    :param
-00002b50: 2069 6e74 7c4e 6f6e 6520 6c65 6e67 7468   int|None length
-00002b60: 3a0a 2020 2020 3a72 7479 7065 3a20 7374  :.    :rtype: st
-00002b70: 720a 2020 2020 2222 220a 2020 2020 6966  r.    """.    if
-00002b80: 2063 6f6d 6d69 7420 6973 204e 6f6e 653a   commit is None:
-00002b90: 0a20 2020 2020 2020 2063 6f6d 6d69 7420  .        commit 
-00002ba0: 3d20 2248 4541 4422 0a20 2020 2072 6574  = "HEAD".    ret
-00002bb0: 7572 6e20 7379 735f 6578 6563 5f6f 7574  urn sys_exec_out
-00002bc0: 2822 6769 7422 2c20 2272 6576 2d70 6172  ("git", "rev-par
-00002bd0: 7365 222c 2022 2d2d 7368 6f72 743d 2569  se", "--short=%i
-00002be0: 2220 2520 6c65 6e67 7468 2069 6620 6c65  " % length if le
-00002bf0: 6e67 7468 2065 6c73 6520 222d 2d73 686f  ngth else "--sho
-00002c00: 7274 222c 2063 6f6d 6d69 742c 2063 7764  rt", commit, cwd
-00002c10: 3d67 6974 5f64 6972 292e 7374 7269 7028  =git_dir).strip(
-00002c20: 290a 0a0a 6465 6620 6769 745f 6973 5f64  )...def git_is_d
-00002c30: 6972 7479 2867 6974 5f64 6972 3d22 2e22  irty(git_dir="."
-00002c40: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00002c50: 7061 7261 6d20 7374 7220 6769 745f 6469  param str git_di
-00002c60: 723a 0a20 2020 203a 7274 7970 653a 2062  r:.    :rtype: b
-00002c70: 6f6f 6c0a 2020 2020 2222 220a 2020 2020  ool.    """.    
-00002c80: 7220 3d20 7379 735f 6578 6563 5f72 6574  r = sys_exec_ret
-00002c90: 5f63 6f64 6528 2267 6974 222c 2022 6469  _code("git", "di
-00002ca0: 6666 222c 2022 2d2d 6e6f 2d65 7874 2d64  ff", "--no-ext-d
-00002cb0: 6966 6622 2c20 222d 2d71 7569 6574 222c  iff", "--quiet",
-00002cc0: 2022 2d2d 6578 6974 2d63 6f64 6522 2c20   "--exit-code", 
-00002cd0: 6377 643d 6769 745f 6469 7229 0a20 2020  cwd=git_dir).   
-00002ce0: 2069 6620 7220 3d3d 2030 3a0a 2020 2020   if r == 0:.    
-00002cf0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00002d00: 0a20 2020 2069 6620 7220 3d3d 2031 3a0a  .    if r == 1:.
-00002d10: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00002d20: 7275 650a 2020 2020 6173 7365 7274 2046  rue.    assert F
-00002d30: 616c 7365 2c20 2262 6164 2072 6574 7572  alse, "bad retur
-00002d40: 6e20 2569 2220 2520 720a 0a0a 6465 6620  n %i" % r...def 
-00002d50: 6769 745f 636f 6d6d 6974 5f64 6174 6528  git_commit_date(
-00002d60: 636f 6d6d 6974 3d22 4845 4144 222c 2067  commit="HEAD", g
-00002d70: 6974 5f64 6972 3d22 2e22 293a 0a20 2020  it_dir="."):.   
-00002d80: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
-00002d90: 7374 7220 636f 6d6d 6974 3a0a 2020 2020  str commit:.    
-00002da0: 3a70 6172 616d 2073 7472 2067 6974 5f64  :param str git_d
-00002db0: 6972 3a0a 2020 2020 3a72 7479 7065 3a20  ir:.    :rtype: 
-00002dc0: 7374 720a 2020 2020 2222 220a 2020 2020  str.    """.    
-00002dd0: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-00002de0: 2073 7973 5f65 7865 635f 6f75 7428 2267   sys_exec_out("g
-00002df0: 6974 222c 2022 7368 6f77 222c 2022 2d73  it", "show", "-s
-00002e00: 222c 2022 2d2d 666f 726d 6174 3d25 6369  ", "--format=%ci
-00002e10: 222c 2063 6f6d 6d69 742c 2063 7764 3d67  ", commit, cwd=g
-00002e20: 6974 5f64 6972 290a 2020 2020 2020 2020  it_dir).        
-00002e30: 2e73 7472 6970 2829 5b3a 2d36 5d0a 2020  .strip()[:-6].  
-00002e40: 2020 2020 2020 2e72 6570 6c61 6365 2822        .replace("
-00002e50: 3a22 2c20 2222 290a 2020 2020 2020 2020  :", "").        
-00002e60: 2e72 6570 6c61 6365 2822 2d22 2c20 2222  .replace("-", ""
-00002e70: 290a 2020 2020 2020 2020 2e72 6570 6c61  ).        .repla
-00002e80: 6365 2822 2022 2c20 222e 2229 0a20 2020  ce(" ", ".").   
-00002e90: 2029 0a0a 0a64 6566 2067 6974 5f64 6573   )...def git_des
-00002ea0: 6372 6962 655f 6865 6164 5f76 6572 7369  cribe_head_versi
-00002eb0: 6f6e 2867 6974 5f64 6972 3d22 2e22 293a  on(git_dir="."):
-00002ec0: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
-00002ed0: 7261 6d20 7374 7220 6769 745f 6469 723a  ram str git_dir:
-00002ee0: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
-00002ef0: 0a20 2020 2022 2222 0a20 2020 2063 6461  .    """.    cda
-00002f00: 7465 203d 2067 6974 5f63 6f6d 6d69 745f  te = git_commit_
-00002f10: 6461 7465 2867 6974 5f64 6972 3d67 6974  date(git_dir=git
-00002f20: 5f64 6972 290a 2020 2020 7265 7620 3d20  _dir).    rev = 
-00002f30: 6769 745f 636f 6d6d 6974 5f72 6576 2867  git_commit_rev(g
-00002f40: 6974 5f64 6972 3d67 6974 5f64 6972 290a  it_dir=git_dir).
-00002f50: 2020 2020 6973 5f64 6972 7479 203d 2067      is_dirty = g
-00002f60: 6974 5f69 735f 6469 7274 7928 6769 745f  it_is_dirty(git_
-00002f70: 6469 723d 6769 745f 6469 7229 0a20 2020  dir=git_dir).   
-00002f80: 2072 6574 7572 6e20 2225 732d 2d67 6974   return "%s--git
-00002f90: 2d25 7325 7322 2025 2028 6364 6174 652c  -%s%s" % (cdate,
-00002fa0: 2072 6576 2c20 222d 6469 7274 7922 2069   rev, "-dirty" i
-00002fb0: 6620 6973 5f64 6972 7479 2065 6c73 6520  f is_dirty else 
-00002fc0: 2222 290a 0a0a 6465 6620 6465 7363 7269  "")...def descri
-00002fd0: 6265 5f72 6574 7572 6e6e 5f76 6572 7369  be_returnn_versi
-00002fe0: 6f6e 2829 3a0a 2020 2020 2222 220a 2020  on():.    """.  
-00002ff0: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
-00003000: 2020 3a72 6574 7572 6e3a 2073 7472 696e    :return: strin
-00003010: 6720 6c69 6b65 2022 312e 3230 3137 3130  g like "1.201710
-00003020: 3137 2e31 3633 3834 302b 6769 742d 6162  17.163840+git-ab
-00003030: 3261 3164 6122 0a20 2020 2022 2222 0a20  2a1da".    """. 
-00003040: 2020 2066 726f 6d20 7265 7475 726e 6e20     from returnn 
-00003050: 696d 706f 7274 205f 5f6c 6f6e 675f 7665  import __long_ve
-00003060: 7273 696f 6e5f 5f0a 0a20 2020 2072 6574  rsion__..    ret
-00003070: 7572 6e20 5f5f 6c6f 6e67 5f76 6572 7369  urn __long_versi
-00003080: 6f6e 5f5f 0a0a 0a64 6566 2064 6573 6372  on__...def descr
-00003090: 6962 655f 7465 6e73 6f72 666c 6f77 5f76  ibe_tensorflow_v
-000030a0: 6572 7369 6f6e 2829 3a0a 2020 2020 2222  ersion():.    ""
-000030b0: 220a 2020 2020 3a72 7479 7065 3a20 7374  ".    :rtype: st
-000030c0: 720a 2020 2020 2222 220a 2020 2020 7472  r.    """.    tr
-000030d0: 793a 0a20 2020 2020 2020 2069 6d70 6f72  y:.        impor
-000030e0: 7420 7465 6e73 6f72 666c 6f77 2061 7320  t tensorflow as 
-000030f0: 7466 0a20 2020 2065 7863 6570 7420 496d  tf.    except Im
-00003100: 706f 7274 4572 726f 723a 0a20 2020 2020  portError:.     
-00003110: 2020 2072 6574 7572 6e20 223c 5465 6e73     return "<Tens
-00003120: 6f72 466c 6f77 2049 6d70 6f72 7445 7272  orFlow ImportErr
-00003130: 6f72 3e22 0a20 2020 2074 7279 3a0a 2020  or>".    try:.  
-00003140: 2020 2020 2020 7464 6972 203d 206f 732e        tdir = os.
-00003150: 7061 7468 2e64 6972 6e61 6d65 2874 662e  path.dirname(tf.
-00003160: 5f5f 6669 6c65 5f5f 290a 2020 2020 6578  __file__).    ex
-00003170: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00003180: 7320 653a 0a20 2020 2020 2020 2074 6469  s e:.        tdi
-00003190: 7220 3d20 223c 756e 6b6e 6f77 6e28 6578  r = "<unknown(ex
-000031a0: 6365 7074 696f 6e3a 2025 7229 3e22 2025  ception: %r)>" %
-000031b0: 2065 0a20 2020 2076 6572 7369 6f6e 203d   e.    version =
-000031c0: 2067 6574 6174 7472 2874 662c 2022 5f5f   getattr(tf, "__
-000031d0: 7665 7273 696f 6e5f 5f22 2c20 223c 756e  version__", "<un
-000031e0: 6b6e 6f77 6e20 7665 7273 696f 6e3e 2229  known version>")
-000031f0: 0a20 2020 2076 6572 7369 6f6e 202b 3d20  .    version += 
-00003200: 2220 2825 7329 2220 2520 6765 7461 7474  " (%s)" % getatt
-00003210: 7228 7466 2c20 225f 5f67 6974 5f76 6572  r(tf, "__git_ver
-00003220: 7369 6f6e 5f5f 222c 2022 3c75 6e6b 6e6f  sion__", "<unkno
-00003230: 776e 2067 6974 2076 6572 7369 6f6e 3e22  wn git version>"
-00003240: 290a 2020 2020 7472 793a 0a20 2020 2020  ).    try:.     
-00003250: 2020 2069 6620 7464 6972 2e73 7461 7274     if tdir.start
-00003260: 7377 6974 6828 223c 2229 3a0a 2020 2020  swith("<"):.    
-00003270: 2020 2020 2020 2020 6769 745f 696e 666f          git_info
-00003280: 203d 2022 3c75 6e6b 6e6f 776e 2d64 6972   = "<unknown-dir
-00003290: 3e22 0a20 2020 2020 2020 2065 6c69 6620  >".        elif 
-000032a0: 6f73 2e70 6174 682e 6578 6973 7473 2874  os.path.exists(t
-000032b0: 6469 7220 2b20 222f 2e2e 2f2e 6769 7422  dir + "/../.git"
-000032c0: 293a 0a20 2020 2020 2020 2020 2020 2067  ):.            g
-000032d0: 6974 5f69 6e66 6f20 3d20 2267 6974 3a22  it_info = "git:"
-000032e0: 202b 2067 6974 5f64 6573 6372 6962 655f   + git_describe_
-000032f0: 6865 6164 5f76 6572 7369 6f6e 2867 6974  head_version(git
-00003300: 5f64 6972 3d74 6469 7229 0a20 2020 2020  _dir=tdir).     
-00003310: 2020 2065 6c69 6620 222f 7369 7465 2d70     elif "/site-p
-00003320: 6163 6b61 6765 732f 2220 696e 2074 6469  ackages/" in tdi
-00003330: 723a 0a20 2020 2020 2020 2020 2020 2067  r:.            g
-00003340: 6974 5f69 6e66 6f20 3d20 223c 7369 7465  it_info = "<site
-00003350: 2d70 6163 6b61 6765 3e22 0a20 2020 2020  -package>".     
-00003360: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00003370: 2020 2020 2067 6974 5f69 6e66 6f20 3d20       git_info = 
-00003380: 223c 6e6f 742d 756e 6465 722d 6769 743e  "<not-under-git>
-00003390: 220a 2020 2020 6578 6365 7074 2045 7863  ".    except Exc
-000033a0: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-000033b0: 2020 2020 2067 6974 5f69 6e66 6f20 3d20       git_info = 
-000033c0: 223c 756e 6b6e 6f77 6e28 6769 7420 6578  "<unknown(git ex
-000033d0: 6365 7074 696f 6e3a 2025 7229 3e22 2025  ception: %r)>" %
-000033e0: 2065 0a20 2020 2072 6574 7572 6e20 2225   e.    return "%
-000033f0: 7320 2825 7320 696e 2025 7329 2220 2520  s (%s in %s)" % 
-00003400: 2876 6572 7369 6f6e 2c20 6769 745f 696e  (version, git_in
-00003410: 666f 2c20 7464 6972 290a 0a0a 6465 6620  fo, tdir)...def 
-00003420: 6465 7363 7269 6265 5f74 6f72 6368 5f76  describe_torch_v
-00003430: 6572 7369 6f6e 2829 3a0a 2020 2020 2222  ersion():.    ""
-00003440: 220a 2020 2020 3a72 7479 7065 3a20 7374  ".    :rtype: st
-00003450: 720a 2020 2020 2222 220a 2020 2020 7472  r.    """.    tr
-00003460: 793a 0a20 2020 2020 2020 2023 206e 6f69  y:.        # noi
-00003470: 6e73 7065 6374 696f 6e20 5079 5061 636b  nspection PyPack
-00003480: 6167 6552 6571 7569 7265 6d65 6e74 730a  ageRequirements.
-00003490: 2020 2020 2020 2020 696d 706f 7274 2074          import t
-000034a0: 6f72 6368 0a20 2020 2065 7863 6570 7420  orch.    except 
-000034b0: 496d 706f 7274 4572 726f 7220 6173 2065  ImportError as e
-000034c0: 7863 3a0a 2020 2020 2020 2020 7265 7475  xc:.        retu
-000034d0: 726e 2022 3c50 7954 6f72 6368 2049 6d70  rn "<PyTorch Imp
-000034e0: 6f72 7445 7272 6f72 3a20 2573 3e22 2025  ortError: %s>" %
-000034f0: 2065 7863 0a20 2020 2074 7279 3a0a 2020   exc.    try:.  
-00003500: 2020 2020 2020 7464 6972 203d 206f 732e        tdir = os.
-00003510: 7061 7468 2e64 6972 6e61 6d65 2874 6f72  path.dirname(tor
-00003520: 6368 2e5f 5f66 696c 655f 5f29 0a20 2020  ch.__file__).   
-00003530: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00003540: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-00003550: 7464 6972 203d 2022 3c75 6e6b 6e6f 776e  tdir = "<unknown
-00003560: 2865 7863 6570 7469 6f6e 3a20 2572 293e  (exception: %r)>
-00003570: 2220 2520 650a 2020 2020 7665 7273 696f  " % e.    versio
-00003580: 6e20 3d20 6765 7461 7474 7228 746f 7263  n = getattr(torc
-00003590: 682c 2022 5f5f 7665 7273 696f 6e5f 5f22  h, "__version__"
-000035a0: 2c20 223c 756e 6b6e 6f77 6e20 7665 7273  , "<unknown vers
-000035b0: 696f 6e3e 2229 0a20 2020 2076 6572 7369  ion>").    versi
-000035c0: 6f6e 202b 3d20 2220 2825 7329 2220 2520  on += " (%s)" % 
-000035d0: 6765 7461 7474 7228 746f 7263 682e 7665  getattr(torch.ve
-000035e0: 7273 696f 6e2c 2022 6769 745f 7665 7273  rsion, "git_vers
-000035f0: 696f 6e22 2c20 223c 756e 6b6e 6f77 6e20  ion", "<unknown 
-00003600: 6769 7420 7665 7273 696f 6e3e 2229 0a20  git version>"). 
-00003610: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00003620: 6966 2074 6469 722e 7374 6172 7473 7769  if tdir.startswi
-00003630: 7468 2822 3c22 293a 0a20 2020 2020 2020  th("<"):.       
-00003640: 2020 2020 2067 6974 5f69 6e66 6f20 3d20       git_info = 
-00003650: 223c 756e 6b6e 6f77 6e2d 6469 723e 220a  "<unknown-dir>".
-00003660: 2020 2020 2020 2020 656c 6966 206f 732e          elif os.
-00003670: 7061 7468 2e65 7869 7374 7328 7464 6972  path.exists(tdir
-00003680: 202b 2022 2f2e 2e2f 2e67 6974 2229 3a0a   + "/../.git"):.
-00003690: 2020 2020 2020 2020 2020 2020 6769 745f              git_
-000036a0: 696e 666f 203d 2022 6769 743a 2220 2b20  info = "git:" + 
-000036b0: 6769 745f 6465 7363 7269 6265 5f68 6561  git_describe_hea
-000036c0: 645f 7665 7273 696f 6e28 6769 745f 6469  d_version(git_di
-000036d0: 723d 7464 6972 290a 2020 2020 2020 2020  r=tdir).        
-000036e0: 656c 6966 2022 2f73 6974 652d 7061 636b  elif "/site-pack
-000036f0: 6167 6573 2f22 2069 6e20 7464 6972 3a0a  ages/" in tdir:.
-00003700: 2020 2020 2020 2020 2020 2020 6769 745f              git_
-00003710: 696e 666f 203d 2022 3c73 6974 652d 7061  info = "<site-pa
-00003720: 636b 6167 653e 220a 2020 2020 2020 2020  ckage>".        
-00003730: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00003740: 2020 6769 745f 696e 666f 203d 2022 3c6e    git_info = "<n
-00003750: 6f74 2d75 6e64 6572 2d67 6974 3e22 0a20  ot-under-git>". 
-00003760: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00003770: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-00003780: 2020 6769 745f 696e 666f 203d 2022 3c75    git_info = "<u
-00003790: 6e6b 6e6f 776e 2867 6974 2065 7863 6570  nknown(git excep
-000037a0: 7469 6f6e 3a20 2572 293e 2220 2520 650a  tion: %r)>" % e.
-000037b0: 2020 2020 7265 7475 726e 2022 2573 2028      return "%s (
-000037c0: 2573 2069 6e20 2573 2922 2025 2028 7665  %s in %s)" % (ve
-000037d0: 7273 696f 6e2c 2067 6974 5f69 6e66 6f2c  rsion, git_info,
-000037e0: 2074 6469 7229 0a0a 0a64 6566 2067 6574   tdir)...def get
-000037f0: 5f74 656e 736f 7266 6c6f 775f 7665 7273  _tensorflow_vers
-00003800: 696f 6e5f 7475 706c 6528 293a 0a20 2020  ion_tuple():.   
-00003810: 2022 2222 0a20 2020 203a 7265 7475 726e   """.    :return
-00003820: 3a20 7475 706c 6520 6f66 2069 6e74 732c  : tuple of ints,
-00003830: 2066 6972 7374 2065 6e74 7279 2069 7320   first entry is 
-00003840: 7468 6520 6d61 6a6f 7220 7665 7273 696f  the major versio
-00003850: 6e0a 2020 2020 3a72 7479 7065 3a20 7475  n.    :rtype: tu
-00003860: 706c 655b 696e 745d 0a20 2020 2022 2222  ple[int].    """
-00003870: 0a20 2020 2069 6d70 6f72 7420 7465 6e73  .    import tens
-00003880: 6f72 666c 6f77 2061 7320 7466 0a20 2020  orflow as tf.   
-00003890: 2069 6d70 6f72 7420 7265 0a0a 2020 2020   import re..    
-000038a0: 7265 7475 726e 2074 7570 6c65 285b 696e  return tuple([in
-000038b0: 7428 7265 2e73 7562 2822 282d 7263 5b30  t(re.sub("(-rc[0
-000038c0: 2d39 5d7c 2d64 6576 5b30 2d39 5d2a 2922  -9]|-dev[0-9]*)"
-000038d0: 2c20 2222 2c20 7329 2920 666f 7220 7320  , "", s)) for s 
-000038e0: 696e 2074 662e 5f5f 7665 7273 696f 6e5f  in tf.__version_
-000038f0: 5f2e 7370 6c69 7428 222e 2229 5d29 0a0a  _.split(".")])..
-00003900: 0a64 6566 2065 7661 6c5f 7368 656c 6c5f  .def eval_shell_
-00003910: 656e 7628 746f 6b65 6e29 3a0a 2020 2020  env(token):.    
-00003920: 2222 220a 2020 2020 3a70 6172 616d 2073  """.    :param s
-00003930: 7472 2074 6f6b 656e 3a0a 2020 2020 3a72  tr token:.    :r
-00003940: 6574 7572 6e3a 2069 6620 2224 7661 7222  eturn: if "$var"
-00003950: 2c20 6c6f 6f6b 7320 696e 206f 732e 656e  , looks in os.en
-00003960: 7669 726f 6e2c 206f 7468 6572 7769 7365  viron, otherwise
-00003970: 2072 6574 7572 6e20 746f 6b65 6e20 6173   return token as
-00003980: 2069 730a 2020 2020 3a72 7479 7065 3a20   is.    :rtype: 
-00003990: 7374 720a 2020 2020 2222 220a 2020 2020  str.    """.    
-000039a0: 6966 2074 6f6b 656e 2e73 7461 7274 7377  if token.startsw
-000039b0: 6974 6828 2224 2229 3a0a 2020 2020 2020  ith("$"):.      
-000039c0: 2020 7265 7475 726e 206f 732e 656e 7669    return os.envi
-000039d0: 726f 6e2e 6765 7428 746f 6b65 6e5b 313a  ron.get(token[1:
-000039e0: 5d2c 2022 2229 0a20 2020 2072 6574 7572  ], "").    retur
-000039f0: 6e20 746f 6b65 6e0a 0a0a 6465 6620 6576  n token...def ev
-00003a00: 616c 5f73 6865 6c6c 5f73 7472 2873 293a  al_shell_str(s):
-00003a10: 0a20 2020 2022 2222 0a20 2020 203a 7479  .    """.    :ty
-00003a20: 7065 2073 3a20 7374 7220 7c20 6c69 7374  pe s: str | list
-00003a30: 5b73 7472 5d20 7c20 2829 2d3e 7374 7220  [str] | ()->str 
-00003a40: 7c20 6c69 7374 5b28 292d 3e73 7472 5d20  | list[()->str] 
-00003a50: 7c20 2829 2d3e 6c69 7374 5b73 7472 5d20  | ()->list[str] 
-00003a60: 7c20 2829 2d3e 6c69 7374 5b28 292d 3e73  | ()->list[()->s
-00003a70: 7472 5d0a 2020 2020 3a72 7479 7065 3a20  tr].    :rtype: 
-00003a80: 6c69 7374 5b73 7472 5d0a 0a20 2020 2050  list[str]..    P
-00003a90: 6172 7365 7320 6073 6020 6173 2073 6865  arses `s` as she
-00003aa0: 6c6c 206c 696b 6520 6172 6775 6d65 6e74  ll like argument
-00003ab0: 7320 2876 6961 2073 686c 6578 2e73 706c  s (via shlex.spl
-00003ac0: 6974 2920 616e 6420 6576 616c 7561 7465  it) and evaluate
-00003ad0: 7320 7368 656c 6c20 656e 7669 726f 6e6d  s shell environm
-00003ae0: 656e 7420 7661 7269 6162 6c65 730a 2020  ent variables.  
-00003af0: 2020 283a 6675 6e63 3a60 6576 616c 5f73    (:func:`eval_s
-00003b00: 6865 6c6c 5f65 6e76 6029 2e0a 2020 2020  hell_env`)..    
-00003b10: 6073 6020 6f72 2069 7473 2065 6c65 6d65  `s` or its eleme
-00003b20: 6e74 7320 6361 6e20 616c 736f 2062 6520  nts can also be 
-00003b30: 6361 6c6c 6162 6c65 2e20 496e 2074 686f  callable. In tho
-00003b40: 7365 2063 6173 6573 2c20 7468 6579 2077  se cases, they w
-00003b50: 696c 6c20 6265 2063 616c 6c65 6420 616e  ill be called an
-00003b60: 6420 7468 6520 7265 7475 726e 6564 2076  d the returned v
-00003b70: 616c 7565 2069 7320 7573 6564 2e0a 2020  alue is used..  
-00003b80: 2020 2222 220a 2020 2020 746f 6b65 6e73    """.    tokens
-00003b90: 203d 205b 5d0a 2020 2020 6966 2063 616c   = [].    if cal
-00003ba0: 6c61 626c 6528 7329 3a0a 2020 2020 2020  lable(s):.      
-00003bb0: 2020 7320 3d20 7328 290a 2020 2020 6966    s = s().    if
-00003bc0: 2069 7369 6e73 7461 6e63 6528 732c 2028   isinstance(s, (
-00003bd0: 6c69 7374 2c20 7475 706c 6529 293a 0a20  list, tuple)):. 
-00003be0: 2020 2020 2020 206c 7320 3d20 730a 2020         ls = s.  
-00003bf0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00003c00: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
-00003c10: 6528 732c 2028 7374 722c 2075 6e69 636f  e(s, (str, unico
-00003c20: 6465 2929 0a20 2020 2020 2020 206c 7320  de)).        ls 
-00003c30: 3d20 7368 6c65 782e 7370 6c69 7428 7329  = shlex.split(s)
-00003c40: 0a20 2020 2066 6f72 2074 6f6b 656e 2069  .    for token i
-00003c50: 6e20 6c73 3a0a 2020 2020 2020 2020 6966  n ls:.        if
-00003c60: 2063 616c 6c61 626c 6528 746f 6b65 6e29   callable(token)
-00003c70: 3a0a 2020 2020 2020 2020 2020 2020 746f  :.            to
-00003c80: 6b65 6e20 3d20 746f 6b65 6e28 290a 2020  ken = token().  
-00003c90: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
-00003ca0: 6e73 7461 6e63 6528 746f 6b65 6e2c 2028  nstance(token, (
-00003cb0: 7374 722c 2075 6e69 636f 6465 2929 0a20  str, unicode)). 
-00003cc0: 2020 2020 2020 2069 6620 746f 6b65 6e2e         if token.
-00003cd0: 7374 6172 7473 7769 7468 2822 2422 293a  startswith("$"):
-00003ce0: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
-00003cf0: 656e 7320 2b3d 2065 7661 6c5f 7368 656c  ens += eval_shel
-00003d00: 6c5f 7374 7228 6576 616c 5f73 6865 6c6c  l_str(eval_shell
-00003d10: 5f65 6e76 2874 6f6b 656e 2929 0a20 2020  _env(token)).   
-00003d20: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00003d30: 2020 2020 2020 2074 6f6b 656e 7320 2b3d         tokens +=
-00003d40: 205b 746f 6b65 6e5d 0a20 2020 2072 6574   [token].    ret
-00003d50: 7572 6e20 746f 6b65 6e73 0a0a 0a64 6566  urn tokens...def
-00003d60: 2068 6466 355f 6469 6d65 6e73 696f 6e28   hdf5_dimension(
-00003d70: 6669 6c65 6e61 6d65 2c20 6469 6d65 6e73  filename, dimens
-00003d80: 696f 6e29 3a0a 2020 2020 2222 220a 2020  ion):.    """.  
-00003d90: 2020 3a70 6172 616d 2073 7472 2066 696c    :param str fil
-00003da0: 656e 616d 653a 0a20 2020 203a 7061 7261  ename:.    :para
-00003db0: 6d20 7374 7220 6469 6d65 6e73 696f 6e3a  m str dimension:
-00003dc0: 0a20 2020 203a 7274 7970 653a 206e 756d  .    :rtype: num
-00003dd0: 7079 2e6e 6461 7272 6179 7c69 6e74 0a20  py.ndarray|int. 
-00003de0: 2020 2022 2222 0a20 2020 2066 696e 203d     """.    fin =
-00003df0: 2068 3570 792e 4669 6c65 2866 696c 656e   h5py.File(filen
-00003e00: 616d 652c 2022 7222 290a 2020 2020 6966  ame, "r").    if
-00003e10: 2022 2f22 2069 6e20 6469 6d65 6e73 696f   "/" in dimensio
-00003e20: 6e3a 0a20 2020 2020 2020 2072 6573 203d  n:.        res =
-00003e30: 2066 696e 5b22 2f22 2e6a 6f69 6e28 6469   fin["/".join(di
-00003e40: 6d65 6e73 696f 6e2e 7370 6c69 7428 222f  mension.split("/
-00003e50: 2229 5b3a 2d31 5d29 5d2e 6174 7472 735b  ")[:-1])].attrs[
-00003e60: 6469 6d65 6e73 696f 6e2e 7370 6c69 7428  dimension.split(
-00003e70: 222f 2229 5b2d 315d 5d0a 2020 2020 656c  "/")[-1]].    el
-00003e80: 7365 3a0a 2020 2020 2020 2020 7265 7320  se:.        res 
-00003e90: 3d20 6669 6e2e 6174 7472 735b 6469 6d65  = fin.attrs[dime
-00003ea0: 6e73 696f 6e5d 0a20 2020 2066 696e 2e63  nsion].    fin.c
-00003eb0: 6c6f 7365 2829 0a20 2020 2072 6574 7572  lose().    retur
-00003ec0: 6e20 7265 730a 0a0a 6465 6620 6864 6635  n res...def hdf5
-00003ed0: 5f67 726f 7570 2866 696c 656e 616d 652c  _group(filename,
-00003ee0: 2064 696d 656e 7369 6f6e 293a 0a20 2020   dimension):.   
-00003ef0: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
-00003f00: 7374 7220 6669 6c65 6e61 6d65 3a0a 2020  str filename:.  
-00003f10: 2020 3a70 6172 616d 2073 7472 2064 696d    :param str dim
-00003f20: 656e 7369 6f6e 3a0a 2020 2020 3a72 7479  ension:.    :rty
-00003f30: 7065 3a20 6469 6374 5b73 7472 5d0a 2020  pe: dict[str].  
-00003f40: 2020 2222 220a 2020 2020 6669 6e20 3d20    """.    fin = 
-00003f50: 6835 7079 2e46 696c 6528 6669 6c65 6e61  h5py.File(filena
-00003f60: 6d65 2c20 2272 2229 0a20 2020 2072 6573  me, "r").    res
-00003f70: 203d 207b 6b3a 2066 696e 5b64 696d 656e   = {k: fin[dimen
-00003f80: 7369 6f6e 5d2e 6174 7472 735b 6b5d 2066  sion].attrs[k] f
-00003f90: 6f72 206b 2069 6e20 6669 6e5b 6469 6d65  or k in fin[dime
-00003fa0: 6e73 696f 6e5d 2e61 7474 7273 7d0a 2020  nsion].attrs}.  
-00003fb0: 2020 6669 6e2e 636c 6f73 6528 290a 2020    fin.close().  
-00003fc0: 2020 7265 7475 726e 2072 6573 0a0a 0a64    return res...d
-00003fd0: 6566 2068 6466 355f 7368 6170 6528 6669  ef hdf5_shape(fi
-00003fe0: 6c65 6e61 6d65 2c20 6469 6d65 6e73 696f  lename, dimensio
-00003ff0: 6e29 3a0a 2020 2020 2222 220a 2020 2020  n):.    """.    
-00004000: 3a70 6172 616d 2073 7472 2066 696c 656e  :param str filen
-00004010: 616d 653a 0a20 2020 203a 7061 7261 6d20  ame:.    :param 
-00004020: 6469 6d65 6e73 696f 6e3a 0a20 2020 203a  dimension:.    :
-00004030: 7274 7970 653a 2074 7570 6c65 5b69 6e74  rtype: tuple[int
-00004040: 5d0a 2020 2020 2222 220a 2020 2020 6669  ].    """.    fi
-00004050: 6e20 3d20 6835 7079 2e46 696c 6528 6669  n = h5py.File(fi
-00004060: 6c65 6e61 6d65 2c20 2272 2229 0a20 2020  lename, "r").   
-00004070: 2072 6573 203d 2066 696e 5b64 696d 656e   res = fin[dimen
-00004080: 7369 6f6e 5d2e 7368 6170 650a 2020 2020  sion].shape.    
-00004090: 6669 6e2e 636c 6f73 6528 290a 2020 2020  fin.close().    
-000040a0: 7265 7475 726e 2072 6573 0a0a 0a64 6566  return res...def
-000040b0: 2068 6466 355f 7374 7269 6e67 7328 6861   hdf5_strings(ha
-000040c0: 6e64 6c65 2c20 6e61 6d65 2c20 6461 7461  ndle, name, data
-000040d0: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-000040e0: 7061 7261 6d20 6835 7079 2e46 696c 6520  param h5py.File 
-000040f0: 6861 6e64 6c65 3a0a 2020 2020 3a70 6172  handle:.    :par
-00004100: 616d 2073 7472 206e 616d 653a 0a20 2020  am str name:.   
-00004110: 203a 7061 7261 6d20 6e75 6d70 792e 6e64   :param numpy.nd
-00004120: 6172 7261 797c 6c69 7374 5b73 7472 5d20  array|list[str] 
-00004130: 6461 7461 3a0a 2020 2020 2222 220a 2020  data:.    """.  
-00004140: 2020 2320 6e6f 696e 7370 6563 7469 6f6e    # noinspection
-00004150: 2050 7942 726f 6164 4578 6365 7074 696f   PyBroadExceptio
-00004160: 6e0a 2020 2020 7472 793a 0a20 2020 2020  n.    try:.     
-00004170: 2020 2073 203d 206d 6178 285b 6c65 6e28     s = max([len(
-00004180: 6429 2066 6f72 2064 2069 6e20 6461 7461  d) for d in data
-00004190: 5d29 0a20 2020 2020 2020 2064 7365 7420  ]).        dset 
-000041a0: 3d20 6861 6e64 6c65 2e63 7265 6174 655f  = handle.create_
-000041b0: 6461 7461 7365 7428 6e61 6d65 2c20 286c  dataset(name, (l
-000041c0: 656e 2864 6174 6129 2c29 2c20 6474 7970  en(data),), dtyp
-000041d0: 653d 2253 2220 2b20 7374 7228 7329 290a  e="S" + str(s)).
-000041e0: 2020 2020 2020 2020 6473 6574 5b2e 2e2e          dset[...
-000041f0: 5d20 3d20 6461 7461 0a20 2020 2065 7863  ] = data.    exc
-00004200: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-00004210: 2020 2020 2020 2023 206e 6f69 6e73 7065         # noinspe
-00004220: 6374 696f 6e20 5079 556e 7265 736f 6c76  ction PyUnresolv
-00004230: 6564 5265 6665 7265 6e63 6573 0a20 2020  edReferences.   
-00004240: 2020 2020 2064 7420 3d20 6835 7079 2e73       dt = h5py.s
-00004250: 7065 6369 616c 5f64 7479 7065 2876 6c65  pecial_dtype(vle
-00004260: 6e3d 756e 6963 6f64 6529 0a20 2020 2020  n=unicode).     
-00004270: 2020 2064 656c 2068 616e 646c 655b 6e61     del handle[na
-00004280: 6d65 5d0a 2020 2020 2020 2020 6473 6574  me].        dset
-00004290: 203d 2068 616e 646c 652e 6372 6561 7465   = handle.create
-000042a0: 5f64 6174 6173 6574 286e 616d 652c 2028  _dataset(name, (
-000042b0: 6c65 6e28 6461 7461 292c 292c 2064 7479  len(data),), dty
-000042c0: 7065 3d64 7429 0a20 2020 2020 2020 2064  pe=dt).        d
-000042d0: 7365 745b 2e2e 2e5d 203d 2064 6174 610a  set[...] = data.
-000042e0: 0a0a 6465 6620 6d6f 6465 6c5f 6570 6f63  ..def model_epoc
-000042f0: 685f 6672 6f6d 5f66 696c 656e 616d 6528  h_from_filename(
-00004300: 6669 6c65 6e61 6d65 293a 0a20 2020 2022  filename):.    "
-00004310: 2222 0a20 2020 203a 7061 7261 6d20 7374  "".    :param st
-00004320: 7220 6669 6c65 6e61 6d65 3a0a 2020 2020  r filename:.    
-00004330: 3a72 6574 7572 6e3a 2065 706f 6368 206e  :return: epoch n
-00004340: 756d 6265 720a 2020 2020 3a72 7479 7065  umber.    :rtype
-00004350: 3a20 696e 740a 2020 2020 2222 220a 2020  : int.    """.  
-00004360: 2020 2320 5765 2063 6f75 6c64 2063 6865    # We could che
-00004370: 636b 2076 6961 3a0a 2020 2020 2320 7466  ck via:.    # tf
-00004380: 2e63 6f6e 7472 6962 2e66 7261 6d65 776f  .contrib.framewo
-00004390: 726b 2e70 7974 686f 6e2e 6672 616d 6577  rk.python.framew
-000043a0: 6f72 6b2e 6368 6563 6b70 6f69 6e74 5f75  ork.checkpoint_u
-000043b0: 7469 6c73 2e6c 6f61 645f 7661 7269 6162  tils.load_variab
-000043c0: 6c65 2829 0a20 2020 2023 206f 6e63 6520  le().    # once 
-000043d0: 7765 2073 6176 6520 7468 6174 2069 6e20  we save that in 
-000043e0: 7468 6520 6d6f 6465 6c2e 0a20 2020 2023  the model..    #
-000043f0: 2053 6565 2054 464e 6574 776f 726b 2e4e   See TFNetwork.N
-00004400: 6574 776f 726b 2e5f 6372 6561 7465 5f73  etwork._create_s
-00004410: 6176 6572 2829 2e0a 2020 2020 2320 5765  aver()..    # We
-00004420: 2064 6f6e 2774 2068 6176 6520 6974 2069   don't have it i
-00004430: 6e20 7468 6520 6d6f 6465 6c2c 2074 686f  n the model, tho
-00004440: 7567 682e 0a20 2020 2023 2046 6f72 206e  ugh..    # For n
-00004450: 6f77 2c20 6a75 7374 2070 6172 7365 2069  ow, just parse i
-00004460: 7420 6672 6f6d 2066 696c 656e 616d 652e  t from filename.
-00004470: 0a20 2020 2023 2049 6620 5446 2c20 616e  .    # If TF, an
-00004480: 6420 7379 6d6c 696e 6b2c 2072 6573 6f6c  d symlink, resol
-00004490: 7665 2075 6e74 696c 206e 6f20 7379 6d6c  ve until no syml
-000044a0: 696e 6b20 616e 796d 6f72 6520 2865 2e67  ink anymore (e.g
-000044b0: 2e20 6966 2077 6520 7379 6d6c 696e 6b65  . if we symlinke
-000044c0: 6420 7468 6520 6265 7374 2065 706f 6368  d the best epoch
-000044d0: 292e 0a20 2020 2077 6869 6c65 2054 7275  )..    while Tru
-000044e0: 653a 0a20 2020 2020 2020 2074 665f 6d65  e:.        tf_me
-000044f0: 7461 5f66 6e20 3d20 2225 732e 6d65 7461  ta_fn = "%s.meta
-00004500: 2220 2520 6669 6c65 6e61 6d65 0a20 2020  " % filename.   
-00004510: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00004520: 6578 6973 7473 2874 665f 6d65 7461 5f66  exists(tf_meta_f
-00004530: 6e29 2061 6e64 206f 732e 7061 7468 2e69  n) and os.path.i
-00004540: 736c 696e 6b28 7466 5f6d 6574 615f 666e  slink(tf_meta_fn
-00004550: 293a 0a20 2020 2020 2020 2020 2020 2074  ):.            t
-00004560: 665f 6d65 7461 5f66 6e5f 203d 206f 732e  f_meta_fn_ = os.
-00004570: 7265 6164 6c69 6e6b 2874 665f 6d65 7461  readlink(tf_meta
-00004580: 5f66 6e29 0a20 2020 2020 2020 2020 2020  _fn).           
-00004590: 2061 7373 6572 7420 7466 5f6d 6574 615f   assert tf_meta_
-000045a0: 666e 5f2e 656e 6473 7769 7468 2822 2e6d  fn_.endswith(".m
-000045b0: 6574 6122 292c 2022 7374 7261 6e67 653f  eta"), "strange?
-000045c0: 2025 732c 2025 7322 2025 2028 6669 6c65   %s, %s" % (file
-000045d0: 6e61 6d65 2c20 7466 5f6d 6574 615f 666e  name, tf_meta_fn
-000045e0: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
-000045f0: 6c65 6e61 6d65 203d 2074 665f 6d65 7461  lename = tf_meta
-00004600: 5f66 6e5f 5b3a 202d 6c65 6e28 222e 6d65  _fn_[: -len(".me
-00004610: 7461 2229 5d0a 2020 2020 2020 2020 656c  ta")].        el
-00004620: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00004630: 6272 6561 6b0a 2020 2020 6d20 3d20 7265  break.    m = re
-00004640: 2e6d 6174 6368 2822 2e2a 5c5c 2e28 5b30  .match(".*\\.([0
-00004650: 2d39 5d2b 2922 2c20 6669 6c65 6e61 6d65  -9]+)", filename
-00004660: 290a 2020 2020 6173 7365 7274 206d 2c20  ).    assert m, 
-00004670: 226e 6f20 6d61 7463 6820 666f 7220 2572  "no match for %r
-00004680: 2220 2520 6669 6c65 6e61 6d65 0a20 2020  " % filename.   
-00004690: 2072 6574 7572 6e20 696e 7428 6d2e 6772   return int(m.gr
-000046a0: 6f75 7073 2829 5b30 5d29 0a0a 0a64 6566  oups()[0])...def
-000046b0: 2064 6565 705f 7570 6461 7465 5f64 6963   deep_update_dic
-000046c0: 745f 7661 6c75 6573 2864 2c20 6b65 792c  t_values(d, key,
-000046d0: 206e 6577 5f76 616c 7565 293a 0a20 2020   new_value):.   
-000046e0: 2022 2222 0a20 2020 2056 6973 6974 7320   """.    Visits 
-000046f0: 616c 6c20 6974 656d 7320 696e 2060 6460  all items in `d`
-00004700: 2e0a 2020 2020 4966 2074 6865 2076 616c  ..    If the val
-00004710: 7565 2069 7320 6120 6469 6374 2c20 6974  ue is a dict, it
-00004720: 2077 696c 6c20 7265 6375 7273 6976 656c   will recursivel
-00004730: 7920 7669 7369 7420 6974 2e0a 0a20 2020  y visit it...   
-00004740: 203a 7061 7261 6d20 6469 6374 5b73 7472   :param dict[str
-00004750: 2c54 7c6f 626a 6563 747c 4e6f 6e65 7c64  ,T|object|None|d
-00004760: 6963 745d 2064 3a20 7769 6c6c 2075 7064  ict] d: will upd
-00004770: 6174 6520 696e 706c 6163 650a 2020 2020  ate inplace.    
-00004780: 3a70 6172 616d 2073 7472 206b 6579 3a0a  :param str key:.
-00004790: 2020 2020 3a70 6172 616d 2054 206e 6577      :param T new
-000047a0: 5f76 616c 7565 3a0a 2020 2020 2222 220a  _value:.    """.
-000047b0: 2020 2020 666f 7220 7661 6c75 6520 696e      for value in
-000047c0: 2064 2e76 616c 7565 7328 293a 0a20 2020   d.values():.   
-000047d0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-000047e0: 6365 2876 616c 7565 2c20 6469 6374 293a  ce(value, dict):
-000047f0: 0a20 2020 2020 2020 2020 2020 2064 6565  .            dee
-00004800: 705f 7570 6461 7465 5f64 6963 745f 7661  p_update_dict_va
-00004810: 6c75 6573 2876 616c 7565 2c20 6b65 793d  lues(value, key=
-00004820: 6b65 792c 206e 6577 5f76 616c 7565 3d6e  key, new_value=n
-00004830: 6577 5f76 616c 7565 290a 2020 2020 6966  ew_value).    if
-00004840: 206b 6579 2069 6e20 643a 0a20 2020 2020   key in d:.     
-00004850: 2020 2064 5b6b 6579 5d20 3d20 6e65 775f     d[key] = new_
-00004860: 7661 6c75 650a 0a0a 6465 6620 7465 726d  value...def term
-00004870: 696e 616c 5f73 697a 6528 6669 6c65 3d73  inal_size(file=s
-00004880: 7973 2e73 7464 6f75 7429 3a0a 2020 2020  ys.stdout):.    
-00004890: 2222 220a 2020 2020 5265 7475 726e 7320  """.    Returns 
-000048a0: 7468 6520 7465 726d 696e 616c 2073 697a  the terminal siz
-000048b0: 652e 0a20 2020 2054 6869 7320 7769 6c6c  e..    This will
-000048c0: 2070 726f 6261 626c 7920 776f 726b 206f   probably work o
-000048d0: 6e20 6c69 6e75 7820 6f6e 6c79 2e0a 0a20  n linux only... 
-000048e0: 2020 203a 7061 7261 6d20 696f 2e46 696c     :param io.Fil
-000048f0: 6520 6669 6c65 3a0a 2020 2020 3a72 6574  e file:.    :ret
-00004900: 7572 6e3a 2028 636f 6c75 6d6e 732c 206c  urn: (columns, l
-00004910: 696e 6573 292c 206f 7220 282d 312c 2d31  ines), or (-1,-1
-00004920: 290a 2020 2020 3a72 7479 7065 3a20 2869  ).    :rtype: (i
-00004930: 6e74 2c69 6e74 290a 2020 2020 2222 220a  nt,int).    """.
-00004940: 2020 2020 696d 706f 7274 206f 730a 2020      import os.  
-00004950: 2020 696d 706f 7274 2069 6f0a 0a20 2020    import io..   
-00004960: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
-00004970: 6669 6c65 2c20 2266 696c 656e 6f22 293a  file, "fileno"):
-00004980: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004990: 2d31 2c20 2d31 0a20 2020 2074 7279 3a0a  -1, -1.    try:.
-000049a0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-000049b0: 732e 6973 6174 7479 2866 696c 652e 6669  s.isatty(file.fi
-000049c0: 6c65 6e6f 2829 293a 0a20 2020 2020 2020  leno()):.       
-000049d0: 2020 2020 2072 6574 7572 6e20 2d31 2c20       return -1, 
-000049e0: 2d31 0a20 2020 2065 7863 6570 7420 2869  -1.    except (i
-000049f0: 6f2e 556e 7375 7070 6f72 7465 644f 7065  o.UnsupportedOpe
-00004a00: 7261 7469 6f6e 2c20 5661 6c75 6545 7272  ration, ValueErr
-00004a10: 6f72 293a 0a20 2020 2020 2020 2072 6574  or):.        ret
-00004a20: 7572 6e20 2d31 2c20 2d31 0a20 2020 2065  urn -1, -1.    e
-00004a30: 6e76 203d 206f 732e 656e 7669 726f 6e0a  nv = os.environ.
-00004a40: 0a20 2020 2023 206e 6f69 6e73 7065 6374  .    # noinspect
-00004a50: 696f 6e20 5079 5368 6164 6f77 696e 674e  ion PyShadowingN
-00004a60: 616d 6573 0a20 2020 2064 6566 2069 6f63  ames.    def ioc
-00004a70: 746c 5f67 7769 6e73 7a28 6664 293a 0a20  tl_gwinsz(fd):. 
-00004a80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00004a90: 2020 203a 7061 7261 6d20 696e 7420 6664     :param int fd
-00004aa0: 3a20 6669 6c65 2064 6573 6372 6970 746f  : file descripto
-00004ab0: 720a 2020 2020 2020 2020 3a72 7479 7065  r.        :rtype
-00004ac0: 3a20 7475 706c 655b 696e 745d 0a20 2020  : tuple[int].   
-00004ad0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00004ae0: 2023 206e 6f69 6e73 7065 6374 696f 6e20   # noinspection 
-00004af0: 5079 4272 6f61 6445 7863 6570 7469 6f6e  PyBroadException
-00004b00: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00004b10: 2020 2020 2020 2020 2020 696d 706f 7274            import
-00004b20: 2066 636e 746c 0a20 2020 2020 2020 2020   fcntl.         
-00004b30: 2020 2069 6d70 6f72 7420 7465 726d 696f     import termio
-00004b40: 730a 2020 2020 2020 2020 2020 2020 696d  s.            im
-00004b50: 706f 7274 2073 7472 7563 740a 0a20 2020  port struct..   
-00004b60: 2020 2020 2020 2020 2063 725f 203d 2073           cr_ = s
-00004b70: 7472 7563 742e 756e 7061 636b 2822 6868  truct.unpack("hh
-00004b80: 222c 2066 636e 746c 2e69 6f63 746c 2866  ", fcntl.ioctl(f
-00004b90: 642c 2074 6572 6d69 6f73 2e54 494f 4347  d, termios.TIOCG
-00004ba0: 5749 4e53 5a2c 2022 3132 3334 2229 2920  WINSZ, "1234")) 
-00004bb0: 2023 206e 6f71 610a 2020 2020 2020 2020   # noqa.        
-00004bc0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00004bd0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00004be0: 7475 726e 0a20 2020 2020 2020 2072 6574  turn.        ret
-00004bf0: 7572 6e20 6372 5f0a 0a20 2020 2063 7220  urn cr_..    cr 
-00004c00: 3d20 696f 6374 6c5f 6777 696e 737a 2866  = ioctl_gwinsz(f
-00004c10: 696c 652e 6669 6c65 6e6f 2920 6f72 2069  ile.fileno) or i
-00004c20: 6f63 746c 5f67 7769 6e73 7a28 3029 206f  octl_gwinsz(0) o
-00004c30: 7220 696f 6374 6c5f 6777 696e 737a 2831  r ioctl_gwinsz(1
-00004c40: 2920 6f72 2069 6f63 746c 5f67 7769 6e73  ) or ioctl_gwins
-00004c50: 7a28 3229 0a20 2020 2069 6620 6e6f 7420  z(2).    if not 
-00004c60: 6372 3a0a 2020 2020 2020 2020 2320 6e6f  cr:.        # no
-00004c70: 696e 7370 6563 7469 6f6e 2050 7942 726f  inspection PyBro
-00004c80: 6164 4578 6365 7074 696f 6e0a 2020 2020  adException.    
-00004c90: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00004ca0: 2020 2020 2066 6420 3d20 6f73 2e6f 7065       fd = os.ope
-00004cb0: 6e28 6f73 2e63 7465 726d 6964 2829 2c20  n(os.ctermid(), 
-00004cc0: 6f73 2e4f 5f52 444f 4e4c 5929 0a20 2020  os.O_RDONLY).   
-00004cd0: 2020 2020 2020 2020 2063 7220 3d20 696f           cr = io
-00004ce0: 6374 6c5f 6777 696e 737a 2866 6429 0a20  ctl_gwinsz(fd). 
-00004cf0: 2020 2020 2020 2020 2020 206f 732e 636c             os.cl
-00004d00: 6f73 6528 6664 290a 2020 2020 2020 2020  ose(fd).        
-00004d10: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00004d20: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-00004d30: 7373 0a20 2020 2069 6620 6e6f 7420 6372  ss.    if not cr
-00004d40: 3a0a 2020 2020 2020 2020 6372 203d 2028  :.        cr = (
-00004d50: 656e 762e 6765 7428 224c 494e 4553 222c  env.get("LINES",
-00004d60: 2032 3529 2c20 656e 762e 6765 7428 2243   25), env.get("C
-00004d70: 4f4c 554d 4e53 222c 2038 3029 290a 2020  OLUMNS", 80)).  
-00004d80: 2020 7265 7475 726e 2069 6e74 2863 725b    return int(cr[
-00004d90: 315d 292c 2069 6e74 2863 725b 305d 290a  1]), int(cr[0]).
-00004da0: 0a0a 6465 6620 6973 5f74 7479 2866 696c  ..def is_tty(fil
-00004db0: 653d 7379 732e 7374 646f 7574 293a 0a20  e=sys.stdout):. 
-00004dc0: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
-00004dd0: 6d20 696f 2e46 696c 6520 6669 6c65 3a0a  m io.File file:.
-00004de0: 2020 2020 3a72 7479 7065 3a20 626f 6f6c      :rtype: bool
-00004df0: 0a20 2020 2022 2222 0a20 2020 2074 6572  .    """.    ter
-00004e00: 6d69 6e61 6c5f 7769 6474 682c 205f 203d  minal_width, _ =
-00004e10: 2074 6572 6d69 6e61 6c5f 7369 7a65 2866   terminal_size(f
-00004e20: 696c 653d 6669 6c65 290a 2020 2020 7265  ile=file).    re
-00004e30: 7475 726e 2074 6572 6d69 6e61 6c5f 7769  turn terminal_wi
-00004e40: 6474 6820 3e20 300a 0a0a 6465 6620 636f  dth > 0...def co
-00004e50: 6e66 6972 6d28 7478 742c 2065 7869 745f  nfirm(txt, exit_
-00004e60: 6f6e 5f66 616c 7365 3d46 616c 7365 293a  on_false=False):
-00004e70: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
-00004e80: 7261 6d20 7374 7220 7478 743a 2065 2e67  ram str txt: e.g
-00004e90: 2e20 2244 656c 6574 6520 6576 6572 7974  . "Delete everyt
-00004ea0: 6869 6e67 3f22 0a20 2020 203a 7061 7261  hing?".    :para
-00004eb0: 6d20 626f 6f6c 2065 7869 745f 6f6e 5f66  m bool exit_on_f
-00004ec0: 616c 7365 3a20 6966 2054 7275 652c 2077  alse: if True, w
-00004ed0: 696c 6c20 6361 6c6c 2073 7973 2e65 7869  ill call sys.exi
-00004ee0: 7428 3129 2069 6620 6e6f 7420 636f 6e66  t(1) if not conf
-00004ef0: 6972 6d65 640a 2020 2020 3a72 7479 7065  irmed.    :rtype
-00004f00: 3a20 626f 6f6c 0a20 2020 2022 2222 0a20  : bool.    """. 
-00004f10: 2020 2077 6869 6c65 2054 7275 653a 0a20     while True:. 
-00004f20: 2020 2020 2020 2072 203d 2069 6e70 7574         r = input
-00004f30: 2822 2573 2043 6f6e 6669 726d 3f20 5b79  ("%s Confirm? [y
-00004f40: 6573 2f6e 6f5d 2220 2520 7478 7429 0a20  es/no]" % txt). 
-00004f50: 2020 2020 2020 2069 6620 6e6f 7420 723a         if not r:
-00004f60: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00004f70: 7469 6e75 650a 2020 2020 2020 2020 6966  tinue.        if
-00004f80: 2072 2069 6e20 5b22 7922 2c20 2279 6573   r in ["y", "yes
-00004f90: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-00004fa0: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
-00004fb0: 2020 2020 6966 2072 2069 6e20 5b22 6e22      if r in ["n"
-00004fc0: 2c20 226e 6f22 5d3a 0a20 2020 2020 2020  , "no"]:.       
-00004fd0: 2020 2020 2069 6620 6578 6974 5f6f 6e5f       if exit_on_
-00004fe0: 6661 6c73 653a 0a20 2020 2020 2020 2020  false:.         
-00004ff0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-00005000: 3129 0a20 2020 2020 2020 2020 2020 2072  1).            r
-00005010: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00005020: 2020 2020 7072 696e 7428 2249 6e76 616c      print("Inval
-00005030: 6964 2072 6573 706f 6e73 6520 2572 2e22  id response %r."
-00005040: 2025 2072 290a 0a0a 6465 6620 686d 7328   % r)...def hms(
-00005050: 7329 3a0a 2020 2020 2222 220a 2020 2020  s):.    """.    
-00005060: 3a70 6172 616d 2066 6c6f 6174 7c69 6e74  :param float|int
-00005070: 2073 3a20 7365 636f 6e64 730a 2020 2020   s: seconds.    
-00005080: 3a72 6574 7572 6e3a 2065 2e67 2e20 2231  :return: e.g. "1
-00005090: 3a32 333a 3435 2220 2868 733a 6d73 3a73  :23:45" (hs:ms:s
-000050a0: 6563 7329 2e20 7365 6520 686d 735f 6672  ecs). see hms_fr
-000050b0: 6163 7469 6f6e 2069 6620 796f 7520 7761  action if you wa
-000050c0: 6e74 2074 6f20 6765 7420 6672 6163 7469  nt to get fracti
-000050d0: 6f6e 616c 2073 6563 6f6e 6473 0a20 2020  onal seconds.   
-000050e0: 203a 7274 7970 653a 2073 7472 0a20 2020   :rtype: str.   
-000050f0: 2022 2222 0a20 2020 206d 2c20 7320 3d20   """.    m, s = 
-00005100: 6469 766d 6f64 2873 2c20 3630 290a 2020  divmod(s, 60).  
-00005110: 2020 682c 206d 203d 2064 6976 6d6f 6428    h, m = divmod(
-00005120: 6d2c 2036 3029 0a20 2020 2072 6574 7572  m, 60).    retur
-00005130: 6e20 2225 643a 2530 3264 3a25 3032 6422  n "%d:%02d:%02d"
-00005140: 2025 2028 682c 206d 2c20 7329 0a0a 0a64   % (h, m, s)...d
-00005150: 6566 2068 6d73 5f66 7261 6374 696f 6e28  ef hms_fraction(
-00005160: 732c 2064 6563 696d 616c 733d 3429 3a0a  s, decimals=4):.
-00005170: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
-00005180: 616d 2066 6c6f 6174 2073 3a20 7365 636f  am float s: seco
-00005190: 6e64 730a 2020 2020 3a70 6172 616d 2069  nds.    :param i
-000051a0: 6e74 2064 6563 696d 616c 733a 2068 6f77  nt decimals: how
-000051b0: 206d 7563 6820 6465 6369 6d61 6c73 2074   much decimals t
-000051c0: 6f20 7072 696e 740a 2020 2020 3a72 6574  o print.    :ret
-000051d0: 7572 6e3a 2065 2e67 2e20 2231 3a32 333a  urn: e.g. "1:23:
-000051e0: 3435 2e36 3738 3922 2028 6873 3a6d 733a  45.6789" (hs:ms:
-000051f0: 7365 6373 290a 2020 2020 3a72 7479 7065  secs).    :rtype
-00005200: 3a20 7374 720a 2020 2020 2222 220a 2020  : str.    """.  
-00005210: 2020 7265 7475 726e 2068 6d73 2869 6e74    return hms(int
-00005220: 2873 2929 202b 2028 2822 2525 2e30 2569  (s)) + (("%%.0%i
-00005230: 6622 2025 2064 6563 696d 616c 7329 2025  f" % decimals) %
-00005240: 2028 7320 2d20 696e 7428 7329 2929 5b31   (s - int(s)))[1
-00005250: 3a5d 0a0a 0a64 6566 2068 756d 616e 5f73  :]...def human_s
-00005260: 697a 6528 6e2c 2066 6163 746f 723d 3130  ize(n, factor=10
-00005270: 3030 2c20 6672 6163 3d30 2e38 2c20 7072  00, frac=0.8, pr
-00005280: 6563 3d31 293a 0a20 2020 2022 2222 0a20  ec=1):.    """. 
-00005290: 2020 203a 7061 7261 6d20 696e 747c 666c     :param int|fl
-000052a0: 6f61 7420 6e3a 0a20 2020 203a 7061 7261  oat n:.    :para
-000052b0: 6d20 696e 7420 6661 6374 6f72 3a20 666f  m int factor: fo
-000052c0: 7220 6561 6368 206f 6620 7468 6520 756e  r each of the un
-000052d0: 6974 7320 4b2c 204d 2c20 472c 2054 0a20  its K, M, G, T. 
-000052e0: 2020 203a 7061 7261 6d20 666c 6f61 7420     :param float 
-000052f0: 6672 6163 3a20 7768 656e 2074 6f20 676f  frac: when to go
-00005300: 206f 7665 7220 746f 2074 6865 206e 6578   over to the nex
-00005310: 7420 6269 6767 6572 2075 6e69 740a 2020  t bigger unit.  
-00005320: 2020 3a70 6172 616d 2069 6e74 2070 7265    :param int pre
-00005330: 633a 2068 6f77 206d 7563 6820 6465 6369  c: how much deci
-00005340: 6d61 6c73 2061 6674 6572 2074 6865 2064  mals after the d
-00005350: 6f74 0a20 2020 203a 7265 7475 726e 3a20  ot.    :return: 
-00005360: 6875 6d61 6e20 7265 6164 6162 6c65 2073  human readable s
-00005370: 697a 652c 2075 7369 6e67 204b 2c20 4d2c  ize, using K, M,
-00005380: 2047 2c20 540a 2020 2020 3a72 7479 7065   G, T.    :rtype
-00005390: 3a20 7374 720a 2020 2020 2222 220a 2020  : str.    """.  
-000053a0: 2020 706f 7374 6669 7865 7320 3d20 5b22    postfixes = ["
-000053b0: 222c 2022 4b22 2c20 224d 222c 2022 4722  ", "K", "M", "G"
-000053c0: 2c20 2254 225d 0a20 2020 2069 203d 2030  , "T"].    i = 0
-000053d0: 0a20 2020 2077 6869 6c65 2069 203c 206c  .    while i < l
-000053e0: 656e 2870 6f73 7466 6978 6573 2920 2d20  en(postfixes) - 
-000053f0: 3120 616e 6420 6e20 3e20 2866 6163 746f  1 and n > (facto
-00005400: 7220 2a2a 2028 6920 2b20 3129 2920 2a20  r ** (i + 1)) * 
-00005410: 6672 6163 3a0a 2020 2020 2020 2020 6920  frac:.        i 
-00005420: 2b3d 2031 0a20 2020 2069 6620 6920 3d3d  += 1.    if i ==
-00005430: 2030 3a0a 2020 2020 2020 2020 7265 7475   0:.        retu
-00005440: 726e 2073 7472 286e 290a 2020 2020 7265  rn str(n).    re
-00005450: 7475 726e 2028 2225 2e22 202b 2073 7472  turn ("%." + str
-00005460: 2870 7265 6329 202b 2022 6622 2920 2520  (prec) + "f") % 
-00005470: 2866 6c6f 6174 286e 2920 2f20 2866 6163  (float(n) / (fac
-00005480: 746f 722a 2a69 2929 202b 2070 6f73 7466  tor**i)) + postf
-00005490: 6978 6573 5b69 5d0a 0a0a 6465 6620 6875  ixes[i]...def hu
-000054a0: 6d61 6e5f 6279 7465 735f 7369 7a65 286e  man_bytes_size(n
-000054b0: 2c20 6661 6374 6f72 3d31 3032 342c 2066  , factor=1024, f
-000054c0: 7261 633d 302e 382c 2070 7265 633d 3129  rac=0.8, prec=1)
-000054d0: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
-000054e0: 6172 616d 2069 6e74 7c66 6c6f 6174 206e  aram int|float n
-000054f0: 3a0a 2020 2020 3a70 6172 616d 2069 6e74  :.    :param int
-00005500: 2066 6163 746f 723a 2073 6565 203a 6675   factor: see :fu
-00005510: 6e63 3a60 6875 6d61 6e5f 7369 7a65 602e  nc:`human_size`.
-00005520: 2031 3032 3420 6279 2064 6566 6175 6c74   1024 by default
-00005530: 2066 6f72 2062 7974 6573 0a20 2020 203a   for bytes.    :
-00005540: 7061 7261 6d20 666c 6f61 7420 6672 6163  param float frac
-00005550: 3a20 7365 6520 3a66 756e 633a 6068 756d  : see :func:`hum
-00005560: 616e 5f73 697a 6560 0a20 2020 203a 7061  an_size`.    :pa
-00005570: 7261 6d20 696e 7420 7072 6563 3a20 686f  ram int prec: ho
-00005580: 7720 6d75 6368 2064 6563 696d 616c 7320  w much decimals 
-00005590: 6166 7465 7220 7468 6520 646f 740a 2020  after the dot.  
-000055a0: 2020 3a72 6574 7572 6e3a 2068 756d 616e    :return: human
-000055b0: 2072 6561 6461 626c 6520 6279 7465 2073   readable byte s
-000055c0: 697a 652c 2075 7369 6e67 204b 2c20 4d2c  ize, using K, M,
-000055d0: 2047 2c20 542c 2077 6974 6820 2242 2220   G, T, with "B" 
-000055e0: 6174 2074 6865 2065 6e64 0a20 2020 203a  at the end.    :
-000055f0: 7274 7970 653a 2073 7472 0a20 2020 2022  rtype: str.    "
-00005600: 2222 0a20 2020 2072 6574 7572 6e20 6875  "".    return hu
-00005610: 6d61 6e5f 7369 7a65 286e 2c20 6661 6374  man_size(n, fact
-00005620: 6f72 3d66 6163 746f 722c 2066 7261 633d  or=factor, frac=
-00005630: 6672 6163 2c20 7072 6563 3d70 7265 6329  frac, prec=prec)
-00005640: 202b 2022 4222 0a0a 0a64 6566 205f 7070   + "B"...def _pp
-00005650: 5f65 7874 7261 5f69 6e66 6f28 6f62 6a2c  _extra_info(obj,
-00005660: 2064 6570 7468 5f6c 696d 6974 3d33 293a   depth_limit=3):
-00005670: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
-00005680: 7261 6d20 6f62 6a65 6374 206f 626a 3a0a  ram object obj:.
-00005690: 2020 2020 3a70 6172 616d 2069 6e74 2064      :param int d
-000056a0: 6570 7468 5f6c 696d 6974 3a0a 2020 2020  epth_limit:.    
-000056b0: 3a72 6574 7572 6e3a 2065 7874 7261 2069  :return: extra i
-000056c0: 6e66 6f20 2869 6620 6176 6169 6c61 626c  nfo (if availabl
-000056d0: 653a 206c 656e 2c20 736f 6d65 2069 7465  e: len, some ite
-000056e0: 6d73 2c20 2e2e 2e29 0a20 2020 203a 7274  ms, ...).    :rt
-000056f0: 7970 653a 2073 7472 0a20 2020 2022 2222  ype: str.    """
-00005700: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-00005710: 6365 286f 626a 2c20 6e70 2e6e 6461 7272  ce(obj, np.ndarr
-00005720: 6179 293a 0a20 2020 2020 2020 2072 6574  ay):.        ret
-00005730: 7572 6e20 2273 6861 7065 3d25 7222 2025  urn "shape=%r" %
-00005740: 2028 6f62 6a2e 7368 6170 652c 290a 2020   (obj.shape,).  
-00005750: 2020 7320 3d20 5b5d 0a20 2020 2069 6620    s = [].    if 
-00005760: 6861 7361 7474 7228 6f62 6a2c 2022 5f5f  hasattr(obj, "__
-00005770: 6c65 6e5f 5f22 293a 0a20 2020 2020 2020  len__"):.       
-00005780: 2023 206e 6f69 6e73 7065 6374 696f 6e20   # noinspection 
-00005790: 5079 4272 6f61 6445 7863 6570 7469 6f6e  PyBroadException
-000057a0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-000057b0: 2020 2020 2020 2020 2020 2320 6e6f 696e            # noin
-000057c0: 7370 6563 7469 6f6e 2050 7954 7970 6543  spection PyTypeC
-000057d0: 6865 636b 6572 0a20 2020 2020 2020 2020  hecker.         
-000057e0: 2020 2069 6620 7479 7065 286f 626a 2920     if type(obj) 
-000057f0: 696e 2028 7374 722c 2075 6e69 636f 6465  in (str, unicode
-00005800: 2c20 6c69 7374 2c20 7475 706c 652c 2064  , list, tuple, d
-00005810: 6963 7429 2061 6e64 206c 656e 286f 626a  ict) and len(obj
-00005820: 2920 3c3d 2035 3a0a 2020 2020 2020 2020  ) <= 5:.        
-00005830: 2020 2020 2020 2020 7061 7373 2020 2320          pass  # 
-00005840: 646f 6e27 7420 7072 696e 7420 6c65 6e20  don't print len 
-00005850: 696e 2074 6869 7320 6361 7365 0a20 2020  in this case.   
-00005860: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00005870: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00005880: 202b 3d20 5b22 6c65 6e20 3d20 2569 2220   += ["len = %i" 
-00005890: 2520 6f62 6a2e 5f5f 6c65 6e5f 5f28 295d  % obj.__len__()]
-000058a0: 2020 2320 6e6f 7161 0a20 2020 2020 2020    # noqa.       
-000058b0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-000058c0: 6e3a 0a20 2020 2020 2020 2020 2020 2070  n:.            p
-000058d0: 6173 730a 2020 2020 6966 2064 6570 7468  ass.    if depth
-000058e0: 5f6c 696d 6974 203e 2030 2061 6e64 2068  _limit > 0 and h
-000058f0: 6173 6174 7472 286f 626a 2c20 225f 5f67  asattr(obj, "__g
-00005900: 6574 6974 656d 5f5f 2229 3a0a 2020 2020  etitem__"):.    
-00005910: 2020 2020 2320 6e6f 696e 7370 6563 7469      # noinspecti
-00005920: 6f6e 2050 7942 726f 6164 4578 6365 7074  on PyBroadExcept
-00005930: 696f 6e0a 2020 2020 2020 2020 7472 793a  ion.        try:
-00005940: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00005950: 7479 7065 286f 626a 2920 696e 2028 7374  type(obj) in (st
-00005960: 722c 2075 6e69 636f 6465 293a 0a20 2020  r, unicode):.   
-00005970: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00005980: 7320 2023 2064 6f65 736e 2774 206d 616b  s  # doesn't mak
-00005990: 6520 7365 6e73 6520 746f 2067 6574 2073  e sense to get s
-000059a0: 7562 2069 7465 6d73 2068 6572 650a 2020  ub items here.  
-000059b0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000059c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059d0: 7375 625f 6f62 6a20 3d20 6f62 6a2e 5f5f  sub_obj = obj.__
-000059e0: 6765 7469 7465 6d5f 5f28 3029 2020 2320  getitem__(0)  # 
-000059f0: 6e6f 7161 0a20 2020 2020 2020 2020 2020  noqa.           
-00005a00: 2020 2020 2065 7874 7261 5f69 6e66 6f20       extra_info 
-00005a10: 3d20 5f70 705f 6578 7472 615f 696e 666f  = _pp_extra_info
-00005a20: 2873 7562 5f6f 626a 2c20 6465 7074 685f  (sub_obj, depth_
-00005a30: 6c69 6d69 7420 2d20 3129 0a20 2020 2020  limit - 1).     
-00005a40: 2020 2020 2020 2020 2020 2069 6620 6578             if ex
-00005a50: 7472 615f 696e 666f 2021 3d20 2222 3a0a  tra_info != "":.
-00005a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a70: 2020 2020 7320 2b3d 205b 225f 5b30 5d3a      s += ["_[0]:
-00005a80: 207b 2573 7d22 2025 2065 7874 7261 5f69   {%s}" % extra_i
-00005a90: 6e66 6f5d 0a20 2020 2020 2020 2065 7863  nfo].        exc
-00005aa0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-00005ab0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00005ac0: 2020 2020 7265 7475 726e 2022 2c20 222e      return ", ".
-00005ad0: 6a6f 696e 2873 290a 0a0a 5f70 7265 7474  join(s)..._prett
-00005ae0: 795f 7072 696e 745f 6c69 6d69 7420 3d20  y_print_limit = 
-00005af0: 3330 300a 5f70 7265 7474 795f 7072 696e  300._pretty_prin
-00005b00: 745f 6173 5f62 7974 6573 203d 2046 616c  t_as_bytes = Fal
-00005b10: 7365 0a0a 0a64 6566 2073 6574 5f70 7265  se...def set_pre
-00005b20: 7474 795f 7072 696e 745f 6465 6661 756c  tty_print_defaul
-00005b30: 745f 6c69 6d69 7428 6c69 6d69 7429 3a0a  t_limit(limit):.
-00005b40: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
-00005b50: 616d 2069 6e74 7c66 6c6f 6174 206c 696d  am int|float lim
-00005b60: 6974 3a20 7573 6520 666c 6f61 7428 2269  it: use float("i
-00005b70: 6e66 2229 2074 6f20 6469 7361 626c 650a  nf") to disable.
-00005b80: 2020 2020 2222 220a 2020 2020 676c 6f62      """.    glob
-00005b90: 616c 205f 7072 6574 7479 5f70 7269 6e74  al _pretty_print
-00005ba0: 5f6c 696d 6974 0a20 2020 205f 7072 6574  _limit.    _pret
-00005bb0: 7479 5f70 7269 6e74 5f6c 696d 6974 203d  ty_print_limit =
-00005bc0: 206c 696d 6974 0a0a 0a64 6566 2073 6574   limit...def set
-00005bd0: 5f70 7265 7474 795f 7072 696e 745f 6173  _pretty_print_as
-00005be0: 5f62 7974 6573 2861 735f 6279 7465 7329  _bytes(as_bytes)
-00005bf0: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
-00005c00: 6172 616d 2062 6f6f 6c20 6173 5f62 7974  aram bool as_byt
-00005c10: 6573 3a0a 2020 2020 2222 220a 2020 2020  es:.    """.    
-00005c20: 676c 6f62 616c 205f 7072 6574 7479 5f70  global _pretty_p
-00005c30: 7269 6e74 5f61 735f 6279 7465 730a 2020  rint_as_bytes.  
-00005c40: 2020 5f70 7265 7474 795f 7072 696e 745f    _pretty_print_
-00005c50: 6173 5f62 7974 6573 203d 2061 735f 6279  as_bytes = as_by
-00005c60: 7465 730a 0a0a 6465 6620 7072 6574 7479  tes...def pretty
-00005c70: 5f70 7269 6e74 286f 626a 2c20 6c69 6d69  _print(obj, limi
-00005c80: 743d 4e6f 6e65 293a 0a20 2020 2022 2222  t=None):.    """
-00005c90: 0a20 2020 203a 7061 7261 6d20 6f62 6a65  .    :param obje
-00005ca0: 6374 206f 626a 3a0a 2020 2020 3a70 6172  ct obj:.    :par
-00005cb0: 616d 2069 6e74 7c66 6c6f 6174 206c 696d  am int|float lim
-00005cc0: 6974 3a20 7573 6520 666c 6f61 7428 2269  it: use float("i
-00005cd0: 6e66 2229 2074 6f20 6469 7361 626c 652e  nf") to disable.
-00005ce0: 204e 6f6e 6520 7769 6c6c 2075 7365 2074   None will use t
-00005cf0: 6865 2064 6566 6175 6c74 2c20 7669 6120  he default, via 
-00005d00: 7365 745f 7072 6574 7479 5f70 7269 6e74  set_pretty_print
-00005d10: 5f64 6566 6175 6c74 5f6c 696d 6974 0a20  _default_limit. 
-00005d20: 2020 203a 7265 7475 726e 3a20 7265 7072     :return: repr
-00005d30: 286f 626a 292c 206f 7220 736f 6d65 2073  (obj), or some s
-00005d40: 686f 7274 6564 2076 6572 7369 6f6e 206f  horted version o
-00005d50: 6620 7468 6174 2c20 6d61 7962 6520 7769  f that, maybe wi
-00005d60: 7468 2065 7874 7261 2069 6e66 6f0a 2020  th extra info.  
-00005d70: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
-00005d80: 2020 2222 220a 2020 2020 6966 205f 7072    """.    if _pr
-00005d90: 6574 7479 5f70 7269 6e74 5f61 735f 6279  etty_print_as_by
-00005da0: 7465 7320 616e 6420 6973 696e 7374 616e  tes and isinstan
-00005db0: 6365 286f 626a 2c20 6e70 2e6e 6461 7272  ce(obj, np.ndarr
-00005dc0: 6179 293a 0a20 2020 2020 2020 2062 7320  ay):.        bs 
-00005dd0: 3d20 6f62 6a2e 746f 6279 7465 7328 290a  = obj.tobytes().
-00005de0: 2020 2020 2020 2020 696d 706f 7274 2067          import g
-00005df0: 7a69 700a 0a20 2020 2020 2020 2062 7320  zip..        bs 
-00005e00: 3d20 677a 6970 2e63 6f6d 7072 6573 7328  = gzip.compress(
-00005e10: 6273 290a 2020 2020 2020 2020 696d 706f  bs).        impo
-00005e20: 7274 2062 6173 6536 340a 0a20 2020 2020  rt base64..     
-00005e30: 2020 2069 6620 6c65 6e28 6273 2920 3e20     if len(bs) > 
-00005e40: 3537 3a0a 2020 2020 2020 2020 2020 2020  57:.            
-00005e50: 7061 7274 7320 3d20 5b5d 0a20 2020 2020  parts = [].     
-00005e60: 2020 2020 2020 2077 6869 6c65 206c 656e         while len
-00005e70: 2862 7329 203e 2030 3a0a 2020 2020 2020  (bs) > 0:.      
-00005e80: 2020 2020 2020 2020 2020 7061 7274 732e            parts.
-00005e90: 6170 7065 6e64 2862 735b 3a35 375d 290a  append(bs[:57]).
-00005ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005eb0: 6273 203d 2062 735b 3537 3a5d 0a20 2020  bs = bs[57:].   
-00005ec0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00005ed0: 6c65 6e28 6273 2920 3d3d 2030 3a0a 2020  len(bs) == 0:.  
-00005ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ef0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-00005f00: 2020 2020 7320 3d20 225c 6e20 2022 202b      s = "\n  " +
-00005f10: 2022 5c6e 2020 222e 6a6f 696e 285b 7265   "\n  ".join([re
-00005f20: 7072 2862 6173 6536 342e 656e 636f 6465  pr(base64.encode
-00005f30: 6279 7465 7328 6273 292e 7374 7269 7028  bytes(bs).strip(
-00005f40: 2929 2066 6f72 2062 7320 696e 2070 6172  )) for bs in par
-00005f50: 7473 5d29 202b 2022 5c6e 2020 220a 2020  ts]) + "\n  ".  
-00005f60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00005f70: 2020 2020 2020 2020 7320 3d20 7265 7072          s = repr
-00005f80: 2862 6173 6536 342e 656e 636f 6465 6279  (base64.encodeby
-00005f90: 7465 7328 6273 292e 7374 7269 7028 2929  tes(bs).strip())
-00005fa0: 0a20 2020 2020 2020 2073 203d 2022 6e75  .        s = "nu
-00005fb0: 6d70 792e 6672 6f6d 6275 6666 6572 2867  mpy.frombuffer(g
-00005fc0: 7a69 702e 6465 636f 6d70 7265 7373 2862  zip.decompress(b
-00005fd0: 6173 6536 342e 6465 636f 6465 6279 7465  ase64.decodebyte
-00005fe0: 7328 2573 2929 2c20 6474 7970 653d 2572  s(%s)), dtype=%r
-00005ff0: 292e 7265 7368 6170 6528 2572 2922 2025  ).reshape(%r)" %
-00006000: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
-00006010: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
-00006020: 7228 6f62 6a2e 6474 7970 6529 2c0a 2020  r(obj.dtype),.  
-00006030: 2020 2020 2020 2020 2020 6f62 6a2e 7368            obj.sh
-00006040: 6170 652c 0a20 2020 2020 2020 2029 0a20  ape,.        ). 
-00006050: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00006060: 2073 203d 2072 6570 7228 6f62 6a29 0a20   s = repr(obj). 
-00006070: 2020 2069 6620 6c69 6d69 7420 6973 204e     if limit is N
-00006080: 6f6e 653a 0a20 2020 2020 2020 206c 696d  one:.        lim
-00006090: 6974 203d 205f 7072 6574 7479 5f70 7269  it = _pretty_pri
-000060a0: 6e74 5f6c 696d 6974 0a20 2020 2069 6620  nt_limit.    if 
-000060b0: 6c65 6e28 7329 203e 206c 696d 6974 3a0a  len(s) > limit:.
-000060c0: 2020 2020 2020 2020 7320 3d20 735b 3a20          s = s[: 
-000060d0: 696e 7428 6c69 6d69 7429 202d 2033 5d0a  int(limit) - 3].
-000060e0: 2020 2020 2020 2020 7320 2b3d 2022 2e2e          s += "..
-000060f0: 2e22 0a20 2020 2065 7874 7261 5f69 6e66  .".    extra_inf
-00006100: 6f20 3d20 5f70 705f 6578 7472 615f 696e  o = _pp_extra_in
-00006110: 666f 286f 626a 290a 2020 2020 6966 2065  fo(obj).    if e
-00006120: 7874 7261 5f69 6e66 6f20 213d 2022 223a  xtra_info != "":
-00006130: 0a20 2020 2020 2020 2073 202b 3d20 222c  .        s += ",
-00006140: 2022 202b 2065 7874 7261 5f69 6e66 6f0a   " + extra_info.
-00006150: 2020 2020 7265 7475 726e 2073 0a0a 0a64      return s...d
-00006160: 6566 2070 726f 6772 6573 735f 6261 7228  ef progress_bar(
-00006170: 636f 6d70 6c65 7465 3d31 2e30 2c20 7072  complete=1.0, pr
-00006180: 6566 6978 3d22 222c 2073 7566 6669 783d  efix="", suffix=
-00006190: 2222 2c20 6669 6c65 3d4e 6f6e 6529 3a0a  "", file=None):.
-000061a0: 2020 2020 2222 220a 2020 2020 5072 696e      """.    Prin
-000061b0: 7473 2073 6f6d 6520 7072 6f67 7265 7373  ts some progress
-000061c0: 2062 6172 2e0a 0a20 2020 203a 7061 7261   bar...    :para
-000061d0: 6d20 666c 6f61 7420 636f 6d70 6c65 7465  m float complete
-000061e0: 3a20 6672 6f6d 2030 2e30 2074 6f20 312e  : from 0.0 to 1.
-000061f0: 300a 2020 2020 3a70 6172 616d 2073 7472  0.    :param str
-00006200: 2070 7265 6669 783a 0a20 2020 203a 7061   prefix:.    :pa
-00006210: 7261 6d20 7374 7220 7375 6666 6978 3a0a  ram str suffix:.
-00006220: 2020 2020 3a70 6172 616d 2069 6f2e 5465      :param io.Te
-00006230: 7874 494f 5772 6170 7065 727c 7479 7069  xtIOWrapper|typi
-00006240: 6e67 2e54 6578 7449 4f7c 4e6f 6e65 2066  ng.TextIO|None f
-00006250: 696c 653a 2077 6865 7265 2074 6f20 7072  ile: where to pr
-00006260: 696e 742e 2073 7464 6f75 7420 6279 2064  int. stdout by d
-00006270: 6566 6175 6c74 0a20 2020 203a 7265 7475  efault.    :retu
-00006280: 726e 3a20 6e6f 7468 696e 672c 2077 696c  rn: nothing, wil
-00006290: 6c20 7072 696e 7420 6f6e 2060 6066 696c  l print on ``fil
-000062a0: 6560 600a 2020 2020 2222 220a 2020 2020  e``.    """.    
-000062b0: 6966 2066 696c 6520 6973 204e 6f6e 653a  if file is None:
-000062c0: 0a20 2020 2020 2020 2066 696c 6520 3d20  .        file = 
-000062d0: 7379 732e 7374 646f 7574 0a20 2020 2074  sys.stdout.    t
-000062e0: 6572 6d69 6e61 6c5f 7769 6474 682c 205f  erminal_width, _
-000062f0: 203d 2074 6572 6d69 6e61 6c5f 7369 7a65   = terminal_size
-00006300: 2866 696c 653d 6669 6c65 290a 2020 2020  (file=file).    
-00006310: 6966 2074 6572 6d69 6e61 6c5f 7769 6474  if terminal_widt
-00006320: 6820 3c3d 2030 3a0a 2020 2020 2020 2020  h <= 0:.        
-00006330: 7265 7475 726e 0a20 2020 2069 6620 636f  return.    if co
-00006340: 6d70 6c65 7465 203d 3d20 312e 303a 0a20  mplete == 1.0:. 
-00006350: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
-00006360: 6528 225c 7225 7322 2025 2028 7465 726d  e("\r%s" % (term
-00006370: 696e 616c 5f77 6964 7468 202a 2022 2022  inal_width * " "
-00006380: 2929 0a20 2020 2020 2020 2066 696c 652e  )).        file.
-00006390: 666c 7573 6828 290a 2020 2020 2020 2020  flush().        
-000063a0: 6669 6c65 2e77 7269 7465 2822 5c72 2229  file.write("\r")
-000063b0: 0a20 2020 2020 2020 2066 696c 652e 666c  .        file.fl
-000063c0: 7573 6828 290a 2020 2020 2020 2020 7265  ush().        re
-000063d0: 7475 726e 0a20 2020 2070 726f 6772 6573  turn.    progres
-000063e0: 7320 3d20 2225 2e30 3266 2525 2220 2520  s = "%.02f%%" % 
-000063f0: 2863 6f6d 706c 6574 6520 2a20 3130 3029  (complete * 100)
-00006400: 0a20 2020 2069 6620 7072 6566 6978 2021  .    if prefix !
-00006410: 3d20 2222 3a0a 2020 2020 2020 2020 7072  = "":.        pr
-00006420: 6566 6978 203d 2070 7265 6669 7820 2b20  efix = prefix + 
-00006430: 2220 220a 2020 2020 6966 2073 7566 6669  " ".    if suffi
-00006440: 7820 213d 2022 223a 0a20 2020 2020 2020  x != "":.       
-00006450: 2073 7566 6669 7820 3d20 2220 2220 2b20   suffix = " " + 
-00006460: 7375 6666 6978 0a20 2020 206e 746f 7461  suffix.    ntota
-00006470: 6c20 3d20 7465 726d 696e 616c 5f77 6964  l = terminal_wid
-00006480: 7468 202d 206c 656e 2870 726f 6772 6573  th - len(progres
-00006490: 7329 202d 206c 656e 2870 7265 6669 7829  s) - len(prefix)
-000064a0: 202d 206c 656e 2873 7566 6669 7829 202d   - len(suffix) -
-000064b0: 2034 0a20 2020 2062 6172 7320 3d20 227c   4.    bars = "|
-000064c0: 2220 2a20 696e 7428 636f 6d70 6c65 7465  " * int(complete
-000064d0: 202a 206e 746f 7461 6c29 0a20 2020 2073   * ntotal).    s
-000064e0: 7061 6365 7320 3d20 2220 2220 2a20 286e  paces = " " * (n
-000064f0: 746f 7461 6c20 2d20 696e 7428 636f 6d70  total - int(comp
-00006500: 6c65 7465 202a 206e 746f 7461 6c29 290a  lete * ntotal)).
-00006510: 2020 2020 6261 7220 3d20 6261 7273 202b      bar = bars +
-00006520: 2073 7061 6365 730a 2020 2020 6669 6c65   spaces.    file
-00006530: 2e77 7269 7465 280a 2020 2020 2020 2020  .write(.        
-00006540: 225c 7225 7322 2025 2070 7265 6669 7820  "\r%s" % prefix 
-00006550: 2b20 225b 2220 2b20 6261 725b 3a20 6c65  + "[" + bar[: le
-00006560: 6e28 6261 7229 202f 2f20 325d 202b 2022  n(bar) // 2] + "
-00006570: 2022 202b 2070 726f 6772 6573 7320 2b20   " + progress + 
-00006580: 2220 2220 2b20 6261 725b 6c65 6e28 6261  " " + bar[len(ba
-00006590: 7229 202f 2f20 3220 3a5d 202b 2022 5d22  r) // 2 :] + "]"
-000065a0: 202b 2073 7566 6669 780a 2020 2020 290a   + suffix.    ).
-000065b0: 2020 2020 6669 6c65 2e66 6c75 7368 2829      file.flush()
-000065c0: 0a0a 0a63 6c61 7373 205f 5072 6f67 7265  ...class _Progre
-000065d0: 7373 4261 7257 6974 6854 696d 6553 7461  ssBarWithTimeSta
-000065e0: 7473 3a0a 2020 2020 2222 220a 2020 2020  ts:.    """.    
-000065f0: 476c 6f62 616c 2063 6c6f 7375 7265 2e20  Global closure. 
-00006600: 5573 6564 2062 7920 3a66 756e 633a 6070  Used by :func:`p
-00006610: 726f 6772 6573 735f 6261 725f 7769 7468  rogress_bar_with
-00006620: 5f74 696d 6560 2e0a 2020 2020 2222 220a  _time`..    """.
-00006630: 0a20 2020 2073 7461 7274 5f74 696d 6520  .    start_time 
-00006640: 3d20 4e6f 6e65 0a20 2020 206c 6173 745f  = None.    last_
-00006650: 636f 6d70 6c65 7465 203d 204e 6f6e 650a  complete = None.
-00006660: 0a0a 6465 6620 7072 6f67 7265 7373 5f62  ..def progress_b
-00006670: 6172 5f77 6974 685f 7469 6d65 2863 6f6d  ar_with_time(com
-00006680: 706c 6574 653d 312e 302c 2070 7265 6669  plete=1.0, prefi
-00006690: 783d 2222 2c20 2a2a 6b77 6172 6773 293a  x="", **kwargs):
-000066a0: 0a20 2020 2022 2222 0a20 2020 203a 6675  .    """.    :fu
-000066b0: 6e63 3a60 7072 6f67 7265 7373 5f62 6172  nc:`progress_bar
-000066c0: 6020 7769 7468 2061 6464 6974 696f 6e61  ` with additiona
-000066d0: 6c20 7265 6d61 696e 696e 6720 7469 6d65  l remaining time
-000066e0: 2065 7374 696d 6174 696f 6e2e 0a0a 2020   estimation...  
-000066f0: 2020 3a70 6172 616d 2066 6c6f 6174 2063    :param float c
-00006700: 6f6d 706c 6574 653a 0a20 2020 203a 7061  omplete:.    :pa
-00006710: 7261 6d20 7374 7220 7072 6566 6978 3a0a  ram str prefix:.
-00006720: 2020 2020 3a70 6172 616d 206b 7761 7267      :param kwarg
-00006730: 733a 2070 6173 7365 6420 746f 203a 6675  s: passed to :fu
-00006740: 6e63 3a60 7072 6f67 7265 7373 5f62 6172  nc:`progress_bar
-00006750: 600a 2020 2020 3a72 6574 7572 6e3a 206e  `.    :return: n
-00006760: 6f74 6869 6e67 0a20 2020 2022 2222 0a20  othing.    """. 
-00006770: 2020 2073 7461 7473 203d 205f 5072 6f67     stats = _Prog
-00006780: 7265 7373 4261 7257 6974 6854 696d 6553  ressBarWithTimeS
-00006790: 7461 7473 0a20 2020 2069 6620 7374 6174  tats.    if stat
-000067a0: 732e 7374 6172 745f 7469 6d65 2069 7320  s.start_time is 
-000067b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7374  None:.        st
-000067c0: 6174 732e 7374 6172 745f 7469 6d65 203d  ats.start_time =
-000067d0: 2074 696d 652e 7469 6d65 2829 0a20 2020   time.time().   
-000067e0: 2020 2020 2073 7461 7473 2e6c 6173 745f       stats.last_
-000067f0: 636f 6d70 6c65 7465 203d 2063 6f6d 706c  complete = compl
-00006800: 6574 650a 2020 2020 6966 2073 7461 7473  ete.    if stats
-00006810: 2e6c 6173 745f 636f 6d70 6c65 7465 203e  .last_complete >
-00006820: 2063 6f6d 706c 6574 653a 0a20 2020 2020   complete:.     
-00006830: 2020 2073 7461 7473 2e73 7461 7274 5f74     stats.start_t
-00006840: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
-00006850: 290a 2020 2020 7374 6174 732e 6c61 7374  ).    stats.last
-00006860: 5f63 6f6d 706c 6574 6520 3d20 636f 6d70  _complete = comp
-00006870: 6c65 7465 0a0a 2020 2020 7374 6172 745f  lete..    start_
-00006880: 656c 6170 7365 6420 3d20 7469 6d65 2e74  elapsed = time.t
-00006890: 696d 6528 2920 2d20 7374 6174 732e 7374  ime() - stats.st
-000068a0: 6172 745f 7469 6d65 0a20 2020 2069 6620  art_time.    if 
-000068b0: 636f 6d70 6c65 7465 203e 2030 3a0a 2020  complete > 0:.  
-000068c0: 2020 2020 2020 746f 7461 6c5f 7469 6d65        total_time
-000068d0: 5f65 7374 696d 6174 6564 203d 2073 7461  _estimated = sta
-000068e0: 7274 5f65 6c61 7073 6564 202f 2063 6f6d  rt_elapsed / com
-000068f0: 706c 6574 650a 2020 2020 2020 2020 7265  plete.        re
-00006900: 6d61 696e 696e 675f 6573 7469 6d61 7465  maining_estimate
-00006910: 6420 3d20 746f 7461 6c5f 7469 6d65 5f65  d = total_time_e
-00006920: 7374 696d 6174 6564 202d 2073 7461 7274  stimated - start
-00006930: 5f65 6c61 7073 6564 0a20 2020 2020 2020  _elapsed.       
-00006940: 2069 6620 7072 6566 6978 3a0a 2020 2020   if prefix:.    
-00006950: 2020 2020 2020 2020 7072 6566 6978 202b          prefix +
-00006960: 3d20 222c 2022 202b 2068 6d73 2872 656d  = ", " + hms(rem
-00006970: 6169 6e69 6e67 5f65 7374 696d 6174 6564  aining_estimated
-00006980: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00006990: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-000069a0: 6978 203d 2068 6d73 2872 656d 6169 6e69  ix = hms(remaini
-000069b0: 6e67 5f65 7374 696d 6174 6564 290a 2020  ng_estimated).  
-000069c0: 2020 7072 6f67 7265 7373 5f62 6172 2863    progress_bar(c
-000069d0: 6f6d 706c 6574 652c 2070 7265 6669 783d  omplete, prefix=
-000069e0: 7072 6566 6978 2c20 2a2a 6b77 6172 6773  prefix, **kwargs
-000069f0: 290a 0a0a 6465 6620 6176 6169 6c61 626c  )...def availabl
-00006a00: 655f 7068 7973 6963 616c 5f6d 656d 6f72  e_physical_memor
-00006a10: 795f 696e 5f62 7974 6573 2829 3a0a 2020  y_in_bytes():.  
-00006a20: 2020 2222 220a 2020 2020 3a72 7479 7065    """.    :rtype
-00006a30: 3a20 696e 740a 2020 2020 2222 220a 2020  : int.    """.  
-00006a40: 2020 2320 6e6f 696e 7370 6563 7469 6f6e    # noinspection
-00006a50: 2050 7942 726f 6164 4578 6365 7074 696f   PyBroadExceptio
-00006a60: 6e0a 2020 2020 7472 793a 0a20 2020 2020  n.    try:.     
-00006a70: 2020 206d 656d 5f62 7974 6573 203d 206f     mem_bytes = o
-00006a80: 732e 7379 7363 6f6e 6628 2253 435f 5041  s.sysconf("SC_PA
-00006a90: 4745 5f53 495a 4522 2920 2a20 6f73 2e73  GE_SIZE") * os.s
-00006aa0: 7973 636f 6e66 2822 5343 5f50 4859 535f  ysconf("SC_PHYS_
-00006ab0: 5041 4745 5322 290a 2020 2020 6578 6365  PAGES").    exce
-00006ac0: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-00006ad0: 2020 2020 2020 6d65 6d5f 6279 7465 7320        mem_bytes 
-00006ae0: 3d20 3130 3234 2a2a 3420 2023 206a 7573  = 1024**4  # jus
-00006af0: 7420 736f 6d65 2072 616e 646f 6d20 6e75  t some random nu
-00006b00: 6d62 6572 2c20 3154 420a 2020 2020 7265  mber, 1TB.    re
-00006b10: 7475 726e 206d 656d 5f62 7974 6573 0a0a  turn mem_bytes..
-00006b20: 0a64 6566 2064 6566 6175 6c74 5f63 6163  .def default_cac
-00006b30: 6865 5f73 697a 655f 696e 5f67 6279 7465  he_size_in_gbyte
-00006b40: 7328 6661 6374 6f72 3d30 2e37 293a 0a20  s(factor=0.7):. 
-00006b50: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
-00006b60: 6d20 666c 6f61 747c 696e 7420 6661 6374  m float|int fact
-00006b70: 6f72 3a0a 2020 2020 3a72 7479 7065 3a20  or:.    :rtype: 
-00006b80: 696e 740a 2020 2020 2222 220a 2020 2020  int.    """.    
-00006b90: 6d65 6d5f 6762 7974 6573 203d 2061 7661  mem_gbytes = ava
-00006ba0: 696c 6162 6c65 5f70 6879 7369 6361 6c5f  ilable_physical_
-00006bb0: 6d65 6d6f 7279 5f69 6e5f 6279 7465 7328  memory_in_bytes(
-00006bc0: 2920 2f20 2831 3032 342e 302a 2a33 290a  ) / (1024.0**3).
-00006bd0: 2020 2020 7265 7475 726e 2069 6e74 286d      return int(m
-00006be0: 656d 5f67 6279 7465 7320 2a20 6661 6374  em_gbytes * fact
-00006bf0: 6f72 290a 0a0a 6465 6620 6265 7474 6572  or)...def better
-00006c00: 5f72 6570 7228 6f29 3a0a 2020 2020 2222  _repr(o):.    ""
-00006c10: 220a 2020 2020 5468 6520 6d61 696e 2064  ".    The main d
-00006c20: 6966 6665 7265 6e63 6520 746f 203a 6675  ifference to :fu
-00006c30: 6e63 3a60 7265 7072 603a 2074 6869 7320  nc:`repr`: this 
-00006c40: 6f6e 6520 6973 2064 6574 6572 6d69 6e69  one is determini
-00006c50: 7374 6963 2e0a 2020 2020 5468 6520 6f72  stic..    The or
-00006c60: 6967 2064 6963 742e 5f5f 7265 7072 5f5f  ig dict.__repr__
-00006c70: 2068 6173 2074 6865 206f 7264 6572 2075   has the order u
-00006c80: 6e64 6566 696e 6564 2066 6f72 2064 6963  ndefined for dic
-00006c90: 7420 6f72 2073 6574 2e0a 2020 2020 466f  t or set..    Fo
-00006ca0: 7220 6269 6720 6469 6374 732f 7365 7473  r big dicts/sets
-00006cb0: 2f6c 6973 7473 2c20 6164 6420 222c 2220  /lists, add "," 
-00006cc0: 6174 2074 6865 2065 6e64 2074 6f20 6d61  at the end to ma
-00006cd0: 6b65 2074 6578 7475 616c 2064 6966 6673  ke textual diffs
-00006ce0: 206e 6963 6572 2e0a 0a20 2020 203a 7061   nicer...    :pa
-00006cf0: 7261 6d20 6f62 6a65 6374 206f 3a0a 2020  ram object o:.  
-00006d00: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
-00006d10: 2020 2222 220a 2020 2020 6966 2069 7369    """.    if isi
-00006d20: 6e73 7461 6e63 6528 6f2c 206c 6973 7429  nstance(o, list)
-00006d30: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00006d40: 2022 5b5c 6e25 735d 2220 2520 2222 2e6a   "[\n%s]" % "".j
-00006d50: 6f69 6e28 6d61 7028 6c61 6d62 6461 2076  oin(map(lambda v
-00006d60: 3a20 6265 7474 6572 5f72 6570 7228 7629  : better_repr(v)
-00006d70: 202b 2022 2c5c 6e22 2c20 6f29 290a 2020   + ",\n", o)).  
-00006d80: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00006d90: 6f2c 2064 6571 7565 293a 0a20 2020 2020  o, deque):.     
-00006da0: 2020 2072 6574 7572 6e20 2264 6571 7565     return "deque
-00006db0: 285b 5c6e 2573 5d29 2220 2520 2222 2e6a  ([\n%s])" % "".j
-00006dc0: 6f69 6e28 6d61 7028 6c61 6d62 6461 2076  oin(map(lambda v
-00006dd0: 3a20 6265 7474 6572 5f72 6570 7228 7629  : better_repr(v)
-00006de0: 202b 2022 2c5c 6e22 2c20 6f29 290a 2020   + ",\n", o)).  
-00006df0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00006e00: 6f2c 2074 7570 6c65 293a 0a20 2020 2020  o, tuple):.     
-00006e10: 2020 2069 6620 6c65 6e28 6f29 203d 3d20     if len(o) == 
-00006e20: 313a 0a20 2020 2020 2020 2020 2020 2072  1:.            r
-00006e30: 6574 7572 6e20 2228 2573 2c29 2220 2520  eturn "(%s,)" % 
-00006e40: 6f5b 305d 0a20 2020 2020 2020 2072 6574  o[0].        ret
-00006e50: 7572 6e20 2228 2573 2922 2025 2022 2c20  urn "(%s)" % ", 
-00006e60: 222e 6a6f 696e 286d 6170 2862 6574 7465  ".join(map(bette
-00006e70: 725f 7265 7072 2c20 6f29 290a 2020 2020  r_repr, o)).    
-00006e80: 6966 2069 7369 6e73 7461 6e63 6528 6f2c  if isinstance(o,
-00006e90: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
-00006ea0: 6c73 203d 205b 6265 7474 6572 5f72 6570  ls = [better_rep
-00006eb0: 7228 6b29 202b 2022 3a20 2220 2b20 6265  r(k) + ": " + be
-00006ec0: 7474 6572 5f72 6570 7228 7629 2066 6f72  tter_repr(v) for
-00006ed0: 2028 6b2c 2076 2920 696e 2073 6f72 7465   (k, v) in sorte
-00006ee0: 6428 6f2e 6974 656d 7328 2929 5d0a 2020  d(o.items())].  
-00006ef0: 2020 2020 2020 6966 2073 756d 285b 6c65        if sum([le
-00006f00: 6e28 7629 2066 6f72 2076 2069 6e20 6c73  n(v) for v in ls
-00006f10: 5d29 203e 3d20 3430 3a0a 2020 2020 2020  ]) >= 40:.      
-00006f20: 2020 2020 2020 7265 7475 726e 2022 7b5c        return "{\
-00006f30: 6e25 737d 2220 2520 2222 2e6a 6f69 6e28  n%s}" % "".join(
-00006f40: 5b76 202b 2022 2c5c 6e22 2066 6f72 2076  [v + ",\n" for v
-00006f50: 2069 6e20 6c73 5d29 0a20 2020 2020 2020   in ls]).       
-00006f60: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00006f70: 2020 2072 6574 7572 6e20 227b 2573 7d22     return "{%s}"
-00006f80: 2025 2022 2c20 222e 6a6f 696e 286c 7329   % ", ".join(ls)
-00006f90: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-00006fa0: 6365 286f 2c20 7365 7429 3a0a 2020 2020  ce(o, set):.    
-00006fb0: 2020 2020 7265 7475 726e 2022 7365 7428      return "set(
-00006fc0: 5b5c 6e25 735d 2922 2025 2022 222e 6a6f  [\n%s])" % "".jo
-00006fd0: 696e 286d 6170 286c 616d 6264 6120 763a  in(map(lambda v:
-00006fe0: 2062 6574 7465 725f 7265 7072 2876 2920   better_repr(v) 
-00006ff0: 2b20 222c 5c6e 222c 206f 2929 0a20 2020  + ",\n", o)).   
-00007000: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
-00007010: 2c20 666c 6f61 7429 2061 6e64 2028 6d61  , float) and (ma
-00007020: 7468 2e69 736e 616e 286f 2920 6f72 206d  th.isnan(o) or m
-00007030: 6174 682e 6973 696e 6628 6f29 293a 0a20  ath.isinf(o)):. 
-00007040: 2020 2020 2020 2072 6574 7572 6e20 2266         return "f
-00007050: 6c6f 6174 2827 2573 2729 2220 2520 7265  loat('%s')" % re
-00007060: 7072 286f 290a 2020 2020 2320 6661 6c6c  pr(o).    # fall
-00007070: 6261 636b 0a20 2020 2072 6574 7572 6e20  back.    return 
-00007080: 7265 7072 286f 290a 0a0a 6465 6620 7369  repr(o)...def si
-00007090: 6d70 6c65 5f6f 626a 5f72 6570 7228 6f62  mple_obj_repr(ob
-000070a0: 6a29 3a0a 2020 2020 2222 220a 2020 2020  j):.    """.    
-000070b0: 3a72 6574 7572 6e3a 2041 6c6c 2073 656c  :return: All sel
-000070c0: 662e 5f5f 696e 6974 5f5f 2061 7267 732e  f.__init__ args.
-000070d0: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
-000070e0: 0a20 2020 2022 2222 0a20 2020 2072 6574  .    """.    ret
-000070f0: 7572 6e20 6f62 6a2e 5f5f 636c 6173 735f  urn obj.__class_
-00007100: 5f2e 5f5f 6e61 6d65 5f5f 202b 2022 2825  _.__name__ + "(%
-00007110: 7329 2220 2520 222c 2022 2e6a 6f69 6e28  s)" % ", ".join(
-00007120: 0a20 2020 2020 2020 205b 2225 733d 2573  .        ["%s=%s
-00007130: 2220 2520 2861 7267 2c20 6265 7474 6572  " % (arg, better
-00007140: 5f72 6570 7228 6765 7461 7474 7228 6f62  _repr(getattr(ob
-00007150: 6a2c 2061 7267 2929 2920 666f 7220 6172  j, arg))) for ar
-00007160: 6720 696e 2067 6574 6172 6773 7065 6328  g in getargspec(
-00007170: 6f62 6a2e 5f5f 696e 6974 5f5f 292e 6172  obj.__init__).ar
-00007180: 6773 5b31 3a5d 5d0a 2020 2020 290a 0a0a  gs[1:]].    )...
-00007190: 636c 6173 7320 4f62 6a41 7344 6963 7428  class ObjAsDict(
-000071a0: 7479 7069 6e67 2e4d 6170 7069 6e67 5b73  typing.Mapping[s
-000071b0: 7472 2c20 6f62 6a65 6374 5d29 3a0a 2020  tr, object]):.  
-000071c0: 2020 2222 220a 2020 2020 5772 6170 7320    """.    Wraps 
-000071d0: 7570 2061 6e79 206f 626a 6563 7420 6173  up any object as
-000071e0: 2061 2064 6963 742c 2077 6865 7265 2074   a dict, where t
-000071f0: 6865 2061 7474 7269 6275 7465 7320 6265  he attributes be
-00007200: 636f 6d65 7320 7468 6520 6b65 7973 2e0a  comes the keys..
-00007210: 2020 2020 5365 6520 616c 736f 203a 636c      See also :cl
-00007220: 6173 733a 6044 6963 7441 734f 626a 602e  ass:`DictAsObj`.
-00007230: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-00007240: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00007250: 206f 626a 293a 0a20 2020 2020 2020 2073   obj):.        s
-00007260: 656c 662e 5f5f 6f62 6a20 3d20 6f62 6a0a  elf.__obj = obj.
-00007270: 0a20 2020 2064 6566 205f 5f67 6574 6974  .    def __getit
-00007280: 656d 5f5f 2873 656c 662c 2069 7465 6d29  em__(self, item)
-00007290: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
-000072a0: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-000072b0: 2c20 2873 7472 2c20 756e 6963 6f64 6529  , (str, unicode)
-000072c0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-000072d0: 6169 7365 204b 6579 4572 726f 7228 6974  aise KeyError(it
-000072e0: 656d 290a 2020 2020 2020 2020 7472 793a  em).        try:
-000072f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00007300: 7572 6e20 6765 7461 7474 7228 7365 6c66  urn getattr(self
-00007310: 2e5f 5f6f 626a 2c20 6974 656d 290a 2020  .__obj, item).  
-00007320: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
-00007330: 7269 6275 7465 4572 726f 7220 6173 2065  ributeError as e
-00007340: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00007350: 6973 6520 4b65 7945 7272 6f72 2865 290a  ise KeyError(e).
-00007360: 0a20 2020 2064 6566 205f 5f6c 656e 5f5f  .    def __len__
-00007370: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00007380: 7265 7475 726e 206c 656e 2876 6172 7328  return len(vars(
-00007390: 7365 6c66 2e5f 5f6f 626a 2929 0a0a 2020  self.__obj))..  
-000073a0: 2020 6465 6620 5f5f 6974 6572 5f5f 2873    def __iter__(s
-000073b0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-000073c0: 7475 726e 2069 7465 7228 7661 7273 2873  turn iter(vars(s
-000073d0: 656c 662e 5f5f 6f62 6a29 290a 0a20 2020  elf.__obj))..   
-000073e0: 2064 6566 2069 7465 6d73 2873 656c 6629   def items(self)
-000073f0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00007400: 2020 2020 2020 3a72 6574 7572 6e3a 2076        :return: v
-00007410: 6172 7328 2e2e 292e 6974 656d 7328 290a  ars(..).items().
-00007420: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
-00007430: 7365 745b 2873 7472 2c6f 626a 6563 7429  set[(str,object)
-00007440: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
-00007450: 2020 2020 2020 7265 7475 726e 2076 6172        return var
-00007460: 7328 7365 6c66 2e5f 5f6f 626a 292e 6974  s(self.__obj).it
-00007470: 656d 7328 290a 0a0a 636c 6173 7320 4469  ems()...class Di
-00007480: 6374 4173 4f62 6a3a 0a20 2020 2022 2222  ctAsObj:.    """
-00007490: 0a20 2020 2057 7261 7073 2075 7020 616e  .    Wraps up an
-000074a0: 7920 6469 6374 696f 6e61 7279 2061 7320  y dictionary as 
-000074b0: 616e 206f 626a 6563 742c 2077 6865 7265  an object, where
-000074c0: 2074 6865 206b 6579 7320 6265 636f 6d65   the keys become
-000074d0: 7320 7468 6520 6174 7472 6962 7574 6573  s the attributes
-000074e0: 2e0a 2020 2020 5365 6520 616c 736f 203a  ..    See also :
-000074f0: 636c 6173 733a 604f 626a 4173 4469 6374  class:`ObjAsDict
-00007500: 602e 0a20 2020 2022 2222 0a0a 2020 2020  `..    """..    
-00007510: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00007520: 662c 2064 696b 7429 3a0a 2020 2020 2020  f, dikt):.      
-00007530: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
-00007540: 6172 616d 2064 6963 745b 7374 725d 2064  aram dict[str] d
-00007550: 696b 743a 0a20 2020 2020 2020 2022 2222  ikt:.        """
-00007560: 0a20 2020 2020 2020 2073 656c 662e 5f5f  .        self.__
-00007570: 6469 6374 5f5f 203d 2064 696b 740a 0a0a  dict__ = dikt...
-00007580: 6465 6620 6469 6374 5f6a 6f69 6e65 6428  def dict_joined(
-00007590: 2a64 7329 3a0a 2020 2020 2222 220a 2020  *ds):.    """.  
-000075a0: 2020 3a70 6172 616d 2064 6963 745b 542c    :param dict[T,
-000075b0: 565d 2064 733a 0a20 2020 203a 7265 7475  V] ds:.    :retu
-000075c0: 726e 3a20 616c 6c20 6469 6374 7320 6a6f  rn: all dicts jo
-000075d0: 696e 6564 2074 6f67 6574 6865 720a 2020  ined together.  
-000075e0: 2020 3a72 7479 7065 3a20 6469 6374 5b54    :rtype: dict[T
-000075f0: 2c56 5d0a 2020 2020 2222 220a 2020 2020  ,V].    """.    
-00007600: 7265 7320 3d20 7b7d 0a20 2020 2066 6f72  res = {}.    for
-00007610: 2064 2069 6e20 6473 3a0a 2020 2020 2020   d in ds:.      
-00007620: 2020 7265 732e 7570 6461 7465 2864 290a    res.update(d).
-00007630: 2020 2020 7265 7475 726e 2072 6573 0a0a      return res..
-00007640: 0a64 6566 206f 626a 5f64 6966 665f 7374  .def obj_diff_st
-00007650: 7228 7365 6c66 2c20 6f74 6865 722c 202a  r(self, other, *
-00007660: 2a6b 7761 7267 7329 3a0a 2020 2020 2222  *kwargs):.    ""
-00007670: 220a 2020 2020 3a70 6172 616d 206f 626a  ".    :param obj
-00007680: 6563 7420 7365 6c66 3a0a 2020 2020 3a70  ect self:.    :p
-00007690: 6172 616d 206f 626a 6563 7420 6f74 6865  aram object othe
-000076a0: 723a 0a20 2020 203a 7265 7475 726e 3a20  r:.    :return: 
-000076b0: 7468 6520 6469 6666 6572 656e 6365 2064  the difference d
-000076c0: 6573 6372 6962 6564 0a20 2020 203a 7274  escribed.    :rt
-000076d0: 7970 653a 2073 7472 0a20 2020 2022 2222  ype: str.    """
-000076e0: 0a20 2020 2064 6966 665f 6c69 7374 203d  .    diff_list =
-000076f0: 206f 626a 5f64 6966 665f 6c69 7374 2873   obj_diff_list(s
-00007700: 656c 662c 206f 7468 6572 2c20 2a2a 6b77  elf, other, **kw
-00007710: 6172 6773 290a 2020 2020 6966 206e 6f74  args).    if not
-00007720: 2064 6966 665f 6c69 7374 3a0a 2020 2020   diff_list:.    
-00007730: 2020 2020 7265 7475 726e 2022 4e6f 2064      return "No d
-00007740: 6966 662e 220a 2020 2020 7265 7475 726e  iff.".    return
-00007750: 2022 5c6e 222e 6a6f 696e 2864 6966 665f   "\n".join(diff_
-00007760: 6c69 7374 290a 0a0a 6465 6620 6f62 6a5f  list)...def obj_
-00007770: 6469 6666 5f6c 6973 7428 7365 6c66 2c20  diff_list(self, 
-00007780: 6f74 6865 722c 202a 2a6b 7761 7267 7329  other, **kwargs)
-00007790: 3a0a 2020 2020 2222 220a 2020 2020 4e6f  :.    """.    No
-000077a0: 7465 2074 6861 7420 7765 2072 6563 7572  te that we recur
-000077b0: 7365 2074 6f20 6120 6365 7274 6169 6e20  se to a certain 
-000077c0: 6465 6772 6565 2074 6f20 7468 6520 6974  degree to the it
-000077d0: 656d 732c 2062 7574 206e 6f74 2066 756c  ems, but not ful
-000077e0: 6c79 2e0a 2020 2020 536f 6d65 2064 6966  ly..    Some dif
-000077f0: 6665 7265 6e63 6573 206d 6967 6874 206a  ferences might j
-00007800: 7573 7420 6265 2073 756d 6d61 7269 7a65  ust be summarize
-00007810: 642e 0a0a 2020 2020 3a70 6172 616d 206f  d...    :param o
-00007820: 626a 6563 7420 7365 6c66 3a0a 2020 2020  bject self:.    
-00007830: 3a70 6172 616d 206f 626a 6563 7420 6f74  :param object ot
-00007840: 6865 723a 0a20 2020 203a 7265 7475 726e  her:.    :return
-00007850: 3a20 7468 6520 6469 6666 6572 656e 6365  : the difference
-00007860: 2064 6573 6372 6962 6564 0a20 2020 203a   described.    :
-00007870: 7274 7970 653a 206c 6973 745b 7374 725d  rtype: list[str]
-00007880: 0a20 2020 2022 2222 0a20 2020 2023 2048  .    """.    # H
-00007890: 6176 696e 6720 7468 656d 2065 7870 6c69  aving them expli
-000078a0: 6369 746c 7920 696e 206b 7761 7267 7320  citly in kwargs 
-000078b0: 6265 6361 7573 6520 7765 2063 616e 6e6f  because we canno
-000078c0: 7420 7573 6520 602a 6020 696e 2050 7974  t use `*` in Pyt
-000078d0: 686f 6e20 322c 0a20 2020 2023 2062 7574  hon 2,.    # but
-000078e0: 2077 6520 646f 206e 6f74 2077 616e 7420   we do not want 
-000078f0: 746f 2061 6c6c 6f77 2074 6865 6d20 6173  to allow them as
-00007900: 2070 6f73 6974 696f 6e61 6c20 6172 6773   positional args
-00007910: 2e0a 2020 2020 7072 6566 6978 203d 206b  ..    prefix = k
-00007920: 7761 7267 732e 706f 7028 225f 7072 6566  wargs.pop("_pref
-00007930: 6978 222c 2022 2229 0a20 2020 2023 2049  ix", "").    # I
-00007940: 6620 616c 6c6f 7765 645f 6d61 7070 696e  f allowed_mappin
-00007950: 6728 7365 6c66 2c20 6f74 6865 7229 2c0a  g(self, other),.
-00007960: 2020 2020 2320 7468 6579 2061 7265 2061      # they are a
-00007970: 7373 6967 6e65 6420 746f 2074 6865 2065  ssigned to the e
-00007980: 7175 616c 5f6d 6170 7069 6e67 2c20 6966  qual_mapping, if
-00007990: 2070 6f73 7369 626c 6520 746f 2064 6f20   possible to do 
-000079a0: 736f 2075 6e61 6d62 6967 756f 7573 6c79  so unambiguously
-000079b0: 2e0a 2020 2020 616c 6c6f 7765 645f 6d61  ..    allowed_ma
-000079c0: 7070 696e 6720 3d20 6b77 6172 6773 2e70  pping = kwargs.p
-000079d0: 6f70 2822 616c 6c6f 7765 645f 6d61 7070  op("allowed_mapp
-000079e0: 696e 6722 2c20 4e6f 6e65 290a 2020 2020  ing", None).    
-000079f0: 6571 7561 6c5f 6d61 705f 7332 6f20 3d20  equal_map_s2o = 
-00007a00: 6b77 6172 6773 2e70 6f70 2822 5f65 7175  kwargs.pop("_equ
-00007a10: 616c 5f6d 6170 5f73 326f 222c 204e 6f6e  al_map_s2o", Non
-00007a20: 6529 2020 2320 7365 6c66 202d 3e20 6f74  e)  # self -> ot
-00007a30: 6865 720a 2020 2020 6571 7561 6c5f 6d61  her.    equal_ma
-00007a40: 705f 6f32 7320 3d20 6b77 6172 6773 2e70  p_o2s = kwargs.p
-00007a50: 6f70 2822 5f65 7175 616c 5f6d 6170 5f6f  op("_equal_map_o
-00007a60: 3273 222c 204e 6f6e 6529 2020 2320 6f74  2s", None)  # ot
-00007a70: 6865 7220 2d3e 2073 656c 660a 2020 2020  her -> self.    
-00007a80: 6571 7561 6c5f 6d61 705f 6669 6e69 7368  equal_map_finish
-00007a90: 6564 203d 206b 7761 7267 732e 706f 7028  ed = kwargs.pop(
-00007aa0: 225f 6571 7561 6c5f 6d61 705f 6669 6e69  "_equal_map_fini
-00007ab0: 7368 6564 222c 2046 616c 7365 290a 2020  shed", False).  
-00007ac0: 2020 6966 206b 7761 7267 733a 0a20 2020    if kwargs:.   
-00007ad0: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-00007ae0: 7272 6f72 2822 6f62 6a5f 6469 6666 5f6c  rror("obj_diff_l
-00007af0: 6973 743a 2069 6e76 616c 6964 206b 7761  ist: invalid kwa
-00007b00: 7267 7320 2572 2220 2520 6b77 6172 6773  rgs %r" % kwargs
-00007b10: 290a 0a20 2020 2069 6620 7365 6c66 2069  )..    if self i
-00007b20: 7320 4e6f 6e65 2061 6e64 206f 7468 6572  s None and other
-00007b30: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00007b40: 2020 7265 7475 726e 205b 5d0a 2020 2020    return [].    
-00007b50: 6966 2073 656c 6620 6973 204e 6f6e 6520  if self is None 
-00007b60: 616e 6420 6f74 6865 7220 6973 206e 6f74  and other is not
-00007b70: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
-00007b80: 6574 7572 6e20 5b22 2573 7365 6c66 2069  eturn ["%sself i
-00007b90: 7320 4e6f 6e65 2061 6e64 206f 7468 6572  s None and other
-00007ba0: 2069 7320 2572 2220 2520 2870 7265 6669   is %r" % (prefi
-00007bb0: 782c 206f 7468 6572 295d 0a20 2020 2069  x, other)].    i
-00007bc0: 6620 7365 6c66 2069 7320 6e6f 7420 4e6f  f self is not No
-00007bd0: 6e65 2061 6e64 206f 7468 6572 2069 7320  ne and other is 
-00007be0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7265  None:.        re
-00007bf0: 7475 726e 205b 2225 736f 7468 6572 2069  turn ["%sother i
-00007c00: 7320 4e6f 6e65 2061 6e64 2073 656c 6620  s None and self 
-00007c10: 6973 2025 7222 2025 2028 7072 6566 6978  is %r" % (prefix
-00007c20: 2c20 7365 6c66 295d 0a20 2020 2069 6620  , self)].    if 
-00007c30: 7479 7065 2873 656c 6629 2021 3d20 7479  type(self) != ty
-00007c40: 7065 286f 7468 6572 293a 0a20 2020 2020  pe(other):.     
-00007c50: 2020 2072 6574 7572 6e20 5b22 2573 7479     return ["%sty
-00007c60: 7065 2064 6966 663a 2073 656c 6620 6973  pe diff: self is
-00007c70: 2025 7320 6275 7420 6f74 6865 7220 6973   %s but other is
-00007c80: 2025 7322 2025 2028 7072 6566 6978 2c20   %s" % (prefix, 
-00007c90: 7479 7065 2873 656c 6629 2e5f 5f6e 616d  type(self).__nam
-00007ca0: 655f 5f2c 2074 7970 6528 6f74 6865 7229  e__, type(other)
-00007cb0: 2e5f 5f6e 616d 655f 5f29 5d0a 0a20 2020  .__name__)]..   
-00007cc0: 2069 6620 616c 6c6f 7765 645f 6d61 7070   if allowed_mapp
-00007cd0: 696e 673a 0a20 2020 2020 2020 2069 6620  ing:.        if 
-00007ce0: 6571 7561 6c5f 6d61 705f 7332 6f20 6973  equal_map_s2o is
-00007cf0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00007d00: 2020 2023 2042 7569 6c64 2075 7020 7468     # Build up th
-00007d10: 6520 756e 6571 7561 6c5f 6d61 702c 2062  e unequal_map, b
-00007d20: 7920 676f 696e 6720 7468 726f 7567 6820  y going through 
-00007d30: 7468 6520 6f62 6a65 6374 732e 0a20 2020  the objects..   
-00007d40: 2020 2020 2020 2020 2065 7175 616c 5f6d           equal_m
-00007d50: 6170 5f73 326f 2c20 6571 7561 6c5f 6d61  ap_s2o, equal_ma
-00007d60: 705f 6f32 7320 3d20 7b7d 2c20 7b7d 0a20  p_o2s = {}, {}. 
-00007d70: 2020 2020 2020 2020 2020 206f 626a 5f64             obj_d
-00007d80: 6966 665f 6c69 7374 280a 2020 2020 2020  iff_list(.      
-00007d90: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
-00007da0: 6f74 6865 722c 2061 6c6c 6f77 6564 5f6d  other, allowed_m
-00007db0: 6170 7069 6e67 3d61 6c6c 6f77 6564 5f6d  apping=allowed_m
-00007dc0: 6170 7069 6e67 2c20 5f65 7175 616c 5f6d  apping, _equal_m
-00007dd0: 6170 5f73 326f 3d65 7175 616c 5f6d 6170  ap_s2o=equal_map
-00007de0: 5f73 326f 2c20 5f65 7175 616c 5f6d 6170  _s2o, _equal_map
-00007df0: 5f6f 3273 3d65 7175 616c 5f6d 6170 5f6f  _o2s=equal_map_o
-00007e00: 3273 0a20 2020 2020 2020 2020 2020 2029  2s.            )
-00007e10: 0a20 2020 2020 2020 2020 2020 2065 7175  .            equ
-00007e20: 616c 5f6d 6170 5f66 696e 6973 6865 6420  al_map_finished 
-00007e30: 3d20 5472 7565 0a20 2020 2065 6c73 653a  = True.    else:
-00007e40: 0a20 2020 2020 2020 2065 7175 616c 5f6d  .        equal_m
-00007e50: 6170 5f66 696e 6973 6865 6420 3d20 5472  ap_finished = Tr
-00007e60: 7565 0a20 2020 2069 6620 6571 7561 6c5f  ue.    if equal_
-00007e70: 6d61 705f 7332 6f20 6973 204e 6f6e 6520  map_s2o is None 
-00007e80: 6f72 2065 7175 616c 5f6d 6170 5f6f 3273  or equal_map_o2s
-00007e90: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00007ea0: 2020 6571 7561 6c5f 6d61 705f 7332 6f2c    equal_map_s2o,
-00007eb0: 2065 7175 616c 5f6d 6170 5f6f 3273 203d   equal_map_o2s =
-00007ec0: 207b 7d2c 207b 7d20 2023 2073 696d 706c   {}, {}  # simpl
-00007ed0: 6966 6965 7320 7468 6520 636f 6465 2062  ifies the code b
-00007ee0: 656c 6f77 0a0a 2020 2020 7375 625f 6b77  elow..    sub_kw
-00007ef0: 6172 6773 203d 2064 6963 7428 0a20 2020  args = dict(.   
-00007f00: 2020 2020 2061 6c6c 6f77 6564 5f6d 6170       allowed_map
-00007f10: 7069 6e67 3d61 6c6c 6f77 6564 5f6d 6170  ping=allowed_map
-00007f20: 7069 6e67 2c0a 2020 2020 2020 2020 5f65  ping,.        _e
-00007f30: 7175 616c 5f6d 6170 5f73 326f 3d65 7175  qual_map_s2o=equ
-00007f40: 616c 5f6d 6170 5f73 326f 2c0a 2020 2020  al_map_s2o,.    
-00007f50: 2020 2020 5f65 7175 616c 5f6d 6170 5f6f      _equal_map_o
-00007f60: 3273 3d65 7175 616c 5f6d 6170 5f6f 3273  2s=equal_map_o2s
-00007f70: 2c0a 2020 2020 2020 2020 5f65 7175 616c  ,.        _equal
-00007f80: 5f6d 6170 5f66 696e 6973 6865 643d 6571  _map_finished=eq
-00007f90: 7561 6c5f 6d61 705f 6669 6e69 7368 6564  ual_map_finished
-00007fa0: 2c0a 2020 2020 290a 0a20 2020 2069 6620  ,.    )..    if 
-00007fb0: 6973 696e 7374 616e 6365 2873 656c 662c  isinstance(self,
-00007fc0: 2028 6c69 7374 2c20 7475 706c 6529 293a   (list, tuple)):
-00007fd0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00007fe0: 6973 696e 7374 616e 6365 286f 7468 6572  isinstance(other
-00007ff0: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
-00008000: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00008010: 7365 6c66 2920 213d 206c 656e 286f 7468  self) != len(oth
-00008020: 6572 293a 0a20 2020 2020 2020 2020 2020  er):.           
-00008030: 2072 6574 7572 6e20 5b22 2573 6c69 7374   return ["%slist
-00008040: 2064 6966 6620 6c65 6e3a 206c 656e 2073   diff len: len s
-00008050: 656c 663a 2025 692c 206c 656e 206f 7468  elf: %i, len oth
-00008060: 6572 3a20 2569 2220 2520 2870 7265 6669  er: %i" % (prefi
-00008070: 782c 206c 656e 2873 656c 6629 2c20 6c65  x, len(self), le
-00008080: 6e28 6f74 6865 7229 295d 0a20 2020 2020  n(other))].     
-00008090: 2020 2073 203d 205b 5d0a 2020 2020 2020     s = [].      
-000080a0: 2020 666f 7220 692c 2028 612c 2062 2920    for i, (a, b) 
-000080b0: 696e 2065 6e75 6d65 7261 7465 287a 6970  in enumerate(zip
-000080c0: 2873 656c 662c 206f 7468 6572 2929 3a0a  (self, other)):.
-000080d0: 2020 2020 2020 2020 2020 2020 7320 2b3d              s +=
-000080e0: 206f 626a 5f64 6966 665f 6c69 7374 2861   obj_diff_list(a
-000080f0: 2c20 622c 205f 7072 6566 6978 3d22 2573  , b, _prefix="%s
-00008100: 5b25 695d 2022 2025 2028 7072 6566 6978  [%i] " % (prefix
-00008110: 2c20 6929 2c20 2a2a 7375 625f 6b77 6172  , i), **sub_kwar
-00008120: 6773 290a 2020 2020 2020 2020 6966 2073  gs).        if s
-00008130: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00008140: 7475 726e 205b 2225 736c 6973 7420 6469  turn ["%slist di
-00008150: 6666 3a22 2025 2070 7265 6669 785d 202b  ff:" % prefix] +
-00008160: 2073 0a20 2020 2020 2020 2072 6574 7572   s.        retur
-00008170: 6e20 5b5d 0a0a 2020 2020 6465 6620 5f73  n []..    def _s
-00008180: 6574 5f64 6966 6628 615f 2c20 625f 293a  et_diff(a_, b_):
-00008190: 0a20 2020 2020 2020 2023 2061 7373 756d  .        # assum
-000081a0: 6520 7468 6520 7661 6c75 6573 2063 616e  e the values can
-000081b0: 2062 6520 736f 7274 6564 0a20 2020 2020   be sorted.     
-000081c0: 2020 2061 5f20 3d20 736f 7274 6564 2861     a_ = sorted(a
-000081d0: 5f29 0a20 2020 2020 2020 2062 5f20 3d20  _).        b_ = 
-000081e0: 736f 7274 6564 2862 5f29 0a20 2020 2020  sorted(b_).     
-000081f0: 2020 2073 656c 665f 6469 6666 5f20 3d20     self_diff_ = 
-00008200: 5b5d 0a20 2020 2020 2020 2073 616d 655f  [].        same_
-00008210: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-00008220: 7220 7620 696e 2061 5f3a 0a20 2020 2020  r v in a_:.     
-00008230: 2020 2020 2020 2076 5f20 3d20 6571 7561         v_ = equa
-00008240: 6c5f 6d61 705f 7332 6f2e 6765 7428 762c  l_map_s2o.get(v,
-00008250: 2076 290a 2020 2020 2020 2020 2020 2020   v).            
-00008260: 6966 2076 5f20 696e 2062 5f3a 0a20 2020  if v_ in b_:.   
-00008270: 2020 2020 2020 2020 2020 2020 2073 616d               sam
-00008280: 655f 2e61 7070 656e 6428 7629 0a20 2020  e_.append(v).   
-00008290: 2020 2020 2020 2020 2020 2020 2062 5f2e               b_.
-000082a0: 7265 6d6f 7665 2876 5f29 0a20 2020 2020  remove(v_).     
-000082b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000082c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000082d0: 665f 6469 6666 5f2e 6170 7065 6e64 2876  f_diff_.append(v
-000082e0: 290a 2020 2020 2020 2020 6f74 6865 725f  ).        other_
-000082f0: 6469 6666 5f20 3d20 625f 0a20 2020 2020  diff_ = b_.     
-00008300: 2020 2072 6574 7572 6e20 7365 6c66 5f64     return self_d
-00008310: 6966 665f 2c20 7361 6d65 5f2c 206f 7468  iff_, same_, oth
-00008320: 6572 5f64 6966 665f 0a0a 2020 2020 6966  er_diff_..    if
-00008330: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-00008340: 2c20 7365 7429 3a0a 2020 2020 2020 2020  , set):.        
-00008350: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
-00008360: 6528 6f74 6865 722c 2073 6574 290a 2020  e(other, set).  
-00008370: 2020 2020 2020 7365 6c66 5f64 6966 662c        self_diff,
-00008380: 205f 2c20 6f74 6865 725f 6469 6666 203d   _, other_diff =
-00008390: 205f 7365 745f 6469 6666 2873 656c 662c   _set_diff(self,
-000083a0: 206f 7468 6572 290a 2020 2020 2020 2020   other).        
-000083b0: 6966 206c 656e 2873 656c 665f 6469 6666  if len(self_diff
-000083c0: 2920 3d3d 206c 656e 286f 7468 6572 5f64  ) == len(other_d
-000083d0: 6966 6629 203d 3d20 313a 0a20 2020 2020  iff) == 1:.     
-000083e0: 2020 2020 2020 2023 2070 6f74 656e 7469         # potenti
-000083f0: 616c 6c79 2075 7064 6174 6520 6571 7561  ally update equa
-00008400: 6c5f 6d61 700a 2020 2020 2020 2020 2020  l_map.          
-00008410: 2020 7320 3d20 6f62 6a5f 6469 6666 5f6c    s = obj_diff_l
-00008420: 6973 7428 6c69 7374 2873 656c 665f 6469  ist(list(self_di
-00008430: 6666 295b 305d 2c20 6c69 7374 286f 7468  ff)[0], list(oth
-00008440: 6572 5f64 6966 6629 5b30 5d2c 202a 2a73  er_diff)[0], **s
-00008450: 7562 5f6b 7761 7267 7329 0a20 2020 2020  ub_kwargs).     
-00008460: 2020 2020 2020 2023 2069 676e 6f72 6520         # ignore 
-00008470: 7468 6520 706f 7465 6e74 6961 6c20 7570  the potential up
-00008480: 6461 7465 6420 6571 7561 6c5f 6d61 7020  dated equal_map 
-00008490: 6e6f 7720 666f 7220 7369 6d70 6c69 6369  now for simplici
-000084a0: 7479 2e20 7765 2077 696c 6c20 616e 7977  ty. we will anyw
-000084b0: 6179 2064 6f20 6120 7365 636f 6e64 2070  ay do a second p
-000084c0: 6173 7320 6c61 7465 722e 0a20 2020 2020  ass later..     
-000084d0: 2020 2020 2020 2069 6620 6c65 6e28 7329         if len(s)
-000084e0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-000084f0: 2020 2020 2020 2072 6574 7572 6e20 5b22         return ["
-00008500: 2573 7365 7420 6469 6666 2076 616c 7565  %sset diff value
-00008510: 3a20 2573 2220 2520 2870 7265 6669 782c  : %s" % (prefix,
-00008520: 2073 5b30 5d29 5d0a 2020 2020 2020 2020   s[0])].        
-00008530: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
-00008540: 6f72 206b 6579 2069 6e20 7365 6c66 5f64  or key in self_d
-00008550: 6966 663a 0a20 2020 2020 2020 2020 2020  iff:.           
-00008560: 2073 202b 3d20 5b22 2573 2020 2572 206e   s += ["%s  %r n
-00008570: 6f74 2069 6e20 6f74 6865 7222 2025 2028  ot in other" % (
-00008580: 7072 6566 6978 2c20 6b65 7929 5d0a 2020  prefix, key)].  
-00008590: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
-000085a0: 206f 7468 6572 5f64 6966 663a 0a20 2020   other_diff:.   
-000085b0: 2020 2020 2020 2020 2073 202b 3d20 5b22           s += ["
-000085c0: 2573 2020 2572 206e 6f74 2069 6e20 7365  %s  %r not in se
-000085d0: 6c66 2220 2520 2870 7265 6669 782c 206b  lf" % (prefix, k
-000085e0: 6579 295d 0a20 2020 2020 2020 2069 6620  ey)].        if 
-000085f0: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-00008600: 6574 7572 6e20 5b22 2573 7365 7420 6469  eturn ["%sset di
-00008610: 6666 3a22 2025 2070 7265 6669 785d 202b  ff:" % prefix] +
-00008620: 2073 0a20 2020 2020 2020 2072 6574 7572   s.        retur
-00008630: 6e20 5b5d 0a0a 2020 2020 6966 2069 7369  n []..    if isi
-00008640: 6e73 7461 6e63 6528 7365 6c66 2c20 6469  nstance(self, di
-00008650: 6374 293a 0a20 2020 2020 2020 2061 7373  ct):.        ass
-00008660: 6572 7420 6973 696e 7374 616e 6365 286f  ert isinstance(o
-00008670: 7468 6572 2c20 6469 6374 290a 2020 2020  ther, dict).    
-00008680: 2020 2020 7365 6c66 5f64 6966 662c 2073      self_diff, s
-00008690: 616d 652c 206f 7468 6572 5f64 6966 6620  ame, other_diff 
-000086a0: 3d20 5f73 6574 5f64 6966 6628 7365 6c66  = _set_diff(self
-000086b0: 2e6b 6579 7328 292c 206f 7468 6572 2e6b  .keys(), other.k
-000086c0: 6579 7328 2929 0a20 2020 2020 2020 2069  eys()).        i
-000086d0: 6620 6e6f 7420 6571 7561 6c5f 6d61 705f  f not equal_map_
-000086e0: 6669 6e69 7368 6564 2061 6e64 206c 656e  finished and len
-000086f0: 2873 656c 665f 6469 6666 2920 3d3d 206c  (self_diff) == l
-00008700: 656e 286f 7468 6572 5f64 6966 6629 203d  en(other_diff) =
-00008710: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00008720: 2023 2070 6f74 656e 7469 616c 6c79 2075   # potentially u
-00008730: 7064 6174 6520 6571 7561 6c5f 6d61 700a  pdate equal_map.
-00008740: 2020 2020 2020 2020 2020 2020 6f62 6a5f              obj_
-00008750: 6469 6666 5f6c 6973 7428 6c69 7374 2873  diff_list(list(s
-00008760: 656c 665f 6469 6666 295b 305d 2c20 6c69  elf_diff)[0], li
-00008770: 7374 286f 7468 6572 5f64 6966 6629 5b30  st(other_diff)[0
-00008780: 5d2c 202a 2a73 7562 5f6b 7761 7267 7329  ], **sub_kwargs)
-00008790: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-000087a0: 676e 6f72 6520 7468 6520 706f 7465 6e74  gnore the potent
-000087b0: 6961 6c20 7570 6461 7465 6420 6571 7561  ial updated equa
-000087c0: 6c5f 6d61 7020 6e6f 7720 666f 7220 7369  l_map now for si
-000087d0: 6d70 6c69 6369 7479 2e20 7765 2077 696c  mplicity. we wil
-000087e0: 6c20 616e 7977 6179 2064 6f20 6120 7365  l anyway do a se
-000087f0: 636f 6e64 2070 6173 7320 6c61 7465 722e  cond pass later.
-00008800: 0a20 2020 2020 2020 2073 203d 205b 5d0a  .        s = [].
-00008810: 2020 2020 2020 2020 666f 7220 6b65 7920          for key 
-00008820: 696e 2073 656c 665f 6469 6666 3a0a 2020  in self_diff:.  
-00008830: 2020 2020 2020 2020 2020 7320 2b3d 205b            s += [
-00008840: 2225 7320 206b 6579 2025 7220 6e6f 7420  "%s  key %r not 
-00008850: 696e 206f 7468 6572 2220 2520 2870 7265  in other" % (pre
-00008860: 6669 782c 206b 6579 295d 0a20 2020 2020  fix, key)].     
-00008870: 2020 2066 6f72 206b 6579 2069 6e20 6f74     for key in ot
-00008880: 6865 725f 6469 6666 3a0a 2020 2020 2020  her_diff:.      
-00008890: 2020 2020 2020 7320 2b3d 205b 2225 7320        s += ["%s 
-000088a0: 206b 6579 2025 7220 6e6f 7420 696e 2073   key %r not in s
-000088b0: 656c 6622 2025 2028 7072 6566 6978 2c20  elf" % (prefix, 
-000088c0: 6b65 7929 5d0a 2020 2020 2020 2020 666f  key)].        fo
-000088d0: 7220 6b65 7920 696e 2073 616d 653a 0a20  r key in same:. 
-000088e0: 2020 2020 2020 2020 2020 206b 6579 5f20             key_ 
-000088f0: 3d20 6571 7561 6c5f 6d61 705f 7332 6f2e  = equal_map_s2o.
-00008900: 6765 7428 6b65 792c 206b 6579 290a 2020  get(key, key).  
-00008910: 2020 2020 2020 2020 2020 7661 6c75 655f            value_
-00008920: 7365 6c66 203d 2073 656c 665b 6b65 795d  self = self[key]
-00008930: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00008940: 7565 5f6f 7468 6572 203d 206f 7468 6572  ue_other = other
-00008950: 5b6b 6579 5f5d 0a20 2020 2020 2020 2020  [key_].         
-00008960: 2020 2073 202b 3d20 6f62 6a5f 6469 6666     s += obj_diff
-00008970: 5f6c 6973 7428 7661 6c75 655f 7365 6c66  _list(value_self
-00008980: 2c20 7661 6c75 655f 6f74 6865 722c 205f  , value_other, _
-00008990: 7072 6566 6978 3d22 2573 5b25 725d 2022  prefix="%s[%r] "
-000089a0: 2025 2028 7072 6566 6978 2c20 6b65 7929   % (prefix, key)
-000089b0: 2c20 2a2a 7375 625f 6b77 6172 6773 290a  , **sub_kwargs).
-000089c0: 2020 2020 2020 2020 6966 2073 3a0a 2020          if s:.  
-000089d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000089e0: 205b 2225 7364 6963 7420 6469 6666 3a22   ["%sdict diff:"
-000089f0: 2025 2070 7265 6669 785d 202b 2073 0a20   % prefix] + s. 
-00008a00: 2020 2020 2020 2072 6574 7572 6e20 5b5d         return []
-00008a10: 0a0a 2020 2020 6966 2069 7369 6e73 7461  ..    if isinsta
-00008a20: 6e63 6528 7365 6c66 2c20 6e70 2e6e 6461  nce(self, np.nda
-00008a30: 7272 6179 293a 0a20 2020 2020 2020 2061  rray):.        a
-00008a40: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
-00008a50: 286f 7468 6572 2c20 6e70 2e6e 6461 7272  (other, np.ndarr
-00008a60: 6179 290a 2020 2020 2020 2020 6966 206e  ay).        if n
-00008a70: 6f74 206e 702e 6172 7261 795f 6571 7561  ot np.array_equa
-00008a80: 6c28 7365 6c66 2c20 6f74 6865 7229 3a0a  l(self, other):.
-00008a90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00008aa0: 726e 205b 2225 7373 656c 663a 2025 7220  rn ["%sself: %r 
-00008ab0: 213d 206f 7468 6572 3a20 2572 2220 2520  != other: %r" % 
-00008ac0: 2870 7265 6669 782c 2073 656c 662c 206f  (prefix, self, o
-00008ad0: 7468 6572 295d 0a20 2020 2020 2020 2072  ther)].        r
-00008ae0: 6574 7572 6e20 5b5d 0a0a 2020 2020 6966  eturn []..    if
-00008af0: 2061 6c6c 6f77 6564 5f6d 6170 7069 6e67   allowed_mapping
-00008b00: 2061 6e64 2073 656c 6620 213d 206f 7468   and self != oth
-00008b10: 6572 2061 6e64 2061 6c6c 6f77 6564 5f6d  er and allowed_m
-00008b20: 6170 7069 6e67 2873 656c 662c 206f 7468  apping(self, oth
-00008b30: 6572 293a 0a20 2020 2020 2020 2069 6620  er):.        if 
-00008b40: 7365 6c66 2069 6e20 6571 7561 6c5f 6d61  self in equal_ma
-00008b50: 705f 7332 6f3a 0a20 2020 2020 2020 2020  p_s2o:.         
-00008b60: 2020 2073 656c 6620 3d20 6571 7561 6c5f     self = equal_
-00008b70: 6d61 705f 7332 6f5b 7365 6c66 5d0a 2020  map_s2o[self].  
-00008b80: 2020 2020 2020 656c 6966 206f 7468 6572        elif other
-00008b90: 206e 6f74 2069 6e20 6571 7561 6c5f 6d61   not in equal_ma
-00008ba0: 705f 6f32 733a 2020 2320 646f 6e27 7420  p_o2s:  # don't 
-00008bb0: 6d61 7020 6d75 6c74 6970 6c65 2074 696d  map multiple tim
-00008bc0: 6573 2074 6f20 7468 6973 0a20 2020 2020  es to this.     
-00008bd0: 2020 2020 2020 2065 7175 616c 5f6d 6170         equal_map
-00008be0: 5f73 326f 5b73 656c 665d 203d 206f 7468  _s2o[self] = oth
-00008bf0: 6572 0a20 2020 2020 2020 2020 2020 2065  er.            e
-00008c00: 7175 616c 5f6d 6170 5f6f 3273 5b6f 7468  qual_map_o2s[oth
-00008c10: 6572 5d20 3d20 7365 6c66 0a0a 2020 2020  er] = self..    
-00008c20: 6966 2073 656c 6620 213d 206f 7468 6572  if self != other
-00008c30: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00008c40: 205b 2225 7373 656c 663a 2025 7220 213d   ["%sself: %r !=
-00008c50: 206f 7468 6572 3a20 2572 2220 2520 2870   other: %r" % (p
-00008c60: 7265 6669 782c 2073 656c 662c 206f 7468  refix, self, oth
-00008c70: 6572 295d 0a20 2020 2072 6574 7572 6e20  er)].    return 
-00008c80: 5b5d 0a0a 0a64 6566 2066 696e 645f 7261  []...def find_ra
-00008c90: 6e67 6573 286c 7329 3a0a 2020 2020 2222  nges(ls):.    ""
-00008ca0: 220a 2020 2020 3a74 7970 6520 6c73 3a20  ".    :type ls: 
-00008cb0: 6c69 7374 5b69 6e74 5d0a 2020 2020 3a72  list[int].    :r
-00008cc0: 6574 7572 6e73 206c 6973 7420 6f66 2072  eturns list of r
-00008cd0: 616e 6765 7320 2873 7461 7274 2c65 6e64  anges (start,end
-00008ce0: 2920 7768 6572 6520 656e 6420 6973 2065  ) where end is e
-00008cf0: 7863 6c75 7369 7665 0a20 2020 2073 7563  xclusive.    suc
-00008d00: 6820 7468 6174 2074 6865 2075 6e69 6f6e  h that the union
-00008d10: 206f 6620 7261 6e67 6528 7374 6172 742c   of range(start,
-00008d20: 656e 6429 206d 6174 6368 6573 206c 2e0a  end) matches l..
-00008d30: 2020 2020 3a72 7479 7065 3a20 6c69 7374      :rtype: list
-00008d40: 5b28 696e 742c 696e 7429 5d0a 2020 2020  [(int,int)].    
-00008d50: 5765 2065 7870 6563 7420 7468 6174 2074  We expect that t
-00008d60: 6865 2069 6e63 6f6d 696e 6720 6c69 7374  he incoming list
-00008d70: 2069 7320 736f 7274 6564 2061 6e64 2073   is sorted and s
-00008d80: 7472 6f6e 676c 7920 6d6f 6e6f 746f 6e69  trongly monotoni
-00008d90: 6320 696e 6372 6561 7369 6e67 2e0a 2020  c increasing..  
-00008da0: 2020 2222 220a 2020 2020 6966 206e 6f74    """.    if not
-00008db0: 206c 733a 0a20 2020 2020 2020 2072 6574   ls:.        ret
-00008dc0: 7572 6e20 5b5d 0a20 2020 2072 616e 6765  urn [].    range
-00008dd0: 7320 3d20 5b28 6c73 5b30 5d2c 206c 735b  s = [(ls[0], ls[
-00008de0: 305d 295d 0a20 2020 2066 6f72 206b 2069  0])].    for k i
-00008df0: 6e20 6c73 3a0a 2020 2020 2020 2020 6173  n ls:.        as
-00008e00: 7365 7274 206b 203e 3d20 7261 6e67 6573  sert k >= ranges
-00008e10: 5b2d 315d 5b31 5d20 2023 2073 7472 6f6e  [-1][1]  # stron
-00008e20: 676c 7920 6d6f 6e6f 746f 6e69 6320 696e  gly monotonic in
-00008e30: 6372 6561 7369 6e67 0a20 2020 2020 2020  creasing.       
-00008e40: 2069 6620 6b20 3d3d 2072 616e 6765 735b   if k == ranges[
-00008e50: 2d31 5d5b 315d 3a0a 2020 2020 2020 2020  -1][1]:.        
-00008e60: 2020 2020 7261 6e67 6573 5b2d 315d 203d      ranges[-1] =
-00008e70: 2028 7261 6e67 6573 5b2d 315d 5b30 5d2c   (ranges[-1][0],
-00008e80: 206b 202b 2031 290a 2020 2020 2020 2020   k + 1).        
-00008e90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00008ea0: 2020 7261 6e67 6573 202b 3d20 5b28 6b2c    ranges += [(k,
-00008eb0: 206b 202b 2031 295d 0a20 2020 2072 6574   k + 1)].    ret
-00008ec0: 7572 6e20 7261 6e67 6573 0a0a 0a5f 7468  urn ranges..._th
-00008ed0: 7265 6164 5f6a 6f69 6e5f 6861 636b 5f69  read_join_hack_i
-00008ee0: 6e73 7461 6c6c 6564 203d 2046 616c 7365  nstalled = False
-00008ef0: 0a0a 0a64 6566 2069 6e69 745f 7468 7265  ...def init_thre
-00008f00: 6164 5f6a 6f69 6e5f 6861 636b 2829 3a0a  ad_join_hack():.
-00008f10: 2020 2020 2222 220a 2020 2020 6060 7468      """.    ``th
-00008f20: 7265 6164 696e 672e 5468 7265 6164 2e6a  reading.Thread.j
-00008f30: 6f69 6e60 6020 616e 6420 6060 7468 7265  oin`` and ``thre
-00008f40: 6164 696e 672e 436f 6e64 6974 696f 6e2e  ading.Condition.
-00008f50: 7761 6974 6060 2077 6f75 6c64 2062 6c6f  wait`` would blo
-00008f60: 636b 2073 6967 6e61 6c73 2077 6865 6e20  ck signals when 
-00008f70: 7275 6e20 696e 2074 6865 206d 6169 6e20  run in the main 
-00008f80: 7468 7265 6164 2e0a 2020 2020 5765 206e  thread..    We n
-00008f90: 6576 6572 2077 616e 7420 746f 2062 6c6f  ever want to blo
-00008fa0: 636b 2073 6967 6e61 6c73 2e0a 2020 2020  ck signals..    
-00008fb0: 4865 7265 2077 6520 7061 7463 6820 6177  Here we patch aw
-00008fc0: 6179 2074 6861 7420 6265 6861 7669 6f72  ay that behavior
-00008fd0: 2e0a 2020 2020 2222 220a 2020 2020 676c  ..    """.    gl
-00008fe0: 6f62 616c 205f 7468 7265 6164 5f6a 6f69  obal _thread_joi
-00008ff0: 6e5f 6861 636b 5f69 6e73 7461 6c6c 6564  n_hack_installed
-00009000: 0a20 2020 2069 6620 5f74 6872 6561 645f  .    if _thread_
-00009010: 6a6f 696e 5f68 6163 6b5f 696e 7374 616c  join_hack_instal
-00009020: 6c65 643a 2020 2320 646f 6e27 7420 696e  led:  # don't in
-00009030: 7374 616c 6c20 7477 6963 650a 2020 2020  stall twice.    
-00009040: 2020 2020 7265 7475 726e 0a20 2020 205f      return.    _
-00009050: 7468 7265 6164 5f6a 6f69 6e5f 6861 636b  thread_join_hack
-00009060: 5f69 6e73 7461 6c6c 6564 203d 2054 7275  _installed = Tru
-00009070: 650a 2020 2020 6966 2050 5933 3a0a 2020  e.    if PY3:.  
-00009080: 2020 2020 2020 2320 5468 6573 6520 6d6f        # These mo
-00009090: 6e6b 6579 2070 6174 6368 6573 2061 7265  nkey patches are
-000090a0: 206e 6f74 206e 6563 6573 7361 7279 2061   not necessary a
-000090b0: 6e79 6d6f 7265 2e20 4e6f 7468 696e 6720  nymore. Nothing 
-000090c0: 626c 6f63 6b73 2073 6967 6e61 6c73 2061  blocks signals a
-000090d0: 6e79 6d6f 7265 2069 6e20 5079 7468 6f6e  nymore in Python
-000090e0: 2033 2e0a 2020 2020 2020 2020 2320 6874   3..        # ht
-000090f0: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-00009100: 2f61 6c62 6572 747a 2f70 6c61 7967 726f  /albertz/playgro
-00009110: 756e 642f 626c 6f62 2f6d 6173 7465 722f  und/blob/master/
-00009120: 7468 7265 6164 2d6a 6f69 6e2d 626c 6f63  thread-join-bloc
-00009130: 6b2e 7079 0a20 2020 2020 2020 2023 2068  k.py.        # h
-00009140: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-00009150: 6d2f 616c 6265 7274 7a2f 706c 6179 6772  m/albertz/playgr
-00009160: 6f75 6e64 2f62 6c6f 622f 6d61 7374 6572  ound/blob/master
-00009170: 2f63 6f6e 642d 7761 6974 2d62 6c6f 636b  /cond-wait-block
-00009180: 2e70 790a 2020 2020 2020 2020 7265 7475  .py.        retu
-00009190: 726e 0a20 2020 206d 6169 6e5f 7468 7265  rn.    main_thre
-000091a0: 6164 203d 2074 6872 6561 6469 6e67 2e63  ad = threading.c
-000091b0: 7572 7265 6e74 5468 7265 6164 2829 0a20  urrentThread(). 
-000091c0: 2020 2023 206e 6f69 6e73 7065 6374 696f     # noinspectio
-000091d0: 6e20 5079 556e 7265 736f 6c76 6564 5265  n PyUnresolvedRe
-000091e0: 6665 7265 6e63 6573 2c50 7950 726f 7465  ferences,PyProte
-000091f0: 6374 6564 4d65 6d62 6572 0a20 2020 2061  ctedMember.    a
-00009200: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
-00009210: 286d 6169 6e5f 7468 7265 6164 2c20 7468  (main_thread, th
-00009220: 7265 6164 696e 672e 5f4d 6169 6e54 6872  reading._MainThr
-00009230: 6561 6429 0a20 2020 206d 6169 6e5f 7468  ead).    main_th
-00009240: 7265 6164 5f69 6420 3d20 7468 7265 6164  read_id = thread
-00009250: 2e67 6574 5f69 6465 6e74 2829 0a0a 2020  .get_ident()..  
-00009260: 2020 2320 5061 7463 6820 5468 7265 6164    # Patch Thread
-00009270: 2e6a 6f69 6e28 292e 0a20 2020 206a 6f69  .join()..    joi
-00009280: 6e5f 6f72 6967 203d 2074 6872 6561 6469  n_orig = threadi
-00009290: 6e67 2e54 6872 6561 642e 6a6f 696e 0a0a  ng.Thread.join..
-000092a0: 2020 2020 6465 6620 6a6f 696e 5f68 6163      def join_hac
-000092b0: 6b65 6428 7468 7265 6164 5f6f 626a 2c20  ked(thread_obj, 
-000092c0: 7469 6d65 6f75 743d 4e6f 6e65 293a 0a20  timeout=None):. 
-000092d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000092e0: 2020 203a 7479 7065 2074 6872 6561 645f     :type thread_
-000092f0: 6f62 6a3a 2074 6872 6561 6469 6e67 2e54  obj: threading.T
-00009300: 6872 6561 640a 2020 2020 2020 2020 3a74  hread.        :t
-00009310: 7970 6520 7469 6d65 6f75 743a 2066 6c6f  ype timeout: flo
-00009320: 6174 7c4e 6f6e 650a 2020 2020 2020 2020  at|None.        
-00009330: 3a72 6574 7572 6e3a 2061 6c77 6179 7320  :return: always 
-00009340: 4e6f 6e65 0a20 2020 2020 2020 2022 2222  None.        """
-00009350: 0a20 2020 2020 2020 2069 6620 7468 7265  .        if thre
-00009360: 6164 2e67 6574 5f69 6465 6e74 2829 203d  ad.get_ident() =
-00009370: 3d20 6d61 696e 5f74 6872 6561 645f 6964  = main_thread_id
-00009380: 2061 6e64 2074 696d 656f 7574 2069 7320   and timeout is 
-00009390: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000093a0: 2020 2320 5468 6973 2069 7320 6120 4841    # This is a HA
-000093b0: 434b 2066 6f72 2054 6872 6561 642e 6a6f  CK for Thread.jo
-000093c0: 696e 2829 2069 6620 7765 2061 7265 2069  in() if we are i
-000093d0: 6e20 7468 6520 6d61 696e 2074 6872 6561  n the main threa
-000093e0: 642e 0a20 2020 2020 2020 2020 2020 2023  d..            #
-000093f0: 2049 6e20 7468 6174 2063 6173 652c 2061   In that case, a
-00009400: 2054 6872 6561 642e 6a6f 696e 2874 696d   Thread.join(tim
-00009410: 656f 7574 3d4e 6f6e 6529 2077 6f75 6c64  eout=None) would
-00009420: 2068 616e 6720 616e 6420 6576 656e 206e   hang and even n
-00009430: 6f74 2072 6573 706f 6e64 2074 6f20 7369  ot respond to si
-00009440: 676e 616c 730a 2020 2020 2020 2020 2020  gnals.          
-00009450: 2020 2320 6265 6361 7573 6520 7369 676e    # because sign
-00009460: 616c 7320 7769 6c6c 2067 6574 2064 656c  als will get del
-00009470: 6976 6572 6564 2074 6f20 6f74 6865 7220  ivered to other 
-00009480: 7468 7265 6164 7320 616e 6420 5079 7468  threads and Pyth
-00009490: 6f6e 2077 6f75 6c64 2066 6f72 7761 7264  on would forward
-000094a0: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-000094b0: 6865 6d20 666f 7220 6465 6c61 7965 6420  hem for delayed 
-000094c0: 6861 6e64 6c69 6e67 2074 6f20 7468 6520  handling to the 
-000094d0: 6d61 696e 2074 6872 6561 6420 7768 6963  main thread whic
-000094e0: 6820 6861 6e67 732e 0a20 2020 2020 2020  h hangs..       
-000094f0: 2020 2020 2023 2053 6565 2043 5079 7468       # See CPyth
-00009500: 6f6e 2073 6967 6e61 6c6d 6f64 756c 652e  on signalmodule.
-00009510: 632e 0a20 2020 2020 2020 2020 2020 2023  c..            #
-00009520: 2043 7572 7265 6e74 6c79 2074 6865 2062   Currently the b
-00009530: 6573 7420 736f 6c75 7469 6f6e 2049 2063  est solution I c
-00009540: 616e 2074 6869 6e6b 206f 663a 0a20 2020  an think of:.   
-00009550: 2020 2020 2020 2020 2077 6869 6c65 2074           while t
-00009560: 6872 6561 645f 6f62 6a2e 6973 5f61 6c69  hread_obj.is_ali
-00009570: 7665 2829 3a0a 2020 2020 2020 2020 2020  ve():.          
-00009580: 2020 2020 2020 6a6f 696e 5f6f 7269 6728        join_orig(
-00009590: 7468 7265 6164 5f6f 626a 2c20 7469 6d65  thread_obj, time
-000095a0: 6f75 743d 302e 3129 0a20 2020 2020 2020  out=0.1).       
-000095b0: 2065 6c69 6620 7468 7265 6164 2e67 6574   elif thread.get
-000095c0: 5f69 6465 6e74 2829 203d 3d20 6d61 696e  _ident() == main
-000095d0: 5f74 6872 6561 645f 6964 2061 6e64 2074  _thread_id and t
-000095e0: 696d 656f 7574 203e 2030 2e31 3a0a 2020  imeout > 0.1:.  
-000095f0: 2020 2020 2020 2020 2020 2320 4c69 6d69            # Limi
-00009600: 7420 7468 6520 7469 6d65 6f75 742e 2054  t the timeout. T
-00009610: 6869 7320 7368 6f75 6c64 206e 6f74 206d  his should not m
-00009620: 6174 7465 7220 666f 7220 7468 6520 756e  atter for the un
-00009630: 6465 726c 7969 6e67 2063 6f64 652e 0a20  derlying code.. 
-00009640: 2020 2020 2020 2020 2020 206a 6f69 6e5f             join_
-00009650: 6f72 6967 2874 6872 6561 645f 6f62 6a2c  orig(thread_obj,
-00009660: 2074 696d 656f 7574 3d30 2e31 290a 2020   timeout=0.1).  
-00009670: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00009680: 2020 2020 2020 2020 2320 496e 2061 6c6c          # In all
-00009690: 206f 7468 6572 2063 6173 6573 2c20 7765   other cases, we
-000096a0: 2063 616e 2075 7365 2074 6865 206f 7269   can use the ori
-000096b0: 6769 6e61 6c2e 0a20 2020 2020 2020 2020  ginal..         
-000096c0: 2020 206a 6f69 6e5f 6f72 6967 2874 6872     join_orig(thr
-000096d0: 6561 645f 6f62 6a2c 2074 696d 656f 7574  ead_obj, timeout
-000096e0: 3d74 696d 656f 7574 290a 0a20 2020 2074  =timeout)..    t
-000096f0: 6872 6561 6469 6e67 2e54 6872 6561 642e  hreading.Thread.
-00009700: 6a6f 696e 203d 206a 6f69 6e5f 6861 636b  join = join_hack
-00009710: 6564 0a0a 2020 2020 2320 4d6f 7374 6c79  ed..    # Mostly
-00009720: 2074 6865 2073 616d 6520 666f 7220 436f   the same for Co
-00009730: 6e64 6974 696f 6e2e 7761 6974 2829 2e0a  ndition.wait()..
-00009740: 2020 2020 6966 2050 5933 3a0a 2020 2020      if PY3:.    
-00009750: 2020 2020 2320 6874 7470 733a 2f2f 796f      # https://yo
-00009760: 7574 7261 636b 2e6a 6574 6272 6169 6e73  utrack.jetbrains
-00009770: 2e63 6f6d 2f69 7373 7565 2f50 592d 3334  .com/issue/PY-34
-00009780: 3938 330a 2020 2020 2020 2020 2320 6e6f  983.        # no
-00009790: 696e 7370 6563 7469 6f6e 2050 7950 6570  inspection PyPep
-000097a0: 384e 616d 696e 670a 2020 2020 2020 2020  8Naming.        
-000097b0: 436f 6e64 6974 696f 6e20 3d20 7468 7265  Condition = thre
-000097c0: 6164 696e 672e 436f 6e64 6974 696f 6e0a  ading.Condition.
-000097d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000097e0: 2020 2320 6e6f 696e 7370 6563 7469 6f6e    # noinspection
-000097f0: 2050 7955 6e72 6573 6f6c 7665 6452 6566   PyUnresolvedRef
-00009800: 6572 656e 6365 732c 5079 5065 7038 4e61  erences,PyPep8Na
-00009810: 6d69 6e67 2c50 7950 726f 7465 6374 6564  ming,PyProtected
-00009820: 4d65 6d62 6572 0a20 2020 2020 2020 2043  Member.        C
-00009830: 6f6e 6469 7469 6f6e 203d 2074 6872 6561  ondition = threa
-00009840: 6469 6e67 2e5f 436f 6e64 6974 696f 6e0a  ding._Condition.
-00009850: 2020 2020 636f 6e64 5f77 6169 745f 6f72      cond_wait_or
-00009860: 6967 203d 2043 6f6e 6469 7469 6f6e 2e77  ig = Condition.w
-00009870: 6169 740a 0a20 2020 2023 206e 6f69 6e73  ait..    # noins
-00009880: 7065 6374 696f 6e20 5079 556e 7573 6564  pection PyUnused
-00009890: 4c6f 6361 6c0a 2020 2020 6465 6620 636f  Local.    def co
-000098a0: 6e64 5f77 6169 745f 6861 636b 6564 2863  nd_wait_hacked(c
-000098b0: 6f6e 642c 2074 696d 656f 7574 3d4e 6f6e  ond, timeout=Non
-000098c0: 652c 202a 6172 6773 293a 0a20 2020 2020  e, *args):.     
-000098d0: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
-000098e0: 7061 7261 6d20 436f 6e64 6974 696f 6e20  param Condition 
-000098f0: 636f 6e64 3a0a 2020 2020 2020 2020 3a70  cond:.        :p
-00009900: 6172 616d 2066 6c6f 6174 7c4e 6f6e 6520  aram float|None 
-00009910: 7469 6d65 6f75 743a 0a20 2020 2020 2020  timeout:.       
-00009920: 203a 7061 7261 6d20 6172 6773 3a0a 2020   :param args:.  
-00009930: 2020 2020 2020 3a72 7479 7065 3a20 626f        :rtype: bo
-00009940: 6f6c 0a20 2020 2020 2020 2022 2222 0a20  ol.        """. 
-00009950: 2020 2020 2020 2069 6620 7468 7265 6164         if thread
-00009960: 2e67 6574 5f69 6465 6e74 2829 203d 3d20  .get_ident() == 
-00009970: 6d61 696e 5f74 6872 6561 645f 6964 3a0a  main_thread_id:.
-00009980: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-00009990: 696d 656f 7574 2069 7320 4e6f 6e65 3a0a  imeout is None:.
-000099a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099b0: 2320 5573 6520 6120 7469 6d65 6f75 7420  # Use a timeout 
-000099c0: 616e 7977 6179 2e20 5468 6973 2073 686f  anyway. This sho
-000099d0: 756c 6420 6e6f 7420 6d61 7474 6572 2066  uld not matter f
-000099e0: 6f72 2074 6865 2075 6e64 6572 6c79 696e  or the underlyin
-000099f0: 6720 636f 6465 2e0a 2020 2020 2020 2020  g code..        
-00009a00: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00009a10: 6f6e 645f 7761 6974 5f6f 7269 6728 636f  ond_wait_orig(co
-00009a20: 6e64 2c20 7469 6d65 6f75 743d 302e 3129  nd, timeout=0.1)
-00009a30: 2020 2320 6e6f 7161 2020 2320 6874 7470    # noqa  # http
-00009a40: 733a 2f2f 796f 7574 7261 636b 2e6a 6574  s://youtrack.jet
-00009a50: 6272 6169 6e73 2e63 6f6d 2f69 7373 7565  brains.com/issue
-00009a60: 2f50 592d 3433 3931 350a 2020 2020 2020  /PY-43915.      
-00009a70: 2020 2020 2020 2320 5468 6572 6520 6973        # There is
-00009a80: 2073 6f6d 6520 636f 6465 2028 652e 672e   some code (e.g.
-00009a90: 206d 756c 7469 7072 6f63 6573 7369 6e67   multiprocessing
-00009aa0: 2e70 6f6f 6c29 2077 6869 6368 2072 656c  .pool) which rel
-00009ab0: 6965 7320 6f6e 2074 6861 740a 2020 2020  ies on that.    
-00009ac0: 2020 2020 2020 2020 2320 7765 2072 6573          # we res
-00009ad0: 7065 6374 2074 6865 2072 6561 6c20 7370  pect the real sp
-00009ae0: 6563 6966 6965 6420 7469 6d65 6f75 742e  ecified timeout.
-00009af0: 0a20 2020 2020 2020 2020 2020 2023 2048  .            # H
-00009b00: 6f77 6576 6572 2c20 7765 2063 616e 6e6f  owever, we canno
-00009b10: 7420 646f 206d 756c 7469 706c 6520 7265  t do multiple re
-00009b20: 7065 6174 6564 2063 616c 6c73 2074 6f20  peated calls to 
-00009b30: 636f 6e64 5f77 6169 745f 6f72 6967 2061  cond_wait_orig a
-00009b40: 7320 7765 206d 6967 6874 206d 6973 7320  s we might miss 
-00009b50: 7468 6520 636f 6e64 6974 696f 6e20 6e6f  the condition no
-00009b60: 7469 6679 2e0a 2020 2020 2020 2020 2020  tify..          
-00009b70: 2020 2320 4275 7420 696e 2073 6f6d 6520    # But in some 
-00009b80: 5079 7468 6f6e 2076 6572 7369 6f6e 732c  Python versions,
-00009b90: 2074 6865 2075 6e64 6572 6c79 696e 6720   the underlying 
-00009ba0: 636f 6e64 5f77 6169 745f 6f72 6967 2077  cond_wait_orig w
-00009bb0: 696c 6c20 616e 7977 6179 2061 6c73 6f20  ill anyway also 
-00009bc0: 7573 6520 736c 6565 702e 0a20 2020 2020  use sleep..     
-00009bd0: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-00009be0: 6e64 5f77 6169 745f 6f72 6967 2863 6f6e  nd_wait_orig(con
-00009bf0: 642c 2074 696d 656f 7574 3d74 696d 656f  d, timeout=timeo
-00009c00: 7574 2920 2023 206e 6f71 610a 2020 2020  ut)  # noqa.    
-00009c10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00009c20: 2020 2020 2020 7265 7475 726e 2063 6f6e        return con
-00009c30: 645f 7761 6974 5f6f 7269 6728 636f 6e64  d_wait_orig(cond
-00009c40: 2c20 7469 6d65 6f75 743d 7469 6d65 6f75  , timeout=timeou
-00009c50: 7429 2020 2320 6e6f 7161 0a0a 2020 2020  t)  # noqa..    
-00009c60: 436f 6e64 6974 696f 6e2e 7761 6974 203d  Condition.wait =
-00009c70: 2063 6f6e 645f 7761 6974 5f68 6163 6b65   cond_wait_hacke
-00009c80: 640a 0a20 2020 2023 2041 6e64 2074 6865  d..    # And the
-00009c90: 2073 616d 6520 666f 7220 4c6f 636b 2e61   same for Lock.a
-00009ca0: 6371 7569 7265 2c20 7665 7279 2073 696d  cquire, very sim
-00009cb0: 696c 6172 2074 6f20 436f 6e64 6974 696f  ilar to Conditio
-00009cc0: 6e2e 7761 6974 2e0a 2020 2020 2320 486f  n.wait..    # Ho
-00009cd0: 7765 7665 723a 2063 616e 2774 2073 6574  wever: can't set
-00009ce0: 2061 7474 7269 6275 7465 7320 6f66 2062   attributes of b
-00009cf0: 7569 6c74 2d69 6e2f 6578 7465 6e73 696f  uilt-in/extensio
-00009d00: 6e20 7479 7065 2027 7468 7265 6164 2e6c  n type 'thread.l
-00009d10: 6f63 6b27 2e0a 2020 2020 2320 5765 2063  ock'..    # We c
-00009d20: 6f75 6c64 2077 7261 7020 7468 6520 7768  ould wrap the wh
-00009d30: 6f6c 6520 7468 7265 6164 696e 672e 4c6f  ole threading.Lo
-00009d40: 636b 2c20 6275 7420 7468 6174 2069 7320  ck, but that is 
-00009d50: 746f 6f20 616e 6e6f 7969 6e67 2066 6f72  too annoying for
-00009d60: 206d 6520 6e6f 772e 2e2e 0a20 2020 2023   me now....    #
-00009d70: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
-00009d80: 5065 7038 4e61 6d69 6e67 0a20 2020 204c  Pep8Naming.    L
-00009d90: 6f63 6b20 3d20 4e6f 6e65 0a20 2020 2069  ock = None.    i
-00009da0: 6620 4c6f 636b 3a0a 2020 2020 2020 2020  f Lock:.        
-00009db0: 6c6f 636b 5f61 6371 7569 7265 5f6f 7269  lock_acquire_ori
-00009dc0: 6720 3d20 4c6f 636b 2e61 6371 7569 7265  g = Lock.acquire
-00009dd0: 2020 2320 6e6f 7161 0a0a 2020 2020 2020    # noqa..      
-00009de0: 2020 2320 4e6f 7465 3a20 7469 6d65 6f75    # Note: timeou
-00009df0: 7420 6172 6775 6d65 6e74 2077 6173 2069  t argument was i
-00009e00: 6e74 726f 6475 6365 6420 696e 2050 7974  ntroduced in Pyt
-00009e10: 686f 6e20 332e 0a20 2020 2020 2020 2064  hon 3..        d
-00009e20: 6566 206c 6f63 6b5f 6163 7175 6972 655f  ef lock_acquire_
-00009e30: 6861 636b 6564 286c 6f63 6b2c 2062 6c6f  hacked(lock, blo
-00009e40: 636b 696e 673d 5472 7565 2c20 7469 6d65  cking=True, time
-00009e50: 6f75 743d 2d31 293a 0a20 2020 2020 2020  out=-1):.       
-00009e60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00009e70: 2020 2020 203a 7061 7261 6d20 7468 7265       :param thre
-00009e80: 6164 696e 672e 4c6f 636b 206c 6f63 6b3a  ading.Lock lock:
-00009e90: 0a20 2020 2020 2020 2020 2020 203a 7061  .            :pa
-00009ea0: 7261 6d20 626f 6f6c 2062 6c6f 636b 696e  ram bool blockin
-00009eb0: 673a 0a20 2020 2020 2020 2020 2020 203a  g:.            :
-00009ec0: 7061 7261 6d20 666c 6f61 7420 7469 6d65  param float time
-00009ed0: 6f75 743a 0a20 2020 2020 2020 2020 2020  out:.           
-00009ee0: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
-00009ef0: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
-00009f00: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00009f10: 2062 6c6f 636b 696e 673a 0a20 2020 2020   blocking:.     
-00009f20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00009f30: 6e20 6c6f 636b 5f61 6371 7569 7265 5f6f  n lock_acquire_o
-00009f40: 7269 6728 6c6f 636b 2c20 626c 6f63 6b69  rig(lock, blocki
-00009f50: 6e67 3d46 616c 7365 2920 2023 206e 6f20  ng=False)  # no 
-00009f60: 7469 6d65 6f75 7420 6966 206e 6f74 2062  timeout if not b
-00009f70: 6c6f 636b 696e 670a 2020 2020 2020 2020  locking.        
-00009f80: 2020 2020 2320 4576 6572 7974 6869 6e67      # Everything
-00009f90: 2069 7320 626c 6f63 6b69 6e67 206e 6f77   is blocking now
-00009fa0: 2e0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00009fb0: 2074 6872 6561 642e 6765 745f 6964 656e   thread.get_iden
-00009fc0: 7428 2920 3d3d 206d 6169 6e5f 7468 7265  t() == main_thre
-00009fd0: 6164 5f69 643a 0a20 2020 2020 2020 2020  ad_id:.         
-00009fe0: 2020 2020 2020 2069 6620 7469 6d65 6f75         if timeou
-00009ff0: 7420 6973 204e 6f6e 6520 6f72 2074 696d  t is None or tim
-0000a000: 656f 7574 203c 2030 3a20 2023 2062 6c6f  eout < 0:  # blo
-0000a010: 636b 696e 6720 7769 7468 6f75 7420 7469  cking without ti
-0000a020: 6d65 6f75 740a 2020 2020 2020 2020 2020  meout.          
-0000a030: 2020 2020 2020 2020 2020 6966 2050 5933            if PY3
-0000a040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a050: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-0000a060: 6e6f 7420 6c6f 636b 5f61 6371 7569 7265  not lock_acquire
-0000a070: 5f6f 7269 6728 6c6f 636b 2c20 626c 6f63  _orig(lock, bloc
-0000a080: 6b69 6e67 3d54 7275 652c 2074 696d 656f  king=True, timeo
-0000a090: 7574 3d30 2e31 293a 0a20 2020 2020 2020  ut=0.1):.       
-0000a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0b0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-0000a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0d0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-0000a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0f0: 2020 656c 7365 3a20 2023 2050 7974 686f    else:  # Pytho
-0000a100: 6e20 322e 2063 616e 6e6f 7420 7573 6520  n 2. cannot use 
-0000a110: 7469 6d65 6f75 740a 2020 2020 2020 2020  timeout.        
-0000a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a130: 7768 696c 6520 6e6f 7420 6c6f 636b 5f61  while not lock_a
-0000a140: 6371 7569 7265 5f6f 7269 6728 6c6f 636b  cquire_orig(lock
-0000a150: 2c20 626c 6f63 6b69 6e67 3d46 616c 7365  , blocking=False
-0000a160: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000a170: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000a180: 696d 652e 736c 6565 7028 302e 3129 0a20  ime.sleep(0.1). 
-0000a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1a0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-0000a1b0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0000a1c0: 2020 2065 6c73 653a 2020 2320 7469 6d65     else:  # time
-0000a1d0: 6f75 7420 6973 2073 6574 2e20 2843 616e  out is set. (Can
-0000a1e0: 206f 6e6c 7920 6265 2077 6974 6820 5079   only be with Py
-0000a1f0: 7468 6f6e 2033 2e29 0a20 2020 2020 2020  thon 3.).       
-0000a200: 2020 2020 2020 2020 2020 2020 2023 2055               # U
-0000a210: 7365 2061 2063 6170 7065 6420 7469 6d65  se a capped time
-0000a220: 6f75 742e 2054 6869 7320 7368 6f75 6c64  out. This should
-0000a230: 206e 6f74 206d 6174 7465 7220 666f 7220   not matter for 
-0000a240: 7468 6520 756e 6465 726c 7969 6e67 2063  the underlying c
-0000a250: 6f64 652e 0a20 2020 2020 2020 2020 2020  ode..           
-0000a260: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000a270: 6c6f 636b 5f61 6371 7569 7265 5f6f 7269  lock_acquire_ori
-0000a280: 6728 6c6f 636b 2c20 626c 6f63 6b69 6e67  g(lock, blocking
-0000a290: 3d54 7275 652c 2074 696d 656f 7574 3d6d  =True, timeout=m
-0000a2a0: 696e 2874 696d 656f 7574 2c20 302e 3129  in(timeout, 0.1)
-0000a2b0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-0000a2c0: 4661 6c6c 6261 636b 2074 6f20 6465 6661  Fallback to defa
-0000a2d0: 756c 742e 0a20 2020 2020 2020 2020 2020  ult..           
-0000a2e0: 2069 6620 5059 333a 0a20 2020 2020 2020   if PY3:.       
-0000a2f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000a300: 6c6f 636b 5f61 6371 7569 7265 5f6f 7269  lock_acquire_ori
-0000a310: 6728 6c6f 636b 2c20 626c 6f63 6b69 6e67  g(lock, blocking
-0000a320: 3d54 7275 652c 2074 696d 656f 7574 3d74  =True, timeout=t
-0000a330: 696d 656f 7574 290a 2020 2020 2020 2020  imeout).        
-0000a340: 2020 2020 7265 7475 726e 206c 6f63 6b5f      return lock_
-0000a350: 6163 7175 6972 655f 6f72 6967 286c 6f63  acquire_orig(loc
-0000a360: 6b2c 2062 6c6f 636b 696e 673d 5472 7565  k, blocking=True
-0000a370: 290a 0a20 2020 2020 2020 204c 6f63 6b2e  )..        Lock.
-0000a380: 6163 7175 6972 6520 3d20 6c6f 636b 5f61  acquire = lock_a
-0000a390: 6371 7569 7265 5f68 6163 6b65 640a 0a0a  cquire_hacked...
-0000a3a0: 6465 6620 7374 6172 745f 6461 656d 6f6e  def start_daemon
-0000a3b0: 5f74 6872 6561 6428 7461 7267 6574 2c20  _thread(target, 
-0000a3c0: 6172 6773 3d28 2929 3a0a 2020 2020 2222  args=()):.    ""
-0000a3d0: 220a 2020 2020 3a70 6172 616d 2028 292d  ".    :param ()-
-0000a3e0: 3e4e 6f6e 6520 7461 7267 6574 3a0a 2020  >None target:.  
-0000a3f0: 2020 3a70 6172 616d 2074 7570 6c65 2061    :param tuple a
-0000a400: 7267 733a 0a20 2020 203a 7265 7475 726e  rgs:.    :return
-0000a410: 3a20 6e6f 7468 696e 670a 2020 2020 2222  : nothing.    ""
-0000a420: 220a 2020 2020 6672 6f6d 2074 6872 6561  ".    from threa
-0000a430: 6469 6e67 2069 6d70 6f72 7420 5468 7265  ding import Thre
-0000a440: 6164 0a0a 2020 2020 7420 3d20 5468 7265  ad..    t = Thre
-0000a450: 6164 2874 6172 6765 743d 7461 7267 6574  ad(target=target
-0000a460: 2c20 6172 6773 3d61 7267 7329 0a20 2020  , args=args).   
-0000a470: 2074 2e64 6165 6d6f 6e20 3d20 5472 7565   t.daemon = True
-0000a480: 0a20 2020 2074 2e73 7461 7274 2829 0a0a  .    t.start()..
-0000a490: 0a64 6566 2069 735f 7175 6974 7469 6e67  .def is_quitting
-0000a4a0: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
-0000a4b0: 3a72 6574 7572 6e3a 2077 6865 7468 6572  :return: whether
-0000a4c0: 2077 6520 6172 6520 6375 7272 656e 746c   we are currentl
-0000a4d0: 7920 7175 6974 7469 6e67 2028 7669 6120  y quitting (via 
-0000a4e0: 3a66 756e 633a 6072 6e6e 2e66 696e 616c  :func:`rnn.final
-0000a4f0: 697a 6560 290a 2020 2020 3a72 7479 7065  ize`).    :rtype
-0000a500: 3a20 626f 6f6c 0a20 2020 2022 2222 0a20  : bool.    """. 
-0000a510: 2020 2069 6d70 6f72 7420 7265 7475 726e     import return
-0000a520: 6e2e 5f5f 6d61 696e 5f5f 2061 7320 726e  n.__main__ as rn
-0000a530: 6e0a 0a20 2020 2069 6620 726e 6e2e 7175  n..    if rnn.qu
-0000a540: 6974 5f72 6574 7572 6e6e 3a20 2023 2076  it_returnn:  # v
-0000a550: 6961 2072 6e6e 2e66 696e 616c 697a 6528  ia rnn.finalize(
-0000a560: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000a570: 2054 7275 650a 2020 2020 6966 2067 6574   True.    if get
-0000a580: 6174 7472 2873 7973 2c20 2265 7869 7465  attr(sys, "exite
-0000a590: 6422 2c20 4661 6c73 6529 3a20 2023 2073  d", False):  # s
-0000a5a0: 6574 2076 6961 2044 6562 7567 206d 6f64  et via Debug mod
-0000a5b0: 756c 6520 7768 656e 2061 6e20 756e 6578  ule when an unex
-0000a5c0: 7065 6374 6564 2053 4947 494e 5420 6f63  pected SIGINT oc
-0000a5d0: 6375 7273 2c20 6f72 2068 6572 650a 2020  curs, or here.  
-0000a5e0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-0000a5f0: 650a 2020 2020 7265 7475 726e 2046 616c  e.    return Fal
-0000a600: 7365 0a0a 0a64 6566 2069 6e74 6572 7275  se...def interru
-0000a610: 7074 5f6d 6169 6e28 293a 0a20 2020 2022  pt_main():.    "
-0000a620: 2222 0a20 2020 2053 656e 6473 203a 636c  "".    Sends :cl
-0000a630: 6173 733a 604b 6579 626f 6172 6449 6e74  ass:`KeyboardInt
-0000a640: 6572 7275 7074 6020 746f 2074 6865 206d  errupt` to the m
-0000a650: 6169 6e20 7468 7265 6164 2e0a 0a20 2020  ain thread...   
-0000a660: 203a 7265 7475 726e 3a20 6e6f 7468 696e   :return: nothin
-0000a670: 670a 2020 2020 2222 220a 2020 2020 2320  g.    """.    # 
-0000a680: 6e6f 696e 7370 6563 7469 6f6e 2050 7950  noinspection PyP
-0000a690: 726f 7465 6374 6564 4d65 6d62 6572 2c50  rotectedMember,P
-0000a6a0: 7955 6e72 6573 6f6c 7665 6452 6566 6572  yUnresolvedRefer
-0000a6b0: 656e 6365 730a 2020 2020 6973 5f6d 6169  ences.    is_mai
-0000a6c0: 6e5f 7468 7265 6164 203d 2069 7369 6e73  n_thread = isins
-0000a6d0: 7461 6e63 6528 7468 7265 6164 696e 672e  tance(threading.
-0000a6e0: 6375 7272 656e 7454 6872 6561 6428 292c  currentThread(),
-0000a6f0: 2074 6872 6561 6469 6e67 2e5f 4d61 696e   threading._Main
-0000a700: 5468 7265 6164 290a 2020 2020 6966 2069  Thread).    if i
-0000a710: 735f 7175 6974 7469 6e67 2829 3a20 2023  s_quitting():  #
-0000a720: 2069 676e 6f72 6520 6966 2077 6520 6172   ignore if we ar
-0000a730: 6520 616c 7265 6164 7920 7175 6974 7469  e already quitti
-0000a740: 6e67 0a20 2020 2020 2020 2069 6620 6973  ng.        if is
-0000a750: 5f6d 6169 6e5f 7468 7265 6164 3a20 2023  _main_thread:  #
-0000a760: 2073 7472 616e 6765 2074 6f20 6765 7420   strange to get 
-0000a770: 6167 6169 6e20 696e 206d 6169 6e20 7468  again in main th
-0000a780: 7265 6164 0a20 2020 2020 2020 2020 2020  read.           
-0000a790: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-0000a7a0: 2822 696e 7465 7272 7570 745f 6d61 696e  ("interrupt_main
-0000a7b0: 2829 2066 726f 6d20 6d61 696e 2074 6872  () from main thr
-0000a7c0: 6561 6420 7768 696c 6520 616c 7265 6164  ead while alread
-0000a7d0: 7920 7175 6974 7469 6e67 2229 0a20 2020  y quitting").   
-0000a7e0: 2020 2020 2023 204e 6f74 206d 6169 6e20       # Not main 
-0000a7f0: 7468 7265 6164 2e20 5468 6973 2077 696c  thread. This wil
-0000a800: 6c20 6a75 7374 2065 7869 7420 7468 6520  l just exit the 
-0000a810: 7468 7265 6164 2e0a 2020 2020 2020 2020  thread..        
-0000a820: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
-0000a830: 7379 732e 6578 6974 6564 203d 2054 7275  sys.exited = Tru
-0000a840: 6520 2023 2044 6f6e 2774 2064 6f20 6974  e  # Don't do it
-0000a850: 2074 7769 6365 2e0a 2020 2020 2320 6e6f   twice..    # no
-0000a860: 696e 7370 6563 7469 6f6e 2050 7950 726f  inspection PyPro
-0000a870: 7465 6374 6564 4d65 6d62 6572 2c50 7955  tectedMember,PyU
-0000a880: 6e72 6573 6f6c 7665 6452 6566 6572 656e  nresolvedReferen
-0000a890: 6365 730a 2020 2020 7379 732e 6578 6974  ces.    sys.exit
-0000a8a0: 6564 5f66 7261 6d65 203d 2073 7973 2e5f  ed_frame = sys._
-0000a8b0: 6765 7466 7261 6d65 2829 0a20 2020 2069  getframe().    i
-0000a8c0: 6620 6973 5f6d 6169 6e5f 7468 7265 6164  f is_main_thread
-0000a8d0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-0000a8e0: 4b65 7962 6f61 7264 496e 7465 7272 7570  KeyboardInterrup
-0000a8f0: 740a 2020 2020 656c 7365 3a0a 2020 2020  t.    else:.    
-0000a900: 2020 2020 7468 7265 6164 2e69 6e74 6572      thread.inter
-0000a910: 7275 7074 5f6d 6169 6e28 290a 2020 2020  rupt_main().    
-0000a920: 2020 2020 7379 732e 6578 6974 2831 2920      sys.exit(1) 
-0000a930: 2023 2041 6e64 2065 7869 7420 7468 6520   # And exit the 
-0000a940: 7468 7265 6164 2e0a 0a0a 636c 6173 7320  thread....class 
-0000a950: 4173 796e 6354 6872 6561 6452 756e 2874  AsyncThreadRun(t
-0000a960: 6872 6561 6469 6e67 2e54 6872 6561 6429  hreading.Thread)
-0000a970: 3a0a 2020 2020 2222 220a 2020 2020 4461  :.    """.    Da
-0000a980: 656d 6f6e 2074 6872 6561 642c 2077 7261  emon thread, wra
-0000a990: 7070 696e 6720 736f 6d65 2066 756e 6374  pping some funct
-0000a9a0: 696f 6e20 6060 6675 6e63 6060 2076 6961  ion ``func`` via
-0000a9b0: 203a 6675 6e63 3a60 7772 6170 5f61 7379   :func:`wrap_asy
-0000a9c0: 6e63 5f66 756e 6360 2e0a 2020 2020 2222  nc_func`..    ""
-0000a9d0: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-0000a9e0: 745f 5f28 7365 6c66 2c20 6e61 6d65 2c20  t__(self, name, 
-0000a9f0: 6675 6e63 293a 0a20 2020 2020 2020 2022  func):.        "
-0000aa00: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
-0000aa10: 6d20 7374 7220 6e61 6d65 3a0a 2020 2020  m str name:.    
-0000aa20: 2020 2020 3a70 6172 616d 2028 292d 3e54      :param ()->T
-0000aa30: 2066 756e 633a 0a20 2020 2020 2020 2022   func:.        "
-0000aa40: 2222 0a20 2020 2020 2020 2073 7570 6572  "".        super
-0000aa50: 2841 7379 6e63 5468 7265 6164 5275 6e2c  (AsyncThreadRun,
-0000aa60: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
-0000aa70: 6e61 6d65 3d6e 616d 652c 2074 6172 6765  name=name, targe
-0000aa80: 743d 7365 6c66 2e6d 6169 6e29 0a20 2020  t=self.main).   
-0000aa90: 2020 2020 2073 656c 662e 6675 6e63 203d       self.func =
-0000aaa0: 2066 756e 630a 2020 2020 2020 2020 7365   func.        se
-0000aab0: 6c66 2e72 6573 756c 7420 3d20 4e6f 6e65  lf.result = None
-0000aac0: 0a20 2020 2020 2020 2073 656c 662e 6461  .        self.da
-0000aad0: 656d 6f6e 203d 2054 7275 650a 2020 2020  emon = True.    
-0000aae0: 2020 2020 7365 6c66 2e73 7461 7274 2829      self.start()
-0000aaf0: 0a0a 2020 2020 6465 6620 6d61 696e 2873  ..    def main(s
-0000ab00: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0000ab10: 220a 2020 2020 2020 2020 5468 7265 6164  ".        Thread
-0000ab20: 2074 6172 6765 7420 6675 6e63 7469 6f6e   target function
-0000ab30: 2e0a 0a20 2020 2020 2020 203a 7265 7475  ...        :retu
-0000ab40: 726e 3a20 6e6f 7468 696e 672c 2077 696c  rn: nothing, wil
-0000ab50: 6c20 6a75 7374 2073 6574 2073 656c 662e  l just set self.
-0000ab60: 7265 7375 6c74 0a20 2020 2020 2020 2022  result.        "
-0000ab70: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-0000ab80: 7265 7375 6c74 203d 2077 7261 705f 6173  result = wrap_as
-0000ab90: 796e 635f 6675 6e63 2873 656c 662e 6675  ync_func(self.fu
-0000aba0: 6e63 290a 0a20 2020 2064 6566 2067 6574  nc)..    def get
-0000abb0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000abc0: 2222 220a 2020 2020 2020 2020 3a72 6574  """.        :ret
-0000abd0: 7572 6e3a 206a 6f69 6e73 2074 6865 2074  urn: joins the t
-0000abe0: 6872 6561 642c 2061 6e64 2074 6865 6e20  hread, and then 
-0000abf0: 7265 7475 726e 7320 7468 6520 7265 7375  returns the resu
-0000ac00: 6c74 0a20 2020 2020 2020 203a 7274 7970  lt.        :rtyp
-0000ac10: 653a 2054 0a20 2020 2020 2020 2022 2222  e: T.        """
-0000ac20: 0a20 2020 2020 2020 2073 656c 662e 6a6f  .        self.jo
-0000ac30: 696e 2829 0a20 2020 2020 2020 2072 6574  in().        ret
-0000ac40: 7572 6e20 7365 6c66 2e72 6573 756c 740a  urn self.result.
-0000ac50: 0a0a 6465 6620 7772 6170 5f61 7379 6e63  ..def wrap_async
-0000ac60: 5f66 756e 6328 6629 3a0a 2020 2020 2222  _func(f):.    ""
-0000ac70: 220a 2020 2020 4361 6c6c 7320 6060 6628  ".    Calls ``f(
-0000ac80: 2960 6020 616e 6420 7265 7475 726e 7320  )`` and returns 
-0000ac90: 7468 6520 7265 7375 6c74 2e0a 2020 2020  the result..    
-0000aca0: 5772 6170 7065 6420 7570 2077 6974 6820  Wrapped up with 
-0000acb0: 6361 7463 6869 6e67 2061 6c6c 2065 7863  catching all exc
-0000acc0: 6570 7469 6f6e 732c 2070 7269 6e74 696e  eptions, printin
-0000acd0: 6720 7374 6163 6b20 7472 6163 652c 2061  g stack trace, a
-0000ace0: 6e64 203a 6675 6e63 3a60 696e 7465 7272  nd :func:`interr
-0000acf0: 7570 745f 6d61 696e 602e 0a0a 2020 2020  upt_main`...    
-0000ad00: 3a70 6172 616d 2028 292d 3e54 2066 3a0a  :param ()->T f:.
-0000ad10: 2020 2020 3a72 7479 7065 3a20 540a 2020      :rtype: T.  
-0000ad20: 2020 2222 220a 2020 2020 2320 6e6f 696e    """.    # noin
-0000ad30: 7370 6563 7469 6f6e 2050 7942 726f 6164  spection PyBroad
-0000ad40: 4578 6365 7074 696f 6e0a 2020 2020 7472  Exception.    tr
-0000ad50: 793a 0a20 2020 2020 2020 2066 726f 6d20  y:.        from 
-0000ad60: 7265 7475 726e 6e2e 7574 696c 2069 6d70  returnn.util imp
-0000ad70: 6f72 7420 6265 7474 6572 5f65 7863 686f  ort better_excho
-0000ad80: 6f6b 0a0a 2020 2020 2020 2020 6265 7474  ok..        bett
-0000ad90: 6572 5f65 7863 686f 6f6b 2e69 6e73 7461  er_exchook.insta
-0000ada0: 6c6c 2829 0a20 2020 2020 2020 2072 6574  ll().        ret
-0000adb0: 7572 6e20 6628 290a 2020 2020 6578 6365  urn f().    exce
-0000adc0: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-0000add0: 2020 2020 2020 7379 732e 6578 6365 7074        sys.except
-0000ade0: 686f 6f6b 282a 7379 732e 6578 635f 696e  hook(*sys.exc_in
-0000adf0: 666f 2829 290a 2020 2020 2020 2020 696e  fo()).        in
-0000ae00: 7465 7272 7570 745f 6d61 696e 2829 0a0a  terrupt_main()..
-0000ae10: 0a64 6566 2074 7279 5f72 756e 2866 756e  .def try_run(fun
-0000ae20: 632c 2061 7267 733d 2829 2c20 6361 7463  c, args=(), catc
-0000ae30: 685f 6578 633d 4578 6365 7074 696f 6e2c  h_exc=Exception,
-0000ae40: 2064 6566 6175 6c74 3d4e 6f6e 6529 3a0a   default=None):.
-0000ae50: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
-0000ae60: 616d 2028 2858 292d 3e54 2920 6675 6e63  am ((X)->T) func
-0000ae70: 3a0a 2020 2020 3a70 6172 616d 2074 7570  :.    :param tup
-0000ae80: 6c65 2061 7267 733a 0a20 2020 203a 7061  le args:.    :pa
-0000ae90: 7261 6d20 7479 7065 5b45 7863 6570 7469  ram type[Excepti
-0000aea0: 6f6e 5d20 6361 7463 685f 6578 633a 0a20  on] catch_exc:. 
-0000aeb0: 2020 203a 7061 7261 6d20 5432 2064 6566     :param T2 def
-0000aec0: 6175 6c74 3a0a 2020 2020 3a72 6574 7572  ault:.    :retur
-0000aed0: 6e3a 2065 6974 6865 7220 6060 6675 6e63  n: either ``func
-0000aee0: 2829 6060 206f 7220 6060 6465 6661 756c  ()`` or ``defaul
-0000aef0: 7460 6020 6966 2074 6865 7265 2077 6173  t`` if there was
-0000af00: 2073 6f6d 6520 6578 6365 7074 696f 6e0a   some exception.
-0000af10: 2020 2020 3a72 7479 7065 3a20 547c 5432      :rtype: T|T2
-0000af20: 0a20 2020 2022 2222 0a20 2020 2023 206e  .    """.    # n
-0000af30: 6f69 6e73 7065 6374 696f 6e20 5079 4272  oinspection PyBr
-0000af40: 6f61 6445 7863 6570 7469 6f6e 0a20 2020  oadException.   
-0000af50: 2074 7279 3a0a 2020 2020 2020 2020 7265   try:.        re
-0000af60: 7475 726e 2066 756e 6328 2a61 7267 7329  turn func(*args)
-0000af70: 0a20 2020 2065 7863 6570 7420 6361 7463  .    except catc
-0000af80: 685f 6578 633a 0a20 2020 2020 2020 2072  h_exc:.        r
-0000af90: 6574 7572 6e20 6465 6661 756c 740a 0a0a  eturn default...
-0000afa0: 6465 6620 7661 6c69 6461 7465 5f62 726f  def validate_bro
-0000afb0: 6164 6361 7374 5f61 6c6c 5f73 6f75 7263  adcast_all_sourc
-0000afc0: 6573 2861 6c6c 6f77 5f62 726f 6164 6361  es(allow_broadca
-0000afd0: 7374 5f61 6c6c 5f73 6f75 7263 6573 2c20  st_all_sources, 
-0000afe0: 696e 7075 7473 2c20 636f 6d6d 6f6e 293a  inputs, common):
-0000aff0: 0a20 2020 2022 2222 0a20 2020 2043 616c  .    """.    Cal
-0000b000: 6c20 7468 6973 2077 6865 6e20 616c 6c20  l this when all 
-0000b010: 696e 7075 7473 2074 6f20 736f 6d65 206f  inputs to some o
-0000b020: 7065 7261 7469 6f6e 2028 6c61 7965 7229  peration (layer)
-0000b030: 206d 7573 7420 6265 2062 726f 6164 6361   must be broadca
-0000b040: 7374 6564 2e0a 2020 2020 4974 2063 6865  sted..    It che
-0000b050: 636b 7320 7768 6574 6865 7220 6272 6f61  cks whether broa
-0000b060: 6463 6173 7469 6e67 2074 6f20 616c 6c20  dcasting to all 
-0000b070: 736f 7572 6365 7320 7368 6f75 6c64 2062  sources should b
-0000b080: 6520 616c 6c6f 7765 642e 0a20 2020 2045  e allowed..    E
-0000b090: 2e67 2e20 666f 7220 696e 7075 7420 5b42  .g. for input [B
-0000b0a0: 2c54 312c 4431 5d20 2b20 5b42 2c54 322c  ,T1,D1] + [B,T2,
-0000b0b0: 4432 5d2c 2077 6865 6e20 616c 6c6f 7765  D2], when allowe
-0000b0c0: 642c 2069 7420 776f 756c 6420 6272 6f61  d, it would broa
-0000b0d0: 6463 6173 7420 746f 205b 422c 5431 2c54  dcast to [B,T1,T
-0000b0e0: 322c 4431 2c44 325d 2e0a 2020 2020 5768  2,D1,D2]..    Wh
-0000b0f0: 656e 206e 6f74 2061 6c6c 6f77 6564 2c20  en not allowed, 
-0000b100: 7468 6572 6520 6d75 7374 2062 6520 6174  there must be at
-0000b110: 206c 6561 7374 206f 6e65 2073 6f75 7263   least one sourc
-0000b120: 6520 7768 6572 6520 6e6f 2062 726f 6164  e where no broad
-0000b130: 6361 7374 696e 6720 7769 6c6c 2062 6520  casting will be 
-0000b140: 646f 6e65 2e0a 2020 2020 5768 6574 6865  done..    Whethe
-0000b150: 7220 6974 2069 7320 616c 6c6f 7765 642c  r it is allowed,
-0000b160: 2074 6869 7320 6465 7065 6e64 7320 6f6e   this depends on
-0000b170: 2074 6865 2062 6568 6176 696f 7220 7665   the behavior ve
-0000b180: 7273 696f 6e2e 0a20 2020 2020 2068 7474  rsion..      htt
-0000b190: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
-0000b1a0: 7277 7468 2d69 362f 7265 7475 726e 6e2f  rwth-i6/returnn/
-0000b1b0: 6973 7375 6573 2f36 3931 0a0a 2020 2020  issues/691..    
-0000b1c0: 436f 6d6d 6f6e 2075 7361 6765 7320 6172  Common usages ar
-0000b1d0: 6520 666f 7220 3a66 756e 633a 6067 6574  e for :func:`get
-0000b1e0: 5f63 6f6d 6d6f 6e5f 7368 6170 6560 206f  _common_shape` o
-0000b1f0: 7220 3a66 756e 633a 6044 6174 612e 6765  r :func:`Data.ge
-0000b200: 745f 636f 6d6d 6f6e 5f64 6174 6160 2e0a  t_common_data`..
-0000b210: 0a20 2020 203a 7061 7261 6d20 626f 6f6c  .    :param bool
-0000b220: 7c4e 6f74 5370 6563 6966 6965 6420 616c  |NotSpecified al
-0000b230: 6c6f 775f 6272 6f61 6463 6173 745f 616c  low_broadcast_al
-0000b240: 6c5f 736f 7572 6365 733a 0a20 2020 203a  l_sources:.    :
-0000b250: 7061 7261 6d20 696e 7075 7473 3a20 616e  param inputs: an
-0000b260: 7974 6869 6e67 2063 6f6e 7665 7274 6962  ything convertib
-0000b270: 6c65 2074 6f20 6974 6572 6162 6c65 206f  le to iterable o
-0000b280: 6620 7374 722c 2075 7365 6420 666f 7220  f str, used for 
-0000b290: 7265 706f 7274 696e 670a 2020 2020 3a70  reporting.    :p
-0000b2a0: 6172 616d 2063 6f6d 6d6f 6e3a 2061 6e79  aram common: any
-0000b2b0: 7468 696e 6720 636f 6e76 6572 7469 626c  thing convertibl
-0000b2c0: 6520 746f 2073 7472 2c20 7573 6564 2066  e to str, used f
-0000b2d0: 6f72 2072 6570 6f72 7469 6e67 0a20 2020  or reporting.   
-0000b2e0: 2022 2222 0a20 2020 206d 7367 203d 2028   """.    msg = (
-0000b2f0: 0a20 2020 2020 2020 2022 416c 6c20 696e  .        "All in
-0000b300: 7075 7473 5c6e 2573 5c6e 7265 7175 6972  puts\n%s\nrequir
-0000b310: 6520 6272 6f61 6463 6173 7469 6e67 2074  e broadcasting t
-0000b320: 6f20 5c6e 2020 2573 2e5c 6e22 2025 2028  o \n  %s.\n" % (
-0000b330: 225c 6e22 2e6a 6f69 6e28 2220 2d20 2573  "\n".join(" - %s
-0000b340: 2220 2520 696e 7020 666f 7220 696e 7020  " % inp for inp 
-0000b350: 696e 2069 6e70 7574 7329 2c20 636f 6d6d  in inputs), comm
-0000b360: 6f6e 290a 2020 2020 2020 2020 2b20 2254  on).        + "T
-0000b370: 6869 7320 6d75 7374 2062 6520 6578 706c  his must be expl
-0000b380: 6963 6974 6c79 2061 6c6c 6f77 6564 2c20  icitly allowed, 
-0000b390: 652e 672e 2062 7920 7370 6563 6966 7969  e.g. by specifyi
-0000b3a0: 6e67 206f 7574 5f73 6861 7065 2e22 0a20  ng out_shape.". 
-0000b3b0: 2020 2029 0a20 2020 2069 6620 616c 6c6f     ).    if allo
-0000b3c0: 775f 6272 6f61 6463 6173 745f 616c 6c5f  w_broadcast_all_
-0000b3d0: 736f 7572 6365 7320 6973 204e 6f74 5370  sources is NotSp
-0000b3e0: 6563 6966 6965 643a 0a20 2020 2020 2020  ecified:.       
-0000b3f0: 2066 726f 6d20 7265 7475 726e 6e2e 7574   from returnn.ut
-0000b400: 696c 2069 6d70 6f72 7420 4265 6861 7669  il import Behavi
-0000b410: 6f72 5665 7273 696f 6e0a 0a20 2020 2020  orVersion..     
-0000b420: 2020 2042 6568 6176 696f 7256 6572 7369     BehaviorVersi
-0000b430: 6f6e 2e72 6571 7569 7265 2876 6572 7369  on.require(versi
-0000b440: 6f6e 3d34 2c20 636f 6e64 6974 696f 6e3d  on=4, condition=
-0000b450: 4661 6c73 652c 206d 6573 7361 6765 3d6d  False, message=m
-0000b460: 7367 290a 2020 2020 2020 2020 7265 7475  sg).        retu
-0000b470: 726e 0a20 2020 2069 6620 616c 6c6f 775f  rn.    if allow_
-0000b480: 6272 6f61 6463 6173 745f 616c 6c5f 736f  broadcast_all_so
-0000b490: 7572 6365 733a 0a20 2020 2020 2020 2072  urces:.        r
-0000b4a0: 6574 7572 6e0a 2020 2020 7261 6973 6520  eturn.    raise 
-0000b4b0: 4578 6365 7074 696f 6e28 6d73 6729 0a0a  Exception(msg)..
-0000b4c0: 0a64 6566 2063 6c61 7373 5f69 6478 5f73  .def class_idx_s
-0000b4d0: 6571 5f74 6f5f 315f 6f66 5f6b 2873 6571  eq_to_1_of_k(seq
-0000b4e0: 2c20 6e75 6d5f 636c 6173 7365 7329 3a0a  , num_classes):.
-0000b4f0: 2020 2020 2222 220a 2020 2020 4261 7369      """.    Basi
-0000b500: 6361 6c6c 7920 6f6e 655f 686f 742e 0a0a  cally one_hot...
-0000b510: 2020 2020 3a70 6172 616d 206c 6973 745b      :param list[
-0000b520: 696e 745d 7c6e 702e 6e64 6172 7261 7920  int]|np.ndarray 
-0000b530: 7365 713a 0a20 2020 203a 7061 7261 6d20  seq:.    :param 
-0000b540: 696e 7420 6e75 6d5f 636c 6173 7365 733a  int num_classes:
-0000b550: 0a20 2020 203a 7274 7970 653a 206e 702e  .    :rtype: np.
-0000b560: 6e64 6172 7261 790a 2020 2020 2222 220a  ndarray.    """.
-0000b570: 2020 2020 6e75 6d5f 6672 616d 6573 203d      num_frames =
-0000b580: 206c 656e 2873 6571 290a 2020 2020 6d20   len(seq).    m 
-0000b590: 3d20 6e70 2e7a 6572 6f73 2828 6e75 6d5f  = np.zeros((num_
-0000b5a0: 6672 616d 6573 2c20 6e75 6d5f 636c 6173  frames, num_clas
-0000b5b0: 7365 7329 2c20 6474 7970 653d 2266 6c6f  ses), dtype="flo
-0000b5c0: 6174 3332 2229 0a20 2020 206d 5b6e 702e  at32").    m[np.
-0000b5d0: 6172 616e 6765 286e 756d 5f66 7261 6d65  arange(num_frame
-0000b5e0: 7329 2c20 7365 715d 203d 2031 0a20 2020  s), seq] = 1.   
-0000b5f0: 2072 6574 7572 6e20 6d0a 0a0a 6465 6620   return m...def 
-0000b600: 756e 6971 2873 6571 293a 0a20 2020 2022  uniq(seq):.    "
-0000b610: 2222 0a20 2020 204c 696b 6520 556e 6978  "".    Like Unix
-0000b620: 2074 6f6f 6c20 756e 6971 2e20 5265 6d6f   tool uniq. Remo
-0000b630: 7665 7320 7265 7065 6174 6564 2065 6e74  ves repeated ent
-0000b640: 7269 6573 2e0a 2020 2020 5365 6520 3a66  ries..    See :f
-0000b650: 756e 633a 6075 6e69 715f 6765 6e65 7269  unc:`uniq_generi
-0000b660: 6360 2066 6f72 2061 2067 656e 6572 6963  c` for a generic
-0000b670: 2028 6e6f 6e2d 4e75 6d70 7929 2076 6572   (non-Numpy) ver
-0000b680: 7369 6f6e 2e0a 0a20 2020 203a 7061 7261  sion...    :para
-0000b690: 6d20 6e75 6d70 792e 6e64 6172 7261 7920  m numpy.ndarray 
-0000b6a0: 7365 713a 0a20 2020 203a 7265 7475 726e  seq:.    :return
-0000b6b0: 3a20 7365 710a 2020 2020 3a72 7479 7065  : seq.    :rtype
-0000b6c0: 3a20 6e75 6d70 792e 6e64 6172 7261 790a  : numpy.ndarray.
-0000b6d0: 2020 2020 2222 220a 2020 2020 6469 6666      """.    diff
-0000b6e0: 7320 3d20 6e70 2e6f 6e65 735f 6c69 6b65  s = np.ones_like
-0000b6f0: 2873 6571 290a 2020 2020 6469 6666 735b  (seq).    diffs[
-0000b700: 313a 5d20 3d20 7365 715b 313a 5d20 2d20  1:] = seq[1:] - 
-0000b710: 7365 715b 3a2d 315d 0a20 2020 2069 6478  seq[:-1].    idx
-0000b720: 203d 2064 6966 6673 2e6e 6f6e 7a65 726f   = diffs.nonzero
-0000b730: 2829 0a20 2020 2072 6574 7572 6e20 7365  ().    return se
-0000b740: 715b 6964 785d 0a0a 0a64 6566 2075 6e69  q[idx]...def uni
-0000b750: 715f 6765 6e65 7269 6328 7365 7129 3a0a  q_generic(seq):.
-0000b760: 2020 2020 2222 220a 2020 2020 4c69 6b65      """.    Like
-0000b770: 2055 6e69 7820 746f 6f6c 2075 6e69 712e   Unix tool uniq.
-0000b780: 2052 656d 6f76 6573 2072 6570 6561 7465   Removes repeate
-0000b790: 6420 656e 7472 6965 732e 0a20 2020 2053  d entries..    S
-0000b7a0: 6565 203a 6675 6e63 3a60 756e 6971 6020  ee :func:`uniq` 
-0000b7b0: 666f 7220 616e 2065 6666 6963 6965 6e74  for an efficient
-0000b7c0: 204e 756d 7079 2069 6d70 6c65 6d65 6e74   Numpy implement
-0000b7d0: 6174 696f 6e2e 0a20 2020 2053 6565 203a  ation..    See :
-0000b7e0: 6675 6e63 3a60 7265 7475 726e 6e2e 7466  func:`returnn.tf
-0000b7f0: 2e75 7469 6c2e 6261 7369 632e 756e 6971  .util.basic.uniq
-0000b800: 6020 666f 7220 616e 2065 6666 6963 6965  ` for an efficie
-0000b810: 6e74 2054 4620 696d 706c 656d 656e 7461  nt TF implementa
-0000b820: 7469 6f6e 2e0a 0a20 2020 203a 7061 7261  tion...    :para
-0000b830: 6d20 6c69 7374 5b54 5d7c 7475 706c 655b  m list[T]|tuple[
-0000b840: 545d 2073 6571 3a0a 2020 2020 3a72 6574  T] seq:.    :ret
-0000b850: 7572 6e3a 2073 6571 0a20 2020 203a 7274  urn: seq.    :rt
-0000b860: 7970 653a 206c 6973 745b 545d 0a20 2020  ype: list[T].   
-0000b870: 2022 2222 0a20 2020 206f 7574 203d 205b   """.    out = [
-0000b880: 5d0a 2020 2020 7669 7369 7465 6420 3d20  ].    visited = 
-0000b890: 7365 7428 290a 2020 2020 666f 7220 7820  set().    for x 
-0000b8a0: 696e 2073 6571 3a0a 2020 2020 2020 2020  in seq:.        
-0000b8b0: 6966 2078 2069 6e20 7669 7369 7465 643a  if x in visited:
-0000b8c0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-0000b8d0: 7469 6e75 650a 2020 2020 2020 2020 6f75  tinue.        ou
-0000b8e0: 742e 6170 7065 6e64 2878 290a 2020 2020  t.append(x).    
-0000b8f0: 2020 2020 7669 7369 7465 642e 6164 6428      visited.add(
-0000b900: 7829 0a20 2020 2072 6574 7572 6e20 6f75  x).    return ou
-0000b910: 740a 0a0a 6465 6620 736c 6963 655f 7061  t...def slice_pa
-0000b920: 645f 7a65 726f 7328 782c 2062 6567 696e  d_zeros(x, begin
-0000b930: 2c20 656e 642c 2061 7869 733d 3029 3a0a  , end, axis=0):.
-0000b940: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
-0000b950: 616d 206e 756d 7079 2e6e 6461 7272 6179  am numpy.ndarray
-0000b960: 2078 3a20 6f66 2073 6861 7065 2028 2e2e   x: of shape (..
-0000b970: 2e2c 2074 696d 652c 202e 2e2e 290a 2020  ., time, ...).  
-0000b980: 2020 3a70 6172 616d 2069 6e74 2062 6567    :param int beg
-0000b990: 696e 3a0a 2020 2020 3a70 6172 616d 2069  in:.    :param i
-0000b9a0: 6e74 2065 6e64 3a0a 2020 2020 3a70 6172  nt end:.    :par
-0000b9b0: 616d 2069 6e74 2061 7869 733a 0a20 2020  am int axis:.   
-0000b9c0: 203a 7265 7475 726e 3a20 6261 7369 6361   :return: basica
-0000b9d0: 6c6c 7920 785b 6265 6769 6e3a 656e 645d  lly x[begin:end]
-0000b9e0: 2028 7769 7468 2061 7869 733d 3d30 2920   (with axis==0) 
-0000b9f0: 6275 7420 6966 2062 6567 696e 203c 2030  but if begin < 0
-0000ba00: 206f 7220 656e 6420 3e20 782e 7368 6170   or end > x.shap
-0000ba10: 655b 305d 2c0a 2020 2020 2069 7420 7769  e[0],.     it wi
-0000ba20: 6c6c 206e 6f74 2064 6973 6361 7264 2074  ll not discard t
-0000ba30: 6865 7365 2066 7261 6d65 7320 6275 7420  hese frames but 
-0000ba40: 7061 6420 7a65 726f 732c 2073 7563 6820  pad zeros, such 
-0000ba50: 7468 6174 2074 6865 2072 6573 756c 7469  that the resulti
-0000ba60: 6e67 2073 6861 7065 5b30 5d20 3d3d 2065  ng shape[0] == e
-0000ba70: 6e64 202d 2062 6567 696e 2e0a 2020 2020  nd - begin..    
-0000ba80: 3a72 7479 7065 3a20 6e75 6d70 792e 6e64  :rtype: numpy.nd
-0000ba90: 6172 7261 790a 2020 2020 2222 220a 2020  array.    """.  
-0000baa0: 2020 6173 7365 7274 2061 7869 7320 3d3d    assert axis ==
-0000bab0: 2030 2c20 226e 6f74 2079 6574 2066 756c   0, "not yet ful
-0000bac0: 6c79 2069 6d70 6c65 6d65 6e74 6564 206f  ly implemented o
-0000bad0: 7468 6572 7769 7365 220a 2020 2020 7061  therwise".    pa
-0000bae0: 645f 6c65 6674 2c20 7061 645f 7269 6768  d_left, pad_righ
-0000baf0: 7420 3d20 302c 2030 0a20 2020 2069 6620  t = 0, 0.    if 
-0000bb00: 6265 6769 6e20 3c20 303a 0a20 2020 2020  begin < 0:.     
-0000bb10: 2020 2070 6164 5f6c 6566 7420 3d20 2d62     pad_left = -b
-0000bb20: 6567 696e 0a20 2020 2020 2020 2062 6567  egin.        beg
-0000bb30: 696e 203d 2030 0a20 2020 2065 6c69 6620  in = 0.    elif 
-0000bb40: 6265 6769 6e20 3e3d 2078 2e73 6861 7065  begin >= x.shape
-0000bb50: 5b61 7869 735d 3a0a 2020 2020 2020 2020  [axis]:.        
-0000bb60: 7265 7475 726e 206e 702e 7a65 726f 7328  return np.zeros(
-0000bb70: 2865 6e64 202d 2062 6567 696e 2c29 202b  (end - begin,) +
-0000bb80: 2078 2e73 6861 7065 5b31 3a5d 2c20 6474   x.shape[1:], dt
-0000bb90: 7970 653d 782e 6474 7970 6529 0a20 2020  ype=x.dtype).   
-0000bba0: 2061 7373 6572 7420 656e 6420 3e3d 2062   assert end >= b
-0000bbb0: 6567 696e 0a20 2020 2069 6620 656e 6420  egin.    if end 
-0000bbc0: 3e20 782e 7368 6170 655b 6178 6973 5d3a  > x.shape[axis]:
-0000bbd0: 0a20 2020 2020 2020 2070 6164 5f72 6967  .        pad_rig
-0000bbe0: 6874 203d 2065 6e64 202d 2078 2e73 6861  ht = end - x.sha
-0000bbf0: 7065 5b61 7869 735d 0a20 2020 2020 2020  pe[axis].       
-0000bc00: 2065 6e64 203d 2078 2e73 6861 7065 5b61   end = x.shape[a
-0000bc10: 7869 735d 0a20 2020 2072 6574 7572 6e20  xis].    return 
-0000bc20: 6e70 2e70 6164 2878 5b62 6567 696e 3a65  np.pad(x[begin:e
-0000bc30: 6e64 5d2c 205b 2870 6164 5f6c 6566 742c  nd], [(pad_left,
-0000bc40: 2070 6164 5f72 6967 6874 295d 202b 205b   pad_right)] + [
-0000bc50: 2830 2c20 3029 5d20 2a20 2878 2e6e 6469  (0, 0)] * (x.ndi
-0000bc60: 6d20 2d20 3129 2c20 6d6f 6465 3d22 636f  m - 1), mode="co
-0000bc70: 6e73 7461 6e74 2229 0a0a 0a64 6566 2072  nstant")...def r
-0000bc80: 616e 646f 6d5f 6f72 7468 6f67 6f6e 616c  andom_orthogonal
-0000bc90: 2873 6861 7065 2c20 6761 696e 3d31 2e30  (shape, gain=1.0
-0000bca0: 2c20 7365 6564 3d4e 6f6e 6529 3a0a 2020  , seed=None):.  
-0000bcb0: 2020 2222 220a 2020 2020 5265 7475 726e    """.    Return
-0000bcc0: 7320 6120 7261 6e64 6f6d 206f 7274 686f  s a random ortho
-0000bcd0: 676f 6e61 6c20 6d61 7472 6978 206f 6620  gonal matrix of 
-0000bce0: 7468 6520 6769 7665 6e20 7368 6170 652e  the given shape.
-0000bcf0: 0a20 2020 2043 6f64 6520 626f 7272 6f77  .    Code borrow
-0000bd00: 6564 2061 6e64 2061 6461 7074 6564 2066  ed and adapted f
-0000bd10: 726f 6d20 4b65 7261 733a 2068 7474 7073  rom Keras: https
-0000bd20: 3a2f 2f67 6974 6875 622e 636f 6d2f 6663  ://github.com/fc
-0000bd30: 686f 6c6c 6574 2f6b 6572 6173 2f62 6c6f  hollet/keras/blo
-0000bd40: 622f 6d61 7374 6572 2f6b 6572 6173 2f69  b/master/keras/i
-0000bd50: 6e69 7469 616c 697a 6572 732e 7079 0a20  nitializers.py. 
-0000bd60: 2020 2052 6566 6572 656e 6365 3a20 5361     Reference: Sa
-0000bd70: 7865 2065 7420 616c 2e2c 2068 7474 7073  xe et al., https
-0000bd80: 3a2f 2f61 7278 6976 2e6f 7267 2f61 6273  ://arxiv.org/abs
-0000bd90: 2f31 3331 322e 3631 3230 0a20 2020 2052  /1312.6120.    R
-0000bda0: 656c 6174 6564 3a20 556e 6974 6172 7920  elated: Unitary 
-0000bdb0: 4576 6f6c 7574 696f 6e20 5265 6375 7272  Evolution Recurr
-0000bdc0: 656e 7420 4e65 7572 616c 204e 6574 776f  ent Neural Netwo
-0000bdd0: 726b 732c 2068 7474 7073 3a2f 2f61 7278  rks, https://arx
-0000bde0: 6976 2e6f 7267 2f61 6273 2f31 3531 312e  iv.org/abs/1511.
-0000bdf0: 3036 3436 340a 0a20 2020 203a 7061 7261  06464..    :para
-0000be00: 6d20 7475 706c 655b 696e 745d 2073 6861  m tuple[int] sha
-0000be10: 7065 3a0a 2020 2020 3a70 6172 616d 2066  pe:.    :param f
-0000be20: 6c6f 6174 2067 6169 6e3a 0a20 2020 203a  loat gain:.    :
-0000be30: 7061 7261 6d20 696e 7420 7365 6564 3a20  param int seed: 
-0000be40: 666f 7220 4e75 6d70 7920 7261 6e64 6f6d  for Numpy random
-0000be50: 2067 656e 6572 6174 6f72 0a20 2020 203a   generator.    :
-0000be60: 7265 7475 726e 3a20 7261 6e64 6f6d 206f  return: random o
-0000be70: 7274 686f 676f 6e61 6c20 6d61 7472 6978  rthogonal matrix
-0000be80: 0a20 2020 203a 7274 7970 653a 206e 756d  .    :rtype: num
-0000be90: 7079 2e6e 6461 7272 6179 0a20 2020 2022  py.ndarray.    "
-0000bea0: 2222 0a20 2020 206e 756d 5f72 6f77 7320  "".    num_rows 
-0000beb0: 3d20 310a 2020 2020 666f 7220 6469 6d20  = 1.    for dim 
-0000bec0: 696e 2073 6861 7065 5b3a 2d31 5d3a 0a20  in shape[:-1]:. 
-0000bed0: 2020 2020 2020 206e 756d 5f72 6f77 7320         num_rows 
-0000bee0: 2a3d 2064 696d 0a20 2020 206e 756d 5f63  *= dim.    num_c
-0000bef0: 6f6c 7320 3d20 7368 6170 655b 2d31 5d0a  ols = shape[-1].
-0000bf00: 2020 2020 666c 6174 5f73 6861 7065 203d      flat_shape =
-0000bf10: 2028 6e75 6d5f 726f 7773 2c20 6e75 6d5f   (num_rows, num_
-0000bf20: 636f 6c73 290a 2020 2020 6966 2073 6565  cols).    if see
-0000bf30: 6420 6973 206e 6f74 204e 6f6e 653a 0a20  d is not None:. 
-0000bf40: 2020 2020 2020 2072 6e64 203d 206e 702e         rnd = np.
-0000bf50: 7261 6e64 6f6d 2e52 616e 646f 6d53 7461  random.RandomSta
-0000bf60: 7465 2873 6565 643d 7365 6564 290a 2020  te(seed=seed).  
-0000bf70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000bf80: 726e 6420 3d20 6e70 2e72 616e 646f 6d0a  rnd = np.random.
-0000bf90: 2020 2020 6120 3d20 726e 642e 6e6f 726d      a = rnd.norm
-0000bfa0: 616c 2830 2e30 2c20 312e 302c 2066 6c61  al(0.0, 1.0, fla
-0000bfb0: 745f 7368 6170 6529 0a20 2020 2075 2c20  t_shape).    u, 
-0000bfc0: 5f2c 2076 203d 206e 702e 6c69 6e61 6c67  _, v = np.linalg
-0000bfd0: 2e73 7664 2861 2c20 6675 6c6c 5f6d 6174  .svd(a, full_mat
-0000bfe0: 7269 6365 733d 4661 6c73 6529 0a20 2020  rices=False).   
-0000bff0: 2023 2050 6963 6b20 7468 6520 6f6e 6520   # Pick the one 
-0000c000: 7769 7468 2074 6865 2063 6f72 7265 6374  with the correct
-0000c010: 2073 6861 7065 2e0a 2020 2020 7120 3d20   shape..    q = 
-0000c020: 7520 6966 2075 2e73 6861 7065 203d 3d20  u if u.shape == 
-0000c030: 666c 6174 5f73 6861 7065 2065 6c73 6520  flat_shape else 
-0000c040: 760a 2020 2020 7120 3d20 712e 7265 7368  v.    q = q.resh
-0000c050: 6170 6528 7368 6170 6529 0a20 2020 2072  ape(shape).    r
-0000c060: 6574 7572 6e20 6761 696e 202a 2071 5b3a  eturn gain * q[:
-0000c070: 2073 6861 7065 5b30 5d2c 203a 2073 6861   shape[0], : sha
-0000c080: 7065 5b31 5d5d 0a0a 0a23 206e 6f69 6e73  pe[1]]...# noins
-0000c090: 7065 6374 696f 6e20 5079 556e 7573 6564  pection PyUnused
-0000c0a0: 4c6f 6361 6c0a 6465 6620 696e 706c 6163  Local.def inplac
-0000c0b0: 655f 696e 6372 656d 656e 7428 782c 2069  e_increment(x, i
-0000c0c0: 6478 2c20 7929 3a0a 2020 2020 2222 220a  dx, y):.    """.
-0000c0d0: 2020 2020 5468 6973 2062 6173 6963 616c      This basical
-0000c0e0: 6c79 2064 6f65 7320 6078 5b69 6478 5d20  ly does `x[idx] 
-0000c0f0: 2b3d 2079 602e 0a20 2020 2054 6865 2064  += y`..    The d
-0000c100: 6966 6665 7265 6e63 6520 746f 2074 6865  ifference to the
-0000c110: 204e 756d 7079 2076 6572 7369 6f6e 2069   Numpy version i
-0000c120: 7320 7468 6174 2069 6e20 6361 7365 2073  s that in case s
-0000c130: 6f6d 6520 696e 6465 7820 6973 2074 6865  ome index is the
-0000c140: 7265 206d 756c 7469 706c 650a 2020 2020  re multiple.    
-0000c150: 7469 6d65 732c 2069 7420 7769 6c6c 206f  times, it will o
-0000c160: 6e6c 7920 6265 2069 6e63 7265 6d65 6e74  nly be increment
-0000c170: 6564 206f 6e63 6520 2861 6e64 2069 7420  ed once (and it 
-0000c180: 6973 206e 6f74 2073 7065 6369 6669 6564  is not specified
-0000c190: 2077 6869 6368 206f 6e65 292e 0a20 2020   which one)..   
-0000c1a0: 2053 6565 2061 6c73 6f20 7468 6561 6e6f   See also theano
-0000c1b0: 2e74 656e 736f 722e 7375 6274 656e 736f  .tensor.subtenso
-0000c1c0: 722e 4164 7661 6e63 6564 496e 6353 7562  r.AdvancedIncSub
-0000c1d0: 7465 6e73 6f72 2064 6f63 756d 656e 7461  tensor documenta
-0000c1e0: 7469 6f6e 2e0a 0a20 2020 203a 7061 7261  tion...    :para
-0000c1f0: 6d20 6e75 6d70 792e 6e64 6172 7261 7920  m numpy.ndarray 
-0000c200: 783a 0a20 2020 203a 7061 7261 6d20 6e75  x:.    :param nu
-0000c210: 6d70 792e 6e64 6172 7261 7920 6964 783a  mpy.ndarray idx:
-0000c220: 0a20 2020 203a 7061 7261 6d20 6e75 6d70  .    :param nump
-0000c230: 792e 6e64 6172 7261 7920 793a 0a20 2020  y.ndarray y:.   
-0000c240: 203a 7274 7970 653a 206e 756d 7079 2e6e   :rtype: numpy.n
-0000c250: 6461 7272 6179 0a20 2020 2022 2222 0a20  darray.    """. 
-0000c260: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-0000c270: 656d 656e 7465 6445 7272 6f72 2822 5468  ementedError("Th
-0000c280: 6973 2066 6561 7475 7265 2077 6173 2072  is feature was r
-0000c290: 656d 6f76 6564 2077 6974 6820 6472 6f70  emoved with drop
-0000c2a0: 7065 6420 5468 6561 6e6f 2073 7570 706f  ped Theano suppo
-0000c2b0: 7274 2229 0a0a 0a64 6566 2070 726f 6428  rt")...def prod(
-0000c2c0: 6c73 293a 0a20 2020 2022 2222 0a20 2020  ls):.    """.   
-0000c2d0: 203a 7061 7261 6d20 6c69 7374 5b54 5d7c   :param list[T]|
-0000c2e0: 7475 706c 655b 545d 7c6e 756d 7079 2e6e  tuple[T]|numpy.n
-0000c2f0: 6461 7272 6179 206c 733a 0a20 2020 203a  darray ls:.    :
-0000c300: 7274 7970 653a 2054 7c69 6e74 7c66 6c6f  rtype: T|int|flo
-0000c310: 6174 0a20 2020 2022 2222 0a20 2020 2069  at.    """.    i
-0000c320: 6620 6c65 6e28 6c73 2920 3d3d 2030 3a0a  f len(ls) == 0:.
-0000c330: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
-0000c340: 0a20 2020 2078 203d 206c 735b 305d 0a20  .    x = ls[0]. 
-0000c350: 2020 2066 6f72 2079 2069 6e20 6c73 5b31     for y in ls[1
-0000c360: 3a5d 3a0a 2020 2020 2020 2020 7820 2a3d  :]:.        x *=
-0000c370: 2079 0a20 2020 2072 6574 7572 6e20 780a   y.    return x.
-0000c380: 0a0a 6465 6620 7061 7273 655f 6f72 7468  ..def parse_orth
-0000c390: 6f67 7261 7068 795f 696e 746f 5f73 796d  ography_into_sym
-0000c3a0: 626f 6c73 280a 2020 2020 6f72 7468 6f67  bols(.    orthog
-0000c3b0: 7261 7068 792c 2075 7070 6572 5f63 6173  raphy, upper_cas
-0000c3c0: 655f 7370 6563 6961 6c3d 5472 7565 2c20  e_special=True, 
-0000c3d0: 776f 7264 5f62 6173 6564 3d46 616c 7365  word_based=False
-0000c3e0: 2c20 7371 7561 7265 5f62 7261 636b 6574  , square_bracket
-0000c3f0: 735f 666f 725f 7370 6563 6961 6c73 3d54  s_for_specials=T
-0000c400: 7275 650a 293a 0a20 2020 2022 2222 0a20  rue.):.    """. 
-0000c410: 2020 2046 6f72 2053 7065 6563 682e 0a20     For Speech.. 
-0000c420: 2020 2045 7861 6d70 6c65 3a0a 2020 2020     Example:.    
-0000c430: 2020 6f72 7468 6f67 7261 7068 7920 3d20    orthography = 
-0000c440: 2268 656c 6c6f 205b 4845 5349 5441 5449  "hello [HESITATI
-0000c450: 4f4e 5d20 7468 6572 6520 220a 2020 2020  ON] there ".    
-0000c460: 2020 7769 7468 2077 6f72 645f 6261 7365    with word_base
-0000c470: 6420 3d3d 2046 616c 7365 3a20 7265 7475  d == False: retu
-0000c480: 726e 7320 6c69 7374 2822 6865 6c6c 6f20  rns list("hello 
-0000c490: 2229 202b 205b 225b 4845 5349 5441 5449  ") + ["[HESITATI
-0000c4a0: 4f4e 5d22 5d20 2b20 6c69 7374 2822 2074  ON]"] + list(" t
-0000c4b0: 6865 7265 2022 292e 0a20 2020 2020 2077  here ")..      w
-0000c4c0: 6974 6820 776f 7264 5f62 6173 6564 203d  ith word_based =
-0000c4d0: 3d20 5472 7565 3a20 7265 7475 726e 7320  = True: returns 
-0000c4e0: 5b22 6865 6c6c 6f22 2c20 225b 4845 5349  ["hello", "[HESI
-0000c4f0: 5441 5449 4f4e 5d22 2c20 2274 6865 7265  TATION]", "there
-0000c500: 225d 0a20 2020 204e 6f20 7072 652f 706f  "].    No pre/po
-0000c510: 7374 2d70 726f 6365 7373 696e 6720 7375  st-processing su
-0000c520: 6368 2061 733a 0a20 2020 2053 7061 6365  ch as:.    Space
-0000c530: 7320 6172 6520 6b65 7074 2061 732d 6973  s are kept as-is
-0000c540: 2e20 4e6f 2073 7472 6970 7069 6e67 2061  . No stripping a
-0000c550: 7420 6265 6769 6e2f 656e 642e 2028 452e  t begin/end. (E.
-0000c560: 672e 2074 7261 696c 696e 6720 7370 6163  g. trailing spac
-0000c570: 6573 2061 7265 206e 6f74 2072 656d 6f76  es are not remov
-0000c580: 6564 2e29 0a20 2020 204e 6f20 746f 6c6f  ed.).    No tolo
-0000c590: 7765 722f 746f 7570 7065 722e 0a20 2020  wer/toupper..   
-0000c5a0: 2044 6f65 736e 2774 2061 6464 205b 4245   Doesn't add [BE
-0000c5b0: 4749 4e5d 2f5b 454e 445d 2073 796d 626f  GIN]/[END] symbo
-0000c5c0: 6c73 206f 7220 736f 2e0a 2020 2020 416e  ls or so..    An
-0000c5d0: 7920 7375 6368 206f 7065 7261 7469 6f6e  y such operation
-0000c5e0: 7320 7368 6f75 6c64 2062 6520 646f 6e65  s should be done
-0000c5f0: 2065 7870 6c69 6369 746c 7920 696e 2061   explicitly in a
-0000c600: 6e20 6164 6469 7469 6f6e 616c 2066 756e  n additional fun
-0000c610: 6374 696f 6e2e 0a20 2020 2041 6e79 7468  ction..    Anyth
-0000c620: 696e 6720 696e 205b 5d2d 6272 6163 6b65  ing in []-bracke
-0000c630: 7473 2061 7265 206d 6561 6e74 2061 7320  ts are meant as 
-0000c640: 7370 6563 6961 6c2d 7379 6d62 6f6c 732e  special-symbols.
-0000c650: 0a20 2020 2041 6c73 6f20 7365 6520 7061  .    Also see pa
-0000c660: 7273 655f 6f72 7468 6f67 7261 7068 7928  rse_orthography(
-0000c670: 2920 7768 6963 6820 696e 636c 7564 6573  ) which includes
-0000c680: 2073 6f6d 6520 7072 6570 726f 6365 7373   some preprocess
-0000c690: 696e 672e 0a0a 2020 2020 3a70 6172 616d  ing...    :param
-0000c6a0: 2073 7472 206f 7274 686f 6772 6170 6879   str orthography
-0000c6b0: 3a20 6578 616d 706c 653a 2022 6865 6c6c  : example: "hell
-0000c6c0: 6f20 5b48 4553 4954 4154 494f 4e5d 2074  o [HESITATION] t
-0000c6d0: 6865 7265 2022 0a20 2020 203a 7061 7261  here ".    :para
-0000c6e0: 6d20 626f 6f6c 2075 7070 6572 5f63 6173  m bool upper_cas
-0000c6f0: 655f 7370 6563 6961 6c3a 2077 6865 7468  e_special: wheth
-0000c700: 6572 2074 6865 2073 7065 6369 616c 2073  er the special s
-0000c710: 796d 626f 6c73 2061 7265 2061 6c77 6179  ymbols are alway
-0000c720: 7320 6d61 6465 2075 7070 6572 2063 6173  s made upper cas
-0000c730: 650a 2020 2020 3a70 6172 616d 2062 6f6f  e.    :param boo
-0000c740: 6c20 776f 7264 5f62 6173 6564 3a20 7768  l word_based: wh
-0000c750: 6574 6865 7220 7765 2073 706c 6974 206f  ether we split o
-0000c760: 6e20 7370 6163 6520 616e 6420 7265 7475  n space and retu
-0000c770: 726e 2066 756c 6c20 776f 7264 730a 2020  rn full words.  
-0000c780: 2020 3a70 6172 616d 2062 6f6f 6c20 7371    :param bool sq
-0000c790: 7561 7265 5f62 7261 636b 6574 735f 666f  uare_brackets_fo
-0000c7a0: 725f 7370 6563 6961 6c73 3a20 6861 6e64  r_specials: hand
-0000c7b0: 6c65 2022 5b2e 2e2e 5d22 0a20 2020 203a  le "[...]".    :
-0000c7c0: 7274 7970 653a 206c 6973 745b 7374 725d  rtype: list[str]
-0000c7d0: 0a20 2020 2022 2222 0a20 2020 2072 6574  .    """.    ret
-0000c7e0: 203d 205b 5d0a 2020 2020 696e 5f73 7065   = [].    in_spe
-0000c7f0: 6369 616c 203d 2030 0a20 2020 2066 6f72  cial = 0.    for
-0000c800: 2063 2069 6e20 6f72 7468 6f67 7261 7068   c in orthograph
-0000c810: 793a 0a20 2020 2020 2020 2069 6620 696e  y:.        if in
-0000c820: 5f73 7065 6369 616c 3a0a 2020 2020 2020  _special:.      
-0000c830: 2020 2020 2020 6966 2063 203d 3d20 225b        if c == "[
-0000c840: 223a 2020 2320 7370 6563 6961 6c2d 7370  ":  # special-sp
-0000c850: 6563 6961 6c0a 2020 2020 2020 2020 2020  ecial.          
-0000c860: 2020 2020 2020 696e 5f73 7065 6369 616c        in_special
-0000c870: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-0000c880: 2020 2020 2020 7265 745b 2d31 5d20 2b3d        ret[-1] +=
-0000c890: 2022 5b22 0a20 2020 2020 2020 2020 2020   "[".           
-0000c8a0: 2065 6c69 6620 6320 3d3d 2022 5d22 3a0a   elif c == "]":.
-0000c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8c0: 696e 5f73 7065 6369 616c 202d 3d20 310a  in_special -= 1.
-0000c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8e0: 7265 745b 2d31 5d20 2b3d 2022 5d22 0a20  ret[-1] += "]". 
-0000c8f0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0000c900: 7570 7065 725f 6361 7365 5f73 7065 6369  upper_case_speci
-0000c910: 616c 3a0a 2020 2020 2020 2020 2020 2020  al:.            
-0000c920: 2020 2020 7265 745b 2d31 5d20 2b3d 2063      ret[-1] += c
-0000c930: 2e75 7070 6572 2829 0a20 2020 2020 2020  .upper().       
-0000c940: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000c950: 2020 2020 2020 2020 2020 2072 6574 5b2d             ret[-
-0000c960: 315d 202b 3d20 630a 2020 2020 2020 2020  1] += c.        
-0000c970: 656c 7365 3a20 2023 206e 6f74 2069 6e5f  else:  # not in_
-0000c980: 7370 6563 6961 6c0a 2020 2020 2020 2020  special.        
-0000c990: 2020 2020 6966 2073 7175 6172 655f 6272      if square_br
-0000c9a0: 6163 6b65 7473 5f66 6f72 5f73 7065 6369  ackets_for_speci
-0000c9b0: 616c 7320 616e 6420 6320 3d3d 2022 5b22  als and c == "["
-0000c9c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c9d0: 2020 696e 5f73 7065 6369 616c 203d 2031    in_special = 1
-0000c9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c9f0: 2072 6574 202b 3d20 5b22 5b22 5d0a 2020   ret += ["["].  
-0000ca00: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca20: 6966 2077 6f72 645f 6261 7365 643a 0a20  if word_based:. 
-0000ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca40: 2020 2069 6620 632e 6973 7370 6163 6528     if c.isspace(
-0000ca50: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000ca60: 2020 2020 2020 2020 2020 2072 6574 202b             ret +
-0000ca70: 3d20 5b22 225d 0a20 2020 2020 2020 2020  = [""].         
-0000ca80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000ca90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000caa0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0000cab0: 7265 743a 0a20 2020 2020 2020 2020 2020  ret:.           
+00000170: 680a 696d 706f 7274 206e 756d 7079 0a69  h.import numpy.i
+00000180: 6d70 6f72 7420 6e75 6d70 7920 6173 206e  mport numpy as n
+00000190: 700a 696d 706f 7274 2072 650a 696d 706f  p.import re.impo
+000001a0: 7274 2074 696d 650a 696d 706f 7274 2063  rt time.import c
+000001b0: 6f6e 7465 7874 6c69 620a 0a74 7279 3a0a  ontextlib..try:.
+000001c0: 2020 2020 696d 706f 7274 2074 6872 6561      import threa
+000001d0: 640a 6578 6365 7074 2049 6d70 6f72 7445  d.except ImportE
+000001e0: 7272 6f72 3a0a 2020 2020 696d 706f 7274  rror:.    import
+000001f0: 205f 7468 7265 6164 2061 7320 7468 7265   _thread as thre
+00000200: 6164 0a69 6d70 6f72 7420 7468 7265 6164  ad.import thread
+00000210: 696e 670a 0a66 726f 6d20 696f 2069 6d70  ing..from io imp
+00000220: 6f72 7420 4279 7465 7349 4f0a 696d 706f  ort BytesIO.impo
+00000230: 7274 2074 7970 696e 670a 6672 6f6d 2072  rt typing.from r
+00000240: 6574 7572 6e6e 2e6c 6f67 2069 6d70 6f72  eturnn.log impor
+00000250: 7420 6c6f 670a 696d 706f 7274 2062 7569  t log.import bui
+00000260: 6c74 696e 730a 0a50 5933 203d 2073 7973  ltins..PY3 = sys
+00000270: 2e76 6572 7369 6f6e 5f69 6e66 6f5b 305d  .version_info[0]
+00000280: 203e 3d20 330a 0a75 6e69 636f 6465 203d   >= 3..unicode =
+00000290: 2073 7472 0a6c 6f6e 6720 3d20 696e 740a   str.long = int.
+000002a0: 2320 6e6f 696e 7370 6563 7469 6f6e 2050  # noinspection P
+000002b0: 7953 6861 646f 7769 6e67 4275 696c 7469  yShadowingBuilti
+000002c0: 6e73 0a69 6e70 7574 203d 2062 7569 6c74  ns.input = built
+000002d0: 696e 732e 696e 7075 740a 0a0a 5420 3d20  ins.input...T = 
+000002e0: 5479 7065 5661 7228 2254 2229 0a4b 203d  TypeVar("T").K =
+000002f0: 2054 7970 6556 6172 2822 4b22 290a 5620   TypeVar("K").V 
+00000300: 3d20 5479 7065 5661 7228 2256 2229 0a0a  = TypeVar("V")..
+00000310: 7265 7475 726e 6e5f 726f 6f74 5f64 6972  returnn_root_dir
+00000320: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
+00000330: 6d65 286f 732e 7061 7468 2e64 6972 6e61  me(os.path.dirna
+00000340: 6d65 286f 732e 7061 7468 2e64 6972 6e61  me(os.path.dirna
+00000350: 6d65 286f 732e 7061 7468 2e61 6273 7061  me(os.path.abspa
+00000360: 7468 285f 5f66 696c 655f 5f29 2929 290a  th(__file__)))).
+00000370: 0a0a 636c 6173 7320 4e6f 7453 7065 6369  ..class NotSpeci
+00000380: 6669 6564 286f 626a 6563 7429 3a0a 2020  fied(object):.  
+00000390: 2020 2222 220a 2020 2020 5468 6973 2069    """.    This i
+000003a0: 7320 6a75 7374 2061 2070 6c61 6365 686f  s just a placeho
+000003b0: 6c64 6572 2c20 746f 2062 6520 7573 6564  lder, to be used
+000003c0: 2061 7320 6465 6661 756c 7420 6172 6775   as default argu
+000003d0: 6d65 6e74 2074 6f20 6d61 726b 2074 6861  ment to mark tha
+000003e0: 7420 6974 2069 7320 6e6f 7420 7370 6563  t it is not spec
+000003f0: 6966 6965 642e 0a20 2020 2022 2222 0a0a  ified..    """..
+00000400: 2020 2020 6465 6620 5f5f 7374 725f 5f28      def __str__(
+00000410: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00000420: 6574 7572 6e20 224e 6f74 5370 6563 6966  eturn "NotSpecif
+00000430: 6965 6422 0a0a 2020 2020 6465 6620 5f5f  ied"..    def __
+00000440: 7265 7072 5f5f 2873 656c 6629 3a0a 2020  repr__(self):.  
+00000450: 2020 2020 2020 7265 7475 726e 2022 3c4e        return "<N
+00000460: 6f74 5370 6563 6966 6965 643e 220a 0a20  otSpecified>".. 
+00000470: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00000480: 2020 2020 6465 6620 7265 736f 6c76 6528      def resolve(
+00000490: 636c 732c 2076 616c 7565 2c20 6465 6661  cls, value, defa
+000004a0: 756c 7429 3a0a 2020 2020 2020 2020 2222  ult):.        ""
+000004b0: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+000004c0: 2054 7c4e 6f74 5370 6563 6966 6965 647c   T|NotSpecified|
+000004d0: 7479 7065 5b4e 6f74 5370 6563 6966 6965  type[NotSpecifie
+000004e0: 645d 2076 616c 7565 3a0a 2020 2020 2020  d] value:.      
+000004f0: 2020 3a70 6172 616d 2055 2064 6566 6175    :param U defau
+00000500: 6c74 3a0a 2020 2020 2020 2020 3a72 7479  lt:.        :rty
+00000510: 7065 3a20 547c 550a 2020 2020 2020 2020  pe: T|U.        
+00000520: 2222 220a 2020 2020 2020 2020 6966 2076  """.        if v
+00000530: 616c 7565 2069 7320 4e6f 7453 7065 6369  alue is NotSpeci
+00000540: 6669 6564 3a0a 2020 2020 2020 2020 2020  fied:.          
+00000550: 2020 7265 7475 726e 2064 6566 6175 6c74    return default
+00000560: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00000570: 7661 6c75 650a 0a0a 636c 6173 7320 456e  value...class En
+00000580: 7469 7479 3a0a 2020 2020 2222 220a 2020  tity:.    """.  
+00000590: 2020 5468 6973 2069 7320 6120 6765 6e65    This is a gene
+000005a0: 7269 6320 706c 6163 6568 6f6c 6465 7220  ric placeholder 
+000005b0: 7768 6963 6820 6361 6e20 6265 2075 7365  which can be use
+000005c0: 6420 666f 7220 656e 756d 7320 6f72 206f  d for enums or o
+000005d0: 7468 6572 2069 6465 6e74 6974 6965 732e  ther identities.
+000005e0: 0a20 2020 2042 7920 696e 7465 6e74 696f  .    By intentio
+000005f0: 6e20 6974 2075 7365 7320 6f62 6a65 6374  n it uses object
+00000600: 2e5f 5f65 715f 5f20 616e 6420 636f 2c20  .__eq__ and co, 
+00000610: 692e 652e 2060 6061 203d 3d20 6260 6020  i.e. ``a == b`` 
+00000620: 6966 6620 6060 6120 6973 2062 6060 2e0a  iff ``a is b``..
+00000630: 2020 2020 5468 6520 6e61 6d65 2069 7320      The name is 
+00000640: 6a75 7374 2066 6f72 2064 6562 7567 6769  just for debuggi
+00000650: 6e67 2070 7572 706f 7365 2e0a 2020 2020  ng purpose..    
+00000660: 5468 6973 2069 7320 6d6f 7265 2065 6666  This is more eff
+00000670: 6963 6965 6e74 2074 6861 6e20 7573 696e  icient than usin
+00000680: 6720 6a75 7374 2074 6865 2073 7472 696e  g just the strin
+00000690: 6720 6469 7265 6374 6c79 2069 6e20 616e  g directly in an
+000006a0: 2065 6e75 6d2e 0a20 2020 2022 2222 0a0a   enum..    """..
+000006b0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+000006c0: 2873 656c 662c 206e 616d 653d 4e6f 6e65  (self, name=None
+000006d0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+000006e0: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
+000006f0: 727c 4e6f 6e65 206e 616d 653a 0a20 2020  r|None name:.   
+00000700: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00000710: 2073 656c 662e 6e61 6d65 203d 206e 616d   self.name = nam
+00000720: 650a 0a20 2020 2064 6566 205f 5f73 7472  e..    def __str
+00000730: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+00000740: 2020 7265 7475 726e 2073 656c 662e 6e61    return self.na
+00000750: 6d65 0a0a 2020 2020 6465 6620 5f5f 7265  me..    def __re
+00000760: 7072 5f5f 2873 656c 6629 3a0a 2020 2020  pr__(self):.    
+00000770: 2020 2020 7265 7475 726e 2022 3c25 733e      return "<%s>
+00000780: 2220 2520 7365 6c66 2e6e 616d 650a 0a20  " % self.name.. 
+00000790: 2020 2064 6566 205f 5f67 6574 7374 6174     def __getstat
+000007a0: 655f 5f28 7365 6c66 293a 0a20 2020 2020  e__(self):.     
+000007b0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+000007c0: 6f6e 2822 4361 6e6e 6f74 2070 6963 6b6c  on("Cannot pickl
+000007d0: 6520 456e 7469 7479 206f 626a 6563 742e  e Entity object.
+000007e0: 2028 2572 2922 2025 2073 656c 6629 0a0a   (%r)" % self)..
+000007f0: 0a63 6c61 7373 204f 7074 696f 6e61 6c4e  .class OptionalN
+00000800: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
+00000810: 6f72 284e 6f74 496d 706c 656d 656e 7465  or(NotImplemente
+00000820: 6445 7272 6f72 293a 0a20 2020 2022 2222  dError):.    """
+00000830: 0a20 2020 2054 6869 7320 6361 6e20 6f70  .    This can op
+00000840: 7469 6f6e 616c 6c79 2062 6520 696d 706c  tionally be impl
+00000850: 656d 656e 7465 642c 2062 7574 2069 7420  emented, but it 
+00000860: 6973 206e 6f74 2072 6571 7569 7265 6420  is not required 
+00000870: 6279 2074 6865 2041 5049 2e0a 2020 2020  by the API..    
+00000880: 2222 220a 0a0a 6465 6620 6973 5f36 3462  """...def is_64b
+00000890: 6974 5f70 6c61 7466 6f72 6d28 293a 0a20  it_platform():. 
+000008a0: 2020 2022 2222 0a20 2020 203a 7265 7475     """.    :retu
+000008b0: 726e 3a20 5472 7565 2069 6620 7765 2072  rn: True if we r
+000008c0: 756e 206f 6e20 3634 6269 742c 2046 616c  un on 64bit, Fal
+000008d0: 7365 2066 6f72 2033 3262 6974 0a20 2020  se for 32bit.   
+000008e0: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
+000008f0: 2020 6874 7470 733a 2f2f 7374 6163 6b6f    https://stacko
+00000900: 7665 7266 6c6f 772e 636f 6d2f 7175 6573  verflow.com/ques
+00000910: 7469 6f6e 732f 3134 3035 3931 332f 686f  tions/1405913/ho
+00000920: 772d 646f 2d69 2d64 6574 6572 6d69 6e65  w-do-i-determine
+00000930: 2d69 662d 6d79 2d70 7974 686f 6e2d 7368  -if-my-python-sh
+00000940: 656c 6c2d 6973 2d65 7865 6375 7469 6e67  ell-is-executing
+00000950: 2d69 6e2d 3332 6269 742d 6f72 2d36 3462  -in-32bit-or-64b
+00000960: 6974 2d6d 6f64 652d 6f6e 2d6f 730a 2020  it-mode-on-os.  
+00000970: 2020 2222 220a 2020 2020 7265 7475 726e    """.    return
+00000980: 2073 7973 2e6d 6178 7369 7a65 203e 2032   sys.maxsize > 2
+00000990: 2a2a 3332 0a0a 0a63 6c61 7373 2042 6163  **32...class Bac
+000009a0: 6b65 6e64 456e 6769 6e65 3a0a 2020 2020  kendEngine:.    
+000009b0: 2222 220a 2020 2020 5374 6f72 6573 2077  """.    Stores w
+000009c0: 6869 6368 2062 6163 6b65 6e64 2065 6e67  hich backend eng
+000009d0: 696e 6520 7765 2075 7365 2069 6e20 5245  ine we use in RE
+000009e0: 5455 524e 4e2e 0a20 2020 2045 2e67 2e20  TURNN..    E.g. 
+000009f0: 5465 6e73 6f72 466c 6f77 206f 7220 5079  TensorFlow or Py
+00000a00: 546f 7263 682e 0a20 2020 2022 2222 0a0a  Torch..    """..
+00000a10: 2020 2020 5465 6e73 6f72 466c 6f77 4e65      TensorFlowNe
+00000a20: 7444 6963 7420 3d20 310a 2020 2020 5465  tDict = 1.    Te
+00000a30: 6e73 6f72 466c 6f77 203d 2032 0a20 2020  nsorFlow = 2.   
+00000a40: 2054 6f72 6368 203d 2033 2020 2320 5079   Torch = 3  # Py
+00000a50: 546f 7263 680a 2020 2020 7365 6c65 6374  Torch.    select
+00000a60: 6564 5f65 6e67 696e 6520 3d20 4e6f 6e65  ed_engine = None
+00000a70: 2020 2320 7479 7065 3a20 7479 7069 6e67    # type: typing
+00000a80: 2e4f 7074 696f 6e61 6c5b 696e 745d 2020  .Optional[int]  
+00000a90: 2320 4f6e 6520 6f66 2074 6865 2070 6f73  # One of the pos
+00000aa0: 7369 626c 6520 656e 6769 6e65 732e 0a0a  sible engines...
+00000ab0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00000ac0: 0a20 2020 2064 6566 2073 656c 6563 745f  .    def select_
+00000ad0: 656e 6769 6e65 2863 6c73 2c20 2a2c 2065  engine(cls, *, e
+00000ae0: 6e67 696e 653d 4e6f 6e65 2c20 6465 6661  ngine=None, defa
+00000af0: 756c 745f 6661 6c6c 6261 636b 5f65 6e67  ult_fallback_eng
+00000b00: 696e 653d 4e6f 6e65 2c20 636f 6e66 6967  ine=None, config
+00000b10: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00000b20: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
+00000b30: 616d 2069 6e74 2065 6e67 696e 653a 2073  am int engine: s
+00000b40: 6565 2074 6865 2067 6c6f 6261 6c20 636c  ee the global cl
+00000b50: 6173 7320 6174 7472 6962 7320 666f 7220  ass attribs for 
+00000b60: 706f 7373 6962 6c65 2076 616c 7565 730a  possible values.
+00000b70: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
+00000b80: 6e74 7c4e 6f6e 6520 6465 6661 756c 745f  nt|None default_
+00000b90: 6661 6c6c 6261 636b 5f65 6e67 696e 653a  fallback_engine:
+00000ba0: 2069 6620 656e 6769 6e65 2069 7320 4e6f   if engine is No
+00000bb0: 6e65 2061 6e64 206e 6f74 2064 6566 696e  ne and not defin
+00000bc0: 6564 2069 6e20 636f 6e66 6967 2c20 7573  ed in config, us
+00000bd0: 6520 7468 6973 0a20 2020 2020 2020 203a  e this.        :
+00000be0: 7061 7261 6d20 7265 7475 726e 6e2e 636f  param returnn.co
+00000bf0: 6e66 6967 2e43 6f6e 6669 6720 636f 6e66  nfig.Config conf
+00000c00: 6967 3a0a 2020 2020 2020 2020 2222 220a  ig:.        """.
+00000c10: 2020 2020 2020 2020 6173 7365 7274 2063          assert c
+00000c20: 6c73 2e73 656c 6563 7465 645f 656e 6769  ls.selected_engi
+00000c30: 6e65 2069 7320 4e6f 6e65 2c20 2261 6c72  ne is None, "alr
+00000c40: 6561 6479 2073 6574 220a 2020 2020 2020  eady set".      
+00000c50: 2020 6966 2065 6e67 696e 6520 6973 204e    if engine is N
+00000c60: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00000c70: 2069 6620 636f 6e66 6967 2069 7320 4e6f   if config is No
+00000c80: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00000c90: 2020 2020 6672 6f6d 2072 6574 7572 6e6e      from returnn
+00000ca0: 2e63 6f6e 6669 6720 696d 706f 7274 2067  .config import g
+00000cb0: 6574 5f67 6c6f 6261 6c5f 636f 6e66 6967  et_global_config
+00000cc0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00000cd0: 2020 636f 6e66 6967 203d 2067 6574 5f67    config = get_g
+00000ce0: 6c6f 6261 6c5f 636f 6e66 6967 2829 0a20  lobal_config(). 
+00000cf0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+00000d00: 6e66 6967 2e62 6f6f 6c28 2275 7365 5f74  nfig.bool("use_t
+00000d10: 656e 736f 7266 6c6f 7722 2c20 4661 6c73  ensorflow", Fals
+00000d20: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00000d30: 2020 2020 656e 6769 6e65 203d 2063 6c73      engine = cls
+00000d40: 2e54 656e 736f 7246 6c6f 774e 6574 4469  .TensorFlowNetDi
+00000d50: 6374 0a20 2020 2020 2020 2020 2020 2069  ct.            i
+00000d60: 6620 636f 6e66 6967 2e76 616c 7565 2822  f config.value("
+00000d70: 6261 636b 656e 6422 2c20 4e6f 6e65 293a  backend", None):
+00000d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000d90: 2062 6163 6b65 6e64 203d 2063 6f6e 6669   backend = confi
+00000da0: 672e 7661 6c75 6528 2262 6163 6b65 6e64  g.value("backend
+00000db0: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
+00000dc0: 2020 2020 2020 2020 2065 6e67 696e 6520           engine 
+00000dd0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00000de0: 2020 2020 2020 2020 2274 656e 736f 7266          "tensorf
+00000df0: 6c6f 772d 6e65 742d 6469 6374 223a 2063  low-net-dict": c
+00000e00: 6c73 2e54 656e 736f 7246 6c6f 774e 6574  ls.TensorFlowNet
+00000e10: 4469 6374 2c0a 2020 2020 2020 2020 2020  Dict,.          
+00000e20: 2020 2020 2020 2020 2020 2274 656e 736f            "tenso
+00000e30: 7266 6c6f 7722 3a20 636c 732e 5465 6e73  rflow": cls.Tens
+00000e40: 6f72 466c 6f77 2c0a 2020 2020 2020 2020  orFlow,.        
+00000e50: 2020 2020 2020 2020 2020 2020 2274 6f72              "tor
+00000e60: 6368 223a 2063 6c73 2e54 6f72 6368 2c0a  ch": cls.Torch,.
+00000e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e80: 7d5b 6261 636b 656e 645d 0a20 2020 2020  }[backend].     
+00000e90: 2020 2020 2020 2069 6620 656e 6769 6e65         if engine
+00000ea0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00000eb0: 2020 2020 2020 2020 2020 6966 2064 6566            if def
+00000ec0: 6175 6c74 5f66 616c 6c62 6163 6b5f 656e  ault_fallback_en
+00000ed0: 6769 6e65 2069 7320 6e6f 7420 4e6f 6e65  gine is not None
+00000ee0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00000ef0: 2020 2020 2020 656e 6769 6e65 203d 2064        engine = d
+00000f00: 6566 6175 6c74 5f66 616c 6c62 6163 6b5f  efault_fallback_
+00000f10: 656e 6769 6e65 0a20 2020 2020 2020 2020  engine.         
+00000f20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00000f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000f40: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+00000f50: 2822 4e6f 2062 6163 6b65 6e64 2064 6566  ("No backend def
+00000f60: 696e 6564 2e20 506c 6561 7365 2073 6574  ined. Please set
+00000f70: 2074 6865 2063 6f6e 6669 6720 6f70 7469   the config opti
+00000f80: 6f6e 2027 6261 636b 656e 6427 2e22 290a  on 'backend'.").
+00000f90: 0a20 2020 2020 2020 2023 206e 6f69 6e73  .        # noins
+00000fa0: 7065 6374 696f 6e20 5079 5072 6f74 6563  pection PyProtec
+00000fb0: 7465 644d 656d 6265 720a 2020 2020 2020  tedMember.      
+00000fc0: 2020 6672 6f6d 2072 6574 7572 6e6e 2e66    from returnn.f
+00000fd0: 726f 6e74 656e 6420 696d 706f 7274 205f  rontend import _
+00000fe0: 6261 636b 656e 640a 0a20 2020 2020 2020  backend..       
+00000ff0: 2069 6620 656e 6769 6e65 203d 3d20 636c   if engine == cl
+00001000: 732e 5465 6e73 6f72 466c 6f77 3a0a 2020  s.TensorFlow:.  
+00001010: 2020 2020 2020 2020 2020 5f62 6163 6b65            _backe
+00001020: 6e64 2e73 656c 6563 745f 6261 636b 656e  nd.select_backen
+00001030: 645f 7466 2829 0a20 2020 2020 2020 2065  d_tf().        e
+00001040: 6c69 6620 656e 6769 6e65 203d 3d20 636c  lif engine == cl
+00001050: 732e 5465 6e73 6f72 466c 6f77 4e65 7444  s.TensorFlowNetD
+00001060: 6963 743a 0a20 2020 2020 2020 2020 2020  ict:.           
+00001070: 2023 204e 6f74 6520 7468 6174 2077 6520   # Note that we 
+00001080: 6173 7375 6d65 2074 6861 7420 7468 6520  assume that the 
+00001090: 7573 6572 2077 616e 7473 2074 6865 2052  user wants the R
+000010a0: 4554 5552 4e4e 206c 6179 6572 7320 6672  ETURNN layers fr
+000010b0: 6f6e 7465 6e64 2028 5446 2d62 6173 6564  ontend (TF-based
+000010c0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+000010d0: 616e 6420 6e6f 7420 7468 6520 6c6f 772d  and not the low-
+000010e0: 6c65 7665 6c20 5446 2066 726f 6e74 656e  level TF fronten
+000010f0: 642e 0a20 2020 2020 2020 2020 2020 2023  d..            #
+00001100: 2049 6620 7765 2077 616e 7420 746f 2065   If we want to e
+00001110: 7870 6f73 6520 7468 6520 6c6f 772d 6c65  xpose the low-le
+00001120: 7665 6c20 5446 2066 726f 6e74 656e 6420  vel TF frontend 
+00001130: 746f 2074 6865 2075 7365 7220 6469 7265  to the user dire
+00001140: 6374 6c79 2061 7420 736f 6d65 2070 6f69  ctly at some poi
+00001150: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+00001160: 2320 7765 2077 6f75 6c64 206e 6565 6420  # we would need 
+00001170: 6120 6e65 7720 636f 6e66 6967 206f 7074  a new config opt
+00001180: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
+00001190: 205f 6261 636b 656e 642e 7365 6c65 6374   _backend.select
+000011a0: 5f62 6163 6b65 6e64 5f72 6574 7572 6e6e  _backend_returnn
+000011b0: 5f6c 6179 6572 735f 7466 2829 0a20 2020  _layers_tf().   
+000011c0: 2020 2020 2065 6c69 6620 656e 6769 6e65       elif engine
+000011d0: 203d 3d20 636c 732e 546f 7263 683a 0a20   == cls.Torch:. 
+000011e0: 2020 2020 2020 2020 2020 205f 6261 636b             _back
+000011f0: 656e 642e 7365 6c65 6374 5f62 6163 6b65  end.select_backe
+00001200: 6e64 5f74 6f72 6368 2829 0a20 2020 2020  nd_torch().     
+00001210: 2020 2063 6c73 2e73 656c 6563 7465 645f     cls.selected_
+00001220: 656e 6769 6e65 203d 2065 6e67 696e 650a  engine = engine.
+00001230: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00001240: 640a 2020 2020 6465 6620 6765 745f 7365  d.    def get_se
+00001250: 6c65 6374 6564 5f65 6e67 696e 6528 636c  lected_engine(cl
+00001260: 7329 202d 3e20 696e 743a 0a20 2020 2020  s) -> int:.     
+00001270: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+00001280: 7265 7475 726e 3a20 6f6e 6520 6f66 2074  return: one of t
+00001290: 6865 2063 6f6e 7374 616e 7473 2054 656e  he constants Ten
+000012a0: 736f 7246 6c6f 774e 6574 4469 6374 2c20  sorFlowNetDict, 
+000012b0: 5465 6e73 6f72 466c 6f77 2c20 546f 7263  TensorFlow, Torc
+000012c0: 680a 2020 2020 2020 2020 2222 220a 2020  h.        """.  
+000012d0: 2020 2020 2020 6966 2063 6c73 2e73 656c        if cls.sel
+000012e0: 6563 7465 645f 656e 6769 6e65 2069 7320  ected_engine is 
+000012f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00001300: 2020 7072 696e 7428 2257 4152 4e49 4e47    print("WARNING
+00001310: 3a20 4261 636b 656e 6445 6e67 696e 652e  : BackendEngine.
+00001320: 6765 745f 7365 6c65 6374 6564 5f65 6e67  get_selected_eng
+00001330: 696e 6528 2920 6361 6c6c 6564 2062 6566  ine() called bef
+00001340: 6f72 6520 7365 6c65 6374 5f65 6e67 696e  ore select_engin
+00001350: 6528 292e 222c 2066 696c 653d 6c6f 672e  e().", file=log.
+00001360: 7633 290a 2020 2020 2020 2020 2020 2020  v3).            
+00001370: 636c 732e 7365 6c65 6374 5f65 6e67 696e  cls.select_engin
+00001380: 6528 290a 2020 2020 2020 2020 7265 7475  e().        retu
+00001390: 726e 2063 6c73 2e73 656c 6563 7465 645f  rn cls.selected_
+000013a0: 656e 6769 6e65 0a0a 2020 2020 4063 6c61  engine..    @cla
+000013b0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+000013c0: 2069 735f 7465 6e73 6f72 666c 6f77 5f73   is_tensorflow_s
+000013d0: 656c 6563 7465 6428 636c 7329 3a0a 2020  elected(cls):.  
+000013e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000013f0: 2020 3a72 7479 7065 3a20 626f 6f6c 0a20    :rtype: bool. 
+00001400: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00001410: 2020 2072 6574 7572 6e20 636c 732e 6765     return cls.ge
+00001420: 745f 7365 6c65 6374 6564 5f65 6e67 696e  t_selected_engin
+00001430: 6528 2920 696e 207b 636c 732e 5465 6e73  e() in {cls.Tens
+00001440: 6f72 466c 6f77 4e65 7444 6963 742c 2063  orFlowNetDict, c
+00001450: 6c73 2e54 656e 736f 7246 6c6f 777d 0a0a  ls.TensorFlow}..
+00001460: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00001470: 0a20 2020 2064 6566 2069 735f 746f 7263  .    def is_torc
+00001480: 685f 7365 6c65 6374 6564 2863 6c73 293a  h_selected(cls):
+00001490: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000014a0: 2020 2020 203a 7274 7970 653a 2062 6f6f       :rtype: boo
+000014b0: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
+000014c0: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
+000014d0: 2e67 6574 5f73 656c 6563 7465 645f 656e  .get_selected_en
+000014e0: 6769 6e65 2829 203d 3d20 636c 732e 546f  gine() == cls.To
+000014f0: 7263 680a 0a0a 636c 6173 7320 4265 6861  rch...class Beha
+00001500: 7669 6f72 5665 7273 696f 6e3a 0a20 2020  viorVersion:.   
+00001510: 2022 2222 0a20 2020 2053 746f 7265 7320   """.    Stores 
+00001520: 7468 6520 676c 6f62 616c 2062 6568 6176  the global behav
+00001530: 696f 725f 7665 7273 696f 6e0a 0a20 2020  ior_version..   
+00001540: 2054 6865 2076 6572 7369 6f6e 2077 696c   The version wil
+00001550: 6c20 6265 2073 6574 2061 6674 6572 2074  l be set after t
+00001560: 6865 2063 6f6e 6669 6720 6973 2064 6566  he config is def
+00001570: 696e 6564 2061 7420 5f5f 6d61 696e 5f5f  ined at __main__
+00001580: 2e69 6e69 745f 636f 6e66 6967 2829 206f  .init_config() o
+00001590: 7220 456e 6769 6e65 2e5f 5f69 6e69 745f  r Engine.__init_
+000015a0: 5f28 290a 2020 2020 2222 220a 0a20 2020  _().    """..   
+000015b0: 205f 6c61 7465 7374 5f62 6568 6176 696f   _latest_behavio
+000015c0: 725f 7665 7273 696f 6e20 3d20 3136 0a20  r_version = 16. 
+000015d0: 2020 205f 6265 6861 7669 6f72 5f76 6572     _behavior_ver
+000015e0: 7369 6f6e 203d 204e 6f6e 6520 2023 2074  sion = None  # t
+000015f0: 7970 653a 2074 7970 696e 672e 4f70 7469  ype: typing.Opti
+00001600: 6f6e 616c 5b69 6e74 5d0a 2020 2020 5f6d  onal[int].    _m
+00001610: 696e 5f62 6568 6176 696f 725f 7665 7273  in_behavior_vers
+00001620: 696f 6e20 3d20 3020 2023 2074 7970 653a  ion = 0  # type:
+00001630: 2069 6e74 0a0a 2020 2020 4063 6c61 7373   int..    @class
+00001640: 6d65 7468 6f64 0a20 2020 2064 6566 2073  method.    def s
+00001650: 6574 2863 6c73 2c20 7665 7273 696f 6e29  et(cls, version)
+00001660: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00001670: 2020 2020 2020 3a70 6172 616d 2069 6e74        :param int
+00001680: 7c4e 6f6e 6520 7665 7273 696f 6e3a 0a20  |None version:. 
+00001690: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000016a0: 2020 2069 6620 7665 7273 696f 6e20 3d3d     if version ==
+000016b0: 2063 6c73 2e5f 6265 6861 7669 6f72 5f76   cls._behavior_v
+000016c0: 6572 7369 6f6e 3a0a 2020 2020 2020 2020  ersion:.        
+000016d0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+000016e0: 2020 2061 7373 6572 7420 6e6f 7420 636c     assert not cl
+000016f0: 732e 6973 5f73 6574 2829 2c20 2262 6568  s.is_set(), "beh
+00001700: 6176 696f 725f 7665 7273 696f 6e20 616c  avior_version al
+00001710: 7265 6164 7920 7365 7420 746f 2025 732c  ready set to %s,
+00001720: 2063 616e 6e6f 7420 7265 7365 7420 746f   cannot reset to
+00001730: 2025 6922 2025 2028 0a20 2020 2020 2020   %i" % (.       
+00001740: 2020 2020 2063 6c73 2e5f 6265 6861 7669       cls._behavi
+00001750: 6f72 5f76 6572 7369 6f6e 2c0a 2020 2020  or_version,.    
+00001760: 2020 2020 2020 2020 7665 7273 696f 6e2c          version,
+00001770: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00001780: 2020 2061 7373 6572 7420 7665 7273 696f     assert versio
+00001790: 6e20 3e3d 2063 6c73 2e5f 6d69 6e5f 6265  n >= cls._min_be
+000017a0: 6861 7669 6f72 5f76 6572 7369 6f6e 0a20  havior_version. 
+000017b0: 2020 2020 2020 2069 6620 7665 7273 696f         if versio
+000017c0: 6e20 3e20 636c 732e 5f6c 6174 6573 745f  n > cls._latest_
+000017d0: 6265 6861 7669 6f72 5f76 6572 7369 6f6e  behavior_version
+000017e0: 3a0a 2020 2020 2020 2020 2020 2020 6672  :.            fr
+000017f0: 6f6d 2072 6574 7572 6e6e 2069 6d70 6f72  om returnn impor
+00001800: 7420 5f5f 6c6f 6e67 5f76 6572 7369 6f6e  t __long_version
+00001810: 5f5f 0a0a 2020 2020 2020 2020 2020 2020  __..            
+00001820: 6c6f 672e 7072 696e 745f 7761 726e 696e  log.print_warnin
+00001830: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
+00001840: 2020 2022 6265 6861 7669 6f72 5f76 6572     "behavior_ver
+00001850: 7369 6f6e 2025 6920 3e20 6c61 7465 7374  sion %i > latest
+00001860: 206b 6e6f 776e 2062 6568 6176 696f 725f   known behavior_
+00001870: 7665 7273 696f 6e20 2569 2e20 220a 2020  version %i. ".  
+00001880: 2020 2020 2020 2020 2020 2020 2020 2259                "Y
+00001890: 6f75 7220 5245 5455 524e 4e20 7665 7273  our RETURNN vers
+000018a0: 696f 6e20 6973 2074 6f6f 206f 6c64 2028  ion is too old (
+000018b0: 2573 292e 2220 2520 2876 6572 7369 6f6e  %s)." % (version
+000018c0: 2c20 636c 732e 5f6c 6174 6573 745f 6265  , cls._latest_be
+000018d0: 6861 7669 6f72 5f76 6572 7369 6f6e 2c20  havior_version, 
+000018e0: 5f5f 6c6f 6e67 5f76 6572 7369 6f6e 5f5f  __long_version__
+000018f0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+00001900: 2020 2020 2020 2020 636c 732e 5f62 6568          cls._beh
+00001910: 6176 696f 725f 7665 7273 696f 6e20 3d20  avior_version = 
+00001920: 7665 7273 696f 6e0a 0a20 2020 2040 636c  version..    @cl
+00001930: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00001940: 6620 6765 7428 636c 7329 3a0a 2020 2020  f get(cls):.    
+00001950: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00001960: 3a72 7479 7065 3a20 696e 740a 2020 2020  :rtype: int.    
+00001970: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00001980: 6966 2063 6c73 2e5f 6265 6861 7669 6f72  if cls._behavior
+00001990: 5f76 6572 7369 6f6e 2069 7320 6e6f 7420  _version is not 
+000019a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000019b0: 2020 7265 7475 726e 2063 6c73 2e5f 6265    return cls._be
+000019c0: 6861 7669 6f72 5f76 6572 7369 6f6e 0a20  havior_version. 
+000019d0: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
+000019e0: 732e 6765 745f 6465 6661 756c 7428 290a  s.get_default().
+000019f0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00001a00: 640a 2020 2020 6465 6620 6765 745f 6465  d.    def get_de
+00001a10: 6661 756c 7428 636c 7329 3a0a 2020 2020  fault(cls):.    
+00001a20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00001a30: 3a72 6574 7572 6e3a 2064 6566 6175 6c74  :return: default
+00001a40: 2062 6568 6176 696f 725f 7665 7273 696f   behavior_versio
+00001a50: 6e2e 2075 7375 616c 6c79 2030 2062 7574  n. usually 0 but
+00001a60: 206d 6967 6874 2062 6520 6469 6666 6572   might be differ
+00001a70: 656e 7420 696e 2074 6573 7420 656e 7669  ent in test envi
+00001a80: 726f 6e6d 656e 740a 2020 2020 2020 2020  ronment.        
+00001a90: 3a72 7479 7065 3a20 696e 740a 2020 2020  :rtype: int.    
+00001aa0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00001ab0: 6966 206f 732e 656e 7669 726f 6e2e 6765  if os.environ.ge
+00001ac0: 7428 2252 4554 5552 4e4e 5f54 4553 5422  t("RETURNN_TEST"
+00001ad0: 2920 616e 6420 746f 5f62 6f6f 6c28 6f73  ) and to_bool(os
+00001ae0: 2e65 6e76 6972 6f6e 2e67 6574 2822 5245  .environ.get("RE
+00001af0: 5455 524e 4e5f 5445 5354 2229 293a 0a20  TURNN_TEST")):. 
+00001b00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00001b10: 6e20 636c 732e 5f6c 6174 6573 745f 6265  n cls._latest_be
+00001b20: 6861 7669 6f72 5f76 6572 7369 6f6e 0a20  havior_version. 
+00001b30: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
+00001b40: 732e 5f6d 696e 5f62 6568 6176 696f 725f  s._min_behavior_
+00001b50: 7665 7273 696f 6e0a 0a20 2020 2040 636c  version..    @cl
+00001b60: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00001b70: 6620 7365 745f 6d69 6e5f 6265 6861 7669  f set_min_behavi
+00001b80: 6f72 5f76 6572 7369 6f6e 2863 6c73 2c20  or_version(cls, 
+00001b90: 6d69 6e5f 6265 6861 7669 6f72 5f76 6572  min_behavior_ver
+00001ba0: 7369 6f6e 3a20 696e 7429 3a0a 2020 2020  sion: int):.    
+00001bb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00001bc0: 5468 6572 6520 6172 6520 736f 6d65 2052  There are some R
+00001bd0: 4554 5552 4e4e 2066 6561 7475 7265 7320  ETURNN features 
+00001be0: 7768 6963 6820 7472 6967 6765 7220 6120  which trigger a 
+00001bf0: 6869 6768 6572 206d 696e 2062 6568 6176  higher min behav
+00001c00: 696f 7220 7665 7273 696f 6e2e 0a20 2020  ior version..   
+00001c10: 2020 2020 2054 6865 206d 696e 2062 6568       The min beh
+00001c20: 6176 696f 7220 7665 7273 696f 6e20 6973  avior version is
+00001c30: 2075 7365 6420 7768 656e 206e 6f20 6265   used when no be
+00001c40: 6861 7669 6f72 2076 6572 7369 6f6e 2069  havior version i
+00001c50: 7320 6578 706c 6963 6974 6c79 2073 6574  s explicitly set
+00001c60: 2e0a 2020 2020 2020 2020 4275 7420 6974  ..        But it
+00001c70: 2069 7320 616c 736f 2061 6e20 6572 726f   is also an erro
+00001c80: 7220 6966 2061 2062 6568 6176 696f 7220  r if a behavior 
+00001c90: 7665 7273 696f 6e20 6973 2073 6574 2c20  version is set, 
+00001ca0: 6275 7420 6974 2069 7320 6c6f 7765 7220  but it is lower 
+00001cb0: 7468 616e 2074 6865 206d 696e 2062 6568  than the min beh
+00001cc0: 6176 696f 7220 7665 7273 696f 6e2e 0a0a  avior version...
+00001cd0: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
+00001ce0: 696e 5f62 6568 6176 696f 725f 7665 7273  in_behavior_vers
+00001cf0: 696f 6e3a 0a20 2020 2020 2020 2022 2222  ion:.        """
+00001d00: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00001d10: 636c 732e 5f6d 696e 5f62 6568 6176 696f  cls._min_behavio
+00001d20: 725f 7665 7273 696f 6e20 3c3d 206d 696e  r_version <= min
+00001d30: 5f62 6568 6176 696f 725f 7665 7273 696f  _behavior_versio
+00001d40: 6e20 3c3d 2063 6c73 2e5f 6c61 7465 7374  n <= cls._latest
+00001d50: 5f62 6568 6176 696f 725f 7665 7273 696f  _behavior_versio
+00001d60: 6e0a 2020 2020 2020 2020 6966 2063 6c73  n.        if cls
+00001d70: 2e5f 6265 6861 7669 6f72 5f76 6572 7369  ._behavior_versi
+00001d80: 6f6e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  on is not None:.
+00001d90: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00001da0: 7274 2063 6c73 2e5f 6265 6861 7669 6f72  rt cls._behavior
+00001db0: 5f76 6572 7369 6f6e 203e 3d20 6d69 6e5f  _version >= min_
+00001dc0: 6265 6861 7669 6f72 5f76 6572 7369 6f6e  behavior_version
+00001dd0: 0a20 2020 2020 2020 2063 6c73 2e5f 6d69  .        cls._mi
+00001de0: 6e5f 6265 6861 7669 6f72 5f76 6572 7369  n_behavior_versi
+00001df0: 6f6e 203d 206d 696e 5f62 6568 6176 696f  on = min_behavio
+00001e00: 725f 7665 7273 696f 6e0a 0a20 2020 2040  r_version..    @
+00001e10: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00001e20: 6465 6620 6973 5f73 6574 2863 6c73 293a  def is_set(cls):
+00001e30: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00001e40: 2020 2020 203a 7274 7970 653a 2062 6f6f       :rtype: boo
+00001e50: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
+00001e60: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
+00001e70: 2e5f 6265 6861 7669 6f72 5f76 6572 7369  ._behavior_versi
+00001e80: 6f6e 2069 7320 6e6f 7420 4e6f 6e65 0a0a  on is not None..
+00001e90: 2020 2020 636c 6173 7320 5265 7175 6972      class Requir
+00001ea0: 656d 656e 744e 6f74 5361 7469 7366 6965  ementNotSatisfie
+00001eb0: 6428 4578 6365 7074 696f 6e29 3a0a 2020  d(Exception):.  
+00001ec0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00001ed0: 2020 4265 6861 7669 6f72 2076 6572 7369    Behavior versi
+00001ee0: 6f6e 2072 6571 7569 7265 6d65 6e74 2069  on requirement i
+00001ef0: 7320 6e6f 7420 7361 7469 7366 6965 640a  s not satisfied.
+00001f00: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00001f10: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00001f20: 2020 6465 6620 7265 7175 6972 6528 636c    def require(cl
+00001f30: 732c 2063 6f6e 6469 7469 6f6e 2c20 6d65  s, condition, me
+00001f40: 7373 6167 652c 2076 6572 7369 6f6e 293a  ssage, version):
+00001f50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00001f60: 2020 2020 203a 7061 7261 6d20 626f 6f6c       :param bool
+00001f70: 2063 6f6e 6469 7469 6f6e 3a0a 2020 2020   condition:.    
+00001f80: 2020 2020 3a70 6172 616d 2073 7472 206d      :param str m
+00001f90: 6573 7361 6765 3a0a 2020 2020 2020 2020  essage:.        
+00001fa0: 3a70 6172 616d 2069 6e74 2076 6572 7369  :param int versi
+00001fb0: 6f6e 3a0a 2020 2020 2020 2020 2222 220a  on:.        """.
+00001fc0: 2020 2020 2020 2020 6173 7365 7274 2076          assert v
+00001fd0: 6572 7369 6f6e 203c 3d20 636c 732e 5f6c  ersion <= cls._l
+00001fe0: 6174 6573 745f 6265 6861 7669 6f72 5f76  atest_behavior_v
+00001ff0: 6572 7369 6f6e 0a20 2020 2020 2020 2069  ersion.        i
+00002000: 6620 6e6f 7420 636f 6e64 6974 696f 6e3a  f not condition:
+00002010: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00002020: 4265 6861 7669 6f72 5665 7273 696f 6e2e  BehaviorVersion.
+00002030: 6765 7428 2920 3e3d 2076 6572 7369 6f6e  get() >= version
+00002040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002050: 2020 7261 6973 6520 4265 6861 7669 6f72    raise Behavior
+00002060: 5665 7273 696f 6e2e 5265 7175 6972 656d  Version.Requirem
+00002070: 656e 744e 6f74 5361 7469 7366 6965 6428  entNotSatisfied(
+00002080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002090: 2020 2020 2022 2573 2028 7265 7175 6972       "%s (requir
+000020a0: 6564 2073 696e 6365 2062 6568 6176 696f  ed since behavio
+000020b0: 725f 7665 7273 696f 6e20 3e3d 2025 6929  r_version >= %i)
+000020c0: 2220 2520 286d 6573 7361 6765 2c20 7665  " % (message, ve
+000020d0: 7273 696f 6e29 0a20 2020 2020 2020 2020  rsion).         
+000020e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000020f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00002100: 2020 2020 2020 2020 2020 206c 6f67 2e70             log.p
+00002110: 7269 6e74 5f64 6570 7265 6361 7469 6f6e  rint_deprecation
+00002120: 5f77 6172 6e69 6e67 286d 6573 7361 6765  _warning(message
+00002130: 2c20 6265 6861 7669 6f72 5f76 6572 7369  , behavior_versi
+00002140: 6f6e 3d76 6572 7369 6f6e 290a 0a0a 6465  on=version)...de
+00002150: 6620 6765 745f 6d6f 6465 6c5f 6669 6c65  f get_model_file
+00002160: 6e61 6d65 5f70 6f73 7466 6978 2829 3a0a  name_postfix():.
+00002170: 2020 2020 2222 220a 2020 2020 3a72 6574      """.    :ret
+00002180: 7572 6e3a 206f 6e65 2070 6f73 7369 626c  urn: one possibl
+00002190: 6520 706f 7374 6669 7820 6f66 2061 2066  e postfix of a f
+000021a0: 696c 6520 7768 6963 6820 7769 6c6c 2062  ile which will b
+000021b0: 6520 7072 6573 656e 7420 7768 656e 2074  e present when t
+000021c0: 6865 206d 6f64 656c 2069 7320 7361 7665  he model is save
+000021d0: 640a 2020 2020 3a72 7479 7065 3a20 7374  d.    :rtype: st
+000021e0: 720a 2020 2020 2222 220a 2020 2020 6173  r.    """.    as
+000021f0: 7365 7274 2042 6163 6b65 6e64 456e 6769  sert BackendEngi
+00002200: 6e65 2e73 656c 6563 7465 645f 656e 6769  ne.selected_engi
+00002210: 6e65 2069 7320 6e6f 7420 4e6f 6e65 0a20  ne is not None. 
+00002220: 2020 2069 6620 4261 636b 656e 6445 6e67     if BackendEng
+00002230: 696e 652e 6973 5f74 656e 736f 7266 6c6f  ine.is_tensorflo
+00002240: 775f 7365 6c65 6374 6564 2829 3a0a 2020  w_selected():.  
+00002250: 2020 2020 2020 2320 5468 6572 6520 7769        # There wi
+00002260: 6c6c 2062 6520 6d75 6c74 6970 6c65 2066  ll be multiple f
+00002270: 696c 6573 2062 7574 2061 202a 2e6d 6574  iles but a *.met
+00002280: 6120 6669 6c65 2077 696c 6c20 616c 7761  a file will alwa
+00002290: 7973 2062 6520 7072 6573 656e 742e 0a20  ys be present.. 
+000022a0: 2020 2020 2020 2072 6574 7572 6e20 222e         return ".
+000022b0: 6d65 7461 220a 2020 2020 6966 2042 6163  meta".    if Bac
+000022c0: 6b65 6e64 456e 6769 6e65 2e69 735f 746f  kendEngine.is_to
+000022d0: 7263 685f 7365 6c65 6374 6564 2829 3a0a  rch_selected():.
+000022e0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+000022f0: 2e70 7422 0a20 2020 2072 6574 7572 6e20  .pt".    return 
+00002300: 2222 0a0a 0a64 6566 2067 6574 5f63 6865  ""...def get_che
+00002310: 636b 706f 696e 745f 6669 6c65 7061 7474  ckpoint_filepatt
+00002320: 6572 6e28 6669 6c65 7061 7468 293a 0a20  ern(filepath):. 
+00002330: 2020 2022 2222 0a20 2020 2052 656d 6f76     """.    Remov
+00002340: 6573 206f 7074 696f 6e61 6c20 2e69 6e64  es optional .ind
+00002350: 6578 206f 7220 2e6d 6574 6120 6578 7465  ex or .meta exte
+00002360: 6e73 696f 6e0a 0a20 2020 203a 7061 7261  nsion..    :para
+00002370: 6d20 7374 7220 6669 6c65 7061 7468 3a0a  m str filepath:.
+00002380: 2020 2020 3a72 6574 7572 6e3a 2043 6865      :return: Che
+00002390: 636b 706f 696e 744c 6f61 6465 7220 636f  ckpointLoader co
+000023a0: 6d70 6174 6962 6c65 2066 696c 6570 6174  mpatible filepat
+000023b0: 7465 726e 0a20 2020 203a 7274 7970 653a  tern.    :rtype:
+000023c0: 2073 7472 0a20 2020 2022 2222 0a20 2020   str.    """.   
+000023d0: 2069 6620 6669 6c65 7061 7468 2e65 6e64   if filepath.end
+000023e0: 7377 6974 6828 222e 6d65 7461 2229 3a0a  swith(".meta"):.
+000023f0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00002400: 696c 6570 6174 685b 3a20 2d6c 656e 2822  ilepath[: -len("
+00002410: 2e6d 6574 6122 295d 0a20 2020 2065 6c69  .meta")].    eli
+00002420: 6620 6669 6c65 7061 7468 2e65 6e64 7377  f filepath.endsw
+00002430: 6974 6828 222e 696e 6465 7822 293a 0a20  ith(".index"):. 
+00002440: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
+00002450: 6c65 7061 7468 5b3a 202d 6c65 6e28 222e  lepath[: -len(".
+00002460: 696e 6465 7822 295d 0a20 2020 2065 6c69  index")].    eli
+00002470: 6620 6669 6c65 7061 7468 2e65 6e64 7377  f filepath.endsw
+00002480: 6974 6828 222e 7074 2229 3a0a 2020 2020  ith(".pt"):.    
+00002490: 2020 2020 7265 7475 726e 2066 696c 6570      return filep
+000024a0: 6174 685b 3a20 2d6c 656e 2822 2e70 7422  ath[: -len(".pt"
+000024b0: 295d 0a20 2020 2072 6574 7572 6e20 6669  )].    return fi
+000024c0: 6c65 7061 7468 0a0a 0a64 6566 2073 7973  lepath...def sys
+000024d0: 5f63 6d64 5f6f 7574 5f6c 696e 6573 2873  _cmd_out_lines(s
+000024e0: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
+000024f0: 7061 7261 6d20 7374 7220 733a 2073 6865  param str s: she
+00002500: 6c6c 2063 6f6d 6d61 6e64 0a20 2020 203a  ll command.    :
+00002510: 7274 7970 653a 206c 6973 745b 7374 725d  rtype: list[str]
+00002520: 0a20 2020 203a 7265 7475 726e 3a20 616c  .    :return: al
+00002530: 6c20 7374 646f 7574 2073 706c 6974 2062  l stdout split b
+00002540: 7920 6e65 776c 696e 652e 2044 6f65 7320  y newline. Does 
+00002550: 6e6f 7420 636f 7665 7220 7374 6465 7272  not cover stderr
+00002560: 2e0a 2020 2020 5261 6973 6573 2043 616c  ..    Raises Cal
+00002570: 6c65 6450 726f 6365 7373 4572 726f 7220  ledProcessError 
+00002580: 6f6e 2065 7272 6f72 2e0a 2020 2020 2222  on error..    ""
+00002590: 220a 2020 2020 7020 3d20 7375 6270 726f  ".    p = subpro
+000025a0: 6365 7373 2e50 6f70 656e 280a 2020 2020  cess.Popen(.    
+000025b0: 2020 2020 732c 0a20 2020 2020 2020 2073      s,.        s
+000025c0: 7464 6f75 743d 7375 6270 726f 6365 7373  tdout=subprocess
+000025d0: 2e50 4950 452c 0a20 2020 2020 2020 2073  .PIPE,.        s
+000025e0: 6865 6c6c 3d54 7275 652c 0a20 2020 2020  hell=True,.     
+000025f0: 2020 2063 6c6f 7365 5f66 6473 3d54 7275     close_fds=Tru
+00002600: 652c 0a20 2020 2020 2020 2065 6e76 3d64  e,.        env=d
+00002610: 6963 7428 6f73 2e65 6e76 6972 6f6e 2c20  ict(os.environ, 
+00002620: 4c41 4e47 3d22 656e 5f55 532e 5554 462d  LANG="en_US.UTF-
+00002630: 3822 2c20 4c43 5f41 4c4c 3d22 656e 5f55  8", LC_ALL="en_U
+00002640: 532e 5554 462d 3822 292c 0a20 2020 2029  S.UTF-8"),.    )
+00002650: 0a20 2020 2073 7464 6f75 7420 3d20 702e  .    stdout = p.
+00002660: 636f 6d6d 756e 6963 6174 6528 295b 305d  communicate()[0]
+00002670: 0a20 2020 2069 6620 5059 333a 0a20 2020  .    if PY3:.   
+00002680: 2020 2020 2073 7464 6f75 7420 3d20 7374       stdout = st
+00002690: 646f 7574 2e64 6563 6f64 6528 2275 7466  dout.decode("utf
+000026a0: 3822 290a 2020 2020 7265 7375 6c74 203d  8").    result =
+000026b0: 205b 6c69 6e65 2e73 7472 6970 2829 2066   [line.strip() f
+000026c0: 6f72 206c 696e 6520 696e 2073 7464 6f75  or line in stdou
+000026d0: 742e 7370 6c69 7428 225c 6e22 295b 3a2d  t.split("\n")[:-
+000026e0: 315d 5d0a 2020 2020 702e 7374 646f 7574  1]].    p.stdout
+000026f0: 2e63 6c6f 7365 2829 0a20 2020 2069 6620  .close().    if 
+00002700: 702e 7265 7475 726e 636f 6465 2021 3d20  p.returncode != 
+00002710: 303a 0a20 2020 2020 2020 2072 6169 7365  0:.        raise
+00002720: 2043 616c 6c65 6450 726f 6365 7373 4572   CalledProcessEr
+00002730: 726f 7228 702e 7265 7475 726e 636f 6465  ror(p.returncode
+00002740: 2c20 732c 2073 7464 6f75 7429 0a20 2020  , s, stdout).   
+00002750: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
+00002760: 0a64 6566 2073 7973 5f65 7865 635f 6f75  .def sys_exec_ou
+00002770: 7428 2a61 7267 732c 202a 2a6b 7761 7267  t(*args, **kwarg
+00002780: 7329 3a0a 2020 2020 2222 220a 2020 2020  s):.    """.    
+00002790: 3a70 6172 616d 2073 7472 2061 7267 733a  :param str args:
+000027a0: 2066 6f72 2073 7562 7072 6f63 6573 732e   for subprocess.
+000027b0: 506f 7065 6e0a 2020 2020 3a70 6172 616d  Popen.    :param
+000027c0: 206b 7761 7267 733a 2066 6f72 2073 7562   kwargs: for sub
+000027d0: 7072 6f63 6573 732e 506f 7065 6e0a 2020  process.Popen.  
+000027e0: 2020 3a72 6574 7572 6e3a 2073 7464 6f75    :return: stdou
+000027f0: 7420 6173 2073 7472 2028 6173 7375 6d65  t as str (assume
+00002800: 7320 7574 6638 290a 2020 2020 3a72 7479  s utf8).    :rty
+00002810: 7065 3a20 7374 720a 2020 2020 2222 220a  pe: str.    """.
+00002820: 2020 2020 6672 6f6d 2073 7562 7072 6f63      from subproc
+00002830: 6573 7320 696d 706f 7274 2050 6f70 656e  ess import Popen
+00002840: 2c20 5049 5045 0a0a 2020 2020 6b77 6172  , PIPE..    kwar
+00002850: 6773 2e73 6574 6465 6661 756c 7428 2273  gs.setdefault("s
+00002860: 6865 6c6c 222c 2046 616c 7365 290a 2020  hell", False).  
+00002870: 2020 7020 3d20 506f 7065 6e28 6172 6773    p = Popen(args
+00002880: 2c20 7374 6469 6e3d 5049 5045 2c20 7374  , stdin=PIPE, st
+00002890: 646f 7574 3d50 4950 452c 202a 2a6b 7761  dout=PIPE, **kwa
+000028a0: 7267 7329 0a20 2020 206f 7574 2c20 5f20  rgs).    out, _ 
+000028b0: 3d20 702e 636f 6d6d 756e 6963 6174 6528  = p.communicate(
+000028c0: 290a 2020 2020 6966 2070 2e72 6574 7572  ).    if p.retur
+000028d0: 6e63 6f64 6520 213d 2030 3a0a 2020 2020  ncode != 0:.    
+000028e0: 2020 2020 7261 6973 6520 4361 6c6c 6564      raise Called
+000028f0: 5072 6f63 6573 7345 7272 6f72 2870 2e72  ProcessError(p.r
+00002900: 6574 7572 6e63 6f64 652c 2061 7267 7329  eturncode, args)
+00002910: 0a20 2020 206f 7574 203d 2075 6e69 636f  .    out = unico
+00002920: 6465 5f74 6f5f 7374 7228 6f75 7429 0a20  de_to_str(out). 
+00002930: 2020 2072 6574 7572 6e20 6f75 740a 0a0a     return out...
+00002940: 6465 6620 7379 735f 6578 6563 5f72 6574  def sys_exec_ret
+00002950: 5f63 6f64 6528 2a61 7267 732c 202a 2a6b  _code(*args, **k
+00002960: 7761 7267 7329 3a0a 2020 2020 2222 220a  wargs):.    """.
+00002970: 2020 2020 3a70 6172 616d 2073 7472 2061      :param str a
+00002980: 7267 733a 2066 6f72 2073 7562 7072 6f63  rgs: for subproc
+00002990: 6573 732e 6361 6c6c 0a20 2020 203a 7061  ess.call.    :pa
+000029a0: 7261 6d20 6b77 6172 6773 3a20 666f 7220  ram kwargs: for 
+000029b0: 7375 6270 726f 6365 7373 2e63 616c 6c0a  subprocess.call.
+000029c0: 2020 2020 3a72 6574 7572 6e3a 2072 6574      :return: ret
+000029d0: 7572 6e20 636f 6465 0a20 2020 203a 7274  urn code.    :rt
+000029e0: 7970 653a 2069 6e74 0a20 2020 2022 2222  ype: int.    """
+000029f0: 0a20 2020 2069 6d70 6f72 7420 7375 6270  .    import subp
+00002a00: 726f 6365 7373 0a0a 2020 2020 7265 7320  rocess..    res 
+00002a10: 3d20 7375 6270 726f 6365 7373 2e63 616c  = subprocess.cal
+00002a20: 6c28 6172 6773 2c20 7368 656c 6c3d 4661  l(args, shell=Fa
+00002a30: 6c73 652c 202a 2a6b 7761 7267 7329 0a20  lse, **kwargs). 
+00002a40: 2020 2076 616c 6964 203d 206b 7761 7267     valid = kwarg
+00002a50: 732e 6765 7428 2276 616c 6964 222c 2028  s.get("valid", (
+00002a60: 302c 2031 2929 0a20 2020 2069 6620 7661  0, 1)).    if va
+00002a70: 6c69 6420 6973 206e 6f74 204e 6f6e 653a  lid is not None:
+00002a80: 0a20 2020 2020 2020 2069 6620 7265 7320  .        if res 
+00002a90: 6e6f 7420 696e 2076 616c 6964 3a0a 2020  not in valid:.  
+00002aa0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00002ab0: 4361 6c6c 6564 5072 6f63 6573 7345 7272  CalledProcessErr
+00002ac0: 6f72 2872 6573 2c20 6172 6773 290a 2020  or(res, args).  
+00002ad0: 2020 7265 7475 726e 2072 6573 0a0a 0a64    return res...d
+00002ae0: 6566 2067 6974 5f63 6f6d 6d69 745f 7265  ef git_commit_re
+00002af0: 7628 636f 6d6d 6974 3d22 4845 4144 222c  v(commit="HEAD",
+00002b00: 2067 6974 5f64 6972 3d22 2e22 2c20 6c65   git_dir=".", le
+00002b10: 6e67 7468 3d4e 6f6e 6529 3a0a 2020 2020  ngth=None):.    
+00002b20: 2222 220a 2020 2020 3a70 6172 616d 2073  """.    :param s
+00002b30: 7472 2063 6f6d 6d69 743a 0a20 2020 203a  tr commit:.    :
+00002b40: 7061 7261 6d20 7374 7220 6769 745f 6469  param str git_di
+00002b50: 723a 0a20 2020 203a 7061 7261 6d20 696e  r:.    :param in
+00002b60: 747c 4e6f 6e65 206c 656e 6774 683a 0a20  t|None length:. 
+00002b70: 2020 203a 7274 7970 653a 2073 7472 0a20     :rtype: str. 
+00002b80: 2020 2022 2222 0a20 2020 2069 6620 636f     """.    if co
+00002b90: 6d6d 6974 2069 7320 4e6f 6e65 3a0a 2020  mmit is None:.  
+00002ba0: 2020 2020 2020 636f 6d6d 6974 203d 2022        commit = "
+00002bb0: 4845 4144 220a 2020 2020 7265 7475 726e  HEAD".    return
+00002bc0: 2073 7973 5f65 7865 635f 6f75 7428 2267   sys_exec_out("g
+00002bd0: 6974 222c 2022 7265 762d 7061 7273 6522  it", "rev-parse"
+00002be0: 2c20 222d 2d73 686f 7274 3d25 6922 2025  , "--short=%i" %
+00002bf0: 206c 656e 6774 6820 6966 206c 656e 6774   length if lengt
+00002c00: 6820 656c 7365 2022 2d2d 7368 6f72 7422  h else "--short"
+00002c10: 2c20 636f 6d6d 6974 2c20 6377 643d 6769  , commit, cwd=gi
+00002c20: 745f 6469 7229 2e73 7472 6970 2829 0a0a  t_dir).strip()..
+00002c30: 0a64 6566 2067 6974 5f69 735f 6469 7274  .def git_is_dirt
+00002c40: 7928 6769 745f 6469 723d 222e 2229 3a0a  y(git_dir="."):.
+00002c50: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
+00002c60: 616d 2073 7472 2067 6974 5f64 6972 3a0a  am str git_dir:.
+00002c70: 2020 2020 3a72 7479 7065 3a20 626f 6f6c      :rtype: bool
+00002c80: 0a20 2020 2022 2222 0a20 2020 2072 203d  .    """.    r =
+00002c90: 2073 7973 5f65 7865 635f 7265 745f 636f   sys_exec_ret_co
+00002ca0: 6465 2822 6769 7422 2c20 2264 6966 6622  de("git", "diff"
+00002cb0: 2c20 222d 2d6e 6f2d 6578 742d 6469 6666  , "--no-ext-diff
+00002cc0: 222c 2022 2d2d 7175 6965 7422 2c20 222d  ", "--quiet", "-
+00002cd0: 2d65 7869 742d 636f 6465 222c 2063 7764  -exit-code", cwd
+00002ce0: 3d67 6974 5f64 6972 290a 2020 2020 6966  =git_dir).    if
+00002cf0: 2072 203d 3d20 303a 0a20 2020 2020 2020   r == 0:.       
+00002d00: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00002d10: 2020 6966 2072 203d 3d20 313a 0a20 2020    if r == 1:.   
+00002d20: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00002d30: 0a20 2020 2061 7373 6572 7420 4661 6c73  .    assert Fals
+00002d40: 652c 2022 6261 6420 7265 7475 726e 2025  e, "bad return %
+00002d50: 6922 2025 2072 0a0a 0a64 6566 2067 6974  i" % r...def git
+00002d60: 5f63 6f6d 6d69 745f 6461 7465 2863 6f6d  _commit_date(com
+00002d70: 6d69 743d 2248 4541 4422 2c20 6769 745f  mit="HEAD", git_
+00002d80: 6469 723d 222e 2229 3a0a 2020 2020 2222  dir="."):.    ""
+00002d90: 220a 2020 2020 3a70 6172 616d 2073 7472  ".    :param str
+00002da0: 2063 6f6d 6d69 743a 0a20 2020 203a 7061   commit:.    :pa
+00002db0: 7261 6d20 7374 7220 6769 745f 6469 723a  ram str git_dir:
+00002dc0: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
+00002dd0: 0a20 2020 2022 2222 0a20 2020 2072 6574  .    """.    ret
+00002de0: 7572 6e20 280a 2020 2020 2020 2020 7379  urn (.        sy
+00002df0: 735f 6578 6563 5f6f 7574 2822 6769 7422  s_exec_out("git"
+00002e00: 2c20 2273 686f 7722 2c20 222d 7322 2c20  , "show", "-s", 
+00002e10: 222d 2d66 6f72 6d61 743d 2563 6922 2c20  "--format=%ci", 
+00002e20: 636f 6d6d 6974 2c20 6377 643d 6769 745f  commit, cwd=git_
+00002e30: 6469 7229 0a20 2020 2020 2020 202e 7374  dir).        .st
+00002e40: 7269 7028 295b 3a2d 365d 0a20 2020 2020  rip()[:-6].     
+00002e50: 2020 202e 7265 706c 6163 6528 223a 222c     .replace(":",
+00002e60: 2022 2229 0a20 2020 2020 2020 202e 7265   "").        .re
+00002e70: 706c 6163 6528 222d 222c 2022 2229 0a20  place("-", ""). 
+00002e80: 2020 2020 2020 202e 7265 706c 6163 6528         .replace(
+00002e90: 2220 222c 2022 2e22 290a 2020 2020 290a  " ", ".").    ).
+00002ea0: 0a0a 6465 6620 6769 745f 6465 7363 7269  ..def git_descri
+00002eb0: 6265 5f68 6561 645f 7665 7273 696f 6e28  be_head_version(
+00002ec0: 6769 745f 6469 723d 222e 2229 3a0a 2020  git_dir="."):.  
+00002ed0: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
+00002ee0: 2073 7472 2067 6974 5f64 6972 3a0a 2020   str git_dir:.  
+00002ef0: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
+00002f00: 2020 2222 220a 2020 2020 6364 6174 6520    """.    cdate 
+00002f10: 3d20 6769 745f 636f 6d6d 6974 5f64 6174  = git_commit_dat
+00002f20: 6528 6769 745f 6469 723d 6769 745f 6469  e(git_dir=git_di
+00002f30: 7229 0a20 2020 2072 6576 203d 2067 6974  r).    rev = git
+00002f40: 5f63 6f6d 6d69 745f 7265 7628 6769 745f  _commit_rev(git_
+00002f50: 6469 723d 6769 745f 6469 7229 0a20 2020  dir=git_dir).   
+00002f60: 2069 735f 6469 7274 7920 3d20 6769 745f   is_dirty = git_
+00002f70: 6973 5f64 6972 7479 2867 6974 5f64 6972  is_dirty(git_dir
+00002f80: 3d67 6974 5f64 6972 290a 2020 2020 7265  =git_dir).    re
+00002f90: 7475 726e 2022 2573 2d2d 6769 742d 2573  turn "%s--git-%s
+00002fa0: 2573 2220 2520 2863 6461 7465 2c20 7265  %s" % (cdate, re
+00002fb0: 762c 2022 2d64 6972 7479 2220 6966 2069  v, "-dirty" if i
+00002fc0: 735f 6469 7274 7920 656c 7365 2022 2229  s_dirty else "")
+00002fd0: 0a0a 0a64 6566 2064 6573 6372 6962 655f  ...def describe_
+00002fe0: 7265 7475 726e 6e5f 7665 7273 696f 6e28  returnn_version(
+00002ff0: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
+00003000: 7274 7970 653a 2073 7472 0a20 2020 203a  rtype: str.    :
+00003010: 7265 7475 726e 3a20 7374 7269 6e67 206c  return: string l
+00003020: 696b 6520 2231 2e32 3031 3731 3031 372e  ike "1.20171017.
+00003030: 3136 3338 3430 2b67 6974 2d61 6232 6131  163840+git-ab2a1
+00003040: 6461 220a 2020 2020 2222 220a 2020 2020  da".    """.    
+00003050: 6672 6f6d 2072 6574 7572 6e6e 2069 6d70  from returnn imp
+00003060: 6f72 7420 5f5f 6c6f 6e67 5f76 6572 7369  ort __long_versi
+00003070: 6f6e 5f5f 0a0a 2020 2020 7265 7475 726e  on__..    return
+00003080: 205f 5f6c 6f6e 675f 7665 7273 696f 6e5f   __long_version_
+00003090: 5f0a 0a0a 6465 6620 6465 7363 7269 6265  _...def describe
+000030a0: 5f74 656e 736f 7266 6c6f 775f 7665 7273  _tensorflow_vers
+000030b0: 696f 6e28 293a 0a20 2020 2022 2222 0a20  ion():.    """. 
+000030c0: 2020 203a 7274 7970 653a 2073 7472 0a20     :rtype: str. 
+000030d0: 2020 2022 2222 0a20 2020 2074 7279 3a0a     """.    try:.
+000030e0: 2020 2020 2020 2020 696d 706f 7274 2074          import t
+000030f0: 656e 736f 7266 6c6f 7720 6173 2074 660a  ensorflow as tf.
+00003100: 2020 2020 6578 6365 7074 2049 6d70 6f72      except Impor
+00003110: 7445 7272 6f72 3a0a 2020 2020 2020 2020  tError:.        
+00003120: 7265 7475 726e 2022 3c54 656e 736f 7246  return "<TensorF
+00003130: 6c6f 7720 496d 706f 7274 4572 726f 723e  low ImportError>
+00003140: 220a 2020 2020 7472 793a 0a20 2020 2020  ".    try:.     
+00003150: 2020 2074 6469 7220 3d20 6f73 2e70 6174     tdir = os.pat
+00003160: 682e 6469 726e 616d 6528 7466 2e5f 5f66  h.dirname(tf.__f
+00003170: 696c 655f 5f29 0a20 2020 2065 7863 6570  ile__).    excep
+00003180: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00003190: 3a0a 2020 2020 2020 2020 7464 6972 203d  :.        tdir =
+000031a0: 2022 3c75 6e6b 6e6f 776e 2865 7863 6570   "<unknown(excep
+000031b0: 7469 6f6e 3a20 2572 293e 2220 2520 650a  tion: %r)>" % e.
+000031c0: 2020 2020 7665 7273 696f 6e20 3d20 6765      version = ge
+000031d0: 7461 7474 7228 7466 2c20 225f 5f76 6572  tattr(tf, "__ver
+000031e0: 7369 6f6e 5f5f 222c 2022 3c75 6e6b 6e6f  sion__", "<unkno
+000031f0: 776e 2076 6572 7369 6f6e 3e22 290a 2020  wn version>").  
+00003200: 2020 7665 7273 696f 6e20 2b3d 2022 2028    version += " (
+00003210: 2573 2922 2025 2067 6574 6174 7472 2874  %s)" % getattr(t
+00003220: 662c 2022 5f5f 6769 745f 7665 7273 696f  f, "__git_versio
+00003230: 6e5f 5f22 2c20 223c 756e 6b6e 6f77 6e20  n__", "<unknown 
+00003240: 6769 7420 7665 7273 696f 6e3e 2229 0a20  git version>"). 
+00003250: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00003260: 6966 2074 6469 722e 7374 6172 7473 7769  if tdir.startswi
+00003270: 7468 2822 3c22 293a 0a20 2020 2020 2020  th("<"):.       
+00003280: 2020 2020 2067 6974 5f69 6e66 6f20 3d20       git_info = 
+00003290: 223c 756e 6b6e 6f77 6e2d 6469 723e 220a  "<unknown-dir>".
+000032a0: 2020 2020 2020 2020 656c 6966 206f 732e          elif os.
+000032b0: 7061 7468 2e65 7869 7374 7328 7464 6972  path.exists(tdir
+000032c0: 202b 2022 2f2e 2e2f 2e67 6974 2229 3a0a   + "/../.git"):.
+000032d0: 2020 2020 2020 2020 2020 2020 6769 745f              git_
+000032e0: 696e 666f 203d 2022 6769 743a 2220 2b20  info = "git:" + 
+000032f0: 6769 745f 6465 7363 7269 6265 5f68 6561  git_describe_hea
+00003300: 645f 7665 7273 696f 6e28 6769 745f 6469  d_version(git_di
+00003310: 723d 7464 6972 290a 2020 2020 2020 2020  r=tdir).        
+00003320: 656c 6966 2022 2f73 6974 652d 7061 636b  elif "/site-pack
+00003330: 6167 6573 2f22 2069 6e20 7464 6972 3a0a  ages/" in tdir:.
+00003340: 2020 2020 2020 2020 2020 2020 6769 745f              git_
+00003350: 696e 666f 203d 2022 3c73 6974 652d 7061  info = "<site-pa
+00003360: 636b 6167 653e 220a 2020 2020 2020 2020  ckage>".        
+00003370: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00003380: 2020 6769 745f 696e 666f 203d 2022 3c6e    git_info = "<n
+00003390: 6f74 2d75 6e64 6572 2d67 6974 3e22 0a20  ot-under-git>". 
+000033a0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+000033b0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+000033c0: 2020 6769 745f 696e 666f 203d 2022 3c75    git_info = "<u
+000033d0: 6e6b 6e6f 776e 2867 6974 2065 7863 6570  nknown(git excep
+000033e0: 7469 6f6e 3a20 2572 293e 2220 2520 650a  tion: %r)>" % e.
+000033f0: 2020 2020 7265 7475 726e 2022 2573 2028      return "%s (
+00003400: 2573 2069 6e20 2573 2922 2025 2028 7665  %s in %s)" % (ve
+00003410: 7273 696f 6e2c 2067 6974 5f69 6e66 6f2c  rsion, git_info,
+00003420: 2074 6469 7229 0a0a 0a64 6566 2064 6573   tdir)...def des
+00003430: 6372 6962 655f 746f 7263 685f 7665 7273  cribe_torch_vers
+00003440: 696f 6e28 293a 0a20 2020 2022 2222 0a20  ion():.    """. 
+00003450: 2020 203a 7274 7970 653a 2073 7472 0a20     :rtype: str. 
+00003460: 2020 2022 2222 0a20 2020 2074 7279 3a0a     """.    try:.
+00003470: 2020 2020 2020 2020 2320 6e6f 696e 7370          # noinsp
+00003480: 6563 7469 6f6e 2050 7950 6163 6b61 6765  ection PyPackage
+00003490: 5265 7175 6972 656d 656e 7473 0a20 2020  Requirements.   
+000034a0: 2020 2020 2069 6d70 6f72 7420 746f 7263       import torc
+000034b0: 680a 2020 2020 6578 6365 7074 2049 6d70  h.    except Imp
+000034c0: 6f72 7445 7272 6f72 2061 7320 6578 633a  ortError as exc:
+000034d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000034e0: 223c 5079 546f 7263 6820 496d 706f 7274  "<PyTorch Import
+000034f0: 4572 726f 723a 2025 733e 2220 2520 6578  Error: %s>" % ex
+00003500: 630a 2020 2020 7472 793a 0a20 2020 2020  c.    try:.     
+00003510: 2020 2074 6469 7220 3d20 6f73 2e70 6174     tdir = os.pat
+00003520: 682e 6469 726e 616d 6528 746f 7263 682e  h.dirname(torch.
+00003530: 5f5f 6669 6c65 5f5f 290a 2020 2020 6578  __file__).    ex
+00003540: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+00003550: 7320 653a 0a20 2020 2020 2020 2074 6469  s e:.        tdi
+00003560: 7220 3d20 223c 756e 6b6e 6f77 6e28 6578  r = "<unknown(ex
+00003570: 6365 7074 696f 6e3a 2025 7229 3e22 2025  ception: %r)>" %
+00003580: 2065 0a20 2020 2076 6572 7369 6f6e 203d   e.    version =
+00003590: 2067 6574 6174 7472 2874 6f72 6368 2c20   getattr(torch, 
+000035a0: 225f 5f76 6572 7369 6f6e 5f5f 222c 2022  "__version__", "
+000035b0: 3c75 6e6b 6e6f 776e 2076 6572 7369 6f6e  <unknown version
+000035c0: 3e22 290a 2020 2020 7665 7273 696f 6e20  >").    version 
+000035d0: 2b3d 2022 2028 2573 2922 2025 2067 6574  += " (%s)" % get
+000035e0: 6174 7472 2874 6f72 6368 2e76 6572 7369  attr(torch.versi
+000035f0: 6f6e 2c20 2267 6974 5f76 6572 7369 6f6e  on, "git_version
+00003600: 222c 2022 3c75 6e6b 6e6f 776e 2067 6974  ", "<unknown git
+00003610: 2076 6572 7369 6f6e 3e22 290a 2020 2020   version>").    
+00003620: 7472 793a 0a20 2020 2020 2020 2069 6620  try:.        if 
+00003630: 7464 6972 2e73 7461 7274 7377 6974 6828  tdir.startswith(
+00003640: 223c 2229 3a0a 2020 2020 2020 2020 2020  "<"):.          
+00003650: 2020 6769 745f 696e 666f 203d 2022 3c75    git_info = "<u
+00003660: 6e6b 6e6f 776e 2d64 6972 3e22 0a20 2020  nknown-dir>".   
+00003670: 2020 2020 2065 6c69 6620 6f73 2e70 6174       elif os.pat
+00003680: 682e 6578 6973 7473 2874 6469 7220 2b20  h.exists(tdir + 
+00003690: 222f 2e2e 2f2e 6769 7422 293a 0a20 2020  "/../.git"):.   
+000036a0: 2020 2020 2020 2020 2067 6974 5f69 6e66           git_inf
+000036b0: 6f20 3d20 2267 6974 3a22 202b 2067 6974  o = "git:" + git
+000036c0: 5f64 6573 6372 6962 655f 6865 6164 5f76  _describe_head_v
+000036d0: 6572 7369 6f6e 2867 6974 5f64 6972 3d74  ersion(git_dir=t
+000036e0: 6469 7229 0a20 2020 2020 2020 2065 6c69  dir).        eli
+000036f0: 6620 222f 7369 7465 2d70 6163 6b61 6765  f "/site-package
+00003700: 732f 2220 696e 2074 6469 723a 0a20 2020  s/" in tdir:.   
+00003710: 2020 2020 2020 2020 2067 6974 5f69 6e66           git_inf
+00003720: 6f20 3d20 223c 7369 7465 2d70 6163 6b61  o = "<site-packa
+00003730: 6765 3e22 0a20 2020 2020 2020 2065 6c73  ge>".        els
+00003740: 653a 0a20 2020 2020 2020 2020 2020 2067  e:.            g
+00003750: 6974 5f69 6e66 6f20 3d20 223c 6e6f 742d  it_info = "<not-
+00003760: 756e 6465 722d 6769 743e 220a 2020 2020  under-git>".    
+00003770: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00003780: 2061 7320 653a 0a20 2020 2020 2020 2067   as e:.        g
+00003790: 6974 5f69 6e66 6f20 3d20 223c 756e 6b6e  it_info = "<unkn
+000037a0: 6f77 6e28 6769 7420 6578 6365 7074 696f  own(git exceptio
+000037b0: 6e3a 2025 7229 3e22 2025 2065 0a20 2020  n: %r)>" % e.   
+000037c0: 2072 6574 7572 6e20 2225 7320 2825 7320   return "%s (%s 
+000037d0: 696e 2025 7329 2220 2520 2876 6572 7369  in %s)" % (versi
+000037e0: 6f6e 2c20 6769 745f 696e 666f 2c20 7464  on, git_info, td
+000037f0: 6972 290a 0a0a 6465 6620 6765 745f 7465  ir)...def get_te
+00003800: 6e73 6f72 666c 6f77 5f76 6572 7369 6f6e  nsorflow_version
+00003810: 5f74 7570 6c65 2829 3a0a 2020 2020 2222  _tuple():.    ""
+00003820: 220a 2020 2020 3a72 6574 7572 6e3a 2074  ".    :return: t
+00003830: 7570 6c65 206f 6620 696e 7473 2c20 6669  uple of ints, fi
+00003840: 7273 7420 656e 7472 7920 6973 2074 6865  rst entry is the
+00003850: 206d 616a 6f72 2076 6572 7369 6f6e 0a20   major version. 
+00003860: 2020 203a 7274 7970 653a 2074 7570 6c65     :rtype: tuple
+00003870: 5b69 6e74 5d0a 2020 2020 2222 220a 2020  [int].    """.  
+00003880: 2020 696d 706f 7274 2074 656e 736f 7266    import tensorf
+00003890: 6c6f 7720 6173 2074 660a 2020 2020 696d  low as tf.    im
+000038a0: 706f 7274 2072 650a 0a20 2020 2072 6574  port re..    ret
+000038b0: 7572 6e20 7475 706c 6528 5b69 6e74 2872  urn tuple([int(r
+000038c0: 652e 7375 6228 2228 2d72 635b 302d 395d  e.sub("(-rc[0-9]
+000038d0: 7c2d 6465 765b 302d 395d 2a29 222c 2022  |-dev[0-9]*)", "
+000038e0: 222c 2073 2929 2066 6f72 2073 2069 6e20  ", s)) for s in 
+000038f0: 7466 2e5f 5f76 6572 7369 6f6e 5f5f 2e73  tf.__version__.s
+00003900: 706c 6974 2822 2e22 295d 290a 0a0a 6465  plit(".")])...de
+00003910: 6620 6576 616c 5f73 6865 6c6c 5f65 6e76  f eval_shell_env
+00003920: 2874 6f6b 656e 293a 0a20 2020 2022 2222  (token):.    """
+00003930: 0a20 2020 203a 7061 7261 6d20 7374 7220  .    :param str 
+00003940: 746f 6b65 6e3a 0a20 2020 203a 7265 7475  token:.    :retu
+00003950: 726e 3a20 6966 2022 2476 6172 222c 206c  rn: if "$var", l
+00003960: 6f6f 6b73 2069 6e20 6f73 2e65 6e76 6972  ooks in os.envir
+00003970: 6f6e 2c20 6f74 6865 7277 6973 6520 7265  on, otherwise re
+00003980: 7475 726e 2074 6f6b 656e 2061 7320 6973  turn token as is
+00003990: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
+000039a0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+000039b0: 746f 6b65 6e2e 7374 6172 7473 7769 7468  token.startswith
+000039c0: 2822 2422 293a 0a20 2020 2020 2020 2072  ("$"):.        r
+000039d0: 6574 7572 6e20 6f73 2e65 6e76 6972 6f6e  eturn os.environ
+000039e0: 2e67 6574 2874 6f6b 656e 5b31 3a5d 2c20  .get(token[1:], 
+000039f0: 2222 290a 2020 2020 7265 7475 726e 2074  "").    return t
+00003a00: 6f6b 656e 0a0a 0a64 6566 2065 7661 6c5f  oken...def eval_
+00003a10: 7368 656c 6c5f 7374 7228 7329 3a0a 2020  shell_str(s):.  
+00003a20: 2020 2222 220a 2020 2020 3a74 7970 6520    """.    :type 
+00003a30: 733a 2073 7472 207c 206c 6973 745b 7374  s: str | list[st
+00003a40: 725d 207c 2028 292d 3e73 7472 207c 206c  r] | ()->str | l
+00003a50: 6973 745b 2829 2d3e 7374 725d 207c 2028  ist[()->str] | (
+00003a60: 292d 3e6c 6973 745b 7374 725d 207c 2028  )->list[str] | (
+00003a70: 292d 3e6c 6973 745b 2829 2d3e 7374 725d  )->list[()->str]
+00003a80: 0a20 2020 203a 7274 7970 653a 206c 6973  .    :rtype: lis
+00003a90: 745b 7374 725d 0a0a 2020 2020 5061 7273  t[str]..    Pars
+00003aa0: 6573 2060 7360 2061 7320 7368 656c 6c20  es `s` as shell 
+00003ab0: 6c69 6b65 2061 7267 756d 656e 7473 2028  like arguments (
+00003ac0: 7669 6120 7368 6c65 782e 7370 6c69 7429  via shlex.split)
+00003ad0: 2061 6e64 2065 7661 6c75 6174 6573 2073   and evaluates s
+00003ae0: 6865 6c6c 2065 6e76 6972 6f6e 6d65 6e74  hell environment
+00003af0: 2076 6172 6961 626c 6573 0a20 2020 2028   variables.    (
+00003b00: 3a66 756e 633a 6065 7661 6c5f 7368 656c  :func:`eval_shel
+00003b10: 6c5f 656e 7660 292e 0a20 2020 2060 7360  l_env`)..    `s`
+00003b20: 206f 7220 6974 7320 656c 656d 656e 7473   or its elements
+00003b30: 2063 616e 2061 6c73 6f20 6265 2063 616c   can also be cal
+00003b40: 6c61 626c 652e 2049 6e20 7468 6f73 6520  lable. In those 
+00003b50: 6361 7365 732c 2074 6865 7920 7769 6c6c  cases, they will
+00003b60: 2062 6520 6361 6c6c 6564 2061 6e64 2074   be called and t
+00003b70: 6865 2072 6574 7572 6e65 6420 7661 6c75  he returned valu
+00003b80: 6520 6973 2075 7365 642e 0a20 2020 2022  e is used..    "
+00003b90: 2222 0a20 2020 2074 6f6b 656e 7320 3d20  "".    tokens = 
+00003ba0: 5b5d 0a20 2020 2069 6620 6361 6c6c 6162  [].    if callab
+00003bb0: 6c65 2873 293a 0a20 2020 2020 2020 2073  le(s):.        s
+00003bc0: 203d 2073 2829 0a20 2020 2069 6620 6973   = s().    if is
+00003bd0: 696e 7374 616e 6365 2873 2c20 286c 6973  instance(s, (lis
+00003be0: 742c 2074 7570 6c65 2929 3a0a 2020 2020  t, tuple)):.    
+00003bf0: 2020 2020 6c73 203d 2073 0a20 2020 2065      ls = s.    e
+00003c00: 6c73 653a 0a20 2020 2020 2020 2061 7373  lse:.        ass
+00003c10: 6572 7420 6973 696e 7374 616e 6365 2873  ert isinstance(s
+00003c20: 2c20 2873 7472 2c20 756e 6963 6f64 6529  , (str, unicode)
+00003c30: 290a 2020 2020 2020 2020 6c73 203d 2073  ).        ls = s
+00003c40: 686c 6578 2e73 706c 6974 2873 290a 2020  hlex.split(s).  
+00003c50: 2020 666f 7220 746f 6b65 6e20 696e 206c    for token in l
+00003c60: 733a 0a20 2020 2020 2020 2069 6620 6361  s:.        if ca
+00003c70: 6c6c 6162 6c65 2874 6f6b 656e 293a 0a20  llable(token):. 
+00003c80: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+00003c90: 203d 2074 6f6b 656e 2829 0a20 2020 2020   = token().     
+00003ca0: 2020 2061 7373 6572 7420 6973 696e 7374     assert isinst
+00003cb0: 616e 6365 2874 6f6b 656e 2c20 2873 7472  ance(token, (str
+00003cc0: 2c20 756e 6963 6f64 6529 290a 2020 2020  , unicode)).    
+00003cd0: 2020 2020 6966 2074 6f6b 656e 2e73 7461      if token.sta
+00003ce0: 7274 7377 6974 6828 2224 2229 3a0a 2020  rtswith("$"):.  
+00003cf0: 2020 2020 2020 2020 2020 746f 6b65 6e73            tokens
+00003d00: 202b 3d20 6576 616c 5f73 6865 6c6c 5f73   += eval_shell_s
+00003d10: 7472 2865 7661 6c5f 7368 656c 6c5f 656e  tr(eval_shell_en
+00003d20: 7628 746f 6b65 6e29 290a 2020 2020 2020  v(token)).      
+00003d30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00003d40: 2020 2020 746f 6b65 6e73 202b 3d20 5b74      tokens += [t
+00003d50: 6f6b 656e 5d0a 2020 2020 7265 7475 726e  oken].    return
+00003d60: 2074 6f6b 656e 730a 0a0a 6465 6620 6864   tokens...def hd
+00003d70: 6635 5f64 696d 656e 7369 6f6e 2866 696c  f5_dimension(fil
+00003d80: 656e 616d 652c 2064 696d 656e 7369 6f6e  ename, dimension
+00003d90: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
+00003da0: 7061 7261 6d20 7374 7220 6669 6c65 6e61  param str filena
+00003db0: 6d65 3a0a 2020 2020 3a70 6172 616d 2073  me:.    :param s
+00003dc0: 7472 2064 696d 656e 7369 6f6e 3a0a 2020  tr dimension:.  
+00003dd0: 2020 3a72 7479 7065 3a20 6e75 6d70 792e    :rtype: numpy.
+00003de0: 6e64 6172 7261 797c 696e 740a 2020 2020  ndarray|int.    
+00003df0: 2222 220a 2020 2020 6669 6e20 3d20 6835  """.    fin = h5
+00003e00: 7079 2e46 696c 6528 6669 6c65 6e61 6d65  py.File(filename
+00003e10: 2c20 2272 2229 0a20 2020 2069 6620 222f  , "r").    if "/
+00003e20: 2220 696e 2064 696d 656e 7369 6f6e 3a0a  " in dimension:.
+00003e30: 2020 2020 2020 2020 7265 7320 3d20 6669          res = fi
+00003e40: 6e5b 222f 222e 6a6f 696e 2864 696d 656e  n["/".join(dimen
+00003e50: 7369 6f6e 2e73 706c 6974 2822 2f22 295b  sion.split("/")[
+00003e60: 3a2d 315d 295d 2e61 7474 7273 5b64 696d  :-1])].attrs[dim
+00003e70: 656e 7369 6f6e 2e73 706c 6974 2822 2f22  ension.split("/"
+00003e80: 295b 2d31 5d5d 0a20 2020 2065 6c73 653a  )[-1]].    else:
+00003e90: 0a20 2020 2020 2020 2072 6573 203d 2066  .        res = f
+00003ea0: 696e 2e61 7474 7273 5b64 696d 656e 7369  in.attrs[dimensi
+00003eb0: 6f6e 5d0a 2020 2020 6669 6e2e 636c 6f73  on].    fin.clos
+00003ec0: 6528 290a 2020 2020 7265 7475 726e 2072  e().    return r
+00003ed0: 6573 0a0a 0a64 6566 2068 6466 355f 6772  es...def hdf5_gr
+00003ee0: 6f75 7028 6669 6c65 6e61 6d65 2c20 6469  oup(filename, di
+00003ef0: 6d65 6e73 696f 6e29 3a0a 2020 2020 2222  mension):.    ""
+00003f00: 220a 2020 2020 3a70 6172 616d 2073 7472  ".    :param str
+00003f10: 2066 696c 656e 616d 653a 0a20 2020 203a   filename:.    :
+00003f20: 7061 7261 6d20 7374 7220 6469 6d65 6e73  param str dimens
+00003f30: 696f 6e3a 0a20 2020 203a 7274 7970 653a  ion:.    :rtype:
+00003f40: 2064 6963 745b 7374 725d 0a20 2020 2022   dict[str].    "
+00003f50: 2222 0a20 2020 2066 696e 203d 2068 3570  "".    fin = h5p
+00003f60: 792e 4669 6c65 2866 696c 656e 616d 652c  y.File(filename,
+00003f70: 2022 7222 290a 2020 2020 7265 7320 3d20   "r").    res = 
+00003f80: 7b6b 3a20 6669 6e5b 6469 6d65 6e73 696f  {k: fin[dimensio
+00003f90: 6e5d 2e61 7474 7273 5b6b 5d20 666f 7220  n].attrs[k] for 
+00003fa0: 6b20 696e 2066 696e 5b64 696d 656e 7369  k in fin[dimensi
+00003fb0: 6f6e 5d2e 6174 7472 737d 0a20 2020 2066  on].attrs}.    f
+00003fc0: 696e 2e63 6c6f 7365 2829 0a20 2020 2072  in.close().    r
+00003fd0: 6574 7572 6e20 7265 730a 0a0a 6465 6620  eturn res...def 
+00003fe0: 6864 6635 5f73 6861 7065 2866 696c 656e  hdf5_shape(filen
+00003ff0: 616d 652c 2064 696d 656e 7369 6f6e 293a  ame, dimension):
+00004000: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
+00004010: 7261 6d20 7374 7220 6669 6c65 6e61 6d65  ram str filename
+00004020: 3a0a 2020 2020 3a70 6172 616d 2064 696d  :.    :param dim
+00004030: 656e 7369 6f6e 3a0a 2020 2020 3a72 7479  ension:.    :rty
+00004040: 7065 3a20 7475 706c 655b 696e 745d 0a20  pe: tuple[int]. 
+00004050: 2020 2022 2222 0a20 2020 2066 696e 203d     """.    fin =
+00004060: 2068 3570 792e 4669 6c65 2866 696c 656e   h5py.File(filen
+00004070: 616d 652c 2022 7222 290a 2020 2020 7265  ame, "r").    re
+00004080: 7320 3d20 6669 6e5b 6469 6d65 6e73 696f  s = fin[dimensio
+00004090: 6e5d 2e73 6861 7065 0a20 2020 2066 696e  n].shape.    fin
+000040a0: 2e63 6c6f 7365 2829 0a20 2020 2072 6574  .close().    ret
+000040b0: 7572 6e20 7265 730a 0a0a 6465 6620 6864  urn res...def hd
+000040c0: 6635 5f73 7472 696e 6773 2868 616e 646c  f5_strings(handl
+000040d0: 652c 206e 616d 652c 2064 6174 6129 3a0a  e, name, data):.
+000040e0: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
+000040f0: 616d 2068 3570 792e 4669 6c65 2068 616e  am h5py.File han
+00004100: 646c 653a 0a20 2020 203a 7061 7261 6d20  dle:.    :param 
+00004110: 7374 7220 6e61 6d65 3a0a 2020 2020 3a70  str name:.    :p
+00004120: 6172 616d 206e 756d 7079 2e6e 6461 7272  aram numpy.ndarr
+00004130: 6179 7c6c 6973 745b 7374 725d 2064 6174  ay|list[str] dat
+00004140: 613a 0a20 2020 2022 2222 0a20 2020 2023  a:.    """.    #
+00004150: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
+00004160: 4272 6f61 6445 7863 6570 7469 6f6e 0a20  BroadException. 
+00004170: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00004180: 7320 3d20 6d61 7828 5b6c 656e 2864 2920  s = max([len(d) 
+00004190: 666f 7220 6420 696e 2064 6174 615d 290a  for d in data]).
+000041a0: 2020 2020 2020 2020 6473 6574 203d 2068          dset = h
+000041b0: 616e 646c 652e 6372 6561 7465 5f64 6174  andle.create_dat
+000041c0: 6173 6574 286e 616d 652c 2028 6c65 6e28  aset(name, (len(
+000041d0: 6461 7461 292c 292c 2064 7479 7065 3d22  data),), dtype="
+000041e0: 5322 202b 2073 7472 2873 2929 0a20 2020  S" + str(s)).   
+000041f0: 2020 2020 2064 7365 745b 2e2e 2e5d 203d       dset[...] =
+00004200: 2064 6174 610a 2020 2020 6578 6365 7074   data.    except
+00004210: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+00004220: 2020 2020 2320 6e6f 696e 7370 6563 7469      # noinspecti
+00004230: 6f6e 2050 7955 6e72 6573 6f6c 7665 6452  on PyUnresolvedR
+00004240: 6566 6572 656e 6365 730a 2020 2020 2020  eferences.      
+00004250: 2020 6474 203d 2068 3570 792e 7370 6563    dt = h5py.spec
+00004260: 6961 6c5f 6474 7970 6528 766c 656e 3d75  ial_dtype(vlen=u
+00004270: 6e69 636f 6465 290a 2020 2020 2020 2020  nicode).        
+00004280: 6465 6c20 6861 6e64 6c65 5b6e 616d 655d  del handle[name]
+00004290: 0a20 2020 2020 2020 2064 7365 7420 3d20  .        dset = 
+000042a0: 6861 6e64 6c65 2e63 7265 6174 655f 6461  handle.create_da
+000042b0: 7461 7365 7428 6e61 6d65 2c20 286c 656e  taset(name, (len
+000042c0: 2864 6174 6129 2c29 2c20 6474 7970 653d  (data),), dtype=
+000042d0: 6474 290a 2020 2020 2020 2020 6473 6574  dt).        dset
+000042e0: 5b2e 2e2e 5d20 3d20 6461 7461 0a0a 0a64  [...] = data...d
+000042f0: 6566 206d 6f64 656c 5f65 706f 6368 5f66  ef model_epoch_f
+00004300: 726f 6d5f 6669 6c65 6e61 6d65 2866 696c  rom_filename(fil
+00004310: 656e 616d 6529 3a0a 2020 2020 2222 220a  ename):.    """.
+00004320: 2020 2020 3a70 6172 616d 2073 7472 2066      :param str f
+00004330: 696c 656e 616d 653a 0a20 2020 203a 7265  ilename:.    :re
+00004340: 7475 726e 3a20 6570 6f63 6820 6e75 6d62  turn: epoch numb
+00004350: 6572 0a20 2020 203a 7274 7970 653a 2069  er.    :rtype: i
+00004360: 6e74 0a20 2020 2022 2222 0a20 2020 2023  nt.    """.    #
+00004370: 2057 6520 636f 756c 6420 6368 6563 6b20   We could check 
+00004380: 7669 613a 0a20 2020 2023 2074 662e 636f  via:.    # tf.co
+00004390: 6e74 7269 622e 6672 616d 6577 6f72 6b2e  ntrib.framework.
+000043a0: 7079 7468 6f6e 2e66 7261 6d65 776f 726b  python.framework
+000043b0: 2e63 6865 636b 706f 696e 745f 7574 696c  .checkpoint_util
+000043c0: 732e 6c6f 6164 5f76 6172 6961 626c 6528  s.load_variable(
+000043d0: 290a 2020 2020 2320 6f6e 6365 2077 6520  ).    # once we 
+000043e0: 7361 7665 2074 6861 7420 696e 2074 6865  save that in the
+000043f0: 206d 6f64 656c 2e0a 2020 2020 2320 5365   model..    # Se
+00004400: 6520 5446 4e65 7477 6f72 6b2e 4e65 7477  e TFNetwork.Netw
+00004410: 6f72 6b2e 5f63 7265 6174 655f 7361 7665  ork._create_save
+00004420: 7228 292e 0a20 2020 2023 2057 6520 646f  r()..    # We do
+00004430: 6e27 7420 6861 7665 2069 7420 696e 2074  n't have it in t
+00004440: 6865 206d 6f64 656c 2c20 7468 6f75 6768  he model, though
+00004450: 2e0a 2020 2020 2320 466f 7220 6e6f 772c  ..    # For now,
+00004460: 206a 7573 7420 7061 7273 6520 6974 2066   just parse it f
+00004470: 726f 6d20 6669 6c65 6e61 6d65 2e0a 2020  rom filename..  
+00004480: 2020 2320 4966 2054 462c 2061 6e64 2073    # If TF, and s
+00004490: 796d 6c69 6e6b 2c20 7265 736f 6c76 6520  ymlink, resolve 
+000044a0: 756e 7469 6c20 6e6f 2073 796d 6c69 6e6b  until no symlink
+000044b0: 2061 6e79 6d6f 7265 2028 652e 672e 2069   anymore (e.g. i
+000044c0: 6620 7765 2073 796d 6c69 6e6b 6564 2074  f we symlinked t
+000044d0: 6865 2062 6573 7420 6570 6f63 6829 2e0a  he best epoch)..
+000044e0: 2020 2020 7768 696c 6520 5472 7565 3a0a      while True:.
+000044f0: 2020 2020 2020 2020 7466 5f6d 6574 615f          tf_meta_
+00004500: 666e 203d 2022 2573 2e6d 6574 6122 2025  fn = "%s.meta" %
+00004510: 2066 696c 656e 616d 650a 2020 2020 2020   filename.      
+00004520: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+00004530: 7374 7328 7466 5f6d 6574 615f 666e 2920  sts(tf_meta_fn) 
+00004540: 616e 6420 6f73 2e70 6174 682e 6973 6c69  and os.path.isli
+00004550: 6e6b 2874 665f 6d65 7461 5f66 6e29 3a0a  nk(tf_meta_fn):.
+00004560: 2020 2020 2020 2020 2020 2020 7466 5f6d              tf_m
+00004570: 6574 615f 666e 5f20 3d20 6f73 2e72 6561  eta_fn_ = os.rea
+00004580: 646c 696e 6b28 7466 5f6d 6574 615f 666e  dlink(tf_meta_fn
+00004590: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+000045a0: 7365 7274 2074 665f 6d65 7461 5f66 6e5f  sert tf_meta_fn_
+000045b0: 2e65 6e64 7377 6974 6828 222e 6d65 7461  .endswith(".meta
+000045c0: 2229 2c20 2273 7472 616e 6765 3f20 2573  "), "strange? %s
+000045d0: 2c20 2573 2220 2520 2866 696c 656e 616d  , %s" % (filenam
+000045e0: 652c 2074 665f 6d65 7461 5f66 6e29 0a20  e, tf_meta_fn). 
+000045f0: 2020 2020 2020 2020 2020 2066 696c 656e             filen
+00004600: 616d 6520 3d20 7466 5f6d 6574 615f 666e  ame = tf_meta_fn
+00004610: 5f5b 3a20 2d6c 656e 2822 2e6d 6574 6122  _[: -len(".meta"
+00004620: 295d 0a20 2020 2020 2020 2065 6c73 653a  )].        else:
+00004630: 0a20 2020 2020 2020 2020 2020 2062 7265  .            bre
+00004640: 616b 0a20 2020 206d 203d 2072 652e 6d61  ak.    m = re.ma
+00004650: 7463 6828 222e 2a5c 5c2e 285b 302d 395d  tch(".*\\.([0-9]
+00004660: 2b29 222c 2066 696c 656e 616d 6529 0a20  +)", filename). 
+00004670: 2020 2061 7373 6572 7420 6d2c 2022 6e6f     assert m, "no
+00004680: 206d 6174 6368 2066 6f72 2025 7222 2025   match for %r" %
+00004690: 2066 696c 656e 616d 650a 2020 2020 7265   filename.    re
+000046a0: 7475 726e 2069 6e74 286d 2e67 726f 7570  turn int(m.group
+000046b0: 7328 295b 305d 290a 0a0a 6465 6620 6465  s()[0])...def de
+000046c0: 6570 5f75 7064 6174 655f 6469 6374 5f76  ep_update_dict_v
+000046d0: 616c 7565 7328 642c 206b 6579 2c20 6e65  alues(d, key, ne
+000046e0: 775f 7661 6c75 6529 3a0a 2020 2020 2222  w_value):.    ""
+000046f0: 220a 2020 2020 5669 7369 7473 2061 6c6c  ".    Visits all
+00004700: 2069 7465 6d73 2069 6e20 6064 602e 0a20   items in `d`.. 
+00004710: 2020 2049 6620 7468 6520 7661 6c75 6520     If the value 
+00004720: 6973 2061 2064 6963 742c 2069 7420 7769  is a dict, it wi
+00004730: 6c6c 2072 6563 7572 7369 7665 6c79 2076  ll recursively v
+00004740: 6973 6974 2069 742e 0a0a 2020 2020 3a70  isit it...    :p
+00004750: 6172 616d 2064 6963 745b 7374 722c 547c  aram dict[str,T|
+00004760: 6f62 6a65 6374 7c4e 6f6e 657c 6469 6374  object|None|dict
+00004770: 5d20 643a 2077 696c 6c20 7570 6461 7465  ] d: will update
+00004780: 2069 6e70 6c61 6365 0a20 2020 203a 7061   inplace.    :pa
+00004790: 7261 6d20 7374 7220 6b65 793a 0a20 2020  ram str key:.   
+000047a0: 203a 7061 7261 6d20 5420 6e65 775f 7661   :param T new_va
+000047b0: 6c75 653a 0a20 2020 2022 2222 0a20 2020  lue:.    """.   
+000047c0: 2066 6f72 2076 616c 7565 2069 6e20 642e   for value in d.
+000047d0: 7661 6c75 6573 2829 3a0a 2020 2020 2020  values():.      
+000047e0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000047f0: 7661 6c75 652c 2064 6963 7429 3a0a 2020  value, dict):.  
+00004800: 2020 2020 2020 2020 2020 6465 6570 5f75            deep_u
+00004810: 7064 6174 655f 6469 6374 5f76 616c 7565  pdate_dict_value
+00004820: 7328 7661 6c75 652c 206b 6579 3d6b 6579  s(value, key=key
+00004830: 2c20 6e65 775f 7661 6c75 653d 6e65 775f  , new_value=new_
+00004840: 7661 6c75 6529 0a20 2020 2069 6620 6b65  value).    if ke
+00004850: 7920 696e 2064 3a0a 2020 2020 2020 2020  y in d:.        
+00004860: 645b 6b65 795d 203d 206e 6577 5f76 616c  d[key] = new_val
+00004870: 7565 0a0a 0a64 6566 2074 6572 6d69 6e61  ue...def termina
+00004880: 6c5f 7369 7a65 2866 696c 653d 7379 732e  l_size(file=sys.
+00004890: 7374 646f 7574 293a 0a20 2020 2022 2222  stdout):.    """
+000048a0: 0a20 2020 2052 6574 7572 6e73 2074 6865  .    Returns the
+000048b0: 2074 6572 6d69 6e61 6c20 7369 7a65 2e0a   terminal size..
+000048c0: 2020 2020 5468 6973 2077 696c 6c20 7072      This will pr
+000048d0: 6f62 6162 6c79 2077 6f72 6b20 6f6e 206c  obably work on l
+000048e0: 696e 7578 206f 6e6c 792e 0a0a 2020 2020  inux only...    
+000048f0: 3a70 6172 616d 2069 6f2e 4669 6c65 2066  :param io.File f
+00004900: 696c 653a 0a20 2020 203a 7265 7475 726e  ile:.    :return
+00004910: 3a20 2863 6f6c 756d 6e73 2c20 6c69 6e65  : (columns, line
+00004920: 7329 2c20 6f72 2028 2d31 2c2d 3129 0a20  s), or (-1,-1). 
+00004930: 2020 203a 7274 7970 653a 2028 696e 742c     :rtype: (int,
+00004940: 696e 7429 0a20 2020 2022 2222 0a20 2020  int).    """.   
+00004950: 2069 6d70 6f72 7420 6f73 0a20 2020 2069   import os.    i
+00004960: 6d70 6f72 7420 696f 0a0a 2020 2020 6966  mport io..    if
+00004970: 206e 6f74 2068 6173 6174 7472 2866 696c   not hasattr(fil
+00004980: 652c 2022 6669 6c65 6e6f 2229 3a0a 2020  e, "fileno"):.  
+00004990: 2020 2020 2020 7265 7475 726e 202d 312c        return -1,
+000049a0: 202d 310a 2020 2020 7472 793a 0a20 2020   -1.    try:.   
+000049b0: 2020 2020 2069 6620 6e6f 7420 6f73 2e69       if not os.i
+000049c0: 7361 7474 7928 6669 6c65 2e66 696c 656e  satty(file.filen
+000049d0: 6f28 2929 3a0a 2020 2020 2020 2020 2020  o()):.          
+000049e0: 2020 7265 7475 726e 202d 312c 202d 310a    return -1, -1.
+000049f0: 2020 2020 6578 6365 7074 2028 696f 2e55      except (io.U
+00004a00: 6e73 7570 706f 7274 6564 4f70 6572 6174  nsupportedOperat
+00004a10: 696f 6e2c 2056 616c 7565 4572 726f 7229  ion, ValueError)
+00004a20: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00004a30: 202d 312c 202d 310a 2020 2020 656e 7620   -1, -1.    env 
+00004a40: 3d20 6f73 2e65 6e76 6972 6f6e 0a0a 2020  = os.environ..  
+00004a50: 2020 2320 6e6f 696e 7370 6563 7469 6f6e    # noinspection
+00004a60: 2050 7953 6861 646f 7769 6e67 4e61 6d65   PyShadowingName
+00004a70: 730a 2020 2020 6465 6620 696f 6374 6c5f  s.    def ioctl_
+00004a80: 6777 696e 737a 2866 6429 3a0a 2020 2020  gwinsz(fd):.    
+00004a90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00004aa0: 3a70 6172 616d 2069 6e74 2066 643a 2066  :param int fd: f
+00004ab0: 696c 6520 6465 7363 7269 7074 6f72 0a20  ile descriptor. 
+00004ac0: 2020 2020 2020 203a 7274 7970 653a 2074         :rtype: t
+00004ad0: 7570 6c65 5b69 6e74 5d0a 2020 2020 2020  uple[int].      
+00004ae0: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
+00004af0: 6e6f 696e 7370 6563 7469 6f6e 2050 7942  noinspection PyB
+00004b00: 726f 6164 4578 6365 7074 696f 6e0a 2020  roadException.  
+00004b10: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00004b20: 2020 2020 2020 2069 6d70 6f72 7420 6663         import fc
+00004b30: 6e74 6c0a 2020 2020 2020 2020 2020 2020  ntl.            
+00004b40: 696d 706f 7274 2074 6572 6d69 6f73 0a20  import termios. 
+00004b50: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+00004b60: 7420 7374 7275 6374 0a0a 2020 2020 2020  t struct..      
+00004b70: 2020 2020 2020 6372 5f20 3d20 7374 7275        cr_ = stru
+00004b80: 6374 2e75 6e70 6163 6b28 2268 6822 2c20  ct.unpack("hh", 
+00004b90: 6663 6e74 6c2e 696f 6374 6c28 6664 2c20  fcntl.ioctl(fd, 
+00004ba0: 7465 726d 696f 732e 5449 4f43 4757 494e  termios.TIOCGWIN
+00004bb0: 535a 2c20 2231 3233 3422 2929 2020 2320  SZ, "1234"))  # 
+00004bc0: 6e6f 7161 0a20 2020 2020 2020 2065 7863  noqa.        exc
+00004bd0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+00004be0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00004bf0: 6e0a 2020 2020 2020 2020 7265 7475 726e  n.        return
+00004c00: 2063 725f 0a0a 2020 2020 6372 203d 2069   cr_..    cr = i
+00004c10: 6f63 746c 5f67 7769 6e73 7a28 6669 6c65  octl_gwinsz(file
+00004c20: 2e66 696c 656e 6f29 206f 7220 696f 6374  .fileno) or ioct
+00004c30: 6c5f 6777 696e 737a 2830 2920 6f72 2069  l_gwinsz(0) or i
+00004c40: 6f63 746c 5f67 7769 6e73 7a28 3129 206f  octl_gwinsz(1) o
+00004c50: 7220 696f 6374 6c5f 6777 696e 737a 2832  r ioctl_gwinsz(2
+00004c60: 290a 2020 2020 6966 206e 6f74 2063 723a  ).    if not cr:
+00004c70: 0a20 2020 2020 2020 2023 206e 6f69 6e73  .        # noins
+00004c80: 7065 6374 696f 6e20 5079 4272 6f61 6445  pection PyBroadE
+00004c90: 7863 6570 7469 6f6e 0a20 2020 2020 2020  xception.       
+00004ca0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00004cb0: 2020 6664 203d 206f 732e 6f70 656e 286f    fd = os.open(o
+00004cc0: 732e 6374 6572 6d69 6428 292c 206f 732e  s.ctermid(), os.
+00004cd0: 4f5f 5244 4f4e 4c59 290a 2020 2020 2020  O_RDONLY).      
+00004ce0: 2020 2020 2020 6372 203d 2069 6f63 746c        cr = ioctl
+00004cf0: 5f67 7769 6e73 7a28 6664 290a 2020 2020  _gwinsz(fd).    
+00004d00: 2020 2020 2020 2020 6f73 2e63 6c6f 7365          os.close
+00004d10: 2866 6429 0a20 2020 2020 2020 2065 7863  (fd).        exc
+00004d20: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+00004d30: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00004d40: 2020 2020 6966 206e 6f74 2063 723a 0a20      if not cr:. 
+00004d50: 2020 2020 2020 2063 7220 3d20 2865 6e76         cr = (env
+00004d60: 2e67 6574 2822 4c49 4e45 5322 2c20 3235  .get("LINES", 25
+00004d70: 292c 2065 6e76 2e67 6574 2822 434f 4c55  ), env.get("COLU
+00004d80: 4d4e 5322 2c20 3830 2929 0a20 2020 2072  MNS", 80)).    r
+00004d90: 6574 7572 6e20 696e 7428 6372 5b31 5d29  eturn int(cr[1])
+00004da0: 2c20 696e 7428 6372 5b30 5d29 0a0a 0a64  , int(cr[0])...d
+00004db0: 6566 2069 735f 7474 7928 6669 6c65 3d73  ef is_tty(file=s
+00004dc0: 7973 2e73 7464 6f75 7429 3a0a 2020 2020  ys.stdout):.    
+00004dd0: 2222 220a 2020 2020 3a70 6172 616d 2069  """.    :param i
+00004de0: 6f2e 4669 6c65 2066 696c 653a 0a20 2020  o.File file:.   
+00004df0: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
+00004e00: 2020 2222 220a 2020 2020 7465 726d 696e    """.    termin
+00004e10: 616c 5f77 6964 7468 2c20 5f20 3d20 7465  al_width, _ = te
+00004e20: 726d 696e 616c 5f73 697a 6528 6669 6c65  rminal_size(file
+00004e30: 3d66 696c 6529 0a20 2020 2072 6574 7572  =file).    retur
+00004e40: 6e20 7465 726d 696e 616c 5f77 6964 7468  n terminal_width
+00004e50: 203e 2030 0a0a 0a64 6566 2063 6f6e 6669   > 0...def confi
+00004e60: 726d 2874 7874 2c20 6578 6974 5f6f 6e5f  rm(txt, exit_on_
+00004e70: 6661 6c73 653d 4661 6c73 6529 3a0a 2020  false=False):.  
+00004e80: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
+00004e90: 2073 7472 2074 7874 3a20 652e 672e 2022   str txt: e.g. "
+00004ea0: 4465 6c65 7465 2065 7665 7279 7468 696e  Delete everythin
+00004eb0: 673f 220a 2020 2020 3a70 6172 616d 2062  g?".    :param b
+00004ec0: 6f6f 6c20 6578 6974 5f6f 6e5f 6661 6c73  ool exit_on_fals
+00004ed0: 653a 2069 6620 5472 7565 2c20 7769 6c6c  e: if True, will
+00004ee0: 2063 616c 6c20 7379 732e 6578 6974 2831   call sys.exit(1
+00004ef0: 2920 6966 206e 6f74 2063 6f6e 6669 726d  ) if not confirm
+00004f00: 6564 0a20 2020 203a 7274 7970 653a 2062  ed.    :rtype: b
+00004f10: 6f6f 6c0a 2020 2020 2222 220a 2020 2020  ool.    """.    
+00004f20: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
+00004f30: 2020 2020 7220 3d20 696e 7075 7428 2225      r = input("%
+00004f40: 7320 436f 6e66 6972 6d3f 205b 7965 732f  s Confirm? [yes/
+00004f50: 6e6f 5d22 2025 2074 7874 290a 2020 2020  no]" % txt).    
+00004f60: 2020 2020 6966 206e 6f74 2072 3a0a 2020      if not r:.  
+00004f70: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00004f80: 7565 0a20 2020 2020 2020 2069 6620 7220  ue.        if r 
+00004f90: 696e 205b 2279 222c 2022 7965 7322 5d3a  in ["y", "yes"]:
+00004fa0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00004fb0: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+00004fc0: 2069 6620 7220 696e 205b 226e 222c 2022   if r in ["n", "
+00004fd0: 6e6f 225d 3a0a 2020 2020 2020 2020 2020  no"]:.          
+00004fe0: 2020 6966 2065 7869 745f 6f6e 5f66 616c    if exit_on_fal
+00004ff0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00005000: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+00005010: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00005020: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00005030: 2070 7269 6e74 2822 496e 7661 6c69 6420   print("Invalid 
+00005040: 7265 7370 6f6e 7365 2025 722e 2220 2520  response %r." % 
+00005050: 7229 0a0a 0a64 6566 2068 6d73 2873 293a  r)...def hms(s):
+00005060: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
+00005070: 7261 6d20 666c 6f61 747c 696e 7420 733a  ram float|int s:
+00005080: 2073 6563 6f6e 6473 0a20 2020 203a 7265   seconds.    :re
+00005090: 7475 726e 3a20 652e 672e 2022 313a 3233  turn: e.g. "1:23
+000050a0: 3a34 3522 2028 6873 3a6d 733a 7365 6373  :45" (hs:ms:secs
+000050b0: 292e 2073 6565 2068 6d73 5f66 7261 6374  ). see hms_fract
+000050c0: 696f 6e20 6966 2079 6f75 2077 616e 7420  ion if you want 
+000050d0: 746f 2067 6574 2066 7261 6374 696f 6e61  to get fractiona
+000050e0: 6c20 7365 636f 6e64 730a 2020 2020 3a72  l seconds.    :r
+000050f0: 7479 7065 3a20 7374 720a 2020 2020 2222  type: str.    ""
+00005100: 220a 2020 2020 6d2c 2073 203d 2064 6976  ".    m, s = div
+00005110: 6d6f 6428 732c 2036 3029 0a20 2020 2068  mod(s, 60).    h
+00005120: 2c20 6d20 3d20 6469 766d 6f64 286d 2c20  , m = divmod(m, 
+00005130: 3630 290a 2020 2020 7265 7475 726e 2022  60).    return "
+00005140: 2564 3a25 3032 643a 2530 3264 2220 2520  %d:%02d:%02d" % 
+00005150: 2868 2c20 6d2c 2073 290a 0a0a 6465 6620  (h, m, s)...def 
+00005160: 686d 735f 6672 6163 7469 6f6e 2873 2c20  hms_fraction(s, 
+00005170: 6465 6369 6d61 6c73 3d34 293a 0a20 2020  decimals=4):.   
+00005180: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
+00005190: 666c 6f61 7420 733a 2073 6563 6f6e 6473  float s: seconds
+000051a0: 0a20 2020 203a 7061 7261 6d20 696e 7420  .    :param int 
+000051b0: 6465 6369 6d61 6c73 3a20 686f 7720 6d75  decimals: how mu
+000051c0: 6368 2064 6563 696d 616c 7320 746f 2070  ch decimals to p
+000051d0: 7269 6e74 0a20 2020 203a 7265 7475 726e  rint.    :return
+000051e0: 3a20 652e 672e 2022 313a 3233 3a34 352e  : e.g. "1:23:45.
+000051f0: 3637 3839 2220 2868 733a 6d73 3a73 6563  6789" (hs:ms:sec
+00005200: 7329 0a20 2020 203a 7274 7970 653a 2073  s).    :rtype: s
+00005210: 7472 0a20 2020 2022 2222 0a20 2020 2072  tr.    """.    r
+00005220: 6574 7572 6e20 686d 7328 696e 7428 7329  eturn hms(int(s)
+00005230: 2920 2b20 2828 2225 252e 3025 6966 2220  ) + (("%%.0%if" 
+00005240: 2520 6465 6369 6d61 6c73 2920 2520 2873  % decimals) % (s
+00005250: 202d 2069 6e74 2873 2929 295b 313a 5d0a   - int(s)))[1:].
+00005260: 0a0a 6465 6620 6875 6d61 6e5f 7369 7a65  ..def human_size
+00005270: 286e 2c20 6661 6374 6f72 3d31 3030 302c  (n, factor=1000,
+00005280: 2066 7261 633d 302e 382c 2070 7265 633d   frac=0.8, prec=
+00005290: 3129 3a0a 2020 2020 2222 220a 2020 2020  1):.    """.    
+000052a0: 3a70 6172 616d 2069 6e74 7c66 6c6f 6174  :param int|float
+000052b0: 206e 3a0a 2020 2020 3a70 6172 616d 2069   n:.    :param i
+000052c0: 6e74 2066 6163 746f 723a 2066 6f72 2065  nt factor: for e
+000052d0: 6163 6820 6f66 2074 6865 2075 6e69 7473  ach of the units
+000052e0: 204b 2c20 4d2c 2047 2c20 540a 2020 2020   K, M, G, T.    
+000052f0: 3a70 6172 616d 2066 6c6f 6174 2066 7261  :param float fra
+00005300: 633a 2077 6865 6e20 746f 2067 6f20 6f76  c: when to go ov
+00005310: 6572 2074 6f20 7468 6520 6e65 7874 2062  er to the next b
+00005320: 6967 6765 7220 756e 6974 0a20 2020 203a  igger unit.    :
+00005330: 7061 7261 6d20 696e 7420 7072 6563 3a20  param int prec: 
+00005340: 686f 7720 6d75 6368 2064 6563 696d 616c  how much decimal
+00005350: 7320 6166 7465 7220 7468 6520 646f 740a  s after the dot.
+00005360: 2020 2020 3a72 6574 7572 6e3a 2068 756d      :return: hum
+00005370: 616e 2072 6561 6461 626c 6520 7369 7a65  an readable size
+00005380: 2c20 7573 696e 6720 4b2c 204d 2c20 472c  , using K, M, G,
+00005390: 2054 0a20 2020 203a 7274 7970 653a 2073   T.    :rtype: s
+000053a0: 7472 0a20 2020 2022 2222 0a20 2020 2070  tr.    """.    p
+000053b0: 6f73 7466 6978 6573 203d 205b 2222 2c20  ostfixes = ["", 
+000053c0: 224b 222c 2022 4d22 2c20 2247 222c 2022  "K", "M", "G", "
+000053d0: 5422 5d0a 2020 2020 6920 3d20 300a 2020  T"].    i = 0.  
+000053e0: 2020 7768 696c 6520 6920 3c20 6c65 6e28    while i < len(
+000053f0: 706f 7374 6669 7865 7329 202d 2031 2061  postfixes) - 1 a
+00005400: 6e64 206e 203e 2028 6661 6374 6f72 202a  nd n > (factor *
+00005410: 2a20 2869 202b 2031 2929 202a 2066 7261  * (i + 1)) * fra
+00005420: 633a 0a20 2020 2020 2020 2069 202b 3d20  c:.        i += 
+00005430: 310a 2020 2020 6966 2069 203d 3d20 303a  1.    if i == 0:
+00005440: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00005450: 7374 7228 6e29 0a20 2020 2072 6574 7572  str(n).    retur
+00005460: 6e20 2822 252e 2220 2b20 7374 7228 7072  n ("%." + str(pr
+00005470: 6563 2920 2b20 2266 2229 2025 2028 666c  ec) + "f") % (fl
+00005480: 6f61 7428 6e29 202f 2028 6661 6374 6f72  oat(n) / (factor
+00005490: 2a2a 6929 2920 2b20 706f 7374 6669 7865  **i)) + postfixe
+000054a0: 735b 695d 0a0a 0a64 6566 2068 756d 616e  s[i]...def human
+000054b0: 5f62 7974 6573 5f73 697a 6528 6e2c 2066  _bytes_size(n, f
+000054c0: 6163 746f 723d 3130 3234 2c20 6672 6163  actor=1024, frac
+000054d0: 3d30 2e38 2c20 7072 6563 3d31 293a 0a20  =0.8, prec=1):. 
+000054e0: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
+000054f0: 6d20 696e 747c 666c 6f61 7420 6e3a 0a20  m int|float n:. 
+00005500: 2020 203a 7061 7261 6d20 696e 7420 6661     :param int fa
+00005510: 6374 6f72 3a20 7365 6520 3a66 756e 633a  ctor: see :func:
+00005520: 6068 756d 616e 5f73 697a 6560 2e20 3130  `human_size`. 10
+00005530: 3234 2062 7920 6465 6661 756c 7420 666f  24 by default fo
+00005540: 7220 6279 7465 730a 2020 2020 3a70 6172  r bytes.    :par
+00005550: 616d 2066 6c6f 6174 2066 7261 633a 2073  am float frac: s
+00005560: 6565 203a 6675 6e63 3a60 6875 6d61 6e5f  ee :func:`human_
+00005570: 7369 7a65 600a 2020 2020 3a70 6172 616d  size`.    :param
+00005580: 2069 6e74 2070 7265 633a 2068 6f77 206d   int prec: how m
+00005590: 7563 6820 6465 6369 6d61 6c73 2061 6674  uch decimals aft
+000055a0: 6572 2074 6865 2064 6f74 0a20 2020 203a  er the dot.    :
+000055b0: 7265 7475 726e 3a20 6875 6d61 6e20 7265  return: human re
+000055c0: 6164 6162 6c65 2062 7974 6520 7369 7a65  adable byte size
+000055d0: 2c20 7573 696e 6720 4b2c 204d 2c20 472c  , using K, M, G,
+000055e0: 2054 2c20 7769 7468 2022 4222 2061 7420   T, with "B" at 
+000055f0: 7468 6520 656e 640a 2020 2020 3a72 7479  the end.    :rty
+00005600: 7065 3a20 7374 720a 2020 2020 2222 220a  pe: str.    """.
+00005610: 2020 2020 7265 7475 726e 2068 756d 616e      return human
+00005620: 5f73 697a 6528 6e2c 2066 6163 746f 723d  _size(n, factor=
+00005630: 6661 6374 6f72 2c20 6672 6163 3d66 7261  factor, frac=fra
+00005640: 632c 2070 7265 633d 7072 6563 2920 2b20  c, prec=prec) + 
+00005650: 2242 220a 0a0a 6465 6620 5f70 705f 6578  "B"...def _pp_ex
+00005660: 7472 615f 696e 666f 286f 626a 2c20 6465  tra_info(obj, de
+00005670: 7074 685f 6c69 6d69 743d 3329 3a0a 2020  pth_limit=3):.  
+00005680: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
+00005690: 206f 626a 6563 7420 6f62 6a3a 0a20 2020   object obj:.   
+000056a0: 203a 7061 7261 6d20 696e 7420 6465 7074   :param int dept
+000056b0: 685f 6c69 6d69 743a 0a20 2020 203a 7265  h_limit:.    :re
+000056c0: 7475 726e 3a20 6578 7472 6120 696e 666f  turn: extra info
+000056d0: 2028 6966 2061 7661 696c 6162 6c65 3a20   (if available: 
+000056e0: 6c65 6e2c 2073 6f6d 6520 6974 656d 732c  len, some items,
+000056f0: 202e 2e2e 290a 2020 2020 3a72 7479 7065   ...).    :rtype
+00005700: 3a20 7374 720a 2020 2020 2222 220a 2020  : str.    """.  
+00005710: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00005720: 6f62 6a2c 206e 702e 6e64 6172 7261 7929  obj, np.ndarray)
+00005730: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00005740: 2022 7368 6170 653d 2572 2220 2520 286f   "shape=%r" % (o
+00005750: 626a 2e73 6861 7065 2c29 0a20 2020 2073  bj.shape,).    s
+00005760: 203d 205b 5d0a 2020 2020 6966 2068 6173   = [].    if has
+00005770: 6174 7472 286f 626a 2c20 225f 5f6c 656e  attr(obj, "__len
+00005780: 5f5f 2229 3a0a 2020 2020 2020 2020 2320  __"):.        # 
+00005790: 6e6f 696e 7370 6563 7469 6f6e 2050 7942  noinspection PyB
+000057a0: 726f 6164 4578 6365 7074 696f 6e0a 2020  roadException.  
+000057b0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000057c0: 2020 2020 2020 2023 206e 6f69 6e73 7065         # noinspe
+000057d0: 6374 696f 6e20 5079 5479 7065 4368 6563  ction PyTypeChec
+000057e0: 6b65 720a 2020 2020 2020 2020 2020 2020  ker.            
+000057f0: 6966 2074 7970 6528 6f62 6a29 2069 6e20  if type(obj) in 
+00005800: 2873 7472 2c20 756e 6963 6f64 652c 206c  (str, unicode, l
+00005810: 6973 742c 2074 7570 6c65 2c20 6469 6374  ist, tuple, dict
+00005820: 2920 616e 6420 6c65 6e28 6f62 6a29 203c  ) and len(obj) <
+00005830: 3d20 353a 0a20 2020 2020 2020 2020 2020  = 5:.           
+00005840: 2020 2020 2070 6173 7320 2023 2064 6f6e       pass  # don
+00005850: 2774 2070 7269 6e74 206c 656e 2069 6e20  't print len in 
+00005860: 7468 6973 2063 6173 650a 2020 2020 2020  this case.      
+00005870: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00005880: 2020 2020 2020 2020 2020 2020 7320 2b3d              s +=
+00005890: 205b 226c 656e 203d 2025 6922 2025 206f   ["len = %i" % o
+000058a0: 626a 2e5f 5f6c 656e 5f5f 2829 5d20 2023  bj.__len__()]  #
+000058b0: 206e 6f71 610a 2020 2020 2020 2020 6578   noqa.        ex
+000058c0: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+000058d0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+000058e0: 0a20 2020 2069 6620 6465 7074 685f 6c69  .    if depth_li
+000058f0: 6d69 7420 3e20 3020 616e 6420 6861 7361  mit > 0 and hasa
+00005900: 7474 7228 6f62 6a2c 2022 5f5f 6765 7469  ttr(obj, "__geti
+00005910: 7465 6d5f 5f22 293a 0a20 2020 2020 2020  tem__"):.       
+00005920: 2023 206e 6f69 6e73 7065 6374 696f 6e20   # noinspection 
+00005930: 5079 4272 6f61 6445 7863 6570 7469 6f6e  PyBroadException
+00005940: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00005950: 2020 2020 2020 2020 2020 6966 2074 7970            if typ
+00005960: 6528 6f62 6a29 2069 6e20 2873 7472 2c20  e(obj) in (str, 
+00005970: 756e 6963 6f64 6529 3a0a 2020 2020 2020  unicode):.      
+00005980: 2020 2020 2020 2020 2020 7061 7373 2020            pass  
+00005990: 2320 646f 6573 6e27 7420 6d61 6b65 2073  # doesn't make s
+000059a0: 656e 7365 2074 6f20 6765 7420 7375 6220  ense to get sub 
+000059b0: 6974 656d 7320 6865 7265 0a20 2020 2020  items here.     
+000059c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000059d0: 2020 2020 2020 2020 2020 2020 2073 7562               sub
+000059e0: 5f6f 626a 203d 206f 626a 2e5f 5f67 6574  _obj = obj.__get
+000059f0: 6974 656d 5f5f 2830 2920 2023 206e 6f71  item__(0)  # noq
+00005a00: 610a 2020 2020 2020 2020 2020 2020 2020  a.              
+00005a10: 2020 6578 7472 615f 696e 666f 203d 205f    extra_info = _
+00005a20: 7070 5f65 7874 7261 5f69 6e66 6f28 7375  pp_extra_info(su
+00005a30: 625f 6f62 6a2c 2064 6570 7468 5f6c 696d  b_obj, depth_lim
+00005a40: 6974 202d 2031 290a 2020 2020 2020 2020  it - 1).        
+00005a50: 2020 2020 2020 2020 6966 2065 7874 7261          if extra
+00005a60: 5f69 6e66 6f20 213d 2022 223a 0a20 2020  _info != "":.   
+00005a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a80: 2073 202b 3d20 5b22 5f5b 305d 3a20 7b25   s += ["_[0]: {%
+00005a90: 737d 2220 2520 6578 7472 615f 696e 666f  s}" % extra_info
+00005aa0: 5d0a 2020 2020 2020 2020 6578 6365 7074  ].        except
+00005ab0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+00005ac0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00005ad0: 2072 6574 7572 6e20 222c 2022 2e6a 6f69   return ", ".joi
+00005ae0: 6e28 7329 0a0a 0a5f 7072 6574 7479 5f70  n(s)..._pretty_p
+00005af0: 7269 6e74 5f6c 696d 6974 203d 2033 3030  rint_limit = 300
+00005b00: 0a5f 7072 6574 7479 5f70 7269 6e74 5f61  ._pretty_print_a
+00005b10: 735f 6279 7465 7320 3d20 4661 6c73 650a  s_bytes = False.
+00005b20: 0a0a 6465 6620 7365 745f 7072 6574 7479  ..def set_pretty
+00005b30: 5f70 7269 6e74 5f64 6566 6175 6c74 5f6c  _print_default_l
+00005b40: 696d 6974 286c 696d 6974 293a 0a20 2020  imit(limit):.   
+00005b50: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
+00005b60: 696e 747c 666c 6f61 7420 6c69 6d69 743a  int|float limit:
+00005b70: 2075 7365 2066 6c6f 6174 2822 696e 6622   use float("inf"
+00005b80: 2920 746f 2064 6973 6162 6c65 0a20 2020  ) to disable.   
+00005b90: 2022 2222 0a20 2020 2067 6c6f 6261 6c20   """.    global 
+00005ba0: 5f70 7265 7474 795f 7072 696e 745f 6c69  _pretty_print_li
+00005bb0: 6d69 740a 2020 2020 5f70 7265 7474 795f  mit.    _pretty_
+00005bc0: 7072 696e 745f 6c69 6d69 7420 3d20 6c69  print_limit = li
+00005bd0: 6d69 740a 0a0a 6465 6620 7365 745f 7072  mit...def set_pr
+00005be0: 6574 7479 5f70 7269 6e74 5f61 735f 6279  etty_print_as_by
+00005bf0: 7465 7328 6173 5f62 7974 6573 293a 0a20  tes(as_bytes):. 
+00005c00: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
+00005c10: 6d20 626f 6f6c 2061 735f 6279 7465 733a  m bool as_bytes:
+00005c20: 0a20 2020 2022 2222 0a20 2020 2067 6c6f  .    """.    glo
+00005c30: 6261 6c20 5f70 7265 7474 795f 7072 696e  bal _pretty_prin
+00005c40: 745f 6173 5f62 7974 6573 0a20 2020 205f  t_as_bytes.    _
+00005c50: 7072 6574 7479 5f70 7269 6e74 5f61 735f  pretty_print_as_
+00005c60: 6279 7465 7320 3d20 6173 5f62 7974 6573  bytes = as_bytes
+00005c70: 0a0a 0a64 6566 2070 7265 7474 795f 7072  ...def pretty_pr
+00005c80: 696e 7428 6f62 6a2c 206c 696d 6974 3d4e  int(obj, limit=N
+00005c90: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
+00005ca0: 2020 3a70 6172 616d 206f 626a 6563 7420    :param object 
+00005cb0: 6f62 6a3a 0a20 2020 203a 7061 7261 6d20  obj:.    :param 
+00005cc0: 696e 747c 666c 6f61 7420 6c69 6d69 743a  int|float limit:
+00005cd0: 2075 7365 2066 6c6f 6174 2822 696e 6622   use float("inf"
+00005ce0: 2920 746f 2064 6973 6162 6c65 2e20 4e6f  ) to disable. No
+00005cf0: 6e65 2077 696c 6c20 7573 6520 7468 6520  ne will use the 
+00005d00: 6465 6661 756c 742c 2076 6961 2073 6574  default, via set
+00005d10: 5f70 7265 7474 795f 7072 696e 745f 6465  _pretty_print_de
+00005d20: 6661 756c 745f 6c69 6d69 740a 2020 2020  fault_limit.    
+00005d30: 3a72 6574 7572 6e3a 2072 6570 7228 6f62  :return: repr(ob
+00005d40: 6a29 2c20 6f72 2073 6f6d 6520 7368 6f72  j), or some shor
+00005d50: 7465 6420 7665 7273 696f 6e20 6f66 2074  ted version of t
+00005d60: 6861 742c 206d 6179 6265 2077 6974 6820  hat, maybe with 
+00005d70: 6578 7472 6120 696e 666f 0a20 2020 203a  extra info.    :
+00005d80: 7274 7970 653a 2073 7472 0a20 2020 2022  rtype: str.    "
+00005d90: 2222 0a20 2020 2069 6620 5f70 7265 7474  "".    if _prett
+00005da0: 795f 7072 696e 745f 6173 5f62 7974 6573  y_print_as_bytes
+00005db0: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
+00005dc0: 6f62 6a2c 206e 702e 6e64 6172 7261 7929  obj, np.ndarray)
+00005dd0: 3a0a 2020 2020 2020 2020 6273 203d 206f  :.        bs = o
+00005de0: 626a 2e74 6f62 7974 6573 2829 0a20 2020  bj.tobytes().   
+00005df0: 2020 2020 2069 6d70 6f72 7420 677a 6970       import gzip
+00005e00: 0a0a 2020 2020 2020 2020 6273 203d 2067  ..        bs = g
+00005e10: 7a69 702e 636f 6d70 7265 7373 2862 7329  zip.compress(bs)
+00005e20: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+00005e30: 6261 7365 3634 0a0a 2020 2020 2020 2020  base64..        
+00005e40: 6966 206c 656e 2862 7329 203e 2035 373a  if len(bs) > 57:
+00005e50: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00005e60: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
+00005e70: 2020 2020 7768 696c 6520 6c65 6e28 6273      while len(bs
+00005e80: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+00005e90: 2020 2020 2020 2070 6172 7473 2e61 7070         parts.app
+00005ea0: 656e 6428 6273 5b3a 3537 5d29 0a20 2020  end(bs[:57]).   
+00005eb0: 2020 2020 2020 2020 2020 2020 2062 7320               bs 
+00005ec0: 3d20 6273 5b35 373a 5d0a 2020 2020 2020  = bs[57:].      
+00005ed0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00005ee0: 2862 7329 203d 3d20 303a 0a20 2020 2020  (bs) == 0:.     
+00005ef0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00005f00: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+00005f10: 2073 203d 2022 5c6e 2020 2220 2b20 225c   s = "\n  " + "\
+00005f20: 6e20 2022 2e6a 6f69 6e28 5b72 6570 7228  n  ".join([repr(
+00005f30: 6261 7365 3634 2e65 6e63 6f64 6562 7974  base64.encodebyt
+00005f40: 6573 2862 7329 2e73 7472 6970 2829 2920  es(bs).strip()) 
+00005f50: 666f 7220 6273 2069 6e20 7061 7274 735d  for bs in parts]
+00005f60: 2920 2b20 225c 6e20 2022 0a20 2020 2020  ) + "\n  ".     
+00005f70: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00005f80: 2020 2020 2073 203d 2072 6570 7228 6261       s = repr(ba
+00005f90: 7365 3634 2e65 6e63 6f64 6562 7974 6573  se64.encodebytes
+00005fa0: 2862 7329 2e73 7472 6970 2829 290a 2020  (bs).strip()).  
+00005fb0: 2020 2020 2020 7320 3d20 226e 756d 7079        s = "numpy
+00005fc0: 2e66 726f 6d62 7566 6665 7228 677a 6970  .frombuffer(gzip
+00005fd0: 2e64 6563 6f6d 7072 6573 7328 6261 7365  .decompress(base
+00005fe0: 3634 2e64 6563 6f64 6562 7974 6573 2825  64.decodebytes(%
+00005ff0: 7329 292c 2064 7479 7065 3d25 7229 2e72  s)), dtype=%r).r
+00006000: 6573 6861 7065 2825 7229 2220 2520 280a  eshape(%r)" % (.
+00006010: 2020 2020 2020 2020 2020 2020 732c 0a20              s,. 
+00006020: 2020 2020 2020 2020 2020 2073 7472 286f             str(o
+00006030: 626a 2e64 7479 7065 292c 0a20 2020 2020  bj.dtype),.     
+00006040: 2020 2020 2020 206f 626a 2e73 6861 7065         obj.shape
+00006050: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00006060: 656c 7365 3a0a 2020 2020 2020 2020 7320  else:.        s 
+00006070: 3d20 7265 7072 286f 626a 290a 2020 2020  = repr(obj).    
+00006080: 6966 206c 696d 6974 2069 7320 4e6f 6e65  if limit is None
+00006090: 3a0a 2020 2020 2020 2020 6c69 6d69 7420  :.        limit 
+000060a0: 3d20 5f70 7265 7474 795f 7072 696e 745f  = _pretty_print_
+000060b0: 6c69 6d69 740a 2020 2020 6966 206c 656e  limit.    if len
+000060c0: 2873 2920 3e20 6c69 6d69 743a 0a20 2020  (s) > limit:.   
+000060d0: 2020 2020 2073 203d 2073 5b3a 2069 6e74       s = s[: int
+000060e0: 286c 696d 6974 2920 2d20 335d 0a20 2020  (limit) - 3].   
+000060f0: 2020 2020 2073 202b 3d20 222e 2e2e 220a       s += "...".
+00006100: 2020 2020 6578 7472 615f 696e 666f 203d      extra_info =
+00006110: 205f 7070 5f65 7874 7261 5f69 6e66 6f28   _pp_extra_info(
+00006120: 6f62 6a29 0a20 2020 2069 6620 6578 7472  obj).    if extr
+00006130: 615f 696e 666f 2021 3d20 2222 3a0a 2020  a_info != "":.  
+00006140: 2020 2020 2020 7320 2b3d 2022 2c20 2220        s += ", " 
+00006150: 2b20 6578 7472 615f 696e 666f 0a20 2020  + extra_info.   
+00006160: 2072 6574 7572 6e20 730a 0a0a 6465 6620   return s...def 
+00006170: 7072 6f67 7265 7373 5f62 6172 2863 6f6d  progress_bar(com
+00006180: 706c 6574 653d 312e 302c 2070 7265 6669  plete=1.0, prefi
+00006190: 783d 2222 2c20 7375 6666 6978 3d22 222c  x="", suffix="",
+000061a0: 2066 696c 653d 4e6f 6e65 293a 0a20 2020   file=None):.   
+000061b0: 2022 2222 0a20 2020 2050 7269 6e74 7320   """.    Prints 
+000061c0: 736f 6d65 2070 726f 6772 6573 7320 6261  some progress ba
+000061d0: 722e 0a0a 2020 2020 3a70 6172 616d 2066  r...    :param f
+000061e0: 6c6f 6174 2063 6f6d 706c 6574 653a 2066  loat complete: f
+000061f0: 726f 6d20 302e 3020 746f 2031 2e30 0a20  rom 0.0 to 1.0. 
+00006200: 2020 203a 7061 7261 6d20 7374 7220 7072     :param str pr
+00006210: 6566 6978 3a0a 2020 2020 3a70 6172 616d  efix:.    :param
+00006220: 2073 7472 2073 7566 6669 783a 0a20 2020   str suffix:.   
+00006230: 203a 7061 7261 6d20 696f 2e54 6578 7449   :param io.TextI
+00006240: 4f57 7261 7070 6572 7c74 7970 696e 672e  OWrapper|typing.
+00006250: 5465 7874 494f 7c4e 6f6e 6520 6669 6c65  TextIO|None file
+00006260: 3a20 7768 6572 6520 746f 2070 7269 6e74  : where to print
+00006270: 2e20 7374 646f 7574 2062 7920 6465 6661  . stdout by defa
+00006280: 756c 740a 2020 2020 3a72 6574 7572 6e3a  ult.    :return:
+00006290: 206e 6f74 6869 6e67 2c20 7769 6c6c 2070   nothing, will p
+000062a0: 7269 6e74 206f 6e20 6060 6669 6c65 6060  rint on ``file``
+000062b0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+000062c0: 6669 6c65 2069 7320 4e6f 6e65 3a0a 2020  file is None:.  
+000062d0: 2020 2020 2020 6669 6c65 203d 2073 7973        file = sys
+000062e0: 2e73 7464 6f75 740a 2020 2020 7465 726d  .stdout.    term
+000062f0: 696e 616c 5f77 6964 7468 2c20 5f20 3d20  inal_width, _ = 
+00006300: 7465 726d 696e 616c 5f73 697a 6528 6669  terminal_size(fi
+00006310: 6c65 3d66 696c 6529 0a20 2020 2069 6620  le=file).    if 
+00006320: 7465 726d 696e 616c 5f77 6964 7468 203c  terminal_width <
+00006330: 3d20 303a 0a20 2020 2020 2020 2072 6574  = 0:.        ret
+00006340: 7572 6e0a 2020 2020 6966 2063 6f6d 706c  urn.    if compl
+00006350: 6574 6520 3d3d 2031 2e30 3a0a 2020 2020  ete == 1.0:.    
+00006360: 2020 2020 6669 6c65 2e77 7269 7465 2822      file.write("
+00006370: 5c72 2573 2220 2520 2874 6572 6d69 6e61  \r%s" % (termina
+00006380: 6c5f 7769 6474 6820 2a20 2220 2229 290a  l_width * " ")).
+00006390: 2020 2020 2020 2020 6669 6c65 2e66 6c75          file.flu
+000063a0: 7368 2829 0a20 2020 2020 2020 2066 696c  sh().        fil
+000063b0: 652e 7772 6974 6528 225c 7222 290a 2020  e.write("\r").  
+000063c0: 2020 2020 2020 6669 6c65 2e66 6c75 7368        file.flush
+000063d0: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
+000063e0: 6e0a 2020 2020 7072 6f67 7265 7373 203d  n.    progress =
+000063f0: 2022 252e 3032 6625 2522 2025 2028 636f   "%.02f%%" % (co
+00006400: 6d70 6c65 7465 202a 2031 3030 290a 2020  mplete * 100).  
+00006410: 2020 6966 2070 7265 6669 7820 213d 2022    if prefix != "
+00006420: 223a 0a20 2020 2020 2020 2070 7265 6669  ":.        prefi
+00006430: 7820 3d20 7072 6566 6978 202b 2022 2022  x = prefix + " "
+00006440: 0a20 2020 2069 6620 7375 6666 6978 2021  .    if suffix !
+00006450: 3d20 2222 3a0a 2020 2020 2020 2020 7375  = "":.        su
+00006460: 6666 6978 203d 2022 2022 202b 2073 7566  ffix = " " + suf
+00006470: 6669 780a 2020 2020 6e74 6f74 616c 203d  fix.    ntotal =
+00006480: 2074 6572 6d69 6e61 6c5f 7769 6474 6820   terminal_width 
+00006490: 2d20 6c65 6e28 7072 6f67 7265 7373 2920  - len(progress) 
+000064a0: 2d20 6c65 6e28 7072 6566 6978 2920 2d20  - len(prefix) - 
+000064b0: 6c65 6e28 7375 6666 6978 2920 2d20 340a  len(suffix) - 4.
+000064c0: 2020 2020 6261 7273 203d 2022 7c22 202a      bars = "|" *
+000064d0: 2069 6e74 2863 6f6d 706c 6574 6520 2a20   int(complete * 
+000064e0: 6e74 6f74 616c 290a 2020 2020 7370 6163  ntotal).    spac
+000064f0: 6573 203d 2022 2022 202a 2028 6e74 6f74  es = " " * (ntot
+00006500: 616c 202d 2069 6e74 2863 6f6d 706c 6574  al - int(complet
+00006510: 6520 2a20 6e74 6f74 616c 2929 0a20 2020  e * ntotal)).   
+00006520: 2062 6172 203d 2062 6172 7320 2b20 7370   bar = bars + sp
+00006530: 6163 6573 0a20 2020 2066 696c 652e 7772  aces.    file.wr
+00006540: 6974 6528 0a20 2020 2020 2020 2022 5c72  ite(.        "\r
+00006550: 2573 2220 2520 7072 6566 6978 202b 2022  %s" % prefix + "
+00006560: 5b22 202b 2062 6172 5b3a 206c 656e 2862  [" + bar[: len(b
+00006570: 6172 2920 2f2f 2032 5d20 2b20 2220 2220  ar) // 2] + " " 
+00006580: 2b20 7072 6f67 7265 7373 202b 2022 2022  + progress + " "
+00006590: 202b 2062 6172 5b6c 656e 2862 6172 2920   + bar[len(bar) 
+000065a0: 2f2f 2032 203a 5d20 2b20 225d 2220 2b20  // 2 :] + "]" + 
+000065b0: 7375 6666 6978 0a20 2020 2029 0a20 2020  suffix.    ).   
+000065c0: 2066 696c 652e 666c 7573 6828 290a 0a0a   file.flush()...
+000065d0: 636c 6173 7320 5f50 726f 6772 6573 7342  class _ProgressB
+000065e0: 6172 5769 7468 5469 6d65 5374 6174 733a  arWithTimeStats:
+000065f0: 0a20 2020 2022 2222 0a20 2020 2047 6c6f  .    """.    Glo
+00006600: 6261 6c20 636c 6f73 7572 652e 2055 7365  bal closure. Use
+00006610: 6420 6279 203a 6675 6e63 3a60 7072 6f67  d by :func:`prog
+00006620: 7265 7373 5f62 6172 5f77 6974 685f 7469  ress_bar_with_ti
+00006630: 6d65 602e 0a20 2020 2022 2222 0a0a 2020  me`..    """..  
+00006640: 2020 7374 6172 745f 7469 6d65 203d 204e    start_time = N
+00006650: 6f6e 650a 2020 2020 6c61 7374 5f63 6f6d  one.    last_com
+00006660: 706c 6574 6520 3d20 4e6f 6e65 0a0a 0a64  plete = None...d
+00006670: 6566 2070 726f 6772 6573 735f 6261 725f  ef progress_bar_
+00006680: 7769 7468 5f74 696d 6528 636f 6d70 6c65  with_time(comple
+00006690: 7465 3d31 2e30 2c20 7072 6566 6978 3d22  te=1.0, prefix="
+000066a0: 222c 202a 2a6b 7761 7267 7329 3a0a 2020  ", **kwargs):.  
+000066b0: 2020 2222 220a 2020 2020 3a66 756e 633a    """.    :func:
+000066c0: 6070 726f 6772 6573 735f 6261 7260 2077  `progress_bar` w
+000066d0: 6974 6820 6164 6469 7469 6f6e 616c 2072  ith additional r
+000066e0: 656d 6169 6e69 6e67 2074 696d 6520 6573  emaining time es
+000066f0: 7469 6d61 7469 6f6e 2e0a 0a20 2020 203a  timation...    :
+00006700: 7061 7261 6d20 666c 6f61 7420 636f 6d70  param float comp
+00006710: 6c65 7465 3a0a 2020 2020 3a70 6172 616d  lete:.    :param
+00006720: 2073 7472 2070 7265 6669 783a 0a20 2020   str prefix:.   
+00006730: 203a 7061 7261 6d20 6b77 6172 6773 3a20   :param kwargs: 
+00006740: 7061 7373 6564 2074 6f20 3a66 756e 633a  passed to :func:
+00006750: 6070 726f 6772 6573 735f 6261 7260 0a20  `progress_bar`. 
+00006760: 2020 203a 7265 7475 726e 3a20 6e6f 7468     :return: noth
+00006770: 696e 670a 2020 2020 2222 220a 2020 2020  ing.    """.    
+00006780: 7374 6174 7320 3d20 5f50 726f 6772 6573  stats = _Progres
+00006790: 7342 6172 5769 7468 5469 6d65 5374 6174  sBarWithTimeStat
+000067a0: 730a 2020 2020 6966 2073 7461 7473 2e73  s.    if stats.s
+000067b0: 7461 7274 5f74 696d 6520 6973 204e 6f6e  tart_time is Non
+000067c0: 653a 0a20 2020 2020 2020 2073 7461 7473  e:.        stats
+000067d0: 2e73 7461 7274 5f74 696d 6520 3d20 7469  .start_time = ti
+000067e0: 6d65 2e74 696d 6528 290a 2020 2020 2020  me.time().      
+000067f0: 2020 7374 6174 732e 6c61 7374 5f63 6f6d    stats.last_com
+00006800: 706c 6574 6520 3d20 636f 6d70 6c65 7465  plete = complete
+00006810: 0a20 2020 2069 6620 7374 6174 732e 6c61  .    if stats.la
+00006820: 7374 5f63 6f6d 706c 6574 6520 3e20 636f  st_complete > co
+00006830: 6d70 6c65 7465 3a0a 2020 2020 2020 2020  mplete:.        
+00006840: 7374 6174 732e 7374 6172 745f 7469 6d65  stats.start_time
+00006850: 203d 2074 696d 652e 7469 6d65 2829 0a20   = time.time(). 
+00006860: 2020 2073 7461 7473 2e6c 6173 745f 636f     stats.last_co
+00006870: 6d70 6c65 7465 203d 2063 6f6d 706c 6574  mplete = complet
+00006880: 650a 0a20 2020 2073 7461 7274 5f65 6c61  e..    start_ela
+00006890: 7073 6564 203d 2074 696d 652e 7469 6d65  psed = time.time
+000068a0: 2829 202d 2073 7461 7473 2e73 7461 7274  () - stats.start
+000068b0: 5f74 696d 650a 2020 2020 6966 2063 6f6d  _time.    if com
+000068c0: 706c 6574 6520 3e20 303a 0a20 2020 2020  plete > 0:.     
+000068d0: 2020 2074 6f74 616c 5f74 696d 655f 6573     total_time_es
+000068e0: 7469 6d61 7465 6420 3d20 7374 6172 745f  timated = start_
+000068f0: 656c 6170 7365 6420 2f20 636f 6d70 6c65  elapsed / comple
+00006900: 7465 0a20 2020 2020 2020 2072 656d 6169  te.        remai
+00006910: 6e69 6e67 5f65 7374 696d 6174 6564 203d  ning_estimated =
+00006920: 2074 6f74 616c 5f74 696d 655f 6573 7469   total_time_esti
+00006930: 6d61 7465 6420 2d20 7374 6172 745f 656c  mated - start_el
+00006940: 6170 7365 640a 2020 2020 2020 2020 6966  apsed.        if
+00006950: 2070 7265 6669 783a 0a20 2020 2020 2020   prefix:.       
+00006960: 2020 2020 2070 7265 6669 7820 2b3d 2022       prefix += "
+00006970: 2c20 2220 2b20 686d 7328 7265 6d61 696e  , " + hms(remain
+00006980: 696e 675f 6573 7469 6d61 7465 6429 0a20  ing_estimated). 
+00006990: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000069a0: 2020 2020 2020 2020 2070 7265 6669 7820           prefix 
+000069b0: 3d20 686d 7328 7265 6d61 696e 696e 675f  = hms(remaining_
+000069c0: 6573 7469 6d61 7465 6429 0a20 2020 2070  estimated).    p
+000069d0: 726f 6772 6573 735f 6261 7228 636f 6d70  rogress_bar(comp
+000069e0: 6c65 7465 2c20 7072 6566 6978 3d70 7265  lete, prefix=pre
+000069f0: 6669 782c 202a 2a6b 7761 7267 7329 0a0a  fix, **kwargs)..
+00006a00: 0a64 6566 2061 7661 696c 6162 6c65 5f70  .def available_p
+00006a10: 6879 7369 6361 6c5f 6d65 6d6f 7279 5f69  hysical_memory_i
+00006a20: 6e5f 6279 7465 7328 293a 0a20 2020 2022  n_bytes():.    "
+00006a30: 2222 0a20 2020 203a 7274 7970 653a 2069  "".    :rtype: i
+00006a40: 6e74 0a20 2020 2022 2222 0a20 2020 2023  nt.    """.    #
+00006a50: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
+00006a60: 4272 6f61 6445 7863 6570 7469 6f6e 0a20  BroadException. 
+00006a70: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00006a80: 6d65 6d5f 6279 7465 7320 3d20 6f73 2e73  mem_bytes = os.s
+00006a90: 7973 636f 6e66 2822 5343 5f50 4147 455f  ysconf("SC_PAGE_
+00006aa0: 5349 5a45 2229 202a 206f 732e 7379 7363  SIZE") * os.sysc
+00006ab0: 6f6e 6628 2253 435f 5048 5953 5f50 4147  onf("SC_PHYS_PAG
+00006ac0: 4553 2229 0a20 2020 2065 7863 6570 7420  ES").    except 
+00006ad0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00006ae0: 2020 206d 656d 5f62 7974 6573 203d 2031     mem_bytes = 1
+00006af0: 3032 342a 2a34 2020 2320 6a75 7374 2073  024**4  # just s
+00006b00: 6f6d 6520 7261 6e64 6f6d 206e 756d 6265  ome random numbe
+00006b10: 722c 2031 5442 0a20 2020 2072 6574 7572  r, 1TB.    retur
+00006b20: 6e20 6d65 6d5f 6279 7465 730a 0a0a 6465  n mem_bytes...de
+00006b30: 6620 6465 6661 756c 745f 6361 6368 655f  f default_cache_
+00006b40: 7369 7a65 5f69 6e5f 6762 7974 6573 2866  size_in_gbytes(f
+00006b50: 6163 746f 723d 302e 3729 3a0a 2020 2020  actor=0.7):.    
+00006b60: 2222 220a 2020 2020 3a70 6172 616d 2066  """.    :param f
+00006b70: 6c6f 6174 7c69 6e74 2066 6163 746f 723a  loat|int factor:
+00006b80: 0a20 2020 203a 7274 7970 653a 2069 6e74  .    :rtype: int
+00006b90: 0a20 2020 2022 2222 0a20 2020 206d 656d  .    """.    mem
+00006ba0: 5f67 6279 7465 7320 3d20 6176 6169 6c61  _gbytes = availa
+00006bb0: 626c 655f 7068 7973 6963 616c 5f6d 656d  ble_physical_mem
+00006bc0: 6f72 795f 696e 5f62 7974 6573 2829 202f  ory_in_bytes() /
+00006bd0: 2028 3130 3234 2e30 2a2a 3329 0a20 2020   (1024.0**3).   
+00006be0: 2072 6574 7572 6e20 696e 7428 6d65 6d5f   return int(mem_
+00006bf0: 6762 7974 6573 202a 2066 6163 746f 7229  gbytes * factor)
+00006c00: 0a0a 0a64 6566 2062 6574 7465 725f 7265  ...def better_re
+00006c10: 7072 286f 293a 0a20 2020 2022 2222 0a20  pr(o):.    """. 
+00006c20: 2020 2054 6865 206d 6169 6e20 6469 6666     The main diff
+00006c30: 6572 656e 6365 2074 6f20 3a66 756e 633a  erence to :func:
+00006c40: 6072 6570 7260 3a20 7468 6973 206f 6e65  `repr`: this one
+00006c50: 2069 7320 6465 7465 726d 696e 6973 7469   is deterministi
+00006c60: 632e 0a20 2020 2054 6865 206f 7269 6720  c..    The orig 
+00006c70: 6469 6374 2e5f 5f72 6570 725f 5f20 6861  dict.__repr__ ha
+00006c80: 7320 7468 6520 6f72 6465 7220 756e 6465  s the order unde
+00006c90: 6669 6e65 6420 666f 7220 6469 6374 206f  fined for dict o
+00006ca0: 7220 7365 742e 0a20 2020 2046 6f72 2062  r set..    For b
+00006cb0: 6967 2064 6963 7473 2f73 6574 732f 6c69  ig dicts/sets/li
+00006cc0: 7374 732c 2061 6464 2022 2c22 2061 7420  sts, add "," at 
+00006cd0: 7468 6520 656e 6420 746f 206d 616b 6520  the end to make 
+00006ce0: 7465 7874 7561 6c20 6469 6666 7320 6e69  textual diffs ni
+00006cf0: 6365 722e 0a0a 2020 2020 3a70 6172 616d  cer...    :param
+00006d00: 206f 626a 6563 7420 6f3a 0a20 2020 203a   object o:.    :
+00006d10: 7274 7970 653a 2073 7472 0a20 2020 2022  rtype: str.    "
+00006d20: 2222 0a20 2020 2069 6620 6973 696e 7374  "".    if isinst
+00006d30: 616e 6365 286f 2c20 6c69 7374 293a 0a20  ance(o, list):. 
+00006d40: 2020 2020 2020 2072 6574 7572 6e20 225b         return "[
+00006d50: 5c6e 2573 5d22 2025 2022 222e 6a6f 696e  \n%s]" % "".join
+00006d60: 286d 6170 286c 616d 6264 6120 763a 2062  (map(lambda v: b
+00006d70: 6574 7465 725f 7265 7072 2876 2920 2b20  etter_repr(v) + 
+00006d80: 222c 5c6e 222c 206f 2929 0a20 2020 2069  ",\n", o)).    i
+00006d90: 6620 6973 696e 7374 616e 6365 286f 2c20  f isinstance(o, 
+00006da0: 6465 7175 6529 3a0a 2020 2020 2020 2020  deque):.        
+00006db0: 7265 7475 726e 2022 6465 7175 6528 5b5c  return "deque([\
+00006dc0: 6e25 735d 2922 2025 2022 222e 6a6f 696e  n%s])" % "".join
+00006dd0: 286d 6170 286c 616d 6264 6120 763a 2062  (map(lambda v: b
+00006de0: 6574 7465 725f 7265 7072 2876 2920 2b20  etter_repr(v) + 
+00006df0: 222c 5c6e 222c 206f 2929 0a20 2020 2069  ",\n", o)).    i
+00006e00: 6620 6973 696e 7374 616e 6365 286f 2c20  f isinstance(o, 
+00006e10: 7475 706c 6529 3a0a 2020 2020 2020 2020  tuple):.        
+00006e20: 6966 206c 656e 286f 2920 3d3d 2031 3a0a  if len(o) == 1:.
+00006e30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00006e40: 726e 2022 2825 732c 2922 2025 206f 5b30  rn "(%s,)" % o[0
+00006e50: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
+00006e60: 2022 2825 7329 2220 2520 222c 2022 2e6a   "(%s)" % ", ".j
+00006e70: 6f69 6e28 6d61 7028 6265 7474 6572 5f72  oin(map(better_r
+00006e80: 6570 722c 206f 2929 0a20 2020 2069 6620  epr, o)).    if 
+00006e90: 6973 696e 7374 616e 6365 286f 2c20 6469  isinstance(o, di
+00006ea0: 6374 293a 0a20 2020 2020 2020 206c 7320  ct):.        ls 
+00006eb0: 3d20 5b62 6574 7465 725f 7265 7072 286b  = [better_repr(k
+00006ec0: 2920 2b20 223a 2022 202b 2062 6574 7465  ) + ": " + bette
+00006ed0: 725f 7265 7072 2876 2920 666f 7220 286b  r_repr(v) for (k
+00006ee0: 2c20 7629 2069 6e20 736f 7274 6564 286f  , v) in sorted(o
+00006ef0: 2e69 7465 6d73 2829 295d 0a20 2020 2020  .items())].     
+00006f00: 2020 2069 6620 7375 6d28 5b6c 656e 2876     if sum([len(v
+00006f10: 2920 666f 7220 7620 696e 206c 735d 2920  ) for v in ls]) 
+00006f20: 3e3d 2034 303a 0a20 2020 2020 2020 2020  >= 40:.         
+00006f30: 2020 2072 6574 7572 6e20 227b 5c6e 2573     return "{\n%s
+00006f40: 7d22 2025 2022 222e 6a6f 696e 285b 7620  }" % "".join([v 
+00006f50: 2b20 222c 5c6e 2220 666f 7220 7620 696e  + ",\n" for v in
+00006f60: 206c 735d 290a 2020 2020 2020 2020 656c   ls]).        el
+00006f70: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00006f80: 7265 7475 726e 2022 7b25 737d 2220 2520  return "{%s}" % 
+00006f90: 222c 2022 2e6a 6f69 6e28 6c73 290a 2020  ", ".join(ls).  
+00006fa0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00006fb0: 6f2c 2073 6574 293a 0a20 2020 2020 2020  o, set):.       
+00006fc0: 2072 6574 7572 6e20 2273 6574 285b 5c6e   return "set([\n
+00006fd0: 2573 5d29 2220 2520 2222 2e6a 6f69 6e28  %s])" % "".join(
+00006fe0: 6d61 7028 6c61 6d62 6461 2076 3a20 6265  map(lambda v: be
+00006ff0: 7474 6572 5f72 6570 7228 7629 202b 2022  tter_repr(v) + "
+00007000: 2c5c 6e22 2c20 6f29 290a 2020 2020 6966  ,\n", o)).    if
+00007010: 2069 7369 6e73 7461 6e63 6528 6f2c 2066   isinstance(o, f
+00007020: 6c6f 6174 2920 616e 6420 286d 6174 682e  loat) and (math.
+00007030: 6973 6e61 6e28 6f29 206f 7220 6d61 7468  isnan(o) or math
+00007040: 2e69 7369 6e66 286f 2929 3a0a 2020 2020  .isinf(o)):.    
+00007050: 2020 2020 7265 7475 726e 2022 666c 6f61      return "floa
+00007060: 7428 2725 7327 2922 2025 2072 6570 7228  t('%s')" % repr(
+00007070: 6f29 0a20 2020 2023 2066 616c 6c62 6163  o).    # fallbac
+00007080: 6b0a 2020 2020 7265 7475 726e 2072 6570  k.    return rep
+00007090: 7228 6f29 0a0a 0a64 6566 2073 696d 706c  r(o)...def simpl
+000070a0: 655f 6f62 6a5f 7265 7072 286f 626a 293a  e_obj_repr(obj):
+000070b0: 0a20 2020 2022 2222 0a20 2020 203a 7265  .    """.    :re
+000070c0: 7475 726e 3a20 416c 6c20 7365 6c66 2e5f  turn: All self._
+000070d0: 5f69 6e69 745f 5f20 6172 6773 2e0a 2020  _init__ args..  
+000070e0: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
+000070f0: 2020 2222 220a 2020 2020 7265 7475 726e    """.    return
+00007100: 206f 626a 2e5f 5f63 6c61 7373 5f5f 2e5f   obj.__class__._
+00007110: 5f6e 616d 655f 5f20 2b20 2228 2573 2922  _name__ + "(%s)"
+00007120: 2025 2022 2c20 222e 6a6f 696e 280a 2020   % ", ".join(.  
+00007130: 2020 2020 2020 5b22 2573 3d25 7322 2025        ["%s=%s" %
+00007140: 2028 6172 672c 2062 6574 7465 725f 7265   (arg, better_re
+00007150: 7072 2867 6574 6174 7472 286f 626a 2c20  pr(getattr(obj, 
+00007160: 6172 6729 2929 2066 6f72 2061 7267 2069  arg))) for arg i
+00007170: 6e20 6765 7461 7267 7370 6563 286f 626a  n getargspec(obj
+00007180: 2e5f 5f69 6e69 745f 5f29 2e61 7267 735b  .__init__).args[
+00007190: 313a 5d5d 0a20 2020 2029 0a0a 0a63 6c61  1:]].    )...cla
+000071a0: 7373 204f 626a 4173 4469 6374 2874 7970  ss ObjAsDict(typ
+000071b0: 696e 672e 4d61 7070 696e 675b 7374 722c  ing.Mapping[str,
+000071c0: 206f 626a 6563 745d 293a 0a20 2020 2022   object]):.    "
+000071d0: 2222 0a20 2020 2057 7261 7073 2075 7020  "".    Wraps up 
+000071e0: 616e 7920 6f62 6a65 6374 2061 7320 6120  any object as a 
+000071f0: 6469 6374 2c20 7768 6572 6520 7468 6520  dict, where the 
+00007200: 6174 7472 6962 7574 6573 2062 6563 6f6d  attributes becom
+00007210: 6573 2074 6865 206b 6579 732e 0a20 2020  es the keys..   
+00007220: 2053 6565 2061 6c73 6f20 3a63 6c61 7373   See also :class
+00007230: 3a60 4469 6374 4173 4f62 6a60 2e0a 2020  :`DictAsObj`..  
+00007240: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+00007250: 5f69 6e69 745f 5f28 7365 6c66 2c20 6f62  _init__(self, ob
+00007260: 6a29 3a0a 2020 2020 2020 2020 7365 6c66  j):.        self
+00007270: 2e5f 5f6f 626a 203d 206f 626a 0a0a 2020  .__obj = obj..  
+00007280: 2020 6465 6620 5f5f 6765 7469 7465 6d5f    def __getitem_
+00007290: 5f28 7365 6c66 2c20 6974 656d 293a 0a20  _(self, item):. 
+000072a0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+000072b0: 696e 7374 616e 6365 2869 7465 6d2c 2028  instance(item, (
+000072c0: 7374 722c 2075 6e69 636f 6465 2929 3a0a  str, unicode)):.
+000072d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000072e0: 6520 4b65 7945 7272 6f72 2869 7465 6d29  e KeyError(item)
+000072f0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00007300: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00007310: 2067 6574 6174 7472 2873 656c 662e 5f5f   getattr(self.__
+00007320: 6f62 6a2c 2069 7465 6d29 0a20 2020 2020  obj, item).     
+00007330: 2020 2065 7863 6570 7420 4174 7472 6962     except Attrib
+00007340: 7574 6545 7272 6f72 2061 7320 653a 0a20  uteError as e:. 
+00007350: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00007360: 204b 6579 4572 726f 7228 6529 0a0a 2020   KeyError(e)..  
+00007370: 2020 6465 6620 5f5f 6c65 6e5f 5f28 7365    def __len__(se
+00007380: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+00007390: 7572 6e20 6c65 6e28 7661 7273 2873 656c  urn len(vars(sel
+000073a0: 662e 5f5f 6f62 6a29 290a 0a20 2020 2064  f.__obj))..    d
+000073b0: 6566 205f 5f69 7465 725f 5f28 7365 6c66  ef __iter__(self
+000073c0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+000073d0: 6e20 6974 6572 2876 6172 7328 7365 6c66  n iter(vars(self
+000073e0: 2e5f 5f6f 626a 2929 0a0a 2020 2020 6465  .__obj))..    de
+000073f0: 6620 6974 656d 7328 7365 6c66 293a 0a20  f items(self):. 
+00007400: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00007410: 2020 203a 7265 7475 726e 3a20 7661 7273     :return: vars
+00007420: 282e 2e29 2e69 7465 6d73 2829 0a20 2020  (..).items().   
+00007430: 2020 2020 203a 7274 7970 653a 2073 6574       :rtype: set
+00007440: 5b28 7374 722c 6f62 6a65 6374 295d 0a20  [(str,object)]. 
+00007450: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00007460: 2020 2072 6574 7572 6e20 7661 7273 2873     return vars(s
+00007470: 656c 662e 5f5f 6f62 6a29 2e69 7465 6d73  elf.__obj).items
+00007480: 2829 0a0a 0a63 6c61 7373 2044 6963 7441  ()...class DictA
+00007490: 734f 626a 3a0a 2020 2020 2222 220a 2020  sObj:.    """.  
+000074a0: 2020 5772 6170 7320 7570 2061 6e79 2064    Wraps up any d
+000074b0: 6963 7469 6f6e 6172 7920 6173 2061 6e20  ictionary as an 
+000074c0: 6f62 6a65 6374 2c20 7768 6572 6520 7468  object, where th
+000074d0: 6520 6b65 7973 2062 6563 6f6d 6573 2074  e keys becomes t
+000074e0: 6865 2061 7474 7269 6275 7465 732e 0a20  he attributes.. 
+000074f0: 2020 2053 6565 2061 6c73 6f20 3a63 6c61     See also :cla
+00007500: 7373 3a60 4f62 6a41 7344 6963 7460 2e0a  ss:`ObjAsDict`..
+00007510: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+00007520: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+00007530: 6469 6b74 293a 0a20 2020 2020 2020 2022  dikt):.        "
+00007540: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
+00007550: 6d20 6469 6374 5b73 7472 5d20 6469 6b74  m dict[str] dikt
+00007560: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00007570: 2020 2020 2020 7365 6c66 2e5f 5f64 6963        self.__dic
+00007580: 745f 5f20 3d20 6469 6b74 0a0a 0a64 6566  t__ = dikt...def
+00007590: 2064 6963 745f 6a6f 696e 6564 282a 6473   dict_joined(*ds
+000075a0: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
+000075b0: 7061 7261 6d20 6469 6374 5b54 2c56 5d20  param dict[T,V] 
+000075c0: 6473 3a0a 2020 2020 3a72 6574 7572 6e3a  ds:.    :return:
+000075d0: 2061 6c6c 2064 6963 7473 206a 6f69 6e65   all dicts joine
+000075e0: 6420 746f 6765 7468 6572 0a20 2020 203a  d together.    :
+000075f0: 7274 7970 653a 2064 6963 745b 542c 565d  rtype: dict[T,V]
+00007600: 0a20 2020 2022 2222 0a20 2020 2072 6573  .    """.    res
+00007610: 203d 207b 7d0a 2020 2020 666f 7220 6420   = {}.    for d 
+00007620: 696e 2064 733a 0a20 2020 2020 2020 2072  in ds:.        r
+00007630: 6573 2e75 7064 6174 6528 6429 0a20 2020  es.update(d).   
+00007640: 2072 6574 7572 6e20 7265 730a 0a0a 6465   return res...de
+00007650: 6620 6f62 6a5f 6469 6666 5f73 7472 2873  f obj_diff_str(s
+00007660: 656c 662c 206f 7468 6572 2c20 2a2a 6b77  elf, other, **kw
+00007670: 6172 6773 293a 0a20 2020 2022 2222 0a20  args):.    """. 
+00007680: 2020 203a 7061 7261 6d20 6f62 6a65 6374     :param object
+00007690: 2073 656c 663a 0a20 2020 203a 7061 7261   self:.    :para
+000076a0: 6d20 6f62 6a65 6374 206f 7468 6572 3a0a  m object other:.
+000076b0: 2020 2020 3a72 6574 7572 6e3a 2074 6865      :return: the
+000076c0: 2064 6966 6665 7265 6e63 6520 6465 7363   difference desc
+000076d0: 7269 6265 640a 2020 2020 3a72 7479 7065  ribed.    :rtype
+000076e0: 3a20 7374 720a 2020 2020 2222 220a 2020  : str.    """.  
+000076f0: 2020 6469 6666 5f6c 6973 7420 3d20 6f62    diff_list = ob
+00007700: 6a5f 6469 6666 5f6c 6973 7428 7365 6c66  j_diff_list(self
+00007710: 2c20 6f74 6865 722c 202a 2a6b 7761 7267  , other, **kwarg
+00007720: 7329 0a20 2020 2069 6620 6e6f 7420 6469  s).    if not di
+00007730: 6666 5f6c 6973 743a 0a20 2020 2020 2020  ff_list:.       
+00007740: 2072 6574 7572 6e20 224e 6f20 6469 6666   return "No diff
+00007750: 2e22 0a20 2020 2072 6574 7572 6e20 225c  .".    return "\
+00007760: 6e22 2e6a 6f69 6e28 6469 6666 5f6c 6973  n".join(diff_lis
+00007770: 7429 0a0a 0a64 6566 206f 626a 5f64 6966  t)...def obj_dif
+00007780: 665f 6c69 7374 2873 656c 662c 206f 7468  f_list(self, oth
+00007790: 6572 2c20 2a2a 6b77 6172 6773 293a 0a20  er, **kwargs):. 
+000077a0: 2020 2022 2222 0a20 2020 204e 6f74 6520     """.    Note 
+000077b0: 7468 6174 2077 6520 7265 6375 7273 6520  that we recurse 
+000077c0: 746f 2061 2063 6572 7461 696e 2064 6567  to a certain deg
+000077d0: 7265 6520 746f 2074 6865 2069 7465 6d73  ree to the items
+000077e0: 2c20 6275 7420 6e6f 7420 6675 6c6c 792e  , but not fully.
+000077f0: 0a20 2020 2053 6f6d 6520 6469 6666 6572  .    Some differ
+00007800: 656e 6365 7320 6d69 6768 7420 6a75 7374  ences might just
+00007810: 2062 6520 7375 6d6d 6172 697a 6564 2e0a   be summarized..
+00007820: 0a20 2020 203a 7061 7261 6d20 6f62 6a65  .    :param obje
+00007830: 6374 2073 656c 663a 0a20 2020 203a 7061  ct self:.    :pa
+00007840: 7261 6d20 6f62 6a65 6374 206f 7468 6572  ram object other
+00007850: 3a0a 2020 2020 3a72 6574 7572 6e3a 2074  :.    :return: t
+00007860: 6865 2064 6966 6665 7265 6e63 6520 6465  he difference de
+00007870: 7363 7269 6265 640a 2020 2020 3a72 7479  scribed.    :rty
+00007880: 7065 3a20 6c69 7374 5b73 7472 5d0a 2020  pe: list[str].  
+00007890: 2020 2222 220a 2020 2020 2320 4861 7669    """.    # Havi
+000078a0: 6e67 2074 6865 6d20 6578 706c 6963 6974  ng them explicit
+000078b0: 6c79 2069 6e20 6b77 6172 6773 2062 6563  ly in kwargs bec
+000078c0: 6175 7365 2077 6520 6361 6e6e 6f74 2075  ause we cannot u
+000078d0: 7365 2060 2a60 2069 6e20 5079 7468 6f6e  se `*` in Python
+000078e0: 2032 2c0a 2020 2020 2320 6275 7420 7765   2,.    # but we
+000078f0: 2064 6f20 6e6f 7420 7761 6e74 2074 6f20   do not want to 
+00007900: 616c 6c6f 7720 7468 656d 2061 7320 706f  allow them as po
+00007910: 7369 7469 6f6e 616c 2061 7267 732e 0a20  sitional args.. 
+00007920: 2020 2070 7265 6669 7820 3d20 6b77 6172     prefix = kwar
+00007930: 6773 2e70 6f70 2822 5f70 7265 6669 7822  gs.pop("_prefix"
+00007940: 2c20 2222 290a 2020 2020 2320 4966 2061  , "").    # If a
+00007950: 6c6c 6f77 6564 5f6d 6170 7069 6e67 2873  llowed_mapping(s
+00007960: 656c 662c 206f 7468 6572 292c 0a20 2020  elf, other),.   
+00007970: 2023 2074 6865 7920 6172 6520 6173 7369   # they are assi
+00007980: 676e 6564 2074 6f20 7468 6520 6571 7561  gned to the equa
+00007990: 6c5f 6d61 7070 696e 672c 2069 6620 706f  l_mapping, if po
+000079a0: 7373 6962 6c65 2074 6f20 646f 2073 6f20  ssible to do so 
+000079b0: 756e 616d 6269 6775 6f75 736c 792e 0a20  unambiguously.. 
+000079c0: 2020 2061 6c6c 6f77 6564 5f6d 6170 7069     allowed_mappi
+000079d0: 6e67 203d 206b 7761 7267 732e 706f 7028  ng = kwargs.pop(
+000079e0: 2261 6c6c 6f77 6564 5f6d 6170 7069 6e67  "allowed_mapping
+000079f0: 222c 204e 6f6e 6529 0a20 2020 2065 7175  ", None).    equ
+00007a00: 616c 5f6d 6170 5f73 326f 203d 206b 7761  al_map_s2o = kwa
+00007a10: 7267 732e 706f 7028 225f 6571 7561 6c5f  rgs.pop("_equal_
+00007a20: 6d61 705f 7332 6f22 2c20 4e6f 6e65 2920  map_s2o", None) 
+00007a30: 2023 2073 656c 6620 2d3e 206f 7468 6572   # self -> other
+00007a40: 0a20 2020 2065 7175 616c 5f6d 6170 5f6f  .    equal_map_o
+00007a50: 3273 203d 206b 7761 7267 732e 706f 7028  2s = kwargs.pop(
+00007a60: 225f 6571 7561 6c5f 6d61 705f 6f32 7322  "_equal_map_o2s"
+00007a70: 2c20 4e6f 6e65 2920 2023 206f 7468 6572  , None)  # other
+00007a80: 202d 3e20 7365 6c66 0a20 2020 2065 7175   -> self.    equ
+00007a90: 616c 5f6d 6170 5f66 696e 6973 6865 6420  al_map_finished 
+00007aa0: 3d20 6b77 6172 6773 2e70 6f70 2822 5f65  = kwargs.pop("_e
+00007ab0: 7175 616c 5f6d 6170 5f66 696e 6973 6865  qual_map_finishe
+00007ac0: 6422 2c20 4661 6c73 6529 0a20 2020 2069  d", False).    i
+00007ad0: 6620 6b77 6172 6773 3a0a 2020 2020 2020  f kwargs:.      
+00007ae0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+00007af0: 7228 226f 626a 5f64 6966 665f 6c69 7374  r("obj_diff_list
+00007b00: 3a20 696e 7661 6c69 6420 6b77 6172 6773  : invalid kwargs
+00007b10: 2025 7222 2025 206b 7761 7267 7329 0a0a   %r" % kwargs)..
+00007b20: 2020 2020 6966 2073 656c 6620 6973 204e      if self is N
+00007b30: 6f6e 6520 616e 6420 6f74 6865 7220 6973  one and other is
+00007b40: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
+00007b50: 6574 7572 6e20 5b5d 0a20 2020 2069 6620  eturn [].    if 
+00007b60: 7365 6c66 2069 7320 4e6f 6e65 2061 6e64  self is None and
+00007b70: 206f 7468 6572 2069 7320 6e6f 7420 4e6f   other is not No
+00007b80: 6e65 3a0a 2020 2020 2020 2020 7265 7475  ne:.        retu
+00007b90: 726e 205b 2225 7373 656c 6620 6973 204e  rn ["%sself is N
+00007ba0: 6f6e 6520 616e 6420 6f74 6865 7220 6973  one and other is
+00007bb0: 2025 7222 2025 2028 7072 6566 6978 2c20   %r" % (prefix, 
+00007bc0: 6f74 6865 7229 5d0a 2020 2020 6966 2073  other)].    if s
+00007bd0: 656c 6620 6973 206e 6f74 204e 6f6e 6520  elf is not None 
+00007be0: 616e 6420 6f74 6865 7220 6973 204e 6f6e  and other is Non
+00007bf0: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
+00007c00: 6e20 5b22 2573 6f74 6865 7220 6973 204e  n ["%sother is N
+00007c10: 6f6e 6520 616e 6420 7365 6c66 2069 7320  one and self is 
+00007c20: 2572 2220 2520 2870 7265 6669 782c 2073  %r" % (prefix, s
+00007c30: 656c 6629 5d0a 2020 2020 6966 2074 7970  elf)].    if typ
+00007c40: 6528 7365 6c66 2920 213d 2074 7970 6528  e(self) != type(
+00007c50: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
+00007c60: 7265 7475 726e 205b 2225 7374 7970 6520  return ["%stype 
+00007c70: 6469 6666 3a20 7365 6c66 2069 7320 2573  diff: self is %s
+00007c80: 2062 7574 206f 7468 6572 2069 7320 2573   but other is %s
+00007c90: 2220 2520 2870 7265 6669 782c 2074 7970  " % (prefix, typ
+00007ca0: 6528 7365 6c66 292e 5f5f 6e61 6d65 5f5f  e(self).__name__
+00007cb0: 2c20 7479 7065 286f 7468 6572 292e 5f5f  , type(other).__
+00007cc0: 6e61 6d65 5f5f 295d 0a0a 2020 2020 6966  name__)]..    if
+00007cd0: 2061 6c6c 6f77 6564 5f6d 6170 7069 6e67   allowed_mapping
+00007ce0: 3a0a 2020 2020 2020 2020 6966 2065 7175  :.        if equ
+00007cf0: 616c 5f6d 6170 5f73 326f 2069 7320 4e6f  al_map_s2o is No
+00007d00: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007d10: 2320 4275 696c 6420 7570 2074 6865 2075  # Build up the u
+00007d20: 6e65 7175 616c 5f6d 6170 2c20 6279 2067  nequal_map, by g
+00007d30: 6f69 6e67 2074 6872 6f75 6768 2074 6865  oing through the
+00007d40: 206f 626a 6563 7473 2e0a 2020 2020 2020   objects..      
+00007d50: 2020 2020 2020 6571 7561 6c5f 6d61 705f        equal_map_
+00007d60: 7332 6f2c 2065 7175 616c 5f6d 6170 5f6f  s2o, equal_map_o
+00007d70: 3273 203d 207b 7d2c 207b 7d0a 2020 2020  2s = {}, {}.    
+00007d80: 2020 2020 2020 2020 6f62 6a5f 6469 6666          obj_diff
+00007d90: 5f6c 6973 7428 0a20 2020 2020 2020 2020  _list(.         
+00007da0: 2020 2020 2020 2073 656c 662c 206f 7468         self, oth
+00007db0: 6572 2c20 616c 6c6f 7765 645f 6d61 7070  er, allowed_mapp
+00007dc0: 696e 673d 616c 6c6f 7765 645f 6d61 7070  ing=allowed_mapp
+00007dd0: 696e 672c 205f 6571 7561 6c5f 6d61 705f  ing, _equal_map_
+00007de0: 7332 6f3d 6571 7561 6c5f 6d61 705f 7332  s2o=equal_map_s2
+00007df0: 6f2c 205f 6571 7561 6c5f 6d61 705f 6f32  o, _equal_map_o2
+00007e00: 733d 6571 7561 6c5f 6d61 705f 6f32 730a  s=equal_map_o2s.
+00007e10: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00007e20: 2020 2020 2020 2020 2020 6571 7561 6c5f            equal_
+00007e30: 6d61 705f 6669 6e69 7368 6564 203d 2054  map_finished = T
+00007e40: 7275 650a 2020 2020 656c 7365 3a0a 2020  rue.    else:.  
+00007e50: 2020 2020 2020 6571 7561 6c5f 6d61 705f        equal_map_
+00007e60: 6669 6e69 7368 6564 203d 2054 7275 650a  finished = True.
+00007e70: 2020 2020 6966 2065 7175 616c 5f6d 6170      if equal_map
+00007e80: 5f73 326f 2069 7320 4e6f 6e65 206f 7220  _s2o is None or 
+00007e90: 6571 7561 6c5f 6d61 705f 6f32 7320 6973  equal_map_o2s is
+00007ea0: 204e 6f6e 653a 0a20 2020 2020 2020 2065   None:.        e
+00007eb0: 7175 616c 5f6d 6170 5f73 326f 2c20 6571  qual_map_s2o, eq
+00007ec0: 7561 6c5f 6d61 705f 6f32 7320 3d20 7b7d  ual_map_o2s = {}
+00007ed0: 2c20 7b7d 2020 2320 7369 6d70 6c69 6669  , {}  # simplifi
+00007ee0: 6573 2074 6865 2063 6f64 6520 6265 6c6f  es the code belo
+00007ef0: 770a 0a20 2020 2073 7562 5f6b 7761 7267  w..    sub_kwarg
+00007f00: 7320 3d20 6469 6374 280a 2020 2020 2020  s = dict(.      
+00007f10: 2020 616c 6c6f 7765 645f 6d61 7070 696e    allowed_mappin
+00007f20: 673d 616c 6c6f 7765 645f 6d61 7070 696e  g=allowed_mappin
+00007f30: 672c 0a20 2020 2020 2020 205f 6571 7561  g,.        _equa
+00007f40: 6c5f 6d61 705f 7332 6f3d 6571 7561 6c5f  l_map_s2o=equal_
+00007f50: 6d61 705f 7332 6f2c 0a20 2020 2020 2020  map_s2o,.       
+00007f60: 205f 6571 7561 6c5f 6d61 705f 6f32 733d   _equal_map_o2s=
+00007f70: 6571 7561 6c5f 6d61 705f 6f32 732c 0a20  equal_map_o2s,. 
+00007f80: 2020 2020 2020 205f 6571 7561 6c5f 6d61         _equal_ma
+00007f90: 705f 6669 6e69 7368 6564 3d65 7175 616c  p_finished=equal
+00007fa0: 5f6d 6170 5f66 696e 6973 6865 642c 0a20  _map_finished,. 
+00007fb0: 2020 2029 0a0a 2020 2020 6966 2069 7369     )..    if isi
+00007fc0: 6e73 7461 6e63 6528 7365 6c66 2c20 286c  nstance(self, (l
+00007fd0: 6973 742c 2074 7570 6c65 2929 3a0a 2020  ist, tuple)):.  
+00007fe0: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
+00007ff0: 6e73 7461 6e63 6528 6f74 6865 722c 2028  nstance(other, (
+00008000: 6c69 7374 2c20 7475 706c 6529 290a 2020  list, tuple)).  
+00008010: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
+00008020: 6629 2021 3d20 6c65 6e28 6f74 6865 7229  f) != len(other)
+00008030: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00008040: 7475 726e 205b 2225 736c 6973 7420 6469  turn ["%slist di
+00008050: 6666 206c 656e 3a20 6c65 6e20 7365 6c66  ff len: len self
+00008060: 3a20 2569 2c20 6c65 6e20 6f74 6865 723a  : %i, len other:
+00008070: 2025 6922 2025 2028 7072 6566 6978 2c20   %i" % (prefix, 
+00008080: 6c65 6e28 7365 6c66 292c 206c 656e 286f  len(self), len(o
+00008090: 7468 6572 2929 5d0a 2020 2020 2020 2020  ther))].        
+000080a0: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
+000080b0: 6f72 2069 2c20 2861 2c20 6229 2069 6e20  or i, (a, b) in 
+000080c0: 656e 756d 6572 6174 6528 7a69 7028 7365  enumerate(zip(se
+000080d0: 6c66 2c20 6f74 6865 7229 293a 0a20 2020  lf, other)):.   
+000080e0: 2020 2020 2020 2020 2073 202b 3d20 6f62           s += ob
+000080f0: 6a5f 6469 6666 5f6c 6973 7428 612c 2062  j_diff_list(a, b
+00008100: 2c20 5f70 7265 6669 783d 2225 735b 2569  , _prefix="%s[%i
+00008110: 5d20 2220 2520 2870 7265 6669 782c 2069  ] " % (prefix, i
+00008120: 292c 202a 2a73 7562 5f6b 7761 7267 7329  ), **sub_kwargs)
+00008130: 0a20 2020 2020 2020 2069 6620 733a 0a20  .        if s:. 
+00008140: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00008150: 6e20 5b22 2573 6c69 7374 2064 6966 663a  n ["%slist diff:
+00008160: 2220 2520 7072 6566 6978 5d20 2b20 730a  " % prefix] + s.
+00008170: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00008180: 5d0a 0a20 2020 2064 6566 205f 7365 745f  ]..    def _set_
+00008190: 6469 6666 2861 5f2c 2062 5f29 3a0a 2020  diff(a_, b_):.  
+000081a0: 2020 2020 2020 2320 6173 7375 6d65 2074        # assume t
+000081b0: 6865 2076 616c 7565 7320 6361 6e20 6265  he values can be
+000081c0: 2073 6f72 7465 640a 2020 2020 2020 2020   sorted.        
+000081d0: 615f 203d 2073 6f72 7465 6428 615f 290a  a_ = sorted(a_).
+000081e0: 2020 2020 2020 2020 625f 203d 2073 6f72          b_ = sor
+000081f0: 7465 6428 625f 290a 2020 2020 2020 2020  ted(b_).        
+00008200: 7365 6c66 5f64 6966 665f 203d 205b 5d0a  self_diff_ = [].
+00008210: 2020 2020 2020 2020 7361 6d65 5f20 3d20          same_ = 
+00008220: 5b5d 0a20 2020 2020 2020 2066 6f72 2076  [].        for v
+00008230: 2069 6e20 615f 3a0a 2020 2020 2020 2020   in a_:.        
+00008240: 2020 2020 765f 203d 2065 7175 616c 5f6d      v_ = equal_m
+00008250: 6170 5f73 326f 2e67 6574 2876 2c20 7629  ap_s2o.get(v, v)
+00008260: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00008270: 765f 2069 6e20 625f 3a0a 2020 2020 2020  v_ in b_:.      
+00008280: 2020 2020 2020 2020 2020 7361 6d65 5f2e            same_.
+00008290: 6170 7065 6e64 2876 290a 2020 2020 2020  append(v).      
+000082a0: 2020 2020 2020 2020 2020 625f 2e72 656d            b_.rem
+000082b0: 6f76 6528 765f 290a 2020 2020 2020 2020  ove(v_).        
+000082c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000082d0: 2020 2020 2020 2020 2020 7365 6c66 5f64            self_d
+000082e0: 6966 665f 2e61 7070 656e 6428 7629 0a20  iff_.append(v). 
+000082f0: 2020 2020 2020 206f 7468 6572 5f64 6966         other_dif
+00008300: 665f 203d 2062 5f0a 2020 2020 2020 2020  f_ = b_.        
+00008310: 7265 7475 726e 2073 656c 665f 6469 6666  return self_diff
+00008320: 5f2c 2073 616d 655f 2c20 6f74 6865 725f  _, same_, other_
+00008330: 6469 6666 5f0a 0a20 2020 2069 6620 6973  diff_..    if is
+00008340: 696e 7374 616e 6365 2873 656c 662c 2073  instance(self, s
+00008350: 6574 293a 0a20 2020 2020 2020 2061 7373  et):.        ass
+00008360: 6572 7420 6973 696e 7374 616e 6365 286f  ert isinstance(o
+00008370: 7468 6572 2c20 7365 7429 0a20 2020 2020  ther, set).     
+00008380: 2020 2073 656c 665f 6469 6666 2c20 5f2c     self_diff, _,
+00008390: 206f 7468 6572 5f64 6966 6620 3d20 5f73   other_diff = _s
+000083a0: 6574 5f64 6966 6628 7365 6c66 2c20 6f74  et_diff(self, ot
+000083b0: 6865 7229 0a20 2020 2020 2020 2069 6620  her).        if 
+000083c0: 6c65 6e28 7365 6c66 5f64 6966 6629 203d  len(self_diff) =
+000083d0: 3d20 6c65 6e28 6f74 6865 725f 6469 6666  = len(other_diff
+000083e0: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+000083f0: 2020 2020 2320 706f 7465 6e74 6961 6c6c      # potentiall
+00008400: 7920 7570 6461 7465 2065 7175 616c 5f6d  y update equal_m
+00008410: 6170 0a20 2020 2020 2020 2020 2020 2073  ap.            s
+00008420: 203d 206f 626a 5f64 6966 665f 6c69 7374   = obj_diff_list
+00008430: 286c 6973 7428 7365 6c66 5f64 6966 6629  (list(self_diff)
+00008440: 5b30 5d2c 206c 6973 7428 6f74 6865 725f  [0], list(other_
+00008450: 6469 6666 295b 305d 2c20 2a2a 7375 625f  diff)[0], **sub_
+00008460: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+00008470: 2020 2020 2320 6967 6e6f 7265 2074 6865      # ignore the
+00008480: 2070 6f74 656e 7469 616c 2075 7064 6174   potential updat
+00008490: 6564 2065 7175 616c 5f6d 6170 206e 6f77  ed equal_map now
+000084a0: 2066 6f72 2073 696d 706c 6963 6974 792e   for simplicity.
+000084b0: 2077 6520 7769 6c6c 2061 6e79 7761 7920   we will anyway 
+000084c0: 646f 2061 2073 6563 6f6e 6420 7061 7373  do a second pass
+000084d0: 206c 6174 6572 2e0a 2020 2020 2020 2020   later..        
+000084e0: 2020 2020 6966 206c 656e 2873 2920 3d3d      if len(s) ==
+000084f0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00008500: 2020 2020 7265 7475 726e 205b 2225 7373      return ["%ss
+00008510: 6574 2064 6966 6620 7661 6c75 653a 2025  et diff value: %
+00008520: 7322 2025 2028 7072 6566 6978 2c20 735b  s" % (prefix, s[
+00008530: 305d 295d 0a20 2020 2020 2020 2073 203d  0])].        s =
+00008540: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
+00008550: 6b65 7920 696e 2073 656c 665f 6469 6666  key in self_diff
+00008560: 3a0a 2020 2020 2020 2020 2020 2020 7320  :.            s 
+00008570: 2b3d 205b 2225 7320 2025 7220 6e6f 7420  += ["%s  %r not 
+00008580: 696e 206f 7468 6572 2220 2520 2870 7265  in other" % (pre
+00008590: 6669 782c 206b 6579 295d 0a20 2020 2020  fix, key)].     
+000085a0: 2020 2066 6f72 206b 6579 2069 6e20 6f74     for key in ot
+000085b0: 6865 725f 6469 6666 3a0a 2020 2020 2020  her_diff:.      
+000085c0: 2020 2020 2020 7320 2b3d 205b 2225 7320        s += ["%s 
+000085d0: 2025 7220 6e6f 7420 696e 2073 656c 6622   %r not in self"
+000085e0: 2025 2028 7072 6566 6978 2c20 6b65 7929   % (prefix, key)
+000085f0: 5d0a 2020 2020 2020 2020 6966 2073 3a0a  ].        if s:.
+00008600: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00008610: 726e 205b 2225 7373 6574 2064 6966 663a  rn ["%sset diff:
+00008620: 2220 2520 7072 6566 6978 5d20 2b20 730a  " % prefix] + s.
+00008630: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00008640: 5d0a 0a20 2020 2069 6620 6973 696e 7374  ]..    if isinst
+00008650: 616e 6365 2873 656c 662c 2064 6963 7429  ance(self, dict)
+00008660: 3a0a 2020 2020 2020 2020 6173 7365 7274  :.        assert
+00008670: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
+00008680: 722c 2064 6963 7429 0a20 2020 2020 2020  r, dict).       
+00008690: 2073 656c 665f 6469 6666 2c20 7361 6d65   self_diff, same
+000086a0: 2c20 6f74 6865 725f 6469 6666 203d 205f  , other_diff = _
+000086b0: 7365 745f 6469 6666 2873 656c 662e 6b65  set_diff(self.ke
+000086c0: 7973 2829 2c20 6f74 6865 722e 6b65 7973  ys(), other.keys
+000086d0: 2829 290a 2020 2020 2020 2020 6966 206e  ()).        if n
+000086e0: 6f74 2065 7175 616c 5f6d 6170 5f66 696e  ot equal_map_fin
+000086f0: 6973 6865 6420 616e 6420 6c65 6e28 7365  ished and len(se
+00008700: 6c66 5f64 6966 6629 203d 3d20 6c65 6e28  lf_diff) == len(
+00008710: 6f74 6865 725f 6469 6666 2920 3d3d 2031  other_diff) == 1
+00008720: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00008730: 706f 7465 6e74 6961 6c6c 7920 7570 6461  potentially upda
+00008740: 7465 2065 7175 616c 5f6d 6170 0a20 2020  te equal_map.   
+00008750: 2020 2020 2020 2020 206f 626a 5f64 6966           obj_dif
+00008760: 665f 6c69 7374 286c 6973 7428 7365 6c66  f_list(list(self
+00008770: 5f64 6966 6629 5b30 5d2c 206c 6973 7428  _diff)[0], list(
+00008780: 6f74 6865 725f 6469 6666 295b 305d 2c20  other_diff)[0], 
+00008790: 2a2a 7375 625f 6b77 6172 6773 290a 2020  **sub_kwargs).  
+000087a0: 2020 2020 2020 2020 2020 2320 6967 6e6f            # igno
+000087b0: 7265 2074 6865 2070 6f74 656e 7469 616c  re the potential
+000087c0: 2075 7064 6174 6564 2065 7175 616c 5f6d   updated equal_m
+000087d0: 6170 206e 6f77 2066 6f72 2073 696d 706c  ap now for simpl
+000087e0: 6963 6974 792e 2077 6520 7769 6c6c 2061  icity. we will a
+000087f0: 6e79 7761 7920 646f 2061 2073 6563 6f6e  nyway do a secon
+00008800: 6420 7061 7373 206c 6174 6572 2e0a 2020  d pass later..  
+00008810: 2020 2020 2020 7320 3d20 5b5d 0a20 2020        s = [].   
+00008820: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
+00008830: 7365 6c66 5f64 6966 663a 0a20 2020 2020  self_diff:.     
+00008840: 2020 2020 2020 2073 202b 3d20 5b22 2573         s += ["%s
+00008850: 2020 6b65 7920 2572 206e 6f74 2069 6e20    key %r not in 
+00008860: 6f74 6865 7222 2025 2028 7072 6566 6978  other" % (prefix
+00008870: 2c20 6b65 7929 5d0a 2020 2020 2020 2020  , key)].        
+00008880: 666f 7220 6b65 7920 696e 206f 7468 6572  for key in other
+00008890: 5f64 6966 663a 0a20 2020 2020 2020 2020  _diff:.         
+000088a0: 2020 2073 202b 3d20 5b22 2573 2020 6b65     s += ["%s  ke
+000088b0: 7920 2572 206e 6f74 2069 6e20 7365 6c66  y %r not in self
+000088c0: 2220 2520 2870 7265 6669 782c 206b 6579  " % (prefix, key
+000088d0: 295d 0a20 2020 2020 2020 2066 6f72 206b  )].        for k
+000088e0: 6579 2069 6e20 7361 6d65 3a0a 2020 2020  ey in same:.    
+000088f0: 2020 2020 2020 2020 6b65 795f 203d 2065          key_ = e
+00008900: 7175 616c 5f6d 6170 5f73 326f 2e67 6574  qual_map_s2o.get
+00008910: 286b 6579 2c20 6b65 7929 0a20 2020 2020  (key, key).     
+00008920: 2020 2020 2020 2076 616c 7565 5f73 656c         value_sel
+00008930: 6620 3d20 7365 6c66 5b6b 6579 5d0a 2020  f = self[key].  
+00008940: 2020 2020 2020 2020 2020 7661 6c75 655f            value_
+00008950: 6f74 6865 7220 3d20 6f74 6865 725b 6b65  other = other[ke
+00008960: 795f 5d0a 2020 2020 2020 2020 2020 2020  y_].            
+00008970: 7320 2b3d 206f 626a 5f64 6966 665f 6c69  s += obj_diff_li
+00008980: 7374 2876 616c 7565 5f73 656c 662c 2076  st(value_self, v
+00008990: 616c 7565 5f6f 7468 6572 2c20 5f70 7265  alue_other, _pre
+000089a0: 6669 783d 2225 735b 2572 5d20 2220 2520  fix="%s[%r] " % 
+000089b0: 2870 7265 6669 782c 206b 6579 292c 202a  (prefix, key), *
+000089c0: 2a73 7562 5f6b 7761 7267 7329 0a20 2020  *sub_kwargs).   
+000089d0: 2020 2020 2069 6620 733a 0a20 2020 2020       if s:.     
+000089e0: 2020 2020 2020 2072 6574 7572 6e20 5b22         return ["
+000089f0: 2573 6469 6374 2064 6966 663a 2220 2520  %sdict diff:" % 
+00008a00: 7072 6566 6978 5d20 2b20 730a 2020 2020  prefix] + s.    
+00008a10: 2020 2020 7265 7475 726e 205b 5d0a 0a20      return [].. 
+00008a20: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00008a30: 2873 656c 662c 206e 702e 6e64 6172 7261  (self, np.ndarra
+00008a40: 7929 3a0a 2020 2020 2020 2020 6173 7365  y):.        asse
+00008a50: 7274 2069 7369 6e73 7461 6e63 6528 6f74  rt isinstance(ot
+00008a60: 6865 722c 206e 702e 6e64 6172 7261 7929  her, np.ndarray)
+00008a70: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00008a80: 6e70 2e61 7272 6179 5f65 7175 616c 2873  np.array_equal(s
+00008a90: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
+00008aa0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00008ab0: 5b22 2573 7365 6c66 3a20 2572 2021 3d20  ["%sself: %r != 
+00008ac0: 6f74 6865 723a 2025 7222 2025 2028 7072  other: %r" % (pr
+00008ad0: 6566 6978 2c20 7365 6c66 2c20 6f74 6865  efix, self, othe
+00008ae0: 7229 5d0a 2020 2020 2020 2020 7265 7475  r)].        retu
+00008af0: 726e 205b 5d0a 0a20 2020 2069 6620 616c  rn []..    if al
+00008b00: 6c6f 7765 645f 6d61 7070 696e 6720 616e  lowed_mapping an
+00008b10: 6420 7365 6c66 2021 3d20 6f74 6865 7220  d self != other 
+00008b20: 616e 6420 616c 6c6f 7765 645f 6d61 7070  and allowed_mapp
+00008b30: 696e 6728 7365 6c66 2c20 6f74 6865 7229  ing(self, other)
+00008b40: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
+00008b50: 6620 696e 2065 7175 616c 5f6d 6170 5f73  f in equal_map_s
+00008b60: 326f 3a0a 2020 2020 2020 2020 2020 2020  2o:.            
+00008b70: 7365 6c66 203d 2065 7175 616c 5f6d 6170  self = equal_map
+00008b80: 5f73 326f 5b73 656c 665d 0a20 2020 2020  _s2o[self].     
+00008b90: 2020 2065 6c69 6620 6f74 6865 7220 6e6f     elif other no
+00008ba0: 7420 696e 2065 7175 616c 5f6d 6170 5f6f  t in equal_map_o
+00008bb0: 3273 3a20 2023 2064 6f6e 2774 206d 6170  2s:  # don't map
+00008bc0: 206d 756c 7469 706c 6520 7469 6d65 7320   multiple times 
+00008bd0: 746f 2074 6869 730a 2020 2020 2020 2020  to this.        
+00008be0: 2020 2020 6571 7561 6c5f 6d61 705f 7332      equal_map_s2
+00008bf0: 6f5b 7365 6c66 5d20 3d20 6f74 6865 720a  o[self] = other.
+00008c00: 2020 2020 2020 2020 2020 2020 6571 7561              equa
+00008c10: 6c5f 6d61 705f 6f32 735b 6f74 6865 725d  l_map_o2s[other]
+00008c20: 203d 2073 656c 660a 0a20 2020 2069 6620   = self..    if 
+00008c30: 7365 6c66 2021 3d20 6f74 6865 723a 0a20  self != other:. 
+00008c40: 2020 2020 2020 2072 6574 7572 6e20 5b22         return ["
+00008c50: 2573 7365 6c66 3a20 2572 2021 3d20 6f74  %sself: %r != ot
+00008c60: 6865 723a 2025 7222 2025 2028 7072 6566  her: %r" % (pref
+00008c70: 6978 2c20 7365 6c66 2c20 6f74 6865 7229  ix, self, other)
+00008c80: 5d0a 2020 2020 7265 7475 726e 205b 5d0a  ].    return [].
+00008c90: 0a0a 6465 6620 6669 6e64 5f72 616e 6765  ..def find_range
+00008ca0: 7328 6c73 293a 0a20 2020 2022 2222 0a20  s(ls):.    """. 
+00008cb0: 2020 203a 7479 7065 206c 733a 206c 6973     :type ls: lis
+00008cc0: 745b 696e 745d 0a20 2020 203a 7265 7475  t[int].    :retu
+00008cd0: 726e 7320 6c69 7374 206f 6620 7261 6e67  rns list of rang
+00008ce0: 6573 2028 7374 6172 742c 656e 6429 2077  es (start,end) w
+00008cf0: 6865 7265 2065 6e64 2069 7320 6578 636c  here end is excl
+00008d00: 7573 6976 650a 2020 2020 7375 6368 2074  usive.    such t
+00008d10: 6861 7420 7468 6520 756e 696f 6e20 6f66  hat the union of
+00008d20: 2072 616e 6765 2873 7461 7274 2c65 6e64   range(start,end
+00008d30: 2920 6d61 7463 6865 7320 6c2e 0a20 2020  ) matches l..   
+00008d40: 203a 7274 7970 653a 206c 6973 745b 2869   :rtype: list[(i
+00008d50: 6e74 2c69 6e74 295d 0a20 2020 2057 6520  nt,int)].    We 
+00008d60: 6578 7065 6374 2074 6861 7420 7468 6520  expect that the 
+00008d70: 696e 636f 6d69 6e67 206c 6973 7420 6973  incoming list is
+00008d80: 2073 6f72 7465 6420 616e 6420 7374 726f   sorted and stro
+00008d90: 6e67 6c79 206d 6f6e 6f74 6f6e 6963 2069  ngly monotonic i
+00008da0: 6e63 7265 6173 696e 672e 0a20 2020 2022  ncreasing..    "
+00008db0: 2222 0a20 2020 2069 6620 6e6f 7420 6c73  "".    if not ls
+00008dc0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00008dd0: 205b 5d0a 2020 2020 7261 6e67 6573 203d   [].    ranges =
+00008de0: 205b 286c 735b 305d 2c20 6c73 5b30 5d29   [(ls[0], ls[0])
+00008df0: 5d0a 2020 2020 666f 7220 6b20 696e 206c  ].    for k in l
+00008e00: 733a 0a20 2020 2020 2020 2061 7373 6572  s:.        asser
+00008e10: 7420 6b20 3e3d 2072 616e 6765 735b 2d31  t k >= ranges[-1
+00008e20: 5d5b 315d 2020 2320 7374 726f 6e67 6c79  ][1]  # strongly
+00008e30: 206d 6f6e 6f74 6f6e 6963 2069 6e63 7265   monotonic incre
+00008e40: 6173 696e 670a 2020 2020 2020 2020 6966  asing.        if
+00008e50: 206b 203d 3d20 7261 6e67 6573 5b2d 315d   k == ranges[-1]
+00008e60: 5b31 5d3a 0a20 2020 2020 2020 2020 2020  [1]:.           
+00008e70: 2072 616e 6765 735b 2d31 5d20 3d20 2872   ranges[-1] = (r
+00008e80: 616e 6765 735b 2d31 5d5b 305d 2c20 6b20  anges[-1][0], k 
+00008e90: 2b20 3129 0a20 2020 2020 2020 2065 6c73  + 1).        els
+00008ea0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00008eb0: 616e 6765 7320 2b3d 205b 286b 2c20 6b20  anges += [(k, k 
+00008ec0: 2b20 3129 5d0a 2020 2020 7265 7475 726e  + 1)].    return
+00008ed0: 2072 616e 6765 730a 0a0a 5f74 6872 6561   ranges..._threa
+00008ee0: 645f 6a6f 696e 5f68 6163 6b5f 696e 7374  d_join_hack_inst
+00008ef0: 616c 6c65 6420 3d20 4661 6c73 650a 0a0a  alled = False...
+00008f00: 6465 6620 696e 6974 5f74 6872 6561 645f  def init_thread_
+00008f10: 6a6f 696e 5f68 6163 6b28 293a 0a20 2020  join_hack():.   
+00008f20: 2022 2222 0a20 2020 2060 6074 6872 6561   """.    ``threa
+00008f30: 6469 6e67 2e54 6872 6561 642e 6a6f 696e  ding.Thread.join
+00008f40: 6060 2061 6e64 2060 6074 6872 6561 6469  `` and ``threadi
+00008f50: 6e67 2e43 6f6e 6469 7469 6f6e 2e77 6169  ng.Condition.wai
+00008f60: 7460 6020 776f 756c 6420 626c 6f63 6b20  t`` would block 
+00008f70: 7369 676e 616c 7320 7768 656e 2072 756e  signals when run
+00008f80: 2069 6e20 7468 6520 6d61 696e 2074 6872   in the main thr
+00008f90: 6561 642e 0a20 2020 2057 6520 6e65 7665  ead..    We neve
+00008fa0: 7220 7761 6e74 2074 6f20 626c 6f63 6b20  r want to block 
+00008fb0: 7369 676e 616c 732e 0a20 2020 2048 6572  signals..    Her
+00008fc0: 6520 7765 2070 6174 6368 2061 7761 7920  e we patch away 
+00008fd0: 7468 6174 2062 6568 6176 696f 722e 0a20  that behavior.. 
+00008fe0: 2020 2022 2222 0a20 2020 2067 6c6f 6261     """.    globa
+00008ff0: 6c20 5f74 6872 6561 645f 6a6f 696e 5f68  l _thread_join_h
+00009000: 6163 6b5f 696e 7374 616c 6c65 640a 2020  ack_installed.  
+00009010: 2020 6966 205f 7468 7265 6164 5f6a 6f69    if _thread_joi
+00009020: 6e5f 6861 636b 5f69 6e73 7461 6c6c 6564  n_hack_installed
+00009030: 3a20 2023 2064 6f6e 2774 2069 6e73 7461  :  # don't insta
+00009040: 6c6c 2074 7769 6365 0a20 2020 2020 2020  ll twice.       
+00009050: 2072 6574 7572 6e0a 2020 2020 5f74 6872   return.    _thr
+00009060: 6561 645f 6a6f 696e 5f68 6163 6b5f 696e  ead_join_hack_in
+00009070: 7374 616c 6c65 6420 3d20 5472 7565 0a20  stalled = True. 
+00009080: 2020 2069 6620 5059 333a 0a20 2020 2020     if PY3:.     
+00009090: 2020 2023 2054 6865 7365 206d 6f6e 6b65     # These monke
+000090a0: 7920 7061 7463 6865 7320 6172 6520 6e6f  y patches are no
+000090b0: 7420 6e65 6365 7373 6172 7920 616e 796d  t necessary anym
+000090c0: 6f72 652e 204e 6f74 6869 6e67 2062 6c6f  ore. Nothing blo
+000090d0: 636b 7320 7369 676e 616c 7320 616e 796d  cks signals anym
+000090e0: 6f72 6520 696e 2050 7974 686f 6e20 332e  ore in Python 3.
+000090f0: 0a20 2020 2020 2020 2023 2068 7474 7073  .        # https
+00009100: 3a2f 2f67 6974 6875 622e 636f 6d2f 616c  ://github.com/al
+00009110: 6265 7274 7a2f 706c 6179 6772 6f75 6e64  bertz/playground
+00009120: 2f62 6c6f 622f 6d61 7374 6572 2f74 6872  /blob/master/thr
+00009130: 6561 642d 6a6f 696e 2d62 6c6f 636b 2e70  ead-join-block.p
+00009140: 790a 2020 2020 2020 2020 2320 6874 7470  y.        # http
+00009150: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f61  s://github.com/a
+00009160: 6c62 6572 747a 2f70 6c61 7967 726f 756e  lbertz/playgroun
+00009170: 642f 626c 6f62 2f6d 6173 7465 722f 636f  d/blob/master/co
+00009180: 6e64 2d77 6169 742d 626c 6f63 6b2e 7079  nd-wait-block.py
+00009190: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
+000091a0: 2020 2020 6d61 696e 5f74 6872 6561 6420      main_thread 
+000091b0: 3d20 7468 7265 6164 696e 672e 6375 7272  = threading.curr
+000091c0: 656e 7454 6872 6561 6428 290a 2020 2020  entThread().    
+000091d0: 2320 6e6f 696e 7370 6563 7469 6f6e 2050  # noinspection P
+000091e0: 7955 6e72 6573 6f6c 7665 6452 6566 6572  yUnresolvedRefer
+000091f0: 656e 6365 732c 5079 5072 6f74 6563 7465  ences,PyProtecte
+00009200: 644d 656d 6265 720a 2020 2020 6173 7365  dMember.    asse
+00009210: 7274 2069 7369 6e73 7461 6e63 6528 6d61  rt isinstance(ma
+00009220: 696e 5f74 6872 6561 642c 2074 6872 6561  in_thread, threa
+00009230: 6469 6e67 2e5f 4d61 696e 5468 7265 6164  ding._MainThread
+00009240: 290a 2020 2020 6d61 696e 5f74 6872 6561  ).    main_threa
+00009250: 645f 6964 203d 2074 6872 6561 642e 6765  d_id = thread.ge
+00009260: 745f 6964 656e 7428 290a 0a20 2020 2023  t_ident()..    #
+00009270: 2050 6174 6368 2054 6872 6561 642e 6a6f   Patch Thread.jo
+00009280: 696e 2829 2e0a 2020 2020 6a6f 696e 5f6f  in()..    join_o
+00009290: 7269 6720 3d20 7468 7265 6164 696e 672e  rig = threading.
+000092a0: 5468 7265 6164 2e6a 6f69 6e0a 0a20 2020  Thread.join..   
+000092b0: 2064 6566 206a 6f69 6e5f 6861 636b 6564   def join_hacked
+000092c0: 2874 6872 6561 645f 6f62 6a2c 2074 696d  (thread_obj, tim
+000092d0: 656f 7574 3d4e 6f6e 6529 3a0a 2020 2020  eout=None):.    
+000092e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000092f0: 3a74 7970 6520 7468 7265 6164 5f6f 626a  :type thread_obj
+00009300: 3a20 7468 7265 6164 696e 672e 5468 7265  : threading.Thre
+00009310: 6164 0a20 2020 2020 2020 203a 7479 7065  ad.        :type
+00009320: 2074 696d 656f 7574 3a20 666c 6f61 747c   timeout: float|
+00009330: 4e6f 6e65 0a20 2020 2020 2020 203a 7265  None.        :re
+00009340: 7475 726e 3a20 616c 7761 7973 204e 6f6e  turn: always Non
+00009350: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+00009360: 2020 2020 2020 6966 2074 6872 6561 642e        if thread.
+00009370: 6765 745f 6964 656e 7428 2920 3d3d 206d  get_ident() == m
+00009380: 6169 6e5f 7468 7265 6164 5f69 6420 616e  ain_thread_id an
+00009390: 6420 7469 6d65 6f75 7420 6973 204e 6f6e  d timeout is Non
+000093a0: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+000093b0: 2054 6869 7320 6973 2061 2048 4143 4b20   This is a HACK 
+000093c0: 666f 7220 5468 7265 6164 2e6a 6f69 6e28  for Thread.join(
+000093d0: 2920 6966 2077 6520 6172 6520 696e 2074  ) if we are in t
+000093e0: 6865 206d 6169 6e20 7468 7265 6164 2e0a  he main thread..
+000093f0: 2020 2020 2020 2020 2020 2020 2320 496e              # In
+00009400: 2074 6861 7420 6361 7365 2c20 6120 5468   that case, a Th
+00009410: 7265 6164 2e6a 6f69 6e28 7469 6d65 6f75  read.join(timeou
+00009420: 743d 4e6f 6e65 2920 776f 756c 6420 6861  t=None) would ha
+00009430: 6e67 2061 6e64 2065 7665 6e20 6e6f 7420  ng and even not 
+00009440: 7265 7370 6f6e 6420 746f 2073 6967 6e61  respond to signa
+00009450: 6c73 0a20 2020 2020 2020 2020 2020 2023  ls.            #
+00009460: 2062 6563 6175 7365 2073 6967 6e61 6c73   because signals
+00009470: 2077 696c 6c20 6765 7420 6465 6c69 7665   will get delive
+00009480: 7265 6420 746f 206f 7468 6572 2074 6872  red to other thr
+00009490: 6561 6473 2061 6e64 2050 7974 686f 6e20  eads and Python 
+000094a0: 776f 756c 6420 666f 7277 6172 640a 2020  would forward.  
+000094b0: 2020 2020 2020 2020 2020 2320 7468 656d            # them
+000094c0: 2066 6f72 2064 656c 6179 6564 2068 616e   for delayed han
+000094d0: 646c 696e 6720 746f 2074 6865 206d 6169  dling to the mai
+000094e0: 6e20 7468 7265 6164 2077 6869 6368 2068  n thread which h
+000094f0: 616e 6773 2e0a 2020 2020 2020 2020 2020  angs..          
+00009500: 2020 2320 5365 6520 4350 7974 686f 6e20    # See CPython 
+00009510: 7369 676e 616c 6d6f 6475 6c65 2e63 2e0a  signalmodule.c..
+00009520: 2020 2020 2020 2020 2020 2020 2320 4375              # Cu
+00009530: 7272 656e 746c 7920 7468 6520 6265 7374  rrently the best
+00009540: 2073 6f6c 7574 696f 6e20 4920 6361 6e20   solution I can 
+00009550: 7468 696e 6b20 6f66 3a0a 2020 2020 2020  think of:.      
+00009560: 2020 2020 2020 7768 696c 6520 7468 7265        while thre
+00009570: 6164 5f6f 626a 2e69 735f 616c 6976 6528  ad_obj.is_alive(
+00009580: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00009590: 2020 206a 6f69 6e5f 6f72 6967 2874 6872     join_orig(thr
+000095a0: 6561 645f 6f62 6a2c 2074 696d 656f 7574  ead_obj, timeout
+000095b0: 3d30 2e31 290a 2020 2020 2020 2020 656c  =0.1).        el
+000095c0: 6966 2074 6872 6561 642e 6765 745f 6964  if thread.get_id
+000095d0: 656e 7428 2920 3d3d 206d 6169 6e5f 7468  ent() == main_th
+000095e0: 7265 6164 5f69 6420 616e 6420 7469 6d65  read_id and time
+000095f0: 6f75 7420 3e20 302e 313a 0a20 2020 2020  out > 0.1:.     
+00009600: 2020 2020 2020 2023 204c 696d 6974 2074         # Limit t
+00009610: 6865 2074 696d 656f 7574 2e20 5468 6973  he timeout. This
+00009620: 2073 686f 756c 6420 6e6f 7420 6d61 7474   should not matt
+00009630: 6572 2066 6f72 2074 6865 2075 6e64 6572  er for the under
+00009640: 6c79 696e 6720 636f 6465 2e0a 2020 2020  lying code..    
+00009650: 2020 2020 2020 2020 6a6f 696e 5f6f 7269          join_ori
+00009660: 6728 7468 7265 6164 5f6f 626a 2c20 7469  g(thread_obj, ti
+00009670: 6d65 6f75 743d 302e 3129 0a20 2020 2020  meout=0.1).     
+00009680: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00009690: 2020 2020 2023 2049 6e20 616c 6c20 6f74       # In all ot
+000096a0: 6865 7220 6361 7365 732c 2077 6520 6361  her cases, we ca
+000096b0: 6e20 7573 6520 7468 6520 6f72 6967 696e  n use the origin
+000096c0: 616c 2e0a 2020 2020 2020 2020 2020 2020  al..            
+000096d0: 6a6f 696e 5f6f 7269 6728 7468 7265 6164  join_orig(thread
+000096e0: 5f6f 626a 2c20 7469 6d65 6f75 743d 7469  _obj, timeout=ti
+000096f0: 6d65 6f75 7429 0a0a 2020 2020 7468 7265  meout)..    thre
+00009700: 6164 696e 672e 5468 7265 6164 2e6a 6f69  ading.Thread.joi
+00009710: 6e20 3d20 6a6f 696e 5f68 6163 6b65 640a  n = join_hacked.
+00009720: 0a20 2020 2023 204d 6f73 746c 7920 7468  .    # Mostly th
+00009730: 6520 7361 6d65 2066 6f72 2043 6f6e 6469  e same for Condi
+00009740: 7469 6f6e 2e77 6169 7428 292e 0a20 2020  tion.wait()..   
+00009750: 2069 6620 5059 333a 0a20 2020 2020 2020   if PY3:.       
+00009760: 2023 2068 7474 7073 3a2f 2f79 6f75 7472   # https://youtr
+00009770: 6163 6b2e 6a65 7462 7261 696e 732e 636f  ack.jetbrains.co
+00009780: 6d2f 6973 7375 652f 5059 2d33 3439 3833  m/issue/PY-34983
+00009790: 0a20 2020 2020 2020 2023 206e 6f69 6e73  .        # noins
+000097a0: 7065 6374 696f 6e20 5079 5065 7038 4e61  pection PyPep8Na
+000097b0: 6d69 6e67 0a20 2020 2020 2020 2043 6f6e  ming.        Con
+000097c0: 6469 7469 6f6e 203d 2074 6872 6561 6469  dition = threadi
+000097d0: 6e67 2e43 6f6e 6469 7469 6f6e 0a20 2020  ng.Condition.   
+000097e0: 2065 6c73 653a 0a20 2020 2020 2020 2023   else:.        #
+000097f0: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
+00009800: 556e 7265 736f 6c76 6564 5265 6665 7265  UnresolvedRefere
+00009810: 6e63 6573 2c50 7950 6570 384e 616d 696e  nces,PyPep8Namin
+00009820: 672c 5079 5072 6f74 6563 7465 644d 656d  g,PyProtectedMem
+00009830: 6265 720a 2020 2020 2020 2020 436f 6e64  ber.        Cond
+00009840: 6974 696f 6e20 3d20 7468 7265 6164 696e  ition = threadin
+00009850: 672e 5f43 6f6e 6469 7469 6f6e 0a20 2020  g._Condition.   
+00009860: 2063 6f6e 645f 7761 6974 5f6f 7269 6720   cond_wait_orig 
+00009870: 3d20 436f 6e64 6974 696f 6e2e 7761 6974  = Condition.wait
+00009880: 0a0a 2020 2020 2320 6e6f 696e 7370 6563  ..    # noinspec
+00009890: 7469 6f6e 2050 7955 6e75 7365 644c 6f63  tion PyUnusedLoc
+000098a0: 616c 0a20 2020 2064 6566 2063 6f6e 645f  al.    def cond_
+000098b0: 7761 6974 5f68 6163 6b65 6428 636f 6e64  wait_hacked(cond
+000098c0: 2c20 7469 6d65 6f75 743d 4e6f 6e65 2c20  , timeout=None, 
+000098d0: 2a61 7267 7329 3a0a 2020 2020 2020 2020  *args):.        
+000098e0: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
+000098f0: 616d 2043 6f6e 6469 7469 6f6e 2063 6f6e  am Condition con
+00009900: 643a 0a20 2020 2020 2020 203a 7061 7261  d:.        :para
+00009910: 6d20 666c 6f61 747c 4e6f 6e65 2074 696d  m float|None tim
+00009920: 656f 7574 3a0a 2020 2020 2020 2020 3a70  eout:.        :p
+00009930: 6172 616d 2061 7267 733a 0a20 2020 2020  aram args:.     
+00009940: 2020 203a 7274 7970 653a 2062 6f6f 6c0a     :rtype: bool.
+00009950: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00009960: 2020 2020 6966 2074 6872 6561 642e 6765      if thread.ge
+00009970: 745f 6964 656e 7428 2920 3d3d 206d 6169  t_ident() == mai
+00009980: 6e5f 7468 7265 6164 5f69 643a 0a20 2020  n_thread_id:.   
+00009990: 2020 2020 2020 2020 2069 6620 7469 6d65           if time
+000099a0: 6f75 7420 6973 204e 6f6e 653a 0a20 2020  out is None:.   
+000099b0: 2020 2020 2020 2020 2020 2020 2023 2055               # U
+000099c0: 7365 2061 2074 696d 656f 7574 2061 6e79  se a timeout any
+000099d0: 7761 792e 2054 6869 7320 7368 6f75 6c64  way. This should
+000099e0: 206e 6f74 206d 6174 7465 7220 666f 7220   not matter for 
+000099f0: 7468 6520 756e 6465 726c 7969 6e67 2063  the underlying c
+00009a00: 6f64 652e 0a20 2020 2020 2020 2020 2020  ode..           
+00009a10: 2020 2020 2072 6574 7572 6e20 636f 6e64       return cond
+00009a20: 5f77 6169 745f 6f72 6967 2863 6f6e 642c  _wait_orig(cond,
+00009a30: 2074 696d 656f 7574 3d30 2e31 2920 2023   timeout=0.1)  #
+00009a40: 206e 6f71 6120 2023 2068 7474 7073 3a2f   noqa  # https:/
+00009a50: 2f79 6f75 7472 6163 6b2e 6a65 7462 7261  /youtrack.jetbra
+00009a60: 696e 732e 636f 6d2f 6973 7375 652f 5059  ins.com/issue/PY
+00009a70: 2d34 3339 3135 0a20 2020 2020 2020 2020  -43915.         
+00009a80: 2020 2023 2054 6865 7265 2069 7320 736f     # There is so
+00009a90: 6d65 2063 6f64 6520 2865 2e67 2e20 6d75  me code (e.g. mu
+00009aa0: 6c74 6970 726f 6365 7373 696e 672e 706f  ltiprocessing.po
+00009ab0: 6f6c 2920 7768 6963 6820 7265 6c69 6573  ol) which relies
+00009ac0: 206f 6e20 7468 6174 0a20 2020 2020 2020   on that.       
+00009ad0: 2020 2020 2023 2077 6520 7265 7370 6563       # we respec
+00009ae0: 7420 7468 6520 7265 616c 2073 7065 6369  t the real speci
+00009af0: 6669 6564 2074 696d 656f 7574 2e0a 2020  fied timeout..  
+00009b00: 2020 2020 2020 2020 2020 2320 486f 7765            # Howe
+00009b10: 7665 722c 2077 6520 6361 6e6e 6f74 2064  ver, we cannot d
+00009b20: 6f20 6d75 6c74 6970 6c65 2072 6570 6561  o multiple repea
+00009b30: 7465 6420 6361 6c6c 7320 746f 2063 6f6e  ted calls to con
+00009b40: 645f 7761 6974 5f6f 7269 6720 6173 2077  d_wait_orig as w
+00009b50: 6520 6d69 6768 7420 6d69 7373 2074 6865  e might miss the
+00009b60: 2063 6f6e 6469 7469 6f6e 206e 6f74 6966   condition notif
+00009b70: 792e 0a20 2020 2020 2020 2020 2020 2023  y..            #
+00009b80: 2042 7574 2069 6e20 736f 6d65 2050 7974   But in some Pyt
+00009b90: 686f 6e20 7665 7273 696f 6e73 2c20 7468  hon versions, th
+00009ba0: 6520 756e 6465 726c 7969 6e67 2063 6f6e  e underlying con
+00009bb0: 645f 7761 6974 5f6f 7269 6720 7769 6c6c  d_wait_orig will
+00009bc0: 2061 6e79 7761 7920 616c 736f 2075 7365   anyway also use
+00009bd0: 2073 6c65 6570 2e0a 2020 2020 2020 2020   sleep..        
+00009be0: 2020 2020 7265 7475 726e 2063 6f6e 645f      return cond_
+00009bf0: 7761 6974 5f6f 7269 6728 636f 6e64 2c20  wait_orig(cond, 
+00009c00: 7469 6d65 6f75 743d 7469 6d65 6f75 7429  timeout=timeout)
+00009c10: 2020 2320 6e6f 7161 0a20 2020 2020 2020    # noqa.       
+00009c20: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00009c30: 2020 2072 6574 7572 6e20 636f 6e64 5f77     return cond_w
+00009c40: 6169 745f 6f72 6967 2863 6f6e 642c 2074  ait_orig(cond, t
+00009c50: 696d 656f 7574 3d74 696d 656f 7574 2920  imeout=timeout) 
+00009c60: 2023 206e 6f71 610a 0a20 2020 2043 6f6e   # noqa..    Con
+00009c70: 6469 7469 6f6e 2e77 6169 7420 3d20 636f  dition.wait = co
+00009c80: 6e64 5f77 6169 745f 6861 636b 6564 0a0a  nd_wait_hacked..
+00009c90: 2020 2020 2320 416e 6420 7468 6520 7361      # And the sa
+00009ca0: 6d65 2066 6f72 204c 6f63 6b2e 6163 7175  me for Lock.acqu
+00009cb0: 6972 652c 2076 6572 7920 7369 6d69 6c61  ire, very simila
+00009cc0: 7220 746f 2043 6f6e 6469 7469 6f6e 2e77  r to Condition.w
+00009cd0: 6169 742e 0a20 2020 2023 2048 6f77 6576  ait..    # Howev
+00009ce0: 6572 3a20 6361 6e27 7420 7365 7420 6174  er: can't set at
+00009cf0: 7472 6962 7574 6573 206f 6620 6275 696c  tributes of buil
+00009d00: 742d 696e 2f65 7874 656e 7369 6f6e 2074  t-in/extension t
+00009d10: 7970 6520 2774 6872 6561 642e 6c6f 636b  ype 'thread.lock
+00009d20: 272e 0a20 2020 2023 2057 6520 636f 756c  '..    # We coul
+00009d30: 6420 7772 6170 2074 6865 2077 686f 6c65  d wrap the whole
+00009d40: 2074 6872 6561 6469 6e67 2e4c 6f63 6b2c   threading.Lock,
+00009d50: 2062 7574 2074 6861 7420 6973 2074 6f6f   but that is too
+00009d60: 2061 6e6e 6f79 696e 6720 666f 7220 6d65   annoying for me
+00009d70: 206e 6f77 2e2e 2e0a 2020 2020 2320 6e6f   now....    # no
+00009d80: 696e 7370 6563 7469 6f6e 2050 7950 6570  inspection PyPep
+00009d90: 384e 616d 696e 670a 2020 2020 4c6f 636b  8Naming.    Lock
+00009da0: 203d 204e 6f6e 650a 2020 2020 6966 204c   = None.    if L
+00009db0: 6f63 6b3a 0a20 2020 2020 2020 206c 6f63  ock:.        loc
+00009dc0: 6b5f 6163 7175 6972 655f 6f72 6967 203d  k_acquire_orig =
+00009dd0: 204c 6f63 6b2e 6163 7175 6972 6520 2023   Lock.acquire  #
+00009de0: 206e 6f71 610a 0a20 2020 2020 2020 2023   noqa..        #
+00009df0: 204e 6f74 653a 2074 696d 656f 7574 2061   Note: timeout a
+00009e00: 7267 756d 656e 7420 7761 7320 696e 7472  rgument was intr
+00009e10: 6f64 7563 6564 2069 6e20 5079 7468 6f6e  oduced in Python
+00009e20: 2033 2e0a 2020 2020 2020 2020 6465 6620   3..        def 
+00009e30: 6c6f 636b 5f61 6371 7569 7265 5f68 6163  lock_acquire_hac
+00009e40: 6b65 6428 6c6f 636b 2c20 626c 6f63 6b69  ked(lock, blocki
+00009e50: 6e67 3d54 7275 652c 2074 696d 656f 7574  ng=True, timeout
+00009e60: 3d2d 3129 3a0a 2020 2020 2020 2020 2020  =-1):.          
+00009e70: 2020 2222 220a 2020 2020 2020 2020 2020    """.          
+00009e80: 2020 3a70 6172 616d 2074 6872 6561 6469    :param threadi
+00009e90: 6e67 2e4c 6f63 6b20 6c6f 636b 3a0a 2020  ng.Lock lock:.  
+00009ea0: 2020 2020 2020 2020 2020 3a70 6172 616d            :param
+00009eb0: 2062 6f6f 6c20 626c 6f63 6b69 6e67 3a0a   bool blocking:.
+00009ec0: 2020 2020 2020 2020 2020 2020 3a70 6172              :par
+00009ed0: 616d 2066 6c6f 6174 2074 696d 656f 7574  am float timeout
+00009ee0: 3a0a 2020 2020 2020 2020 2020 2020 3a72  :.            :r
+00009ef0: 7479 7065 3a20 626f 6f6c 0a20 2020 2020  type: bool.     
+00009f00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00009f10: 2020 2020 2020 2069 6620 6e6f 7420 626c         if not bl
+00009f20: 6f63 6b69 6e67 3a0a 2020 2020 2020 2020  ocking:.        
+00009f30: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00009f40: 6f63 6b5f 6163 7175 6972 655f 6f72 6967  ock_acquire_orig
+00009f50: 286c 6f63 6b2c 2062 6c6f 636b 696e 673d  (lock, blocking=
+00009f60: 4661 6c73 6529 2020 2320 6e6f 2074 696d  False)  # no tim
+00009f70: 656f 7574 2069 6620 6e6f 7420 626c 6f63  eout if not bloc
+00009f80: 6b69 6e67 0a20 2020 2020 2020 2020 2020  king.           
+00009f90: 2023 2045 7665 7279 7468 696e 6720 6973   # Everything is
+00009fa0: 2062 6c6f 636b 696e 6720 6e6f 772e 0a20   blocking now.. 
+00009fb0: 2020 2020 2020 2020 2020 2069 6620 7468             if th
+00009fc0: 7265 6164 2e67 6574 5f69 6465 6e74 2829  read.get_ident()
+00009fd0: 203d 3d20 6d61 696e 5f74 6872 6561 645f   == main_thread_
+00009fe0: 6964 3a0a 2020 2020 2020 2020 2020 2020  id:.            
+00009ff0: 2020 2020 6966 2074 696d 656f 7574 2069      if timeout i
+0000a000: 7320 4e6f 6e65 206f 7220 7469 6d65 6f75  s None or timeou
+0000a010: 7420 3c20 303a 2020 2320 626c 6f63 6b69  t < 0:  # blocki
+0000a020: 6e67 2077 6974 686f 7574 2074 696d 656f  ng without timeo
+0000a030: 7574 0a20 2020 2020 2020 2020 2020 2020  ut.             
+0000a040: 2020 2020 2020 2069 6620 5059 333a 0a20         if PY3:. 
+0000a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a060: 2020 2020 2020 2077 6869 6c65 206e 6f74         while not
+0000a070: 206c 6f63 6b5f 6163 7175 6972 655f 6f72   lock_acquire_or
+0000a080: 6967 286c 6f63 6b2c 2062 6c6f 636b 696e  ig(lock, blockin
+0000a090: 673d 5472 7565 2c20 7469 6d65 6f75 743d  g=True, timeout=
+0000a0a0: 302e 3129 3a0a 2020 2020 2020 2020 2020  0.1):.          
+0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0c0: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
+0000a0d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000a0e0: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
+0000a0f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000a100: 6c73 653a 2020 2320 5079 7468 6f6e 2032  lse:  # Python 2
+0000a110: 2e20 6361 6e6e 6f74 2075 7365 2074 696d  . cannot use tim
+0000a120: 656f 7574 0a20 2020 2020 2020 2020 2020  eout.           
+0000a130: 2020 2020 2020 2020 2020 2020 2077 6869               whi
+0000a140: 6c65 206e 6f74 206c 6f63 6b5f 6163 7175  le not lock_acqu
+0000a150: 6972 655f 6f72 6967 286c 6f63 6b2c 2062  ire_orig(lock, b
+0000a160: 6c6f 636b 696e 673d 4661 6c73 6529 3a0a  locking=False):.
+0000a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a180: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+0000a190: 2e73 6c65 6570 2830 2e31 290a 2020 2020  .sleep(0.1).    
+0000a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1b0: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+0000a1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1d0: 656c 7365 3a20 2023 2074 696d 656f 7574  else:  # timeout
+0000a1e0: 2069 7320 7365 742e 2028 4361 6e20 6f6e   is set. (Can on
+0000a1f0: 6c79 2062 6520 7769 7468 2050 7974 686f  ly be with Pytho
+0000a200: 6e20 332e 290a 2020 2020 2020 2020 2020  n 3.).          
+0000a210: 2020 2020 2020 2020 2020 2320 5573 6520            # Use 
+0000a220: 6120 6361 7070 6564 2074 696d 656f 7574  a capped timeout
+0000a230: 2e20 5468 6973 2073 686f 756c 6420 6e6f  . This should no
+0000a240: 7420 6d61 7474 6572 2066 6f72 2074 6865  t matter for the
+0000a250: 2075 6e64 6572 6c79 696e 6720 636f 6465   underlying code
+0000a260: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a270: 2020 2020 2020 7265 7475 726e 206c 6f63        return loc
+0000a280: 6b5f 6163 7175 6972 655f 6f72 6967 286c  k_acquire_orig(l
+0000a290: 6f63 6b2c 2062 6c6f 636b 696e 673d 5472  ock, blocking=Tr
+0000a2a0: 7565 2c20 7469 6d65 6f75 743d 6d69 6e28  ue, timeout=min(
+0000a2b0: 7469 6d65 6f75 742c 2030 2e31 2929 0a20  timeout, 0.1)). 
+0000a2c0: 2020 2020 2020 2020 2020 2023 2046 616c             # Fal
+0000a2d0: 6c62 6163 6b20 746f 2064 6566 6175 6c74  lback to default
+0000a2e0: 2e0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000a2f0: 2050 5933 3a0a 2020 2020 2020 2020 2020   PY3:.          
+0000a300: 2020 2020 2020 7265 7475 726e 206c 6f63        return loc
+0000a310: 6b5f 6163 7175 6972 655f 6f72 6967 286c  k_acquire_orig(l
+0000a320: 6f63 6b2c 2062 6c6f 636b 696e 673d 5472  ock, blocking=Tr
+0000a330: 7565 2c20 7469 6d65 6f75 743d 7469 6d65  ue, timeout=time
+0000a340: 6f75 7429 0a20 2020 2020 2020 2020 2020  out).           
+0000a350: 2072 6574 7572 6e20 6c6f 636b 5f61 6371   return lock_acq
+0000a360: 7569 7265 5f6f 7269 6728 6c6f 636b 2c20  uire_orig(lock, 
+0000a370: 626c 6f63 6b69 6e67 3d54 7275 6529 0a0a  blocking=True)..
+0000a380: 2020 2020 2020 2020 4c6f 636b 2e61 6371          Lock.acq
+0000a390: 7569 7265 203d 206c 6f63 6b5f 6163 7175  uire = lock_acqu
+0000a3a0: 6972 655f 6861 636b 6564 0a0a 0a64 6566  ire_hacked...def
+0000a3b0: 2073 7461 7274 5f64 6165 6d6f 6e5f 7468   start_daemon_th
+0000a3c0: 7265 6164 2874 6172 6765 742c 2061 7267  read(target, arg
+0000a3d0: 733d 2829 293a 0a20 2020 2022 2222 0a20  s=()):.    """. 
+0000a3e0: 2020 203a 7061 7261 6d20 2829 2d3e 4e6f     :param ()->No
+0000a3f0: 6e65 2074 6172 6765 743a 0a20 2020 203a  ne target:.    :
+0000a400: 7061 7261 6d20 7475 706c 6520 6172 6773  param tuple args
+0000a410: 3a0a 2020 2020 3a72 6574 7572 6e3a 206e  :.    :return: n
+0000a420: 6f74 6869 6e67 0a20 2020 2022 2222 0a20  othing.    """. 
+0000a430: 2020 2066 726f 6d20 7468 7265 6164 696e     from threadin
+0000a440: 6720 696d 706f 7274 2054 6872 6561 640a  g import Thread.
+0000a450: 0a20 2020 2074 203d 2054 6872 6561 6428  .    t = Thread(
+0000a460: 7461 7267 6574 3d74 6172 6765 742c 2061  target=target, a
+0000a470: 7267 733d 6172 6773 290a 2020 2020 742e  rgs=args).    t.
+0000a480: 6461 656d 6f6e 203d 2054 7275 650a 2020  daemon = True.  
+0000a490: 2020 742e 7374 6172 7428 290a 0a0a 6465    t.start()...de
+0000a4a0: 6620 6973 5f71 7569 7474 696e 6728 293a  f is_quitting():
+0000a4b0: 0a20 2020 2022 2222 0a20 2020 203a 7265  .    """.    :re
+0000a4c0: 7475 726e 3a20 7768 6574 6865 7220 7765  turn: whether we
+0000a4d0: 2061 7265 2063 7572 7265 6e74 6c79 2071   are currently q
+0000a4e0: 7569 7474 696e 6720 2876 6961 203a 6675  uitting (via :fu
+0000a4f0: 6e63 3a60 726e 6e2e 6669 6e61 6c69 7a65  nc:`rnn.finalize
+0000a500: 6029 0a20 2020 203a 7274 7970 653a 2062  `).    :rtype: b
+0000a510: 6f6f 6c0a 2020 2020 2222 220a 2020 2020  ool.    """.    
+0000a520: 696d 706f 7274 2072 6574 7572 6e6e 2e5f  import returnn._
+0000a530: 5f6d 6169 6e5f 5f20 6173 2072 6e6e 0a0a  _main__ as rnn..
+0000a540: 2020 2020 6966 2072 6e6e 2e71 7569 745f      if rnn.quit_
+0000a550: 7265 7475 726e 6e3a 2020 2320 7669 6120  returnn:  # via 
+0000a560: 726e 6e2e 6669 6e61 6c69 7a65 2829 0a20  rnn.finalize(). 
+0000a570: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0000a580: 7565 0a20 2020 2069 6620 6765 7461 7474  ue.    if getatt
+0000a590: 7228 7379 732c 2022 6578 6974 6564 222c  r(sys, "exited",
+0000a5a0: 2046 616c 7365 293a 2020 2320 7365 7420   False):  # set 
+0000a5b0: 7669 6120 4465 6275 6720 6d6f 6475 6c65  via Debug module
+0000a5c0: 2077 6865 6e20 616e 2075 6e65 7870 6563   when an unexpec
+0000a5d0: 7465 6420 5349 4749 4e54 206f 6363 7572  ted SIGINT occur
+0000a5e0: 732c 206f 7220 6865 7265 0a20 2020 2020  s, or here.     
+0000a5f0: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
+0000a600: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0000a610: 0a0a 6465 6620 696e 7465 7272 7570 745f  ..def interrupt_
+0000a620: 6d61 696e 2829 3a0a 2020 2020 2222 220a  main():.    """.
+0000a630: 2020 2020 5365 6e64 7320 3a63 6c61 7373      Sends :class
+0000a640: 3a60 4b65 7962 6f61 7264 496e 7465 7272  :`KeyboardInterr
+0000a650: 7570 7460 2074 6f20 7468 6520 6d61 696e  upt` to the main
+0000a660: 2074 6872 6561 642e 0a0a 2020 2020 3a72   thread...    :r
+0000a670: 6574 7572 6e3a 206e 6f74 6869 6e67 0a20  eturn: nothing. 
+0000a680: 2020 2022 2222 0a20 2020 2023 206e 6f69     """.    # noi
+0000a690: 6e73 7065 6374 696f 6e20 5079 5072 6f74  nspection PyProt
+0000a6a0: 6563 7465 644d 656d 6265 722c 5079 556e  ectedMember,PyUn
+0000a6b0: 7265 736f 6c76 6564 5265 6665 7265 6e63  resolvedReferenc
+0000a6c0: 6573 0a20 2020 2069 735f 6d61 696e 5f74  es.    is_main_t
+0000a6d0: 6872 6561 6420 3d20 6973 696e 7374 616e  hread = isinstan
+0000a6e0: 6365 2874 6872 6561 6469 6e67 2e63 7572  ce(threading.cur
+0000a6f0: 7265 6e74 5468 7265 6164 2829 2c20 7468  rentThread(), th
+0000a700: 7265 6164 696e 672e 5f4d 6169 6e54 6872  reading._MainThr
+0000a710: 6561 6429 0a20 2020 2069 6620 6973 5f71  ead).    if is_q
+0000a720: 7569 7474 696e 6728 293a 2020 2320 6967  uitting():  # ig
+0000a730: 6e6f 7265 2069 6620 7765 2061 7265 2061  nore if we are a
+0000a740: 6c72 6561 6479 2071 7569 7474 696e 670a  lready quitting.
+0000a750: 2020 2020 2020 2020 6966 2069 735f 6d61          if is_ma
+0000a760: 696e 5f74 6872 6561 643a 2020 2320 7374  in_thread:  # st
+0000a770: 7261 6e67 6520 746f 2067 6574 2061 6761  range to get aga
+0000a780: 696e 2069 6e20 6d61 696e 2074 6872 6561  in in main threa
+0000a790: 640a 2020 2020 2020 2020 2020 2020 7261  d.            ra
+0000a7a0: 6973 6520 4578 6365 7074 696f 6e28 2269  ise Exception("i
+0000a7b0: 6e74 6572 7275 7074 5f6d 6169 6e28 2920  nterrupt_main() 
+0000a7c0: 6672 6f6d 206d 6169 6e20 7468 7265 6164  from main thread
+0000a7d0: 2077 6869 6c65 2061 6c72 6561 6479 2071   while already q
+0000a7e0: 7569 7474 696e 6722 290a 2020 2020 2020  uitting").      
+0000a7f0: 2020 2320 4e6f 7420 6d61 696e 2074 6872    # Not main thr
+0000a800: 6561 642e 2054 6869 7320 7769 6c6c 206a  ead. This will j
+0000a810: 7573 7420 6578 6974 2074 6865 2074 6872  ust exit the thr
+0000a820: 6561 642e 0a20 2020 2020 2020 2073 7973  ead..        sys
+0000a830: 2e65 7869 7428 3129 0a20 2020 2073 7973  .exit(1).    sys
+0000a840: 2e65 7869 7465 6420 3d20 5472 7565 2020  .exited = True  
+0000a850: 2320 446f 6e27 7420 646f 2069 7420 7477  # Don't do it tw
+0000a860: 6963 652e 0a20 2020 2023 206e 6f69 6e73  ice..    # noins
+0000a870: 7065 6374 696f 6e20 5079 5072 6f74 6563  pection PyProtec
+0000a880: 7465 644d 656d 6265 722c 5079 556e 7265  tedMember,PyUnre
+0000a890: 736f 6c76 6564 5265 6665 7265 6e63 6573  solvedReferences
+0000a8a0: 0a20 2020 2073 7973 2e65 7869 7465 645f  .    sys.exited_
+0000a8b0: 6672 616d 6520 3d20 7379 732e 5f67 6574  frame = sys._get
+0000a8c0: 6672 616d 6528 290a 2020 2020 6966 2069  frame().    if i
+0000a8d0: 735f 6d61 696e 5f74 6872 6561 643a 0a20  s_main_thread:. 
+0000a8e0: 2020 2020 2020 2072 6169 7365 204b 6579         raise Key
+0000a8f0: 626f 6172 6449 6e74 6572 7275 7074 0a20  boardInterrupt. 
+0000a900: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000a910: 2074 6872 6561 642e 696e 7465 7272 7570   thread.interrup
+0000a920: 745f 6d61 696e 2829 0a20 2020 2020 2020  t_main().       
+0000a930: 2073 7973 2e65 7869 7428 3129 2020 2320   sys.exit(1)  # 
+0000a940: 416e 6420 6578 6974 2074 6865 2074 6872  And exit the thr
+0000a950: 6561 642e 0a0a 0a63 6c61 7373 2041 7379  ead....class Asy
+0000a960: 6e63 5468 7265 6164 5275 6e28 7468 7265  ncThreadRun(thre
+0000a970: 6164 696e 672e 5468 7265 6164 293a 0a20  ading.Thread):. 
+0000a980: 2020 2022 2222 0a20 2020 2044 6165 6d6f     """.    Daemo
+0000a990: 6e20 7468 7265 6164 2c20 7772 6170 7069  n thread, wrappi
+0000a9a0: 6e67 2073 6f6d 6520 6675 6e63 7469 6f6e  ng some function
+0000a9b0: 2060 6066 756e 6360 6020 7669 6120 3a66   ``func`` via :f
+0000a9c0: 756e 633a 6077 7261 705f 6173 796e 635f  unc:`wrap_async_
+0000a9d0: 6675 6e63 602e 0a20 2020 2022 2222 0a0a  func`..    """..
+0000a9e0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+0000a9f0: 2873 656c 662c 206e 616d 652c 2066 756e  (self, name, fun
+0000aa00: 6329 3a0a 2020 2020 2020 2020 2222 220a  c):.        """.
+0000aa10: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+0000aa20: 7472 206e 616d 653a 0a20 2020 2020 2020  tr name:.       
+0000aa30: 203a 7061 7261 6d20 2829 2d3e 5420 6675   :param ()->T fu
+0000aa40: 6e63 3a0a 2020 2020 2020 2020 2222 220a  nc:.        """.
+0000aa50: 2020 2020 2020 2020 7375 7065 7228 4173          super(As
+0000aa60: 796e 6354 6872 6561 6452 756e 2c20 7365  yncThreadRun, se
+0000aa70: 6c66 292e 5f5f 696e 6974 5f5f 286e 616d  lf).__init__(nam
+0000aa80: 653d 6e61 6d65 2c20 7461 7267 6574 3d73  e=name, target=s
+0000aa90: 656c 662e 6d61 696e 290a 2020 2020 2020  elf.main).      
+0000aaa0: 2020 7365 6c66 2e66 756e 6320 3d20 6675    self.func = fu
+0000aab0: 6e63 0a20 2020 2020 2020 2073 656c 662e  nc.        self.
+0000aac0: 7265 7375 6c74 203d 204e 6f6e 650a 2020  result = None.  
+0000aad0: 2020 2020 2020 7365 6c66 2e64 6165 6d6f        self.daemo
+0000aae0: 6e20 3d20 5472 7565 0a20 2020 2020 2020  n = True.       
+0000aaf0: 2073 656c 662e 7374 6172 7428 290a 0a20   self.start().. 
+0000ab00: 2020 2064 6566 206d 6169 6e28 7365 6c66     def main(self
+0000ab10: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0000ab20: 2020 2020 2020 2054 6872 6561 6420 7461         Thread ta
+0000ab30: 7267 6574 2066 756e 6374 696f 6e2e 0a0a  rget function...
+0000ab40: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+0000ab50: 206e 6f74 6869 6e67 2c20 7769 6c6c 206a   nothing, will j
+0000ab60: 7573 7420 7365 7420 7365 6c66 2e72 6573  ust set self.res
+0000ab70: 756c 740a 2020 2020 2020 2020 2222 220a  ult.        """.
+0000ab80: 2020 2020 2020 2020 7365 6c66 2e72 6573          self.res
+0000ab90: 756c 7420 3d20 7772 6170 5f61 7379 6e63  ult = wrap_async
+0000aba0: 5f66 756e 6328 7365 6c66 2e66 756e 6329  _func(self.func)
+0000abb0: 0a0a 2020 2020 6465 6620 6765 7428 7365  ..    def get(se
+0000abc0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0000abd0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0000abe0: 3a20 6a6f 696e 7320 7468 6520 7468 7265  : joins the thre
+0000abf0: 6164 2c20 616e 6420 7468 656e 2072 6574  ad, and then ret
+0000ac00: 7572 6e73 2074 6865 2072 6573 756c 740a  urns the result.
+0000ac10: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
+0000ac20: 540a 2020 2020 2020 2020 2222 220a 2020  T.        """.  
+0000ac30: 2020 2020 2020 7365 6c66 2e6a 6f69 6e28        self.join(
+0000ac40: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000ac50: 2073 656c 662e 7265 7375 6c74 0a0a 0a64   self.result...d
+0000ac60: 6566 2077 7261 705f 6173 796e 635f 6675  ef wrap_async_fu
+0000ac70: 6e63 2866 293a 0a20 2020 2022 2222 0a20  nc(f):.    """. 
+0000ac80: 2020 2043 616c 6c73 2060 6066 2829 6060     Calls ``f()``
+0000ac90: 2061 6e64 2072 6574 7572 6e73 2074 6865   and returns the
+0000aca0: 2072 6573 756c 742e 0a20 2020 2057 7261   result..    Wra
+0000acb0: 7070 6564 2075 7020 7769 7468 2063 6174  pped up with cat
+0000acc0: 6368 696e 6720 616c 6c20 6578 6365 7074  ching all except
+0000acd0: 696f 6e73 2c20 7072 696e 7469 6e67 2073  ions, printing s
+0000ace0: 7461 636b 2074 7261 6365 2c20 616e 6420  tack trace, and 
+0000acf0: 3a66 756e 633a 6069 6e74 6572 7275 7074  :func:`interrupt
+0000ad00: 5f6d 6169 6e60 2e0a 0a20 2020 203a 7061  _main`...    :pa
+0000ad10: 7261 6d20 2829 2d3e 5420 663a 0a20 2020  ram ()->T f:.   
+0000ad20: 203a 7274 7970 653a 2054 0a20 2020 2022   :rtype: T.    "
+0000ad30: 2222 0a20 2020 2023 206e 6f69 6e73 7065  "".    # noinspe
+0000ad40: 6374 696f 6e20 5079 4272 6f61 6445 7863  ction PyBroadExc
+0000ad50: 6570 7469 6f6e 0a20 2020 2074 7279 3a0a  eption.    try:.
+0000ad60: 2020 2020 2020 2020 6672 6f6d 2072 6574          from ret
+0000ad70: 7572 6e6e 2e75 7469 6c20 696d 706f 7274  urnn.util import
+0000ad80: 2062 6574 7465 725f 6578 6368 6f6f 6b0a   better_exchook.
+0000ad90: 0a20 2020 2020 2020 2062 6574 7465 725f  .        better_
+0000ada0: 6578 6368 6f6f 6b2e 696e 7374 616c 6c28  exchook.install(
+0000adb0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000adc0: 2066 2829 0a20 2020 2065 7863 6570 7420   f().    except 
+0000add0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+0000ade0: 2020 2073 7973 2e65 7863 6570 7468 6f6f     sys.excepthoo
+0000adf0: 6b28 2a73 7973 2e65 7863 5f69 6e66 6f28  k(*sys.exc_info(
+0000ae00: 2929 0a20 2020 2020 2020 2069 6e74 6572  )).        inter
+0000ae10: 7275 7074 5f6d 6169 6e28 290a 0a0a 6465  rupt_main()...de
+0000ae20: 6620 7472 795f 7275 6e28 6675 6e63 2c20  f try_run(func, 
+0000ae30: 6172 6773 3d28 292c 2063 6174 6368 5f65  args=(), catch_e
+0000ae40: 7863 3d45 7863 6570 7469 6f6e 2c20 6465  xc=Exception, de
+0000ae50: 6661 756c 743d 4e6f 6e65 293a 0a20 2020  fault=None):.   
+0000ae60: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
+0000ae70: 2828 5829 2d3e 5429 2066 756e 633a 0a20  ((X)->T) func:. 
+0000ae80: 2020 203a 7061 7261 6d20 7475 706c 6520     :param tuple 
+0000ae90: 6172 6773 3a0a 2020 2020 3a70 6172 616d  args:.    :param
+0000aea0: 2074 7970 655b 4578 6365 7074 696f 6e5d   type[Exception]
+0000aeb0: 2063 6174 6368 5f65 7863 3a0a 2020 2020   catch_exc:.    
+0000aec0: 3a70 6172 616d 2054 3220 6465 6661 756c  :param T2 defaul
+0000aed0: 743a 0a20 2020 203a 7265 7475 726e 3a20  t:.    :return: 
+0000aee0: 6569 7468 6572 2060 6066 756e 6328 2960  either ``func()`
+0000aef0: 6020 6f72 2060 6064 6566 6175 6c74 6060  ` or ``default``
+0000af00: 2069 6620 7468 6572 6520 7761 7320 736f   if there was so
+0000af10: 6d65 2065 7863 6570 7469 6f6e 0a20 2020  me exception.   
+0000af20: 203a 7274 7970 653a 2054 7c54 320a 2020   :rtype: T|T2.  
+0000af30: 2020 2222 220a 2020 2020 2320 6e6f 696e    """.    # noin
+0000af40: 7370 6563 7469 6f6e 2050 7942 726f 6164  spection PyBroad
+0000af50: 4578 6365 7074 696f 6e0a 2020 2020 7472  Exception.    tr
+0000af60: 793a 0a20 2020 2020 2020 2072 6574 7572  y:.        retur
+0000af70: 6e20 6675 6e63 282a 6172 6773 290a 2020  n func(*args).  
+0000af80: 2020 6578 6365 7074 2063 6174 6368 5f65    except catch_e
+0000af90: 7863 3a0a 2020 2020 2020 2020 7265 7475  xc:.        retu
+0000afa0: 726e 2064 6566 6175 6c74 0a0a 0a64 6566  rn default...def
+0000afb0: 2076 616c 6964 6174 655f 6272 6f61 6463   validate_broadc
+0000afc0: 6173 745f 616c 6c5f 736f 7572 6365 7328  ast_all_sources(
+0000afd0: 616c 6c6f 775f 6272 6f61 6463 6173 745f  allow_broadcast_
+0000afe0: 616c 6c5f 736f 7572 6365 732c 2069 6e70  all_sources, inp
+0000aff0: 7574 732c 2063 6f6d 6d6f 6e29 3a0a 2020  uts, common):.  
+0000b000: 2020 2222 220a 2020 2020 4361 6c6c 2074    """.    Call t
+0000b010: 6869 7320 7768 656e 2061 6c6c 2069 6e70  his when all inp
+0000b020: 7574 7320 746f 2073 6f6d 6520 6f70 6572  uts to some oper
+0000b030: 6174 696f 6e20 286c 6179 6572 2920 6d75  ation (layer) mu
+0000b040: 7374 2062 6520 6272 6f61 6463 6173 7465  st be broadcaste
+0000b050: 642e 0a20 2020 2049 7420 6368 6563 6b73  d..    It checks
+0000b060: 2077 6865 7468 6572 2062 726f 6164 6361   whether broadca
+0000b070: 7374 696e 6720 746f 2061 6c6c 2073 6f75  sting to all sou
+0000b080: 7263 6573 2073 686f 756c 6420 6265 2061  rces should be a
+0000b090: 6c6c 6f77 6564 2e0a 2020 2020 452e 672e  llowed..    E.g.
+0000b0a0: 2066 6f72 2069 6e70 7574 205b 422c 5431   for input [B,T1
+0000b0b0: 2c44 315d 202b 205b 422c 5432 2c44 325d  ,D1] + [B,T2,D2]
+0000b0c0: 2c20 7768 656e 2061 6c6c 6f77 6564 2c20  , when allowed, 
+0000b0d0: 6974 2077 6f75 6c64 2062 726f 6164 6361  it would broadca
+0000b0e0: 7374 2074 6f20 5b42 2c54 312c 5432 2c44  st to [B,T1,T2,D
+0000b0f0: 312c 4432 5d2e 0a20 2020 2057 6865 6e20  1,D2]..    When 
+0000b100: 6e6f 7420 616c 6c6f 7765 642c 2074 6865  not allowed, the
+0000b110: 7265 206d 7573 7420 6265 2061 7420 6c65  re must be at le
+0000b120: 6173 7420 6f6e 6520 736f 7572 6365 2077  ast one source w
+0000b130: 6865 7265 206e 6f20 6272 6f61 6463 6173  here no broadcas
+0000b140: 7469 6e67 2077 696c 6c20 6265 2064 6f6e  ting will be don
+0000b150: 652e 0a20 2020 2057 6865 7468 6572 2069  e..    Whether i
+0000b160: 7420 6973 2061 6c6c 6f77 6564 2c20 7468  t is allowed, th
+0000b170: 6973 2064 6570 656e 6473 206f 6e20 7468  is depends on th
+0000b180: 6520 6265 6861 7669 6f72 2076 6572 7369  e behavior versi
+0000b190: 6f6e 2e0a 2020 2020 2020 6874 7470 733a  on..      https:
+0000b1a0: 2f2f 6769 7468 7562 2e63 6f6d 2f72 7774  //github.com/rwt
+0000b1b0: 682d 6936 2f72 6574 7572 6e6e 2f69 7373  h-i6/returnn/iss
+0000b1c0: 7565 732f 3639 310a 0a20 2020 2043 6f6d  ues/691..    Com
+0000b1d0: 6d6f 6e20 7573 6167 6573 2061 7265 2066  mon usages are f
+0000b1e0: 6f72 203a 6675 6e63 3a60 6765 745f 636f  or :func:`get_co
+0000b1f0: 6d6d 6f6e 5f73 6861 7065 6020 6f72 203a  mmon_shape` or :
+0000b200: 6675 6e63 3a60 4461 7461 2e67 6574 5f63  func:`Data.get_c
+0000b210: 6f6d 6d6f 6e5f 6461 7461 602e 0a0a 2020  ommon_data`...  
+0000b220: 2020 3a70 6172 616d 2062 6f6f 6c7c 4e6f    :param bool|No
+0000b230: 7453 7065 6369 6669 6564 2061 6c6c 6f77  tSpecified allow
+0000b240: 5f62 726f 6164 6361 7374 5f61 6c6c 5f73  _broadcast_all_s
+0000b250: 6f75 7263 6573 3a0a 2020 2020 3a70 6172  ources:.    :par
+0000b260: 616d 2069 6e70 7574 733a 2061 6e79 7468  am inputs: anyth
+0000b270: 696e 6720 636f 6e76 6572 7469 626c 6520  ing convertible 
+0000b280: 746f 2069 7465 7261 626c 6520 6f66 2073  to iterable of s
+0000b290: 7472 2c20 7573 6564 2066 6f72 2072 6570  tr, used for rep
+0000b2a0: 6f72 7469 6e67 0a20 2020 203a 7061 7261  orting.    :para
+0000b2b0: 6d20 636f 6d6d 6f6e 3a20 616e 7974 6869  m common: anythi
+0000b2c0: 6e67 2063 6f6e 7665 7274 6962 6c65 2074  ng convertible t
+0000b2d0: 6f20 7374 722c 2075 7365 6420 666f 7220  o str, used for 
+0000b2e0: 7265 706f 7274 696e 670a 2020 2020 2222  reporting.    ""
+0000b2f0: 220a 2020 2020 6d73 6720 3d20 280a 2020  ".    msg = (.  
+0000b300: 2020 2020 2020 2241 6c6c 2069 6e70 7574        "All input
+0000b310: 735c 6e25 735c 6e72 6571 7569 7265 2062  s\n%s\nrequire b
+0000b320: 726f 6164 6361 7374 696e 6720 746f 205c  roadcasting to \
+0000b330: 6e20 2025 732e 5c6e 2220 2520 2822 5c6e  n  %s.\n" % ("\n
+0000b340: 222e 6a6f 696e 2822 202d 2025 7322 2025  ".join(" - %s" %
+0000b350: 2069 6e70 2066 6f72 2069 6e70 2069 6e20   inp for inp in 
+0000b360: 696e 7075 7473 292c 2063 6f6d 6d6f 6e29  inputs), common)
+0000b370: 0a20 2020 2020 2020 202b 2022 5468 6973  .        + "This
+0000b380: 206d 7573 7420 6265 2065 7870 6c69 6369   must be explici
+0000b390: 746c 7920 616c 6c6f 7765 642c 2065 2e67  tly allowed, e.g
+0000b3a0: 2e20 6279 2073 7065 6369 6679 696e 6720  . by specifying 
+0000b3b0: 6f75 745f 7368 6170 652e 220a 2020 2020  out_shape.".    
+0000b3c0: 290a 2020 2020 6966 2061 6c6c 6f77 5f62  ).    if allow_b
+0000b3d0: 726f 6164 6361 7374 5f61 6c6c 5f73 6f75  roadcast_all_sou
+0000b3e0: 7263 6573 2069 7320 4e6f 7453 7065 6369  rces is NotSpeci
+0000b3f0: 6669 6564 3a0a 2020 2020 2020 2020 6672  fied:.        fr
+0000b400: 6f6d 2072 6574 7572 6e6e 2e75 7469 6c20  om returnn.util 
+0000b410: 696d 706f 7274 2042 6568 6176 696f 7256  import BehaviorV
+0000b420: 6572 7369 6f6e 0a0a 2020 2020 2020 2020  ersion..        
+0000b430: 4265 6861 7669 6f72 5665 7273 696f 6e2e  BehaviorVersion.
+0000b440: 7265 7175 6972 6528 7665 7273 696f 6e3d  require(version=
+0000b450: 342c 2063 6f6e 6469 7469 6f6e 3d46 616c  4, condition=Fal
+0000b460: 7365 2c20 6d65 7373 6167 653d 6d73 6729  se, message=msg)
+0000b470: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
+0000b480: 2020 2020 6966 2061 6c6c 6f77 5f62 726f      if allow_bro
+0000b490: 6164 6361 7374 5f61 6c6c 5f73 6f75 7263  adcast_all_sourc
+0000b4a0: 6573 3a0a 2020 2020 2020 2020 7265 7475  es:.        retu
+0000b4b0: 726e 0a20 2020 2072 6169 7365 2045 7863  rn.    raise Exc
+0000b4c0: 6570 7469 6f6e 286d 7367 290a 0a0a 6465  eption(msg)...de
+0000b4d0: 6620 636c 6173 735f 6964 785f 7365 715f  f class_idx_seq_
+0000b4e0: 746f 5f31 5f6f 665f 6b28 7365 712c 206e  to_1_of_k(seq, n
+0000b4f0: 756d 5f63 6c61 7373 6573 293a 0a20 2020  um_classes):.   
+0000b500: 2022 2222 0a20 2020 2042 6173 6963 616c   """.    Basical
+0000b510: 6c79 206f 6e65 5f68 6f74 2e0a 0a20 2020  ly one_hot...   
+0000b520: 203a 7061 7261 6d20 6c69 7374 5b69 6e74   :param list[int
+0000b530: 5d7c 6e70 2e6e 6461 7272 6179 2073 6571  ]|np.ndarray seq
+0000b540: 3a0a 2020 2020 3a70 6172 616d 2069 6e74  :.    :param int
+0000b550: 206e 756d 5f63 6c61 7373 6573 3a0a 2020   num_classes:.  
+0000b560: 2020 3a72 7479 7065 3a20 6e70 2e6e 6461    :rtype: np.nda
+0000b570: 7272 6179 0a20 2020 2022 2222 0a20 2020  rray.    """.   
+0000b580: 206e 756d 5f66 7261 6d65 7320 3d20 6c65   num_frames = le
+0000b590: 6e28 7365 7129 0a20 2020 206d 203d 206e  n(seq).    m = n
+0000b5a0: 702e 7a65 726f 7328 286e 756d 5f66 7261  p.zeros((num_fra
+0000b5b0: 6d65 732c 206e 756d 5f63 6c61 7373 6573  mes, num_classes
+0000b5c0: 292c 2064 7479 7065 3d22 666c 6f61 7433  ), dtype="float3
+0000b5d0: 3222 290a 2020 2020 6d5b 6e70 2e61 7261  2").    m[np.ara
+0000b5e0: 6e67 6528 6e75 6d5f 6672 616d 6573 292c  nge(num_frames),
+0000b5f0: 2073 6571 5d20 3d20 310a 2020 2020 7265   seq] = 1.    re
+0000b600: 7475 726e 206d 0a0a 0a64 6566 2075 6e69  turn m...def uni
+0000b610: 7128 7365 7129 3a0a 2020 2020 2222 220a  q(seq):.    """.
+0000b620: 2020 2020 4c69 6b65 2055 6e69 7820 746f      Like Unix to
+0000b630: 6f6c 2075 6e69 712e 2052 656d 6f76 6573  ol uniq. Removes
+0000b640: 2072 6570 6561 7465 6420 656e 7472 6965   repeated entrie
+0000b650: 732e 0a20 2020 2053 6565 203a 6675 6e63  s..    See :func
+0000b660: 3a60 756e 6971 5f67 656e 6572 6963 6020  :`uniq_generic` 
+0000b670: 666f 7220 6120 6765 6e65 7269 6320 286e  for a generic (n
+0000b680: 6f6e 2d4e 756d 7079 2920 7665 7273 696f  on-Numpy) versio
+0000b690: 6e2e 0a0a 2020 2020 3a70 6172 616d 206e  n...    :param n
+0000b6a0: 756d 7079 2e6e 6461 7272 6179 2073 6571  umpy.ndarray seq
+0000b6b0: 3a0a 2020 2020 3a72 6574 7572 6e3a 2073  :.    :return: s
+0000b6c0: 6571 0a20 2020 203a 7274 7970 653a 206e  eq.    :rtype: n
+0000b6d0: 756d 7079 2e6e 6461 7272 6179 0a20 2020  umpy.ndarray.   
+0000b6e0: 2022 2222 0a20 2020 2064 6966 6673 203d   """.    diffs =
+0000b6f0: 206e 702e 6f6e 6573 5f6c 696b 6528 7365   np.ones_like(se
+0000b700: 7129 0a20 2020 2064 6966 6673 5b31 3a5d  q).    diffs[1:]
+0000b710: 203d 2073 6571 5b31 3a5d 202d 2073 6571   = seq[1:] - seq
+0000b720: 5b3a 2d31 5d0a 2020 2020 6964 7820 3d20  [:-1].    idx = 
+0000b730: 6469 6666 732e 6e6f 6e7a 6572 6f28 290a  diffs.nonzero().
+0000b740: 2020 2020 7265 7475 726e 2073 6571 5b69      return seq[i
+0000b750: 6478 5d0a 0a0a 6465 6620 756e 6971 5f67  dx]...def uniq_g
+0000b760: 656e 6572 6963 2873 6571 293a 0a20 2020  eneric(seq):.   
+0000b770: 2022 2222 0a20 2020 204c 696b 6520 556e   """.    Like Un
+0000b780: 6978 2074 6f6f 6c20 756e 6971 2e20 5265  ix tool uniq. Re
+0000b790: 6d6f 7665 7320 7265 7065 6174 6564 2065  moves repeated e
+0000b7a0: 6e74 7269 6573 2e0a 2020 2020 5365 6520  ntries..    See 
+0000b7b0: 3a66 756e 633a 6075 6e69 7160 2066 6f72  :func:`uniq` for
+0000b7c0: 2061 6e20 6566 6669 6369 656e 7420 4e75   an efficient Nu
+0000b7d0: 6d70 7920 696d 706c 656d 656e 7461 7469  mpy implementati
+0000b7e0: 6f6e 2e0a 2020 2020 5365 6520 3a66 756e  on..    See :fun
+0000b7f0: 633a 6072 6574 7572 6e6e 2e74 662e 7574  c:`returnn.tf.ut
+0000b800: 696c 2e62 6173 6963 2e75 6e69 7160 2066  il.basic.uniq` f
+0000b810: 6f72 2061 6e20 6566 6669 6369 656e 7420  or an efficient 
+0000b820: 5446 2069 6d70 6c65 6d65 6e74 6174 696f  TF implementatio
+0000b830: 6e2e 0a0a 2020 2020 3a70 6172 616d 206c  n...    :param l
+0000b840: 6973 745b 545d 7c74 7570 6c65 5b54 5d20  ist[T]|tuple[T] 
+0000b850: 7365 713a 0a20 2020 203a 7265 7475 726e  seq:.    :return
+0000b860: 3a20 7365 710a 2020 2020 3a72 7479 7065  : seq.    :rtype
+0000b870: 3a20 6c69 7374 5b54 5d0a 2020 2020 2222  : list[T].    ""
+0000b880: 220a 2020 2020 6f75 7420 3d20 5b5d 0a20  ".    out = []. 
+0000b890: 2020 2076 6973 6974 6564 203d 2073 6574     visited = set
+0000b8a0: 2829 0a20 2020 2066 6f72 2078 2069 6e20  ().    for x in 
+0000b8b0: 7365 713a 0a20 2020 2020 2020 2069 6620  seq:.        if 
+0000b8c0: 7820 696e 2076 6973 6974 6564 3a0a 2020  x in visited:.  
+0000b8d0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0000b8e0: 7565 0a20 2020 2020 2020 206f 7574 2e61  ue.        out.a
+0000b8f0: 7070 656e 6428 7829 0a20 2020 2020 2020  ppend(x).       
+0000b900: 2076 6973 6974 6564 2e61 6464 2878 290a   visited.add(x).
+0000b910: 2020 2020 7265 7475 726e 206f 7574 0a0a      return out..
+0000b920: 0a64 6566 2073 6c69 6365 5f70 6164 5f7a  .def slice_pad_z
+0000b930: 6572 6f73 2878 3a20 6e75 6d70 792e 6e64  eros(x: numpy.nd
+0000b940: 6172 7261 792c 2062 6567 696e 3a20 696e  array, begin: in
+0000b950: 742c 2065 6e64 3a20 696e 742c 2061 7869  t, end: int, axi
+0000b960: 733a 2069 6e74 203d 2030 2920 2d3e 206e  s: int = 0) -> n
+0000b970: 756d 7079 2e6e 6461 7272 6179 3a0a 2020  umpy.ndarray:.  
+0000b980: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
+0000b990: 2078 3a20 6f66 2073 6861 7065 2028 2e2e   x: of shape (..
+0000b9a0: 2e2c 2074 696d 652c 202e 2e2e 290a 2020  ., time, ...).  
+0000b9b0: 2020 3a70 6172 616d 2062 6567 696e 3a0a    :param begin:.
+0000b9c0: 2020 2020 3a70 6172 616d 2065 6e64 3a0a      :param end:.
+0000b9d0: 2020 2020 3a70 6172 616d 2061 7869 733a      :param axis:
+0000b9e0: 0a20 2020 203a 7265 7475 726e 3a20 6261  .    :return: ba
+0000b9f0: 7369 6361 6c6c 7920 785b 6265 6769 6e3a  sically x[begin:
+0000ba00: 656e 645d 2028 7769 7468 2061 7869 733d  end] (with axis=
+0000ba10: 3d30 2920 6275 7420 6966 2062 6567 696e  =0) but if begin
+0000ba20: 203c 2030 206f 7220 656e 6420 3e20 782e   < 0 or end > x.
+0000ba30: 7368 6170 655b 305d 2c0a 2020 2020 2069  shape[0],.     i
+0000ba40: 7420 7769 6c6c 206e 6f74 2064 6973 6361  t will not disca
+0000ba50: 7264 2074 6865 7365 2066 7261 6d65 7320  rd these frames 
+0000ba60: 6275 7420 7061 6420 7a65 726f 732c 2073  but pad zeros, s
+0000ba70: 7563 6820 7468 6174 2074 6865 2072 6573  uch that the res
+0000ba80: 756c 7469 6e67 2073 6861 7065 5b30 5d20  ulting shape[0] 
+0000ba90: 3d3d 2065 6e64 202d 2062 6567 696e 2e0a  == end - begin..
+0000baa0: 2020 2020 2222 220a 2020 2020 6173 7365      """.    asse
+0000bab0: 7274 2061 7869 7320 3d3d 2030 2c20 226e  rt axis == 0, "n
+0000bac0: 6f74 2079 6574 2066 756c 6c79 2069 6d70  ot yet fully imp
+0000bad0: 6c65 6d65 6e74 6564 206f 7468 6572 7769  lemented otherwi
+0000bae0: 7365 220a 2020 2020 7061 645f 6c65 6674  se".    pad_left
+0000baf0: 2c20 7061 645f 7269 6768 7420 3d20 302c  , pad_right = 0,
+0000bb00: 2030 0a20 2020 2069 6620 6265 6769 6e20   0.    if begin 
+0000bb10: 3c20 303a 0a20 2020 2020 2020 2070 6164  < 0:.        pad
+0000bb20: 5f6c 6566 7420 3d20 2d62 6567 696e 0a20  _left = -begin. 
+0000bb30: 2020 2020 2020 2062 6567 696e 203d 2030         begin = 0
+0000bb40: 0a20 2020 2065 6c69 6620 6265 6769 6e20  .    elif begin 
+0000bb50: 3e3d 2078 2e73 6861 7065 5b61 7869 735d  >= x.shape[axis]
+0000bb60: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000bb70: 206e 702e 7a65 726f 7328 2865 6e64 202d   np.zeros((end -
+0000bb80: 2062 6567 696e 2c29 202b 2078 2e73 6861   begin,) + x.sha
+0000bb90: 7065 5b31 3a5d 2c20 6474 7970 653d 782e  pe[1:], dtype=x.
+0000bba0: 6474 7970 6529 0a20 2020 2061 7373 6572  dtype).    asser
+0000bbb0: 7420 656e 6420 3e3d 2062 6567 696e 0a20  t end >= begin. 
+0000bbc0: 2020 2069 6620 656e 6420 3e20 782e 7368     if end > x.sh
+0000bbd0: 6170 655b 6178 6973 5d3a 0a20 2020 2020  ape[axis]:.     
+0000bbe0: 2020 2070 6164 5f72 6967 6874 203d 2065     pad_right = e
+0000bbf0: 6e64 202d 2078 2e73 6861 7065 5b61 7869  nd - x.shape[axi
+0000bc00: 735d 0a20 2020 2020 2020 2065 6e64 203d  s].        end =
+0000bc10: 2078 2e73 6861 7065 5b61 7869 735d 0a20   x.shape[axis]. 
+0000bc20: 2020 2072 6574 7572 6e20 6e70 2e70 6164     return np.pad
+0000bc30: 2878 5b62 6567 696e 3a65 6e64 5d2c 205b  (x[begin:end], [
+0000bc40: 2870 6164 5f6c 6566 742c 2070 6164 5f72  (pad_left, pad_r
+0000bc50: 6967 6874 295d 202b 205b 2830 2c20 3029  ight)] + [(0, 0)
+0000bc60: 5d20 2a20 2878 2e6e 6469 6d20 2d20 3129  ] * (x.ndim - 1)
+0000bc70: 2c20 6d6f 6465 3d22 636f 6e73 7461 6e74  , mode="constant
+0000bc80: 2229 0a0a 0a64 6566 2072 616e 646f 6d5f  ")...def random_
+0000bc90: 6f72 7468 6f67 6f6e 616c 2873 6861 7065  orthogonal(shape
+0000bca0: 2c20 6761 696e 3d31 2e30 2c20 7365 6564  , gain=1.0, seed
+0000bcb0: 3d4e 6f6e 6529 3a0a 2020 2020 2222 220a  =None):.    """.
+0000bcc0: 2020 2020 5265 7475 726e 7320 6120 7261      Returns a ra
+0000bcd0: 6e64 6f6d 206f 7274 686f 676f 6e61 6c20  ndom orthogonal 
+0000bce0: 6d61 7472 6978 206f 6620 7468 6520 6769  matrix of the gi
+0000bcf0: 7665 6e20 7368 6170 652e 0a20 2020 2043  ven shape..    C
+0000bd00: 6f64 6520 626f 7272 6f77 6564 2061 6e64  ode borrowed and
+0000bd10: 2061 6461 7074 6564 2066 726f 6d20 4b65   adapted from Ke
+0000bd20: 7261 733a 2068 7474 7073 3a2f 2f67 6974  ras: https://git
+0000bd30: 6875 622e 636f 6d2f 6663 686f 6c6c 6574  hub.com/fchollet
+0000bd40: 2f6b 6572 6173 2f62 6c6f 622f 6d61 7374  /keras/blob/mast
+0000bd50: 6572 2f6b 6572 6173 2f69 6e69 7469 616c  er/keras/initial
+0000bd60: 697a 6572 732e 7079 0a20 2020 2052 6566  izers.py.    Ref
+0000bd70: 6572 656e 6365 3a20 5361 7865 2065 7420  erence: Saxe et 
+0000bd80: 616c 2e2c 2068 7474 7073 3a2f 2f61 7278  al., https://arx
+0000bd90: 6976 2e6f 7267 2f61 6273 2f31 3331 322e  iv.org/abs/1312.
+0000bda0: 3631 3230 0a20 2020 2052 656c 6174 6564  6120.    Related
+0000bdb0: 3a20 556e 6974 6172 7920 4576 6f6c 7574  : Unitary Evolut
+0000bdc0: 696f 6e20 5265 6375 7272 656e 7420 4e65  ion Recurrent Ne
+0000bdd0: 7572 616c 204e 6574 776f 726b 732c 2068  ural Networks, h
+0000bde0: 7474 7073 3a2f 2f61 7278 6976 2e6f 7267  ttps://arxiv.org
+0000bdf0: 2f61 6273 2f31 3531 312e 3036 3436 340a  /abs/1511.06464.
+0000be00: 0a20 2020 203a 7061 7261 6d20 7475 706c  .    :param tupl
+0000be10: 655b 696e 745d 2073 6861 7065 3a0a 2020  e[int] shape:.  
+0000be20: 2020 3a70 6172 616d 2066 6c6f 6174 2067    :param float g
+0000be30: 6169 6e3a 0a20 2020 203a 7061 7261 6d20  ain:.    :param 
+0000be40: 696e 7420 7365 6564 3a20 666f 7220 4e75  int seed: for Nu
+0000be50: 6d70 7920 7261 6e64 6f6d 2067 656e 6572  mpy random gener
+0000be60: 6174 6f72 0a20 2020 203a 7265 7475 726e  ator.    :return
+0000be70: 3a20 7261 6e64 6f6d 206f 7274 686f 676f  : random orthogo
+0000be80: 6e61 6c20 6d61 7472 6978 0a20 2020 203a  nal matrix.    :
+0000be90: 7274 7970 653a 206e 756d 7079 2e6e 6461  rtype: numpy.nda
+0000bea0: 7272 6179 0a20 2020 2022 2222 0a20 2020  rray.    """.   
+0000beb0: 206e 756d 5f72 6f77 7320 3d20 310a 2020   num_rows = 1.  
+0000bec0: 2020 666f 7220 6469 6d20 696e 2073 6861    for dim in sha
+0000bed0: 7065 5b3a 2d31 5d3a 0a20 2020 2020 2020  pe[:-1]:.       
+0000bee0: 206e 756d 5f72 6f77 7320 2a3d 2064 696d   num_rows *= dim
+0000bef0: 0a20 2020 206e 756d 5f63 6f6c 7320 3d20  .    num_cols = 
+0000bf00: 7368 6170 655b 2d31 5d0a 2020 2020 666c  shape[-1].    fl
+0000bf10: 6174 5f73 6861 7065 203d 2028 6e75 6d5f  at_shape = (num_
+0000bf20: 726f 7773 2c20 6e75 6d5f 636f 6c73 290a  rows, num_cols).
+0000bf30: 2020 2020 6966 2073 6565 6420 6973 206e      if seed is n
+0000bf40: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000bf50: 2072 6e64 203d 206e 702e 7261 6e64 6f6d   rnd = np.random
+0000bf60: 2e52 616e 646f 6d53 7461 7465 2873 6565  .RandomState(see
+0000bf70: 643d 7365 6564 290a 2020 2020 656c 7365  d=seed).    else
+0000bf80: 3a0a 2020 2020 2020 2020 726e 6420 3d20  :.        rnd = 
+0000bf90: 6e70 2e72 616e 646f 6d0a 2020 2020 6120  np.random.    a 
+0000bfa0: 3d20 726e 642e 6e6f 726d 616c 2830 2e30  = rnd.normal(0.0
+0000bfb0: 2c20 312e 302c 2066 6c61 745f 7368 6170  , 1.0, flat_shap
+0000bfc0: 6529 0a20 2020 2075 2c20 5f2c 2076 203d  e).    u, _, v =
+0000bfd0: 206e 702e 6c69 6e61 6c67 2e73 7664 2861   np.linalg.svd(a
+0000bfe0: 2c20 6675 6c6c 5f6d 6174 7269 6365 733d  , full_matrices=
+0000bff0: 4661 6c73 6529 0a20 2020 2023 2050 6963  False).    # Pic
+0000c000: 6b20 7468 6520 6f6e 6520 7769 7468 2074  k the one with t
+0000c010: 6865 2063 6f72 7265 6374 2073 6861 7065  he correct shape
+0000c020: 2e0a 2020 2020 7120 3d20 7520 6966 2075  ..    q = u if u
+0000c030: 2e73 6861 7065 203d 3d20 666c 6174 5f73  .shape == flat_s
+0000c040: 6861 7065 2065 6c73 6520 760a 2020 2020  hape else v.    
+0000c050: 7120 3d20 712e 7265 7368 6170 6528 7368  q = q.reshape(sh
+0000c060: 6170 6529 0a20 2020 2072 6574 7572 6e20  ape).    return 
+0000c070: 6761 696e 202a 2071 5b3a 2073 6861 7065  gain * q[: shape
+0000c080: 5b30 5d2c 203a 2073 6861 7065 5b31 5d5d  [0], : shape[1]]
+0000c090: 0a0a 0a23 206e 6f69 6e73 7065 6374 696f  ...# noinspectio
+0000c0a0: 6e20 5079 556e 7573 6564 4c6f 6361 6c0a  n PyUnusedLocal.
+0000c0b0: 6465 6620 696e 706c 6163 655f 696e 6372  def inplace_incr
+0000c0c0: 656d 656e 7428 782c 2069 6478 2c20 7929  ement(x, idx, y)
+0000c0d0: 3a0a 2020 2020 2222 220a 2020 2020 5468  :.    """.    Th
+0000c0e0: 6973 2062 6173 6963 616c 6c79 2064 6f65  is basically doe
+0000c0f0: 7320 6078 5b69 6478 5d20 2b3d 2079 602e  s `x[idx] += y`.
+0000c100: 0a20 2020 2054 6865 2064 6966 6665 7265  .    The differe
+0000c110: 6e63 6520 746f 2074 6865 204e 756d 7079  nce to the Numpy
+0000c120: 2076 6572 7369 6f6e 2069 7320 7468 6174   version is that
+0000c130: 2069 6e20 6361 7365 2073 6f6d 6520 696e   in case some in
+0000c140: 6465 7820 6973 2074 6865 7265 206d 756c  dex is there mul
+0000c150: 7469 706c 650a 2020 2020 7469 6d65 732c  tiple.    times,
+0000c160: 2069 7420 7769 6c6c 206f 6e6c 7920 6265   it will only be
+0000c170: 2069 6e63 7265 6d65 6e74 6564 206f 6e63   incremented onc
+0000c180: 6520 2861 6e64 2069 7420 6973 206e 6f74  e (and it is not
+0000c190: 2073 7065 6369 6669 6564 2077 6869 6368   specified which
+0000c1a0: 206f 6e65 292e 0a20 2020 2053 6565 2061   one)..    See a
+0000c1b0: 6c73 6f20 7468 6561 6e6f 2e74 656e 736f  lso theano.tenso
+0000c1c0: 722e 7375 6274 656e 736f 722e 4164 7661  r.subtensor.Adva
+0000c1d0: 6e63 6564 496e 6353 7562 7465 6e73 6f72  ncedIncSubtensor
+0000c1e0: 2064 6f63 756d 656e 7461 7469 6f6e 2e0a   documentation..
+0000c1f0: 0a20 2020 203a 7061 7261 6d20 6e75 6d70  .    :param nump
+0000c200: 792e 6e64 6172 7261 7920 783a 0a20 2020  y.ndarray x:.   
+0000c210: 203a 7061 7261 6d20 6e75 6d70 792e 6e64   :param numpy.nd
+0000c220: 6172 7261 7920 6964 783a 0a20 2020 203a  array idx:.    :
+0000c230: 7061 7261 6d20 6e75 6d70 792e 6e64 6172  param numpy.ndar
+0000c240: 7261 7920 793a 0a20 2020 203a 7274 7970  ray y:.    :rtyp
+0000c250: 653a 206e 756d 7079 2e6e 6461 7272 6179  e: numpy.ndarray
+0000c260: 0a20 2020 2022 2222 0a20 2020 2072 6169  .    """.    rai
+0000c270: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
+0000c280: 6445 7272 6f72 2822 5468 6973 2066 6561  dError("This fea
+0000c290: 7475 7265 2077 6173 2072 656d 6f76 6564  ture was removed
+0000c2a0: 2077 6974 6820 6472 6f70 7065 6420 5468   with dropped Th
+0000c2b0: 6561 6e6f 2073 7570 706f 7274 2229 0a0a  eano support")..
+0000c2c0: 0a64 6566 2070 726f 6428 6c73 293a 0a20  .def prod(ls):. 
+0000c2d0: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
+0000c2e0: 6d20 6c69 7374 5b54 5d7c 7475 706c 655b  m list[T]|tuple[
+0000c2f0: 545d 7c6e 756d 7079 2e6e 6461 7272 6179  T]|numpy.ndarray
+0000c300: 206c 733a 0a20 2020 203a 7274 7970 653a   ls:.    :rtype:
+0000c310: 2054 7c69 6e74 7c66 6c6f 6174 0a20 2020   T|int|float.   
+0000c320: 2022 2222 0a20 2020 2069 6620 6c65 6e28   """.    if len(
+0000c330: 6c73 2920 3d3d 2030 3a0a 2020 2020 2020  ls) == 0:.      
+0000c340: 2020 7265 7475 726e 2031 0a20 2020 2078    return 1.    x
+0000c350: 203d 206c 735b 305d 0a20 2020 2066 6f72   = ls[0].    for
+0000c360: 2079 2069 6e20 6c73 5b31 3a5d 3a0a 2020   y in ls[1:]:.  
+0000c370: 2020 2020 2020 7820 2a3d 2079 0a20 2020        x *= y.   
+0000c380: 2072 6574 7572 6e20 780a 0a0a 6465 6620   return x...def 
+0000c390: 7061 7273 655f 6f72 7468 6f67 7261 7068  parse_orthograph
+0000c3a0: 795f 696e 746f 5f73 796d 626f 6c73 280a  y_into_symbols(.
+0000c3b0: 2020 2020 6f72 7468 6f67 7261 7068 792c      orthography,
+0000c3c0: 2075 7070 6572 5f63 6173 655f 7370 6563   upper_case_spec
+0000c3d0: 6961 6c3d 5472 7565 2c20 776f 7264 5f62  ial=True, word_b
+0000c3e0: 6173 6564 3d46 616c 7365 2c20 7371 7561  ased=False, squa
+0000c3f0: 7265 5f62 7261 636b 6574 735f 666f 725f  re_brackets_for_
+0000c400: 7370 6563 6961 6c73 3d54 7275 650a 293a  specials=True.):
+0000c410: 0a20 2020 2022 2222 0a20 2020 2046 6f72  .    """.    For
+0000c420: 2053 7065 6563 682e 0a20 2020 2045 7861   Speech..    Exa
+0000c430: 6d70 6c65 3a0a 2020 2020 2020 6f72 7468  mple:.      orth
+0000c440: 6f67 7261 7068 7920 3d20 2268 656c 6c6f  ography = "hello
+0000c450: 205b 4845 5349 5441 5449 4f4e 5d20 7468   [HESITATION] th
+0000c460: 6572 6520 220a 2020 2020 2020 7769 7468  ere ".      with
+0000c470: 2077 6f72 645f 6261 7365 6420 3d3d 2046   word_based == F
+0000c480: 616c 7365 3a20 7265 7475 726e 7320 6c69  alse: returns li
+0000c490: 7374 2822 6865 6c6c 6f20 2229 202b 205b  st("hello ") + [
+0000c4a0: 225b 4845 5349 5441 5449 4f4e 5d22 5d20  "[HESITATION]"] 
+0000c4b0: 2b20 6c69 7374 2822 2074 6865 7265 2022  + list(" there "
+0000c4c0: 292e 0a20 2020 2020 2077 6974 6820 776f  )..      with wo
+0000c4d0: 7264 5f62 6173 6564 203d 3d20 5472 7565  rd_based == True
+0000c4e0: 3a20 7265 7475 726e 7320 5b22 6865 6c6c  : returns ["hell
+0000c4f0: 6f22 2c20 225b 4845 5349 5441 5449 4f4e  o", "[HESITATION
+0000c500: 5d22 2c20 2274 6865 7265 225d 0a20 2020  ]", "there"].   
+0000c510: 204e 6f20 7072 652f 706f 7374 2d70 726f   No pre/post-pro
+0000c520: 6365 7373 696e 6720 7375 6368 2061 733a  cessing such as:
+0000c530: 0a20 2020 2053 7061 6365 7320 6172 6520  .    Spaces are 
+0000c540: 6b65 7074 2061 732d 6973 2e20 4e6f 2073  kept as-is. No s
+0000c550: 7472 6970 7069 6e67 2061 7420 6265 6769  tripping at begi
+0000c560: 6e2f 656e 642e 2028 452e 672e 2074 7261  n/end. (E.g. tra
+0000c570: 696c 696e 6720 7370 6163 6573 2061 7265  iling spaces are
+0000c580: 206e 6f74 2072 656d 6f76 6564 2e29 0a20   not removed.). 
+0000c590: 2020 204e 6f20 746f 6c6f 7765 722f 746f     No tolower/to
+0000c5a0: 7570 7065 722e 0a20 2020 2044 6f65 736e  upper..    Doesn
+0000c5b0: 2774 2061 6464 205b 4245 4749 4e5d 2f5b  't add [BEGIN]/[
+0000c5c0: 454e 445d 2073 796d 626f 6c73 206f 7220  END] symbols or 
+0000c5d0: 736f 2e0a 2020 2020 416e 7920 7375 6368  so..    Any such
+0000c5e0: 206f 7065 7261 7469 6f6e 7320 7368 6f75   operations shou
+0000c5f0: 6c64 2062 6520 646f 6e65 2065 7870 6c69  ld be done expli
+0000c600: 6369 746c 7920 696e 2061 6e20 6164 6469  citly in an addi
+0000c610: 7469 6f6e 616c 2066 756e 6374 696f 6e2e  tional function.
+0000c620: 0a20 2020 2041 6e79 7468 696e 6720 696e  .    Anything in
+0000c630: 205b 5d2d 6272 6163 6b65 7473 2061 7265   []-brackets are
+0000c640: 206d 6561 6e74 2061 7320 7370 6563 6961   meant as specia
+0000c650: 6c2d 7379 6d62 6f6c 732e 0a20 2020 2041  l-symbols..    A
+0000c660: 6c73 6f20 7365 6520 7061 7273 655f 6f72  lso see parse_or
+0000c670: 7468 6f67 7261 7068 7928 2920 7768 6963  thography() whic
+0000c680: 6820 696e 636c 7564 6573 2073 6f6d 6520  h includes some 
+0000c690: 7072 6570 726f 6365 7373 696e 672e 0a0a  preprocessing...
+0000c6a0: 2020 2020 3a70 6172 616d 2073 7472 206f      :param str o
+0000c6b0: 7274 686f 6772 6170 6879 3a20 6578 616d  rthography: exam
+0000c6c0: 706c 653a 2022 6865 6c6c 6f20 5b48 4553  ple: "hello [HES
+0000c6d0: 4954 4154 494f 4e5d 2074 6865 7265 2022  ITATION] there "
+0000c6e0: 0a20 2020 203a 7061 7261 6d20 626f 6f6c  .    :param bool
+0000c6f0: 2075 7070 6572 5f63 6173 655f 7370 6563   upper_case_spec
+0000c700: 6961 6c3a 2077 6865 7468 6572 2074 6865  ial: whether the
+0000c710: 2073 7065 6369 616c 2073 796d 626f 6c73   special symbols
+0000c720: 2061 7265 2061 6c77 6179 7320 6d61 6465   are always made
+0000c730: 2075 7070 6572 2063 6173 650a 2020 2020   upper case.    
+0000c740: 3a70 6172 616d 2062 6f6f 6c20 776f 7264  :param bool word
+0000c750: 5f62 6173 6564 3a20 7768 6574 6865 7220  _based: whether 
+0000c760: 7765 2073 706c 6974 206f 6e20 7370 6163  we split on spac
+0000c770: 6520 616e 6420 7265 7475 726e 2066 756c  e and return ful
+0000c780: 6c20 776f 7264 730a 2020 2020 3a70 6172  l words.    :par
+0000c790: 616d 2062 6f6f 6c20 7371 7561 7265 5f62  am bool square_b
+0000c7a0: 7261 636b 6574 735f 666f 725f 7370 6563  rackets_for_spec
+0000c7b0: 6961 6c73 3a20 6861 6e64 6c65 2022 5b2e  ials: handle "[.
+0000c7c0: 2e2e 5d22 0a20 2020 203a 7274 7970 653a  ..]".    :rtype:
+0000c7d0: 206c 6973 745b 7374 725d 0a20 2020 2022   list[str].    "
+0000c7e0: 2222 0a20 2020 2072 6574 203d 205b 5d0a  "".    ret = [].
+0000c7f0: 2020 2020 696e 5f73 7065 6369 616c 203d      in_special =
+0000c800: 2030 0a20 2020 2066 6f72 2063 2069 6e20   0.    for c in 
+0000c810: 6f72 7468 6f67 7261 7068 793a 0a20 2020  orthography:.   
+0000c820: 2020 2020 2069 6620 696e 5f73 7065 6369       if in_speci
+0000c830: 616c 3a0a 2020 2020 2020 2020 2020 2020  al:.            
+0000c840: 6966 2063 203d 3d20 225b 223a 2020 2320  if c == "[":  # 
+0000c850: 7370 6563 6961 6c2d 7370 6563 6961 6c0a  special-special.
+0000c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c870: 696e 5f73 7065 6369 616c 202b 3d20 310a  in_special += 1.
+0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c890: 7265 745b 2d31 5d20 2b3d 2022 5b22 0a20  ret[-1] += "[". 
+0000c8a0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0000c8b0: 6320 3d3d 2022 5d22 3a0a 2020 2020 2020  c == "]":.      
+0000c8c0: 2020 2020 2020 2020 2020 696e 5f73 7065            in_spe
+0000c8d0: 6369 616c 202d 3d20 310a 2020 2020 2020  cial -= 1.      
+0000c8e0: 2020 2020 2020 2020 2020 7265 745b 2d31            ret[-1
+0000c8f0: 5d20 2b3d 2022 5d22 0a20 2020 2020 2020  ] += "]".       
+0000c900: 2020 2020 2065 6c69 6620 7570 7065 725f       elif upper_
+0000c910: 6361 7365 5f73 7065 6369 616c 3a0a 2020  case_special:.  
+0000c920: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000c930: 745b 2d31 5d20 2b3d 2063 2e75 7070 6572  t[-1] += c.upper
+0000c940: 2829 0a20 2020 2020 2020 2020 2020 2065  ().            e
+0000c950: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000c960: 2020 2020 2072 6574 5b2d 315d 202b 3d20       ret[-1] += 
+0000c970: 630a 2020 2020 2020 2020 656c 7365 3a20  c.        else: 
+0000c980: 2023 206e 6f74 2069 6e5f 7370 6563 6961   # not in_specia
+0000c990: 6c0a 2020 2020 2020 2020 2020 2020 6966  l.            if
+0000c9a0: 2073 7175 6172 655f 6272 6163 6b65 7473   square_brackets
+0000c9b0: 5f66 6f72 5f73 7065 6369 616c 7320 616e  _for_specials an
+0000c9c0: 6420 6320 3d3d 2022 5b22 3a0a 2020 2020  d c == "[":.    
+0000c9d0: 2020 2020 2020 2020 2020 2020 696e 5f73              in_s
+0000c9e0: 7065 6369 616c 203d 2031 0a20 2020 2020  pecial = 1.     
+0000c9f0: 2020 2020 2020 2020 2020 2072 6574 202b             ret +
+0000ca00: 3d20 5b22 5b22 5d0a 2020 2020 2020 2020  = ["["].        
+0000ca10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000ca20: 2020 2020 2020 2020 2020 6966 2077 6f72            if wor
+0000ca30: 645f 6261 7365 643a 0a20 2020 2020 2020  d_based:.       
+0000ca40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000ca50: 632e 6973 7370 6163 6528 293a 0a20 2020  c.isspace():.   
+0000ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca70: 2020 2020 2072 6574 202b 3d20 5b22 225d       ret += [""]
+0000ca80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ca90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cab0: 2020 2069 6620 6e6f 7420 7265 743a 0a20     if not ret:. 
 0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cad0: 2072 6574 202b 3d20 5b22 225d 0a20 2020   ret += [""].   
-0000cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000caf0: 2020 2020 2072 6574 5b2d 315d 202b 3d20       ret[-1] += 
-0000cb00: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
-0000cb10: 2020 656c 7365 3a20 2023 206e 6f74 2077    else:  # not w
-0000cb20: 6f72 645f 6261 7365 640a 2020 2020 2020  ord_based.      
-0000cb30: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000cb40: 7420 2b3d 2063 0a20 2020 2072 6574 7572  t += c.    retur
-0000cb50: 6e20 7265 740a 0a0a 6465 6620 7061 7273  n ret...def pars
-0000cb60: 655f 6f72 7468 6f67 7261 7068 7928 0a20  e_orthography(. 
-0000cb70: 2020 206f 7274 686f 6772 6170 6879 2c20     orthography, 
-0000cb80: 7072 6566 6978 3d28 292c 2070 6f73 7466  prefix=(), postf
-0000cb90: 6978 3d28 225b 454e 445d 222c 292c 2072  ix=("[END]",), r
-0000cba0: 656d 6f76 655f 6368 6172 733d 2228 297b  emove_chars="(){
-0000cbb0: 7d22 2c20 636f 6c6c 6170 7365 5f73 7061  }", collapse_spa
-0000cbc0: 6365 733d 5472 7565 2c20 6669 6e61 6c5f  ces=True, final_
-0000cbd0: 7374 7269 703d 5472 7565 2c20 2a2a 6b77  strip=True, **kw
-0000cbe0: 6172 6773 0a29 3a0a 2020 2020 2222 220a  args.):.    """.
-0000cbf0: 2020 2020 466f 7220 5370 6565 6368 2e20      For Speech. 
-0000cc00: 4675 6c6c 2070 726f 6365 7373 696e 672e  Full processing.
-0000cc10: 0a20 2020 2045 7861 6d70 6c65 3a0a 2020  .    Example:.  
-0000cc20: 2020 2020 6f72 7468 6f67 7261 7068 7920      orthography 
-0000cc30: 3d20 2268 656c 6c6f 205b 4845 5349 5441  = "hello [HESITA
-0000cc40: 5449 4f4e 5d20 7468 6572 6520 220a 2020  TION] there ".  
-0000cc50: 2020 2020 7769 7468 2077 6f72 645f 6261      with word_ba
-0000cc60: 7365 6420 3d3d 2046 616c 7365 3a20 7265  sed == False: re
-0000cc70: 7475 726e 7320 6c69 7374 2822 6865 6c6c  turns list("hell
-0000cc80: 6f20 2229 202b 205b 225b 4845 5349 5441  o ") + ["[HESITA
-0000cc90: 5449 4f4e 5d22 5d20 2b20 6c69 7374 2822  TION]"] + list("
-0000cca0: 2074 6865 7265 2229 202b 205b 225b 454e   there") + ["[EN
-0000ccb0: 445d 225d 0a20 2020 2020 2077 6974 6820  D]"].      with 
-0000ccc0: 776f 7264 5f62 6173 6564 203d 3d20 5472  word_based == Tr
-0000ccd0: 7565 3a20 7265 7475 726e 7320 5b22 6865  ue: returns ["he
-0000cce0: 6c6c 6f22 2c20 225b 4845 5349 5441 5449  llo", "[HESITATI
-0000ccf0: 4f4e 5d22 2c20 2274 6865 7265 222c 2022  ON]", "there", "
-0000cd00: 5b45 4e44 5d22 5d0a 2020 2020 446f 6573  [END]"].    Does
-0000cd10: 2073 6f6d 6520 7072 6570 726f 6365 7373   some preprocess
-0000cd20: 696e 6720 6f6e 206f 7274 686f 6772 6170  ing on orthograp
-0000cd30: 6879 2061 6e64 2074 6865 6e20 7061 7373  hy and then pass
-0000cd40: 6573 2069 7420 6f6e 2074 6f20 7061 7273  es it on to pars
-0000cd50: 655f 6f72 7468 6f67 7261 7068 795f 696e  e_orthography_in
-0000cd60: 746f 5f73 796d 626f 6c73 2829 2e0a 0a20  to_symbols()... 
-0000cd70: 2020 203a 7061 7261 6d20 7374 7220 6f72     :param str or
-0000cd80: 7468 6f67 7261 7068 793a 2065 2e67 2e20  thography: e.g. 
-0000cd90: 2268 656c 6c6f 205b 4845 5349 5441 5449  "hello [HESITATI
-0000cda0: 4f4e 5d20 7468 6572 6520 220a 2020 2020  ON] there ".    
-0000cdb0: 3a70 6172 616d 206c 6973 745b 7374 725d  :param list[str]
-0000cdc0: 2070 7265 6669 783a 2077 696c 6c20 6164   prefix: will ad
-0000cdd0: 6420 7468 6973 2070 7265 6669 780a 2020  d this prefix.  
-0000cde0: 2020 3a70 6172 616d 206c 6973 745b 7374    :param list[st
-0000cdf0: 725d 2070 6f73 7466 6978 3a20 7769 6c6c  r] postfix: will
-0000ce00: 2061 6464 2074 6869 7320 706f 7374 6669   add this postfi
-0000ce10: 780a 2020 2020 3a70 6172 616d 2073 7472  x.    :param str
-0000ce20: 2072 656d 6f76 655f 6368 6172 733a 2074   remove_chars: t
-0000ce30: 686f 7365 2063 6861 7273 2077 696c 6c20  hose chars will 
-0000ce40: 6a75 7374 2062 6520 7265 6d6f 7665 6420  just be removed 
-0000ce50: 6174 2074 6865 2062 6567 696e 6e69 6e67  at the beginning
-0000ce60: 0a20 2020 203a 7061 7261 6d20 626f 6f6c  .    :param bool
-0000ce70: 2063 6f6c 6c61 7073 655f 7370 6163 6573   collapse_spaces
-0000ce80: 3a20 7768 6574 6865 7220 6d75 6c74 6970  : whether multip
-0000ce90: 6c65 2073 7061 6365 7320 616e 6420 7461  le spaces and ta
-0000cea0: 6273 2061 7265 2063 6f6c 6c61 7073 6564  bs are collapsed
-0000ceb0: 2069 6e74 6f20 6120 7369 6e67 6c65 2073   into a single s
-0000cec0: 7061 6365 0a20 2020 203a 7061 7261 6d20  pace.    :param 
-0000ced0: 626f 6f6c 2066 696e 616c 5f73 7472 6970  bool final_strip
-0000cee0: 3a20 7768 6574 6865 7220 7765 2073 7472  : whether we str
-0000cef0: 6970 206c 6566 7420 616e 6420 7269 6768  ip left and righ
-0000cf00: 740a 2020 2020 3a70 6172 616d 206b 7761  t.    :param kwa
-0000cf10: 7267 733a 2070 6173 7365 6420 6f6e 2074  rgs: passed on t
-0000cf20: 6f20 7061 7273 655f 6f72 7468 6f67 7261  o parse_orthogra
-0000cf30: 7068 795f 696e 746f 5f73 796d 626f 6c73  phy_into_symbols
-0000cf40: 2829 0a20 2020 203a 7274 7970 653a 206c  ().    :rtype: l
-0000cf50: 6973 745b 7374 725d 0a20 2020 2022 2222  ist[str].    """
-0000cf60: 0a20 2020 2066 6f72 2063 2069 6e20 7265  .    for c in re
-0000cf70: 6d6f 7665 5f63 6861 7273 3a0a 2020 2020  move_chars:.    
-0000cf80: 2020 2020 6f72 7468 6f67 7261 7068 7920      orthography 
-0000cf90: 3d20 6f72 7468 6f67 7261 7068 792e 7265  = orthography.re
-0000cfa0: 706c 6163 6528 632c 2022 2229 0a20 2020  place(c, "").   
-0000cfb0: 2069 6620 636f 6c6c 6170 7365 5f73 7061   if collapse_spa
-0000cfc0: 6365 733a 0a20 2020 2020 2020 206f 7274  ces:.        ort
-0000cfd0: 686f 6772 6170 6879 203d 2022 2022 2e6a  hography = " ".j
-0000cfe0: 6f69 6e28 6f72 7468 6f67 7261 7068 792e  oin(orthography.
-0000cff0: 7370 6c69 7428 2929 0a20 2020 2069 6620  split()).    if 
-0000d000: 6669 6e61 6c5f 7374 7269 703a 0a20 2020  final_strip:.   
-0000d010: 2020 2020 206f 7274 686f 6772 6170 6879       orthography
-0000d020: 203d 206f 7274 686f 6772 6170 6879 2e73   = orthography.s
-0000d030: 7472 6970 2829 0a20 2020 2072 6574 7572  trip().    retur
-0000d040: 6e20 6c69 7374 2870 7265 6669 7829 202b  n list(prefix) +
-0000d050: 2070 6172 7365 5f6f 7274 686f 6772 6170   parse_orthograp
-0000d060: 6879 5f69 6e74 6f5f 7379 6d62 6f6c 7328  hy_into_symbols(
-0000d070: 6f72 7468 6f67 7261 7068 792c 202a 2a6b  orthography, **k
-0000d080: 7761 7267 7329 202b 206c 6973 7428 706f  wargs) + list(po
-0000d090: 7374 6669 7829 0a0a 0a64 6566 206a 736f  stfix)...def jso
-0000d0a0: 6e5f 7265 6d6f 7665 5f63 6f6d 6d65 6e74  n_remove_comment
-0000d0b0: 7328 7374 7269 6e67 2c20 7374 7269 705f  s(string, strip_
-0000d0c0: 7370 6163 653d 5472 7565 293a 0a20 2020  space=True):.   
-0000d0d0: 2022 2222 0a20 2020 203a 7479 7065 2073   """.    :type s
-0000d0e0: 7472 696e 673a 2073 7472 0a20 2020 203a  tring: str.    :
-0000d0f0: 7061 7261 6d20 626f 6f6c 2073 7472 6970  param bool strip
-0000d100: 5f73 7061 6365 3a0a 2020 2020 3a72 7479  _space:.    :rty
-0000d110: 7065 3a20 7374 720a 0a20 2020 2076 6961  pe: str..    via
-0000d120: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-0000d130: 636f 6d2f 6765 7469 6679 2f4a 534f 4e2e  com/getify/JSON.
-0000d140: 6d69 6e69 6679 2f62 6c6f 622f 6d61 7374  minify/blob/mast
-0000d150: 6572 2f6d 696e 6966 795f 6a73 6f6e 2e70  er/minify_json.p
-0000d160: 792c 0a20 2020 2062 7920 4765 7261 6c64  y,.    by Gerald
-0000d170: 2053 746f 7265 722c 2050 7261 6479 756e   Storer, Pradyun
-0000d180: 2053 2e20 4765 6461 6d2c 206d 6f64 6966   S. Gedam, modif
-0000d190: 6965 6420 6279 2075 732e 0a20 2020 2022  ied by us..    "
-0000d1a0: 2222 0a20 2020 2074 6f6b 656e 697a 6572  "".    tokenizer
-0000d1b0: 203d 2072 652e 636f 6d70 696c 6528 2722   = re.compile('"
-0000d1c0: 7c28 2f5c 5c2a 297c 285c 5c2a 2f29 7c28  |(/\\*)|(\\*/)|(
-0000d1d0: 2f2f 297c 5c6e 7c5c 7227 290a 2020 2020  //)|\n|\r').    
-0000d1e0: 656e 645f 736c 6173 6865 735f 7265 203d  end_slashes_re =
-0000d1f0: 2072 652e 636f 6d70 696c 6528 7222 285c   re.compile(r"(\
-0000d200: 5c29 2a24 2229 0a0a 2020 2020 696e 5f73  \)*$")..    in_s
-0000d210: 7472 696e 6720 3d20 4661 6c73 650a 2020  tring = False.  
-0000d220: 2020 696e 5f6d 756c 7469 203d 2046 616c    in_multi = Fal
-0000d230: 7365 0a20 2020 2069 6e5f 7369 6e67 6c65  se.    in_single
-0000d240: 203d 2046 616c 7365 0a0a 2020 2020 6e65   = False..    ne
-0000d250: 775f 7374 7220 3d20 5b5d 0a20 2020 2069  w_str = [].    i
-0000d260: 6e64 6578 203d 2030 0a0a 2020 2020 666f  ndex = 0..    fo
-0000d270: 7220 6d61 7463 6820 696e 2072 652e 6669  r match in re.fi
-0000d280: 6e64 6974 6572 2874 6f6b 656e 697a 6572  nditer(tokenizer
-0000d290: 2c20 7374 7269 6e67 293a 0a0a 2020 2020  , string):..    
-0000d2a0: 2020 2020 6966 206e 6f74 2028 696e 5f6d      if not (in_m
-0000d2b0: 756c 7469 206f 7220 696e 5f73 696e 676c  ulti or in_singl
-0000d2c0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0000d2d0: 746d 7020 3d20 7374 7269 6e67 5b69 6e64  tmp = string[ind
-0000d2e0: 6578 203a 206d 6174 6368 2e73 7461 7274  ex : match.start
-0000d2f0: 2829 5d0a 2020 2020 2020 2020 2020 2020  ()].            
-0000d300: 6966 206e 6f74 2069 6e5f 7374 7269 6e67  if not in_string
-0000d310: 2061 6e64 2073 7472 6970 5f73 7061 6365   and strip_space
-0000d320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d330: 2020 2320 7265 706c 6163 6520 7768 6974    # replace whit
-0000d340: 6520 7370 6163 6520 6173 2064 6566 696e  e space as defin
-0000d350: 6564 2069 6e20 7374 616e 6461 7264 0a20  ed in standard. 
-0000d360: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000d370: 6d70 203d 2072 652e 7375 6228 225b 205c  mp = re.sub("[ \
-0000d380: 745c 6e5c 725d 2b22 2c20 2222 2c20 746d  t\n\r]+", "", tm
-0000d390: 7029 0a20 2020 2020 2020 2020 2020 206e  p).            n
-0000d3a0: 6577 5f73 7472 2e61 7070 656e 6428 746d  ew_str.append(tm
-0000d3b0: 7029 0a0a 2020 2020 2020 2020 696e 6465  p)..        inde
-0000d3c0: 7820 3d20 6d61 7463 682e 656e 6428 290a  x = match.end().
-0000d3d0: 2020 2020 2020 2020 7661 6c20 3d20 6d61          val = ma
-0000d3e0: 7463 682e 6772 6f75 7028 290a 0a20 2020  tch.group()..   
-0000d3f0: 2020 2020 2069 6620 7661 6c20 3d3d 2027       if val == '
-0000d400: 2227 2061 6e64 206e 6f74 2028 696e 5f6d  "' and not (in_m
-0000d410: 756c 7469 206f 7220 696e 5f73 696e 676c  ulti or in_singl
-0000d420: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0000d430: 6573 6361 7065 6420 3d20 656e 645f 736c  escaped = end_sl
-0000d440: 6173 6865 735f 7265 2e73 6561 7263 6828  ashes_re.search(
-0000d450: 7374 7269 6e67 2c20 302c 206d 6174 6368  string, 0, match
-0000d460: 2e73 7461 7274 2829 290a 0a20 2020 2020  .start())..     
-0000d470: 2020 2020 2020 2023 2073 7461 7274 206f         # start o
-0000d480: 6620 7374 7269 6e67 206f 7220 756e 6573  f string or unes
-0000d490: 6361 7065 6420 7175 6f74 6520 6368 6172  caped quote char
-0000d4a0: 6163 7465 7220 746f 2065 6e64 2073 7472  acter to end str
-0000d4b0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-0000d4c0: 6966 206e 6f74 2069 6e5f 7374 7269 6e67  if not in_string
-0000d4d0: 206f 7220 2865 7363 6170 6564 2069 7320   or (escaped is 
-0000d4e0: 4e6f 6e65 206f 7220 6c65 6e28 6573 6361  None or len(esca
-0000d4f0: 7065 642e 6772 6f75 7028 2929 2025 2032  ped.group()) % 2
-0000d500: 203d 3d20 3029 3a0a 2020 2020 2020 2020   == 0):.        
-0000d510: 2020 2020 2020 2020 696e 5f73 7472 696e          in_strin
-0000d520: 6720 3d20 6e6f 7420 696e 5f73 7472 696e  g = not in_strin
-0000d530: 670a 2020 2020 2020 2020 2020 2020 696e  g.            in
-0000d540: 6465 7820 2d3d 2031 2020 2320 696e 636c  dex -= 1  # incl
-0000d550: 7564 6520 2220 6368 6172 6163 7465 7220  ude " character 
-0000d560: 696e 206e 6578 7420 6361 7463 680a 2020  in next catch.  
-0000d570: 2020 2020 2020 656c 6966 206e 6f74 2028        elif not (
-0000d580: 696e 5f73 7472 696e 6720 6f72 2069 6e5f  in_string or in_
-0000d590: 6d75 6c74 6920 6f72 2069 6e5f 7369 6e67  multi or in_sing
-0000d5a0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-0000d5b0: 2069 6620 7661 6c20 3d3d 2022 2f2a 223a   if val == "/*":
-0000d5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d5d0: 2069 6e5f 6d75 6c74 6920 3d20 5472 7565   in_multi = True
-0000d5e0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0000d5f0: 6620 7661 6c20 3d3d 2022 2f2f 223a 0a20  f val == "//":. 
-0000d600: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000d610: 6e5f 7369 6e67 6c65 203d 2054 7275 650a  n_single = True.
-0000d620: 2020 2020 2020 2020 656c 6966 2076 616c          elif val
-0000d630: 203d 3d20 222a 2f22 2061 6e64 2069 6e5f   == "*/" and in_
-0000d640: 6d75 6c74 6920 616e 6420 6e6f 7420 2869  multi and not (i
-0000d650: 6e5f 7374 7269 6e67 206f 7220 696e 5f73  n_string or in_s
-0000d660: 696e 676c 6529 3a0a 2020 2020 2020 2020  ingle):.        
-0000d670: 2020 2020 696e 5f6d 756c 7469 203d 2046      in_multi = F
-0000d680: 616c 7365 0a20 2020 2020 2020 2065 6c69  alse.        eli
-0000d690: 6620 7661 6c20 696e 2022 5c72 5c6e 2220  f val in "\r\n" 
-0000d6a0: 616e 6420 6e6f 7420 2869 6e5f 6d75 6c74  and not (in_mult
-0000d6b0: 6920 6f72 2069 6e5f 7374 7269 6e67 2920  i or in_string) 
-0000d6c0: 616e 6420 696e 5f73 696e 676c 653a 0a20  and in_single:. 
-0000d6d0: 2020 2020 2020 2020 2020 2069 6e5f 7369             in_si
-0000d6e0: 6e67 6c65 203d 2046 616c 7365 0a20 2020  ngle = False.   
-0000d6f0: 2020 2020 2065 6c69 6620 6e6f 7420 2828       elif not ((
-0000d700: 696e 5f6d 756c 7469 206f 7220 696e 5f73  in_multi or in_s
-0000d710: 696e 676c 6529 206f 7220 2876 616c 2069  ingle) or (val i
-0000d720: 6e20 2220 5c72 5c6e 5c74 2220 616e 6420  n " \r\n\t" and 
-0000d730: 7374 7269 705f 7370 6163 6529 293a 0a20  strip_space)):. 
-0000d740: 2020 2020 2020 2020 2020 206e 6577 5f73             new_s
-0000d750: 7472 2e61 7070 656e 6428 7661 6c29 0a0a  tr.append(val)..
-0000d760: 2020 2020 6e65 775f 7374 722e 6170 7065      new_str.appe
-0000d770: 6e64 2873 7472 696e 675b 696e 6465 783a  nd(string[index:
-0000d780: 5d29 0a20 2020 2072 6574 7572 6e20 2222  ]).    return ""
-0000d790: 2e6a 6f69 6e28 6e65 775f 7374 7229 0a0a  .join(new_str)..
-0000d7a0: 0a64 6566 205f 7079 325f 756e 6963 6f64  .def _py2_unicod
-0000d7b0: 655f 746f 5f73 7472 5f72 6563 7572 7369  e_to_str_recursi
-0000d7c0: 7665 2873 293a 0a20 2020 2022 2222 0a20  ve(s):.    """. 
-0000d7d0: 2020 2054 6869 7320 6973 2073 7570 706f     This is suppo
-0000d7e0: 7365 6420 746f 2062 6520 7275 6e20 7769  sed to be run wi
-0000d7f0: 7468 2050 7974 686f 6e20 322e 0a20 2020  th Python 2..   
-0000d800: 2041 6c73 6f20 7365 6520 3a66 756e 633a   Also see :func:
-0000d810: 6061 735f 7374 7260 2061 6e64 203a 6675  `as_str` and :fu
-0000d820: 6e63 3a60 7079 325f 7574 6638 5f73 7472  nc:`py2_utf8_str
-0000d830: 5f74 6f5f 756e 6963 6f64 6560 2e0a 0a20  _to_unicode`... 
-0000d840: 2020 203a 7061 7261 6d20 7374 727c 756e     :param str|un
-0000d850: 6963 6f64 6520 733a 206f 7220 616e 7920  icode s: or any 
-0000d860: 7265 6375 7273 6976 6520 7374 7275 6374  recursive struct
-0000d870: 7572 6520 7375 6368 2061 7320 6469 6374  ure such as dict
-0000d880: 2c20 6c69 7374 2c20 7475 706c 650a 2020  , list, tuple.  
-0000d890: 2020 3a72 6574 7572 6e3a 2050 7974 686f    :return: Pytho
-0000d8a0: 6e20 3220 7374 7220 2869 7320 6c69 6b65  n 2 str (is like
-0000d8b0: 2050 7974 686f 6e20 3320 5554 462d 3820   Python 3 UTF-8 
-0000d8c0: 666f 726d 6174 7465 6420 6279 7465 7329  formatted bytes)
-0000d8d0: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
-0000d8e0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-0000d8f0: 6973 696e 7374 616e 6365 2873 2c20 6469  isinstance(s, di
-0000d900: 6374 293a 0a20 2020 2020 2020 2072 6574  ct):.        ret
-0000d910: 7572 6e20 7b5f 7079 325f 756e 6963 6f64  urn {_py2_unicod
-0000d920: 655f 746f 5f73 7472 5f72 6563 7572 7369  e_to_str_recursi
-0000d930: 7665 286b 6579 293a 205f 7079 325f 756e  ve(key): _py2_un
-0000d940: 6963 6f64 655f 746f 5f73 7472 5f72 6563  icode_to_str_rec
-0000d950: 7572 7369 7665 2876 616c 7565 2920 666f  ursive(value) fo
-0000d960: 7220 6b65 792c 2076 616c 7565 2069 6e20  r key, value in 
-0000d970: 732e 6974 656d 7328 297d 0a20 2020 2065  s.items()}.    e
-0000d980: 6c69 6620 6973 696e 7374 616e 6365 2873  lif isinstance(s
-0000d990: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
-0000d9a0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000d9b0: 206d 616b 655f 7365 715f 6f66 5f74 7970   make_seq_of_typ
-0000d9c0: 6528 7479 7065 2873 292c 205b 5f70 7932  e(type(s), [_py2
-0000d9d0: 5f75 6e69 636f 6465 5f74 6f5f 7374 725f  _unicode_to_str_
-0000d9e0: 7265 6375 7273 6976 6528 656c 656d 656e  recursive(elemen
-0000d9f0: 7429 2066 6f72 2065 6c65 6d65 6e74 2069  t) for element i
-0000da00: 6e20 735d 290a 2020 2020 656c 6966 2069  n s]).    elif i
-0000da10: 7369 6e73 7461 6e63 6528 732c 2075 6e69  sinstance(s, uni
-0000da20: 636f 6465 293a 0a20 2020 2020 2020 2072  code):.        r
-0000da30: 6574 7572 6e20 732e 656e 636f 6465 2822  eturn s.encode("
-0000da40: 7574 662d 3822 2920 2023 2050 7974 686f  utf-8")  # Pytho
-0000da50: 6e20 3220 7374 722c 2050 7974 686f 6e20  n 2 str, Python 
-0000da60: 3320 6279 7465 730a 2020 2020 656c 7365  3 bytes.    else
-0000da70: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000da80: 2073 0a0a 0a64 6566 206c 6f61 645f 6a73   s...def load_js
-0000da90: 6f6e 2866 696c 656e 616d 653d 4e6f 6e65  on(filename=None
-0000daa0: 2c20 636f 6e74 656e 743d 4e6f 6e65 293a  , content=None):
-0000dab0: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
-0000dac0: 7261 6d20 7374 727c 4e6f 6e65 2066 696c  ram str|None fil
-0000dad0: 656e 616d 653a 0a20 2020 203a 7061 7261  ename:.    :para
-0000dae0: 6d20 7374 727c 4e6f 6e65 2063 6f6e 7465  m str|None conte
-0000daf0: 6e74 3a0a 2020 2020 3a72 7479 7065 3a20  nt:.    :rtype: 
-0000db00: 6469 6374 5b73 7472 5d0a 2020 2020 2222  dict[str].    ""
-0000db10: 220a 2020 2020 6966 2063 6f6e 7465 6e74  ".    if content
-0000db20: 3a0a 2020 2020 2020 2020 6173 7365 7274  :.        assert
-0000db30: 206e 6f74 2066 696c 656e 616d 650a 2020   not filename.  
-0000db40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000db50: 636f 6e74 656e 7420 3d20 6f70 656e 2866  content = open(f
-0000db60: 696c 656e 616d 6529 2e72 6561 6428 290a  ilename).read().
-0000db70: 2020 2020 696d 706f 7274 206a 736f 6e0a      import json.
-0000db80: 0a20 2020 2063 6f6e 7465 6e74 203d 206a  .    content = j
-0000db90: 736f 6e5f 7265 6d6f 7665 5f63 6f6d 6d65  son_remove_comme
-0000dba0: 6e74 7328 636f 6e74 656e 7429 0a20 2020  nts(content).   
-0000dbb0: 2074 7279 3a0a 2020 2020 2020 2020 6a73   try:.        js
-0000dbc0: 6f6e 5f63 6f6e 7465 6e74 203d 206a 736f  on_content = jso
-0000dbd0: 6e2e 6c6f 6164 7328 636f 6e74 656e 7429  n.loads(content)
-0000dbe0: 0a20 2020 2065 7863 6570 7420 5661 6c75  .    except Valu
-0000dbf0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-0000dc00: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-0000dc10: 7469 6f6e 2822 636f 6e66 6967 206c 6f6f  tion("config loo
-0000dc20: 6b73 206c 696b 6520 4a53 4f4e 2062 7574  ks like JSON but
-0000dc30: 2069 6e76 616c 6964 206a 736f 6e20 636f   invalid json co
-0000dc40: 6e74 656e 742c 2025 7222 2025 2065 290a  ntent, %r" % e).
-0000dc50: 2020 2020 6966 206e 6f74 2050 5933 3a0a      if not PY3:.
-0000dc60: 2020 2020 2020 2020 6a73 6f6e 5f63 6f6e          json_con
-0000dc70: 7465 6e74 203d 205f 7079 325f 756e 6963  tent = _py2_unic
-0000dc80: 6f64 655f 746f 5f73 7472 5f72 6563 7572  ode_to_str_recur
-0000dc90: 7369 7665 286a 736f 6e5f 636f 6e74 656e  sive(json_conten
-0000dca0: 7429 0a20 2020 2072 6574 7572 6e20 6a73  t).    return js
-0000dcb0: 6f6e 5f63 6f6e 7465 6e74 0a0a 0a63 6c61  on_content...cla
-0000dcc0: 7373 204e 756d 6265 7273 4469 6374 3a0a  ss NumbersDict:.
-0000dcd0: 2020 2020 2222 220a 2020 2020 4974 2773      """.    It's
-0000dce0: 206d 6f73 746c 7920 6c69 6b65 2064 6963   mostly like dic
-0000dcf0: 745b 7374 722c 666c 6f61 747c 696e 745d  t[str,float|int]
-0000dd00: 2026 2073 6f6d 6520 6f70 7469 6f6e 616c   & some optional
-0000dd10: 2062 726f 6164 6361 7374 2064 6566 6175   broadcast defau
-0000dd20: 6c74 2076 616c 7565 2e0a 2020 2020 4974  lt value..    It
-0000dd30: 2069 6d70 6c65 6d65 6e74 7320 7468 6520   implements the 
-0000dd40: 7374 616e 6461 7264 206d 6174 6820 6269  standard math bi
-0000dd50: 6e20 6f70 7320 696e 2061 2073 7472 6169  n ops in a strai
-0000dd60: 6768 742d 666f 7277 6172 6420 7761 792e  ght-forward way.
-0000dd70: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-0000dd80: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0000dd90: 2061 7574 6f5f 636f 6e76 6572 743d 4e6f   auto_convert=No
-0000dda0: 6e65 2c20 6e75 6d62 6572 735f 6469 6374  ne, numbers_dict
-0000ddb0: 3d4e 6f6e 652c 2062 726f 6164 6361 7374  =None, broadcast
-0000ddc0: 5f76 616c 7565 3d4e 6f6e 6529 3a0a 2020  _value=None):.  
-0000ddd0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000dde0: 2020 3a70 6172 616d 2064 6963 747c 4e75    :param dict|Nu
-0000ddf0: 6d62 6572 7344 6963 747c 5420 6175 746f  mbersDict|T auto
-0000de00: 5f63 6f6e 7665 7274 3a20 6669 7273 7420  _convert: first 
-0000de10: 6172 6775 6d65 6e74 2c20 736f 2074 6861  argument, so tha
-0000de20: 7420 7765 2063 616e 2061 7574 6f6d 6174  t we can automat
-0000de30: 6963 616c 6c79 2063 6f6e 7665 7274 2f63  ically convert/c
-0000de40: 6f70 790a 2020 2020 2020 2020 3a70 6172  opy.        :par
-0000de50: 616d 2064 6963 7420 6e75 6d62 6572 735f  am dict numbers_
-0000de60: 6469 6374 3a0a 2020 2020 2020 2020 3a70  dict:.        :p
-0000de70: 6172 616d 2054 2062 726f 6164 6361 7374  aram T broadcast
-0000de80: 5f76 616c 7565 3a0a 2020 2020 2020 2020  _value:.        
-0000de90: 2222 220a 2020 2020 2020 2020 6966 2061  """.        if a
-0000dea0: 7574 6f5f 636f 6e76 6572 7420 6973 206e  uto_convert is n
-0000deb0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000dec0: 2020 2020 2061 7373 6572 7420 6272 6f61       assert broa
-0000ded0: 6463 6173 745f 7661 6c75 6520 6973 204e  dcast_value is N
-0000dee0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0000def0: 6173 7365 7274 206e 756d 6265 7273 5f64  assert numbers_d
-0000df00: 6963 7420 6973 204e 6f6e 650a 2020 2020  ict is None.    
-0000df10: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0000df20: 7461 6e63 6528 6175 746f 5f63 6f6e 7665  tance(auto_conve
-0000df30: 7274 2c20 6469 6374 293a 0a20 2020 2020  rt, dict):.     
-0000df40: 2020 2020 2020 2020 2020 206e 756d 6265             numbe
-0000df50: 7273 5f64 6963 7420 3d20 6175 746f 5f63  rs_dict = auto_c
-0000df60: 6f6e 7665 7274 0a20 2020 2020 2020 2020  onvert.         
-0000df70: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0000df80: 6365 2861 7574 6f5f 636f 6e76 6572 742c  ce(auto_convert,
-0000df90: 204e 756d 6265 7273 4469 6374 293a 0a20   NumbersDict):. 
-0000dfa0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000dfb0: 756d 6265 7273 5f64 6963 7420 3d20 6175  umbers_dict = au
-0000dfc0: 746f 5f63 6f6e 7665 7274 2e64 6963 740a  to_convert.dict.
-0000dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfe0: 6272 6f61 6463 6173 745f 7661 6c75 6520  broadcast_value 
-0000dff0: 3d20 6175 746f 5f63 6f6e 7665 7274 2e76  = auto_convert.v
-0000e000: 616c 7565 0a20 2020 2020 2020 2020 2020  alue.           
-0000e010: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000e020: 2020 2020 2020 2062 726f 6164 6361 7374         broadcast
-0000e030: 5f76 616c 7565 203d 2061 7574 6f5f 636f  _value = auto_co
-0000e040: 6e76 6572 740a 2020 2020 2020 2020 6966  nvert.        if
-0000e050: 206e 756d 6265 7273 5f64 6963 7420 6973   numbers_dict is
-0000e060: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000e070: 2020 206e 756d 6265 7273 5f64 6963 7420     numbers_dict 
-0000e080: 3d20 7b7d 0a20 2020 2020 2020 2065 6c73  = {}.        els
-0000e090: 653a 0a20 2020 2020 2020 2020 2020 206e  e:.            n
-0000e0a0: 756d 6265 7273 5f64 6963 7420 3d20 6469  umbers_dict = di
-0000e0b0: 6374 286e 756d 6265 7273 5f64 6963 7429  ct(numbers_dict)
-0000e0c0: 2020 2320 666f 7263 6520 636f 7079 0a0a    # force copy..
-0000e0d0: 2020 2020 2020 2020 7365 6c66 2e64 6963          self.dic
-0000e0e0: 7420 3d20 6e75 6d62 6572 735f 6469 6374  t = numbers_dict
-0000e0f0: 0a20 2020 2020 2020 2073 656c 662e 7661  .        self.va
-0000e100: 6c75 6520 3d20 6272 6f61 6463 6173 745f  lue = broadcast_
-0000e110: 7661 6c75 650a 2020 2020 2020 2020 7365  value.        se
-0000e120: 6c66 2e6d 6178 203d 2073 656c 662e 5f6d  lf.max = self._m
-0000e130: 6178 5f65 7272 6f72 0a0a 2020 2020 6465  ax_error..    de
-0000e140: 6620 636f 7079 2873 656c 6629 3a0a 2020  f copy(self):.  
-0000e150: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000e160: 2020 3a72 7479 7065 3a20 4e75 6d62 6572    :rtype: Number
-0000e170: 7344 6963 740a 2020 2020 2020 2020 2222  sDict.        ""
-0000e180: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0000e190: 204e 756d 6265 7273 4469 6374 2873 656c   NumbersDict(sel
-0000e1a0: 6629 0a0a 2020 2020 4063 6c61 7373 6d65  f)..    @classme
-0000e1b0: 7468 6f64 0a20 2020 2064 6566 2063 6f6e  thod.    def con
-0000e1c0: 7374 616e 745f 6c69 6b65 2863 6c73 2c20  stant_like(cls, 
-0000e1d0: 636f 6e73 745f 6e75 6d62 6572 2c20 6e75  const_number, nu
-0000e1e0: 6d62 6572 735f 6469 6374 293a 0a20 2020  mbers_dict):.   
-0000e1f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000e200: 203a 7061 7261 6d20 696e 747c 666c 6f61   :param int|floa
-0000e210: 747c 6f62 6a65 6374 2063 6f6e 7374 5f6e  t|object const_n
-0000e220: 756d 6265 723a 0a20 2020 2020 2020 203a  umber:.        :
-0000e230: 7061 7261 6d20 4e75 6d62 6572 7344 6963  param NumbersDic
-0000e240: 7420 6e75 6d62 6572 735f 6469 6374 3a0a  t numbers_dict:.
-0000e250: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0000e260: 204e 756d 6265 7273 4469 6374 2077 6974   NumbersDict wit
-0000e270: 6820 7361 6d65 206b 6579 7320 6173 206e  h same keys as n
-0000e280: 756d 6265 7273 5f64 6963 740a 2020 2020  umbers_dict.    
-0000e290: 2020 2020 3a72 7479 7065 3a20 4e75 6d62      :rtype: Numb
-0000e2a0: 6572 7344 6963 740a 2020 2020 2020 2020  ersDict.        
-0000e2b0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0000e2c0: 726e 204e 756d 6265 7273 4469 6374 280a  rn NumbersDict(.
-0000e2d0: 2020 2020 2020 2020 2020 2020 6272 6f61              broa
-0000e2e0: 6463 6173 745f 7661 6c75 653d 636f 6e73  dcast_value=cons
-0000e2f0: 745f 6e75 6d62 6572 2069 6620 286e 756d  t_number if (num
-0000e300: 6265 7273 5f64 6963 742e 7661 6c75 6520  bers_dict.value 
-0000e310: 6973 206e 6f74 204e 6f6e 6529 2065 6c73  is not None) els
-0000e320: 6520 4e6f 6e65 2c0a 2020 2020 2020 2020  e None,.        
-0000e330: 2020 2020 6e75 6d62 6572 735f 6469 6374      numbers_dict
-0000e340: 3d7b 6b3a 2063 6f6e 7374 5f6e 756d 6265  ={k: const_numbe
-0000e350: 7220 666f 7220 6b20 696e 206e 756d 6265  r for k in numbe
-0000e360: 7273 5f64 6963 742e 6469 6374 2e6b 6579  rs_dict.dict.key
-0000e370: 7328 297d 2c0a 2020 2020 2020 2020 290a  s()},.        ).
-0000e380: 0a20 2020 2064 6566 2063 6f70 795f 6c69  .    def copy_li
-0000e390: 6b65 2873 656c 662c 206e 756d 6265 7273  ke(self, numbers
-0000e3a0: 5f64 6963 7429 3a0a 2020 2020 2020 2020  _dict):.        
-0000e3b0: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
-0000e3c0: 616d 204e 756d 6265 7273 4469 6374 206e  am NumbersDict n
-0000e3d0: 756d 6265 7273 5f64 6963 743a 0a20 2020  umbers_dict:.   
-0000e3e0: 2020 2020 203a 7265 7475 726e 3a20 636f       :return: co
-0000e3f0: 7079 206f 6620 7365 6c66 2077 6974 6820  py of self with 
-0000e400: 7361 6d65 206b 6579 7320 6173 206e 756d  same keys as num
-0000e410: 6265 7273 5f64 6963 7420 6173 2066 6172  bers_dict as far
-0000e420: 2061 7320 7765 2068 6176 6520 7468 656d   as we have them
-0000e430: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0000e440: 204e 756d 6265 7273 4469 6374 0a20 2020   NumbersDict.   
-0000e450: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000e460: 2069 6620 7365 6c66 2e76 616c 7565 2069   if self.value i
-0000e470: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000e480: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0000e490: 756d 6265 7273 4469 6374 280a 2020 2020  umbersDict(.    
-0000e4a0: 2020 2020 2020 2020 2020 2020 6272 6f61              broa
-0000e4b0: 6463 6173 745f 7661 6c75 653d 7365 6c66  dcast_value=self
-0000e4c0: 2e76 616c 7565 2069 6620 286e 756d 6265  .value if (numbe
-0000e4d0: 7273 5f64 6963 742e 7661 6c75 6520 6973  rs_dict.value is
-0000e4e0: 206e 6f74 204e 6f6e 6529 2065 6c73 6520   not None) else 
-0000e4f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-0000e500: 2020 2020 2020 6e75 6d62 6572 735f 6469        numbers_di
-0000e510: 6374 3d7b 6b3a 2073 656c 665b 6b5d 2066  ct={k: self[k] f
-0000e520: 6f72 206b 2069 6e20 6e75 6d62 6572 735f  or k in numbers_
-0000e530: 6469 6374 2e64 6963 742e 6b65 7973 2829  dict.dict.keys()
-0000e540: 7d2c 0a20 2020 2020 2020 2020 2020 2029  },.            )
-0000e550: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000e560: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000e570: 6e20 4e75 6d62 6572 7344 6963 7428 0a20  n NumbersDict(. 
-0000e580: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000e590: 726f 6164 6361 7374 5f76 616c 7565 3d4e  roadcast_value=N
-0000e5a0: 6f6e 652c 206e 756d 6265 7273 5f64 6963  one, numbers_dic
-0000e5b0: 743d 7b6b 3a20 7365 6c66 5b6b 5d20 666f  t={k: self[k] fo
-0000e5c0: 7220 6b20 696e 206e 756d 6265 7273 5f64  r k in numbers_d
-0000e5d0: 6963 742e 6469 6374 2e6b 6579 7328 2920  ict.dict.keys() 
-0000e5e0: 6966 206b 2069 6e20 7365 6c66 2e64 6963  if k in self.dic
-0000e5f0: 747d 0a20 2020 2020 2020 2020 2020 2029  t}.            )
-0000e600: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-0000e610: 2020 2020 6465 6620 6b65 7973 5f73 6574      def keys_set
-0000e620: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000e630: 2222 220a 2020 2020 2020 2020 3a72 7479  """.        :rty
-0000e640: 7065 3a20 7365 745b 7374 725d 0a20 2020  pe: set[str].   
-0000e650: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000e660: 2072 6574 7572 6e20 7365 7428 7365 6c66   return set(self
-0000e670: 2e64 6963 742e 6b65 7973 2829 290a 0a20  .dict.keys()).. 
-0000e680: 2020 2064 6566 205f 5f67 6574 6974 656d     def __getitem
-0000e690: 5f5f 2873 656c 662c 206b 6579 293a 0a20  __(self, key):. 
-0000e6a0: 2020 2020 2020 2069 6620 7365 6c66 2e76         if self.v
-0000e6b0: 616c 7565 2069 7320 6e6f 7420 4e6f 6e65  alue is not None
-0000e6c0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000e6d0: 7475 726e 2073 656c 662e 6469 6374 2e67  turn self.dict.g
-0000e6e0: 6574 286b 6579 2c20 7365 6c66 2e76 616c  et(key, self.val
-0000e6f0: 7565 290a 2020 2020 2020 2020 7265 7475  ue).        retu
-0000e700: 726e 2073 656c 662e 6469 6374 5b6b 6579  rn self.dict[key
-0000e710: 5d0a 0a20 2020 2064 6566 205f 5f73 6574  ]..    def __set
-0000e720: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
-0000e730: 2c20 7661 6c75 6529 3a0a 2020 2020 2020  , value):.      
-0000e740: 2020 7365 6c66 2e64 6963 745b 6b65 795d    self.dict[key]
-0000e750: 203d 2076 616c 7565 0a0a 2020 2020 6465   = value..    de
-0000e760: 6620 5f5f 6465 6c69 7465 6d5f 5f28 7365  f __delitem__(se
-0000e770: 6c66 2c20 6b65 7929 3a0a 2020 2020 2020  lf, key):.      
-0000e780: 2020 6465 6c20 7365 6c66 2e64 6963 745b    del self.dict[
-0000e790: 6b65 795d 0a0a 2020 2020 6465 6620 6765  key]..    def ge
-0000e7a0: 7428 7365 6c66 2c20 6b65 792c 2064 6566  t(self, key, def
-0000e7b0: 6175 6c74 3d4e 6f6e 6529 3a0a 2020 2020  ault=None):.    
-0000e7c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000e7d0: 3a70 6172 616d 2073 7472 206b 6579 3a0a  :param str key:.
-0000e7e0: 2020 2020 2020 2020 3a70 6172 616d 2054          :param T
-0000e7f0: 2064 6566 6175 6c74 3a0a 2020 2020 2020   default:.      
-0000e800: 2020 3a72 7479 7065 3a20 6f62 6a65 6374    :rtype: object
-0000e810: 7c54 0a20 2020 2020 2020 2022 2222 0a20  |T.        """. 
-0000e820: 2020 2020 2020 2023 204b 6565 7020 636f         # Keep co
-0000e830: 6e73 6973 7465 6e74 2077 6974 6820 7365  nsistent with se
-0000e840: 6c66 2e5f 5f67 6574 5f69 7465 6d5f 5f2e  lf.__get_item__.
-0000e850: 2049 6620 7365 6c66 2e76 616c 7565 2069   If self.value i
-0000e860: 7320 7365 742c 2074 6869 7320 7769 6c6c  s set, this will
-0000e870: 2061 6c77 6179 7320 6265 2074 6865 2064   always be the d
-0000e880: 6566 6175 6c74 2076 616c 7565 2e0a 2020  efault value..  
-0000e890: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000e8a0: 662e 6469 6374 2e67 6574 286b 6579 2c20  f.dict.get(key, 
-0000e8b0: 7365 6c66 2e76 616c 7565 2069 6620 7365  self.value if se
-0000e8c0: 6c66 2e76 616c 7565 2069 7320 6e6f 7420  lf.value is not 
-0000e8d0: 4e6f 6e65 2065 6c73 6520 6465 6661 756c  None else defaul
-0000e8e0: 7429 0a0a 2020 2020 6465 6620 706f 7028  t)..    def pop(
-0000e8f0: 7365 6c66 2c20 6b65 792c 202a 6172 6773  self, key, *args
-0000e900: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0000e910: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-0000e920: 7220 6b65 793a 0a20 2020 2020 2020 203a  r key:.        :
-0000e930: 7061 7261 6d20 5420 6172 6773 3a20 6465  param T args: de
-0000e940: 6661 756c 742c 206f 7220 6e6f 740a 2020  fault, or not.  
-0000e950: 2020 2020 2020 3a72 7479 7065 3a20 6f62        :rtype: ob
-0000e960: 6a65 6374 7c54 0a20 2020 2020 2020 2022  ject|T.        "
-0000e970: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0000e980: 6e20 7365 6c66 2e64 6963 742e 706f 7028  n self.dict.pop(
-0000e990: 6b65 792c 202a 6172 6773 290a 0a20 2020  key, *args)..   
-0000e9a0: 2064 6566 205f 5f69 7465 725f 5f28 7365   def __iter__(se
-0000e9b0: 6c66 293a 0a20 2020 2020 2020 2023 2054  lf):.        # T
-0000e9c0: 6869 7320 6361 6e20 706f 7465 6e74 6961  his can potentia
-0000e9d0: 6c6c 7920 6361 7573 6520 636f 6e66 7573  lly cause confus
-0000e9e0: 696f 6e2e 2053 6f20 656e 666f 7263 6520  ion. So enforce 
-0000e9f0: 6578 706c 6963 6974 6e65 7373 2e0a 2020  explicitness..  
-0000ea00: 2020 2020 2020 2320 466f 7220 6120 6469        # For a di
-0000ea10: 6374 2c20 7765 2077 6f75 6c64 2072 6574  ct, we would ret
-0000ea20: 7572 6e20 7468 6520 6469 6374 206b 6579  urn the dict key
-0000ea30: 7320 6865 7265 2e0a 2020 2020 2020 2020  s here..        
-0000ea40: 2320 416c 736f 2c20 6d61 7828 7365 6c66  # Also, max(self
-0000ea50: 2920 776f 756c 6420 7265 7375 6c74 2069  ) would result i
-0000ea60: 6e20 6120 6361 6c6c 2074 6f20 7365 6c66  n a call to self
-0000ea70: 2e5f 5f69 7465 725f 5f28 292c 0a20 2020  .__iter__(),.   
-0000ea80: 2020 2020 2023 2077 6869 6368 2077 6f75       # which wou
-0000ea90: 6c64 206f 6e6c 7920 6d61 6b65 2073 656e  ld only make sen
-0000eaa0: 7365 2066 6f72 206f 7572 2076 616c 7565  se for our value
-0000eab0: 732c 206e 6f74 2074 6865 2064 6963 7420  s, not the dict 
-0000eac0: 6b65 7973 2e0a 2020 2020 2020 2020 7261  keys..        ra
-0000ead0: 6973 6520 4578 6365 7074 696f 6e28 2225  ise Exception("%
-0000eae0: 732e 5f5f 6974 6572 5f5f 2069 7320 756e  s.__iter__ is un
-0000eaf0: 6465 6669 6e65 6422 2025 2073 656c 662e  defined" % self.
-0000eb00: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0000eb10: 5f5f 290a 0a20 2020 2064 6566 206b 6579  __)..    def key
-0000eb20: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-0000eb30: 2022 2222 0a20 2020 2020 2020 203a 7274   """.        :rt
-0000eb40: 7970 653a 2073 6574 5b73 7472 5d0a 2020  ype: set[str].  
-0000eb50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000eb60: 2020 7265 7475 726e 2073 656c 662e 6469    return self.di
-0000eb70: 6374 2e6b 6579 7328 290a 0a20 2020 2064  ct.keys()..    d
-0000eb80: 6566 2076 616c 7565 7328 7365 6c66 293a  ef values(self):
-0000eb90: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000eba0: 2020 2020 203a 7274 7970 653a 206c 6973       :rtype: lis
-0000ebb0: 745b 6f62 6a65 6374 5d0a 2020 2020 2020  t[object].      
-0000ebc0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-0000ebd0: 7475 726e 206c 6973 7428 7365 6c66 2e64  turn list(self.d
-0000ebe0: 6963 742e 7661 6c75 6573 2829 2920 2b20  ict.values()) + 
-0000ebf0: 285b 7365 6c66 2e76 616c 7565 5d20 6966  ([self.value] if
-0000ec00: 2073 656c 662e 7661 6c75 6520 6973 206e   self.value is n
-0000ec10: 6f74 204e 6f6e 6520 656c 7365 205b 5d29  ot None else [])
-0000ec20: 0a0a 2020 2020 6465 6620 6974 656d 7328  ..    def items(
-0000ec30: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0000ec40: 2222 0a20 2020 2020 2020 203a 7265 7475  "".        :retu
-0000ec50: 726e 3a20 6469 6374 2069 7465 6d73 2e20  rn: dict items. 
-0000ec60: 7468 6973 2065 7863 6c75 6465 7320 7365  this excludes se
-0000ec70: 6c66 2e76 616c 7565 0a20 2020 2020 2020  lf.value.       
-0000ec80: 203a 7274 7970 653a 2073 7472 5b28 7374   :rtype: str[(st
-0000ec90: 722c 6f62 6a65 6374 295d 0a20 2020 2020  r,object)].     
-0000eca0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0000ecb0: 6574 7572 6e20 7365 6c66 2e64 6963 742e  eturn self.dict.
-0000ecc0: 6974 656d 7328 290a 0a20 2020 2064 6566  items()..    def
-0000ecd0: 2068 6173 5f76 616c 7565 7328 7365 6c66   has_values(self
-0000ece0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0000ecf0: 2020 2020 2020 203a 7274 7970 653a 2062         :rtype: b
-0000ed00: 6f6f 6c0a 2020 2020 2020 2020 2222 220a  ool.        """.
-0000ed10: 2020 2020 2020 2020 7265 7475 726e 2062          return b
-0000ed20: 6f6f 6c28 7365 6c66 2e64 6963 7429 206f  ool(self.dict) o
-0000ed30: 7220 7365 6c66 2e76 616c 7565 2069 7320  r self.value is 
-0000ed40: 6e6f 7420 4e6f 6e65 0a0a 2020 2020 6465  not None..    de
-0000ed50: 6620 756e 6172 795f 6f70 2873 656c 662c  f unary_op(self,
-0000ed60: 206f 7029 3a0a 2020 2020 2020 2020 2222   op):.        ""
-0000ed70: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
-0000ed80: 2028 5429 2d3e 5432 206f 703a 0a20 2020   (T)->T2 op:.   
-0000ed90: 2020 2020 203a 7265 7475 726e 3a20 6e65       :return: ne
-0000eda0: 7720 4e75 6d62 6572 7344 6963 742c 2077  w NumbersDict, w
-0000edb0: 6865 7265 2060 606f 7060 6020 6973 2061  here ``op`` is a
-0000edc0: 7070 6c69 6564 206f 6e20 616c 6c20 7661  pplied on all va
-0000edd0: 6c75 6573 0a20 2020 2020 2020 203a 7274  lues.        :rt
-0000ede0: 7970 653a 204e 756d 6265 7273 4469 6374  ype: NumbersDict
-0000edf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ee00: 2020 2020 2072 6573 203d 204e 756d 6265       res = Numbe
-0000ee10: 7273 4469 6374 2829 0a20 2020 2020 2020  rsDict().       
-0000ee20: 2069 6620 7365 6c66 2e76 616c 7565 2069   if self.value i
-0000ee30: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000ee40: 2020 2020 2020 2020 7265 732e 7661 6c75          res.valu
-0000ee50: 6520 3d20 6f70 2873 656c 662e 7661 6c75  e = op(self.valu
-0000ee60: 6529 0a20 2020 2020 2020 2066 6f72 206b  e).        for k
-0000ee70: 2c20 7620 696e 2073 656c 662e 6469 6374  , v in self.dict
-0000ee80: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0000ee90: 2020 2020 2020 7265 732e 6469 6374 5b6b        res.dict[k
-0000eea0: 5d20 3d20 6f70 2876 290a 2020 2020 2020  ] = op(v).      
-0000eeb0: 2020 7265 7475 726e 2072 6573 0a0a 2020    return res..  
-0000eec0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-0000eed0: 2020 2064 6566 2062 696e 5f6f 705f 7363     def bin_op_sc
-0000eee0: 616c 6172 5f6f 7074 696f 6e61 6c28 636c  alar_optional(cl
-0000eef0: 732c 2073 656c 662c 206f 7468 6572 2c20  s, self, other, 
-0000ef00: 7a65 726f 2c20 6f70 293a 0a20 2020 2020  zero, op):.     
-0000ef10: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
-0000ef20: 7061 7261 6d20 5420 7365 6c66 3a0a 2020  param T self:.  
-0000ef30: 2020 2020 2020 3a70 6172 616d 2054 206f        :param T o
-0000ef40: 7468 6572 3a0a 2020 2020 2020 2020 3a70  ther:.        :p
-0000ef50: 6172 616d 2054 207a 6572 6f3a 0a20 2020  aram T zero:.   
-0000ef60: 2020 2020 203a 7061 7261 6d20 2854 2c54       :param (T,T
-0000ef70: 292d 3e54 206f 703a 0a20 2020 2020 2020  )->T op:.       
-0000ef80: 203a 7274 7970 653a 2054 0a20 2020 2020   :rtype: T.     
-0000ef90: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0000efa0: 6620 7365 6c66 2069 7320 4e6f 6e65 2061  f self is None a
-0000efb0: 6e64 206f 7468 6572 2069 7320 4e6f 6e65  nd other is None
-0000efc0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000efd0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
-0000efe0: 2020 6966 2073 656c 6620 6973 204e 6f6e    if self is Non
-0000eff0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0000f000: 656c 6620 3d20 7a65 726f 0a20 2020 2020  elf = zero.     
-0000f010: 2020 2069 6620 6f74 6865 7220 6973 204e     if other is N
-0000f020: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000f030: 206f 7468 6572 203d 207a 6572 6f0a 2020   other = zero.  
-0000f040: 2020 2020 2020 7265 7475 726e 206f 7028        return op(
-0000f050: 7365 6c66 2c20 6f74 6865 7229 0a0a 2020  self, other)..  
-0000f060: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-0000f070: 2020 2064 6566 2062 696e 5f6f 7028 636c     def bin_op(cl
-0000f080: 732c 2073 656c 662c 206f 7468 6572 2c20  s, self, other, 
-0000f090: 6f70 2c20 7a65 726f 2c20 7265 7375 6c74  op, zero, result
-0000f0a0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0000f0b0: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
-0000f0c0: 616d 204e 756d 6265 7273 4469 6374 7c69  am NumbersDict|i
-0000f0d0: 6e74 7c66 6c6f 6174 7c54 2073 656c 663a  nt|float|T self:
-0000f0e0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000f0f0: 4e75 6d62 6572 7344 6963 747c 696e 747c  NumbersDict|int|
-0000f100: 666c 6f61 747c 5420 6f74 6865 723a 0a20  float|T other:. 
-0000f110: 2020 2020 2020 203a 7061 7261 6d20 2854         :param (T
-0000f120: 2c54 292d 3e54 206f 703a 0a20 2020 2020  ,T)->T op:.     
-0000f130: 2020 203a 7061 7261 6d20 5420 7a65 726f     :param T zero
-0000f140: 3a0a 2020 2020 2020 2020 3a70 6172 616d  :.        :param
-0000f150: 204e 756d 6265 7273 4469 6374 7c4e 6f6e   NumbersDict|Non
-0000f160: 6520 7265 7375 6c74 3a0a 2020 2020 2020  e result:.      
-0000f170: 2020 3a72 7479 7065 3a20 4e75 6d62 6572    :rtype: Number
-0000f180: 7344 6963 740a 2020 2020 2020 2020 2222  sDict.        ""
-0000f190: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-0000f1a0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-0000f1b0: 2c20 4e75 6d62 6572 7344 6963 7429 3a0a  , NumbersDict):.
-0000f1c0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0000f1d0: 7369 6e73 7461 6e63 6528 6f74 6865 722c  sinstance(other,
-0000f1e0: 204e 756d 6265 7273 4469 6374 293a 0a20   NumbersDict):. 
-0000f1f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000f200: 656c 6620 3d20 4e75 6d62 6572 7344 6963  elf = NumbersDic
-0000f210: 742e 636f 6e73 7461 6e74 5f6c 696b 6528  t.constant_like(
-0000f220: 7365 6c66 2c20 6e75 6d62 6572 735f 6469  self, numbers_di
-0000f230: 6374 3d6f 7468 6572 290a 2020 2020 2020  ct=other).      
-0000f240: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000f250: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f260: 203d 204e 756d 6265 7273 4469 6374 2873   = NumbersDict(s
-0000f270: 656c 6629 0a20 2020 2020 2020 2069 6620  elf).        if 
-0000f280: 6e6f 7420 6973 696e 7374 616e 6365 286f  not isinstance(o
-0000f290: 7468 6572 2c20 4e75 6d62 6572 7344 6963  ther, NumbersDic
-0000f2a0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0000f2b0: 6f74 6865 7220 3d20 4e75 6d62 6572 7344  other = NumbersD
-0000f2c0: 6963 742e 636f 6e73 7461 6e74 5f6c 696b  ict.constant_lik
-0000f2d0: 6528 6f74 6865 722c 206e 756d 6265 7273  e(other, numbers
-0000f2e0: 5f64 6963 743d 7365 6c66 290a 2020 2020  _dict=self).    
-0000f2f0: 2020 2020 6966 2072 6573 756c 7420 6973      if result is
-0000f300: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000f310: 2020 2072 6573 756c 7420 3d20 4e75 6d62     result = Numb
-0000f320: 6572 7344 6963 7428 290a 2020 2020 2020  ersDict().      
-0000f330: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-0000f340: 6e63 6528 7265 7375 6c74 2c20 4e75 6d62  nce(result, Numb
-0000f350: 6572 7344 6963 7429 0a20 2020 2020 2020  ersDict).       
-0000f360: 2066 6f72 206b 2069 6e20 7365 6c66 2e6b   for k in self.k
-0000f370: 6579 735f 7365 7420 7c20 6f74 6865 722e  eys_set | other.
-0000f380: 6b65 7973 5f73 6574 3a0a 2020 2020 2020  keys_set:.      
-0000f390: 2020 2020 2020 7265 7375 6c74 5b6b 5d20        result[k] 
-0000f3a0: 3d20 636c 732e 6269 6e5f 6f70 5f73 6361  = cls.bin_op_sca
-0000f3b0: 6c61 725f 6f70 7469 6f6e 616c 2873 656c  lar_optional(sel
-0000f3c0: 662e 6765 7428 6b2c 204e 6f6e 6529 2c20  f.get(k, None), 
-0000f3d0: 6f74 6865 722e 6765 7428 6b2c 204e 6f6e  other.get(k, Non
-0000f3e0: 6529 2c20 7a65 726f 3d7a 6572 6f2c 206f  e), zero=zero, o
-0000f3f0: 703d 6f70 290a 2020 2020 2020 2020 7265  p=op).        re
-0000f400: 7375 6c74 2e76 616c 7565 203d 2063 6c73  sult.value = cls
-0000f410: 2e62 696e 5f6f 705f 7363 616c 6172 5f6f  .bin_op_scalar_o
-0000f420: 7074 696f 6e61 6c28 7365 6c66 2e76 616c  ptional(self.val
-0000f430: 7565 2c20 6f74 6865 722e 7661 6c75 652c  ue, other.value,
-0000f440: 207a 6572 6f3d 7a65 726f 2c20 6f70 3d6f   zero=zero, op=o
-0000f450: 7029 0a20 2020 2020 2020 2072 6574 7572  p).        retur
-0000f460: 6e20 7265 7375 6c74 0a0a 2020 2020 6465  n result..    de
-0000f470: 6620 5f5f 6164 645f 5f28 7365 6c66 2c20  f __add__(self, 
-0000f480: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
-0000f490: 7265 7475 726e 2073 656c 662e 6269 6e5f  return self.bin_
-0000f4a0: 6f70 2873 656c 662c 206f 7468 6572 2c20  op(self, other, 
-0000f4b0: 6f70 3d6c 616d 6264 6120 612c 2062 3a20  op=lambda a, b: 
-0000f4c0: 6120 2b20 622c 207a 6572 6f3d 3029 0a0a  a + b, zero=0)..
-0000f4d0: 2020 2020 5f5f 7261 6464 5f5f 203d 205f      __radd__ = _
-0000f4e0: 5f61 6464 5f5f 0a0a 2020 2020 6465 6620  _add__..    def 
-0000f4f0: 5f5f 6961 6464 5f5f 2873 656c 662c 206f  __iadd__(self, o
-0000f500: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
-0000f510: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
-0000f520: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
-0000f530: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
-0000f540: 202b 2062 2c20 7a65 726f 3d30 2c20 7265   + b, zero=0, re
-0000f550: 7375 6c74 3d73 656c 6629 0a0a 2020 2020  sult=self)..    
-0000f560: 6465 6620 5f5f 7375 625f 5f28 7365 6c66  def __sub__(self
-0000f570: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
-0000f580: 2020 7265 7475 726e 2073 656c 662e 6269    return self.bi
-0000f590: 6e5f 6f70 2873 656c 662c 206f 7468 6572  n_op(self, other
-0000f5a0: 2c20 6f70 3d6c 616d 6264 6120 612c 2062  , op=lambda a, b
-0000f5b0: 3a20 6120 2d20 622c 207a 6572 6f3d 3029  : a - b, zero=0)
-0000f5c0: 0a0a 2020 2020 6465 6620 5f5f 7273 7562  ..    def __rsub
-0000f5d0: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
-0000f5e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000f5f0: 7365 6c66 2e62 696e 5f6f 7028 7365 6c66  self.bin_op(self
-0000f600: 2c20 6f74 6865 722c 206f 703d 6c61 6d62  , other, op=lamb
-0000f610: 6461 2061 2c20 623a 2062 202d 2061 2c20  da a, b: b - a, 
-0000f620: 7a65 726f 3d30 290a 0a20 2020 2064 6566  zero=0)..    def
-0000f630: 205f 5f69 7375 625f 5f28 7365 6c66 2c20   __isub__(self, 
-0000f640: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
-0000f650: 7265 7475 726e 2073 656c 662e 6269 6e5f  return self.bin_
-0000f660: 6f70 2873 656c 662c 206f 7468 6572 2c20  op(self, other, 
-0000f670: 6f70 3d6c 616d 6264 6120 612c 2062 3a20  op=lambda a, b: 
-0000f680: 6120 2d20 622c 207a 6572 6f3d 302c 2072  a - b, zero=0, r
-0000f690: 6573 756c 743d 7365 6c66 290a 0a20 2020  esult=self)..   
-0000f6a0: 2064 6566 205f 5f6d 756c 5f5f 2873 656c   def __mul__(sel
-0000f6b0: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
-0000f6c0: 2020 2072 6574 7572 6e20 7365 6c66 2e62     return self.b
-0000f6d0: 696e 5f6f 7028 7365 6c66 2c20 6f74 6865  in_op(self, othe
-0000f6e0: 722c 206f 703d 6c61 6d62 6461 2061 2c20  r, op=lambda a, 
-0000f6f0: 623a 2061 202a 2062 2c20 7a65 726f 3d31  b: a * b, zero=1
-0000f700: 290a 0a20 2020 205f 5f72 6d75 6c5f 5f20  )..    __rmul__ 
-0000f710: 3d20 5f5f 6d75 6c5f 5f0a 0a20 2020 2064  = __mul__..    d
-0000f720: 6566 205f 5f69 6d75 6c5f 5f28 7365 6c66  ef __imul__(self
-0000f730: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
-0000f740: 2020 7265 7475 726e 2073 656c 662e 6269    return self.bi
-0000f750: 6e5f 6f70 2873 656c 662c 206f 7468 6572  n_op(self, other
-0000f760: 2c20 6f70 3d6c 616d 6264 6120 612c 2062  , op=lambda a, b
-0000f770: 3a20 6120 2a20 622c 207a 6572 6f3d 312c  : a * b, zero=1,
-0000f780: 2072 6573 756c 743d 7365 6c66 290a 0a20   result=self).. 
-0000f790: 2020 2064 6566 205f 5f64 6976 5f5f 2873     def __div__(s
-0000f7a0: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
-0000f7b0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000f7c0: 2e62 696e 5f6f 7028 7365 6c66 2c20 6f74  .bin_op(self, ot
-0000f7d0: 6865 722c 206f 703d 6c61 6d62 6461 2061  her, op=lambda a
-0000f7e0: 2c20 623a 2061 202f 2062 2c20 7a65 726f  , b: a / b, zero
-0000f7f0: 3d31 290a 0a20 2020 205f 5f72 6469 765f  =1)..    __rdiv_
-0000f800: 5f20 3d20 5f5f 6469 765f 5f0a 2020 2020  _ = __div__.    
-0000f810: 5f5f 7472 7565 6469 765f 5f20 3d20 5f5f  __truediv__ = __
-0000f820: 6469 765f 5f0a 0a20 2020 2064 6566 205f  div__..    def _
-0000f830: 5f69 6469 765f 5f28 7365 6c66 2c20 6f74  _idiv__(self, ot
-0000f840: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
-0000f850: 7475 726e 2073 656c 662e 6269 6e5f 6f70  turn self.bin_op
-0000f860: 2873 656c 662c 206f 7468 6572 2c20 6f70  (self, other, op
-0000f870: 3d6c 616d 6264 6120 612c 2062 3a20 6120  =lambda a, b: a 
-0000f880: 2f20 622c 207a 6572 6f3d 312c 2072 6573  / b, zero=1, res
-0000f890: 756c 743d 7365 6c66 290a 0a20 2020 205f  ult=self)..    _
-0000f8a0: 5f69 7472 7565 6469 765f 5f20 3d20 5f5f  _itruediv__ = __
-0000f8b0: 6964 6976 5f5f 0a0a 2020 2020 6465 6620  idiv__..    def 
-0000f8c0: 5f5f 666c 6f6f 7264 6976 5f5f 2873 656c  __floordiv__(sel
-0000f8d0: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
-0000f8e0: 2020 2072 6574 7572 6e20 7365 6c66 2e62     return self.b
-0000f8f0: 696e 5f6f 7028 7365 6c66 2c20 6f74 6865  in_op(self, othe
-0000f900: 722c 206f 703d 6c61 6d62 6461 2061 2c20  r, op=lambda a, 
-0000f910: 623a 2061 202f 2f20 622c 207a 6572 6f3d  b: a // b, zero=
-0000f920: 3129 0a0a 2020 2020 6465 6620 5f5f 6966  1)..    def __if
-0000f930: 6c6f 6f72 6469 765f 5f28 7365 6c66 2c20  loordiv__(self, 
-0000f940: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
-0000f950: 7265 7475 726e 2073 656c 662e 6269 6e5f  return self.bin_
-0000f960: 6f70 2873 656c 662c 206f 7468 6572 2c20  op(self, other, 
-0000f970: 6f70 3d6c 616d 6264 6120 612c 2062 3a20  op=lambda a, b: 
-0000f980: 6120 2f2f 2062 2c20 7a65 726f 3d31 2c20  a // b, zero=1, 
-0000f990: 7265 7375 6c74 3d73 656c 6629 0a0a 2020  result=self)..  
-0000f9a0: 2020 6465 6620 5f5f 6e65 675f 5f28 7365    def __neg__(se
-0000f9b0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-0000f9c0: 7572 6e20 7365 6c66 2e75 6e61 7279 5f6f  urn self.unary_o
-0000f9d0: 7028 6f70 3d6c 616d 6264 6120 613a 202d  p(op=lambda a: -
-0000f9e0: 6129 0a0a 2020 2020 6465 6620 5f5f 626f  a)..    def __bo
-0000f9f0: 6f6c 5f5f 2873 656c 6629 3a0a 2020 2020  ol__(self):.    
-0000fa00: 2020 2020 7265 7475 726e 2061 6e79 2873      return any(s
-0000fa10: 656c 662e 7661 6c75 6573 2829 290a 0a20  elf.values()).. 
-0000fa20: 2020 205f 5f6e 6f6e 7a65 726f 5f5f 203d     __nonzero__ =
-0000fa30: 205f 5f62 6f6f 6c5f 5f20 2023 2050 7974   __bool__  # Pyt
-0000fa40: 686f 6e20 320a 0a20 2020 2064 6566 2065  hon 2..    def e
-0000fa50: 6c65 6d5f 6571 2873 656c 662c 206f 7468  lem_eq(self, oth
-0000fa60: 6572 2c20 7265 7375 6c74 5f77 6974 685f  er, result_with_
-0000fa70: 6465 6661 756c 743d 5472 7565 293a 0a20  default=True):. 
-0000fa80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000fa90: 2020 2045 6c65 6d65 6e74 2d77 6973 6520     Element-wise 
-0000faa0: 6571 7561 6c69 7479 2063 6865 636b 2077  equality check w
-0000fab0: 6974 6820 6f74 6865 722e 0a20 2020 2020  ith other..     
-0000fac0: 2020 204e 6f74 6520 6162 6f75 7420 6272     Note about br
-0000fad0: 6f61 6463 6173 7420 6465 6661 756c 7420  oadcast default 
-0000fae0: 7661 6c75 653a 2043 6f6e 7369 6465 7220  value: Consider 
-0000faf0: 736f 6d65 206b 6579 2077 6869 6368 2069  some key which i
-0000fb00: 7320 6e65 6974 6865 7220 696e 2073 656c  s neither in sel
-0000fb10: 6620 6e6f 7220 696e 206f 7468 6572 2e0a  f nor in other..
-0000fb20: 2020 2020 2020 2020 2020 5468 6973 206d            This m
-0000fb30: 6561 6e73 2074 6861 7420 7365 6c66 5b6b  eans that self[k
-0000fb40: 6579 5d20 3d3d 2073 656c 662e 6465 6661  ey] == self.defa
-0000fb50: 756c 742c 206f 7468 6572 5b6b 6579 5d20  ult, other[key] 
-0000fb60: 3d3d 206f 7468 6572 2e64 6566 6175 6c74  == other.default
-0000fb70: 2e0a 2020 2020 2020 2020 2020 5468 7573  ..          Thus
-0000fb80: 2c20 696e 2063 6173 6520 7468 6174 2073  , in case that s
-0000fb90: 656c 662e 6465 6661 756c 7420 213d 206f  elf.default != o
-0000fba0: 7468 6572 2e64 6566 6175 6c74 2c20 7765  ther.default, we
-0000fbb0: 2067 6574 2072 6573 2e64 6566 6175 6c74   get res.default
-0000fbc0: 203d 3d20 4661 6c73 652e 0a20 2020 2020   == False..     
-0000fbd0: 2020 2020 2054 6865 6e2c 2061 6c6c 2872       Then, all(r
-0000fbe0: 6573 2e76 616c 7565 7328 2929 203d 3d20  es.values()) == 
-0000fbf0: 4661 6c73 652c 2065 7665 6e20 7768 656e  False, even when
-0000fc00: 2061 6c6c 206f 7468 6572 2076 616c 7565   all other value
-0000fc10: 7320 6172 6520 5472 7565 2e0a 2020 2020  s are True..    
-0000fc20: 2020 2020 2020 5468 6973 2069 7320 736f        This is so
-0000fc30: 6d65 7469 6d65 7320 6e6f 7420 7768 6174  metimes not what
-0000fc40: 2077 6520 7761 6e74 2e0a 2020 2020 2020   we want..      
-0000fc50: 2020 2020 596f 7520 6361 6e20 636f 6e74      You can cont
-0000fc60: 726f 6c20 7468 6520 6265 6861 7669 6f72  rol the behavior
-0000fc70: 2076 6961 2072 6573 756c 745f 7769 7468   via result_with
-0000fc80: 5f64 6566 6175 6c74 2e0a 0a20 2020 2020  _default...     
-0000fc90: 2020 203a 7061 7261 6d20 4e75 6d62 6572     :param Number
-0000fca0: 7344 6963 747c 5420 6f74 6865 723a 0a20  sDict|T other:. 
-0000fcb0: 2020 2020 2020 203a 7061 7261 6d20 626f         :param bo
-0000fcc0: 6f6c 2072 6573 756c 745f 7769 7468 5f64  ol result_with_d
-0000fcd0: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
-0000fce0: 3a72 7479 7065 3a20 4e75 6d62 6572 7344  :rtype: NumbersD
-0000fcf0: 6963 740a 2020 2020 2020 2020 2222 220a  ict.        """.
-0000fd00: 0a20 2020 2020 2020 2064 6566 206f 7028  .        def op(
-0000fd10: 612c 2062 293a 0a20 2020 2020 2020 2020  a, b):.         
-0000fd20: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
-0000fd30: 2020 203a 7061 7261 6d20 613a 0a20 2020     :param a:.   
-0000fd40: 2020 2020 2020 2020 203a 7061 7261 6d20           :param 
-0000fd50: 623a 0a20 2020 2020 2020 2020 2020 203a  b:.            :
-0000fd60: 7274 7970 653a 2062 6f6f 6c7c 4e6f 6e65  rtype: bool|None
-0000fd70: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
-0000fd80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000fd90: 6120 6973 204e 6f6e 653a 0a20 2020 2020  a is None:.     
-0000fda0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000fdb0: 6e20 4e6f 6e65 0a20 2020 2020 2020 2020  n None.         
-0000fdc0: 2020 2069 6620 6220 6973 204e 6f6e 653a     if b is None:
-0000fdd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fde0: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-0000fdf0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000fe00: 6120 3d3d 2062 0a0a 2020 2020 2020 2020  a == b..        
-0000fe10: 7265 7320 3d20 7365 6c66 2e62 696e 5f6f  res = self.bin_o
-0000fe20: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
-0000fe30: 703d 6f70 2c20 7a65 726f 3d4e 6f6e 6529  p=op, zero=None)
-0000fe40: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000fe50: 7265 7375 6c74 5f77 6974 685f 6465 6661  result_with_defa
-0000fe60: 756c 743a 0a20 2020 2020 2020 2020 2020  ult:.           
-0000fe70: 2072 6573 2e76 616c 7565 203d 204e 6f6e   res.value = Non
-0000fe80: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-0000fe90: 2072 6573 0a0a 2020 2020 6465 6620 5f5f   res..    def __
-0000fea0: 6571 5f5f 2873 656c 662c 206f 7468 6572  eq__(self, other
-0000feb0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0000fec0: 2020 2020 2020 203a 7061 7261 6d20 4e75         :param Nu
-0000fed0: 6d62 6572 7344 6963 747c 5420 6f74 6865  mbersDict|T othe
-0000fee0: 723a 0a20 2020 2020 2020 203a 7265 7475  r:.        :retu
-0000fef0: 726e 3a20 7768 6574 6865 7220 7365 6c66  rn: whether self
-0000ff00: 203d 3d20 6f74 6865 7220 656c 656d 7769   == other elemwi
-0000ff10: 7365 2e20 7365 6520 7365 6c66 2e65 6c65  se. see self.ele
-0000ff20: 6d5f 6571 0a20 2020 2020 2020 203a 7274  m_eq.        :rt
-0000ff30: 7970 653a 2062 6f6f 6c0a 2020 2020 2020  ype: bool.      
-0000ff40: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-0000ff50: 7475 726e 2061 6c6c 2873 656c 662e 656c  turn all(self.el
-0000ff60: 656d 5f65 7128 6f74 6865 7229 2e76 616c  em_eq(other).val
-0000ff70: 7565 7328 2929 0a0a 2020 2020 6465 6620  ues())..    def 
-0000ff80: 5f5f 6e65 5f5f 2873 656c 662c 206f 7468  __ne__(self, oth
-0000ff90: 6572 293a 0a20 2020 2020 2020 2022 2222  er):.        """
-0000ffa0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000ffb0: 4e75 6d62 6572 7344 6963 747c 5420 6f74  NumbersDict|T ot
-0000ffc0: 6865 723a 0a20 2020 2020 2020 203a 7265  her:.        :re
-0000ffd0: 7475 726e 3a20 6e6f 7420 2873 656c 6620  turn: not (self 
-0000ffe0: 3d3d 206f 7468 6572 290a 2020 2020 2020  == other).      
-0000fff0: 2020 3a72 7479 7065 3a20 626f 6f6c 0a20    :rtype: bool. 
-00010000: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00010010: 2020 2072 6574 7572 6e20 6e6f 7420 2873     return not (s
-00010020: 656c 6620 3d3d 206f 7468 6572 290a 0a20  elf == other).. 
-00010030: 2020 2064 6566 205f 5f63 6d70 5f5f 2873     def __cmp__(s
-00010040: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
-00010050: 2020 2020 2023 2054 6865 7265 2069 7320       # There is 
-00010060: 6e6f 2067 6f6f 6420 7374 7261 6967 6874  no good straight
-00010070: 2d66 6f72 7761 7264 2069 6d70 6c65 6d65  -forward impleme
-00010080: 6e74 6174 696f 6e0a 2020 2020 2020 2020  ntation.        
-00010090: 2320 616e 6420 6974 2077 6f75 6c64 206a  # and it would j
-000100a0: 7573 7420 636f 6e66 7573 652e 0a20 2020  ust confuse..   
-000100b0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-000100c0: 7469 6f6e 2822 2573 2e5f 5f63 6d70 5f5f  tion("%s.__cmp__
-000100d0: 2069 7320 756e 6465 6669 6e65 6422 2025   is undefined" %
-000100e0: 2073 656c 662e 5f5f 636c 6173 735f 5f2e   self.__class__.
-000100f0: 5f5f 6e61 6d65 5f5f 290a 0a20 2020 2064  __name__)..    d
-00010100: 6566 2061 6e79 5f63 6f6d 7061 7265 2873  ef any_compare(s
-00010110: 656c 662c 206f 7468 6572 2c20 636d 7029  elf, other, cmp)
-00010120: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00010130: 2020 2020 2020 3a70 6172 616d 204e 756d        :param Num
-00010140: 6265 7273 4469 6374 206f 7468 6572 3a0a  bersDict other:.
-00010150: 2020 2020 2020 2020 3a70 6172 616d 2028          :param (
-00010160: 286f 626a 6563 742c 6f62 6a65 6374 292d  (object,object)-
-00010170: 3e54 7275 6529 2063 6d70 3a0a 2020 2020  >True) cmp:.    
-00010180: 2020 2020 3a72 7479 7065 3a20 5472 7565      :rtype: True
-00010190: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000101a0: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
-000101b0: 7365 6c66 2e6b 6579 7328 293a 0a20 2020  self.keys():.   
-000101c0: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
-000101d0: 696e 206f 7468 6572 2e6b 6579 7328 293a  in other.keys():
-000101e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000101f0: 2069 6620 636d 7028 7365 6c66 5b6b 6579   if cmp(self[key
-00010200: 5d2c 206f 7468 6572 5b6b 6579 5d29 3a0a  ], other[key]):.
-00010210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010220: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
-00010230: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00010240: 206f 7468 6572 2e76 616c 7565 2069 7320   other.value is 
-00010250: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00010260: 2020 2020 2020 2020 2020 6966 2063 6d70            if cmp
-00010270: 2873 656c 665b 6b65 795d 2c20 6f74 6865  (self[key], othe
-00010280: 722e 7661 6c75 6529 3a0a 2020 2020 2020  r.value):.      
-00010290: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000102a0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-000102b0: 2020 6966 2073 656c 662e 7661 6c75 6520    if self.value 
-000102c0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-000102d0: 6f74 6865 722e 7661 6c75 6520 6973 206e  other.value is n
-000102e0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000102f0: 2020 2020 2069 6620 636d 7028 7365 6c66       if cmp(self
-00010300: 2e76 616c 7565 2c20 6f74 6865 722e 7661  .value, other.va
-00010310: 6c75 6529 3a0a 2020 2020 2020 2020 2020  lue):.          
-00010320: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00010330: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00010340: 2046 616c 7365 0a0a 2020 2020 4073 7461   False..    @sta
-00010350: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-00010360: 6620 5f6d 6178 282a 6172 6773 293a 0a20  f _max(*args):. 
-00010370: 2020 2020 2020 2061 7267 7320 3d20 5b61         args = [a
-00010380: 2066 6f72 2061 2069 6e20 6172 6773 2069   for a in args i
-00010390: 6620 6120 6973 206e 6f74 204e 6f6e 655d  f a is not None]
-000103a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-000103b0: 6172 6773 3a0a 2020 2020 2020 2020 2020  args:.          
-000103c0: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
-000103d0: 2020 2020 2020 6966 206c 656e 2861 7267        if len(arg
-000103e0: 7329 203d 3d20 313a 0a20 2020 2020 2020  s) == 1:.       
-000103f0: 2020 2020 2072 6574 7572 6e20 6172 6773       return args
-00010400: 5b30 5d0a 2020 2020 2020 2020 7265 7475  [0].        retu
-00010410: 726e 206d 6178 282a 6172 6773 290a 0a20  rn max(*args).. 
-00010420: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-00010430: 0a20 2020 2064 6566 205f 6d69 6e28 2a61  .    def _min(*a
-00010440: 7267 7329 3a0a 2020 2020 2020 2020 6172  rgs):.        ar
-00010450: 6773 203d 205b 6120 666f 7220 6120 696e  gs = [a for a in
-00010460: 2061 7267 7320 6966 2061 2069 7320 6e6f   args if a is no
-00010470: 7420 4e6f 6e65 5d0a 2020 2020 2020 2020  t None].        
-00010480: 6966 206e 6f74 2061 7267 733a 0a20 2020  if not args:.   
-00010490: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000104a0: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
-000104b0: 6c65 6e28 6172 6773 2920 3d3d 2031 3a0a  len(args) == 1:.
-000104c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000104d0: 726e 2061 7267 735b 305d 0a20 2020 2020  rn args[0].     
-000104e0: 2020 2072 6574 7572 6e20 6d69 6e28 2a61     return min(*a
-000104f0: 7267 7329 0a0a 2020 2020 4063 6c61 7373  rgs)..    @class
-00010500: 6d65 7468 6f64 0a20 2020 2064 6566 206d  method.    def m
-00010510: 6178 2863 6c73 2c20 6974 656d 7329 3a0a  ax(cls, items):.
-00010520: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010530: 2020 2020 456c 656d 656e 742d 7769 7365      Element-wise
-00010540: 206d 6178 696d 756d 2066 6f72 2069 7465   maximum for ite
-00010550: 6d20 696e 2069 7465 6d73 2e0a 2020 2020  m in items..    
-00010560: 2020 2020 3a70 6172 616d 206c 6973 745b      :param list[
-00010570: 4e75 6d62 6572 7344 6963 747c 696e 747c  NumbersDict|int|
-00010580: 666c 6f61 745d 2069 7465 6d73 3a0a 2020  float] items:.  
-00010590: 2020 2020 2020 3a72 7479 7065 3a20 4e75        :rtype: Nu
-000105a0: 6d62 6572 7344 6963 740a 2020 2020 2020  mbersDict.      
-000105b0: 2020 2222 220a 2020 2020 2020 2020 6173    """.        as
-000105c0: 7365 7274 2069 7465 6d73 0a20 2020 2020  sert items.     
-000105d0: 2020 2069 6620 6c65 6e28 6974 656d 7329     if len(items)
-000105e0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-000105f0: 2020 2072 6574 7572 6e20 4e75 6d62 6572     return Number
-00010600: 7344 6963 7428 6974 656d 735b 305d 290a  sDict(items[0]).
-00010610: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
-00010620: 7465 6d73 2920 3d3d 2032 3a0a 2020 2020  tems) == 2:.    
-00010630: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00010640: 6c73 2e62 696e 5f6f 7028 6974 656d 735b  ls.bin_op(items[
-00010650: 305d 2c20 6974 656d 735b 315d 2c20 6f70  0], items[1], op
-00010660: 3d63 6c73 2e5f 6d61 782c 207a 6572 6f3d  =cls._max, zero=
-00010670: 4e6f 6e65 290a 2020 2020 2020 2020 7265  None).        re
-00010680: 7475 726e 2063 6c73 2e6d 6178 285b 6974  turn cls.max([it
-00010690: 656d 735b 305d 2c20 636c 732e 6d61 7828  ems[0], cls.max(
-000106a0: 6974 656d 735b 313a 5d29 5d29 0a0a 2020  items[1:])])..  
-000106b0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-000106c0: 2020 2064 6566 206d 696e 2863 6c73 2c20     def min(cls, 
-000106d0: 6974 656d 7329 3a0a 2020 2020 2020 2020  items):.        
-000106e0: 2222 220a 2020 2020 2020 2020 456c 656d  """.        Elem
-000106f0: 656e 742d 7769 7365 206d 696e 696d 756d  ent-wise minimum
-00010700: 2066 6f72 2069 7465 6d20 696e 2069 7465   for item in ite
-00010710: 6d73 2e0a 2020 2020 2020 2020 3a70 6172  ms..        :par
-00010720: 616d 206c 6973 745b 4e75 6d62 6572 7344  am list[NumbersD
-00010730: 6963 747c 696e 747c 666c 6f61 745d 2069  ict|int|float] i
-00010740: 7465 6d73 3a0a 2020 2020 2020 2020 3a72  tems:.        :r
-00010750: 7479 7065 3a20 4e75 6d62 6572 7344 6963  type: NumbersDic
-00010760: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
-00010770: 2020 2020 2020 6173 7365 7274 2069 7465        assert ite
-00010780: 6d73 0a20 2020 2020 2020 2069 6620 6c65  ms.        if le
-00010790: 6e28 6974 656d 7329 203d 3d20 313a 0a20  n(items) == 1:. 
-000107a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000107b0: 6e20 4e75 6d62 6572 7344 6963 7428 6974  n NumbersDict(it
-000107c0: 656d 735b 305d 290a 2020 2020 2020 2020  ems[0]).        
-000107d0: 6966 206c 656e 2869 7465 6d73 2920 3d3d  if len(items) ==
-000107e0: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-000107f0: 7265 7475 726e 2063 6c73 2e62 696e 5f6f  return cls.bin_o
-00010800: 7028 6974 656d 735b 305d 2c20 6974 656d  p(items[0], item
-00010810: 735b 315d 2c20 6f70 3d63 6c73 2e5f 6d69  s[1], op=cls._mi
-00010820: 6e2c 207a 6572 6f3d 4e6f 6e65 290a 2020  n, zero=None).  
-00010830: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
-00010840: 2e6d 696e 285b 6974 656d 735b 305d 2c20  .min([items[0], 
-00010850: 636c 732e 6d69 6e28 6974 656d 735b 313a  cls.min(items[1:
-00010860: 5d29 5d29 0a0a 2020 2020 4073 7461 7469  ])])..    @stati
-00010870: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-00010880: 5f6d 6178 5f65 7272 6f72 2829 3a0a 2020  _max_error():.  
-00010890: 2020 2020 2020 2320 5769 6c6c 2072 6570        # Will rep
-000108a0: 6c61 6365 2073 656c 662e 6d61 7820 666f  lace self.max fo
-000108b0: 7220 6561 6368 2069 6e73 7461 6e63 652e  r each instance.
-000108c0: 2054 6f20 6265 2073 7572 6520 7468 6174   To be sure that
-000108d0: 2077 6520 646f 6e27 7420 636f 6e66 7573   we don't confus
-000108e0: 6520 6974 2077 6974 6820 7365 6c66 2e6d  e it with self.m
-000108f0: 6178 5f76 616c 7565 2e0a 2020 2020 2020  ax_value..      
-00010900: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-00010910: 6e28 2255 7365 206d 6178 5f76 616c 7565  n("Use max_value
-00010920: 2069 6e73 7465 6164 2e22 290a 0a20 2020   instead.")..   
-00010930: 2064 6566 206d 6178 5f76 616c 7565 2873   def max_value(s
-00010940: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00010950: 220a 2020 2020 2020 2020 4d61 7869 6d75  ".        Maximu
-00010960: 6d20 6f66 206f 7572 2076 616c 7565 732e  m of our values.
-00010970: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00010980: 2020 2020 2072 6574 7572 6e20 6d61 7828       return max(
-00010990: 7365 6c66 2e76 616c 7565 7328 2929 0a0a  self.values())..
-000109a0: 2020 2020 6465 6620 6d69 6e5f 7661 6c75      def min_valu
-000109b0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-000109c0: 2022 2222 0a20 2020 2020 2020 204d 696e   """.        Min
-000109d0: 696d 756d 206f 6620 6f75 7220 7661 6c75  imum of our valu
-000109e0: 6573 2e0a 2020 2020 2020 2020 2222 220a  es..        """.
-000109f0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-00010a00: 696e 2873 656c 662e 7661 6c75 6573 2829  in(self.values()
-00010a10: 290a 0a20 2020 2064 6566 205f 5f72 6570  )..    def __rep
-00010a20: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-00010a30: 2020 2069 6620 7365 6c66 2e76 616c 7565     if self.value
-00010a40: 2069 7320 4e6f 6e65 2061 6e64 206e 6f74   is None and not
-00010a50: 2073 656c 662e 6469 6374 3a0a 2020 2020   self.dict:.    
-00010a60: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00010a70: 2573 2829 2220 2520 7365 6c66 2e5f 5f63  %s()" % self.__c
-00010a80: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f0a  lass__.__name__.
-00010a90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00010aa0: 7661 6c75 6520 6973 204e 6f6e 6520 616e  value is None an
-00010ab0: 6420 7365 6c66 2e64 6963 743a 0a20 2020  d self.dict:.   
-00010ac0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00010ad0: 2225 7328 2572 2922 2025 2028 7365 6c66  "%s(%r)" % (self
-00010ae0: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
-00010af0: 655f 5f2c 2073 656c 662e 6469 6374 290a  e__, self.dict).
-00010b00: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00010b10: 656c 662e 6469 6374 2061 6e64 2073 656c  elf.dict and sel
-00010b20: 662e 7661 6c75 6520 6973 206e 6f74 204e  f.value is not N
-00010b30: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00010b40: 2072 6574 7572 6e20 2225 7328 2572 2922   return "%s(%r)"
-00010b50: 2025 2028 7365 6c66 2e5f 5f63 6c61 7373   % (self.__class
-00010b60: 5f5f 2e5f 5f6e 616d 655f 5f2c 2073 656c  __.__name__, sel
-00010b70: 662e 7661 6c75 6529 0a20 2020 2020 2020  f.value).       
-00010b80: 2072 6574 7572 6e20 2225 7328 6e75 6d62   return "%s(numb
-00010b90: 6572 735f 6469 6374 3d25 722c 2062 726f  ers_dict=%r, bro
-00010ba0: 6164 6361 7374 5f76 616c 7565 3d25 7229  adcast_value=%r)
-00010bb0: 2220 2520 2873 656c 662e 5f5f 636c 6173  " % (self.__clas
-00010bc0: 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20 7365  s__.__name__, se
-00010bd0: 6c66 2e64 6963 742c 2073 656c 662e 7661  lf.dict, self.va
-00010be0: 6c75 6529 0a0a 0a64 6566 2063 6f6c 6c65  lue)...def colle
-00010bf0: 6374 5f63 6c61 7373 5f69 6e69 745f 6b77  ct_class_init_kw
-00010c00: 6172 6773 2863 6c73 2c20 6f6e 6c79 5f77  args(cls, only_w
-00010c10: 6974 685f 6465 6661 756c 743d 4661 6c73  ith_default=Fals
-00010c20: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
-00010c30: 3a70 6172 616d 2074 7970 6520 636c 733a  :param type cls:
-00010c40: 2063 6c61 7373 2c20 7768 6572 6520 6974   class, where it
-00010c50: 2061 7373 756d 6573 2074 6861 7420 6b77   assumes that kw
-00010c60: 6172 6773 2061 7265 2070 6173 7365 6420  args are passed 
-00010c70: 6f6e 2074 6f20 6261 7365 2063 6c61 7373  on to base class
-00010c80: 6573 0a20 2020 203a 7061 7261 6d20 626f  es.    :param bo
-00010c90: 6f6c 206f 6e6c 795f 7769 7468 5f64 6566  ol only_with_def
-00010ca0: 6175 6c74 3a20 6966 2067 6976 656e 2077  ault: if given w
-00010cb0: 696c 6c20 6f6e 6c79 2072 6574 7572 6e20  ill only return 
-00010cc0: 7468 6520 6b77 6172 6773 2077 6974 6820  the kwargs with 
-00010cd0: 6465 6661 756c 7420 7661 6c75 6573 0a20  default values. 
-00010ce0: 2020 203a 7265 7475 726e 3a20 7365 7420     :return: set 
-00010cf0: 6966 206e 6f74 2077 6974 685f 6465 6661  if not with_defa
-00010d00: 756c 742c 206f 7468 6572 7769 7365 2074  ult, otherwise t
-00010d10: 6865 2064 6963 7420 746f 2074 6865 2064  he dict to the d
-00010d20: 6566 6175 6c74 2076 616c 7565 730a 2020  efault values.  
-00010d30: 2020 3a72 7479 7065 3a20 6c69 7374 5b73    :rtype: list[s
-00010d40: 7472 5d20 7c20 6469 6374 5b73 7472 5d0a  tr] | dict[str].
-00010d50: 2020 2020 2222 220a 2020 2020 6672 6f6d      """.    from
-00010d60: 2063 6f6c 6c65 6374 696f 6e73 2069 6d70   collections imp
-00010d70: 6f72 7420 4f72 6465 7265 6444 6963 740a  ort OrderedDict.
-00010d80: 0a20 2020 2069 6620 6f6e 6c79 5f77 6974  .    if only_wit
-00010d90: 685f 6465 6661 756c 743a 0a20 2020 2020  h_default:.     
-00010da0: 2020 206b 7761 7267 7320 3d20 4f72 6465     kwargs = Orde
-00010db0: 7265 6444 6963 7428 290a 2020 2020 656c  redDict().    el
-00010dc0: 7365 3a0a 2020 2020 2020 2020 6b77 6172  se:.        kwar
-00010dd0: 6773 203d 205b 5d0a 2020 2020 666f 7220  gs = [].    for 
-00010de0: 636c 735f 2069 6e20 696e 7370 6563 742e  cls_ in inspect.
-00010df0: 6765 746d 726f 2863 6c73 293a 0a20 2020  getmro(cls):.   
-00010e00: 2020 2020 2023 2043 6865 636b 2050 7974       # Check Pyt
-00010e10: 686f 6e20 6675 6e63 7469 6f6e 2e20 436f  hon function. Co
-00010e20: 756c 6420 6265 2062 7569 6c74 696e 2066  uld be builtin f
-00010e30: 756e 6320 6f72 2073 6f2e 2050 7974 686f  unc or so. Pytho
-00010e40: 6e20 3220 6765 7461 7267 7370 6563 2064  n 2 getargspec d
-00010e50: 6f65 7320 6e6f 7420 776f 726b 2069 6e20  oes not work in 
-00010e60: 7468 6174 2063 6173 652e 0a20 2020 2020  that case..     
-00010e70: 2020 2069 6620 6e6f 7420 696e 7370 6563     if not inspec
-00010e80: 742e 6973 6d65 7468 6f64 2863 6c73 5f2e  t.ismethod(cls_.
-00010e90: 5f5f 696e 6974 5f5f 2920 616e 6420 6e6f  __init__) and no
-00010ea0: 7420 696e 7370 6563 742e 6973 6675 6e63  t inspect.isfunc
-00010eb0: 7469 6f6e 2863 6c73 5f2e 5f5f 696e 6974  tion(cls_.__init
-00010ec0: 5f5f 293a 0a20 2020 2020 2020 2020 2020  __):.           
-00010ed0: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00010ee0: 2020 6172 675f 7370 6563 203d 2067 6574    arg_spec = get
-00010ef0: 6172 6773 7065 6328 636c 735f 2e5f 5f69  argspec(cls_.__i
-00010f00: 6e69 745f 5f29 0a20 2020 2020 2020 2061  nit__).        a
-00010f10: 7267 7320 3d20 6172 675f 7370 6563 2e61  rgs = arg_spec.a
-00010f20: 7267 735b 313a 5d20 2023 2066 6972 7374  rgs[1:]  # first
-00010f30: 2061 7267 2069 7320 7365 6c66 2c20 6967   arg is self, ig
-00010f40: 6e6f 7265 0a20 2020 2020 2020 2069 6620  nore.        if 
-00010f50: 6f6e 6c79 5f77 6974 685f 6465 6661 756c  only_with_defaul
-00010f60: 743a 0a20 2020 2020 2020 2020 2020 2069  t:.            i
-00010f70: 6620 6172 675f 7370 6563 2e64 6566 6175  f arg_spec.defau
-00010f80: 6c74 733a 0a20 2020 2020 2020 2020 2020  lts:.           
-00010f90: 2020 2020 2061 7373 6572 7420 6c65 6e28       assert len(
-00010fa0: 6172 675f 7370 6563 2e64 6566 6175 6c74  arg_spec.default
-00010fb0: 7329 203c 3d20 6c65 6e28 6172 6773 290a  s) <= len(args).
-00010fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010fd0: 6172 6773 203d 2061 7267 735b 6c65 6e28  args = args[len(
-00010fe0: 6172 6773 2920 2d20 6c65 6e28 6172 675f  args) - len(arg_
-00010ff0: 7370 6563 2e64 6566 6175 6c74 7329 203a  spec.defaults) :
-00011000: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00011010: 2020 6173 7365 7274 206c 656e 2861 7267    assert len(arg
-00011020: 5f73 7065 632e 6465 6661 756c 7473 2920  _spec.defaults) 
-00011030: 3d3d 206c 656e 2861 7267 7329 2c20 6172  == len(args), ar
-00011040: 675f 7370 6563 0a20 2020 2020 2020 2020  g_spec.         
-00011050: 2020 2020 2020 2066 6f72 2061 7267 2c20         for arg, 
-00011060: 6465 6661 756c 7420 696e 207a 6970 2861  default in zip(a
-00011070: 7267 732c 2061 7267 5f73 7065 632e 6465  rgs, arg_spec.de
-00011080: 6661 756c 7473 293a 0a20 2020 2020 2020  faults):.       
-00011090: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
-000110a0: 7267 735b 6172 675d 203d 2064 6566 6175  rgs[arg] = defau
-000110b0: 6c74 0a20 2020 2020 2020 2065 6c73 653a  lt.        else:
-000110c0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000110d0: 2061 7267 2069 6e20 6172 6773 3a0a 2020   arg in args:.  
-000110e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000110f0: 2061 7267 206e 6f74 2069 6e20 6b77 6172   arg not in kwar
-00011100: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00011110: 2020 2020 2020 2020 6b77 6172 6773 2e61          kwargs.a
-00011120: 7070 656e 6428 6172 6729 0a20 2020 2072  ppend(arg).    r
-00011130: 6574 7572 6e20 6b77 6172 6773 0a0a 0a64  eturn kwargs...d
-00011140: 6566 2067 6574 6172 6773 7065 6328 6675  ef getargspec(fu
-00011150: 6e63 293a 0a20 2020 2022 2222 0a20 2020  nc):.    """.   
-00011160: 203a 6675 6e63 3a60 696e 7370 6563 742e   :func:`inspect.
-00011170: 6765 7466 756c 6c61 7267 7370 6563 6020  getfullargspec` 
-00011180: 6f72 2060 696e 7370 6563 742e 6765 7461  or `inspect.geta
-00011190: 7267 7370 6563 6020 2850 7974 686f 6e20  rgspec` (Python 
-000111a0: 3229 0a0a 2020 2020 3a70 6172 616d 2066  2)..    :param f
-000111b0: 756e 633a 0a20 2020 203a 7265 7475 726e  unc:.    :return
-000111c0: 3a20 4675 6c6c 4172 6753 7065 630a 2020  : FullArgSpec.  
-000111d0: 2020 2222 220a 2020 2020 6966 2050 5933    """.    if PY3
-000111e0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000111f0: 2069 6e73 7065 6374 2e67 6574 6675 6c6c   inspect.getfull
-00011200: 6172 6773 7065 6328 6675 6e63 290a 2020  argspec(func).  
-00011210: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00011220: 2320 6e6f 696e 7370 6563 7469 6f6e 2050  # noinspection P
-00011230: 7944 6570 7265 6361 7469 6f6e 0a20 2020  yDeprecation.   
-00011240: 2020 2020 2072 6574 7572 6e20 696e 7370       return insp
-00011250: 6563 742e 6765 7461 7267 7370 6563 2866  ect.getargspec(f
-00011260: 756e 6329 0a0a 0a64 6566 2063 6f6c 6c65  unc)...def colle
-00011270: 6374 5f6d 616e 6461 746f 7279 5f63 6c61  ct_mandatory_cla
-00011280: 7373 5f69 6e69 745f 6b77 6172 6773 2863  ss_init_kwargs(c
-00011290: 6c73 293a 0a20 2020 2022 2222 0a20 2020  ls):.    """.   
-000112a0: 203a 7061 7261 6d20 7479 7065 2063 6c73   :param type cls
-000112b0: 3a0a 2020 2020 3a72 6574 7572 6e3a 206c  :.    :return: l
-000112c0: 6973 7420 6f66 206b 7761 7267 7320 7768  ist of kwargs wh
-000112d0: 6963 6820 6861 7665 206e 6f20 6465 6661  ich have no defa
-000112e0: 756c 742c 2069 2e65 2e20 7768 6963 6820  ult, i.e. which 
-000112f0: 6d75 7374 2062 6520 7072 6f76 6964 6564  must be provided
-00011300: 0a20 2020 203a 7274 7970 653a 206c 6973  .    :rtype: lis
-00011310: 745b 7374 725d 0a20 2020 2022 2222 0a20  t[str].    """. 
-00011320: 2020 2061 6c6c 5f6b 7761 7267 7320 3d20     all_kwargs = 
-00011330: 636f 6c6c 6563 745f 636c 6173 735f 696e  collect_class_in
-00011340: 6974 5f6b 7761 7267 7328 636c 732c 206f  it_kwargs(cls, o
-00011350: 6e6c 795f 7769 7468 5f64 6566 6175 6c74  nly_with_default
-00011360: 3d46 616c 7365 290a 2020 2020 6465 6661  =False).    defa
-00011370: 756c 745f 6b77 6172 6773 203d 2063 6f6c  ult_kwargs = col
-00011380: 6c65 6374 5f63 6c61 7373 5f69 6e69 745f  lect_class_init_
-00011390: 6b77 6172 6773 2863 6c73 2c20 6f6e 6c79  kwargs(cls, only
-000113a0: 5f77 6974 685f 6465 6661 756c 743d 5472  _with_default=Tr
-000113b0: 7565 290a 2020 2020 6d61 6e64 6174 6f72  ue).    mandator
-000113c0: 795f 6b77 6172 6773 203d 205b 5d0a 2020  y_kwargs = [].  
-000113d0: 2020 666f 7220 6172 6720 696e 2061 6c6c    for arg in all
-000113e0: 5f6b 7761 7267 733a 0a20 2020 2020 2020  _kwargs:.       
-000113f0: 2069 6620 6172 6720 6e6f 7420 696e 2064   if arg not in d
-00011400: 6566 6175 6c74 5f6b 7761 7267 733a 0a20  efault_kwargs:. 
-00011410: 2020 2020 2020 2020 2020 206d 616e 6461             manda
-00011420: 746f 7279 5f6b 7761 7267 732e 6170 7065  tory_kwargs.appe
-00011430: 6e64 2861 7267 290a 2020 2020 7265 7475  nd(arg).    retu
-00011440: 726e 206d 616e 6461 746f 7279 5f6b 7761  rn mandatory_kwa
-00011450: 7267 730a 0a0a 6465 6620 6865 6c70 5f6f  rgs...def help_o
-00011460: 6e5f 7479 7065 5f65 7272 6f72 5f77 726f  n_type_error_wro
-00011470: 6e67 5f61 7267 7328 636c 732c 206b 7761  ng_args(cls, kwa
-00011480: 7267 7329 3a0a 2020 2020 2222 220a 2020  rgs):.    """.  
-00011490: 2020 3a70 6172 616d 2074 7970 6520 636c    :param type cl
-000114a0: 733a 0a20 2020 203a 7061 7261 6d20 6c69  s:.    :param li
-000114b0: 7374 5b73 7472 5d20 6b77 6172 6773 3a0a  st[str] kwargs:.
-000114c0: 2020 2020 2222 220a 2020 2020 6d61 6e64      """.    mand
-000114d0: 6174 6f72 795f 6172 6773 203d 2063 6f6c  atory_args = col
-000114e0: 6c65 6374 5f6d 616e 6461 746f 7279 5f63  lect_mandatory_c
-000114f0: 6c61 7373 5f69 6e69 745f 6b77 6172 6773  lass_init_kwargs
-00011500: 2863 6c73 290a 2020 2020 666f 7220 6172  (cls).    for ar
-00011510: 6720 696e 206b 7761 7267 733a 0a20 2020  g in kwargs:.   
-00011520: 2020 2020 2069 6620 6172 6720 696e 206d       if arg in m
-00011530: 616e 6461 746f 7279 5f61 7267 733a 0a20  andatory_args:. 
-00011540: 2020 2020 2020 2020 2020 206d 616e 6461             manda
-00011550: 746f 7279 5f61 7267 732e 7265 6d6f 7665  tory_args.remove
-00011560: 2861 7267 290a 2020 2020 616c 6c5f 6b77  (arg).    all_kw
-00011570: 6172 6773 203d 2063 6f6c 6c65 6374 5f63  args = collect_c
-00011580: 6c61 7373 5f69 6e69 745f 6b77 6172 6773  lass_init_kwargs
-00011590: 2863 6c73 290a 2020 2020 756e 6b6e 6f77  (cls).    unknow
-000115a0: 6e5f 6172 6773 203d 205b 5d0a 2020 2020  n_args = [].    
-000115b0: 666f 7220 6172 6720 696e 206b 7761 7267  for arg in kwarg
-000115c0: 733a 0a20 2020 2020 2020 2069 6620 6172  s:.        if ar
-000115d0: 6720 6e6f 7420 696e 2061 6c6c 5f6b 7761  g not in all_kwa
-000115e0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-000115f0: 2075 6e6b 6e6f 776e 5f61 7267 732e 6170   unknown_args.ap
-00011600: 7065 6e64 2861 7267 290a 2020 2020 6966  pend(arg).    if
-00011610: 206d 616e 6461 746f 7279 5f61 7267 7320   mandatory_args 
-00011620: 6f72 2075 6e6b 6e6f 776e 5f61 7267 733a  or unknown_args:
-00011630: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-00011640: 4172 6773 206d 6973 6d61 7463 683f 204d  Args mismatch? M
-00011650: 6973 7369 6e67 2061 7265 2025 722c 2075  issing are %r, u
-00011660: 6e6b 6e6f 776e 7320 6172 6520 2572 2e20  nknowns are %r. 
-00011670: 4b77 6172 6773 2025 722e 2220 2520 286d  Kwargs %r." % (m
-00011680: 616e 6461 746f 7279 5f61 7267 732c 2075  andatory_args, u
-00011690: 6e6b 6e6f 776e 5f61 7267 732c 206b 7761  nknown_args, kwa
-000116a0: 7267 7329 290a 0a0a 6465 6620 6375 7374  rgs))...def cust
-000116b0: 6f6d 5f65 7865 6328 736f 7572 6365 2c20  om_exec(source, 
-000116c0: 736f 7572 6365 5f66 696c 656e 616d 652c  source_filename,
-000116d0: 2075 7365 725f 6e73 2c20 7573 6572 5f67   user_ns, user_g
-000116e0: 6c6f 6261 6c5f 6e73 293a 0a20 2020 2022  lobal_ns):.    "
-000116f0: 2222 0a20 2020 203a 7061 7261 6d20 7374  "".    :param st
-00011700: 7220 736f 7572 6365 3a0a 2020 2020 3a70  r source:.    :p
-00011710: 6172 616d 2073 7472 2073 6f75 7263 655f  aram str source_
-00011720: 6669 6c65 6e61 6d65 3a0a 2020 2020 3a70  filename:.    :p
-00011730: 6172 616d 2064 6963 745b 7374 725d 2075  aram dict[str] u
-00011740: 7365 725f 6e73 3a0a 2020 2020 3a70 6172  ser_ns:.    :par
-00011750: 616d 2064 6963 745b 7374 725d 2075 7365  am dict[str] use
-00011760: 725f 676c 6f62 616c 5f6e 733a 0a20 2020  r_global_ns:.   
-00011770: 203a 7265 7475 726e 3a20 6e6f 7468 696e   :return: nothin
-00011780: 670a 2020 2020 2222 220a 2020 2020 6966  g.    """.    if
-00011790: 206e 6f74 2073 6f75 7263 652e 656e 6473   not source.ends
-000117a0: 7769 7468 2822 5c6e 2229 3a0a 2020 2020  with("\n"):.    
-000117b0: 2020 2020 736f 7572 6365 202b 3d20 225c      source += "\
-000117c0: 6e22 0a20 2020 2063 6f20 3d20 636f 6d70  n".    co = comp
-000117d0: 696c 6528 736f 7572 6365 2c20 736f 7572  ile(source, sour
-000117e0: 6365 5f66 696c 656e 616d 652c 2022 6578  ce_filename, "ex
-000117f0: 6563 2229 0a20 2020 2075 7365 725f 676c  ec").    user_gl
-00011800: 6f62 616c 5f6e 735b 225f 5f70 6163 6b61  obal_ns["__packa
-00011810: 6765 5f5f 225d 203d 2022 7265 7475 726e  ge__"] = "return
-00011820: 6e22 2020 2320 696d 706f 7274 616e 7420  n"  # important 
-00011830: 736f 2074 6861 7420 696d 706f 7274 7320  so that imports 
-00011840: 776f 726b 0a20 2020 2065 7661 6c28 636f  work.    eval(co
-00011850: 2c20 7573 6572 5f67 6c6f 6261 6c5f 6e73  , user_global_ns
-00011860: 2c20 7573 6572 5f6e 7329 0a0a 0a63 6c61  , user_ns)...cla
-00011870: 7373 2046 726f 7a65 6e44 6963 7428 6469  ss FrozenDict(di
-00011880: 6374 293a 0a20 2020 2022 2222 0a20 2020  ct):.    """.   
-00011890: 2046 726f 7a65 6e20 6469 6374 2e0a 2020   Frozen dict..  
-000118a0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-000118b0: 5f73 6574 6974 656d 5f5f 2873 656c 662c  _setitem__(self,
-000118c0: 206b 6579 2c20 7661 6c75 6529 3a0a 2020   key, value):.  
-000118d0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000118e0: 6545 7272 6f72 2822 4672 6f7a 656e 4469  eError("FrozenDi
-000118f0: 6374 2063 616e 6e6f 7420 6265 206d 6f64  ct cannot be mod
-00011900: 6966 6965 6422 290a 0a20 2020 2064 6566  ified")..    def
-00011910: 205f 5f68 6173 685f 5f28 7365 6c66 293a   __hash__(self):
-00011920: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00011930: 6861 7368 2874 7570 6c65 2873 6f72 7465  hash(tuple(sorte
-00011940: 6428 7365 6c66 2e69 7465 6d73 2829 2929  d(self.items()))
-00011950: 290a 0a0a 6465 6620 6d61 6b65 5f68 6173  )...def make_has
-00011960: 6861 626c 6528 6f62 6a29 3a0a 2020 2020  hable(obj):.    
-00011970: 2222 220a 2020 2020 5468 6561 6e6f 206e  """.    Theano n
-00011980: 6565 6473 2068 6173 6861 626c 6520 6f62  eeds hashable ob
-00011990: 6a65 6374 7320 696e 2073 6f6d 6520 6361  jects in some ca
-000119a0: 7365 732c 2065 2e67 2e20 7468 6520 7072  ses, e.g. the pr
-000119b0: 6f70 6572 7469 6573 206f 6620 4f70 732e  operties of Ops.
-000119c0: 0a20 2020 2054 6869 7320 636f 6e76 6572  .    This conver
-000119d0: 7473 2061 6c6c 206f 626a 6563 7473 2061  ts all objects a
-000119e0: 7320 7375 6368 2c20 692e 652e 2069 6e74  s such, i.e. int
-000119f0: 6f20 696d 6d75 7461 626c 6520 6672 6f7a  o immutable froz
-00011a00: 656e 2074 7970 6573 2e0a 0a20 2020 203a  en types...    :
-00011a10: 7061 7261 6d20 547c 6469 6374 7c6c 6973  param T|dict|lis
-00011a20: 747c 7475 706c 6520 6f62 6a3a 0a20 2020  t|tuple obj:.   
-00011a30: 203a 7274 7970 653a 2054 7c46 726f 7a65   :rtype: T|Froze
-00011a40: 6e44 6963 747c 7475 706c 650a 2020 2020  nDict|tuple.    
-00011a50: 2222 220a 2020 2020 6966 2069 7369 6e73  """.    if isins
-00011a60: 7461 6e63 6528 6f62 6a2c 2064 6963 7429  tance(obj, dict)
-00011a70: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00011a80: 2046 726f 7a65 6e44 6963 7428 5b6d 616b   FrozenDict([mak
-00011a90: 655f 6861 7368 6162 6c65 2869 7465 6d29  e_hashable(item)
-00011aa0: 2066 6f72 2069 7465 6d20 696e 206f 626a   for item in obj
-00011ab0: 2e69 7465 6d73 2829 5d29 0a20 2020 2069  .items()]).    i
-00011ac0: 6620 6973 696e 7374 616e 6365 286f 626a  f isinstance(obj
-00011ad0: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
-00011ae0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00011af0: 2074 7570 6c65 285b 6d61 6b65 5f68 6173   tuple([make_has
-00011b00: 6861 626c 6528 6974 656d 2920 666f 7220  hable(item) for 
-00011b10: 6974 656d 2069 6e20 6f62 6a5d 290a 2020  item in obj]).  
-00011b20: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00011b30: 6f62 6a2c 2028 7374 722c 2075 6e69 636f  obj, (str, unico
-00011b40: 6465 2c20 666c 6f61 742c 2069 6e74 2c20  de, float, int, 
-00011b50: 6c6f 6e67 2929 3a0a 2020 2020 2020 2020  long)):.        
-00011b60: 7265 7475 726e 206f 626a 0a20 2020 2069  return obj.    i
-00011b70: 6620 6f62 6a20 6973 204e 6f6e 653a 0a20  f obj is None:. 
-00011b80: 2020 2020 2020 2072 6574 7572 6e20 6f62         return ob
-00011b90: 6a0a 2020 2020 6966 2022 7465 6e73 6f72  j.    if "tensor
-00011ba0: 666c 6f77 2220 696e 2073 7973 2e6d 6f64  flow" in sys.mod
-00011bb0: 756c 6573 3a0a 2020 2020 2020 2020 696d  ules:.        im
-00011bc0: 706f 7274 2074 656e 736f 7266 6c6f 7720  port tensorflow 
-00011bd0: 6173 2074 660a 0a20 2020 2020 2020 2069  as tf..        i
-00011be0: 6620 6973 696e 7374 616e 6365 286f 626a  f isinstance(obj
-00011bf0: 2c20 7466 2e54 656e 736f 7229 3a0a 2020  , tf.Tensor):.  
-00011c00: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00011c10: 2052 6566 4964 4571 286f 626a 290a 2020   RefIdEq(obj).  
-00011c20: 2020 6173 7365 7274 2046 616c 7365 2c20    assert False, 
-00011c30: 2264 6f6e 2774 206b 6e6f 7720 686f 7720  "don't know how 
-00011c40: 746f 206d 616b 6520 6861 7368 6162 6c65  to make hashable
-00011c50: 3a20 2572 2028 2572 2922 2025 2028 6f62  : %r (%r)" % (ob
-00011c60: 6a2c 2074 7970 6528 6f62 6a29 290a 0a0a  j, type(obj))...
-00011c70: 636c 6173 7320 5265 6649 6445 7128 4765  class RefIdEq(Ge
-00011c80: 6e65 7269 635b 545d 293a 0a20 2020 2022  neric[T]):.    "
-00011c90: 2222 0a20 2020 2052 6566 6572 656e 6365  "".    Reference
-00011ca0: 2074 6f20 736f 6d65 206f 626a 6563 7420   to some object 
-00011cb0: 2865 2e67 2e20 742e 6654 656e 736f 7229  (e.g. t.fTensor)
-00011cc0: 2c20 6275 7420 7468 6973 206f 626a 6563  , but this objec
-00011cd0: 7420 6973 2061 6c77 6179 7320 6861 7368  t is always hash
-00011ce0: 6162 6c65 2c0a 2020 2020 616e 6420 7573  able,.    and us
-00011cf0: 6573 2074 6865 2060 6964 6020 6f66 2074  es the `id` of t
-00011d00: 6865 2066 756e 6374 696f 6e20 666f 7220  he function for 
-00011d10: 7468 6520 6861 7368 2061 6e64 2065 7175  the hash and equ
-00011d20: 616c 6974 792e 0a0a 2020 2020 2849 6e20  ality...    (In 
-00011d30: 6361 7365 206f 6620 7466 2e54 656e 736f  case of tf.Tenso
-00011d40: 722c 2074 6869 7320 6973 2066 6f72 2063  r, this is for c
-00011d50: 6f6d 7061 7469 6269 6c69 7479 0a20 2020  ompatibility.   
-00011d60: 2020 6265 6361 7573 6520 7466 2e54 656e    because tf.Ten
-00011d70: 736f 722e 7265 6628 2920 7761 7320 6e6f  sor.ref() was no
-00011d80: 7420 6176 6169 6c61 626c 6520 696e 2065  t available in e
-00011d90: 6172 6c69 6572 2054 4620 7665 7273 696f  arlier TF versio
-00011da0: 6e73 2e0a 2020 2020 2048 6f77 6576 6572  ns..     However
-00011db0: 2c20 7765 2061 6c73 6f20 6e65 6564 2074  , we also need t
-00011dc0: 6869 7320 666f 7220 3a63 6c61 7373 3a60  his for :class:`
-00011dd0: 4469 6374 5265 664b 6579 7360 2e29 0a20  DictRefKeys`.). 
-00011de0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-00011df0: 5f5f 696e 6974 5f5f 2873 656c 662c 206f  __init__(self, o
-00011e00: 626a 3a20 5429 3a0a 2020 2020 2020 2020  bj: T):.        
-00011e10: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
-00011e20: 616d 206f 626a 3a20 666f 7220 6578 616d  am obj: for exam
-00011e30: 706c 6520 7466 2e54 656e 736f 720a 2020  ple tf.Tensor.  
-00011e40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00011e50: 2020 7365 6c66 2e6f 626a 203d 206f 626a    self.obj = obj
-00011e60: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
-00011e70: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-00011e80: 2020 7265 7475 726e 2022 5465 6e73 6f72    return "Tensor
-00011e90: 5265 667b 2572 7d22 2025 2073 656c 662e  Ref{%r}" % self.
-00011ea0: 6f62 6a0a 0a20 2020 2064 6566 205f 5f65  obj..    def __e
-00011eb0: 715f 5f28 7365 6c66 2c20 6f74 6865 7229  q__(self, other)
-00011ec0: 3a0a 2020 2020 2020 2020 6966 206f 7468  :.        if oth
-00011ed0: 6572 2069 7320 4e6f 6e65 206f 7220 6e6f  er is None or no
-00011ee0: 7420 6973 696e 7374 616e 6365 286f 7468  t isinstance(oth
-00011ef0: 6572 2c20 5265 6649 6445 7129 3a0a 2020  er, RefIdEq):.  
-00011f00: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00011f10: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
-00011f20: 6574 7572 6e20 7365 6c66 2e6f 626a 2069  eturn self.obj i
-00011f30: 7320 6f74 6865 722e 6f62 6a0a 0a20 2020  s other.obj..   
-00011f40: 2064 6566 205f 5f6e 655f 5f28 7365 6c66   def __ne__(self
-00011f50: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
-00011f60: 2020 7265 7475 726e 206e 6f74 2073 656c    return not sel
-00011f70: 662e 5f5f 6571 5f5f 286f 7468 6572 290a  f.__eq__(other).
-00011f80: 0a20 2020 2064 6566 205f 5f68 6173 685f  .    def __hash_
-00011f90: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-00011fa0: 2072 6574 7572 6e20 6964 2873 656c 662e   return id(self.
-00011fb0: 6f62 6a29 0a0a 0a63 6c61 7373 2044 6963  obj)...class Dic
-00011fc0: 7452 6566 4b65 7973 2847 656e 6572 6963  tRefKeys(Generic
-00011fd0: 5b4b 2c20 565d 293a 0a20 2020 2022 2222  [K, V]):.    """
-00011fe0: 0a20 2020 204c 696b 6520 6064 6963 7460  .    Like `dict`
-00011ff0: 2c20 6275 7420 6861 7368 2061 6e64 2065  , but hash and e
-00012000: 7175 616c 6974 7920 6f66 2074 6865 206b  quality of the k
-00012010: 6579 730a 2020 2020 2222 220a 0a20 2020  eys.    """..   
-00012020: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00012030: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
-00012040: 662e 5f64 203d 207b 7d20 2023 2074 7970  f._d = {}  # typ
-00012050: 653a 2044 6963 745b 5265 6649 6445 715b  e: Dict[RefIdEq[
-00012060: 4b5d 2c20 565d 0a0a 2020 2020 6465 6620  K], V]..    def 
-00012070: 5f5f 7265 7072 5f5f 2873 656c 6629 3a0a  __repr__(self):.
-00012080: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00012090: 4469 6374 5265 664b 6579 7328 2573 2922  DictRefKeys(%s)"
-000120a0: 2025 2022 2c20 222e 6a6f 696e 285b 2225   % ", ".join(["%
-000120b0: 723a 2025 7222 2025 2028 6b2c 2076 2920  r: %r" % (k, v) 
-000120c0: 666f 7220 286b 2c20 7629 2069 6e20 7365  for (k, v) in se
-000120d0: 6c66 2e69 7465 6d73 2829 5d29 0a0a 2020  lf.items()])..  
-000120e0: 2020 6465 6620 6974 656d 7328 7365 6c66    def items(self
-000120f0: 2920 2d3e 2049 7465 7261 626c 655b 5475  ) -> Iterable[Tu
-00012100: 706c 655b 4b2c 2056 5d5d 3a0a 2020 2020  ple[K, V]]:.    
-00012110: 2020 2020 2222 2269 7465 6d73 2222 220a      """items""".
-00012120: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-00012130: 2069 6e20 7365 6c66 2e5f 642e 6974 656d   in self._d.item
-00012140: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00012150: 2079 6965 6c64 206b 2e6f 626a 2c20 760a   yield k.obj, v.
-00012160: 0a20 2020 2064 6566 206b 6579 7328 7365  .    def keys(se
-00012170: 6c66 2920 2d3e 2049 7465 7261 626c 655b  lf) -> Iterable[
-00012180: 4b5d 3a0a 2020 2020 2020 2020 2222 226b  K]:.        """k
-00012190: 6579 7322 2222 0a20 2020 2020 2020 2066  eys""".        f
-000121a0: 6f72 206b 2069 6e20 7365 6c66 2e5f 642e  or k in self._d.
-000121b0: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
-000121c0: 2020 2020 7969 656c 6420 6b2e 6f62 6a0a      yield k.obj.
-000121d0: 0a20 2020 2064 6566 2076 616c 7565 7328  .    def values(
-000121e0: 7365 6c66 2920 2d3e 2049 7465 7261 626c  self) -> Iterabl
-000121f0: 655b 565d 3a0a 2020 2020 2020 2020 2222  e[V]:.        ""
-00012200: 2276 616c 7565 7322 2222 0a20 2020 2020  "values""".     
-00012210: 2020 2066 6f72 2076 2069 6e20 7365 6c66     for v in self
-00012220: 2e5f 642e 7661 6c75 6573 2829 3a0a 2020  ._d.values():.  
-00012230: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
-00012240: 760a 0a20 2020 2064 6566 205f 5f67 6574  v..    def __get
-00012250: 6974 656d 5f5f 2873 656c 662c 2069 7465  item__(self, ite
-00012260: 6d3a 204b 2920 2d3e 2056 3a0a 2020 2020  m: K) -> V:.    
-00012270: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00012280: 5f64 5b52 6566 4964 4571 2869 7465 6d29  _d[RefIdEq(item)
-00012290: 5d0a 0a20 2020 2064 6566 205f 5f73 6574  ]..    def __set
-000122a0: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
-000122b0: 3a20 4b2c 2076 616c 7565 3a20 5629 3a0a  : K, value: V):.
-000122c0: 2020 2020 2020 2020 7365 6c66 2e5f 645b          self._d[
-000122d0: 5265 6649 6445 7128 6b65 7929 5d20 3d20  RefIdEq(key)] = 
-000122e0: 7661 6c75 650a 0a20 2020 2064 6566 205f  value..    def _
-000122f0: 5f63 6f6e 7461 696e 735f 5f28 7365 6c66  _contains__(self
-00012300: 2c20 6974 656d 3a20 4b29 3a0a 2020 2020  , item: K):.    
-00012310: 2020 2020 7265 7475 726e 2052 6566 4964      return RefId
-00012320: 4571 2869 7465 6d29 2069 6e20 7365 6c66  Eq(item) in self
-00012330: 2e5f 640a 0a0a 6465 6620 6d61 6b65 5f64  ._d...def make_d
-00012340: 6c6c 5f6e 616d 6528 6261 7365 6e61 6d65  ll_name(basename
-00012350: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00012360: 7061 7261 6d20 7374 7220 6261 7365 6e61  param str basena
-00012370: 6d65 3a0a 2020 2020 3a72 6574 7572 6e3a  me:.    :return:
-00012380: 2065 2e67 2e20 226c 6962 2573 2e73 6f22   e.g. "lib%s.so"
-00012390: 2025 2062 6173 656e 616d 652c 2064 6570   % basename, dep
-000123a0: 656e 6469 6e67 206f 6e20 7379 732e 706c  ending on sys.pl
-000123b0: 6174 666f 726d 0a20 2020 203a 7274 7970  atform.    :rtyp
-000123c0: 653a 2073 7472 0a20 2020 2022 2222 0a20  e: str.    """. 
-000123d0: 2020 2069 6620 7379 732e 706c 6174 666f     if sys.platfo
-000123e0: 726d 203d 3d20 2264 6172 7769 6e22 3a0a  rm == "darwin":.
-000123f0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00012400: 6c69 6225 732e 6479 6c69 6222 2025 2062  lib%s.dylib" % b
-00012410: 6173 656e 616d 650a 2020 2020 656c 6966  asename.    elif
-00012420: 2073 7973 2e70 6c61 7466 6f72 6d20 3d3d   sys.platform ==
-00012430: 2022 7769 6e33 3222 3a0a 2020 2020 2020   "win32":.      
-00012440: 2020 7265 7475 726e 2022 2573 2e64 6c6c    return "%s.dll
-00012450: 2220 2520 6261 7365 6e61 6d65 0a20 2020  " % basename.   
-00012460: 2065 6c73 653a 2020 2320 4c69 6e75 782c   else:  # Linux,
-00012470: 2055 6e69 780a 2020 2020 2020 2020 7265   Unix.        re
-00012480: 7475 726e 2022 6c69 6225 732e 736f 2220  turn "lib%s.so" 
-00012490: 2520 6261 7365 6e61 6d65 0a0a 0a64 6566  % basename...def
-000124a0: 2065 7363 6170 655f 635f 7374 7228 7329   escape_c_str(s)
-000124b0: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
-000124c0: 6172 616d 2073 7472 2073 3a0a 2020 2020  aram str s:.    
-000124d0: 3a72 6574 7572 6e3a 2043 2d65 7363 6170  :return: C-escap
-000124e0: 6564 2073 7472 0a20 2020 203a 7274 7970  ed str.    :rtyp
-000124f0: 653a 2073 7472 0a20 2020 2022 2222 0a20  e: str.    """. 
-00012500: 2020 2072 6574 7572 6e20 2722 2573 2227     return '"%s"'
-00012510: 2025 2073 2e72 6570 6c61 6365 2822 5c5c   % s.replace("\\
-00012520: 5c5c 222c 2022 5c5c 2229 2e72 6570 6c61  \\", "\\").repla
-00012530: 6365 2822 5c6e 222c 2022 5c5c 6e22 292e  ce("\n", "\\n").
-00012540: 7265 706c 6163 6528 2722 272c 2027 5c5c  replace('"', '\\
-00012550: 2227 292e 7265 706c 6163 6528 2227 222c  "').replace("'",
-00012560: 2022 5c5c 2722 290a 0a0a 6465 6620 6174   "\\'")...def at
-00012570: 7472 5f63 6861 696e 2862 6173 652c 2061  tr_chain(base, a
-00012580: 7474 7269 6273 293a 0a20 2020 2022 2222  ttribs):.    """
-00012590: 0a20 2020 203a 7061 7261 6d20 6f62 6a65  .    :param obje
-000125a0: 6374 2062 6173 653a 0a20 2020 203a 7061  ct base:.    :pa
-000125b0: 7261 6d20 6c69 7374 5b73 7472 5d7c 7475  ram list[str]|tu
-000125c0: 706c 655b 7374 725d 7c73 7472 2061 7474  ple[str]|str att
-000125d0: 7269 6273 3a0a 2020 2020 3a72 6574 7572  ribs:.    :retur
-000125e0: 6e3a 2067 6574 6174 7472 2867 6574 6174  n: getattr(getat
-000125f0: 7472 286f 626a 6563 742c 2061 7474 7269  tr(object, attri
-00012600: 6273 5b30 5d29 2c20 6174 7472 6962 735b  bs[0]), attribs[
-00012610: 315d 2920 2e2e 2e0a 2020 2020 3a72 7479  1]) ....    :rty
-00012620: 7065 3a20 6f62 6a65 6374 0a20 2020 2022  pe: object.    "
-00012630: 2222 0a20 2020 2069 6620 6e6f 7420 6973  "".    if not is
-00012640: 696e 7374 616e 6365 2861 7474 7269 6273  instance(attribs
-00012650: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
-00012660: 3a0a 2020 2020 2020 2020 6173 7365 7274  :.        assert
-00012670: 2069 7369 6e73 7461 6e63 6528 6174 7472   isinstance(attr
-00012680: 6962 732c 2073 7472 290a 2020 2020 2020  ibs, str).      
-00012690: 2020 6174 7472 6962 7320 3d20 5b61 7474    attribs = [att
-000126a0: 7269 6273 5d0a 2020 2020 656c 7365 3a0a  ribs].    else:.
-000126b0: 2020 2020 2020 2020 6174 7472 6962 7320          attribs 
-000126c0: 3d20 6c69 7374 2861 7474 7269 6273 290a  = list(attribs).
-000126d0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-000126e0: 6765 286c 656e 2861 7474 7269 6273 2929  ge(len(attribs))
-000126f0: 3a0a 2020 2020 2020 2020 6261 7365 203d  :.        base =
-00012700: 2067 6574 6174 7472 2862 6173 652c 2061   getattr(base, a
-00012710: 7474 7269 6273 5b69 5d29 0a20 2020 2072  ttribs[i]).    r
-00012720: 6574 7572 6e20 6261 7365 0a0a 0a64 6566  eturn base...def
-00012730: 2074 6f5f 626f 6f6c 2876 293a 0a20 2020   to_bool(v):.   
-00012740: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
-00012750: 696e 747c 666c 6f61 747c 7374 7220 763a  int|float|str v:
-00012760: 2069 6620 6974 2069 7320 6120 7374 7269   if it is a stri
-00012770: 6e67 2c20 6974 2073 686f 756c 6420 7265  ng, it should re
-00012780: 7072 6573 656e 7420 736f 6d65 2069 6e74  present some int
-00012790: 6567 6572 2c20 6f72 2061 6c74 6572 6e61  eger, or alterna
-000127a0: 7469 7665 6c79 2022 7472 7565 2220 6f72  tively "true" or
-000127b0: 2022 6661 6c73 6522 0a20 2020 203a 7274   "false".    :rt
-000127c0: 7970 653a 2062 6f6f 6c0a 2020 2020 2222  ype: bool.    ""
-000127d0: 220a 2020 2020 7472 793a 0a20 2020 2020  ".    try:.     
-000127e0: 2020 2072 6574 7572 6e20 626f 6f6c 2869     return bool(i
-000127f0: 6e74 2876 2929 0a20 2020 2065 7863 6570  nt(v)).    excep
-00012800: 7420 5661 6c75 6545 7272 6f72 3a0a 2020  t ValueError:.  
-00012810: 2020 2020 2020 7061 7373 0a20 2020 2069        pass.    i
-00012820: 6620 6973 696e 7374 616e 6365 2876 2c20  f isinstance(v, 
-00012830: 2873 7472 2c20 756e 6963 6f64 6529 293a  (str, unicode)):
-00012840: 0a20 2020 2020 2020 2076 203d 2076 2e6c  .        v = v.l
-00012850: 6f77 6572 2829 0a20 2020 2020 2020 2069  ower().        i
-00012860: 6620 7620 696e 205b 2274 7275 6522 2c20  f v in ["true", 
-00012870: 2279 6573 222c 2022 6f6e 222c 2022 3122  "yes", "on", "1"
-00012880: 5d3a 0a20 2020 2020 2020 2020 2020 2072  ]:.            r
-00012890: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-000128a0: 2020 2069 6620 7620 696e 205b 2266 616c     if v in ["fal
-000128b0: 7365 222c 2022 6e6f 222c 2022 6f66 6622  se", "no", "off"
-000128c0: 2c20 2230 225d 3a0a 2020 2020 2020 2020  , "0"]:.        
-000128d0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-000128e0: 0a20 2020 2072 6169 7365 2056 616c 7565  .    raise Value
-000128f0: 4572 726f 7228 2274 6f5f 626f 6f6c 2063  Error("to_bool c
-00012900: 616e 6e6f 7420 6861 6e64 6c65 2025 7222  annot handle %r"
-00012910: 2025 2076 290a 0a0a 6465 6620 6173 5f73   % v)...def as_s
-00012920: 7472 2873 293a 0a20 2020 2022 2222 0a20  tr(s):.    """. 
-00012930: 2020 203a 7061 7261 6d20 7374 727c 756e     :param str|un
-00012940: 6963 6f64 657c 6279 7465 7320 733a 0a20  icode|bytes s:. 
-00012950: 2020 203a 7274 7970 653a 2073 7472 7c75     :rtype: str|u
-00012960: 6e69 636f 6465 0a20 2020 2022 2222 0a20  nicode.    """. 
-00012970: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00012980: 2873 2c20 7374 7229 206f 7220 2275 6e69  (s, str) or "uni
-00012990: 636f 6465 2220 696e 2073 7472 2874 7970  code" in str(typ
-000129a0: 6528 7329 293a 0a20 2020 2020 2020 2072  e(s)):.        r
-000129b0: 6574 7572 6e20 730a 2020 2020 6966 2069  eturn s.    if i
-000129c0: 7369 6e73 7461 6e63 6528 732c 2062 7974  sinstance(s, byt
-000129d0: 6573 2920 6f72 2069 7369 6e73 7461 6e63  es) or isinstanc
-000129e0: 6528 732c 2075 6e69 636f 6465 293a 0a20  e(s, unicode):. 
-000129f0: 2020 2020 2020 2023 206e 6f69 6e73 7065         # noinspe
-00012a00: 6374 696f 6e20 5079 556e 7265 736f 6c76  ction PyUnresolv
-00012a10: 6564 5265 6665 7265 6e63 6573 0a20 2020  edReferences.   
-00012a20: 2020 2020 2072 6574 7572 6e20 732e 6465       return s.de
-00012a30: 636f 6465 2822 7574 6638 2229 0a20 2020  code("utf8").   
-00012a40: 2061 7373 6572 7420 4661 6c73 652c 2022   assert False, "
-00012a50: 756e 6b6e 6f77 6e20 7479 7065 2025 7322  unknown type %s"
-00012a60: 2025 2074 7970 6528 7329 0a0a 0a64 6566   % type(s)...def
-00012a70: 2070 7932 5f75 7466 385f 7374 725f 746f   py2_utf8_str_to
-00012a80: 5f75 6e69 636f 6465 2873 293a 0a20 2020  _unicode(s):.   
-00012a90: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
-00012aa0: 7374 7220 733a 2065 2e67 2e20 7468 6520  str s: e.g. the 
-00012ab0: 7374 7269 6e67 206c 6974 6572 616c 2022  string literal "
-00012ac0: c3a4 c3b6 c3bc 2220 696e 2050 7974 686f  ......" in Pytho
-00012ad0: 6e20 3320 6973 2063 6f72 7265 6374 2c20  n 3 is correct, 
-00012ae0: 6275 7420 696e 2050 7974 686f 6e20 3220  but in Python 2 
-00012af0: 6974 2073 686f 756c 6420 6861 7665 2062  it should have b
-00012b00: 6565 6e20 7522 c3a4 c3b6 c3bc 222c 0a20  een u"......",. 
-00012b10: 2020 2020 2062 7574 206a 7573 7420 7573       but just us
-00012b20: 696e 6720 22c3 a4c3 b6c3 bc22 2077 696c  ing "......" wil
-00012b30: 6c20 6163 7475 616c 6c79 2062 6520 7468  l actually be th
-00012b40: 6520 7261 7720 7574 6638 2062 7974 6520  e raw utf8 byte 
-00012b50: 7365 7175 656e 6365 2e0a 2020 2020 2020  sequence..      
-00012b60: 5468 6973 2063 616e 2068 6170 7065 6e20  This can happen 
-00012b70: 7768 656e 2079 6f75 2065 7661 6c28 2920  when you eval() 
-00012b80: 736f 6d65 2073 7472 696e 672e 0a20 2020  some string..   
-00012b90: 2020 2057 6520 6173 7375 6d65 2074 6861     We assume tha
-00012ba0: 7420 796f 7520 6172 6520 7573 696e 6720  t you are using 
-00012bb0: 5079 7468 6f6e 2032 2c20 616e 6420 676f  Python 2, and go
-00012bc0: 7420 7468 6520 7374 7269 6e67 2028 6e6f  t the string (no
-00012bd0: 7420 756e 6963 6f64 6520 6f62 6a65 6374  t unicode object
-00012be0: 2920 22c3 a4c3 b6c3 bc22 2c20 6f72 206d  ) "......", or m
-00012bf0: 6179 6265 2022 6162 6322 2e0a 2020 2020  aybe "abc"..    
-00012c00: 2020 416c 736f 2073 6565 203a 6675 6e63    Also see :func
-00012c10: 3a60 5f70 7932 5f75 6e69 636f 6465 5f74  :`_py2_unicode_t
-00012c20: 6f5f 7374 725f 7265 6375 7273 6976 6560  o_str_recursive`
-00012c30: 2061 6e64 203a 6675 6e63 3a60 6173 5f73   and :func:`as_s
-00012c40: 7472 602e 0a20 2020 203a 7265 7475 726e  tr`..    :return
-00012c50: 3a20 6966 2069 7420 6973 2069 6e64 6565  : if it is indee
-00012c60: 6420 756e 6963 6f64 652c 2069 7420 7769  d unicode, it wi
-00012c70: 6c6c 2072 6574 7572 6e20 7468 6520 756e  ll return the un
-00012c80: 6963 6f64 6520 6f62 6a65 6374 2c20 6f74  icode object, ot
-00012c90: 6865 7277 6973 6520 6974 206b 6565 7073  herwise it keeps
-00012ca0: 2074 6865 2073 7472 696e 670a 2020 2020   the string.    
-00012cb0: 3a72 7479 7065 3a20 7374 727c 756e 6963  :rtype: str|unic
-00012cc0: 6f64 650a 2020 2020 2222 220a 2020 2020  ode.    """.    
-00012cd0: 6173 7365 7274 206e 6f74 2050 5933 0a20  assert not PY3. 
-00012ce0: 2020 2061 7373 6572 7420 6973 696e 7374     assert isinst
-00012cf0: 616e 6365 2873 2c20 7374 7229 0a20 2020  ance(s, str).   
-00012d00: 2074 7279 3a0a 2020 2020 2020 2020 2320   try:.        # 
-00012d10: 6e6f 696e 7370 6563 7469 6f6e 2050 7955  noinspection PyU
-00012d20: 6e72 6573 6f6c 7665 6452 6566 6572 656e  nresolvedReferen
-00012d30: 6365 730a 2020 2020 2020 2020 732e 6465  ces.        s.de
-00012d40: 636f 6465 2822 6173 6369 6922 290a 2020  code("ascii").  
-00012d50: 2020 2020 2020 7265 7475 726e 2073 0a20        return s. 
-00012d60: 2020 2065 7863 6570 7420 556e 6963 6f64     except Unicod
-00012d70: 6544 6563 6f64 6545 7272 6f72 3a0a 2020  eDecodeError:.  
-00012d80: 2020 2020 2020 7061 7373 0a20 2020 2023        pass.    #
-00012d90: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
-00012da0: 556e 7265 736f 6c76 6564 5265 6665 7265  UnresolvedRefere
-00012db0: 6e63 6573 0a20 2020 2072 6574 7572 6e20  nces.    return 
-00012dc0: 732e 6465 636f 6465 2822 7574 6638 2229  s.decode("utf8")
-00012dd0: 0a0a 0a64 6566 2075 6e69 636f 6465 5f74  ...def unicode_t
-00012de0: 6f5f 7374 7228 7329 3a0a 2020 2020 2222  o_str(s):.    ""
-00012df0: 220a 2020 2020 5468 6520 6265 6861 7669  ".    The behavi
-00012e00: 6f72 2069 7320 6469 6666 6572 656e 7420  or is different 
-00012e10: 6465 7065 6e64 696e 6720 6f6e 2050 7974  depending on Pyt
-00012e20: 686f 6e20 3220 6f72 2050 7974 686f 6e20  hon 2 or Python 
-00012e30: 332e 2049 6e20 616c 6c20 6361 7365 732c  3. In all cases,
-00012e40: 2074 6865 2072 6574 7572 6e65 6420 7479   the returned ty
-00012e50: 7065 2069 7320 6120 7374 7220 6f62 6a65  pe is a str obje
-00012e60: 6374 2e0a 2020 2020 5079 7468 6f6e 2032  ct..    Python 2
-00012e70: 3a0a 2020 2020 2020 5765 2072 6574 7572  :.      We retur
-00012e80: 6e20 7468 6520 7574 6638 2065 6e63 6f64  n the utf8 encod
-00012e90: 6564 2073 7472 2028 7768 6963 6820 6973  ed str (which is
-00012ea0: 206c 696b 6520 5079 7468 6f6e 2033 2062   like Python 3 b
-00012eb0: 7974 6573 2c20 6f72 2066 6f72 2041 5343  ytes, or for ASC
-00012ec0: 4949 2c20 7468 6572 6520 6973 206e 6f20  II, there is no 
-00012ed0: 6469 6666 6572 656e 6365 292e 0a20 2020  difference)..   
-00012ee0: 2050 7974 686f 6e20 333a 0a20 2020 2020   Python 3:.     
-00012ef0: 2057 6520 7265 7475 726e 2061 2073 7472   We return a str
-00012f00: 206f 626a 6563 742e 0a20 2020 204e 6f74   object..    Not
-00012f10: 6520 7468 6174 2074 6869 7320 6675 6e63  e that this func
-00012f20: 7469 6f6e 2070 726f 6261 626c 7920 646f  tion probably do
-00012f30: 6573 206e 6f74 206d 616b 6520 6d75 6368  es not make much
-00012f40: 2073 656e 7365 2e0a 2020 2020 4974 206d   sense..    It m
-00012f50: 6967 6874 2062 6520 7573 6564 2077 6865  ight be used whe
-00012f60: 6e20 7468 6572 6520 6973 206f 7468 6572  n there is other
-00012f70: 2063 6f64 6520 7768 6963 6820 6578 7065   code which expe
-00012f80: 6374 7320 6120 7374 7220 6f62 6a65 6374  cts a str object
-00012f90: 2c20 6e6f 206d 6174 7465 7220 6966 2050  , no matter if P
-00012fa0: 7974 686f 6e20 3220 6f72 2050 7974 686f  ython 2 or Pytho
-00012fb0: 6e20 332e 0a20 2020 2049 6e20 5079 7468  n 3..    In Pyth
-00012fc0: 6f6e 2032 2c20 6120 7374 7220 6f62 6a65  on 2, a str obje
-00012fd0: 6374 206f 6674 656e 2068 6f6c 6473 2055  ct often holds U
-00012fe0: 5446 3820 7465 7874 2c20 736f 2074 6865  TF8 text, so the
-00012ff0: 2062 6568 6176 696f 7220 6f66 2074 6869   behavior of thi
-00013000: 7320 6675 6e63 7469 6f6e 2069 7320 6669  s function is fi
-00013010: 6e65 2074 6865 6e2e 0a20 2020 2041 6c73  ne then..    Als
-00013020: 6f20 7365 6520 3a66 756e 633a 6061 735f  o see :func:`as_
-00013030: 7374 7260 2e0a 0a20 2020 203a 7061 7261  str`...    :para
-00013040: 6d20 7374 727c 756e 6963 6f64 657c 6279  m str|unicode|by
-00013050: 7465 7320 733a 0a20 2020 203a 7274 7970  tes s:.    :rtyp
-00013060: 653a 2073 7472 0a20 2020 2022 2222 0a20  e: str.    """. 
-00013070: 2020 2069 6620 5059 3320 616e 6420 6973     if PY3 and is
-00013080: 696e 7374 616e 6365 2873 2c20 6279 7465  instance(s, byte
-00013090: 7329 3a0a 2020 2020 2020 2020 7320 3d20  s):.        s = 
-000130a0: 732e 6465 636f 6465 2822 7574 6638 2229  s.decode("utf8")
-000130b0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-000130c0: 6973 696e 7374 616e 6365 2873 2c20 7374  isinstance(s, st
-000130d0: 7229 0a20 2020 2069 6620 6e6f 7420 5059  r).    if not PY
-000130e0: 3320 616e 6420 6973 696e 7374 616e 6365  3 and isinstance
-000130f0: 2873 2c20 756e 6963 6f64 6529 3a0a 2020  (s, unicode):.  
-00013100: 2020 2020 2020 7320 3d20 732e 656e 636f        s = s.enco
-00013110: 6465 2822 7574 6638 2229 0a20 2020 2020  de("utf8").     
-00013120: 2020 2061 7373 6572 7420 6973 696e 7374     assert isinst
-00013130: 616e 6365 2873 2c20 7374 7229 0a20 2020  ance(s, str).   
-00013140: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
-00013150: 6365 2873 2c20 7374 7229 0a20 2020 2072  ce(s, str).    r
-00013160: 6574 7572 6e20 730a 0a0a 6465 6620 6465  eturn s...def de
-00013170: 6570 636f 7079 2878 2c20 7374 6f70 5f74  epcopy(x, stop_t
-00013180: 7970 6573 3d4e 6f6e 6529 3a0a 2020 2020  ypes=None):.    
-00013190: 2222 220a 2020 2020 5369 6d70 6c65 7220  """.    Simpler 
-000131a0: 7661 7269 616e 7420 6f66 2063 6f70 792e  variant of copy.
-000131b0: 6465 6570 636f 7079 2829 2e0a 2020 2020  deepcopy()..    
-000131c0: 5368 6f75 6c64 2068 616e 646c 6520 736f  Should handle so
-000131d0: 6d65 2065 6467 6520 6361 7365 7320 6173  me edge cases as
-000131e0: 2077 656c 6c2c 206c 696b 6520 636f 7079   well, like copy
-000131f0: 696e 6720 6d6f 6475 6c65 2072 6566 6572  ing module refer
-00013200: 656e 6365 732e 0a0a 2020 2020 3a70 6172  ences...    :par
-00013210: 616d 2054 2078 3a20 616e 2061 7262 6974  am T x: an arbit
-00013220: 7261 7279 206f 626a 6563 740a 2020 2020  rary object.    
-00013230: 3a70 6172 616d 206c 6973 745b 7479 7065  :param list[type
-00013240: 5d7c 4e6f 6e65 2073 746f 705f 7479 7065  ]|None stop_type
-00013250: 733a 206f 626a 6563 7473 206f 6620 7468  s: objects of th
-00013260: 6573 6520 7479 7065 7320 7769 6c6c 206e  ese types will n
-00013270: 6f74 2062 6520 6465 6570 2d63 6f70 6965  ot be deep-copie
-00013280: 642c 206f 6e6c 7920 7468 6520 7265 6665  d, only the refe
-00013290: 7265 6e63 6520 6973 2070 6173 7365 640a  rence is passed.
-000132a0: 2020 2020 3a72 7479 7065 3a20 540a 2020      :rtype: T.  
-000132b0: 2020 2222 220a 2020 2020 2320 5365 6520    """.    # See 
-000132c0: 616c 736f 2063 6c61 7373 2050 6963 6b6c  also class Pickl
-000132d0: 6572 2066 726f 6d20 5461 736b 5379 7374  er from TaskSyst
-000132e0: 656d 2e0a 2020 2020 2320 4f72 3a20 6874  em..    # Or: ht
-000132f0: 7470 733a 2f2f 6d61 696c 2e70 7974 686f  tps://mail.pytho
-00013300: 6e2e 6f72 672f 7069 7065 726d 6169 6c2f  n.org/pipermail/
-00013310: 7079 7468 6f6e 2d69 6465 6173 2f32 3031  python-ideas/201
-00013320: 332d 4a75 6c79 2f30 3231 3935 392e 6874  3-July/021959.ht
-00013330: 6d6c 0a20 2020 2066 726f 6d20 2e74 6173  ml.    from .tas
-00013340: 6b5f 7379 7374 656d 2069 6d70 6f72 7420  k_system import 
-00013350: 5069 636b 6c65 722c 2055 6e70 6963 6b6c  Pickler, Unpickl
-00013360: 6572 0a0a 2020 2020 7065 7273 6973 7465  er..    persiste
-00013370: 6e74 5f6d 656d 6f20 3d20 7b7d 2020 2320  nt_memo = {}  # 
-00013380: 6964 202d 3e20 6f62 6a0a 0a20 2020 2064  id -> obj..    d
-00013390: 6566 2070 6572 7369 7374 656e 745f 6964  ef persistent_id
-000133a0: 286f 626a 293a 0a20 2020 2020 2020 2022  (obj):.        "
-000133b0: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
-000133c0: 6d20 6f62 6a65 6374 206f 626a 3a0a 2020  m object obj:.  
-000133d0: 2020 2020 2020 3a72 7479 7065 3a20 696e        :rtype: in
-000133e0: 747c 4e6f 6e65 0a20 2020 2020 2020 2022  t|None.        "
-000133f0: 2222 0a20 2020 2020 2020 2069 6620 7374  "".        if st
-00013400: 6f70 5f74 7970 6573 2061 6e64 2069 7369  op_types and isi
-00013410: 6e73 7461 6e63 6528 6f62 6a2c 2074 7570  nstance(obj, tup
-00013420: 6c65 2873 746f 705f 7479 7065 7329 293a  le(stop_types)):
-00013430: 0a20 2020 2020 2020 2020 2020 2070 6572  .            per
-00013440: 7369 7374 656e 745f 6d65 6d6f 5b69 6428  sistent_memo[id(
-00013450: 6f62 6a29 5d20 3d20 6f62 6a0a 2020 2020  obj)] = obj.    
-00013460: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-00013470: 6428 6f62 6a29 0a20 2020 2020 2020 2072  d(obj).        r
-00013480: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
-00013490: 6465 6620 7069 636b 6c65 5f64 756d 7073  def pickle_dumps
-000134a0: 286f 626a 293a 0a20 2020 2020 2020 2022  (obj):.        "
-000134b0: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
-000134c0: 6d20 6f62 6a65 6374 206f 626a 3a0a 2020  m object obj:.  
-000134d0: 2020 2020 2020 3a72 7479 7065 3a20 6279        :rtype: by
-000134e0: 7465 730a 2020 2020 2020 2020 2222 220a  tes.        """.
-000134f0: 2020 2020 2020 2020 7369 6f20 3d20 4279          sio = By
-00013500: 7465 7349 4f28 290a 2020 2020 2020 2020  tesIO().        
-00013510: 7020 3d20 5069 636b 6c65 7228 7369 6f29  p = Pickler(sio)
-00013520: 0a20 2020 2020 2020 2070 2e70 6572 7369  .        p.persi
-00013530: 7374 656e 745f 6964 203d 2070 6572 7369  stent_id = persi
-00013540: 7374 656e 745f 6964 0a20 2020 2020 2020  stent_id.       
-00013550: 2070 2e64 756d 7028 6f62 6a29 0a20 2020   p.dump(obj).   
-00013560: 2020 2020 2072 6574 7572 6e20 7369 6f2e       return sio.
-00013570: 6765 7476 616c 7565 2829 0a0a 2020 2020  getvalue()..    
-00013580: 2320 6e6f 696e 7370 6563 7469 6f6e 2050  # noinspection P
-00013590: 7953 6861 646f 7769 6e67 4e61 6d65 730a  yShadowingNames.
-000135a0: 2020 2020 6465 6620 7069 636b 6c65 5f6c      def pickle_l
-000135b0: 6f61 6473 2873 293a 0a20 2020 2020 2020  oads(s):.       
-000135c0: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
-000135d0: 7261 6d20 6279 7465 7320 733a 0a20 2020  ram bytes s:.   
-000135e0: 2020 2020 203a 7274 7970 653a 206f 626a       :rtype: obj
-000135f0: 6563 740a 2020 2020 2020 2020 2222 220a  ect.        """.
-00013600: 2020 2020 2020 2020 7020 3d20 556e 7069          p = Unpi
-00013610: 636b 6c65 7228 4279 7465 7349 4f28 7329  ckler(BytesIO(s)
-00013620: 290a 2020 2020 2020 2020 702e 7065 7273  ).        p.pers
-00013630: 6973 7465 6e74 5f6c 6f61 6420 3d20 7065  istent_load = pe
-00013640: 7273 6973 7465 6e74 5f6d 656d 6f2e 5f5f  rsistent_memo.__
-00013650: 6765 7469 7465 6d5f 5f0a 2020 2020 2020  getitem__.      
-00013660: 2020 7265 7475 726e 2070 2e6c 6f61 6428    return p.load(
-00013670: 290a 0a20 2020 2073 203d 2070 6963 6b6c  )..    s = pickl
-00013680: 655f 6475 6d70 7328 7829 0a20 2020 2063  e_dumps(x).    c
-00013690: 203d 2070 6963 6b6c 655f 6c6f 6164 7328   = pickle_loads(
-000136a0: 7329 0a20 2020 2072 6574 7572 6e20 630a  s).    return c.
-000136b0: 0a0a 6465 6620 6c6f 6164 5f74 7874 5f76  ..def load_txt_v
-000136c0: 6563 746f 7228 6669 6c65 6e61 6d65 293a  ector(filename):
-000136d0: 0a20 2020 2022 2222 0a20 2020 2045 7870  .    """.    Exp
-000136e0: 6563 7420 6c69 6e65 2d62 6173 6564 2074  ect line-based t
-000136f0: 6578 7420 656e 636f 6469 6e67 2069 6e20  ext encoding in 
-00013700: 6669 6c65 2e0a 2020 2020 5765 2061 6c73  file..    We als
-00013710: 6f20 7375 7070 6f72 7420 5370 7269 6e74  o support Sprint
-00013720: 2058 4d4c 2066 6f72 6d61 742c 2077 6869   XML format, whi
-00013730: 6368 2068 6173 2073 6f6d 6520 6164 6469  ch has some addi
-00013740: 7469 6f6e 616c 2078 6d6c 2068 6561 6465  tional xml heade
-00013750: 7220 616e 6420 666f 6f74 6572 2c0a 2020  r and footer,.  
-00013760: 2020 7768 6963 6820 7765 2077 696c 6c20    which we will 
-00013770: 6a75 7374 2073 7472 6970 2061 7761 792e  just strip away.
-00013780: 0a0a 2020 2020 3a70 6172 616d 2073 7472  ..    :param str
-00013790: 2066 696c 656e 616d 653a 0a20 2020 203a   filename:.    :
-000137a0: 7274 7970 653a 206c 6973 745b 666c 6f61  rtype: list[floa
-000137b0: 745d 0a20 2020 2022 2222 0a20 2020 2072  t].    """.    r
-000137c0: 6574 7572 6e20 5b66 6c6f 6174 286c 696e  eturn [float(lin
-000137d0: 6529 2066 6f72 206c 696e 6520 696e 206f  e) for line in o
-000137e0: 7065 6e28 6669 6c65 6e61 6d65 292e 7265  pen(filename).re
-000137f0: 6164 2829 2e73 706c 6974 6c69 6e65 7328  ad().splitlines(
-00013800: 2920 6966 206c 696e 6520 616e 6420 6e6f  ) if line and no
-00013810: 7420 6c69 6e65 2e73 7461 7274 7377 6974  t line.startswit
-00013820: 6828 223c 2229 5d0a 0a0a 636c 6173 7320  h("<")]...class 
-00013830: 436f 6c6c 6563 7469 6f6e 5265 6164 4368  CollectionReadCh
-00013840: 6563 6b43 6f76 6572 6564 3a0a 2020 2020  eckCovered:.    
-00013850: 2222 220a 2020 2020 5772 6170 7320 6172  """.    Wraps ar
-00013860: 6f75 6e64 2061 2064 6963 742e 2049 7420  ound a dict. It 
-00013870: 6b65 6570 7320 7472 6163 6b20 6162 6f75  keeps track abou
-00013880: 7420 616c 6c20 7468 6520 6b65 7973 2077  t all the keys w
-00013890: 6869 6368 2077 6572 6520 7265 6164 2066  hich were read f
-000138a0: 726f 6d20 7468 6520 6469 6374 2e0a 2020  rom the dict..  
-000138b0: 2020 5669 6120 3a66 756e 633a 6061 7373    Via :func:`ass
-000138c0: 6572 745f 616c 6c5f 7265 6164 602c 2079  ert_all_read`, y
-000138d0: 6f75 2063 616e 2063 6865 636b 2074 6861  ou can check tha
-000138e0: 7420 7468 6572 6520 6172 6520 6e6f 206b  t there are no k
-000138f0: 6579 7320 696e 2074 6865 2064 6963 7420  eys in the dict 
-00013900: 7768 6963 6820 7765 7265 206e 6f74 2072  which were not r
-00013910: 6561 642e 0a20 2020 2054 6865 2075 7361  ead..    The usa
-00013920: 6765 2069 7320 666f 7220 636f 6e66 6967  ge is for config
-00013930: 2064 6963 7420 6f70 7469 6f6e 732c 2077   dict options, w
-00013940: 6865 7265 2074 6865 2075 7365 7220 6861  here the user ha
-00013950: 7320 7370 6563 6966 6965 6420 6120 7261  s specified a ra
-00013960: 6e67 6520 6f66 206f 7074 696f 6e73 2c0a  nge of options,.
-00013970: 2020 2020 616e 6420 7768 6572 6520 696e      and where in
-00013980: 2074 6865 2063 6f64 6520 7468 6572 6520   the code there 
-00013990: 6973 2075 7375 616c 6c79 2061 2064 6566  is usually a def
-000139a0: 6175 6c74 2066 6f72 2065 7665 7279 206e  ault for every n
-000139b0: 6f6e 2d73 7065 6369 6669 6564 206f 7074  on-specified opt
-000139c0: 696f 6e2c 0a20 2020 2074 6f20 6368 6563  ion,.    to chec
-000139d0: 6b20 7768 6574 6865 7220 616c 6c20 7468  k whether all th
-000139e0: 6520 7573 6572 2d73 7065 6369 6669 6564  e user-specified
-000139f0: 206f 7074 696f 6e73 2061 7265 2061 6c73   options are als
-00013a00: 6f20 7573 6564 2028 6d61 7962 6520 7468  o used (maybe th
-00013a10: 6520 7573 6572 206d 6164 6520 6120 7479  e user made a ty
-00013a20: 706f 292e 0a20 2020 2022 2222 0a0a 2020  po)..    """..  
-00013a30: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00013a40: 656c 662c 2063 6f6c 6c65 6374 696f 6e2c  elf, collection,
-00013a50: 2074 7275 7468 5f76 616c 7565 3d4e 6f6e   truth_value=Non
-00013a60: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-00013a70: 2020 2020 2020 2020 3a70 6172 616d 2064          :param d
-00013a80: 6963 745b 7374 725d 2063 6f6c 6c65 6374  ict[str] collect
-00013a90: 696f 6e3a 0a20 2020 2020 2020 203a 7061  ion:.        :pa
-00013aa0: 7261 6d20 4e6f 6e65 7c62 6f6f 6c20 7472  ram None|bool tr
-00013ab0: 7574 685f 7661 6c75 653a 206e 6f74 653a  uth_value: note:
-00013ac0: 2063 6865 636b 2065 7870 6c69 6369 746c   check explicitl
-00013ad0: 7920 666f 7220 7365 6c66 2e74 7275 7468  y for self.truth
-00013ae0: 5f76 616c 7565 2c20 626f 6f6c 2873 656c  _value, bool(sel
-00013af0: 6629 2069 7320 6e6f 7420 7468 6520 7361  f) is not the sa
-00013b00: 6d65 210a 2020 2020 2020 2020 2222 220a  me!.        """.
-00013b10: 2020 2020 2020 2020 7365 6c66 2e63 6f6c          self.col
-00013b20: 6c65 6374 696f 6e20 3d20 636f 6c6c 6563  lection = collec
-00013b30: 7469 6f6e 0a20 2020 2020 2020 2069 6620  tion.        if 
-00013b40: 7472 7574 685f 7661 6c75 6520 6973 204e  truth_value is N
-00013b50: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00013b60: 2074 7275 7468 5f76 616c 7565 203d 2062   truth_value = b
-00013b70: 6f6f 6c28 7365 6c66 2e63 6f6c 6c65 6374  ool(self.collect
-00013b80: 696f 6e29 0a20 2020 2020 2020 2073 656c  ion).        sel
-00013b90: 662e 7472 7574 685f 7661 6c75 6520 3d20  f.truth_value = 
-00013ba0: 7472 7574 685f 7661 6c75 650a 2020 2020  truth_value.    
-00013bb0: 2020 2020 7365 6c66 2e67 6f74 5f69 7465      self.got_ite
-00013bc0: 6d73 203d 2073 6574 2829 0a0a 2020 2020  ms = set()..    
-00013bd0: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
-00013be0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-00013bf0: 726e 2022 2573 2825 722c 2074 7275 7468  rn "%s(%r, truth
-00013c00: 5f76 616c 7565 3d25 7229 2220 2520 2873  _value=%r)" % (s
-00013c10: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
-00013c20: 6e61 6d65 5f5f 2c20 7365 6c66 2e63 6f6c  name__, self.col
-00013c30: 6c65 6374 696f 6e2c 2073 656c 662e 7472  lection, self.tr
-00013c40: 7574 685f 7661 6c75 6529 0a0a 2020 2020  uth_value)..    
-00013c50: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00013c60: 2064 6566 2066 726f 6d5f 626f 6f6c 5f6f   def from_bool_o
-00013c70: 725f 6469 6374 2863 6c73 2c20 7661 6c75  r_dict(cls, valu
-00013c80: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-00013c90: 2020 2020 2020 2020 3a70 6172 616d 2062          :param b
-00013ca0: 6f6f 6c7c 6469 6374 5b73 7472 5d20 7661  ool|dict[str] va
-00013cb0: 6c75 653a 0a20 2020 2020 2020 203a 7274  lue:.        :rt
-00013cc0: 7970 653a 2043 6f6c 6c65 6374 696f 6e52  ype: CollectionR
-00013cd0: 6561 6443 6865 636b 436f 7665 7265 640a  eadCheckCovered.
-00013ce0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013cf0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00013d00: 6528 7661 6c75 652c 2062 6f6f 6c29 3a0a  e(value, bool):.
-00013d10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00013d20: 726e 2063 6c73 2863 6f6c 6c65 6374 696f  rn cls(collectio
-00013d30: 6e3d 7b7d 2c20 7472 7574 685f 7661 6c75  n={}, truth_valu
-00013d40: 653d 7661 6c75 6529 0a20 2020 2020 2020  e=value).       
-00013d50: 2069 6620 6973 696e 7374 616e 6365 2876   if isinstance(v
-00013d60: 616c 7565 2c20 6469 6374 293a 0a20 2020  alue, dict):.   
-00013d70: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00013d80: 636c 7328 636f 6c6c 6563 7469 6f6e 3d76  cls(collection=v
-00013d90: 616c 7565 290a 2020 2020 2020 2020 7261  alue).        ra
-00013da0: 6973 6520 5479 7065 4572 726f 7228 2269  ise TypeError("i
-00013db0: 6e76 616c 6964 2074 7970 653a 2025 7322  nvalid type: %s"
-00013dc0: 2025 2074 7970 6528 7661 6c75 6529 290a   % type(value)).
-00013dd0: 0a20 2020 2064 6566 205f 5f67 6574 6974  .    def __getit
-00013de0: 656d 5f5f 2873 656c 662c 2069 7465 6d29  em__(self, item)
-00013df0: 3a0a 2020 2020 2020 2020 7265 7320 3d20  :.        res = 
-00013e00: 7365 6c66 2e63 6f6c 6c65 6374 696f 6e5b  self.collection[
-00013e10: 6974 656d 5d0a 2020 2020 2020 2020 7365  item].        se
-00013e20: 6c66 2e67 6f74 5f69 7465 6d73 2e61 6464  lf.got_items.add
-00013e30: 2869 7465 6d29 0a20 2020 2020 2020 2072  (item).        r
-00013e40: 6574 7572 6e20 7265 730a 0a20 2020 2064  eturn res..    d
-00013e50: 6566 2067 6574 2873 656c 662c 2069 7465  ef get(self, ite
-00013e60: 6d2c 2064 6566 6175 6c74 3d4e 6f6e 6529  m, default=None)
-00013e70: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00013e80: 2020 2020 2020 3a70 6172 616d 2073 7472        :param str
-00013e90: 2069 7465 6d3a 0a20 2020 2020 2020 203a   item:.        :
-00013ea0: 7061 7261 6d20 5420 6465 6661 756c 743a  param T default:
-00013eb0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-00013ec0: 2054 7c74 7970 696e 672e 416e 797c 4e6f   T|typing.Any|No
-00013ed0: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
-00013ee0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00013ef0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00013f00: 656c 665b 6974 656d 5d0a 2020 2020 2020  elf[item].      
-00013f10: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-00013f20: 723a 0a20 2020 2020 2020 2020 2020 2072  r:.            r
-00013f30: 6574 7572 6e20 6465 6661 756c 740a 0a20  eturn default.. 
-00013f40: 2020 2064 6566 205f 5f62 6f6f 6c5f 5f28     def __bool__(
-00013f50: 7365 6c66 293a 2020 2320 5079 7468 6f6e  self):  # Python
-00013f60: 2033 0a20 2020 2020 2020 2072 6574 7572   3.        retur
-00013f70: 6e20 7365 6c66 2e74 7275 7468 5f76 616c  n self.truth_val
-00013f80: 7565 0a0a 2020 2020 5f5f 6e6f 6e7a 6572  ue..    __nonzer
-00013f90: 6f5f 5f20 3d20 5f5f 626f 6f6c 5f5f 2020  o__ = __bool__  
-00013fa0: 2320 5079 7468 6f6e 2032 0a0a 2020 2020  # Python 2..    
-00013fb0: 6465 6620 5f5f 6c65 6e5f 5f28 7365 6c66  def __len__(self
-00013fc0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00013fd0: 6e20 6c65 6e28 7365 6c66 2e63 6f6c 6c65  n len(self.colle
-00013fe0: 6374 696f 6e29 0a0a 2020 2020 6465 6620  ction)..    def 
-00013ff0: 5f5f 6974 6572 5f5f 2873 656c 6629 3a0a  __iter__(self):.
-00014000: 2020 2020 2020 2020 666f 7220 6b20 696e          for k in
-00014010: 2073 656c 662e 636f 6c6c 6563 7469 6f6e   self.collection
-00014020: 3a0a 2020 2020 2020 2020 2020 2020 7969  :.            yi
-00014030: 656c 6420 7365 6c66 5b6b 5d0a 0a20 2020  eld self[k]..   
-00014040: 2064 6566 2061 7373 6572 745f 616c 6c5f   def assert_all_
-00014050: 7265 6164 2873 656c 6629 3a0a 2020 2020  read(self):.    
-00014060: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00014070: 4173 7365 7274 7320 7468 6174 2061 6c6c  Asserts that all
-00014080: 2069 7465 6d73 2068 6176 6520 6265 656e   items have been
-00014090: 2072 6561 642e 0a20 2020 2020 2020 2022   read..        "
-000140a0: 2222 0a20 2020 2020 2020 2072 656d 6169  "".        remai
-000140b0: 6e69 6e67 203d 2073 6574 2873 656c 662e  ning = set(self.
-000140c0: 636f 6c6c 6563 7469 6f6e 292e 6469 6666  collection).diff
-000140d0: 6572 656e 6365 2873 656c 662e 676f 745f  erence(self.got_
-000140e0: 6974 656d 7329 0a20 2020 2020 2020 2061  items).        a
-000140f0: 7373 6572 7420 6e6f 7420 7265 6d61 696e  ssert not remain
-00014100: 696e 672c 2022 5468 6520 6b65 7973 2025  ing, "The keys %
-00014110: 7220 7765 7265 206e 6f74 2072 6561 6420  r were not read 
-00014120: 696e 2074 6865 2063 6f6c 6c65 6374 696f  in the collectio
-00014130: 6e20 2572 2e22 2025 2028 7265 6d61 696e  n %r." % (remain
-00014140: 696e 672c 2073 656c 662e 636f 6c6c 6563  ing, self.collec
-00014150: 7469 6f6e 290a 0a0a 6465 6620 7768 6963  tion)...def whic
-00014160: 6828 7072 6f67 7261 6d29 3a0a 2020 2020  h(program):.    
-00014170: 2222 220a 2020 2020 4669 6e64 7320 6070  """.    Finds `p
-00014180: 726f 6772 616d 6020 696e 2073 6f6d 6520  rogram` in some 
-00014190: 6f66 2074 6865 2064 6972 7320 6f66 2074  of the dirs of t
-000141a0: 6865 2050 4154 4820 656e 7620 7661 722e  he PATH env var.
-000141b0: 0a0a 2020 2020 3a70 6172 616d 2073 7472  ..    :param str
-000141c0: 2070 726f 6772 616d 3a20 652e 672e 2022   program: e.g. "
-000141d0: 7079 7468 6f6e 220a 2020 2020 3a72 6574  python".    :ret
-000141e0: 7572 6e3a 2066 756c 6c20 7061 7468 2c20  urn: full path, 
-000141f0: 652e 672e 2022 2f75 7372 2f62 696e 2f70  e.g. "/usr/bin/p
-00014200: 7974 686f 6e22 2c20 6f72 204e 6f6e 650a  ython", or None.
-00014210: 2020 2020 3a72 7479 7065 3a20 7374 727c      :rtype: str|
-00014220: 4e6f 6e65 0a20 2020 2022 2222 0a20 2020  None.    """.   
-00014230: 2023 206e 6f69 6e73 7065 6374 696f 6e20   # noinspection 
-00014240: 5079 5368 6164 6f77 696e 674e 616d 6573  PyShadowingNames
-00014250: 0a20 2020 2064 6566 2069 735f 6578 6528  .    def is_exe(
-00014260: 7061 7468 293a 0a20 2020 2020 2020 2022  path):.        "
-00014270: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
-00014280: 6d20 7374 7220 7061 7468 3a0a 2020 2020  m str path:.    
-00014290: 2020 2020 3a72 7479 7065 3a20 7374 720a      :rtype: str.
-000142a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000142b0: 2020 2020 7265 7475 726e 206f 732e 7061      return os.pa
-000142c0: 7468 2e69 7366 696c 6528 7061 7468 2920  th.isfile(path) 
-000142d0: 616e 6420 6f73 2e61 6363 6573 7328 7061  and os.access(pa
-000142e0: 7468 2c20 6f73 2e58 5f4f 4b29 0a0a 2020  th, os.X_OK)..  
-000142f0: 2020 6670 6174 682c 2066 6e61 6d65 203d    fpath, fname =
-00014300: 206f 732e 7061 7468 2e73 706c 6974 2870   os.path.split(p
-00014310: 726f 6772 616d 290a 2020 2020 6966 2066  rogram).    if f
-00014320: 7061 7468 3a0a 2020 2020 2020 2020 6966  path:.        if
-00014330: 2069 735f 6578 6528 7072 6f67 7261 6d29   is_exe(program)
-00014340: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00014350: 7475 726e 2070 726f 6772 616d 0a20 2020  turn program.   
-00014360: 2065 6c73 653a 0a20 2020 2020 2020 2066   else:.        f
-00014370: 6f72 2070 6174 6820 696e 206f 732e 656e  or path in os.en
-00014380: 7669 726f 6e5b 2250 4154 4822 5d2e 7370  viron["PATH"].sp
-00014390: 6c69 7428 6f73 2e70 6174 6873 6570 293a  lit(os.pathsep):
-000143a0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-000143b0: 6820 3d20 7061 7468 2e73 7472 6970 2827  h = path.strip('
-000143c0: 2227 290a 2020 2020 2020 2020 2020 2020  "').            
-000143d0: 6578 655f 6669 6c65 203d 206f 732e 7061  exe_file = os.pa
-000143e0: 7468 2e6a 6f69 6e28 7061 7468 2c20 7072  th.join(path, pr
-000143f0: 6f67 7261 6d29 0a20 2020 2020 2020 2020  ogram).         
-00014400: 2020 2069 6620 6973 5f65 7865 2865 7865     if is_exe(exe
-00014410: 5f66 696c 6529 3a0a 2020 2020 2020 2020  _file):.        
-00014420: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-00014430: 7865 5f66 696c 650a 0a20 2020 2072 6574  xe_file..    ret
-00014440: 7572 6e20 4e6f 6e65 0a0a 0a64 6566 2077  urn None...def w
-00014450: 6869 6368 5f70 6970 2829 3a0a 2020 2020  hich_pip():.    
-00014460: 2222 220a 2020 2020 3a72 7479 7065 3a20  """.    :rtype: 
-00014470: 7374 720a 2020 2020 3a72 6574 7572 6e3a  str.    :return:
-00014480: 2070 6174 6820 746f 2070 6970 2066 6f72   path to pip for
-00014490: 2074 6865 2063 7572 7265 6e74 2050 7974   the current Pyt
-000144a0: 686f 6e20 656e 760a 2020 2020 2222 220a  hon env.    """.
-000144b0: 2020 2020 2320 4265 666f 7265 2077 6520      # Before we 
-000144c0: 6c6f 6f6b 2061 6e79 7768 6572 6520 696e  look anywhere in
-000144d0: 2050 4154 482c 2063 6865 636b 2069 6620   PATH, check if 
-000144e0: 7468 6572 6520 6973 2073 6f6d 6520 7069  there is some pi
-000144f0: 7020 616c 6f6e 6773 6964 6520 746f 2074  p alongside to t
-00014500: 6865 2050 7974 686f 6e20 6578 6563 7574  he Python execut
-00014510: 6162 6c65 2e0a 2020 2020 2320 5468 6973  able..    # This
-00014520: 206d 6967 6874 2062 6520 6d6f 7265 2072   might be more r
-00014530: 656c 6961 626c 652e 0a20 2020 2070 7920  eliable..    py 
-00014540: 3d20 7379 732e 6578 6563 7574 6162 6c65  = sys.executable
-00014550: 0a20 2020 2064 6972 5f6e 616d 652c 2062  .    dir_name, b
-00014560: 6173 656e 616d 6520 3d20 7079 2e72 7370  asename = py.rsp
-00014570: 6c69 7428 222f 222c 2031 290a 2020 2020  lit("/", 1).    
-00014580: 6966 2062 6173 656e 616d 652e 7374 6172  if basename.star
-00014590: 7473 7769 7468 2822 7079 7468 6f6e 2229  tswith("python")
-000145a0: 3a0a 2020 2020 2020 2020 706f 7374 6669  :.        postfi
-000145b0: 7820 3d20 6261 7365 6e61 6d65 5b6c 656e  x = basename[len
-000145c0: 2822 7079 7468 6f6e 2229 203a 5d0a 2020  ("python") :].  
-000145d0: 2020 2020 2020 7069 705f 7061 7468 203d        pip_path =
-000145e0: 2022 2573 2f70 6970 2573 2220 2520 2864   "%s/pip%s" % (d
-000145f0: 6972 5f6e 616d 652c 2070 6f73 7466 6978  ir_name, postfix
-00014600: 290a 2020 2020 2020 2020 6966 206f 732e  ).        if os.
-00014610: 7061 7468 2e65 7869 7374 7328 7069 705f  path.exists(pip_
-00014620: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
-00014630: 2020 2072 6574 7572 6e20 7069 705f 7061     return pip_pa
-00014640: 7468 0a20 2020 2023 2047 656e 6572 6963  th.    # Generic
-00014650: 2066 616c 6c62 6163 6b2e 0a20 2020 2070   fallback..    p
-00014660: 6970 5f70 6174 6820 3d20 7768 6963 6828  ip_path = which(
-00014670: 2270 6970 2229 0a20 2020 2072 6574 7572  "pip").    retur
-00014680: 6e20 7069 705f 7061 7468 0a0a 0a64 6566  n pip_path...def
-00014690: 2070 6970 5f69 6e73 7461 6c6c 282a 706b   pip_install(*pk
-000146a0: 675f 6e61 6d65 7329 3a0a 2020 2020 2222  g_names):.    ""
-000146b0: 220a 2020 2020 496e 7374 616c 6c20 7061  ".    Install pa
-000146c0: 636b 6167 6573 2076 6961 2070 6970 2066  ckages via pip f
-000146d0: 6f72 2074 6865 2063 7572 7265 6e74 2050  or the current P
-000146e0: 7974 686f 6e20 656e 762e 0a0a 2020 2020  ython env...    
-000146f0: 3a70 6172 616d 2073 7472 2070 6b67 5f6e  :param str pkg_n
-00014700: 616d 6573 3a0a 2020 2020 2222 220a 2020  ames:.    """.  
-00014710: 2020 7079 203d 2073 7973 2e65 7865 6375    py = sys.execu
-00014720: 7461 626c 650a 2020 2020 7069 705f 7061  table.    pip_pa
-00014730: 7468 203d 2077 6869 6368 5f70 6970 2829  th = which_pip()
-00014740: 0a20 2020 2070 7269 6e74 2822 5069 7020  .    print("Pip 
-00014750: 696e 7374 616c 6c22 2c20 2a70 6b67 5f6e  install", *pkg_n
-00014760: 616d 6573 290a 2020 2020 696e 5f76 6972  ames).    in_vir
-00014770: 7475 616c 5f65 6e76 203d 2068 6173 6174  tual_env = hasat
-00014780: 7472 2873 7973 2c20 2272 6561 6c5f 7072  tr(sys, "real_pr
-00014790: 6566 6978 2229 2020 2320 6874 7470 733a  efix")  # https:
-000147a0: 2f2f 7374 6163 6b6f 7665 7266 6c6f 772e  //stackoverflow.
-000147b0: 636f 6d2f 7175 6573 7469 6f6e 732f 3138  com/questions/18
-000147c0: 3731 3534 392f 0a20 2020 2063 6d64 203d  71549/.    cmd =
-000147d0: 205b 7079 2c20 7069 705f 7061 7468 2c20   [py, pip_path, 
-000147e0: 2269 6e73 7461 6c6c 225d 0a20 2020 2069  "install"].    i
-000147f0: 6620 6e6f 7420 696e 5f76 6972 7475 616c  f not in_virtual
-00014800: 5f65 6e76 3a0a 2020 2020 2020 2020 636d  _env:.        cm
-00014810: 6420 2b3d 205b 222d 2d75 7365 7222 5d0a  d += ["--user"].
-00014820: 2020 2020 636d 6420 2b3d 206c 6973 7428      cmd += list(
-00014830: 706b 675f 6e61 6d65 7329 0a20 2020 2070  pkg_names).    p
-00014840: 7269 6e74 2822 2420 2573 2220 2520 2220  rint("$ %s" % " 
-00014850: 222e 6a6f 696e 2863 6d64 2929 0a20 2020  ".join(cmd)).   
-00014860: 2073 7562 7072 6f63 6573 732e 6368 6563   subprocess.chec
-00014870: 6b5f 6361 6c6c 2863 6d64 2c20 6377 643d  k_call(cmd, cwd=
-00014880: 222f 2229 0a20 2020 205f 7069 705f 696e  "/").    _pip_in
-00014890: 7374 616c 6c65 645f 7061 636b 6167 6573  stalled_packages
-000148a0: 2e63 6c65 6172 2829 2020 2320 666f 7263  .clear()  # forc
-000148b0: 6520 7265 6c6f 6164 0a0a 0a5f 7069 705f  e reload..._pip_
-000148c0: 696e 7374 616c 6c65 645f 7061 636b 6167  installed_packag
-000148d0: 6573 203d 2073 6574 2829 0a0a 0a64 6566  es = set()...def
-000148e0: 2070 6970 5f63 6865 636b 5f69 735f 696e   pip_check_is_in
-000148f0: 7374 616c 6c65 6428 706b 675f 6e61 6d65  stalled(pkg_name
-00014900: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00014910: 7061 7261 6d20 7374 7220 706b 675f 6e61  param str pkg_na
-00014920: 6d65 3a20 7769 7468 6f75 7420 7665 7273  me: without vers
-00014930: 696f 6e2c 2065 2e67 2e20 6a75 7374 2022  ion, e.g. just "
-00014940: 7465 6e73 6f72 666c 6f77 222c 206f 7220  tensorflow", or 
-00014950: 7769 7468 2076 6572 7369 6f6e 2c20 652e  with version, e.
-00014960: 672e 2022 7465 6e73 6f72 666c 6f77 3d3d  g. "tensorflow==
-00014970: 312e 322e 3322 0a20 2020 203a 7274 7970  1.2.3".    :rtyp
-00014980: 653a 2062 6f6f 6c0a 2020 2020 2222 220a  e: bool.    """.
-00014990: 2020 2020 6966 206e 6f74 205f 7069 705f      if not _pip_
-000149a0: 696e 7374 616c 6c65 645f 7061 636b 6167  installed_packag
-000149b0: 6573 3a0a 2020 2020 2020 2020 7079 203d  es:.        py =
-000149c0: 2073 7973 2e65 7865 6375 7461 626c 650a   sys.executable.
-000149d0: 2020 2020 2020 2020 7069 705f 7061 7468          pip_path
-000149e0: 203d 2077 6869 6368 5f70 6970 2829 0a20   = which_pip(). 
-000149f0: 2020 2020 2020 2063 6d64 203d 205b 7079         cmd = [py
-00014a00: 2c20 7069 705f 7061 7468 2c20 2266 7265  , pip_path, "fre
-00014a10: 657a 6522 5d0a 2020 2020 2020 2020 666f  eze"].        fo
-00014a20: 7220 6c69 6e65 2069 6e20 7379 735f 6578  r line in sys_ex
-00014a30: 6563 5f6f 7574 282a 636d 6429 2e73 706c  ec_out(*cmd).spl
-00014a40: 6974 6c69 6e65 7328 293a 0a20 2020 2020  itlines():.     
-00014a50: 2020 2020 2020 2069 6620 6c69 6e65 2061         if line a
-00014a60: 6e64 2022 3d3d 2220 696e 206c 696e 653a  nd "==" in line:
-00014a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014a80: 2069 6620 223d 3d22 206e 6f74 2069 6e20   if "==" not in 
-00014a90: 706b 675f 6e61 6d65 3a0a 2020 2020 2020  pkg_name:.      
-00014aa0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-00014ab0: 6e65 203d 206c 696e 655b 3a20 6c69 6e65  ne = line[: line
-00014ac0: 2e69 6e64 6578 2822 3d3d 2229 5d0a 2020  .index("==")].  
-00014ad0: 2020 2020 2020 2020 2020 2020 2020 5f70                _p
-00014ae0: 6970 5f69 6e73 7461 6c6c 6564 5f70 6163  ip_installed_pac
-00014af0: 6b61 6765 732e 6164 6428 6c69 6e65 290a  kages.add(line).
-00014b00: 2020 2020 7265 7475 726e 2070 6b67 5f6e      return pkg_n
-00014b10: 616d 6520 696e 205f 7069 705f 696e 7374  ame in _pip_inst
-00014b20: 616c 6c65 645f 7061 636b 6167 6573 0a0a  alled_packages..
-00014b30: 0a5f 6f72 6967 696e 616c 5f65 7865 6376  ._original_execv
-00014b40: 203d 204e 6f6e 650a 5f6f 7269 6769 6e61   = None._origina
-00014b50: 6c5f 6578 6563 7665 203d 204e 6f6e 650a  l_execve = None.
-00014b60: 5f6f 7269 6769 6e61 6c5f 6578 6563 7670  _original_execvp
-00014b70: 6520 3d20 4e6f 6e65 0a0a 0a64 6566 206f  e = None...def o
-00014b80: 7665 7277 7269 7465 5f6f 735f 6578 6563  verwrite_os_exec
-00014b90: 2870 7265 6669 785f 6172 6773 293a 0a20  (prefix_args):. 
-00014ba0: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
-00014bb0: 6d20 6c69 7374 5b73 7472 5d20 7072 6566  m list[str] pref
-00014bc0: 6978 5f61 7267 733a 0a20 2020 2022 2222  ix_args:.    """
-00014bd0: 0a20 2020 2067 6c6f 6261 6c20 5f6f 7269  .    global _ori
-00014be0: 6769 6e61 6c5f 6578 6563 762c 205f 6f72  ginal_execv, _or
-00014bf0: 6967 696e 616c 5f65 7865 6376 652c 205f  iginal_execve, _
-00014c00: 6f72 6967 696e 616c 5f65 7865 6376 7065  original_execvpe
-00014c10: 0a20 2020 2069 6620 6e6f 7420 5f6f 7269  .    if not _ori
-00014c20: 6769 6e61 6c5f 6578 6563 763a 0a20 2020  ginal_execv:.   
-00014c30: 2020 2020 205f 6f72 6967 696e 616c 5f65       _original_e
-00014c40: 7865 6376 203d 206f 732e 6578 6563 760a  xecv = os.execv.
-00014c50: 2020 2020 6966 206e 6f74 205f 6f72 6967      if not _orig
-00014c60: 696e 616c 5f65 7865 6376 653a 0a20 2020  inal_execve:.   
-00014c70: 2020 2020 205f 6f72 6967 696e 616c 5f65       _original_e
-00014c80: 7865 6376 6520 3d20 6f73 2e65 7865 6376  xecve = os.execv
-00014c90: 650a 2020 2020 6966 206e 6f74 205f 6f72  e.    if not _or
-00014ca0: 6967 696e 616c 5f65 7865 6376 7065 3a0a  iginal_execvpe:.
-00014cb0: 2020 2020 2020 2020 2320 6e6f 696e 7370          # noinsp
-00014cc0: 6563 7469 6f6e 2050 7950 726f 7465 6374  ection PyProtect
-00014cd0: 6564 4d65 6d62 6572 2c50 7955 6e72 6573  edMember,PyUnres
-00014ce0: 6f6c 7665 6452 6566 6572 656e 6365 730a  olvedReferences.
-00014cf0: 2020 2020 2020 2020 5f6f 7269 6769 6e61          _origina
-00014d00: 6c5f 6578 6563 7670 6520 3d20 6f73 2e5f  l_execvpe = os._
-00014d10: 6578 6563 7670 650a 0a20 2020 2023 206e  execvpe..    # n
-00014d20: 6f69 6e73 7065 6374 696f 6e20 5079 556e  oinspection PyUn
-00014d30: 7573 6564 4c6f 6361 6c0a 2020 2020 6465  usedLocal.    de
-00014d40: 6620 7772 6170 7065 645f 6578 6563 7670  f wrapped_execvp
-00014d50: 6528 6669 6c65 2c20 6172 6773 2c20 656e  e(file, args, en
-00014d60: 763d 4e6f 6e65 293a 0a20 2020 2020 2020  v=None):.       
-00014d70: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
-00014d80: 7261 6d20 6669 6c65 3a0a 2020 2020 2020  ram file:.      
-00014d90: 2020 3a70 6172 616d 206c 6973 745b 7374    :param list[st
-00014da0: 725d 7c74 7570 6c65 5b73 7472 5d20 6172  r]|tuple[str] ar
-00014db0: 6773 3a0a 2020 2020 2020 2020 3a70 6172  gs:.        :par
-00014dc0: 616d 2064 6963 745b 7374 725d 2065 6e76  am dict[str] env
-00014dd0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00014de0: 2020 2020 2020 6e65 775f 6172 6773 203d        new_args =
-00014df0: 2070 7265 6669 785f 6172 6773 202b 205b   prefix_args + [
-00014e00: 7768 6963 6828 6172 6773 5b30 5d29 5d20  which(args[0])] 
-00014e10: 2b20 6172 6773 5b31 3a5d 0a20 2020 2020  + args[1:].     
-00014e20: 2020 2073 7973 2e73 7464 6572 722e 7772     sys.stderr.wr
-00014e30: 6974 6528 2224 2025 735c 6e22 2025 2022  ite("$ %s\n" % "
-00014e40: 2022 2e6a 6f69 6e28 6e65 775f 6172 6773   ".join(new_args
-00014e50: 2929 0a20 2020 2020 2020 2073 7973 2e73  )).        sys.s
-00014e60: 7464 6572 722e 666c 7573 6828 290a 2020  tderr.flush().  
-00014e70: 2020 2020 2020 5f6f 7269 6769 6e61 6c5f        _original_
-00014e80: 6578 6563 7670 6528 6669 6c65 3d70 7265  execvpe(file=pre
-00014e90: 6669 785f 6172 6773 5b30 5d2c 2061 7267  fix_args[0], arg
-00014ea0: 733d 6e65 775f 6172 6773 2c20 656e 763d  s=new_args, env=
-00014eb0: 656e 7629 0a0a 2020 2020 6465 6620 6578  env)..    def ex
-00014ec0: 6563 7628 7061 7468 2c20 6172 6773 293a  ecv(path, args):
-00014ed0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00014ee0: 2020 2020 203a 7061 7261 6d20 7374 7220       :param str 
-00014ef0: 7061 7468 3a0a 2020 2020 2020 2020 3a70  path:.        :p
-00014f00: 6172 616d 206c 6973 745b 7374 725d 7c74  aram list[str]|t
-00014f10: 7570 6c65 5b73 7472 5d20 6172 6773 3a0a  uple[str] args:.
-00014f20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00014f30: 2020 2020 6966 2061 7267 735b 3a20 6c65      if args[: le
-00014f40: 6e28 7072 6566 6978 5f61 7267 7329 5d20  n(prefix_args)] 
-00014f50: 3d3d 2070 7265 6669 785f 6172 6773 3a0a  == prefix_args:.
-00014f60: 2020 2020 2020 2020 2020 2020 5f6f 7269              _ori
-00014f70: 6769 6e61 6c5f 6578 6563 7628 7061 7468  ginal_execv(path
-00014f80: 2c20 6172 6773 290a 2020 2020 2020 2020  , args).        
-00014f90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00014fa0: 2020 7772 6170 7065 645f 6578 6563 7670    wrapped_execvp
-00014fb0: 6528 7061 7468 2c20 6172 6773 290a 0a20  e(path, args).. 
-00014fc0: 2020 2064 6566 2065 7865 6376 6528 7061     def execve(pa
-00014fd0: 7468 2c20 6172 6773 2c20 656e 7629 3a0a  th, args, env):.
-00014fe0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00014ff0: 2020 2020 3a70 6172 616d 2073 7472 2070      :param str p
-00015000: 6174 683a 0a20 2020 2020 2020 203a 7061  ath:.        :pa
-00015010: 7261 6d20 6c69 7374 5b73 7472 5d7c 7475  ram list[str]|tu
-00015020: 706c 655b 7374 725d 2061 7267 733a 0a20  ple[str] args:. 
-00015030: 2020 2020 2020 203a 7061 7261 6d20 6469         :param di
-00015040: 6374 5b73 7472 5d20 656e 763a 0a20 2020  ct[str] env:.   
-00015050: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00015060: 2069 6620 6172 6773 5b3a 206c 656e 2870   if args[: len(p
-00015070: 7265 6669 785f 6172 6773 295d 203d 3d20  refix_args)] == 
-00015080: 7072 6566 6978 5f61 7267 733a 0a20 2020  prefix_args:.   
-00015090: 2020 2020 2020 2020 205f 6f72 6967 696e           _origin
-000150a0: 616c 5f65 7865 6376 6528 7061 7468 2c20  al_execve(path, 
-000150b0: 6172 6773 2c20 656e 7629 0a20 2020 2020  args, env).     
-000150c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000150d0: 2020 2020 2077 7261 7070 6564 5f65 7865       wrapped_exe
-000150e0: 6376 7065 2870 6174 682c 2061 7267 732c  cvpe(path, args,
-000150f0: 2065 6e76 290a 0a20 2020 2064 6566 2065   env)..    def e
-00015100: 7865 636c 2866 696c 652c 202a 6172 6773  xecl(file, *args
-00015110: 293a 0a20 2020 2020 2020 2022 2222 6578  ):.        """ex
-00015120: 6563 6c28 6669 6c65 2c20 2a61 7267 7329  ecl(file, *args)
-00015130: 0a0a 2020 2020 2020 2020 4578 6563 7574  ..        Execut
-00015140: 6520 7468 6520 6578 6563 7574 6162 6c65  e the executable
-00015150: 2066 696c 6520 7769 7468 2061 7267 756d   file with argum
-00015160: 656e 7420 6c69 7374 2061 7267 732c 2072  ent list args, r
-00015170: 6570 6c61 6369 6e67 2074 6865 0a20 2020  eplacing the.   
-00015180: 2020 2020 2063 7572 7265 6e74 2070 726f       current pro
-00015190: 6365 7373 2e22 2222 0a20 2020 2020 2020  cess.""".       
-000151a0: 206f 732e 6578 6563 7628 6669 6c65 2c20   os.execv(file, 
-000151b0: 6172 6773 290a 0a20 2020 2064 6566 2065  args)..    def e
-000151c0: 7865 636c 6528 6669 6c65 2c20 2a61 7267  xecle(file, *arg
-000151d0: 7329 3a0a 2020 2020 2020 2020 2222 2265  s):.        """e
-000151e0: 7865 636c 6528 6669 6c65 2c20 2a61 7267  xecle(file, *arg
-000151f0: 732c 2065 6e76 290a 0a20 2020 2020 2020  s, env)..       
-00015200: 2045 7865 6375 7465 2074 6865 2065 7865   Execute the exe
-00015210: 6375 7461 626c 6520 6669 6c65 2077 6974  cutable file wit
-00015220: 6820 6172 6775 6d65 6e74 206c 6973 7420  h argument list 
-00015230: 6172 6773 2061 6e64 0a20 2020 2020 2020  args and.       
-00015240: 2065 6e76 6972 6f6e 6d65 6e74 2065 6e76   environment env
-00015250: 2c20 7265 706c 6163 696e 6720 7468 6520  , replacing the 
-00015260: 6375 7272 656e 7420 7072 6f63 6573 732e  current process.
-00015270: 2222 220a 2020 2020 2020 2020 656e 7620  """.        env 
-00015280: 3d20 6172 6773 5b2d 315d 0a20 2020 2020  = args[-1].     
-00015290: 2020 206f 732e 6578 6563 7665 2866 696c     os.execve(fil
-000152a0: 652c 2061 7267 735b 3a2d 315d 2c20 656e  e, args[:-1], en
-000152b0: 7629 0a0a 2020 2020 6465 6620 6578 6563  v)..    def exec
-000152c0: 6c70 2866 696c 652c 202a 6172 6773 293a  lp(file, *args):
-000152d0: 0a20 2020 2020 2020 2022 2222 6578 6563  .        """exec
-000152e0: 6c70 2866 696c 652c 202a 6172 6773 290a  lp(file, *args).
-000152f0: 0a20 2020 2020 2020 2045 7865 6375 7465  .        Execute
-00015300: 2074 6865 2065 7865 6375 7461 626c 6520   the executable 
-00015310: 6669 6c65 2028 7768 6963 6820 6973 2073  file (which is s
-00015320: 6561 7263 6865 6420 666f 7220 616c 6f6e  earched for alon
-00015330: 6720 2450 4154 4829 0a20 2020 2020 2020  g $PATH).       
-00015340: 2077 6974 6820 6172 6775 6d65 6e74 206c   with argument l
-00015350: 6973 7420 6172 6773 2c20 7265 706c 6163  ist args, replac
-00015360: 696e 6720 7468 6520 6375 7272 656e 7420  ing the current 
-00015370: 7072 6f63 6573 732e 2222 220a 2020 2020  process.""".    
-00015380: 2020 2020 6f73 2e65 7865 6376 7028 6669      os.execvp(fi
-00015390: 6c65 2c20 6172 6773 290a 0a20 2020 2064  le, args)..    d
-000153a0: 6566 2065 7865 636c 7065 2866 696c 652c  ef execlpe(file,
-000153b0: 202a 6172 6773 293a 0a20 2020 2020 2020   *args):.       
-000153c0: 2022 2222 6578 6563 6c70 6528 6669 6c65   """execlpe(file
-000153d0: 2c20 2a61 7267 732c 2065 6e76 290a 0a20  , *args, env).. 
-000153e0: 2020 2020 2020 2045 7865 6375 7465 2074         Execute t
-000153f0: 6865 2065 7865 6375 7461 626c 6520 6669  he executable fi
-00015400: 6c65 2028 7768 6963 6820 6973 2073 6561  le (which is sea
-00015410: 7263 6865 6420 666f 7220 616c 6f6e 6720  rched for along 
-00015420: 2450 4154 4829 0a20 2020 2020 2020 2077  $PATH).        w
-00015430: 6974 6820 6172 6775 6d65 6e74 206c 6973  ith argument lis
-00015440: 7420 6172 6773 2061 6e64 2065 6e76 6972  t args and envir
-00015450: 6f6e 6d65 6e74 2065 6e76 2c20 7265 706c  onment env, repl
-00015460: 6163 696e 6720 7468 6520 6375 7272 656e  acing the curren
-00015470: 740a 2020 2020 2020 2020 7072 6f63 6573  t.        proces
-00015480: 732e 2222 220a 2020 2020 2020 2020 656e  s.""".        en
-00015490: 7620 3d20 6172 6773 5b2d 315d 0a20 2020  v = args[-1].   
-000154a0: 2020 2020 206f 732e 6578 6563 7670 6528       os.execvpe(
-000154b0: 6669 6c65 2c20 6172 6773 5b3a 2d31 5d2c  file, args[:-1],
-000154c0: 2065 6e76 290a 0a20 2020 2064 6566 2065   env)..    def e
-000154d0: 7865 6376 7028 6669 6c65 2c20 6172 6773  xecvp(file, args
-000154e0: 293a 0a20 2020 2020 2020 2022 2222 6578  ):.        """ex
-000154f0: 6563 7670 2866 696c 652c 2061 7267 7329  ecvp(file, args)
-00015500: 0a0a 2020 2020 2020 2020 4578 6563 7574  ..        Execut
-00015510: 6520 7468 6520 6578 6563 7574 6162 6c65  e the executable
-00015520: 2066 696c 6520 2877 6869 6368 2069 7320   file (which is 
-00015530: 7365 6172 6368 6564 2066 6f72 2061 6c6f  searched for alo
-00015540: 6e67 2024 5041 5448 290a 2020 2020 2020  ng $PATH).      
-00015550: 2020 7769 7468 2061 7267 756d 656e 7420    with argument 
-00015560: 6c69 7374 2061 7267 732c 2072 6570 6c61  list args, repla
-00015570: 6369 6e67 2074 6865 2063 7572 7265 6e74  cing the current
-00015580: 2070 726f 6365 7373 2e0a 2020 2020 2020   process..      
-00015590: 2020 6172 6773 206d 6179 2062 6520 6120    args may be a 
-000155a0: 6c69 7374 206f 7220 7475 706c 6520 6f66  list or tuple of
-000155b0: 2073 7472 696e 6773 2e22 2222 0a20 2020   strings.""".   
-000155c0: 2020 2020 2077 7261 7070 6564 5f65 7865       wrapped_exe
-000155d0: 6376 7065 2866 696c 652c 2061 7267 7329  cvpe(file, args)
-000155e0: 0a0a 2020 2020 6465 6620 6578 6563 7670  ..    def execvp
-000155f0: 6528 6669 6c65 2c20 6172 6773 2c20 656e  e(file, args, en
-00015600: 7629 3a0a 2020 2020 2020 2020 2222 2265  v):.        """e
-00015610: 7865 6376 7065 2866 696c 652c 2061 7267  xecvpe(file, arg
-00015620: 732c 2065 6e76 290a 0a20 2020 2020 2020  s, env)..       
-00015630: 2045 7865 6375 7465 2074 6865 2065 7865   Execute the exe
-00015640: 6375 7461 626c 6520 6669 6c65 2028 7768  cutable file (wh
-00015650: 6963 6820 6973 2073 6561 7263 6865 6420  ich is searched 
-00015660: 666f 7220 616c 6f6e 6720 2450 4154 4829  for along $PATH)
-00015670: 0a20 2020 2020 2020 2077 6974 6820 6172  .        with ar
-00015680: 6775 6d65 6e74 206c 6973 7420 6172 6773  gument list args
-00015690: 2061 6e64 2065 6e76 6972 6f6e 6d65 6e74   and environment
-000156a0: 2065 6e76 202c 2072 6570 6c61 6369 6e67   env , replacing
-000156b0: 2074 6865 0a20 2020 2020 2020 2063 7572   the.        cur
-000156c0: 7265 6e74 2070 726f 6365 7373 2e0a 2020  rent process..  
-000156d0: 2020 2020 2020 6172 6773 206d 6179 2062        args may b
-000156e0: 6520 6120 6c69 7374 206f 7220 7475 706c  e a list or tupl
-000156f0: 6520 6f66 2073 7472 696e 6773 2e22 2222  e of strings."""
-00015700: 0a20 2020 2020 2020 2077 7261 7070 6564  .        wrapped
-00015710: 5f65 7865 6376 7065 2866 696c 652c 2061  _execvpe(file, a
-00015720: 7267 732c 2065 6e76 290a 0a20 2020 206f  rgs, env)..    o
-00015730: 732e 6578 6563 7620 3d20 6578 6563 760a  s.execv = execv.
-00015740: 2020 2020 6f73 2e65 7865 6376 6520 3d20      os.execve = 
-00015750: 6578 6563 7665 0a20 2020 206f 732e 6578  execve.    os.ex
-00015760: 6563 6c20 3d20 6578 6563 6c0a 2020 2020  ecl = execl.    
-00015770: 6f73 2e65 7865 636c 6520 3d20 6578 6563  os.execle = exec
-00015780: 6c65 0a20 2020 206f 732e 6578 6563 6c70  le.    os.execlp
-00015790: 203d 2065 7865 636c 700a 2020 2020 6f73   = execlp.    os
-000157a0: 2e65 7865 636c 7065 203d 2065 7865 636c  .execlpe = execl
-000157b0: 7065 0a20 2020 206f 732e 6578 6563 7670  pe.    os.execvp
-000157c0: 203d 2065 7865 6376 700a 2020 2020 6f73   = execvp.    os
-000157d0: 2e65 7865 6376 7065 203d 2065 7865 6376  .execvpe = execv
-000157e0: 7065 0a20 2020 206f 732e 5f65 7865 6376  pe.    os._execv
-000157f0: 7065 203d 2077 7261 7070 6564 5f65 7865  pe = wrapped_exe
-00015800: 6376 7065 0a0a 0a64 6566 2067 6574 5f6c  cvpe...def get_l
-00015810: 7362 5f72 656c 6561 7365 2829 3a0a 2020  sb_release():.  
-00015820: 2020 2222 220a 2020 2020 3a72 6574 7572    """.    :retur
-00015830: 6e3a 2060 602f 6574 632f 6c73 622d 7265  n: ``/etc/lsb-re
-00015840: 6c65 6173 6560 6020 7061 7273 6564 2061  lease`` parsed a
-00015850: 7320 6120 6469 6374 0a20 2020 203a 7274  s a dict.    :rt
-00015860: 7970 653a 2064 6963 745b 7374 722c 7374  ype: dict[str,st
-00015870: 725d 0a20 2020 2022 2222 0a20 2020 2064  r].    """.    d
-00015880: 203d 207b 7d0a 2020 2020 666f 7220 6c69   = {}.    for li
-00015890: 6e65 2069 6e20 6f70 656e 2822 2f65 7463  ne in open("/etc
-000158a0: 2f6c 7362 2d72 656c 6561 7365 2229 2e72  /lsb-release").r
-000158b0: 6561 6428 292e 7370 6c69 746c 696e 6573  ead().splitlines
-000158c0: 2829 3a0a 2020 2020 2020 2020 6b2c 2076  ():.        k, v
-000158d0: 203d 206c 696e 652e 7370 6c69 7428 223d   = line.split("=
-000158e0: 222c 2031 290a 2020 2020 2020 2020 6966  ", 1).        if
-000158f0: 2076 5b30 5d20 3d3d 2076 5b2d 315d 203d   v[0] == v[-1] =
-00015900: 3d20 2722 273a 0a20 2020 2020 2020 2020  = '"':.         
-00015910: 2020 2076 203d 2076 5b31 3a2d 315d 0a20     v = v[1:-1]. 
-00015920: 2020 2020 2020 2064 5b6b 5d20 3d20 760a         d[k] = v.
-00015930: 2020 2020 7265 7475 726e 2064 0a0a 0a64      return d...d
-00015940: 6566 2067 6574 5f75 6275 6e74 755f 6d61  ef get_ubuntu_ma
-00015950: 6a6f 725f 7665 7273 696f 6e28 293a 0a20  jor_version():. 
-00015960: 2020 2022 2222 0a20 2020 203a 7274 7970     """.    :rtyp
-00015970: 653a 2069 6e74 7c4e 6f6e 650a 2020 2020  e: int|None.    
-00015980: 2222 220a 2020 2020 6420 3d20 6765 745f  """.    d = get_
-00015990: 6c73 625f 7265 6c65 6173 6528 290a 2020  lsb_release().  
-000159a0: 2020 6966 2064 5b22 4449 5354 5249 425f    if d["DISTRIB_
-000159b0: 4944 225d 2021 3d20 2255 6275 6e74 7522  ID"] != "Ubuntu"
-000159c0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000159d0: 204e 6f6e 650a 2020 2020 7265 7475 726e   None.    return
-000159e0: 2069 6e74 2866 6c6f 6174 2864 5b22 4449   int(float(d["DI
-000159f0: 5354 5249 425f 5245 4c45 4153 4522 5d29  STRIB_RELEASE"])
-00015a00: 290a 0a0a 6465 6620 6175 746f 5f70 7265  )...def auto_pre
-00015a10: 6669 785f 6f73 5f65 7865 635f 7072 6566  fix_os_exec_pref
-00015a20: 6978 5f75 6275 6e74 7528 7072 6566 6978  ix_ubuntu(prefix
-00015a30: 5f61 7267 732c 2075 6275 6e74 755f 6d69  _args, ubuntu_mi
-00015a40: 6e5f 7665 7273 696f 6e3d 3136 293a 0a20  n_version=16):. 
-00015a50: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
-00015a60: 6d20 6c69 7374 5b73 7472 5d20 7072 6566  m list[str] pref
-00015a70: 6978 5f61 7267 733a 0a20 2020 203a 7061  ix_args:.    :pa
-00015a80: 7261 6d20 696e 7420 7562 756e 7475 5f6d  ram int ubuntu_m
-00015a90: 696e 5f76 6572 7369 6f6e 3a0a 0a20 2020  in_version:..   
-00015aa0: 2045 7861 6d70 6c65 2075 7361 6765 3a0a   Example usage:.
-00015ab0: 2020 2020 2020 6175 746f 5f70 7265 6669        auto_prefi
-00015ac0: 785f 6f73 5f65 7865 635f 7072 6566 6978  x_os_exec_prefix
-00015ad0: 5f75 6275 6e74 7528 5b22 2f75 2f7a 6579  _ubuntu(["/u/zey
-00015ae0: 6572 2f74 6f6f 6c73 2f67 6c69 6263 3231  er/tools/glibc21
-00015af0: 372f 6c64 2d6c 696e 7578 2d78 3836 2d36  7/ld-linux-x86-6
-00015b00: 342e 736f 2e32 225d 290a 2020 2020 2222  4.so.2"]).    ""
-00015b10: 220a 2020 2020 7562 756e 7475 5f76 6572  ".    ubuntu_ver
-00015b20: 7369 6f6e 203d 2067 6574 5f75 6275 6e74  sion = get_ubunt
-00015b30: 755f 6d61 6a6f 725f 7665 7273 696f 6e28  u_major_version(
-00015b40: 290a 2020 2020 6966 2075 6275 6e74 755f  ).    if ubuntu_
-00015b50: 7665 7273 696f 6e20 6973 204e 6f6e 653a  version is None:
-00015b60: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
-00015b70: 2020 2020 6966 2075 6275 6e74 755f 7665      if ubuntu_ve
-00015b80: 7273 696f 6e20 3e3d 2075 6275 6e74 755f  rsion >= ubuntu_
-00015b90: 6d69 6e5f 7665 7273 696f 6e3a 0a20 2020  min_version:.   
-00015ba0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00015bb0: 7072 696e 7428 2259 6f75 2061 7265 2072  print("You are r
-00015bc0: 756e 6e69 6e67 2055 6275 6e74 7520 2569  unning Ubuntu %i
-00015bd0: 2c20 7468 7573 2077 6520 7072 6566 6978  , thus we prefix
-00015be0: 2061 6c6c 206f 732e 6578 6563 2077 6974   all os.exec wit
-00015bf0: 6820 2573 2e22 2025 2028 7562 756e 7475  h %s." % (ubuntu
-00015c00: 5f76 6572 7369 6f6e 2c20 7072 6566 6978  _version, prefix
-00015c10: 5f61 7267 7329 290a 2020 2020 6173 7365  _args)).    asse
-00015c20: 7274 206f 732e 7061 7468 2e65 7869 7374  rt os.path.exist
-00015c30: 7328 7072 6566 6978 5f61 7267 735b 305d  s(prefix_args[0]
-00015c40: 290a 2020 2020 6f76 6572 7772 6974 655f  ).    overwrite_
-00015c50: 6f73 5f65 7865 6328 7072 6566 6978 5f61  os_exec(prefix_a
-00015c60: 7267 733d 7072 6566 6978 5f61 7267 7329  rgs=prefix_args)
-00015c70: 0a0a 0a64 6566 2063 6c65 616e 7570 5f65  ...def cleanup_e
-00015c80: 6e76 5f76 6172 5f70 6174 6828 656e 765f  nv_var_path(env_
-00015c90: 7661 722c 2070 6174 685f 7072 6566 6978  var, path_prefix
-00015ca0: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00015cb0: 7061 7261 6d20 7374 7220 656e 765f 7661  param str env_va
-00015cc0: 723a 2065 2e67 2e20 224c 445f 4c49 4252  r: e.g. "LD_LIBR
-00015cd0: 4152 595f 5041 5448 220a 2020 2020 3a70  ARY_PATH".    :p
-00015ce0: 6172 616d 2073 7472 2070 6174 685f 7072  aram str path_pr
-00015cf0: 6566 6978 3a0a 0a20 2020 2057 696c 6c20  efix:..    Will 
-00015d00: 7265 6d6f 7665 2061 6c6c 2070 6174 6873  remove all paths
-00015d10: 2069 6e20 6f73 2e65 6e76 6972 6f6e 5b65   in os.environ[e
-00015d20: 6e76 5f76 6172 5d20 7768 6963 6820 6172  nv_var] which ar
-00015d30: 6520 7072 6566 6978 6564 2077 6974 6820  e prefixed with 
-00015d40: 7061 7468 5f70 7265 6669 782e 0a20 2020  path_prefix..   
-00015d50: 2022 2222 0a20 2020 2069 6620 656e 765f   """.    if env_
-00015d60: 7661 7220 6e6f 7420 696e 206f 732e 656e  var not in os.en
-00015d70: 7669 726f 6e3a 0a20 2020 2020 2020 2072  viron:.        r
-00015d80: 6574 7572 6e0a 2020 2020 7073 203d 206f  eturn.    ps = o
-00015d90: 732e 656e 7669 726f 6e5b 656e 765f 7661  s.environ[env_va
-00015da0: 725d 2e73 706c 6974 2822 3a22 290a 0a20  r].split(":").. 
-00015db0: 2020 2064 6566 2066 2870 293a 0a20 2020     def f(p):.   
-00015dc0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00015dd0: 203a 7061 7261 6d20 7374 7220 703a 0a20   :param str p:. 
-00015de0: 2020 2020 2020 203a 7274 7970 653a 2062         :rtype: b
-00015df0: 6f6f 6c0a 2020 2020 2020 2020 2222 220a  ool.        """.
-00015e00: 2020 2020 2020 2020 6966 2070 203d 3d20          if p == 
-00015e10: 7061 7468 5f70 7265 6669 7820 6f72 2070  path_prefix or p
-00015e20: 2e73 7461 7274 7377 6974 6828 7061 7468  .startswith(path
-00015e30: 5f70 7265 6669 7820 2b20 222f 2229 3a0a  _prefix + "/"):.
-00015e40: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00015e50: 7428 2252 656d 6f76 696e 6720 2573 2066  t("Removing %s f
-00015e60: 726f 6d20 2573 2e22 2025 2028 702c 2065  rom %s." % (p, e
-00015e70: 6e76 5f76 6172 2929 0a20 2020 2020 2020  nv_var)).       
-00015e80: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00015e90: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00015ea0: 2054 7275 650a 0a20 2020 2070 7320 3d20   True..    ps = 
-00015eb0: 6669 6c74 6572 2866 2c20 7073 290a 2020  filter(f, ps).  
-00015ec0: 2020 6f73 2e65 6e76 6972 6f6e 5b65 6e76    os.environ[env
-00015ed0: 5f76 6172 5d20 3d20 223a 222e 6a6f 696e  _var] = ":".join
-00015ee0: 2870 7329 0a0a 0a64 6566 2067 6574 5f6c  (ps)...def get_l
-00015ef0: 6f67 696e 5f75 7365 726e 616d 6528 293a  ogin_username():
-00015f00: 0a20 2020 2022 2222 0a20 2020 203a 7274  .    """.    :rt
-00015f10: 7970 653a 2073 7472 0a20 2020 203a 7265  ype: str.    :re
-00015f20: 7475 726e 3a20 7468 6520 7573 6572 6e61  turn: the userna
-00015f30: 6d65 206f 6620 7468 6520 6375 7272 656e  me of the curren
-00015f40: 7420 7573 6572 2e0a 2020 2020 5573 6520  t user..    Use 
-00015f50: 7468 6973 2061 7320 6120 7265 706c 6163  this as a replac
-00015f60: 656d 656e 7420 666f 7220 6f73 2e67 6574  ement for os.get
-00015f70: 6c6f 6769 6e28 292e 0a20 2020 2022 2222  login()..    """
-00015f80: 0a20 2020 2069 6d70 6f72 7420 6f73 0a0a  .    import os..
-00015f90: 2020 2020 6966 2073 7973 2e70 6c61 7466      if sys.platf
-00015fa0: 6f72 6d20 3d3d 2022 7769 6e33 3222 3a0a  orm == "win32":.
-00015fb0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-00015fc0: 732e 6765 746c 6f67 696e 2829 0a20 2020  s.getlogin().   
-00015fd0: 2069 6d70 6f72 7420 7077 640a 0a20 2020   import pwd..   
-00015fe0: 2074 7279 3a0a 2020 2020 2020 2020 7265   try:.        re
-00015ff0: 7475 726e 2070 7764 2e67 6574 7077 7569  turn pwd.getpwui
-00016000: 6428 6f73 2e67 6574 7569 6428 2929 5b30  d(os.getuid())[0
-00016010: 5d0a 2020 2020 6578 6365 7074 204b 6579  ].    except Key
-00016020: 4572 726f 723a 0a20 2020 2020 2020 2023  Error:.        #
-00016030: 2070 7764 2e67 6574 7077 7569 6428 2920   pwd.getpwuid() 
-00016040: 6361 6e20 7468 726f 7720 4b65 7945 7272  can throw KeyErr
-00016050: 6f72 3a20 2767 6574 7077 7569 6428 293a  or: 'getpwuid():
-00016060: 2075 6964 206e 6f74 2066 6f75 6e64 3a20   uid not found: 
-00016070: 3132 3334 3527 0a20 2020 2020 2020 2023  12345'.        #
-00016080: 2074 6869 7320 6361 6e20 6861 7070 656e   this can happen
-00016090: 2065 2e67 2e20 696e 2061 2064 6f63 6b65   e.g. in a docke
-000160a0: 7220 656e 7669 726f 6e6d 656e 7420 7769  r environment wi
-000160b0: 7468 206d 6170 7065 6420 7569 6473 2075  th mapped uids u
-000160c0: 6e6b 6e6f 776e 2074 6f20 7468 6520 646f  nknown to the do
-000160d0: 636b 6572 204f 530a 2020 2020 2020 2020  cker OS.        
-000160e0: 7265 7475 726e 2073 7472 286f 732e 6765  return str(os.ge
-000160f0: 7475 6964 2829 290a 0a0a 6465 6620 6765  tuid())...def ge
-00016100: 745f 7465 6d70 5f64 6972 2829 3a0a 2020  t_temp_dir():.  
-00016110: 2020 2222 220a 2020 2020 3a72 7479 7065    """.    :rtype
-00016120: 3a20 7374 720a 2020 2020 3a72 6574 7572  : str.    :retur
-00016130: 6e3a 2065 2e67 2e20 222f 746d 702f 2455  n: e.g. "/tmp/$U
-00016140: 5345 524e 414d 4522 0a20 2020 2022 2222  SERNAME".    """
-00016150: 0a20 2020 2075 7365 726e 616d 6520 3d20  .    username = 
-00016160: 6765 745f 6c6f 6769 6e5f 7573 6572 6e61  get_login_userna
-00016170: 6d65 2829 0a20 2020 2066 6f72 2065 6e76  me().    for env
-00016180: 6e61 6d65 2069 6e20 5b22 544d 5044 4952  name in ["TMPDIR
-00016190: 222c 2022 5445 4d50 222c 2022 544d 5022  ", "TEMP", "TMP"
-000161a0: 5d3a 0a20 2020 2020 2020 2064 6972 6e61  ]:.        dirna
-000161b0: 6d65 203d 206f 732e 6765 7465 6e76 2865  me = os.getenv(e
-000161c0: 6e76 6e61 6d65 290a 2020 2020 2020 2020  nvname).        
-000161d0: 6966 2064 6972 6e61 6d65 3a0a 2020 2020  if dirname:.    
-000161e0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-000161f0: 2573 2f25 7322 2025 2028 6469 726e 616d  %s/%s" % (dirnam
-00016200: 652c 2075 7365 726e 616d 6529 0a20 2020  e, username).   
-00016210: 2023 202f 7661 722f 746d 7020 7368 6f75   # /var/tmp shou
-00016220: 6c64 2062 6520 6d6f 7265 2070 6572 7369  ld be more persi
-00016230: 7374 656e 7420 7468 616e 202f 746d 7020  stent than /tmp 
-00016240: 7573 7561 6c6c 792e 0a20 2020 2069 6620  usually..    if 
-00016250: 6f73 2e70 6174 682e 6578 6973 7473 2822  os.path.exists("
-00016260: 2f76 6172 2f74 6d70 2229 3a0a 2020 2020  /var/tmp"):.    
-00016270: 2020 2020 7265 7475 726e 2022 2f76 6172      return "/var
-00016280: 2f74 6d70 2f25 7322 2025 2075 7365 726e  /tmp/%s" % usern
-00016290: 616d 650a 2020 2020 7265 7475 726e 2022  ame.    return "
-000162a0: 2f74 6d70 2f25 7322 2025 2075 7365 726e  /tmp/%s" % usern
-000162b0: 616d 650a 0a0a 6465 6620 6765 745f 6361  ame...def get_ca
-000162c0: 6368 655f 6469 7228 293a 0a20 2020 2022  che_dir():.    "
-000162d0: 2222 0a20 2020 203a 7265 7475 726e 3a20  "".    :return: 
-000162e0: 7573 6564 2074 6f20 6361 6368 6520 6e6f  used to cache no
-000162f0: 6e2d 6372 6974 6963 616c 2074 6869 6e67  n-critical thing
-00016300: 732e 2062 7920 6465 6661 756c 7420 6765  s. by default ge
-00016310: 745f 7465 6d70 5f64 6972 2e20 756e 6c65  t_temp_dir. unle
-00016320: 7373 2079 6f75 2064 6566 696e 6520 656e  ss you define en
-00016330: 7620 5245 5455 524e 4e5f 4341 4348 455f  v RETURNN_CACHE_
-00016340: 4449 520a 2020 2020 3a72 7479 7065 3a20  DIR.    :rtype: 
-00016350: 7374 720a 2020 2020 2222 220a 2020 2020  str.    """.    
-00016360: 6966 2022 5245 5455 524e 4e5f 4341 4348  if "RETURNN_CACH
-00016370: 455f 4449 5222 2069 6e20 6f73 2e65 6e76  E_DIR" in os.env
-00016380: 6972 6f6e 3a0a 2020 2020 2020 2020 7265  iron:.        re
-00016390: 7475 726e 206f 732e 656e 7669 726f 6e5b  turn os.environ[
-000163a0: 2252 4554 5552 4e4e 5f43 4143 4845 5f44  "RETURNN_CACHE_D
-000163b0: 4952 225d 0a20 2020 2072 6574 7572 6e20  IR"].    return 
-000163c0: 6765 745f 7465 6d70 5f64 6972 2829 0a0a  get_temp_dir()..
-000163d0: 0a63 6c61 7373 204c 6f63 6b46 696c 6528  .class LockFile(
-000163e0: 6f62 6a65 6374 293a 0a20 2020 2022 2222  object):.    """
-000163f0: 0a20 2020 2053 696d 706c 6520 6c6f 636b  .    Simple lock
-00016400: 2066 696c 652e 0a20 2020 2022 2222 0a0a   file..    """..
-00016410: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00016420: 2873 656c 662c 2064 6972 6563 746f 7279  (self, directory
-00016430: 2c20 6e61 6d65 3d22 6c6f 636b 5f66 696c  , name="lock_fil
-00016440: 6522 2c20 6c6f 636b 5f74 696d 656f 7574  e", lock_timeout
-00016450: 3d31 202a 2036 3020 2a20 3630 293a 0a20  =1 * 60 * 60):. 
-00016460: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00016470: 2020 203a 7061 7261 6d20 7374 7220 6469     :param str di
-00016480: 7265 6374 6f72 793a 0a20 2020 2020 2020  rectory:.       
-00016490: 203a 7061 7261 6d20 696e 747c 666c 6f61   :param int|floa
-000164a0: 7420 6c6f 636b 5f74 696d 656f 7574 3a20  t lock_timeout: 
-000164b0: 696e 2073 6563 6f6e 6473 0a20 2020 2020  in seconds.     
-000164c0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
-000164d0: 656c 662e 6469 7265 6374 6f72 7920 3d20  elf.directory = 
-000164e0: 6469 7265 6374 6f72 790a 2020 2020 2020  directory.      
-000164f0: 2020 7365 6c66 2e6e 616d 6520 3d20 6e61    self.name = na
-00016500: 6d65 0a20 2020 2020 2020 2073 656c 662e  me.        self.
-00016510: 6664 203d 204e 6f6e 650a 2020 2020 2020  fd = None.      
-00016520: 2020 7365 6c66 2e6c 6f63 6b5f 7469 6d65    self.lock_time
-00016530: 6f75 7420 3d20 6c6f 636b 5f74 696d 656f  out = lock_timeo
-00016540: 7574 0a20 2020 2020 2020 2073 656c 662e  ut.        self.
-00016550: 6c6f 636b 6669 6c65 203d 2022 2573 2f25  lockfile = "%s/%
-00016560: 7322 2025 2028 6469 7265 6374 6f72 792c  s" % (directory,
-00016570: 206e 616d 6529 0a0a 2020 2020 6465 6620   name)..    def 
-00016580: 6973 5f6f 6c64 5f6c 6f63 6b66 696c 6528  is_old_lockfile(
-00016590: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-000165a0: 2222 0a20 2020 2020 2020 203a 7265 7475  "".        :retu
-000165b0: 726e 3a20 5768 6574 6865 7220 7468 6572  rn: Whether ther
-000165c0: 6520 6973 2061 6e20 6578 6973 7469 6e67  e is an existing
-000165d0: 206c 6f63 6b20 6669 6c65 2061 6e64 2074   lock file and t
-000165e0: 6865 2065 7869 7374 696e 6720 6c6f 636b  he existing lock
-000165f0: 2066 696c 6520 6973 206f 6c64 2e0a 2020   file is old..  
-00016600: 2020 2020 2020 3a72 7479 7065 3a20 626f        :rtype: bo
-00016610: 6f6c 0a20 2020 2020 2020 2022 2222 0a20  ol.        """. 
-00016620: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00016630: 2020 2020 2020 2020 6d74 696d 6520 3d20          mtime = 
-00016640: 6f73 2e70 6174 682e 6765 746d 7469 6d65  os.path.getmtime
-00016650: 2873 656c 662e 6c6f 636b 6669 6c65 290a  (self.lockfile).
-00016660: 2020 2020 2020 2020 6578 6365 7074 204f          except O
-00016670: 5345 7272 6f72 3a0a 2020 2020 2020 2020  SError:.        
-00016680: 2020 2020 6d74 696d 6520 3d20 4e6f 6e65      mtime = None
-00016690: 0a20 2020 2020 2020 2069 6620 6d74 696d  .        if mtim
-000166a0: 6520 616e 6420 2861 6273 2874 696d 652e  e and (abs(time.
-000166b0: 7469 6d65 2829 202d 206d 7469 6d65 2920  time() - mtime) 
-000166c0: 3e20 7365 6c66 2e6c 6f63 6b5f 7469 6d65  > self.lock_time
-000166d0: 6f75 7429 3a0a 2020 2020 2020 2020 2020  out):.          
-000166e0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-000166f0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00016700: 7365 0a0a 2020 2020 6465 6620 6d61 7962  se..    def mayb
-00016710: 655f 7265 6d6f 7665 5f6f 6c64 5f6c 6f63  e_remove_old_loc
-00016720: 6b66 696c 6528 7365 6c66 293a 0a20 2020  kfile(self):.   
-00016730: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00016740: 2052 656d 6f76 6573 2061 6e20 6578 6973   Removes an exis
-00016750: 7469 6e67 206f 6c64 206c 6f63 6b66 696c  ting old lockfil
-00016760: 652c 2069 6620 7468 6572 6520 6973 206f  e, if there is o
-00016770: 6e65 2e0a 2020 2020 2020 2020 2222 220a  ne..        """.
-00016780: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00016790: 656c 662e 6973 5f6f 6c64 5f6c 6f63 6b66  elf.is_old_lockf
-000167a0: 696c 6528 293a 0a20 2020 2020 2020 2020  ile():.         
-000167b0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-000167c0: 2020 7072 696e 7428 2252 656d 6f76 696e    print("Removin
-000167d0: 6720 6f6c 6420 6c6f 636b 6669 6c65 2025  g old lockfile %
-000167e0: 7220 2870 726f 6261 626c 7920 6372 6173  r (probably cras
-000167f0: 6865 6420 7072 6f63 292e 2220 2520 7365  hed proc)." % se
-00016800: 6c66 2e6c 6f63 6b66 696c 6529 0a20 2020  lf.lockfile).   
-00016810: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00016820: 2020 2020 2020 6f73 2e72 656d 6f76 6528        os.remove(
-00016830: 7365 6c66 2e6c 6f63 6b66 696c 6529 0a20  self.lockfile). 
-00016840: 2020 2020 2020 2065 7863 6570 7420 4f53         except OS
-00016850: 4572 726f 7220 6173 2065 7863 3a0a 2020  Error as exc:.  
-00016860: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00016870: 2252 656d 6f76 6520 6c6f 636b 6669 6c65  "Remove lockfile
-00016880: 2065 7863 6570 7469 6f6e 2025 722e 2049   exception %r. I
-00016890: 676e 6f72 696e 6720 6974 2e22 2025 2065  gnoring it." % e
-000168a0: 7863 290a 0a20 2020 2064 6566 2069 735f  xc)..    def is_
-000168b0: 6c6f 636b 6564 2873 656c 6629 3a0a 2020  locked(self):.  
-000168c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000168d0: 2020 3a72 6574 7572 6e3a 2077 6865 7468    :return: wheth
-000168e0: 6572 2074 6865 7265 2069 7320 616e 2061  er there is an a
-000168f0: 6374 6976 6520 286e 6f74 206f 6c64 2920  ctive (not old) 
-00016900: 6c6f 636b 6669 6c65 0a20 2020 2020 2020  lockfile.       
-00016910: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
-00016920: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016930: 2020 6966 2073 656c 662e 6973 5f6f 6c64    if self.is_old
-00016940: 5f6c 6f63 6b66 696c 6528 293a 0a20 2020  _lockfile():.   
-00016950: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00016960: 4661 6c73 650a 2020 2020 2020 2020 7472  False.        tr
-00016970: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-00016980: 6574 7572 6e20 6f73 2e70 6174 682e 6578  eturn os.path.ex
-00016990: 6973 7473 2873 656c 662e 6c6f 636b 6669  ists(self.lockfi
-000169a0: 6c65 290a 2020 2020 2020 2020 6578 6365  le).        exce
-000169b0: 7074 204f 5345 7272 6f72 3a0a 2020 2020  pt OSError:.    
-000169c0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000169d0: 616c 7365 0a0a 2020 2020 6465 6620 6c6f  alse..    def lo
-000169e0: 636b 2873 656c 6629 3a0a 2020 2020 2020  ck(self):.      
-000169f0: 2020 2222 220a 2020 2020 2020 2020 4163    """.        Ac
-00016a00: 7175 6972 6573 2074 6865 206c 6f63 6b2e  quires the lock.
-00016a10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00016a20: 2020 2020 2069 6d70 6f72 7420 7469 6d65       import time
-00016a30: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-00016a40: 6572 726e 6f0a 0a20 2020 2020 2020 2077  errno..        w
-00016a50: 6169 745f 636f 756e 7420 3d20 300a 2020  ait_count = 0.  
-00016a60: 2020 2020 2020 7768 696c 6520 5472 7565        while True
-00016a70: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00016a80: 5472 7920 746f 2063 7265 6174 6520 6469  Try to create di
-00016a90: 7265 6374 6f72 7920 6966 2069 7420 646f  rectory if it do
-00016aa0: 6573 206e 6f74 2065 7869 7374 2e0a 2020  es not exist..  
-00016ab0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00016ac0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00016ad0: 732e 6d61 6b65 6469 7273 2873 656c 662e  s.makedirs(self.
-00016ae0: 6469 7265 6374 6f72 7929 0a20 2020 2020  directory).     
-00016af0: 2020 2020 2020 2065 7863 6570 7420 4f53         except OS
-00016b00: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-00016b10: 2020 2020 2020 2070 6173 7320 2023 2049         pass  # I
-00016b20: 676e 6f72 6520 616e 7920 6572 726f 7273  gnore any errors
-00016b30: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00016b40: 4e6f 7720 7472 7920 746f 2063 7265 6174  Now try to creat
-00016b50: 6520 7468 6520 6c6f 636b 2e0a 2020 2020  e the lock..    
-00016b60: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00016b70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00016b80: 662e 6664 203d 206f 732e 6f70 656e 2873  f.fd = os.open(s
-00016b90: 656c 662e 6c6f 636b 6669 6c65 2c20 6f73  elf.lockfile, os
-00016ba0: 2e4f 5f43 5245 4154 207c 206f 732e 4f5f  .O_CREAT | os.O_
-00016bb0: 4558 434c 207c 206f 732e 4f5f 5244 5752  EXCL | os.O_RDWR
-00016bc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016bd0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-00016be0: 2020 2020 2065 7863 6570 7420 4f53 4572       except OSEr
-00016bf0: 726f 7220 6173 2065 7863 3a0a 2020 2020  ror as exc:.    
-00016c00: 2020 2020 2020 2020 2020 2020 2320 506f              # Po
-00016c10: 7373 6962 6c65 2065 7272 6f72 733a 0a20  ssible errors:. 
-00016c20: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00016c30: 2045 4e4f 454e 5420 284e 6f20 7375 6368   ENOENT (No such
-00016c40: 2066 696c 6520 6f72 2064 6972 6563 746f   file or directo
-00016c50: 7279 292c 2065 2e67 2e20 6966 2074 6865  ry), e.g. if the
-00016c60: 2064 6972 6563 746f 7279 2077 6173 2064   directory was d
-00016c70: 656c 6574 6564 2e0a 2020 2020 2020 2020  eleted..        
-00016c80: 2020 2020 2020 2020 2320 4545 5849 5354          # EEXIST
-00016c90: 2028 4669 6c65 2065 7869 7374 7329 2c20   (File exists), 
-00016ca0: 6966 2074 6865 206c 6f63 6b20 616c 7265  if the lock alre
-00016cb0: 6164 7920 6578 6973 7473 2e0a 2020 2020  ady exists..    
-00016cc0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-00016cd0: 7863 2e65 7272 6e6f 206e 6f74 2069 6e20  xc.errno not in 
-00016ce0: 5b65 7272 6e6f 2e45 4e4f 454e 542c 2065  [errno.ENOENT, e
-00016cf0: 7272 6e6f 2e45 4558 4953 545d 3a0a 2020  rrno.EEXIST]:.  
-00016d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d10: 2020 7261 6973 6520 2023 204f 7468 6572    raise  # Other
-00016d20: 2065 7272 6f72 2c20 736f 2072 6572 6169   error, so rerai
-00016d30: 7365 2e0a 2020 2020 2020 2020 2020 2020  se..            
-00016d40: 2320 5765 2064 6964 206e 6f74 2067 6574  # We did not get
-00016d50: 2074 6865 206c 6f63 6b2e 0a20 2020 2020   the lock..     
-00016d60: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
-00016d70: 6620 6974 2069 7320 6120 7265 616c 6c79  f it is a really
-00016d80: 206f 6c64 206f 6e65 2e0a 2020 2020 2020   old one..      
-00016d90: 2020 2020 2020 7365 6c66 2e6d 6179 6265        self.maybe
-00016da0: 5f72 656d 6f76 655f 6f6c 645f 6c6f 636b  _remove_old_lock
-00016db0: 6669 6c65 2829 0a20 2020 2020 2020 2020  file().         
-00016dc0: 2020 2023 2057 6169 7420 6120 6269 742c     # Wait a bit,
-00016dd0: 2061 6e64 2074 6865 6e20 7265 7472 792e   and then retry.
-00016de0: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
-00016df0: 652e 736c 6565 7028 3129 0a20 2020 2020  e.sleep(1).     
-00016e00: 2020 2020 2020 2077 6169 745f 636f 756e         wait_coun
-00016e10: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
-00016e20: 2020 2069 6620 7761 6974 5f63 6f75 6e74     if wait_count
-00016e30: 203d 3d20 3130 3a0a 2020 2020 2020 2020   == 10:.        
-00016e40: 2020 2020 2020 2020 7072 696e 7428 2257          print("W
-00016e50: 6169 7469 6e67 2066 6f72 206c 6f63 6b2d  aiting for lock-
-00016e60: 6669 6c65 3a20 2573 2220 2520 7365 6c66  file: %s" % self
-00016e70: 2e6c 6f63 6b66 696c 6529 0a0a 2020 2020  .lockfile)..    
-00016e80: 6465 6620 756e 6c6f 636b 2873 656c 6629  def unlock(self)
-00016e90: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00016ea0: 2020 2020 2020 5265 6c65 6173 6573 2074        Releases t
-00016eb0: 6865 206c 6f63 6b2e 0a20 2020 2020 2020  he lock..       
-00016ec0: 2022 2222 0a20 2020 2020 2020 206f 732e   """.        os.
-00016ed0: 636c 6f73 6528 7365 6c66 2e66 6429 0a20  close(self.fd). 
-00016ee0: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
-00016ef0: 2873 656c 662e 6c6f 636b 6669 6c65 290a  (self.lockfile).
-00016f00: 0a20 2020 2064 6566 205f 5f65 6e74 6572  .    def __enter
-00016f10: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-00016f20: 2020 7365 6c66 2e6c 6f63 6b28 290a 0a20    self.lock().. 
-00016f30: 2020 2064 6566 205f 5f65 7869 745f 5f28     def __exit__(
-00016f40: 7365 6c66 2c20 6578 635f 7479 7065 2c20  self, exc_type, 
-00016f50: 6578 635f 7661 6c2c 2065 7863 5f74 6229  exc_val, exc_tb)
-00016f60: 3a0a 2020 2020 2020 2020 7365 6c66 2e75  :.        self.u
-00016f70: 6e6c 6f63 6b28 290a 0a0a 6465 6620 7374  nlock()...def st
-00016f80: 725f 6973 5f6e 756d 6265 7228 7329 3a0a  r_is_number(s):.
-00016f90: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
-00016fa0: 616d 2073 7472 2073 3a20 652e 672e 2022  am str s: e.g. "
-00016fb0: 3122 2c20 222e 3322 206f 7220 2278 220a  1", ".3" or "x".
-00016fc0: 2020 2020 3a72 6574 7572 6e3a 2077 6865      :return: whe
-00016fd0: 7468 6572 2073 2063 616e 2062 6520 6361  ther s can be ca
-00016fe0: 7374 6564 2074 6f20 666c 6f61 7420 6f72  sted to float or
-00016ff0: 2069 6e74 0a20 2020 203a 7274 7970 653a   int.    :rtype:
-00017000: 2062 6f6f 6c0a 2020 2020 2222 220a 2020   bool.    """.  
-00017010: 2020 7472 793a 0a20 2020 2020 2020 2066    try:.        f
-00017020: 6c6f 6174 2873 290a 2020 2020 2020 2020  loat(s).        
-00017030: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
-00017040: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
-00017050: 723a 0a20 2020 2020 2020 2072 6574 7572  r:.        retur
-00017060: 6e20 4661 6c73 650a 0a0a 6465 6620 736f  n False...def so
-00017070: 7274 6564 5f76 616c 7565 735f 6672 6f6d  rted_values_from
-00017080: 5f64 6963 7428 6429 3a0a 2020 2020 2222  _dict(d):.    ""
-00017090: 220a 2020 2020 3a70 6172 616d 2064 6963  ".    :param dic
-000170a0: 745b 542c 565d 2064 3a0a 2020 2020 3a72  t[T,V] d:.    :r
-000170b0: 7479 7065 3a20 6c69 7374 5b56 5d0a 2020  type: list[V].  
-000170c0: 2020 2222 220a 2020 2020 6173 7365 7274    """.    assert
-000170d0: 2069 7369 6e73 7461 6e63 6528 642c 2064   isinstance(d, d
-000170e0: 6963 7429 0a20 2020 2072 6574 7572 6e20  ict).    return 
-000170f0: 5b76 2066 6f72 2028 6b2c 2076 2920 696e  [v for (k, v) in
-00017100: 2073 6f72 7465 6428 642e 6974 656d 7328   sorted(d.items(
-00017110: 2929 5d0a 0a0a 6465 6620 6469 6374 5f7a  ))]...def dict_z
-00017120: 6970 286b 6579 732c 2076 616c 7565 7329  ip(keys, values)
-00017130: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
-00017140: 6172 616d 206c 6973 745b 545d 206b 6579  aram list[T] key
-00017150: 733a 0a20 2020 203a 7061 7261 6d20 6c69  s:.    :param li
-00017160: 7374 5b56 5d20 7661 6c75 6573 3a0a 2020  st[V] values:.  
-00017170: 2020 3a72 7479 7065 3a20 6469 6374 5b54    :rtype: dict[T
-00017180: 2c56 5d0a 2020 2020 2222 220a 2020 2020  ,V].    """.    
-00017190: 6173 7365 7274 206c 656e 286b 6579 7329  assert len(keys)
-000171a0: 203d 3d20 6c65 6e28 7661 6c75 6573 290a   == len(values).
-000171b0: 2020 2020 7265 7475 726e 2064 6963 7428      return dict(
-000171c0: 7a69 7028 6b65 7973 2c20 7661 6c75 6573  zip(keys, values
-000171d0: 2929 0a0a 0a64 6566 2070 6172 7365 5f6c  ))...def parse_l
-000171e0: 645f 636f 6e66 5f66 696c 6528 666e 293a  d_conf_file(fn):
-000171f0: 0a20 2020 2022 2222 0a20 2020 2056 6961  .    """.    Via
-00017200: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-00017210: 636f 6d2f 616c 6265 7274 7a2f 7379 7374  com/albertz/syst
-00017220: 656d 2d74 6f6f 6c73 2f62 6c6f 622f 6d61  em-tools/blob/ma
-00017230: 7374 6572 2f62 696e 2f66 696e 642d 6c69  ster/bin/find-li
-00017240: 622d 696e 2d70 6174 682e 7079 2e0a 0a20  b-in-path.py... 
-00017250: 2020 203a 7061 7261 6d20 7374 7220 666e     :param str fn
-00017260: 3a20 652e 672e 2022 2f65 7463 2f6c 642e  : e.g. "/etc/ld.
-00017270: 736f 2e63 6f6e 6622 0a20 2020 203a 7265  so.conf".    :re
-00017280: 7475 726e 3a20 6c69 7374 206f 6620 7061  turn: list of pa
-00017290: 7468 7320 666f 7220 6c69 6273 0a20 2020  ths for libs.   
-000172a0: 203a 7274 7970 653a 206c 6973 745b 7374   :rtype: list[st
-000172b0: 725d 0a20 2020 2022 2222 0a20 2020 2066  r].    """.    f
-000172c0: 726f 6d20 676c 6f62 2069 6d70 6f72 7420  rom glob import 
-000172d0: 676c 6f62 0a0a 2020 2020 7061 7468 7320  glob..    paths 
-000172e0: 3d20 5b5d 0a20 2020 2066 6f72 206c 696e  = [].    for lin
-000172f0: 6520 696e 206f 7065 6e28 666e 292e 7265  e in open(fn).re
-00017300: 6164 2829 2e73 706c 6974 6c69 6e65 7328  ad().splitlines(
-00017310: 293a 0a20 2020 2020 2020 206c 696e 6520  ):.        line 
-00017320: 3d20 6c69 6e65 2e73 7472 6970 2829 0a20  = line.strip(). 
-00017330: 2020 2020 2020 2069 6620 6e6f 7420 6c69         if not li
-00017340: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00017350: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-00017360: 2069 6620 6c69 6e65 2e73 7461 7274 7377   if line.startsw
-00017370: 6974 6828 2223 2229 3a0a 2020 2020 2020  ith("#"):.      
-00017380: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-00017390: 2020 2020 2020 2069 6620 6c69 6e65 2e73         if line.s
-000173a0: 7461 7274 7377 6974 6828 2269 6e63 6c75  tartswith("inclu
-000173b0: 6465 2022 293a 0a20 2020 2020 2020 2020  de "):.         
-000173c0: 2020 2066 6f72 2073 7562 5f66 6e20 696e     for sub_fn in
-000173d0: 2067 6c6f 6228 6c69 6e65 5b6c 656e 2822   glob(line[len("
-000173e0: 696e 636c 7564 6520 2229 203a 5d29 3a0a  include ") :]):.
-000173f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017400: 7061 7468 732e 6578 7465 6e64 2870 6172  paths.extend(par
-00017410: 7365 5f6c 645f 636f 6e66 5f66 696c 6528  se_ld_conf_file(
-00017420: 7375 625f 666e 2929 0a20 2020 2020 2020  sub_fn)).       
-00017430: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00017440: 2020 2020 2020 7061 7468 732e 6170 7065        paths.appe
-00017450: 6e64 286c 696e 6529 0a20 2020 2072 6574  nd(line).    ret
-00017460: 7572 6e20 7061 7468 730a 0a0a 6465 6620  urn paths...def 
-00017470: 6765 745f 6c64 5f70 6174 6873 2829 3a0a  get_ld_paths():.
-00017480: 2020 2020 2222 220a 2020 2020 546f 2062      """.    To b
-00017490: 6520 7665 7279 2063 6f72 7265 6374 2c20  e very correct, 
-000174a0: 7365 6520 6d61 6e2d 7061 6765 206f 6620  see man-page of 
-000174b0: 6c64 2e73 6f2e 0a20 2020 2041 6e64 2068  ld.so..    And h
-000174c0: 6572 653a 2068 7474 7073 3a2f 2f75 6e69  ere: https://uni
-000174d0: 782e 7374 6163 6b65 7863 6861 6e67 652e  x.stackexchange.
-000174e0: 636f 6d2f 7175 6573 7469 6f6e 732f 3335  com/questions/35
-000174f0: 3432 3935 2f77 6861 742d 6973 2d74 6865  4295/what-is-the
-00017500: 2d64 6566 6175 6c74 2d76 616c 7565 2d6f  -default-value-o
-00017510: 662d 6c64 2d6c 6962 7261 7279 2d70 6174  f-ld-library-pat
-00017520: 682f 3335 3432 3936 0a20 2020 2053 686f  h/354296.    Sho
-00017530: 7274 2076 6572 7369 6f6e 2c20 6e6f 7420  rt version, not 
-00017540: 7370 6563 6966 6963 2074 6f20 616e 2065  specific to an e
-00017550: 7865 6375 7461 626c 652c 2069 6e20 7468  xecutable, in th
-00017560: 6973 206f 7264 6572 3a0a 2020 2020 2d20  is order:.    - 
-00017570: 4c44 5f4c 4942 5241 5259 5f50 4154 480a  LD_LIBRARY_PATH.
-00017580: 2020 2020 2d20 2f65 7463 2f6c 642e 736f      - /etc/ld.so
-00017590: 2e63 6163 6865 2028 696e 7374 6561 6420  .cache (instead 
-000175a0: 7765 2077 696c 6c20 7061 7273 6520 2f65  we will parse /e
-000175b0: 7463 2f6c 642e 736f 2e63 6f6e 6629 0a20  tc/ld.so.conf). 
-000175c0: 2020 202d 202f 6c69 622c 202f 7573 722f     - /lib, /usr/
-000175d0: 6c69 6220 286f 7220 6d61 7962 6520 2f6c  lib (or maybe /l
-000175e0: 6962 3634 2c20 2f75 7372 2f6c 6962 3634  ib64, /usr/lib64
-000175f0: 290a 2020 2020 5669 6120 6874 7470 733a  ).    Via https:
-00017600: 2f2f 6769 7468 7562 2e63 6f6d 2f61 6c62  //github.com/alb
-00017610: 6572 747a 2f73 7973 7465 6d2d 746f 6f6c  ertz/system-tool
-00017620: 732f 626c 6f62 2f6d 6173 7465 722f 6269  s/blob/master/bi
-00017630: 6e2f 6669 6e64 2d6c 6962 2d69 6e2d 7061  n/find-lib-in-pa
-00017640: 7468 2e70 792e 0a0a 2020 2020 3a72 7479  th.py...    :rty
-00017650: 7065 3a20 6c69 7374 5b73 7472 5d0a 2020  pe: list[str].  
-00017660: 2020 3a72 6574 7572 6e3a 206c 6973 7420    :return: list 
-00017670: 6f66 2070 6174 6873 2074 6f20 7365 6172  of paths to sear
-00017680: 6368 2066 6f72 206c 6962 7320 282a 2e73  ch for libs (*.s
-00017690: 6f20 6669 6c65 7329 0a20 2020 2022 2222  o files).    """
-000176a0: 0a20 2020 2070 6174 6873 203d 205b 5d0a  .    paths = [].
-000176b0: 2020 2020 6966 2022 4c44 5f4c 4942 5241      if "LD_LIBRA
-000176c0: 5259 5f50 4154 4822 2069 6e20 6f73 2e65  RY_PATH" in os.e
-000176d0: 6e76 6972 6f6e 3a0a 2020 2020 2020 2020  nviron:.        
-000176e0: 7061 7468 732e 6578 7465 6e64 286f 732e  paths.extend(os.
-000176f0: 656e 7669 726f 6e5b 224c 445f 4c49 4252  environ["LD_LIBR
-00017700: 4152 595f 5041 5448 225d 2e73 706c 6974  ARY_PATH"].split
-00017710: 2822 3a22 2929 0a20 2020 2069 6620 6f73  (":")).    if os
-00017720: 2e70 6174 682e 6578 6973 7473 2822 2f65  .path.exists("/e
-00017730: 7463 2f6c 642e 736f 2e63 6f6e 6622 293a  tc/ld.so.conf"):
-00017740: 0a20 2020 2020 2020 2070 6174 6873 2e65  .        paths.e
-00017750: 7874 656e 6428 7061 7273 655f 6c64 5f63  xtend(parse_ld_c
-00017760: 6f6e 665f 6669 6c65 2822 2f65 7463 2f6c  onf_file("/etc/l
-00017770: 642e 736f 2e63 6f6e 6622 2929 0a20 2020  d.so.conf")).   
-00017780: 2070 6174 6873 2e65 7874 656e 6428 5b22   paths.extend(["
-00017790: 2f6c 6962 222c 2022 2f75 7372 2f6c 6962  /lib", "/usr/lib
-000177a0: 222c 2022 2f6c 6962 3634 222c 2022 2f75  ", "/lib64", "/u
-000177b0: 7372 2f6c 6962 3634 225d 290a 2020 2020  sr/lib64"]).    
-000177c0: 7265 7475 726e 2070 6174 6873 0a0a 0a64  return paths...d
-000177d0: 6566 2066 696e 645f 6c69 6228 6c69 625f  ef find_lib(lib_
-000177e0: 6e61 6d65 293a 0a20 2020 2022 2222 0a20  name):.    """. 
-000177f0: 2020 203a 7061 7261 6d20 7374 7220 6c69     :param str li
-00017800: 625f 6e61 6d65 3a20 7769 7468 6f75 7420  b_name: without 
-00017810: 706f 7374 6669 782f 7072 6566 6978 2c20  postfix/prefix, 
-00017820: 652e 672e 2022 6375 6461 7274 2220 6f72  e.g. "cudart" or
-00017830: 2022 626c 6173 220a 2020 2020 3a72 6574   "blas".    :ret
-00017840: 7572 6e3a 2072 6574 7572 6e73 2066 756c  urn: returns ful
-00017850: 6c20 7061 7468 2074 6f20 6c69 6220 6f72  l path to lib or
-00017860: 204e 6f6e 650a 2020 2020 3a72 7479 7065   None.    :rtype
-00017870: 3a20 7374 727c 4e6f 6e65 0a20 2020 2022  : str|None.    "
-00017880: 2222 0a20 2020 2069 6620 7379 732e 706c  "".    if sys.pl
-00017890: 6174 666f 726d 203d 3d20 2264 6172 7769  atform == "darwi
-000178a0: 6e22 3a0a 2020 2020 2020 2020 7072 6566  n":.        pref
-000178b0: 6978 203d 2022 6c69 6222 0a20 2020 2020  ix = "lib".     
-000178c0: 2020 2070 6f73 7466 6978 203d 2022 2e64     postfix = ".d
-000178d0: 796c 6962 220a 2020 2020 656c 6966 2073  ylib".    elif s
-000178e0: 7973 2e70 6c61 7466 6f72 6d20 3d3d 2022  ys.platform == "
-000178f0: 7769 6e33 3222 3a0a 2020 2020 2020 2020  win32":.        
-00017900: 7072 6566 6978 203d 2022 220a 2020 2020  prefix = "".    
-00017910: 2020 2020 706f 7374 6669 7820 3d20 222e      postfix = ".
-00017920: 646c 6c22 0a20 2020 2065 6c73 653a 0a20  dll".    else:. 
-00017930: 2020 2020 2020 2070 7265 6669 7820 3d20         prefix = 
-00017940: 226c 6962 220a 2020 2020 2020 2020 706f  "lib".        po
-00017950: 7374 6669 7820 3d20 222e 736f 220a 2020  stfix = ".so".  
-00017960: 2020 666f 7220 7061 7468 2069 6e20 6765    for path in ge
-00017970: 745f 6c64 5f70 6174 6873 2829 3a0a 2020  t_ld_paths():.  
-00017980: 2020 2020 2020 666e 203d 2022 2573 2f25        fn = "%s/%
-00017990: 7325 7325 7322 2025 2028 7061 7468 2c20  s%s%s" % (path, 
-000179a0: 7072 6566 6978 2c20 6c69 625f 6e61 6d65  prefix, lib_name
-000179b0: 2c20 706f 7374 6669 7829 0a20 2020 2020  , postfix).     
-000179c0: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-000179d0: 6973 7473 2866 6e29 3a0a 2020 2020 2020  ists(fn):.      
-000179e0: 2020 2020 2020 7265 7475 726e 2066 6e0a        return fn.
-000179f0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-00017a00: 0a0a 6465 6620 7265 6164 5f73 6765 5f6e  ..def read_sge_n
-00017a10: 756d 5f70 726f 6373 286a 6f62 5f69 643d  um_procs(job_id=
-00017a20: 4e6f 6e65 293a 0a20 2020 2022 2222 0a20  None):.    """. 
-00017a30: 2020 2046 726f 6d20 7468 6520 5375 6e20     From the Sun 
-00017a40: 4772 6964 2045 6e67 696e 6520 2853 4745  Grid Engine (SGE
-00017a50: 292c 2072 6561 6473 2074 6865 206e 756d  ), reads the num
-00017a60: 5f70 726f 6320 7365 7474 696e 6720 666f  _proc setting fo
-00017a70: 7220 6120 7061 7274 6963 756c 6172 206a  r a particular j
-00017a80: 6f62 2e0a 2020 2020 4966 206a 6f62 5f69  ob..    If job_i
-00017a90: 6420 6973 206e 6f74 2070 726f 7669 6465  d is not provide
-00017aa0: 6420 616e 6420 7468 6520 4a4f 425f 4944  d and the JOB_ID
-00017ab0: 2065 6e76 2069 7320 7365 742c 2069 7420   env is set, it 
-00017ac0: 7769 6c6c 2075 7365 2074 6861 7420 696e  will use that in
-00017ad0: 7374 6561 6420 2869 2e65 2e20 6974 2075  stead (i.e. it u
-00017ae0: 7365 7320 7468 6520 6375 7272 656e 7420  ses the current 
-00017af0: 6a6f 6229 2e0a 2020 2020 5468 6973 2063  job)..    This c
-00017b00: 616c 6c73 2071 7374 6174 2074 6f20 6669  alls qstat to fi
-00017b10: 6775 7265 206f 7574 2074 6869 7320 7365  gure out this se
-00017b20: 7474 696e 672e 2054 6865 7265 2061 7265  tting. There are
-00017b30: 206d 756c 7469 706c 6520 7761 7973 2074   multiple ways t
-00017b40: 6869 7320 6361 6e20 676f 2077 726f 6e67  his can go wrong
-00017b50: 2c0a 2020 2020 736f 2062 6574 7465 7220  ,.    so better 
-00017b60: 6361 7463 6820 616e 7920 6578 6365 7074  catch any except
-00017b70: 696f 6e2e 0a0a 2020 2020 3a70 6172 616d  ion...    :param
-00017b80: 2069 6e74 7c4e 6f6e 6520 6a6f 625f 6964   int|None job_id
-00017b90: 3a0a 2020 2020 3a72 6574 7572 6e3a 206e  :.    :return: n
-00017ba0: 756d 5f70 726f 630a 2020 2020 3a72 7479  um_proc.    :rty
-00017bb0: 7065 3a20 696e 747c 4e6f 6e65 0a20 2020  pe: int|None.   
-00017bc0: 2022 2222 0a20 2020 2069 6620 6e6f 7420   """.    if not 
-00017bd0: 6a6f 625f 6964 3a0a 2020 2020 2020 2020  job_id:.        
-00017be0: 6966 206e 6f74 206f 732e 656e 7669 726f  if not os.enviro
-00017bf0: 6e2e 6765 7428 2253 4745 5f52 4f4f 5422  n.get("SGE_ROOT"
-00017c00: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00017c10: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
-00017c20: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00017c30: 2020 2020 2320 7169 6e74 2e70 7920 6d69      # qint.py mi
-00017c40: 6768 7420 6f76 6572 7772 6974 6520 4a4f  ght overwrite JO
-00017c50: 425f 4944 2062 7574 2073 6574 7320 5347  B_ID but sets SG
-00017c60: 455f 4a4f 425f 4944 2069 6e73 7465 6164  E_JOB_ID instead
-00017c70: 2e0a 2020 2020 2020 2020 2020 2020 6a6f  ..            jo
-00017c80: 625f 6964 203d 2069 6e74 286f 732e 656e  b_id = int(os.en
-00017c90: 7669 726f 6e2e 6765 7428 2253 4745 5f4a  viron.get("SGE_J
-00017ca0: 4f42 5f49 4422 2920 6f72 206f 732e 656e  OB_ID") or os.en
-00017cb0: 7669 726f 6e2e 6765 7428 224a 4f42 5f49  viron.get("JOB_I
-00017cc0: 4422 2920 6f72 2030 290a 2020 2020 2020  D") or 0).      
-00017cd0: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
-00017ce0: 726f 7220 6173 2065 7863 3a0a 2020 2020  ror as exc:.    
-00017cf0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-00017d00: 6365 7074 696f 6e28 2272 6561 645f 7367  ception("read_sg
-00017d10: 655f 6e75 6d5f 7072 6f63 733a 2025 722c  e_num_procs: %r,
-00017d20: 2069 6e76 616c 6964 204a 4f42 5f49 443a   invalid JOB_ID:
-00017d30: 2025 7222 2025 2028 6578 632c 206f 732e   %r" % (exc, os.
-00017d40: 656e 7669 726f 6e2e 6765 7428 224a 4f42  environ.get("JOB
-00017d50: 5f49 4422 2929 290a 2020 2020 2020 2020  _ID"))).        
-00017d60: 6966 206e 6f74 206a 6f62 5f69 643a 0a20  if not job_id:. 
-00017d70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017d80: 6e20 4e6f 6e65 0a20 2020 2066 726f 6d20  n None.    from 
-00017d90: 7375 6270 726f 6365 7373 2069 6d70 6f72  subprocess impor
-00017da0: 7420 506f 7065 6e2c 2050 4950 452c 2043  t Popen, PIPE, C
-00017db0: 616c 6c65 6450 726f 6365 7373 4572 726f  alledProcessErro
-00017dc0: 720a 0a20 2020 2073 6765 5f63 6d64 203d  r..    sge_cmd =
-00017dd0: 205b 2271 7374 6174 222c 2022 2d6a 222c   ["qstat", "-j",
-00017de0: 2073 7472 286a 6f62 5f69 6429 5d0a 2020   str(job_id)].  
-00017df0: 2020 7072 6f63 203d 2050 6f70 656e 2873    proc = Popen(s
-00017e00: 6765 5f63 6d64 2c20 7374 646f 7574 3d50  ge_cmd, stdout=P
-00017e10: 4950 4529 0a20 2020 2073 7464 6f75 742c  IPE).    stdout,
-00017e20: 205f 203d 2070 726f 632e 636f 6d6d 756e   _ = proc.commun
-00017e30: 6963 6174 6528 290a 2020 2020 6966 2070  icate().    if p
-00017e40: 726f 632e 7265 7475 726e 636f 6465 3a0a  roc.returncode:.
-00017e50: 2020 2020 2020 2020 7261 6973 6520 4361          raise Ca
-00017e60: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-00017e70: 2870 726f 632e 7265 7475 726e 636f 6465  (proc.returncode
-00017e80: 2c20 7367 655f 636d 642c 2073 7464 6f75  , sge_cmd, stdou
-00017e90: 7429 0a20 2020 2073 7464 6f75 7420 3d20  t).    stdout = 
-00017ea0: 7374 646f 7574 2e64 6563 6f64 6528 2275  stdout.decode("u
-00017eb0: 7466 3822 290a 2020 2020 6c73 203d 205b  tf8").    ls = [
-00017ec0: 0a20 2020 2020 2020 206c 696e 655b 6c65  .        line[le
-00017ed0: 6e28 2268 6172 6420 7265 736f 7572 6365  n("hard resource
-00017ee0: 5f6c 6973 743a 2229 203a 5d2e 7374 7269  _list:") :].stri
-00017ef0: 7028 290a 2020 2020 2020 2020 666f 7220  p().        for 
-00017f00: 6c69 6e65 2069 6e20 7374 646f 7574 2e73  line in stdout.s
-00017f10: 706c 6974 6c69 6e65 7328 290a 2020 2020  plitlines().    
-00017f20: 2020 2020 6966 206c 696e 652e 7374 6172      if line.star
-00017f30: 7473 7769 7468 2822 6861 7264 2072 6573  tswith("hard res
-00017f40: 6f75 7263 655f 6c69 7374 3a22 290a 2020  ource_list:").  
-00017f50: 2020 5d0a 2020 2020 6173 7365 7274 206c    ].    assert l
-00017f60: 656e 286c 7329 203d 3d20 310a 2020 2020  en(ls) == 1.    
-00017f70: 6f70 7473 203d 2064 6963 7428 5b6f 7074  opts = dict([opt
-00017f80: 2e73 706c 6974 2822 3d22 2c20 3129 2066  .split("=", 1) f
-00017f90: 6f72 206f 7074 2069 6e20 6c73 5b30 5d2e  or opt in ls[0].
-00017fa0: 7370 6c69 7428 222c 2229 5d29 2020 2320  split(",")])  # 
-00017fb0: 6e6f 7161 0a20 2020 2074 7279 3a0a 2020  noqa.    try:.  
-00017fc0: 2020 2020 2020 7265 7475 726e 2069 6e74        return int
-00017fd0: 286f 7074 735b 226e 756d 5f70 726f 6322  (opts["num_proc"
-00017fe0: 5d29 0a20 2020 2065 7863 6570 7420 5661  ]).    except Va
-00017ff0: 6c75 6545 7272 6f72 2061 7320 6578 633a  lueError as exc:
-00018000: 0a20 2020 2020 2020 2072 6169 7365 2045  .        raise E
-00018010: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
-00018020: 2020 2020 2020 2272 6561 645f 7367 655f        "read_sge_
-00018030: 6e75 6d5f 7072 6f63 733a 2025 722c 2069  num_procs: %r, i
-00018040: 6e76 616c 6964 206e 756d 5f70 726f 6320  nvalid num_proc 
-00018050: 2572 2066 6f72 206a 6f62 2069 6420 2569  %r for job id %i
-00018060: 2e5c 6e6c 696e 653a 2025 7222 0a20 2020  .\nline: %r".   
-00018070: 2020 2020 2020 2020 2025 2028 6578 632c           % (exc,
-00018080: 206f 7074 735b 226e 756d 5f70 726f 6322   opts["num_proc"
-00018090: 5d2c 206a 6f62 5f69 642c 206c 735b 305d  ], job_id, ls[0]
-000180a0: 290a 2020 2020 2020 2020 290a 0a0a 6465  ).        )...de
-000180b0: 6620 6765 745f 6e75 6d62 6572 5f61 7661  f get_number_ava
-000180c0: 696c 6162 6c65 5f63 7075 7328 293a 0a20  ilable_cpus():. 
-000180d0: 2020 2022 2222 0a20 2020 203a 7265 7475     """.    :retu
-000180e0: 726e 3a20 6e75 6d62 6572 206f 6620 6176  rn: number of av
-000180f0: 6169 6c61 626c 6520 4350 5573 2c20 6966  ailable CPUs, if
-00018100: 2077 6520 6361 6e20 6669 6775 7265 2069   we can figure i
-00018110: 7420 6f75 740a 2020 2020 3a72 7479 7065  t out.    :rtype
-00018120: 3a20 696e 747c 4e6f 6e65 0a20 2020 2022  : int|None.    "
-00018130: 2222 0a20 2020 2069 6620 6861 7361 7474  "".    if hasatt
-00018140: 7228 6f73 2c20 2273 6368 6564 5f67 6574  r(os, "sched_get
-00018150: 6166 6669 6e69 7479 2229 3a20 2023 2050  affinity"):  # P
-00018160: 7974 686f 6e20 3e3d 332e 340a 2020 2020  ython >=3.4.    
-00018170: 2020 2020 7265 7475 726e 206c 656e 286f      return len(o
-00018180: 732e 7363 6865 645f 6765 7461 6666 696e  s.sched_getaffin
-00018190: 6974 7928 3029 290a 2020 2020 7472 793a  ity(0)).    try:
-000181a0: 0a20 2020 2020 2020 2023 206e 6f69 6e73  .        # noins
-000181b0: 7065 6374 696f 6e20 5079 5061 636b 6167  pection PyPackag
-000181c0: 6552 6571 7569 7265 6d65 6e74 732c 5079  eRequirements,Py
-000181d0: 556e 7265 736f 6c76 6564 5265 6665 7265  UnresolvedRefere
-000181e0: 6e63 6573 0a20 2020 2020 2020 2069 6d70  nces.        imp
-000181f0: 6f72 7420 7073 7574 696c 0a0a 2020 2020  ort psutil..    
-00018200: 2020 2020 7072 6f63 203d 2070 7375 7469      proc = psuti
-00018210: 6c2e 5072 6f63 6573 7328 290a 2020 2020  l.Process().    
-00018220: 2020 2020 6966 2068 6173 6174 7472 2870      if hasattr(p
-00018230: 726f 632c 2022 6370 755f 6166 6669 6e69  roc, "cpu_affini
-00018240: 7479 2229 3a0a 2020 2020 2020 2020 2020  ty"):.          
-00018250: 2020 7265 7475 726e 206c 656e 2870 726f    return len(pro
-00018260: 632e 6370 755f 6166 6669 6e69 7479 2829  c.cpu_affinity()
-00018270: 290a 2020 2020 6578 6365 7074 2049 6d70  ).    except Imp
-00018280: 6f72 7445 7272 6f72 3a0a 2020 2020 2020  ortError:.      
-00018290: 2020 7061 7373 0a20 2020 2069 6620 6861    pass.    if ha
-000182a0: 7361 7474 7228 6f73 2c20 2273 7973 636f  sattr(os, "sysco
-000182b0: 6e66 2229 2061 6e64 2022 5343 5f4e 5052  nf") and "SC_NPR
-000182c0: 4f43 4553 534f 5253 5f4f 4e4c 4e22 2069  OCESSORS_ONLN" i
-000182d0: 6e20 6f73 2e73 7973 636f 6e66 5f6e 616d  n os.sysconf_nam
-000182e0: 6573 3a0a 2020 2020 2020 2020 7265 7475  es:.        retu
-000182f0: 726e 206f 732e 7379 7363 6f6e 6628 2253  rn os.sysconf("S
-00018300: 435f 4e50 524f 4345 5353 4f52 535f 4f4e  C_NPROCESSORS_ON
-00018310: 4c4e 2229 0a20 2020 2069 6620 6861 7361  LN").    if hasa
-00018320: 7474 7228 6f73 2c20 2263 7075 5f63 6f75  ttr(os, "cpu_cou
-00018330: 6e74 2229 3a20 2023 2050 7974 686f 6e20  nt"):  # Python 
-00018340: 3e3d 332e 340a 2020 2020 2020 2020 7265  >=3.4.        re
-00018350: 7475 726e 206f 732e 6370 755f 636f 756e  turn os.cpu_coun
-00018360: 7428 2920 2023 206e 6f74 2071 7569 7465  t()  # not quite
-00018370: 2063 6f72 7265 6374 3b20 7468 6174 2061   correct; that a
-00018380: 7265 2061 6c6c 2069 6e20 7468 6520 7379  re all in the sy
-00018390: 7374 656d 0a20 2020 2072 6574 7572 6e20  stem.    return 
-000183a0: 4e6f 6e65 0a0a 0a64 6566 2067 7565 7373  None...def guess
-000183b0: 5f72 6571 7565 7374 6564 5f6d 6178 5f6e  _requested_max_n
-000183c0: 756d 5f74 6872 6561 6473 286c 6f67 5f66  um_threads(log_f
-000183d0: 696c 653d 4e6f 6e65 2c20 6661 6c6c 6261  ile=None, fallba
-000183e0: 636b 5f6e 756d 5f63 7075 733d 5472 7565  ck_num_cpus=True
-000183f0: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-00018400: 7061 7261 6d20 696f 2e46 696c 6520 6c6f  param io.File lo
-00018410: 675f 6669 6c65 3a0a 2020 2020 3a70 6172  g_file:.    :par
-00018420: 616d 2062 6f6f 6c20 6661 6c6c 6261 636b  am bool fallback
-00018430: 5f6e 756d 5f63 7075 733a 0a20 2020 203a  _num_cpus:.    :
-00018440: 7274 7970 653a 2069 6e74 7c4e 6f6e 650a  rtype: int|None.
-00018450: 2020 2020 2222 220a 2020 2020 7472 793a      """.    try:
-00018460: 0a20 2020 2020 2020 2073 6765 5f6e 756d  .        sge_num
-00018470: 5f70 726f 6373 203d 2072 6561 645f 7367  _procs = read_sg
-00018480: 655f 6e75 6d5f 7072 6f63 7328 290a 2020  e_num_procs().  
-00018490: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-000184a0: 6f6e 2061 7320 6578 633a 0a20 2020 2020  on as exc:.     
-000184b0: 2020 2069 6620 6c6f 675f 6669 6c65 3a0a     if log_file:.
-000184c0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000184d0: 7428 2245 7272 6f72 2077 6869 6c65 2067  t("Error while g
-000184e0: 6574 7469 6e67 2053 4745 206e 756d 5f70  etting SGE num_p
-000184f0: 726f 633a 2025 7222 2025 2065 7863 2c20  roc: %r" % exc, 
-00018500: 6669 6c65 3d6c 6f67 5f66 696c 6529 0a20  file=log_file). 
-00018510: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00018520: 2069 6620 7367 655f 6e75 6d5f 7072 6f63   if sge_num_proc
-00018530: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-00018540: 6620 6c6f 675f 6669 6c65 3a0a 2020 2020  f log_file:.    
-00018550: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00018560: 7428 2255 7365 206e 756d 5f74 6872 6561  t("Use num_threa
-00018570: 6473 3d25 6920 2862 7574 206d 696e 2032  ds=%i (but min 2
-00018580: 2920 7669 6120 5347 4520 6e75 6d5f 7072  ) via SGE num_pr
-00018590: 6f63 2e22 2025 2073 6765 5f6e 756d 5f70  oc." % sge_num_p
-000185a0: 726f 6373 2c20 6669 6c65 3d6c 6f67 5f66  rocs, file=log_f
-000185b0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-000185c0: 2072 6574 7572 6e20 6d61 7828 7367 655f   return max(sge_
-000185d0: 6e75 6d5f 7072 6f63 732c 2032 290a 2020  num_procs, 2).  
-000185e0: 2020 6f6d 705f 6e75 6d5f 7468 7265 6164    omp_num_thread
-000185f0: 7320 3d20 696e 7428 6f73 2e65 6e76 6972  s = int(os.envir
-00018600: 6f6e 2e67 6574 2822 4f4d 505f 4e55 4d5f  on.get("OMP_NUM_
-00018610: 5448 5245 4144 5322 2920 6f72 2030 290a  THREADS") or 0).
-00018620: 2020 2020 6966 206f 6d70 5f6e 756d 5f74      if omp_num_t
-00018630: 6872 6561 6473 3a0a 2020 2020 2020 2020  hreads:.        
-00018640: 2320 4d69 6e69 6d75 6d20 6f66 2032 2074  # Minimum of 2 t
-00018650: 6872 6561 6473 2c20 7368 6f75 6c64 206e  hreads, should n
-00018660: 6f74 2068 7572 742e 0a20 2020 2020 2020  ot hurt..       
-00018670: 2069 6620 6c6f 675f 6669 6c65 3a0a 2020   if log_file:.  
-00018680: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00018690: 2255 7365 206e 756d 5f74 6872 6561 6473  "Use num_threads
-000186a0: 3d25 6920 2862 7574 206d 696e 2032 2920  =%i (but min 2) 
-000186b0: 7669 6120 4f4d 505f 4e55 4d5f 5448 5245  via OMP_NUM_THRE
-000186c0: 4144 532e 2220 2520 6f6d 705f 6e75 6d5f  ADS." % omp_num_
-000186d0: 7468 7265 6164 732c 2066 696c 653d 6c6f  threads, file=lo
-000186e0: 675f 6669 6c65 290a 2020 2020 2020 2020  g_file).        
-000186f0: 7265 7475 726e 206d 6178 286f 6d70 5f6e  return max(omp_n
-00018700: 756d 5f74 6872 6561 6473 2c20 3229 0a20  um_threads, 2). 
-00018710: 2020 2069 6620 6661 6c6c 6261 636b 5f6e     if fallback_n
-00018720: 756d 5f63 7075 733a 0a20 2020 2020 2020  um_cpus:.       
-00018730: 2072 6574 7572 6e20 6765 745f 6e75 6d62   return get_numb
-00018740: 6572 5f61 7661 696c 6162 6c65 5f63 7075  er_available_cpu
-00018750: 7328 290a 2020 2020 7265 7475 726e 204e  s().    return N
-00018760: 6f6e 650a 0a0a 5468 6561 6e6f 466c 6167  one...TheanoFlag
-00018770: 7320 3d20 7b0a 2020 2020 6b65 793a 2076  s = {.    key: v
-00018780: 616c 7565 2066 6f72 2028 6b65 792c 2076  alue for (key, v
-00018790: 616c 7565 2920 696e 205b 732e 7370 6c69  alue) in [s.spli
-000187a0: 7428 223d 222c 2031 2920 666f 7220 7320  t("=", 1) for s 
-000187b0: 696e 206f 732e 656e 7669 726f 6e2e 6765  in os.environ.ge
-000187c0: 7428 2254 4845 414e 4f5f 464c 4147 5322  t("THEANO_FLAGS"
-000187d0: 2c20 2222 292e 7370 6c69 7428 222c 2229  , "").split(",")
-000187e0: 2069 6620 735d 0a7d 0a0a 0a64 6566 205f   if s].}...def _
-000187f0: 636f 6e73 6964 6572 5f63 6865 636b 5f66  consider_check_f
-00018800: 6f72 5f67 7075 2829 3a0a 2020 2020 2222  or_gpu():.    ""
-00018810: 220a 2020 2020 5468 6572 6520 6172 6520  ".    There are 
-00018820: 6361 7365 7320 7768 6572 6520 6e76 6964  cases where nvid
-00018830: 6961 2d73 6d69 2063 6f75 6c64 2068 616e  ia-smi could han
-00018840: 672e 0a20 2020 2028 416e 7920 7265 6164  g..    (Any read
-00018850: 206f 6620 2f70 726f 632f 6d6f 6475 6c65   of /proc/module
-00018860: 7320 6d69 6768 7420 6861 6e67 2069 6e20  s might hang in 
-00018870: 7468 6174 2063 6173 652c 206d 6179 6265  that case, maybe
-00018880: 2063 6175 7365 640a 2020 2020 2062 7920   caused.     by 
-00018890: 7472 7969 6e67 2074 6f20 606d 6f64 7072  trying to `modpr
-000188a0: 6f62 6520 6e76 6964 6961 6020 746f 2063  obe nvidia` to c
-000188b0: 6865 636b 2069 6620 7468 6572 6520 6973  heck if there is
-000188c0: 2061 204e 7669 6469 6120 6361 7264 2e29   a Nvidia card.)
-000188d0: 0a20 2020 2054 6869 7320 736f 6d65 7469  .    This someti
-000188e0: 6d65 7320 6861 7070 656e 7320 696e 206f  mes happens in o
-000188f0: 7572 2053 4745 2063 6c75 7374 6572 206f  ur SGE cluster o
-00018900: 6e20 6e6f 6465 7320 7769 7468 6f75 7420  n nodes without 
-00018910: 4e76 6964 6961 2063 6172 6473 2e0a 2020  Nvidia cards..  
-00018920: 2020 4d61 7962 6520 6974 2773 2061 6c73    Maybe it's als
-00018930: 6f20 6120 4c69 6e75 7820 4b65 726e 656c  o a Linux Kernel
-00018940: 2062 7567 2e0a 2020 2020 416e 7977 6179   bug..    Anyway
-00018950: 2c20 6a75 7374 2061 766f 6964 2061 6e79  , just avoid any
-00018960: 2073 7563 6820 6368 6563 6b20 6966 2077   such check if w
-00018970: 6520 646f 6e27 7420 6173 6b65 6420 666f  e don't asked fo
-00018980: 7220 6120 4750 552e 0a0a 2020 2020 3a72  r a GPU...    :r
-00018990: 7479 7065 3a20 626f 6f6c 0a20 2020 2022  type: bool.    "
-000189a0: 2222 0a20 2020 2069 6620 2264 6576 6963  "".    if "devic
-000189b0: 6522 2069 6e20 5468 6561 6e6f 466c 6167  e" in TheanoFlag
-000189c0: 733a 0a20 2020 2020 2020 2064 6576 203d  s:.        dev =
-000189d0: 2054 6865 616e 6f46 6c61 6773 5b22 6465   TheanoFlags["de
-000189e0: 7669 6365 225d 0a20 2020 2020 2020 2069  vice"].        i
-000189f0: 6620 6465 762e 7374 6172 7473 7769 7468  f dev.startswith
-00018a00: 2822 6770 7522 2920 6f72 2064 6576 2e73  ("gpu") or dev.s
-00018a10: 7461 7274 7377 6974 6828 2263 7564 6122  tartswith("cuda"
-00018a20: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00018a30: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-00018a40: 2020 2023 2054 4845 414e 4f5f 464c 4147     # THEANO_FLAG
-00018a50: 5320 7769 6c6c 206f 7665 7277 7269 7465  S will overwrite
-00018a60: 2074 6869 7320 636f 6e66 6967 206f 7074   this config opt
-00018a70: 696f 6e2e 2053 6565 2072 6e6e 2e69 6e69  ion. See rnn.ini
-00018a80: 7444 6576 6963 6573 2829 2e0a 2020 2020  tDevices()..    
-00018a90: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00018aa0: 0a20 2020 2023 206e 6f69 6e73 7065 6374  .    # noinspect
-00018ab0: 696f 6e20 5079 4272 6f61 6445 7863 6570  ion PyBroadExcep
-00018ac0: 7469 6f6e 0a20 2020 2074 7279 3a0a 2020  tion.    try:.  
-00018ad0: 2020 2020 2020 6672 6f6d 2072 6574 7572        from retur
-00018ae0: 6e6e 2e63 6f6e 6669 6720 696d 706f 7274  nn.config import
-00018af0: 2067 6574 5f67 6c6f 6261 6c5f 636f 6e66   get_global_conf
-00018b00: 6967 0a0a 2020 2020 2020 2020 636f 6e66  ig..        conf
-00018b10: 6967 203d 2067 6574 5f67 6c6f 6261 6c5f  ig = get_global_
-00018b20: 636f 6e66 6967 2829 0a20 2020 2065 7863  config().    exc
-00018b30: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-00018b40: 2020 2020 2020 2063 6f6e 6669 6720 3d20         config = 
-00018b50: 4e6f 6e65 0a20 2020 2069 6620 636f 6e66  None.    if conf
-00018b60: 6967 3a0a 2020 2020 2020 2020 666f 7220  ig:.        for 
-00018b70: 6465 7620 696e 2063 6f6e 6669 672e 6c69  dev in config.li
-00018b80: 7374 2822 6465 7669 6365 222c 205b 5d29  st("device", [])
-00018b90: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00018ba0: 2064 6576 2e73 7461 7274 7377 6974 6828   dev.startswith(
-00018bb0: 2267 7075 2229 206f 7220 6465 762e 7374  "gpu") or dev.st
-00018bc0: 6172 7473 7769 7468 2822 6375 6461 2229  artswith("cuda")
-00018bd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018be0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-00018bf0: 2020 2020 2020 2020 2020 6966 2064 6576            if dev
-00018c00: 203d 3d20 2261 6c6c 223a 0a20 2020 2020   == "all":.     
-00018c10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00018c20: 6e20 5472 7565 0a20 2020 2072 6574 7572  n True.    retur
-00018c30: 6e20 4661 6c73 650a 0a0a 6465 6620 6765  n False...def ge
-00018c40: 745f 6770 755f 6e61 6d65 7328 293a 0a20  t_gpu_names():. 
-00018c50: 2020 2022 2222 0a20 2020 203a 7274 7970     """.    :rtyp
-00018c60: 653a 206c 6973 745b 7374 725d 0a20 2020  e: list[str].   
-00018c70: 2022 2222 0a20 2020 2069 6620 6e6f 7420   """.    if not 
-00018c80: 5f63 6f6e 7369 6465 725f 6368 6563 6b5f  _consider_check_
-00018c90: 666f 725f 6770 7528 293a 0a20 2020 2020  for_gpu():.     
-00018ca0: 2020 2072 6574 7572 6e20 5b5d 0a20 2020     return [].   
-00018cb0: 2069 6620 6f73 2e6e 616d 6520 3d3d 2022   if os.name == "
-00018cc0: 6e74 223a 0a20 2020 2020 2020 2072 6574  nt":.        ret
-00018cd0: 7572 6e20 2247 6546 6f72 6365 2047 5458  urn "GeForce GTX
-00018ce0: 2037 3730 2220 2023 2054 4f44 4f0a 2020   770"  # TODO.  
-00018cf0: 2020 656c 6966 2073 7973 2e70 6c61 7466    elif sys.platf
-00018d00: 6f72 6d20 3d3d 2022 6461 7277 696e 223a  orm == "darwin":
-00018d10: 0a20 2020 2020 2020 2023 2054 4f44 4f20  .        # TODO 
-00018d20: 7061 7273 6520 7669 6120 786d 6c20 6f75  parse via xml ou
-00018d30: 7470 7574 0a20 2020 2020 2020 2072 6574  tput.        ret
-00018d40: 7572 6e20 7379 735f 636d 645f 6f75 745f  urn sys_cmd_out_
-00018d50: 6c69 6e65 7328 0a20 2020 2020 2020 2020  lines(.         
-00018d60: 2020 2022 7379 7374 656d 5f70 726f 6669     "system_profi
-00018d70: 6c65 7220 5350 4469 7370 6c61 7973 4461  ler SPDisplaysDa
-00018d80: 7461 5479 7065 207c 2022 0a20 2020 2020  taType | ".     
-00018d90: 2020 2020 2020 2022 6772 6570 2027 4368         "grep 'Ch
-00018da0: 6970 7365 7420 4d6f 6465 6c3a 204e 5649  ipset Model: NVI
-00018db0: 4449 4127 207c 2022 0a20 2020 2020 2020  DIA' | ".       
-00018dc0: 2020 2020 2022 7365 6420 2773 2f2e 2a43       "sed 's/.*C
-00018dd0: 6869 7073 6574 204d 6f64 656c 3a20 4e56  hipset Model: NV
-00018de0: 4944 4941 202a 2f2f 3b73 2f20 2a24 2f2f  IDIA *//;s/ *$//
-00018df0: 2722 0a20 2020 2020 2020 2029 0a20 2020  '".        ).   
-00018e00: 2065 6c73 653a 0a20 2020 2020 2020 2074   else:.        t
-00018e10: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00018e20: 7265 7475 726e 2073 7973 5f63 6d64 5f6f  return sys_cmd_o
-00018e30: 7574 5f6c 696e 6573 2822 6e76 6964 6961  ut_lines("nvidia
-00018e40: 2d73 6d69 202d 4c20 7c20 6375 7420 2d64  -smi -L | cut -d
-00018e50: 2027 2827 202d 6620 3120 7c20 6375 7420   '(' -f 1 | cut 
-00018e60: 2d64 2027 2027 202d 6620 332d 207c 2073  -d ' ' -f 3- | s
-00018e70: 6564 202d 6520 2773 2f5c 5c20 242f 2f27  ed -e 's/\\ $//'
-00018e80: 2229 0a20 2020 2020 2020 2065 7863 6570  ").        excep
-00018e90: 7420 4361 6c6c 6564 5072 6f63 6573 7345  t CalledProcessE
-00018ea0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00018eb0: 2020 7265 7475 726e 205b 5d0a 0a0a 6465    return []...de
-00018ec0: 6620 5f67 6574 5f6e 756d 5f67 7075 5f64  f _get_num_gpu_d
-00018ed0: 6576 6963 6573 2829 3a0a 2020 2020 2222  evices():.    ""
-00018ee0: 220a 2020 2020 3a72 6574 7572 6e3a 2063  ".    :return: c
-00018ef0: 7075 2c67 7075 0a20 2020 203a 7274 7970  pu,gpu.    :rtyp
-00018f00: 653a 2028 696e 742c 696e 7429 0a20 2020  e: (int,int).   
-00018f10: 2022 2222 0a20 2020 2069 6620 6f73 2e6e   """.    if os.n
-00018f20: 616d 6520 3d3d 2022 6e74 223a 0a20 2020  ame == "nt":.   
-00018f30: 2020 2020 2072 6574 7572 6e20 312c 2031       return 1, 1
-00018f40: 2020 2320 544f 444f 0a20 2020 2065 6c69    # TODO.    eli
-00018f50: 6620 7379 732e 706c 6174 666f 726d 203d  f sys.platform =
-00018f60: 3d20 2264 6172 7769 6e22 3a0a 2020 2020  = "darwin":.    
-00018f70: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-00018f80: 2020 2020 2020 2020 2069 6e74 2873 7973           int(sys
-00018f90: 5f63 6d64 5f6f 7574 5f6c 696e 6573 2822  _cmd_out_lines("
-00018fa0: 7379 7363 746c 202d 6120 7c20 6772 6570  sysctl -a | grep
-00018fb0: 206d 6163 6864 6570 2e63 7075 2e63 6f72   machdep.cpu.cor
-00018fc0: 655f 636f 756e 7420 7c20 6177 6b20 277b  e_count | awk '{
-00018fd0: 7072 696e 7420 2432 7d27 2229 5b30 5d29  print $2}'")[0])
-00018fe0: 2c0a 2020 2020 2020 2020 2020 2020 6c65  ,.            le
-00018ff0: 6e28 7379 735f 636d 645f 6f75 745f 6c69  n(sys_cmd_out_li
-00019000: 6e65 7328 2273 7973 7465 6d5f 7072 6f66  nes("system_prof
-00019010: 696c 6572 2053 5044 6973 706c 6179 7344  iler SPDisplaysD
-00019020: 6174 6154 7970 6520 7c20 6772 6570 2027  ataType | grep '
-00019030: 4368 6970 7365 7420 4d6f 6465 6c3a 204e  Chipset Model: N
-00019040: 5649 4449 4127 207c 2063 6174 2229 292c  VIDIA' | cat")),
-00019050: 0a20 2020 2020 2020 2029 0a20 2020 2065  .        ).    e
-00019060: 6c73 653a 0a20 2020 2020 2020 206e 756d  lse:.        num
-00019070: 5f63 7075 7320 3d20 6c65 6e28 7379 735f  _cpus = len(sys_
-00019080: 636d 645f 6f75 745f 6c69 6e65 7328 2263  cmd_out_lines("c
-00019090: 6174 202f 7072 6f63 2f63 7075 696e 666f  at /proc/cpuinfo
-000190a0: 207c 2067 7265 7020 7072 6f63 6573 736f   | grep processo
-000190b0: 7222 2929 206f 7220 310a 2020 2020 2020  r")) or 1.      
-000190c0: 2020 6e75 6d5f 6770 7573 203d 2030 0a20    num_gpus = 0. 
-000190d0: 2020 2020 2020 2069 6620 5f63 6f6e 7369         if _consi
-000190e0: 6465 725f 6368 6563 6b5f 666f 725f 6770  der_check_for_gp
-000190f0: 7528 293a 0a20 2020 2020 2020 2020 2020  u():.           
-00019100: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00019110: 2020 2020 2020 6e75 6d5f 6770 7573 203d        num_gpus =
-00019120: 206c 656e 2873 7973 5f63 6d64 5f6f 7574   len(sys_cmd_out
-00019130: 5f6c 696e 6573 2822 6e76 6964 6961 2d73  _lines("nvidia-s
-00019140: 6d69 202d 4c22 2929 0a20 2020 2020 2020  mi -L")).       
-00019150: 2020 2020 2065 7863 6570 7420 4361 6c6c       except Call
-00019160: 6564 5072 6f63 6573 7345 7272 6f72 3a0a  edProcessError:.
-00019170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019180: 7061 7373 0a20 2020 2020 2020 2072 6574  pass.        ret
-00019190: 7572 6e20 6e75 6d5f 6370 7573 2c20 6e75  urn num_cpus, nu
-000191a0: 6d5f 6770 7573 0a0a 0a5f 6e75 6d5f 6465  m_gpus..._num_de
-000191b0: 7669 6365 7320 3d20 4e6f 6e65 0a0a 0a64  vices = None...d
-000191c0: 6566 2067 6574 5f6e 756d 5f67 7075 5f64  ef get_num_gpu_d
-000191d0: 6576 6963 6573 2829 3a0a 2020 2020 2222  evices():.    ""
-000191e0: 220a 2020 2020 3a72 6574 7572 6e3a 2028  ".    :return: (
-000191f0: 6370 7520 636f 756e 742c 2067 7075 2063  cpu count, gpu c
-00019200: 6f75 6e74 290a 2020 2020 3a72 7479 7065  ount).    :rtype
-00019210: 3a20 2869 6e74 2c20 696e 7429 0a20 2020  : (int, int).   
-00019220: 2022 2222 0a20 2020 2067 6c6f 6261 6c20   """.    global 
-00019230: 5f6e 756d 5f64 6576 6963 6573 0a20 2020  _num_devices.   
-00019240: 2069 6620 5f6e 756d 5f64 6576 6963 6573   if _num_devices
-00019250: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00019260: 2020 2020 2020 7265 7475 726e 205f 6e75        return _nu
-00019270: 6d5f 6465 7669 6365 730a 2020 2020 5f6e  m_devices.    _n
-00019280: 756d 5f64 6576 6963 6573 203d 205f 6765  um_devices = _ge
-00019290: 745f 6e75 6d5f 6770 755f 6465 7669 6365  t_num_gpu_device
-000192a0: 7328 290a 2020 2020 7265 7475 726e 205f  s().    return _
-000192b0: 6e75 6d5f 6465 7669 6365 730a 0a0a 6465  num_devices...de
-000192c0: 6620 6861 7665 5f67 7075 2829 3a0a 2020  f have_gpu():.  
-000192d0: 2020 2222 220a 2020 2020 3a72 7479 7065    """.    :rtype
-000192e0: 3a20 626f 6f6c 0a20 2020 2022 2222 0a20  : bool.    """. 
-000192f0: 2020 2063 7075 732c 2067 7075 7320 3d20     cpus, gpus = 
-00019300: 6765 745f 6e75 6d5f 6770 755f 6465 7669  get_num_gpu_devi
-00019310: 6365 7328 290a 2020 2020 7265 7475 726e  ces().    return
-00019320: 2067 7075 7320 3e20 300a 0a0a 6465 6620   gpus > 0...def 
-00019330: 7472 795f 616e 645f 6967 6e6f 7265 5f65  try_and_ignore_e
-00019340: 7863 6570 7469 6f6e 2866 293a 0a20 2020  xception(f):.   
-00019350: 2022 2222 0a20 2020 2043 616c 6c73 2060   """.    Calls `
-00019360: 6066 6060 2c20 616e 6420 6967 6e6f 7265  `f``, and ignore
-00019370: 7320 616e 7920 6578 6365 7074 696f 6e2e  s any exception.
-00019380: 0a0a 2020 2020 3a70 6172 616d 2028 292d  ..    :param ()-
-00019390: 3e54 2066 3a0a 2020 2020 3a72 6574 7572  >T f:.    :retur
-000193a0: 6e3a 2077 6861 7465 7665 7220 6060 6660  n: whatever ``f`
-000193b0: 6020 7265 7475 726e 732c 206f 7220 4e6f  ` returns, or No
-000193c0: 6e65 0a20 2020 203a 7274 7970 653a 2054  ne.    :rtype: T
-000193d0: 7c4e 6f6e 650a 2020 2020 2222 220a 2020  |None.    """.  
-000193e0: 2020 7472 793a 0a20 2020 2020 2020 2072    try:.        r
-000193f0: 6574 7572 6e20 6628 290a 2020 2020 6578  eturn f().    ex
-00019400: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00019410: 7320 6578 633a 0a20 2020 2020 2020 2070  s exc:.        p
-00019420: 7269 6e74 2822 7472 795f 616e 645f 6967  rint("try_and_ig
-00019430: 6e6f 7265 5f65 7863 6570 7469 6f6e 3a20  nore_exception: 
-00019440: 2572 2066 6169 6c65 643a 2025 7322 2025  %r failed: %s" %
-00019450: 2028 662c 2065 7863 2929 0a20 2020 2020   (f, exc)).     
-00019460: 2020 2073 7973 2e65 7863 6570 7468 6f6f     sys.excepthoo
-00019470: 6b28 2a73 7973 2e65 7863 5f69 6e66 6f28  k(*sys.exc_info(
-00019480: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
-00019490: 6e20 4e6f 6e65 0a0a 0a64 6566 2074 7279  n None...def try
-000194a0: 5f67 6574 5f73 7461 636b 5f66 7261 6d65  _get_stack_frame
-000194b0: 2864 6570 7468 3d31 293a 0a20 2020 2022  (depth=1):.    "
-000194c0: 2222 0a20 2020 203a 7061 7261 6d20 696e  "".    :param in
-000194d0: 7420 6465 7074 683a 0a20 2020 203a 7274  t depth:.    :rt
-000194e0: 7970 653a 2074 7970 6573 2e46 7261 6d65  ype: types.Frame
-000194f0: 5479 7065 7c4e 6f6e 650a 2020 2020 3a72  Type|None.    :r
-00019500: 6574 7572 6e3a 2063 616c 6c65 7220 6675  eturn: caller fu
-00019510: 6e63 7469 6f6e 206e 616d 652e 2074 6869  nction name. thi
-00019520: 7320 6973 206a 7573 7420 666f 7220 6465  s is just for de
-00019530: 6275 6767 696e 670a 2020 2020 2222 220a  bugging.    """.
-00019540: 2020 2020 2320 6e6f 696e 7370 6563 7469      # noinspecti
-00019550: 6f6e 2050 7942 726f 6164 4578 6365 7074  on PyBroadExcept
-00019560: 696f 6e0a 2020 2020 7472 793a 0a20 2020  ion.    try:.   
-00019570: 2020 2020 2023 206e 6f69 6e73 7065 6374       # noinspect
-00019580: 696f 6e20 5079 5072 6f74 6563 7465 644d  ion PyProtectedM
-00019590: 656d 6265 722c 5079 556e 7265 736f 6c76  ember,PyUnresolv
-000195a0: 6564 5265 6665 7265 6e63 6573 0a20 2020  edReferences.   
-000195b0: 2020 2020 2066 7261 6d65 203d 2073 7973       frame = sys
-000195c0: 2e5f 6765 7466 7261 6d65 2864 6570 7468  ._getframe(depth
-000195d0: 202b 2031 2920 2023 206f 6e65 206d 6f72   + 1)  # one mor
-000195e0: 6520 746f 2063 6f75 6e74 206f 7572 7365  e to count ourse
-000195f0: 6c76 6573 0a20 2020 2020 2020 2072 6574  lves.        ret
-00019600: 7572 6e20 6672 616d 650a 2020 2020 6578  urn frame.    ex
-00019610: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
-00019620: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00019630: 6f6e 650a 0a0a 6465 6620 7472 795f 6765  one...def try_ge
-00019640: 745f 6361 6c6c 6572 5f6e 616d 6528 6465  t_caller_name(de
-00019650: 7074 683d 312c 2066 616c 6c62 6163 6b3d  pth=1, fallback=
-00019660: 4e6f 6e65 293a 0a20 2020 2022 2222 0a20  None):.    """. 
-00019670: 2020 203a 7061 7261 6d20 696e 7420 6465     :param int de
-00019680: 7074 683a 0a20 2020 203a 7061 7261 6d20  pth:.    :param 
-00019690: 7374 727c 4e6f 6e65 2066 616c 6c62 6163  str|None fallbac
-000196a0: 6b3a 2074 6869 7320 6973 2072 6574 7572  k: this is retur
-000196b0: 6e65 6420 6966 2077 6520 6661 696c 2066  ned if we fail f
-000196c0: 6f72 2073 6f6d 6520 7265 6173 6f6e 0a20  or some reason. 
-000196d0: 2020 203a 7274 7970 653a 2073 7472 7c4e     :rtype: str|N
-000196e0: 6f6e 650a 2020 2020 3a72 6574 7572 6e3a  one.    :return:
-000196f0: 2063 616c 6c65 7220 6675 6e63 7469 6f6e   caller function
-00019700: 206e 616d 652e 2074 6869 7320 6973 206a   name. this is j
-00019710: 7573 7420 666f 7220 6465 6275 6767 696e  ust for debuggin
-00019720: 670a 2020 2020 2222 220a 2020 2020 6672  g.    """.    fr
-00019730: 616d 6520 3d20 7472 795f 6765 745f 7374  ame = try_get_st
-00019740: 6163 6b5f 6672 616d 6528 6465 7074 6820  ack_frame(depth 
-00019750: 2b20 3129 2020 2320 6f6e 6520 6d6f 7265  + 1)  # one more
-00019760: 2074 6f20 636f 756e 7420 6f75 7273 656c   to count oursel
-00019770: 7665 730a 2020 2020 6966 2066 7261 6d65  ves.    if frame
-00019780: 3a0a 2020 2020 2020 2020 6672 6f6d 202e  :.        from .
-00019790: 6265 7474 6572 5f65 7863 686f 6f6b 2069  better_exchook i
-000197a0: 6d70 6f72 7420 6765 745f 6675 6e63 5f73  mport get_func_s
-000197b0: 7472 5f66 726f 6d5f 636f 6465 5f6f 626a  tr_from_code_obj
-000197c0: 6563 740a 0a20 2020 2020 2020 2072 6574  ect..        ret
-000197d0: 7572 6e20 6765 745f 6675 6e63 5f73 7472  urn get_func_str
-000197e0: 5f66 726f 6d5f 636f 6465 5f6f 626a 6563  _from_code_objec
-000197f0: 7428 6672 616d 652e 665f 636f 6465 290a  t(frame.f_code).
-00019800: 2020 2020 7265 7475 726e 2066 616c 6c62      return fallb
-00019810: 6163 6b0a 0a0a 636c 6173 7320 496e 6669  ack...class Infi
-00019820: 6e69 7465 5265 6375 7273 696f 6e44 6574  niteRecursionDet
-00019830: 6563 7465 6428 4578 6365 7074 696f 6e29  ected(Exception)
-00019840: 3a0a 2020 2020 2222 220a 2020 2020 5261  :.    """.    Ra
-00019850: 6973 6564 2077 6865 6e20 616e 2069 6e66  ised when an inf
-00019860: 696e 6974 6520 7265 6375 7273 696f 6e20  inite recursion 
-00019870: 6973 2064 6574 6563 7465 642c 2062 7920  is detected, by 
-00019880: 6775 6172 645f 696e 6669 6e69 7465 5f72  guard_infinite_r
-00019890: 6563 7572 7369 6f6e 2e0a 2020 2020 2222  ecursion..    ""
-000198a0: 220a 0a0a 5f67 7561 7264 5f69 6e66 696e  "..._guard_infin
-000198b0: 6974 655f 7265 6375 7273 696f 6e5f 6361  ite_recursion_ca
-000198c0: 6368 6520 3d20 7468 7265 6164 696e 672e  che = threading.
-000198d0: 6c6f 6361 6c28 290a 0a0a 4063 6f6e 7465  local()...@conte
-000198e0: 7874 6c69 622e 636f 6e74 6578 746d 616e  xtlib.contextman
-000198f0: 6167 6572 0a64 6566 2067 7561 7264 5f69  ager.def guard_i
-00019900: 6e66 696e 6974 655f 7265 6375 7273 696f  nfinite_recursio
-00019910: 6e28 2a61 7267 7329 3a0a 2020 2020 2222  n(*args):.    ""
-00019920: 220a 2020 2020 5265 6769 7374 6572 7320  ".    Registers 
-00019930: 6172 6773 2028 636f 756c 6420 6265 2066  args (could be f
-00019940: 756e 6320 2b20 6172 6773 2920 696e 2073  unc + args) in s
-00019950: 6f6d 6520 6361 6368 652e 0a20 2020 2049  ome cache..    I
-00019960: 6620 7468 6f73 6520 6172 6773 2061 7265  f those args are
-00019970: 2061 6c72 6561 6479 2069 6e20 7468 6520   already in the 
-00019980: 6361 6368 652c 2069 7420 7769 6c6c 2072  cache, it will r
-00019990: 6169 7365 2061 6e20 6578 6365 7074 696f  aise an exceptio
-000199a0: 6e2e 0a0a 2020 2020 4974 2077 696c 6c20  n...    It will 
-000199b0: 7573 6520 7468 6520 6964 206f 6620 7468  use the id of th
-000199c0: 6520 6172 6773 2061 7320 6b65 7920 616e  e args as key an
-000199d0: 6420 6e6f 7420 7573 6520 616e 7920 6861  d not use any ha
-000199e0: 7368 696e 670a 2020 2020 746f 2061 6c6c  shing.    to all
-000199f0: 6f77 2074 6861 7420 6775 6172 645f 696e  ow that guard_in
-00019a00: 6669 6e69 7465 5f72 6563 7572 7369 6f6e  finite_recursion
-00019a10: 2063 616e 2062 6520 7573 6564 0a20 2020   can be used.   
-00019a20: 2074 6f20 6775 6172 6420 6375 7374 6f6d   to guard custom
-00019a30: 205f 5f68 6173 685f 5f20 696d 706c 656d   __hash__ implem
-00019a40: 656e 7461 7469 6f6e 7320 6173 2077 656c  entations as wel
-00019a50: 6c2e 0a20 2020 2022 2222 0a20 2020 2069  l..    """.    i
-00019a60: 6620 6e6f 7420 6172 6773 3a0a 2020 2020  f not args:.    
-00019a70: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00019a80: 7272 6f72 2822 6775 6172 645f 696e 6669  rror("guard_infi
-00019a90: 6e69 7465 5f72 6563 7572 7369 6f6e 206e  nite_recursion n
-00019aa0: 6565 6473 2061 7420 6c65 6173 7420 6f6e  eeds at least on
-00019ab0: 6520 6172 6722 290a 2020 2020 6b65 7920  e arg").    key 
-00019ac0: 3d20 7475 706c 6528 6964 2861 7267 2920  = tuple(id(arg) 
-00019ad0: 666f 7220 6172 6720 696e 2061 7267 7329  for arg in args)
-00019ae0: 0a20 2020 2069 6620 6e6f 7420 6861 7361  .    if not hasa
-00019af0: 7474 7228 5f67 7561 7264 5f69 6e66 696e  ttr(_guard_infin
-00019b00: 6974 655f 7265 6375 7273 696f 6e5f 6361  ite_recursion_ca
-00019b10: 6368 652c 2022 6361 6368 6522 293a 0a20  che, "cache"):. 
-00019b20: 2020 2020 2020 205f 6775 6172 645f 696e         _guard_in
-00019b30: 6669 6e69 7465 5f72 6563 7572 7369 6f6e  finite_recursion
-00019b40: 5f63 6163 6865 2e63 6163 6865 203d 2073  _cache.cache = s
-00019b50: 6574 2829 0a20 2020 2069 6620 6b65 7920  et().    if key 
-00019b60: 696e 205f 6775 6172 645f 696e 6669 6e69  in _guard_infini
-00019b70: 7465 5f72 6563 7572 7369 6f6e 5f63 6163  te_recursion_cac
-00019b80: 6865 2e63 6163 6865 3a0a 2020 2020 2020  he.cache:.      
-00019b90: 2020 7261 6973 6520 496e 6669 6e69 7465    raise Infinite
-00019ba0: 5265 6375 7273 696f 6e44 6574 6563 7465  RecursionDetecte
-00019bb0: 6428 2269 6e66 696e 6974 6520 7265 6375  d("infinite recu
-00019bc0: 7273 696f 6e20 6465 7465 6374 6564 2229  rsion detected")
-00019bd0: 0a20 2020 205f 6775 6172 645f 696e 6669  .    _guard_infi
-00019be0: 6e69 7465 5f72 6563 7572 7369 6f6e 5f63  nite_recursion_c
-00019bf0: 6163 6865 2e63 6163 6865 2e61 6464 286b  ache.cache.add(k
-00019c00: 6579 290a 2020 2020 7472 793a 0a20 2020  ey).    try:.   
-00019c10: 2020 2020 2079 6965 6c64 0a20 2020 2066       yield.    f
-00019c20: 696e 616c 6c79 3a0a 2020 2020 2020 2020  inally:.        
-00019c30: 5f67 7561 7264 5f69 6e66 696e 6974 655f  _guard_infinite_
-00019c40: 7265 6375 7273 696f 6e5f 6361 6368 652e  recursion_cache.
-00019c50: 6361 6368 652e 7265 6d6f 7665 286b 6579  cache.remove(key
-00019c60: 290a 0a0a 6465 6620 6361 6d65 6c5f 6361  )...def camel_ca
-00019c70: 7365 5f74 6f5f 736e 616b 655f 6361 7365  se_to_snake_case
-00019c80: 286e 616d 6529 3a0a 2020 2020 2222 220a  (name):.    """.
-00019c90: 2020 2020 3a70 6172 616d 2073 7472 206e      :param str n
-00019ca0: 616d 653a 2065 2e67 2e20 2243 616d 656c  ame: e.g. "Camel
-00019cb0: 4361 7365 220a 2020 2020 3a72 6574 7572  Case".    :retur
-00019cc0: 6e3a 2065 2e67 2e20 2263 616d 656c 5f63  n: e.g. "camel_c
-00019cd0: 6173 6522 0a20 2020 203a 7274 7970 653a  ase".    :rtype:
-00019ce0: 2073 7472 0a20 2020 2022 2222 0a20 2020   str.    """.   
-00019cf0: 2073 3120 3d20 7265 2e73 7562 2822 282e   s1 = re.sub("(.
-00019d00: 2928 5b41 2d5a 5d5b 612d 7a5d 2b29 222c  )([A-Z][a-z]+)",
-00019d10: 2072 225c 315f 5c32 222c 206e 616d 6529   r"\1_\2", name)
-00019d20: 0a20 2020 2072 6574 7572 6e20 7265 2e73  .    return re.s
-00019d30: 7562 2822 285b 612d 7a30 2d39 5d29 285b  ub("([a-z0-9])([
-00019d40: 412d 5a5d 2922 2c20 7222 5c31 5f5c 3222  A-Z])", r"\1_\2"
-00019d50: 2c20 7331 292e 6c6f 7765 7228 290a 0a0a  , s1).lower()...
-00019d60: 6465 6620 6765 745f 686f 7374 6e61 6d65  def get_hostname
-00019d70: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
-00019d80: 3a72 6574 7572 6e3a 2065 2e67 2e20 2263  :return: e.g. "c
-00019d90: 6c75 7374 6572 2d63 6e2d 3231 3122 0a20  luster-cn-211". 
-00019da0: 2020 203a 7274 7970 653a 2073 7472 0a20     :rtype: str. 
-00019db0: 2020 2022 2222 0a20 2020 2023 2063 6865     """.    # che
-00019dc0: 636b 5f6f 7574 7075 7428 5b22 686f 7374  ck_output(["host
-00019dd0: 6e61 6d65 225d 292e 7374 7269 7028 292e  name"]).strip().
-00019de0: 6465 636f 6465 2822 7574 6638 2229 0a20  decode("utf8"). 
-00019df0: 2020 2069 6d70 6f72 7420 736f 636b 6574     import socket
-00019e00: 0a0a 2020 2020 7265 7475 726e 2073 6f63  ..    return soc
-00019e10: 6b65 742e 6765 7468 6f73 746e 616d 6528  ket.gethostname(
-00019e20: 290a 0a0a 6465 6620 6973 5f72 756e 6e69  )...def is_runni
-00019e30: 6e67 5f6f 6e5f 636c 7573 7465 7228 293a  ng_on_cluster():
-00019e40: 0a20 2020 2022 2222 0a20 2020 203a 7265  .    """.    :re
-00019e50: 7475 726e 3a20 6936 2073 7065 6369 6669  turn: i6 specifi
-00019e60: 632e 2057 6865 7468 6572 2077 6520 7275  c. Whether we ru
-00019e70: 6e20 6f6e 2073 6f6d 6520 6f66 2074 6865  n on some of the
-00019e80: 2063 6c75 7374 6572 206e 6f64 6573 2e0a   cluster nodes..
-00019e90: 2020 2020 3a72 7479 7065 3a20 626f 6f6c      :rtype: bool
-00019ea0: 0a20 2020 2022 2222 0a20 2020 2072 6574  .    """.    ret
-00019eb0: 7572 6e20 6765 745f 686f 7374 6e61 6d65  urn get_hostname
-00019ec0: 2829 2e73 7461 7274 7377 6974 6828 2263  ().startswith("c
-00019ed0: 6c75 7374 6572 2d63 6e2d 2229 206f 7220  luster-cn-") or 
-00019ee0: 6765 745f 686f 7374 6e61 6d65 2829 2e73  get_hostname().s
-00019ef0: 7461 7274 7377 6974 6828 2263 6e2d 2229  tartswith("cn-")
-00019f00: 0a0a 0a73 7461 7274 5f74 696d 6520 3d20  ...start_time = 
-00019f10: 7469 6d65 2e74 696d 6528 290a 0a0a 6465  time.time()...de
-00019f20: 6620 6765 745f 7574 635f 7374 6172 745f  f get_utc_start_
-00019f30: 7469 6d65 5f66 696c 656e 616d 655f 7061  time_filename_pa
-00019f40: 7274 2829 3a0a 2020 2020 2222 220a 2020  rt():.    """.  
-00019f50: 2020 3a72 6574 7572 6e3a 2073 7472 696e    :return: strin
-00019f60: 6720 7768 6963 6820 6361 6e20 6265 2075  g which can be u
-00019f70: 7365 6420 6173 2070 6172 7420 6f66 2061  sed as part of a
-00019f80: 2066 696c 656e 616d 652c 2077 6869 6368   filename, which
-00019f90: 2072 6570 7265 7365 6e74 7320 7468 6520   represents the 
-00019fa0: 7374 6172 7420 7469 6d65 206f 6620 5245  start time of RE
-00019fb0: 5455 524e 4e20 696e 2055 5443 0a20 2020  TURNN in UTC.   
-00019fc0: 203a 7274 7970 653a 2073 7472 0a20 2020   :rtype: str.   
-00019fd0: 2022 2222 0a20 2020 2072 6574 7572 6e20   """.    return 
-00019fe0: 7469 6d65 2e73 7472 6674 696d 6528 2225  time.strftime("%
-00019ff0: 592d 256d 2d25 642d 2548 2d25 4d2d 2553  Y-%m-%d-%H-%M-%S
-0001a000: 222c 2074 696d 652e 676d 7469 6d65 2873  ", time.gmtime(s
-0001a010: 7461 7274 5f74 696d 6529 290a 0a0a 6465  tart_time))...de
-0001a020: 6620 6d61 7962 655f 6d61 6b65 5f64 6972  f maybe_make_dir
-0001a030: 7328 6469 726e 616d 6529 3a0a 2020 2020  s(dirname):.    
-0001a040: 2222 220a 2020 2020 4372 6561 7465 7320  """.    Creates 
-0001a050: 7468 6520 6469 7265 6374 6f72 7920 6966  the directory if
-0001a060: 2069 7420 646f 6573 206e 6f74 2079 6574   it does not yet
-0001a070: 2065 7869 7374 2e0a 0a20 2020 203a 7061   exist...    :pa
-0001a080: 7261 6d20 7374 7220 6469 726e 616d 653a  ram str dirname:
-0001a090: 2054 6865 2070 6174 6820 6f66 2074 6865   The path of the
-0001a0a0: 2064 6972 6563 746f 7279 0a20 2020 2022   directory.    "
-0001a0b0: 2222 0a20 2020 2069 6d70 6f72 7420 6f73  "".    import os
-0001a0c0: 0a0a 2020 2020 6966 206e 6f74 206f 732e  ..    if not os.
-0001a0d0: 7061 7468 2e65 7869 7374 7328 6469 726e  path.exists(dirn
-0001a0e0: 616d 6529 3a0a 2020 2020 2020 2020 7472  ame):.        tr
-0001a0f0: 793a 0a20 2020 2020 2020 2020 2020 206f  y:.            o
-0001a100: 732e 6d61 6b65 6469 7273 2864 6972 6e61  s.makedirs(dirna
-0001a110: 6d65 290a 2020 2020 2020 2020 6578 6365  me).        exce
-0001a120: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-0001a130: 6578 633a 0a20 2020 2020 2020 2020 2020  exc:.           
-0001a140: 2070 7269 6e74 2822 6d61 7962 655f 6372   print("maybe_cr
-0001a150: 6561 7465 5f66 6f6c 6465 723a 2065 7863  eate_folder: exc
-0001a160: 6570 7469 6f6e 2063 7265 6174 696e 6720  eption creating 
-0001a170: 6469 723a 222c 2065 7863 290a 2020 2020  dir:", exc).    
-0001a180: 2020 2020 2020 2020 2320 4d61 7962 6520          # Maybe 
-0001a190: 6120 636f 6e63 7572 7265 6e74 2070 726f  a concurrent pro
-0001a1a0: 6365 7373 2c20 652e 672e 2074 662e 636f  cess, e.g. tf.co
-0001a1b0: 6d70 6174 2e76 312e 7375 6d6d 6172 792e  mpat.v1.summary.
-0001a1c0: 4669 6c65 5772 6974 6572 2063 7265 6174  FileWriter creat
-0001a1d0: 6564 2069 7420 696e 2074 6865 206d 6561  ed it in the mea
-0001a1e0: 6e2d 7768 696c 652c 0a20 2020 2020 2020  n-while,.       
-0001a1f0: 2020 2020 2023 2073 6f20 7468 656e 2069       # so then i
-0001a200: 7420 776f 756c 6420 6265 206f 6b20 6e6f  t would be ok no
-0001a210: 7720 6966 2069 7420 6578 6973 7473 2c20  w if it exists, 
-0001a220: 6275 7420 6661 696c 2069 6620 6974 2064  but fail if it d
-0001a230: 6f65 7320 6e6f 7420 6578 6973 742e 0a20  oes not exist.. 
-0001a240: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-0001a250: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-0001a260: 2864 6972 6e61 6d65 290a 0a0a 6465 6620  (dirname)...def 
-0001a270: 6c6f 675f 7275 6e74 696d 655f 696e 666f  log_runtime_info
-0001a280: 5f74 6f5f 6469 7228 7061 7468 2c20 636f  _to_dir(path, co
-0001a290: 6e66 6967 293a 0a20 2020 2022 2222 0a20  nfig):.    """. 
-0001a2a0: 2020 2054 6869 7320 7769 6c6c 2077 7269     This will wri
-0001a2b0: 7465 206d 756c 7469 706c 6520 6c6f 6767  te multiple logg
-0001a2c0: 696e 6720 696e 666f 726d 6174 696f 6e20  ing information 
-0001a2d0: 696e 746f 2074 6865 2070 6174 682e 0a20  into the path.. 
-0001a2e0: 2020 2049 7420 7769 6c6c 2063 7265 6174     It will creat
-0001a2f0: 6520 7265 7475 726e 6e2e 2a2e 6c6f 6720  e returnn.*.log 
-0001a300: 7769 7468 2073 6f6d 6520 6d65 7461 2069  with some meta i
-0001a310: 6e66 6f72 6d61 7469 6f6e 2c0a 2020 2020  nformation,.    
-0001a320: 6173 2077 656c 6c20 6173 2063 6f70 7920  as well as copy 
-0001a330: 7468 6520 7573 6564 2063 6f6e 6669 6720  the used config 
-0001a340: 6669 6c65 2e0a 0a20 2020 203a 7061 7261  file...    :para
-0001a350: 6d20 7374 7220 7061 7468 3a20 6469 7265  m str path: dire
-0001a360: 6374 6f72 7920 7061 7468 0a20 2020 203a  ctory path.    :
-0001a370: 7061 7261 6d20 7265 7475 726e 6e2e 636f  param returnn.co
-0001a380: 6e66 6967 2e43 6f6e 6669 6720 636f 6e66  nfig.Config conf
-0001a390: 6967 3a0a 2020 2020 2222 220a 2020 2020  ig:.    """.    
-0001a3a0: 696d 706f 7274 206f 730a 2020 2020 696d  import os.    im
-0001a3b0: 706f 7274 2073 7973 0a20 2020 2069 6d70  port sys.    imp
-0001a3c0: 6f72 7420 7368 7574 696c 0a20 2020 2066  ort shutil.    f
-0001a3d0: 726f 6d20 7265 7475 726e 6e2e 636f 6e66  rom returnn.conf
-0001a3e0: 6967 2069 6d70 6f72 7420 436f 6e66 6967  ig import Config
-0001a3f0: 0a0a 2020 2020 7472 793a 0a20 2020 2020  ..    try:.     
-0001a400: 2020 2068 6f73 746e 616d 6520 3d20 6765     hostname = ge
-0001a410: 745f 686f 7374 6e61 6d65 2829 0a20 2020  t_hostname().   
-0001a420: 2020 2020 2063 6f6e 7465 6e74 203d 205b       content = [
-0001a430: 0a20 2020 2020 2020 2020 2020 2022 5469  .            "Ti
-0001a440: 6d65 3a20 2573 2220 2520 7469 6d65 2e73  me: %s" % time.s
-0001a450: 7472 6674 696d 6528 2225 592d 256d 2d25  trftime("%Y-%m-%
-0001a460: 6420 2548 3a25 4d3a 2553 222c 2074 696d  d %H:%M:%S", tim
-0001a470: 652e 676d 7469 6d65 2873 7461 7274 5f74  e.gmtime(start_t
-0001a480: 696d 6529 292c 0a20 2020 2020 2020 2020  ime)),.         
-0001a490: 2020 2022 4361 6c6c 3a20 2573 2220 2520     "Call: %s" % 
-0001a4a0: 2873 7973 2e61 7267 762c 292c 0a20 2020  (sys.argv,),.   
-0001a4b0: 2020 2020 2020 2020 2022 5061 7468 3a20           "Path: 
-0001a4c0: 2573 2220 2520 286f 732e 6765 7463 7764  %s" % (os.getcwd
-0001a4d0: 2829 2c29 2c0a 2020 2020 2020 2020 2020  (),),.          
-0001a4e0: 2020 2248 6f73 746e 616d 653a 2025 7322    "Hostname: %s"
-0001a4f0: 2025 2067 6574 5f68 6f73 746e 616d 6528   % get_hostname(
-0001a500: 292c 0a20 2020 2020 2020 2020 2020 2022  ),.            "
-0001a510: 5049 443a 2025 6922 2025 206f 732e 6765  PID: %i" % os.ge
-0001a520: 7470 6964 2829 2c0a 2020 2020 2020 2020  tpid(),.        
-0001a530: 2020 2020 2252 6574 7572 6e6e 3a20 2573      "Returnn: %s
-0001a540: 2220 2520 2864 6573 6372 6962 655f 7265  " % (describe_re
-0001a550: 7475 726e 6e5f 7665 7273 696f 6e28 292c  turnn_version(),
-0001a560: 292c 0a20 2020 2020 2020 2020 2020 2022  ),.            "
-0001a570: 5465 6e73 6f72 466c 6f77 3a20 2573 2220  TensorFlow: %s" 
-0001a580: 2520 2864 6573 6372 6962 655f 7465 6e73  % (describe_tens
-0001a590: 6f72 666c 6f77 5f76 6572 7369 6f6e 2829  orflow_version()
-0001a5a0: 2c29 2c0a 2020 2020 2020 2020 2020 2020  ,),.            
-0001a5b0: 2243 6f6e 6669 6720 6669 6c65 733a 2025  "Config files: %
-0001a5c0: 7322 2025 2028 636f 6e66 6967 2e66 696c  s" % (config.fil
-0001a5d0: 6573 2c29 2c0a 2020 2020 2020 2020 5d0a  es,),.        ].
-0001a5e0: 2020 2020 2020 2020 6d61 7962 655f 6d61          maybe_ma
-0001a5f0: 6b65 5f64 6972 7328 7061 7468 290a 2020  ke_dirs(path).  
-0001a600: 2020 2020 2020 6c6f 675f 666e 203d 2022        log_fn = "
-0001a610: 2573 2f72 6574 7572 6e6e 2e25 732e 2573  %s/returnn.%s.%s
-0001a620: 2e25 692e 6c6f 6722 2025 2028 7061 7468  .%i.log" % (path
-0001a630: 2c20 6765 745f 7574 635f 7374 6172 745f  , get_utc_start_
-0001a640: 7469 6d65 5f66 696c 656e 616d 655f 7061  time_filename_pa
-0001a650: 7274 2829 2c20 686f 7374 6e61 6d65 2c20  rt(), hostname, 
-0001a660: 6f73 2e67 6574 7069 6428 2929 0a20 2020  os.getpid()).   
-0001a670: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
-0001a680: 6174 682e 6578 6973 7473 286c 6f67 5f66  ath.exists(log_f
-0001a690: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
-0001a6a0: 7769 7468 206f 7065 6e28 6c6f 675f 666e  with open(log_fn
-0001a6b0: 2c20 2277 2229 2061 7320 663a 0a20 2020  , "w") as f:.   
-0001a6c0: 2020 2020 2020 2020 2020 2020 2066 2e77               f.w
-0001a6d0: 7269 7465 2822 5265 7475 726e 6e20 6c6f  rite("Returnn lo
-0001a6e0: 6720 6669 6c65 3a5c 6e22 202b 2022 222e  g file:\n" + "".
-0001a6f0: 6a6f 696e 285b 2225 735c 6e22 2025 2073  join(["%s\n" % s
-0001a700: 2066 6f72 2073 2069 6e20 636f 6e74 656e   for s in conten
-0001a710: 745d 2920 2b20 225c 6e22 290a 2020 2020  t]) + "\n").    
-0001a720: 2020 2020 666f 7220 666e 2069 6e20 636f      for fn in co
-0001a730: 6e66 6967 2e66 696c 6573 3a0a 2020 2020  nfig.files:.    
-0001a740: 2020 2020 2020 2020 6261 7365 5f66 6e20          base_fn 
-0001a750: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-0001a760: 6d65 2866 6e29 0a20 2020 2020 2020 2020  me(fn).         
-0001a770: 2020 2074 6172 6765 745f 666e 203d 2022     target_fn = "
-0001a780: 2573 2f25 7322 2025 2028 7061 7468 2c20  %s/%s" % (path, 
-0001a790: 6261 7365 5f66 6e29 0a20 2020 2020 2020  base_fn).       
-0001a7a0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-0001a7b0: 6578 6973 7473 2874 6172 6765 745f 666e  exists(target_fn
-0001a7c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001a7d0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0001a7e0: 2020 2020 2020 2020 7368 7574 696c 2e63          shutil.c
-0001a7f0: 6f70 7928 666e 2c20 7461 7267 6574 5f66  opy(fn, target_f
-0001a800: 6e29 0a20 2020 2020 2020 2020 2020 2063  n).            c
-0001a810: 6f6e 6669 675f 7479 7065 203d 2043 6f6e  onfig_type = Con
-0001a820: 6669 672e 6765 745f 636f 6e66 6967 5f66  fig.get_config_f
-0001a830: 696c 655f 7479 7065 2866 6e29 0a20 2020  ile_type(fn).   
-0001a840: 2020 2020 2020 2020 2063 6f6d 6d65 6e74           comment
-0001a850: 5f70 7265 6669 7820 3d20 2223 220a 2020  _prefix = "#".  
-0001a860: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
-0001a870: 6669 675f 7479 7065 203d 3d20 226a 7322  fig_type == "js"
-0001a880: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a890: 2020 636f 6d6d 656e 745f 7072 6566 6978    comment_prefix
-0001a8a0: 203d 2022 2f2f 220a 2020 2020 2020 2020   = "//".        
-0001a8b0: 2020 2020 7769 7468 206f 7065 6e28 7461      with open(ta
-0001a8c0: 7267 6574 5f66 6e2c 2022 6122 2920 6173  rget_fn, "a") as
-0001a8d0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-0001a8e0: 2020 2020 662e 7772 6974 6528 0a20 2020      f.write(.   
-0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a900: 2022 5c6e 5c6e 5c6e 220a 2020 2020 2020   "\n\n\n".      
-0001a910: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001a920: 2222 2e6a 6f69 6e28 0a20 2020 2020 2020  "".join(.       
-0001a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a940: 205b 2225 7320 436f 6e66 6967 2d66 696c   ["%s Config-fil
-0001a950: 6520 636f 7069 6564 2066 6f72 206c 6f67  e copied for log
-0001a960: 6769 6e67 2070 7572 706f 7365 2062 7920  ging purpose by 
-0001a970: 5265 7475 726e 6e2e 5c6e 2220 2520 636f  Returnn.\n" % co
-0001a980: 6d6d 656e 745f 7072 6566 6978 5d0a 2020  mment_prefix].  
-0001a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9a0: 2020 2020 2020 2b20 5b22 2573 2025 735c        + ["%s %s\
-0001a9b0: 6e22 2025 2028 636f 6d6d 656e 745f 7072  n" % (comment_pr
-0001a9c0: 6566 6978 2c20 7329 2066 6f72 2073 2069  efix, s) for s i
-0001a9d0: 6e20 636f 6e74 656e 745d 0a20 2020 2020  n content].     
-0001a9e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001a9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aa00: 2020 2020 202b 2022 5c6e 220a 2020 2020       + "\n".    
-0001aa10: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001aa20: 2020 6578 6365 7074 204f 5345 7272 6f72    except OSError
-0001aa30: 2061 7320 6578 633a 0a20 2020 2020 2020   as exc:.       
-0001aa40: 2069 6620 2244 6973 6b20 7175 6f74 6122   if "Disk quota"
-0001aa50: 2069 6e20 7374 7228 6578 6329 3a0a 2020   in str(exc):.  
-0001aa60: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001aa70: 226c 6f67 5f72 756e 7469 6d65 5f69 6e66  "log_runtime_inf
-0001aa80: 6f5f 746f 5f64 6972 3a20 4572 726f 722c  o_to_dir: Error,
-0001aa90: 2063 616e 6e6f 7420 7772 6974 653a 2025   cannot write: %
-0001aaa0: 7322 2025 2065 7863 290a 2020 2020 2020  s" % exc).      
-0001aab0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001aac0: 2020 2020 7261 6973 650a 0a0a 6465 6620      raise...def 
-0001aad0: 7368 6f75 6c64 5f77 7269 7465 5f74 6f5f  should_write_to_
-0001aae0: 6469 736b 2863 6f6e 6669 6729 3a0a 2020  disk(config):.  
-0001aaf0: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
-0001ab00: 2072 6574 7572 6e6e 2e63 6f6e 6669 672e   returnn.config.
-0001ab10: 436f 6e66 6967 2063 6f6e 6669 673a 0a20  Config config:. 
-0001ab20: 2020 203a 7274 7970 653a 2062 6f6f 6c0a     :rtype: bool.
-0001ab30: 2020 2020 2222 220a 2020 2020 6966 2063      """.    if c
-0001ab40: 6f6e 6669 672e 6973 5f74 7275 6528 2275  onfig.is_true("u
-0001ab50: 7365 5f68 6f72 6f76 6f64 2229 3a0a 2020  se_horovod"):.  
-0001ab60: 2020 2020 2020 2320 6e6f 696e 7370 6563        # noinspec
-0001ab70: 7469 6f6e 2050 7950 6163 6b61 6765 5265  tion PyPackageRe
-0001ab80: 7175 6972 656d 656e 7473 2c50 7955 6e72  quirements,PyUnr
-0001ab90: 6573 6f6c 7665 6452 6566 6572 656e 6365  esolvedReference
-0001aba0: 730a 2020 2020 2020 2020 696d 706f 7274  s.        import
-0001abb0: 2068 6f72 6f76 6f64 2e74 656e 736f 7266   horovod.tensorf
-0001abc0: 6c6f 7720 6173 2068 7664 0a0a 2020 2020  low as hvd..    
-0001abd0: 2020 2020 6966 2068 7664 2e72 616e 6b28      if hvd.rank(
-0001abe0: 2920 213d 2030 3a0a 2020 2020 2020 2020  ) != 0:.        
-0001abf0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001ac00: 0a20 2020 2069 6620 636f 6e66 6967 2e69  .    if config.i
-0001ac10: 735f 7472 7565 2822 6472 795f 7275 6e22  s_true("dry_run"
-0001ac20: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0001ac30: 6e20 4661 6c73 650a 2020 2020 7265 7475  n False.    retu
-0001ac40: 726e 2054 7275 650a 0a0a 636c 6173 7320  rn True...class 
-0001ac50: 4e61 7469 7665 436f 6465 436f 6d70 696c  NativeCodeCompil
-0001ac60: 6572 286f 626a 6563 7429 3a0a 2020 2020  er(object):.    
-0001ac70: 2222 220a 2020 2020 4865 6c70 6572 2063  """.    Helper c
-0001ac80: 6c61 7373 2074 6f20 636f 6d70 696c 6520  lass to compile 
-0001ac90: 6e61 7469 7665 2043 2f43 2b2b 2063 6f64  native C/C++ cod
-0001aca0: 6520 6f6e 2d74 6865 2d66 6c79 2e0a 2020  e on-the-fly..  
-0001acb0: 2020 2222 220a 0a20 2020 2043 6163 6865    """..    Cache
-0001acc0: 4469 724e 616d 6520 3d20 2272 6574 7572  DirName = "retur
-0001acd0: 6e6e 5f6e 6174 6976 6522 0a20 2020 2043  nn_native".    C
-0001ace0: 6f6c 6c65 6374 6564 436f 6d70 696c 6572  ollectedCompiler
-0001acf0: 7320 3d20 4e6f 6e65 2020 2320 7479 7065  s = None  # type
-0001ad00: 3a20 7479 7069 6e67 2e4f 7074 696f 6e61  : typing.Optiona
-0001ad10: 6c5b 7479 7069 6e67 2e4c 6973 745b 4e61  l[typing.List[Na
-0001ad20: 7469 7665 436f 6465 436f 6d70 696c 6572  tiveCodeCompiler
-0001ad30: 5d5d 0a0a 2020 2020 6465 6620 5f5f 696e  ]]..    def __in
-0001ad40: 6974 5f5f 280a 2020 2020 2020 2020 7365  it__(.        se
-0001ad50: 6c66 2c0a 2020 2020 2020 2020 6261 7365  lf,.        base
-0001ad60: 5f6e 616d 652c 0a20 2020 2020 2020 2063  _name,.        c
-0001ad70: 6f64 655f 7665 7273 696f 6e2c 0a20 2020  ode_version,.   
-0001ad80: 2020 2020 2063 6f64 652c 0a20 2020 2020       code,.     
-0001ad90: 2020 2069 735f 6370 703d 5472 7565 2c0a     is_cpp=True,.
-0001ada0: 2020 2020 2020 2020 635f 6d61 6372 6f5f          c_macro_
-0001adb0: 6465 6669 6e65 733d 4e6f 6e65 2c0a 2020  defines=None,.  
-0001adc0: 2020 2020 2020 6c64 5f66 6c61 6773 3d4e        ld_flags=N
-0001add0: 6f6e 652c 0a20 2020 2020 2020 2069 6e63  one,.        inc
-0001ade0: 6c75 6465 5f70 6174 6873 3d28 292c 0a20  lude_paths=(),. 
-0001adf0: 2020 2020 2020 2069 6e63 6c75 6465 5f64         include_d
-0001ae00: 6570 733d 4e6f 6e65 2c0a 2020 2020 2020  eps=None,.      
-0001ae10: 2020 7374 6174 6963 5f76 6572 7369 6f6e    static_version
-0001ae20: 5f6e 616d 653d 4e6f 6e65 2c0a 2020 2020  _name=None,.    
-0001ae30: 2020 2020 7368 6f75 6c64 5f63 6c65 616e      should_clean
-0001ae40: 7570 5f6f 6c64 5f61 6c6c 3d54 7275 652c  up_old_all=True,
-0001ae50: 0a20 2020 2020 2020 2073 686f 756c 645f  .        should_
-0001ae60: 636c 6561 6e75 705f 6f6c 645f 6d79 6469  cleanup_old_mydi
-0001ae70: 723d 4661 6c73 652c 0a20 2020 2020 2020  r=False,.       
-0001ae80: 2075 7365 5f63 7878 3131 5f61 6269 3d46   use_cxx11_abi=F
-0001ae90: 616c 7365 2c0a 2020 2020 2020 2020 6c6f  alse,.        lo
-0001aea0: 675f 7374 7265 616d 3d4e 6f6e 652c 0a20  g_stream=None,. 
-0001aeb0: 2020 2020 2020 2076 6572 626f 7365 3d46         verbose=F
-0001aec0: 616c 7365 2c0a 2020 2020 293a 0a20 2020  alse,.    ):.   
-0001aed0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001aee0: 203a 7061 7261 6d20 7374 7220 6261 7365   :param str base
-0001aef0: 5f6e 616d 653a 2062 6173 6520 6e61 6d65  _name: base name
-0001af00: 2066 6f72 2074 6865 206d 6f64 756c 652c   for the module,
-0001af10: 2065 2e67 2e20 227a 6572 6f5f 6f75 7422   e.g. "zero_out"
-0001af20: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001af30: 696e 747c 7475 706c 655b 696e 745d 2063  int|tuple[int] c
-0001af40: 6f64 655f 7665 7273 696f 6e3a 2063 6865  ode_version: che
-0001af50: 636b 2066 6f72 2074 6865 2063 6163 6865  ck for the cache
-0001af60: 2077 6865 7468 6572 2074 6f20 7265 7573   whether to reus
-0001af70: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
-0001af80: 2073 7472 2063 6f64 653a 2074 6865 2073   str code: the s
-0001af90: 6f75 7263 6520 636f 6465 2069 7473 656c  ource code itsel
-0001afa0: 660a 2020 2020 2020 2020 3a70 6172 616d  f.        :param
-0001afb0: 2062 6f6f 6c20 6973 5f63 7070 3a20 6966   bool is_cpp: if
-0001afc0: 2046 616c 7365 2c20 4320 6973 2061 7373   False, C is ass
-0001afd0: 756d 6564 0a20 2020 2020 2020 203a 7061  umed.        :pa
-0001afe0: 7261 6d20 6469 6374 5b73 7472 2c73 7472  ram dict[str,str
-0001aff0: 7c69 6e74 7c4e 6f6e 655d 7c4e 6f6e 6520  |int|None]|None 
-0001b000: 635f 6d61 6372 6f5f 6465 6669 6e65 733a  c_macro_defines:
-0001b010: 2065 2e67 2e20 7b22 5445 4e53 4f52 464c   e.g. {"TENSORFL
-0001b020: 4f57 223a 2031 7d0a 2020 2020 2020 2020  OW": 1}.        
-0001b030: 3a70 6172 616d 206c 6973 745b 7374 725d  :param list[str]
-0001b040: 7c4e 6f6e 6520 6c64 5f66 6c61 6773 3a20  |None ld_flags: 
-0001b050: 652e 672e 205b 222d 6c62 6c61 7322 5d0a  e.g. ["-lblas"].
-0001b060: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
-0001b070: 6973 745b 7374 725d 7c74 7570 6c65 5b73  ist[str]|tuple[s
-0001b080: 7472 5d20 696e 636c 7564 655f 7061 7468  tr] include_path
-0001b090: 733a 0a20 2020 2020 2020 203a 7061 7261  s:.        :para
-0001b0a0: 6d20 6c69 7374 5b73 7472 5d7c 4e6f 6e65  m list[str]|None
-0001b0b0: 2069 6e63 6c75 6465 5f64 6570 733a 2069   include_deps: i
-0001b0c0: 6620 7072 6f76 6964 6564 2061 6e64 2061  f provided and a
-0001b0d0: 6e20 6578 6973 7469 6e67 206c 6962 2066  n existing lib f
-0001b0e0: 696c 652c 0a20 2020 2020 2020 2020 2020  ile,.           
-0001b0f0: 2077 6520 7769 6c6c 2063 6865 636b 2069   we will check i
-0001b100: 6620 616e 7920 6465 7065 6e64 656e 6379  f any dependency
-0001b110: 2069 7320 6e65 7765 720a 2020 2020 2020   is newer.      
-0001b120: 2020 2020 2020 616e 6420 7765 206e 6565        and we nee
-0001b130: 6420 746f 2072 6563 6f6d 7069 6c65 2e20  d to recompile. 
-0001b140: 7765 2063 6f75 6c64 2061 6c73 6f20 646f  we could also do
-0001b150: 2069 7420 6175 746f 6d61 7469 6361 6c6c   it automaticall
-0001b160: 7920 7669 6120 2d4d 4420 6275 7420 7468  y via -MD but th
-0001b170: 6174 2073 6565 6d73 206f 7665 726b 696c  at seems overkil
-0001b180: 6c20 616e 6420 746f 6f20 736c 6f77 2e0a  l and too slow..
-0001b190: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0001b1a0: 7472 7c4e 6f6e 6520 7374 6174 6963 5f76  tr|None static_v
-0001b1b0: 6572 7369 6f6e 5f6e 616d 653a 206e 6f72  ersion_name: nor
-0001b1c0: 6d61 6c6c 792c 2077 6520 7573 6520 2e2e  mally, we use ..
-0001b1d0: 2e2f 6261 7365 5f6e 616d 652f 6861 7368  ./base_name/hash
-0001b1e0: 2061 7320 7468 6520 6469 720a 2020 2020   as the dir.    
-0001b1f0: 2020 2020 2020 2020 6275 7420 7468 6973          but this
-0001b200: 2077 6f75 6c64 2075 7365 202e 2e2e 2f62   would use .../b
-0001b210: 6173 655f 6e61 6d65 2f73 7461 7469 635f  ase_name/static_
-0001b220: 7665 7273 696f 6e5f 6e61 6d65 2e0a 2020  version_name..  
-0001b230: 2020 2020 2020 3a70 6172 616d 2062 6f6f        :param boo
-0001b240: 6c20 7368 6f75 6c64 5f63 6c65 616e 7570  l should_cleanup
-0001b250: 5f6f 6c64 5f61 6c6c 3a20 7768 6574 6865  _old_all: whethe
-0001b260: 7220 7765 2073 686f 756c 6420 6c6f 6f6b  r we should look
-0001b270: 2069 6e20 7468 6520 6361 6368 6520 6469   in the cache di
-0001b280: 720a 2020 2020 2020 2020 2020 2020 616e  r.            an
-0001b290: 6420 6368 6563 6b20 616c 6c20 6f70 7320  d check all ops 
-0001b2a0: 6966 2077 6520 6361 6e20 6465 6c65 7465  if we can delete
-0001b2b0: 2073 6f6d 6520 6f6c 6420 6f6e 6573 2077   some old ones w
-0001b2c0: 6869 6368 2061 7265 206f 6c64 6572 2074  hich are older t
-0001b2d0: 6861 6e20 736f 6d65 206c 696d 6974 0a20  han some limit. 
-0001b2e0: 2020 2020 2020 2020 2020 2028 7365 6c66             (self
-0001b2f0: 2e5f 636c 6561 6e75 705f 7469 6d65 5f6c  ._cleanup_time_l
-0001b300: 696d 6974 5f64 6179 7329 0a20 2020 2020  imit_days).     
-0001b310: 2020 203a 7061 7261 6d20 626f 6f6c 2073     :param bool s
-0001b320: 686f 756c 645f 636c 6561 6e75 705f 6f6c  hould_cleanup_ol
-0001b330: 645f 6d79 6469 723a 2077 6865 7468 6572  d_mydir: whether
-0001b340: 2077 6520 7368 6f75 6c64 2064 656c 6574   we should delet
-0001b350: 6520 6f75 7220 6f70 2064 6972 2062 6566  e our op dir bef
-0001b360: 6f72 6520 7765 2063 6f6d 7069 6c65 2074  ore we compile t
-0001b370: 6865 7265 2e0a 2020 2020 2020 2020 3a70  here..        :p
-0001b380: 6172 616d 2074 7970 696e 672e 5465 7874  aram typing.Text
-0001b390: 494f 7c4e 6f6e 6520 6c6f 675f 7374 7265  IO|None log_stre
-0001b3a0: 616d 3a20 6669 6c65 2073 7472 6561 6d20  am: file stream 
-0001b3b0: 666f 7220 7072 696e 7420 7374 6174 656d  for print statem
-0001b3c0: 656e 7473 0a20 2020 2020 2020 203a 7061  ents.        :pa
-0001b3d0: 7261 6d20 626f 6f6c 2076 6572 626f 7365  ram bool verbose
-0001b3e0: 3a20 6265 2073 6c69 6768 746c 7920 6d6f  : be slightly mo
-0001b3f0: 7265 2076 6572 626f 7365 0a20 2020 2020  re verbose.     
-0001b400: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0001b410: 6620 7365 6c66 2e43 6f6c 6c65 6374 6564  f self.Collected
-0001b420: 436f 6d70 696c 6572 7320 6973 206e 6f74  Compilers is not
-0001b430: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001b440: 2020 2073 656c 662e 436f 6c6c 6563 7465     self.Collecte
-0001b450: 6443 6f6d 7069 6c65 7273 2e61 7070 656e  dCompilers.appen
-0001b460: 6428 7365 6c66 290a 2020 2020 2020 2020  d(self).        
-0001b470: 7365 6c66 2e76 6572 626f 7365 203d 2076  self.verbose = v
-0001b480: 6572 626f 7365 0a20 2020 2020 2020 2073  erbose.        s
-0001b490: 656c 662e 6361 6368 655f 6469 7220 3d20  elf.cache_dir = 
-0001b4a0: 2225 732f 2573 2220 2520 2867 6574 5f63  "%s/%s" % (get_c
-0001b4b0: 6163 6865 5f64 6972 2829 2c20 7365 6c66  ache_dir(), self
-0001b4c0: 2e43 6163 6865 4469 724e 616d 6529 0a20  .CacheDirName). 
-0001b4d0: 2020 2020 2020 2073 656c 662e 5f69 6e63         self._inc
-0001b4e0: 6c75 6465 5f70 6174 6873 203d 206c 6973  lude_paths = lis
-0001b4f0: 7428 696e 636c 7564 655f 7061 7468 7329  t(include_paths)
-0001b500: 0a20 2020 2020 2020 2073 656c 662e 6261  .        self.ba
-0001b510: 7365 5f6e 616d 6520 3d20 6261 7365 5f6e  se_name = base_n
-0001b520: 616d 650a 2020 2020 2020 2020 7365 6c66  ame.        self
-0001b530: 2e63 6f64 655f 7665 7273 696f 6e20 3d20  .code_version = 
-0001b540: 636f 6465 5f76 6572 7369 6f6e 0a20 2020  code_version.   
-0001b550: 2020 2020 2073 656c 662e 636f 6465 203d       self.code =
-0001b560: 2063 6f64 650a 2020 2020 2020 2020 7365   code.        se
-0001b570: 6c66 2e69 735f 6370 7020 3d20 6973 5f63  lf.is_cpp = is_c
-0001b580: 7070 0a20 2020 2020 2020 2073 656c 662e  pp.        self.
-0001b590: 635f 6d61 6372 6f5f 6465 6669 6e65 7320  c_macro_defines 
-0001b5a0: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
-0001b5b0: 2069 6e20 2863 5f6d 6163 726f 5f64 6566   in (c_macro_def
-0001b5c0: 696e 6573 206f 7220 7b7d 292e 6974 656d  ines or {}).item
-0001b5d0: 7328 2920 6966 2076 2069 7320 6e6f 7420  s() if v is not 
-0001b5e0: 4e6f 6e65 7d0a 2020 2020 2020 2020 7365  None}.        se
-0001b5f0: 6c66 2e6c 645f 666c 6167 7320 3d20 6c64  lf.ld_flags = ld
-0001b600: 5f66 6c61 6773 206f 7220 5b5d 0a20 2020  _flags or [].   
-0001b610: 2020 2020 2073 656c 662e 696e 636c 7564       self.includ
-0001b620: 655f 6465 7073 203d 2069 6e63 6c75 6465  e_deps = include
-0001b630: 5f64 6570 730a 2020 2020 2020 2020 7365  _deps.        se
-0001b640: 6c66 2e73 7461 7469 635f 7665 7273 696f  lf.static_versio
-0001b650: 6e5f 6e61 6d65 203d 2073 7461 7469 635f  n_name = static_
-0001b660: 7665 7273 696f 6e5f 6e61 6d65 0a20 2020  version_name.   
-0001b670: 2020 2020 2073 656c 662e 5f63 6f64 655f       self._code_
-0001b680: 6861 7368 203d 2073 656c 662e 5f6d 616b  hash = self._mak
-0001b690: 655f 636f 6465 5f68 6173 6828 290a 2020  e_code_hash().  
-0001b6a0: 2020 2020 2020 7365 6c66 2e5f 696e 666f        self._info
-0001b6b0: 5f64 6963 7420 3d20 7365 6c66 2e5f 6d61  _dict = self._ma
-0001b6c0: 6b65 5f69 6e66 6f5f 6469 6374 2829 0a20  ke_info_dict(). 
-0001b6d0: 2020 2020 2020 2073 656c 662e 5f68 6173         self._has
-0001b6e0: 6820 3d20 7365 6c66 2e5f 6d61 6b65 5f68  h = self._make_h
-0001b6f0: 6173 6828 290a 2020 2020 2020 2020 7365  ash().        se
-0001b700: 6c66 2e5f 6374 7970 6573 5f6c 6962 203d  lf._ctypes_lib =
-0001b710: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
-0001b720: 2073 686f 756c 645f 636c 6561 6e75 705f   should_cleanup_
-0001b730: 6f6c 645f 616c 6c3a 0a20 2020 2020 2020  old_all:.       
-0001b740: 2020 2020 2073 656c 662e 5f63 6c65 616e       self._clean
-0001b750: 7570 5f6f 6c64 2829 0a20 2020 2020 2020  up_old().       
-0001b760: 2073 656c 662e 5f73 686f 756c 645f 636c   self._should_cl
-0001b770: 6561 6e75 705f 6f6c 645f 6d79 6469 7220  eanup_old_mydir 
-0001b780: 3d20 7368 6f75 6c64 5f63 6c65 616e 7570  = should_cleanup
-0001b790: 5f6f 6c64 5f6d 7964 6972 0a20 2020 2020  _old_mydir.     
-0001b7a0: 2020 2073 656c 662e 7573 655f 6378 7831     self.use_cxx1
-0001b7b0: 315f 6162 6920 3d20 7573 655f 6378 7831  1_abi = use_cxx1
-0001b7c0: 315f 6162 690a 2020 2020 2020 2020 7365  1_abi.        se
-0001b7d0: 6c66 2e5f 6c6f 675f 7374 7265 616d 203d  lf._log_stream =
-0001b7e0: 206c 6f67 5f73 7472 6561 6d0a 2020 2020   log_stream.    
-0001b7f0: 2020 2020 6966 2073 656c 662e 7665 7262      if self.verb
-0001b800: 6f73 653a 0a20 2020 2020 2020 2020 2020  ose:.           
-0001b810: 2070 7269 6e74 2822 2573 3a20 2572 2220   print("%s: %r" 
-0001b820: 2520 2873 656c 662e 5f5f 636c 6173 735f  % (self.__class_
-0001b830: 5f2e 5f5f 6e61 6d65 5f5f 2c20 7365 6c66  _.__name__, self
-0001b840: 292c 2066 696c 653d 6c6f 675f 7374 7265  ), file=log_stre
-0001b850: 616d 290a 0a20 2020 2064 6566 205f 5f72  am)..    def __r
-0001b860: 6570 725f 5f28 7365 6c66 293a 0a20 2020  epr__(self):.   
-0001b870: 2020 2020 2072 6574 7572 6e20 223c 2573       return "<%s
-0001b880: 2025 7220 696e 2025 723e 2220 2520 2873   %r in %r>" % (s
-0001b890: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
-0001b8a0: 6e61 6d65 5f5f 2c20 7365 6c66 2e62 6173  name__, self.bas
-0001b8b0: 655f 6e61 6d65 2c20 7365 6c66 2e5f 6d6f  e_name, self._mo
-0001b8c0: 645f 7061 7468 290a 0a20 2020 2040 7072  d_path)..    @pr
-0001b8d0: 6f70 6572 7479 0a20 2020 2064 6566 205f  operty.    def _
-0001b8e0: 6d6f 645f 7061 7468 2873 656c 6629 3a0a  mod_path(self):.
-0001b8f0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-0001b900: 2573 2f25 732f 2573 2220 2520 2873 656c  %s/%s/%s" % (sel
-0001b910: 662e 6361 6368 655f 6469 722c 2073 656c  f.cache_dir, sel
-0001b920: 662e 6261 7365 5f6e 616d 652c 2073 656c  f.base_name, sel
-0001b930: 662e 7374 6174 6963 5f76 6572 7369 6f6e  f.static_version
-0001b940: 5f6e 616d 6520 6f72 2073 656c 662e 5f68  _name or self._h
-0001b950: 6173 685b 3a31 305d 290a 0a20 2020 2040  ash[:10])..    @
-0001b960: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0001b970: 205f 696e 666f 5f66 696c 656e 616d 6528   _info_filename(
-0001b980: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-0001b990: 6574 7572 6e20 2225 732f 696e 666f 2e70  eturn "%s/info.p
-0001b9a0: 7922 2025 2028 7365 6c66 2e5f 6d6f 645f  y" % (self._mod_
-0001b9b0: 7061 7468 2c29 0a0a 2020 2020 4070 726f  path,)..    @pro
-0001b9c0: 7065 7274 790a 2020 2020 6465 6620 5f73  perty.    def _s
-0001b9d0: 6f5f 6669 6c65 6e61 6d65 2873 656c 6629  o_filename(self)
-0001b9e0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0001b9f0: 2022 2573 2f25 732e 736f 2220 2520 2873   "%s/%s.so" % (s
-0001ba00: 656c 662e 5f6d 6f64 5f70 6174 682c 2073  elf._mod_path, s
-0001ba10: 656c 662e 6261 7365 5f6e 616d 6529 0a0a  elf.base_name)..
-0001ba20: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-0001ba30: 2020 6465 6620 5f63 5f66 696c 656e 616d    def _c_filenam
-0001ba40: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0001ba50: 2069 6620 7365 6c66 2e69 735f 6370 703a   if self.is_cpp:
-0001ba60: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001ba70: 7572 6e20 2225 732f 2573 2e63 6322 2025  urn "%s/%s.cc" %
-0001ba80: 2028 7365 6c66 2e5f 6d6f 645f 7061 7468   (self._mod_path
-0001ba90: 2c20 7365 6c66 2e62 6173 655f 6e61 6d65  , self.base_name
-0001baa0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001bab0: 2022 2573 2f25 732e 6322 2025 2028 7365   "%s/%s.c" % (se
-0001bac0: 6c66 2e5f 6d6f 645f 7061 7468 2c20 7365  lf._mod_path, se
-0001bad0: 6c66 2e62 6173 655f 6e61 6d65 290a 0a20  lf.base_name).. 
-0001bae0: 2020 205f 636c 6561 6e75 705f 7469 6d65     _cleanup_time
-0001baf0: 5f6c 696d 6974 5f64 6179 7320 3d20 3630  _limit_days = 60
-0001bb00: 0a0a 2020 2020 6465 6620 5f63 6c65 616e  ..    def _clean
-0001bb10: 7570 5f6f 6c64 2873 656c 6629 3a0a 2020  up_old(self):.  
-0001bb20: 2020 2020 2020 6d6f 645f 7061 7468 203d        mod_path =
-0001bb30: 2073 656c 662e 5f6d 6f64 5f70 6174 6820   self._mod_path 
-0001bb40: 2023 202e 2e2e 2f62 6173 655f 6e61 6d65   # .../base_name
-0001bb50: 2f68 6173 680a 2020 2020 2020 2020 6261  /hash.        ba
-0001bb60: 7365 5f6d 6f64 5f70 6174 6820 3d20 6f73  se_mod_path = os
-0001bb70: 2e70 6174 682e 6469 726e 616d 6528 6d6f  .path.dirname(mo
-0001bb80: 645f 7061 7468 2920 2023 202e 2e2e 2f62  d_path)  # .../b
-0001bb90: 6173 655f 6e61 6d65 0a20 2020 2020 2020  ase_name.       
-0001bba0: 206d 795f 6d6f 645f 7061 7468 5f6e 616d   my_mod_path_nam
-0001bbb0: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-0001bbc0: 6e61 6d65 286d 6f64 5f70 6174 6829 0a20  name(mod_path). 
-0001bbd0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-0001bbe0: 2e70 6174 682e 6578 6973 7473 2862 6173  .path.exists(bas
-0001bbf0: 655f 6d6f 645f 7061 7468 293a 0a20 2020  e_mod_path):.   
-0001bc00: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-0001bc10: 2020 2020 2020 2020 696d 706f 7274 2074          import t
-0001bc20: 696d 650a 0a20 2020 2020 2020 2063 6c65  ime..        cle
-0001bc30: 616e 7570 5f74 696d 655f 6c69 6d69 745f  anup_time_limit_
-0001bc40: 7365 6373 203d 2073 656c 662e 5f63 6c65  secs = self._cle
-0001bc50: 616e 7570 5f74 696d 655f 6c69 6d69 745f  anup_time_limit_
-0001bc60: 6461 7973 202a 2032 3420 2a20 3630 202a  days * 24 * 60 *
-0001bc70: 2036 300a 2020 2020 2020 2020 666f 7220   60.        for 
-0001bc80: 7020 696e 206f 732e 6c69 7374 6469 7228  p in os.listdir(
-0001bc90: 6261 7365 5f6d 6f64 5f70 6174 6829 3a0a  base_mod_path):.
-0001bca0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-0001bcb0: 203d 3d20 6d79 5f6d 6f64 5f70 6174 685f   == my_mod_path_
-0001bcc0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-0001bcd0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0001bce0: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
-0001bcf0: 6469 725f 7061 7468 203d 2022 2573 2f25  dir_path = "%s/%
-0001bd00: 7322 2025 2028 6261 7365 5f6d 6f64 5f70  s" % (base_mod_p
-0001bd10: 6174 682c 2070 290a 2020 2020 2020 2020  ath, p).        
-0001bd20: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-0001bd30: 7468 2e69 7364 6972 2866 756c 6c5f 6469  th.isdir(full_di
-0001bd40: 725f 7061 7468 293a 0a20 2020 2020 2020  r_path):.       
-0001bd50: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0001bd60: 6520 2023 2069 676e 6f72 6520 666f 7220  e  # ignore for 
-0001bd70: 6e6f 770a 2020 2020 2020 2020 2020 2020  now.            
-0001bd80: 6c6f 636b 203d 204c 6f63 6b46 696c 6528  lock = LockFile(
-0001bd90: 6675 6c6c 5f64 6972 5f70 6174 6829 0a20  full_dir_path). 
-0001bda0: 2020 2020 2020 2020 2020 2069 6620 6c6f             if lo
-0001bdb0: 636b 2e69 735f 6c6f 636b 6564 2829 3a0a  ck.is_locked():.
-0001bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bdd0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0001bde0: 2020 2020 206c 6f63 6b2e 6d61 7962 655f       lock.maybe_
-0001bdf0: 7265 6d6f 7665 5f6f 6c64 5f6c 6f63 6b66  remove_old_lockf
-0001be00: 696c 6528 290a 2020 2020 2020 2020 2020  ile().          
-0001be10: 2020 696e 666f 5f70 6174 6820 3d20 2225    info_path = "%
-0001be20: 732f 696e 666f 2e70 7922 2025 2066 756c  s/info.py" % ful
-0001be30: 6c5f 6469 725f 7061 7468 0a20 2020 2020  l_dir_path.     
-0001be40: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-0001be50: 2e70 6174 682e 6578 6973 7473 2869 6e66  .path.exists(inf
-0001be60: 6f5f 7061 7468 293a 0a20 2020 2020 2020  o_path):.       
-0001be70: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-0001be80: 6c65 616e 7570 5f6f 6c64 5f70 6174 6828  leanup_old_path(
-0001be90: 6675 6c6c 5f64 6972 5f70 6174 682c 2072  full_dir_path, r
-0001bea0: 6561 736f 6e3d 2263 6f72 7275 7074 2064  eason="corrupt d
-0001beb0: 6972 2c20 6d69 7373 696e 6720 696e 666f  ir, missing info
-0001bec0: 2e70 7922 290a 2020 2020 2020 2020 2020  .py").          
-0001bed0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0001bee0: 2020 2020 2020 2020 2020 2073 6f5f 7061             so_pa
-0001bef0: 7468 203d 2022 2573 2f25 732e 736f 2220  th = "%s/%s.so" 
-0001bf00: 2520 2866 756c 6c5f 6469 725f 7061 7468  % (full_dir_path
-0001bf10: 2c20 7365 6c66 2e62 6173 655f 6e61 6d65  , self.base_name
-0001bf20: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0001bf30: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-0001bf40: 7374 7328 736f 5f70 6174 6829 3a0a 2020  sts(so_path):.  
-0001bf50: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001bf60: 6c66 2e5f 636c 6561 6e75 705f 6f6c 645f  lf._cleanup_old_
-0001bf70: 7061 7468 2866 756c 6c5f 6469 725f 7061  path(full_dir_pa
-0001bf80: 7468 2c20 7265 6173 6f6e 3d22 636f 7272  th, reason="corr
-0001bf90: 7570 7420 6469 722c 206d 6973 7369 6e67  upt dir, missing
-0001bfa0: 2073 6f22 290a 2020 2020 2020 2020 2020   so").          
-0001bfb0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0001bfc0: 2020 2020 2020 2020 2020 2064 7420 3d20             dt = 
-0001bfd0: 7469 6d65 2e74 696d 6528 2920 2d20 6f73  time.time() - os
-0001bfe0: 2e70 6174 682e 6765 746d 7469 6d65 2873  .path.getmtime(s
-0001bff0: 6f5f 7061 7468 290a 2020 2020 2020 2020  o_path).        
-0001c000: 2020 2020 6966 2064 7420 3e20 636c 6561      if dt > clea
-0001c010: 6e75 705f 7469 6d65 5f6c 696d 6974 5f73  nup_time_limit_s
-0001c020: 6563 733a 0a20 2020 2020 2020 2020 2020  ecs:.           
-0001c030: 2020 2020 2073 656c 662e 5f63 6c65 616e       self._clean
-0001c040: 7570 5f6f 6c64 5f70 6174 6828 6675 6c6c  up_old_path(full
-0001c050: 5f64 6972 5f70 6174 682c 2072 6561 736f  _dir_path, reaso
-0001c060: 6e3d 2225 7320 6f6c 6422 2025 2068 6d73  n="%s old" % hms
-0001c070: 2864 7429 290a 0a20 2020 2064 6566 205f  (dt))..    def _
-0001c080: 636c 6561 6e75 705f 6f6c 645f 7061 7468  cleanup_old_path
-0001c090: 2873 656c 662c 2070 2c20 7265 6173 6f6e  (self, p, reason
-0001c0a0: 293a 0a20 2020 2020 2020 2070 7269 6e74  ):.        print
-0001c0b0: 2822 2573 2064 656c 6574 6520 6f6c 642c  ("%s delete old,
-0001c0c0: 2025 733a 2025 7322 2025 2028 7365 6c66   %s: %s" % (self
-0001c0d0: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
-0001c0e0: 655f 5f2c 2072 6561 736f 6e2c 2070 2929  e__, reason, p))
-0001c0f0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0001c100: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
-0001c110: 290a 2020 2020 2020 2020 696d 706f 7274  ).        import
-0001c120: 2073 6875 7469 6c0a 0a20 2020 2020 2020   shutil..       
-0001c130: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0001c140: 2020 7368 7574 696c 2e72 6d74 7265 6528    shutil.rmtree(
-0001c150: 7029 0a20 2020 2020 2020 2065 7863 6570  p).        excep
-0001c160: 7420 4f53 4572 726f 7220 6173 2065 7863  t OSError as exc
-0001c170: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0001c180: 696e 7428 2225 7320 6465 6c65 7465 2065  int("%s delete e
-0001c190: 7863 6570 7469 6f6e 2028 2573 292e 2057  xception (%s). W
-0001c1a0: 696c 6c20 6967 6e6f 7265 2061 6e64 2074  ill ignore and t
-0001c1b0: 7279 2074 6f20 636f 6e74 696e 7565 2061  ry to continue a
-0001c1c0: 6e79 7761 792e 2220 2520 2873 656c 662e  nyway." % (self.
-0001c1d0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0001c1e0: 5f5f 2c20 6578 6329 290a 0a20 2020 2064  __, exc))..    d
-0001c1f0: 6566 205f 6c6f 6164 5f69 6e66 6f28 7365  ef _load_info(se
-0001c200: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0001c210: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0001c220: 2064 6963 745b 7374 725d 7c4e 6f6e 650a   dict[str]|None.
-0001c230: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001c240: 2020 2020 6669 6c65 6e61 6d65 203d 2073      filename = s
-0001c250: 656c 662e 5f69 6e66 6f5f 6669 6c65 6e61  elf._info_filena
-0001c260: 6d65 0a20 2020 2020 2020 2069 6620 6e6f  me.        if no
-0001c270: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-0001c280: 2866 696c 656e 616d 6529 3a0a 2020 2020  (filename):.    
-0001c290: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0001c2a0: 6f6e 650a 2020 2020 2020 2020 7320 3d20  one.        s = 
-0001c2b0: 6f70 656e 2866 696c 656e 616d 6529 2e72  open(filename).r
-0001c2c0: 6561 6428 290a 2020 2020 2020 2020 7265  ead().        re
-0001c2d0: 7320 3d20 6576 616c 2873 290a 2020 2020  s = eval(s).    
-0001c2e0: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
-0001c2f0: 7461 6e63 6528 7265 732c 2064 6963 7429  tance(res, dict)
-0001c300: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001c310: 7265 730a 0a20 2020 205f 7265 6c65 7661  res..    _releva
-0001c320: 6e74 5f69 6e66 6f5f 6b65 7973 203d 2028  nt_info_keys = (
-0001c330: 2263 6f64 655f 7665 7273 696f 6e22 2c20  "code_version", 
-0001c340: 2263 6f64 655f 6861 7368 222c 2022 635f  "code_hash", "c_
-0001c350: 6d61 6372 6f5f 6465 6669 6e65 7322 2c20  macro_defines", 
-0001c360: 226c 645f 666c 6167 7322 2c20 2263 6f6d  "ld_flags", "com
-0001c370: 7069 6c65 725f 6269 6e22 290a 0a20 2020  piler_bin")..   
-0001c380: 2064 6566 205f 6d61 6b65 5f69 6e66 6f5f   def _make_info_
-0001c390: 6469 6374 2873 656c 6629 3a0a 2020 2020  dict(self):.    
-0001c3a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001c3b0: 3a72 7479 7065 3a20 6469 6374 5b73 7472  :rtype: dict[str
-0001c3c0: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
-0001c3d0: 2020 2020 2020 7265 7475 726e 207b 0a20        return {. 
-0001c3e0: 2020 2020 2020 2020 2020 2022 6261 7365             "base
-0001c3f0: 5f6e 616d 6522 3a20 7365 6c66 2e62 6173  _name": self.bas
-0001c400: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-0001c410: 2020 2020 2269 6e63 6c75 6465 5f70 6174      "include_pat
-0001c420: 6873 223a 2073 656c 662e 5f69 6e63 6c75  hs": self._inclu
-0001c430: 6465 5f70 6174 6873 2c0a 2020 2020 2020  de_paths,.      
-0001c440: 2020 2020 2020 2263 6f64 655f 7665 7273        "code_vers
-0001c450: 696f 6e22 3a20 7365 6c66 2e63 6f64 655f  ion": self.code_
-0001c460: 7665 7273 696f 6e2c 0a20 2020 2020 2020  version,.       
-0001c470: 2020 2020 2022 636f 6465 5f68 6173 6822       "code_hash"
-0001c480: 3a20 7365 6c66 2e5f 636f 6465 5f68 6173  : self._code_has
-0001c490: 682c 0a20 2020 2020 2020 2020 2020 2022  h,.            "
-0001c4a0: 635f 6d61 6372 6f5f 6465 6669 6e65 7322  c_macro_defines"
-0001c4b0: 3a20 7365 6c66 2e63 5f6d 6163 726f 5f64  : self.c_macro_d
-0001c4c0: 6566 696e 6573 2c0a 2020 2020 2020 2020  efines,.        
-0001c4d0: 2020 2020 226c 645f 666c 6167 7322 3a20      "ld_flags": 
-0001c4e0: 7365 6c66 2e6c 645f 666c 6167 732c 0a20  self.ld_flags,. 
-0001c4f0: 2020 2020 2020 2020 2020 2022 636f 6d70             "comp
-0001c500: 696c 6572 5f62 696e 223a 2073 656c 662e  iler_bin": self.
-0001c510: 5f67 6574 5f63 6f6d 7069 6c65 725f 6269  _get_compiler_bi
-0001c520: 6e28 292c 0a20 2020 2020 2020 207d 0a0a  n(),.        }..
-0001c530: 2020 2020 6465 6620 5f6d 616b 655f 636f      def _make_co
-0001c540: 6465 5f68 6173 6828 7365 6c66 293a 0a20  de_hash(self):. 
-0001c550: 2020 2020 2020 2069 6d70 6f72 7420 6861         import ha
-0001c560: 7368 6c69 620a 0a20 2020 2020 2020 2068  shlib..        h
-0001c570: 203d 2068 6173 686c 6962 2e6d 6435 2829   = hashlib.md5()
-0001c580: 0a20 2020 2020 2020 2068 2e75 7064 6174  .        h.updat
-0001c590: 6528 7365 6c66 2e63 6f64 652e 656e 636f  e(self.code.enco
-0001c5a0: 6465 2822 7574 6638 2229 290a 2020 2020  de("utf8")).    
-0001c5b0: 2020 2020 7265 7475 726e 2068 2e68 6578      return h.hex
-0001c5c0: 6469 6765 7374 2829 0a0a 2020 2020 6465  digest()..    de
-0001c5d0: 6620 5f6d 616b 655f 6861 7368 2873 656c  f _make_hash(sel
-0001c5e0: 6629 3a0a 2020 2020 2020 2020 696d 706f  f):.        impo
-0001c5f0: 7274 2068 6173 686c 6962 0a0a 2020 2020  rt hashlib..    
-0001c600: 2020 2020 6820 3d20 6861 7368 6c69 622e      h = hashlib.
-0001c610: 6d64 3528 290a 2020 2020 2020 2020 682e  md5().        h.
-0001c620: 7570 6461 7465 2822 7b22 2e65 6e63 6f64  update("{".encod
-0001c630: 6528 2275 7466 3822 2929 0a20 2020 2020  e("utf8")).     
-0001c640: 2020 2066 6f72 206b 6579 2069 6e20 7365     for key in se
-0001c650: 6c66 2e5f 7265 6c65 7661 6e74 5f69 6e66  lf._relevant_inf
-0001c660: 6f5f 6b65 7973 3a0a 2020 2020 2020 2020  o_keys:.        
-0001c670: 2020 2020 682e 7570 6461 7465 2828 2225      h.update(("%
-0001c680: 733a 7b25 737d 2220 2520 286b 6579 2c20  s:{%s}" % (key, 
-0001c690: 7365 6c66 2e5f 696e 666f 5f64 6963 745b  self._info_dict[
-0001c6a0: 6b65 795d 2929 2e65 6e63 6f64 6528 2275  key])).encode("u
-0001c6b0: 7466 3822 2929 0a20 2020 2020 2020 2068  tf8")).        h
-0001c6c0: 2e75 7064 6174 6528 227d 222e 656e 636f  .update("}".enco
-0001c6d0: 6465 2822 7574 6638 2229 290a 2020 2020  de("utf8")).    
-0001c6e0: 2020 2020 7265 7475 726e 2068 2e68 6578      return h.hex
-0001c6f0: 6469 6765 7374 2829 0a0a 2020 2020 6465  digest()..    de
-0001c700: 6620 5f73 6176 655f 696e 666f 2873 656c  f _save_info(sel
-0001c710: 6629 3a0a 2020 2020 2020 2020 6669 6c65  f):.        file
-0001c720: 6e61 6d65 203d 2073 656c 662e 5f69 6e66  name = self._inf
-0001c730: 6f5f 6669 6c65 6e61 6d65 0a20 2020 2020  o_filename.     
-0001c740: 2020 2077 6974 6820 6f70 656e 2866 696c     with open(fil
-0001c750: 656e 616d 652c 2022 7722 2920 6173 2066  ename, "w") as f
-0001c760: 3a0a 2020 2020 2020 2020 2020 2020 662e  :.            f.
-0001c770: 7772 6974 6528 2225 735c 6e22 2025 2062  write("%s\n" % b
-0001c780: 6574 7465 725f 7265 7072 2873 656c 662e  etter_repr(self.
-0001c790: 5f69 6e66 6f5f 6469 6374 2929 0a0a 2020  _info_dict))..  
-0001c7a0: 2020 6465 6620 5f6e 6565 645f 7265 636f    def _need_reco
-0001c7b0: 6d70 696c 6528 7365 6c66 293a 0a20 2020  mpile(self):.   
-0001c7c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001c7d0: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
-0001c7e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001c7f0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-0001c800: 2e65 7869 7374 7328 7365 6c66 2e5f 736f  .exists(self._so
-0001c810: 5f66 696c 656e 616d 6529 3a0a 2020 2020  _filename):.    
-0001c820: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-0001c830: 7275 650a 2020 2020 2020 2020 6966 2073  rue.        if s
-0001c840: 656c 662e 696e 636c 7564 655f 6465 7073  elf.include_deps
-0001c850: 3a0a 2020 2020 2020 2020 2020 2020 736f  :.            so
-0001c860: 5f6d 7469 6d65 203d 206f 732e 7061 7468  _mtime = os.path
-0001c870: 2e67 6574 6d74 696d 6528 7365 6c66 2e5f  .getmtime(self._
-0001c880: 736f 5f66 696c 656e 616d 6529 0a20 2020  so_filename).   
-0001c890: 2020 2020 2020 2020 2066 6f72 2066 6e20           for fn 
-0001c8a0: 696e 2073 656c 662e 696e 636c 7564 655f  in self.include_
-0001c8b0: 6465 7073 3a0a 2020 2020 2020 2020 2020  deps:.          
-0001c8c0: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-0001c8d0: 2e67 6574 6d74 696d 6528 666e 2920 3e20  .getmtime(fn) > 
-0001c8e0: 736f 5f6d 7469 6d65 3a0a 2020 2020 2020  so_mtime:.      
-0001c8f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001c900: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0001c910: 2020 6f6c 645f 696e 666f 203d 2073 656c    old_info = sel
-0001c920: 662e 5f6c 6f61 645f 696e 666f 2829 0a20  f._load_info(). 
-0001c930: 2020 2020 2020 206e 6577 5f69 6e66 6f20         new_info 
-0001c940: 3d20 7365 6c66 2e5f 6d61 6b65 5f69 6e66  = self._make_inf
-0001c950: 6f5f 6469 6374 2829 0a20 2020 2020 2020  o_dict().       
-0001c960: 2069 6620 6e6f 7420 6f6c 645f 696e 666f   if not old_info
-0001c970: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001c980: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0001c990: 2020 2320 5468 6520 6861 7368 2061 6c72    # The hash alr
-0001c9a0: 6561 6479 206d 6174 6368 6564 2062 7574  eady matched but
-0001c9b0: 2076 6572 7920 756e 6c69 6b65 6c79 2c20   very unlikely, 
-0001c9c0: 7468 6973 2063 6f75 6c64 2062 6520 6120  this could be a 
-0001c9d0: 636f 6c6c 6973 696f 6e2e 0a20 2020 2020  collision..     
-0001c9e0: 2020 2023 2041 6e79 7761 792c 206a 7573     # Anyway, jus
-0001c9f0: 7420 646f 2074 6869 7320 7665 7279 2063  t do this very c
-0001ca00: 6865 6170 2063 6865 636b 2e0a 2020 2020  heap check..    
-0001ca10: 2020 2020 666f 7220 6b65 7920 696e 2073      for key in s
-0001ca20: 656c 662e 5f72 656c 6576 616e 745f 696e  elf._relevant_in
-0001ca30: 666f 5f6b 6579 733a 0a20 2020 2020 2020  fo_keys:.       
-0001ca40: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
-0001ca50: 696e 206f 6c64 5f69 6e66 6f3a 0a20 2020  in old_info:.   
-0001ca60: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001ca70: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
-0001ca80: 2020 2020 2069 6620 6f6c 645f 696e 666f       if old_info
-0001ca90: 5b6b 6579 5d20 213d 206e 6577 5f69 6e66  [key] != new_inf
-0001caa0: 6f5b 6b65 795d 3a0a 2020 2020 2020 2020  o[key]:.        
-0001cab0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-0001cac0: 7275 650a 2020 2020 2020 2020 2320 4966  rue.        # If
-0001cad0: 206e 6f20 636f 6465 2076 6572 7369 6f6e   no code version
-0001cae0: 2069 7320 7072 6f76 6964 6564 2c20 7765   is provided, we
-0001caf0: 2063 6f75 6c64 2061 6c73 6f20 6368 6563   could also chec
-0001cb00: 6b20 7468 6520 636f 6465 2069 7473 656c  k the code itsel
-0001cb10: 6620 6e6f 772e 0a20 2020 2020 2020 2023  f now..        #
-0001cb20: 2042 7574 2049 2074 6869 6e6b 2074 6869   But I think thi
-0001cb30: 7320 6973 206f 7665 726b 696c 6c2e 0a20  s is overkill.. 
-0001cb40: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0001cb50: 6c73 650a 0a20 2020 2064 6566 205f 6d61  lse..    def _ma
-0001cb60: 7962 655f 636f 6d70 696c 6528 7365 6c66  ybe_compile(self
-0001cb70: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0001cb80: 2020 2020 2020 204f 6e20 7375 6363 6573         On succes
-0001cb90: 7366 756c 2072 6574 7572 6e2c 2073 656c  sful return, sel
-0001cba0: 662e 5f73 6f5f 6669 6c65 6e61 6d65 2073  f._so_filename s
-0001cbb0: 686f 756c 6420 6578 6973 7420 616e 6420  hould exist and 
-0001cbc0: 6265 2075 702d 746f 2d64 6174 652e 0a20  be up-to-date.. 
-0001cbd0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001cbe0: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
-0001cbf0: 6e65 6564 5f72 6563 6f6d 7069 6c65 2829  need_recompile()
-0001cc00: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0001cc10: 2073 656c 662e 7665 7262 6f73 653a 0a20   self.verbose:. 
-0001cc20: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001cc30: 7269 6e74 2822 2573 3a20 4e6f 206e 6565  rint("%s: No nee
-0001cc40: 6420 746f 2072 6563 6f6d 7069 6c65 3a20  d to recompile: 
-0001cc50: 2573 2220 2520 2873 656c 662e 5f5f 636c  %s" % (self.__cl
-0001cc60: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20  ass__.__name__, 
-0001cc70: 7365 6c66 2e5f 736f 5f66 696c 656e 616d  self._so_filenam
-0001cc80: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
-0001cc90: 2320 546f 7563 6820 6974 2073 6f20 7468  # Touch it so th
-0001cca0: 6174 2077 6520 6361 6e20 7365 6520 7468  at we can see th
-0001ccb0: 6174 2077 6520 7573 6564 2069 7420 7265  at we used it re
-0001ccc0: 6365 6e74 6c79 2e0a 2020 2020 2020 2020  cently..        
-0001ccd0: 2020 2020 6f73 2e75 7469 6d65 2873 656c      os.utime(sel
-0001cce0: 662e 5f69 6e66 6f5f 6669 6c65 6e61 6d65  f._info_filename
-0001ccf0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-0001cd00: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0001cd10: 2020 206c 6f63 6b20 3d20 4c6f 636b 4669     lock = LockFi
-0001cd20: 6c65 2873 656c 662e 5f6d 6f64 5f70 6174  le(self._mod_pat
-0001cd30: 6829 0a20 2020 2020 2020 2069 6620 6e6f  h).        if no
-0001cd40: 7420 7365 6c66 2e5f 6e65 6564 5f72 6563  t self._need_rec
-0001cd50: 6f6d 7069 6c65 2829 3a20 2023 2063 6865  ompile():  # che
-0001cd60: 636b 2061 6761 696e 0a20 2020 2020 2020  ck again.       
-0001cd70: 2020 2020 2069 6620 7365 6c66 2e76 6572       if self.ver
-0001cd80: 626f 7365 3a0a 2020 2020 2020 2020 2020  bose:.          
-0001cd90: 2020 2020 2020 7072 696e 7428 2225 733a        print("%s:
-0001cda0: 204e 6f20 6e65 6564 2074 6f20 7265 636f   No need to reco
-0001cdb0: 6d70 696c 6520 6166 7465 7220 7765 2077  mpile after we w
-0001cdc0: 6169 7465 643a 2025 7322 2025 2028 7365  aited: %s" % (se
-0001cdd0: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
-0001cde0: 616d 655f 5f2c 2073 656c 662e 5f73 6f5f  ame__, self._so_
-0001cdf0: 6669 6c65 6e61 6d65 2929 0a20 2020 2020  filename)).     
-0001ce00: 2020 2020 2020 206f 732e 7574 696d 6528         os.utime(
-0001ce10: 7365 6c66 2e5f 696e 666f 5f66 696c 656e  self._info_filen
-0001ce20: 616d 652c 204e 6f6e 6529 0a20 2020 2020  ame, None).     
-0001ce30: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-0001ce40: 2020 2020 2020 6966 2073 656c 662e 5f73        if self._s
-0001ce50: 686f 756c 645f 636c 6561 6e75 705f 6f6c  hould_cleanup_ol
-0001ce60: 645f 6d79 6469 7220 616e 6420 6e6f 7420  d_mydir and not 
-0001ce70: 6c6f 636b 2e69 735f 6c6f 636b 6564 2829  lock.is_locked()
-0001ce80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0001ce90: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0001cea0: 7365 6c66 2e5f 6d6f 645f 7061 7468 293a  self._mod_path):
-0001ceb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cec0: 2073 656c 662e 5f63 6c65 616e 7570 5f6f   self._cleanup_o
-0001ced0: 6c64 5f70 6174 6828 7365 6c66 2e5f 6d6f  ld_path(self._mo
-0001cee0: 645f 7061 7468 2c20 7265 6173 6f6e 3d22  d_path, reason="
-0001cef0: 6e65 6564 2072 6563 6f6d 7069 6c65 2229  need recompile")
-0001cf00: 0a20 2020 2020 2020 2077 6974 6820 6c6f  .        with lo
-0001cf10: 636b 3a0a 2020 2020 2020 2020 2020 2020  ck:.            
-0001cf20: 7365 6c66 2e5f 6d61 7962 655f 636f 6d70  self._maybe_comp
-0001cf30: 696c 655f 696e 6e65 7228 290a 0a20 2020  ile_inner()..   
-0001cf40: 2064 6566 205f 6765 745f 636f 6d70 696c   def _get_compil
-0001cf50: 6572 5f62 696e 2873 656c 6629 3a0a 2020  er_bin(self):.  
-0001cf60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001cf70: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
-0001cf80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001cf90: 2020 6966 2073 656c 662e 6973 5f63 7070    if self.is_cpp
-0001cfa0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001cfb0: 7475 726e 2022 672b 2b22 0a20 2020 2020  turn "g++".     
-0001cfc0: 2020 2072 6574 7572 6e20 2267 6363 220a     return "gcc".
-0001cfd0: 0a20 2020 2064 6566 205f 7472 616e 7366  .    def _transf
-0001cfe0: 6f72 6d5f 636f 6d70 696c 6572 5f6f 7074  orm_compiler_opt
-0001cff0: 7328 7365 6c66 2c20 6f70 7473 293a 0a20  s(self, opts):. 
-0001d000: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001d010: 2020 203a 7061 7261 6d20 6c69 7374 5b73     :param list[s
-0001d020: 7472 5d20 6f70 7473 3a0a 2020 2020 2020  tr] opts:.      
-0001d030: 2020 3a72 7479 7065 3a20 6c69 7374 5b73    :rtype: list[s
-0001d040: 7472 5d0a 2020 2020 2020 2020 2222 220a  tr].        """.
-0001d050: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0001d060: 7074 730a 0a20 2020 2064 6566 205f 6578  pts..    def _ex
-0001d070: 7472 615f 636f 6d6d 6f6e 5f6f 7074 7328  tra_common_opts(
-0001d080: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0001d090: 2222 0a20 2020 2020 2020 203a 7274 7970  "".        :rtyp
-0001d0a0: 653a 206c 6973 745b 7374 725d 0a20 2020  e: list[str].   
-0001d0b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001d0c0: 2069 6620 7365 6c66 2e69 735f 6370 703a   if self.is_cpp:
-0001d0d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001d0e0: 7572 6e20 5b22 2d73 7464 3d63 2b2b 3131  urn ["-std=c++11
-0001d0f0: 225d 0a20 2020 2020 2020 2072 6574 7572  "].        retur
-0001d100: 6e20 5b5d 0a0a 2020 2020 4063 6c61 7373  n []..    @class
-0001d110: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-0001d120: 7472 616e 7366 6f72 6d5f 6c64 5f66 6c61  transform_ld_fla
-0001d130: 6728 636c 732c 206f 7074 293a 0a20 2020  g(cls, opt):.   
-0001d140: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001d150: 203a 7061 7261 6d20 7374 7220 6f70 743a   :param str opt:
-0001d160: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
-0001d170: 2073 7472 0a20 2020 2020 2020 2022 2222   str.        """
-0001d180: 0a20 2020 2020 2020 2069 6620 7379 732e  .        if sys.
-0001d190: 706c 6174 666f 726d 203d 3d20 2264 6172  platform == "dar
-0001d1a0: 7769 6e22 3a0a 2020 2020 2020 2020 2020  win":.          
-0001d1b0: 2020 2320 4974 2073 6565 6d73 2073 6f6d    # It seems som
-0001d1c0: 6520 7665 7273 696f 6e73 206f 6620 4d61  e versions of Ma
-0001d1d0: 634f 5320 6c64 2063 616e 6e6f 7420 6861  cOS ld cannot ha
-0001d1e0: 6e64 6c65 2074 6865 2060 2d6c 3a66 696c  ndle the `-l:fil
-0001d1f0: 656e 616d 6560 2061 7267 756d 656e 7420  ename` argument 
-0001d200: 636f 7272 6563 746c 792e 0a20 2020 2020  correctly..     
-0001d210: 2020 2020 2020 2023 2045 2e67 2e20 5465         # E.g. Te
-0001d220: 6e73 6f72 466c 6f77 2031 2e31 3420 696e  nsorFlow 1.14 in
-0001d230: 636f 7272 6563 746c 7920 7573 6573 2074  correctly uses t
-0001d240: 6869 732e 0a20 2020 2020 2020 2020 2020  his..           
-0001d250: 2023 2068 7474 7073 3a2f 2f67 6974 6875   # https://githu
-0001d260: 622e 636f 6d2f 7465 6e73 6f72 666c 6f77  b.com/tensorflow
-0001d270: 2f74 656e 736f 7266 6c6f 772f 6973 7375  /tensorflow/issu
-0001d280: 6573 2f33 3035 3634 0a20 2020 2020 2020  es/30564.       
-0001d290: 2020 2020 2069 6620 6f70 742e 7374 6172       if opt.star
-0001d2a0: 7473 7769 7468 2822 2d6c 3a6c 6962 2229  tswith("-l:lib")
-0001d2b0: 2061 6e64 206f 7074 2e65 6e64 7377 6974   and opt.endswit
-0001d2c0: 6828 222e 6479 6c69 6222 293a 0a20 2020  h(".dylib"):.   
-0001d2d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001d2e0: 7572 6e20 222d 6c25 7322 2025 206f 7074  urn "-l%s" % opt
-0001d2f0: 5b6c 656e 2822 2d6c 3a6c 6962 2229 203a  [len("-l:lib") :
-0001d300: 202d 6c65 6e28 222e 6479 6c69 6222 295d   -len(".dylib")]
-0001d310: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001d320: 6f70 740a 0a20 2020 2064 6566 205f 6d61  opt..    def _ma
-0001d330: 7962 655f 636f 6d70 696c 655f 696e 6e65  ybe_compile_inne
-0001d340: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
-0001d350: 2023 2044 6972 6563 746f 7279 2073 686f   # Directory sho
-0001d360: 756c 6420 6265 2063 7265 6174 6564 2062  uld be created b
-0001d370: 7920 7468 6520 6c6f 636b 696e 6720 6d65  y the locking me
-0001d380: 6368 616e 6973 6d2e 0a20 2020 2020 2020  chanism..       
-0001d390: 2061 7373 6572 7420 6f73 2e70 6174 682e   assert os.path.
-0001d3a0: 6578 6973 7473 2873 656c 662e 5f6d 6f64  exists(self._mod
-0001d3b0: 5f70 6174 6829 0a20 2020 2020 2020 2077  _path).        w
-0001d3c0: 6974 6820 6f70 656e 2873 656c 662e 5f63  ith open(self._c
-0001d3d0: 5f66 696c 656e 616d 652c 2022 7722 2920  _filename, "w") 
-0001d3e0: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-0001d3f0: 2020 662e 7772 6974 6528 7365 6c66 2e63    f.write(self.c
-0001d400: 6f64 6529 0a20 2020 2020 2020 2063 6f6d  ode).        com
-0001d410: 6d6f 6e5f 6f70 7473 203d 205b 222d 7368  mon_opts = ["-sh
-0001d420: 6172 6564 222c 2022 2d4f 3222 5d0a 2020  ared", "-O2"].  
-0001d430: 2020 2020 2020 636f 6d6d 6f6e 5f6f 7074        common_opt
-0001d440: 7320 2b3d 2073 656c 662e 5f65 7874 7261  s += self._extra
-0001d450: 5f63 6f6d 6d6f 6e5f 6f70 7473 2829 0a20  _common_opts(). 
-0001d460: 2020 2020 2020 2069 6620 7379 732e 706c         if sys.pl
-0001d470: 6174 666f 726d 203d 3d20 2264 6172 7769  atform == "darwi
-0001d480: 6e22 3a0a 2020 2020 2020 2020 2020 2020  n":.            
-0001d490: 636f 6d6d 6f6e 5f6f 7074 7320 2b3d 205b  common_opts += [
-0001d4a0: 222d 756e 6465 6669 6e65 6422 2c20 2264  "-undefined", "d
-0001d4b0: 796e 616d 6963 5f6c 6f6f 6b75 7022 5d0a  ynamic_lookup"].
-0001d4c0: 2020 2020 2020 2020 666f 7220 696e 636c          for incl
-0001d4d0: 7564 655f 7061 7468 2069 6e20 7365 6c66  ude_path in self
-0001d4e0: 2e5f 696e 636c 7564 655f 7061 7468 733a  ._include_paths:
-0001d4f0: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-0001d500: 6d6f 6e5f 6f70 7473 202b 3d20 5b22 2d49  mon_opts += ["-I
-0001d510: 222c 2069 6e63 6c75 6465 5f70 6174 685d  ", include_path]
-0001d520: 0a20 2020 2020 2020 2063 6f6d 7069 6c65  .        compile
-0001d530: 725f 6f70 7473 203d 205b 222d 6650 4943  r_opts = ["-fPIC
-0001d540: 222c 2022 2d76 225d 0a20 2020 2020 2020  ", "-v"].       
-0001d550: 2063 6f6d 6d6f 6e5f 6f70 7473 202b 3d20   common_opts += 
-0001d560: 7365 6c66 2e5f 7472 616e 7366 6f72 6d5f  self._transform_
-0001d570: 636f 6d70 696c 6572 5f6f 7074 7328 636f  compiler_opts(co
-0001d580: 6d70 696c 6572 5f6f 7074 7329 0a20 2020  mpiler_opts).   
-0001d590: 2020 2020 2063 6f6d 6d6f 6e5f 6f70 7473       common_opts
-0001d5a0: 202b 3d20 5b22 2d44 5f47 4c49 4243 5858   += ["-D_GLIBCXX
-0001d5b0: 5f55 5345 5f43 5858 3131 5f41 4249 3d25  _USE_CXX11_ABI=%
-0001d5c0: 6922 2025 2028 3120 6966 2073 656c 662e  i" % (1 if self.
-0001d5d0: 7573 655f 6378 7831 315f 6162 6920 656c  use_cxx11_abi el
-0001d5e0: 7365 2030 295d 0a20 2020 2020 2020 2063  se 0)].        c
-0001d5f0: 6f6d 6d6f 6e5f 6f70 7473 202b 3d20 5b22  ommon_opts += ["
-0001d600: 2d44 2573 3d25 7322 2025 2069 7465 6d20  -D%s=%s" % item 
-0001d610: 666f 7220 6974 656d 2069 6e20 736f 7274  for item in sort
-0001d620: 6564 2873 656c 662e 635f 6d61 6372 6f5f  ed(self.c_macro_
-0001d630: 6465 6669 6e65 732e 6974 656d 7328 2929  defines.items())
-0001d640: 5d0a 2020 2020 2020 2020 636f 6d6d 6f6e  ].        common
-0001d650: 5f6f 7074 7320 2b3d 205b 222d 6722 5d0a  _opts += ["-g"].
-0001d660: 2020 2020 2020 2020 6f70 7473 203d 2063          opts = c
-0001d670: 6f6d 6d6f 6e5f 6f70 7473 202b 205b 7365  ommon_opts + [se
-0001d680: 6c66 2e5f 635f 6669 6c65 6e61 6d65 2c20  lf._c_filename, 
-0001d690: 222d 6f22 2c20 7365 6c66 2e5f 736f 5f66  "-o", self._so_f
-0001d6a0: 696c 656e 616d 655d 0a20 2020 2020 2020  ilename].       
-0001d6b0: 206f 7074 7320 2b3d 206c 6973 7428 6d61   opts += list(ma
-0001d6c0: 7028 7365 6c66 2e5f 7472 616e 7366 6f72  p(self._transfor
-0001d6d0: 6d5f 6c64 5f66 6c61 672c 2073 656c 662e  m_ld_flag, self.
-0001d6e0: 6c64 5f66 6c61 6773 2929 0a20 2020 2020  ld_flags)).     
-0001d6f0: 2020 2063 6d64 5f62 696e 203d 2073 656c     cmd_bin = sel
-0001d700: 662e 5f67 6574 5f63 6f6d 7069 6c65 725f  f._get_compiler_
-0001d710: 6269 6e28 290a 2020 2020 2020 2020 636d  bin().        cm
-0001d720: 645f 6172 6773 203d 205b 636d 645f 6269  d_args = [cmd_bi
-0001d730: 6e5d 202b 206f 7074 730a 2020 2020 2020  n] + opts.      
-0001d740: 2020 6672 6f6d 2073 7562 7072 6f63 6573    from subproces
-0001d750: 7320 696d 706f 7274 2050 6f70 656e 2c20  s import Popen, 
-0001d760: 5049 5045 2c20 5354 444f 5554 2c20 4361  PIPE, STDOUT, Ca
-0001d770: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-0001d780: 0a0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-0001d790: 2225 7320 6361 6c6c 3a20 2573 2220 2520  "%s call: %s" % 
-0001d7a0: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
-0001d7b0: 5f5f 6e61 6d65 5f5f 2c20 2220 222e 6a6f  __name__, " ".jo
-0001d7c0: 696e 2863 6d64 5f61 7267 7329 292c 2066  in(cmd_args)), f
-0001d7d0: 696c 653d 7365 6c66 2e5f 6c6f 675f 7374  ile=self._log_st
-0001d7e0: 7265 616d 290a 2020 2020 2020 2020 7072  ream).        pr
-0001d7f0: 6f63 203d 2050 6f70 656e 2863 6d64 5f61  oc = Popen(cmd_a
-0001d800: 7267 732c 2063 7764 3d73 656c 662e 5f6d  rgs, cwd=self._m
-0001d810: 6f64 5f70 6174 682c 2073 7464 6f75 743d  od_path, stdout=
-0001d820: 5049 5045 2c20 7374 6465 7272 3d53 5444  PIPE, stderr=STD
-0001d830: 4f55 5429 0a20 2020 2020 2020 2073 7464  OUT).        std
-0001d840: 6f75 742c 2073 7464 6572 7220 3d20 7072  out, stderr = pr
-0001d850: 6f63 2e63 6f6d 6d75 6e69 6361 7465 2829  oc.communicate()
-0001d860: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-0001d870: 7374 6465 7272 2069 7320 4e6f 6e65 2020  stderr is None  
-0001d880: 2320 7368 6f75 6c64 206f 6e6c 7920 6861  # should only ha
-0001d890: 7665 2073 7464 6f75 740a 2020 2020 2020  ve stdout.      
-0001d8a0: 2020 6966 2070 726f 632e 7265 7475 726e    if proc.return
-0001d8b0: 636f 6465 2021 3d20 303a 0a20 2020 2020  code != 0:.     
-0001d8c0: 2020 2020 2020 2070 7269 6e74 2822 2573         print("%s
-0001d8d0: 3a20 2573 2066 6169 6c65 642e 2220 2520  : %s failed." % 
-0001d8e0: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
-0001d8f0: 5f5f 6e61 6d65 5f5f 2c20 636d 645f 6269  __name__, cmd_bi
-0001d900: 6e29 290a 2020 2020 2020 2020 2020 2020  n)).            
-0001d910: 7072 696e 7428 224f 7269 6769 6e61 6c20  print("Original 
-0001d920: 7374 646f 7574 2f73 7464 6572 723a 2229  stdout/stderr:")
-0001d930: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0001d940: 6e74 2873 7464 6f75 742e 6465 636f 6465  nt(stdout.decode
-0001d950: 2822 7574 6638 2229 290a 2020 2020 2020  ("utf8")).      
-0001d960: 2020 2020 2020 7072 696e 7428 290a 2020        print().  
-0001d970: 2020 2020 2020 2020 2020 6966 2063 6d64            if cmd
-0001d980: 5f62 696e 2e65 6e64 7377 6974 6828 222f  _bin.endswith("/
-0001d990: 6e76 6363 2229 2061 6e64 2062 2265 7272  nvcc") and b"err
-0001d9a0: 6f72 3a20 636f 6e73 7465 7870 7220 6675  or: constexpr fu
-0001d9b0: 6e63 7469 6f6e 2072 6574 7572 6e20 6973  nction return is
-0001d9c0: 206e 6f6e 2d63 6f6e 7374 616e 7422 2069   non-constant" i
-0001d9d0: 6e20 7374 646f 7574 3a0a 2020 2020 2020  n stdout:.      
-0001d9e0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001d9f0: 2254 6869 7320 6d69 6768 7420 6265 2074  "This might be t
-0001da00: 6865 2065 7272 6f72 3a20 6874 7470 733a  he error: https:
-0001da10: 2f2f 6769 7468 7562 2e63 6f6d 2f74 656e  //github.com/ten
-0001da20: 736f 7266 6c6f 772f 7465 6e73 6f72 666c  sorflow/tensorfl
-0001da30: 6f77 2f69 7373 7565 732f 3232 3736 3622  ow/issues/22766"
-0001da40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001da50: 2020 7072 696e 7428 290a 2020 2020 2020    print().      
-0001da60: 2020 2020 2020 6966 2063 6d64 5f62 696e        if cmd_bin
-0001da70: 2e65 6e64 7377 6974 6828 222f 6e76 6363  .endswith("/nvcc
-0001da80: 2229 2061 6e64 2062 2267 6363 2076 6572  ") and b"gcc ver
-0001da90: 7369 6f6e 7320 6c61 7465 7220 7468 616e  sions later than
-0001daa0: 2220 696e 2073 7464 6f75 743a 0a20 2020  " in stdout:.   
-0001dab0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0001dac0: 6e74 2822 596f 7572 2047 4343 2076 6572  nt("Your GCC ver
-0001dad0: 7369 6f6e 206d 6967 6874 2062 6520 746f  sion might be to
-0001dae0: 6f20 6e65 772e 2054 6869 7320 6973 2061  o new. This is a
-0001daf0: 2070 726f 626c 656d 2077 6974 6820 736f   problem with so
-0001db00: 6d65 206e 7663 6320 7665 7273 696f 6e73  me nvcc versions
-0001db10: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-0001db20: 2020 2020 7072 696e 7428 290a 2020 2020      print().    
-0001db30: 2020 2020 2020 2020 7261 6973 6520 4361          raise Ca
-0001db40: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-0001db50: 2872 6574 7572 6e63 6f64 653d 7072 6f63  (returncode=proc
-0001db60: 2e72 6574 7572 6e63 6f64 652c 2063 6d64  .returncode, cmd
-0001db70: 3d63 6d64 5f61 7267 7329 0a20 2020 2020  =cmd_args).     
-0001db80: 2020 2061 7373 6572 7420 6f73 2e70 6174     assert os.pat
-0001db90: 682e 6578 6973 7473 2873 656c 662e 5f73  h.exists(self._s
-0001dba0: 6f5f 6669 6c65 6e61 6d65 290a 2020 2020  o_filename).    
-0001dbb0: 2020 2020 7769 7468 206f 7065 6e28 2225      with open("%
-0001dbc0: 732f 636f 6d70 696c 652e 6c6f 6722 2025  s/compile.log" %
-0001dbd0: 2073 656c 662e 5f6d 6f64 5f70 6174 682c   self._mod_path,
-0001dbe0: 2022 7762 2229 2061 7320 663a 0a20 2020   "wb") as f:.   
-0001dbf0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0001dc00: 2e76 6572 626f 7365 3a0a 2020 2020 2020  .verbose:.      
-0001dc10: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001dc20: 2225 733a 2077 7269 7465 2063 6f6d 7069  "%s: write compi
-0001dc30: 6c65 206c 6f67 2074 6f3a 2025 7322 2025  le log to: %s" %
-0001dc40: 2028 7365 6c66 2e5f 5f63 6c61 7373 5f5f   (self.__class__
-0001dc50: 2e5f 5f6e 616d 655f 5f2c 2066 2e6e 616d  .__name__, f.nam
-0001dc60: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
-0001dc70: 662e 7772 6974 6528 2822 2b20 2573 5c6e  f.write(("+ %s\n
-0001dc80: 2220 2520 2220 222e 6a6f 696e 2863 6d64  " % " ".join(cmd
-0001dc90: 5f61 7267 7329 292e 656e 636f 6465 2822  _args)).encode("
-0001dca0: 7574 6638 2229 290a 2020 2020 2020 2020  utf8")).        
-0001dcb0: 2020 2020 662e 7772 6974 6528 7374 646f      f.write(stdo
-0001dcc0: 7574 290a 2020 2020 2020 2020 7365 6c66  ut).        self
-0001dcd0: 2e5f 7361 7665 5f69 6e66 6f28 290a 2020  ._save_info().  
-0001dce0: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
-0001dcf0: 2073 656c 662e 5f6e 6565 645f 7265 636f   self._need_reco
-0001dd00: 6d70 696c 6528 290a 0a20 2020 2064 6566  mpile()..    def
-0001dd10: 206c 6f61 645f 6c69 625f 6374 7970 6573   load_lib_ctypes
-0001dd20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001dd30: 2222 220a 2020 2020 2020 2020 3a72 7479  """.        :rty
-0001dd40: 7065 3a20 6374 7970 6573 2e43 444c 4c0a  pe: ctypes.CDLL.
-0001dd50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001dd60: 2020 2020 6966 2073 656c 662e 5f63 7479      if self._cty
-0001dd70: 7065 735f 6c69 623a 0a20 2020 2020 2020  pes_lib:.       
-0001dd80: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001dd90: 2e5f 6374 7970 6573 5f6c 6962 0a20 2020  ._ctypes_lib.   
-0001dda0: 2020 2020 2073 656c 662e 5f6d 6179 6265       self._maybe
-0001ddb0: 5f63 6f6d 7069 6c65 2829 0a20 2020 2020  _compile().     
-0001ddc0: 2020 2069 6d70 6f72 7420 6374 7970 6573     import ctypes
-0001ddd0: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0001dde0: 6374 7970 6573 5f6c 6962 203d 2063 7479  ctypes_lib = cty
-0001ddf0: 7065 732e 6364 6c6c 2e4c 6f61 644c 6962  pes.cdll.LoadLib
-0001de00: 7261 7279 2873 656c 662e 5f73 6f5f 6669  rary(self._so_fi
-0001de10: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
-0001de20: 7265 7475 726e 2073 656c 662e 5f63 7479  return self._cty
-0001de30: 7065 735f 6c69 620a 0a20 2020 2064 6566  pes_lib..    def
-0001de40: 2067 6574 5f6c 6962 5f66 696c 656e 616d   get_lib_filenam
-0001de50: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0001de60: 2022 2222 0a20 2020 2020 2020 203a 7274   """.        :rt
-0001de70: 7970 653a 2073 7472 0a20 2020 2020 2020  ype: str.       
-0001de80: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
-0001de90: 662e 5f6d 6179 6265 5f63 6f6d 7069 6c65  f._maybe_compile
-0001dea0: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-0001deb0: 6e20 7365 6c66 2e5f 736f 5f66 696c 656e  n self._so_filen
-0001dec0: 616d 650a 0a0a 2320 5365 6520 3a66 756e  ame...# See :fun
-0001ded0: 633a 606d 6179 6265 5f72 6573 7461 7274  c:`maybe_restart
-0001dee0: 5f72 6574 7572 6e6e 5f77 6974 685f 6174  _returnn_with_at
-0001def0: 666f 726b 5f70 6174 6368 6020 6265 6c6f  fork_patch` belo
-0001df00: 7720 666f 7220 7768 7920 796f 7520 6d69  w for why you mi
-0001df10: 6768 7420 7761 6e74 2074 6f20 7573 6520  ght want to use 
-0001df20: 7468 6973 2e0a 5f63 5f63 6f64 655f 7061  this.._c_code_pa
-0001df30: 7463 685f 6174 666f 726b 203d 2022 2222  tch_atfork = """
-0001df40: 0a23 6465 6669 6e65 205f 474e 555f 534f  .#define _GNU_SO
-0001df50: 5552 4345 0a23 696e 636c 7564 6520 3c73  URCE.#include <s
-0001df60: 6368 6564 2e68 3e0a 2369 6e63 6c75 6465  ched.h>.#include
-0001df70: 203c 7369 676e 616c 2e68 3e0a 2369 6e63   <signal.h>.#inc
-0001df80: 6c75 6465 203c 7379 732f 7379 7363 616c  lude <sys/syscal
-0001df90: 6c2e 683e 0a23 696e 636c 7564 6520 3c73  l.h>.#include <s
-0001dfa0: 7464 696f 2e68 3e0a 2369 6e63 6c75 6465  tdio.h>.#include
-0001dfb0: 203c 7374 646c 6962 2e68 3e0a 2369 6e63   <stdlib.h>.#inc
-0001dfc0: 6c75 6465 203c 756e 6973 7464 2e68 3e0a  lude <unistd.h>.
-0001dfd0: 0a2f 2f20 6874 7470 733a 2f2f 7374 6163  .// https://stac
-0001dfe0: 6b6f 7665 7266 6c6f 772e 636f 6d2f 7175  koverflow.com/qu
-0001dff0: 6573 7469 6f6e 732f 3436 3834 3534 3936  estions/46845496
-0001e000: 2f6c 642d 7072 656c 6f61 642d 616e 642d  /ld-preload-and-
-0001e010: 6c69 6e6b 6167 650a 2f2f 2068 7474 7073  linkage.// https
-0001e020: 3a2f 2f73 7461 636b 6f76 6572 666c 6f77  ://stackoverflow
-0001e030: 2e63 6f6d 2f71 7565 7374 696f 6e73 2f34  .com/questions/4
-0001e040: 3638 3130 3539 372f 666f 726b 6578 6563  6810597/forkexec
-0001e050: 2d77 6974 686f 7574 2d61 7466 6f72 6b2d  -without-atfork-
-0001e060: 6861 6e64 6c65 7273 0a0a 696e 7420 7074  handlers..int pt
-0001e070: 6872 6561 645f 6174 666f 726b 2876 6f69  hread_atfork(voi
-0001e080: 6420 282a 7072 6570 6172 6529 2876 6f69  d (*prepare)(voi
-0001e090: 6429 2c20 766f 6964 2028 2a70 6172 656e  d), void (*paren
-0001e0a0: 7429 2876 6f69 6429 2c20 766f 6964 2028  t)(void), void (
-0001e0b0: 2a63 6869 6c64 2928 766f 6964 2929 207b  *child)(void)) {
-0001e0c0: 0a20 2070 7269 6e74 6628 2249 676e 6f72  .  printf("Ignor
-0001e0d0: 696e 6720 7074 6872 6561 645f 6174 666f  ing pthread_atfo
-0001e0e0: 726b 2063 616c 6c21 5c5c 6e22 293b 0a20  rk call!\\n");. 
-0001e0f0: 2066 666c 7573 6828 7374 646f 7574 293b   fflush(stdout);
-0001e100: 0a20 2072 6574 7572 6e20 303b 0a7d 0a0a  .  return 0;.}..
-0001e110: 696e 7420 5f5f 7265 6769 7374 6572 5f61  int __register_a
-0001e120: 7466 6f72 6b28 766f 6964 2028 2a70 7265  tfork(void (*pre
-0001e130: 7061 7265 2928 766f 6964 292c 2076 6f69  pare)(void), voi
-0001e140: 6420 282a 7061 7265 6e74 2928 766f 6964  d (*parent)(void
-0001e150: 292c 2076 6f69 6420 282a 6368 696c 6429  ), void (*child)
-0001e160: 2876 6f69 6429 2920 7b0a 2020 7072 696e  (void)) {.  prin
-0001e170: 7466 2822 4967 6e6f 7269 6e67 205f 5f72  tf("Ignoring __r
-0001e180: 6567 6973 7465 725f 6174 666f 726b 2063  egister_atfork c
-0001e190: 616c 6c21 5c5c 6e22 293b 0a20 2066 666c  all!\\n");.  ffl
-0001e1a0: 7573 6828 7374 646f 7574 293b 0a20 2072  ush(stdout);.  r
-0001e1b0: 6574 7572 6e20 303b 0a7d 0a0a 2f2f 2041  eturn 0;.}..// A
-0001e1c0: 6e6f 7468 6572 2077 6179 2074 6f20 6967  nother way to ig
-0001e1d0: 6e6f 7265 2061 7466 6f72 6b20 6861 6e64  nore atfork hand
-0001e1e0: 6c65 7273 3a20 4f76 6572 7269 6465 2066  lers: Override f
-0001e1f0: 6f72 6b2e 0a23 6966 6465 6620 5f5f 6c69  ork..#ifdef __li
-0001e200: 6e75 785f 5f20 2f2f 206f 6e6c 7920 776f  nux__ // only wo
-0001e210: 726b 7320 6f6e 204c 696e 7578 2063 7572  rks on Linux cur
-0001e220: 7265 6e74 6c79 0a70 6964 5f74 2066 6f72  rently.pid_t for
-0001e230: 6b28 766f 6964 2920 7b0a 2020 7265 7475  k(void) {.  retu
-0001e240: 726e 2073 7973 6361 6c6c 2853 5953 5f63  rn syscall(SYS_c
-0001e250: 6c6f 6e65 2c20 5349 4743 484c 442c 2030  lone, SIGCHLD, 0
-0001e260: 293b 0a7d 0a23 656e 6469 660a 0a5f 5f61  );.}.#endif..__a
-0001e270: 7474 7269 6275 7465 5f5f 2828 636f 6e73  ttribute__((cons
-0001e280: 7472 7563 746f 7229 290a 766f 6964 2070  tructor)).void p
-0001e290: 6174 6368 5f61 7466 6f72 6b5f 696e 6974  atch_atfork_init
-0001e2a0: 2829 207b 0a20 2073 6574 656e 7628 225f  () {.  setenv("_
-0001e2b0: 5f52 4554 5552 4e4e 5f41 5446 4f52 4b5f  _RETURNN_ATFORK_
-0001e2c0: 5041 5443 4845 4422 2c20 2231 222c 2031  PATCHED", "1", 1
-0001e2d0: 293b 0a7d 0a22 2222 0a0a 0a64 6566 2067  );.}."""...def g
-0001e2e0: 6574 5f70 6174 6368 5f61 7466 6f72 6b5f  et_patch_atfork_
-0001e2f0: 6c69 6228 293a 0a20 2020 2022 2222 0a20  lib():.    """. 
-0001e300: 2020 203a 7265 7475 726e 3a20 7061 7468     :return: path
-0001e310: 2074 6f20 6f75 7220 7061 7463 685f 6174   to our patch_at
-0001e320: 666f 726b 206c 6962 2e20 7365 6520 3a66  fork lib. see :f
-0001e330: 756e 633a 606d 6179 6265 5f72 6573 7461  unc:`maybe_resta
-0001e340: 7274 5f72 6574 7572 6e6e 5f77 6974 685f  rt_returnn_with_
-0001e350: 6174 666f 726b 5f70 6174 6368 600a 2020  atfork_patch`.  
-0001e360: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
-0001e370: 2020 2222 220a 2020 2020 6e61 7469 7665    """.    native
-0001e380: 203d 204e 6174 6976 6543 6f64 6543 6f6d   = NativeCodeCom
-0001e390: 7069 6c65 7228 6261 7365 5f6e 616d 653d  piler(base_name=
-0001e3a0: 2270 6174 6368 5f61 7466 6f72 6b22 2c20  "patch_atfork", 
-0001e3b0: 636f 6465 5f76 6572 7369 6f6e 3d32 2c20  code_version=2, 
-0001e3c0: 636f 6465 3d5f 635f 636f 6465 5f70 6174  code=_c_code_pat
-0001e3d0: 6368 5f61 7466 6f72 6b2c 2069 735f 6370  ch_atfork, is_cp
-0001e3e0: 703d 4661 6c73 6529 0a20 2020 2066 6e20  p=False).    fn 
-0001e3f0: 3d20 6e61 7469 7665 2e67 6574 5f6c 6962  = native.get_lib
-0001e400: 5f66 696c 656e 616d 6528 290a 2020 2020  _filename().    
-0001e410: 7265 7475 726e 2066 6e0a 0a0a 6465 6620  return fn...def 
-0001e420: 7265 7374 6172 745f 7265 7475 726e 6e28  restart_returnn(
-0001e430: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
-0001e440: 6573 7461 7274 7320 5245 5455 524e 4e2e  estarts RETURNN.
-0001e450: 0a20 2020 2022 2222 0a20 2020 206c 6f67  .    """.    log
-0001e460: 2e66 6c75 7368 2829 0a20 2020 2073 7973  .flush().    sys
-0001e470: 2e73 7464 6f75 742e 666c 7573 6828 290a  .stdout.flush().
-0001e480: 2020 2020 7379 732e 7374 6465 7272 2e66      sys.stderr.f
-0001e490: 6c75 7368 2829 0a20 2020 2023 2068 7474  lush().    # htt
-0001e4a0: 7073 3a2f 2f73 7461 636b 6f76 6572 666c  ps://stackoverfl
-0001e4b0: 6f77 2e63 6f6d 2f71 7565 7374 696f 6e73  ow.com/questions
-0001e4c0: 2f37 3233 3335 3930 342f 7369 6d70 6c65  /72335904/simple
-0001e4d0: 2d77 6179 2d74 6f2d 7265 7374 6172 742d  -way-to-restart-
-0001e4e0: 6170 706c 6963 6174 696f 6e0a 2020 2020  application.    
-0001e4f0: 636c 6f73 655f 616c 6c5f 6664 735f 6578  close_all_fds_ex
-0001e500: 6365 7074 287b 302c 2031 2c20 327d 290a  cept({0, 1, 2}).
-0001e510: 2020 2020 6f73 2e65 7865 6376 2873 7973      os.execv(sys
-0001e520: 2e65 7865 6375 7461 626c 652c 205b 7379  .executable, [sy
-0001e530: 732e 6578 6563 7574 6162 6c65 5d20 2b20  s.executable] + 
-0001e540: 7379 732e 6172 6776 290a 2020 2020 7261  sys.argv).    ra
-0001e550: 6973 6520 4578 6365 7074 696f 6e28 2272  ise Exception("r
-0001e560: 6573 7461 7274 5f72 6574 7572 6e6e 3a20  estart_returnn: 
-0001e570: 6578 6563 7620 6661 696c 6564 2229 0a0a  execv failed")..
-0001e580: 0a64 6566 206d 6179 6265 5f72 6573 7461  .def maybe_resta
-0001e590: 7274 5f72 6574 7572 6e6e 5f77 6974 685f  rt_returnn_with_
-0001e5a0: 6174 666f 726b 5f70 6174 6368 2829 3a0a  atfork_patch():.
-0001e5b0: 2020 2020 2222 220a 2020 2020 5768 6174      """.    What
-0001e5c0: 2077 6520 7761 6e74 3a20 7375 6270 726f   we want: subpro
-0001e5d0: 6365 7373 2e50 6f70 656e 2074 6f20 616c  cess.Popen to al
-0001e5e0: 7761 7973 2077 6f72 6b2e 0a20 2020 2050  ways work..    P
-0001e5f0: 726f 626c 656d 3a20 4974 2075 7365 7320  roblem: It uses 
-0001e600: 666f 726b 2b65 7865 6320 696e 7465 726e  fork+exec intern
-0001e610: 616c 6c79 2069 6e20 7375 6270 726f 6365  ally in subproce
-0001e620: 7373 5f66 6f72 6b5f 6578 6563 2c20 7669  ss_fork_exec, vi
-0001e630: 6120 5f70 6f73 6978 7375 6270 726f 6365  a _posixsubproce
-0001e640: 7373 2e66 6f72 6b5f 6578 6563 2e0a 2020  ss.fork_exec..  
-0001e650: 2020 5468 6174 2069 7320 6120 7072 6f62    That is a prob
-0001e660: 6c65 6d20 6265 6361 7573 6520 666f 726b  lem because fork
-0001e670: 2063 616e 2074 7269 6767 6572 2061 6e79   can trigger any
-0001e680: 2061 7466 6f72 6b20 6861 6e64 6c65 7273   atfork handlers
-0001e690: 2072 6567 6973 7465 7265 6420 7669 6120   registered via 
-0001e6a0: 7074 6872 6561 645f 6174 666f 726b 2c0a  pthread_atfork,.
-0001e6b0: 2020 2020 616e 6420 7468 6f73 6520 6361      and those ca
-0001e6c0: 6e20 6372 6173 682f 6465 6164 6c6f 636b  n crash/deadlock
-0001e6d0: 2069 6e20 736f 6d65 2063 6173 6573 2e0a   in some cases..
-0001e6e0: 0a20 2020 2068 7474 7073 3a2f 2f67 6974  .    https://git
-0001e6f0: 6875 622e 636f 6d2f 7465 6e73 6f72 666c  hub.com/tensorfl
-0001e700: 6f77 2f74 656e 736f 7266 6c6f 772f 6973  ow/tensorflow/is
-0001e710: 7375 6573 2f31 3338 3032 0a20 2020 2068  sues/13802.    h
-0001e720: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-0001e730: 6d2f 7869 616e 7969 2f4f 7065 6e42 4c41  m/xianyi/OpenBLA
-0001e740: 532f 6973 7375 6573 2f32 3430 0a20 2020  S/issues/240.   
-0001e750: 2068 7474 7073 3a2f 2f74 7261 632e 7361   https://trac.sa
-0001e760: 6765 6d61 7468 2e6f 7267 2f74 6963 6b65  gemath.org/ticke
-0001e770: 742f 3232 3032 310a 2020 2020 6874 7470  t/22021.    http
-0001e780: 733a 2f2f 6275 6773 2e70 7974 686f 6e2e  s://bugs.python.
-0001e790: 6f72 672f 6973 7375 6533 3138 3134 0a20  org/issue31814. 
-0001e7a0: 2020 2068 7474 7073 3a2f 2f73 7461 636b     https://stack
-0001e7b0: 6f76 6572 666c 6f77 2e63 6f6d 2f71 7565  overflow.com/que
-0001e7c0: 7374 696f 6e73 2f34 3638 3435 3439 362f  stions/46845496/
-0001e7d0: 6c64 2d70 7265 6c6f 6164 2d61 6e64 2d6c  ld-preload-and-l
-0001e7e0: 696e 6b61 6765 0a20 2020 2068 7474 7073  inkage.    https
-0001e7f0: 3a2f 2f73 7461 636b 6f76 6572 666c 6f77  ://stackoverflow
-0001e800: 2e63 6f6d 2f71 7565 7374 696f 6e73 2f34  .com/questions/4
-0001e810: 3638 3130 3539 372f 666f 726b 6578 6563  6810597/forkexec
-0001e820: 2d77 6974 686f 7574 2d61 7466 6f72 6b2d  -without-atfork-
-0001e830: 6861 6e64 6c65 7273 0a0a 2020 2020 5468  handlers..    Th
-0001e840: 6520 736f 6c75 7469 6f6e 2068 6572 653a  e solution here:
-0001e850: 204a 7573 7420 6f76 6572 7269 6465 2070   Just override p
-0001e860: 7468 7265 6164 5f61 7466 6f72 6b2c 2076  thread_atfork, v
-0001e870: 6961 204c 445f 5052 454c 4f41 442e 0a20  ia LD_PRELOAD.. 
-0001e880: 2020 204e 6f74 6520 7468 6174 2069 6e20     Note that in 
-0001e890: 736f 6d65 2063 6173 6573 2c20 7468 6973  some cases, this
-0001e8a0: 2069 7320 6e6f 7420 656e 6f75 6768 2028   is not enough (
-0001e8b0: 7365 6520 7468 6520 534f 2064 6973 6375  see the SO discu
-0001e8c0: 7373 696f 6e29 2c0a 2020 2020 736f 2077  ssion),.    so w
-0001e8d0: 6520 616c 736f 206f 7665 7277 7269 7465  e also overwrite
-0001e8e0: 2066 6f72 6b20 6974 7365 6c66 2e0a 2020   fork itself..  
-0001e8f0: 2020 5365 6520 616c 736f 2074 6573 7473    See also tests
-0001e900: 2f74 6573 745f 666f 726b 5f65 7865 632e  /test_fork_exec.
-0001e910: 7079 2066 6f72 2061 2064 656d 6f2e 0a20  py for a demo.. 
-0001e920: 2020 2022 2222 0a20 2020 2069 6620 6f73     """.    if os
-0001e930: 2e65 6e76 6972 6f6e 2e67 6574 2822 5f5f  .environ.get("__
-0001e940: 5245 5455 524e 4e5f 4154 464f 524b 5f50  RETURNN_ATFORK_P
-0001e950: 4154 4348 4544 2229 203d 3d20 2231 223a  ATCHED") == "1":
-0001e960: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-0001e970: 5275 6e6e 696e 6720 7769 7468 2070 6174  Running with pat
-0001e980: 6368 6564 2061 7466 6f72 6b2e 2229 0a20  ched atfork."). 
-0001e990: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-0001e9a0: 2020 6966 206f 732e 656e 7669 726f 6e2e    if os.environ.
-0001e9b0: 6765 7428 225f 5f52 4554 5552 4e4e 5f54  get("__RETURNN_T
-0001e9c0: 5259 5f41 5446 4f52 4b5f 5041 5443 4845  RY_ATFORK_PATCHE
-0001e9d0: 4422 2920 3d3d 2022 3122 3a0a 2020 2020  D") == "1":.    
-0001e9e0: 2020 2020 7072 696e 7428 2250 6174 6368      print("Patch
-0001e9f0: 696e 6720 6174 666f 726b 2064 6964 206e  ing atfork did n
-0001ea00: 6f74 2077 6f72 6b21 2057 696c 6c20 636f  ot work! Will co
-0001ea10: 6e74 696e 7565 2061 6e79 7761 792e 2229  ntinue anyway.")
-0001ea20: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
-0001ea30: 2020 2020 6c69 6220 3d20 6765 745f 7061      lib = get_pa
-0001ea40: 7463 685f 6174 666f 726b 5f6c 6962 2829  tch_atfork_lib()
-0001ea50: 0a20 2020 2065 6e76 203d 206f 732e 656e  .    env = os.en
-0001ea60: 7669 726f 6e2e 636f 7079 2829 0a20 2020  viron.copy().   
-0001ea70: 2065 6e76 5b22 4459 4c44 5f49 4e53 4552   env["DYLD_INSER
-0001ea80: 545f 4c49 4252 4152 4945 5322 2069 6620  T_LIBRARIES" if 
-0001ea90: 7379 732e 706c 6174 666f 726d 203d 3d20  sys.platform == 
-0001eaa0: 2264 6172 7769 6e22 2065 6c73 6520 224c  "darwin" else "L
-0001eab0: 445f 5052 454c 4f41 4422 5d20 3d20 6c69  D_PRELOAD"] = li
-0001eac0: 620a 2020 2020 656e 765b 225f 5f52 4554  b.    env["__RET
-0001ead0: 5552 4e4e 5f54 5259 5f41 5446 4f52 4b5f  URNN_TRY_ATFORK_
-0001eae0: 5041 5443 4845 4422 5d20 3d20 2231 220a  PATCHED"] = "1".
-0001eaf0: 2020 2020 7072 696e 7428 2252 6573 7461      print("Resta
-0001eb00: 7274 696e 6720 5265 7475 726e 6e20 7769  rting Returnn wi
-0001eb10: 7468 2061 7466 6f72 6b20 7061 7463 682e  th atfork patch.
-0001eb20: 2e2e 222c 2073 7973 2e65 7865 6375 7461  ..", sys.executa
-0001eb30: 626c 652c 2073 7973 2e61 7267 7629 0a20  ble, sys.argv). 
-0001eb40: 2020 2073 7973 2e73 7464 6f75 742e 666c     sys.stdout.fl
-0001eb50: 7573 6828 290a 2020 2020 6f73 2e65 7865  ush().    os.exe
-0001eb60: 6376 7065 2873 7973 2e65 7865 6375 7461  cvpe(sys.executa
-0001eb70: 626c 652c 205b 7379 732e 6578 6563 7574  ble, [sys.execut
-0001eb80: 6162 6c65 5d20 2b20 7379 732e 6172 6776  able] + sys.argv
-0001eb90: 2c20 656e 7629 0a20 2020 2070 7269 6e74  , env).    print
-0001eba0: 2822 6578 6563 7670 6520 6469 6420 6e6f  ("execvpe did no
-0001ebb0: 7420 776f 726b 3f22 290a 0a0a 6465 6620  t work?")...def 
-0001ebc0: 636c 6f73 655f 616c 6c5f 6664 735f 6578  close_all_fds_ex
-0001ebd0: 6365 7074 2865 7863 6570 745f 6664 7329  cept(except_fds)
-0001ebe0: 3a0a 2020 2020 2222 220a 2020 2020 4361  :.    """.    Ca
-0001ebf0: 6c6c 7320 6f73 2e63 6c6f 7365 7261 6e67  lls os.closerang
-0001ec00: 6520 6578 6365 7074 2066 6f72 2074 6865  e except for the
-0001ec10: 2067 6976 656e 2066 6473 2e0a 2020 2020   given fds..    
-0001ec20: 436f 6465 2061 646f 7074 6564 2061 6e64  Code adopted and
-0001ec30: 2065 7874 656e 6465 6420 6672 6f6d 206d   extended from m
-0001ec40: 756c 7469 7072 6f63 6573 7369 6e67 2e75  ultiprocessing.u
-0001ec50: 7469 6c2e 636c 6f73 655f 616c 6c5f 6664  til.close_all_fd
-0001ec60: 735f 6578 6365 7074 2e0a 0a20 2020 203a  s_except...    :
-0001ec70: 7061 7261 6d20 7479 7069 6e67 2e43 6f6c  param typing.Col
-0001ec80: 6c65 6374 696f 6e5b 696e 745d 2065 7863  lection[int] exc
-0001ec90: 6570 745f 6664 733a 2075 7375 616c 6c79  ept_fds: usually
-0001eca0: 2061 7420 6c65 6173 7420 7b30 2c31 2c32   at least {0,1,2
-0001ecb0: 7d0a 2020 2020 2222 220a 2020 2020 2320  }.    """.    # 
-0001ecc0: 6e6f 696e 7370 6563 7469 6f6e 2050 7942  noinspection PyB
-0001ecd0: 726f 6164 4578 6365 7074 696f 6e0a 2020  roadException.  
-0001ece0: 2020 7472 793a 0a20 2020 2020 2020 206d    try:.        m
-0001ecf0: 6178 5f66 6420 3d20 6f73 2e73 7973 636f  ax_fd = os.sysco
-0001ed00: 6e66 2822 5343 5f4f 5045 4e5f 4d41 5822  nf("SC_OPEN_MAX"
-0001ed10: 290a 2020 2020 6578 6365 7074 2045 7863  ).    except Exc
-0001ed20: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-0001ed30: 6d61 785f 6664 203d 2032 3536 0a0a 2020  max_fd = 256..  
-0001ed40: 2020 6578 6365 7074 5f66 6473 203d 2073    except_fds = s
-0001ed50: 6f72 7465 6428 6c69 7374 2865 7863 6570  orted(list(excep
-0001ed60: 745f 6664 7329 202b 205b 2d31 2c20 6d61  t_fds) + [-1, ma
-0001ed70: 785f 6664 5d29 0a20 2020 2061 7373 6572  x_fd]).    asser
-0001ed80: 7420 6578 6365 7074 5f66 6473 5b30 5d20  t except_fds[0] 
-0001ed90: 3d3d 202d 3120 616e 6420 6578 6365 7074  == -1 and except
-0001eda0: 5f66 6473 5b2d 315d 203d 3d20 6d61 785f  _fds[-1] == max_
-0001edb0: 6664 2c20 2266 6420 696e 7661 6c69 6422  fd, "fd invalid"
-0001edc0: 0a0a 2020 2020 666f 7220 6920 696e 2072  ..    for i in r
-0001edd0: 616e 6765 286c 656e 2865 7863 6570 745f  ange(len(except_
-0001ede0: 6664 7329 202d 2031 293a 0a20 2020 2020  fds) - 1):.     
-0001edf0: 2020 2069 6620 6578 6365 7074 5f66 6473     if except_fds
-0001ee00: 5b69 5d20 2b20 3120 3c20 6578 6365 7074  [i] + 1 < except
-0001ee10: 5f66 6473 5b69 202b 2031 5d3a 0a20 2020  _fds[i + 1]:.   
-0001ee20: 2020 2020 2020 2020 206f 732e 636c 6f73           os.clos
-0001ee30: 6572 616e 6765 2865 7863 6570 745f 6664  erange(except_fd
-0001ee40: 735b 695d 202b 2031 2c20 6578 6365 7074  s[i] + 1, except
-0001ee50: 5f66 6473 5b69 202b 2031 5d29 0a0a 0a63  _fds[i + 1])...c
-0001ee60: 6c61 7373 2053 7461 7473 3a0a 2020 2020  lass Stats:.    
-0001ee70: 2222 220a 2020 2020 436f 6c6c 6563 7473  """.    Collects
-0001ee80: 206d 6561 6e20 616e 6420 7661 7269 616e   mean and varian
-0001ee90: 6365 2c20 7275 6e6e 696e 6720 6176 6572  ce, running aver
-0001eea0: 6167 652e 0a0a 2020 2020 6874 7470 733a  age...    https:
-0001eeb0: 2f2f 656e 2e77 696b 6970 6564 6961 2e6f  //en.wikipedia.o
-0001eec0: 7267 2f77 696b 692f 416c 676f 7269 7468  rg/wiki/Algorith
-0001eed0: 6d73 5f66 6f72 5f63 616c 6375 6c61 7469  ms_for_calculati
-0001eee0: 6e67 5f76 6172 6961 6e63 650a 2020 2020  ng_variance.    
-0001eef0: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-0001ef00: 6e69 745f 5f28 7365 6c66 2c20 666f 726d  nit__(self, form
-0001ef10: 6174 5f73 7472 3d4e 6f6e 6529 3a0a 2020  at_str=None):.  
-0001ef20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001ef30: 2020 3a70 6172 616d 204e 6f6e 657c 2828    :param None|((
-0001ef40: 666c 6f61 747c 6e75 6d70 792e 6e64 6172  float|numpy.ndar
-0001ef50: 7261 7929 2d3e 7374 7229 2066 6f72 6d61  ray)->str) forma
-0001ef60: 745f 7374 723a 0a20 2020 2020 2020 2022  t_str:.        "
-0001ef70: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-0001ef80: 666f 726d 6174 5f73 7472 203d 2066 6f72  format_str = for
-0001ef90: 6d61 745f 7374 7220 6f72 2073 7472 0a20  mat_str or str. 
-0001efa0: 2020 2020 2020 2073 656c 662e 6d65 616e         self.mean
-0001efb0: 203d 2030 2e30 0a20 2020 2020 2020 2073   = 0.0.        s
-0001efc0: 656c 662e 6d65 616e 5f73 7120 3d20 302e  elf.mean_sq = 0.
-0001efd0: 300a 2020 2020 2020 2020 7365 6c66 2e76  0.        self.v
-0001efe0: 6172 203d 2030 2e30 0a20 2020 2020 2020  ar = 0.0.       
-0001eff0: 2073 656c 662e 6d69 6e20 3d20 4e6f 6e65   self.min = None
-0001f000: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
-0001f010: 7820 3d20 4e6f 6e65 0a20 2020 2020 2020  x = None.       
-0001f020: 2073 656c 662e 746f 7461 6c5f 6461 7461   self.total_data
-0001f030: 5f6c 656e 203d 2030 0a20 2020 2020 2020  _len = 0.       
-0001f040: 2073 656c 662e 6e75 6d5f 7365 7173 203d   self.num_seqs =
-0001f050: 2030 0a0a 2020 2020 6465 6620 5f5f 7374   0..    def __st
-0001f060: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-0001f070: 2020 2069 6620 7365 6c66 2e6e 756d 5f73     if self.num_s
-0001f080: 6571 7320 3e20 303a 0a20 2020 2020 2020  eqs > 0:.       
-0001f090: 2020 2020 2069 6620 7365 6c66 2e6e 756d       if self.num
-0001f0a0: 5f73 6571 7320 3d3d 2073 656c 662e 746f  _seqs == self.to
-0001f0b0: 7461 6c5f 6461 7461 5f6c 656e 3a0a 2020  tal_data_len:.  
-0001f0c0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0001f0d0: 7472 615f 7374 7220 3d20 2261 7667 5f64  tra_str = "avg_d
-0001f0e0: 6174 615f 6c65 6e3d 3122 0a20 2020 2020  ata_len=1".     
-0001f0f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001f100: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-0001f110: 7261 5f73 7472 203d 2022 746f 7461 6c5f  ra_str = "total_
-0001f120: 6461 7461 5f6c 656e 3d25 692c 2061 7667  data_len=%i, avg
-0001f130: 5f64 6174 615f 6c65 6e3d 2566 2220 2520  _data_len=%f" % 
-0001f140: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001f150: 2020 2020 2020 7365 6c66 2e74 6f74 616c        self.total
-0001f160: 5f64 6174 615f 6c65 6e2c 0a20 2020 2020  _data_len,.     
-0001f170: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001f180: 6c6f 6174 2873 656c 662e 746f 7461 6c5f  loat(self.total_
-0001f190: 6461 7461 5f6c 656e 2920 2f20 7365 6c66  data_len) / self
-0001f1a0: 2e6e 756d 5f73 6571 732c 0a20 2020 2020  .num_seqs,.     
-0001f1b0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001f1c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001f1d0: 2253 7461 7473 286d 6561 6e3d 2573 2c20  "Stats(mean=%s, 
-0001f1e0: 7374 645f 6465 763d 2573 2c20 6d69 6e3d  std_dev=%s, min=
-0001f1f0: 2573 2c20 6d61 783d 2573 2c20 6e75 6d5f  %s, max=%s, num_
-0001f200: 7365 7173 3d25 692c 2025 7329 2220 2520  seqs=%i, %s)" % 
-0001f210: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001f220: 2020 7365 6c66 2e66 6f72 6d61 745f 7374    self.format_st
-0001f230: 7228 7365 6c66 2e67 6574 5f6d 6561 6e28  r(self.get_mean(
-0001f240: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-0001f250: 2020 2020 7365 6c66 2e66 6f72 6d61 745f      self.format_
-0001f260: 7374 7228 7365 6c66 2e67 6574 5f73 7464  str(self.get_std
-0001f270: 5f64 6576 2829 292c 0a20 2020 2020 2020  _dev()),.       
-0001f280: 2020 2020 2020 2020 2073 656c 662e 666f           self.fo
-0001f290: 726d 6174 5f73 7472 2873 656c 662e 6d69  rmat_str(self.mi
-0001f2a0: 6e29 2c0a 2020 2020 2020 2020 2020 2020  n),.            
-0001f2b0: 2020 2020 7365 6c66 2e66 6f72 6d61 745f      self.format_
-0001f2c0: 7374 7228 7365 6c66 2e6d 6178 292c 0a20  str(self.max),. 
-0001f2d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001f2e0: 656c 662e 6e75 6d5f 7365 7173 2c0a 2020  elf.num_seqs,.  
-0001f2f0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0001f300: 7472 615f 7374 722c 0a20 2020 2020 2020  tra_str,.       
-0001f310: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-0001f320: 6574 7572 6e20 2253 7461 7473 286e 756d  eturn "Stats(num
-0001f330: 5f73 6571 733d 3029 220a 0a20 2020 2064  _seqs=0)"..    d
-0001f340: 6566 2063 6f6c 6c65 6374 2873 656c 662c  ef collect(self,
-0001f350: 2064 6174 6129 3a0a 2020 2020 2020 2020   data):.        
-0001f360: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
-0001f370: 616d 206e 756d 7079 2e6e 6461 7272 6179  am numpy.ndarray
-0001f380: 7c6c 6973 745b 696e 745d 7c6c 6973 745b  |list[int]|list[
-0001f390: 666c 6f61 745d 2064 6174 613a 2073 6861  float] data: sha
-0001f3a0: 7065 2028 7469 6d65 2c20 6469 6d29 206f  pe (time, dim) o
-0001f3b0: 7220 2874 696d 652c 290a 2020 2020 2020  r (time,).      
-0001f3c0: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
-0001f3d0: 706f 7274 206e 756d 7079 0a0a 2020 2020  port numpy..    
-0001f3e0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0001f3f0: 6528 6461 7461 2c20 286c 6973 742c 2074  e(data, (list, t
-0001f400: 7570 6c65 2929 3a0a 2020 2020 2020 2020  uple)):.        
-0001f410: 2020 2020 6461 7461 203d 206e 756d 7079      data = numpy
-0001f420: 2e61 7272 6179 2864 6174 6129 0a20 2020  .array(data).   
-0001f430: 2020 2020 2061 7373 6572 7420 6973 696e       assert isin
-0001f440: 7374 616e 6365 2864 6174 612c 206e 756d  stance(data, num
-0001f450: 7079 2e6e 6461 7272 6179 290a 2020 2020  py.ndarray).    
-0001f460: 2020 2020 6173 7365 7274 2064 6174 612e      assert data.
-0001f470: 6e64 696d 203e 3d20 310a 2020 2020 2020  ndim >= 1.      
-0001f480: 2020 6966 2064 6174 612e 7368 6170 655b    if data.shape[
-0001f490: 305d 203d 3d20 303a 0a20 2020 2020 2020  0] == 0:.       
-0001f4a0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-0001f4b0: 2020 2020 7365 6c66 2e6e 756d 5f73 6571      self.num_seq
-0001f4c0: 7320 2b3d 2031 0a20 2020 2020 2020 2064  s += 1.        d
-0001f4d0: 6174 615f 6d69 6e20 3d20 6e75 6d70 792e  ata_min = numpy.
-0001f4e0: 6d69 6e28 6461 7461 2c20 6178 6973 3d30  min(data, axis=0
-0001f4f0: 290a 2020 2020 2020 2020 6461 7461 5f6d  ).        data_m
-0001f500: 6178 203d 206e 756d 7079 2e6d 6178 2864  ax = numpy.max(d
-0001f510: 6174 612c 2061 7869 733d 3029 0a20 2020  ata, axis=0).   
-0001f520: 2020 2020 2069 6620 7365 6c66 2e6d 696e       if self.min
-0001f530: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001f540: 2020 2020 2020 7365 6c66 2e6d 696e 203d        self.min =
-0001f550: 2064 6174 615f 6d69 6e0a 2020 2020 2020   data_min.      
-0001f560: 2020 2020 2020 7365 6c66 2e6d 6178 203d        self.max =
-0001f570: 2064 6174 615f 6d61 780a 2020 2020 2020   data_max.      
-0001f580: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001f590: 2020 2020 7365 6c66 2e6d 696e 203d 206e      self.min = n
-0001f5a0: 756d 7079 2e6d 696e 696d 756d 2873 656c  umpy.minimum(sel
-0001f5b0: 662e 6d69 6e2c 2064 6174 615f 6d69 6e29  f.min, data_min)
-0001f5c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001f5d0: 662e 6d61 7820 3d20 6e75 6d70 792e 6d61  f.max = numpy.ma
-0001f5e0: 7869 6d75 6d28 7365 6c66 2e6d 6178 2c20  ximum(self.max, 
-0001f5f0: 6461 7461 5f6d 6178 290a 2020 2020 2020  data_max).      
-0001f600: 2020 6e65 775f 746f 7461 6c5f 6461 7461    new_total_data
-0001f610: 5f6c 656e 203d 2073 656c 662e 746f 7461  _len = self.tota
-0001f620: 6c5f 6461 7461 5f6c 656e 202b 2064 6174  l_data_len + dat
-0001f630: 612e 7368 6170 655b 305d 0a20 2020 2020  a.shape[0].     
-0001f640: 2020 206d 6561 6e5f 6469 6666 203d 206e     mean_diff = n
-0001f650: 756d 7079 2e6d 6561 6e28 6461 7461 2c20  umpy.mean(data, 
-0001f660: 6178 6973 3d30 2920 2d20 7365 6c66 2e6d  axis=0) - self.m
-0001f670: 6561 6e0a 2020 2020 2020 2020 6d5f 6120  ean.        m_a 
-0001f680: 3d20 7365 6c66 2e76 6172 202a 2073 656c  = self.var * sel
-0001f690: 662e 746f 7461 6c5f 6461 7461 5f6c 656e  f.total_data_len
-0001f6a0: 0a20 2020 2020 2020 206d 5f62 203d 206e  .        m_b = n
-0001f6b0: 756d 7079 2e76 6172 2864 6174 612c 2061  umpy.var(data, a
-0001f6c0: 7869 733d 3029 202a 2064 6174 612e 7368  xis=0) * data.sh
-0001f6d0: 6170 655b 305d 0a20 2020 2020 2020 206d  ape[0].        m
-0001f6e0: 3220 3d20 6d5f 6120 2b20 6d5f 6220 2b20  2 = m_a + m_b + 
-0001f6f0: 6d65 616e 5f64 6966 662a 2a32 202a 2073  mean_diff**2 * s
-0001f700: 656c 662e 746f 7461 6c5f 6461 7461 5f6c  elf.total_data_l
-0001f710: 656e 202a 2064 6174 612e 7368 6170 655b  en * data.shape[
-0001f720: 305d 202f 206e 6577 5f74 6f74 616c 5f64  0] / new_total_d
-0001f730: 6174 615f 6c65 6e0a 2020 2020 2020 2020  ata_len.        
-0001f740: 7365 6c66 2e76 6172 203d 206d 3220 2f20  self.var = m2 / 
-0001f750: 6e65 775f 746f 7461 6c5f 6461 7461 5f6c  new_total_data_l
-0001f760: 656e 0a20 2020 2020 2020 2064 6174 615f  en.        data_
-0001f770: 7375 6d20 3d20 6e75 6d70 792e 7375 6d28  sum = numpy.sum(
-0001f780: 6461 7461 2c20 6178 6973 3d30 290a 2020  data, axis=0).  
-0001f790: 2020 2020 2020 6465 6c74 6120 3d20 6461        delta = da
-0001f7a0: 7461 5f73 756d 202d 2073 656c 662e 6d65  ta_sum - self.me
-0001f7b0: 616e 202a 2064 6174 612e 7368 6170 655b  an * data.shape[
-0001f7c0: 305d 0a20 2020 2020 2020 2073 656c 662e  0].        self.
-0001f7d0: 6d65 616e 202b 3d20 6465 6c74 6120 2f20  mean += delta / 
-0001f7e0: 6e65 775f 746f 7461 6c5f 6461 7461 5f6c  new_total_data_l
-0001f7f0: 656e 0a20 2020 2020 2020 2064 656c 7461  en.        delta
-0001f800: 5f73 7120 3d20 6e75 6d70 792e 7375 6d28  _sq = numpy.sum(
-0001f810: 6461 7461 202a 2064 6174 612c 2061 7869  data * data, axi
-0001f820: 733d 3029 202d 2073 656c 662e 6d65 616e  s=0) - self.mean
-0001f830: 5f73 7120 2a20 6461 7461 2e73 6861 7065  _sq * data.shape
-0001f840: 5b30 5d0a 2020 2020 2020 2020 7365 6c66  [0].        self
-0001f850: 2e6d 6561 6e5f 7371 202b 3d20 6465 6c74  .mean_sq += delt
-0001f860: 615f 7371 202f 206e 6577 5f74 6f74 616c  a_sq / new_total
-0001f870: 5f64 6174 615f 6c65 6e0a 2020 2020 2020  _data_len.      
-0001f880: 2020 7365 6c66 2e74 6f74 616c 5f64 6174    self.total_dat
-0001f890: 615f 6c65 6e20 3d20 6e65 775f 746f 7461  a_len = new_tota
-0001f8a0: 6c5f 6461 7461 5f6c 656e 0a0a 2020 2020  l_data_len..    
-0001f8b0: 6465 6620 6765 745f 6d65 616e 2873 656c  def get_mean(sel
-0001f8c0: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-0001f8d0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0001f8e0: 206d 6561 6e2c 2073 6861 7065 2028 6469   mean, shape (di
-0001f8f0: 6d2c 290a 2020 2020 2020 2020 3a72 7479  m,).        :rty
-0001f900: 7065 3a20 6e75 6d70 792e 6e64 6172 7261  pe: numpy.ndarra
-0001f910: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
-0001f920: 2020 2020 2020 6173 7365 7274 2073 656c        assert sel
-0001f930: 662e 6e75 6d5f 7365 7173 203e 2030 0a20  f.num_seqs > 0. 
-0001f940: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001f950: 6c66 2e6d 6561 6e0a 0a20 2020 2064 6566  lf.mean..    def
-0001f960: 2067 6574 5f73 7464 5f64 6576 2873 656c   get_std_dev(sel
-0001f970: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-0001f980: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0001f990: 2073 7464 2064 6576 2c20 7368 6170 6520   std dev, shape 
-0001f9a0: 2864 696d 2c29 0a20 2020 2020 2020 203a  (dim,).        :
-0001f9b0: 7274 7970 653a 206e 756d 7079 2e6e 6461  rtype: numpy.nda
-0001f9c0: 7272 6179 0a20 2020 2020 2020 2022 2222  rray.        """
-0001f9d0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-0001f9e0: 6e75 6d70 790a 0a20 2020 2020 2020 2061  numpy..        a
-0001f9f0: 7373 6572 7420 7365 6c66 2e6e 756d 5f73  ssert self.num_s
-0001fa00: 6571 7320 3e20 300a 2020 2020 2020 2020  eqs > 0.        
-0001fa10: 7265 7475 726e 206e 756d 7079 2e73 7172  return numpy.sqr
-0001fa20: 7428 7365 6c66 2e76 6172 290a 2020 2020  t(self.var).    
-0001fa30: 2020 2020 2320 7265 7475 726e 206e 756d      # return num
-0001fa40: 7079 2e73 7172 7428 7365 6c66 2e6d 6561  py.sqrt(self.mea
-0001fa50: 6e5f 7371 202d 2073 656c 662e 6d65 616e  n_sq - self.mean
-0001fa60: 202a 2073 656c 662e 6d65 616e 290a 0a20   * self.mean).. 
-0001fa70: 2020 2064 6566 2064 756d 7028 7365 6c66     def dump(self
-0001fa80: 2c20 6f75 7470 7574 5f66 696c 655f 7072  , output_file_pr
-0001fa90: 6566 6978 3d4e 6f6e 652c 2073 7472 6561  efix=None, strea
-0001faa0: 6d3d 4e6f 6e65 2c20 7374 7265 616d 5f70  m=None, stream_p
-0001fab0: 7265 6669 783d 2222 293a 0a20 2020 2020  refix=""):.     
-0001fac0: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
-0001fad0: 7061 7261 6d20 7374 727c 4e6f 6e65 206f  param str|None o
-0001fae0: 7574 7075 745f 6669 6c65 5f70 7265 6669  utput_file_prefi
-0001faf0: 783a 2069 6620 6769 7665 6e2c 2077 696c  x: if given, wil
-0001fb00: 6c20 6e75 6d70 792e 7361 7665 7478 7420  l numpy.savetxt 
-0001fb10: 6d65 616e 7c73 7464 5f64 6576 2074 6f20  mean|std_dev to 
-0001fb20: 6469 736b 0a20 2020 2020 2020 203a 7061  disk.        :pa
-0001fb30: 7261 6d20 7374 7220 7374 7265 616d 5f70  ram str stream_p
-0001fb40: 7265 6669 783a 0a20 2020 2020 2020 203a  refix:.        :
-0001fb50: 7061 7261 6d20 696f 2e54 6578 7449 4f42  param io.TextIOB
-0001fb60: 6173 6520 7374 7265 616d 3a20 7379 732e  ase stream: sys.
-0001fb70: 7374 646f 7574 2062 7920 6465 6661 756c  stdout by defaul
-0001fb80: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
-0001fb90: 2020 2020 2020 6966 2073 7472 6561 6d20        if stream 
-0001fba0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0001fbb0: 2020 2020 2073 7472 6561 6d20 3d20 7379       stream = sy
-0001fbc0: 732e 7374 646f 7574 0a20 2020 2020 2020  s.stdout.       
-0001fbd0: 2069 6d70 6f72 7420 6e75 6d70 790a 0a20   import numpy.. 
-0001fbe0: 2020 2020 2020 2070 7269 6e74 2822 2573         print("%s
-0001fbf0: 5374 6174 733a 2220 2520 7374 7265 616d  Stats:" % stream
-0001fc00: 5f70 7265 6669 782c 2066 696c 653d 7374  _prefix, file=st
-0001fc10: 7265 616d 290a 2020 2020 2020 2020 6966  ream).        if
-0001fc20: 2073 656c 662e 6e75 6d5f 7365 7173 2021   self.num_seqs !
-0001fc30: 3d20 7365 6c66 2e74 6f74 616c 5f64 6174  = self.total_dat
-0001fc40: 615f 6c65 6e3a 0a20 2020 2020 2020 2020  a_len:.         
-0001fc50: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-0001fc60: 2020 2020 2020 2020 2020 2220 2025 6920            "  %i 
-0001fc70: 7365 7173 2c20 2569 2074 6f74 616c 2066  seqs, %i total f
-0001fc80: 7261 6d65 732c 2025 6620 6176 6572 6167  rames, %f averag
-0001fc90: 6520 6672 616d 6573 220a 2020 2020 2020  e frames".      
-0001fca0: 2020 2020 2020 2020 2020 2520 2873 656c            % (sel
-0001fcb0: 662e 6e75 6d5f 7365 7173 2c20 7365 6c66  f.num_seqs, self
-0001fcc0: 2e74 6f74 616c 5f64 6174 615f 6c65 6e2c  .total_data_len,
-0001fcd0: 2073 656c 662e 746f 7461 6c5f 6461 7461   self.total_data
-0001fce0: 5f6c 656e 202f 2066 6c6f 6174 2873 656c  _len / float(sel
-0001fcf0: 662e 6e75 6d5f 7365 7173 2929 2c0a 2020  f.num_seqs)),.  
-0001fd00: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0001fd10: 6c65 3d73 7472 6561 6d2c 0a20 2020 2020  le=stream,.     
-0001fd20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001fd30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001fd40: 2020 2070 7269 6e74 2822 2020 2569 2073     print("  %i s
-0001fd50: 6571 7322 2025 2028 7365 6c66 2e6e 756d  eqs" % (self.num
-0001fd60: 5f73 6571 732c 292c 2066 696c 653d 7374  _seqs,), file=st
-0001fd70: 7265 616d 290a 2020 2020 2020 2020 7072  ream).        pr
-0001fd80: 696e 7428 2220 204d 6561 6e3a 2025 7322  int("  Mean: %s"
-0001fd90: 2025 2028 7365 6c66 2e66 6f72 6d61 745f   % (self.format_
-0001fda0: 7374 7228 7365 6c66 2e67 6574 5f6d 6561  str(self.get_mea
-0001fdb0: 6e28 2929 2c29 2c20 6669 6c65 3d73 7472  n()),), file=str
-0001fdc0: 6561 6d29 0a20 2020 2020 2020 2070 7269  eam).        pri
-0001fdd0: 6e74 2822 2020 5374 6420 6465 763a 2025  nt("  Std dev: %
-0001fde0: 7322 2025 2028 7365 6c66 2e66 6f72 6d61  s" % (self.forma
-0001fdf0: 745f 7374 7228 7365 6c66 2e67 6574 5f73  t_str(self.get_s
-0001fe00: 7464 5f64 6576 2829 292c 292c 2066 696c  td_dev()),), fil
-0001fe10: 653d 7374 7265 616d 290a 2020 2020 2020  e=stream).      
-0001fe20: 2020 7072 696e 7428 2220 204d 696e 2f6d    print("  Min/m
-0001fe30: 6178 3a20 2573 202f 2025 7322 2025 2028  ax: %s / %s" % (
-0001fe40: 7365 6c66 2e66 6f72 6d61 745f 7374 7228  self.format_str(
-0001fe50: 7365 6c66 2e6d 696e 292c 2073 656c 662e  self.min), self.
-0001fe60: 666f 726d 6174 5f73 7472 2873 656c 662e  format_str(self.
-0001fe70: 6d61 7829 292c 2066 696c 653d 7374 7265  max)), file=stre
-0001fe80: 616d 290a 2020 2020 2020 2020 2320 7072  am).        # pr
-0001fe90: 696e 7428 2253 7464 2064 6576 2028 6e61  int("Std dev (na
-0001fea0: 6976 6529 3a20 2573 2220 2520 6e75 6d70  ive): %s" % nump
-0001feb0: 792e 7371 7274 2873 656c 662e 6d65 616e  y.sqrt(self.mean
-0001fec0: 5f73 7120 2d20 7365 6c66 2e6d 6561 6e20  _sq - self.mean 
-0001fed0: 2a20 7365 6c66 2e6d 6561 6e29 2c20 6669  * self.mean), fi
-0001fee0: 6c65 3d73 7472 6561 6d29 0a20 2020 2020  le=stream).     
-0001fef0: 2020 2069 6620 6f75 7470 7574 5f66 696c     if output_fil
-0001ff00: 655f 7072 6566 6978 3a0a 2020 2020 2020  e_prefix:.      
-0001ff10: 2020 2020 2020 7072 696e 7428 2220 2057        print("  W
-0001ff20: 7269 7465 206d 6561 6e2f 7374 642d 6465  rite mean/std-de
-0001ff30: 7620 746f 2025 732e 286d 6561 6e7c 7374  v to %s.(mean|st
-0001ff40: 645f 6465 7629 2e74 7874 2e22 2025 2028  d_dev).txt." % (
-0001ff50: 6f75 7470 7574 5f66 696c 655f 7072 6566  output_file_pref
-0001ff60: 6978 2c29 2c20 6669 6c65 3d73 7472 6561  ix,), file=strea
-0001ff70: 6d29 0a20 2020 2020 2020 2020 2020 206e  m).            n
-0001ff80: 756d 7079 2e73 6176 6574 7874 2822 2573  umpy.savetxt("%s
-0001ff90: 2e6d 6561 6e2e 7478 7422 2025 206f 7574  .mean.txt" % out
-0001ffa0: 7075 745f 6669 6c65 5f70 7265 6669 782c  put_file_prefix,
-0001ffb0: 2073 656c 662e 6765 745f 6d65 616e 2829   self.get_mean()
-0001ffc0: 290a 2020 2020 2020 2020 2020 2020 6e75  ).            nu
-0001ffd0: 6d70 792e 7361 7665 7478 7428 2225 732e  mpy.savetxt("%s.
-0001ffe0: 7374 645f 6465 762e 7478 7422 2025 206f  std_dev.txt" % o
-0001fff0: 7574 7075 745f 6669 6c65 5f70 7265 6669  utput_file_prefi
-00020000: 782c 2073 656c 662e 6765 745f 7374 645f  x, self.get_std_
-00020010: 6465 7628 2929 0a0a 0a64 6566 2069 735f  dev())...def is_
-00020020: 6e61 6d65 6474 7570 6c65 2863 6c73 293a  namedtuple(cls):
-00020030: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
-00020040: 7261 6d20 5420 636c 733a 2074 7570 6c65  ram T cls: tuple
-00020050: 2c20 6c69 7374 206f 7220 6e61 6d65 6474  , list or namedt
-00020060: 7570 6c65 2074 7970 650a 2020 2020 3a72  uple type.    :r
-00020070: 6574 7572 6e3a 2077 6865 7468 6572 2063  eturn: whether c
-00020080: 6c73 2069 7320 6120 6e61 6d65 6474 7570  ls is a namedtup
-00020090: 6c65 2074 7970 650a 2020 2020 3a72 7479  le type.    :rty
-000200a0: 7065 3a20 626f 6f6c 0a20 2020 2022 2222  pe: bool.    """
-000200b0: 0a20 2020 2072 6574 7572 6e20 6973 7375  .    return issu
-000200c0: 6263 6c61 7373 2863 6c73 2c20 7475 706c  bclass(cls, tupl
-000200d0: 6529 2061 6e64 2063 6c73 2069 7320 6e6f  e) and cls is no
-000200e0: 7420 7475 706c 650a 0a0a 6465 6620 6d61  t tuple...def ma
-000200f0: 6b65 5f73 6571 5f6f 665f 7479 7065 2863  ke_seq_of_type(c
-00020100: 6c73 2c20 7365 7129 3a0a 2020 2020 2222  ls, seq):.    ""
-00020110: 220a 2020 2020 3a70 6172 616d 2074 7970  ".    :param typ
-00020120: 655b 545d 2063 6c73 3a20 652e 672e 2074  e[T] cls: e.g. t
-00020130: 7570 6c65 2c20 6c69 7374 206f 7220 6e61  uple, list or na
-00020140: 6d65 6474 7570 6c65 0a20 2020 203a 7061  medtuple.    :pa
-00020150: 7261 6d20 6c69 7374 7c74 7570 6c65 7c54  ram list|tuple|T
-00020160: 2073 6571 3a0a 2020 2020 3a72 6574 7572   seq:.    :retur
-00020170: 6e3a 2063 6c73 2873 6571 2920 6f72 2063  n: cls(seq) or c
-00020180: 6c73 282a 7365 7129 0a20 2020 203a 7274  ls(*seq).    :rt
-00020190: 7970 653a 2054 7c6c 6973 747c 7475 706c  ype: T|list|tupl
-000201a0: 650a 2020 2020 2222 220a 2020 2020 6173  e.    """.    as
-000201b0: 7365 7274 2069 7373 7562 636c 6173 7328  sert issubclass(
-000201c0: 636c 732c 2028 6c69 7374 2c20 7475 706c  cls, (list, tupl
-000201d0: 6529 290a 2020 2020 6966 2069 735f 6e61  e)).    if is_na
-000201e0: 6d65 6474 7570 6c65 2863 6c73 293a 0a20  medtuple(cls):. 
-000201f0: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
-00020200: 7328 2a73 6571 2920 2023 206e 6f71 610a  s(*seq)  # noqa.
-00020210: 2020 2020 7265 7475 726e 2063 6c73 2873      return cls(s
-00020220: 6571 2920 2023 206e 6f71 610a 0a0a 6465  eq)  # noqa...de
-00020230: 6620 656e 7375 7265 5f6c 6973 745f 6f66  f ensure_list_of
-00020240: 5f74 7970 6528 6c73 2c20 7479 7065 5f29  _type(ls, type_)
-00020250: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
-00020260: 6172 616d 206c 6973 7420 6c73 3a0a 2020  aram list ls:.  
-00020270: 2020 3a70 6172 616d 2028 2829 2d3e 5429    :param (()->T)
-00020280: 7c74 7970 655b 545d 2074 7970 655f 3a20  |type[T] type_: 
-00020290: 7479 7065 206f 6620 696e 7374 616e 6365  type of instance
-000202a0: 7320 6f66 2060 6c73 602e 0a20 2020 2020  s of `ls`..     
-000202b0: 204e 6f74 6520 7468 6520 7374 7261 6e67   Note the strang
-000202c0: 6520 7479 7065 2068 6572 6520 696e 2074  e type here in t
-000202d0: 6865 2064 6f63 7374 7269 6e67 2069 7320  he docstring is 
-000202e0: 6475 6520 746f 2073 6f6d 6520 5079 4368  due to some PyCh
-000202f0: 6172 6d20 7479 7065 2069 6e66 6572 656e  arm type inferen
-00020300: 6365 2070 726f 626c 656d 730a 2020 2020  ce problems.    
-00020310: 2020 2868 7474 7073 3a2f 2f79 6f75 7472    (https://youtr
-00020320: 6163 6b2e 6a65 7462 7261 696e 732e 636f  ack.jetbrains.co
-00020330: 6d2f 6973 7375 652f 5059 2d35 3038 3238  m/issue/PY-50828
-00020340: 292e 0a20 2020 203a 7274 7970 653a 206c  )..    :rtype: l
-00020350: 6973 745b 545d 0a20 2020 2022 2222 0a20  ist[T].    """. 
-00020360: 2020 2061 7373 6572 7420 616c 6c28 6973     assert all(is
-00020370: 696e 7374 616e 6365 2865 6c65 6d2c 2074  instance(elem, t
-00020380: 7970 655f 2920 666f 7220 656c 656d 2069  ype_) for elem i
-00020390: 6e20 6c73 290a 2020 2020 7265 7475 726e  n ls).    return
-000203a0: 206c 730a 0a0a 4063 6f6e 7465 7874 6c69   ls...@contextli
-000203b0: 622e 636f 6e74 6578 746d 616e 6167 6572  b.contextmanager
-000203c0: 0a64 6566 2064 756d 6d79 5f6e 6f6f 705f  .def dummy_noop_
-000203d0: 6374 7828 293a 0a20 2020 2022 2222 0a20  ctx():.    """. 
-000203e0: 2020 2050 726f 7669 6465 7320 6120 6e6f     Provides a no
-000203f0: 2d6f 7020 636f 6e74 6578 7420 6d61 6e61  -op context mana
-00020400: 6765 722e 0a20 2020 2022 2222 0a20 2020  ger..    """.   
-00020410: 2079 6965 6c64 204e 6f6e 650a 0a0a 6465   yield None...de
-00020420: 6620 5f67 6574 5f6e 6772 616d 7328 7365  f _get_ngrams(se
-00020430: 676d 656e 742c 206d 6178 5f6f 7264 6572  gment, max_order
-00020440: 293a 0a20 2020 2022 2222 4578 7472 6163  ):.    """Extrac
-00020450: 7473 2061 6c6c 206e 2d67 7261 6d73 2075  ts all n-grams u
-00020460: 7074 6f20 6120 6769 7665 6e20 6d61 7869  pto a given maxi
-00020470: 6d75 6d20 6f72 6465 7220 6672 6f6d 2061  mum order from a
-00020480: 6e20 696e 7075 7420 7365 676d 656e 742e  n input segment.
-00020490: 0a20 2020 2043 6f64 6520 6164 6170 7465  .    Code adapte
-000204a0: 6420 6672 6f6d 2047 6f6f 676c 6520 5465  d from Google Te
-000204b0: 6e73 6f72 3254 656e 736f 722e 0a0a 2020  nsor2Tensor...  
-000204c0: 2020 4172 6773 3a0a 2020 2020 2020 7365    Args:.      se
-000204d0: 676d 656e 7420 286c 6973 745b 696e 745d  gment (list[int]
-000204e0: 7c6c 6973 745b 7374 725d 293a 2074 6578  |list[str]): tex
-000204f0: 7420 7365 676d 656e 7420 6672 6f6d 2077  t segment from w
-00020500: 6869 6368 206e 2d67 7261 6d73 2077 696c  hich n-grams wil
-00020510: 6c20 6265 2065 7874 7261 6374 6564 2e0a  l be extracted..
-00020520: 2020 2020 2020 6d61 785f 6f72 6465 7220        max_order 
-00020530: 2869 6e74 293a 206d 6178 696d 756d 206c  (int): maximum l
-00020540: 656e 6774 6820 696e 2074 6f6b 656e 7320  ength in tokens 
-00020550: 6f66 2074 6865 206e 2d67 7261 6d73 2072  of the n-grams r
-00020560: 6574 7572 6e65 6420 6279 2074 6869 730a  eturned by this.
-00020570: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00020580: 732e 0a0a 2020 2020 5265 7475 726e 733a  s...    Returns:
-00020590: 0a20 2020 2020 2054 6865 2043 6f75 6e74  .      The Count
-000205a0: 6572 2063 6f6e 7461 696e 696e 6720 616c  er containing al
-000205b0: 6c20 6e2d 6772 616d 7320 7570 746f 206d  l n-grams upto m
-000205c0: 6178 5f6f 7264 6572 2069 6e20 7365 676d  ax_order in segm
-000205d0: 656e 740a 2020 2020 2020 7769 7468 2061  ent.      with a
-000205e0: 2063 6f75 6e74 206f 6620 686f 7720 6d61   count of how ma
-000205f0: 6e79 2074 696d 6573 2065 6163 6820 6e2d  ny times each n-
-00020600: 6772 616d 206f 6363 7572 7265 642e 0a20  gram occurred.. 
-00020610: 2020 2022 2222 0a20 2020 2069 6d70 6f72     """.    impor
-00020620: 7420 636f 6c6c 6563 7469 6f6e 730a 0a20  t collections.. 
-00020630: 2020 206e 6772 616d 5f63 6f75 6e74 7320     ngram_counts 
-00020640: 3d20 636f 6c6c 6563 7469 6f6e 732e 436f  = collections.Co
-00020650: 756e 7465 7228 290a 2020 2020 666f 7220  unter().    for 
-00020660: 6f72 6465 7220 696e 2072 616e 6765 2831  order in range(1
-00020670: 2c20 6d61 785f 6f72 6465 7220 2b20 3129  , max_order + 1)
-00020680: 3a0a 2020 2020 2020 2020 666f 7220 6920  :.        for i 
-00020690: 696e 2072 616e 6765 2830 2c20 6c65 6e28  in range(0, len(
-000206a0: 7365 676d 656e 7429 202d 206f 7264 6572  segment) - order
-000206b0: 202b 2031 293a 0a20 2020 2020 2020 2020   + 1):.         
-000206c0: 2020 206e 6772 616d 203d 2074 7570 6c65     ngram = tuple
-000206d0: 2873 6567 6d65 6e74 5b69 203a 2069 202b  (segment[i : i +
-000206e0: 206f 7264 6572 5d29 0a20 2020 2020 2020   order]).       
-000206f0: 2020 2020 206e 6772 616d 5f63 6f75 6e74       ngram_count
-00020700: 735b 6e67 7261 6d5d 202b 3d20 310a 2020  s[ngram] += 1.  
-00020710: 2020 7265 7475 726e 206e 6772 616d 5f63    return ngram_c
-00020720: 6f75 6e74 730a 0a0a 6465 6620 636f 6d70  ounts...def comp
-00020730: 7574 655f 626c 6575 2872 6566 6572 656e  ute_bleu(referen
-00020740: 6365 5f63 6f72 7075 732c 2074 7261 6e73  ce_corpus, trans
-00020750: 6c61 7469 6f6e 5f63 6f72 7075 732c 206d  lation_corpus, m
-00020760: 6178 5f6f 7264 6572 3d34 2c20 7573 655f  ax_order=4, use_
-00020770: 6270 3d54 7275 6529 3a0a 2020 2020 2222  bp=True):.    ""
-00020780: 2243 6f6d 7075 7465 7320 424c 4555 2073  "Computes BLEU s
-00020790: 636f 7265 206f 6620 7472 616e 736c 6174  core of translat
-000207a0: 6564 2073 6567 6d65 6e74 7320 6167 6169  ed segments agai
-000207b0: 6e73 7420 6f6e 6520 6f72 206d 6f72 6520  nst one or more 
-000207c0: 7265 6665 7265 6e63 6573 2e0a 2020 2020  references..    
-000207d0: 436f 6465 2061 6461 7074 6564 2066 726f  Code adapted fro
-000207e0: 6d20 476f 6f67 6c65 2054 656e 736f 7232  m Google Tensor2
-000207f0: 5465 6e73 6f72 2e0a 0a20 2020 2041 7267  Tensor...    Arg
-00020800: 733a 0a20 2020 2020 2072 6566 6572 656e  s:.      referen
-00020810: 6365 5f63 6f72 7075 7320 286c 6973 745b  ce_corpus (list[
-00020820: 6c69 7374 5b69 6e74 5d7c 6c69 7374 5b73  list[int]|list[s
-00020830: 7472 5d5d 293a 206c 6973 7420 6f66 2072  tr]]): list of r
-00020840: 6566 6572 656e 6365 7320 666f 7220 6561  eferences for ea
-00020850: 6368 2074 7261 6e73 6c61 7469 6f6e 2e20  ch translation. 
-00020860: 4561 6368 0a20 2020 2020 2020 2020 2072  Each.          r
-00020870: 6566 6572 656e 6365 2073 686f 756c 6420  eference should 
-00020880: 6265 2074 6f6b 656e 697a 6564 2069 6e74  be tokenized int
-00020890: 6f20 6120 6c69 7374 206f 6620 746f 6b65  o a list of toke
-000208a0: 6e73 2e0a 2020 2020 2020 7472 616e 736c  ns..      transl
-000208b0: 6174 696f 6e5f 636f 7270 7573 2028 6c69  ation_corpus (li
-000208c0: 7374 5b6c 6973 745b 696e 745d 7c6c 6973  st[list[int]|lis
-000208d0: 745b 7374 725d 5d29 3a20 6c69 7374 206f  t[str]]): list o
-000208e0: 6620 7472 616e 736c 6174 696f 6e73 2074  f translations t
-000208f0: 6f20 7363 6f72 652e 2045 6163 6820 7472  o score. Each tr
-00020900: 616e 736c 6174 696f 6e0a 2020 2020 2020  anslation.      
-00020910: 2020 2020 7368 6f75 6c64 2062 6520 746f      should be to
-00020920: 6b65 6e69 7a65 6420 696e 746f 2061 206c  kenized into a l
-00020930: 6973 7420 6f66 2074 6f6b 656e 732e 0a20  ist of tokens.. 
-00020940: 2020 2020 206d 6178 5f6f 7264 6572 2028       max_order (
-00020950: 696e 7429 3a20 4d61 7869 6d75 6d20 6e2d  int): Maximum n-
-00020960: 6772 616d 206f 7264 6572 2074 6f20 7573  gram order to us
-00020970: 6520 7768 656e 2063 6f6d 7075 7469 6e67  e when computing
-00020980: 2042 4c45 5520 7363 6f72 652e 0a20 2020   BLEU score..   
-00020990: 2020 2075 7365 5f62 7020 2862 6f6f 6c29     use_bp (bool)
-000209a0: 3a20 626f 6f6c 6561 6e2c 2077 6865 7468  : boolean, wheth
-000209b0: 6572 2074 6f20 6170 706c 7920 6272 6576  er to apply brev
-000209c0: 6974 7920 7065 6e61 6c74 792e 0a0a 2020  ity penalty...  
-000209d0: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-000209e0: 2042 4c45 5520 7363 6f72 652e 0a20 2020   BLEU score..   
-000209f0: 2022 2222 0a20 2020 2069 6d70 6f72 7420   """.    import 
-00020a00: 6d61 7468 0a0a 2020 2020 7265 6665 7265  math..    refere
-00020a10: 6e63 655f 6c65 6e67 7468 203d 2030 0a20  nce_length = 0. 
-00020a20: 2020 2074 7261 6e73 6c61 7469 6f6e 5f6c     translation_l
-00020a30: 656e 6774 6820 3d20 300a 2020 2020 6270  ength = 0.    bp
-00020a40: 203d 2031 2e30 0a20 2020 2067 656f 5f6d   = 1.0.    geo_m
-00020a50: 6561 6e20 3d20 300a 0a20 2020 206d 6174  ean = 0..    mat
-00020a60: 6368 6573 5f62 795f 6f72 6465 7220 3d20  ches_by_order = 
-00020a70: 5b30 5d20 2a20 6d61 785f 6f72 6465 720a  [0] * max_order.
-00020a80: 2020 2020 706f 7373 6962 6c65 5f6d 6174      possible_mat
-00020a90: 6368 6573 5f62 795f 6f72 6465 7220 3d20  ches_by_order = 
-00020aa0: 5b30 5d20 2a20 6d61 785f 6f72 6465 720a  [0] * max_order.
-00020ab0: 0a20 2020 2066 6f72 2028 7265 6665 7265  .    for (refere
-00020ac0: 6e63 6573 2c20 7472 616e 736c 6174 696f  nces, translatio
-00020ad0: 6e73 2920 696e 207a 6970 2872 6566 6572  ns) in zip(refer
-00020ae0: 656e 6365 5f63 6f72 7075 732c 2074 7261  ence_corpus, tra
-00020af0: 6e73 6c61 7469 6f6e 5f63 6f72 7075 7329  nslation_corpus)
-00020b00: 3a0a 2020 2020 2020 2020 7265 6665 7265  :.        refere
-00020b10: 6e63 655f 6c65 6e67 7468 202b 3d20 6c65  nce_length += le
-00020b20: 6e28 7265 6665 7265 6e63 6573 290a 2020  n(references).  
-00020b30: 2020 2020 2020 7472 616e 736c 6174 696f        translatio
-00020b40: 6e5f 6c65 6e67 7468 202b 3d20 6c65 6e28  n_length += len(
-00020b50: 7472 616e 736c 6174 696f 6e73 290a 2020  translations).  
-00020b60: 2020 2020 2020 7265 665f 6e67 7261 6d5f        ref_ngram_
-00020b70: 636f 756e 7473 203d 205f 6765 745f 6e67  counts = _get_ng
-00020b80: 7261 6d73 2872 6566 6572 656e 6365 732c  rams(references,
-00020b90: 206d 6178 5f6f 7264 6572 290a 2020 2020   max_order).    
-00020ba0: 2020 2020 7472 616e 736c 6174 696f 6e5f      translation_
-00020bb0: 6e67 7261 6d5f 636f 756e 7473 203d 205f  ngram_counts = _
-00020bc0: 6765 745f 6e67 7261 6d73 2874 7261 6e73  get_ngrams(trans
-00020bd0: 6c61 7469 6f6e 732c 206d 6178 5f6f 7264  lations, max_ord
-00020be0: 6572 290a 0a20 2020 2020 2020 206f 7665  er)..        ove
-00020bf0: 726c 6170 203d 207b 6e67 7261 6d3a 206d  rlap = {ngram: m
-00020c00: 696e 2863 6f75 6e74 2c20 7472 616e 736c  in(count, transl
-00020c10: 6174 696f 6e5f 6e67 7261 6d5f 636f 756e  ation_ngram_coun
-00020c20: 7473 5b6e 6772 616d 5d29 2066 6f72 206e  ts[ngram]) for n
-00020c30: 6772 616d 2c20 636f 756e 7420 696e 2072  gram, count in r
-00020c40: 6566 5f6e 6772 616d 5f63 6f75 6e74 732e  ef_ngram_counts.
-00020c50: 6974 656d 7328 297d 0a0a 2020 2020 2020  items()}..      
-00020c60: 2020 666f 7220 6e67 7261 6d20 696e 206f    for ngram in o
-00020c70: 7665 726c 6170 3a0a 2020 2020 2020 2020  verlap:.        
-00020c80: 2020 2020 6d61 7463 6865 735f 6279 5f6f      matches_by_o
-00020c90: 7264 6572 5b6c 656e 286e 6772 616d 2920  rder[len(ngram) 
-00020ca0: 2d20 315d 202b 3d20 6f76 6572 6c61 705b  - 1] += overlap[
-00020cb0: 6e67 7261 6d5d 0a20 2020 2020 2020 2066  ngram].        f
-00020cc0: 6f72 206e 6772 616d 2069 6e20 7472 616e  or ngram in tran
-00020cd0: 736c 6174 696f 6e5f 6e67 7261 6d5f 636f  slation_ngram_co
-00020ce0: 756e 7473 3a0a 2020 2020 2020 2020 2020  unts:.          
-00020cf0: 2020 706f 7373 6962 6c65 5f6d 6174 6368    possible_match
-00020d00: 6573 5f62 795f 6f72 6465 725b 6c65 6e28  es_by_order[len(
-00020d10: 6e67 7261 6d29 202d 2031 5d20 2b3d 2074  ngram) - 1] += t
-00020d20: 7261 6e73 6c61 7469 6f6e 5f6e 6772 616d  ranslation_ngram
-00020d30: 5f63 6f75 6e74 735b 6e67 7261 6d5d 0a0a  _counts[ngram]..
-00020d40: 2020 2020 7072 6563 6973 696f 6e73 203d      precisions =
-00020d50: 205b 302e 305d 202a 206d 6178 5f6f 7264   [0.0] * max_ord
-00020d60: 6572 0a20 2020 2073 6d6f 6f74 6820 3d20  er.    smooth = 
-00020d70: 312e 300a 2020 2020 666f 7220 6920 696e  1.0.    for i in
-00020d80: 2072 616e 6765 2830 2c20 6d61 785f 6f72   range(0, max_or
-00020d90: 6465 7229 3a0a 2020 2020 2020 2020 6966  der):.        if
-00020da0: 2070 6f73 7369 626c 655f 6d61 7463 6865   possible_matche
-00020db0: 735f 6279 5f6f 7264 6572 5b69 5d20 3e20  s_by_order[i] > 
-00020dc0: 303a 0a20 2020 2020 2020 2020 2020 2070  0:.            p
-00020dd0: 7265 6369 7369 6f6e 735b 695d 203d 206d  recisions[i] = m
-00020de0: 6174 6368 6573 5f62 795f 6f72 6465 725b  atches_by_order[
-00020df0: 695d 202f 2070 6f73 7369 626c 655f 6d61  i] / possible_ma
-00020e00: 7463 6865 735f 6279 5f6f 7264 6572 5b69  tches_by_order[i
-00020e10: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-00020e20: 206d 6174 6368 6573 5f62 795f 6f72 6465   matches_by_orde
-00020e30: 725b 695d 203e 2030 3a0a 2020 2020 2020  r[i] > 0:.      
-00020e40: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-00020e50: 696f 6e73 5b69 5d20 3d20 6d61 7463 6865  ions[i] = matche
-00020e60: 735f 6279 5f6f 7264 6572 5b69 5d20 2f20  s_by_order[i] / 
-00020e70: 706f 7373 6962 6c65 5f6d 6174 6368 6573  possible_matches
-00020e80: 5f62 795f 6f72 6465 725b 695d 0a20 2020  _by_order[i].   
-00020e90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00020ea0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00020eb0: 6d6f 6f74 6820 2a3d 2032 0a20 2020 2020  mooth *= 2.     
-00020ec0: 2020 2020 2020 2020 2020 2070 7265 6369             preci
-00020ed0: 7369 6f6e 735b 695d 203d 2031 2e30 202f  sions[i] = 1.0 /
-00020ee0: 2028 736d 6f6f 7468 202a 2070 6f73 7369   (smooth * possi
-00020ef0: 626c 655f 6d61 7463 6865 735f 6279 5f6f  ble_matches_by_o
-00020f00: 7264 6572 5b69 5d29 0a20 2020 2020 2020  rder[i]).       
-00020f10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00020f20: 2020 2070 7265 6369 7369 6f6e 735b 695d     precisions[i]
-00020f30: 203d 2030 2e30 0a0a 2020 2020 6966 206d   = 0.0..    if m
-00020f40: 6178 2870 7265 6369 7369 6f6e 7329 203e  ax(precisions) >
-00020f50: 2030 3a0a 2020 2020 2020 2020 705f 6c6f   0:.        p_lo
-00020f60: 675f 7375 6d20 3d20 7375 6d28 6d61 7468  g_sum = sum(math
-00020f70: 2e6c 6f67 2870 2920 666f 7220 7020 696e  .log(p) for p in
-00020f80: 2070 7265 6369 7369 6f6e 7320 6966 2070   precisions if p
-00020f90: 290a 2020 2020 2020 2020 6765 6f5f 6d65  ).        geo_me
-00020fa0: 616e 203d 206d 6174 682e 6578 7028 705f  an = math.exp(p_
-00020fb0: 6c6f 675f 7375 6d20 2f20 6d61 785f 6f72  log_sum / max_or
-00020fc0: 6465 7229 0a0a 2020 2020 6966 2075 7365  der)..    if use
-00020fd0: 5f62 703a 0a20 2020 2020 2020 2072 6174  _bp:.        rat
-00020fe0: 696f 203d 2074 7261 6e73 6c61 7469 6f6e  io = translation
-00020ff0: 5f6c 656e 6774 6820 2f20 7265 6665 7265  _length / refere
-00021000: 6e63 655f 6c65 6e67 7468 0a20 2020 2020  nce_length.     
-00021010: 2020 2069 6620 7261 7469 6f20 3c20 3165     if ratio < 1e
-00021020: 2d33 303a 0a20 2020 2020 2020 2020 2020  -30:.           
-00021030: 2062 7020 3d20 302e 300a 2020 2020 2020   bp = 0.0.      
-00021040: 2020 656c 6966 2072 6174 696f 203c 2031    elif ratio < 1
-00021050: 2e30 3a0a 2020 2020 2020 2020 2020 2020  .0:.            
-00021060: 6270 203d 206d 6174 682e 6578 7028 3120  bp = math.exp(1 
-00021070: 2d20 312e 3020 2f20 7261 7469 6f29 0a20  - 1.0 / ratio). 
-00021080: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00021090: 2020 2020 2020 2020 2062 7020 3d20 312e           bp = 1.
-000210a0: 300a 2020 2020 626c 6575 203d 2067 656f  0.    bleu = geo
-000210b0: 5f6d 6561 6e20 2a20 6270 0a20 2020 2072  _mean * bp.    r
-000210c0: 6574 7572 6e20 6e70 2e66 6c6f 6174 3332  eturn np.float32
-000210d0: 2862 6c65 7529 0a0a 0a23 206e 6f69 6e73  (bleu)...# noins
-000210e0: 7065 6374 696f 6e20 5079 5061 636b 6167  pection PyPackag
-000210f0: 6552 6571 7569 7265 6d65 6e74 730a 6465  eRequirements.de
-00021100: 6620 6d6f 6e6b 6579 6669 785f 676c 6962  f monkeyfix_glib
-00021110: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
-00021120: 4669 7865 7320 736f 6d65 2073 7475 7069  Fixes some stupi
-00021130: 6420 6275 6773 2073 7563 6820 7468 6174  d bugs such that
-00021140: 2053 4947 494e 5420 6973 206e 6f74 2077   SIGINT is not w
-00021150: 6f72 6b69 6e67 2e0a 2020 2020 5468 6973  orking..    This
-00021160: 2069 7320 7573 6564 2062 7920 6175 6469   is used by audi
-00021170: 6f72 6561 642c 2061 6e64 2069 6e64 6972  oread, and indir
-00021180: 6563 746c 7920 6279 206c 6962 726f 7361  ectly by librosa
-00021190: 2066 6f72 206c 6f61 6469 6e67 2061 7564   for loading aud
-000211a0: 696f 2e0a 2020 2020 6874 7470 733a 2f2f  io..    https://
-000211b0: 7374 6163 6b6f 7665 7266 6c6f 772e 636f  stackoverflow.co
-000211c0: 6d2f 7175 6573 7469 6f6e 732f 3136 3431  m/questions/1641
-000211d0: 3038 3532 2f0a 2020 2020 5365 6520 616c  0852/.    See al
-000211e0: 736f 203a 6675 6e63 3a60 6d6f 6e6b 6579  so :func:`monkey
-000211f0: 7061 7463 685f 6175 6469 6f72 6561 6460  patch_audioread`
-00021200: 2e0a 2020 2020 2222 220a 2020 2020 7472  ..    """.    tr
-00021210: 793a 0a20 2020 2020 2020 2069 6d70 6f72  y:.        impor
-00021220: 7420 6769 0a20 2020 2065 7863 6570 7420  t gi.    except 
-00021230: 496d 706f 7274 4572 726f 723a 0a20 2020  ImportError:.   
-00021240: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00021250: 7472 793a 0a20 2020 2020 2020 2066 726f  try:.        fro
-00021260: 6d20 6769 2e72 6570 6f73 6974 6f72 7920  m gi.repository 
-00021270: 696d 706f 7274 2047 4c69 620a 2020 2020  import GLib.    
-00021280: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
-00021290: 6f72 3a0a 2020 2020 2020 2020 2320 6e6f  or:.        # no
-000212a0: 696e 7370 6563 7469 6f6e 2050 7955 6e72  inspection PyUnr
-000212b0: 6573 6f6c 7665 6452 6566 6572 656e 6365  esolvedReference
-000212c0: 730a 2020 2020 2020 2020 6672 6f6d 2067  s.        from g
-000212d0: 692e 6f76 6572 7269 6465 7320 696d 706f  i.overrides impo
-000212e0: 7274 2047 4c69 620a 2020 2020 2320 446f  rt GLib.    # Do
-000212f0: 206e 6f74 6869 6e67 2e0a 2020 2020 2320   nothing..    # 
-00021300: 5468 6520 6f72 6967 696e 616c 2062 6568  The original beh
-00021310: 6176 696f 7220 776f 756c 6420 696e 7374  avior would inst
-00021320: 616c 6c20 6120 5349 4749 4e54 2068 616e  all a SIGINT han
-00021330: 646c 6572 2077 6869 6368 2063 616c 6c73  dler which calls
-00021340: 2047 4c69 622e 4d61 696e 4c6f 6f70 2e71   GLib.MainLoop.q
-00021350: 7569 7428 292c 0a20 2020 2023 2061 6e64  uit(),.    # and
-00021360: 2074 6865 6e20 7265 7261 6973 6520 6120   then reraise a 
-00021370: 4b65 7962 6f61 7264 496e 7465 7272 7570  KeyboardInterrup
-00021380: 7420 696e 2074 6861 7420 7468 7265 6164  t in that thread
-00021390: 2e0a 2020 2020 2320 486f 7765 7665 722c  ..    # However,
-000213a0: 2077 6520 7761 6e74 2061 6e64 2065 7870   we want and exp
-000213b0: 6563 7420 746f 2067 6574 2074 6865 204b  ect to get the K
-000213c0: 6579 626f 6172 6449 6e74 6572 7275 7074  eyboardInterrupt
-000213d0: 2069 6e20 7468 6520 6d61 696e 2074 6872   in the main thr
-000213e0: 6561 642e 0a20 2020 2047 4c69 622e 4d61  ead..    GLib.Ma
-000213f0: 696e 4c6f 6f70 2e5f 5f69 6e69 745f 5f20  inLoop.__init__ 
-00021400: 3d20 6c61 6d62 6461 202a 6172 6773 2c20  = lambda *args, 
-00021410: 2a2a 6b77 6172 6773 3a20 4e6f 6e65 0a0a  **kwargs: None..
-00021420: 0a64 6566 206d 6f6e 6b65 7970 6174 6368  .def monkeypatch
-00021430: 5f61 7564 696f 7265 6164 2829 3a0a 2020  _audioread():.  
-00021440: 2020 2222 220a 2020 2020 6175 6469 6f72    """.    audior
-00021450: 6561 6420 646f 6573 206e 6f74 2062 6568  ead does not beh
-00021460: 6176 6520 6f70 7469 6d61 6c20 696e 2073  ave optimal in s
-00021470: 6f6d 6520 6361 7365 732e 0a20 2020 2045  ome cases..    E
-00021480: 2e67 2e20 6561 6368 2063 616c 6c20 746f  .g. each call to
-00021490: 205f 6361 5f61 7661 696c 6162 6c65 2829   _ca_available()
-000214a0: 2074 616b 6573 2071 7569 7465 206c 6f6e   takes quite lon
-000214b0: 6720 6265 6361 7573 6520 6f66 2074 6865  g because of the
-000214c0: 2063 7479 7065 732e 7574 696c 2e66 696e   ctypes.util.fin
-000214d0: 645f 6c69 6272 6172 7920 7573 6167 652e  d_library usage.
-000214e0: 0a20 2020 2057 6520 7769 6c6c 2070 6174  .    We will pat
-000214f0: 6368 2074 6869 732e 0a0a 2020 2020 486f  ch this...    Ho
-00021500: 7765 7665 722c 2074 6865 2072 6563 6f6d  wever, the recom
-00021510: 6d65 6e64 6174 696f 6e20 776f 756c 6420  mendation would 
-00021520: 6265 2074 6f20 6e6f 7420 7573 6520 6175  be to not use au
-00021530: 6469 6f72 6561 6420 286c 6962 726f 7361  dioread (librosa
-00021540: 2e6c 6f61 6429 2e0a 2020 2020 6175 6469  .load)..    audi
-00021550: 6f72 6561 6420 7573 6573 2047 7374 7265  oread uses Gstre
-00021560: 616d 6572 2061 7320 6120 6261 636b 656e  amer as a backen
-00021570: 6420 6279 2064 6566 6175 6c74 2063 7572  d by default cur
-00021580: 7265 6e74 6c79 2028 6f6e 204c 696e 7578  rently (on Linux
-00021590: 292e 0a20 2020 2047 7374 7265 616d 6572  )..    Gstreamer
-000215a0: 2068 6173 206d 756c 7469 706c 6520 6973   has multiple is
-000215b0: 7375 6573 2e20 5365 6520 616c 736f 203a  sues. See also :
-000215c0: 6675 6e63 3a60 6d6f 6e6b 6579 6669 785f  func:`monkeyfix_
-000215d0: 676c 6962 602c 2061 6e64 2068 6572 6520  glib`, and here 
-000215e0: 666f 7220 6469 7363 7573 7369 6f6e 3a0a  for discussion:.
-000215f0: 2020 2020 6874 7470 733a 2f2f 6769 7468      https://gith
-00021600: 7562 2e63 6f6d 2f62 6565 7462 6f78 2f61  ub.com/beetbox/a
-00021610: 7564 696f 7265 6164 2f69 7373 7565 732f  udioread/issues/
-00021620: 3632 0a20 2020 2068 7474 7073 3a2f 2f67  62.    https://g
-00021630: 6974 6875 622e 636f 6d2f 6265 6574 626f  ithub.com/beetbo
-00021640: 782f 6175 6469 6f72 6561 642f 6973 7375  x/audioread/issu
-00021650: 6573 2f36 330a 0a20 2020 2049 6e73 7465  es/63..    Inste
-00021660: 6164 2c20 7573 6520 5079 536f 756e 6446  ad, use PySoundF
-00021670: 696c 652c 2077 6869 6368 2069 7320 616c  ile, which is al
-00021680: 736f 2066 6173 7465 722e 2053 6565 2068  so faster. See h
-00021690: 6572 6520 666f 7220 6469 7363 7573 7369  ere for discussi
-000216a0: 6f6e 733a 0a20 2020 2068 7474 7073 3a2f  ons:.    https:/
-000216b0: 2f67 6974 6875 622e 636f 6d2f 6265 6574  /github.com/beet
-000216c0: 626f 782f 6175 6469 6f72 6561 642f 6973  box/audioread/is
-000216d0: 7375 6573 2f36 340a 2020 2020 6874 7470  sues/64.    http
-000216e0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f6c  s://github.com/l
-000216f0: 6962 726f 7361 2f6c 6962 726f 7361 2f69  ibrosa/librosa/i
-00021700: 7373 7565 732f 3638 310a 2020 2020 2222  ssues/681.    ""
-00021710: 220a 2020 2020 7472 793a 0a20 2020 2020  ".    try:.     
-00021720: 2020 2023 206e 6f69 6e73 7065 6374 696f     # noinspectio
-00021730: 6e20 5079 5061 636b 6167 6552 6571 7569  n PyPackageRequi
-00021740: 7265 6d65 6e74 730a 2020 2020 2020 2020  rements.        
-00021750: 696d 706f 7274 2061 7564 696f 7265 6164  import audioread
-00021760: 0a20 2020 2065 7863 6570 7420 496d 706f  .    except Impo
-00021770: 7274 4572 726f 723a 0a20 2020 2020 2020  rtError:.       
-00021780: 2072 6574 7572 6e0a 2020 2020 2320 6e6f   return.    # no
-00021790: 696e 7370 6563 7469 6f6e 2050 7950 726f  inspection PyPro
-000217a0: 7465 6374 6564 4d65 6d62 6572 0a20 2020  tectedMember.   
-000217b0: 2072 6573 203d 2061 7564 696f 7265 6164   res = audioread
-000217c0: 2e5f 6361 5f61 7661 696c 6162 6c65 2829  ._ca_available()
-000217d0: 0a20 2020 2061 7564 696f 7265 6164 2e5f  .    audioread._
-000217e0: 6361 5f61 7661 696c 6162 6c65 203d 206c  ca_available = l
-000217f0: 616d 6264 613a 2072 6573 0a0a 0a5f 6366  ambda: res..._cf
-00021800: 5f63 6163 6865 203d 207b 7d0a 5f63 665f  _cache = {}._cf_
-00021810: 6d73 675f 7072 696e 7465 6420 3d20 4661  msg_printed = Fa
-00021820: 6c73 650a 0a0a 6465 6620 6366 2866 696c  lse...def cf(fil
-00021830: 656e 616d 6529 3a0a 2020 2020 2222 220a  ename):.    """.
-00021840: 2020 2020 4361 6368 6520 6d61 6e61 6765      Cache manage
-00021850: 722e 2069 3620 7370 6563 6966 6963 2e0a  r. i6 specific..
-00021860: 0a20 2020 203a 7265 7475 726e 3a20 6669  .    :return: fi
-00021870: 6c65 6e61 6d65 0a20 2020 203a 7274 7970  lename.    :rtyp
-00021880: 653a 2073 7472 0a20 2020 2022 2222 0a20  e: str.    """. 
-00021890: 2020 2067 6c6f 6261 6c20 5f63 665f 6d73     global _cf_ms
-000218a0: 675f 7072 696e 7465 640a 2020 2020 696d  g_printed.    im
-000218b0: 706f 7274 206f 730a 2020 2020 6672 6f6d  port os.    from
-000218c0: 2073 7562 7072 6f63 6573 7320 696d 706f   subprocess impo
-000218d0: 7274 2063 6865 636b 5f6f 7574 7075 740a  rt check_output.
-000218e0: 0a20 2020 2069 6620 6669 6c65 6e61 6d65  .    if filename
-000218f0: 2069 6e20 5f63 665f 6361 6368 653a 0a20   in _cf_cache:. 
-00021900: 2020 2020 2020 2072 6574 7572 6e20 5f63         return _c
-00021910: 665f 6361 6368 655b 6669 6c65 6e61 6d65  f_cache[filename
-00021920: 5d0a 2020 2020 6465 6275 675f 6d6f 6465  ].    debug_mode
-00021930: 203d 2069 6e74 286f 732e 656e 7669 726f   = int(os.enviro
-00021940: 6e2e 6765 7428 2244 4542 5547 222c 2030  n.get("DEBUG", 0
-00021950: 2929 0a20 2020 2069 6620 6465 6275 675f  )).    if debug_
-00021960: 6d6f 6465 206f 7220 6765 745f 686f 7374  mode or get_host
-00021970: 6e61 6d65 2829 203d 3d20 2263 6c75 7374  name() == "clust
-00021980: 6572 2d63 6e2d 3231 3122 206f 7220 6e6f  er-cn-211" or no
-00021990: 7420 6973 5f72 756e 6e69 6e67 5f6f 6e5f  t is_running_on_
-000219a0: 636c 7573 7465 7228 293a 0a20 2020 2020  cluster():.     
-000219b0: 2020 2069 6620 6e6f 7420 5f63 665f 6d73     if not _cf_ms
-000219c0: 675f 7072 696e 7465 643a 0a20 2020 2020  g_printed:.     
-000219d0: 2020 2020 2020 2070 7269 6e74 2822 4361         print("Ca
-000219e0: 6368 6520 6d61 6e61 6765 723a 206e 6f74  che manager: not
-000219f0: 2075 7365 642c 2075 7365 206c 6f63 616c   used, use local
-00021a00: 2066 696c 653a 2025 7320 2864 6973 6361   file: %s (disca
-00021a10: 7264 2066 7572 7468 6572 206d 6573 7361  rd further messa
-00021a20: 6765 7329 2220 2520 6669 6c65 6e61 6d65  ges)" % filename
-00021a30: 290a 2020 2020 2020 2020 2020 2020 5f63  ).            _c
-00021a40: 665f 6d73 675f 7072 696e 7465 6420 3d20  f_msg_printed = 
-00021a50: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
-00021a60: 7572 6e20 6669 6c65 6e61 6d65 2020 2320  urn filename  # 
-00021a70: 666f 7220 6465 6275 6767 696e 670a 2020  for debugging.  
-00021a80: 2020 7472 793a 0a20 2020 2020 2020 2063    try:.        c
-00021a90: 6163 6865 645f 666e 203d 2063 6865 636b  ached_fn = check
-00021aa0: 5f6f 7574 7075 7428 5b22 6366 222c 2066  _output(["cf", f
-00021ab0: 696c 656e 616d 655d 292e 7374 7269 7028  ilename]).strip(
-00021ac0: 292e 6465 636f 6465 2822 7574 6638 2229  ).decode("utf8")
-00021ad0: 0a20 2020 2065 7863 6570 7420 4361 6c6c  .    except Call
-00021ae0: 6564 5072 6f63 6573 7345 7272 6f72 3a0a  edProcessError:.
-00021af0: 2020 2020 2020 2020 6966 206e 6f74 205f          if not _
-00021b00: 6366 5f6d 7367 5f70 7269 6e74 6564 3a0a  cf_msg_printed:.
-00021b10: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00021b20: 7428 2243 6163 6865 206d 616e 6167 6572  t("Cache manager
-00021b30: 3a20 4572 726f 7220 6f63 6375 7272 6564  : Error occurred
-00021b40: 2c20 7573 696e 6720 6c6f 6361 6c20 6669  , using local fi
-00021b50: 6c65 2229 0a20 2020 2020 2020 2020 2020  le").           
-00021b60: 205f 6366 5f6d 7367 5f70 7269 6e74 6564   _cf_msg_printed
-00021b70: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00021b80: 7265 7475 726e 2066 696c 656e 616d 650a  return filename.
-00021b90: 2020 2020 6173 7365 7274 206f 732e 7061      assert os.pa
-00021ba0: 7468 2e65 7869 7374 7328 6361 6368 6564  th.exists(cached
-00021bb0: 5f66 6e29 0a20 2020 205f 6366 5f63 6163  _fn).    _cf_cac
-00021bc0: 6865 5b66 696c 656e 616d 655d 203d 2063  he[filename] = c
-00021bd0: 6163 6865 645f 666e 0a20 2020 2072 6574  ached_fn.    ret
-00021be0: 7572 6e20 6361 6368 6564 5f66 6e0a 0a0a  urn cached_fn...
-00021bf0: 6465 6620 6269 6e61 7279 5f73 6561 7263  def binary_searc
-00021c00: 685f 616e 7928 636d 702c 206c 6f77 2c20  h_any(cmp, low, 
-00021c10: 6869 6768 293a 0a20 2020 2022 2222 0a20  high):.    """. 
-00021c20: 2020 2042 696e 6172 7920 7365 6172 6368     Binary search
-00021c30: 2066 6f72 2061 2063 7573 746f 6d20 636f   for a custom co
-00021c40: 6d70 6172 6520 6675 6e63 7469 6f6e 2e0a  mpare function..
-00021c50: 0a20 2020 203a 7061 7261 6d20 2869 6e74  .    :param (int
-00021c60: 292d 3e69 6e74 2063 6d70 3a20 652e 672e  )->int cmp: e.g.
-00021c70: 2063 6d70 2869 6478 2920 3d3d 2063 6f6d   cmp(idx) == com
-00021c80: 7061 7265 2861 7272 6179 5b69 6478 5d2c  pare(array[idx],
-00021c90: 206b 6579 290a 2020 2020 3a70 6172 616d   key).    :param
-00021ca0: 2069 6e74 206c 6f77 3a20 696e 636c 7573   int low: inclus
-00021cb0: 6976 650a 2020 2020 3a70 6172 616d 2069  ive.    :param i
-00021cc0: 6e74 2068 6967 683a 2065 7863 6c75 7369  nt high: exclusi
-00021cd0: 7665 0a20 2020 203a 7274 7970 653a 2069  ve.    :rtype: i
-00021ce0: 6e74 7c4e 6f6e 650a 2020 2020 2222 220a  nt|None.    """.
-00021cf0: 2020 2020 7768 696c 6520 6c6f 7720 3c20      while low < 
-00021d00: 6869 6768 3a0a 2020 2020 2020 2020 6d69  high:.        mi
-00021d10: 6420 3d20 286c 6f77 202b 2068 6967 6829  d = (low + high)
-00021d20: 202f 2f20 320a 2020 2020 2020 2020 7220   // 2.        r 
-00021d30: 3d20 636d 7028 6d69 6429 0a20 2020 2020  = cmp(mid).     
-00021d40: 2020 2069 6620 7220 3c20 303a 0a20 2020     if r < 0:.   
-00021d50: 2020 2020 2020 2020 206c 6f77 203d 206d           low = m
-00021d60: 6964 202b 2031 0a20 2020 2020 2020 2065  id + 1.        e
-00021d70: 6c69 6620 7220 3e20 303a 0a20 2020 2020  lif r > 0:.     
-00021d80: 2020 2020 2020 2068 6967 6820 3d20 6d69         high = mi
-00021d90: 640a 2020 2020 2020 2020 656c 7365 3a0a  d.        else:.
-00021da0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00021db0: 726e 206d 6964 0a20 2020 2072 6574 7572  rn mid.    retur
-00021dc0: 6e20 6c6f 770a 0a0a 6465 6620 6765 6e65  n low...def gene
-00021dd0: 7269 635f 696d 706f 7274 5f6d 6f64 756c  ric_import_modul
-00021de0: 6528 6669 6c65 6e61 6d65 293a 0a20 2020  e(filename):.   
-00021df0: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
-00021e00: 7374 7220 6669 6c65 6e61 6d65 3a0a 2020  str filename:.  
-00021e10: 2020 2020 5765 2074 7279 2074 6f20 6265      We try to be
-00021e20: 2063 6c65 7665 7220 6162 6f75 7420 6669   clever about fi
-00021e30: 6c65 6e61 6d65 2e0a 2020 2020 2020 4966  lename..      If
-00021e40: 2069 7420 6c6f 6f6b 7320 6c69 6b65 2061   it looks like a
-00021e50: 206d 6f64 756c 6520 6e61 6d65 2c20 6a75   module name, ju
-00021e60: 7374 2064 6f20 696d 706f 7274 6c69 622e  st do importlib.
-00021e70: 696d 706f 7274 5f6d 6f64 756c 652e 0a20  import_module.. 
-00021e80: 2020 2020 2049 6620 6974 206c 6f6f 6b73       If it looks
-00021e90: 206c 696b 6520 6120 6669 6c65 6e61 6d65   like a filename
-00021ea0: 2c20 7365 6172 6368 2066 6f72 2061 2062  , search for a b
-00021eb0: 6173 6520 7061 7468 2028 7768 6963 6820  ase path (which 
-00021ec0: 646f 6573 206e 6f74 2068 6176 6520 5f5f  does not have __
-00021ed0: 696e 6974 5f5f 2e70 7929 2c0a 2020 2020  init__.py),.    
-00021ee0: 2020 6164 6420 7468 6174 2070 6174 6820    add that path 
-00021ef0: 746f 2073 7973 2e70 6174 6820 6966 206e  to sys.path if n
-00021f00: 6565 6465 642c 2061 6e64 2069 6d70 6f72  eeded, and impor
-00021f10: 7420 7468 6520 7265 6d61 696e 696e 6720  t the remaining 
-00021f20: 7768 6572 6520 222f 2220 6973 2072 6570  where "/" is rep
-00021f30: 6c61 6365 6420 6279 2022 2e22 0a20 2020  laced by ".".   
-00021f40: 2020 2061 6e64 2074 6865 2066 696c 6520     and the file 
-00021f50: 6578 7465 6e73 696f 6e20 6973 2072 656d  extension is rem
-00021f60: 6f76 6564 2e0a 2020 2020 3a72 6574 7572  oved..    :retur
-00021f70: 6e3a 2074 6865 206d 6f64 756c 650a 2020  n: the module.  
-00021f80: 2020 3a72 7479 7065 3a20 7479 7065 732e    :rtype: types.
-00021f90: 4d6f 6475 6c65 5479 7065 0a20 2020 2022  ModuleType.    "
-00021fa0: 2222 0a20 2020 2061 7373 6572 7420 6669  "".    assert fi
-00021fb0: 6c65 6e61 6d65 0a20 2020 2069 6d70 6f72  lename.    impor
-00021fc0: 7420 696d 706f 7274 6c69 620a 0a20 2020  t importlib..   
-00021fd0: 2069 6620 222f 2220 6e6f 7420 696e 2066   if "/" not in f
-00021fe0: 696c 656e 616d 653a 0a20 2020 2020 2020  ilename:.       
-00021ff0: 2072 6574 7572 6e20 696d 706f 7274 6c69   return importli
-00022000: 622e 696d 706f 7274 5f6d 6f64 756c 6528  b.import_module(
-00022010: 6669 6c65 6e61 6d65 290a 2020 2020 7072  filename).    pr
-00022020: 6566 6978 5f64 6972 203d 2022 220a 2020  efix_dir = "".  
-00022030: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-00022040: 2e65 7869 7374 7328 6669 6c65 6e61 6d65  .exists(filename
-00022050: 293a 0a20 2020 2020 2020 2061 7373 6572  ):.        asser
-00022060: 7420 6669 6c65 6e61 6d65 5b30 5d20 213d  t filename[0] !=
-00022070: 2022 2f22 0a20 2020 2020 2020 2023 204d   "/".        # M
-00022080: 6179 6265 2072 656c 6174 6976 6520 746f  aybe relative to
-00022090: 2052 6574 7572 6e6e 3f0a 2020 2020 2020   Returnn?.      
-000220a0: 2020 7072 6566 6978 5f64 6972 203d 2022    prefix_dir = "
-000220b0: 2573 2f22 2025 2072 6574 7572 6e6e 5f72  %s/" % returnn_r
-000220c0: 6f6f 745f 6469 720a 2020 2020 6173 7365  oot_dir.    asse
-000220d0: 7274 206f 732e 7061 7468 2e65 7869 7374  rt os.path.exist
-000220e0: 7328 7072 6566 6978 5f64 6972 202b 2066  s(prefix_dir + f
-000220f0: 696c 656e 616d 6529 0a20 2020 2061 7373  ilename).    ass
-00022100: 6572 7420 6669 6c65 6e61 6d65 2e65 6e64  ert filename.end
-00022110: 7377 6974 6828 222e 7079 2229 206f 7220  swith(".py") or 
-00022120: 6f73 2e70 6174 682e 6973 6469 7228 7072  os.path.isdir(pr
-00022130: 6566 6978 5f64 6972 202b 2066 696c 656e  efix_dir + filen
-00022140: 616d 6529 0a20 2020 2064 6972 7320 3d20  ame).    dirs = 
-00022150: 6669 6c65 6e61 6d65 2e73 706c 6974 2822  filename.split("
-00022160: 2f22 290a 2020 2020 6469 7273 2c20 6261  /").    dirs, ba
-00022170: 7365 5f66 6e20 3d20 6469 7273 5b3a 2d31  se_fn = dirs[:-1
-00022180: 5d2c 2064 6972 735b 2d31 5d0a 2020 2020  ], dirs[-1].    
-00022190: 6173 7365 7274 206c 656e 2864 6972 7329  assert len(dirs)
-000221a0: 203e 3d20 310a 2020 2020 666f 7220 6920   >= 1.    for i 
-000221b0: 696e 2072 6576 6572 7365 6428 7261 6e67  in reversed(rang
-000221c0: 6528 6c65 6e28 6469 7273 2929 293a 0a20  e(len(dirs))):. 
-000221d0: 2020 2020 2020 2064 203d 2070 7265 6669         d = prefi
-000221e0: 785f 6469 7220 2b20 222f 222e 6a6f 696e  x_dir + "/".join
-000221f0: 2864 6972 735b 3a20 6920 2b20 315d 290a  (dirs[: i + 1]).
-00022200: 2020 2020 2020 2020 6173 7365 7274 206f          assert o
-00022210: 732e 7061 7468 2e69 7364 6972 2864 290a  s.path.isdir(d).
-00022220: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-00022230: 7468 2e65 7869 7374 7328 2225 732f 5f5f  th.exists("%s/__
-00022240: 696e 6974 5f5f 2e70 7922 2025 2064 293a  init__.py" % d):
-00022250: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00022260: 7469 6e75 650a 2020 2020 2020 2020 6966  tinue.        if
-00022270: 2064 206e 6f74 2069 6e20 7379 732e 7061   d not in sys.pa
-00022280: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
-00022290: 7379 732e 7061 7468 2e61 7070 656e 6428  sys.path.append(
-000222a0: 6429 0a20 2020 2020 2020 206d 203d 2022  d).        m = "
-000222b0: 2e22 2e6a 6f69 6e28 6469 7273 5b69 202b  .".join(dirs[i +
-000222c0: 2031 203a 5d20 2b20 5b62 6173 655f 666e   1 :] + [base_fn
-000222d0: 5d29 0a20 2020 2020 2020 2069 6620 6261  ]).        if ba
-000222e0: 7365 5f66 6e2e 656e 6473 7769 7468 2822  se_fn.endswith("
-000222f0: 2e70 7922 293a 0a20 2020 2020 2020 2020  .py"):.         
-00022300: 2020 206d 203d 206d 5b3a 2d33 5d0a 2020     m = m[:-3].  
-00022310: 2020 2020 2020 7265 7475 726e 2069 6d70        return imp
-00022320: 6f72 746c 6962 2e69 6d70 6f72 745f 6d6f  ortlib.import_mo
-00022330: 6475 6c65 286d 290a 2020 2020 7261 6973  dule(m).    rais
-00022340: 6520 5661 6c75 6545 7272 6f72 2822 6361  e ValueError("ca
-00022350: 6e6e 6f74 2066 6967 7572 6520 6f75 7420  nnot figure out 
-00022360: 6261 7365 206d 6f64 756c 6520 7061 7468  base module path
-00022370: 2066 726f 6d20 2572 2220 2520 6669 6c65   from %r" % file
-00022380: 6e61 6d65 290a 0a0a 6465 6620 736f 6674  name)...def soft
-00022390: 6d61 7828 782c 2061 7869 733d 4e6f 6e65  max(x, axis=None
-000223a0: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
-000223b0: 7061 7261 6d20 6e75 6d70 792e 6e64 6172  param numpy.ndar
-000223c0: 7261 7920 783a 0a20 2020 203a 7061 7261  ray x:.    :para
-000223d0: 6d20 696e 747c 4e6f 6e65 2061 7869 733a  m int|None axis:
-000223e0: 0a20 2020 203a 7274 7970 653a 206e 756d  .    :rtype: num
-000223f0: 7079 2e6e 6461 7272 6179 0a20 2020 2022  py.ndarray.    "
-00022400: 2222 0a20 2020 2069 6d70 6f72 7420 6e75  "".    import nu
-00022410: 6d70 790a 0a20 2020 2065 5f78 203d 206e  mpy..    e_x = n
-00022420: 756d 7079 2e65 7870 2878 202d 206e 756d  umpy.exp(x - num
-00022430: 7079 2e6d 6178 2878 2c20 6178 6973 3d61  py.max(x, axis=a
-00022440: 7869 732c 206b 6565 7064 696d 733d 5472  xis, keepdims=Tr
-00022450: 7565 2929 0a20 2020 2072 6574 7572 6e20  ue)).    return 
-00022460: 655f 7820 2f20 6e75 6d70 792e 7375 6d28  e_x / numpy.sum(
-00022470: 655f 782c 2061 7869 733d 6178 6973 2c20  e_x, axis=axis, 
-00022480: 6b65 6570 6469 6d73 3d54 7275 6529 0a0a  keepdims=True)..
-00022490: 0a64 6566 2063 6f6c 6c65 6374 5f70 726f  .def collect_pro
-000224a0: 635f 6d61 7073 5f65 7865 635f 6669 6c65  c_maps_exec_file
-000224b0: 7328 293a 0a20 2020 2022 2222 0a20 2020  s():.    """.   
-000224c0: 2043 7572 7265 6e74 6c79 206f 6e6c 7920   Currently only 
-000224d0: 776f 726b 7320 6f6e 204c 696e 7578 2e2e  works on Linux..
-000224e0: 2e0a 0a20 2020 203a 7265 7475 726e 3a20  ...    :return: 
-000224f0: 6c69 7374 206f 6620 6d61 7070 6564 2065  list of mapped e
-00022500: 7865 6375 7461 626c 6573 2028 6c69 6273  xecutables (libs
-00022510: 290a 2020 2020 3a72 7479 7065 3a20 6c69  ).    :rtype: li
-00022520: 7374 5b73 7472 5d0a 2020 2020 2222 220a  st[str].    """.
-00022530: 2020 2020 696d 706f 7274 2072 650a 0a20      import re.. 
-00022540: 2020 2070 6964 203d 206f 732e 6765 7470     pid = os.getp
-00022550: 6964 2829 0a20 2020 2066 6e73 203d 205b  id().    fns = [
-00022560: 5d0a 2020 2020 666f 7220 6c69 6e65 2069  ].    for line i
-00022570: 6e20 6f70 656e 2822 2f70 726f 632f 2569  n open("/proc/%i
-00022580: 2f6d 6170 7322 2025 2070 6964 2c20 2272  /maps" % pid, "r
-00022590: 2229 2e72 6561 6428 292e 7370 6c69 746c  ").read().splitl
-000225a0: 696e 6573 2829 3a20 2023 2066 6f72 2065  ines():  # for e
-000225b0: 6163 6820 6d61 7070 6564 2072 6567 696f  ach mapped regio
-000225c0: 6e0a 2020 2020 2020 2020 2320 6874 7470  n.        # http
-000225d0: 733a 2f2f 7374 6163 6b6f 7665 7266 6c6f  s://stackoverflo
-000225e0: 772e 636f 6d2f 7175 6573 7469 6f6e 732f  w.com/questions/
-000225f0: 3134 3031 3335 392f 756e 6465 7273 7461  1401359/understa
-00022600: 6e64 696e 672d 6c69 6e75 782d 7072 6f63  nding-linux-proc
-00022610: 2d69 642d 6d61 7073 0a20 2020 2020 2020  -id-maps.       
-00022620: 2023 2061 6464 7265 7373 2020 2020 2020   # address      
-00022630: 2020 2020 2070 6572 6d73 206f 6666 7365       perms offse
-00022640: 7420 2064 6576 2020 2069 6e6f 6465 2020  t  dev   inode  
-00022650: 2070 6174 686e 616d 650a 2020 2020 2020   pathname.      
-00022660: 2020 2320 452e 672e 3a0a 2020 2020 2020    # E.g.:.      
-00022670: 2020 2320 3766 6632 6465 3931 6330 3030    # 7ff2de91c000
-00022680: 2d37 6666 3264 6539 3165 3030 3020 7277  -7ff2de91e000 rw
-00022690: 2d70 2030 3031 3763 3030 3020 3038 3a30  -p 0017c000 08:0
-000226a0: 3220 3739 3438 3434 2020 2020 2020 2020  2 794844        
-000226b0: 2020 2020 2020 2020 2020 2020 202f 7573               /us
-000226c0: 722f 6c69 622f 7838 365f 3634 2d6c 696e  r/lib/x86_64-lin
-000226d0: 7578 2d67 6e75 2f6c 6962 7374 6463 2b2e  ux-gnu/libstdc+.
-000226e0: 2e2e 0a20 2020 2020 2020 206d 203d 2072  ...        m = r
-000226f0: 652e 6d61 7463 6828 0a20 2020 2020 2020  e.match(.       
-00022700: 2020 2020 2072 225e 285b 302d 3941 2d46       r"^([0-9A-F
-00022710: 612d 665d 2b29 2d28 5b30 2d39 412d 4661  a-f]+)-([0-9A-Fa
-00022720: 2d66 5d2b 295c 732b 285b 7277 7870 735c  -f]+)\s+([rwxps\
-00022730: 2d5d 2b29 5c73 2b28 5b30 2d39 412d 4661  -]+)\s+([0-9A-Fa
-00022740: 2d66 5d2b 295c 732b 285b 302d 3941 2d46  -f]+)\s+([0-9A-F
-00022750: 612d 663a 5d2b 295c 732b 285b 302d 395d  a-f:]+)\s+([0-9]
-00022760: 2b29 5c73 2a28 2e2a 2924 222c 206c 696e  +)\s*(.*)$", lin
-00022770: 650a 2020 2020 2020 2020 290a 2020 2020  e.        ).    
-00022780: 2020 2020 6173 7365 7274 206d 2c20 226e      assert m, "n
-00022790: 6f20 6d61 7463 6820 666f 7220 2572 2220  o match for %r" 
-000227a0: 2520 6c69 6e65 0a20 2020 2020 2020 2061  % line.        a
-000227b0: 6464 7265 7373 5f73 7461 7274 2c20 6164  ddress_start, ad
-000227c0: 6472 6573 735f 656e 642c 2070 6572 6d73  dress_end, perms
-000227d0: 2c20 6f66 6673 6574 2c20 6465 762c 2069  , offset, dev, i
-000227e0: 5f6e 6f64 652c 2070 6174 685f 6e61 6d65  _node, path_name
-000227f0: 203d 206d 2e67 726f 7570 7328 290a 2020   = m.groups().  
-00022800: 2020 2020 2020 6966 2022 7822 206e 6f74        if "x" not
-00022810: 2069 6e20 7065 726d 733a 0a20 2020 2020   in perms:.     
-00022820: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00022830: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
-00022840: 6174 685f 6e61 6d65 206f 7220 7061 7468  ath_name or path
-00022850: 5f6e 616d 652e 7374 6172 7473 7769 7468  _name.startswith
-00022860: 2822 5b22 2920 6f72 2022 2864 656c 6574  ("[") or "(delet
-00022870: 6564 2922 2069 6e20 7061 7468 5f6e 616d  ed)" in path_nam
-00022880: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-00022890: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-000228a0: 6966 2070 6174 685f 6e61 6d65 206e 6f74  if path_name not
-000228b0: 2069 6e20 666e 733a 0a20 2020 2020 2020   in fns:.       
-000228c0: 2020 2020 2066 6e73 2e61 7070 656e 6428       fns.append(
-000228d0: 7061 7468 5f6e 616d 6529 0a20 2020 2072  path_name).    r
-000228e0: 6574 7572 6e20 666e 730a 0a0a 6465 6620  eturn fns...def 
-000228f0: 6669 6e64 5f73 796d 5f69 6e5f 6578 6563  find_sym_in_exec
-00022900: 2866 6e2c 2073 796d 293a 0a20 2020 2022  (fn, sym):.    "
-00022910: 2222 0a20 2020 2055 7365 7320 6060 6f62  "".    Uses ``ob
-00022920: 6a64 756d 7060 6020 746f 206c 6973 7420  jdump`` to list 
-00022930: 6176 6169 6c61 626c 6520 7379 6d62 6f6c  available symbol
-00022940: 732c 2061 6e64 2066 696c 7465 7273 2074  s, and filters t
-00022950: 6865 6d20 6279 2074 6865 2067 6976 656e  hem by the given
-00022960: 2060 6073 796d 6060 2e0a 0a20 2020 203a   ``sym``...    :
-00022970: 7061 7261 6d20 7374 7220 666e 3a20 7061  param str fn: pa
-00022980: 7468 0a20 2020 203a 7061 7261 6d20 7374  th.    :param st
-00022990: 7220 7379 6d3a 0a20 2020 203a 7265 7475  r sym:.    :retu
-000229a0: 726e 3a20 6d61 7463 6865 6420 6f75 742c  rn: matched out,
-000229b0: 206f 7220 4e6f 6e65 0a20 2020 203a 7274   or None.    :rt
-000229c0: 7970 653a 2073 7472 7c4e 6f6e 650a 2020  ype: str|None.  
-000229d0: 2020 2222 220a 2020 2020 6672 6f6d 2073    """.    from s
-000229e0: 7562 7072 6f63 6573 7320 696d 706f 7274  ubprocess import
-000229f0: 2043 616c 6c65 6450 726f 6365 7373 4572   CalledProcessEr
-00022a00: 726f 720a 0a20 2020 206f 626a 6475 6d70  ror..    objdump
-00022a10: 203d 2022 6f62 6a64 756d 7020 2d54 220a   = "objdump -T".
-00022a20: 2020 2020 6966 2073 7973 2e70 6c61 7466      if sys.platf
-00022a30: 6f72 6d20 3d3d 2022 6461 7277 696e 223a  orm == "darwin":
-00022a40: 0a20 2020 2020 2020 206f 626a 6475 6d70  .        objdump
-00022a50: 203d 2022 6f74 6f6f 6c20 2d49 4847 7622   = "otool -IHGv"
-00022a60: 0a20 2020 2073 6865 6c6c 5f63 6d64 203d  .    shell_cmd =
-00022a70: 2022 2573 2025 7320 7c20 6772 6570 2025   "%s %s | grep %
-00022a80: 7322 2025 2028 6f62 6a64 756d 702c 2066  s" % (objdump, f
-00022a90: 6e2c 2073 796d 290a 2020 2020 7472 793a  n, sym).    try:
-00022aa0: 0a20 2020 2020 2020 206f 7574 203d 2073  .        out = s
-00022ab0: 7973 5f65 7865 635f 6f75 7428 7368 656c  ys_exec_out(shel
-00022ac0: 6c5f 636d 642c 2073 6865 6c6c 3d54 7275  l_cmd, shell=Tru
-00022ad0: 6529 0a20 2020 2065 7863 6570 7420 4361  e).    except Ca
-00022ae0: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-00022af0: 3a20 2023 206e 6f6e 6520 666f 756e 640a  :  # none found.
-00022b00: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00022b10: 6f6e 650a 2020 2020 6173 7365 7274 2069  one.    assert i
-00022b20: 7369 6e73 7461 6e63 6528 6f75 742c 2028  sinstance(out, (
-00022b30: 7374 722c 2075 6e69 636f 6465 2929 0a20  str, unicode)). 
-00022b40: 2020 206f 7574 5f6c 6e73 203d 206f 7574     out_lns = out
-00022b50: 2e73 706c 6974 6c69 6e65 7328 290a 2020  .splitlines().  
-00022b60: 2020 6f75 745f 6c6e 7320 3d20 5b6c 6e20    out_lns = [ln 
-00022b70: 666f 7220 6c6e 2069 6e20 6f75 745f 6c6e  for ln in out_ln
-00022b80: 7320 6966 2022 2e74 6578 7422 2069 6e20  s if ".text" in 
-00022b90: 6c6e 5d20 2023 2073 6565 206f 626a 6475  ln]  # see objdu
-00022ba0: 6d70 0a20 2020 206f 7574 5f6c 6e73 203d  mp.    out_lns =
-00022bb0: 205b 6c6e 2066 6f72 206c 6e20 696e 206f   [ln for ln in o
-00022bc0: 7574 5f6c 6e73 2069 6620 7379 6d20 696e  ut_lns if sym in
-00022bd0: 206c 6e2e 7370 6c69 7428 295d 0a20 2020   ln.split()].   
-00022be0: 2069 6620 6e6f 7420 6f75 745f 6c6e 733a   if not out_lns:
-00022bf0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00022c00: 4e6f 6e65 0a20 2020 2072 6574 7572 6e20  None.    return 
-00022c10: 2246 6f75 6e64 2025 7220 696e 2025 723a  "Found %r in %r:
-00022c20: 5c6e 2573 2220 2520 2873 796d 2c20 666e  \n%s" % (sym, fn
-00022c30: 2c20 225c 6e22 2e6a 6f69 6e28 6f75 745f  , "\n".join(out_
-00022c40: 6c6e 7329 290a 0a0a 6465 6620 6475 6d6d  lns))...def dumm
-00022c50: 795f 6e75 6d70 795f 6765 6d6d 5f63 616c  y_numpy_gemm_cal
-00022c60: 6c28 293a 0a20 2020 2022 2222 0a20 2020  l():.    """.   
-00022c70: 204a 7573 7420 7065 7266 6f72 6d73 2073   Just performs s
-00022c80: 6f6d 6520 4745 4d4d 2063 616c 6c20 7669  ome GEMM call vi
-00022c90: 6120 4e75 6d70 792e 0a20 2020 2054 6869  a Numpy..    Thi
-00022ca0: 7320 6d61 6b65 7320 7375 7265 2074 6861  s makes sure tha
-00022cb0: 7420 7468 6520 424c 4153 206c 6962 7261  t the BLAS libra
-00022cc0: 7279 2069 7320 6c6f 6164 6564 2e0a 2020  ry is loaded..  
-00022cd0: 2020 2222 220a 2020 2020 696d 706f 7274    """.    import
-00022ce0: 206e 756d 7079 0a0a 2020 2020 6120 3d20   numpy..    a = 
-00022cf0: 6e75 6d70 792e 7261 6e64 6f6d 2e72 616e  numpy.random.ran
-00022d00: 646e 2835 2c20 3329 2e61 7374 7970 6528  dn(5, 3).astype(
-00022d10: 6e75 6d70 792e 666c 6f61 7433 3229 0a20  numpy.float32). 
-00022d20: 2020 2062 203d 206e 756d 7079 2e72 616e     b = numpy.ran
-00022d30: 646f 6d2e 7261 6e64 6e28 332c 2037 292e  dom.randn(3, 7).
-00022d40: 6173 7479 7065 286e 756d 7079 2e66 6c6f  astype(numpy.flo
-00022d50: 6174 3332 290a 2020 2020 6320 3d20 6e75  at32).    c = nu
-00022d60: 6d70 792e 646f 7428 612c 2062 290a 2020  mpy.dot(a, b).  
-00022d70: 2020 6173 7365 7274 206e 756d 7079 2e69    assert numpy.i
-00022d80: 7366 696e 6974 6528 6329 2e61 6c6c 2829  sfinite(c).all()
-00022d90: 0a0a 0a5f 6669 6e64 5f73 6765 6d6d 5f6c  ..._find_sgemm_l
-00022da0: 6962 5f66 726f 6d5f 7275 6e74 696d 655f  ib_from_runtime_
-00022db0: 6361 6368 6564 203d 204e 6f6e 650a 0a0a  cached = None...
-00022dc0: 6465 6620 6669 6e64 5f73 6765 6d6d 5f6c  def find_sgemm_l
-00022dd0: 6962 735f 6672 6f6d 5f72 756e 7469 6d65  ibs_from_runtime
-00022de0: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
-00022df0: 4c6f 6f6b 7320 7468 726f 7567 6820 616c  Looks through al
-00022e00: 6c20 6c69 6273 2076 6961 203a 6675 6e63  l libs via :func
-00022e10: 3a60 636f 6c6c 6563 745f 7072 6f63 5f6d  :`collect_proc_m
-00022e20: 6170 735f 6578 6563 5f66 696c 6573 602c  aps_exec_files`,
-00022e30: 0a20 2020 2061 6e64 2073 6561 7263 6865  .    and searche
-00022e40: 7320 666f 7220 616c 6c20 7768 6963 6820  s for all which 
-00022e50: 6861 7665 2074 6865 2060 6073 6765 6d6d  have the ``sgemm
-00022e60: 6060 2073 796d 626f 6c2e 0a20 2020 2043  `` symbol..    C
-00022e70: 7572 7265 6e74 6c79 206f 6e6c 7920 776f  urrently only wo
-00022e80: 726b 7320 6f6e 204c 696e 7578 2028 6265  rks on Linux (be
-00022e90: 6361 7573 6520 636f 6c6c 6563 745f 7072  cause collect_pr
-00022ea0: 6f63 5f6d 6170 735f 6578 6563 5f66 696c  oc_maps_exec_fil
-00022eb0: 6573 292e 0a0a 2020 2020 3a72 6574 7572  es)...    :retur
-00022ec0: 6e3a 206c 6973 7420 6f66 206c 6962 7320  n: list of libs 
-00022ed0: 2874 6865 6972 2070 6174 6829 0a20 2020  (their path).   
-00022ee0: 203a 7274 7970 653a 206c 6973 745b 7374   :rtype: list[st
-00022ef0: 725d 0a20 2020 2022 2222 0a20 2020 2069  r].    """.    i
-00022f00: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
-00022f10: 6973 7473 2822 2f70 726f 6322 293a 0a20  ists("/proc"):. 
-00022f20: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00022f30: 6e65 0a20 2020 2067 6c6f 6261 6c20 5f66  ne.    global _f
-00022f40: 696e 645f 7367 656d 6d5f 6c69 625f 6672  ind_sgemm_lib_fr
-00022f50: 6f6d 5f72 756e 7469 6d65 5f63 6163 6865  om_runtime_cache
-00022f60: 640a 2020 2020 6966 205f 6669 6e64 5f73  d.    if _find_s
-00022f70: 6765 6d6d 5f6c 6962 5f66 726f 6d5f 7275  gemm_lib_from_ru
-00022f80: 6e74 696d 655f 6361 6368 6564 2069 7320  ntime_cached is 
-00022f90: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00022fa0: 2020 7265 7475 726e 205f 6669 6e64 5f73    return _find_s
-00022fb0: 6765 6d6d 5f6c 6962 5f66 726f 6d5f 7275  gemm_lib_from_ru
-00022fc0: 6e74 696d 655f 6361 6368 6564 0a20 2020  ntime_cached.   
-00022fd0: 2064 756d 6d79 5f6e 756d 7079 5f67 656d   dummy_numpy_gem
-00022fe0: 6d5f 6361 6c6c 2829 2020 2320 6d61 6b65  m_call()  # make
-00022ff0: 2073 7572 6520 7468 6174 204e 756d 7079   sure that Numpy
-00023000: 2069 7320 6c6f 6164 6564 2061 6e64 204e   is loaded and N
-00023010: 756d 7079 2073 6765 6d6d 2069 7320 6176  umpy sgemm is av
-00023020: 6169 6c61 626c 650a 2020 2020 666e 7320  ailable.    fns 
-00023030: 3d20 636f 6c6c 6563 745f 7072 6f63 5f6d  = collect_proc_m
-00023040: 6170 735f 6578 6563 5f66 696c 6573 2829  aps_exec_files()
-00023050: 0a20 2020 2066 6e73 5f77 6974 685f 7367  .    fns_with_sg
-00023060: 656d 6d20 3d20 5b5d 0a20 2020 2066 6f72  emm = [].    for
-00023070: 2066 6e20 696e 2066 6e73 3a0a 2020 2020   fn in fns:.    
-00023080: 2020 2020 6f75 7420 3d20 6669 6e64 5f73      out = find_s
-00023090: 796d 5f69 6e5f 6578 6563 2866 6e2c 2022  ym_in_exec(fn, "
-000230a0: 7367 656d 6d5f 2229 0a20 2020 2020 2020  sgemm_").       
-000230b0: 2069 6620 6f75 743a 0a20 2020 2020 2020   if out:.       
-000230c0: 2020 2020 2066 6e73 5f77 6974 685f 7367       fns_with_sg
-000230d0: 656d 6d2e 6170 7065 6e64 2866 6e29 0a20  emm.append(fn). 
-000230e0: 2020 205f 6669 6e64 5f73 6765 6d6d 5f6c     _find_sgemm_l
-000230f0: 6962 5f66 726f 6d5f 7275 6e74 696d 655f  ib_from_runtime_
-00023100: 6361 6368 6564 203d 2066 6e73 5f77 6974  cached = fns_wit
-00023110: 685f 7367 656d 6d0a 2020 2020 7265 7475  h_sgemm.    retu
-00023120: 726e 2066 6e73 5f77 6974 685f 7367 656d  rn fns_with_sgem
-00023130: 6d0a 0a0a 5f66 696e 645f 6c69 6263 7564  m..._find_libcud
-00023140: 6172 745f 6672 6f6d 5f72 756e 7469 6d65  art_from_runtime
-00023150: 5f63 6163 6865 6420 3d20 4e6f 6e65 0a0a  _cached = None..
-00023160: 0a64 6566 2066 696e 645f 6c69 6263 7564  .def find_libcud
-00023170: 6172 745f 6672 6f6d 5f72 756e 7469 6d65  art_from_runtime
-00023180: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
-00023190: 4c6f 6f6b 7320 7468 726f 7567 6820 616c  Looks through al
-000231a0: 6c20 6c69 6273 2076 6961 203a 6675 6e63  l libs via :func
-000231b0: 3a60 636f 6c6c 6563 745f 7072 6f63 5f6d  :`collect_proc_m
-000231c0: 6170 735f 6578 6563 5f66 696c 6573 602c  aps_exec_files`,
-000231d0: 0a20 2020 2061 6e64 2073 6561 7263 6865  .    and searche
-000231e0: 7320 666f 7220 616c 6c20 7768 6963 6820  s for all which 
-000231f0: 6861 7665 2074 6865 2060 6073 6765 6d6d  have the ``sgemm
-00023200: 6060 2073 796d 626f 6c2e 0a20 2020 2043  `` symbol..    C
-00023210: 7572 7265 6e74 6c79 206f 6e6c 7920 776f  urrently only wo
-00023220: 726b 7320 6f6e 204c 696e 7578 2028 6265  rks on Linux (be
-00023230: 6361 7573 6520 636f 6c6c 6563 745f 7072  cause collect_pr
-00023240: 6f63 5f6d 6170 735f 6578 6563 5f66 696c  oc_maps_exec_fil
-00023250: 6573 292e 0a0a 2020 2020 3a72 6574 7572  es)...    :retur
-00023260: 6e3a 206c 6973 7420 6f66 206c 6962 7320  n: list of libs 
-00023270: 2874 6865 6972 2070 6174 6829 0a20 2020  (their path).   
-00023280: 203a 7274 7970 653a 2073 7472 7c4e 6f6e   :rtype: str|Non
-00023290: 650a 2020 2020 2222 220a 2020 2020 6966  e.    """.    if
-000232a0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-000232b0: 7374 7328 222f 7072 6f63 2229 3a0a 2020  sts("/proc"):.  
-000232c0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-000232d0: 650a 2020 2020 676c 6f62 616c 205f 6669  e.    global _fi
-000232e0: 6e64 5f6c 6962 6375 6461 7274 5f66 726f  nd_libcudart_fro
-000232f0: 6d5f 7275 6e74 696d 655f 6361 6368 6564  m_runtime_cached
-00023300: 0a20 2020 2069 6620 5f66 696e 645f 6c69  .    if _find_li
-00023310: 6263 7564 6172 745f 6672 6f6d 5f72 756e  bcudart_from_run
-00023320: 7469 6d65 5f63 6163 6865 6420 6973 206e  time_cached is n
-00023330: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00023340: 2072 6574 7572 6e20 5f66 696e 645f 6c69   return _find_li
-00023350: 6263 7564 6172 745f 6672 6f6d 5f72 756e  bcudart_from_run
-00023360: 7469 6d65 5f63 6163 6865 645b 305d 0a20  time_cached[0]. 
-00023370: 2020 2066 6e73 203d 2063 6f6c 6c65 6374     fns = collect
-00023380: 5f70 726f 635f 6d61 7073 5f65 7865 635f  _proc_maps_exec_
-00023390: 6669 6c65 7328 290a 2020 2020 666f 7220  files().    for 
-000233a0: 666e 2069 6e20 666e 733a 0a20 2020 2020  fn in fns:.     
-000233b0: 2020 2069 6620 7265 2e6d 6174 6368 2822     if re.match("
-000233c0: 2e2a 2f6c 6962 6375 6461 7274 5c5c 2e73  .*/libcudart\\.s
-000233d0: 6f28 5c5c 2e2e 2a29 3f22 2c20 666e 293a  o(\\..*)?", fn):
-000233e0: 0a20 2020 2020 2020 2020 2020 205f 6669  .            _fi
-000233f0: 6e64 5f6c 6962 6375 6461 7274 5f66 726f  nd_libcudart_fro
-00023400: 6d5f 7275 6e74 696d 655f 6361 6368 6564  m_runtime_cached
-00023410: 203d 205b 666e 5d0a 2020 2020 2020 2020   = [fn].        
-00023420: 2020 2020 7265 7475 726e 2066 6e0a 2020      return fn.  
-00023430: 2020 5f66 696e 645f 6c69 6263 7564 6172    _find_libcudar
-00023440: 745f 6672 6f6d 5f72 756e 7469 6d65 5f63  t_from_runtime_c
-00023450: 6163 6865 6420 3d20 5b4e 6f6e 655d 0a20  ached = [None]. 
-00023460: 2020 2072 6574 7572 6e20 4e6f 6e65 0a       return None.
+0000cad0: 2020 2020 2020 2020 2020 2072 6574 202b             ret +
+0000cae0: 3d20 5b22 225d 0a20 2020 2020 2020 2020  = [""].         
+0000caf0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000cb00: 6574 5b2d 315d 202b 3d20 630a 2020 2020  et[-1] += c.    
+0000cb10: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000cb20: 3a20 2023 206e 6f74 2077 6f72 645f 6261  :  # not word_ba
+0000cb30: 7365 640a 2020 2020 2020 2020 2020 2020  sed.            
+0000cb40: 2020 2020 2020 2020 7265 7420 2b3d 2063          ret += c
+0000cb50: 0a20 2020 2072 6574 7572 6e20 7265 740a  .    return ret.
+0000cb60: 0a0a 6465 6620 7061 7273 655f 6f72 7468  ..def parse_orth
+0000cb70: 6f67 7261 7068 7928 0a20 2020 206f 7274  ography(.    ort
+0000cb80: 686f 6772 6170 6879 2c20 7072 6566 6978  hography, prefix
+0000cb90: 3d28 292c 2070 6f73 7466 6978 3d28 225b  =(), postfix=("[
+0000cba0: 454e 445d 222c 292c 2072 656d 6f76 655f  END]",), remove_
+0000cbb0: 6368 6172 733d 2228 297b 7d22 2c20 636f  chars="(){}", co
+0000cbc0: 6c6c 6170 7365 5f73 7061 6365 733d 5472  llapse_spaces=Tr
+0000cbd0: 7565 2c20 6669 6e61 6c5f 7374 7269 703d  ue, final_strip=
+0000cbe0: 5472 7565 2c20 2a2a 6b77 6172 6773 0a29  True, **kwargs.)
+0000cbf0: 3a0a 2020 2020 2222 220a 2020 2020 466f  :.    """.    Fo
+0000cc00: 7220 5370 6565 6368 2e20 4675 6c6c 2070  r Speech. Full p
+0000cc10: 726f 6365 7373 696e 672e 0a20 2020 2045  rocessing..    E
+0000cc20: 7861 6d70 6c65 3a0a 2020 2020 2020 6f72  xample:.      or
+0000cc30: 7468 6f67 7261 7068 7920 3d20 2268 656c  thography = "hel
+0000cc40: 6c6f 205b 4845 5349 5441 5449 4f4e 5d20  lo [HESITATION] 
+0000cc50: 7468 6572 6520 220a 2020 2020 2020 7769  there ".      wi
+0000cc60: 7468 2077 6f72 645f 6261 7365 6420 3d3d  th word_based ==
+0000cc70: 2046 616c 7365 3a20 7265 7475 726e 7320   False: returns 
+0000cc80: 6c69 7374 2822 6865 6c6c 6f20 2229 202b  list("hello ") +
+0000cc90: 205b 225b 4845 5349 5441 5449 4f4e 5d22   ["[HESITATION]"
+0000cca0: 5d20 2b20 6c69 7374 2822 2074 6865 7265  ] + list(" there
+0000ccb0: 2229 202b 205b 225b 454e 445d 225d 0a20  ") + ["[END]"]. 
+0000ccc0: 2020 2020 2077 6974 6820 776f 7264 5f62       with word_b
+0000ccd0: 6173 6564 203d 3d20 5472 7565 3a20 7265  ased == True: re
+0000cce0: 7475 726e 7320 5b22 6865 6c6c 6f22 2c20  turns ["hello", 
+0000ccf0: 225b 4845 5349 5441 5449 4f4e 5d22 2c20  "[HESITATION]", 
+0000cd00: 2274 6865 7265 222c 2022 5b45 4e44 5d22  "there", "[END]"
+0000cd10: 5d0a 2020 2020 446f 6573 2073 6f6d 6520  ].    Does some 
+0000cd20: 7072 6570 726f 6365 7373 696e 6720 6f6e  preprocessing on
+0000cd30: 206f 7274 686f 6772 6170 6879 2061 6e64   orthography and
+0000cd40: 2074 6865 6e20 7061 7373 6573 2069 7420   then passes it 
+0000cd50: 6f6e 2074 6f20 7061 7273 655f 6f72 7468  on to parse_orth
+0000cd60: 6f67 7261 7068 795f 696e 746f 5f73 796d  ography_into_sym
+0000cd70: 626f 6c73 2829 2e0a 0a20 2020 203a 7061  bols()...    :pa
+0000cd80: 7261 6d20 7374 7220 6f72 7468 6f67 7261  ram str orthogra
+0000cd90: 7068 793a 2065 2e67 2e20 2268 656c 6c6f  phy: e.g. "hello
+0000cda0: 205b 4845 5349 5441 5449 4f4e 5d20 7468   [HESITATION] th
+0000cdb0: 6572 6520 220a 2020 2020 3a70 6172 616d  ere ".    :param
+0000cdc0: 206c 6973 745b 7374 725d 2070 7265 6669   list[str] prefi
+0000cdd0: 783a 2077 696c 6c20 6164 6420 7468 6973  x: will add this
+0000cde0: 2070 7265 6669 780a 2020 2020 3a70 6172   prefix.    :par
+0000cdf0: 616d 206c 6973 745b 7374 725d 2070 6f73  am list[str] pos
+0000ce00: 7466 6978 3a20 7769 6c6c 2061 6464 2074  tfix: will add t
+0000ce10: 6869 7320 706f 7374 6669 780a 2020 2020  his postfix.    
+0000ce20: 3a70 6172 616d 2073 7472 2072 656d 6f76  :param str remov
+0000ce30: 655f 6368 6172 733a 2074 686f 7365 2063  e_chars: those c
+0000ce40: 6861 7273 2077 696c 6c20 6a75 7374 2062  hars will just b
+0000ce50: 6520 7265 6d6f 7665 6420 6174 2074 6865  e removed at the
+0000ce60: 2062 6567 696e 6e69 6e67 0a20 2020 203a   beginning.    :
+0000ce70: 7061 7261 6d20 626f 6f6c 2063 6f6c 6c61  param bool colla
+0000ce80: 7073 655f 7370 6163 6573 3a20 7768 6574  pse_spaces: whet
+0000ce90: 6865 7220 6d75 6c74 6970 6c65 2073 7061  her multiple spa
+0000cea0: 6365 7320 616e 6420 7461 6273 2061 7265  ces and tabs are
+0000ceb0: 2063 6f6c 6c61 7073 6564 2069 6e74 6f20   collapsed into 
+0000cec0: 6120 7369 6e67 6c65 2073 7061 6365 0a20  a single space. 
+0000ced0: 2020 203a 7061 7261 6d20 626f 6f6c 2066     :param bool f
+0000cee0: 696e 616c 5f73 7472 6970 3a20 7768 6574  inal_strip: whet
+0000cef0: 6865 7220 7765 2073 7472 6970 206c 6566  her we strip lef
+0000cf00: 7420 616e 6420 7269 6768 740a 2020 2020  t and right.    
+0000cf10: 3a70 6172 616d 206b 7761 7267 733a 2070  :param kwargs: p
+0000cf20: 6173 7365 6420 6f6e 2074 6f20 7061 7273  assed on to pars
+0000cf30: 655f 6f72 7468 6f67 7261 7068 795f 696e  e_orthography_in
+0000cf40: 746f 5f73 796d 626f 6c73 2829 0a20 2020  to_symbols().   
+0000cf50: 203a 7274 7970 653a 206c 6973 745b 7374   :rtype: list[st
+0000cf60: 725d 0a20 2020 2022 2222 0a20 2020 2066  r].    """.    f
+0000cf70: 6f72 2063 2069 6e20 7265 6d6f 7665 5f63  or c in remove_c
+0000cf80: 6861 7273 3a0a 2020 2020 2020 2020 6f72  hars:.        or
+0000cf90: 7468 6f67 7261 7068 7920 3d20 6f72 7468  thography = orth
+0000cfa0: 6f67 7261 7068 792e 7265 706c 6163 6528  ography.replace(
+0000cfb0: 632c 2022 2229 0a20 2020 2069 6620 636f  c, "").    if co
+0000cfc0: 6c6c 6170 7365 5f73 7061 6365 733a 0a20  llapse_spaces:. 
+0000cfd0: 2020 2020 2020 206f 7274 686f 6772 6170         orthograp
+0000cfe0: 6879 203d 2022 2022 2e6a 6f69 6e28 6f72  hy = " ".join(or
+0000cff0: 7468 6f67 7261 7068 792e 7370 6c69 7428  thography.split(
+0000d000: 2929 0a20 2020 2069 6620 6669 6e61 6c5f  )).    if final_
+0000d010: 7374 7269 703a 0a20 2020 2020 2020 206f  strip:.        o
+0000d020: 7274 686f 6772 6170 6879 203d 206f 7274  rthography = ort
+0000d030: 686f 6772 6170 6879 2e73 7472 6970 2829  hography.strip()
+0000d040: 0a20 2020 2072 6574 7572 6e20 6c69 7374  .    return list
+0000d050: 2870 7265 6669 7829 202b 2070 6172 7365  (prefix) + parse
+0000d060: 5f6f 7274 686f 6772 6170 6879 5f69 6e74  _orthography_int
+0000d070: 6f5f 7379 6d62 6f6c 7328 6f72 7468 6f67  o_symbols(orthog
+0000d080: 7261 7068 792c 202a 2a6b 7761 7267 7329  raphy, **kwargs)
+0000d090: 202b 206c 6973 7428 706f 7374 6669 7829   + list(postfix)
+0000d0a0: 0a0a 0a64 6566 206a 736f 6e5f 7265 6d6f  ...def json_remo
+0000d0b0: 7665 5f63 6f6d 6d65 6e74 7328 7374 7269  ve_comments(stri
+0000d0c0: 6e67 2c20 7374 7269 705f 7370 6163 653d  ng, strip_space=
+0000d0d0: 5472 7565 293a 0a20 2020 2022 2222 0a20  True):.    """. 
+0000d0e0: 2020 203a 7479 7065 2073 7472 696e 673a     :type string:
+0000d0f0: 2073 7472 0a20 2020 203a 7061 7261 6d20   str.    :param 
+0000d100: 626f 6f6c 2073 7472 6970 5f73 7061 6365  bool strip_space
+0000d110: 3a0a 2020 2020 3a72 7479 7065 3a20 7374  :.    :rtype: st
+0000d120: 720a 0a20 2020 2076 6961 2068 7474 7073  r..    via https
+0000d130: 3a2f 2f67 6974 6875 622e 636f 6d2f 6765  ://github.com/ge
+0000d140: 7469 6679 2f4a 534f 4e2e 6d69 6e69 6679  tify/JSON.minify
+0000d150: 2f62 6c6f 622f 6d61 7374 6572 2f6d 696e  /blob/master/min
+0000d160: 6966 795f 6a73 6f6e 2e70 792c 0a20 2020  ify_json.py,.   
+0000d170: 2062 7920 4765 7261 6c64 2053 746f 7265   by Gerald Store
+0000d180: 722c 2050 7261 6479 756e 2053 2e20 4765  r, Pradyun S. Ge
+0000d190: 6461 6d2c 206d 6f64 6966 6965 6420 6279  dam, modified by
+0000d1a0: 2075 732e 0a20 2020 2022 2222 0a20 2020   us..    """.   
+0000d1b0: 2074 6f6b 656e 697a 6572 203d 2072 652e   tokenizer = re.
+0000d1c0: 636f 6d70 696c 6528 2722 7c28 2f5c 5c2a  compile('"|(/\\*
+0000d1d0: 297c 285c 5c2a 2f29 7c28 2f2f 297c 5c6e  )|(\\*/)|(//)|\n
+0000d1e0: 7c5c 7227 290a 2020 2020 656e 645f 736c  |\r').    end_sl
+0000d1f0: 6173 6865 735f 7265 203d 2072 652e 636f  ashes_re = re.co
+0000d200: 6d70 696c 6528 7222 285c 5c29 2a24 2229  mpile(r"(\\)*$")
+0000d210: 0a0a 2020 2020 696e 5f73 7472 696e 6720  ..    in_string 
+0000d220: 3d20 4661 6c73 650a 2020 2020 696e 5f6d  = False.    in_m
+0000d230: 756c 7469 203d 2046 616c 7365 0a20 2020  ulti = False.   
+0000d240: 2069 6e5f 7369 6e67 6c65 203d 2046 616c   in_single = Fal
+0000d250: 7365 0a0a 2020 2020 6e65 775f 7374 7220  se..    new_str 
+0000d260: 3d20 5b5d 0a20 2020 2069 6e64 6578 203d  = [].    index =
+0000d270: 2030 0a0a 2020 2020 666f 7220 6d61 7463   0..    for matc
+0000d280: 6820 696e 2072 652e 6669 6e64 6974 6572  h in re.finditer
+0000d290: 2874 6f6b 656e 697a 6572 2c20 7374 7269  (tokenizer, stri
+0000d2a0: 6e67 293a 0a0a 2020 2020 2020 2020 6966  ng):..        if
+0000d2b0: 206e 6f74 2028 696e 5f6d 756c 7469 206f   not (in_multi o
+0000d2c0: 7220 696e 5f73 696e 676c 6529 3a0a 2020  r in_single):.  
+0000d2d0: 2020 2020 2020 2020 2020 746d 7020 3d20            tmp = 
+0000d2e0: 7374 7269 6e67 5b69 6e64 6578 203a 206d  string[index : m
+0000d2f0: 6174 6368 2e73 7461 7274 2829 5d0a 2020  atch.start()].  
+0000d300: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000d310: 2069 6e5f 7374 7269 6e67 2061 6e64 2073   in_string and s
+0000d320: 7472 6970 5f73 7061 6365 3a0a 2020 2020  trip_space:.    
+0000d330: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+0000d340: 706c 6163 6520 7768 6974 6520 7370 6163  place white spac
+0000d350: 6520 6173 2064 6566 696e 6564 2069 6e20  e as defined in 
+0000d360: 7374 616e 6461 7264 0a20 2020 2020 2020  standard.       
+0000d370: 2020 2020 2020 2020 2074 6d70 203d 2072           tmp = r
+0000d380: 652e 7375 6228 225b 205c 745c 6e5c 725d  e.sub("[ \t\n\r]
+0000d390: 2b22 2c20 2222 2c20 746d 7029 0a20 2020  +", "", tmp).   
+0000d3a0: 2020 2020 2020 2020 206e 6577 5f73 7472           new_str
+0000d3b0: 2e61 7070 656e 6428 746d 7029 0a0a 2020  .append(tmp)..  
+0000d3c0: 2020 2020 2020 696e 6465 7820 3d20 6d61        index = ma
+0000d3d0: 7463 682e 656e 6428 290a 2020 2020 2020  tch.end().      
+0000d3e0: 2020 7661 6c20 3d20 6d61 7463 682e 6772    val = match.gr
+0000d3f0: 6f75 7028 290a 0a20 2020 2020 2020 2069  oup()..        i
+0000d400: 6620 7661 6c20 3d3d 2027 2227 2061 6e64  f val == '"' and
+0000d410: 206e 6f74 2028 696e 5f6d 756c 7469 206f   not (in_multi o
+0000d420: 7220 696e 5f73 696e 676c 6529 3a0a 2020  r in_single):.  
+0000d430: 2020 2020 2020 2020 2020 6573 6361 7065            escape
+0000d440: 6420 3d20 656e 645f 736c 6173 6865 735f  d = end_slashes_
+0000d450: 7265 2e73 6561 7263 6828 7374 7269 6e67  re.search(string
+0000d460: 2c20 302c 206d 6174 6368 2e73 7461 7274  , 0, match.start
+0000d470: 2829 290a 0a20 2020 2020 2020 2020 2020  ())..           
+0000d480: 2023 2073 7461 7274 206f 6620 7374 7269   # start of stri
+0000d490: 6e67 206f 7220 756e 6573 6361 7065 6420  ng or unescaped 
+0000d4a0: 7175 6f74 6520 6368 6172 6163 7465 7220  quote character 
+0000d4b0: 746f 2065 6e64 2073 7472 696e 670a 2020  to end string.  
+0000d4c0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000d4d0: 2069 6e5f 7374 7269 6e67 206f 7220 2865   in_string or (e
+0000d4e0: 7363 6170 6564 2069 7320 4e6f 6e65 206f  scaped is None o
+0000d4f0: 7220 6c65 6e28 6573 6361 7065 642e 6772  r len(escaped.gr
+0000d500: 6f75 7028 2929 2025 2032 203d 3d20 3029  oup()) % 2 == 0)
+0000d510: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d520: 2020 696e 5f73 7472 696e 6720 3d20 6e6f    in_string = no
+0000d530: 7420 696e 5f73 7472 696e 670a 2020 2020  t in_string.    
+0000d540: 2020 2020 2020 2020 696e 6465 7820 2d3d          index -=
+0000d550: 2031 2020 2320 696e 636c 7564 6520 2220   1  # include " 
+0000d560: 6368 6172 6163 7465 7220 696e 206e 6578  character in nex
+0000d570: 7420 6361 7463 680a 2020 2020 2020 2020  t catch.        
+0000d580: 656c 6966 206e 6f74 2028 696e 5f73 7472  elif not (in_str
+0000d590: 696e 6720 6f72 2069 6e5f 6d75 6c74 6920  ing or in_multi 
+0000d5a0: 6f72 2069 6e5f 7369 6e67 6c65 293a 0a20  or in_single):. 
+0000d5b0: 2020 2020 2020 2020 2020 2069 6620 7661             if va
+0000d5c0: 6c20 3d3d 2022 2f2a 223a 0a20 2020 2020  l == "/*":.     
+0000d5d0: 2020 2020 2020 2020 2020 2069 6e5f 6d75             in_mu
+0000d5e0: 6c74 6920 3d20 5472 7565 0a20 2020 2020  lti = True.     
+0000d5f0: 2020 2020 2020 2065 6c69 6620 7661 6c20         elif val 
+0000d600: 3d3d 2022 2f2f 223a 0a20 2020 2020 2020  == "//":.       
+0000d610: 2020 2020 2020 2020 2069 6e5f 7369 6e67           in_sing
+0000d620: 6c65 203d 2054 7275 650a 2020 2020 2020  le = True.      
+0000d630: 2020 656c 6966 2076 616c 203d 3d20 222a    elif val == "*
+0000d640: 2f22 2061 6e64 2069 6e5f 6d75 6c74 6920  /" and in_multi 
+0000d650: 616e 6420 6e6f 7420 2869 6e5f 7374 7269  and not (in_stri
+0000d660: 6e67 206f 7220 696e 5f73 696e 676c 6529  ng or in_single)
+0000d670: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+0000d680: 5f6d 756c 7469 203d 2046 616c 7365 0a20  _multi = False. 
+0000d690: 2020 2020 2020 2065 6c69 6620 7661 6c20         elif val 
+0000d6a0: 696e 2022 5c72 5c6e 2220 616e 6420 6e6f  in "\r\n" and no
+0000d6b0: 7420 2869 6e5f 6d75 6c74 6920 6f72 2069  t (in_multi or i
+0000d6c0: 6e5f 7374 7269 6e67 2920 616e 6420 696e  n_string) and in
+0000d6d0: 5f73 696e 676c 653a 0a20 2020 2020 2020  _single:.       
+0000d6e0: 2020 2020 2069 6e5f 7369 6e67 6c65 203d       in_single =
+0000d6f0: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
+0000d700: 6c69 6620 6e6f 7420 2828 696e 5f6d 756c  lif not ((in_mul
+0000d710: 7469 206f 7220 696e 5f73 696e 676c 6529  ti or in_single)
+0000d720: 206f 7220 2876 616c 2069 6e20 2220 5c72   or (val in " \r
+0000d730: 5c6e 5c74 2220 616e 6420 7374 7269 705f  \n\t" and strip_
+0000d740: 7370 6163 6529 293a 0a20 2020 2020 2020  space)):.       
+0000d750: 2020 2020 206e 6577 5f73 7472 2e61 7070       new_str.app
+0000d760: 656e 6428 7661 6c29 0a0a 2020 2020 6e65  end(val)..    ne
+0000d770: 775f 7374 722e 6170 7065 6e64 2873 7472  w_str.append(str
+0000d780: 696e 675b 696e 6465 783a 5d29 0a20 2020  ing[index:]).   
+0000d790: 2072 6574 7572 6e20 2222 2e6a 6f69 6e28   return "".join(
+0000d7a0: 6e65 775f 7374 7229 0a0a 0a64 6566 205f  new_str)...def _
+0000d7b0: 7079 325f 756e 6963 6f64 655f 746f 5f73  py2_unicode_to_s
+0000d7c0: 7472 5f72 6563 7572 7369 7665 2873 293a  tr_recursive(s):
+0000d7d0: 0a20 2020 2022 2222 0a20 2020 2054 6869  .    """.    Thi
+0000d7e0: 7320 6973 2073 7570 706f 7365 6420 746f  s is supposed to
+0000d7f0: 2062 6520 7275 6e20 7769 7468 2050 7974   be run with Pyt
+0000d800: 686f 6e20 322e 0a20 2020 2041 6c73 6f20  hon 2..    Also 
+0000d810: 7365 6520 3a66 756e 633a 6061 735f 7374  see :func:`as_st
+0000d820: 7260 2061 6e64 203a 6675 6e63 3a60 7079  r` and :func:`py
+0000d830: 325f 7574 6638 5f73 7472 5f74 6f5f 756e  2_utf8_str_to_un
+0000d840: 6963 6f64 6560 2e0a 0a20 2020 203a 7061  icode`...    :pa
+0000d850: 7261 6d20 7374 727c 756e 6963 6f64 6520  ram str|unicode 
+0000d860: 733a 206f 7220 616e 7920 7265 6375 7273  s: or any recurs
+0000d870: 6976 6520 7374 7275 6374 7572 6520 7375  ive structure su
+0000d880: 6368 2061 7320 6469 6374 2c20 6c69 7374  ch as dict, list
+0000d890: 2c20 7475 706c 650a 2020 2020 3a72 6574  , tuple.    :ret
+0000d8a0: 7572 6e3a 2050 7974 686f 6e20 3220 7374  urn: Python 2 st
+0000d8b0: 7220 2869 7320 6c69 6b65 2050 7974 686f  r (is like Pytho
+0000d8c0: 6e20 3320 5554 462d 3820 666f 726d 6174  n 3 UTF-8 format
+0000d8d0: 7465 6420 6279 7465 7329 0a20 2020 203a  ted bytes).    :
+0000d8e0: 7274 7970 653a 2073 7472 0a20 2020 2022  rtype: str.    "
+0000d8f0: 2222 0a20 2020 2069 6620 6973 696e 7374  "".    if isinst
+0000d900: 616e 6365 2873 2c20 6469 6374 293a 0a20  ance(s, dict):. 
+0000d910: 2020 2020 2020 2072 6574 7572 6e20 7b5f         return {_
+0000d920: 7079 325f 756e 6963 6f64 655f 746f 5f73  py2_unicode_to_s
+0000d930: 7472 5f72 6563 7572 7369 7665 286b 6579  tr_recursive(key
+0000d940: 293a 205f 7079 325f 756e 6963 6f64 655f  ): _py2_unicode_
+0000d950: 746f 5f73 7472 5f72 6563 7572 7369 7665  to_str_recursive
+0000d960: 2876 616c 7565 2920 666f 7220 6b65 792c  (value) for key,
+0000d970: 2076 616c 7565 2069 6e20 732e 6974 656d   value in s.item
+0000d980: 7328 297d 0a20 2020 2065 6c69 6620 6973  s()}.    elif is
+0000d990: 696e 7374 616e 6365 2873 2c20 286c 6973  instance(s, (lis
+0000d9a0: 742c 2074 7570 6c65 2929 3a0a 2020 2020  t, tuple)):.    
+0000d9b0: 2020 2020 7265 7475 726e 206d 616b 655f      return make_
+0000d9c0: 7365 715f 6f66 5f74 7970 6528 7479 7065  seq_of_type(type
+0000d9d0: 2873 292c 205b 5f70 7932 5f75 6e69 636f  (s), [_py2_unico
+0000d9e0: 6465 5f74 6f5f 7374 725f 7265 6375 7273  de_to_str_recurs
+0000d9f0: 6976 6528 656c 656d 656e 7429 2066 6f72  ive(element) for
+0000da00: 2065 6c65 6d65 6e74 2069 6e20 735d 290a   element in s]).
+0000da10: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+0000da20: 6e63 6528 732c 2075 6e69 636f 6465 293a  nce(s, unicode):
+0000da30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000da40: 732e 656e 636f 6465 2822 7574 662d 3822  s.encode("utf-8"
+0000da50: 2920 2023 2050 7974 686f 6e20 3220 7374  )  # Python 2 st
+0000da60: 722c 2050 7974 686f 6e20 3320 6279 7465  r, Python 3 byte
+0000da70: 730a 2020 2020 656c 7365 3a0a 2020 2020  s.    else:.    
+0000da80: 2020 2020 7265 7475 726e 2073 0a0a 0a64      return s...d
+0000da90: 6566 206c 6f61 645f 6a73 6f6e 2866 696c  ef load_json(fil
+0000daa0: 656e 616d 653d 4e6f 6e65 2c20 636f 6e74  ename=None, cont
+0000dab0: 656e 743d 4e6f 6e65 293a 0a20 2020 2022  ent=None):.    "
+0000dac0: 2222 0a20 2020 203a 7061 7261 6d20 7374  "".    :param st
+0000dad0: 727c 4e6f 6e65 2066 696c 656e 616d 653a  r|None filename:
+0000dae0: 0a20 2020 203a 7061 7261 6d20 7374 727c  .    :param str|
+0000daf0: 4e6f 6e65 2063 6f6e 7465 6e74 3a0a 2020  None content:.  
+0000db00: 2020 3a72 7479 7065 3a20 6469 6374 5b73    :rtype: dict[s
+0000db10: 7472 5d0a 2020 2020 2222 220a 2020 2020  tr].    """.    
+0000db20: 6966 2063 6f6e 7465 6e74 3a0a 2020 2020  if content:.    
+0000db30: 2020 2020 6173 7365 7274 206e 6f74 2066      assert not f
+0000db40: 696c 656e 616d 650a 2020 2020 656c 7365  ilename.    else
+0000db50: 3a0a 2020 2020 2020 2020 636f 6e74 656e  :.        conten
+0000db60: 7420 3d20 6f70 656e 2866 696c 656e 616d  t = open(filenam
+0000db70: 6529 2e72 6561 6428 290a 2020 2020 696d  e).read().    im
+0000db80: 706f 7274 206a 736f 6e0a 0a20 2020 2063  port json..    c
+0000db90: 6f6e 7465 6e74 203d 206a 736f 6e5f 7265  ontent = json_re
+0000dba0: 6d6f 7665 5f63 6f6d 6d65 6e74 7328 636f  move_comments(co
+0000dbb0: 6e74 656e 7429 0a20 2020 2074 7279 3a0a  ntent).    try:.
+0000dbc0: 2020 2020 2020 2020 6a73 6f6e 5f63 6f6e          json_con
+0000dbd0: 7465 6e74 203d 206a 736f 6e2e 6c6f 6164  tent = json.load
+0000dbe0: 7328 636f 6e74 656e 7429 0a20 2020 2065  s(content).    e
+0000dbf0: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+0000dc00: 2061 7320 653a 0a20 2020 2020 2020 2072   as e:.        r
+0000dc10: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+0000dc20: 636f 6e66 6967 206c 6f6f 6b73 206c 696b  config looks lik
+0000dc30: 6520 4a53 4f4e 2062 7574 2069 6e76 616c  e JSON but inval
+0000dc40: 6964 206a 736f 6e20 636f 6e74 656e 742c  id json content,
+0000dc50: 2025 7222 2025 2065 290a 2020 2020 6966   %r" % e).    if
+0000dc60: 206e 6f74 2050 5933 3a0a 2020 2020 2020   not PY3:.      
+0000dc70: 2020 6a73 6f6e 5f63 6f6e 7465 6e74 203d    json_content =
+0000dc80: 205f 7079 325f 756e 6963 6f64 655f 746f   _py2_unicode_to
+0000dc90: 5f73 7472 5f72 6563 7572 7369 7665 286a  _str_recursive(j
+0000dca0: 736f 6e5f 636f 6e74 656e 7429 0a20 2020  son_content).   
+0000dcb0: 2072 6574 7572 6e20 6a73 6f6e 5f63 6f6e   return json_con
+0000dcc0: 7465 6e74 0a0a 0a63 6c61 7373 204e 756d  tent...class Num
+0000dcd0: 6265 7273 4469 6374 3a0a 2020 2020 2222  bersDict:.    ""
+0000dce0: 220a 2020 2020 4974 2773 206d 6f73 746c  ".    It's mostl
+0000dcf0: 7920 6c69 6b65 2064 6963 745b 7374 722c  y like dict[str,
+0000dd00: 666c 6f61 747c 696e 745d 2026 2073 6f6d  float|int] & som
+0000dd10: 6520 6f70 7469 6f6e 616c 2062 726f 6164  e optional broad
+0000dd20: 6361 7374 2064 6566 6175 6c74 2076 616c  cast default val
+0000dd30: 7565 2e0a 2020 2020 4974 2069 6d70 6c65  ue..    It imple
+0000dd40: 6d65 6e74 7320 7468 6520 7374 616e 6461  ments the standa
+0000dd50: 7264 206d 6174 6820 6269 6e20 6f70 7320  rd math bin ops 
+0000dd60: 696e 2061 2073 7472 6169 6768 742d 666f  in a straight-fo
+0000dd70: 7277 6172 6420 7761 792e 0a20 2020 2022  rward way..    "
+0000dd80: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+0000dd90: 6974 5f5f 2873 656c 662c 2061 7574 6f5f  it__(self, auto_
+0000dda0: 636f 6e76 6572 743d 4e6f 6e65 2c20 6e75  convert=None, nu
+0000ddb0: 6d62 6572 735f 6469 6374 3d4e 6f6e 652c  mbers_dict=None,
+0000ddc0: 2062 726f 6164 6361 7374 5f76 616c 7565   broadcast_value
+0000ddd0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0000dde0: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
+0000ddf0: 616d 2064 6963 747c 4e75 6d62 6572 7344  am dict|NumbersD
+0000de00: 6963 747c 5420 6175 746f 5f63 6f6e 7665  ict|T auto_conve
+0000de10: 7274 3a20 6669 7273 7420 6172 6775 6d65  rt: first argume
+0000de20: 6e74 2c20 736f 2074 6861 7420 7765 2063  nt, so that we c
+0000de30: 616e 2061 7574 6f6d 6174 6963 616c 6c79  an automatically
+0000de40: 2063 6f6e 7665 7274 2f63 6f70 790a 2020   convert/copy.  
+0000de50: 2020 2020 2020 3a70 6172 616d 2064 6963        :param dic
+0000de60: 7420 6e75 6d62 6572 735f 6469 6374 3a0a  t numbers_dict:.
+0000de70: 2020 2020 2020 2020 3a70 6172 616d 2054          :param T
+0000de80: 2062 726f 6164 6361 7374 5f76 616c 7565   broadcast_value
+0000de90: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000dea0: 2020 2020 2020 6966 2061 7574 6f5f 636f        if auto_co
+0000deb0: 6e76 6572 7420 6973 206e 6f74 204e 6f6e  nvert is not Non
+0000dec0: 653a 0a20 2020 2020 2020 2020 2020 2061  e:.            a
+0000ded0: 7373 6572 7420 6272 6f61 6463 6173 745f  ssert broadcast_
+0000dee0: 7661 6c75 6520 6973 204e 6f6e 650a 2020  value is None.  
+0000def0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000df00: 206e 756d 6265 7273 5f64 6963 7420 6973   numbers_dict is
+0000df10: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0000df20: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0000df30: 6175 746f 5f63 6f6e 7665 7274 2c20 6469  auto_convert, di
+0000df40: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
+0000df50: 2020 2020 206e 756d 6265 7273 5f64 6963       numbers_dic
+0000df60: 7420 3d20 6175 746f 5f63 6f6e 7665 7274  t = auto_convert
+0000df70: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0000df80: 6620 6973 696e 7374 616e 6365 2861 7574  f isinstance(aut
+0000df90: 6f5f 636f 6e76 6572 742c 204e 756d 6265  o_convert, Numbe
+0000dfa0: 7273 4469 6374 293a 0a20 2020 2020 2020  rsDict):.       
+0000dfb0: 2020 2020 2020 2020 206e 756d 6265 7273           numbers
+0000dfc0: 5f64 6963 7420 3d20 6175 746f 5f63 6f6e  _dict = auto_con
+0000dfd0: 7665 7274 2e64 6963 740a 2020 2020 2020  vert.dict.      
+0000dfe0: 2020 2020 2020 2020 2020 6272 6f61 6463            broadc
+0000dff0: 6173 745f 7661 6c75 6520 3d20 6175 746f  ast_value = auto
+0000e000: 5f63 6f6e 7665 7274 2e76 616c 7565 0a20  _convert.value. 
+0000e010: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000e020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e030: 2062 726f 6164 6361 7374 5f76 616c 7565   broadcast_value
+0000e040: 203d 2061 7574 6f5f 636f 6e76 6572 740a   = auto_convert.
+0000e050: 2020 2020 2020 2020 6966 206e 756d 6265          if numbe
+0000e060: 7273 5f64 6963 7420 6973 204e 6f6e 653a  rs_dict is None:
+0000e070: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+0000e080: 6265 7273 5f64 6963 7420 3d20 7b7d 0a20  bers_dict = {}. 
+0000e090: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000e0a0: 2020 2020 2020 2020 206e 756d 6265 7273           numbers
+0000e0b0: 5f64 6963 7420 3d20 6469 6374 286e 756d  _dict = dict(num
+0000e0c0: 6265 7273 5f64 6963 7429 2020 2320 666f  bers_dict)  # fo
+0000e0d0: 7263 6520 636f 7079 0a0a 2020 2020 2020  rce copy..      
+0000e0e0: 2020 7365 6c66 2e64 6963 7420 3d20 6e75    self.dict = nu
+0000e0f0: 6d62 6572 735f 6469 6374 0a20 2020 2020  mbers_dict.     
+0000e100: 2020 2073 656c 662e 7661 6c75 6520 3d20     self.value = 
+0000e110: 6272 6f61 6463 6173 745f 7661 6c75 650a  broadcast_value.
+0000e120: 2020 2020 2020 2020 7365 6c66 2e6d 6178          self.max
+0000e130: 203d 2073 656c 662e 5f6d 6178 5f65 7272   = self._max_err
+0000e140: 6f72 0a0a 2020 2020 6465 6620 636f 7079  or..    def copy
+0000e150: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000e160: 2222 220a 2020 2020 2020 2020 3a72 7479  """.        :rty
+0000e170: 7065 3a20 4e75 6d62 6572 7344 6963 740a  pe: NumbersDict.
+0000e180: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000e190: 2020 2020 7265 7475 726e 204e 756d 6265      return Numbe
+0000e1a0: 7273 4469 6374 2873 656c 6629 0a0a 2020  rsDict(self)..  
+0000e1b0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0000e1c0: 2020 2064 6566 2063 6f6e 7374 616e 745f     def constant_
+0000e1d0: 6c69 6b65 2863 6c73 2c20 636f 6e73 745f  like(cls, const_
+0000e1e0: 6e75 6d62 6572 2c20 6e75 6d62 6572 735f  number, numbers_
+0000e1f0: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
+0000e200: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
+0000e210: 6d20 696e 747c 666c 6f61 747c 6f62 6a65  m int|float|obje
+0000e220: 6374 2063 6f6e 7374 5f6e 756d 6265 723a  ct const_number:
+0000e230: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000e240: 4e75 6d62 6572 7344 6963 7420 6e75 6d62  NumbersDict numb
+0000e250: 6572 735f 6469 6374 3a0a 2020 2020 2020  ers_dict:.      
+0000e260: 2020 3a72 6574 7572 6e3a 204e 756d 6265    :return: Numbe
+0000e270: 7273 4469 6374 2077 6974 6820 7361 6d65  rsDict with same
+0000e280: 206b 6579 7320 6173 206e 756d 6265 7273   keys as numbers
+0000e290: 5f64 6963 740a 2020 2020 2020 2020 3a72  _dict.        :r
+0000e2a0: 7479 7065 3a20 4e75 6d62 6572 7344 6963  type: NumbersDic
+0000e2b0: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
+0000e2c0: 2020 2020 2020 7265 7475 726e 204e 756d        return Num
+0000e2d0: 6265 7273 4469 6374 280a 2020 2020 2020  bersDict(.      
+0000e2e0: 2020 2020 2020 6272 6f61 6463 6173 745f        broadcast_
+0000e2f0: 7661 6c75 653d 636f 6e73 745f 6e75 6d62  value=const_numb
+0000e300: 6572 2069 6620 286e 756d 6265 7273 5f64  er if (numbers_d
+0000e310: 6963 742e 7661 6c75 6520 6973 206e 6f74  ict.value is not
+0000e320: 204e 6f6e 6529 2065 6c73 6520 4e6f 6e65   None) else None
+0000e330: 2c0a 2020 2020 2020 2020 2020 2020 6e75  ,.            nu
+0000e340: 6d62 6572 735f 6469 6374 3d7b 6b3a 2063  mbers_dict={k: c
+0000e350: 6f6e 7374 5f6e 756d 6265 7220 666f 7220  onst_number for 
+0000e360: 6b20 696e 206e 756d 6265 7273 5f64 6963  k in numbers_dic
+0000e370: 742e 6469 6374 2e6b 6579 7328 297d 2c0a  t.dict.keys()},.
+0000e380: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+0000e390: 6566 2063 6f70 795f 6c69 6b65 2873 656c  ef copy_like(sel
+0000e3a0: 662c 206e 756d 6265 7273 5f64 6963 7429  f, numbers_dict)
+0000e3b0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000e3c0: 2020 2020 2020 3a70 6172 616d 204e 756d        :param Num
+0000e3d0: 6265 7273 4469 6374 206e 756d 6265 7273  bersDict numbers
+0000e3e0: 5f64 6963 743a 0a20 2020 2020 2020 203a  _dict:.        :
+0000e3f0: 7265 7475 726e 3a20 636f 7079 206f 6620  return: copy of 
+0000e400: 7365 6c66 2077 6974 6820 7361 6d65 206b  self with same k
+0000e410: 6579 7320 6173 206e 756d 6265 7273 5f64  eys as numbers_d
+0000e420: 6963 7420 6173 2066 6172 2061 7320 7765  ict as far as we
+0000e430: 2068 6176 6520 7468 656d 0a20 2020 2020   have them.     
+0000e440: 2020 203a 7274 7970 653a 204e 756d 6265     :rtype: Numbe
+0000e450: 7273 4469 6374 0a20 2020 2020 2020 2022  rsDict.        "
+0000e460: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
+0000e470: 6c66 2e76 616c 7565 2069 7320 6e6f 7420  lf.value is not 
+0000e480: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000e490: 2020 7265 7475 726e 204e 756d 6265 7273    return Numbers
+0000e4a0: 4469 6374 280a 2020 2020 2020 2020 2020  Dict(.          
+0000e4b0: 2020 2020 2020 6272 6f61 6463 6173 745f        broadcast_
+0000e4c0: 7661 6c75 653d 7365 6c66 2e76 616c 7565  value=self.value
+0000e4d0: 2069 6620 286e 756d 6265 7273 5f64 6963   if (numbers_dic
+0000e4e0: 742e 7661 6c75 6520 6973 206e 6f74 204e  t.value is not N
+0000e4f0: 6f6e 6529 2065 6c73 6520 4e6f 6e65 2c0a  one) else None,.
+0000e500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e510: 6e75 6d62 6572 735f 6469 6374 3d7b 6b3a  numbers_dict={k:
+0000e520: 2073 656c 665b 6b5d 2066 6f72 206b 2069   self[k] for k i
+0000e530: 6e20 6e75 6d62 6572 735f 6469 6374 2e64  n numbers_dict.d
+0000e540: 6963 742e 6b65 7973 2829 7d2c 0a20 2020  ict.keys()},.   
+0000e550: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000e560: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000e570: 2020 2020 2072 6574 7572 6e20 4e75 6d62       return Numb
+0000e580: 6572 7344 6963 7428 0a20 2020 2020 2020  ersDict(.       
+0000e590: 2020 2020 2020 2020 2062 726f 6164 6361           broadca
+0000e5a0: 7374 5f76 616c 7565 3d4e 6f6e 652c 206e  st_value=None, n
+0000e5b0: 756d 6265 7273 5f64 6963 743d 7b6b 3a20  umbers_dict={k: 
+0000e5c0: 7365 6c66 5b6b 5d20 666f 7220 6b20 696e  self[k] for k in
+0000e5d0: 206e 756d 6265 7273 5f64 6963 742e 6469   numbers_dict.di
+0000e5e0: 6374 2e6b 6579 7328 2920 6966 206b 2069  ct.keys() if k i
+0000e5f0: 6e20 7365 6c66 2e64 6963 747d 0a20 2020  n self.dict}.   
+0000e600: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000e610: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+0000e620: 6620 6b65 7973 5f73 6574 2873 656c 6629  f keys_set(self)
+0000e630: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000e640: 2020 2020 2020 3a72 7479 7065 3a20 7365        :rtype: se
+0000e650: 745b 7374 725d 0a20 2020 2020 2020 2022  t[str].        "
+0000e660: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0000e670: 6e20 7365 7428 7365 6c66 2e64 6963 742e  n set(self.dict.
+0000e680: 6b65 7973 2829 290a 0a20 2020 2064 6566  keys())..    def
+0000e690: 205f 5f67 6574 6974 656d 5f5f 2873 656c   __getitem__(sel
+0000e6a0: 662c 206b 6579 293a 0a20 2020 2020 2020  f, key):.       
+0000e6b0: 2069 6620 7365 6c66 2e76 616c 7565 2069   if self.value i
+0000e6c0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000e6d0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000e6e0: 656c 662e 6469 6374 2e67 6574 286b 6579  elf.dict.get(key
+0000e6f0: 2c20 7365 6c66 2e76 616c 7565 290a 2020  , self.value).  
+0000e700: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000e710: 662e 6469 6374 5b6b 6579 5d0a 0a20 2020  f.dict[key]..   
+0000e720: 2064 6566 205f 5f73 6574 6974 656d 5f5f   def __setitem__
+0000e730: 2873 656c 662c 206b 6579 2c20 7661 6c75  (self, key, valu
+0000e740: 6529 3a0a 2020 2020 2020 2020 7365 6c66  e):.        self
+0000e750: 2e64 6963 745b 6b65 795d 203d 2076 616c  .dict[key] = val
+0000e760: 7565 0a0a 2020 2020 6465 6620 5f5f 6465  ue..    def __de
+0000e770: 6c69 7465 6d5f 5f28 7365 6c66 2c20 6b65  litem__(self, ke
+0000e780: 7929 3a0a 2020 2020 2020 2020 6465 6c20  y):.        del 
+0000e790: 7365 6c66 2e64 6963 745b 6b65 795d 0a0a  self.dict[key]..
+0000e7a0: 2020 2020 6465 6620 6765 7428 7365 6c66      def get(self
+0000e7b0: 2c20 6b65 792c 2064 6566 6175 6c74 3d4e  , key, default=N
+0000e7c0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+0000e7d0: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+0000e7e0: 2073 7472 206b 6579 3a0a 2020 2020 2020   str key:.      
+0000e7f0: 2020 3a70 6172 616d 2054 2064 6566 6175    :param T defau
+0000e800: 6c74 3a0a 2020 2020 2020 2020 3a72 7479  lt:.        :rty
+0000e810: 7065 3a20 6f62 6a65 6374 7c54 0a20 2020  pe: object|T.   
+0000e820: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000e830: 2023 204b 6565 7020 636f 6e73 6973 7465   # Keep consiste
+0000e840: 6e74 2077 6974 6820 7365 6c66 2e5f 5f67  nt with self.__g
+0000e850: 6574 5f69 7465 6d5f 5f2e 2049 6620 7365  et_item__. If se
+0000e860: 6c66 2e76 616c 7565 2069 7320 7365 742c  lf.value is set,
+0000e870: 2074 6869 7320 7769 6c6c 2061 6c77 6179   this will alway
+0000e880: 7320 6265 2074 6865 2064 6566 6175 6c74  s be the default
+0000e890: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
+0000e8a0: 7265 7475 726e 2073 656c 662e 6469 6374  return self.dict
+0000e8b0: 2e67 6574 286b 6579 2c20 7365 6c66 2e76  .get(key, self.v
+0000e8c0: 616c 7565 2069 6620 7365 6c66 2e76 616c  alue if self.val
+0000e8d0: 7565 2069 7320 6e6f 7420 4e6f 6e65 2065  ue is not None e
+0000e8e0: 6c73 6520 6465 6661 756c 7429 0a0a 2020  lse default)..  
+0000e8f0: 2020 6465 6620 706f 7028 7365 6c66 2c20    def pop(self, 
+0000e900: 6b65 792c 202a 6172 6773 293a 0a20 2020  key, *args):.   
+0000e910: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000e920: 203a 7061 7261 6d20 7374 7220 6b65 793a   :param str key:
+0000e930: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000e940: 5420 6172 6773 3a20 6465 6661 756c 742c  T args: default,
+0000e950: 206f 7220 6e6f 740a 2020 2020 2020 2020   or not.        
+0000e960: 3a72 7479 7065 3a20 6f62 6a65 6374 7c54  :rtype: object|T
+0000e970: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000e980: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000e990: 2e64 6963 742e 706f 7028 6b65 792c 202a  .dict.pop(key, *
+0000e9a0: 6172 6773 290a 0a20 2020 2064 6566 205f  args)..    def _
+0000e9b0: 5f69 7465 725f 5f28 7365 6c66 293a 0a20  _iter__(self):. 
+0000e9c0: 2020 2020 2020 2023 2054 6869 7320 6361         # This ca
+0000e9d0: 6e20 706f 7465 6e74 6961 6c6c 7920 6361  n potentially ca
+0000e9e0: 7573 6520 636f 6e66 7573 696f 6e2e 2053  use confusion. S
+0000e9f0: 6f20 656e 666f 7263 6520 6578 706c 6963  o enforce explic
+0000ea00: 6974 6e65 7373 2e0a 2020 2020 2020 2020  itness..        
+0000ea10: 2320 466f 7220 6120 6469 6374 2c20 7765  # For a dict, we
+0000ea20: 2077 6f75 6c64 2072 6574 7572 6e20 7468   would return th
+0000ea30: 6520 6469 6374 206b 6579 7320 6865 7265  e dict keys here
+0000ea40: 2e0a 2020 2020 2020 2020 2320 416c 736f  ..        # Also
+0000ea50: 2c20 6d61 7828 7365 6c66 2920 776f 756c  , max(self) woul
+0000ea60: 6420 7265 7375 6c74 2069 6e20 6120 6361  d result in a ca
+0000ea70: 6c6c 2074 6f20 7365 6c66 2e5f 5f69 7465  ll to self.__ite
+0000ea80: 725f 5f28 292c 0a20 2020 2020 2020 2023  r__(),.        #
+0000ea90: 2077 6869 6368 2077 6f75 6c64 206f 6e6c   which would onl
+0000eaa0: 7920 6d61 6b65 2073 656e 7365 2066 6f72  y make sense for
+0000eab0: 206f 7572 2076 616c 7565 732c 206e 6f74   our values, not
+0000eac0: 2074 6865 2064 6963 7420 6b65 7973 2e0a   the dict keys..
+0000ead0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+0000eae0: 6365 7074 696f 6e28 2225 732e 5f5f 6974  ception("%s.__it
+0000eaf0: 6572 5f5f 2069 7320 756e 6465 6669 6e65  er__ is undefine
+0000eb00: 6422 2025 2073 656c 662e 5f5f 636c 6173  d" % self.__clas
+0000eb10: 735f 5f2e 5f5f 6e61 6d65 5f5f 290a 0a20  s__.__name__).. 
+0000eb20: 2020 2064 6566 206b 6579 7328 7365 6c66     def keys(self
+0000eb30: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0000eb40: 2020 2020 2020 203a 7274 7970 653a 2073         :rtype: s
+0000eb50: 6574 5b73 7472 5d0a 2020 2020 2020 2020  et[str].        
+0000eb60: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0000eb70: 726e 2073 656c 662e 6469 6374 2e6b 6579  rn self.dict.key
+0000eb80: 7328 290a 0a20 2020 2064 6566 2076 616c  s()..    def val
+0000eb90: 7565 7328 7365 6c66 293a 0a20 2020 2020  ues(self):.     
+0000eba0: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+0000ebb0: 7274 7970 653a 206c 6973 745b 6f62 6a65  rtype: list[obje
+0000ebc0: 6374 5d0a 2020 2020 2020 2020 2222 220a  ct].        """.
+0000ebd0: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+0000ebe0: 6973 7428 7365 6c66 2e64 6963 742e 7661  ist(self.dict.va
+0000ebf0: 6c75 6573 2829 2920 2b20 285b 7365 6c66  lues()) + ([self
+0000ec00: 2e76 616c 7565 5d20 6966 2073 656c 662e  .value] if self.
+0000ec10: 7661 6c75 6520 6973 206e 6f74 204e 6f6e  value is not Non
+0000ec20: 6520 656c 7365 205b 5d29 0a0a 2020 2020  e else [])..    
+0000ec30: 6465 6620 6974 656d 7328 7365 6c66 293a  def items(self):
+0000ec40: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000ec50: 2020 2020 203a 7265 7475 726e 3a20 6469       :return: di
+0000ec60: 6374 2069 7465 6d73 2e20 7468 6973 2065  ct items. this e
+0000ec70: 7863 6c75 6465 7320 7365 6c66 2e76 616c  xcludes self.val
+0000ec80: 7565 0a20 2020 2020 2020 203a 7274 7970  ue.        :rtyp
+0000ec90: 653a 2073 7472 5b28 7374 722c 6f62 6a65  e: str[(str,obje
+0000eca0: 6374 295d 0a20 2020 2020 2020 2022 2222  ct)].        """
+0000ecb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000ecc0: 7365 6c66 2e64 6963 742e 6974 656d 7328  self.dict.items(
+0000ecd0: 290a 0a20 2020 2064 6566 2068 6173 5f76  )..    def has_v
+0000ece0: 616c 7565 7328 7365 6c66 293a 0a20 2020  alues(self):.   
+0000ecf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000ed00: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
+0000ed10: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000ed20: 2020 7265 7475 726e 2062 6f6f 6c28 7365    return bool(se
+0000ed30: 6c66 2e64 6963 7429 206f 7220 7365 6c66  lf.dict) or self
+0000ed40: 2e76 616c 7565 2069 7320 6e6f 7420 4e6f  .value is not No
+0000ed50: 6e65 0a0a 2020 2020 6465 6620 756e 6172  ne..    def unar
+0000ed60: 795f 6f70 2873 656c 662c 206f 7029 3a0a  y_op(self, op):.
+0000ed70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000ed80: 2020 2020 3a70 6172 616d 2028 5429 2d3e      :param (T)->
+0000ed90: 5432 206f 703a 0a20 2020 2020 2020 203a  T2 op:.        :
+0000eda0: 7265 7475 726e 3a20 6e65 7720 4e75 6d62  return: new Numb
+0000edb0: 6572 7344 6963 742c 2077 6865 7265 2060  ersDict, where `
+0000edc0: 606f 7060 6020 6973 2061 7070 6c69 6564  `op`` is applied
+0000edd0: 206f 6e20 616c 6c20 7661 6c75 6573 0a20   on all values. 
+0000ede0: 2020 2020 2020 203a 7274 7970 653a 204e         :rtype: N
+0000edf0: 756d 6265 7273 4469 6374 0a20 2020 2020  umbersDict.     
+0000ee00: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+0000ee10: 6573 203d 204e 756d 6265 7273 4469 6374  es = NumbersDict
+0000ee20: 2829 0a20 2020 2020 2020 2069 6620 7365  ().        if se
+0000ee30: 6c66 2e76 616c 7565 2069 7320 6e6f 7420  lf.value is not 
+0000ee40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000ee50: 2020 7265 732e 7661 6c75 6520 3d20 6f70    res.value = op
+0000ee60: 2873 656c 662e 7661 6c75 6529 0a20 2020  (self.value).   
+0000ee70: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
+0000ee80: 2073 656c 662e 6469 6374 2e69 7465 6d73   self.dict.items
+0000ee90: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0000eea0: 7265 732e 6469 6374 5b6b 5d20 3d20 6f70  res.dict[k] = op
+0000eeb0: 2876 290a 2020 2020 2020 2020 7265 7475  (v).        retu
+0000eec0: 726e 2072 6573 0a0a 2020 2020 4063 6c61  rn res..    @cla
+0000eed0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+0000eee0: 2062 696e 5f6f 705f 7363 616c 6172 5f6f   bin_op_scalar_o
+0000eef0: 7074 696f 6e61 6c28 636c 732c 2073 656c  ptional(cls, sel
+0000ef00: 662c 206f 7468 6572 2c20 7a65 726f 2c20  f, other, zero, 
+0000ef10: 6f70 293a 0a20 2020 2020 2020 2022 2222  op):.        """
+0000ef20: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000ef30: 5420 7365 6c66 3a0a 2020 2020 2020 2020  T self:.        
+0000ef40: 3a70 6172 616d 2054 206f 7468 6572 3a0a  :param T other:.
+0000ef50: 2020 2020 2020 2020 3a70 6172 616d 2054          :param T
+0000ef60: 207a 6572 6f3a 0a20 2020 2020 2020 203a   zero:.        :
+0000ef70: 7061 7261 6d20 2854 2c54 292d 3e54 206f  param (T,T)->T o
+0000ef80: 703a 0a20 2020 2020 2020 203a 7274 7970  p:.        :rtyp
+0000ef90: 653a 2054 0a20 2020 2020 2020 2022 2222  e: T.        """
+0000efa0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0000efb0: 2069 7320 4e6f 6e65 2061 6e64 206f 7468   is None and oth
+0000efc0: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
+0000efd0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0000efe0: 6f6e 650a 2020 2020 2020 2020 6966 2073  one.        if s
+0000eff0: 656c 6620 6973 204e 6f6e 653a 0a20 2020  elf is None:.   
+0000f000: 2020 2020 2020 2020 2073 656c 6620 3d20           self = 
+0000f010: 7a65 726f 0a20 2020 2020 2020 2069 6620  zero.        if 
+0000f020: 6f74 6865 7220 6973 204e 6f6e 653a 0a20  other is None:. 
+0000f030: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0000f040: 203d 207a 6572 6f0a 2020 2020 2020 2020   = zero.        
+0000f050: 7265 7475 726e 206f 7028 7365 6c66 2c20  return op(self, 
+0000f060: 6f74 6865 7229 0a0a 2020 2020 4063 6c61  other)..    @cla
+0000f070: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+0000f080: 2062 696e 5f6f 7028 636c 732c 2073 656c   bin_op(cls, sel
+0000f090: 662c 206f 7468 6572 2c20 6f70 2c20 7a65  f, other, op, ze
+0000f0a0: 726f 2c20 7265 7375 6c74 3d4e 6f6e 6529  ro, result=None)
+0000f0b0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000f0c0: 2020 2020 2020 3a70 6172 616d 204e 756d        :param Num
+0000f0d0: 6265 7273 4469 6374 7c69 6e74 7c66 6c6f  bersDict|int|flo
+0000f0e0: 6174 7c54 2073 656c 663a 0a20 2020 2020  at|T self:.     
+0000f0f0: 2020 203a 7061 7261 6d20 4e75 6d62 6572     :param Number
+0000f100: 7344 6963 747c 696e 747c 666c 6f61 747c  sDict|int|float|
+0000f110: 5420 6f74 6865 723a 0a20 2020 2020 2020  T other:.       
+0000f120: 203a 7061 7261 6d20 2854 2c54 292d 3e54   :param (T,T)->T
+0000f130: 206f 703a 0a20 2020 2020 2020 203a 7061   op:.        :pa
+0000f140: 7261 6d20 5420 7a65 726f 3a0a 2020 2020  ram T zero:.    
+0000f150: 2020 2020 3a70 6172 616d 204e 756d 6265      :param Numbe
+0000f160: 7273 4469 6374 7c4e 6f6e 6520 7265 7375  rsDict|None resu
+0000f170: 6c74 3a0a 2020 2020 2020 2020 3a72 7479  lt:.        :rty
+0000f180: 7065 3a20 4e75 6d62 6572 7344 6963 740a  pe: NumbersDict.
+0000f190: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000f1a0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+0000f1b0: 7461 6e63 6528 7365 6c66 2c20 4e75 6d62  tance(self, Numb
+0000f1c0: 6572 7344 6963 7429 3a0a 2020 2020 2020  ersDict):.      
+0000f1d0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000f1e0: 6e63 6528 6f74 6865 722c 204e 756d 6265  nce(other, Numbe
+0000f1f0: 7273 4469 6374 293a 0a20 2020 2020 2020  rsDict):.       
+0000f200: 2020 2020 2020 2020 2073 656c 6620 3d20           self = 
+0000f210: 4e75 6d62 6572 7344 6963 742e 636f 6e73  NumbersDict.cons
+0000f220: 7461 6e74 5f6c 696b 6528 7365 6c66 2c20  tant_like(self, 
+0000f230: 6e75 6d62 6572 735f 6469 6374 3d6f 7468  numbers_dict=oth
+0000f240: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+0000f250: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000f260: 2020 2020 2020 7365 6c66 203d 204e 756d        self = Num
+0000f270: 6265 7273 4469 6374 2873 656c 6629 0a20  bersDict(self). 
+0000f280: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0000f290: 696e 7374 616e 6365 286f 7468 6572 2c20  instance(other, 
+0000f2a0: 4e75 6d62 6572 7344 6963 7429 3a0a 2020  NumbersDict):.  
+0000f2b0: 2020 2020 2020 2020 2020 6f74 6865 7220            other 
+0000f2c0: 3d20 4e75 6d62 6572 7344 6963 742e 636f  = NumbersDict.co
+0000f2d0: 6e73 7461 6e74 5f6c 696b 6528 6f74 6865  nstant_like(othe
+0000f2e0: 722c 206e 756d 6265 7273 5f64 6963 743d  r, numbers_dict=
+0000f2f0: 7365 6c66 290a 2020 2020 2020 2020 6966  self).        if
+0000f300: 2072 6573 756c 7420 6973 204e 6f6e 653a   result is None:
+0000f310: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0000f320: 756c 7420 3d20 4e75 6d62 6572 7344 6963  ult = NumbersDic
+0000f330: 7428 290a 2020 2020 2020 2020 6173 7365  t().        asse
+0000f340: 7274 2069 7369 6e73 7461 6e63 6528 7265  rt isinstance(re
+0000f350: 7375 6c74 2c20 4e75 6d62 6572 7344 6963  sult, NumbersDic
+0000f360: 7429 0a20 2020 2020 2020 2066 6f72 206b  t).        for k
+0000f370: 2069 6e20 7365 6c66 2e6b 6579 735f 7365   in self.keys_se
+0000f380: 7420 7c20 6f74 6865 722e 6b65 7973 5f73  t | other.keys_s
+0000f390: 6574 3a0a 2020 2020 2020 2020 2020 2020  et:.            
+0000f3a0: 7265 7375 6c74 5b6b 5d20 3d20 636c 732e  result[k] = cls.
+0000f3b0: 6269 6e5f 6f70 5f73 6361 6c61 725f 6f70  bin_op_scalar_op
+0000f3c0: 7469 6f6e 616c 2873 656c 662e 6765 7428  tional(self.get(
+0000f3d0: 6b2c 204e 6f6e 6529 2c20 6f74 6865 722e  k, None), other.
+0000f3e0: 6765 7428 6b2c 204e 6f6e 6529 2c20 7a65  get(k, None), ze
+0000f3f0: 726f 3d7a 6572 6f2c 206f 703d 6f70 290a  ro=zero, op=op).
+0000f400: 2020 2020 2020 2020 7265 7375 6c74 2e76          result.v
+0000f410: 616c 7565 203d 2063 6c73 2e62 696e 5f6f  alue = cls.bin_o
+0000f420: 705f 7363 616c 6172 5f6f 7074 696f 6e61  p_scalar_optiona
+0000f430: 6c28 7365 6c66 2e76 616c 7565 2c20 6f74  l(self.value, ot
+0000f440: 6865 722e 7661 6c75 652c 207a 6572 6f3d  her.value, zero=
+0000f450: 7a65 726f 2c20 6f70 3d6f 7029 0a20 2020  zero, op=op).   
+0000f460: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+0000f470: 6c74 0a0a 2020 2020 6465 6620 5f5f 6164  lt..    def __ad
+0000f480: 645f 5f28 7365 6c66 2c20 6f74 6865 7229  d__(self, other)
+0000f490: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000f4a0: 2073 656c 662e 6269 6e5f 6f70 2873 656c   self.bin_op(sel
+0000f4b0: 662c 206f 7468 6572 2c20 6f70 3d6c 616d  f, other, op=lam
+0000f4c0: 6264 6120 612c 2062 3a20 6120 2b20 622c  bda a, b: a + b,
+0000f4d0: 207a 6572 6f3d 3029 0a0a 2020 2020 5f5f   zero=0)..    __
+0000f4e0: 7261 6464 5f5f 203d 205f 5f61 6464 5f5f  radd__ = __add__
+0000f4f0: 0a0a 2020 2020 6465 6620 5f5f 6961 6464  ..    def __iadd
+0000f500: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
+0000f510: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f520: 7365 6c66 2e62 696e 5f6f 7028 7365 6c66  self.bin_op(self
+0000f530: 2c20 6f74 6865 722c 206f 703d 6c61 6d62  , other, op=lamb
+0000f540: 6461 2061 2c20 623a 2061 202b 2062 2c20  da a, b: a + b, 
+0000f550: 7a65 726f 3d30 2c20 7265 7375 6c74 3d73  zero=0, result=s
+0000f560: 656c 6629 0a0a 2020 2020 6465 6620 5f5f  elf)..    def __
+0000f570: 7375 625f 5f28 7365 6c66 2c20 6f74 6865  sub__(self, othe
+0000f580: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
+0000f590: 726e 2073 656c 662e 6269 6e5f 6f70 2873  rn self.bin_op(s
+0000f5a0: 656c 662c 206f 7468 6572 2c20 6f70 3d6c  elf, other, op=l
+0000f5b0: 616d 6264 6120 612c 2062 3a20 6120 2d20  ambda a, b: a - 
+0000f5c0: 622c 207a 6572 6f3d 3029 0a0a 2020 2020  b, zero=0)..    
+0000f5d0: 6465 6620 5f5f 7273 7562 5f5f 2873 656c  def __rsub__(sel
+0000f5e0: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
+0000f5f0: 2020 2072 6574 7572 6e20 7365 6c66 2e62     return self.b
+0000f600: 696e 5f6f 7028 7365 6c66 2c20 6f74 6865  in_op(self, othe
+0000f610: 722c 206f 703d 6c61 6d62 6461 2061 2c20  r, op=lambda a, 
+0000f620: 623a 2062 202d 2061 2c20 7a65 726f 3d30  b: b - a, zero=0
+0000f630: 290a 0a20 2020 2064 6566 205f 5f69 7375  )..    def __isu
+0000f640: 625f 5f28 7365 6c66 2c20 6f74 6865 7229  b__(self, other)
+0000f650: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000f660: 2073 656c 662e 6269 6e5f 6f70 2873 656c   self.bin_op(sel
+0000f670: 662c 206f 7468 6572 2c20 6f70 3d6c 616d  f, other, op=lam
+0000f680: 6264 6120 612c 2062 3a20 6120 2d20 622c  bda a, b: a - b,
+0000f690: 207a 6572 6f3d 302c 2072 6573 756c 743d   zero=0, result=
+0000f6a0: 7365 6c66 290a 0a20 2020 2064 6566 205f  self)..    def _
+0000f6b0: 5f6d 756c 5f5f 2873 656c 662c 206f 7468  _mul__(self, oth
+0000f6c0: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+0000f6d0: 7572 6e20 7365 6c66 2e62 696e 5f6f 7028  urn self.bin_op(
+0000f6e0: 7365 6c66 2c20 6f74 6865 722c 206f 703d  self, other, op=
+0000f6f0: 6c61 6d62 6461 2061 2c20 623a 2061 202a  lambda a, b: a *
+0000f700: 2062 2c20 7a65 726f 3d31 290a 0a20 2020   b, zero=1)..   
+0000f710: 205f 5f72 6d75 6c5f 5f20 3d20 5f5f 6d75   __rmul__ = __mu
+0000f720: 6c5f 5f0a 0a20 2020 2064 6566 205f 5f69  l__..    def __i
+0000f730: 6d75 6c5f 5f28 7365 6c66 2c20 6f74 6865  mul__(self, othe
+0000f740: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
+0000f750: 726e 2073 656c 662e 6269 6e5f 6f70 2873  rn self.bin_op(s
+0000f760: 656c 662c 206f 7468 6572 2c20 6f70 3d6c  elf, other, op=l
+0000f770: 616d 6264 6120 612c 2062 3a20 6120 2a20  ambda a, b: a * 
+0000f780: 622c 207a 6572 6f3d 312c 2072 6573 756c  b, zero=1, resul
+0000f790: 743d 7365 6c66 290a 0a20 2020 2064 6566  t=self)..    def
+0000f7a0: 205f 5f64 6976 5f5f 2873 656c 662c 206f   __div__(self, o
+0000f7b0: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+0000f7c0: 6574 7572 6e20 7365 6c66 2e62 696e 5f6f  eturn self.bin_o
+0000f7d0: 7028 7365 6c66 2c20 6f74 6865 722c 206f  p(self, other, o
+0000f7e0: 703d 6c61 6d62 6461 2061 2c20 623a 2061  p=lambda a, b: a
+0000f7f0: 202f 2062 2c20 7a65 726f 3d31 290a 0a20   / b, zero=1).. 
+0000f800: 2020 205f 5f72 6469 765f 5f20 3d20 5f5f     __rdiv__ = __
+0000f810: 6469 765f 5f0a 2020 2020 5f5f 7472 7565  div__.    __true
+0000f820: 6469 765f 5f20 3d20 5f5f 6469 765f 5f0a  div__ = __div__.
+0000f830: 0a20 2020 2064 6566 205f 5f69 6469 765f  .    def __idiv_
+0000f840: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
+0000f850: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000f860: 656c 662e 6269 6e5f 6f70 2873 656c 662c  elf.bin_op(self,
+0000f870: 206f 7468 6572 2c20 6f70 3d6c 616d 6264   other, op=lambd
+0000f880: 6120 612c 2062 3a20 6120 2f20 622c 207a  a a, b: a / b, z
+0000f890: 6572 6f3d 312c 2072 6573 756c 743d 7365  ero=1, result=se
+0000f8a0: 6c66 290a 0a20 2020 205f 5f69 7472 7565  lf)..    __itrue
+0000f8b0: 6469 765f 5f20 3d20 5f5f 6964 6976 5f5f  div__ = __idiv__
+0000f8c0: 0a0a 2020 2020 6465 6620 5f5f 666c 6f6f  ..    def __floo
+0000f8d0: 7264 6976 5f5f 2873 656c 662c 206f 7468  rdiv__(self, oth
+0000f8e0: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+0000f8f0: 7572 6e20 7365 6c66 2e62 696e 5f6f 7028  urn self.bin_op(
+0000f900: 7365 6c66 2c20 6f74 6865 722c 206f 703d  self, other, op=
+0000f910: 6c61 6d62 6461 2061 2c20 623a 2061 202f  lambda a, b: a /
+0000f920: 2f20 622c 207a 6572 6f3d 3129 0a0a 2020  / b, zero=1)..  
+0000f930: 2020 6465 6620 5f5f 6966 6c6f 6f72 6469    def __ifloordi
+0000f940: 765f 5f28 7365 6c66 2c20 6f74 6865 7229  v__(self, other)
+0000f950: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000f960: 2073 656c 662e 6269 6e5f 6f70 2873 656c   self.bin_op(sel
+0000f970: 662c 206f 7468 6572 2c20 6f70 3d6c 616d  f, other, op=lam
+0000f980: 6264 6120 612c 2062 3a20 6120 2f2f 2062  bda a, b: a // b
+0000f990: 2c20 7a65 726f 3d31 2c20 7265 7375 6c74  , zero=1, result
+0000f9a0: 3d73 656c 6629 0a0a 2020 2020 6465 6620  =self)..    def 
+0000f9b0: 5f5f 6e65 675f 5f28 7365 6c66 293a 0a20  __neg__(self):. 
+0000f9c0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000f9d0: 6c66 2e75 6e61 7279 5f6f 7028 6f70 3d6c  lf.unary_op(op=l
+0000f9e0: 616d 6264 6120 613a 202d 6129 0a0a 2020  ambda a: -a)..  
+0000f9f0: 2020 6465 6620 5f5f 626f 6f6c 5f5f 2873    def __bool__(s
+0000fa00: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+0000fa10: 7475 726e 2061 6e79 2873 656c 662e 7661  turn any(self.va
+0000fa20: 6c75 6573 2829 290a 0a20 2020 205f 5f6e  lues())..    __n
+0000fa30: 6f6e 7a65 726f 5f5f 203d 205f 5f62 6f6f  onzero__ = __boo
+0000fa40: 6c5f 5f20 2023 2050 7974 686f 6e20 320a  l__  # Python 2.
+0000fa50: 0a20 2020 2064 6566 2065 6c65 6d5f 6571  .    def elem_eq
+0000fa60: 2873 656c 662c 206f 7468 6572 2c20 7265  (self, other, re
+0000fa70: 7375 6c74 5f77 6974 685f 6465 6661 756c  sult_with_defaul
+0000fa80: 743d 5472 7565 293a 0a20 2020 2020 2020  t=True):.       
+0000fa90: 2022 2222 0a20 2020 2020 2020 2045 6c65   """.        Ele
+0000faa0: 6d65 6e74 2d77 6973 6520 6571 7561 6c69  ment-wise equali
+0000fab0: 7479 2063 6865 636b 2077 6974 6820 6f74  ty check with ot
+0000fac0: 6865 722e 0a20 2020 2020 2020 204e 6f74  her..        Not
+0000fad0: 6520 6162 6f75 7420 6272 6f61 6463 6173  e about broadcas
+0000fae0: 7420 6465 6661 756c 7420 7661 6c75 653a  t default value:
+0000faf0: 2043 6f6e 7369 6465 7220 736f 6d65 206b   Consider some k
+0000fb00: 6579 2077 6869 6368 2069 7320 6e65 6974  ey which is neit
+0000fb10: 6865 7220 696e 2073 656c 6620 6e6f 7220  her in self nor 
+0000fb20: 696e 206f 7468 6572 2e0a 2020 2020 2020  in other..      
+0000fb30: 2020 2020 5468 6973 206d 6561 6e73 2074      This means t
+0000fb40: 6861 7420 7365 6c66 5b6b 6579 5d20 3d3d  hat self[key] ==
+0000fb50: 2073 656c 662e 6465 6661 756c 742c 206f   self.default, o
+0000fb60: 7468 6572 5b6b 6579 5d20 3d3d 206f 7468  ther[key] == oth
+0000fb70: 6572 2e64 6566 6175 6c74 2e0a 2020 2020  er.default..    
+0000fb80: 2020 2020 2020 5468 7573 2c20 696e 2063        Thus, in c
+0000fb90: 6173 6520 7468 6174 2073 656c 662e 6465  ase that self.de
+0000fba0: 6661 756c 7420 213d 206f 7468 6572 2e64  fault != other.d
+0000fbb0: 6566 6175 6c74 2c20 7765 2067 6574 2072  efault, we get r
+0000fbc0: 6573 2e64 6566 6175 6c74 203d 3d20 4661  es.default == Fa
+0000fbd0: 6c73 652e 0a20 2020 2020 2020 2020 2054  lse..          T
+0000fbe0: 6865 6e2c 2061 6c6c 2872 6573 2e76 616c  hen, all(res.val
+0000fbf0: 7565 7328 2929 203d 3d20 4661 6c73 652c  ues()) == False,
+0000fc00: 2065 7665 6e20 7768 656e 2061 6c6c 206f   even when all o
+0000fc10: 7468 6572 2076 616c 7565 7320 6172 6520  ther values are 
+0000fc20: 5472 7565 2e0a 2020 2020 2020 2020 2020  True..          
+0000fc30: 5468 6973 2069 7320 736f 6d65 7469 6d65  This is sometime
+0000fc40: 7320 6e6f 7420 7768 6174 2077 6520 7761  s not what we wa
+0000fc50: 6e74 2e0a 2020 2020 2020 2020 2020 596f  nt..          Yo
+0000fc60: 7520 6361 6e20 636f 6e74 726f 6c20 7468  u can control th
+0000fc70: 6520 6265 6861 7669 6f72 2076 6961 2072  e behavior via r
+0000fc80: 6573 756c 745f 7769 7468 5f64 6566 6175  esult_with_defau
+0000fc90: 6c74 2e0a 0a20 2020 2020 2020 203a 7061  lt...        :pa
+0000fca0: 7261 6d20 4e75 6d62 6572 7344 6963 747c  ram NumbersDict|
+0000fcb0: 5420 6f74 6865 723a 0a20 2020 2020 2020  T other:.       
+0000fcc0: 203a 7061 7261 6d20 626f 6f6c 2072 6573   :param bool res
+0000fcd0: 756c 745f 7769 7468 5f64 6566 6175 6c74  ult_with_default
+0000fce0: 3a0a 2020 2020 2020 2020 3a72 7479 7065  :.        :rtype
+0000fcf0: 3a20 4e75 6d62 6572 7344 6963 740a 2020  : NumbersDict.  
+0000fd00: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0000fd10: 2020 2064 6566 206f 7028 612c 2062 293a     def op(a, b):
+0000fd20: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
+0000fd30: 0a20 2020 2020 2020 2020 2020 203a 7061  .            :pa
+0000fd40: 7261 6d20 613a 0a20 2020 2020 2020 2020  ram a:.         
+0000fd50: 2020 203a 7061 7261 6d20 623a 0a20 2020     :param b:.   
+0000fd60: 2020 2020 2020 2020 203a 7274 7970 653a           :rtype:
+0000fd70: 2062 6f6f 6c7c 4e6f 6e65 0a20 2020 2020   bool|None.     
+0000fd80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000fd90: 2020 2020 2020 2069 6620 6120 6973 204e         if a is N
+0000fda0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000fdb0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0000fdc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000fdd0: 6220 6973 204e 6f6e 653a 0a20 2020 2020  b is None:.     
+0000fde0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000fdf0: 6e20 4e6f 6e65 0a20 2020 2020 2020 2020  n None.         
+0000fe00: 2020 2072 6574 7572 6e20 6120 3d3d 2062     return a == b
+0000fe10: 0a0a 2020 2020 2020 2020 7265 7320 3d20  ..        res = 
+0000fe20: 7365 6c66 2e62 696e 5f6f 7028 7365 6c66  self.bin_op(self
+0000fe30: 2c20 6f74 6865 722c 206f 703d 6f70 2c20  , other, op=op, 
+0000fe40: 7a65 726f 3d4e 6f6e 6529 0a20 2020 2020  zero=None).     
+0000fe50: 2020 2069 6620 6e6f 7420 7265 7375 6c74     if not result
+0000fe60: 5f77 6974 685f 6465 6661 756c 743a 0a20  _with_default:. 
+0000fe70: 2020 2020 2020 2020 2020 2072 6573 2e76             res.v
+0000fe80: 616c 7565 203d 204e 6f6e 650a 2020 2020  alue = None.    
+0000fe90: 2020 2020 7265 7475 726e 2072 6573 0a0a      return res..
+0000fea0: 2020 2020 6465 6620 5f5f 6571 5f5f 2873      def __eq__(s
+0000feb0: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
+0000fec0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000fed0: 203a 7061 7261 6d20 4e75 6d62 6572 7344   :param NumbersD
+0000fee0: 6963 747c 5420 6f74 6865 723a 0a20 2020  ict|T other:.   
+0000fef0: 2020 2020 203a 7265 7475 726e 3a20 7768       :return: wh
+0000ff00: 6574 6865 7220 7365 6c66 203d 3d20 6f74  ether self == ot
+0000ff10: 6865 7220 656c 656d 7769 7365 2e20 7365  her elemwise. se
+0000ff20: 6520 7365 6c66 2e65 6c65 6d5f 6571 0a20  e self.elem_eq. 
+0000ff30: 2020 2020 2020 203a 7274 7970 653a 2062         :rtype: b
+0000ff40: 6f6f 6c0a 2020 2020 2020 2020 2222 220a  ool.        """.
+0000ff50: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+0000ff60: 6c6c 2873 656c 662e 656c 656d 5f65 7128  ll(self.elem_eq(
+0000ff70: 6f74 6865 7229 2e76 616c 7565 7328 2929  other).values())
+0000ff80: 0a0a 2020 2020 6465 6620 5f5f 6e65 5f5f  ..    def __ne__
+0000ff90: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
+0000ffa0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000ffb0: 2020 203a 7061 7261 6d20 4e75 6d62 6572     :param Number
+0000ffc0: 7344 6963 747c 5420 6f74 6865 723a 0a20  sDict|T other:. 
+0000ffd0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+0000ffe0: 6e6f 7420 2873 656c 6620 3d3d 206f 7468  not (self == oth
+0000fff0: 6572 290a 2020 2020 2020 2020 3a72 7479  er).        :rty
+00010000: 7065 3a20 626f 6f6c 0a20 2020 2020 2020  pe: bool.       
+00010010: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00010020: 7572 6e20 6e6f 7420 2873 656c 6620 3d3d  urn not (self ==
+00010030: 206f 7468 6572 290a 0a20 2020 2064 6566   other)..    def
+00010040: 205f 5f63 6d70 5f5f 2873 656c 662c 206f   __cmp__(self, o
+00010050: 7468 6572 293a 0a20 2020 2020 2020 2023  ther):.        #
+00010060: 2054 6865 7265 2069 7320 6e6f 2067 6f6f   There is no goo
+00010070: 6420 7374 7261 6967 6874 2d66 6f72 7761  d straight-forwa
+00010080: 7264 2069 6d70 6c65 6d65 6e74 6174 696f  rd implementatio
+00010090: 6e0a 2020 2020 2020 2020 2320 616e 6420  n.        # and 
+000100a0: 6974 2077 6f75 6c64 206a 7573 7420 636f  it would just co
+000100b0: 6e66 7573 652e 0a20 2020 2020 2020 2072  nfuse..        r
+000100c0: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+000100d0: 2573 2e5f 5f63 6d70 5f5f 2069 7320 756e  %s.__cmp__ is un
+000100e0: 6465 6669 6e65 6422 2025 2073 656c 662e  defined" % self.
+000100f0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00010100: 5f5f 290a 0a20 2020 2064 6566 2061 6e79  __)..    def any
+00010110: 5f63 6f6d 7061 7265 2873 656c 662c 206f  _compare(self, o
+00010120: 7468 6572 2c20 636d 7029 3a0a 2020 2020  ther, cmp):.    
+00010130: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00010140: 3a70 6172 616d 204e 756d 6265 7273 4469  :param NumbersDi
+00010150: 6374 206f 7468 6572 3a0a 2020 2020 2020  ct other:.      
+00010160: 2020 3a70 6172 616d 2028 286f 626a 6563    :param ((objec
+00010170: 742c 6f62 6a65 6374 292d 3e54 7275 6529  t,object)->True)
+00010180: 2063 6d70 3a0a 2020 2020 2020 2020 3a72   cmp:.        :r
+00010190: 7479 7065 3a20 5472 7565 0a20 2020 2020  type: True.     
+000101a0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+000101b0: 6f72 206b 6579 2069 6e20 7365 6c66 2e6b  or key in self.k
+000101c0: 6579 7328 293a 0a20 2020 2020 2020 2020  eys():.         
+000101d0: 2020 2069 6620 6b65 7920 696e 206f 7468     if key in oth
+000101e0: 6572 2e6b 6579 7328 293a 0a20 2020 2020  er.keys():.     
+000101f0: 2020 2020 2020 2020 2020 2069 6620 636d             if cm
+00010200: 7028 7365 6c66 5b6b 6579 5d2c 206f 7468  p(self[key], oth
+00010210: 6572 5b6b 6579 5d29 3a0a 2020 2020 2020  er[key]):.      
+00010220: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00010230: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+00010240: 2020 2020 2020 656c 6966 206f 7468 6572        elif other
+00010250: 2e76 616c 7565 2069 7320 6e6f 7420 4e6f  .value is not No
+00010260: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00010270: 2020 2020 6966 2063 6d70 2873 656c 665b      if cmp(self[
+00010280: 6b65 795d 2c20 6f74 6865 722e 7661 6c75  key], other.valu
+00010290: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000102a0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+000102b0: 7275 650a 2020 2020 2020 2020 6966 2073  rue.        if s
+000102c0: 656c 662e 7661 6c75 6520 6973 206e 6f74  elf.value is not
+000102d0: 204e 6f6e 6520 616e 6420 6f74 6865 722e   None and other.
+000102e0: 7661 6c75 6520 6973 206e 6f74 204e 6f6e  value is not Non
+000102f0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00010300: 6620 636d 7028 7365 6c66 2e76 616c 7565  f cmp(self.value
+00010310: 2c20 6f74 6865 722e 7661 6c75 6529 3a0a  , other.value):.
+00010320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010330: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+00010340: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00010350: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
+00010360: 686f 640a 2020 2020 6465 6620 5f6d 6178  hod.    def _max
+00010370: 282a 6172 6773 293a 0a20 2020 2020 2020  (*args):.       
+00010380: 2061 7267 7320 3d20 5b61 2066 6f72 2061   args = [a for a
+00010390: 2069 6e20 6172 6773 2069 6620 6120 6973   in args if a is
+000103a0: 206e 6f74 204e 6f6e 655d 0a20 2020 2020   not None].     
+000103b0: 2020 2069 6620 6e6f 7420 6172 6773 3a0a     if not args:.
+000103c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000103d0: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+000103e0: 6966 206c 656e 2861 7267 7329 203d 3d20  if len(args) == 
+000103f0: 313a 0a20 2020 2020 2020 2020 2020 2072  1:.            r
+00010400: 6574 7572 6e20 6172 6773 5b30 5d0a 2020  eturn args[0].  
+00010410: 2020 2020 2020 7265 7475 726e 206d 6178        return max
+00010420: 282a 6172 6773 290a 0a20 2020 2040 7374  (*args)..    @st
+00010430: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+00010440: 6566 205f 6d69 6e28 2a61 7267 7329 3a0a  ef _min(*args):.
+00010450: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
+00010460: 6120 666f 7220 6120 696e 2061 7267 7320  a for a in args 
+00010470: 6966 2061 2069 7320 6e6f 7420 4e6f 6e65  if a is not None
+00010480: 5d0a 2020 2020 2020 2020 6966 206e 6f74  ].        if not
+00010490: 2061 7267 733a 0a20 2020 2020 2020 2020   args:.         
+000104a0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
+000104b0: 2020 2020 2020 2069 6620 6c65 6e28 6172         if len(ar
+000104c0: 6773 2920 3d3d 2031 3a0a 2020 2020 2020  gs) == 1:.      
+000104d0: 2020 2020 2020 7265 7475 726e 2061 7267        return arg
+000104e0: 735b 305d 0a20 2020 2020 2020 2072 6574  s[0].        ret
+000104f0: 7572 6e20 6d69 6e28 2a61 7267 7329 0a0a  urn min(*args)..
+00010500: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00010510: 0a20 2020 2064 6566 206d 6178 2863 6c73  .    def max(cls
+00010520: 2c20 6974 656d 7329 3a0a 2020 2020 2020  , items):.      
+00010530: 2020 2222 220a 2020 2020 2020 2020 456c    """.        El
+00010540: 656d 656e 742d 7769 7365 206d 6178 696d  ement-wise maxim
+00010550: 756d 2066 6f72 2069 7465 6d20 696e 2069  um for item in i
+00010560: 7465 6d73 2e0a 2020 2020 2020 2020 3a70  tems..        :p
+00010570: 6172 616d 206c 6973 745b 4e75 6d62 6572  aram list[Number
+00010580: 7344 6963 747c 696e 747c 666c 6f61 745d  sDict|int|float]
+00010590: 2069 7465 6d73 3a0a 2020 2020 2020 2020   items:.        
+000105a0: 3a72 7479 7065 3a20 4e75 6d62 6572 7344  :rtype: NumbersD
+000105b0: 6963 740a 2020 2020 2020 2020 2222 220a  ict.        """.
+000105c0: 2020 2020 2020 2020 6173 7365 7274 2069          assert i
+000105d0: 7465 6d73 0a20 2020 2020 2020 2069 6620  tems.        if 
+000105e0: 6c65 6e28 6974 656d 7329 203d 3d20 313a  len(items) == 1:
+000105f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00010600: 7572 6e20 4e75 6d62 6572 7344 6963 7428  urn NumbersDict(
+00010610: 6974 656d 735b 305d 290a 2020 2020 2020  items[0]).      
+00010620: 2020 6966 206c 656e 2869 7465 6d73 2920    if len(items) 
+00010630: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+00010640: 2020 7265 7475 726e 2063 6c73 2e62 696e    return cls.bin
+00010650: 5f6f 7028 6974 656d 735b 305d 2c20 6974  _op(items[0], it
+00010660: 656d 735b 315d 2c20 6f70 3d63 6c73 2e5f  ems[1], op=cls._
+00010670: 6d61 782c 207a 6572 6f3d 4e6f 6e65 290a  max, zero=None).
+00010680: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+00010690: 6c73 2e6d 6178 285b 6974 656d 735b 305d  ls.max([items[0]
+000106a0: 2c20 636c 732e 6d61 7828 6974 656d 735b  , cls.max(items[
+000106b0: 313a 5d29 5d29 0a0a 2020 2020 4063 6c61  1:])])..    @cla
+000106c0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+000106d0: 206d 696e 2863 6c73 2c20 6974 656d 7329   min(cls, items)
+000106e0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000106f0: 2020 2020 2020 456c 656d 656e 742d 7769        Element-wi
+00010700: 7365 206d 696e 696d 756d 2066 6f72 2069  se minimum for i
+00010710: 7465 6d20 696e 2069 7465 6d73 2e0a 2020  tem in items..  
+00010720: 2020 2020 2020 3a70 6172 616d 206c 6973        :param lis
+00010730: 745b 4e75 6d62 6572 7344 6963 747c 696e  t[NumbersDict|in
+00010740: 747c 666c 6f61 745d 2069 7465 6d73 3a0a  t|float] items:.
+00010750: 2020 2020 2020 2020 3a72 7479 7065 3a20          :rtype: 
+00010760: 4e75 6d62 6572 7344 6963 740a 2020 2020  NumbersDict.    
+00010770: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00010780: 6173 7365 7274 2069 7465 6d73 0a20 2020  assert items.   
+00010790: 2020 2020 2069 6620 6c65 6e28 6974 656d       if len(item
+000107a0: 7329 203d 3d20 313a 0a20 2020 2020 2020  s) == 1:.       
+000107b0: 2020 2020 2072 6574 7572 6e20 4e75 6d62       return Numb
+000107c0: 6572 7344 6963 7428 6974 656d 735b 305d  ersDict(items[0]
+000107d0: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+000107e0: 2869 7465 6d73 2920 3d3d 2032 3a0a 2020  (items) == 2:.  
+000107f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00010800: 2063 6c73 2e62 696e 5f6f 7028 6974 656d   cls.bin_op(item
+00010810: 735b 305d 2c20 6974 656d 735b 315d 2c20  s[0], items[1], 
+00010820: 6f70 3d63 6c73 2e5f 6d69 6e2c 207a 6572  op=cls._min, zer
+00010830: 6f3d 4e6f 6e65 290a 2020 2020 2020 2020  o=None).        
+00010840: 7265 7475 726e 2063 6c73 2e6d 696e 285b  return cls.min([
+00010850: 6974 656d 735b 305d 2c20 636c 732e 6d69  items[0], cls.mi
+00010860: 6e28 6974 656d 735b 313a 5d29 5d29 0a0a  n(items[1:])])..
+00010870: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+00010880: 640a 2020 2020 6465 6620 5f6d 6178 5f65  d.    def _max_e
+00010890: 7272 6f72 2829 3a0a 2020 2020 2020 2020  rror():.        
+000108a0: 2320 5769 6c6c 2072 6570 6c61 6365 2073  # Will replace s
+000108b0: 656c 662e 6d61 7820 666f 7220 6561 6368  elf.max for each
+000108c0: 2069 6e73 7461 6e63 652e 2054 6f20 6265   instance. To be
+000108d0: 2073 7572 6520 7468 6174 2077 6520 646f   sure that we do
+000108e0: 6e27 7420 636f 6e66 7573 6520 6974 2077  n't confuse it w
+000108f0: 6974 6820 7365 6c66 2e6d 6178 5f76 616c  ith self.max_val
+00010900: 7565 2e0a 2020 2020 2020 2020 7261 6973  ue..        rais
+00010910: 6520 4578 6365 7074 696f 6e28 2255 7365  e Exception("Use
+00010920: 206d 6178 5f76 616c 7565 2069 6e73 7465   max_value inste
+00010930: 6164 2e22 290a 0a20 2020 2064 6566 206d  ad.")..    def m
+00010940: 6178 5f76 616c 7565 2873 656c 6629 3a0a  ax_value(self):.
+00010950: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010960: 2020 2020 4d61 7869 6d75 6d20 6f66 206f      Maximum of o
+00010970: 7572 2076 616c 7565 732e 0a20 2020 2020  ur values..     
+00010980: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00010990: 6574 7572 6e20 6d61 7828 7365 6c66 2e76  eturn max(self.v
+000109a0: 616c 7565 7328 2929 0a0a 2020 2020 6465  alues())..    de
+000109b0: 6620 6d69 6e5f 7661 6c75 6528 7365 6c66  f min_value(self
+000109c0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+000109d0: 2020 2020 2020 204d 696e 696d 756d 206f         Minimum o
+000109e0: 6620 6f75 7220 7661 6c75 6573 2e0a 2020  f our values..  
+000109f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00010a00: 2020 7265 7475 726e 206d 696e 2873 656c    return min(sel
+00010a10: 662e 7661 6c75 6573 2829 290a 0a20 2020  f.values())..   
+00010a20: 2064 6566 205f 5f72 6570 725f 5f28 7365   def __repr__(se
+00010a30: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
+00010a40: 7365 6c66 2e76 616c 7565 2069 7320 4e6f  self.value is No
+00010a50: 6e65 2061 6e64 206e 6f74 2073 656c 662e  ne and not self.
+00010a60: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
+00010a70: 2020 7265 7475 726e 2022 2573 2829 2220    return "%s()" 
+00010a80: 2520 7365 6c66 2e5f 5f63 6c61 7373 5f5f  % self.__class__
+00010a90: 2e5f 5f6e 616d 655f 5f0a 2020 2020 2020  .__name__.      
+00010aa0: 2020 6966 2073 656c 662e 7661 6c75 6520    if self.value 
+00010ab0: 6973 204e 6f6e 6520 616e 6420 7365 6c66  is None and self
+00010ac0: 2e64 6963 743a 0a20 2020 2020 2020 2020  .dict:.         
+00010ad0: 2020 2072 6574 7572 6e20 2225 7328 2572     return "%s(%r
+00010ae0: 2922 2025 2028 7365 6c66 2e5f 5f63 6c61  )" % (self.__cla
+00010af0: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 2073  ss__.__name__, s
+00010b00: 656c 662e 6469 6374 290a 2020 2020 2020  elf.dict).      
+00010b10: 2020 6966 206e 6f74 2073 656c 662e 6469    if not self.di
+00010b20: 6374 2061 6e64 2073 656c 662e 7661 6c75  ct and self.valu
+00010b30: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00010b40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00010b50: 6e20 2225 7328 2572 2922 2025 2028 7365  n "%s(%r)" % (se
+00010b60: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
+00010b70: 616d 655f 5f2c 2073 656c 662e 7661 6c75  ame__, self.valu
+00010b80: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+00010b90: 6e20 2225 7328 6e75 6d62 6572 735f 6469  n "%s(numbers_di
+00010ba0: 6374 3d25 722c 2062 726f 6164 6361 7374  ct=%r, broadcast
+00010bb0: 5f76 616c 7565 3d25 7229 2220 2520 2873  _value=%r)" % (s
+00010bc0: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
+00010bd0: 6e61 6d65 5f5f 2c20 7365 6c66 2e64 6963  name__, self.dic
+00010be0: 742c 2073 656c 662e 7661 6c75 6529 0a0a  t, self.value)..
+00010bf0: 0a64 6566 2063 6f6c 6c65 6374 5f63 6c61  .def collect_cla
+00010c00: 7373 5f69 6e69 745f 6b77 6172 6773 2863  ss_init_kwargs(c
+00010c10: 6c73 2c20 6f6e 6c79 5f77 6974 685f 6465  ls, only_with_de
+00010c20: 6661 756c 743d 4661 6c73 6529 3a0a 2020  fault=False):.  
+00010c30: 2020 2222 220a 2020 2020 3a70 6172 616d    """.    :param
+00010c40: 2074 7970 6520 636c 733a 2063 6c61 7373   type cls: class
+00010c50: 2c20 7768 6572 6520 6974 2061 7373 756d  , where it assum
+00010c60: 6573 2074 6861 7420 6b77 6172 6773 2061  es that kwargs a
+00010c70: 7265 2070 6173 7365 6420 6f6e 2074 6f20  re passed on to 
+00010c80: 6261 7365 2063 6c61 7373 6573 0a20 2020  base classes.   
+00010c90: 203a 7061 7261 6d20 626f 6f6c 206f 6e6c   :param bool onl
+00010ca0: 795f 7769 7468 5f64 6566 6175 6c74 3a20  y_with_default: 
+00010cb0: 6966 2067 6976 656e 2077 696c 6c20 6f6e  if given will on
+00010cc0: 6c79 2072 6574 7572 6e20 7468 6520 6b77  ly return the kw
+00010cd0: 6172 6773 2077 6974 6820 6465 6661 756c  args with defaul
+00010ce0: 7420 7661 6c75 6573 0a20 2020 203a 7265  t values.    :re
+00010cf0: 7475 726e 3a20 7365 7420 6966 206e 6f74  turn: set if not
+00010d00: 2077 6974 685f 6465 6661 756c 742c 206f   with_default, o
+00010d10: 7468 6572 7769 7365 2074 6865 2064 6963  therwise the dic
+00010d20: 7420 746f 2074 6865 2064 6566 6175 6c74  t to the default
+00010d30: 2076 616c 7565 730a 2020 2020 3a72 7479   values.    :rty
+00010d40: 7065 3a20 6c69 7374 5b73 7472 5d20 7c20  pe: list[str] | 
+00010d50: 6469 6374 5b73 7472 5d0a 2020 2020 2222  dict[str].    ""
+00010d60: 220a 2020 2020 6672 6f6d 2063 6f6c 6c65  ".    from colle
+00010d70: 6374 696f 6e73 2069 6d70 6f72 7420 4f72  ctions import Or
+00010d80: 6465 7265 6444 6963 740a 0a20 2020 2069  deredDict..    i
+00010d90: 6620 6f6e 6c79 5f77 6974 685f 6465 6661  f only_with_defa
+00010da0: 756c 743a 0a20 2020 2020 2020 206b 7761  ult:.        kwa
+00010db0: 7267 7320 3d20 4f72 6465 7265 6444 6963  rgs = OrderedDic
+00010dc0: 7428 290a 2020 2020 656c 7365 3a0a 2020  t().    else:.  
+00010dd0: 2020 2020 2020 6b77 6172 6773 203d 205b        kwargs = [
+00010de0: 5d0a 2020 2020 666f 7220 636c 735f 2069  ].    for cls_ i
+00010df0: 6e20 696e 7370 6563 742e 6765 746d 726f  n inspect.getmro
+00010e00: 2863 6c73 293a 0a20 2020 2020 2020 2023  (cls):.        #
+00010e10: 2043 6865 636b 2050 7974 686f 6e20 6675   Check Python fu
+00010e20: 6e63 7469 6f6e 2e20 436f 756c 6420 6265  nction. Could be
+00010e30: 2062 7569 6c74 696e 2066 756e 6320 6f72   builtin func or
+00010e40: 2073 6f2e 2050 7974 686f 6e20 3220 6765   so. Python 2 ge
+00010e50: 7461 7267 7370 6563 2064 6f65 7320 6e6f  targspec does no
+00010e60: 7420 776f 726b 2069 6e20 7468 6174 2063  t work in that c
+00010e70: 6173 652e 0a20 2020 2020 2020 2069 6620  ase..        if 
+00010e80: 6e6f 7420 696e 7370 6563 742e 6973 6d65  not inspect.isme
+00010e90: 7468 6f64 2863 6c73 5f2e 5f5f 696e 6974  thod(cls_.__init
+00010ea0: 5f5f 2920 616e 6420 6e6f 7420 696e 7370  __) and not insp
+00010eb0: 6563 742e 6973 6675 6e63 7469 6f6e 2863  ect.isfunction(c
+00010ec0: 6c73 5f2e 5f5f 696e 6974 5f5f 293a 0a20  ls_.__init__):. 
+00010ed0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00010ee0: 6e75 650a 2020 2020 2020 2020 6172 675f  nue.        arg_
+00010ef0: 7370 6563 203d 2067 6574 6172 6773 7065  spec = getargspe
+00010f00: 6328 636c 735f 2e5f 5f69 6e69 745f 5f29  c(cls_.__init__)
+00010f10: 0a20 2020 2020 2020 2061 7267 7320 3d20  .        args = 
+00010f20: 6172 675f 7370 6563 2e61 7267 735b 313a  arg_spec.args[1:
+00010f30: 5d20 2023 2066 6972 7374 2061 7267 2069  ]  # first arg i
+00010f40: 7320 7365 6c66 2c20 6967 6e6f 7265 0a20  s self, ignore. 
+00010f50: 2020 2020 2020 2069 6620 6f6e 6c79 5f77         if only_w
+00010f60: 6974 685f 6465 6661 756c 743a 0a20 2020  ith_default:.   
+00010f70: 2020 2020 2020 2020 2069 6620 6172 675f           if arg_
+00010f80: 7370 6563 2e64 6566 6175 6c74 733a 0a20  spec.defaults:. 
+00010f90: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00010fa0: 7373 6572 7420 6c65 6e28 6172 675f 7370  ssert len(arg_sp
+00010fb0: 6563 2e64 6566 6175 6c74 7329 203c 3d20  ec.defaults) <= 
+00010fc0: 6c65 6e28 6172 6773 290a 2020 2020 2020  len(args).      
+00010fd0: 2020 2020 2020 2020 2020 6172 6773 203d            args =
+00010fe0: 2061 7267 735b 6c65 6e28 6172 6773 2920   args[len(args) 
+00010ff0: 2d20 6c65 6e28 6172 675f 7370 6563 2e64  - len(arg_spec.d
+00011000: 6566 6175 6c74 7329 203a 5d0a 2020 2020  efaults) :].    
+00011010: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00011020: 7274 206c 656e 2861 7267 5f73 7065 632e  rt len(arg_spec.
+00011030: 6465 6661 756c 7473 2920 3d3d 206c 656e  defaults) == len
+00011040: 2861 7267 7329 2c20 6172 675f 7370 6563  (args), arg_spec
+00011050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011060: 2066 6f72 2061 7267 2c20 6465 6661 756c   for arg, defaul
+00011070: 7420 696e 207a 6970 2861 7267 732c 2061  t in zip(args, a
+00011080: 7267 5f73 7065 632e 6465 6661 756c 7473  rg_spec.defaults
+00011090: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000110a0: 2020 2020 2020 206b 7761 7267 735b 6172         kwargs[ar
+000110b0: 675d 203d 2064 6566 6175 6c74 0a20 2020  g] = default.   
+000110c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000110d0: 2020 2020 2020 2066 6f72 2061 7267 2069         for arg i
+000110e0: 6e20 6172 6773 3a0a 2020 2020 2020 2020  n args:.        
+000110f0: 2020 2020 2020 2020 6966 2061 7267 206e          if arg n
+00011100: 6f74 2069 6e20 6b77 6172 6773 3a0a 2020  ot in kwargs:.  
+00011110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011120: 2020 6b77 6172 6773 2e61 7070 656e 6428    kwargs.append(
+00011130: 6172 6729 0a20 2020 2072 6574 7572 6e20  arg).    return 
+00011140: 6b77 6172 6773 0a0a 0a64 6566 2067 6574  kwargs...def get
+00011150: 6172 6773 7065 6328 6675 6e63 293a 0a20  argspec(func):. 
+00011160: 2020 2022 2222 0a20 2020 203a 6675 6e63     """.    :func
+00011170: 3a60 696e 7370 6563 742e 6765 7466 756c  :`inspect.getful
+00011180: 6c61 7267 7370 6563 6020 6f72 2060 696e  largspec` or `in
+00011190: 7370 6563 742e 6765 7461 7267 7370 6563  spect.getargspec
+000111a0: 6020 2850 7974 686f 6e20 3229 0a0a 2020  ` (Python 2)..  
+000111b0: 2020 3a70 6172 616d 2066 756e 633a 0a20    :param func:. 
+000111c0: 2020 203a 7265 7475 726e 3a20 4675 6c6c     :return: Full
+000111d0: 4172 6753 7065 630a 2020 2020 2222 220a  ArgSpec.    """.
+000111e0: 2020 2020 6966 2050 5933 3a0a 2020 2020      if PY3:.    
+000111f0: 2020 2020 7265 7475 726e 2069 6e73 7065      return inspe
+00011200: 6374 2e67 6574 6675 6c6c 6172 6773 7065  ct.getfullargspe
+00011210: 6328 6675 6e63 290a 2020 2020 656c 7365  c(func).    else
+00011220: 3a0a 2020 2020 2020 2020 2320 6e6f 696e  :.        # noin
+00011230: 7370 6563 7469 6f6e 2050 7944 6570 7265  spection PyDepre
+00011240: 6361 7469 6f6e 0a20 2020 2020 2020 2072  cation.        r
+00011250: 6574 7572 6e20 696e 7370 6563 742e 6765  eturn inspect.ge
+00011260: 7461 7267 7370 6563 2866 756e 6329 0a0a  targspec(func)..
+00011270: 0a64 6566 2063 6f6c 6c65 6374 5f6d 616e  .def collect_man
+00011280: 6461 746f 7279 5f63 6c61 7373 5f69 6e69  datory_class_ini
+00011290: 745f 6b77 6172 6773 2863 6c73 293a 0a20  t_kwargs(cls):. 
+000112a0: 2020 2022 2222 0a20 2020 203a 7061 7261     """.    :para
+000112b0: 6d20 7479 7065 2063 6c73 3a0a 2020 2020  m type cls:.    
+000112c0: 3a72 6574 7572 6e3a 206c 6973 7420 6f66  :return: list of
+000112d0: 206b 7761 7267 7320 7768 6963 6820 6861   kwargs which ha
+000112e0: 7665 206e 6f20 6465 6661 756c 742c 2069  ve no default, i
+000112f0: 2e65 2e20 7768 6963 6820 6d75 7374 2062  .e. which must b
+00011300: 6520 7072 6f76 6964 6564 0a20 2020 203a  e provided.    :
+00011310: 7274 7970 653a 206c 6973 745b 7374 725d  rtype: list[str]
+00011320: 0a20 2020 2022 2222 0a20 2020 2061 6c6c  .    """.    all
+00011330: 5f6b 7761 7267 7320 3d20 636f 6c6c 6563  _kwargs = collec
+00011340: 745f 636c 6173 735f 696e 6974 5f6b 7761  t_class_init_kwa
+00011350: 7267 7328 636c 732c 206f 6e6c 795f 7769  rgs(cls, only_wi
+00011360: 7468 5f64 6566 6175 6c74 3d46 616c 7365  th_default=False
+00011370: 290a 2020 2020 6465 6661 756c 745f 6b77  ).    default_kw
+00011380: 6172 6773 203d 2063 6f6c 6c65 6374 5f63  args = collect_c
+00011390: 6c61 7373 5f69 6e69 745f 6b77 6172 6773  lass_init_kwargs
+000113a0: 2863 6c73 2c20 6f6e 6c79 5f77 6974 685f  (cls, only_with_
+000113b0: 6465 6661 756c 743d 5472 7565 290a 2020  default=True).  
+000113c0: 2020 6d61 6e64 6174 6f72 795f 6b77 6172    mandatory_kwar
+000113d0: 6773 203d 205b 5d0a 2020 2020 666f 7220  gs = [].    for 
+000113e0: 6172 6720 696e 2061 6c6c 5f6b 7761 7267  arg in all_kwarg
+000113f0: 733a 0a20 2020 2020 2020 2069 6620 6172  s:.        if ar
+00011400: 6720 6e6f 7420 696e 2064 6566 6175 6c74  g not in default
+00011410: 5f6b 7761 7267 733a 0a20 2020 2020 2020  _kwargs:.       
+00011420: 2020 2020 206d 616e 6461 746f 7279 5f6b       mandatory_k
+00011430: 7761 7267 732e 6170 7065 6e64 2861 7267  wargs.append(arg
+00011440: 290a 2020 2020 7265 7475 726e 206d 616e  ).    return man
+00011450: 6461 746f 7279 5f6b 7761 7267 730a 0a0a  datory_kwargs...
+00011460: 6465 6620 6865 6c70 5f6f 6e5f 7479 7065  def help_on_type
+00011470: 5f65 7272 6f72 5f77 726f 6e67 5f61 7267  _error_wrong_arg
+00011480: 7328 636c 732c 206b 7761 7267 7329 3a0a  s(cls, kwargs):.
+00011490: 2020 2020 2222 220a 2020 2020 3a70 6172      """.    :par
+000114a0: 616d 2074 7970 6520 636c 733a 0a20 2020  am type cls:.   
+000114b0: 203a 7061 7261 6d20 6c69 7374 5b73 7472   :param list[str
+000114c0: 5d20 6b77 6172 6773 3a0a 2020 2020 2222  ] kwargs:.    ""
+000114d0: 220a 2020 2020 6d61 6e64 6174 6f72 795f  ".    mandatory_
+000114e0: 6172 6773 203d 2063 6f6c 6c65 6374 5f6d  args = collect_m
+000114f0: 616e 6461 746f 7279 5f63 6c61 7373 5f69  andatory_class_i
+00011500: 6e69 745f 6b77 6172 6773 2863 6c73 290a  nit_kwargs(cls).
+00011510: 2020 2020 666f 7220 6172 6720 696e 206b      for arg in k
+00011520: 7761 7267 733a 0a20 2020 2020 2020 2069  wargs:.        i
+00011530: 6620 6172 6720 696e 206d 616e 6461 746f  f arg in mandato
+00011540: 7279 5f61 7267 733a 0a20 2020 2020 2020  ry_args:.       
+00011550: 2020 2020 206d 616e 6461 746f 7279 5f61       mandatory_a
+00011560: 7267 732e 7265 6d6f 7665 2861 7267 290a  rgs.remove(arg).
+00011570: 2020 2020 616c 6c5f 6b77 6172 6773 203d      all_kwargs =
+00011580: 2063 6f6c 6c65 6374 5f63 6c61 7373 5f69   collect_class_i
+00011590: 6e69 745f 6b77 6172 6773 2863 6c73 290a  nit_kwargs(cls).
+000115a0: 2020 2020 756e 6b6e 6f77 6e5f 6172 6773      unknown_args
+000115b0: 203d 205b 5d0a 2020 2020 666f 7220 6172   = [].    for ar
+000115c0: 6720 696e 206b 7761 7267 733a 0a20 2020  g in kwargs:.   
+000115d0: 2020 2020 2069 6620 6172 6720 6e6f 7420       if arg not 
+000115e0: 696e 2061 6c6c 5f6b 7761 7267 733a 0a20  in all_kwargs:. 
+000115f0: 2020 2020 2020 2020 2020 2075 6e6b 6e6f             unkno
+00011600: 776e 5f61 7267 732e 6170 7065 6e64 2861  wn_args.append(a
+00011610: 7267 290a 2020 2020 6966 206d 616e 6461  rg).    if manda
+00011620: 746f 7279 5f61 7267 7320 6f72 2075 6e6b  tory_args or unk
+00011630: 6e6f 776e 5f61 7267 733a 0a20 2020 2020  nown_args:.     
+00011640: 2020 2070 7269 6e74 2822 4172 6773 206d     print("Args m
+00011650: 6973 6d61 7463 683f 204d 6973 7369 6e67  ismatch? Missing
+00011660: 2061 7265 2025 722c 2075 6e6b 6e6f 776e   are %r, unknown
+00011670: 7320 6172 6520 2572 2e20 4b77 6172 6773  s are %r. Kwargs
+00011680: 2025 722e 2220 2520 286d 616e 6461 746f   %r." % (mandato
+00011690: 7279 5f61 7267 732c 2075 6e6b 6e6f 776e  ry_args, unknown
+000116a0: 5f61 7267 732c 206b 7761 7267 7329 290a  _args, kwargs)).
+000116b0: 0a0a 6465 6620 6375 7374 6f6d 5f65 7865  ..def custom_exe
+000116c0: 6328 736f 7572 6365 2c20 736f 7572 6365  c(source, source
+000116d0: 5f66 696c 656e 616d 652c 2075 7365 725f  _filename, user_
+000116e0: 6e73 2c20 7573 6572 5f67 6c6f 6261 6c5f  ns, user_global_
+000116f0: 6e73 293a 0a20 2020 2022 2222 0a20 2020  ns):.    """.   
+00011700: 203a 7061 7261 6d20 7374 7220 736f 7572   :param str sour
+00011710: 6365 3a0a 2020 2020 3a70 6172 616d 2073  ce:.    :param s
+00011720: 7472 2073 6f75 7263 655f 6669 6c65 6e61  tr source_filena
+00011730: 6d65 3a0a 2020 2020 3a70 6172 616d 2064  me:.    :param d
+00011740: 6963 745b 7374 725d 2075 7365 725f 6e73  ict[str] user_ns
+00011750: 3a0a 2020 2020 3a70 6172 616d 2064 6963  :.    :param dic
+00011760: 745b 7374 725d 2075 7365 725f 676c 6f62  t[str] user_glob
+00011770: 616c 5f6e 733a 0a20 2020 203a 7265 7475  al_ns:.    :retu
+00011780: 726e 3a20 6e6f 7468 696e 670a 2020 2020  rn: nothing.    
+00011790: 2222 220a 2020 2020 6966 206e 6f74 2073  """.    if not s
+000117a0: 6f75 7263 652e 656e 6473 7769 7468 2822  ource.endswith("
+000117b0: 5c6e 2229 3a0a 2020 2020 2020 2020 736f  \n"):.        so
+000117c0: 7572 6365 202b 3d20 225c 6e22 0a20 2020  urce += "\n".   
+000117d0: 2063 6f20 3d20 636f 6d70 696c 6528 736f   co = compile(so
+000117e0: 7572 6365 2c20 736f 7572 6365 5f66 696c  urce, source_fil
+000117f0: 656e 616d 652c 2022 6578 6563 2229 0a20  ename, "exec"). 
+00011800: 2020 2075 7365 725f 676c 6f62 616c 5f6e     user_global_n
+00011810: 735b 225f 5f70 6163 6b61 6765 5f5f 225d  s["__package__"]
+00011820: 203d 2022 7265 7475 726e 6e22 2020 2320   = "returnn"  # 
+00011830: 696d 706f 7274 616e 7420 736f 2074 6861  important so tha
+00011840: 7420 696d 706f 7274 7320 776f 726b 0a20  t imports work. 
+00011850: 2020 2065 7661 6c28 636f 2c20 7573 6572     eval(co, user
+00011860: 5f67 6c6f 6261 6c5f 6e73 2c20 7573 6572  _global_ns, user
+00011870: 5f6e 7329 0a0a 0a63 6c61 7373 2046 726f  _ns)...class Fro
+00011880: 7a65 6e44 6963 7428 6469 6374 293a 0a20  zenDict(dict):. 
+00011890: 2020 2022 2222 0a20 2020 2046 726f 7a65     """.    Froze
+000118a0: 6e20 6469 6374 2e0a 2020 2020 2222 220a  n dict..    """.
+000118b0: 0a20 2020 2064 6566 205f 5f73 6574 6974  .    def __setit
+000118c0: 656d 5f5f 2873 656c 662c 206b 6579 2c20  em__(self, key, 
+000118d0: 7661 6c75 6529 3a0a 2020 2020 2020 2020  value):.        
+000118e0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000118f0: 2822 4672 6f7a 656e 4469 6374 2063 616e  ("FrozenDict can
+00011900: 6e6f 7420 6265 206d 6f64 6966 6965 6422  not be modified"
+00011910: 290a 0a20 2020 2064 6566 205f 5f68 6173  )..    def __has
+00011920: 685f 5f28 7365 6c66 293a 0a20 2020 2020  h__(self):.     
+00011930: 2020 2072 6574 7572 6e20 6861 7368 2874     return hash(t
+00011940: 7570 6c65 2873 6f72 7465 6428 7365 6c66  uple(sorted(self
+00011950: 2e69 7465 6d73 2829 2929 290a 0a0a 6465  .items())))...de
+00011960: 6620 6d61 6b65 5f68 6173 6861 626c 6528  f make_hashable(
+00011970: 6f62 6a29 3a0a 2020 2020 2222 220a 2020  obj):.    """.  
+00011980: 2020 5468 6561 6e6f 206e 6565 6473 2068    Theano needs h
+00011990: 6173 6861 626c 6520 6f62 6a65 6374 7320  ashable objects 
+000119a0: 696e 2073 6f6d 6520 6361 7365 732c 2065  in some cases, e
+000119b0: 2e67 2e20 7468 6520 7072 6f70 6572 7469  .g. the properti
+000119c0: 6573 206f 6620 4f70 732e 0a20 2020 2054  es of Ops..    T
+000119d0: 6869 7320 636f 6e76 6572 7473 2061 6c6c  his converts all
+000119e0: 206f 626a 6563 7473 2061 7320 7375 6368   objects as such
+000119f0: 2c20 692e 652e 2069 6e74 6f20 696d 6d75  , i.e. into immu
+00011a00: 7461 626c 6520 6672 6f7a 656e 2074 7970  table frozen typ
+00011a10: 6573 2e0a 0a20 2020 203a 7061 7261 6d20  es...    :param 
+00011a20: 547c 6469 6374 7c6c 6973 747c 7475 706c  T|dict|list|tupl
+00011a30: 6520 6f62 6a3a 0a20 2020 203a 7274 7970  e obj:.    :rtyp
+00011a40: 653a 2054 7c46 726f 7a65 6e44 6963 747c  e: T|FrozenDict|
+00011a50: 7475 706c 650a 2020 2020 2222 220a 2020  tuple.    """.  
+00011a60: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00011a70: 6f62 6a2c 2064 6963 7429 3a0a 2020 2020  obj, dict):.    
+00011a80: 2020 2020 7265 7475 726e 2046 726f 7a65      return Froze
+00011a90: 6e44 6963 7428 5b6d 616b 655f 6861 7368  nDict([make_hash
+00011aa0: 6162 6c65 2869 7465 6d29 2066 6f72 2069  able(item) for i
+00011ab0: 7465 6d20 696e 206f 626a 2e69 7465 6d73  tem in obj.items
+00011ac0: 2829 5d29 0a20 2020 2069 6620 6973 696e  ()]).    if isin
+00011ad0: 7374 616e 6365 286f 626a 2c20 286c 6973  stance(obj, (lis
+00011ae0: 742c 2074 7570 6c65 2929 3a0a 2020 2020  t, tuple)):.    
+00011af0: 2020 2020 7265 7475 726e 2074 7570 6c65      return tuple
+00011b00: 285b 6d61 6b65 5f68 6173 6861 626c 6528  ([make_hashable(
+00011b10: 6974 656d 2920 666f 7220 6974 656d 2069  item) for item i
+00011b20: 6e20 6f62 6a5d 290a 2020 2020 6966 2069  n obj]).    if i
+00011b30: 7369 6e73 7461 6e63 6528 6f62 6a2c 2028  sinstance(obj, (
+00011b40: 7374 722c 2075 6e69 636f 6465 2c20 666c  str, unicode, fl
+00011b50: 6f61 742c 2069 6e74 2c20 6c6f 6e67 2929  oat, int, long))
+00011b60: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00011b70: 206f 626a 0a20 2020 2069 6620 6f62 6a20   obj.    if obj 
+00011b80: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00011b90: 2072 6574 7572 6e20 6f62 6a0a 2020 2020   return obj.    
+00011ba0: 6966 2022 7465 6e73 6f72 666c 6f77 2220  if "tensorflow" 
+00011bb0: 696e 2073 7973 2e6d 6f64 756c 6573 3a0a  in sys.modules:.
+00011bc0: 2020 2020 2020 2020 696d 706f 7274 2074          import t
+00011bd0: 656e 736f 7266 6c6f 7720 6173 2074 660a  ensorflow as tf.
+00011be0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00011bf0: 7374 616e 6365 286f 626a 2c20 7466 2e54  stance(obj, tf.T
+00011c00: 656e 736f 7229 3a0a 2020 2020 2020 2020  ensor):.        
+00011c10: 2020 2020 7265 7475 726e 2052 6566 4964      return RefId
+00011c20: 4571 286f 626a 290a 2020 2020 6173 7365  Eq(obj).    asse
+00011c30: 7274 2046 616c 7365 2c20 2264 6f6e 2774  rt False, "don't
+00011c40: 206b 6e6f 7720 686f 7720 746f 206d 616b   know how to mak
+00011c50: 6520 6861 7368 6162 6c65 3a20 2572 2028  e hashable: %r (
+00011c60: 2572 2922 2025 2028 6f62 6a2c 2074 7970  %r)" % (obj, typ
+00011c70: 6528 6f62 6a29 290a 0a0a 636c 6173 7320  e(obj))...class 
+00011c80: 5265 6649 6445 7128 4765 6e65 7269 635b  RefIdEq(Generic[
+00011c90: 545d 293a 0a20 2020 2022 2222 0a20 2020  T]):.    """.   
+00011ca0: 2052 6566 6572 656e 6365 2074 6f20 736f   Reference to so
+00011cb0: 6d65 206f 626a 6563 7420 2865 2e67 2e20  me object (e.g. 
+00011cc0: 742e 6654 656e 736f 7229 2c20 6275 7420  t.fTensor), but 
+00011cd0: 7468 6973 206f 626a 6563 7420 6973 2061  this object is a
+00011ce0: 6c77 6179 7320 6861 7368 6162 6c65 2c0a  lways hashable,.
+00011cf0: 2020 2020 616e 6420 7573 6573 2074 6865      and uses the
+00011d00: 2060 6964 6020 6f66 2074 6865 2066 756e   `id` of the fun
+00011d10: 6374 696f 6e20 666f 7220 7468 6520 6861  ction for the ha
+00011d20: 7368 2061 6e64 2065 7175 616c 6974 792e  sh and equality.
+00011d30: 0a0a 2020 2020 2849 6e20 6361 7365 206f  ..    (In case o
+00011d40: 6620 7466 2e54 656e 736f 722c 2074 6869  f tf.Tensor, thi
+00011d50: 7320 6973 2066 6f72 2063 6f6d 7061 7469  s is for compati
+00011d60: 6269 6c69 7479 0a20 2020 2020 6265 6361  bility.     beca
+00011d70: 7573 6520 7466 2e54 656e 736f 722e 7265  use tf.Tensor.re
+00011d80: 6628 2920 7761 7320 6e6f 7420 6176 6169  f() was not avai
+00011d90: 6c61 626c 6520 696e 2065 6172 6c69 6572  lable in earlier
+00011da0: 2054 4620 7665 7273 696f 6e73 2e0a 2020   TF versions..  
+00011db0: 2020 2048 6f77 6576 6572 2c20 7765 2061     However, we a
+00011dc0: 6c73 6f20 6e65 6564 2074 6869 7320 666f  lso need this fo
+00011dd0: 7220 3a63 6c61 7373 3a60 4469 6374 5265  r :class:`DictRe
+00011de0: 664b 6579 7360 2e29 0a20 2020 2022 2222  fKeys`.).    """
+00011df0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00011e00: 5f5f 2873 656c 662c 206f 626a 3a20 5429  __(self, obj: T)
+00011e10: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00011e20: 2020 2020 2020 3a70 6172 616d 206f 626a        :param obj
+00011e30: 3a20 666f 7220 6578 616d 706c 6520 7466  : for example tf
+00011e40: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+00011e50: 2222 220a 2020 2020 2020 2020 7365 6c66  """.        self
+00011e60: 2e6f 626a 203d 206f 626a 0a0a 2020 2020  .obj = obj..    
+00011e70: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
+00011e80: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+00011e90: 726e 2022 5465 6e73 6f72 5265 667b 2572  rn "TensorRef{%r
+00011ea0: 7d22 2025 2073 656c 662e 6f62 6a0a 0a20  }" % self.obj.. 
+00011eb0: 2020 2064 6566 205f 5f65 715f 5f28 7365     def __eq__(se
+00011ec0: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
+00011ed0: 2020 2020 6966 206f 7468 6572 2069 7320      if other is 
+00011ee0: 4e6f 6e65 206f 7220 6e6f 7420 6973 696e  None or not isin
+00011ef0: 7374 616e 6365 286f 7468 6572 2c20 5265  stance(other, Re
+00011f00: 6649 6445 7129 3a0a 2020 2020 2020 2020  fIdEq):.        
+00011f10: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00011f20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00011f30: 7365 6c66 2e6f 626a 2069 7320 6f74 6865  self.obj is othe
+00011f40: 722e 6f62 6a0a 0a20 2020 2064 6566 205f  r.obj..    def _
+00011f50: 5f6e 655f 5f28 7365 6c66 2c20 6f74 6865  _ne__(self, othe
+00011f60: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
+00011f70: 726e 206e 6f74 2073 656c 662e 5f5f 6571  rn not self.__eq
+00011f80: 5f5f 286f 7468 6572 290a 0a20 2020 2064  __(other)..    d
+00011f90: 6566 205f 5f68 6173 685f 5f28 7365 6c66  ef __hash__(self
+00011fa0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00011fb0: 6e20 6964 2873 656c 662e 6f62 6a29 0a0a  n id(self.obj)..
+00011fc0: 0a63 6c61 7373 2044 6963 7452 6566 4b65  .class DictRefKe
+00011fd0: 7973 2847 656e 6572 6963 5b4b 2c20 565d  ys(Generic[K, V]
+00011fe0: 293a 0a20 2020 2022 2222 0a20 2020 204c  ):.    """.    L
+00011ff0: 696b 6520 6064 6963 7460 2c20 6275 7420  ike `dict`, but 
+00012000: 6861 7368 2061 6e64 2065 7175 616c 6974  hash and equalit
+00012010: 7920 6f66 2074 6865 206b 6579 730a 2020  y of the keys.  
+00012020: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+00012030: 5f69 6e69 745f 5f28 7365 6c66 293a 0a20  _init__(self):. 
+00012040: 2020 2020 2020 2073 656c 662e 5f64 203d         self._d =
+00012050: 207b 7d20 2023 2074 7970 653a 2044 6963   {}  # type: Dic
+00012060: 745b 5265 6649 6445 715b 4b5d 2c20 565d  t[RefIdEq[K], V]
+00012070: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
+00012080: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+00012090: 2020 7265 7475 726e 2022 4469 6374 5265    return "DictRe
+000120a0: 664b 6579 7328 2573 2922 2025 2022 2c20  fKeys(%s)" % ", 
+000120b0: 222e 6a6f 696e 285b 2225 723a 2025 7222  ".join(["%r: %r"
+000120c0: 2025 2028 6b2c 2076 2920 666f 7220 286b   % (k, v) for (k
+000120d0: 2c20 7629 2069 6e20 7365 6c66 2e69 7465  , v) in self.ite
+000120e0: 6d73 2829 5d29 0a0a 2020 2020 6465 6620  ms()])..    def 
+000120f0: 6974 656d 7328 7365 6c66 2920 2d3e 2049  items(self) -> I
+00012100: 7465 7261 626c 655b 5475 706c 655b 4b2c  terable[Tuple[K,
+00012110: 2056 5d5d 3a0a 2020 2020 2020 2020 2222   V]]:.        ""
+00012120: 2269 7465 6d73 2222 220a 2020 2020 2020  "items""".      
+00012130: 2020 666f 7220 6b2c 2076 2069 6e20 7365    for k, v in se
+00012140: 6c66 2e5f 642e 6974 656d 7328 293a 0a20  lf._d.items():. 
+00012150: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+00012160: 206b 2e6f 626a 2c20 760a 0a20 2020 2064   k.obj, v..    d
+00012170: 6566 206b 6579 7328 7365 6c66 2920 2d3e  ef keys(self) ->
+00012180: 2049 7465 7261 626c 655b 4b5d 3a0a 2020   Iterable[K]:.  
+00012190: 2020 2020 2020 2222 226b 6579 7322 2222        """keys"""
+000121a0: 0a20 2020 2020 2020 2066 6f72 206b 2069  .        for k i
+000121b0: 6e20 7365 6c66 2e5f 642e 6b65 7973 2829  n self._d.keys()
+000121c0: 3a0a 2020 2020 2020 2020 2020 2020 7969  :.            yi
+000121d0: 656c 6420 6b2e 6f62 6a0a 0a20 2020 2064  eld k.obj..    d
+000121e0: 6566 2076 616c 7565 7328 7365 6c66 2920  ef values(self) 
+000121f0: 2d3e 2049 7465 7261 626c 655b 565d 3a0a  -> Iterable[V]:.
+00012200: 2020 2020 2020 2020 2222 2276 616c 7565          """value
+00012210: 7322 2222 0a20 2020 2020 2020 2066 6f72  s""".        for
+00012220: 2076 2069 6e20 7365 6c66 2e5f 642e 7661   v in self._d.va
+00012230: 6c75 6573 2829 3a0a 2020 2020 2020 2020  lues():.        
+00012240: 2020 2020 7969 656c 6420 760a 0a20 2020      yield v..   
+00012250: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
+00012260: 2873 656c 662c 2069 7465 6d3a 204b 2920  (self, item: K) 
+00012270: 2d3e 2056 3a0a 2020 2020 2020 2020 7265  -> V:.        re
+00012280: 7475 726e 2073 656c 662e 5f64 5b52 6566  turn self._d[Ref
+00012290: 4964 4571 2869 7465 6d29 5d0a 0a20 2020  IdEq(item)]..   
+000122a0: 2064 6566 205f 5f73 6574 6974 656d 5f5f   def __setitem__
+000122b0: 2873 656c 662c 206b 6579 3a20 4b2c 2076  (self, key: K, v
+000122c0: 616c 7565 3a20 5629 3a0a 2020 2020 2020  alue: V):.      
+000122d0: 2020 7365 6c66 2e5f 645b 5265 6649 6445    self._d[RefIdE
+000122e0: 7128 6b65 7929 5d20 3d20 7661 6c75 650a  q(key)] = value.
+000122f0: 0a20 2020 2064 6566 205f 5f63 6f6e 7461  .    def __conta
+00012300: 696e 735f 5f28 7365 6c66 2c20 6974 656d  ins__(self, item
+00012310: 3a20 4b29 3a0a 2020 2020 2020 2020 7265  : K):.        re
+00012320: 7475 726e 2052 6566 4964 4571 2869 7465  turn RefIdEq(ite
+00012330: 6d29 2069 6e20 7365 6c66 2e5f 640a 0a0a  m) in self._d...
+00012340: 6465 6620 6d61 6b65 5f64 6c6c 5f6e 616d  def make_dll_nam
+00012350: 6528 6261 7365 6e61 6d65 293a 0a20 2020  e(basename):.   
+00012360: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
+00012370: 7374 7220 6261 7365 6e61 6d65 3a0a 2020  str basename:.  
+00012380: 2020 3a72 6574 7572 6e3a 2065 2e67 2e20    :return: e.g. 
+00012390: 226c 6962 2573 2e73 6f22 2025 2062 6173  "lib%s.so" % bas
+000123a0: 656e 616d 652c 2064 6570 656e 6469 6e67  ename, depending
+000123b0: 206f 6e20 7379 732e 706c 6174 666f 726d   on sys.platform
+000123c0: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
+000123d0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+000123e0: 7379 732e 706c 6174 666f 726d 203d 3d20  sys.platform == 
+000123f0: 2264 6172 7769 6e22 3a0a 2020 2020 2020  "darwin":.      
+00012400: 2020 7265 7475 726e 2022 6c69 6225 732e    return "lib%s.
+00012410: 6479 6c69 6222 2025 2062 6173 656e 616d  dylib" % basenam
+00012420: 650a 2020 2020 656c 6966 2073 7973 2e70  e.    elif sys.p
+00012430: 6c61 7466 6f72 6d20 3d3d 2022 7769 6e33  latform == "win3
+00012440: 3222 3a0a 2020 2020 2020 2020 7265 7475  2":.        retu
+00012450: 726e 2022 2573 2e64 6c6c 2220 2520 6261  rn "%s.dll" % ba
+00012460: 7365 6e61 6d65 0a20 2020 2065 6c73 653a  sename.    else:
+00012470: 2020 2320 4c69 6e75 782c 2055 6e69 780a    # Linux, Unix.
+00012480: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+00012490: 6c69 6225 732e 736f 2220 2520 6261 7365  lib%s.so" % base
+000124a0: 6e61 6d65 0a0a 0a64 6566 2065 7363 6170  name...def escap
+000124b0: 655f 635f 7374 7228 7329 3a0a 2020 2020  e_c_str(s):.    
+000124c0: 2222 220a 2020 2020 3a70 6172 616d 2073  """.    :param s
+000124d0: 7472 2073 3a0a 2020 2020 3a72 6574 7572  tr s:.    :retur
+000124e0: 6e3a 2043 2d65 7363 6170 6564 2073 7472  n: C-escaped str
+000124f0: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
+00012500: 0a20 2020 2022 2222 0a20 2020 2072 6574  .    """.    ret
+00012510: 7572 6e20 2722 2573 2227 2025 2073 2e72  urn '"%s"' % s.r
+00012520: 6570 6c61 6365 2822 5c5c 5c5c 222c 2022  eplace("\\\\", "
+00012530: 5c5c 2229 2e72 6570 6c61 6365 2822 5c6e  \\").replace("\n
+00012540: 222c 2022 5c5c 6e22 292e 7265 706c 6163  ", "\\n").replac
+00012550: 6528 2722 272c 2027 5c5c 2227 292e 7265  e('"', '\\"').re
+00012560: 706c 6163 6528 2227 222c 2022 5c5c 2722  place("'", "\\'"
+00012570: 290a 0a0a 6465 6620 6174 7472 5f63 6861  )...def attr_cha
+00012580: 696e 2862 6173 652c 2061 7474 7269 6273  in(base, attribs
+00012590: 293a 0a20 2020 2022 2222 0a20 2020 203a  ):.    """.    :
+000125a0: 7061 7261 6d20 6f62 6a65 6374 2062 6173  param object bas
+000125b0: 653a 0a20 2020 203a 7061 7261 6d20 6c69  e:.    :param li
+000125c0: 7374 5b73 7472 5d7c 7475 706c 655b 7374  st[str]|tuple[st
+000125d0: 725d 7c73 7472 2061 7474 7269 6273 3a0a  r]|str attribs:.
+000125e0: 2020 2020 3a72 6574 7572 6e3a 2067 6574      :return: get
+000125f0: 6174 7472 2867 6574 6174 7472 286f 626a  attr(getattr(obj
+00012600: 6563 742c 2061 7474 7269 6273 5b30 5d29  ect, attribs[0])
+00012610: 2c20 6174 7472 6962 735b 315d 2920 2e2e  , attribs[1]) ..
+00012620: 2e0a 2020 2020 3a72 7479 7065 3a20 6f62  ..    :rtype: ob
+00012630: 6a65 6374 0a20 2020 2022 2222 0a20 2020  ject.    """.   
+00012640: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+00012650: 6365 2861 7474 7269 6273 2c20 286c 6973  ce(attribs, (lis
+00012660: 742c 2074 7570 6c65 2929 3a0a 2020 2020  t, tuple)):.    
+00012670: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+00012680: 7461 6e63 6528 6174 7472 6962 732c 2073  tance(attribs, s
+00012690: 7472 290a 2020 2020 2020 2020 6174 7472  tr).        attr
+000126a0: 6962 7320 3d20 5b61 7474 7269 6273 5d0a  ibs = [attribs].
+000126b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000126c0: 2020 6174 7472 6962 7320 3d20 6c69 7374    attribs = list
+000126d0: 2861 7474 7269 6273 290a 2020 2020 666f  (attribs).    fo
+000126e0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+000126f0: 2861 7474 7269 6273 2929 3a0a 2020 2020  (attribs)):.    
+00012700: 2020 2020 6261 7365 203d 2067 6574 6174      base = getat
+00012710: 7472 2862 6173 652c 2061 7474 7269 6273  tr(base, attribs
+00012720: 5b69 5d29 0a20 2020 2072 6574 7572 6e20  [i]).    return 
+00012730: 6261 7365 0a0a 0a64 6566 2074 6f5f 626f  base...def to_bo
+00012740: 6f6c 2876 293a 0a20 2020 2022 2222 0a20  ol(v):.    """. 
+00012750: 2020 203a 7061 7261 6d20 696e 747c 666c     :param int|fl
+00012760: 6f61 747c 7374 7220 763a 2069 6620 6974  oat|str v: if it
+00012770: 2069 7320 6120 7374 7269 6e67 2c20 6974   is a string, it
+00012780: 2073 686f 756c 6420 7265 7072 6573 656e   should represen
+00012790: 7420 736f 6d65 2069 6e74 6567 6572 2c20  t some integer, 
+000127a0: 6f72 2061 6c74 6572 6e61 7469 7665 6c79  or alternatively
+000127b0: 2022 7472 7565 2220 6f72 2022 6661 6c73   "true" or "fals
+000127c0: 6522 0a20 2020 203a 7274 7970 653a 2062  e".    :rtype: b
+000127d0: 6f6f 6c0a 2020 2020 2222 220a 2020 2020  ool.    """.    
+000127e0: 7472 793a 0a20 2020 2020 2020 2072 6574  try:.        ret
+000127f0: 7572 6e20 626f 6f6c 2869 6e74 2876 2929  urn bool(int(v))
+00012800: 0a20 2020 2065 7863 6570 7420 5661 6c75  .    except Valu
+00012810: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
+00012820: 7061 7373 0a20 2020 2069 6620 6973 696e  pass.    if isin
+00012830: 7374 616e 6365 2876 2c20 2873 7472 2c20  stance(v, (str, 
+00012840: 756e 6963 6f64 6529 293a 0a20 2020 2020  unicode)):.     
+00012850: 2020 2076 203d 2076 2e6c 6f77 6572 2829     v = v.lower()
+00012860: 0a20 2020 2020 2020 2069 6620 7620 696e  .        if v in
+00012870: 205b 2274 7275 6522 2c20 2279 6573 222c   ["true", "yes",
+00012880: 2022 6f6e 222c 2022 3122 5d3a 0a20 2020   "on", "1"]:.   
+00012890: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000128a0: 5472 7565 0a20 2020 2020 2020 2069 6620  True.        if 
+000128b0: 7620 696e 205b 2266 616c 7365 222c 2022  v in ["false", "
+000128c0: 6e6f 222c 2022 6f66 6622 2c20 2230 225d  no", "off", "0"]
+000128d0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000128e0: 7475 726e 2046 616c 7365 0a20 2020 2072  turn False.    r
+000128f0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00012900: 2274 6f5f 626f 6f6c 2063 616e 6e6f 7420  "to_bool cannot 
+00012910: 6861 6e64 6c65 2025 7222 2025 2076 290a  handle %r" % v).
+00012920: 0a0a 6465 6620 6173 5f73 7472 2873 293a  ..def as_str(s):
+00012930: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
+00012940: 7261 6d20 7374 727c 756e 6963 6f64 657c  ram str|unicode|
+00012950: 6279 7465 7320 733a 0a20 2020 203a 7274  bytes s:.    :rt
+00012960: 7970 653a 2073 7472 7c75 6e69 636f 6465  ype: str|unicode
+00012970: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+00012980: 6973 696e 7374 616e 6365 2873 2c20 7374  isinstance(s, st
+00012990: 7229 206f 7220 2275 6e69 636f 6465 2220  r) or "unicode" 
+000129a0: 696e 2073 7472 2874 7970 6528 7329 293a  in str(type(s)):
+000129b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000129c0: 730a 2020 2020 6966 2069 7369 6e73 7461  s.    if isinsta
+000129d0: 6e63 6528 732c 2062 7974 6573 2920 6f72  nce(s, bytes) or
+000129e0: 2069 7369 6e73 7461 6e63 6528 732c 2075   isinstance(s, u
+000129f0: 6e69 636f 6465 293a 0a20 2020 2020 2020  nicode):.       
+00012a00: 2023 206e 6f69 6e73 7065 6374 696f 6e20   # noinspection 
+00012a10: 5079 556e 7265 736f 6c76 6564 5265 6665  PyUnresolvedRefe
+00012a20: 7265 6e63 6573 0a20 2020 2020 2020 2072  rences.        r
+00012a30: 6574 7572 6e20 732e 6465 636f 6465 2822  eturn s.decode("
+00012a40: 7574 6638 2229 0a20 2020 2061 7373 6572  utf8").    asser
+00012a50: 7420 4661 6c73 652c 2022 756e 6b6e 6f77  t False, "unknow
+00012a60: 6e20 7479 7065 2025 7322 2025 2074 7970  n type %s" % typ
+00012a70: 6528 7329 0a0a 0a64 6566 2070 7932 5f75  e(s)...def py2_u
+00012a80: 7466 385f 7374 725f 746f 5f75 6e69 636f  tf8_str_to_unico
+00012a90: 6465 2873 293a 0a20 2020 2022 2222 0a20  de(s):.    """. 
+00012aa0: 2020 203a 7061 7261 6d20 7374 7220 733a     :param str s:
+00012ab0: 2065 2e67 2e20 7468 6520 7374 7269 6e67   e.g. the string
+00012ac0: 206c 6974 6572 616c 2022 c3a4 c3b6 c3bc   literal "......
+00012ad0: 2220 696e 2050 7974 686f 6e20 3320 6973  " in Python 3 is
+00012ae0: 2063 6f72 7265 6374 2c20 6275 7420 696e   correct, but in
+00012af0: 2050 7974 686f 6e20 3220 6974 2073 686f   Python 2 it sho
+00012b00: 756c 6420 6861 7665 2062 6565 6e20 7522  uld have been u"
+00012b10: c3a4 c3b6 c3bc 222c 0a20 2020 2020 2062  ......",.      b
+00012b20: 7574 206a 7573 7420 7573 696e 6720 22c3  ut just using ".
+00012b30: a4c3 b6c3 bc22 2077 696c 6c20 6163 7475  ....." will actu
+00012b40: 616c 6c79 2062 6520 7468 6520 7261 7720  ally be the raw 
+00012b50: 7574 6638 2062 7974 6520 7365 7175 656e  utf8 byte sequen
+00012b60: 6365 2e0a 2020 2020 2020 5468 6973 2063  ce..      This c
+00012b70: 616e 2068 6170 7065 6e20 7768 656e 2079  an happen when y
+00012b80: 6f75 2065 7661 6c28 2920 736f 6d65 2073  ou eval() some s
+00012b90: 7472 696e 672e 0a20 2020 2020 2057 6520  tring..      We 
+00012ba0: 6173 7375 6d65 2074 6861 7420 796f 7520  assume that you 
+00012bb0: 6172 6520 7573 696e 6720 5079 7468 6f6e  are using Python
+00012bc0: 2032 2c20 616e 6420 676f 7420 7468 6520   2, and got the 
+00012bd0: 7374 7269 6e67 2028 6e6f 7420 756e 6963  string (not unic
+00012be0: 6f64 6520 6f62 6a65 6374 2920 22c3 a4c3  ode object) "...
+00012bf0: b6c3 bc22 2c20 6f72 206d 6179 6265 2022  ...", or maybe "
+00012c00: 6162 6322 2e0a 2020 2020 2020 416c 736f  abc"..      Also
+00012c10: 2073 6565 203a 6675 6e63 3a60 5f70 7932   see :func:`_py2
+00012c20: 5f75 6e69 636f 6465 5f74 6f5f 7374 725f  _unicode_to_str_
+00012c30: 7265 6375 7273 6976 6560 2061 6e64 203a  recursive` and :
+00012c40: 6675 6e63 3a60 6173 5f73 7472 602e 0a20  func:`as_str`.. 
+00012c50: 2020 203a 7265 7475 726e 3a20 6966 2069     :return: if i
+00012c60: 7420 6973 2069 6e64 6565 6420 756e 6963  t is indeed unic
+00012c70: 6f64 652c 2069 7420 7769 6c6c 2072 6574  ode, it will ret
+00012c80: 7572 6e20 7468 6520 756e 6963 6f64 6520  urn the unicode 
+00012c90: 6f62 6a65 6374 2c20 6f74 6865 7277 6973  object, otherwis
+00012ca0: 6520 6974 206b 6565 7073 2074 6865 2073  e it keeps the s
+00012cb0: 7472 696e 670a 2020 2020 3a72 7479 7065  tring.    :rtype
+00012cc0: 3a20 7374 727c 756e 6963 6f64 650a 2020  : str|unicode.  
+00012cd0: 2020 2222 220a 2020 2020 6173 7365 7274    """.    assert
+00012ce0: 206e 6f74 2050 5933 0a20 2020 2061 7373   not PY3.    ass
+00012cf0: 6572 7420 6973 696e 7374 616e 6365 2873  ert isinstance(s
+00012d00: 2c20 7374 7229 0a20 2020 2074 7279 3a0a  , str).    try:.
+00012d10: 2020 2020 2020 2020 2320 6e6f 696e 7370          # noinsp
+00012d20: 6563 7469 6f6e 2050 7955 6e72 6573 6f6c  ection PyUnresol
+00012d30: 7665 6452 6566 6572 656e 6365 730a 2020  vedReferences.  
+00012d40: 2020 2020 2020 732e 6465 636f 6465 2822        s.decode("
+00012d50: 6173 6369 6922 290a 2020 2020 2020 2020  ascii").        
+00012d60: 7265 7475 726e 2073 0a20 2020 2065 7863  return s.    exc
+00012d70: 6570 7420 556e 6963 6f64 6544 6563 6f64  ept UnicodeDecod
+00012d80: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
+00012d90: 7061 7373 0a20 2020 2023 206e 6f69 6e73  pass.    # noins
+00012da0: 7065 6374 696f 6e20 5079 556e 7265 736f  pection PyUnreso
+00012db0: 6c76 6564 5265 6665 7265 6e63 6573 0a20  lvedReferences. 
+00012dc0: 2020 2072 6574 7572 6e20 732e 6465 636f     return s.deco
+00012dd0: 6465 2822 7574 6638 2229 0a0a 0a64 6566  de("utf8")...def
+00012de0: 2075 6e69 636f 6465 5f74 6f5f 7374 7228   unicode_to_str(
+00012df0: 7329 3a0a 2020 2020 2222 220a 2020 2020  s):.    """.    
+00012e00: 5468 6520 6265 6861 7669 6f72 2069 7320  The behavior is 
+00012e10: 6469 6666 6572 656e 7420 6465 7065 6e64  different depend
+00012e20: 696e 6720 6f6e 2050 7974 686f 6e20 3220  ing on Python 2 
+00012e30: 6f72 2050 7974 686f 6e20 332e 2049 6e20  or Python 3. In 
+00012e40: 616c 6c20 6361 7365 732c 2074 6865 2072  all cases, the r
+00012e50: 6574 7572 6e65 6420 7479 7065 2069 7320  eturned type is 
+00012e60: 6120 7374 7220 6f62 6a65 6374 2e0a 2020  a str object..  
+00012e70: 2020 5079 7468 6f6e 2032 3a0a 2020 2020    Python 2:.    
+00012e80: 2020 5765 2072 6574 7572 6e20 7468 6520    We return the 
+00012e90: 7574 6638 2065 6e63 6f64 6564 2073 7472  utf8 encoded str
+00012ea0: 2028 7768 6963 6820 6973 206c 696b 6520   (which is like 
+00012eb0: 5079 7468 6f6e 2033 2062 7974 6573 2c20  Python 3 bytes, 
+00012ec0: 6f72 2066 6f72 2041 5343 4949 2c20 7468  or for ASCII, th
+00012ed0: 6572 6520 6973 206e 6f20 6469 6666 6572  ere is no differ
+00012ee0: 656e 6365 292e 0a20 2020 2050 7974 686f  ence)..    Pytho
+00012ef0: 6e20 333a 0a20 2020 2020 2057 6520 7265  n 3:.      We re
+00012f00: 7475 726e 2061 2073 7472 206f 626a 6563  turn a str objec
+00012f10: 742e 0a20 2020 204e 6f74 6520 7468 6174  t..    Note that
+00012f20: 2074 6869 7320 6675 6e63 7469 6f6e 2070   this function p
+00012f30: 726f 6261 626c 7920 646f 6573 206e 6f74  robably does not
+00012f40: 206d 616b 6520 6d75 6368 2073 656e 7365   make much sense
+00012f50: 2e0a 2020 2020 4974 206d 6967 6874 2062  ..    It might b
+00012f60: 6520 7573 6564 2077 6865 6e20 7468 6572  e used when ther
+00012f70: 6520 6973 206f 7468 6572 2063 6f64 6520  e is other code 
+00012f80: 7768 6963 6820 6578 7065 6374 7320 6120  which expects a 
+00012f90: 7374 7220 6f62 6a65 6374 2c20 6e6f 206d  str object, no m
+00012fa0: 6174 7465 7220 6966 2050 7974 686f 6e20  atter if Python 
+00012fb0: 3220 6f72 2050 7974 686f 6e20 332e 0a20  2 or Python 3.. 
+00012fc0: 2020 2049 6e20 5079 7468 6f6e 2032 2c20     In Python 2, 
+00012fd0: 6120 7374 7220 6f62 6a65 6374 206f 6674  a str object oft
+00012fe0: 656e 2068 6f6c 6473 2055 5446 3820 7465  en holds UTF8 te
+00012ff0: 7874 2c20 736f 2074 6865 2062 6568 6176  xt, so the behav
+00013000: 696f 7220 6f66 2074 6869 7320 6675 6e63  ior of this func
+00013010: 7469 6f6e 2069 7320 6669 6e65 2074 6865  tion is fine the
+00013020: 6e2e 0a20 2020 2041 6c73 6f20 7365 6520  n..    Also see 
+00013030: 3a66 756e 633a 6061 735f 7374 7260 2e0a  :func:`as_str`..
+00013040: 0a20 2020 203a 7061 7261 6d20 7374 727c  .    :param str|
+00013050: 756e 6963 6f64 657c 6279 7465 7320 733a  unicode|bytes s:
+00013060: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
+00013070: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+00013080: 5059 3320 616e 6420 6973 696e 7374 616e  PY3 and isinstan
+00013090: 6365 2873 2c20 6279 7465 7329 3a0a 2020  ce(s, bytes):.  
+000130a0: 2020 2020 2020 7320 3d20 732e 6465 636f        s = s.deco
+000130b0: 6465 2822 7574 6638 2229 0a20 2020 2020  de("utf8").     
+000130c0: 2020 2061 7373 6572 7420 6973 696e 7374     assert isinst
+000130d0: 616e 6365 2873 2c20 7374 7229 0a20 2020  ance(s, str).   
+000130e0: 2069 6620 6e6f 7420 5059 3320 616e 6420   if not PY3 and 
+000130f0: 6973 696e 7374 616e 6365 2873 2c20 756e  isinstance(s, un
+00013100: 6963 6f64 6529 3a0a 2020 2020 2020 2020  icode):.        
+00013110: 7320 3d20 732e 656e 636f 6465 2822 7574  s = s.encode("ut
+00013120: 6638 2229 0a20 2020 2020 2020 2061 7373  f8").        ass
+00013130: 6572 7420 6973 696e 7374 616e 6365 2873  ert isinstance(s
+00013140: 2c20 7374 7229 0a20 2020 2061 7373 6572  , str).    asser
+00013150: 7420 6973 696e 7374 616e 6365 2873 2c20  t isinstance(s, 
+00013160: 7374 7229 0a20 2020 2072 6574 7572 6e20  str).    return 
+00013170: 730a 0a0a 6465 6620 6465 6570 636f 7079  s...def deepcopy
+00013180: 2878 2c20 7374 6f70 5f74 7970 6573 3d4e  (x, stop_types=N
+00013190: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
+000131a0: 2020 5369 6d70 6c65 7220 7661 7269 616e    Simpler varian
+000131b0: 7420 6f66 2063 6f70 792e 6465 6570 636f  t of copy.deepco
+000131c0: 7079 2829 2e0a 2020 2020 5368 6f75 6c64  py()..    Should
+000131d0: 2068 616e 646c 6520 736f 6d65 2065 6467   handle some edg
+000131e0: 6520 6361 7365 7320 6173 2077 656c 6c2c  e cases as well,
+000131f0: 206c 696b 6520 636f 7079 696e 6720 6d6f   like copying mo
+00013200: 6475 6c65 2072 6566 6572 656e 6365 732e  dule references.
+00013210: 0a0a 2020 2020 3a70 6172 616d 2054 2078  ..    :param T x
+00013220: 3a20 616e 2061 7262 6974 7261 7279 206f  : an arbitrary o
+00013230: 626a 6563 740a 2020 2020 3a70 6172 616d  bject.    :param
+00013240: 206c 6973 745b 7479 7065 5d7c 4e6f 6e65   list[type]|None
+00013250: 2073 746f 705f 7479 7065 733a 206f 626a   stop_types: obj
+00013260: 6563 7473 206f 6620 7468 6573 6520 7479  ects of these ty
+00013270: 7065 7320 7769 6c6c 206e 6f74 2062 6520  pes will not be 
+00013280: 6465 6570 2d63 6f70 6965 642c 206f 6e6c  deep-copied, onl
+00013290: 7920 7468 6520 7265 6665 7265 6e63 6520  y the reference 
+000132a0: 6973 2070 6173 7365 640a 2020 2020 3a72  is passed.    :r
+000132b0: 7479 7065 3a20 540a 2020 2020 2222 220a  type: T.    """.
+000132c0: 2020 2020 2320 5365 6520 616c 736f 2063      # See also c
+000132d0: 6c61 7373 2050 6963 6b6c 6572 2066 726f  lass Pickler fro
+000132e0: 6d20 5461 736b 5379 7374 656d 2e0a 2020  m TaskSystem..  
+000132f0: 2020 2320 4f72 3a20 6874 7470 733a 2f2f    # Or: https://
+00013300: 6d61 696c 2e70 7974 686f 6e2e 6f72 672f  mail.python.org/
+00013310: 7069 7065 726d 6169 6c2f 7079 7468 6f6e  pipermail/python
+00013320: 2d69 6465 6173 2f32 3031 332d 4a75 6c79  -ideas/2013-July
+00013330: 2f30 3231 3935 392e 6874 6d6c 0a20 2020  /021959.html.   
+00013340: 2066 726f 6d20 2e74 6173 6b5f 7379 7374   from .task_syst
+00013350: 656d 2069 6d70 6f72 7420 5069 636b 6c65  em import Pickle
+00013360: 722c 2055 6e70 6963 6b6c 6572 0a0a 2020  r, Unpickler..  
+00013370: 2020 7065 7273 6973 7465 6e74 5f6d 656d    persistent_mem
+00013380: 6f20 3d20 7b7d 2020 2320 6964 202d 3e20  o = {}  # id -> 
+00013390: 6f62 6a0a 0a20 2020 2064 6566 2070 6572  obj..    def per
+000133a0: 7369 7374 656e 745f 6964 286f 626a 293a  sistent_id(obj):
+000133b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000133c0: 2020 2020 203a 7061 7261 6d20 6f62 6a65       :param obje
+000133d0: 6374 206f 626a 3a0a 2020 2020 2020 2020  ct obj:.        
+000133e0: 3a72 7479 7065 3a20 696e 747c 4e6f 6e65  :rtype: int|None
+000133f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013400: 2020 2020 2069 6620 7374 6f70 5f74 7970       if stop_typ
+00013410: 6573 2061 6e64 2069 7369 6e73 7461 6e63  es and isinstanc
+00013420: 6528 6f62 6a2c 2074 7570 6c65 2873 746f  e(obj, tuple(sto
+00013430: 705f 7479 7065 7329 293a 0a20 2020 2020  p_types)):.     
+00013440: 2020 2020 2020 2070 6572 7369 7374 656e         persisten
+00013450: 745f 6d65 6d6f 5b69 6428 6f62 6a29 5d20  t_memo[id(obj)] 
+00013460: 3d20 6f62 6a0a 2020 2020 2020 2020 2020  = obj.          
+00013470: 2020 7265 7475 726e 2069 6428 6f62 6a29    return id(obj)
+00013480: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013490: 4e6f 6e65 0a0a 2020 2020 6465 6620 7069  None..    def pi
+000134a0: 636b 6c65 5f64 756d 7073 286f 626a 293a  ckle_dumps(obj):
+000134b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000134c0: 2020 2020 203a 7061 7261 6d20 6f62 6a65       :param obje
+000134d0: 6374 206f 626a 3a0a 2020 2020 2020 2020  ct obj:.        
+000134e0: 3a72 7479 7065 3a20 6279 7465 730a 2020  :rtype: bytes.  
+000134f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00013500: 2020 7369 6f20 3d20 4279 7465 7349 4f28    sio = BytesIO(
+00013510: 290a 2020 2020 2020 2020 7020 3d20 5069  ).        p = Pi
+00013520: 636b 6c65 7228 7369 6f29 0a20 2020 2020  ckler(sio).     
+00013530: 2020 2070 2e70 6572 7369 7374 656e 745f     p.persistent_
+00013540: 6964 203d 2070 6572 7369 7374 656e 745f  id = persistent_
+00013550: 6964 0a20 2020 2020 2020 2070 2e64 756d  id.        p.dum
+00013560: 7028 6f62 6a29 0a20 2020 2020 2020 2072  p(obj).        r
+00013570: 6574 7572 6e20 7369 6f2e 6765 7476 616c  eturn sio.getval
+00013580: 7565 2829 0a0a 2020 2020 2320 6e6f 696e  ue()..    # noin
+00013590: 7370 6563 7469 6f6e 2050 7953 6861 646f  spection PyShado
+000135a0: 7769 6e67 4e61 6d65 730a 2020 2020 6465  wingNames.    de
+000135b0: 6620 7069 636b 6c65 5f6c 6f61 6473 2873  f pickle_loads(s
+000135c0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+000135d0: 2020 2020 2020 203a 7061 7261 6d20 6279         :param by
+000135e0: 7465 7320 733a 0a20 2020 2020 2020 203a  tes s:.        :
+000135f0: 7274 7970 653a 206f 626a 6563 740a 2020  rtype: object.  
+00013600: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00013610: 2020 7020 3d20 556e 7069 636b 6c65 7228    p = Unpickler(
+00013620: 4279 7465 7349 4f28 7329 290a 2020 2020  BytesIO(s)).    
+00013630: 2020 2020 702e 7065 7273 6973 7465 6e74      p.persistent
+00013640: 5f6c 6f61 6420 3d20 7065 7273 6973 7465  _load = persiste
+00013650: 6e74 5f6d 656d 6f2e 5f5f 6765 7469 7465  nt_memo.__getite
+00013660: 6d5f 5f0a 2020 2020 2020 2020 7265 7475  m__.        retu
+00013670: 726e 2070 2e6c 6f61 6428 290a 0a20 2020  rn p.load()..   
+00013680: 2073 203d 2070 6963 6b6c 655f 6475 6d70   s = pickle_dump
+00013690: 7328 7829 0a20 2020 2063 203d 2070 6963  s(x).    c = pic
+000136a0: 6b6c 655f 6c6f 6164 7328 7329 0a20 2020  kle_loads(s).   
+000136b0: 2072 6574 7572 6e20 630a 0a0a 6465 6620   return c...def 
+000136c0: 6c6f 6164 5f74 7874 5f76 6563 746f 7228  load_txt_vector(
+000136d0: 6669 6c65 6e61 6d65 293a 0a20 2020 2022  filename):.    "
+000136e0: 2222 0a20 2020 2045 7870 6563 7420 6c69  "".    Expect li
+000136f0: 6e65 2d62 6173 6564 2074 6578 7420 656e  ne-based text en
+00013700: 636f 6469 6e67 2069 6e20 6669 6c65 2e0a  coding in file..
+00013710: 2020 2020 5765 2061 6c73 6f20 7375 7070      We also supp
+00013720: 6f72 7420 5370 7269 6e74 2058 4d4c 2066  ort Sprint XML f
+00013730: 6f72 6d61 742c 2077 6869 6368 2068 6173  ormat, which has
+00013740: 2073 6f6d 6520 6164 6469 7469 6f6e 616c   some additional
+00013750: 2078 6d6c 2068 6561 6465 7220 616e 6420   xml header and 
+00013760: 666f 6f74 6572 2c0a 2020 2020 7768 6963  footer,.    whic
+00013770: 6820 7765 2077 696c 6c20 6a75 7374 2073  h we will just s
+00013780: 7472 6970 2061 7761 792e 0a0a 2020 2020  trip away...    
+00013790: 3a70 6172 616d 2073 7472 2066 696c 656e  :param str filen
+000137a0: 616d 653a 0a20 2020 203a 7274 7970 653a  ame:.    :rtype:
+000137b0: 206c 6973 745b 666c 6f61 745d 0a20 2020   list[float].   
+000137c0: 2022 2222 0a20 2020 2072 6574 7572 6e20   """.    return 
+000137d0: 5b66 6c6f 6174 286c 696e 6529 2066 6f72  [float(line) for
+000137e0: 206c 696e 6520 696e 206f 7065 6e28 6669   line in open(fi
+000137f0: 6c65 6e61 6d65 292e 7265 6164 2829 2e73  lename).read().s
+00013800: 706c 6974 6c69 6e65 7328 2920 6966 206c  plitlines() if l
+00013810: 696e 6520 616e 6420 6e6f 7420 6c69 6e65  ine and not line
+00013820: 2e73 7461 7274 7377 6974 6828 223c 2229  .startswith("<")
+00013830: 5d0a 0a0a 636c 6173 7320 436f 6c6c 6563  ]...class Collec
+00013840: 7469 6f6e 5265 6164 4368 6563 6b43 6f76  tionReadCheckCov
+00013850: 6572 6564 3a0a 2020 2020 2222 220a 2020  ered:.    """.  
+00013860: 2020 5772 6170 7320 6172 6f75 6e64 2061    Wraps around a
+00013870: 2064 6963 742e 2049 7420 6b65 6570 7320   dict. It keeps 
+00013880: 7472 6163 6b20 6162 6f75 7420 616c 6c20  track about all 
+00013890: 7468 6520 6b65 7973 2077 6869 6368 2077  the keys which w
+000138a0: 6572 6520 7265 6164 2066 726f 6d20 7468  ere read from th
+000138b0: 6520 6469 6374 2e0a 2020 2020 5669 6120  e dict..    Via 
+000138c0: 3a66 756e 633a 6061 7373 6572 745f 616c  :func:`assert_al
+000138d0: 6c5f 7265 6164 602c 2079 6f75 2063 616e  l_read`, you can
+000138e0: 2063 6865 636b 2074 6861 7420 7468 6572   check that ther
+000138f0: 6520 6172 6520 6e6f 206b 6579 7320 696e  e are no keys in
+00013900: 2074 6865 2064 6963 7420 7768 6963 6820   the dict which 
+00013910: 7765 7265 206e 6f74 2072 6561 642e 0a20  were not read.. 
+00013920: 2020 2054 6865 2075 7361 6765 2069 7320     The usage is 
+00013930: 666f 7220 636f 6e66 6967 2064 6963 7420  for config dict 
+00013940: 6f70 7469 6f6e 732c 2077 6865 7265 2074  options, where t
+00013950: 6865 2075 7365 7220 6861 7320 7370 6563  he user has spec
+00013960: 6966 6965 6420 6120 7261 6e67 6520 6f66  ified a range of
+00013970: 206f 7074 696f 6e73 2c0a 2020 2020 616e   options,.    an
+00013980: 6420 7768 6572 6520 696e 2074 6865 2063  d where in the c
+00013990: 6f64 6520 7468 6572 6520 6973 2075 7375  ode there is usu
+000139a0: 616c 6c79 2061 2064 6566 6175 6c74 2066  ally a default f
+000139b0: 6f72 2065 7665 7279 206e 6f6e 2d73 7065  or every non-spe
+000139c0: 6369 6669 6564 206f 7074 696f 6e2c 0a20  cified option,. 
+000139d0: 2020 2074 6f20 6368 6563 6b20 7768 6574     to check whet
+000139e0: 6865 7220 616c 6c20 7468 6520 7573 6572  her all the user
+000139f0: 2d73 7065 6369 6669 6564 206f 7074 696f  -specified optio
+00013a00: 6e73 2061 7265 2061 6c73 6f20 7573 6564  ns are also used
+00013a10: 2028 6d61 7962 6520 7468 6520 7573 6572   (maybe the user
+00013a20: 206d 6164 6520 6120 7479 706f 292e 0a20   made a typo).. 
+00013a30: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
+00013a40: 5f5f 696e 6974 5f5f 2873 656c 662c 2063  __init__(self, c
+00013a50: 6f6c 6c65 6374 696f 6e2c 2074 7275 7468  ollection, truth
+00013a60: 5f76 616c 7565 3d4e 6f6e 6529 3a0a 2020  _value=None):.  
+00013a70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00013a80: 2020 3a70 6172 616d 2064 6963 745b 7374    :param dict[st
+00013a90: 725d 2063 6f6c 6c65 6374 696f 6e3a 0a20  r] collection:. 
+00013aa0: 2020 2020 2020 203a 7061 7261 6d20 4e6f         :param No
+00013ab0: 6e65 7c62 6f6f 6c20 7472 7574 685f 7661  ne|bool truth_va
+00013ac0: 6c75 653a 206e 6f74 653a 2063 6865 636b  lue: note: check
+00013ad0: 2065 7870 6c69 6369 746c 7920 666f 7220   explicitly for 
+00013ae0: 7365 6c66 2e74 7275 7468 5f76 616c 7565  self.truth_value
+00013af0: 2c20 626f 6f6c 2873 656c 6629 2069 7320  , bool(self) is 
+00013b00: 6e6f 7420 7468 6520 7361 6d65 210a 2020  not the same!.  
+00013b10: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00013b20: 2020 7365 6c66 2e63 6f6c 6c65 6374 696f    self.collectio
+00013b30: 6e20 3d20 636f 6c6c 6563 7469 6f6e 0a20  n = collection. 
+00013b40: 2020 2020 2020 2069 6620 7472 7574 685f         if truth_
+00013b50: 7661 6c75 6520 6973 204e 6f6e 653a 0a20  value is None:. 
+00013b60: 2020 2020 2020 2020 2020 2074 7275 7468             truth
+00013b70: 5f76 616c 7565 203d 2062 6f6f 6c28 7365  _value = bool(se
+00013b80: 6c66 2e63 6f6c 6c65 6374 696f 6e29 0a20  lf.collection). 
+00013b90: 2020 2020 2020 2073 656c 662e 7472 7574         self.trut
+00013ba0: 685f 7661 6c75 6520 3d20 7472 7574 685f  h_value = truth_
+00013bb0: 7661 6c75 650a 2020 2020 2020 2020 7365  value.        se
+00013bc0: 6c66 2e67 6f74 5f69 7465 6d73 203d 2073  lf.got_items = s
+00013bd0: 6574 2829 0a0a 2020 2020 6465 6620 5f5f  et()..    def __
+00013be0: 7265 7072 5f5f 2873 656c 6629 3a0a 2020  repr__(self):.  
+00013bf0: 2020 2020 2020 7265 7475 726e 2022 2573        return "%s
+00013c00: 2825 722c 2074 7275 7468 5f76 616c 7565  (%r, truth_value
+00013c10: 3d25 7229 2220 2520 2873 656c 662e 5f5f  =%r)" % (self.__
+00013c20: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00013c30: 2c20 7365 6c66 2e63 6f6c 6c65 6374 696f  , self.collectio
+00013c40: 6e2c 2073 656c 662e 7472 7574 685f 7661  n, self.truth_va
+00013c50: 6c75 6529 0a0a 2020 2020 4063 6c61 7373  lue)..    @class
+00013c60: 6d65 7468 6f64 0a20 2020 2064 6566 2066  method.    def f
+00013c70: 726f 6d5f 626f 6f6c 5f6f 725f 6469 6374  rom_bool_or_dict
+00013c80: 2863 6c73 2c20 7661 6c75 6529 3a0a 2020  (cls, value):.  
+00013c90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00013ca0: 2020 3a70 6172 616d 2062 6f6f 6c7c 6469    :param bool|di
+00013cb0: 6374 5b73 7472 5d20 7661 6c75 653a 0a20  ct[str] value:. 
+00013cc0: 2020 2020 2020 203a 7274 7970 653a 2043         :rtype: C
+00013cd0: 6f6c 6c65 6374 696f 6e52 6561 6443 6865  ollectionReadChe
+00013ce0: 636b 436f 7665 7265 640a 2020 2020 2020  ckCovered.      
+00013cf0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00013d00: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
+00013d10: 652c 2062 6f6f 6c29 3a0a 2020 2020 2020  e, bool):.      
+00013d20: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
+00013d30: 2863 6f6c 6c65 6374 696f 6e3d 7b7d 2c20  (collection={}, 
+00013d40: 7472 7574 685f 7661 6c75 653d 7661 6c75  truth_value=valu
+00013d50: 6529 0a20 2020 2020 2020 2069 6620 6973  e).        if is
+00013d60: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
+00013d70: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
+00013d80: 2020 2072 6574 7572 6e20 636c 7328 636f     return cls(co
+00013d90: 6c6c 6563 7469 6f6e 3d76 616c 7565 290a  llection=value).
+00013da0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00013db0: 7065 4572 726f 7228 2269 6e76 616c 6964  peError("invalid
+00013dc0: 2074 7970 653a 2025 7322 2025 2074 7970   type: %s" % typ
+00013dd0: 6528 7661 6c75 6529 290a 0a20 2020 2064  e(value))..    d
+00013de0: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
+00013df0: 656c 662c 2069 7465 6d29 3a0a 2020 2020  elf, item):.    
+00013e00: 2020 2020 7265 7320 3d20 7365 6c66 2e63      res = self.c
+00013e10: 6f6c 6c65 6374 696f 6e5b 6974 656d 5d0a  ollection[item].
+00013e20: 2020 2020 2020 2020 7365 6c66 2e67 6f74          self.got
+00013e30: 5f69 7465 6d73 2e61 6464 2869 7465 6d29  _items.add(item)
+00013e40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013e50: 7265 730a 0a20 2020 2064 6566 2067 6574  res..    def get
+00013e60: 2873 656c 662c 2069 7465 6d2c 2064 6566  (self, item, def
+00013e70: 6175 6c74 3d4e 6f6e 6529 3a0a 2020 2020  ault=None):.    
+00013e80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00013e90: 3a70 6172 616d 2073 7472 2069 7465 6d3a  :param str item:
+00013ea0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00013eb0: 5420 6465 6661 756c 743a 0a20 2020 2020  T default:.     
+00013ec0: 2020 203a 7274 7970 653a 2054 7c74 7970     :rtype: T|typ
+00013ed0: 696e 672e 416e 797c 4e6f 6e65 0a20 2020  ing.Any|None.   
+00013ee0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00013ef0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00013f00: 2020 7265 7475 726e 2073 656c 665b 6974    return self[it
+00013f10: 656d 5d0a 2020 2020 2020 2020 6578 6365  em].        exce
+00013f20: 7074 204b 6579 4572 726f 723a 0a20 2020  pt KeyError:.   
+00013f30: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013f40: 6465 6661 756c 740a 0a20 2020 2064 6566  default..    def
+00013f50: 205f 5f62 6f6f 6c5f 5f28 7365 6c66 293a   __bool__(self):
+00013f60: 2020 2320 5079 7468 6f6e 2033 0a20 2020    # Python 3.   
+00013f70: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00013f80: 2e74 7275 7468 5f76 616c 7565 0a0a 2020  .truth_value..  
+00013f90: 2020 5f5f 6e6f 6e7a 6572 6f5f 5f20 3d20    __nonzero__ = 
+00013fa0: 5f5f 626f 6f6c 5f5f 2020 2320 5079 7468  __bool__  # Pyth
+00013fb0: 6f6e 2032 0a0a 2020 2020 6465 6620 5f5f  on 2..    def __
+00013fc0: 6c65 6e5f 5f28 7365 6c66 293a 0a20 2020  len__(self):.   
+00013fd0: 2020 2020 2072 6574 7572 6e20 6c65 6e28       return len(
+00013fe0: 7365 6c66 2e63 6f6c 6c65 6374 696f 6e29  self.collection)
+00013ff0: 0a0a 2020 2020 6465 6620 5f5f 6974 6572  ..    def __iter
+00014000: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+00014010: 2020 666f 7220 6b20 696e 2073 656c 662e    for k in self.
+00014020: 636f 6c6c 6563 7469 6f6e 3a0a 2020 2020  collection:.    
+00014030: 2020 2020 2020 2020 7969 656c 6420 7365          yield se
+00014040: 6c66 5b6b 5d0a 0a20 2020 2064 6566 2061  lf[k]..    def a
+00014050: 7373 6572 745f 616c 6c5f 7265 6164 2873  ssert_all_read(s
+00014060: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00014070: 220a 2020 2020 2020 2020 4173 7365 7274  ".        Assert
+00014080: 7320 7468 6174 2061 6c6c 2069 7465 6d73  s that all items
+00014090: 2068 6176 6520 6265 656e 2072 6561 642e   have been read.
+000140a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000140b0: 2020 2020 2072 656d 6169 6e69 6e67 203d       remaining =
+000140c0: 2073 6574 2873 656c 662e 636f 6c6c 6563   set(self.collec
+000140d0: 7469 6f6e 292e 6469 6666 6572 656e 6365  tion).difference
+000140e0: 2873 656c 662e 676f 745f 6974 656d 7329  (self.got_items)
+000140f0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00014100: 6e6f 7420 7265 6d61 696e 696e 672c 2022  not remaining, "
+00014110: 5468 6520 6b65 7973 2025 7220 7765 7265  The keys %r were
+00014120: 206e 6f74 2072 6561 6420 696e 2074 6865   not read in the
+00014130: 2063 6f6c 6c65 6374 696f 6e20 2572 2e22   collection %r."
+00014140: 2025 2028 7265 6d61 696e 696e 672c 2073   % (remaining, s
+00014150: 656c 662e 636f 6c6c 6563 7469 6f6e 290a  elf.collection).
+00014160: 0a0a 6465 6620 7768 6963 6828 7072 6f67  ..def which(prog
+00014170: 7261 6d29 3a0a 2020 2020 2222 220a 2020  ram):.    """.  
+00014180: 2020 4669 6e64 7320 6070 726f 6772 616d    Finds `program
+00014190: 6020 696e 2073 6f6d 6520 6f66 2074 6865  ` in some of the
+000141a0: 2064 6972 7320 6f66 2074 6865 2050 4154   dirs of the PAT
+000141b0: 4820 656e 7620 7661 722e 0a0a 2020 2020  H env var...    
+000141c0: 3a70 6172 616d 2073 7472 2070 726f 6772  :param str progr
+000141d0: 616d 3a20 652e 672e 2022 7079 7468 6f6e  am: e.g. "python
+000141e0: 220a 2020 2020 3a72 6574 7572 6e3a 2066  ".    :return: f
+000141f0: 756c 6c20 7061 7468 2c20 652e 672e 2022  ull path, e.g. "
+00014200: 2f75 7372 2f62 696e 2f70 7974 686f 6e22  /usr/bin/python"
+00014210: 2c20 6f72 204e 6f6e 650a 2020 2020 3a72  , or None.    :r
+00014220: 7479 7065 3a20 7374 727c 4e6f 6e65 0a20  type: str|None. 
+00014230: 2020 2022 2222 0a20 2020 2023 206e 6f69     """.    # noi
+00014240: 6e73 7065 6374 696f 6e20 5079 5368 6164  nspection PyShad
+00014250: 6f77 696e 674e 616d 6573 0a20 2020 2064  owingNames.    d
+00014260: 6566 2069 735f 6578 6528 7061 7468 293a  ef is_exe(path):
+00014270: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00014280: 2020 2020 203a 7061 7261 6d20 7374 7220       :param str 
+00014290: 7061 7468 3a0a 2020 2020 2020 2020 3a72  path:.        :r
+000142a0: 7479 7065 3a20 7374 720a 2020 2020 2020  type: str.      
+000142b0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+000142c0: 7475 726e 206f 732e 7061 7468 2e69 7366  turn os.path.isf
+000142d0: 696c 6528 7061 7468 2920 616e 6420 6f73  ile(path) and os
+000142e0: 2e61 6363 6573 7328 7061 7468 2c20 6f73  .access(path, os
+000142f0: 2e58 5f4f 4b29 0a0a 2020 2020 6670 6174  .X_OK)..    fpat
+00014300: 682c 2066 6e61 6d65 203d 206f 732e 7061  h, fname = os.pa
+00014310: 7468 2e73 706c 6974 2870 726f 6772 616d  th.split(program
+00014320: 290a 2020 2020 6966 2066 7061 7468 3a0a  ).    if fpath:.
+00014330: 2020 2020 2020 2020 6966 2069 735f 6578          if is_ex
+00014340: 6528 7072 6f67 7261 6d29 3a0a 2020 2020  e(program):.    
+00014350: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+00014360: 726f 6772 616d 0a20 2020 2065 6c73 653a  rogram.    else:
+00014370: 0a20 2020 2020 2020 2066 6f72 2070 6174  .        for pat
+00014380: 6820 696e 206f 732e 656e 7669 726f 6e5b  h in os.environ[
+00014390: 2250 4154 4822 5d2e 7370 6c69 7428 6f73  "PATH"].split(os
+000143a0: 2e70 6174 6873 6570 293a 0a20 2020 2020  .pathsep):.     
+000143b0: 2020 2020 2020 2070 6174 6820 3d20 7061         path = pa
+000143c0: 7468 2e73 7472 6970 2827 2227 290a 2020  th.strip('"').  
+000143d0: 2020 2020 2020 2020 2020 6578 655f 6669            exe_fi
+000143e0: 6c65 203d 206f 732e 7061 7468 2e6a 6f69  le = os.path.joi
+000143f0: 6e28 7061 7468 2c20 7072 6f67 7261 6d29  n(path, program)
+00014400: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00014410: 6973 5f65 7865 2865 7865 5f66 696c 6529  is_exe(exe_file)
+00014420: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014430: 2020 7265 7475 726e 2065 7865 5f66 696c    return exe_fil
+00014440: 650a 0a20 2020 2072 6574 7572 6e20 4e6f  e..    return No
+00014450: 6e65 0a0a 0a64 6566 2077 6869 6368 5f70  ne...def which_p
+00014460: 6970 2829 3a0a 2020 2020 2222 220a 2020  ip():.    """.  
+00014470: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
+00014480: 2020 3a72 6574 7572 6e3a 2070 6174 6820    :return: path 
+00014490: 746f 2070 6970 2066 6f72 2074 6865 2063  to pip for the c
+000144a0: 7572 7265 6e74 2050 7974 686f 6e20 656e  urrent Python en
+000144b0: 760a 2020 2020 2222 220a 2020 2020 2320  v.    """.    # 
+000144c0: 4265 666f 7265 2077 6520 6c6f 6f6b 2061  Before we look a
+000144d0: 6e79 7768 6572 6520 696e 2050 4154 482c  nywhere in PATH,
+000144e0: 2063 6865 636b 2069 6620 7468 6572 6520   check if there 
+000144f0: 6973 2073 6f6d 6520 7069 7020 616c 6f6e  is some pip alon
+00014500: 6773 6964 6520 746f 2074 6865 2050 7974  gside to the Pyt
+00014510: 686f 6e20 6578 6563 7574 6162 6c65 2e0a  hon executable..
+00014520: 2020 2020 2320 5468 6973 206d 6967 6874      # This might
+00014530: 2062 6520 6d6f 7265 2072 656c 6961 626c   be more reliabl
+00014540: 652e 0a20 2020 2070 7920 3d20 7379 732e  e..    py = sys.
+00014550: 6578 6563 7574 6162 6c65 0a20 2020 2064  executable.    d
+00014560: 6972 5f6e 616d 652c 2062 6173 656e 616d  ir_name, basenam
+00014570: 6520 3d20 7079 2e72 7370 6c69 7428 222f  e = py.rsplit("/
+00014580: 222c 2031 290a 2020 2020 6966 2062 6173  ", 1).    if bas
+00014590: 656e 616d 652e 7374 6172 7473 7769 7468  ename.startswith
+000145a0: 2822 7079 7468 6f6e 2229 3a0a 2020 2020  ("python"):.    
+000145b0: 2020 2020 706f 7374 6669 7820 3d20 6261      postfix = ba
+000145c0: 7365 6e61 6d65 5b6c 656e 2822 7079 7468  sename[len("pyth
+000145d0: 6f6e 2229 203a 5d0a 2020 2020 2020 2020  on") :].        
+000145e0: 7069 705f 7061 7468 203d 2022 2573 2f70  pip_path = "%s/p
+000145f0: 6970 2573 2220 2520 2864 6972 5f6e 616d  ip%s" % (dir_nam
+00014600: 652c 2070 6f73 7466 6978 290a 2020 2020  e, postfix).    
+00014610: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+00014620: 7869 7374 7328 7069 705f 7061 7468 293a  xists(pip_path):
+00014630: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00014640: 7572 6e20 7069 705f 7061 7468 0a20 2020  urn pip_path.   
+00014650: 2023 2047 656e 6572 6963 2066 616c 6c62   # Generic fallb
+00014660: 6163 6b2e 0a20 2020 2070 6970 5f70 6174  ack..    pip_pat
+00014670: 6820 3d20 7768 6963 6828 2270 6970 2229  h = which("pip")
+00014680: 0a20 2020 2072 6574 7572 6e20 7069 705f  .    return pip_
+00014690: 7061 7468 0a0a 0a64 6566 2070 6970 5f69  path...def pip_i
+000146a0: 6e73 7461 6c6c 282a 706b 675f 6e61 6d65  nstall(*pkg_name
+000146b0: 7329 3a0a 2020 2020 2222 220a 2020 2020  s):.    """.    
+000146c0: 496e 7374 616c 6c20 7061 636b 6167 6573  Install packages
+000146d0: 2076 6961 2070 6970 2066 6f72 2074 6865   via pip for the
+000146e0: 2063 7572 7265 6e74 2050 7974 686f 6e20   current Python 
+000146f0: 656e 762e 0a0a 2020 2020 3a70 6172 616d  env...    :param
+00014700: 2073 7472 2070 6b67 5f6e 616d 6573 3a0a   str pkg_names:.
+00014710: 2020 2020 2222 220a 2020 2020 7079 203d      """.    py =
+00014720: 2073 7973 2e65 7865 6375 7461 626c 650a   sys.executable.
+00014730: 2020 2020 7069 705f 7061 7468 203d 2077      pip_path = w
+00014740: 6869 6368 5f70 6970 2829 0a20 2020 2070  hich_pip().    p
+00014750: 7269 6e74 2822 5069 7020 696e 7374 616c  rint("Pip instal
+00014760: 6c22 2c20 2a70 6b67 5f6e 616d 6573 290a  l", *pkg_names).
+00014770: 2020 2020 696e 5f76 6972 7475 616c 5f65      in_virtual_e
+00014780: 6e76 203d 2068 6173 6174 7472 2873 7973  nv = hasattr(sys
+00014790: 2c20 2272 6561 6c5f 7072 6566 6978 2229  , "real_prefix")
+000147a0: 2020 2320 6874 7470 733a 2f2f 7374 6163    # https://stac
+000147b0: 6b6f 7665 7266 6c6f 772e 636f 6d2f 7175  koverflow.com/qu
+000147c0: 6573 7469 6f6e 732f 3138 3731 3534 392f  estions/1871549/
+000147d0: 0a20 2020 2063 6d64 203d 205b 7079 2c20  .    cmd = [py, 
+000147e0: 7069 705f 7061 7468 2c20 2269 6e73 7461  pip_path, "insta
+000147f0: 6c6c 225d 0a20 2020 2069 6620 6e6f 7420  ll"].    if not 
+00014800: 696e 5f76 6972 7475 616c 5f65 6e76 3a0a  in_virtual_env:.
+00014810: 2020 2020 2020 2020 636d 6420 2b3d 205b          cmd += [
+00014820: 222d 2d75 7365 7222 5d0a 2020 2020 636d  "--user"].    cm
+00014830: 6420 2b3d 206c 6973 7428 706b 675f 6e61  d += list(pkg_na
+00014840: 6d65 7329 0a20 2020 2070 7269 6e74 2822  mes).    print("
+00014850: 2420 2573 2220 2520 2220 222e 6a6f 696e  $ %s" % " ".join
+00014860: 2863 6d64 2929 0a20 2020 2073 7562 7072  (cmd)).    subpr
+00014870: 6f63 6573 732e 6368 6563 6b5f 6361 6c6c  ocess.check_call
+00014880: 2863 6d64 2c20 6377 643d 222f 2229 0a20  (cmd, cwd="/"). 
+00014890: 2020 205f 7069 705f 696e 7374 616c 6c65     _pip_installe
+000148a0: 645f 7061 636b 6167 6573 2e63 6c65 6172  d_packages.clear
+000148b0: 2829 2020 2320 666f 7263 6520 7265 6c6f  ()  # force relo
+000148c0: 6164 0a0a 0a5f 7069 705f 696e 7374 616c  ad..._pip_instal
+000148d0: 6c65 645f 7061 636b 6167 6573 203d 2073  led_packages = s
+000148e0: 6574 2829 0a0a 0a64 6566 2070 6970 5f63  et()...def pip_c
+000148f0: 6865 636b 5f69 735f 696e 7374 616c 6c65  heck_is_installe
+00014900: 6428 706b 675f 6e61 6d65 293a 0a20 2020  d(pkg_name):.   
+00014910: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
+00014920: 7374 7220 706b 675f 6e61 6d65 3a20 7769  str pkg_name: wi
+00014930: 7468 6f75 7420 7665 7273 696f 6e2c 2065  thout version, e
+00014940: 2e67 2e20 6a75 7374 2022 7465 6e73 6f72  .g. just "tensor
+00014950: 666c 6f77 222c 206f 7220 7769 7468 2076  flow", or with v
+00014960: 6572 7369 6f6e 2c20 652e 672e 2022 7465  ersion, e.g. "te
+00014970: 6e73 6f72 666c 6f77 3d3d 312e 322e 3322  nsorflow==1.2.3"
+00014980: 0a20 2020 203a 7274 7970 653a 2062 6f6f  .    :rtype: boo
+00014990: 6c0a 2020 2020 2222 220a 2020 2020 6966  l.    """.    if
+000149a0: 206e 6f74 205f 7069 705f 696e 7374 616c   not _pip_instal
+000149b0: 6c65 645f 7061 636b 6167 6573 3a0a 2020  led_packages:.  
+000149c0: 2020 2020 2020 7079 203d 2073 7973 2e65        py = sys.e
+000149d0: 7865 6375 7461 626c 650a 2020 2020 2020  xecutable.      
+000149e0: 2020 7069 705f 7061 7468 203d 2077 6869    pip_path = whi
+000149f0: 6368 5f70 6970 2829 0a20 2020 2020 2020  ch_pip().       
+00014a00: 2063 6d64 203d 205b 7079 2c20 7069 705f   cmd = [py, pip_
+00014a10: 7061 7468 2c20 2266 7265 657a 6522 5d0a  path, "freeze"].
+00014a20: 2020 2020 2020 2020 666f 7220 6c69 6e65          for line
+00014a30: 2069 6e20 7379 735f 6578 6563 5f6f 7574   in sys_exec_out
+00014a40: 282a 636d 6429 2e73 706c 6974 6c69 6e65  (*cmd).splitline
+00014a50: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00014a60: 2069 6620 6c69 6e65 2061 6e64 2022 3d3d   if line and "==
+00014a70: 2220 696e 206c 696e 653a 0a20 2020 2020  " in line:.     
+00014a80: 2020 2020 2020 2020 2020 2069 6620 223d             if "=
+00014a90: 3d22 206e 6f74 2069 6e20 706b 675f 6e61  =" not in pkg_na
+00014aa0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+00014ab0: 2020 2020 2020 2020 6c69 6e65 203d 206c          line = l
+00014ac0: 696e 655b 3a20 6c69 6e65 2e69 6e64 6578  ine[: line.index
+00014ad0: 2822 3d3d 2229 5d0a 2020 2020 2020 2020  ("==")].        
+00014ae0: 2020 2020 2020 2020 5f70 6970 5f69 6e73          _pip_ins
+00014af0: 7461 6c6c 6564 5f70 6163 6b61 6765 732e  talled_packages.
+00014b00: 6164 6428 6c69 6e65 290a 2020 2020 7265  add(line).    re
+00014b10: 7475 726e 2070 6b67 5f6e 616d 6520 696e  turn pkg_name in
+00014b20: 205f 7069 705f 696e 7374 616c 6c65 645f   _pip_installed_
+00014b30: 7061 636b 6167 6573 0a0a 0a5f 6f72 6967  packages..._orig
+00014b40: 696e 616c 5f65 7865 6376 203d 204e 6f6e  inal_execv = Non
+00014b50: 650a 5f6f 7269 6769 6e61 6c5f 6578 6563  e._original_exec
+00014b60: 7665 203d 204e 6f6e 650a 5f6f 7269 6769  ve = None._origi
+00014b70: 6e61 6c5f 6578 6563 7670 6520 3d20 4e6f  nal_execvpe = No
+00014b80: 6e65 0a0a 0a64 6566 206f 7665 7277 7269  ne...def overwri
+00014b90: 7465 5f6f 735f 6578 6563 2870 7265 6669  te_os_exec(prefi
+00014ba0: 785f 6172 6773 293a 0a20 2020 2022 2222  x_args):.    """
+00014bb0: 0a20 2020 203a 7061 7261 6d20 6c69 7374  .    :param list
+00014bc0: 5b73 7472 5d20 7072 6566 6978 5f61 7267  [str] prefix_arg
+00014bd0: 733a 0a20 2020 2022 2222 0a20 2020 2067  s:.    """.    g
+00014be0: 6c6f 6261 6c20 5f6f 7269 6769 6e61 6c5f  lobal _original_
+00014bf0: 6578 6563 762c 205f 6f72 6967 696e 616c  execv, _original
+00014c00: 5f65 7865 6376 652c 205f 6f72 6967 696e  _execve, _origin
+00014c10: 616c 5f65 7865 6376 7065 0a20 2020 2069  al_execvpe.    i
+00014c20: 6620 6e6f 7420 5f6f 7269 6769 6e61 6c5f  f not _original_
+00014c30: 6578 6563 763a 0a20 2020 2020 2020 205f  execv:.        _
+00014c40: 6f72 6967 696e 616c 5f65 7865 6376 203d  original_execv =
+00014c50: 206f 732e 6578 6563 760a 2020 2020 6966   os.execv.    if
+00014c60: 206e 6f74 205f 6f72 6967 696e 616c 5f65   not _original_e
+00014c70: 7865 6376 653a 0a20 2020 2020 2020 205f  xecve:.        _
+00014c80: 6f72 6967 696e 616c 5f65 7865 6376 6520  original_execve 
+00014c90: 3d20 6f73 2e65 7865 6376 650a 2020 2020  = os.execve.    
+00014ca0: 6966 206e 6f74 205f 6f72 6967 696e 616c  if not _original
+00014cb0: 5f65 7865 6376 7065 3a0a 2020 2020 2020  _execvpe:.      
+00014cc0: 2020 2320 6e6f 696e 7370 6563 7469 6f6e    # noinspection
+00014cd0: 2050 7950 726f 7465 6374 6564 4d65 6d62   PyProtectedMemb
+00014ce0: 6572 2c50 7955 6e72 6573 6f6c 7665 6452  er,PyUnresolvedR
+00014cf0: 6566 6572 656e 6365 730a 2020 2020 2020  eferences.      
+00014d00: 2020 5f6f 7269 6769 6e61 6c5f 6578 6563    _original_exec
+00014d10: 7670 6520 3d20 6f73 2e5f 6578 6563 7670  vpe = os._execvp
+00014d20: 650a 0a20 2020 2023 206e 6f69 6e73 7065  e..    # noinspe
+00014d30: 6374 696f 6e20 5079 556e 7573 6564 4c6f  ction PyUnusedLo
+00014d40: 6361 6c0a 2020 2020 6465 6620 7772 6170  cal.    def wrap
+00014d50: 7065 645f 6578 6563 7670 6528 6669 6c65  ped_execvpe(file
+00014d60: 2c20 6172 6773 2c20 656e 763d 4e6f 6e65  , args, env=None
+00014d70: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00014d80: 2020 2020 2020 203a 7061 7261 6d20 6669         :param fi
+00014d90: 6c65 3a0a 2020 2020 2020 2020 3a70 6172  le:.        :par
+00014da0: 616d 206c 6973 745b 7374 725d 7c74 7570  am list[str]|tup
+00014db0: 6c65 5b73 7472 5d20 6172 6773 3a0a 2020  le[str] args:.  
+00014dc0: 2020 2020 2020 3a70 6172 616d 2064 6963        :param dic
+00014dd0: 745b 7374 725d 2065 6e76 3a0a 2020 2020  t[str] env:.    
+00014de0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00014df0: 6e65 775f 6172 6773 203d 2070 7265 6669  new_args = prefi
+00014e00: 785f 6172 6773 202b 205b 7768 6963 6828  x_args + [which(
+00014e10: 6172 6773 5b30 5d29 5d20 2b20 6172 6773  args[0])] + args
+00014e20: 5b31 3a5d 0a20 2020 2020 2020 2073 7973  [1:].        sys
+00014e30: 2e73 7464 6572 722e 7772 6974 6528 2224  .stderr.write("$
+00014e40: 2025 735c 6e22 2025 2022 2022 2e6a 6f69   %s\n" % " ".joi
+00014e50: 6e28 6e65 775f 6172 6773 2929 0a20 2020  n(new_args)).   
+00014e60: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
+00014e70: 666c 7573 6828 290a 2020 2020 2020 2020  flush().        
+00014e80: 5f6f 7269 6769 6e61 6c5f 6578 6563 7670  _original_execvp
+00014e90: 6528 6669 6c65 3d70 7265 6669 785f 6172  e(file=prefix_ar
+00014ea0: 6773 5b30 5d2c 2061 7267 733d 6e65 775f  gs[0], args=new_
+00014eb0: 6172 6773 2c20 656e 763d 656e 7629 0a0a  args, env=env)..
+00014ec0: 2020 2020 6465 6620 6578 6563 7628 7061      def execv(pa
+00014ed0: 7468 2c20 6172 6773 293a 0a20 2020 2020  th, args):.     
+00014ee0: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+00014ef0: 7061 7261 6d20 7374 7220 7061 7468 3a0a  param str path:.
+00014f00: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
+00014f10: 6973 745b 7374 725d 7c74 7570 6c65 5b73  ist[str]|tuple[s
+00014f20: 7472 5d20 6172 6773 3a0a 2020 2020 2020  tr] args:.      
+00014f30: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00014f40: 2061 7267 735b 3a20 6c65 6e28 7072 6566   args[: len(pref
+00014f50: 6978 5f61 7267 7329 5d20 3d3d 2070 7265  ix_args)] == pre
+00014f60: 6669 785f 6172 6773 3a0a 2020 2020 2020  fix_args:.      
+00014f70: 2020 2020 2020 5f6f 7269 6769 6e61 6c5f        _original_
+00014f80: 6578 6563 7628 7061 7468 2c20 6172 6773  execv(path, args
+00014f90: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00014fa0: 2020 2020 2020 2020 2020 2020 7772 6170              wrap
+00014fb0: 7065 645f 6578 6563 7670 6528 7061 7468  ped_execvpe(path
+00014fc0: 2c20 6172 6773 290a 0a20 2020 2064 6566  , args)..    def
+00014fd0: 2065 7865 6376 6528 7061 7468 2c20 6172   execve(path, ar
+00014fe0: 6773 2c20 656e 7629 3a0a 2020 2020 2020  gs, env):.      
+00014ff0: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
+00015000: 6172 616d 2073 7472 2070 6174 683a 0a20  aram str path:. 
+00015010: 2020 2020 2020 203a 7061 7261 6d20 6c69         :param li
+00015020: 7374 5b73 7472 5d7c 7475 706c 655b 7374  st[str]|tuple[st
+00015030: 725d 2061 7267 733a 0a20 2020 2020 2020  r] args:.       
+00015040: 203a 7061 7261 6d20 6469 6374 5b73 7472   :param dict[str
+00015050: 5d20 656e 763a 0a20 2020 2020 2020 2022  ] env:.        "
+00015060: 2222 0a20 2020 2020 2020 2069 6620 6172  "".        if ar
+00015070: 6773 5b3a 206c 656e 2870 7265 6669 785f  gs[: len(prefix_
+00015080: 6172 6773 295d 203d 3d20 7072 6566 6978  args)] == prefix
+00015090: 5f61 7267 733a 0a20 2020 2020 2020 2020  _args:.         
+000150a0: 2020 205f 6f72 6967 696e 616c 5f65 7865     _original_exe
+000150b0: 6376 6528 7061 7468 2c20 6172 6773 2c20  cve(path, args, 
+000150c0: 656e 7629 0a20 2020 2020 2020 2065 6c73  env).        els
+000150d0: 653a 0a20 2020 2020 2020 2020 2020 2077  e:.            w
+000150e0: 7261 7070 6564 5f65 7865 6376 7065 2870  rapped_execvpe(p
+000150f0: 6174 682c 2061 7267 732c 2065 6e76 290a  ath, args, env).
+00015100: 0a20 2020 2064 6566 2065 7865 636c 2866  .    def execl(f
+00015110: 696c 652c 202a 6172 6773 293a 0a20 2020  ile, *args):.   
+00015120: 2020 2020 2022 2222 6578 6563 6c28 6669       """execl(fi
+00015130: 6c65 2c20 2a61 7267 7329 0a0a 2020 2020  le, *args)..    
+00015140: 2020 2020 4578 6563 7574 6520 7468 6520      Execute the 
+00015150: 6578 6563 7574 6162 6c65 2066 696c 6520  executable file 
+00015160: 7769 7468 2061 7267 756d 656e 7420 6c69  with argument li
+00015170: 7374 2061 7267 732c 2072 6570 6c61 6369  st args, replaci
+00015180: 6e67 2074 6865 0a20 2020 2020 2020 2063  ng the.        c
+00015190: 7572 7265 6e74 2070 726f 6365 7373 2e22  urrent process."
+000151a0: 2222 0a20 2020 2020 2020 206f 732e 6578  "".        os.ex
+000151b0: 6563 7628 6669 6c65 2c20 6172 6773 290a  ecv(file, args).
+000151c0: 0a20 2020 2064 6566 2065 7865 636c 6528  .    def execle(
+000151d0: 6669 6c65 2c20 2a61 7267 7329 3a0a 2020  file, *args):.  
+000151e0: 2020 2020 2020 2222 2265 7865 636c 6528        """execle(
+000151f0: 6669 6c65 2c20 2a61 7267 732c 2065 6e76  file, *args, env
+00015200: 290a 0a20 2020 2020 2020 2045 7865 6375  )..        Execu
+00015210: 7465 2074 6865 2065 7865 6375 7461 626c  te the executabl
+00015220: 6520 6669 6c65 2077 6974 6820 6172 6775  e file with argu
+00015230: 6d65 6e74 206c 6973 7420 6172 6773 2061  ment list args a
+00015240: 6e64 0a20 2020 2020 2020 2065 6e76 6972  nd.        envir
+00015250: 6f6e 6d65 6e74 2065 6e76 2c20 7265 706c  onment env, repl
+00015260: 6163 696e 6720 7468 6520 6375 7272 656e  acing the curren
+00015270: 7420 7072 6f63 6573 732e 2222 220a 2020  t process.""".  
+00015280: 2020 2020 2020 656e 7620 3d20 6172 6773        env = args
+00015290: 5b2d 315d 0a20 2020 2020 2020 206f 732e  [-1].        os.
+000152a0: 6578 6563 7665 2866 696c 652c 2061 7267  execve(file, arg
+000152b0: 735b 3a2d 315d 2c20 656e 7629 0a0a 2020  s[:-1], env)..  
+000152c0: 2020 6465 6620 6578 6563 6c70 2866 696c    def execlp(fil
+000152d0: 652c 202a 6172 6773 293a 0a20 2020 2020  e, *args):.     
+000152e0: 2020 2022 2222 6578 6563 6c70 2866 696c     """execlp(fil
+000152f0: 652c 202a 6172 6773 290a 0a20 2020 2020  e, *args)..     
+00015300: 2020 2045 7865 6375 7465 2074 6865 2065     Execute the e
+00015310: 7865 6375 7461 626c 6520 6669 6c65 2028  xecutable file (
+00015320: 7768 6963 6820 6973 2073 6561 7263 6865  which is searche
+00015330: 6420 666f 7220 616c 6f6e 6720 2450 4154  d for along $PAT
+00015340: 4829 0a20 2020 2020 2020 2077 6974 6820  H).        with 
+00015350: 6172 6775 6d65 6e74 206c 6973 7420 6172  argument list ar
+00015360: 6773 2c20 7265 706c 6163 696e 6720 7468  gs, replacing th
+00015370: 6520 6375 7272 656e 7420 7072 6f63 6573  e current proces
+00015380: 732e 2222 220a 2020 2020 2020 2020 6f73  s.""".        os
+00015390: 2e65 7865 6376 7028 6669 6c65 2c20 6172  .execvp(file, ar
+000153a0: 6773 290a 0a20 2020 2064 6566 2065 7865  gs)..    def exe
+000153b0: 636c 7065 2866 696c 652c 202a 6172 6773  clpe(file, *args
+000153c0: 293a 0a20 2020 2020 2020 2022 2222 6578  ):.        """ex
+000153d0: 6563 6c70 6528 6669 6c65 2c20 2a61 7267  eclpe(file, *arg
+000153e0: 732c 2065 6e76 290a 0a20 2020 2020 2020  s, env)..       
+000153f0: 2045 7865 6375 7465 2074 6865 2065 7865   Execute the exe
+00015400: 6375 7461 626c 6520 6669 6c65 2028 7768  cutable file (wh
+00015410: 6963 6820 6973 2073 6561 7263 6865 6420  ich is searched 
+00015420: 666f 7220 616c 6f6e 6720 2450 4154 4829  for along $PATH)
+00015430: 0a20 2020 2020 2020 2077 6974 6820 6172  .        with ar
+00015440: 6775 6d65 6e74 206c 6973 7420 6172 6773  gument list args
+00015450: 2061 6e64 2065 6e76 6972 6f6e 6d65 6e74   and environment
+00015460: 2065 6e76 2c20 7265 706c 6163 696e 6720   env, replacing 
+00015470: 7468 6520 6375 7272 656e 740a 2020 2020  the current.    
+00015480: 2020 2020 7072 6f63 6573 732e 2222 220a      process.""".
+00015490: 2020 2020 2020 2020 656e 7620 3d20 6172          env = ar
+000154a0: 6773 5b2d 315d 0a20 2020 2020 2020 206f  gs[-1].        o
+000154b0: 732e 6578 6563 7670 6528 6669 6c65 2c20  s.execvpe(file, 
+000154c0: 6172 6773 5b3a 2d31 5d2c 2065 6e76 290a  args[:-1], env).
+000154d0: 0a20 2020 2064 6566 2065 7865 6376 7028  .    def execvp(
+000154e0: 6669 6c65 2c20 6172 6773 293a 0a20 2020  file, args):.   
+000154f0: 2020 2020 2022 2222 6578 6563 7670 2866       """execvp(f
+00015500: 696c 652c 2061 7267 7329 0a0a 2020 2020  ile, args)..    
+00015510: 2020 2020 4578 6563 7574 6520 7468 6520      Execute the 
+00015520: 6578 6563 7574 6162 6c65 2066 696c 6520  executable file 
+00015530: 2877 6869 6368 2069 7320 7365 6172 6368  (which is search
+00015540: 6564 2066 6f72 2061 6c6f 6e67 2024 5041  ed for along $PA
+00015550: 5448 290a 2020 2020 2020 2020 7769 7468  TH).        with
+00015560: 2061 7267 756d 656e 7420 6c69 7374 2061   argument list a
+00015570: 7267 732c 2072 6570 6c61 6369 6e67 2074  rgs, replacing t
+00015580: 6865 2063 7572 7265 6e74 2070 726f 6365  he current proce
+00015590: 7373 2e0a 2020 2020 2020 2020 6172 6773  ss..        args
+000155a0: 206d 6179 2062 6520 6120 6c69 7374 206f   may be a list o
+000155b0: 7220 7475 706c 6520 6f66 2073 7472 696e  r tuple of strin
+000155c0: 6773 2e22 2222 0a20 2020 2020 2020 2077  gs.""".        w
+000155d0: 7261 7070 6564 5f65 7865 6376 7065 2866  rapped_execvpe(f
+000155e0: 696c 652c 2061 7267 7329 0a0a 2020 2020  ile, args)..    
+000155f0: 6465 6620 6578 6563 7670 6528 6669 6c65  def execvpe(file
+00015600: 2c20 6172 6773 2c20 656e 7629 3a0a 2020  , args, env):.  
+00015610: 2020 2020 2020 2222 2265 7865 6376 7065        """execvpe
+00015620: 2866 696c 652c 2061 7267 732c 2065 6e76  (file, args, env
+00015630: 290a 0a20 2020 2020 2020 2045 7865 6375  )..        Execu
+00015640: 7465 2074 6865 2065 7865 6375 7461 626c  te the executabl
+00015650: 6520 6669 6c65 2028 7768 6963 6820 6973  e file (which is
+00015660: 2073 6561 7263 6865 6420 666f 7220 616c   searched for al
+00015670: 6f6e 6720 2450 4154 4829 0a20 2020 2020  ong $PATH).     
+00015680: 2020 2077 6974 6820 6172 6775 6d65 6e74     with argument
+00015690: 206c 6973 7420 6172 6773 2061 6e64 2065   list args and e
+000156a0: 6e76 6972 6f6e 6d65 6e74 2065 6e76 202c  nvironment env ,
+000156b0: 2072 6570 6c61 6369 6e67 2074 6865 0a20   replacing the. 
+000156c0: 2020 2020 2020 2063 7572 7265 6e74 2070         current p
+000156d0: 726f 6365 7373 2e0a 2020 2020 2020 2020  rocess..        
+000156e0: 6172 6773 206d 6179 2062 6520 6120 6c69  args may be a li
+000156f0: 7374 206f 7220 7475 706c 6520 6f66 2073  st or tuple of s
+00015700: 7472 696e 6773 2e22 2222 0a20 2020 2020  trings.""".     
+00015710: 2020 2077 7261 7070 6564 5f65 7865 6376     wrapped_execv
+00015720: 7065 2866 696c 652c 2061 7267 732c 2065  pe(file, args, e
+00015730: 6e76 290a 0a20 2020 206f 732e 6578 6563  nv)..    os.exec
+00015740: 7620 3d20 6578 6563 760a 2020 2020 6f73  v = execv.    os
+00015750: 2e65 7865 6376 6520 3d20 6578 6563 7665  .execve = execve
+00015760: 0a20 2020 206f 732e 6578 6563 6c20 3d20  .    os.execl = 
+00015770: 6578 6563 6c0a 2020 2020 6f73 2e65 7865  execl.    os.exe
+00015780: 636c 6520 3d20 6578 6563 6c65 0a20 2020  cle = execle.   
+00015790: 206f 732e 6578 6563 6c70 203d 2065 7865   os.execlp = exe
+000157a0: 636c 700a 2020 2020 6f73 2e65 7865 636c  clp.    os.execl
+000157b0: 7065 203d 2065 7865 636c 7065 0a20 2020  pe = execlpe.   
+000157c0: 206f 732e 6578 6563 7670 203d 2065 7865   os.execvp = exe
+000157d0: 6376 700a 2020 2020 6f73 2e65 7865 6376  cvp.    os.execv
+000157e0: 7065 203d 2065 7865 6376 7065 0a20 2020  pe = execvpe.   
+000157f0: 206f 732e 5f65 7865 6376 7065 203d 2077   os._execvpe = w
+00015800: 7261 7070 6564 5f65 7865 6376 7065 0a0a  rapped_execvpe..
+00015810: 0a64 6566 2067 6574 5f6c 7362 5f72 656c  .def get_lsb_rel
+00015820: 6561 7365 2829 3a0a 2020 2020 2222 220a  ease():.    """.
+00015830: 2020 2020 3a72 6574 7572 6e3a 2060 602f      :return: ``/
+00015840: 6574 632f 6c73 622d 7265 6c65 6173 6560  etc/lsb-release`
+00015850: 6020 7061 7273 6564 2061 7320 6120 6469  ` parsed as a di
+00015860: 6374 0a20 2020 203a 7274 7970 653a 2064  ct.    :rtype: d
+00015870: 6963 745b 7374 722c 7374 725d 0a20 2020  ict[str,str].   
+00015880: 2022 2222 0a20 2020 2064 203d 207b 7d0a   """.    d = {}.
+00015890: 2020 2020 666f 7220 6c69 6e65 2069 6e20      for line in 
+000158a0: 6f70 656e 2822 2f65 7463 2f6c 7362 2d72  open("/etc/lsb-r
+000158b0: 656c 6561 7365 2229 2e72 6561 6428 292e  elease").read().
+000158c0: 7370 6c69 746c 696e 6573 2829 3a0a 2020  splitlines():.  
+000158d0: 2020 2020 2020 6b2c 2076 203d 206c 696e        k, v = lin
+000158e0: 652e 7370 6c69 7428 223d 222c 2031 290a  e.split("=", 1).
+000158f0: 2020 2020 2020 2020 6966 2076 5b30 5d20          if v[0] 
+00015900: 3d3d 2076 5b2d 315d 203d 3d20 2722 273a  == v[-1] == '"':
+00015910: 0a20 2020 2020 2020 2020 2020 2076 203d  .            v =
+00015920: 2076 5b31 3a2d 315d 0a20 2020 2020 2020   v[1:-1].       
+00015930: 2064 5b6b 5d20 3d20 760a 2020 2020 7265   d[k] = v.    re
+00015940: 7475 726e 2064 0a0a 0a64 6566 2067 6574  turn d...def get
+00015950: 5f75 6275 6e74 755f 6d61 6a6f 725f 7665  _ubuntu_major_ve
+00015960: 7273 696f 6e28 293a 0a20 2020 2022 2222  rsion():.    """
+00015970: 0a20 2020 203a 7274 7970 653a 2069 6e74  .    :rtype: int
+00015980: 7c4e 6f6e 650a 2020 2020 2222 220a 2020  |None.    """.  
+00015990: 2020 6420 3d20 6765 745f 6c73 625f 7265    d = get_lsb_re
+000159a0: 6c65 6173 6528 290a 2020 2020 6966 2064  lease().    if d
+000159b0: 5b22 4449 5354 5249 425f 4944 225d 2021  ["DISTRIB_ID"] !
+000159c0: 3d20 2255 6275 6e74 7522 3a0a 2020 2020  = "Ubuntu":.    
+000159d0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+000159e0: 2020 2020 7265 7475 726e 2069 6e74 2866      return int(f
+000159f0: 6c6f 6174 2864 5b22 4449 5354 5249 425f  loat(d["DISTRIB_
+00015a00: 5245 4c45 4153 4522 5d29 290a 0a0a 6465  RELEASE"]))...de
+00015a10: 6620 6175 746f 5f70 7265 6669 785f 6f73  f auto_prefix_os
+00015a20: 5f65 7865 635f 7072 6566 6978 5f75 6275  _exec_prefix_ubu
+00015a30: 6e74 7528 7072 6566 6978 5f61 7267 732c  ntu(prefix_args,
+00015a40: 2075 6275 6e74 755f 6d69 6e5f 7665 7273   ubuntu_min_vers
+00015a50: 696f 6e3d 3136 293a 0a20 2020 2022 2222  ion=16):.    """
+00015a60: 0a20 2020 203a 7061 7261 6d20 6c69 7374  .    :param list
+00015a70: 5b73 7472 5d20 7072 6566 6978 5f61 7267  [str] prefix_arg
+00015a80: 733a 0a20 2020 203a 7061 7261 6d20 696e  s:.    :param in
+00015a90: 7420 7562 756e 7475 5f6d 696e 5f76 6572  t ubuntu_min_ver
+00015aa0: 7369 6f6e 3a0a 0a20 2020 2045 7861 6d70  sion:..    Examp
+00015ab0: 6c65 2075 7361 6765 3a0a 2020 2020 2020  le usage:.      
+00015ac0: 6175 746f 5f70 7265 6669 785f 6f73 5f65  auto_prefix_os_e
+00015ad0: 7865 635f 7072 6566 6978 5f75 6275 6e74  xec_prefix_ubunt
+00015ae0: 7528 5b22 2f75 2f7a 6579 6572 2f74 6f6f  u(["/u/zeyer/too
+00015af0: 6c73 2f67 6c69 6263 3231 372f 6c64 2d6c  ls/glibc217/ld-l
+00015b00: 696e 7578 2d78 3836 2d36 342e 736f 2e32  inux-x86-64.so.2
+00015b10: 225d 290a 2020 2020 2222 220a 2020 2020  "]).    """.    
+00015b20: 7562 756e 7475 5f76 6572 7369 6f6e 203d  ubuntu_version =
+00015b30: 2067 6574 5f75 6275 6e74 755f 6d61 6a6f   get_ubuntu_majo
+00015b40: 725f 7665 7273 696f 6e28 290a 2020 2020  r_version().    
+00015b50: 6966 2075 6275 6e74 755f 7665 7273 696f  if ubuntu_versio
+00015b60: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
+00015b70: 2020 2072 6574 7572 6e0a 2020 2020 6966     return.    if
+00015b80: 2075 6275 6e74 755f 7665 7273 696f 6e20   ubuntu_version 
+00015b90: 3e3d 2075 6275 6e74 755f 6d69 6e5f 7665  >= ubuntu_min_ve
+00015ba0: 7273 696f 6e3a 0a20 2020 2020 2020 2072  rsion:.        r
+00015bb0: 6574 7572 6e0a 2020 2020 7072 696e 7428  eturn.    print(
+00015bc0: 2259 6f75 2061 7265 2072 756e 6e69 6e67  "You are running
+00015bd0: 2055 6275 6e74 7520 2569 2c20 7468 7573   Ubuntu %i, thus
+00015be0: 2077 6520 7072 6566 6978 2061 6c6c 206f   we prefix all o
+00015bf0: 732e 6578 6563 2077 6974 6820 2573 2e22  s.exec with %s."
+00015c00: 2025 2028 7562 756e 7475 5f76 6572 7369   % (ubuntu_versi
+00015c10: 6f6e 2c20 7072 6566 6978 5f61 7267 7329  on, prefix_args)
+00015c20: 290a 2020 2020 6173 7365 7274 206f 732e  ).    assert os.
+00015c30: 7061 7468 2e65 7869 7374 7328 7072 6566  path.exists(pref
+00015c40: 6978 5f61 7267 735b 305d 290a 2020 2020  ix_args[0]).    
+00015c50: 6f76 6572 7772 6974 655f 6f73 5f65 7865  overwrite_os_exe
+00015c60: 6328 7072 6566 6978 5f61 7267 733d 7072  c(prefix_args=pr
+00015c70: 6566 6978 5f61 7267 7329 0a0a 0a64 6566  efix_args)...def
+00015c80: 2063 6c65 616e 7570 5f65 6e76 5f76 6172   cleanup_env_var
+00015c90: 5f70 6174 6828 656e 765f 7661 722c 2070  _path(env_var, p
+00015ca0: 6174 685f 7072 6566 6978 293a 0a20 2020  ath_prefix):.   
+00015cb0: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
+00015cc0: 7374 7220 656e 765f 7661 723a 2065 2e67  str env_var: e.g
+00015cd0: 2e20 224c 445f 4c49 4252 4152 595f 5041  . "LD_LIBRARY_PA
+00015ce0: 5448 220a 2020 2020 3a70 6172 616d 2073  TH".    :param s
+00015cf0: 7472 2070 6174 685f 7072 6566 6978 3a0a  tr path_prefix:.
+00015d00: 0a20 2020 2057 696c 6c20 7265 6d6f 7665  .    Will remove
+00015d10: 2061 6c6c 2070 6174 6873 2069 6e20 6f73   all paths in os
+00015d20: 2e65 6e76 6972 6f6e 5b65 6e76 5f76 6172  .environ[env_var
+00015d30: 5d20 7768 6963 6820 6172 6520 7072 6566  ] which are pref
+00015d40: 6978 6564 2077 6974 6820 7061 7468 5f70  ixed with path_p
+00015d50: 7265 6669 782e 0a20 2020 2022 2222 0a20  refix..    """. 
+00015d60: 2020 2069 6620 656e 765f 7661 7220 6e6f     if env_var no
+00015d70: 7420 696e 206f 732e 656e 7669 726f 6e3a  t in os.environ:
+00015d80: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
+00015d90: 2020 2020 7073 203d 206f 732e 656e 7669      ps = os.envi
+00015da0: 726f 6e5b 656e 765f 7661 725d 2e73 706c  ron[env_var].spl
+00015db0: 6974 2822 3a22 290a 0a20 2020 2064 6566  it(":")..    def
+00015dc0: 2066 2870 293a 0a20 2020 2020 2020 2022   f(p):.        "
+00015dd0: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
+00015de0: 6d20 7374 7220 703a 0a20 2020 2020 2020  m str p:.       
+00015df0: 203a 7274 7970 653a 2062 6f6f 6c0a 2020   :rtype: bool.  
+00015e00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00015e10: 2020 6966 2070 203d 3d20 7061 7468 5f70    if p == path_p
+00015e20: 7265 6669 7820 6f72 2070 2e73 7461 7274  refix or p.start
+00015e30: 7377 6974 6828 7061 7468 5f70 7265 6669  swith(path_prefi
+00015e40: 7820 2b20 222f 2229 3a0a 2020 2020 2020  x + "/"):.      
+00015e50: 2020 2020 2020 7072 696e 7428 2252 656d        print("Rem
+00015e60: 6f76 696e 6720 2573 2066 726f 6d20 2573  oving %s from %s
+00015e70: 2e22 2025 2028 702c 2065 6e76 5f76 6172  ." % (p, env_var
+00015e80: 2929 0a20 2020 2020 2020 2020 2020 2072  )).            r
+00015e90: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00015ea0: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+00015eb0: 0a20 2020 2070 7320 3d20 6669 6c74 6572  .    ps = filter
+00015ec0: 2866 2c20 7073 290a 2020 2020 6f73 2e65  (f, ps).    os.e
+00015ed0: 6e76 6972 6f6e 5b65 6e76 5f76 6172 5d20  nviron[env_var] 
+00015ee0: 3d20 223a 222e 6a6f 696e 2870 7329 0a0a  = ":".join(ps)..
+00015ef0: 0a64 6566 2067 6574 5f6c 6f67 696e 5f75  .def get_login_u
+00015f00: 7365 726e 616d 6528 293a 0a20 2020 2022  sername():.    "
+00015f10: 2222 0a20 2020 203a 7274 7970 653a 2073  "".    :rtype: s
+00015f20: 7472 0a20 2020 203a 7265 7475 726e 3a20  tr.    :return: 
+00015f30: 7468 6520 7573 6572 6e61 6d65 206f 6620  the username of 
+00015f40: 7468 6520 6375 7272 656e 7420 7573 6572  the current user
+00015f50: 2e0a 2020 2020 5573 6520 7468 6973 2061  ..    Use this a
+00015f60: 7320 6120 7265 706c 6163 656d 656e 7420  s a replacement 
+00015f70: 666f 7220 6f73 2e67 6574 6c6f 6769 6e28  for os.getlogin(
+00015f80: 292e 0a20 2020 2022 2222 0a20 2020 2069  )..    """.    i
+00015f90: 6d70 6f72 7420 6f73 0a0a 2020 2020 6966  mport os..    if
+00015fa0: 2073 7973 2e70 6c61 7466 6f72 6d20 3d3d   sys.platform ==
+00015fb0: 2022 7769 6e33 3222 3a0a 2020 2020 2020   "win32":.      
+00015fc0: 2020 7265 7475 726e 206f 732e 6765 746c    return os.getl
+00015fd0: 6f67 696e 2829 0a20 2020 2069 6d70 6f72  ogin().    impor
+00015fe0: 7420 7077 640a 0a20 2020 2074 7279 3a0a  t pwd..    try:.
+00015ff0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+00016000: 7764 2e67 6574 7077 7569 6428 6f73 2e67  wd.getpwuid(os.g
+00016010: 6574 7569 6428 2929 5b30 5d0a 2020 2020  etuid())[0].    
+00016020: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
+00016030: 0a20 2020 2020 2020 2023 2070 7764 2e67  .        # pwd.g
+00016040: 6574 7077 7569 6428 2920 6361 6e20 7468  etpwuid() can th
+00016050: 726f 7720 4b65 7945 7272 6f72 3a20 2767  row KeyError: 'g
+00016060: 6574 7077 7569 6428 293a 2075 6964 206e  etpwuid(): uid n
+00016070: 6f74 2066 6f75 6e64 3a20 3132 3334 3527  ot found: 12345'
+00016080: 0a20 2020 2020 2020 2023 2074 6869 7320  .        # this 
+00016090: 6361 6e20 6861 7070 656e 2065 2e67 2e20  can happen e.g. 
+000160a0: 696e 2061 2064 6f63 6b65 7220 656e 7669  in a docker envi
+000160b0: 726f 6e6d 656e 7420 7769 7468 206d 6170  ronment with map
+000160c0: 7065 6420 7569 6473 2075 6e6b 6e6f 776e  ped uids unknown
+000160d0: 2074 6f20 7468 6520 646f 636b 6572 204f   to the docker O
+000160e0: 530a 2020 2020 2020 2020 7265 7475 726e  S.        return
+000160f0: 2073 7472 286f 732e 6765 7475 6964 2829   str(os.getuid()
+00016100: 290a 0a0a 6465 6620 6765 745f 7465 6d70  )...def get_temp
+00016110: 5f64 6972 2829 3a0a 2020 2020 2222 220a  _dir():.    """.
+00016120: 2020 2020 3a72 7479 7065 3a20 7374 720a      :rtype: str.
+00016130: 2020 2020 3a72 6574 7572 6e3a 2065 2e67      :return: e.g
+00016140: 2e20 222f 746d 702f 2455 5345 524e 414d  . "/tmp/$USERNAM
+00016150: 4522 0a20 2020 2022 2222 0a20 2020 2075  E".    """.    u
+00016160: 7365 726e 616d 6520 3d20 6765 745f 6c6f  sername = get_lo
+00016170: 6769 6e5f 7573 6572 6e61 6d65 2829 0a20  gin_username(). 
+00016180: 2020 2066 6f72 2065 6e76 6e61 6d65 2069     for envname i
+00016190: 6e20 5b22 544d 5044 4952 222c 2022 5445  n ["TMPDIR", "TE
+000161a0: 4d50 222c 2022 544d 5022 5d3a 0a20 2020  MP", "TMP"]:.   
+000161b0: 2020 2020 2064 6972 6e61 6d65 203d 206f       dirname = o
+000161c0: 732e 6765 7465 6e76 2865 6e76 6e61 6d65  s.getenv(envname
+000161d0: 290a 2020 2020 2020 2020 6966 2064 6972  ).        if dir
+000161e0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+000161f0: 2020 7265 7475 726e 2022 2573 2f25 7322    return "%s/%s"
+00016200: 2025 2028 6469 726e 616d 652c 2075 7365   % (dirname, use
+00016210: 726e 616d 6529 0a20 2020 2023 202f 7661  rname).    # /va
+00016220: 722f 746d 7020 7368 6f75 6c64 2062 6520  r/tmp should be 
+00016230: 6d6f 7265 2070 6572 7369 7374 656e 7420  more persistent 
+00016240: 7468 616e 202f 746d 7020 7573 7561 6c6c  than /tmp usuall
+00016250: 792e 0a20 2020 2069 6620 6f73 2e70 6174  y..    if os.pat
+00016260: 682e 6578 6973 7473 2822 2f76 6172 2f74  h.exists("/var/t
+00016270: 6d70 2229 3a0a 2020 2020 2020 2020 7265  mp"):.        re
+00016280: 7475 726e 2022 2f76 6172 2f74 6d70 2f25  turn "/var/tmp/%
+00016290: 7322 2025 2075 7365 726e 616d 650a 2020  s" % username.  
+000162a0: 2020 7265 7475 726e 2022 2f74 6d70 2f25    return "/tmp/%
+000162b0: 7322 2025 2075 7365 726e 616d 650a 0a0a  s" % username...
+000162c0: 6465 6620 6765 745f 6361 6368 655f 6469  def get_cache_di
+000162d0: 7228 293a 0a20 2020 2022 2222 0a20 2020  r():.    """.   
+000162e0: 203a 7265 7475 726e 3a20 7573 6564 2074   :return: used t
+000162f0: 6f20 6361 6368 6520 6e6f 6e2d 6372 6974  o cache non-crit
+00016300: 6963 616c 2074 6869 6e67 732e 2062 7920  ical things. by 
+00016310: 6465 6661 756c 7420 6765 745f 7465 6d70  default get_temp
+00016320: 5f64 6972 2e20 756e 6c65 7373 2079 6f75  _dir. unless you
+00016330: 2064 6566 696e 6520 656e 7620 5245 5455   define env RETU
+00016340: 524e 4e5f 4341 4348 455f 4449 520a 2020  RNN_CACHE_DIR.  
+00016350: 2020 3a72 7479 7065 3a20 7374 720a 2020    :rtype: str.  
+00016360: 2020 2222 220a 2020 2020 6966 2022 5245    """.    if "RE
+00016370: 5455 524e 4e5f 4341 4348 455f 4449 5222  TURNN_CACHE_DIR"
+00016380: 2069 6e20 6f73 2e65 6e76 6972 6f6e 3a0a   in os.environ:.
+00016390: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+000163a0: 732e 656e 7669 726f 6e5b 2252 4554 5552  s.environ["RETUR
+000163b0: 4e4e 5f43 4143 4845 5f44 4952 225d 0a20  NN_CACHE_DIR"]. 
+000163c0: 2020 2072 6574 7572 6e20 6765 745f 7465     return get_te
+000163d0: 6d70 5f64 6972 2829 0a0a 0a63 6c61 7373  mp_dir()...class
+000163e0: 204c 6f63 6b46 696c 6528 6f62 6a65 6374   LockFile(object
+000163f0: 293a 0a20 2020 2022 2222 0a20 2020 2053  ):.    """.    S
+00016400: 696d 706c 6520 6c6f 636b 2066 696c 652e  imple lock file.
+00016410: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+00016420: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00016430: 2064 6972 6563 746f 7279 2c20 6e61 6d65   directory, name
+00016440: 3d22 6c6f 636b 5f66 696c 6522 2c20 6c6f  ="lock_file", lo
+00016450: 636b 5f74 696d 656f 7574 3d31 202a 2036  ck_timeout=1 * 6
+00016460: 3020 2a20 3630 293a 0a20 2020 2020 2020  0 * 60):.       
+00016470: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
+00016480: 7261 6d20 7374 7220 6469 7265 6374 6f72  ram str director
+00016490: 793a 0a20 2020 2020 2020 203a 7061 7261  y:.        :para
+000164a0: 6d20 696e 747c 666c 6f61 7420 6c6f 636b  m int|float lock
+000164b0: 5f74 696d 656f 7574 3a20 696e 2073 6563  _timeout: in sec
+000164c0: 6f6e 6473 0a20 2020 2020 2020 2022 2222  onds.        """
+000164d0: 0a20 2020 2020 2020 2073 656c 662e 6469  .        self.di
+000164e0: 7265 6374 6f72 7920 3d20 6469 7265 6374  rectory = direct
+000164f0: 6f72 790a 2020 2020 2020 2020 7365 6c66  ory.        self
+00016500: 2e6e 616d 6520 3d20 6e61 6d65 0a20 2020  .name = name.   
+00016510: 2020 2020 2073 656c 662e 6664 203d 204e       self.fd = N
+00016520: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
+00016530: 2e6c 6f63 6b5f 7469 6d65 6f75 7420 3d20  .lock_timeout = 
+00016540: 6c6f 636b 5f74 696d 656f 7574 0a20 2020  lock_timeout.   
+00016550: 2020 2020 2073 656c 662e 6c6f 636b 6669       self.lockfi
+00016560: 6c65 203d 2022 2573 2f25 7322 2025 2028  le = "%s/%s" % (
+00016570: 6469 7265 6374 6f72 792c 206e 616d 6529  directory, name)
+00016580: 0a0a 2020 2020 6465 6620 6973 5f6f 6c64  ..    def is_old
+00016590: 5f6c 6f63 6b66 696c 6528 7365 6c66 293a  _lockfile(self):
+000165a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000165b0: 2020 2020 203a 7265 7475 726e 3a20 5768       :return: Wh
+000165c0: 6574 6865 7220 7468 6572 6520 6973 2061  ether there is a
+000165d0: 6e20 6578 6973 7469 6e67 206c 6f63 6b20  n existing lock 
+000165e0: 6669 6c65 2061 6e64 2074 6865 2065 7869  file and the exi
+000165f0: 7374 696e 6720 6c6f 636b 2066 696c 6520  sting lock file 
+00016600: 6973 206f 6c64 2e0a 2020 2020 2020 2020  is old..        
+00016610: 3a72 7479 7065 3a20 626f 6f6c 0a20 2020  :rtype: bool.   
+00016620: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00016630: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00016640: 2020 6d74 696d 6520 3d20 6f73 2e70 6174    mtime = os.pat
+00016650: 682e 6765 746d 7469 6d65 2873 656c 662e  h.getmtime(self.
+00016660: 6c6f 636b 6669 6c65 290a 2020 2020 2020  lockfile).      
+00016670: 2020 6578 6365 7074 204f 5345 7272 6f72    except OSError
+00016680: 3a0a 2020 2020 2020 2020 2020 2020 6d74  :.            mt
+00016690: 696d 6520 3d20 4e6f 6e65 0a20 2020 2020  ime = None.     
+000166a0: 2020 2069 6620 6d74 696d 6520 616e 6420     if mtime and 
+000166b0: 2861 6273 2874 696d 652e 7469 6d65 2829  (abs(time.time()
+000166c0: 202d 206d 7469 6d65 2920 3e20 7365 6c66   - mtime) > self
+000166d0: 2e6c 6f63 6b5f 7469 6d65 6f75 7429 3a0a  .lock_timeout):.
+000166e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000166f0: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+00016700: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
+00016710: 2020 6465 6620 6d61 7962 655f 7265 6d6f    def maybe_remo
+00016720: 7665 5f6f 6c64 5f6c 6f63 6b66 696c 6528  ve_old_lockfile(
+00016730: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00016740: 2222 0a20 2020 2020 2020 2052 656d 6f76  "".        Remov
+00016750: 6573 2061 6e20 6578 6973 7469 6e67 206f  es an existing o
+00016760: 6c64 206c 6f63 6b66 696c 652c 2069 6620  ld lockfile, if 
+00016770: 7468 6572 6520 6973 206f 6e65 2e0a 2020  there is one..  
+00016780: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016790: 2020 6966 206e 6f74 2073 656c 662e 6973    if not self.is
+000167a0: 5f6f 6c64 5f6c 6f63 6b66 696c 6528 293a  _old_lockfile():
+000167b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000167c0: 7572 6e0a 2020 2020 2020 2020 7072 696e  urn.        prin
+000167d0: 7428 2252 656d 6f76 696e 6720 6f6c 6420  t("Removing old 
+000167e0: 6c6f 636b 6669 6c65 2025 7220 2870 726f  lockfile %r (pro
+000167f0: 6261 626c 7920 6372 6173 6865 6420 7072  bably crashed pr
+00016800: 6f63 292e 2220 2520 7365 6c66 2e6c 6f63  oc)." % self.loc
+00016810: 6b66 696c 6529 0a20 2020 2020 2020 2074  kfile).        t
+00016820: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00016830: 6f73 2e72 656d 6f76 6528 7365 6c66 2e6c  os.remove(self.l
+00016840: 6f63 6b66 696c 6529 0a20 2020 2020 2020  ockfile).       
+00016850: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
+00016860: 6173 2065 7863 3a0a 2020 2020 2020 2020  as exc:.        
+00016870: 2020 2020 7072 696e 7428 2252 656d 6f76      print("Remov
+00016880: 6520 6c6f 636b 6669 6c65 2065 7863 6570  e lockfile excep
+00016890: 7469 6f6e 2025 722e 2049 676e 6f72 696e  tion %r. Ignorin
+000168a0: 6720 6974 2e22 2025 2065 7863 290a 0a20  g it." % exc).. 
+000168b0: 2020 2064 6566 2069 735f 6c6f 636b 6564     def is_locked
+000168c0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000168d0: 2222 220a 2020 2020 2020 2020 3a72 6574  """.        :ret
+000168e0: 7572 6e3a 2077 6865 7468 6572 2074 6865  urn: whether the
+000168f0: 7265 2069 7320 616e 2061 6374 6976 6520  re is an active 
+00016900: 286e 6f74 206f 6c64 2920 6c6f 636b 6669  (not old) lockfi
+00016910: 6c65 0a20 2020 2020 2020 203a 7274 7970  le.        :rtyp
+00016920: 653a 2062 6f6f 6c0a 2020 2020 2020 2020  e: bool.        
+00016930: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
+00016940: 656c 662e 6973 5f6f 6c64 5f6c 6f63 6b66  elf.is_old_lockf
+00016950: 696c 6528 293a 0a20 2020 2020 2020 2020  ile():.         
+00016960: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00016970: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00016980: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00016990: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
+000169a0: 656c 662e 6c6f 636b 6669 6c65 290a 2020  elf.lockfile).  
+000169b0: 2020 2020 2020 6578 6365 7074 204f 5345        except OSE
+000169c0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+000169d0: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
+000169e0: 2020 2020 6465 6620 6c6f 636b 2873 656c      def lock(sel
+000169f0: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+00016a00: 2020 2020 2020 2020 4163 7175 6972 6573          Acquires
+00016a10: 2074 6865 206c 6f63 6b2e 0a20 2020 2020   the lock..     
+00016a20: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00016a30: 6d70 6f72 7420 7469 6d65 0a20 2020 2020  mport time.     
+00016a40: 2020 2069 6d70 6f72 7420 6572 726e 6f0a     import errno.
+00016a50: 0a20 2020 2020 2020 2077 6169 745f 636f  .        wait_co
+00016a60: 756e 7420 3d20 300a 2020 2020 2020 2020  unt = 0.        
+00016a70: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
+00016a80: 2020 2020 2020 2020 2320 5472 7920 746f          # Try to
+00016a90: 2063 7265 6174 6520 6469 7265 6374 6f72   create director
+00016aa0: 7920 6966 2069 7420 646f 6573 206e 6f74  y if it does not
+00016ab0: 2065 7869 7374 2e0a 2020 2020 2020 2020   exist..        
+00016ac0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00016ad0: 2020 2020 2020 2020 206f 732e 6d61 6b65           os.make
+00016ae0: 6469 7273 2873 656c 662e 6469 7265 6374  dirs(self.direct
+00016af0: 6f72 7929 0a20 2020 2020 2020 2020 2020  ory).           
+00016b00: 2065 7863 6570 7420 4f53 4572 726f 723a   except OSError:
+00016b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016b20: 2070 6173 7320 2023 2049 676e 6f72 6520   pass  # Ignore 
+00016b30: 616e 7920 6572 726f 7273 2e0a 2020 2020  any errors..    
+00016b40: 2020 2020 2020 2020 2320 4e6f 7720 7472          # Now tr
+00016b50: 7920 746f 2063 7265 6174 6520 7468 6520  y to create the 
+00016b60: 6c6f 636b 2e0a 2020 2020 2020 2020 2020  lock..          
+00016b70: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00016b80: 2020 2020 2020 2073 656c 662e 6664 203d         self.fd =
+00016b90: 206f 732e 6f70 656e 2873 656c 662e 6c6f   os.open(self.lo
+00016ba0: 636b 6669 6c65 2c20 6f73 2e4f 5f43 5245  ckfile, os.O_CRE
+00016bb0: 4154 207c 206f 732e 4f5f 4558 434c 207c  AT | os.O_EXCL |
+00016bc0: 206f 732e 4f5f 5244 5752 290a 2020 2020   os.O_RDWR).    
+00016bd0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00016be0: 726e 0a20 2020 2020 2020 2020 2020 2065  rn.            e
+00016bf0: 7863 6570 7420 4f53 4572 726f 7220 6173  xcept OSError as
+00016c00: 2065 7863 3a0a 2020 2020 2020 2020 2020   exc:.          
+00016c10: 2020 2020 2020 2320 506f 7373 6962 6c65        # Possible
+00016c20: 2065 7272 6f72 733a 0a20 2020 2020 2020   errors:.       
+00016c30: 2020 2020 2020 2020 2023 2045 4e4f 454e           # ENOEN
+00016c40: 5420 284e 6f20 7375 6368 2066 696c 6520  T (No such file 
+00016c50: 6f72 2064 6972 6563 746f 7279 292c 2065  or directory), e
+00016c60: 2e67 2e20 6966 2074 6865 2064 6972 6563  .g. if the direc
+00016c70: 746f 7279 2077 6173 2064 656c 6574 6564  tory was deleted
+00016c80: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016c90: 2020 2320 4545 5849 5354 2028 4669 6c65    # EEXIST (File
+00016ca0: 2065 7869 7374 7329 2c20 6966 2074 6865   exists), if the
+00016cb0: 206c 6f63 6b20 616c 7265 6164 7920 6578   lock already ex
+00016cc0: 6973 7473 2e0a 2020 2020 2020 2020 2020  ists..          
+00016cd0: 2020 2020 2020 6966 2065 7863 2e65 7272        if exc.err
+00016ce0: 6e6f 206e 6f74 2069 6e20 5b65 7272 6e6f  no not in [errno
+00016cf0: 2e45 4e4f 454e 542c 2065 7272 6e6f 2e45  .ENOENT, errno.E
+00016d00: 4558 4953 545d 3a0a 2020 2020 2020 2020  EXIST]:.        
+00016d10: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00016d20: 6520 2023 204f 7468 6572 2065 7272 6f72  e  # Other error
+00016d30: 2c20 736f 2072 6572 6169 7365 2e0a 2020  , so reraise..  
+00016d40: 2020 2020 2020 2020 2020 2320 5765 2064            # We d
+00016d50: 6964 206e 6f74 2067 6574 2074 6865 206c  id not get the l
+00016d60: 6f63 6b2e 0a20 2020 2020 2020 2020 2020  ock..           
+00016d70: 2023 2043 6865 636b 2069 6620 6974 2069   # Check if it i
+00016d80: 7320 6120 7265 616c 6c79 206f 6c64 206f  s a really old o
+00016d90: 6e65 2e0a 2020 2020 2020 2020 2020 2020  ne..            
+00016da0: 7365 6c66 2e6d 6179 6265 5f72 656d 6f76  self.maybe_remov
+00016db0: 655f 6f6c 645f 6c6f 636b 6669 6c65 2829  e_old_lockfile()
+00016dc0: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
+00016dd0: 6169 7420 6120 6269 742c 2061 6e64 2074  ait a bit, and t
+00016de0: 6865 6e20 7265 7472 792e 0a20 2020 2020  hen retry..     
+00016df0: 2020 2020 2020 2074 696d 652e 736c 6565         time.slee
+00016e00: 7028 3129 0a20 2020 2020 2020 2020 2020  p(1).           
+00016e10: 2077 6169 745f 636f 756e 7420 2b3d 2031   wait_count += 1
+00016e20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016e30: 7761 6974 5f63 6f75 6e74 203d 3d20 3130  wait_count == 10
+00016e40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016e50: 2020 7072 696e 7428 2257 6169 7469 6e67    print("Waiting
+00016e60: 2066 6f72 206c 6f63 6b2d 6669 6c65 3a20   for lock-file: 
+00016e70: 2573 2220 2520 7365 6c66 2e6c 6f63 6b66  %s" % self.lockf
+00016e80: 696c 6529 0a0a 2020 2020 6465 6620 756e  ile)..    def un
+00016e90: 6c6f 636b 2873 656c 6629 3a0a 2020 2020  lock(self):.    
+00016ea0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00016eb0: 5265 6c65 6173 6573 2074 6865 206c 6f63  Releases the loc
+00016ec0: 6b2e 0a20 2020 2020 2020 2022 2222 0a20  k..        """. 
+00016ed0: 2020 2020 2020 206f 732e 636c 6f73 6528         os.close(
+00016ee0: 7365 6c66 2e66 6429 0a20 2020 2020 2020  self.fd).       
+00016ef0: 206f 732e 7265 6d6f 7665 2873 656c 662e   os.remove(self.
+00016f00: 6c6f 636b 6669 6c65 290a 0a20 2020 2064  lockfile)..    d
+00016f10: 6566 205f 5f65 6e74 6572 5f5f 2873 656c  ef __enter__(sel
+00016f20: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
+00016f30: 2e6c 6f63 6b28 290a 0a20 2020 2064 6566  .lock()..    def
+00016f40: 205f 5f65 7869 745f 5f28 7365 6c66 2c20   __exit__(self, 
+00016f50: 6578 635f 7479 7065 2c20 6578 635f 7661  exc_type, exc_va
+00016f60: 6c2c 2065 7863 5f74 6229 3a0a 2020 2020  l, exc_tb):.    
+00016f70: 2020 2020 7365 6c66 2e75 6e6c 6f63 6b28      self.unlock(
+00016f80: 290a 0a0a 6465 6620 7374 725f 6973 5f6e  )...def str_is_n
+00016f90: 756d 6265 7228 7329 3a0a 2020 2020 2222  umber(s):.    ""
+00016fa0: 220a 2020 2020 3a70 6172 616d 2073 7472  ".    :param str
+00016fb0: 2073 3a20 652e 672e 2022 3122 2c20 222e   s: e.g. "1", ".
+00016fc0: 3322 206f 7220 2278 220a 2020 2020 3a72  3" or "x".    :r
+00016fd0: 6574 7572 6e3a 2077 6865 7468 6572 2073  eturn: whether s
+00016fe0: 2063 616e 2062 6520 6361 7374 6564 2074   can be casted t
+00016ff0: 6f20 666c 6f61 7420 6f72 2069 6e74 0a20  o float or int. 
+00017000: 2020 203a 7274 7970 653a 2062 6f6f 6c0a     :rtype: bool.
+00017010: 2020 2020 2222 220a 2020 2020 7472 793a      """.    try:
+00017020: 0a20 2020 2020 2020 2066 6c6f 6174 2873  .        float(s
+00017030: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00017040: 2054 7275 650a 2020 2020 6578 6365 7074   True.    except
+00017050: 2056 616c 7565 4572 726f 723a 0a20 2020   ValueError:.   
+00017060: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00017070: 650a 0a0a 6465 6620 736f 7274 6564 5f76  e...def sorted_v
+00017080: 616c 7565 735f 6672 6f6d 5f64 6963 7428  alues_from_dict(
+00017090: 6429 3a0a 2020 2020 2222 220a 2020 2020  d):.    """.    
+000170a0: 3a70 6172 616d 2064 6963 745b 542c 565d  :param dict[T,V]
+000170b0: 2064 3a0a 2020 2020 3a72 7479 7065 3a20   d:.    :rtype: 
+000170c0: 6c69 7374 5b56 5d0a 2020 2020 2222 220a  list[V].    """.
+000170d0: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+000170e0: 7461 6e63 6528 642c 2064 6963 7429 0a20  tance(d, dict). 
+000170f0: 2020 2072 6574 7572 6e20 5b76 2066 6f72     return [v for
+00017100: 2028 6b2c 2076 2920 696e 2073 6f72 7465   (k, v) in sorte
+00017110: 6428 642e 6974 656d 7328 2929 5d0a 0a0a  d(d.items())]...
+00017120: 6465 6620 6469 6374 5f7a 6970 286b 6579  def dict_zip(key
+00017130: 732c 2076 616c 7565 7329 3a0a 2020 2020  s, values):.    
+00017140: 2222 220a 2020 2020 3a70 6172 616d 206c  """.    :param l
+00017150: 6973 745b 545d 206b 6579 733a 0a20 2020  ist[T] keys:.   
+00017160: 203a 7061 7261 6d20 6c69 7374 5b56 5d20   :param list[V] 
+00017170: 7661 6c75 6573 3a0a 2020 2020 3a72 7479  values:.    :rty
+00017180: 7065 3a20 6469 6374 5b54 2c56 5d0a 2020  pe: dict[T,V].  
+00017190: 2020 2222 220a 2020 2020 6173 7365 7274    """.    assert
+000171a0: 206c 656e 286b 6579 7329 203d 3d20 6c65   len(keys) == le
+000171b0: 6e28 7661 6c75 6573 290a 2020 2020 7265  n(values).    re
+000171c0: 7475 726e 2064 6963 7428 7a69 7028 6b65  turn dict(zip(ke
+000171d0: 7973 2c20 7661 6c75 6573 2929 0a0a 0a64  ys, values))...d
+000171e0: 6566 2070 6172 7365 5f6c 645f 636f 6e66  ef parse_ld_conf
+000171f0: 5f66 696c 6528 666e 293a 0a20 2020 2022  _file(fn):.    "
+00017200: 2222 0a20 2020 2056 6961 2068 7474 7073  "".    Via https
+00017210: 3a2f 2f67 6974 6875 622e 636f 6d2f 616c  ://github.com/al
+00017220: 6265 7274 7a2f 7379 7374 656d 2d74 6f6f  bertz/system-too
+00017230: 6c73 2f62 6c6f 622f 6d61 7374 6572 2f62  ls/blob/master/b
+00017240: 696e 2f66 696e 642d 6c69 622d 696e 2d70  in/find-lib-in-p
+00017250: 6174 682e 7079 2e0a 0a20 2020 203a 7061  ath.py...    :pa
+00017260: 7261 6d20 7374 7220 666e 3a20 652e 672e  ram str fn: e.g.
+00017270: 2022 2f65 7463 2f6c 642e 736f 2e63 6f6e   "/etc/ld.so.con
+00017280: 6622 0a20 2020 203a 7265 7475 726e 3a20  f".    :return: 
+00017290: 6c69 7374 206f 6620 7061 7468 7320 666f  list of paths fo
+000172a0: 7220 6c69 6273 0a20 2020 203a 7274 7970  r libs.    :rtyp
+000172b0: 653a 206c 6973 745b 7374 725d 0a20 2020  e: list[str].   
+000172c0: 2022 2222 0a20 2020 2066 726f 6d20 676c   """.    from gl
+000172d0: 6f62 2069 6d70 6f72 7420 676c 6f62 0a0a  ob import glob..
+000172e0: 2020 2020 7061 7468 7320 3d20 5b5d 0a20      paths = []. 
+000172f0: 2020 2066 6f72 206c 696e 6520 696e 206f     for line in o
+00017300: 7065 6e28 666e 292e 7265 6164 2829 2e73  pen(fn).read().s
+00017310: 706c 6974 6c69 6e65 7328 293a 0a20 2020  plitlines():.   
+00017320: 2020 2020 206c 696e 6520 3d20 6c69 6e65       line = line
+00017330: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+00017340: 2069 6620 6e6f 7420 6c69 6e65 3a0a 2020   if not line:.  
+00017350: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00017360: 7565 0a20 2020 2020 2020 2069 6620 6c69  ue.        if li
+00017370: 6e65 2e73 7461 7274 7377 6974 6828 2223  ne.startswith("#
+00017380: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+00017390: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+000173a0: 2069 6620 6c69 6e65 2e73 7461 7274 7377   if line.startsw
+000173b0: 6974 6828 2269 6e63 6c75 6465 2022 293a  ith("include "):
+000173c0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000173d0: 2073 7562 5f66 6e20 696e 2067 6c6f 6228   sub_fn in glob(
+000173e0: 6c69 6e65 5b6c 656e 2822 696e 636c 7564  line[len("includ
+000173f0: 6520 2229 203a 5d29 3a0a 2020 2020 2020  e ") :]):.      
+00017400: 2020 2020 2020 2020 2020 7061 7468 732e            paths.
+00017410: 6578 7465 6e64 2870 6172 7365 5f6c 645f  extend(parse_ld_
+00017420: 636f 6e66 5f66 696c 6528 7375 625f 666e  conf_file(sub_fn
+00017430: 2929 0a20 2020 2020 2020 2020 2020 2063  )).            c
+00017440: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00017450: 7061 7468 732e 6170 7065 6e64 286c 696e  paths.append(lin
+00017460: 6529 0a20 2020 2072 6574 7572 6e20 7061  e).    return pa
+00017470: 7468 730a 0a0a 6465 6620 6765 745f 6c64  ths...def get_ld
+00017480: 5f70 6174 6873 2829 3a0a 2020 2020 2222  _paths():.    ""
+00017490: 220a 2020 2020 546f 2062 6520 7665 7279  ".    To be very
+000174a0: 2063 6f72 7265 6374 2c20 7365 6520 6d61   correct, see ma
+000174b0: 6e2d 7061 6765 206f 6620 6c64 2e73 6f2e  n-page of ld.so.
+000174c0: 0a20 2020 2041 6e64 2068 6572 653a 2068  .    And here: h
+000174d0: 7474 7073 3a2f 2f75 6e69 782e 7374 6163  ttps://unix.stac
+000174e0: 6b65 7863 6861 6e67 652e 636f 6d2f 7175  kexchange.com/qu
+000174f0: 6573 7469 6f6e 732f 3335 3432 3935 2f77  estions/354295/w
+00017500: 6861 742d 6973 2d74 6865 2d64 6566 6175  hat-is-the-defau
+00017510: 6c74 2d76 616c 7565 2d6f 662d 6c64 2d6c  lt-value-of-ld-l
+00017520: 6962 7261 7279 2d70 6174 682f 3335 3432  ibrary-path/3542
+00017530: 3936 0a20 2020 2053 686f 7274 2076 6572  96.    Short ver
+00017540: 7369 6f6e 2c20 6e6f 7420 7370 6563 6966  sion, not specif
+00017550: 6963 2074 6f20 616e 2065 7865 6375 7461  ic to an executa
+00017560: 626c 652c 2069 6e20 7468 6973 206f 7264  ble, in this ord
+00017570: 6572 3a0a 2020 2020 2d20 4c44 5f4c 4942  er:.    - LD_LIB
+00017580: 5241 5259 5f50 4154 480a 2020 2020 2d20  RARY_PATH.    - 
+00017590: 2f65 7463 2f6c 642e 736f 2e63 6163 6865  /etc/ld.so.cache
+000175a0: 2028 696e 7374 6561 6420 7765 2077 696c   (instead we wil
+000175b0: 6c20 7061 7273 6520 2f65 7463 2f6c 642e  l parse /etc/ld.
+000175c0: 736f 2e63 6f6e 6629 0a20 2020 202d 202f  so.conf).    - /
+000175d0: 6c69 622c 202f 7573 722f 6c69 6220 286f  lib, /usr/lib (o
+000175e0: 7220 6d61 7962 6520 2f6c 6962 3634 2c20  r maybe /lib64, 
+000175f0: 2f75 7372 2f6c 6962 3634 290a 2020 2020  /usr/lib64).    
+00017600: 5669 6120 6874 7470 733a 2f2f 6769 7468  Via https://gith
+00017610: 7562 2e63 6f6d 2f61 6c62 6572 747a 2f73  ub.com/albertz/s
+00017620: 7973 7465 6d2d 746f 6f6c 732f 626c 6f62  ystem-tools/blob
+00017630: 2f6d 6173 7465 722f 6269 6e2f 6669 6e64  /master/bin/find
+00017640: 2d6c 6962 2d69 6e2d 7061 7468 2e70 792e  -lib-in-path.py.
+00017650: 0a0a 2020 2020 3a72 7479 7065 3a20 6c69  ..    :rtype: li
+00017660: 7374 5b73 7472 5d0a 2020 2020 3a72 6574  st[str].    :ret
+00017670: 7572 6e3a 206c 6973 7420 6f66 2070 6174  urn: list of pat
+00017680: 6873 2074 6f20 7365 6172 6368 2066 6f72  hs to search for
+00017690: 206c 6962 7320 282a 2e73 6f20 6669 6c65   libs (*.so file
+000176a0: 7329 0a20 2020 2022 2222 0a20 2020 2070  s).    """.    p
+000176b0: 6174 6873 203d 205b 5d0a 2020 2020 6966  aths = [].    if
+000176c0: 2022 4c44 5f4c 4942 5241 5259 5f50 4154   "LD_LIBRARY_PAT
+000176d0: 4822 2069 6e20 6f73 2e65 6e76 6972 6f6e  H" in os.environ
+000176e0: 3a0a 2020 2020 2020 2020 7061 7468 732e  :.        paths.
+000176f0: 6578 7465 6e64 286f 732e 656e 7669 726f  extend(os.enviro
+00017700: 6e5b 224c 445f 4c49 4252 4152 595f 5041  n["LD_LIBRARY_PA
+00017710: 5448 225d 2e73 706c 6974 2822 3a22 2929  TH"].split(":"))
+00017720: 0a20 2020 2069 6620 6f73 2e70 6174 682e  .    if os.path.
+00017730: 6578 6973 7473 2822 2f65 7463 2f6c 642e  exists("/etc/ld.
+00017740: 736f 2e63 6f6e 6622 293a 0a20 2020 2020  so.conf"):.     
+00017750: 2020 2070 6174 6873 2e65 7874 656e 6428     paths.extend(
+00017760: 7061 7273 655f 6c64 5f63 6f6e 665f 6669  parse_ld_conf_fi
+00017770: 6c65 2822 2f65 7463 2f6c 642e 736f 2e63  le("/etc/ld.so.c
+00017780: 6f6e 6622 2929 0a20 2020 2070 6174 6873  onf")).    paths
+00017790: 2e65 7874 656e 6428 5b22 2f6c 6962 222c  .extend(["/lib",
+000177a0: 2022 2f75 7372 2f6c 6962 222c 2022 2f6c   "/usr/lib", "/l
+000177b0: 6962 3634 222c 2022 2f75 7372 2f6c 6962  ib64", "/usr/lib
+000177c0: 3634 225d 290a 2020 2020 7265 7475 726e  64"]).    return
+000177d0: 2070 6174 6873 0a0a 0a64 6566 2066 696e   paths...def fin
+000177e0: 645f 6c69 6228 6c69 625f 6e61 6d65 293a  d_lib(lib_name):
+000177f0: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
+00017800: 7261 6d20 7374 7220 6c69 625f 6e61 6d65  ram str lib_name
+00017810: 3a20 7769 7468 6f75 7420 706f 7374 6669  : without postfi
+00017820: 782f 7072 6566 6978 2c20 652e 672e 2022  x/prefix, e.g. "
+00017830: 6375 6461 7274 2220 6f72 2022 626c 6173  cudart" or "blas
+00017840: 220a 2020 2020 3a72 6574 7572 6e3a 2072  ".    :return: r
+00017850: 6574 7572 6e73 2066 756c 6c20 7061 7468  eturns full path
+00017860: 2074 6f20 6c69 6220 6f72 204e 6f6e 650a   to lib or None.
+00017870: 2020 2020 3a72 7479 7065 3a20 7374 727c      :rtype: str|
+00017880: 4e6f 6e65 0a20 2020 2022 2222 0a20 2020  None.    """.   
+00017890: 2069 6620 7379 732e 706c 6174 666f 726d   if sys.platform
+000178a0: 203d 3d20 2264 6172 7769 6e22 3a0a 2020   == "darwin":.  
+000178b0: 2020 2020 2020 7072 6566 6978 203d 2022        prefix = "
+000178c0: 6c69 6222 0a20 2020 2020 2020 2070 6f73  lib".        pos
+000178d0: 7466 6978 203d 2022 2e64 796c 6962 220a  tfix = ".dylib".
+000178e0: 2020 2020 656c 6966 2073 7973 2e70 6c61      elif sys.pla
+000178f0: 7466 6f72 6d20 3d3d 2022 7769 6e33 3222  tform == "win32"
+00017900: 3a0a 2020 2020 2020 2020 7072 6566 6978  :.        prefix
+00017910: 203d 2022 220a 2020 2020 2020 2020 706f   = "".        po
+00017920: 7374 6669 7820 3d20 222e 646c 6c22 0a20  stfix = ".dll". 
+00017930: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00017940: 2070 7265 6669 7820 3d20 226c 6962 220a   prefix = "lib".
+00017950: 2020 2020 2020 2020 706f 7374 6669 7820          postfix 
+00017960: 3d20 222e 736f 220a 2020 2020 666f 7220  = ".so".    for 
+00017970: 7061 7468 2069 6e20 6765 745f 6c64 5f70  path in get_ld_p
+00017980: 6174 6873 2829 3a0a 2020 2020 2020 2020  aths():.        
+00017990: 666e 203d 2022 2573 2f25 7325 7325 7322  fn = "%s/%s%s%s"
+000179a0: 2025 2028 7061 7468 2c20 7072 6566 6978   % (path, prefix
+000179b0: 2c20 6c69 625f 6e61 6d65 2c20 706f 7374  , lib_name, post
+000179c0: 6669 7829 0a20 2020 2020 2020 2069 6620  fix).        if 
+000179d0: 6f73 2e70 6174 682e 6578 6973 7473 2866  os.path.exists(f
+000179e0: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
+000179f0: 7265 7475 726e 2066 6e0a 2020 2020 7265  return fn.    re
+00017a00: 7475 726e 204e 6f6e 650a 0a0a 6465 6620  turn None...def 
+00017a10: 7265 6164 5f73 6765 5f6e 756d 5f70 726f  read_sge_num_pro
+00017a20: 6373 286a 6f62 5f69 643d 4e6f 6e65 293a  cs(job_id=None):
+00017a30: 0a20 2020 2022 2222 0a20 2020 2046 726f  .    """.    Fro
+00017a40: 6d20 7468 6520 5375 6e20 4772 6964 2045  m the Sun Grid E
+00017a50: 6e67 696e 6520 2853 4745 292c 2072 6561  ngine (SGE), rea
+00017a60: 6473 2074 6865 206e 756d 5f70 726f 6320  ds the num_proc 
+00017a70: 7365 7474 696e 6720 666f 7220 6120 7061  setting for a pa
+00017a80: 7274 6963 756c 6172 206a 6f62 2e0a 2020  rticular job..  
+00017a90: 2020 4966 206a 6f62 5f69 6420 6973 206e    If job_id is n
+00017aa0: 6f74 2070 726f 7669 6465 6420 616e 6420  ot provided and 
+00017ab0: 7468 6520 4a4f 425f 4944 2065 6e76 2069  the JOB_ID env i
+00017ac0: 7320 7365 742c 2069 7420 7769 6c6c 2075  s set, it will u
+00017ad0: 7365 2074 6861 7420 696e 7374 6561 6420  se that instead 
+00017ae0: 2869 2e65 2e20 6974 2075 7365 7320 7468  (i.e. it uses th
+00017af0: 6520 6375 7272 656e 7420 6a6f 6229 2e0a  e current job)..
+00017b00: 2020 2020 5468 6973 2063 616c 6c73 2071      This calls q
+00017b10: 7374 6174 2074 6f20 6669 6775 7265 206f  stat to figure o
+00017b20: 7574 2074 6869 7320 7365 7474 696e 672e  ut this setting.
+00017b30: 2054 6865 7265 2061 7265 206d 756c 7469   There are multi
+00017b40: 706c 6520 7761 7973 2074 6869 7320 6361  ple ways this ca
+00017b50: 6e20 676f 2077 726f 6e67 2c0a 2020 2020  n go wrong,.    
+00017b60: 736f 2062 6574 7465 7220 6361 7463 6820  so better catch 
+00017b70: 616e 7920 6578 6365 7074 696f 6e2e 0a0a  any exception...
+00017b80: 2020 2020 3a70 6172 616d 2069 6e74 7c4e      :param int|N
+00017b90: 6f6e 6520 6a6f 625f 6964 3a0a 2020 2020  one job_id:.    
+00017ba0: 3a72 6574 7572 6e3a 206e 756d 5f70 726f  :return: num_pro
+00017bb0: 630a 2020 2020 3a72 7479 7065 3a20 696e  c.    :rtype: in
+00017bc0: 747c 4e6f 6e65 0a20 2020 2022 2222 0a20  t|None.    """. 
+00017bd0: 2020 2069 6620 6e6f 7420 6a6f 625f 6964     if not job_id
+00017be0: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
+00017bf0: 206f 732e 656e 7669 726f 6e2e 6765 7428   os.environ.get(
+00017c00: 2253 4745 5f52 4f4f 5422 293a 0a20 2020  "SGE_ROOT"):.   
+00017c10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00017c20: 4e6f 6e65 0a20 2020 2020 2020 2074 7279  None.        try
+00017c30: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00017c40: 7169 6e74 2e70 7920 6d69 6768 7420 6f76  qint.py might ov
+00017c50: 6572 7772 6974 6520 4a4f 425f 4944 2062  erwrite JOB_ID b
+00017c60: 7574 2073 6574 7320 5347 455f 4a4f 425f  ut sets SGE_JOB_
+00017c70: 4944 2069 6e73 7465 6164 2e0a 2020 2020  ID instead..    
+00017c80: 2020 2020 2020 2020 6a6f 625f 6964 203d          job_id =
+00017c90: 2069 6e74 286f 732e 656e 7669 726f 6e2e   int(os.environ.
+00017ca0: 6765 7428 2253 4745 5f4a 4f42 5f49 4422  get("SGE_JOB_ID"
+00017cb0: 2920 6f72 206f 732e 656e 7669 726f 6e2e  ) or os.environ.
+00017cc0: 6765 7428 224a 4f42 5f49 4422 2920 6f72  get("JOB_ID") or
+00017cd0: 2030 290a 2020 2020 2020 2020 6578 6365   0).        exce
+00017ce0: 7074 2056 616c 7565 4572 726f 7220 6173  pt ValueError as
+00017cf0: 2065 7863 3a0a 2020 2020 2020 2020 2020   exc:.          
+00017d00: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+00017d10: 6e28 2272 6561 645f 7367 655f 6e75 6d5f  n("read_sge_num_
+00017d20: 7072 6f63 733a 2025 722c 2069 6e76 616c  procs: %r, inval
+00017d30: 6964 204a 4f42 5f49 443a 2025 7222 2025  id JOB_ID: %r" %
+00017d40: 2028 6578 632c 206f 732e 656e 7669 726f   (exc, os.enviro
+00017d50: 6e2e 6765 7428 224a 4f42 5f49 4422 2929  n.get("JOB_ID"))
+00017d60: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00017d70: 206a 6f62 5f69 643a 0a20 2020 2020 2020   job_id:.       
+00017d80: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00017d90: 0a20 2020 2066 726f 6d20 7375 6270 726f  .    from subpro
+00017da0: 6365 7373 2069 6d70 6f72 7420 506f 7065  cess import Pope
+00017db0: 6e2c 2050 4950 452c 2043 616c 6c65 6450  n, PIPE, CalledP
+00017dc0: 726f 6365 7373 4572 726f 720a 0a20 2020  rocessError..   
+00017dd0: 2073 6765 5f63 6d64 203d 205b 2271 7374   sge_cmd = ["qst
+00017de0: 6174 222c 2022 2d6a 222c 2073 7472 286a  at", "-j", str(j
+00017df0: 6f62 5f69 6429 5d0a 2020 2020 7072 6f63  ob_id)].    proc
+00017e00: 203d 2050 6f70 656e 2873 6765 5f63 6d64   = Popen(sge_cmd
+00017e10: 2c20 7374 646f 7574 3d50 4950 4529 0a20  , stdout=PIPE). 
+00017e20: 2020 2073 7464 6f75 742c 205f 203d 2070     stdout, _ = p
+00017e30: 726f 632e 636f 6d6d 756e 6963 6174 6528  roc.communicate(
+00017e40: 290a 2020 2020 6966 2070 726f 632e 7265  ).    if proc.re
+00017e50: 7475 726e 636f 6465 3a0a 2020 2020 2020  turncode:.      
+00017e60: 2020 7261 6973 6520 4361 6c6c 6564 5072    raise CalledPr
+00017e70: 6f63 6573 7345 7272 6f72 2870 726f 632e  ocessError(proc.
+00017e80: 7265 7475 726e 636f 6465 2c20 7367 655f  returncode, sge_
+00017e90: 636d 642c 2073 7464 6f75 7429 0a20 2020  cmd, stdout).   
+00017ea0: 2073 7464 6f75 7420 3d20 7374 646f 7574   stdout = stdout
+00017eb0: 2e64 6563 6f64 6528 2275 7466 3822 290a  .decode("utf8").
+00017ec0: 2020 2020 6c73 203d 205b 0a20 2020 2020      ls = [.     
+00017ed0: 2020 206c 696e 655b 6c65 6e28 2268 6172     line[len("har
+00017ee0: 6420 7265 736f 7572 6365 5f6c 6973 743a  d resource_list:
+00017ef0: 2229 203a 5d2e 7374 7269 7028 290a 2020  ") :].strip().  
+00017f00: 2020 2020 2020 666f 7220 6c69 6e65 2069        for line i
+00017f10: 6e20 7374 646f 7574 2e73 706c 6974 6c69  n stdout.splitli
+00017f20: 6e65 7328 290a 2020 2020 2020 2020 6966  nes().        if
+00017f30: 206c 696e 652e 7374 6172 7473 7769 7468   line.startswith
+00017f40: 2822 6861 7264 2072 6573 6f75 7263 655f  ("hard resource_
+00017f50: 6c69 7374 3a22 290a 2020 2020 5d0a 2020  list:").    ].  
+00017f60: 2020 6173 7365 7274 206c 656e 286c 7329    assert len(ls)
+00017f70: 203d 3d20 310a 2020 2020 6f70 7473 203d   == 1.    opts =
+00017f80: 2064 6963 7428 5b6f 7074 2e73 706c 6974   dict([opt.split
+00017f90: 2822 3d22 2c20 3129 2066 6f72 206f 7074  ("=", 1) for opt
+00017fa0: 2069 6e20 6c73 5b30 5d2e 7370 6c69 7428   in ls[0].split(
+00017fb0: 222c 2229 5d29 2020 2320 6e6f 7161 0a20  ",")])  # noqa. 
+00017fc0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00017fd0: 7265 7475 726e 2069 6e74 286f 7074 735b  return int(opts[
+00017fe0: 226e 756d 5f70 726f 6322 5d29 0a20 2020  "num_proc"]).   
+00017ff0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
+00018000: 6f72 2061 7320 6578 633a 0a20 2020 2020  or as exc:.     
+00018010: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+00018020: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00018030: 2272 6561 645f 7367 655f 6e75 6d5f 7072  "read_sge_num_pr
+00018040: 6f63 733a 2025 722c 2069 6e76 616c 6964  ocs: %r, invalid
+00018050: 206e 756d 5f70 726f 6320 2572 2066 6f72   num_proc %r for
+00018060: 206a 6f62 2069 6420 2569 2e5c 6e6c 696e   job id %i.\nlin
+00018070: 653a 2025 7222 0a20 2020 2020 2020 2020  e: %r".         
+00018080: 2020 2025 2028 6578 632c 206f 7074 735b     % (exc, opts[
+00018090: 226e 756d 5f70 726f 6322 5d2c 206a 6f62  "num_proc"], job
+000180a0: 5f69 642c 206c 735b 305d 290a 2020 2020  _id, ls[0]).    
+000180b0: 2020 2020 290a 0a0a 6465 6620 6765 745f      )...def get_
+000180c0: 6e75 6d62 6572 5f61 7661 696c 6162 6c65  number_available
+000180d0: 5f63 7075 7328 293a 0a20 2020 2022 2222  _cpus():.    """
+000180e0: 0a20 2020 203a 7265 7475 726e 3a20 6e75  .    :return: nu
+000180f0: 6d62 6572 206f 6620 6176 6169 6c61 626c  mber of availabl
+00018100: 6520 4350 5573 2c20 6966 2077 6520 6361  e CPUs, if we ca
+00018110: 6e20 6669 6775 7265 2069 7420 6f75 740a  n figure it out.
+00018120: 2020 2020 3a72 7479 7065 3a20 696e 747c      :rtype: int|
+00018130: 4e6f 6e65 0a20 2020 2022 2222 0a20 2020  None.    """.   
+00018140: 2069 6620 6861 7361 7474 7228 6f73 2c20   if hasattr(os, 
+00018150: 2273 6368 6564 5f67 6574 6166 6669 6e69  "sched_getaffini
+00018160: 7479 2229 3a20 2023 2050 7974 686f 6e20  ty"):  # Python 
+00018170: 3e3d 332e 340a 2020 2020 2020 2020 7265  >=3.4.        re
+00018180: 7475 726e 206c 656e 286f 732e 7363 6865  turn len(os.sche
+00018190: 645f 6765 7461 6666 696e 6974 7928 3029  d_getaffinity(0)
+000181a0: 290a 2020 2020 7472 793a 0a20 2020 2020  ).    try:.     
+000181b0: 2020 2023 206e 6f69 6e73 7065 6374 696f     # noinspectio
+000181c0: 6e20 5079 5061 636b 6167 6552 6571 7569  n PyPackageRequi
+000181d0: 7265 6d65 6e74 732c 5079 556e 7265 736f  rements,PyUnreso
+000181e0: 6c76 6564 5265 6665 7265 6e63 6573 0a20  lvedReferences. 
+000181f0: 2020 2020 2020 2069 6d70 6f72 7420 7073         import ps
+00018200: 7574 696c 0a0a 2020 2020 2020 2020 7072  util..        pr
+00018210: 6f63 203d 2070 7375 7469 6c2e 5072 6f63  oc = psutil.Proc
+00018220: 6573 7328 290a 2020 2020 2020 2020 6966  ess().        if
+00018230: 2068 6173 6174 7472 2870 726f 632c 2022   hasattr(proc, "
+00018240: 6370 755f 6166 6669 6e69 7479 2229 3a0a  cpu_affinity"):.
+00018250: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00018260: 726e 206c 656e 2870 726f 632e 6370 755f  rn len(proc.cpu_
+00018270: 6166 6669 6e69 7479 2829 290a 2020 2020  affinity()).    
+00018280: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
+00018290: 6f72 3a0a 2020 2020 2020 2020 7061 7373  or:.        pass
+000182a0: 0a20 2020 2069 6620 6861 7361 7474 7228  .    if hasattr(
+000182b0: 6f73 2c20 2273 7973 636f 6e66 2229 2061  os, "sysconf") a
+000182c0: 6e64 2022 5343 5f4e 5052 4f43 4553 534f  nd "SC_NPROCESSO
+000182d0: 5253 5f4f 4e4c 4e22 2069 6e20 6f73 2e73  RS_ONLN" in os.s
+000182e0: 7973 636f 6e66 5f6e 616d 6573 3a0a 2020  ysconf_names:.  
+000182f0: 2020 2020 2020 7265 7475 726e 206f 732e        return os.
+00018300: 7379 7363 6f6e 6628 2253 435f 4e50 524f  sysconf("SC_NPRO
+00018310: 4345 5353 4f52 535f 4f4e 4c4e 2229 0a20  CESSORS_ONLN"). 
+00018320: 2020 2069 6620 6861 7361 7474 7228 6f73     if hasattr(os
+00018330: 2c20 2263 7075 5f63 6f75 6e74 2229 3a20  , "cpu_count"): 
+00018340: 2023 2050 7974 686f 6e20 3e3d 332e 340a   # Python >=3.4.
+00018350: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+00018360: 732e 6370 755f 636f 756e 7428 2920 2023  s.cpu_count()  #
+00018370: 206e 6f74 2071 7569 7465 2063 6f72 7265   not quite corre
+00018380: 6374 3b20 7468 6174 2061 7265 2061 6c6c  ct; that are all
+00018390: 2069 6e20 7468 6520 7379 7374 656d 0a20   in the system. 
+000183a0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+000183b0: 0a64 6566 2067 7565 7373 5f72 6571 7565  .def guess_reque
+000183c0: 7374 6564 5f6d 6178 5f6e 756d 5f74 6872  sted_max_num_thr
+000183d0: 6561 6473 286c 6f67 5f66 696c 653d 4e6f  eads(log_file=No
+000183e0: 6e65 2c20 6661 6c6c 6261 636b 5f6e 756d  ne, fallback_num
+000183f0: 5f63 7075 733d 5472 7565 293a 0a20 2020  _cpus=True):.   
+00018400: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
+00018410: 696f 2e46 696c 6520 6c6f 675f 6669 6c65  io.File log_file
+00018420: 3a0a 2020 2020 3a70 6172 616d 2062 6f6f  :.    :param boo
+00018430: 6c20 6661 6c6c 6261 636b 5f6e 756d 5f63  l fallback_num_c
+00018440: 7075 733a 0a20 2020 203a 7274 7970 653a  pus:.    :rtype:
+00018450: 2069 6e74 7c4e 6f6e 650a 2020 2020 2222   int|None.    ""
+00018460: 220a 2020 2020 7472 793a 0a20 2020 2020  ".    try:.     
+00018470: 2020 2073 6765 5f6e 756d 5f70 726f 6373     sge_num_procs
+00018480: 203d 2072 6561 645f 7367 655f 6e75 6d5f   = read_sge_num_
+00018490: 7072 6f63 7328 290a 2020 2020 6578 6365  procs().    exce
+000184a0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+000184b0: 6578 633a 0a20 2020 2020 2020 2069 6620  exc:.        if 
+000184c0: 6c6f 675f 6669 6c65 3a0a 2020 2020 2020  log_file:.      
+000184d0: 2020 2020 2020 7072 696e 7428 2245 7272        print("Err
+000184e0: 6f72 2077 6869 6c65 2067 6574 7469 6e67  or while getting
+000184f0: 2053 4745 206e 756d 5f70 726f 633a 2025   SGE num_proc: %
+00018500: 7222 2025 2065 7863 2c20 6669 6c65 3d6c  r" % exc, file=l
+00018510: 6f67 5f66 696c 6529 0a20 2020 2065 6c73  og_file).    els
+00018520: 653a 0a20 2020 2020 2020 2069 6620 7367  e:.        if sg
+00018530: 655f 6e75 6d5f 7072 6f63 733a 0a20 2020  e_num_procs:.   
+00018540: 2020 2020 2020 2020 2069 6620 6c6f 675f           if log_
+00018550: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+00018560: 2020 2020 2020 7072 696e 7428 2255 7365        print("Use
+00018570: 206e 756d 5f74 6872 6561 6473 3d25 6920   num_threads=%i 
+00018580: 2862 7574 206d 696e 2032 2920 7669 6120  (but min 2) via 
+00018590: 5347 4520 6e75 6d5f 7072 6f63 2e22 2025  SGE num_proc." %
+000185a0: 2073 6765 5f6e 756d 5f70 726f 6373 2c20   sge_num_procs, 
+000185b0: 6669 6c65 3d6c 6f67 5f66 696c 6529 0a20  file=log_file). 
+000185c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000185d0: 6e20 6d61 7828 7367 655f 6e75 6d5f 7072  n max(sge_num_pr
+000185e0: 6f63 732c 2032 290a 2020 2020 6f6d 705f  ocs, 2).    omp_
+000185f0: 6e75 6d5f 7468 7265 6164 7320 3d20 696e  num_threads = in
+00018600: 7428 6f73 2e65 6e76 6972 6f6e 2e67 6574  t(os.environ.get
+00018610: 2822 4f4d 505f 4e55 4d5f 5448 5245 4144  ("OMP_NUM_THREAD
+00018620: 5322 2920 6f72 2030 290a 2020 2020 6966  S") or 0).    if
+00018630: 206f 6d70 5f6e 756d 5f74 6872 6561 6473   omp_num_threads
+00018640: 3a0a 2020 2020 2020 2020 2320 4d69 6e69  :.        # Mini
+00018650: 6d75 6d20 6f66 2032 2074 6872 6561 6473  mum of 2 threads
+00018660: 2c20 7368 6f75 6c64 206e 6f74 2068 7572  , should not hur
+00018670: 742e 0a20 2020 2020 2020 2069 6620 6c6f  t..        if lo
+00018680: 675f 6669 6c65 3a0a 2020 2020 2020 2020  g_file:.        
+00018690: 2020 2020 7072 696e 7428 2255 7365 206e      print("Use n
+000186a0: 756d 5f74 6872 6561 6473 3d25 6920 2862  um_threads=%i (b
+000186b0: 7574 206d 696e 2032 2920 7669 6120 4f4d  ut min 2) via OM
+000186c0: 505f 4e55 4d5f 5448 5245 4144 532e 2220  P_NUM_THREADS." 
+000186d0: 2520 6f6d 705f 6e75 6d5f 7468 7265 6164  % omp_num_thread
+000186e0: 732c 2066 696c 653d 6c6f 675f 6669 6c65  s, file=log_file
+000186f0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00018700: 206d 6178 286f 6d70 5f6e 756d 5f74 6872   max(omp_num_thr
+00018710: 6561 6473 2c20 3229 0a20 2020 2069 6620  eads, 2).    if 
+00018720: 6661 6c6c 6261 636b 5f6e 756d 5f63 7075  fallback_num_cpu
+00018730: 733a 0a20 2020 2020 2020 2072 6574 7572  s:.        retur
+00018740: 6e20 6765 745f 6e75 6d62 6572 5f61 7661  n get_number_ava
+00018750: 696c 6162 6c65 5f63 7075 7328 290a 2020  ilable_cpus().  
+00018760: 2020 7265 7475 726e 204e 6f6e 650a 0a0a    return None...
+00018770: 5468 6561 6e6f 466c 6167 7320 3d20 7b0a  TheanoFlags = {.
+00018780: 2020 2020 6b65 793a 2076 616c 7565 2066      key: value f
+00018790: 6f72 2028 6b65 792c 2076 616c 7565 2920  or (key, value) 
+000187a0: 696e 205b 732e 7370 6c69 7428 223d 222c  in [s.split("=",
+000187b0: 2031 2920 666f 7220 7320 696e 206f 732e   1) for s in os.
+000187c0: 656e 7669 726f 6e2e 6765 7428 2254 4845  environ.get("THE
+000187d0: 414e 4f5f 464c 4147 5322 2c20 2222 292e  ANO_FLAGS", "").
+000187e0: 7370 6c69 7428 222c 2229 2069 6620 735d  split(",") if s]
+000187f0: 0a7d 0a0a 0a64 6566 205f 636f 6e73 6964  .}...def _consid
+00018800: 6572 5f63 6865 636b 5f66 6f72 5f67 7075  er_check_for_gpu
+00018810: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
+00018820: 5468 6572 6520 6172 6520 6361 7365 7320  There are cases 
+00018830: 7768 6572 6520 6e76 6964 6961 2d73 6d69  where nvidia-smi
+00018840: 2063 6f75 6c64 2068 616e 672e 0a20 2020   could hang..   
+00018850: 2028 416e 7920 7265 6164 206f 6620 2f70   (Any read of /p
+00018860: 726f 632f 6d6f 6475 6c65 7320 6d69 6768  roc/modules migh
+00018870: 7420 6861 6e67 2069 6e20 7468 6174 2063  t hang in that c
+00018880: 6173 652c 206d 6179 6265 2063 6175 7365  ase, maybe cause
+00018890: 640a 2020 2020 2062 7920 7472 7969 6e67  d.     by trying
+000188a0: 2074 6f20 606d 6f64 7072 6f62 6520 6e76   to `modprobe nv
+000188b0: 6964 6961 6020 746f 2063 6865 636b 2069  idia` to check i
+000188c0: 6620 7468 6572 6520 6973 2061 204e 7669  f there is a Nvi
+000188d0: 6469 6120 6361 7264 2e29 0a20 2020 2054  dia card.).    T
+000188e0: 6869 7320 736f 6d65 7469 6d65 7320 6861  his sometimes ha
+000188f0: 7070 656e 7320 696e 206f 7572 2053 4745  ppens in our SGE
+00018900: 2063 6c75 7374 6572 206f 6e20 6e6f 6465   cluster on node
+00018910: 7320 7769 7468 6f75 7420 4e76 6964 6961  s without Nvidia
+00018920: 2063 6172 6473 2e0a 2020 2020 4d61 7962   cards..    Mayb
+00018930: 6520 6974 2773 2061 6c73 6f20 6120 4c69  e it's also a Li
+00018940: 6e75 7820 4b65 726e 656c 2062 7567 2e0a  nux Kernel bug..
+00018950: 2020 2020 416e 7977 6179 2c20 6a75 7374      Anyway, just
+00018960: 2061 766f 6964 2061 6e79 2073 7563 6820   avoid any such 
+00018970: 6368 6563 6b20 6966 2077 6520 646f 6e27  check if we don'
+00018980: 7420 6173 6b65 6420 666f 7220 6120 4750  t asked for a GP
+00018990: 552e 0a0a 2020 2020 3a72 7479 7065 3a20  U...    :rtype: 
+000189a0: 626f 6f6c 0a20 2020 2022 2222 0a20 2020  bool.    """.   
+000189b0: 2069 6620 2264 6576 6963 6522 2069 6e20   if "device" in 
+000189c0: 5468 6561 6e6f 466c 6167 733a 0a20 2020  TheanoFlags:.   
+000189d0: 2020 2020 2064 6576 203d 2054 6865 616e       dev = Thean
+000189e0: 6f46 6c61 6773 5b22 6465 7669 6365 225d  oFlags["device"]
+000189f0: 0a20 2020 2020 2020 2069 6620 6465 762e  .        if dev.
+00018a00: 7374 6172 7473 7769 7468 2822 6770 7522  startswith("gpu"
+00018a10: 2920 6f72 2064 6576 2e73 7461 7274 7377  ) or dev.startsw
+00018a20: 6974 6828 2263 7564 6122 293a 0a20 2020  ith("cuda"):.   
+00018a30: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00018a40: 5472 7565 0a20 2020 2020 2020 2023 2054  True.        # T
+00018a50: 4845 414e 4f5f 464c 4147 5320 7769 6c6c  HEANO_FLAGS will
+00018a60: 206f 7665 7277 7269 7465 2074 6869 7320   overwrite this 
+00018a70: 636f 6e66 6967 206f 7074 696f 6e2e 2053  config option. S
+00018a80: 6565 2072 6e6e 2e69 6e69 7444 6576 6963  ee rnn.initDevic
+00018a90: 6573 2829 2e0a 2020 2020 2020 2020 7265  es()..        re
+00018aa0: 7475 726e 2046 616c 7365 0a20 2020 2023  turn False.    #
+00018ab0: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
+00018ac0: 4272 6f61 6445 7863 6570 7469 6f6e 0a20  BroadException. 
+00018ad0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00018ae0: 6672 6f6d 2072 6574 7572 6e6e 2e63 6f6e  from returnn.con
+00018af0: 6669 6720 696d 706f 7274 2067 6574 5f67  fig import get_g
+00018b00: 6c6f 6261 6c5f 636f 6e66 6967 0a0a 2020  lobal_config..  
+00018b10: 2020 2020 2020 636f 6e66 6967 203d 2067        config = g
+00018b20: 6574 5f67 6c6f 6261 6c5f 636f 6e66 6967  et_global_config
+00018b30: 2829 0a20 2020 2065 7863 6570 7420 4578  ().    except Ex
+00018b40: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00018b50: 2063 6f6e 6669 6720 3d20 4e6f 6e65 0a20   config = None. 
+00018b60: 2020 2069 6620 636f 6e66 6967 3a0a 2020     if config:.  
+00018b70: 2020 2020 2020 666f 7220 6465 7620 696e        for dev in
+00018b80: 2063 6f6e 6669 672e 6c69 7374 2822 6465   config.list("de
+00018b90: 7669 6365 222c 205b 5d29 3a0a 2020 2020  vice", []):.    
+00018ba0: 2020 2020 2020 2020 6966 2064 6576 2e73          if dev.s
+00018bb0: 7461 7274 7377 6974 6828 2267 7075 2229  tartswith("gpu")
+00018bc0: 206f 7220 6465 762e 7374 6172 7473 7769   or dev.startswi
+00018bd0: 7468 2822 6375 6461 2229 3a0a 2020 2020  th("cuda"):.    
+00018be0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00018bf0: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+00018c00: 2020 2020 6966 2064 6576 203d 3d20 2261      if dev == "a
+00018c10: 6c6c 223a 0a20 2020 2020 2020 2020 2020  ll":.           
+00018c20: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00018c30: 0a20 2020 2072 6574 7572 6e20 4661 6c73  .    return Fals
+00018c40: 650a 0a0a 6465 6620 6765 745f 6770 755f  e...def get_gpu_
+00018c50: 6e61 6d65 7328 293a 0a20 2020 2022 2222  names():.    """
+00018c60: 0a20 2020 203a 7274 7970 653a 206c 6973  .    :rtype: lis
+00018c70: 745b 7374 725d 0a20 2020 2022 2222 0a20  t[str].    """. 
+00018c80: 2020 2069 6620 6e6f 7420 5f63 6f6e 7369     if not _consi
+00018c90: 6465 725f 6368 6563 6b5f 666f 725f 6770  der_check_for_gp
+00018ca0: 7528 293a 0a20 2020 2020 2020 2072 6574  u():.        ret
+00018cb0: 7572 6e20 5b5d 0a20 2020 2069 6620 6f73  urn [].    if os
+00018cc0: 2e6e 616d 6520 3d3d 2022 6e74 223a 0a20  .name == "nt":. 
+00018cd0: 2020 2020 2020 2072 6574 7572 6e20 2247         return "G
+00018ce0: 6546 6f72 6365 2047 5458 2037 3730 2220  eForce GTX 770" 
+00018cf0: 2023 2054 4f44 4f0a 2020 2020 656c 6966   # TODO.    elif
+00018d00: 2073 7973 2e70 6c61 7466 6f72 6d20 3d3d   sys.platform ==
+00018d10: 2022 6461 7277 696e 223a 0a20 2020 2020   "darwin":.     
+00018d20: 2020 2023 2054 4f44 4f20 7061 7273 6520     # TODO parse 
+00018d30: 7669 6120 786d 6c20 6f75 7470 7574 0a20  via xml output. 
+00018d40: 2020 2020 2020 2072 6574 7572 6e20 7379         return sy
+00018d50: 735f 636d 645f 6f75 745f 6c69 6e65 7328  s_cmd_out_lines(
+00018d60: 0a20 2020 2020 2020 2020 2020 2022 7379  .            "sy
+00018d70: 7374 656d 5f70 726f 6669 6c65 7220 5350  stem_profiler SP
+00018d80: 4469 7370 6c61 7973 4461 7461 5479 7065  DisplaysDataType
+00018d90: 207c 2022 0a20 2020 2020 2020 2020 2020   | ".           
+00018da0: 2022 6772 6570 2027 4368 6970 7365 7420   "grep 'Chipset 
+00018db0: 4d6f 6465 6c3a 204e 5649 4449 4127 207c  Model: NVIDIA' |
+00018dc0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+00018dd0: 7365 6420 2773 2f2e 2a43 6869 7073 6574  sed 's/.*Chipset
+00018de0: 204d 6f64 656c 3a20 4e56 4944 4941 202a   Model: NVIDIA *
+00018df0: 2f2f 3b73 2f20 2a24 2f2f 2722 0a20 2020  //;s/ *$//'".   
+00018e00: 2020 2020 2029 0a20 2020 2065 6c73 653a       ).    else:
+00018e10: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00018e20: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00018e30: 2073 7973 5f63 6d64 5f6f 7574 5f6c 696e   sys_cmd_out_lin
+00018e40: 6573 2822 6e76 6964 6961 2d73 6d69 202d  es("nvidia-smi -
+00018e50: 4c20 7c20 6375 7420 2d64 2027 2827 202d  L | cut -d '(' -
+00018e60: 6620 3120 7c20 6375 7420 2d64 2027 2027  f 1 | cut -d ' '
+00018e70: 202d 6620 332d 207c 2073 6564 202d 6520   -f 3- | sed -e 
+00018e80: 2773 2f5c 5c20 242f 2f27 2229 0a20 2020  's/\\ $//'").   
+00018e90: 2020 2020 2065 7863 6570 7420 4361 6c6c       except Call
+00018ea0: 6564 5072 6f63 6573 7345 7272 6f72 3a0a  edProcessError:.
+00018eb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00018ec0: 726e 205b 5d0a 0a0a 6465 6620 5f67 6574  rn []...def _get
+00018ed0: 5f6e 756d 5f67 7075 5f64 6576 6963 6573  _num_gpu_devices
+00018ee0: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
+00018ef0: 3a72 6574 7572 6e3a 2063 7075 2c67 7075  :return: cpu,gpu
+00018f00: 0a20 2020 203a 7274 7970 653a 2028 696e  .    :rtype: (in
+00018f10: 742c 696e 7429 0a20 2020 2022 2222 0a20  t,int).    """. 
+00018f20: 2020 2069 6620 6f73 2e6e 616d 6520 3d3d     if os.name ==
+00018f30: 2022 6e74 223a 0a20 2020 2020 2020 2072   "nt":.        r
+00018f40: 6574 7572 6e20 312c 2031 2020 2320 544f  eturn 1, 1  # TO
+00018f50: 444f 0a20 2020 2065 6c69 6620 7379 732e  DO.    elif sys.
+00018f60: 706c 6174 666f 726d 203d 3d20 2264 6172  platform == "dar
+00018f70: 7769 6e22 3a0a 2020 2020 2020 2020 7265  win":.        re
+00018f80: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
+00018f90: 2020 2069 6e74 2873 7973 5f63 6d64 5f6f     int(sys_cmd_o
+00018fa0: 7574 5f6c 696e 6573 2822 7379 7363 746c  ut_lines("sysctl
+00018fb0: 202d 6120 7c20 6772 6570 206d 6163 6864   -a | grep machd
+00018fc0: 6570 2e63 7075 2e63 6f72 655f 636f 756e  ep.cpu.core_coun
+00018fd0: 7420 7c20 6177 6b20 277b 7072 696e 7420  t | awk '{print 
+00018fe0: 2432 7d27 2229 5b30 5d29 2c0a 2020 2020  $2}'")[0]),.    
+00018ff0: 2020 2020 2020 2020 6c65 6e28 7379 735f          len(sys_
+00019000: 636d 645f 6f75 745f 6c69 6e65 7328 2273  cmd_out_lines("s
+00019010: 7973 7465 6d5f 7072 6f66 696c 6572 2053  ystem_profiler S
+00019020: 5044 6973 706c 6179 7344 6174 6154 7970  PDisplaysDataTyp
+00019030: 6520 7c20 6772 6570 2027 4368 6970 7365  e | grep 'Chipse
+00019040: 7420 4d6f 6465 6c3a 204e 5649 4449 4127  t Model: NVIDIA'
+00019050: 207c 2063 6174 2229 292c 0a20 2020 2020   | cat")),.     
+00019060: 2020 2029 0a20 2020 2065 6c73 653a 0a20     ).    else:. 
+00019070: 2020 2020 2020 206e 756d 5f63 7075 7320         num_cpus 
+00019080: 3d20 6c65 6e28 7379 735f 636d 645f 6f75  = len(sys_cmd_ou
+00019090: 745f 6c69 6e65 7328 2263 6174 202f 7072  t_lines("cat /pr
+000190a0: 6f63 2f63 7075 696e 666f 207c 2067 7265  oc/cpuinfo | gre
+000190b0: 7020 7072 6f63 6573 736f 7222 2929 206f  p processor")) o
+000190c0: 7220 310a 2020 2020 2020 2020 6e75 6d5f  r 1.        num_
+000190d0: 6770 7573 203d 2030 0a20 2020 2020 2020  gpus = 0.       
+000190e0: 2069 6620 5f63 6f6e 7369 6465 725f 6368   if _consider_ch
+000190f0: 6563 6b5f 666f 725f 6770 7528 293a 0a20  eck_for_gpu():. 
+00019100: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00019110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019120: 6e75 6d5f 6770 7573 203d 206c 656e 2873  num_gpus = len(s
+00019130: 7973 5f63 6d64 5f6f 7574 5f6c 696e 6573  ys_cmd_out_lines
+00019140: 2822 6e76 6964 6961 2d73 6d69 202d 4c22  ("nvidia-smi -L"
+00019150: 2929 0a20 2020 2020 2020 2020 2020 2065  )).            e
+00019160: 7863 6570 7420 4361 6c6c 6564 5072 6f63  xcept CalledProc
+00019170: 6573 7345 7272 6f72 3a0a 2020 2020 2020  essError:.      
+00019180: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+00019190: 2020 2020 2020 2072 6574 7572 6e20 6e75         return nu
+000191a0: 6d5f 6370 7573 2c20 6e75 6d5f 6770 7573  m_cpus, num_gpus
+000191b0: 0a0a 0a5f 6e75 6d5f 6465 7669 6365 7320  ..._num_devices 
+000191c0: 3d20 4e6f 6e65 0a0a 0a64 6566 2067 6574  = None...def get
+000191d0: 5f6e 756d 5f67 7075 5f64 6576 6963 6573  _num_gpu_devices
+000191e0: 2829 3a0a 2020 2020 2222 220a 2020 2020  ():.    """.    
+000191f0: 3a72 6574 7572 6e3a 2028 6370 7520 636f  :return: (cpu co
+00019200: 756e 742c 2067 7075 2063 6f75 6e74 290a  unt, gpu count).
+00019210: 2020 2020 3a72 7479 7065 3a20 2869 6e74      :rtype: (int
+00019220: 2c20 696e 7429 0a20 2020 2022 2222 0a20  , int).    """. 
+00019230: 2020 2067 6c6f 6261 6c20 5f6e 756d 5f64     global _num_d
+00019240: 6576 6963 6573 0a20 2020 2069 6620 5f6e  evices.    if _n
+00019250: 756d 5f64 6576 6963 6573 2069 7320 6e6f  um_devices is no
+00019260: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00019270: 7265 7475 726e 205f 6e75 6d5f 6465 7669  return _num_devi
+00019280: 6365 730a 2020 2020 5f6e 756d 5f64 6576  ces.    _num_dev
+00019290: 6963 6573 203d 205f 6765 745f 6e75 6d5f  ices = _get_num_
+000192a0: 6770 755f 6465 7669 6365 7328 290a 2020  gpu_devices().  
+000192b0: 2020 7265 7475 726e 205f 6e75 6d5f 6465    return _num_de
+000192c0: 7669 6365 730a 0a0a 6465 6620 6861 7665  vices...def have
+000192d0: 5f67 7075 2829 3a0a 2020 2020 2222 220a  _gpu():.    """.
+000192e0: 2020 2020 3a72 7479 7065 3a20 626f 6f6c      :rtype: bool
+000192f0: 0a20 2020 2022 2222 0a20 2020 2063 7075  .    """.    cpu
+00019300: 732c 2067 7075 7320 3d20 6765 745f 6e75  s, gpus = get_nu
+00019310: 6d5f 6770 755f 6465 7669 6365 7328 290a  m_gpu_devices().
+00019320: 2020 2020 7265 7475 726e 2067 7075 7320      return gpus 
+00019330: 3e20 300a 0a0a 6465 6620 7472 795f 616e  > 0...def try_an
+00019340: 645f 6967 6e6f 7265 5f65 7863 6570 7469  d_ignore_excepti
+00019350: 6f6e 2866 293a 0a20 2020 2022 2222 0a20  on(f):.    """. 
+00019360: 2020 2043 616c 6c73 2060 6066 6060 2c20     Calls ``f``, 
+00019370: 616e 6420 6967 6e6f 7265 7320 616e 7920  and ignores any 
+00019380: 6578 6365 7074 696f 6e2e 0a0a 2020 2020  exception...    
+00019390: 3a70 6172 616d 2028 292d 3e54 2066 3a0a  :param ()->T f:.
+000193a0: 2020 2020 3a72 6574 7572 6e3a 2077 6861      :return: wha
+000193b0: 7465 7665 7220 6060 6660 6020 7265 7475  tever ``f`` retu
+000193c0: 726e 732c 206f 7220 4e6f 6e65 0a20 2020  rns, or None.   
+000193d0: 203a 7274 7970 653a 2054 7c4e 6f6e 650a   :rtype: T|None.
+000193e0: 2020 2020 2222 220a 2020 2020 7472 793a      """.    try:
+000193f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00019400: 6628 290a 2020 2020 6578 6365 7074 2045  f().    except E
+00019410: 7863 6570 7469 6f6e 2061 7320 6578 633a  xception as exc:
+00019420: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
+00019430: 7472 795f 616e 645f 6967 6e6f 7265 5f65  try_and_ignore_e
+00019440: 7863 6570 7469 6f6e 3a20 2572 2066 6169  xception: %r fai
+00019450: 6c65 643a 2025 7322 2025 2028 662c 2065  led: %s" % (f, e
+00019460: 7863 2929 0a20 2020 2020 2020 2073 7973  xc)).        sys
+00019470: 2e65 7863 6570 7468 6f6f 6b28 2a73 7973  .excepthook(*sys
+00019480: 2e65 7863 5f69 6e66 6f28 2929 0a20 2020  .exc_info()).   
+00019490: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+000194a0: 0a0a 0a64 6566 2074 7279 5f67 6574 5f73  ...def try_get_s
+000194b0: 7461 636b 5f66 7261 6d65 2864 6570 7468  tack_frame(depth
+000194c0: 3d31 293a 0a20 2020 2022 2222 0a20 2020  =1):.    """.   
+000194d0: 203a 7061 7261 6d20 696e 7420 6465 7074   :param int dept
+000194e0: 683a 0a20 2020 203a 7274 7970 653a 2074  h:.    :rtype: t
+000194f0: 7970 6573 2e46 7261 6d65 5479 7065 7c4e  ypes.FrameType|N
+00019500: 6f6e 650a 2020 2020 3a72 6574 7572 6e3a  one.    :return:
+00019510: 2063 616c 6c65 7220 6675 6e63 7469 6f6e   caller function
+00019520: 206e 616d 652e 2074 6869 7320 6973 206a   name. this is j
+00019530: 7573 7420 666f 7220 6465 6275 6767 696e  ust for debuggin
+00019540: 670a 2020 2020 2222 220a 2020 2020 2320  g.    """.    # 
+00019550: 6e6f 696e 7370 6563 7469 6f6e 2050 7942  noinspection PyB
+00019560: 726f 6164 4578 6365 7074 696f 6e0a 2020  roadException.  
+00019570: 2020 7472 793a 0a20 2020 2020 2020 2023    try:.        #
+00019580: 206e 6f69 6e73 7065 6374 696f 6e20 5079   noinspection Py
+00019590: 5072 6f74 6563 7465 644d 656d 6265 722c  ProtectedMember,
+000195a0: 5079 556e 7265 736f 6c76 6564 5265 6665  PyUnresolvedRefe
+000195b0: 7265 6e63 6573 0a20 2020 2020 2020 2066  rences.        f
+000195c0: 7261 6d65 203d 2073 7973 2e5f 6765 7466  rame = sys._getf
+000195d0: 7261 6d65 2864 6570 7468 202b 2031 2920  rame(depth + 1) 
+000195e0: 2023 206f 6e65 206d 6f72 6520 746f 2063   # one more to c
+000195f0: 6f75 6e74 206f 7572 7365 6c76 6573 0a20  ount ourselves. 
+00019600: 2020 2020 2020 2072 6574 7572 6e20 6672         return fr
+00019610: 616d 650a 2020 2020 6578 6365 7074 2045  ame.    except E
+00019620: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
+00019630: 2020 7265 7475 726e 204e 6f6e 650a 0a0a    return None...
+00019640: 6465 6620 7472 795f 6765 745f 6361 6c6c  def try_get_call
+00019650: 6572 5f6e 616d 6528 6465 7074 683d 312c  er_name(depth=1,
+00019660: 2066 616c 6c62 6163 6b3d 4e6f 6e65 293a   fallback=None):
+00019670: 0a20 2020 2022 2222 0a20 2020 203a 7061  .    """.    :pa
+00019680: 7261 6d20 696e 7420 6465 7074 683a 0a20  ram int depth:. 
+00019690: 2020 203a 7061 7261 6d20 7374 727c 4e6f     :param str|No
+000196a0: 6e65 2066 616c 6c62 6163 6b3a 2074 6869  ne fallback: thi
+000196b0: 7320 6973 2072 6574 7572 6e65 6420 6966  s is returned if
+000196c0: 2077 6520 6661 696c 2066 6f72 2073 6f6d   we fail for som
+000196d0: 6520 7265 6173 6f6e 0a20 2020 203a 7274  e reason.    :rt
+000196e0: 7970 653a 2073 7472 7c4e 6f6e 650a 2020  ype: str|None.  
+000196f0: 2020 3a72 6574 7572 6e3a 2063 616c 6c65    :return: calle
+00019700: 7220 6675 6e63 7469 6f6e 206e 616d 652e  r function name.
+00019710: 2074 6869 7320 6973 206a 7573 7420 666f   this is just fo
+00019720: 7220 6465 6275 6767 696e 670a 2020 2020  r debugging.    
+00019730: 2222 220a 2020 2020 6672 616d 6520 3d20  """.    frame = 
+00019740: 7472 795f 6765 745f 7374 6163 6b5f 6672  try_get_stack_fr
+00019750: 616d 6528 6465 7074 6820 2b20 3129 2020  ame(depth + 1)  
+00019760: 2320 6f6e 6520 6d6f 7265 2074 6f20 636f  # one more to co
+00019770: 756e 7420 6f75 7273 656c 7665 730a 2020  unt ourselves.  
+00019780: 2020 6966 2066 7261 6d65 3a0a 2020 2020    if frame:.    
+00019790: 2020 2020 6672 6f6d 202e 6265 7474 6572      from .better
+000197a0: 5f65 7863 686f 6f6b 2069 6d70 6f72 7420  _exchook import 
+000197b0: 6765 745f 6675 6e63 5f73 7472 5f66 726f  get_func_str_fro
+000197c0: 6d5f 636f 6465 5f6f 626a 6563 740a 0a20  m_code_object.. 
+000197d0: 2020 2020 2020 2072 6574 7572 6e20 6765         return ge
+000197e0: 745f 6675 6e63 5f73 7472 5f66 726f 6d5f  t_func_str_from_
+000197f0: 636f 6465 5f6f 626a 6563 7428 6672 616d  code_object(fram
+00019800: 652e 665f 636f 6465 290a 2020 2020 7265  e.f_code).    re
+00019810: 7475 726e 2066 616c 6c62 6163 6b0a 0a0a  turn fallback...
+00019820: 636c 6173 7320 496e 6669 6e69 7465 5265  class InfiniteRe
+00019830: 6375 7273 696f 6e44 6574 6563 7465 6428  cursionDetected(
+00019840: 4578 6365 7074 696f 6e29 3a0a 2020 2020  Exception):.    
+00019850: 2222 220a 2020 2020 5261 6973 6564 2077  """.    Raised w
+00019860: 6865 6e20 616e 2069 6e66 696e 6974 6520  hen an infinite 
+00019870: 7265 6375 7273 696f 6e20 6973 2064 6574  recursion is det
+00019880: 6563 7465 642c 2062 7920 6775 6172 645f  ected, by guard_
+00019890: 696e 6669 6e69 7465 5f72 6563 7572 7369  infinite_recursi
+000198a0: 6f6e 2e0a 2020 2020 2222 220a 0a0a 5f67  on..    """..._g
+000198b0: 7561 7264 5f69 6e66 696e 6974 655f 7265  uard_infinite_re
+000198c0: 6375 7273 696f 6e5f 6361 6368 6520 3d20  cursion_cache = 
+000198d0: 7468 7265 6164 696e 672e 6c6f 6361 6c28  threading.local(
+000198e0: 290a 0a0a 4063 6f6e 7465 7874 6c69 622e  )...@contextlib.
+000198f0: 636f 6e74 6578 746d 616e 6167 6572 0a64  contextmanager.d
+00019900: 6566 2067 7561 7264 5f69 6e66 696e 6974  ef guard_infinit
+00019910: 655f 7265 6375 7273 696f 6e28 2a61 7267  e_recursion(*arg
+00019920: 7329 3a0a 2020 2020 2222 220a 2020 2020  s):.    """.    
+00019930: 5265 6769 7374 6572 7320 6172 6773 2028  Registers args (
+00019940: 636f 756c 6420 6265 2066 756e 6320 2b20  could be func + 
+00019950: 6172 6773 2920 696e 2073 6f6d 6520 6361  args) in some ca
+00019960: 6368 652e 0a20 2020 2049 6620 7468 6f73  che..    If thos
+00019970: 6520 6172 6773 2061 7265 2061 6c72 6561  e args are alrea
+00019980: 6479 2069 6e20 7468 6520 6361 6368 652c  dy in the cache,
+00019990: 2069 7420 7769 6c6c 2072 6169 7365 2061   it will raise a
+000199a0: 6e20 6578 6365 7074 696f 6e2e 0a0a 2020  n exception...  
+000199b0: 2020 4974 2077 696c 6c20 7573 6520 7468    It will use th
+000199c0: 6520 6964 206f 6620 7468 6520 6172 6773  e id of the args
+000199d0: 2061 7320 6b65 7920 616e 6420 6e6f 7420   as key and not 
+000199e0: 7573 6520 616e 7920 6861 7368 696e 670a  use any hashing.
+000199f0: 2020 2020 746f 2061 6c6c 6f77 2074 6861      to allow tha
+00019a00: 7420 6775 6172 645f 696e 6669 6e69 7465  t guard_infinite
+00019a10: 5f72 6563 7572 7369 6f6e 2063 616e 2062  _recursion can b
+00019a20: 6520 7573 6564 0a20 2020 2074 6f20 6775  e used.    to gu
+00019a30: 6172 6420 6375 7374 6f6d 205f 5f68 6173  ard custom __has
+00019a40: 685f 5f20 696d 706c 656d 656e 7461 7469  h__ implementati
+00019a50: 6f6e 7320 6173 2077 656c 6c2e 0a20 2020  ons as well..   
+00019a60: 2022 2222 0a20 2020 2069 6620 6e6f 7420   """.    if not 
+00019a70: 6172 6773 3a0a 2020 2020 2020 2020 7261  args:.        ra
+00019a80: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00019a90: 6775 6172 645f 696e 6669 6e69 7465 5f72  guard_infinite_r
+00019aa0: 6563 7572 7369 6f6e 206e 6565 6473 2061  ecursion needs a
+00019ab0: 7420 6c65 6173 7420 6f6e 6520 6172 6722  t least one arg"
+00019ac0: 290a 2020 2020 6b65 7920 3d20 7475 706c  ).    key = tupl
+00019ad0: 6528 6964 2861 7267 2920 666f 7220 6172  e(id(arg) for ar
+00019ae0: 6720 696e 2061 7267 7329 0a20 2020 2069  g in args).    i
+00019af0: 6620 6e6f 7420 6861 7361 7474 7228 5f67  f not hasattr(_g
+00019b00: 7561 7264 5f69 6e66 696e 6974 655f 7265  uard_infinite_re
+00019b10: 6375 7273 696f 6e5f 6361 6368 652c 2022  cursion_cache, "
+00019b20: 6361 6368 6522 293a 0a20 2020 2020 2020  cache"):.       
+00019b30: 205f 6775 6172 645f 696e 6669 6e69 7465   _guard_infinite
+00019b40: 5f72 6563 7572 7369 6f6e 5f63 6163 6865  _recursion_cache
+00019b50: 2e63 6163 6865 203d 2073 6574 2829 0a20  .cache = set(). 
+00019b60: 2020 2069 6620 6b65 7920 696e 205f 6775     if key in _gu
+00019b70: 6172 645f 696e 6669 6e69 7465 5f72 6563  ard_infinite_rec
+00019b80: 7572 7369 6f6e 5f63 6163 6865 2e63 6163  ursion_cache.cac
+00019b90: 6865 3a0a 2020 2020 2020 2020 7261 6973  he:.        rais
+00019ba0: 6520 496e 6669 6e69 7465 5265 6375 7273  e InfiniteRecurs
+00019bb0: 696f 6e44 6574 6563 7465 6428 2269 6e66  ionDetected("inf
+00019bc0: 696e 6974 6520 7265 6375 7273 696f 6e20  inite recursion 
+00019bd0: 6465 7465 6374 6564 2229 0a20 2020 205f  detected").    _
+00019be0: 6775 6172 645f 696e 6669 6e69 7465 5f72  guard_infinite_r
+00019bf0: 6563 7572 7369 6f6e 5f63 6163 6865 2e63  ecursion_cache.c
+00019c00: 6163 6865 2e61 6464 286b 6579 290a 2020  ache.add(key).  
+00019c10: 2020 7472 793a 0a20 2020 2020 2020 2079    try:.        y
+00019c20: 6965 6c64 0a20 2020 2066 696e 616c 6c79  ield.    finally
+00019c30: 3a0a 2020 2020 2020 2020 5f67 7561 7264  :.        _guard
+00019c40: 5f69 6e66 696e 6974 655f 7265 6375 7273  _infinite_recurs
+00019c50: 696f 6e5f 6361 6368 652e 6361 6368 652e  ion_cache.cache.
+00019c60: 7265 6d6f 7665 286b 6579 290a 0a0a 6465  remove(key)...de
+00019c70: 6620 6361 6d65 6c5f 6361 7365 5f74 6f5f  f camel_case_to_
+00019c80: 736e 616b 655f 6361 7365 286e 616d 6529  snake_case(name)
+00019c90: 3a0a 2020 2020 2222 220a 2020 2020 3a70  :.    """.    :p
+00019ca0: 6172 616d 2073 7472 206e 616d 653a 2065  aram str name: e
+00019cb0: 2e67 2e20 2243 616d 656c 4361 7365 220a  .g. "CamelCase".
+00019cc0: 2020 2020 3a72 6574 7572 6e3a 2065 2e67      :return: e.g
+00019cd0: 2e20 2263 616d 656c 5f63 6173 6522 0a20  . "camel_case". 
+00019ce0: 2020 203a 7274 7970 653a 2073 7472 0a20     :rtype: str. 
+00019cf0: 2020 2022 2222 0a20 2020 2073 3120 3d20     """.    s1 = 
+00019d00: 7265 2e73 7562 2822 282e 2928 5b41 2d5a  re.sub("(.)([A-Z
+00019d10: 5d5b 612d 7a5d 2b29 222c 2072 225c 315f  ][a-z]+)", r"\1_
+00019d20: 5c32 222c 206e 616d 6529 0a20 2020 2072  \2", name).    r
+00019d30: 6574 7572 6e20 7265 2e73 7562 2822 285b  eturn re.sub("([
+00019d40: 612d 7a30 2d39 5d29 285b 412d 5a5d 2922  a-z0-9])([A-Z])"
+00019d50: 2c20 7222 5c31 5f5c 3222 2c20 7331 292e  , r"\1_\2", s1).
+00019d60: 6c6f 7765 7228 290a 0a0a 6465 6620 6765  lower()...def ge
+00019d70: 745f 686f 7374 6e61 6d65 2829 3a0a 2020  t_hostname():.  
+00019d80: 2020 2222 220a 2020 2020 3a72 6574 7572    """.    :retur
+00019d90: 6e3a 2065 2e67 2e20 2263 6c75 7374 6572  n: e.g. "cluster
+00019da0: 2d63 6e2d 3231 3122 0a20 2020 203a 7274  -cn-211".    :rt
+00019db0: 7970 653a 2073 7472 0a20 2020 2022 2222  ype: str.    """
+00019dc0: 0a20 2020 2023 2063 6865 636b 5f6f 7574  .    # check_out
+00019dd0: 7075 7428 5b22 686f 7374 6e61 6d65 225d  put(["hostname"]
+00019de0: 292e 7374 7269 7028 292e 6465 636f 6465  ).strip().decode
+00019df0: 2822 7574 6638 2229 0a20 2020 2069 6d70  ("utf8").    imp
+00019e00: 6f72 7420 736f 636b 6574 0a0a 2020 2020  ort socket..    
+00019e10: 7265 7475 726e 2073 6f63 6b65 742e 6765  return socket.ge
+00019e20: 7468 6f73 746e 616d 6528 290a 0a0a 6465  thostname()...de
+00019e30: 6620 6973 5f72 756e 6e69 6e67 5f6f 6e5f  f is_running_on_
+00019e40: 636c 7573 7465 7228 293a 0a20 2020 2022  cluster():.    "
+00019e50: 2222 0a20 2020 203a 7265 7475 726e 3a20  "".    :return: 
+00019e60: 6936 2073 7065 6369 6669 632e 2057 6865  i6 specific. Whe
+00019e70: 7468 6572 2077 6520 7275 6e20 6f6e 2073  ther we run on s
+00019e80: 6f6d 6520 6f66 2074 6865 2063 6c75 7374  ome of the clust
+00019e90: 6572 206e 6f64 6573 2e0a 2020 2020 3a72  er nodes..    :r
+00019ea0: 7479 7065 3a20 626f 6f6c 0a20 2020 2022  type: bool.    "
+00019eb0: 2222 0a20 2020 2072 6574 7572 6e20 6765  "".    return ge
+00019ec0: 745f 686f 7374 6e61 6d65 2829 2e73 7461  t_hostname().sta
+00019ed0: 7274 7377 6974 6828 2263 6c75 7374 6572  rtswith("cluster
+00019ee0: 2d63 6e2d 2229 206f 7220 6765 745f 686f  -cn-") or get_ho
+00019ef0: 7374 6e61 6d65 2829 2e73 7461 7274 7377  stname().startsw
+00019f00: 6974 6828 2263 6e2d 2229 0a0a 0a73 7461  ith("cn-")...sta
+00019f10: 7274 5f74 696d 6520 3d20 7469 6d65 2e74  rt_time = time.t
+00019f20: 696d 6528 290a 0a0a 6465 6620 6765 745f  ime()...def get_
+00019f30: 7574 635f 7374 6172 745f 7469 6d65 5f66  utc_start_time_f
+00019f40: 696c 656e 616d 655f 7061 7274 2829 3a0a  ilename_part():.
+00019f50: 2020 2020 2222 220a 2020 2020 3a72 6574      """.    :ret
+00019f60: 7572 6e3a 2073 7472 696e 6720 7768 6963  urn: string whic
+00019f70: 6820 6361 6e20 6265 2075 7365 6420 6173  h can be used as
+00019f80: 2070 6172 7420 6f66 2061 2066 696c 656e   part of a filen
+00019f90: 616d 652c 2077 6869 6368 2072 6570 7265  ame, which repre
+00019fa0: 7365 6e74 7320 7468 6520 7374 6172 7420  sents the start 
+00019fb0: 7469 6d65 206f 6620 5245 5455 524e 4e20  time of RETURNN 
+00019fc0: 696e 2055 5443 0a20 2020 203a 7274 7970  in UTC.    :rtyp
+00019fd0: 653a 2073 7472 0a20 2020 2022 2222 0a20  e: str.    """. 
+00019fe0: 2020 2072 6574 7572 6e20 7469 6d65 2e73     return time.s
+00019ff0: 7472 6674 696d 6528 2225 592d 256d 2d25  trftime("%Y-%m-%
+0001a000: 642d 2548 2d25 4d2d 2553 222c 2074 696d  d-%H-%M-%S", tim
+0001a010: 652e 676d 7469 6d65 2873 7461 7274 5f74  e.gmtime(start_t
+0001a020: 696d 6529 290a 0a0a 6465 6620 6d61 7962  ime))...def mayb
+0001a030: 655f 6d61 6b65 5f64 6972 7328 6469 726e  e_make_dirs(dirn
+0001a040: 616d 6529 3a0a 2020 2020 2222 220a 2020  ame):.    """.  
+0001a050: 2020 4372 6561 7465 7320 7468 6520 6469    Creates the di
+0001a060: 7265 6374 6f72 7920 6966 2069 7420 646f  rectory if it do
+0001a070: 6573 206e 6f74 2079 6574 2065 7869 7374  es not yet exist
+0001a080: 2e0a 0a20 2020 203a 7061 7261 6d20 7374  ...    :param st
+0001a090: 7220 6469 726e 616d 653a 2054 6865 2070  r dirname: The p
+0001a0a0: 6174 6820 6f66 2074 6865 2064 6972 6563  ath of the direc
+0001a0b0: 746f 7279 0a20 2020 2022 2222 0a20 2020  tory.    """.   
+0001a0c0: 2069 6d70 6f72 7420 6f73 0a0a 2020 2020   import os..    
+0001a0d0: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+0001a0e0: 7869 7374 7328 6469 726e 616d 6529 3a0a  xists(dirname):.
+0001a0f0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0001a100: 2020 2020 2020 2020 206f 732e 6d61 6b65           os.make
+0001a110: 6469 7273 2864 6972 6e61 6d65 290a 2020  dirs(dirname).  
+0001a120: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+0001a130: 6570 7469 6f6e 2061 7320 6578 633a 0a20  eption as exc:. 
+0001a140: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001a150: 2822 6d61 7962 655f 6372 6561 7465 5f66  ("maybe_create_f
+0001a160: 6f6c 6465 723a 2065 7863 6570 7469 6f6e  older: exception
+0001a170: 2063 7265 6174 696e 6720 6469 723a 222c   creating dir:",
+0001a180: 2065 7863 290a 2020 2020 2020 2020 2020   exc).          
+0001a190: 2020 2320 4d61 7962 6520 6120 636f 6e63    # Maybe a conc
+0001a1a0: 7572 7265 6e74 2070 726f 6365 7373 2c20  urrent process, 
+0001a1b0: 652e 672e 2074 662e 636f 6d70 6174 2e76  e.g. tf.compat.v
+0001a1c0: 312e 7375 6d6d 6172 792e 4669 6c65 5772  1.summary.FileWr
+0001a1d0: 6974 6572 2063 7265 6174 6564 2069 7420  iter created it 
+0001a1e0: 696e 2074 6865 206d 6561 6e2d 7768 696c  in the mean-whil
+0001a1f0: 652c 0a20 2020 2020 2020 2020 2020 2023  e,.            #
+0001a200: 2073 6f20 7468 656e 2069 7420 776f 756c   so then it woul
+0001a210: 6420 6265 206f 6b20 6e6f 7720 6966 2069  d be ok now if i
+0001a220: 7420 6578 6973 7473 2c20 6275 7420 6661  t exists, but fa
+0001a230: 696c 2069 6620 6974 2064 6f65 7320 6e6f  il if it does no
+0001a240: 7420 6578 6973 742e 0a20 2020 2020 2020  t exist..       
+0001a250: 2020 2020 2061 7373 6572 7420 6f73 2e70       assert os.p
+0001a260: 6174 682e 6578 6973 7473 2864 6972 6e61  ath.exists(dirna
+0001a270: 6d65 290a 0a0a 6465 6620 6c6f 675f 7275  me)...def log_ru
+0001a280: 6e74 696d 655f 696e 666f 5f74 6f5f 6469  ntime_info_to_di
+0001a290: 7228 7061 7468 2c20 636f 6e66 6967 293a  r(path, config):
+0001a2a0: 0a20 2020 2022 2222 0a20 2020 2054 6869  .    """.    Thi
+0001a2b0: 7320 7769 6c6c 2077 7269 7465 206d 756c  s will write mul
+0001a2c0: 7469 706c 6520 6c6f 6767 696e 6720 696e  tiple logging in
+0001a2d0: 666f 726d 6174 696f 6e20 696e 746f 2074  formation into t
+0001a2e0: 6865 2070 6174 682e 0a20 2020 2049 7420  he path..    It 
+0001a2f0: 7769 6c6c 2063 7265 6174 6520 7265 7475  will create retu
+0001a300: 726e 6e2e 2a2e 6c6f 6720 7769 7468 2073  rnn.*.log with s
+0001a310: 6f6d 6520 6d65 7461 2069 6e66 6f72 6d61  ome meta informa
+0001a320: 7469 6f6e 2c0a 2020 2020 6173 2077 656c  tion,.    as wel
+0001a330: 6c20 6173 2063 6f70 7920 7468 6520 7573  l as copy the us
+0001a340: 6564 2063 6f6e 6669 6720 6669 6c65 2e0a  ed config file..
+0001a350: 0a20 2020 203a 7061 7261 6d20 7374 7220  .    :param str 
+0001a360: 7061 7468 3a20 6469 7265 6374 6f72 7920  path: directory 
+0001a370: 7061 7468 0a20 2020 203a 7061 7261 6d20  path.    :param 
+0001a380: 7265 7475 726e 6e2e 636f 6e66 6967 2e43  returnn.config.C
+0001a390: 6f6e 6669 6720 636f 6e66 6967 3a0a 2020  onfig config:.  
+0001a3a0: 2020 2222 220a 2020 2020 696d 706f 7274    """.    import
+0001a3b0: 206f 730a 2020 2020 696d 706f 7274 2073   os.    import s
+0001a3c0: 7973 0a20 2020 2069 6d70 6f72 7420 7368  ys.    import sh
+0001a3d0: 7574 696c 0a20 2020 2066 726f 6d20 7265  util.    from re
+0001a3e0: 7475 726e 6e2e 636f 6e66 6967 2069 6d70  turnn.config imp
+0001a3f0: 6f72 7420 436f 6e66 6967 0a0a 2020 2020  ort Config..    
+0001a400: 7472 793a 0a20 2020 2020 2020 2068 6f73  try:.        hos
+0001a410: 746e 616d 6520 3d20 6765 745f 686f 7374  tname = get_host
+0001a420: 6e61 6d65 2829 0a20 2020 2020 2020 2063  name().        c
+0001a430: 6f6e 7465 6e74 203d 205b 0a20 2020 2020  ontent = [.     
+0001a440: 2020 2020 2020 2022 5469 6d65 3a20 2573         "Time: %s
+0001a450: 2220 2520 7469 6d65 2e73 7472 6674 696d  " % time.strftim
+0001a460: 6528 2225 592d 256d 2d25 6420 2548 3a25  e("%Y-%m-%d %H:%
+0001a470: 4d3a 2553 222c 2074 696d 652e 676d 7469  M:%S", time.gmti
+0001a480: 6d65 2873 7461 7274 5f74 696d 6529 292c  me(start_time)),
+0001a490: 0a20 2020 2020 2020 2020 2020 2022 4361  .            "Ca
+0001a4a0: 6c6c 3a20 2573 2220 2520 2873 7973 2e61  ll: %s" % (sys.a
+0001a4b0: 7267 762c 292c 0a20 2020 2020 2020 2020  rgv,),.         
+0001a4c0: 2020 2022 5061 7468 3a20 2573 2220 2520     "Path: %s" % 
+0001a4d0: 286f 732e 6765 7463 7764 2829 2c29 2c0a  (os.getcwd(),),.
+0001a4e0: 2020 2020 2020 2020 2020 2020 2248 6f73              "Hos
+0001a4f0: 746e 616d 653a 2025 7322 2025 2067 6574  tname: %s" % get
+0001a500: 5f68 6f73 746e 616d 6528 292c 0a20 2020  _hostname(),.   
+0001a510: 2020 2020 2020 2020 2022 5049 443a 2025           "PID: %
+0001a520: 6922 2025 206f 732e 6765 7470 6964 2829  i" % os.getpid()
+0001a530: 2c0a 2020 2020 2020 2020 2020 2020 2252  ,.            "R
+0001a540: 6574 7572 6e6e 3a20 2573 2220 2520 2864  eturnn: %s" % (d
+0001a550: 6573 6372 6962 655f 7265 7475 726e 6e5f  escribe_returnn_
+0001a560: 7665 7273 696f 6e28 292c 292c 0a20 2020  version(),),.   
+0001a570: 2020 2020 2020 2020 2022 5465 6e73 6f72           "Tensor
+0001a580: 466c 6f77 3a20 2573 2220 2520 2864 6573  Flow: %s" % (des
+0001a590: 6372 6962 655f 7465 6e73 6f72 666c 6f77  cribe_tensorflow
+0001a5a0: 5f76 6572 7369 6f6e 2829 2c29 2c0a 2020  _version(),),.  
+0001a5b0: 2020 2020 2020 2020 2020 2243 6f6e 6669            "Confi
+0001a5c0: 6720 6669 6c65 733a 2025 7322 2025 2028  g files: %s" % (
+0001a5d0: 636f 6e66 6967 2e66 696c 6573 2c29 2c0a  config.files,),.
+0001a5e0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+0001a5f0: 2020 6d61 7962 655f 6d61 6b65 5f64 6972    maybe_make_dir
+0001a600: 7328 7061 7468 290a 2020 2020 2020 2020  s(path).        
+0001a610: 6c6f 675f 666e 203d 2022 2573 2f72 6574  log_fn = "%s/ret
+0001a620: 7572 6e6e 2e25 732e 2573 2e25 692e 6c6f  urnn.%s.%s.%i.lo
+0001a630: 6722 2025 2028 7061 7468 2c20 6765 745f  g" % (path, get_
+0001a640: 7574 635f 7374 6172 745f 7469 6d65 5f66  utc_start_time_f
+0001a650: 696c 656e 616d 655f 7061 7274 2829 2c20  ilename_part(), 
+0001a660: 686f 7374 6e61 6d65 2c20 6f73 2e67 6574  hostname, os.get
+0001a670: 7069 6428 2929 0a20 2020 2020 2020 2069  pid()).        i
+0001a680: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
+0001a690: 6973 7473 286c 6f67 5f66 6e29 3a0a 2020  ists(log_fn):.  
+0001a6a0: 2020 2020 2020 2020 2020 7769 7468 206f            with o
+0001a6b0: 7065 6e28 6c6f 675f 666e 2c20 2277 2229  pen(log_fn, "w")
+0001a6c0: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
+0001a6d0: 2020 2020 2020 2066 2e77 7269 7465 2822         f.write("
+0001a6e0: 5265 7475 726e 6e20 6c6f 6720 6669 6c65  Returnn log file
+0001a6f0: 3a5c 6e22 202b 2022 222e 6a6f 696e 285b  :\n" + "".join([
+0001a700: 2225 735c 6e22 2025 2073 2066 6f72 2073  "%s\n" % s for s
+0001a710: 2069 6e20 636f 6e74 656e 745d 2920 2b20   in content]) + 
+0001a720: 225c 6e22 290a 2020 2020 2020 2020 666f  "\n").        fo
+0001a730: 7220 666e 2069 6e20 636f 6e66 6967 2e66  r fn in config.f
+0001a740: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
+0001a750: 2020 6261 7365 5f66 6e20 3d20 6f73 2e70    base_fn = os.p
+0001a760: 6174 682e 6261 7365 6e61 6d65 2866 6e29  ath.basename(fn)
+0001a770: 0a20 2020 2020 2020 2020 2020 2074 6172  .            tar
+0001a780: 6765 745f 666e 203d 2022 2573 2f25 7322  get_fn = "%s/%s"
+0001a790: 2025 2028 7061 7468 2c20 6261 7365 5f66   % (path, base_f
+0001a7a0: 6e29 0a20 2020 2020 2020 2020 2020 2069  n).            i
+0001a7b0: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+0001a7c0: 2874 6172 6765 745f 666e 293a 0a20 2020  (target_fn):.   
+0001a7d0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001a7e0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+0001a7f0: 2020 7368 7574 696c 2e63 6f70 7928 666e    shutil.copy(fn
+0001a800: 2c20 7461 7267 6574 5f66 6e29 0a20 2020  , target_fn).   
+0001a810: 2020 2020 2020 2020 2063 6f6e 6669 675f           config_
+0001a820: 7479 7065 203d 2043 6f6e 6669 672e 6765  type = Config.ge
+0001a830: 745f 636f 6e66 6967 5f66 696c 655f 7479  t_config_file_ty
+0001a840: 7065 2866 6e29 0a20 2020 2020 2020 2020  pe(fn).         
+0001a850: 2020 2063 6f6d 6d65 6e74 5f70 7265 6669     comment_prefi
+0001a860: 7820 3d20 2223 220a 2020 2020 2020 2020  x = "#".        
+0001a870: 2020 2020 6966 2063 6f6e 6669 675f 7479      if config_ty
+0001a880: 7065 203d 3d20 226a 7322 3a0a 2020 2020  pe == "js":.    
+0001a890: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
+0001a8a0: 656e 745f 7072 6566 6978 203d 2022 2f2f  ent_prefix = "//
+0001a8b0: 220a 2020 2020 2020 2020 2020 2020 7769  ".            wi
+0001a8c0: 7468 206f 7065 6e28 7461 7267 6574 5f66  th open(target_f
+0001a8d0: 6e2c 2022 6122 2920 6173 2066 3a0a 2020  n, "a") as f:.  
+0001a8e0: 2020 2020 2020 2020 2020 2020 2020 662e                f.
+0001a8f0: 7772 6974 6528 0a20 2020 2020 2020 2020  write(.         
+0001a900: 2020 2020 2020 2020 2020 2022 5c6e 5c6e             "\n\n
+0001a910: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
+0001a920: 2020 2020 2020 2020 2b20 2222 2e6a 6f69          + "".joi
+0001a930: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+0001a940: 2020 2020 2020 2020 2020 205b 2225 7320             ["%s 
+0001a950: 436f 6e66 6967 2d66 696c 6520 636f 7069  Config-file copi
+0001a960: 6564 2066 6f72 206c 6f67 6769 6e67 2070  ed for logging p
+0001a970: 7572 706f 7365 2062 7920 5265 7475 726e  urpose by Return
+0001a980: 6e2e 5c6e 2220 2520 636f 6d6d 656e 745f  n.\n" % comment_
+0001a990: 7072 6566 6978 5d0a 2020 2020 2020 2020  prefix].        
+0001a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9b0: 2b20 5b22 2573 2025 735c 6e22 2025 2028  + ["%s %s\n" % (
+0001a9c0: 636f 6d6d 656e 745f 7072 6566 6978 2c20  comment_prefix, 
+0001a9d0: 7329 2066 6f72 2073 2069 6e20 636f 6e74  s) for s in cont
+0001a9e0: 656e 745d 0a20 2020 2020 2020 2020 2020  ent].           
+0001a9f0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001aa00: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001aa10: 2022 5c6e 220a 2020 2020 2020 2020 2020   "\n".          
+0001aa20: 2020 2020 2020 290a 2020 2020 6578 6365        ).    exce
+0001aa30: 7074 204f 5345 7272 6f72 2061 7320 6578  pt OSError as ex
+0001aa40: 633a 0a20 2020 2020 2020 2069 6620 2244  c:.        if "D
+0001aa50: 6973 6b20 7175 6f74 6122 2069 6e20 7374  isk quota" in st
+0001aa60: 7228 6578 6329 3a0a 2020 2020 2020 2020  r(exc):.        
+0001aa70: 2020 2020 7072 696e 7428 226c 6f67 5f72      print("log_r
+0001aa80: 756e 7469 6d65 5f69 6e66 6f5f 746f 5f64  untime_info_to_d
+0001aa90: 6972 3a20 4572 726f 722c 2063 616e 6e6f  ir: Error, canno
+0001aaa0: 7420 7772 6974 653a 2025 7322 2025 2065  t write: %s" % e
+0001aab0: 7863 290a 2020 2020 2020 2020 656c 7365  xc).        else
+0001aac0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001aad0: 6973 650a 0a0a 6465 6620 7368 6f75 6c64  ise...def should
+0001aae0: 5f77 7269 7465 5f74 6f5f 6469 736b 2863  _write_to_disk(c
+0001aaf0: 6f6e 6669 6729 3a0a 2020 2020 2222 220a  onfig):.    """.
+0001ab00: 2020 2020 3a70 6172 616d 2072 6574 7572      :param retur
+0001ab10: 6e6e 2e63 6f6e 6669 672e 436f 6e66 6967  nn.config.Config
+0001ab20: 2063 6f6e 6669 673a 0a20 2020 203a 7274   config:.    :rt
+0001ab30: 7970 653a 2062 6f6f 6c0a 2020 2020 2222  ype: bool.    ""
+0001ab40: 220a 2020 2020 6966 2063 6f6e 6669 672e  ".    if config.
+0001ab50: 6973 5f74 7275 6528 2275 7365 5f68 6f72  is_true("use_hor
+0001ab60: 6f76 6f64 2229 3a0a 2020 2020 2020 2020  ovod"):.        
+0001ab70: 2320 6e6f 696e 7370 6563 7469 6f6e 2050  # noinspection P
+0001ab80: 7950 6163 6b61 6765 5265 7175 6972 656d  yPackageRequirem
+0001ab90: 656e 7473 2c50 7955 6e72 6573 6f6c 7665  ents,PyUnresolve
+0001aba0: 6452 6566 6572 656e 6365 730a 2020 2020  dReferences.    
+0001abb0: 2020 2020 696d 706f 7274 2068 6f72 6f76      import horov
+0001abc0: 6f64 2e74 656e 736f 7266 6c6f 7720 6173  od.tensorflow as
+0001abd0: 2068 7664 0a0a 2020 2020 2020 2020 6966   hvd..        if
+0001abe0: 2068 7664 2e72 616e 6b28 2920 213d 2030   hvd.rank() != 0
+0001abf0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001ac00: 7475 726e 2046 616c 7365 0a20 2020 2069  turn False.    i
+0001ac10: 6620 636f 6e66 6967 2e69 735f 7472 7565  f config.is_true
+0001ac20: 2822 6472 795f 7275 6e22 293a 0a20 2020  ("dry_run"):.   
+0001ac30: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+0001ac40: 650a 2020 2020 7265 7475 726e 2054 7275  e.    return Tru
+0001ac50: 650a 0a0a 636c 6173 7320 4e61 7469 7665  e...class Native
+0001ac60: 436f 6465 436f 6d70 696c 6572 286f 626a  CodeCompiler(obj
+0001ac70: 6563 7429 3a0a 2020 2020 2222 220a 2020  ect):.    """.  
+0001ac80: 2020 4865 6c70 6572 2063 6c61 7373 2074    Helper class t
+0001ac90: 6f20 636f 6d70 696c 6520 6e61 7469 7665  o compile native
+0001aca0: 2043 2f43 2b2b 2063 6f64 6520 6f6e 2d74   C/C++ code on-t
+0001acb0: 6865 2d66 6c79 2e0a 2020 2020 2222 220a  he-fly..    """.
+0001acc0: 0a20 2020 2043 6163 6865 4469 724e 616d  .    CacheDirNam
+0001acd0: 6520 3d20 2272 6574 7572 6e6e 5f6e 6174  e = "returnn_nat
+0001ace0: 6976 6522 0a20 2020 2043 6f6c 6c65 6374  ive".    Collect
+0001acf0: 6564 436f 6d70 696c 6572 7320 3d20 4e6f  edCompilers = No
+0001ad00: 6e65 2020 2320 7479 7065 3a20 7479 7069  ne  # type: typi
+0001ad10: 6e67 2e4f 7074 696f 6e61 6c5b 7479 7069  ng.Optional[typi
+0001ad20: 6e67 2e4c 6973 745b 4e61 7469 7665 436f  ng.List[NativeCo
+0001ad30: 6465 436f 6d70 696c 6572 5d5d 0a0a 2020  deCompiler]]..  
+0001ad40: 2020 6465 6620 5f5f 696e 6974 5f5f 280a    def __init__(.
+0001ad50: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0001ad60: 2020 2020 2020 6261 7365 5f6e 616d 652c        base_name,
+0001ad70: 0a20 2020 2020 2020 2063 6f64 655f 7665  .        code_ve
+0001ad80: 7273 696f 6e2c 0a20 2020 2020 2020 2063  rsion,.        c
+0001ad90: 6f64 652c 0a20 2020 2020 2020 2069 735f  ode,.        is_
+0001ada0: 6370 703d 5472 7565 2c0a 2020 2020 2020  cpp=True,.      
+0001adb0: 2020 635f 6d61 6372 6f5f 6465 6669 6e65    c_macro_define
+0001adc0: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+0001add0: 6c64 5f66 6c61 6773 3d4e 6f6e 652c 0a20  ld_flags=None,. 
+0001ade0: 2020 2020 2020 2069 6e63 6c75 6465 5f70         include_p
+0001adf0: 6174 6873 3d28 292c 0a20 2020 2020 2020  aths=(),.       
+0001ae00: 2069 6e63 6c75 6465 5f64 6570 733d 4e6f   include_deps=No
+0001ae10: 6e65 2c0a 2020 2020 2020 2020 7374 6174  ne,.        stat
+0001ae20: 6963 5f76 6572 7369 6f6e 5f6e 616d 653d  ic_version_name=
+0001ae30: 4e6f 6e65 2c0a 2020 2020 2020 2020 7368  None,.        sh
+0001ae40: 6f75 6c64 5f63 6c65 616e 7570 5f6f 6c64  ould_cleanup_old
+0001ae50: 5f61 6c6c 3d54 7275 652c 0a20 2020 2020  _all=True,.     
+0001ae60: 2020 2073 686f 756c 645f 636c 6561 6e75     should_cleanu
+0001ae70: 705f 6f6c 645f 6d79 6469 723d 4661 6c73  p_old_mydir=Fals
+0001ae80: 652c 0a20 2020 2020 2020 2075 7365 5f63  e,.        use_c
+0001ae90: 7878 3131 5f61 6269 3d46 616c 7365 2c0a  xx11_abi=False,.
+0001aea0: 2020 2020 2020 2020 6c6f 675f 7374 7265          log_stre
+0001aeb0: 616d 3d4e 6f6e 652c 0a20 2020 2020 2020  am=None,.       
+0001aec0: 2076 6572 626f 7365 3d46 616c 7365 2c0a   verbose=False,.
+0001aed0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+0001aee0: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
+0001aef0: 6d20 7374 7220 6261 7365 5f6e 616d 653a  m str base_name:
+0001af00: 2062 6173 6520 6e61 6d65 2066 6f72 2074   base name for t
+0001af10: 6865 206d 6f64 756c 652c 2065 2e67 2e20  he module, e.g. 
+0001af20: 227a 6572 6f5f 6f75 7422 0a20 2020 2020  "zero_out".     
+0001af30: 2020 203a 7061 7261 6d20 696e 747c 7475     :param int|tu
+0001af40: 706c 655b 696e 745d 2063 6f64 655f 7665  ple[int] code_ve
+0001af50: 7273 696f 6e3a 2063 6865 636b 2066 6f72  rsion: check for
+0001af60: 2074 6865 2063 6163 6865 2077 6865 7468   the cache wheth
+0001af70: 6572 2074 6f20 7265 7573 650a 2020 2020  er to reuse.    
+0001af80: 2020 2020 3a70 6172 616d 2073 7472 2063      :param str c
+0001af90: 6f64 653a 2074 6865 2073 6f75 7263 6520  ode: the source 
+0001afa0: 636f 6465 2069 7473 656c 660a 2020 2020  code itself.    
+0001afb0: 2020 2020 3a70 6172 616d 2062 6f6f 6c20      :param bool 
+0001afc0: 6973 5f63 7070 3a20 6966 2046 616c 7365  is_cpp: if False
+0001afd0: 2c20 4320 6973 2061 7373 756d 6564 0a20  , C is assumed. 
+0001afe0: 2020 2020 2020 203a 7061 7261 6d20 6469         :param di
+0001aff0: 6374 5b73 7472 2c73 7472 7c69 6e74 7c4e  ct[str,str|int|N
+0001b000: 6f6e 655d 7c4e 6f6e 6520 635f 6d61 6372  one]|None c_macr
+0001b010: 6f5f 6465 6669 6e65 733a 2065 2e67 2e20  o_defines: e.g. 
+0001b020: 7b22 5445 4e53 4f52 464c 4f57 223a 2031  {"TENSORFLOW": 1
+0001b030: 7d0a 2020 2020 2020 2020 3a70 6172 616d  }.        :param
+0001b040: 206c 6973 745b 7374 725d 7c4e 6f6e 6520   list[str]|None 
+0001b050: 6c64 5f66 6c61 6773 3a20 652e 672e 205b  ld_flags: e.g. [
+0001b060: 222d 6c62 6c61 7322 5d0a 2020 2020 2020  "-lblas"].      
+0001b070: 2020 3a70 6172 616d 206c 6973 745b 7374    :param list[st
+0001b080: 725d 7c74 7570 6c65 5b73 7472 5d20 696e  r]|tuple[str] in
+0001b090: 636c 7564 655f 7061 7468 733a 0a20 2020  clude_paths:.   
+0001b0a0: 2020 2020 203a 7061 7261 6d20 6c69 7374       :param list
+0001b0b0: 5b73 7472 5d7c 4e6f 6e65 2069 6e63 6c75  [str]|None inclu
+0001b0c0: 6465 5f64 6570 733a 2069 6620 7072 6f76  de_deps: if prov
+0001b0d0: 6964 6564 2061 6e64 2061 6e20 6578 6973  ided and an exis
+0001b0e0: 7469 6e67 206c 6962 2066 696c 652c 0a20  ting lib file,. 
+0001b0f0: 2020 2020 2020 2020 2020 2077 6520 7769             we wi
+0001b100: 6c6c 2063 6865 636b 2069 6620 616e 7920  ll check if any 
+0001b110: 6465 7065 6e64 656e 6379 2069 7320 6e65  dependency is ne
+0001b120: 7765 720a 2020 2020 2020 2020 2020 2020  wer.            
+0001b130: 616e 6420 7765 206e 6565 6420 746f 2072  and we need to r
+0001b140: 6563 6f6d 7069 6c65 2e20 7765 2063 6f75  ecompile. we cou
+0001b150: 6c64 2061 6c73 6f20 646f 2069 7420 6175  ld also do it au
+0001b160: 746f 6d61 7469 6361 6c6c 7920 7669 6120  tomatically via 
+0001b170: 2d4d 4420 6275 7420 7468 6174 2073 6565  -MD but that see
+0001b180: 6d73 206f 7665 726b 696c 6c20 616e 6420  ms overkill and 
+0001b190: 746f 6f20 736c 6f77 2e0a 2020 2020 2020  too slow..      
+0001b1a0: 2020 3a70 6172 616d 2073 7472 7c4e 6f6e    :param str|Non
+0001b1b0: 6520 7374 6174 6963 5f76 6572 7369 6f6e  e static_version
+0001b1c0: 5f6e 616d 653a 206e 6f72 6d61 6c6c 792c  _name: normally,
+0001b1d0: 2077 6520 7573 6520 2e2e 2e2f 6261 7365   we use .../base
+0001b1e0: 5f6e 616d 652f 6861 7368 2061 7320 7468  _name/hash as th
+0001b1f0: 6520 6469 720a 2020 2020 2020 2020 2020  e dir.          
+0001b200: 2020 6275 7420 7468 6973 2077 6f75 6c64    but this would
+0001b210: 2075 7365 202e 2e2e 2f62 6173 655f 6e61   use .../base_na
+0001b220: 6d65 2f73 7461 7469 635f 7665 7273 696f  me/static_versio
+0001b230: 6e5f 6e61 6d65 2e0a 2020 2020 2020 2020  n_name..        
+0001b240: 3a70 6172 616d 2062 6f6f 6c20 7368 6f75  :param bool shou
+0001b250: 6c64 5f63 6c65 616e 7570 5f6f 6c64 5f61  ld_cleanup_old_a
+0001b260: 6c6c 3a20 7768 6574 6865 7220 7765 2073  ll: whether we s
+0001b270: 686f 756c 6420 6c6f 6f6b 2069 6e20 7468  hould look in th
+0001b280: 6520 6361 6368 6520 6469 720a 2020 2020  e cache dir.    
+0001b290: 2020 2020 2020 2020 616e 6420 6368 6563          and chec
+0001b2a0: 6b20 616c 6c20 6f70 7320 6966 2077 6520  k all ops if we 
+0001b2b0: 6361 6e20 6465 6c65 7465 2073 6f6d 6520  can delete some 
+0001b2c0: 6f6c 6420 6f6e 6573 2077 6869 6368 2061  old ones which a
+0001b2d0: 7265 206f 6c64 6572 2074 6861 6e20 736f  re older than so
+0001b2e0: 6d65 206c 696d 6974 0a20 2020 2020 2020  me limit.       
+0001b2f0: 2020 2020 2028 7365 6c66 2e5f 636c 6561       (self._clea
+0001b300: 6e75 705f 7469 6d65 5f6c 696d 6974 5f64  nup_time_limit_d
+0001b310: 6179 7329 0a20 2020 2020 2020 203a 7061  ays).        :pa
+0001b320: 7261 6d20 626f 6f6c 2073 686f 756c 645f  ram bool should_
+0001b330: 636c 6561 6e75 705f 6f6c 645f 6d79 6469  cleanup_old_mydi
+0001b340: 723a 2077 6865 7468 6572 2077 6520 7368  r: whether we sh
+0001b350: 6f75 6c64 2064 656c 6574 6520 6f75 7220  ould delete our 
+0001b360: 6f70 2064 6972 2062 6566 6f72 6520 7765  op dir before we
+0001b370: 2063 6f6d 7069 6c65 2074 6865 7265 2e0a   compile there..
+0001b380: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
+0001b390: 7970 696e 672e 5465 7874 494f 7c4e 6f6e  yping.TextIO|Non
+0001b3a0: 6520 6c6f 675f 7374 7265 616d 3a20 6669  e log_stream: fi
+0001b3b0: 6c65 2073 7472 6561 6d20 666f 7220 7072  le stream for pr
+0001b3c0: 696e 7420 7374 6174 656d 656e 7473 0a20  int statements. 
+0001b3d0: 2020 2020 2020 203a 7061 7261 6d20 626f         :param bo
+0001b3e0: 6f6c 2076 6572 626f 7365 3a20 6265 2073  ol verbose: be s
+0001b3f0: 6c69 6768 746c 7920 6d6f 7265 2076 6572  lightly more ver
+0001b400: 626f 7365 0a20 2020 2020 2020 2022 2222  bose.        """
+0001b410: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001b420: 2e43 6f6c 6c65 6374 6564 436f 6d70 696c  .CollectedCompil
+0001b430: 6572 7320 6973 206e 6f74 204e 6f6e 653a  ers is not None:
+0001b440: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001b450: 662e 436f 6c6c 6563 7465 6443 6f6d 7069  f.CollectedCompi
+0001b460: 6c65 7273 2e61 7070 656e 6428 7365 6c66  lers.append(self
+0001b470: 290a 2020 2020 2020 2020 7365 6c66 2e76  ).        self.v
+0001b480: 6572 626f 7365 203d 2076 6572 626f 7365  erbose = verbose
+0001b490: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
+0001b4a0: 6368 655f 6469 7220 3d20 2225 732f 2573  che_dir = "%s/%s
+0001b4b0: 2220 2520 2867 6574 5f63 6163 6865 5f64  " % (get_cache_d
+0001b4c0: 6972 2829 2c20 7365 6c66 2e43 6163 6865  ir(), self.Cache
+0001b4d0: 4469 724e 616d 6529 0a20 2020 2020 2020  DirName).       
+0001b4e0: 2073 656c 662e 5f69 6e63 6c75 6465 5f70   self._include_p
+0001b4f0: 6174 6873 203d 206c 6973 7428 696e 636c  aths = list(incl
+0001b500: 7564 655f 7061 7468 7329 0a20 2020 2020  ude_paths).     
+0001b510: 2020 2073 656c 662e 6261 7365 5f6e 616d     self.base_nam
+0001b520: 6520 3d20 6261 7365 5f6e 616d 650a 2020  e = base_name.  
+0001b530: 2020 2020 2020 7365 6c66 2e63 6f64 655f        self.code_
+0001b540: 7665 7273 696f 6e20 3d20 636f 6465 5f76  version = code_v
+0001b550: 6572 7369 6f6e 0a20 2020 2020 2020 2073  ersion.        s
+0001b560: 656c 662e 636f 6465 203d 2063 6f64 650a  elf.code = code.
+0001b570: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
+0001b580: 6370 7020 3d20 6973 5f63 7070 0a20 2020  cpp = is_cpp.   
+0001b590: 2020 2020 2073 656c 662e 635f 6d61 6372       self.c_macr
+0001b5a0: 6f5f 6465 6669 6e65 7320 3d20 7b6b 3a20  o_defines = {k: 
+0001b5b0: 7620 666f 7220 6b2c 2076 2069 6e20 2863  v for k, v in (c
+0001b5c0: 5f6d 6163 726f 5f64 6566 696e 6573 206f  _macro_defines o
+0001b5d0: 7220 7b7d 292e 6974 656d 7328 2920 6966  r {}).items() if
+0001b5e0: 2076 2069 7320 6e6f 7420 4e6f 6e65 7d0a   v is not None}.
+0001b5f0: 2020 2020 2020 2020 7365 6c66 2e6c 645f          self.ld_
+0001b600: 666c 6167 7320 3d20 6c64 5f66 6c61 6773  flags = ld_flags
+0001b610: 206f 7220 5b5d 0a20 2020 2020 2020 2073   or [].        s
+0001b620: 656c 662e 696e 636c 7564 655f 6465 7073  elf.include_deps
+0001b630: 203d 2069 6e63 6c75 6465 5f64 6570 730a   = include_deps.
+0001b640: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+0001b650: 7469 635f 7665 7273 696f 6e5f 6e61 6d65  tic_version_name
+0001b660: 203d 2073 7461 7469 635f 7665 7273 696f   = static_versio
+0001b670: 6e5f 6e61 6d65 0a20 2020 2020 2020 2073  n_name.        s
+0001b680: 656c 662e 5f63 6f64 655f 6861 7368 203d  elf._code_hash =
+0001b690: 2073 656c 662e 5f6d 616b 655f 636f 6465   self._make_code
+0001b6a0: 5f68 6173 6828 290a 2020 2020 2020 2020  _hash().        
+0001b6b0: 7365 6c66 2e5f 696e 666f 5f64 6963 7420  self._info_dict 
+0001b6c0: 3d20 7365 6c66 2e5f 6d61 6b65 5f69 6e66  = self._make_inf
+0001b6d0: 6f5f 6469 6374 2829 0a20 2020 2020 2020  o_dict().       
+0001b6e0: 2073 656c 662e 5f68 6173 6820 3d20 7365   self._hash = se
+0001b6f0: 6c66 2e5f 6d61 6b65 5f68 6173 6828 290a  lf._make_hash().
+0001b700: 2020 2020 2020 2020 7365 6c66 2e5f 6374          self._ct
+0001b710: 7970 6573 5f6c 6962 203d 204e 6f6e 650a  ypes_lib = None.
+0001b720: 2020 2020 2020 2020 6966 2073 686f 756c          if shoul
+0001b730: 645f 636c 6561 6e75 705f 6f6c 645f 616c  d_cleanup_old_al
+0001b740: 6c3a 0a20 2020 2020 2020 2020 2020 2073  l:.            s
+0001b750: 656c 662e 5f63 6c65 616e 7570 5f6f 6c64  elf._cleanup_old
+0001b760: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+0001b770: 5f73 686f 756c 645f 636c 6561 6e75 705f  _should_cleanup_
+0001b780: 6f6c 645f 6d79 6469 7220 3d20 7368 6f75  old_mydir = shou
+0001b790: 6c64 5f63 6c65 616e 7570 5f6f 6c64 5f6d  ld_cleanup_old_m
+0001b7a0: 7964 6972 0a20 2020 2020 2020 2073 656c  ydir.        sel
+0001b7b0: 662e 7573 655f 6378 7831 315f 6162 6920  f.use_cxx11_abi 
+0001b7c0: 3d20 7573 655f 6378 7831 315f 6162 690a  = use_cxx11_abi.
+0001b7d0: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
+0001b7e0: 675f 7374 7265 616d 203d 206c 6f67 5f73  g_stream = log_s
+0001b7f0: 7472 6561 6d0a 2020 2020 2020 2020 6966  tream.        if
+0001b800: 2073 656c 662e 7665 7262 6f73 653a 0a20   self.verbose:. 
+0001b810: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0001b820: 2822 2573 3a20 2572 2220 2520 2873 656c  ("%s: %r" % (sel
+0001b830: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
+0001b840: 6d65 5f5f 2c20 7365 6c66 292c 2066 696c  me__, self), fil
+0001b850: 653d 6c6f 675f 7374 7265 616d 290a 0a20  e=log_stream).. 
+0001b860: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+0001b870: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+0001b880: 6574 7572 6e20 223c 2573 2025 7220 696e  eturn "<%s %r in
+0001b890: 2025 723e 2220 2520 2873 656c 662e 5f5f   %r>" % (self.__
+0001b8a0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0001b8b0: 2c20 7365 6c66 2e62 6173 655f 6e61 6d65  , self.base_name
+0001b8c0: 2c20 7365 6c66 2e5f 6d6f 645f 7061 7468  , self._mod_path
+0001b8d0: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+0001b8e0: 0a20 2020 2064 6566 205f 6d6f 645f 7061  .    def _mod_pa
+0001b8f0: 7468 2873 656c 6629 3a0a 2020 2020 2020  th(self):.      
+0001b900: 2020 7265 7475 726e 2022 2573 2f25 732f    return "%s/%s/
+0001b910: 2573 2220 2520 2873 656c 662e 6361 6368  %s" % (self.cach
+0001b920: 655f 6469 722c 2073 656c 662e 6261 7365  e_dir, self.base
+0001b930: 5f6e 616d 652c 2073 656c 662e 7374 6174  _name, self.stat
+0001b940: 6963 5f76 6572 7369 6f6e 5f6e 616d 6520  ic_version_name 
+0001b950: 6f72 2073 656c 662e 5f68 6173 685b 3a31  or self._hash[:1
+0001b960: 305d 290a 0a20 2020 2040 7072 6f70 6572  0])..    @proper
+0001b970: 7479 0a20 2020 2064 6566 205f 696e 666f  ty.    def _info
+0001b980: 5f66 696c 656e 616d 6528 7365 6c66 293a  _filename(self):
+0001b990: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001b9a0: 2225 732f 696e 666f 2e70 7922 2025 2028  "%s/info.py" % (
+0001b9b0: 7365 6c66 2e5f 6d6f 645f 7061 7468 2c29  self._mod_path,)
+0001b9c0: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+0001b9d0: 2020 2020 6465 6620 5f73 6f5f 6669 6c65      def _so_file
+0001b9e0: 6e61 6d65 2873 656c 6629 3a0a 2020 2020  name(self):.    
+0001b9f0: 2020 2020 7265 7475 726e 2022 2573 2f25      return "%s/%
+0001ba00: 732e 736f 2220 2520 2873 656c 662e 5f6d  s.so" % (self._m
+0001ba10: 6f64 5f70 6174 682c 2073 656c 662e 6261  od_path, self.ba
+0001ba20: 7365 5f6e 616d 6529 0a0a 2020 2020 4070  se_name)..    @p
+0001ba30: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0001ba40: 5f63 5f66 696c 656e 616d 6528 7365 6c66  _c_filename(self
+0001ba50: 293a 0a20 2020 2020 2020 2069 6620 7365  ):.        if se
+0001ba60: 6c66 2e69 735f 6370 703a 0a20 2020 2020  lf.is_cpp:.     
+0001ba70: 2020 2020 2020 2072 6574 7572 6e20 2225         return "%
+0001ba80: 732f 2573 2e63 6322 2025 2028 7365 6c66  s/%s.cc" % (self
+0001ba90: 2e5f 6d6f 645f 7061 7468 2c20 7365 6c66  ._mod_path, self
+0001baa0: 2e62 6173 655f 6e61 6d65 290a 2020 2020  .base_name).    
+0001bab0: 2020 2020 7265 7475 726e 2022 2573 2f25      return "%s/%
+0001bac0: 732e 6322 2025 2028 7365 6c66 2e5f 6d6f  s.c" % (self._mo
+0001bad0: 645f 7061 7468 2c20 7365 6c66 2e62 6173  d_path, self.bas
+0001bae0: 655f 6e61 6d65 290a 0a20 2020 205f 636c  e_name)..    _cl
+0001baf0: 6561 6e75 705f 7469 6d65 5f6c 696d 6974  eanup_time_limit
+0001bb00: 5f64 6179 7320 3d20 3630 0a0a 2020 2020  _days = 60..    
+0001bb10: 6465 6620 5f63 6c65 616e 7570 5f6f 6c64  def _cleanup_old
+0001bb20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001bb30: 6d6f 645f 7061 7468 203d 2073 656c 662e  mod_path = self.
+0001bb40: 5f6d 6f64 5f70 6174 6820 2023 202e 2e2e  _mod_path  # ...
+0001bb50: 2f62 6173 655f 6e61 6d65 2f68 6173 680a  /base_name/hash.
+0001bb60: 2020 2020 2020 2020 6261 7365 5f6d 6f64          base_mod
+0001bb70: 5f70 6174 6820 3d20 6f73 2e70 6174 682e  _path = os.path.
+0001bb80: 6469 726e 616d 6528 6d6f 645f 7061 7468  dirname(mod_path
+0001bb90: 2920 2023 202e 2e2e 2f62 6173 655f 6e61  )  # .../base_na
+0001bba0: 6d65 0a20 2020 2020 2020 206d 795f 6d6f  me.        my_mo
+0001bbb0: 645f 7061 7468 5f6e 616d 6520 3d20 6f73  d_path_name = os
+0001bbc0: 2e70 6174 682e 6261 7365 6e61 6d65 286d  .path.basename(m
+0001bbd0: 6f64 5f70 6174 6829 0a20 2020 2020 2020  od_path).       
+0001bbe0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+0001bbf0: 6578 6973 7473 2862 6173 655f 6d6f 645f  exists(base_mod_
+0001bc00: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
+0001bc10: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+0001bc20: 2020 696d 706f 7274 2074 696d 650a 0a20    import time.. 
+0001bc30: 2020 2020 2020 2063 6c65 616e 7570 5f74         cleanup_t
+0001bc40: 696d 655f 6c69 6d69 745f 7365 6373 203d  ime_limit_secs =
+0001bc50: 2073 656c 662e 5f63 6c65 616e 7570 5f74   self._cleanup_t
+0001bc60: 696d 655f 6c69 6d69 745f 6461 7973 202a  ime_limit_days *
+0001bc70: 2032 3420 2a20 3630 202a 2036 300a 2020   24 * 60 * 60.  
+0001bc80: 2020 2020 2020 666f 7220 7020 696e 206f        for p in o
+0001bc90: 732e 6c69 7374 6469 7228 6261 7365 5f6d  s.listdir(base_m
+0001bca0: 6f64 5f70 6174 6829 3a0a 2020 2020 2020  od_path):.      
+0001bcb0: 2020 2020 2020 6966 2070 203d 3d20 6d79        if p == my
+0001bcc0: 5f6d 6f64 5f70 6174 685f 6e61 6d65 3a0a  _mod_path_name:.
+0001bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bce0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001bcf0: 2020 2020 2066 756c 6c5f 6469 725f 7061       full_dir_pa
+0001bd00: 7468 203d 2022 2573 2f25 7322 2025 2028  th = "%s/%s" % (
+0001bd10: 6261 7365 5f6d 6f64 5f70 6174 682c 2070  base_mod_path, p
+0001bd20: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0001bd30: 206e 6f74 206f 732e 7061 7468 2e69 7364   not os.path.isd
+0001bd40: 6972 2866 756c 6c5f 6469 725f 7061 7468  ir(full_dir_path
+0001bd50: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001bd60: 2020 2063 6f6e 7469 6e75 6520 2023 2069     continue  # i
+0001bd70: 676e 6f72 6520 666f 7220 6e6f 770a 2020  gnore for now.  
+0001bd80: 2020 2020 2020 2020 2020 6c6f 636b 203d            lock =
+0001bd90: 204c 6f63 6b46 696c 6528 6675 6c6c 5f64   LockFile(full_d
+0001bda0: 6972 5f70 6174 6829 0a20 2020 2020 2020  ir_path).       
+0001bdb0: 2020 2020 2069 6620 6c6f 636b 2e69 735f       if lock.is_
+0001bdc0: 6c6f 636b 6564 2829 3a0a 2020 2020 2020  locked():.      
+0001bdd0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0001bde0: 7565 0a20 2020 2020 2020 2020 2020 206c  ue.            l
+0001bdf0: 6f63 6b2e 6d61 7962 655f 7265 6d6f 7665  ock.maybe_remove
+0001be00: 5f6f 6c64 5f6c 6f63 6b66 696c 6528 290a  _old_lockfile().
+0001be10: 2020 2020 2020 2020 2020 2020 696e 666f              info
+0001be20: 5f70 6174 6820 3d20 2225 732f 696e 666f  _path = "%s/info
+0001be30: 2e70 7922 2025 2066 756c 6c5f 6469 725f  .py" % full_dir_
+0001be40: 7061 7468 0a20 2020 2020 2020 2020 2020  path.           
+0001be50: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+0001be60: 6578 6973 7473 2869 6e66 6f5f 7061 7468  exists(info_path
+0001be70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001be80: 2020 2073 656c 662e 5f63 6c65 616e 7570     self._cleanup
+0001be90: 5f6f 6c64 5f70 6174 6828 6675 6c6c 5f64  _old_path(full_d
+0001bea0: 6972 5f70 6174 682c 2072 6561 736f 6e3d  ir_path, reason=
+0001beb0: 2263 6f72 7275 7074 2064 6972 2c20 6d69  "corrupt dir, mi
+0001bec0: 7373 696e 6720 696e 666f 2e70 7922 290a  ssing info.py").
+0001bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bee0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001bef0: 2020 2020 2073 6f5f 7061 7468 203d 2022       so_path = "
+0001bf00: 2573 2f25 732e 736f 2220 2520 2866 756c  %s/%s.so" % (ful
+0001bf10: 6c5f 6469 725f 7061 7468 2c20 7365 6c66  l_dir_path, self
+0001bf20: 2e62 6173 655f 6e61 6d65 290a 2020 2020  .base_name).    
+0001bf30: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+0001bf40: 732e 7061 7468 2e65 7869 7374 7328 736f  s.path.exists(so
+0001bf50: 5f70 6174 6829 3a0a 2020 2020 2020 2020  _path):.        
+0001bf60: 2020 2020 2020 2020 7365 6c66 2e5f 636c          self._cl
+0001bf70: 6561 6e75 705f 6f6c 645f 7061 7468 2866  eanup_old_path(f
+0001bf80: 756c 6c5f 6469 725f 7061 7468 2c20 7265  ull_dir_path, re
+0001bf90: 6173 6f6e 3d22 636f 7272 7570 7420 6469  ason="corrupt di
+0001bfa0: 722c 206d 6973 7369 6e67 2073 6f22 290a  r, missing so").
+0001bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bfc0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001bfd0: 2020 2020 2064 7420 3d20 7469 6d65 2e74       dt = time.t
+0001bfe0: 696d 6528 2920 2d20 6f73 2e70 6174 682e  ime() - os.path.
+0001bff0: 6765 746d 7469 6d65 2873 6f5f 7061 7468  getmtime(so_path
+0001c000: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0001c010: 2064 7420 3e20 636c 6561 6e75 705f 7469   dt > cleanup_ti
+0001c020: 6d65 5f6c 696d 6974 5f73 6563 733a 0a20  me_limit_secs:. 
+0001c030: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001c040: 656c 662e 5f63 6c65 616e 7570 5f6f 6c64  elf._cleanup_old
+0001c050: 5f70 6174 6828 6675 6c6c 5f64 6972 5f70  _path(full_dir_p
+0001c060: 6174 682c 2072 6561 736f 6e3d 2225 7320  ath, reason="%s 
+0001c070: 6f6c 6422 2025 2068 6d73 2864 7429 290a  old" % hms(dt)).
+0001c080: 0a20 2020 2064 6566 205f 636c 6561 6e75  .    def _cleanu
+0001c090: 705f 6f6c 645f 7061 7468 2873 656c 662c  p_old_path(self,
+0001c0a0: 2070 2c20 7265 6173 6f6e 293a 0a20 2020   p, reason):.   
+0001c0b0: 2020 2020 2070 7269 6e74 2822 2573 2064       print("%s d
+0001c0c0: 656c 6574 6520 6f6c 642c 2025 733a 2025  elete old, %s: %
+0001c0d0: 7322 2025 2028 7365 6c66 2e5f 5f63 6c61  s" % (self.__cla
+0001c0e0: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 2072  ss__.__name__, r
+0001c0f0: 6561 736f 6e2c 2070 2929 0a20 2020 2020  eason, p)).     
+0001c100: 2020 2061 7373 6572 7420 6f73 2e70 6174     assert os.pat
+0001c110: 682e 6578 6973 7473 2870 290a 2020 2020  h.exists(p).    
+0001c120: 2020 2020 696d 706f 7274 2073 6875 7469      import shuti
+0001c130: 6c0a 0a20 2020 2020 2020 2074 7279 3a0a  l..        try:.
+0001c140: 2020 2020 2020 2020 2020 2020 7368 7574              shut
+0001c150: 696c 2e72 6d74 7265 6528 7029 0a20 2020  il.rmtree(p).   
+0001c160: 2020 2020 2065 7863 6570 7420 4f53 4572       except OSEr
+0001c170: 726f 7220 6173 2065 7863 3a0a 2020 2020  ror as exc:.    
+0001c180: 2020 2020 2020 2020 7072 696e 7428 2225          print("%
+0001c190: 7320 6465 6c65 7465 2065 7863 6570 7469  s delete excepti
+0001c1a0: 6f6e 2028 2573 292e 2057 696c 6c20 6967  on (%s). Will ig
+0001c1b0: 6e6f 7265 2061 6e64 2074 7279 2074 6f20  nore and try to 
+0001c1c0: 636f 6e74 696e 7565 2061 6e79 7761 792e  continue anyway.
+0001c1d0: 2220 2520 2873 656c 662e 5f5f 636c 6173  " % (self.__clas
+0001c1e0: 735f 5f2e 5f5f 6e61 6d65 5f5f 2c20 6578  s__.__name__, ex
+0001c1f0: 6329 290a 0a20 2020 2064 6566 205f 6c6f  c))..    def _lo
+0001c200: 6164 5f69 6e66 6f28 7365 6c66 293a 0a20  ad_info(self):. 
+0001c210: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001c220: 2020 203a 7274 7970 653a 2064 6963 745b     :rtype: dict[
+0001c230: 7374 725d 7c4e 6f6e 650a 2020 2020 2020  str]|None.      
+0001c240: 2020 2222 220a 2020 2020 2020 2020 6669    """.        fi
+0001c250: 6c65 6e61 6d65 203d 2073 656c 662e 5f69  lename = self._i
+0001c260: 6e66 6f5f 6669 6c65 6e61 6d65 0a20 2020  nfo_filename.   
+0001c270: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+0001c280: 6174 682e 6578 6973 7473 2866 696c 656e  ath.exists(filen
+0001c290: 616d 6529 3a0a 2020 2020 2020 2020 2020  ame):.          
+0001c2a0: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
+0001c2b0: 2020 2020 2020 7320 3d20 6f70 656e 2866        s = open(f
+0001c2c0: 696c 656e 616d 6529 2e72 6561 6428 290a  ilename).read().
+0001c2d0: 2020 2020 2020 2020 7265 7320 3d20 6576          res = ev
+0001c2e0: 616c 2873 290a 2020 2020 2020 2020 6173  al(s).        as
+0001c2f0: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
+0001c300: 7265 732c 2064 6963 7429 0a20 2020 2020  res, dict).     
+0001c310: 2020 2072 6574 7572 6e20 7265 730a 0a20     return res.. 
+0001c320: 2020 205f 7265 6c65 7661 6e74 5f69 6e66     _relevant_inf
+0001c330: 6f5f 6b65 7973 203d 2028 2263 6f64 655f  o_keys = ("code_
+0001c340: 7665 7273 696f 6e22 2c20 2263 6f64 655f  version", "code_
+0001c350: 6861 7368 222c 2022 635f 6d61 6372 6f5f  hash", "c_macro_
+0001c360: 6465 6669 6e65 7322 2c20 226c 645f 666c  defines", "ld_fl
+0001c370: 6167 7322 2c20 2263 6f6d 7069 6c65 725f  ags", "compiler_
+0001c380: 6269 6e22 290a 0a20 2020 2064 6566 205f  bin")..    def _
+0001c390: 6d61 6b65 5f69 6e66 6f5f 6469 6374 2873  make_info_dict(s
+0001c3a0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0001c3b0: 220a 2020 2020 2020 2020 3a72 7479 7065  ".        :rtype
+0001c3c0: 3a20 6469 6374 5b73 7472 5d0a 2020 2020  : dict[str].    
+0001c3d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001c3e0: 7265 7475 726e 207b 0a20 2020 2020 2020  return {.       
+0001c3f0: 2020 2020 2022 6261 7365 5f6e 616d 6522       "base_name"
+0001c400: 3a20 7365 6c66 2e62 6173 655f 6e61 6d65  : self.base_name
+0001c410: 2c0a 2020 2020 2020 2020 2020 2020 2269  ,.            "i
+0001c420: 6e63 6c75 6465 5f70 6174 6873 223a 2073  nclude_paths": s
+0001c430: 656c 662e 5f69 6e63 6c75 6465 5f70 6174  elf._include_pat
+0001c440: 6873 2c0a 2020 2020 2020 2020 2020 2020  hs,.            
+0001c450: 2263 6f64 655f 7665 7273 696f 6e22 3a20  "code_version": 
+0001c460: 7365 6c66 2e63 6f64 655f 7665 7273 696f  self.code_versio
+0001c470: 6e2c 0a20 2020 2020 2020 2020 2020 2022  n,.            "
+0001c480: 636f 6465 5f68 6173 6822 3a20 7365 6c66  code_hash": self
+0001c490: 2e5f 636f 6465 5f68 6173 682c 0a20 2020  ._code_hash,.   
+0001c4a0: 2020 2020 2020 2020 2022 635f 6d61 6372           "c_macr
+0001c4b0: 6f5f 6465 6669 6e65 7322 3a20 7365 6c66  o_defines": self
+0001c4c0: 2e63 5f6d 6163 726f 5f64 6566 696e 6573  .c_macro_defines
+0001c4d0: 2c0a 2020 2020 2020 2020 2020 2020 226c  ,.            "l
+0001c4e0: 645f 666c 6167 7322 3a20 7365 6c66 2e6c  d_flags": self.l
+0001c4f0: 645f 666c 6167 732c 0a20 2020 2020 2020  d_flags,.       
+0001c500: 2020 2020 2022 636f 6d70 696c 6572 5f62       "compiler_b
+0001c510: 696e 223a 2073 656c 662e 5f67 6574 5f63  in": self._get_c
+0001c520: 6f6d 7069 6c65 725f 6269 6e28 292c 0a20  ompiler_bin(),. 
+0001c530: 2020 2020 2020 207d 0a0a 2020 2020 6465         }..    de
+0001c540: 6620 5f6d 616b 655f 636f 6465 5f68 6173  f _make_code_has
+0001c550: 6828 7365 6c66 293a 0a20 2020 2020 2020  h(self):.       
+0001c560: 2069 6d70 6f72 7420 6861 7368 6c69 620a   import hashlib.
+0001c570: 0a20 2020 2020 2020 2068 203d 2068 6173  .        h = has
+0001c580: 686c 6962 2e6d 6435 2829 0a20 2020 2020  hlib.md5().     
+0001c590: 2020 2068 2e75 7064 6174 6528 7365 6c66     h.update(self
+0001c5a0: 2e63 6f64 652e 656e 636f 6465 2822 7574  .code.encode("ut
+0001c5b0: 6638 2229 290a 2020 2020 2020 2020 7265  f8")).        re
+0001c5c0: 7475 726e 2068 2e68 6578 6469 6765 7374  turn h.hexdigest
+0001c5d0: 2829 0a0a 2020 2020 6465 6620 5f6d 616b  ()..    def _mak
+0001c5e0: 655f 6861 7368 2873 656c 6629 3a0a 2020  e_hash(self):.  
+0001c5f0: 2020 2020 2020 696d 706f 7274 2068 6173        import has
+0001c600: 686c 6962 0a0a 2020 2020 2020 2020 6820  hlib..        h 
+0001c610: 3d20 6861 7368 6c69 622e 6d64 3528 290a  = hashlib.md5().
+0001c620: 2020 2020 2020 2020 682e 7570 6461 7465          h.update
+0001c630: 2822 7b22 2e65 6e63 6f64 6528 2275 7466  ("{".encode("utf
+0001c640: 3822 2929 0a20 2020 2020 2020 2066 6f72  8")).        for
+0001c650: 206b 6579 2069 6e20 7365 6c66 2e5f 7265   key in self._re
+0001c660: 6c65 7661 6e74 5f69 6e66 6f5f 6b65 7973  levant_info_keys
+0001c670: 3a0a 2020 2020 2020 2020 2020 2020 682e  :.            h.
+0001c680: 7570 6461 7465 2828 2225 733a 7b25 737d  update(("%s:{%s}
+0001c690: 2220 2520 286b 6579 2c20 7365 6c66 2e5f  " % (key, self._
+0001c6a0: 696e 666f 5f64 6963 745b 6b65 795d 2929  info_dict[key]))
+0001c6b0: 2e65 6e63 6f64 6528 2275 7466 3822 2929  .encode("utf8"))
+0001c6c0: 0a20 2020 2020 2020 2068 2e75 7064 6174  .        h.updat
+0001c6d0: 6528 227d 222e 656e 636f 6465 2822 7574  e("}".encode("ut
+0001c6e0: 6638 2229 290a 2020 2020 2020 2020 7265  f8")).        re
+0001c6f0: 7475 726e 2068 2e68 6578 6469 6765 7374  turn h.hexdigest
+0001c700: 2829 0a0a 2020 2020 6465 6620 5f73 6176  ()..    def _sav
+0001c710: 655f 696e 666f 2873 656c 6629 3a0a 2020  e_info(self):.  
+0001c720: 2020 2020 2020 6669 6c65 6e61 6d65 203d        filename =
+0001c730: 2073 656c 662e 5f69 6e66 6f5f 6669 6c65   self._info_file
+0001c740: 6e61 6d65 0a20 2020 2020 2020 2077 6974  name.        wit
+0001c750: 6820 6f70 656e 2866 696c 656e 616d 652c  h open(filename,
+0001c760: 2022 7722 2920 6173 2066 3a0a 2020 2020   "w") as f:.    
+0001c770: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
+0001c780: 2225 735c 6e22 2025 2062 6574 7465 725f  "%s\n" % better_
+0001c790: 7265 7072 2873 656c 662e 5f69 6e66 6f5f  repr(self._info_
+0001c7a0: 6469 6374 2929 0a0a 2020 2020 6465 6620  dict))..    def 
+0001c7b0: 5f6e 6565 645f 7265 636f 6d70 696c 6528  _need_recompile(
+0001c7c0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0001c7d0: 2222 0a20 2020 2020 2020 203a 7274 7970  "".        :rtyp
+0001c7e0: 653a 2062 6f6f 6c0a 2020 2020 2020 2020  e: bool.        
+0001c7f0: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+0001c800: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+0001c810: 7328 7365 6c66 2e5f 736f 5f66 696c 656e  s(self._so_filen
+0001c820: 616d 6529 3a0a 2020 2020 2020 2020 2020  ame):.          
+0001c830: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+0001c840: 2020 2020 2020 6966 2073 656c 662e 696e        if self.in
+0001c850: 636c 7564 655f 6465 7073 3a0a 2020 2020  clude_deps:.    
+0001c860: 2020 2020 2020 2020 736f 5f6d 7469 6d65          so_mtime
+0001c870: 203d 206f 732e 7061 7468 2e67 6574 6d74   = os.path.getmt
+0001c880: 696d 6528 7365 6c66 2e5f 736f 5f66 696c  ime(self._so_fil
+0001c890: 656e 616d 6529 0a20 2020 2020 2020 2020  ename).         
+0001c8a0: 2020 2066 6f72 2066 6e20 696e 2073 656c     for fn in sel
+0001c8b0: 662e 696e 636c 7564 655f 6465 7073 3a0a  f.include_deps:.
+0001c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8d0: 6966 206f 732e 7061 7468 2e67 6574 6d74  if os.path.getmt
+0001c8e0: 696d 6528 666e 2920 3e20 736f 5f6d 7469  ime(fn) > so_mti
+0001c8f0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+0001c900: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+0001c910: 7275 650a 2020 2020 2020 2020 6f6c 645f  rue.        old_
+0001c920: 696e 666f 203d 2073 656c 662e 5f6c 6f61  info = self._loa
+0001c930: 645f 696e 666f 2829 0a20 2020 2020 2020  d_info().       
+0001c940: 206e 6577 5f69 6e66 6f20 3d20 7365 6c66   new_info = self
+0001c950: 2e5f 6d61 6b65 5f69 6e66 6f5f 6469 6374  ._make_info_dict
+0001c960: 2829 0a20 2020 2020 2020 2069 6620 6e6f  ().        if no
+0001c970: 7420 6f6c 645f 696e 666f 3a0a 2020 2020  t old_info:.    
+0001c980: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+0001c990: 7275 650a 2020 2020 2020 2020 2320 5468  rue.        # Th
+0001c9a0: 6520 6861 7368 2061 6c72 6561 6479 206d  e hash already m
+0001c9b0: 6174 6368 6564 2062 7574 2076 6572 7920  atched but very 
+0001c9c0: 756e 6c69 6b65 6c79 2c20 7468 6973 2063  unlikely, this c
+0001c9d0: 6f75 6c64 2062 6520 6120 636f 6c6c 6973  ould be a collis
+0001c9e0: 696f 6e2e 0a20 2020 2020 2020 2023 2041  ion..        # A
+0001c9f0: 6e79 7761 792c 206a 7573 7420 646f 2074  nyway, just do t
+0001ca00: 6869 7320 7665 7279 2063 6865 6170 2063  his very cheap c
+0001ca10: 6865 636b 2e0a 2020 2020 2020 2020 666f  heck..        fo
+0001ca20: 7220 6b65 7920 696e 2073 656c 662e 5f72  r key in self._r
+0001ca30: 656c 6576 616e 745f 696e 666f 5f6b 6579  elevant_info_key
+0001ca40: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+0001ca50: 6620 6b65 7920 6e6f 7420 696e 206f 6c64  f key not in old
+0001ca60: 5f69 6e66 6f3a 0a20 2020 2020 2020 2020  _info:.         
+0001ca70: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+0001ca80: 7565 0a20 2020 2020 2020 2020 2020 2069  ue.            i
+0001ca90: 6620 6f6c 645f 696e 666f 5b6b 6579 5d20  f old_info[key] 
+0001caa0: 213d 206e 6577 5f69 6e66 6f5b 6b65 795d  != new_info[key]
+0001cab0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001cac0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+0001cad0: 2020 2020 2020 2320 4966 206e 6f20 636f        # If no co
+0001cae0: 6465 2076 6572 7369 6f6e 2069 7320 7072  de version is pr
+0001caf0: 6f76 6964 6564 2c20 7765 2063 6f75 6c64  ovided, we could
+0001cb00: 2061 6c73 6f20 6368 6563 6b20 7468 6520   also check the 
+0001cb10: 636f 6465 2069 7473 656c 6620 6e6f 772e  code itself now.
+0001cb20: 0a20 2020 2020 2020 2023 2042 7574 2049  .        # But I
+0001cb30: 2074 6869 6e6b 2074 6869 7320 6973 206f   think this is o
+0001cb40: 7665 726b 696c 6c2e 0a20 2020 2020 2020  verkill..       
+0001cb50: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+0001cb60: 2020 2064 6566 205f 6d61 7962 655f 636f     def _maybe_co
+0001cb70: 6d70 696c 6528 7365 6c66 293a 0a20 2020  mpile(self):.   
+0001cb80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001cb90: 204f 6e20 7375 6363 6573 7366 756c 2072   On successful r
+0001cba0: 6574 7572 6e2c 2073 656c 662e 5f73 6f5f  eturn, self._so_
+0001cbb0: 6669 6c65 6e61 6d65 2073 686f 756c 6420  filename should 
+0001cbc0: 6578 6973 7420 616e 6420 6265 2075 702d  exist and be up-
+0001cbd0: 746f 2d64 6174 652e 0a20 2020 2020 2020  to-date..       
+0001cbe0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+0001cbf0: 6e6f 7420 7365 6c66 2e5f 6e65 6564 5f72  not self._need_r
+0001cc00: 6563 6f6d 7069 6c65 2829 3a0a 2020 2020  ecompile():.    
+0001cc10: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0001cc20: 7665 7262 6f73 653a 0a20 2020 2020 2020  verbose:.       
+0001cc30: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+0001cc40: 2573 3a20 4e6f 206e 6565 6420 746f 2072  %s: No need to r
+0001cc50: 6563 6f6d 7069 6c65 3a20 2573 2220 2520  ecompile: %s" % 
+0001cc60: 2873 656c 662e 5f5f 636c 6173 735f 5f2e  (self.__class__.
+0001cc70: 5f5f 6e61 6d65 5f5f 2c20 7365 6c66 2e5f  __name__, self._
+0001cc80: 736f 5f66 696c 656e 616d 6529 290a 2020  so_filename)).  
+0001cc90: 2020 2020 2020 2020 2020 2320 546f 7563            # Touc
+0001cca0: 6820 6974 2073 6f20 7468 6174 2077 6520  h it so that we 
+0001ccb0: 6361 6e20 7365 6520 7468 6174 2077 6520  can see that we 
+0001ccc0: 7573 6564 2069 7420 7265 6365 6e74 6c79  used it recently
+0001ccd0: 2e0a 2020 2020 2020 2020 2020 2020 6f73  ..            os
+0001cce0: 2e75 7469 6d65 2873 656c 662e 5f69 6e66  .utime(self._inf
+0001ccf0: 6f5f 6669 6c65 6e61 6d65 2c20 4e6f 6e65  o_filename, None
+0001cd00: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0001cd10: 7475 726e 0a20 2020 2020 2020 206c 6f63  turn.        loc
+0001cd20: 6b20 3d20 4c6f 636b 4669 6c65 2873 656c  k = LockFile(sel
+0001cd30: 662e 5f6d 6f64 5f70 6174 6829 0a20 2020  f._mod_path).   
+0001cd40: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0001cd50: 2e5f 6e65 6564 5f72 6563 6f6d 7069 6c65  ._need_recompile
+0001cd60: 2829 3a20 2023 2063 6865 636b 2061 6761  ():  # check aga
+0001cd70: 696e 0a20 2020 2020 2020 2020 2020 2069  in.            i
+0001cd80: 6620 7365 6c66 2e76 6572 626f 7365 3a0a  f self.verbose:.
+0001cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cda0: 7072 696e 7428 2225 733a 204e 6f20 6e65  print("%s: No ne
+0001cdb0: 6564 2074 6f20 7265 636f 6d70 696c 6520  ed to recompile 
+0001cdc0: 6166 7465 7220 7765 2077 6169 7465 643a  after we waited:
+0001cdd0: 2025 7322 2025 2028 7365 6c66 2e5f 5f63   %s" % (self.__c
+0001cde0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f2c  lass__.__name__,
+0001cdf0: 2073 656c 662e 5f73 6f5f 6669 6c65 6e61   self._so_filena
+0001ce00: 6d65 2929 0a20 2020 2020 2020 2020 2020  me)).           
+0001ce10: 206f 732e 7574 696d 6528 7365 6c66 2e5f   os.utime(self._
+0001ce20: 696e 666f 5f66 696c 656e 616d 652c 204e  info_filename, N
+0001ce30: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
+0001ce40: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
+0001ce50: 6966 2073 656c 662e 5f73 686f 756c 645f  if self._should_
+0001ce60: 636c 6561 6e75 705f 6f6c 645f 6d79 6469  cleanup_old_mydi
+0001ce70: 7220 616e 6420 6e6f 7420 6c6f 636b 2e69  r and not lock.i
+0001ce80: 735f 6c6f 636b 6564 2829 3a0a 2020 2020  s_locked():.    
+0001ce90: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+0001cea0: 7468 2e65 7869 7374 7328 7365 6c66 2e5f  th.exists(self._
+0001ceb0: 6d6f 645f 7061 7468 293a 0a20 2020 2020  mod_path):.     
+0001cec0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001ced0: 5f63 6c65 616e 7570 5f6f 6c64 5f70 6174  _cleanup_old_pat
+0001cee0: 6828 7365 6c66 2e5f 6d6f 645f 7061 7468  h(self._mod_path
+0001cef0: 2c20 7265 6173 6f6e 3d22 6e65 6564 2072  , reason="need r
+0001cf00: 6563 6f6d 7069 6c65 2229 0a20 2020 2020  ecompile").     
+0001cf10: 2020 2077 6974 6820 6c6f 636b 3a0a 2020     with lock:.  
+0001cf20: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0001cf30: 6d61 7962 655f 636f 6d70 696c 655f 696e  maybe_compile_in
+0001cf40: 6e65 7228 290a 0a20 2020 2064 6566 205f  ner()..    def _
+0001cf50: 6765 745f 636f 6d70 696c 6572 5f62 696e  get_compiler_bin
+0001cf60: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001cf70: 2222 220a 2020 2020 2020 2020 3a72 7479  """.        :rty
+0001cf80: 7065 3a20 7374 720a 2020 2020 2020 2020  pe: str.        
+0001cf90: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
+0001cfa0: 656c 662e 6973 5f63 7070 3a0a 2020 2020  elf.is_cpp:.    
+0001cfb0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+0001cfc0: 672b 2b22 0a20 2020 2020 2020 2072 6574  g++".        ret
+0001cfd0: 7572 6e20 2267 6363 220a 0a20 2020 2064  urn "gcc"..    d
+0001cfe0: 6566 205f 7472 616e 7366 6f72 6d5f 636f  ef _transform_co
+0001cff0: 6d70 696c 6572 5f6f 7074 7328 7365 6c66  mpiler_opts(self
+0001d000: 2c20 6f70 7473 293a 0a20 2020 2020 2020  , opts):.       
+0001d010: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
+0001d020: 7261 6d20 6c69 7374 5b73 7472 5d20 6f70  ram list[str] op
+0001d030: 7473 3a0a 2020 2020 2020 2020 3a72 7479  ts:.        :rty
+0001d040: 7065 3a20 6c69 7374 5b73 7472 5d0a 2020  pe: list[str].  
+0001d050: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001d060: 2020 7265 7475 726e 206f 7074 730a 0a20    return opts.. 
+0001d070: 2020 2064 6566 205f 6578 7472 615f 636f     def _extra_co
+0001d080: 6d6d 6f6e 5f6f 7074 7328 7365 6c66 293a  mmon_opts(self):
+0001d090: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001d0a0: 2020 2020 203a 7274 7970 653a 206c 6973       :rtype: lis
+0001d0b0: 745b 7374 725d 0a20 2020 2020 2020 2022  t[str].        "
+0001d0c0: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
+0001d0d0: 6c66 2e69 735f 6370 703a 0a20 2020 2020  lf.is_cpp:.     
+0001d0e0: 2020 2020 2020 2072 6574 7572 6e20 5b22         return ["
+0001d0f0: 2d73 7464 3d63 2b2b 3131 225d 0a20 2020  -std=c++11"].   
+0001d100: 2020 2020 2072 6574 7572 6e20 5b5d 0a0a       return []..
+0001d110: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0001d120: 0a20 2020 2064 6566 205f 7472 616e 7366  .    def _transf
+0001d130: 6f72 6d5f 6c64 5f66 6c61 6728 636c 732c  orm_ld_flag(cls,
+0001d140: 206f 7074 293a 0a20 2020 2020 2020 2022   opt):.        "
+0001d150: 2222 0a20 2020 2020 2020 203a 7061 7261  "".        :para
+0001d160: 6d20 7374 7220 6f70 743a 0a20 2020 2020  m str opt:.     
+0001d170: 2020 203a 7274 7970 653a 2073 7472 0a20     :rtype: str. 
+0001d180: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001d190: 2020 2069 6620 7379 732e 706c 6174 666f     if sys.platfo
+0001d1a0: 726d 203d 3d20 2264 6172 7769 6e22 3a0a  rm == "darwin":.
+0001d1b0: 2020 2020 2020 2020 2020 2020 2320 4974              # It
+0001d1c0: 2073 6565 6d73 2073 6f6d 6520 7665 7273   seems some vers
+0001d1d0: 696f 6e73 206f 6620 4d61 634f 5320 6c64  ions of MacOS ld
+0001d1e0: 2063 616e 6e6f 7420 6861 6e64 6c65 2074   cannot handle t
+0001d1f0: 6865 2060 2d6c 3a66 696c 656e 616d 6560  he `-l:filename`
+0001d200: 2061 7267 756d 656e 7420 636f 7272 6563   argument correc
+0001d210: 746c 792e 0a20 2020 2020 2020 2020 2020  tly..           
+0001d220: 2023 2045 2e67 2e20 5465 6e73 6f72 466c   # E.g. TensorFl
+0001d230: 6f77 2031 2e31 3420 696e 636f 7272 6563  ow 1.14 incorrec
+0001d240: 746c 7920 7573 6573 2074 6869 732e 0a20  tly uses this.. 
+0001d250: 2020 2020 2020 2020 2020 2023 2068 7474             # htt
+0001d260: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+0001d270: 7465 6e73 6f72 666c 6f77 2f74 656e 736f  tensorflow/tenso
+0001d280: 7266 6c6f 772f 6973 7375 6573 2f33 3035  rflow/issues/305
+0001d290: 3634 0a20 2020 2020 2020 2020 2020 2069  64.            i
+0001d2a0: 6620 6f70 742e 7374 6172 7473 7769 7468  f opt.startswith
+0001d2b0: 2822 2d6c 3a6c 6962 2229 2061 6e64 206f  ("-l:lib") and o
+0001d2c0: 7074 2e65 6e64 7377 6974 6828 222e 6479  pt.endswith(".dy
+0001d2d0: 6c69 6222 293a 0a20 2020 2020 2020 2020  lib"):.         
+0001d2e0: 2020 2020 2020 2072 6574 7572 6e20 222d         return "-
+0001d2f0: 6c25 7322 2025 206f 7074 5b6c 656e 2822  l%s" % opt[len("
+0001d300: 2d6c 3a6c 6962 2229 203a 202d 6c65 6e28  -l:lib") : -len(
+0001d310: 222e 6479 6c69 6222 295d 0a20 2020 2020  ".dylib")].     
+0001d320: 2020 2072 6574 7572 6e20 6f70 740a 0a20     return opt.. 
+0001d330: 2020 2064 6566 205f 6d61 7962 655f 636f     def _maybe_co
+0001d340: 6d70 696c 655f 696e 6e65 7228 7365 6c66  mpile_inner(self
+0001d350: 293a 0a20 2020 2020 2020 2023 2044 6972  ):.        # Dir
+0001d360: 6563 746f 7279 2073 686f 756c 6420 6265  ectory should be
+0001d370: 2063 7265 6174 6564 2062 7920 7468 6520   created by the 
+0001d380: 6c6f 636b 696e 6720 6d65 6368 616e 6973  locking mechanis
+0001d390: 6d2e 0a20 2020 2020 2020 2061 7373 6572  m..        asser
+0001d3a0: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+0001d3b0: 2873 656c 662e 5f6d 6f64 5f70 6174 6829  (self._mod_path)
+0001d3c0: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
+0001d3d0: 656e 2873 656c 662e 5f63 5f66 696c 656e  en(self._c_filen
+0001d3e0: 616d 652c 2022 7722 2920 6173 2066 3a0a  ame, "w") as f:.
+0001d3f0: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
+0001d400: 6974 6528 7365 6c66 2e63 6f64 6529 0a20  ite(self.code). 
+0001d410: 2020 2020 2020 2063 6f6d 6d6f 6e5f 6f70         common_op
+0001d420: 7473 203d 205b 222d 7368 6172 6564 222c  ts = ["-shared",
+0001d430: 2022 2d4f 3222 5d0a 2020 2020 2020 2020   "-O2"].        
+0001d440: 636f 6d6d 6f6e 5f6f 7074 7320 2b3d 2073  common_opts += s
+0001d450: 656c 662e 5f65 7874 7261 5f63 6f6d 6d6f  elf._extra_commo
+0001d460: 6e5f 6f70 7473 2829 0a20 2020 2020 2020  n_opts().       
+0001d470: 2069 6620 7379 732e 706c 6174 666f 726d   if sys.platform
+0001d480: 203d 3d20 2264 6172 7769 6e22 3a0a 2020   == "darwin":.  
+0001d490: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
+0001d4a0: 5f6f 7074 7320 2b3d 205b 222d 756e 6465  _opts += ["-unde
+0001d4b0: 6669 6e65 6422 2c20 2264 796e 616d 6963  fined", "dynamic
+0001d4c0: 5f6c 6f6f 6b75 7022 5d0a 2020 2020 2020  _lookup"].      
+0001d4d0: 2020 666f 7220 696e 636c 7564 655f 7061    for include_pa
+0001d4e0: 7468 2069 6e20 7365 6c66 2e5f 696e 636c  th in self._incl
+0001d4f0: 7564 655f 7061 7468 733a 0a20 2020 2020  ude_paths:.     
+0001d500: 2020 2020 2020 2063 6f6d 6d6f 6e5f 6f70         common_op
+0001d510: 7473 202b 3d20 5b22 2d49 222c 2069 6e63  ts += ["-I", inc
+0001d520: 6c75 6465 5f70 6174 685d 0a20 2020 2020  lude_path].     
+0001d530: 2020 2063 6f6d 7069 6c65 725f 6f70 7473     compiler_opts
+0001d540: 203d 205b 222d 6650 4943 222c 2022 2d76   = ["-fPIC", "-v
+0001d550: 225d 0a20 2020 2020 2020 2063 6f6d 6d6f  "].        commo
+0001d560: 6e5f 6f70 7473 202b 3d20 7365 6c66 2e5f  n_opts += self._
+0001d570: 7472 616e 7366 6f72 6d5f 636f 6d70 696c  transform_compil
+0001d580: 6572 5f6f 7074 7328 636f 6d70 696c 6572  er_opts(compiler
+0001d590: 5f6f 7074 7329 0a20 2020 2020 2020 2063  _opts).        c
+0001d5a0: 6f6d 6d6f 6e5f 6f70 7473 202b 3d20 5b22  ommon_opts += ["
+0001d5b0: 2d44 5f47 4c49 4243 5858 5f55 5345 5f43  -D_GLIBCXX_USE_C
+0001d5c0: 5858 3131 5f41 4249 3d25 6922 2025 2028  XX11_ABI=%i" % (
+0001d5d0: 3120 6966 2073 656c 662e 7573 655f 6378  1 if self.use_cx
+0001d5e0: 7831 315f 6162 6920 656c 7365 2030 295d  x11_abi else 0)]
+0001d5f0: 0a20 2020 2020 2020 2063 6f6d 6d6f 6e5f  .        common_
+0001d600: 6f70 7473 202b 3d20 5b22 2d44 2573 3d25  opts += ["-D%s=%
+0001d610: 7322 2025 2069 7465 6d20 666f 7220 6974  s" % item for it
+0001d620: 656d 2069 6e20 736f 7274 6564 2873 656c  em in sorted(sel
+0001d630: 662e 635f 6d61 6372 6f5f 6465 6669 6e65  f.c_macro_define
+0001d640: 732e 6974 656d 7328 2929 5d0a 2020 2020  s.items())].    
+0001d650: 2020 2020 636f 6d6d 6f6e 5f6f 7074 7320      common_opts 
+0001d660: 2b3d 205b 222d 6722 5d0a 2020 2020 2020  += ["-g"].      
+0001d670: 2020 6f70 7473 203d 2063 6f6d 6d6f 6e5f    opts = common_
+0001d680: 6f70 7473 202b 205b 7365 6c66 2e5f 635f  opts + [self._c_
+0001d690: 6669 6c65 6e61 6d65 2c20 222d 6f22 2c20  filename, "-o", 
+0001d6a0: 7365 6c66 2e5f 736f 5f66 696c 656e 616d  self._so_filenam
+0001d6b0: 655d 0a20 2020 2020 2020 206f 7074 7320  e].        opts 
+0001d6c0: 2b3d 206c 6973 7428 6d61 7028 7365 6c66  += list(map(self
+0001d6d0: 2e5f 7472 616e 7366 6f72 6d5f 6c64 5f66  ._transform_ld_f
+0001d6e0: 6c61 672c 2073 656c 662e 6c64 5f66 6c61  lag, self.ld_fla
+0001d6f0: 6773 2929 0a20 2020 2020 2020 2063 6d64  gs)).        cmd
+0001d700: 5f62 696e 203d 2073 656c 662e 5f67 6574  _bin = self._get
+0001d710: 5f63 6f6d 7069 6c65 725f 6269 6e28 290a  _compiler_bin().
+0001d720: 2020 2020 2020 2020 636d 645f 6172 6773          cmd_args
+0001d730: 203d 205b 636d 645f 6269 6e5d 202b 206f   = [cmd_bin] + o
+0001d740: 7074 730a 2020 2020 2020 2020 6672 6f6d  pts.        from
+0001d750: 2073 7562 7072 6f63 6573 7320 696d 706f   subprocess impo
+0001d760: 7274 2050 6f70 656e 2c20 5049 5045 2c20  rt Popen, PIPE, 
+0001d770: 5354 444f 5554 2c20 4361 6c6c 6564 5072  STDOUT, CalledPr
+0001d780: 6f63 6573 7345 7272 6f72 0a0a 2020 2020  ocessError..    
+0001d790: 2020 2020 7072 696e 7428 2225 7320 6361      print("%s ca
+0001d7a0: 6c6c 3a20 2573 2220 2520 2873 656c 662e  ll: %s" % (self.
+0001d7b0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0001d7c0: 5f5f 2c20 2220 222e 6a6f 696e 2863 6d64  __, " ".join(cmd
+0001d7d0: 5f61 7267 7329 292c 2066 696c 653d 7365  _args)), file=se
+0001d7e0: 6c66 2e5f 6c6f 675f 7374 7265 616d 290a  lf._log_stream).
+0001d7f0: 2020 2020 2020 2020 7072 6f63 203d 2050          proc = P
+0001d800: 6f70 656e 2863 6d64 5f61 7267 732c 2063  open(cmd_args, c
+0001d810: 7764 3d73 656c 662e 5f6d 6f64 5f70 6174  wd=self._mod_pat
+0001d820: 682c 2073 7464 6f75 743d 5049 5045 2c20  h, stdout=PIPE, 
+0001d830: 7374 6465 7272 3d53 5444 4f55 5429 0a20  stderr=STDOUT). 
+0001d840: 2020 2020 2020 2073 7464 6f75 742c 2073         stdout, s
+0001d850: 7464 6572 7220 3d20 7072 6f63 2e63 6f6d  tderr = proc.com
+0001d860: 6d75 6e69 6361 7465 2829 0a20 2020 2020  municate().     
+0001d870: 2020 2061 7373 6572 7420 7374 6465 7272     assert stderr
+0001d880: 2069 7320 4e6f 6e65 2020 2320 7368 6f75   is None  # shou
+0001d890: 6c64 206f 6e6c 7920 6861 7665 2073 7464  ld only have std
+0001d8a0: 6f75 740a 2020 2020 2020 2020 6966 2070  out.        if p
+0001d8b0: 726f 632e 7265 7475 726e 636f 6465 2021  roc.returncode !
+0001d8c0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0001d8d0: 2070 7269 6e74 2822 2573 3a20 2573 2066   print("%s: %s f
+0001d8e0: 6169 6c65 642e 2220 2520 2873 656c 662e  ailed." % (self.
+0001d8f0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0001d900: 5f5f 2c20 636d 645f 6269 6e29 290a 2020  __, cmd_bin)).  
+0001d910: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0001d920: 224f 7269 6769 6e61 6c20 7374 646f 7574  "Original stdout
+0001d930: 2f73 7464 6572 723a 2229 0a20 2020 2020  /stderr:").     
+0001d940: 2020 2020 2020 2070 7269 6e74 2873 7464         print(std
+0001d950: 6f75 742e 6465 636f 6465 2822 7574 6638  out.decode("utf8
+0001d960: 2229 290a 2020 2020 2020 2020 2020 2020  ")).            
+0001d970: 7072 696e 7428 290a 2020 2020 2020 2020  print().        
+0001d980: 2020 2020 6966 2063 6d64 5f62 696e 2e65      if cmd_bin.e
+0001d990: 6e64 7377 6974 6828 222f 6e76 6363 2229  ndswith("/nvcc")
+0001d9a0: 2061 6e64 2062 2265 7272 6f72 3a20 636f   and b"error: co
+0001d9b0: 6e73 7465 7870 7220 6675 6e63 7469 6f6e  nstexpr function
+0001d9c0: 2072 6574 7572 6e20 6973 206e 6f6e 2d63   return is non-c
+0001d9d0: 6f6e 7374 616e 7422 2069 6e20 7374 646f  onstant" in stdo
+0001d9e0: 7574 3a0a 2020 2020 2020 2020 2020 2020  ut:.            
+0001d9f0: 2020 2020 7072 696e 7428 2254 6869 7320      print("This 
+0001da00: 6d69 6768 7420 6265 2074 6865 2065 7272  might be the err
+0001da10: 6f72 3a20 6874 7470 733a 2f2f 6769 7468  or: https://gith
+0001da20: 7562 2e63 6f6d 2f74 656e 736f 7266 6c6f  ub.com/tensorflo
+0001da30: 772f 7465 6e73 6f72 666c 6f77 2f69 7373  w/tensorflow/iss
+0001da40: 7565 732f 3232 3736 3622 290a 2020 2020  ues/22766").    
+0001da50: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0001da60: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+0001da70: 6966 2063 6d64 5f62 696e 2e65 6e64 7377  if cmd_bin.endsw
+0001da80: 6974 6828 222f 6e76 6363 2229 2061 6e64  ith("/nvcc") and
+0001da90: 2062 2267 6363 2076 6572 7369 6f6e 7320   b"gcc versions 
+0001daa0: 6c61 7465 7220 7468 616e 2220 696e 2073  later than" in s
+0001dab0: 7464 6f75 743a 0a20 2020 2020 2020 2020  tdout:.         
+0001dac0: 2020 2020 2020 2070 7269 6e74 2822 596f         print("Yo
+0001dad0: 7572 2047 4343 2076 6572 7369 6f6e 206d  ur GCC version m
+0001dae0: 6967 6874 2062 6520 746f 6f20 6e65 772e  ight be too new.
+0001daf0: 2054 6869 7320 6973 2061 2070 726f 626c   This is a probl
+0001db00: 656d 2077 6974 6820 736f 6d65 206e 7663  em with some nvc
+0001db10: 6320 7665 7273 696f 6e73 2e22 290a 2020  c versions.").  
+0001db20: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001db30: 696e 7428 290a 2020 2020 2020 2020 2020  int().          
+0001db40: 2020 7261 6973 6520 4361 6c6c 6564 5072    raise CalledPr
+0001db50: 6f63 6573 7345 7272 6f72 2872 6574 7572  ocessError(retur
+0001db60: 6e63 6f64 653d 7072 6f63 2e72 6574 7572  ncode=proc.retur
+0001db70: 6e63 6f64 652c 2063 6d64 3d63 6d64 5f61  ncode, cmd=cmd_a
+0001db80: 7267 7329 0a20 2020 2020 2020 2061 7373  rgs).        ass
+0001db90: 6572 7420 6f73 2e70 6174 682e 6578 6973  ert os.path.exis
+0001dba0: 7473 2873 656c 662e 5f73 6f5f 6669 6c65  ts(self._so_file
+0001dbb0: 6e61 6d65 290a 2020 2020 2020 2020 7769  name).        wi
+0001dbc0: 7468 206f 7065 6e28 2225 732f 636f 6d70  th open("%s/comp
+0001dbd0: 696c 652e 6c6f 6722 2025 2073 656c 662e  ile.log" % self.
+0001dbe0: 5f6d 6f64 5f70 6174 682c 2022 7762 2229  _mod_path, "wb")
+0001dbf0: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
+0001dc00: 2020 2069 6620 7365 6c66 2e76 6572 626f     if self.verbo
+0001dc10: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001dc20: 2020 2020 7072 696e 7428 2225 733a 2077      print("%s: w
+0001dc30: 7269 7465 2063 6f6d 7069 6c65 206c 6f67  rite compile log
+0001dc40: 2074 6f3a 2025 7322 2025 2028 7365 6c66   to: %s" % (self
+0001dc50: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+0001dc60: 655f 5f2c 2066 2e6e 616d 6529 290a 2020  e__, f.name)).  
+0001dc70: 2020 2020 2020 2020 2020 662e 7772 6974            f.writ
+0001dc80: 6528 2822 2b20 2573 5c6e 2220 2520 2220  e(("+ %s\n" % " 
+0001dc90: 222e 6a6f 696e 2863 6d64 5f61 7267 7329  ".join(cmd_args)
+0001dca0: 292e 656e 636f 6465 2822 7574 6638 2229  ).encode("utf8")
+0001dcb0: 290a 2020 2020 2020 2020 2020 2020 662e  ).            f.
+0001dcc0: 7772 6974 6528 7374 646f 7574 290a 2020  write(stdout).  
+0001dcd0: 2020 2020 2020 7365 6c66 2e5f 7361 7665        self._save
+0001dce0: 5f69 6e66 6f28 290a 2020 2020 2020 2020  _info().        
+0001dcf0: 6173 7365 7274 206e 6f74 2073 656c 662e  assert not self.
+0001dd00: 5f6e 6565 645f 7265 636f 6d70 696c 6528  _need_recompile(
+0001dd10: 290a 0a20 2020 2064 6566 206c 6f61 645f  )..    def load_
+0001dd20: 6c69 625f 6374 7970 6573 2873 656c 6629  lib_ctypes(self)
+0001dd30: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001dd40: 2020 2020 2020 3a72 7479 7065 3a20 6374        :rtype: ct
+0001dd50: 7970 6573 2e43 444c 4c0a 2020 2020 2020  ypes.CDLL.      
+0001dd60: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0001dd70: 2073 656c 662e 5f63 7479 7065 735f 6c69   self._ctypes_li
+0001dd80: 623a 0a20 2020 2020 2020 2020 2020 2072  b:.            r
+0001dd90: 6574 7572 6e20 7365 6c66 2e5f 6374 7970  eturn self._ctyp
+0001dda0: 6573 5f6c 6962 0a20 2020 2020 2020 2073  es_lib.        s
+0001ddb0: 656c 662e 5f6d 6179 6265 5f63 6f6d 7069  elf._maybe_compi
+0001ddc0: 6c65 2829 0a20 2020 2020 2020 2069 6d70  le().        imp
+0001ddd0: 6f72 7420 6374 7970 6573 0a0a 2020 2020  ort ctypes..    
+0001dde0: 2020 2020 7365 6c66 2e5f 6374 7970 6573      self._ctypes
+0001ddf0: 5f6c 6962 203d 2063 7479 7065 732e 6364  _lib = ctypes.cd
+0001de00: 6c6c 2e4c 6f61 644c 6962 7261 7279 2873  ll.LoadLibrary(s
+0001de10: 656c 662e 5f73 6f5f 6669 6c65 6e61 6d65  elf._so_filename
+0001de20: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001de30: 2073 656c 662e 5f63 7479 7065 735f 6c69   self._ctypes_li
+0001de40: 620a 0a20 2020 2064 6566 2067 6574 5f6c  b..    def get_l
+0001de50: 6962 5f66 696c 656e 616d 6528 7365 6c66  ib_filename(self
+0001de60: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0001de70: 2020 2020 2020 203a 7274 7970 653a 2073         :rtype: s
+0001de80: 7472 0a20 2020 2020 2020 2022 2222 0a20  tr.        """. 
+0001de90: 2020 2020 2020 2073 656c 662e 5f6d 6179         self._may
+0001dea0: 6265 5f63 6f6d 7069 6c65 2829 0a20 2020  be_compile().   
+0001deb0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001dec0: 2e5f 736f 5f66 696c 656e 616d 650a 0a0a  ._so_filename...
+0001ded0: 2320 5365 6520 3a66 756e 633a 606d 6179  # See :func:`may
+0001dee0: 6265 5f72 6573 7461 7274 5f72 6574 7572  be_restart_retur
+0001def0: 6e6e 5f77 6974 685f 6174 666f 726b 5f70  nn_with_atfork_p
+0001df00: 6174 6368 6020 6265 6c6f 7720 666f 7220  atch` below for 
+0001df10: 7768 7920 796f 7520 6d69 6768 7420 7761  why you might wa
+0001df20: 6e74 2074 6f20 7573 6520 7468 6973 2e0a  nt to use this..
+0001df30: 5f63 5f63 6f64 655f 7061 7463 685f 6174  _c_code_patch_at
+0001df40: 666f 726b 203d 2022 2222 0a23 6465 6669  fork = """.#defi
+0001df50: 6e65 205f 474e 555f 534f 5552 4345 0a23  ne _GNU_SOURCE.#
+0001df60: 696e 636c 7564 6520 3c73 6368 6564 2e68  include <sched.h
+0001df70: 3e0a 2369 6e63 6c75 6465 203c 7369 676e  >.#include <sign
+0001df80: 616c 2e68 3e0a 2369 6e63 6c75 6465 203c  al.h>.#include <
+0001df90: 7379 732f 7379 7363 616c 6c2e 683e 0a23  sys/syscall.h>.#
+0001dfa0: 696e 636c 7564 6520 3c73 7464 696f 2e68  include <stdio.h
+0001dfb0: 3e0a 2369 6e63 6c75 6465 203c 7374 646c  >.#include <stdl
+0001dfc0: 6962 2e68 3e0a 2369 6e63 6c75 6465 203c  ib.h>.#include <
+0001dfd0: 756e 6973 7464 2e68 3e0a 0a2f 2f20 6874  unistd.h>..// ht
+0001dfe0: 7470 733a 2f2f 7374 6163 6b6f 7665 7266  tps://stackoverf
+0001dff0: 6c6f 772e 636f 6d2f 7175 6573 7469 6f6e  low.com/question
+0001e000: 732f 3436 3834 3534 3936 2f6c 642d 7072  s/46845496/ld-pr
+0001e010: 656c 6f61 642d 616e 642d 6c69 6e6b 6167  eload-and-linkag
+0001e020: 650a 2f2f 2068 7474 7073 3a2f 2f73 7461  e.// https://sta
+0001e030: 636b 6f76 6572 666c 6f77 2e63 6f6d 2f71  ckoverflow.com/q
+0001e040: 7565 7374 696f 6e73 2f34 3638 3130 3539  uestions/4681059
+0001e050: 372f 666f 726b 6578 6563 2d77 6974 686f  7/forkexec-witho
+0001e060: 7574 2d61 7466 6f72 6b2d 6861 6e64 6c65  ut-atfork-handle
+0001e070: 7273 0a0a 696e 7420 7074 6872 6561 645f  rs..int pthread_
+0001e080: 6174 666f 726b 2876 6f69 6420 282a 7072  atfork(void (*pr
+0001e090: 6570 6172 6529 2876 6f69 6429 2c20 766f  epare)(void), vo
+0001e0a0: 6964 2028 2a70 6172 656e 7429 2876 6f69  id (*parent)(voi
+0001e0b0: 6429 2c20 766f 6964 2028 2a63 6869 6c64  d), void (*child
+0001e0c0: 2928 766f 6964 2929 207b 0a20 2070 7269  )(void)) {.  pri
+0001e0d0: 6e74 6628 2249 676e 6f72 696e 6720 7074  ntf("Ignoring pt
+0001e0e0: 6872 6561 645f 6174 666f 726b 2063 616c  hread_atfork cal
+0001e0f0: 6c21 5c5c 6e22 293b 0a20 2066 666c 7573  l!\\n");.  fflus
+0001e100: 6828 7374 646f 7574 293b 0a20 2072 6574  h(stdout);.  ret
+0001e110: 7572 6e20 303b 0a7d 0a0a 696e 7420 5f5f  urn 0;.}..int __
+0001e120: 7265 6769 7374 6572 5f61 7466 6f72 6b28  register_atfork(
+0001e130: 766f 6964 2028 2a70 7265 7061 7265 2928  void (*prepare)(
+0001e140: 766f 6964 292c 2076 6f69 6420 282a 7061  void), void (*pa
+0001e150: 7265 6e74 2928 766f 6964 292c 2076 6f69  rent)(void), voi
+0001e160: 6420 282a 6368 696c 6429 2876 6f69 6429  d (*child)(void)
+0001e170: 2920 7b0a 2020 7072 696e 7466 2822 4967  ) {.  printf("Ig
+0001e180: 6e6f 7269 6e67 205f 5f72 6567 6973 7465  noring __registe
+0001e190: 725f 6174 666f 726b 2063 616c 6c21 5c5c  r_atfork call!\\
+0001e1a0: 6e22 293b 0a20 2066 666c 7573 6828 7374  n");.  fflush(st
+0001e1b0: 646f 7574 293b 0a20 2072 6574 7572 6e20  dout);.  return 
+0001e1c0: 303b 0a7d 0a0a 2f2f 2041 6e6f 7468 6572  0;.}..// Another
+0001e1d0: 2077 6179 2074 6f20 6967 6e6f 7265 2061   way to ignore a
+0001e1e0: 7466 6f72 6b20 6861 6e64 6c65 7273 3a20  tfork handlers: 
+0001e1f0: 4f76 6572 7269 6465 2066 6f72 6b2e 0a23  Override fork..#
+0001e200: 6966 6465 6620 5f5f 6c69 6e75 785f 5f20  ifdef __linux__ 
+0001e210: 2f2f 206f 6e6c 7920 776f 726b 7320 6f6e  // only works on
+0001e220: 204c 696e 7578 2063 7572 7265 6e74 6c79   Linux currently
+0001e230: 0a70 6964 5f74 2066 6f72 6b28 766f 6964  .pid_t fork(void
+0001e240: 2920 7b0a 2020 7265 7475 726e 2073 7973  ) {.  return sys
+0001e250: 6361 6c6c 2853 5953 5f63 6c6f 6e65 2c20  call(SYS_clone, 
+0001e260: 5349 4743 484c 442c 2030 293b 0a7d 0a23  SIGCHLD, 0);.}.#
+0001e270: 656e 6469 660a 0a5f 5f61 7474 7269 6275  endif..__attribu
+0001e280: 7465 5f5f 2828 636f 6e73 7472 7563 746f  te__((constructo
+0001e290: 7229 290a 766f 6964 2070 6174 6368 5f61  r)).void patch_a
+0001e2a0: 7466 6f72 6b5f 696e 6974 2829 207b 0a20  tfork_init() {. 
+0001e2b0: 2073 6574 656e 7628 225f 5f52 4554 5552   setenv("__RETUR
+0001e2c0: 4e4e 5f41 5446 4f52 4b5f 5041 5443 4845  NN_ATFORK_PATCHE
+0001e2d0: 4422 2c20 2231 222c 2031 293b 0a7d 0a22  D", "1", 1);.}."
+0001e2e0: 2222 0a0a 0a64 6566 2067 6574 5f70 6174  ""...def get_pat
+0001e2f0: 6368 5f61 7466 6f72 6b5f 6c69 6228 293a  ch_atfork_lib():
+0001e300: 0a20 2020 2022 2222 0a20 2020 203a 7265  .    """.    :re
+0001e310: 7475 726e 3a20 7061 7468 2074 6f20 6f75  turn: path to ou
+0001e320: 7220 7061 7463 685f 6174 666f 726b 206c  r patch_atfork l
+0001e330: 6962 2e20 7365 6520 3a66 756e 633a 606d  ib. see :func:`m
+0001e340: 6179 6265 5f72 6573 7461 7274 5f72 6574  aybe_restart_ret
+0001e350: 7572 6e6e 5f77 6974 685f 6174 666f 726b  urnn_with_atfork
+0001e360: 5f70 6174 6368 600a 2020 2020 3a72 7479  _patch`.    :rty
+0001e370: 7065 3a20 7374 720a 2020 2020 2222 220a  pe: str.    """.
+0001e380: 2020 2020 6e61 7469 7665 203d 204e 6174      native = Nat
+0001e390: 6976 6543 6f64 6543 6f6d 7069 6c65 7228  iveCodeCompiler(
+0001e3a0: 6261 7365 5f6e 616d 653d 2270 6174 6368  base_name="patch
+0001e3b0: 5f61 7466 6f72 6b22 2c20 636f 6465 5f76  _atfork", code_v
+0001e3c0: 6572 7369 6f6e 3d32 2c20 636f 6465 3d5f  ersion=2, code=_
+0001e3d0: 635f 636f 6465 5f70 6174 6368 5f61 7466  c_code_patch_atf
+0001e3e0: 6f72 6b2c 2069 735f 6370 703d 4661 6c73  ork, is_cpp=Fals
+0001e3f0: 6529 0a20 2020 2066 6e20 3d20 6e61 7469  e).    fn = nati
+0001e400: 7665 2e67 6574 5f6c 6962 5f66 696c 656e  ve.get_lib_filen
+0001e410: 616d 6528 290a 2020 2020 7265 7475 726e  ame().    return
+0001e420: 2066 6e0a 0a0a 6465 6620 7265 7374 6172   fn...def restar
+0001e430: 745f 7265 7475 726e 6e28 293a 0a20 2020  t_returnn():.   
+0001e440: 2022 2222 0a20 2020 2052 6573 7461 7274   """.    Restart
+0001e450: 7320 5245 5455 524e 4e2e 0a20 2020 2022  s RETURNN..    "
+0001e460: 2222 0a20 2020 206c 6f67 2e66 6c75 7368  "".    log.flush
+0001e470: 2829 0a20 2020 2073 7973 2e73 7464 6f75  ().    sys.stdou
+0001e480: 742e 666c 7573 6828 290a 2020 2020 7379  t.flush().    sy
+0001e490: 732e 7374 6465 7272 2e66 6c75 7368 2829  s.stderr.flush()
+0001e4a0: 0a20 2020 2023 2068 7474 7073 3a2f 2f73  .    # https://s
+0001e4b0: 7461 636b 6f76 6572 666c 6f77 2e63 6f6d  tackoverflow.com
+0001e4c0: 2f71 7565 7374 696f 6e73 2f37 3233 3335  /questions/72335
+0001e4d0: 3930 342f 7369 6d70 6c65 2d77 6179 2d74  904/simple-way-t
+0001e4e0: 6f2d 7265 7374 6172 742d 6170 706c 6963  o-restart-applic
+0001e4f0: 6174 696f 6e0a 2020 2020 636c 6f73 655f  ation.    close_
+0001e500: 616c 6c5f 6664 735f 6578 6365 7074 287b  all_fds_except({
+0001e510: 302c 2031 2c20 327d 290a 2020 2020 6f73  0, 1, 2}).    os
+0001e520: 2e65 7865 6376 2873 7973 2e65 7865 6375  .execv(sys.execu
+0001e530: 7461 626c 652c 205b 7379 732e 6578 6563  table, [sys.exec
+0001e540: 7574 6162 6c65 5d20 2b20 7379 732e 6172  utable] + sys.ar
+0001e550: 6776 290a 2020 2020 7261 6973 6520 4578  gv).    raise Ex
+0001e560: 6365 7074 696f 6e28 2272 6573 7461 7274  ception("restart
+0001e570: 5f72 6574 7572 6e6e 3a20 6578 6563 7620  _returnn: execv 
+0001e580: 6661 696c 6564 2229 0a0a 0a64 6566 206d  failed")...def m
+0001e590: 6179 6265 5f72 6573 7461 7274 5f72 6574  aybe_restart_ret
+0001e5a0: 7572 6e6e 5f77 6974 685f 6174 666f 726b  urnn_with_atfork
+0001e5b0: 5f70 6174 6368 2829 3a0a 2020 2020 2222  _patch():.    ""
+0001e5c0: 220a 2020 2020 5768 6174 2077 6520 7761  ".    What we wa
+0001e5d0: 6e74 3a20 7375 6270 726f 6365 7373 2e50  nt: subprocess.P
+0001e5e0: 6f70 656e 2074 6f20 616c 7761 7973 2077  open to always w
+0001e5f0: 6f72 6b2e 0a20 2020 2050 726f 626c 656d  ork..    Problem
+0001e600: 3a20 4974 2075 7365 7320 666f 726b 2b65  : It uses fork+e
+0001e610: 7865 6320 696e 7465 726e 616c 6c79 2069  xec internally i
+0001e620: 6e20 7375 6270 726f 6365 7373 5f66 6f72  n subprocess_for
+0001e630: 6b5f 6578 6563 2c20 7669 6120 5f70 6f73  k_exec, via _pos
+0001e640: 6978 7375 6270 726f 6365 7373 2e66 6f72  ixsubprocess.for
+0001e650: 6b5f 6578 6563 2e0a 2020 2020 5468 6174  k_exec..    That
+0001e660: 2069 7320 6120 7072 6f62 6c65 6d20 6265   is a problem be
+0001e670: 6361 7573 6520 666f 726b 2063 616e 2074  cause fork can t
+0001e680: 7269 6767 6572 2061 6e79 2061 7466 6f72  rigger any atfor
+0001e690: 6b20 6861 6e64 6c65 7273 2072 6567 6973  k handlers regis
+0001e6a0: 7465 7265 6420 7669 6120 7074 6872 6561  tered via pthrea
+0001e6b0: 645f 6174 666f 726b 2c0a 2020 2020 616e  d_atfork,.    an
+0001e6c0: 6420 7468 6f73 6520 6361 6e20 6372 6173  d those can cras
+0001e6d0: 682f 6465 6164 6c6f 636b 2069 6e20 736f  h/deadlock in so
+0001e6e0: 6d65 2063 6173 6573 2e0a 0a20 2020 2068  me cases...    h
+0001e6f0: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+0001e700: 6d2f 7465 6e73 6f72 666c 6f77 2f74 656e  m/tensorflow/ten
+0001e710: 736f 7266 6c6f 772f 6973 7375 6573 2f31  sorflow/issues/1
+0001e720: 3338 3032 0a20 2020 2068 7474 7073 3a2f  3802.    https:/
+0001e730: 2f67 6974 6875 622e 636f 6d2f 7869 616e  /github.com/xian
+0001e740: 7969 2f4f 7065 6e42 4c41 532f 6973 7375  yi/OpenBLAS/issu
+0001e750: 6573 2f32 3430 0a20 2020 2068 7474 7073  es/240.    https
+0001e760: 3a2f 2f74 7261 632e 7361 6765 6d61 7468  ://trac.sagemath
+0001e770: 2e6f 7267 2f74 6963 6b65 742f 3232 3032  .org/ticket/2202
+0001e780: 310a 2020 2020 6874 7470 733a 2f2f 6275  1.    https://bu
+0001e790: 6773 2e70 7974 686f 6e2e 6f72 672f 6973  gs.python.org/is
+0001e7a0: 7375 6533 3138 3134 0a20 2020 2068 7474  sue31814.    htt
+0001e7b0: 7073 3a2f 2f73 7461 636b 6f76 6572 666c  ps://stackoverfl
+0001e7c0: 6f77 2e63 6f6d 2f71 7565 7374 696f 6e73  ow.com/questions
+0001e7d0: 2f34 3638 3435 3439 362f 6c64 2d70 7265  /46845496/ld-pre
+0001e7e0: 6c6f 6164 2d61 6e64 2d6c 696e 6b61 6765  load-and-linkage
+0001e7f0: 0a20 2020 2068 7474 7073 3a2f 2f73 7461  .    https://sta
+0001e800: 636b 6f76 6572 666c 6f77 2e63 6f6d 2f71  ckoverflow.com/q
+0001e810: 7565 7374 696f 6e73 2f34 3638 3130 3539  uestions/4681059
+0001e820: 372f 666f 726b 6578 6563 2d77 6974 686f  7/forkexec-witho
+0001e830: 7574 2d61 7466 6f72 6b2d 6861 6e64 6c65  ut-atfork-handle
+0001e840: 7273 0a0a 2020 2020 5468 6520 736f 6c75  rs..    The solu
+0001e850: 7469 6f6e 2068 6572 653a 204a 7573 7420  tion here: Just 
+0001e860: 6f76 6572 7269 6465 2070 7468 7265 6164  override pthread
+0001e870: 5f61 7466 6f72 6b2c 2076 6961 204c 445f  _atfork, via LD_
+0001e880: 5052 454c 4f41 442e 0a20 2020 204e 6f74  PRELOAD..    Not
+0001e890: 6520 7468 6174 2069 6e20 736f 6d65 2063  e that in some c
+0001e8a0: 6173 6573 2c20 7468 6973 2069 7320 6e6f  ases, this is no
+0001e8b0: 7420 656e 6f75 6768 2028 7365 6520 7468  t enough (see th
+0001e8c0: 6520 534f 2064 6973 6375 7373 696f 6e29  e SO discussion)
+0001e8d0: 2c0a 2020 2020 736f 2077 6520 616c 736f  ,.    so we also
+0001e8e0: 206f 7665 7277 7269 7465 2066 6f72 6b20   overwrite fork 
+0001e8f0: 6974 7365 6c66 2e0a 2020 2020 5365 6520  itself..    See 
+0001e900: 616c 736f 2074 6573 7473 2f74 6573 745f  also tests/test_
+0001e910: 666f 726b 5f65 7865 632e 7079 2066 6f72  fork_exec.py for
+0001e920: 2061 2064 656d 6f2e 0a20 2020 2022 2222   a demo..    """
+0001e930: 0a20 2020 2069 6620 6f73 2e65 6e76 6972  .    if os.envir
+0001e940: 6f6e 2e67 6574 2822 5f5f 5245 5455 524e  on.get("__RETURN
+0001e950: 4e5f 4154 464f 524b 5f50 4154 4348 4544  N_ATFORK_PATCHED
+0001e960: 2229 203d 3d20 2231 223a 0a20 2020 2020  ") == "1":.     
+0001e970: 2020 2070 7269 6e74 2822 5275 6e6e 696e     print("Runnin
+0001e980: 6720 7769 7468 2070 6174 6368 6564 2061  g with patched a
+0001e990: 7466 6f72 6b2e 2229 0a20 2020 2020 2020  tfork.").       
+0001e9a0: 2072 6574 7572 6e0a 2020 2020 6966 206f   return.    if o
+0001e9b0: 732e 656e 7669 726f 6e2e 6765 7428 225f  s.environ.get("_
+0001e9c0: 5f52 4554 5552 4e4e 5f54 5259 5f41 5446  _RETURNN_TRY_ATF
+0001e9d0: 4f52 4b5f 5041 5443 4845 4422 2920 3d3d  ORK_PATCHED") ==
+0001e9e0: 2022 3122 3a0a 2020 2020 2020 2020 7072   "1":.        pr
+0001e9f0: 696e 7428 2250 6174 6368 696e 6720 6174  int("Patching at
+0001ea00: 666f 726b 2064 6964 206e 6f74 2077 6f72  fork did not wor
+0001ea10: 6b21 2057 696c 6c20 636f 6e74 696e 7565  k! Will continue
+0001ea20: 2061 6e79 7761 792e 2229 0a20 2020 2020   anyway.").     
+0001ea30: 2020 2072 6574 7572 6e0a 2020 2020 6c69     return.    li
+0001ea40: 6220 3d20 6765 745f 7061 7463 685f 6174  b = get_patch_at
+0001ea50: 666f 726b 5f6c 6962 2829 0a20 2020 2065  fork_lib().    e
+0001ea60: 6e76 203d 206f 732e 656e 7669 726f 6e2e  nv = os.environ.
+0001ea70: 636f 7079 2829 0a20 2020 2065 6e76 5b22  copy().    env["
+0001ea80: 4459 4c44 5f49 4e53 4552 545f 4c49 4252  DYLD_INSERT_LIBR
+0001ea90: 4152 4945 5322 2069 6620 7379 732e 706c  ARIES" if sys.pl
+0001eaa0: 6174 666f 726d 203d 3d20 2264 6172 7769  atform == "darwi
+0001eab0: 6e22 2065 6c73 6520 224c 445f 5052 454c  n" else "LD_PREL
+0001eac0: 4f41 4422 5d20 3d20 6c69 620a 2020 2020  OAD"] = lib.    
+0001ead0: 656e 765b 225f 5f52 4554 5552 4e4e 5f54  env["__RETURNN_T
+0001eae0: 5259 5f41 5446 4f52 4b5f 5041 5443 4845  RY_ATFORK_PATCHE
+0001eaf0: 4422 5d20 3d20 2231 220a 2020 2020 7072  D"] = "1".    pr
+0001eb00: 696e 7428 2252 6573 7461 7274 696e 6720  int("Restarting 
+0001eb10: 5265 7475 726e 6e20 7769 7468 2061 7466  Returnn with atf
+0001eb20: 6f72 6b20 7061 7463 682e 2e2e 222c 2073  ork patch...", s
+0001eb30: 7973 2e65 7865 6375 7461 626c 652c 2073  ys.executable, s
+0001eb40: 7973 2e61 7267 7629 0a20 2020 2073 7973  ys.argv).    sys
+0001eb50: 2e73 7464 6f75 742e 666c 7573 6828 290a  .stdout.flush().
+0001eb60: 2020 2020 6f73 2e65 7865 6376 7065 2873      os.execvpe(s
+0001eb70: 7973 2e65 7865 6375 7461 626c 652c 205b  ys.executable, [
+0001eb80: 7379 732e 6578 6563 7574 6162 6c65 5d20  sys.executable] 
+0001eb90: 2b20 7379 732e 6172 6776 2c20 656e 7629  + sys.argv, env)
+0001eba0: 0a20 2020 2070 7269 6e74 2822 6578 6563  .    print("exec
+0001ebb0: 7670 6520 6469 6420 6e6f 7420 776f 726b  vpe did not work
+0001ebc0: 3f22 290a 0a0a 6465 6620 636c 6f73 655f  ?")...def close_
+0001ebd0: 616c 6c5f 6664 735f 6578 6365 7074 2865  all_fds_except(e
+0001ebe0: 7863 6570 745f 6664 7329 3a0a 2020 2020  xcept_fds):.    
+0001ebf0: 2222 220a 2020 2020 4361 6c6c 7320 6f73  """.    Calls os
+0001ec00: 2e63 6c6f 7365 7261 6e67 6520 6578 6365  .closerange exce
+0001ec10: 7074 2066 6f72 2074 6865 2067 6976 656e  pt for the given
+0001ec20: 2066 6473 2e0a 2020 2020 436f 6465 2061   fds..    Code a
+0001ec30: 646f 7074 6564 2061 6e64 2065 7874 656e  dopted and exten
+0001ec40: 6465 6420 6672 6f6d 206d 756c 7469 7072  ded from multipr
+0001ec50: 6f63 6573 7369 6e67 2e75 7469 6c2e 636c  ocessing.util.cl
+0001ec60: 6f73 655f 616c 6c5f 6664 735f 6578 6365  ose_all_fds_exce
+0001ec70: 7074 2e0a 0a20 2020 203a 7061 7261 6d20  pt...    :param 
+0001ec80: 7479 7069 6e67 2e43 6f6c 6c65 6374 696f  typing.Collectio
+0001ec90: 6e5b 696e 745d 2065 7863 6570 745f 6664  n[int] except_fd
+0001eca0: 733a 2075 7375 616c 6c79 2061 7420 6c65  s: usually at le
+0001ecb0: 6173 7420 7b30 2c31 2c32 7d0a 2020 2020  ast {0,1,2}.    
+0001ecc0: 2222 220a 2020 2020 2320 6e6f 696e 7370  """.    # noinsp
+0001ecd0: 6563 7469 6f6e 2050 7942 726f 6164 4578  ection PyBroadEx
+0001ece0: 6365 7074 696f 6e0a 2020 2020 7472 793a  ception.    try:
+0001ecf0: 0a20 2020 2020 2020 206d 6178 5f66 6420  .        max_fd 
+0001ed00: 3d20 6f73 2e73 7973 636f 6e66 2822 5343  = os.sysconf("SC
+0001ed10: 5f4f 5045 4e5f 4d41 5822 290a 2020 2020  _OPEN_MAX").    
+0001ed20: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+0001ed30: 3a0a 2020 2020 2020 2020 6d61 785f 6664  :.        max_fd
+0001ed40: 203d 2032 3536 0a0a 2020 2020 6578 6365   = 256..    exce
+0001ed50: 7074 5f66 6473 203d 2073 6f72 7465 6428  pt_fds = sorted(
+0001ed60: 6c69 7374 2865 7863 6570 745f 6664 7329  list(except_fds)
+0001ed70: 202b 205b 2d31 2c20 6d61 785f 6664 5d29   + [-1, max_fd])
+0001ed80: 0a20 2020 2061 7373 6572 7420 6578 6365  .    assert exce
+0001ed90: 7074 5f66 6473 5b30 5d20 3d3d 202d 3120  pt_fds[0] == -1 
+0001eda0: 616e 6420 6578 6365 7074 5f66 6473 5b2d  and except_fds[-
+0001edb0: 315d 203d 3d20 6d61 785f 6664 2c20 2266  1] == max_fd, "f
+0001edc0: 6420 696e 7661 6c69 6422 0a0a 2020 2020  d invalid"..    
+0001edd0: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+0001ede0: 656e 2865 7863 6570 745f 6664 7329 202d  en(except_fds) -
+0001edf0: 2031 293a 0a20 2020 2020 2020 2069 6620   1):.        if 
+0001ee00: 6578 6365 7074 5f66 6473 5b69 5d20 2b20  except_fds[i] + 
+0001ee10: 3120 3c20 6578 6365 7074 5f66 6473 5b69  1 < except_fds[i
+0001ee20: 202b 2031 5d3a 0a20 2020 2020 2020 2020   + 1]:.         
+0001ee30: 2020 206f 732e 636c 6f73 6572 616e 6765     os.closerange
+0001ee40: 2865 7863 6570 745f 6664 735b 695d 202b  (except_fds[i] +
+0001ee50: 2031 2c20 6578 6365 7074 5f66 6473 5b69   1, except_fds[i
+0001ee60: 202b 2031 5d29 0a0a 0a63 6c61 7373 2053   + 1])...class S
+0001ee70: 7461 7473 3a0a 2020 2020 2222 220a 2020  tats:.    """.  
+0001ee80: 2020 436f 6c6c 6563 7473 206d 6561 6e20    Collects mean 
+0001ee90: 616e 6420 7661 7269 616e 6365 2c20 7275  and variance, ru
+0001eea0: 6e6e 696e 6720 6176 6572 6167 652e 0a0a  nning average...
+0001eeb0: 2020 2020 6874 7470 733a 2f2f 656e 2e77      https://en.w
+0001eec0: 696b 6970 6564 6961 2e6f 7267 2f77 696b  ikipedia.org/wik
+0001eed0: 692f 416c 676f 7269 7468 6d73 5f66 6f72  i/Algorithms_for
+0001eee0: 5f63 616c 6375 6c61 7469 6e67 5f76 6172  _calculating_var
+0001eef0: 6961 6e63 650a 2020 2020 2222 220a 0a20  iance.    """.. 
+0001ef00: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+0001ef10: 7365 6c66 2c20 666f 726d 6174 5f73 7472  self, format_str
+0001ef20: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0001ef30: 2222 220a 2020 2020 2020 2020 3a70 6172  """.        :par
+0001ef40: 616d 204e 6f6e 657c 2828 666c 6f61 747c  am None|((float|
+0001ef50: 6e75 6d70 792e 6e64 6172 7261 7929 2d3e  numpy.ndarray)->
+0001ef60: 7374 7229 2066 6f72 6d61 745f 7374 723a  str) format_str:
+0001ef70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001ef80: 2020 2020 2073 656c 662e 666f 726d 6174       self.format
+0001ef90: 5f73 7472 203d 2066 6f72 6d61 745f 7374  _str = format_st
+0001efa0: 7220 6f72 2073 7472 0a20 2020 2020 2020  r or str.       
+0001efb0: 2073 656c 662e 6d65 616e 203d 2030 2e30   self.mean = 0.0
+0001efc0: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
+0001efd0: 616e 5f73 7120 3d20 302e 300a 2020 2020  an_sq = 0.0.    
+0001efe0: 2020 2020 7365 6c66 2e76 6172 203d 2030      self.var = 0
+0001eff0: 2e30 0a20 2020 2020 2020 2073 656c 662e  .0.        self.
+0001f000: 6d69 6e20 3d20 4e6f 6e65 0a20 2020 2020  min = None.     
+0001f010: 2020 2073 656c 662e 6d61 7820 3d20 4e6f     self.max = No
+0001f020: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+0001f030: 746f 7461 6c5f 6461 7461 5f6c 656e 203d  total_data_len =
+0001f040: 2030 0a20 2020 2020 2020 2073 656c 662e   0.        self.
+0001f050: 6e75 6d5f 7365 7173 203d 2030 0a0a 2020  num_seqs = 0..  
+0001f060: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
+0001f070: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
+0001f080: 7365 6c66 2e6e 756d 5f73 6571 7320 3e20  self.num_seqs > 
+0001f090: 303a 0a20 2020 2020 2020 2020 2020 2069  0:.            i
+0001f0a0: 6620 7365 6c66 2e6e 756d 5f73 6571 7320  f self.num_seqs 
+0001f0b0: 3d3d 2073 656c 662e 746f 7461 6c5f 6461  == self.total_da
+0001f0c0: 7461 5f6c 656e 3a0a 2020 2020 2020 2020  ta_len:.        
+0001f0d0: 2020 2020 2020 2020 6578 7472 615f 7374          extra_st
+0001f0e0: 7220 3d20 2261 7667 5f64 6174 615f 6c65  r = "avg_data_le
+0001f0f0: 6e3d 3122 0a20 2020 2020 2020 2020 2020  n=1".           
+0001f100: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001f110: 2020 2020 2020 2065 7874 7261 5f73 7472         extra_str
+0001f120: 203d 2022 746f 7461 6c5f 6461 7461 5f6c   = "total_data_l
+0001f130: 656e 3d25 692c 2061 7667 5f64 6174 615f  en=%i, avg_data_
+0001f140: 6c65 6e3d 2566 2220 2520 280a 2020 2020  len=%f" % (.    
+0001f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f160: 7365 6c66 2e74 6f74 616c 5f64 6174 615f  self.total_data_
+0001f170: 6c65 6e2c 0a20 2020 2020 2020 2020 2020  len,.           
+0001f180: 2020 2020 2020 2020 2066 6c6f 6174 2873           float(s
+0001f190: 656c 662e 746f 7461 6c5f 6461 7461 5f6c  elf.total_data_l
+0001f1a0: 656e 2920 2f20 7365 6c66 2e6e 756d 5f73  en) / self.num_s
+0001f1b0: 6571 732c 0a20 2020 2020 2020 2020 2020  eqs,.           
+0001f1c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0001f1d0: 2020 2072 6574 7572 6e20 2253 7461 7473     return "Stats
+0001f1e0: 286d 6561 6e3d 2573 2c20 7374 645f 6465  (mean=%s, std_de
+0001f1f0: 763d 2573 2c20 6d69 6e3d 2573 2c20 6d61  v=%s, min=%s, ma
+0001f200: 783d 2573 2c20 6e75 6d5f 7365 7173 3d25  x=%s, num_seqs=%
+0001f210: 692c 2025 7329 2220 2520 280a 2020 2020  i, %s)" % (.    
+0001f220: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001f230: 2e66 6f72 6d61 745f 7374 7228 7365 6c66  .format_str(self
+0001f240: 2e67 6574 5f6d 6561 6e28 2929 2c0a 2020  .get_mean()),.  
+0001f250: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001f260: 6c66 2e66 6f72 6d61 745f 7374 7228 7365  lf.format_str(se
+0001f270: 6c66 2e67 6574 5f73 7464 5f64 6576 2829  lf.get_std_dev()
+0001f280: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001f290: 2020 2073 656c 662e 666f 726d 6174 5f73     self.format_s
+0001f2a0: 7472 2873 656c 662e 6d69 6e29 2c0a 2020  tr(self.min),.  
+0001f2b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001f2c0: 6c66 2e66 6f72 6d61 745f 7374 7228 7365  lf.format_str(se
+0001f2d0: 6c66 2e6d 6178 292c 0a20 2020 2020 2020  lf.max),.       
+0001f2e0: 2020 2020 2020 2020 2073 656c 662e 6e75           self.nu
+0001f2f0: 6d5f 7365 7173 2c0a 2020 2020 2020 2020  m_seqs,.        
+0001f300: 2020 2020 2020 2020 6578 7472 615f 7374          extra_st
+0001f310: 722c 0a20 2020 2020 2020 2020 2020 2029  r,.            )
+0001f320: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001f330: 2253 7461 7473 286e 756d 5f73 6571 733d  "Stats(num_seqs=
+0001f340: 3029 220a 0a20 2020 2064 6566 2063 6f6c  0)"..    def col
+0001f350: 6c65 6374 2873 656c 662c 2064 6174 6129  lect(self, data)
+0001f360: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001f370: 2020 2020 2020 3a70 6172 616d 206e 756d        :param num
+0001f380: 7079 2e6e 6461 7272 6179 7c6c 6973 745b  py.ndarray|list[
+0001f390: 696e 745d 7c6c 6973 745b 666c 6f61 745d  int]|list[float]
+0001f3a0: 2064 6174 613a 2073 6861 7065 2028 7469   data: shape (ti
+0001f3b0: 6d65 2c20 6469 6d29 206f 7220 2874 696d  me, dim) or (tim
+0001f3c0: 652c 290a 2020 2020 2020 2020 2222 220a  e,).        """.
+0001f3d0: 2020 2020 2020 2020 696d 706f 7274 206e          import n
+0001f3e0: 756d 7079 0a0a 2020 2020 2020 2020 6966  umpy..        if
+0001f3f0: 2069 7369 6e73 7461 6e63 6528 6461 7461   isinstance(data
+0001f400: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
+0001f410: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
+0001f420: 7461 203d 206e 756d 7079 2e61 7272 6179  ta = numpy.array
+0001f430: 2864 6174 6129 0a20 2020 2020 2020 2061  (data).        a
+0001f440: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
+0001f450: 2864 6174 612c 206e 756d 7079 2e6e 6461  (data, numpy.nda
+0001f460: 7272 6179 290a 2020 2020 2020 2020 6173  rray).        as
+0001f470: 7365 7274 2064 6174 612e 6e64 696d 203e  sert data.ndim >
+0001f480: 3d20 310a 2020 2020 2020 2020 6966 2064  = 1.        if d
+0001f490: 6174 612e 7368 6170 655b 305d 203d 3d20  ata.shape[0] == 
+0001f4a0: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+0001f4b0: 6574 7572 6e0a 2020 2020 2020 2020 7365  eturn.        se
+0001f4c0: 6c66 2e6e 756d 5f73 6571 7320 2b3d 2031  lf.num_seqs += 1
+0001f4d0: 0a20 2020 2020 2020 2064 6174 615f 6d69  .        data_mi
+0001f4e0: 6e20 3d20 6e75 6d70 792e 6d69 6e28 6461  n = numpy.min(da
+0001f4f0: 7461 2c20 6178 6973 3d30 290a 2020 2020  ta, axis=0).    
+0001f500: 2020 2020 6461 7461 5f6d 6178 203d 206e      data_max = n
+0001f510: 756d 7079 2e6d 6178 2864 6174 612c 2061  umpy.max(data, a
+0001f520: 7869 733d 3029 0a20 2020 2020 2020 2069  xis=0).        i
+0001f530: 6620 7365 6c66 2e6d 696e 2069 7320 4e6f  f self.min is No
+0001f540: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0001f550: 7365 6c66 2e6d 696e 203d 2064 6174 615f  self.min = data_
+0001f560: 6d69 6e0a 2020 2020 2020 2020 2020 2020  min.            
+0001f570: 7365 6c66 2e6d 6178 203d 2064 6174 615f  self.max = data_
+0001f580: 6d61 780a 2020 2020 2020 2020 656c 7365  max.        else
+0001f590: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0001f5a0: 6c66 2e6d 696e 203d 206e 756d 7079 2e6d  lf.min = numpy.m
+0001f5b0: 696e 696d 756d 2873 656c 662e 6d69 6e2c  inimum(self.min,
+0001f5c0: 2064 6174 615f 6d69 6e29 0a20 2020 2020   data_min).     
+0001f5d0: 2020 2020 2020 2073 656c 662e 6d61 7820         self.max 
+0001f5e0: 3d20 6e75 6d70 792e 6d61 7869 6d75 6d28  = numpy.maximum(
+0001f5f0: 7365 6c66 2e6d 6178 2c20 6461 7461 5f6d  self.max, data_m
+0001f600: 6178 290a 2020 2020 2020 2020 6e65 775f  ax).        new_
+0001f610: 746f 7461 6c5f 6461 7461 5f6c 656e 203d  total_data_len =
+0001f620: 2073 656c 662e 746f 7461 6c5f 6461 7461   self.total_data
+0001f630: 5f6c 656e 202b 2064 6174 612e 7368 6170  _len + data.shap
+0001f640: 655b 305d 0a20 2020 2020 2020 206d 6561  e[0].        mea
+0001f650: 6e5f 6469 6666 203d 206e 756d 7079 2e6d  n_diff = numpy.m
+0001f660: 6561 6e28 6461 7461 2c20 6178 6973 3d30  ean(data, axis=0
+0001f670: 2920 2d20 7365 6c66 2e6d 6561 6e0a 2020  ) - self.mean.  
+0001f680: 2020 2020 2020 6d5f 6120 3d20 7365 6c66        m_a = self
+0001f690: 2e76 6172 202a 2073 656c 662e 746f 7461  .var * self.tota
+0001f6a0: 6c5f 6461 7461 5f6c 656e 0a20 2020 2020  l_data_len.     
+0001f6b0: 2020 206d 5f62 203d 206e 756d 7079 2e76     m_b = numpy.v
+0001f6c0: 6172 2864 6174 612c 2061 7869 733d 3029  ar(data, axis=0)
+0001f6d0: 202a 2064 6174 612e 7368 6170 655b 305d   * data.shape[0]
+0001f6e0: 0a20 2020 2020 2020 206d 3220 3d20 6d5f  .        m2 = m_
+0001f6f0: 6120 2b20 6d5f 6220 2b20 6d65 616e 5f64  a + m_b + mean_d
+0001f700: 6966 662a 2a32 202a 2073 656c 662e 746f  iff**2 * self.to
+0001f710: 7461 6c5f 6461 7461 5f6c 656e 202a 2064  tal_data_len * d
+0001f720: 6174 612e 7368 6170 655b 305d 202f 206e  ata.shape[0] / n
+0001f730: 6577 5f74 6f74 616c 5f64 6174 615f 6c65  ew_total_data_le
+0001f740: 6e0a 2020 2020 2020 2020 7365 6c66 2e76  n.        self.v
+0001f750: 6172 203d 206d 3220 2f20 6e65 775f 746f  ar = m2 / new_to
+0001f760: 7461 6c5f 6461 7461 5f6c 656e 0a20 2020  tal_data_len.   
+0001f770: 2020 2020 2064 6174 615f 7375 6d20 3d20       data_sum = 
+0001f780: 6e75 6d70 792e 7375 6d28 6461 7461 2c20  numpy.sum(data, 
+0001f790: 6178 6973 3d30 290a 2020 2020 2020 2020  axis=0).        
+0001f7a0: 6465 6c74 6120 3d20 6461 7461 5f73 756d  delta = data_sum
+0001f7b0: 202d 2073 656c 662e 6d65 616e 202a 2064   - self.mean * d
+0001f7c0: 6174 612e 7368 6170 655b 305d 0a20 2020  ata.shape[0].   
+0001f7d0: 2020 2020 2073 656c 662e 6d65 616e 202b       self.mean +
+0001f7e0: 3d20 6465 6c74 6120 2f20 6e65 775f 746f  = delta / new_to
+0001f7f0: 7461 6c5f 6461 7461 5f6c 656e 0a20 2020  tal_data_len.   
+0001f800: 2020 2020 2064 656c 7461 5f73 7120 3d20       delta_sq = 
+0001f810: 6e75 6d70 792e 7375 6d28 6461 7461 202a  numpy.sum(data *
+0001f820: 2064 6174 612c 2061 7869 733d 3029 202d   data, axis=0) -
+0001f830: 2073 656c 662e 6d65 616e 5f73 7120 2a20   self.mean_sq * 
+0001f840: 6461 7461 2e73 6861 7065 5b30 5d0a 2020  data.shape[0].  
+0001f850: 2020 2020 2020 7365 6c66 2e6d 6561 6e5f        self.mean_
+0001f860: 7371 202b 3d20 6465 6c74 615f 7371 202f  sq += delta_sq /
+0001f870: 206e 6577 5f74 6f74 616c 5f64 6174 615f   new_total_data_
+0001f880: 6c65 6e0a 2020 2020 2020 2020 7365 6c66  len.        self
+0001f890: 2e74 6f74 616c 5f64 6174 615f 6c65 6e20  .total_data_len 
+0001f8a0: 3d20 6e65 775f 746f 7461 6c5f 6461 7461  = new_total_data
+0001f8b0: 5f6c 656e 0a0a 2020 2020 6465 6620 6765  _len..    def ge
+0001f8c0: 745f 6d65 616e 2873 656c 6629 3a0a 2020  t_mean(self):.  
+0001f8d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001f8e0: 2020 3a72 6574 7572 6e3a 206d 6561 6e2c    :return: mean,
+0001f8f0: 2073 6861 7065 2028 6469 6d2c 290a 2020   shape (dim,).  
+0001f900: 2020 2020 2020 3a72 7479 7065 3a20 6e75        :rtype: nu
+0001f910: 6d70 792e 6e64 6172 7261 790a 2020 2020  mpy.ndarray.    
+0001f920: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001f930: 6173 7365 7274 2073 656c 662e 6e75 6d5f  assert self.num_
+0001f940: 7365 7173 203e 2030 0a20 2020 2020 2020  seqs > 0.       
+0001f950: 2072 6574 7572 6e20 7365 6c66 2e6d 6561   return self.mea
+0001f960: 6e0a 0a20 2020 2064 6566 2067 6574 5f73  n..    def get_s
+0001f970: 7464 5f64 6576 2873 656c 6629 3a0a 2020  td_dev(self):.  
+0001f980: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001f990: 2020 3a72 6574 7572 6e3a 2073 7464 2064    :return: std d
+0001f9a0: 6576 2c20 7368 6170 6520 2864 696d 2c29  ev, shape (dim,)
+0001f9b0: 0a20 2020 2020 2020 203a 7274 7970 653a  .        :rtype:
+0001f9c0: 206e 756d 7079 2e6e 6461 7272 6179 0a20   numpy.ndarray. 
+0001f9d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001f9e0: 2020 2069 6d70 6f72 7420 6e75 6d70 790a     import numpy.
+0001f9f0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+0001fa00: 7365 6c66 2e6e 756d 5f73 6571 7320 3e20  self.num_seqs > 
+0001fa10: 300a 2020 2020 2020 2020 7265 7475 726e  0.        return
+0001fa20: 206e 756d 7079 2e73 7172 7428 7365 6c66   numpy.sqrt(self
+0001fa30: 2e76 6172 290a 2020 2020 2020 2020 2320  .var).        # 
+0001fa40: 7265 7475 726e 206e 756d 7079 2e73 7172  return numpy.sqr
+0001fa50: 7428 7365 6c66 2e6d 6561 6e5f 7371 202d  t(self.mean_sq -
+0001fa60: 2073 656c 662e 6d65 616e 202a 2073 656c   self.mean * sel
+0001fa70: 662e 6d65 616e 290a 0a20 2020 2064 6566  f.mean)..    def
+0001fa80: 2064 756d 7028 7365 6c66 2c20 6f75 7470   dump(self, outp
+0001fa90: 7574 5f66 696c 655f 7072 6566 6978 3d4e  ut_file_prefix=N
+0001faa0: 6f6e 652c 2073 7472 6561 6d3d 4e6f 6e65  one, stream=None
+0001fab0: 2c20 7374 7265 616d 5f70 7265 6669 783d  , stream_prefix=
+0001fac0: 2222 293a 0a20 2020 2020 2020 2022 2222  ""):.        """
+0001fad0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001fae0: 7374 727c 4e6f 6e65 206f 7574 7075 745f  str|None output_
+0001faf0: 6669 6c65 5f70 7265 6669 783a 2069 6620  file_prefix: if 
+0001fb00: 6769 7665 6e2c 2077 696c 6c20 6e75 6d70  given, will nump
+0001fb10: 792e 7361 7665 7478 7420 6d65 616e 7c73  y.savetxt mean|s
+0001fb20: 7464 5f64 6576 2074 6f20 6469 736b 0a20  td_dev to disk. 
+0001fb30: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
+0001fb40: 7220 7374 7265 616d 5f70 7265 6669 783a  r stream_prefix:
+0001fb50: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001fb60: 696f 2e54 6578 7449 4f42 6173 6520 7374  io.TextIOBase st
+0001fb70: 7265 616d 3a20 7379 732e 7374 646f 7574  ream: sys.stdout
+0001fb80: 2062 7920 6465 6661 756c 740a 2020 2020   by default.    
+0001fb90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001fba0: 6966 2073 7472 6561 6d20 6973 204e 6f6e  if stream is Non
+0001fbb0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+0001fbc0: 7472 6561 6d20 3d20 7379 732e 7374 646f  tream = sys.stdo
+0001fbd0: 7574 0a20 2020 2020 2020 2069 6d70 6f72  ut.        impor
+0001fbe0: 7420 6e75 6d70 790a 0a20 2020 2020 2020  t numpy..       
+0001fbf0: 2070 7269 6e74 2822 2573 5374 6174 733a   print("%sStats:
+0001fc00: 2220 2520 7374 7265 616d 5f70 7265 6669  " % stream_prefi
+0001fc10: 782c 2066 696c 653d 7374 7265 616d 290a  x, file=stream).
+0001fc20: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0001fc30: 6e75 6d5f 7365 7173 2021 3d20 7365 6c66  num_seqs != self
+0001fc40: 2e74 6f74 616c 5f64 6174 615f 6c65 6e3a  .total_data_len:
+0001fc50: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001fc60: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+0001fc70: 2020 2020 2220 2025 6920 7365 7173 2c20      "  %i seqs, 
+0001fc80: 2569 2074 6f74 616c 2066 7261 6d65 732c  %i total frames,
+0001fc90: 2025 6620 6176 6572 6167 6520 6672 616d   %f average fram
+0001fca0: 6573 220a 2020 2020 2020 2020 2020 2020  es".            
+0001fcb0: 2020 2020 2520 2873 656c 662e 6e75 6d5f      % (self.num_
+0001fcc0: 7365 7173 2c20 7365 6c66 2e74 6f74 616c  seqs, self.total
+0001fcd0: 5f64 6174 615f 6c65 6e2c 2073 656c 662e  _data_len, self.
+0001fce0: 746f 7461 6c5f 6461 7461 5f6c 656e 202f  total_data_len /
+0001fcf0: 2066 6c6f 6174 2873 656c 662e 6e75 6d5f   float(self.num_
+0001fd00: 7365 7173 2929 2c0a 2020 2020 2020 2020  seqs)),.        
+0001fd10: 2020 2020 2020 2020 6669 6c65 3d73 7472          file=str
+0001fd20: 6561 6d2c 0a20 2020 2020 2020 2020 2020  eam,.           
+0001fd30: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
+0001fd40: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001fd50: 6e74 2822 2020 2569 2073 6571 7322 2025  nt("  %i seqs" %
+0001fd60: 2028 7365 6c66 2e6e 756d 5f73 6571 732c   (self.num_seqs,
+0001fd70: 292c 2066 696c 653d 7374 7265 616d 290a  ), file=stream).
+0001fd80: 2020 2020 2020 2020 7072 696e 7428 2220          print(" 
+0001fd90: 204d 6561 6e3a 2025 7322 2025 2028 7365   Mean: %s" % (se
+0001fda0: 6c66 2e66 6f72 6d61 745f 7374 7228 7365  lf.format_str(se
+0001fdb0: 6c66 2e67 6574 5f6d 6561 6e28 2929 2c29  lf.get_mean()),)
+0001fdc0: 2c20 6669 6c65 3d73 7472 6561 6d29 0a20  , file=stream). 
+0001fdd0: 2020 2020 2020 2070 7269 6e74 2822 2020         print("  
+0001fde0: 5374 6420 6465 763a 2025 7322 2025 2028  Std dev: %s" % (
+0001fdf0: 7365 6c66 2e66 6f72 6d61 745f 7374 7228  self.format_str(
+0001fe00: 7365 6c66 2e67 6574 5f73 7464 5f64 6576  self.get_std_dev
+0001fe10: 2829 292c 292c 2066 696c 653d 7374 7265  ()),), file=stre
+0001fe20: 616d 290a 2020 2020 2020 2020 7072 696e  am).        prin
+0001fe30: 7428 2220 204d 696e 2f6d 6178 3a20 2573  t("  Min/max: %s
+0001fe40: 202f 2025 7322 2025 2028 7365 6c66 2e66   / %s" % (self.f
+0001fe50: 6f72 6d61 745f 7374 7228 7365 6c66 2e6d  ormat_str(self.m
+0001fe60: 696e 292c 2073 656c 662e 666f 726d 6174  in), self.format
+0001fe70: 5f73 7472 2873 656c 662e 6d61 7829 292c  _str(self.max)),
+0001fe80: 2066 696c 653d 7374 7265 616d 290a 2020   file=stream).  
+0001fe90: 2020 2020 2020 2320 7072 696e 7428 2253        # print("S
+0001fea0: 7464 2064 6576 2028 6e61 6976 6529 3a20  td dev (naive): 
+0001feb0: 2573 2220 2520 6e75 6d70 792e 7371 7274  %s" % numpy.sqrt
+0001fec0: 2873 656c 662e 6d65 616e 5f73 7120 2d20  (self.mean_sq - 
+0001fed0: 7365 6c66 2e6d 6561 6e20 2a20 7365 6c66  self.mean * self
+0001fee0: 2e6d 6561 6e29 2c20 6669 6c65 3d73 7472  .mean), file=str
+0001fef0: 6561 6d29 0a20 2020 2020 2020 2069 6620  eam).        if 
+0001ff00: 6f75 7470 7574 5f66 696c 655f 7072 6566  output_file_pref
+0001ff10: 6978 3a0a 2020 2020 2020 2020 2020 2020  ix:.            
+0001ff20: 7072 696e 7428 2220 2057 7269 7465 206d  print("  Write m
+0001ff30: 6561 6e2f 7374 642d 6465 7620 746f 2025  ean/std-dev to %
+0001ff40: 732e 286d 6561 6e7c 7374 645f 6465 7629  s.(mean|std_dev)
+0001ff50: 2e74 7874 2e22 2025 2028 6f75 7470 7574  .txt." % (output
+0001ff60: 5f66 696c 655f 7072 6566 6978 2c29 2c20  _file_prefix,), 
+0001ff70: 6669 6c65 3d73 7472 6561 6d29 0a20 2020  file=stream).   
+0001ff80: 2020 2020 2020 2020 206e 756d 7079 2e73           numpy.s
+0001ff90: 6176 6574 7874 2822 2573 2e6d 6561 6e2e  avetxt("%s.mean.
+0001ffa0: 7478 7422 2025 206f 7574 7075 745f 6669  txt" % output_fi
+0001ffb0: 6c65 5f70 7265 6669 782c 2073 656c 662e  le_prefix, self.
+0001ffc0: 6765 745f 6d65 616e 2829 290a 2020 2020  get_mean()).    
+0001ffd0: 2020 2020 2020 2020 6e75 6d70 792e 7361          numpy.sa
+0001ffe0: 7665 7478 7428 2225 732e 7374 645f 6465  vetxt("%s.std_de
+0001fff0: 762e 7478 7422 2025 206f 7574 7075 745f  v.txt" % output_
+00020000: 6669 6c65 5f70 7265 6669 782c 2073 656c  file_prefix, sel
+00020010: 662e 6765 745f 7374 645f 6465 7628 2929  f.get_std_dev())
+00020020: 0a0a 0a64 6566 2069 735f 6e61 6d65 6474  ...def is_namedt
+00020030: 7570 6c65 2863 6c73 293a 0a20 2020 2022  uple(cls):.    "
+00020040: 2222 0a20 2020 203a 7061 7261 6d20 5420  "".    :param T 
+00020050: 636c 733a 2074 7570 6c65 2c20 6c69 7374  cls: tuple, list
+00020060: 206f 7220 6e61 6d65 6474 7570 6c65 2074   or namedtuple t
+00020070: 7970 650a 2020 2020 3a72 6574 7572 6e3a  ype.    :return:
+00020080: 2077 6865 7468 6572 2063 6c73 2069 7320   whether cls is 
+00020090: 6120 6e61 6d65 6474 7570 6c65 2074 7970  a namedtuple typ
+000200a0: 650a 2020 2020 3a72 7479 7065 3a20 626f  e.    :rtype: bo
+000200b0: 6f6c 0a20 2020 2022 2222 0a20 2020 2072  ol.    """.    r
+000200c0: 6574 7572 6e20 6973 7375 6263 6c61 7373  eturn issubclass
+000200d0: 2863 6c73 2c20 7475 706c 6529 2061 6e64  (cls, tuple) and
+000200e0: 2063 6c73 2069 7320 6e6f 7420 7475 706c   cls is not tupl
+000200f0: 650a 0a0a 6465 6620 6d61 6b65 5f73 6571  e...def make_seq
+00020100: 5f6f 665f 7479 7065 2863 6c73 2c20 7365  _of_type(cls, se
+00020110: 7129 3a0a 2020 2020 2222 220a 2020 2020  q):.    """.    
+00020120: 3a70 6172 616d 2074 7970 655b 545d 2063  :param type[T] c
+00020130: 6c73 3a20 652e 672e 2074 7570 6c65 2c20  ls: e.g. tuple, 
+00020140: 6c69 7374 206f 7220 6e61 6d65 6474 7570  list or namedtup
+00020150: 6c65 0a20 2020 203a 7061 7261 6d20 6c69  le.    :param li
+00020160: 7374 7c74 7570 6c65 7c54 2073 6571 3a0a  st|tuple|T seq:.
+00020170: 2020 2020 3a72 6574 7572 6e3a 2063 6c73      :return: cls
+00020180: 2873 6571 2920 6f72 2063 6c73 282a 7365  (seq) or cls(*se
+00020190: 7129 0a20 2020 203a 7274 7970 653a 2054  q).    :rtype: T
+000201a0: 7c6c 6973 747c 7475 706c 650a 2020 2020  |list|tuple.    
+000201b0: 2222 220a 2020 2020 6173 7365 7274 2069  """.    assert i
+000201c0: 7373 7562 636c 6173 7328 636c 732c 2028  ssubclass(cls, (
+000201d0: 6c69 7374 2c20 7475 706c 6529 290a 2020  list, tuple)).  
+000201e0: 2020 6966 2069 735f 6e61 6d65 6474 7570    if is_namedtup
+000201f0: 6c65 2863 6c73 293a 0a20 2020 2020 2020  le(cls):.       
+00020200: 2072 6574 7572 6e20 636c 7328 2a73 6571   return cls(*seq
+00020210: 2920 2023 206e 6f71 610a 2020 2020 7265  )  # noqa.    re
+00020220: 7475 726e 2063 6c73 2873 6571 2920 2023  turn cls(seq)  #
+00020230: 206e 6f71 610a 0a0a 6465 6620 656e 7375   noqa...def ensu
+00020240: 7265 5f6c 6973 745f 6f66 5f74 7970 6528  re_list_of_type(
+00020250: 6c73 2c20 7479 7065 5f29 3a0a 2020 2020  ls, type_):.    
+00020260: 2222 220a 2020 2020 3a70 6172 616d 206c  """.    :param l
+00020270: 6973 7420 6c73 3a0a 2020 2020 3a70 6172  ist ls:.    :par
+00020280: 616d 2028 2829 2d3e 5429 7c74 7970 655b  am (()->T)|type[
+00020290: 545d 2074 7970 655f 3a20 7479 7065 206f  T] type_: type o
+000202a0: 6620 696e 7374 616e 6365 7320 6f66 2060  f instances of `
+000202b0: 6c73 602e 0a20 2020 2020 204e 6f74 6520  ls`..      Note 
+000202c0: 7468 6520 7374 7261 6e67 6520 7479 7065  the strange type
+000202d0: 2068 6572 6520 696e 2074 6865 2064 6f63   here in the doc
+000202e0: 7374 7269 6e67 2069 7320 6475 6520 746f  string is due to
+000202f0: 2073 6f6d 6520 5079 4368 6172 6d20 7479   some PyCharm ty
+00020300: 7065 2069 6e66 6572 656e 6365 2070 726f  pe inference pro
+00020310: 626c 656d 730a 2020 2020 2020 2868 7474  blems.      (htt
+00020320: 7073 3a2f 2f79 6f75 7472 6163 6b2e 6a65  ps://youtrack.je
+00020330: 7462 7261 696e 732e 636f 6d2f 6973 7375  tbrains.com/issu
+00020340: 652f 5059 2d35 3038 3238 292e 0a20 2020  e/PY-50828)..   
+00020350: 203a 7274 7970 653a 206c 6973 745b 545d   :rtype: list[T]
+00020360: 0a20 2020 2022 2222 0a20 2020 2061 7373  .    """.    ass
+00020370: 6572 7420 616c 6c28 6973 696e 7374 616e  ert all(isinstan
+00020380: 6365 2865 6c65 6d2c 2074 7970 655f 2920  ce(elem, type_) 
+00020390: 666f 7220 656c 656d 2069 6e20 6c73 290a  for elem in ls).
+000203a0: 2020 2020 7265 7475 726e 206c 730a 0a0a      return ls...
+000203b0: 4063 6f6e 7465 7874 6c69 622e 636f 6e74  @contextlib.cont
+000203c0: 6578 746d 616e 6167 6572 0a64 6566 2064  extmanager.def d
+000203d0: 756d 6d79 5f6e 6f6f 705f 6374 7828 293a  ummy_noop_ctx():
+000203e0: 0a20 2020 2022 2222 0a20 2020 2050 726f  .    """.    Pro
+000203f0: 7669 6465 7320 6120 6e6f 2d6f 7020 636f  vides a no-op co
+00020400: 6e74 6578 7420 6d61 6e61 6765 722e 0a20  ntext manager.. 
+00020410: 2020 2022 2222 0a20 2020 2079 6965 6c64     """.    yield
+00020420: 204e 6f6e 650a 0a0a 6465 6620 5f67 6574   None...def _get
+00020430: 5f6e 6772 616d 7328 7365 676d 656e 742c  _ngrams(segment,
+00020440: 206d 6178 5f6f 7264 6572 293a 0a20 2020   max_order):.   
+00020450: 2022 2222 4578 7472 6163 7473 2061 6c6c   """Extracts all
+00020460: 206e 2d67 7261 6d73 2075 7074 6f20 6120   n-grams upto a 
+00020470: 6769 7665 6e20 6d61 7869 6d75 6d20 6f72  given maximum or
+00020480: 6465 7220 6672 6f6d 2061 6e20 696e 7075  der from an inpu
+00020490: 7420 7365 676d 656e 742e 0a20 2020 2043  t segment..    C
+000204a0: 6f64 6520 6164 6170 7465 6420 6672 6f6d  ode adapted from
+000204b0: 2047 6f6f 676c 6520 5465 6e73 6f72 3254   Google Tensor2T
+000204c0: 656e 736f 722e 0a0a 2020 2020 4172 6773  ensor...    Args
+000204d0: 3a0a 2020 2020 2020 7365 676d 656e 7420  :.      segment 
+000204e0: 286c 6973 745b 696e 745d 7c6c 6973 745b  (list[int]|list[
+000204f0: 7374 725d 293a 2074 6578 7420 7365 676d  str]): text segm
+00020500: 656e 7420 6672 6f6d 2077 6869 6368 206e  ent from which n
+00020510: 2d67 7261 6d73 2077 696c 6c20 6265 2065  -grams will be e
+00020520: 7874 7261 6374 6564 2e0a 2020 2020 2020  xtracted..      
+00020530: 6d61 785f 6f72 6465 7220 2869 6e74 293a  max_order (int):
+00020540: 206d 6178 696d 756d 206c 656e 6774 6820   maximum length 
+00020550: 696e 2074 6f6b 656e 7320 6f66 2074 6865  in tokens of the
+00020560: 206e 2d67 7261 6d73 2072 6574 7572 6e65   n-grams returne
+00020570: 6420 6279 2074 6869 730a 2020 2020 2020  d by this.      
+00020580: 2020 2020 6d65 7468 6f64 732e 0a0a 2020      methods...  
+00020590: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+000205a0: 2054 6865 2043 6f75 6e74 6572 2063 6f6e   The Counter con
+000205b0: 7461 696e 696e 6720 616c 6c20 6e2d 6772  taining all n-gr
+000205c0: 616d 7320 7570 746f 206d 6178 5f6f 7264  ams upto max_ord
+000205d0: 6572 2069 6e20 7365 676d 656e 740a 2020  er in segment.  
+000205e0: 2020 2020 7769 7468 2061 2063 6f75 6e74      with a count
+000205f0: 206f 6620 686f 7720 6d61 6e79 2074 696d   of how many tim
+00020600: 6573 2065 6163 6820 6e2d 6772 616d 206f  es each n-gram o
+00020610: 6363 7572 7265 642e 0a20 2020 2022 2222  ccurred..    """
+00020620: 0a20 2020 2069 6d70 6f72 7420 636f 6c6c  .    import coll
+00020630: 6563 7469 6f6e 730a 0a20 2020 206e 6772  ections..    ngr
+00020640: 616d 5f63 6f75 6e74 7320 3d20 636f 6c6c  am_counts = coll
+00020650: 6563 7469 6f6e 732e 436f 756e 7465 7228  ections.Counter(
+00020660: 290a 2020 2020 666f 7220 6f72 6465 7220  ).    for order 
+00020670: 696e 2072 616e 6765 2831 2c20 6d61 785f  in range(1, max_
+00020680: 6f72 6465 7220 2b20 3129 3a0a 2020 2020  order + 1):.    
+00020690: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+000206a0: 6765 2830 2c20 6c65 6e28 7365 676d 656e  ge(0, len(segmen
+000206b0: 7429 202d 206f 7264 6572 202b 2031 293a  t) - order + 1):
+000206c0: 0a20 2020 2020 2020 2020 2020 206e 6772  .            ngr
+000206d0: 616d 203d 2074 7570 6c65 2873 6567 6d65  am = tuple(segme
+000206e0: 6e74 5b69 203a 2069 202b 206f 7264 6572  nt[i : i + order
+000206f0: 5d29 0a20 2020 2020 2020 2020 2020 206e  ]).            n
+00020700: 6772 616d 5f63 6f75 6e74 735b 6e67 7261  gram_counts[ngra
+00020710: 6d5d 202b 3d20 310a 2020 2020 7265 7475  m] += 1.    retu
+00020720: 726e 206e 6772 616d 5f63 6f75 6e74 730a  rn ngram_counts.
+00020730: 0a0a 6465 6620 636f 6d70 7574 655f 626c  ..def compute_bl
+00020740: 6575 2872 6566 6572 656e 6365 5f63 6f72  eu(reference_cor
+00020750: 7075 732c 2074 7261 6e73 6c61 7469 6f6e  pus, translation
+00020760: 5f63 6f72 7075 732c 206d 6178 5f6f 7264  _corpus, max_ord
+00020770: 6572 3d34 2c20 7573 655f 6270 3d54 7275  er=4, use_bp=Tru
+00020780: 6529 3a0a 2020 2020 2222 2243 6f6d 7075  e):.    """Compu
+00020790: 7465 7320 424c 4555 2073 636f 7265 206f  tes BLEU score o
+000207a0: 6620 7472 616e 736c 6174 6564 2073 6567  f translated seg
+000207b0: 6d65 6e74 7320 6167 6169 6e73 7420 6f6e  ments against on
+000207c0: 6520 6f72 206d 6f72 6520 7265 6665 7265  e or more refere
+000207d0: 6e63 6573 2e0a 2020 2020 436f 6465 2061  nces..    Code a
+000207e0: 6461 7074 6564 2066 726f 6d20 476f 6f67  dapted from Goog
+000207f0: 6c65 2054 656e 736f 7232 5465 6e73 6f72  le Tensor2Tensor
+00020800: 2e0a 0a20 2020 2041 7267 733a 0a20 2020  ...    Args:.   
+00020810: 2020 2072 6566 6572 656e 6365 5f63 6f72     reference_cor
+00020820: 7075 7320 286c 6973 745b 6c69 7374 5b69  pus (list[list[i
+00020830: 6e74 5d7c 6c69 7374 5b73 7472 5d5d 293a  nt]|list[str]]):
+00020840: 206c 6973 7420 6f66 2072 6566 6572 656e   list of referen
+00020850: 6365 7320 666f 7220 6561 6368 2074 7261  ces for each tra
+00020860: 6e73 6c61 7469 6f6e 2e20 4561 6368 0a20  nslation. Each. 
+00020870: 2020 2020 2020 2020 2072 6566 6572 656e           referen
+00020880: 6365 2073 686f 756c 6420 6265 2074 6f6b  ce should be tok
+00020890: 656e 697a 6564 2069 6e74 6f20 6120 6c69  enized into a li
+000208a0: 7374 206f 6620 746f 6b65 6e73 2e0a 2020  st of tokens..  
+000208b0: 2020 2020 7472 616e 736c 6174 696f 6e5f      translation_
+000208c0: 636f 7270 7573 2028 6c69 7374 5b6c 6973  corpus (list[lis
+000208d0: 745b 696e 745d 7c6c 6973 745b 7374 725d  t[int]|list[str]
+000208e0: 5d29 3a20 6c69 7374 206f 6620 7472 616e  ]): list of tran
+000208f0: 736c 6174 696f 6e73 2074 6f20 7363 6f72  slations to scor
+00020900: 652e 2045 6163 6820 7472 616e 736c 6174  e. Each translat
+00020910: 696f 6e0a 2020 2020 2020 2020 2020 7368  ion.          sh
+00020920: 6f75 6c64 2062 6520 746f 6b65 6e69 7a65  ould be tokenize
+00020930: 6420 696e 746f 2061 206c 6973 7420 6f66  d into a list of
+00020940: 2074 6f6b 656e 732e 0a20 2020 2020 206d   tokens..      m
+00020950: 6178 5f6f 7264 6572 2028 696e 7429 3a20  ax_order (int): 
+00020960: 4d61 7869 6d75 6d20 6e2d 6772 616d 206f  Maximum n-gram o
+00020970: 7264 6572 2074 6f20 7573 6520 7768 656e  rder to use when
+00020980: 2063 6f6d 7075 7469 6e67 2042 4c45 5520   computing BLEU 
+00020990: 7363 6f72 652e 0a20 2020 2020 2075 7365  score..      use
+000209a0: 5f62 7020 2862 6f6f 6c29 3a20 626f 6f6c  _bp (bool): bool
+000209b0: 6561 6e2c 2077 6865 7468 6572 2074 6f20  ean, whether to 
+000209c0: 6170 706c 7920 6272 6576 6974 7920 7065  apply brevity pe
+000209d0: 6e61 6c74 792e 0a0a 2020 2020 5265 7475  nalty...    Retu
+000209e0: 726e 733a 0a20 2020 2020 2042 4c45 5520  rns:.      BLEU 
+000209f0: 7363 6f72 652e 0a20 2020 2022 2222 0a20  score..    """. 
+00020a00: 2020 2069 6d70 6f72 7420 6d61 7468 0a0a     import math..
+00020a10: 2020 2020 7265 6665 7265 6e63 655f 6c65      reference_le
+00020a20: 6e67 7468 203d 2030 0a20 2020 2074 7261  ngth = 0.    tra
+00020a30: 6e73 6c61 7469 6f6e 5f6c 656e 6774 6820  nslation_length 
+00020a40: 3d20 300a 2020 2020 6270 203d 2031 2e30  = 0.    bp = 1.0
+00020a50: 0a20 2020 2067 656f 5f6d 6561 6e20 3d20  .    geo_mean = 
+00020a60: 300a 0a20 2020 206d 6174 6368 6573 5f62  0..    matches_b
+00020a70: 795f 6f72 6465 7220 3d20 5b30 5d20 2a20  y_order = [0] * 
+00020a80: 6d61 785f 6f72 6465 720a 2020 2020 706f  max_order.    po
+00020a90: 7373 6962 6c65 5f6d 6174 6368 6573 5f62  ssible_matches_b
+00020aa0: 795f 6f72 6465 7220 3d20 5b30 5d20 2a20  y_order = [0] * 
+00020ab0: 6d61 785f 6f72 6465 720a 0a20 2020 2066  max_order..    f
+00020ac0: 6f72 2028 7265 6665 7265 6e63 6573 2c20  or (references, 
+00020ad0: 7472 616e 736c 6174 696f 6e73 2920 696e  translations) in
+00020ae0: 207a 6970 2872 6566 6572 656e 6365 5f63   zip(reference_c
+00020af0: 6f72 7075 732c 2074 7261 6e73 6c61 7469  orpus, translati
+00020b00: 6f6e 5f63 6f72 7075 7329 3a0a 2020 2020  on_corpus):.    
+00020b10: 2020 2020 7265 6665 7265 6e63 655f 6c65      reference_le
+00020b20: 6e67 7468 202b 3d20 6c65 6e28 7265 6665  ngth += len(refe
+00020b30: 7265 6e63 6573 290a 2020 2020 2020 2020  rences).        
+00020b40: 7472 616e 736c 6174 696f 6e5f 6c65 6e67  translation_leng
+00020b50: 7468 202b 3d20 6c65 6e28 7472 616e 736c  th += len(transl
+00020b60: 6174 696f 6e73 290a 2020 2020 2020 2020  ations).        
+00020b70: 7265 665f 6e67 7261 6d5f 636f 756e 7473  ref_ngram_counts
+00020b80: 203d 205f 6765 745f 6e67 7261 6d73 2872   = _get_ngrams(r
+00020b90: 6566 6572 656e 6365 732c 206d 6178 5f6f  eferences, max_o
+00020ba0: 7264 6572 290a 2020 2020 2020 2020 7472  rder).        tr
+00020bb0: 616e 736c 6174 696f 6e5f 6e67 7261 6d5f  anslation_ngram_
+00020bc0: 636f 756e 7473 203d 205f 6765 745f 6e67  counts = _get_ng
+00020bd0: 7261 6d73 2874 7261 6e73 6c61 7469 6f6e  rams(translation
+00020be0: 732c 206d 6178 5f6f 7264 6572 290a 0a20  s, max_order).. 
+00020bf0: 2020 2020 2020 206f 7665 726c 6170 203d         overlap =
+00020c00: 207b 6e67 7261 6d3a 206d 696e 2863 6f75   {ngram: min(cou
+00020c10: 6e74 2c20 7472 616e 736c 6174 696f 6e5f  nt, translation_
+00020c20: 6e67 7261 6d5f 636f 756e 7473 5b6e 6772  ngram_counts[ngr
+00020c30: 616d 5d29 2066 6f72 206e 6772 616d 2c20  am]) for ngram, 
+00020c40: 636f 756e 7420 696e 2072 6566 5f6e 6772  count in ref_ngr
+00020c50: 616d 5f63 6f75 6e74 732e 6974 656d 7328  am_counts.items(
+00020c60: 297d 0a0a 2020 2020 2020 2020 666f 7220  )}..        for 
+00020c70: 6e67 7261 6d20 696e 206f 7665 726c 6170  ngram in overlap
+00020c80: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
+00020c90: 7463 6865 735f 6279 5f6f 7264 6572 5b6c  tches_by_order[l
+00020ca0: 656e 286e 6772 616d 2920 2d20 315d 202b  en(ngram) - 1] +
+00020cb0: 3d20 6f76 6572 6c61 705b 6e67 7261 6d5d  = overlap[ngram]
+00020cc0: 0a20 2020 2020 2020 2066 6f72 206e 6772  .        for ngr
+00020cd0: 616d 2069 6e20 7472 616e 736c 6174 696f  am in translatio
+00020ce0: 6e5f 6e67 7261 6d5f 636f 756e 7473 3a0a  n_ngram_counts:.
+00020cf0: 2020 2020 2020 2020 2020 2020 706f 7373              poss
+00020d00: 6962 6c65 5f6d 6174 6368 6573 5f62 795f  ible_matches_by_
+00020d10: 6f72 6465 725b 6c65 6e28 6e67 7261 6d29  order[len(ngram)
+00020d20: 202d 2031 5d20 2b3d 2074 7261 6e73 6c61   - 1] += transla
+00020d30: 7469 6f6e 5f6e 6772 616d 5f63 6f75 6e74  tion_ngram_count
+00020d40: 735b 6e67 7261 6d5d 0a0a 2020 2020 7072  s[ngram]..    pr
+00020d50: 6563 6973 696f 6e73 203d 205b 302e 305d  ecisions = [0.0]
+00020d60: 202a 206d 6178 5f6f 7264 6572 0a20 2020   * max_order.   
+00020d70: 2073 6d6f 6f74 6820 3d20 312e 300a 2020   smooth = 1.0.  
+00020d80: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00020d90: 2830 2c20 6d61 785f 6f72 6465 7229 3a0a  (0, max_order):.
+00020da0: 2020 2020 2020 2020 6966 2070 6f73 7369          if possi
+00020db0: 626c 655f 6d61 7463 6865 735f 6279 5f6f  ble_matches_by_o
+00020dc0: 7264 6572 5b69 5d20 3e20 303a 0a20 2020  rder[i] > 0:.   
+00020dd0: 2020 2020 2020 2020 2070 7265 6369 7369           precisi
+00020de0: 6f6e 735b 695d 203d 206d 6174 6368 6573  ons[i] = matches
+00020df0: 5f62 795f 6f72 6465 725b 695d 202f 2070  _by_order[i] / p
+00020e00: 6f73 7369 626c 655f 6d61 7463 6865 735f  ossible_matches_
+00020e10: 6279 5f6f 7264 6572 5b69 5d0a 2020 2020  by_order[i].    
+00020e20: 2020 2020 2020 2020 6966 206d 6174 6368          if match
+00020e30: 6573 5f62 795f 6f72 6465 725b 695d 203e  es_by_order[i] >
+00020e40: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00020e50: 2020 2020 7072 6563 6973 696f 6e73 5b69      precisions[i
+00020e60: 5d20 3d20 6d61 7463 6865 735f 6279 5f6f  ] = matches_by_o
+00020e70: 7264 6572 5b69 5d20 2f20 706f 7373 6962  rder[i] / possib
+00020e80: 6c65 5f6d 6174 6368 6573 5f62 795f 6f72  le_matches_by_or
+00020e90: 6465 725b 695d 0a20 2020 2020 2020 2020  der[i].         
+00020ea0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00020eb0: 2020 2020 2020 2020 2073 6d6f 6f74 6820           smooth 
+00020ec0: 2a3d 2032 0a20 2020 2020 2020 2020 2020  *= 2.           
+00020ed0: 2020 2020 2070 7265 6369 7369 6f6e 735b       precisions[
+00020ee0: 695d 203d 2031 2e30 202f 2028 736d 6f6f  i] = 1.0 / (smoo
+00020ef0: 7468 202a 2070 6f73 7369 626c 655f 6d61  th * possible_ma
+00020f00: 7463 6865 735f 6279 5f6f 7264 6572 5b69  tches_by_order[i
+00020f10: 5d29 0a20 2020 2020 2020 2065 6c73 653a  ]).        else:
+00020f20: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+00020f30: 6369 7369 6f6e 735b 695d 203d 2030 2e30  cisions[i] = 0.0
+00020f40: 0a0a 2020 2020 6966 206d 6178 2870 7265  ..    if max(pre
+00020f50: 6369 7369 6f6e 7329 203e 2030 3a0a 2020  cisions) > 0:.  
+00020f60: 2020 2020 2020 705f 6c6f 675f 7375 6d20        p_log_sum 
+00020f70: 3d20 7375 6d28 6d61 7468 2e6c 6f67 2870  = sum(math.log(p
+00020f80: 2920 666f 7220 7020 696e 2070 7265 6369  ) for p in preci
+00020f90: 7369 6f6e 7320 6966 2070 290a 2020 2020  sions if p).    
+00020fa0: 2020 2020 6765 6f5f 6d65 616e 203d 206d      geo_mean = m
+00020fb0: 6174 682e 6578 7028 705f 6c6f 675f 7375  ath.exp(p_log_su
+00020fc0: 6d20 2f20 6d61 785f 6f72 6465 7229 0a0a  m / max_order)..
+00020fd0: 2020 2020 6966 2075 7365 5f62 703a 0a20      if use_bp:. 
+00020fe0: 2020 2020 2020 2072 6174 696f 203d 2074         ratio = t
+00020ff0: 7261 6e73 6c61 7469 6f6e 5f6c 656e 6774  ranslation_lengt
+00021000: 6820 2f20 7265 6665 7265 6e63 655f 6c65  h / reference_le
+00021010: 6e67 7468 0a20 2020 2020 2020 2069 6620  ngth.        if 
+00021020: 7261 7469 6f20 3c20 3165 2d33 303a 0a20  ratio < 1e-30:. 
+00021030: 2020 2020 2020 2020 2020 2062 7020 3d20             bp = 
+00021040: 302e 300a 2020 2020 2020 2020 656c 6966  0.0.        elif
+00021050: 2072 6174 696f 203c 2031 2e30 3a0a 2020   ratio < 1.0:.  
+00021060: 2020 2020 2020 2020 2020 6270 203d 206d            bp = m
+00021070: 6174 682e 6578 7028 3120 2d20 312e 3020  ath.exp(1 - 1.0 
+00021080: 2f20 7261 7469 6f29 0a20 2020 2020 2020  / ratio).       
+00021090: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000210a0: 2020 2062 7020 3d20 312e 300a 2020 2020     bp = 1.0.    
+000210b0: 626c 6575 203d 2067 656f 5f6d 6561 6e20  bleu = geo_mean 
+000210c0: 2a20 6270 0a20 2020 2072 6574 7572 6e20  * bp.    return 
+000210d0: 6e70 2e66 6c6f 6174 3332 2862 6c65 7529  np.float32(bleu)
+000210e0: 0a0a 0a23 206e 6f69 6e73 7065 6374 696f  ...# noinspectio
+000210f0: 6e20 5079 5061 636b 6167 6552 6571 7569  n PyPackageRequi
+00021100: 7265 6d65 6e74 730a 6465 6620 6d6f 6e6b  rements.def monk
+00021110: 6579 6669 785f 676c 6962 2829 3a0a 2020  eyfix_glib():.  
+00021120: 2020 2222 220a 2020 2020 4669 7865 7320    """.    Fixes 
+00021130: 736f 6d65 2073 7475 7069 6420 6275 6773  some stupid bugs
+00021140: 2073 7563 6820 7468 6174 2053 4947 494e   such that SIGIN
+00021150: 5420 6973 206e 6f74 2077 6f72 6b69 6e67  T is not working
+00021160: 2e0a 2020 2020 5468 6973 2069 7320 7573  ..    This is us
+00021170: 6564 2062 7920 6175 6469 6f72 6561 642c  ed by audioread,
+00021180: 2061 6e64 2069 6e64 6972 6563 746c 7920   and indirectly 
+00021190: 6279 206c 6962 726f 7361 2066 6f72 206c  by librosa for l
+000211a0: 6f61 6469 6e67 2061 7564 696f 2e0a 2020  oading audio..  
+000211b0: 2020 6874 7470 733a 2f2f 7374 6163 6b6f    https://stacko
+000211c0: 7665 7266 6c6f 772e 636f 6d2f 7175 6573  verflow.com/ques
+000211d0: 7469 6f6e 732f 3136 3431 3038 3532 2f0a  tions/16410852/.
+000211e0: 2020 2020 5365 6520 616c 736f 203a 6675      See also :fu
+000211f0: 6e63 3a60 6d6f 6e6b 6579 7061 7463 685f  nc:`monkeypatch_
+00021200: 6175 6469 6f72 6561 6460 2e0a 2020 2020  audioread`..    
+00021210: 2222 220a 2020 2020 7472 793a 0a20 2020  """.    try:.   
+00021220: 2020 2020 2069 6d70 6f72 7420 6769 0a20       import gi. 
+00021230: 2020 2065 7863 6570 7420 496d 706f 7274     except Import
+00021240: 4572 726f 723a 0a20 2020 2020 2020 2072  Error:.        r
+00021250: 6574 7572 6e0a 2020 2020 7472 793a 0a20  eturn.    try:. 
+00021260: 2020 2020 2020 2066 726f 6d20 6769 2e72         from gi.r
+00021270: 6570 6f73 6974 6f72 7920 696d 706f 7274  epository import
+00021280: 2047 4c69 620a 2020 2020 6578 6365 7074   GLib.    except
+00021290: 2049 6d70 6f72 7445 7272 6f72 3a0a 2020   ImportError:.  
+000212a0: 2020 2020 2020 2320 6e6f 696e 7370 6563        # noinspec
+000212b0: 7469 6f6e 2050 7955 6e72 6573 6f6c 7665  tion PyUnresolve
+000212c0: 6452 6566 6572 656e 6365 730a 2020 2020  dReferences.    
+000212d0: 2020 2020 6672 6f6d 2067 692e 6f76 6572      from gi.over
+000212e0: 7269 6465 7320 696d 706f 7274 2047 4c69  rides import GLi
+000212f0: 620a 2020 2020 2320 446f 206e 6f74 6869  b.    # Do nothi
+00021300: 6e67 2e0a 2020 2020 2320 5468 6520 6f72  ng..    # The or
+00021310: 6967 696e 616c 2062 6568 6176 696f 7220  iginal behavior 
+00021320: 776f 756c 6420 696e 7374 616c 6c20 6120  would install a 
+00021330: 5349 4749 4e54 2068 616e 646c 6572 2077  SIGINT handler w
+00021340: 6869 6368 2063 616c 6c73 2047 4c69 622e  hich calls GLib.
+00021350: 4d61 696e 4c6f 6f70 2e71 7569 7428 292c  MainLoop.quit(),
+00021360: 0a20 2020 2023 2061 6e64 2074 6865 6e20  .    # and then 
+00021370: 7265 7261 6973 6520 6120 4b65 7962 6f61  reraise a Keyboa
+00021380: 7264 496e 7465 7272 7570 7420 696e 2074  rdInterrupt in t
+00021390: 6861 7420 7468 7265 6164 2e0a 2020 2020  hat thread..    
+000213a0: 2320 486f 7765 7665 722c 2077 6520 7761  # However, we wa
+000213b0: 6e74 2061 6e64 2065 7870 6563 7420 746f  nt and expect to
+000213c0: 2067 6574 2074 6865 204b 6579 626f 6172   get the Keyboar
+000213d0: 6449 6e74 6572 7275 7074 2069 6e20 7468  dInterrupt in th
+000213e0: 6520 6d61 696e 2074 6872 6561 642e 0a20  e main thread.. 
+000213f0: 2020 2047 4c69 622e 4d61 696e 4c6f 6f70     GLib.MainLoop
+00021400: 2e5f 5f69 6e69 745f 5f20 3d20 6c61 6d62  .__init__ = lamb
+00021410: 6461 202a 6172 6773 2c20 2a2a 6b77 6172  da *args, **kwar
+00021420: 6773 3a20 4e6f 6e65 0a0a 0a64 6566 206d  gs: None...def m
+00021430: 6f6e 6b65 7970 6174 6368 5f61 7564 696f  onkeypatch_audio
+00021440: 7265 6164 2829 3a0a 2020 2020 2222 220a  read():.    """.
+00021450: 2020 2020 6175 6469 6f72 6561 6420 646f      audioread do
+00021460: 6573 206e 6f74 2062 6568 6176 6520 6f70  es not behave op
+00021470: 7469 6d61 6c20 696e 2073 6f6d 6520 6361  timal in some ca
+00021480: 7365 732e 0a20 2020 2045 2e67 2e20 6561  ses..    E.g. ea
+00021490: 6368 2063 616c 6c20 746f 205f 6361 5f61  ch call to _ca_a
+000214a0: 7661 696c 6162 6c65 2829 2074 616b 6573  vailable() takes
+000214b0: 2071 7569 7465 206c 6f6e 6720 6265 6361   quite long beca
+000214c0: 7573 6520 6f66 2074 6865 2063 7479 7065  use of the ctype
+000214d0: 732e 7574 696c 2e66 696e 645f 6c69 6272  s.util.find_libr
+000214e0: 6172 7920 7573 6167 652e 0a20 2020 2057  ary usage..    W
+000214f0: 6520 7769 6c6c 2070 6174 6368 2074 6869  e will patch thi
+00021500: 732e 0a0a 2020 2020 486f 7765 7665 722c  s...    However,
+00021510: 2074 6865 2072 6563 6f6d 6d65 6e64 6174   the recommendat
+00021520: 696f 6e20 776f 756c 6420 6265 2074 6f20  ion would be to 
+00021530: 6e6f 7420 7573 6520 6175 6469 6f72 6561  not use audiorea
+00021540: 6420 286c 6962 726f 7361 2e6c 6f61 6429  d (librosa.load)
+00021550: 2e0a 2020 2020 6175 6469 6f72 6561 6420  ..    audioread 
+00021560: 7573 6573 2047 7374 7265 616d 6572 2061  uses Gstreamer a
+00021570: 7320 6120 6261 636b 656e 6420 6279 2064  s a backend by d
+00021580: 6566 6175 6c74 2063 7572 7265 6e74 6c79  efault currently
+00021590: 2028 6f6e 204c 696e 7578 292e 0a20 2020   (on Linux)..   
+000215a0: 2047 7374 7265 616d 6572 2068 6173 206d   Gstreamer has m
+000215b0: 756c 7469 706c 6520 6973 7375 6573 2e20  ultiple issues. 
+000215c0: 5365 6520 616c 736f 203a 6675 6e63 3a60  See also :func:`
+000215d0: 6d6f 6e6b 6579 6669 785f 676c 6962 602c  monkeyfix_glib`,
+000215e0: 2061 6e64 2068 6572 6520 666f 7220 6469   and here for di
+000215f0: 7363 7573 7369 6f6e 3a0a 2020 2020 6874  scussion:.    ht
+00021600: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+00021610: 2f62 6565 7462 6f78 2f61 7564 696f 7265  /beetbox/audiore
+00021620: 6164 2f69 7373 7565 732f 3632 0a20 2020  ad/issues/62.   
+00021630: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
+00021640: 636f 6d2f 6265 6574 626f 782f 6175 6469  com/beetbox/audi
+00021650: 6f72 6561 642f 6973 7375 6573 2f36 330a  oread/issues/63.
+00021660: 0a20 2020 2049 6e73 7465 6164 2c20 7573  .    Instead, us
+00021670: 6520 5079 536f 756e 6446 696c 652c 2077  e PySoundFile, w
+00021680: 6869 6368 2069 7320 616c 736f 2066 6173  hich is also fas
+00021690: 7465 722e 2053 6565 2068 6572 6520 666f  ter. See here fo
+000216a0: 7220 6469 7363 7573 7369 6f6e 733a 0a20  r discussions:. 
+000216b0: 2020 2068 7474 7073 3a2f 2f67 6974 6875     https://githu
+000216c0: 622e 636f 6d2f 6265 6574 626f 782f 6175  b.com/beetbox/au
+000216d0: 6469 6f72 6561 642f 6973 7375 6573 2f36  dioread/issues/6
+000216e0: 340a 2020 2020 6874 7470 733a 2f2f 6769  4.    https://gi
+000216f0: 7468 7562 2e63 6f6d 2f6c 6962 726f 7361  thub.com/librosa
+00021700: 2f6c 6962 726f 7361 2f69 7373 7565 732f  /librosa/issues/
+00021710: 3638 310a 2020 2020 2222 220a 2020 2020  681.    """.    
+00021720: 7472 793a 0a20 2020 2020 2020 2023 206e  try:.        # n
+00021730: 6f69 6e73 7065 6374 696f 6e20 5079 5061  oinspection PyPa
+00021740: 636b 6167 6552 6571 7569 7265 6d65 6e74  ckageRequirement
+00021750: 730a 2020 2020 2020 2020 696d 706f 7274  s.        import
+00021760: 2061 7564 696f 7265 6164 0a20 2020 2065   audioread.    e
+00021770: 7863 6570 7420 496d 706f 7274 4572 726f  xcept ImportErro
+00021780: 723a 0a20 2020 2020 2020 2072 6574 7572  r:.        retur
+00021790: 6e0a 2020 2020 2320 6e6f 696e 7370 6563  n.    # noinspec
+000217a0: 7469 6f6e 2050 7950 726f 7465 6374 6564  tion PyProtected
+000217b0: 4d65 6d62 6572 0a20 2020 2072 6573 203d  Member.    res =
+000217c0: 2061 7564 696f 7265 6164 2e5f 6361 5f61   audioread._ca_a
+000217d0: 7661 696c 6162 6c65 2829 0a20 2020 2061  vailable().    a
+000217e0: 7564 696f 7265 6164 2e5f 6361 5f61 7661  udioread._ca_ava
+000217f0: 696c 6162 6c65 203d 206c 616d 6264 613a  ilable = lambda:
+00021800: 2072 6573 0a0a 0a5f 6366 5f63 6163 6865   res..._cf_cache
+00021810: 203d 207b 7d0a 5f63 665f 6d73 675f 7072   = {}._cf_msg_pr
+00021820: 696e 7465 6420 3d20 4661 6c73 650a 0a0a  inted = False...
+00021830: 6465 6620 6366 2866 696c 656e 616d 6529  def cf(filename)
+00021840: 3a0a 2020 2020 2222 220a 2020 2020 4361  :.    """.    Ca
+00021850: 6368 6520 6d61 6e61 6765 722e 2069 3620  che manager. i6 
+00021860: 7370 6563 6966 6963 2e0a 0a20 2020 203a  specific...    :
+00021870: 7265 7475 726e 3a20 6669 6c65 6e61 6d65  return: filename
+00021880: 0a20 2020 203a 7274 7970 653a 2073 7472  .    :rtype: str
+00021890: 0a20 2020 2022 2222 0a20 2020 2067 6c6f  .    """.    glo
+000218a0: 6261 6c20 5f63 665f 6d73 675f 7072 696e  bal _cf_msg_prin
+000218b0: 7465 640a 2020 2020 696d 706f 7274 206f  ted.    import o
+000218c0: 730a 2020 2020 6672 6f6d 2073 7562 7072  s.    from subpr
+000218d0: 6f63 6573 7320 696d 706f 7274 2063 6865  ocess import che
+000218e0: 636b 5f6f 7574 7075 740a 0a20 2020 2069  ck_output..    i
+000218f0: 6620 6669 6c65 6e61 6d65 2069 6e20 5f63  f filename in _c
+00021900: 665f 6361 6368 653a 0a20 2020 2020 2020  f_cache:.       
+00021910: 2072 6574 7572 6e20 5f63 665f 6361 6368   return _cf_cach
+00021920: 655b 6669 6c65 6e61 6d65 5d0a 2020 2020  e[filename].    
+00021930: 6465 6275 675f 6d6f 6465 203d 2069 6e74  debug_mode = int
+00021940: 286f 732e 656e 7669 726f 6e2e 6765 7428  (os.environ.get(
+00021950: 2244 4542 5547 222c 2030 2929 0a20 2020  "DEBUG", 0)).   
+00021960: 2069 6620 6465 6275 675f 6d6f 6465 206f   if debug_mode o
+00021970: 7220 6765 745f 686f 7374 6e61 6d65 2829  r get_hostname()
+00021980: 203d 3d20 2263 6c75 7374 6572 2d63 6e2d   == "cluster-cn-
+00021990: 3231 3122 206f 7220 6e6f 7420 6973 5f72  211" or not is_r
+000219a0: 756e 6e69 6e67 5f6f 6e5f 636c 7573 7465  unning_on_cluste
+000219b0: 7228 293a 0a20 2020 2020 2020 2069 6620  r():.        if 
+000219c0: 6e6f 7420 5f63 665f 6d73 675f 7072 696e  not _cf_msg_prin
+000219d0: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
+000219e0: 2070 7269 6e74 2822 4361 6368 6520 6d61   print("Cache ma
+000219f0: 6e61 6765 723a 206e 6f74 2075 7365 642c  nager: not used,
+00021a00: 2075 7365 206c 6f63 616c 2066 696c 653a   use local file:
+00021a10: 2025 7320 2864 6973 6361 7264 2066 7572   %s (discard fur
+00021a20: 7468 6572 206d 6573 7361 6765 7329 2220  ther messages)" 
+00021a30: 2520 6669 6c65 6e61 6d65 290a 2020 2020  % filename).    
+00021a40: 2020 2020 2020 2020 5f63 665f 6d73 675f          _cf_msg_
+00021a50: 7072 696e 7465 6420 3d20 5472 7565 0a20  printed = True. 
+00021a60: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
+00021a70: 6c65 6e61 6d65 2020 2320 666f 7220 6465  lename  # for de
+00021a80: 6275 6767 696e 670a 2020 2020 7472 793a  bugging.    try:
+00021a90: 0a20 2020 2020 2020 2063 6163 6865 645f  .        cached_
+00021aa0: 666e 203d 2063 6865 636b 5f6f 7574 7075  fn = check_outpu
+00021ab0: 7428 5b22 6366 222c 2066 696c 656e 616d  t(["cf", filenam
+00021ac0: 655d 292e 7374 7269 7028 292e 6465 636f  e]).strip().deco
+00021ad0: 6465 2822 7574 6638 2229 0a20 2020 2065  de("utf8").    e
+00021ae0: 7863 6570 7420 4361 6c6c 6564 5072 6f63  xcept CalledProc
+00021af0: 6573 7345 7272 6f72 3a0a 2020 2020 2020  essError:.      
+00021b00: 2020 6966 206e 6f74 205f 6366 5f6d 7367    if not _cf_msg
+00021b10: 5f70 7269 6e74 6564 3a0a 2020 2020 2020  _printed:.      
+00021b20: 2020 2020 2020 7072 696e 7428 2243 6163        print("Cac
+00021b30: 6865 206d 616e 6167 6572 3a20 4572 726f  he manager: Erro
+00021b40: 7220 6f63 6375 7272 6564 2c20 7573 696e  r occurred, usin
+00021b50: 6720 6c6f 6361 6c20 6669 6c65 2229 0a20  g local file"). 
+00021b60: 2020 2020 2020 2020 2020 205f 6366 5f6d             _cf_m
+00021b70: 7367 5f70 7269 6e74 6564 203d 2054 7275  sg_printed = Tru
+00021b80: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00021b90: 2066 696c 656e 616d 650a 2020 2020 6173   filename.    as
+00021ba0: 7365 7274 206f 732e 7061 7468 2e65 7869  sert os.path.exi
+00021bb0: 7374 7328 6361 6368 6564 5f66 6e29 0a20  sts(cached_fn). 
+00021bc0: 2020 205f 6366 5f63 6163 6865 5b66 696c     _cf_cache[fil
+00021bd0: 656e 616d 655d 203d 2063 6163 6865 645f  ename] = cached_
+00021be0: 666e 0a20 2020 2072 6574 7572 6e20 6361  fn.    return ca
+00021bf0: 6368 6564 5f66 6e0a 0a0a 6465 6620 6269  ched_fn...def bi
+00021c00: 6e61 7279 5f73 6561 7263 685f 616e 7928  nary_search_any(
+00021c10: 636d 702c 206c 6f77 2c20 6869 6768 293a  cmp, low, high):
+00021c20: 0a20 2020 2022 2222 0a20 2020 2042 696e  .    """.    Bin
+00021c30: 6172 7920 7365 6172 6368 2066 6f72 2061  ary search for a
+00021c40: 2063 7573 746f 6d20 636f 6d70 6172 6520   custom compare 
+00021c50: 6675 6e63 7469 6f6e 2e0a 0a20 2020 203a  function...    :
+00021c60: 7061 7261 6d20 2869 6e74 292d 3e69 6e74  param (int)->int
+00021c70: 2063 6d70 3a20 652e 672e 2063 6d70 2869   cmp: e.g. cmp(i
+00021c80: 6478 2920 3d3d 2063 6f6d 7061 7265 2861  dx) == compare(a
+00021c90: 7272 6179 5b69 6478 5d2c 206b 6579 290a  rray[idx], key).
+00021ca0: 2020 2020 3a70 6172 616d 2069 6e74 206c      :param int l
+00021cb0: 6f77 3a20 696e 636c 7573 6976 650a 2020  ow: inclusive.  
+00021cc0: 2020 3a70 6172 616d 2069 6e74 2068 6967    :param int hig
+00021cd0: 683a 2065 7863 6c75 7369 7665 0a20 2020  h: exclusive.   
+00021ce0: 203a 7274 7970 653a 2069 6e74 7c4e 6f6e   :rtype: int|Non
+00021cf0: 650a 2020 2020 2222 220a 2020 2020 7768  e.    """.    wh
+00021d00: 696c 6520 6c6f 7720 3c20 6869 6768 3a0a  ile low < high:.
+00021d10: 2020 2020 2020 2020 6d69 6420 3d20 286c          mid = (l
+00021d20: 6f77 202b 2068 6967 6829 202f 2f20 320a  ow + high) // 2.
+00021d30: 2020 2020 2020 2020 7220 3d20 636d 7028          r = cmp(
+00021d40: 6d69 6429 0a20 2020 2020 2020 2069 6620  mid).        if 
+00021d50: 7220 3c20 303a 0a20 2020 2020 2020 2020  r < 0:.         
+00021d60: 2020 206c 6f77 203d 206d 6964 202b 2031     low = mid + 1
+00021d70: 0a20 2020 2020 2020 2065 6c69 6620 7220  .        elif r 
+00021d80: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+00021d90: 2068 6967 6820 3d20 6d69 640a 2020 2020   high = mid.    
+00021da0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00021db0: 2020 2020 2020 7265 7475 726e 206d 6964        return mid
+00021dc0: 0a20 2020 2072 6574 7572 6e20 6c6f 770a  .    return low.
+00021dd0: 0a0a 6465 6620 6765 6e65 7269 635f 696d  ..def generic_im
+00021de0: 706f 7274 5f6d 6f64 756c 6528 6669 6c65  port_module(file
+00021df0: 6e61 6d65 293a 0a20 2020 2022 2222 0a20  name):.    """. 
+00021e00: 2020 203a 7061 7261 6d20 7374 7220 6669     :param str fi
+00021e10: 6c65 6e61 6d65 3a0a 2020 2020 2020 5765  lename:.      We
+00021e20: 2074 7279 2074 6f20 6265 2063 6c65 7665   try to be cleve
+00021e30: 7220 6162 6f75 7420 6669 6c65 6e61 6d65  r about filename
+00021e40: 2e0a 2020 2020 2020 4966 2069 7420 6c6f  ..      If it lo
+00021e50: 6f6b 7320 6c69 6b65 2061 206d 6f64 756c  oks like a modul
+00021e60: 6520 6e61 6d65 2c20 6a75 7374 2064 6f20  e name, just do 
+00021e70: 696d 706f 7274 6c69 622e 696d 706f 7274  importlib.import
+00021e80: 5f6d 6f64 756c 652e 0a20 2020 2020 2049  _module..      I
+00021e90: 6620 6974 206c 6f6f 6b73 206c 696b 6520  f it looks like 
+00021ea0: 6120 6669 6c65 6e61 6d65 2c20 7365 6172  a filename, sear
+00021eb0: 6368 2066 6f72 2061 2062 6173 6520 7061  ch for a base pa
+00021ec0: 7468 2028 7768 6963 6820 646f 6573 206e  th (which does n
+00021ed0: 6f74 2068 6176 6520 5f5f 696e 6974 5f5f  ot have __init__
+00021ee0: 2e70 7929 2c0a 2020 2020 2020 6164 6420  .py),.      add 
+00021ef0: 7468 6174 2070 6174 6820 746f 2073 7973  that path to sys
+00021f00: 2e70 6174 6820 6966 206e 6565 6465 642c  .path if needed,
+00021f10: 2061 6e64 2069 6d70 6f72 7420 7468 6520   and import the 
+00021f20: 7265 6d61 696e 696e 6720 7768 6572 6520  remaining where 
+00021f30: 222f 2220 6973 2072 6570 6c61 6365 6420  "/" is replaced 
+00021f40: 6279 2022 2e22 0a20 2020 2020 2061 6e64  by ".".      and
+00021f50: 2074 6865 2066 696c 6520 6578 7465 6e73   the file extens
+00021f60: 696f 6e20 6973 2072 656d 6f76 6564 2e0a  ion is removed..
+00021f70: 2020 2020 3a72 6574 7572 6e3a 2074 6865      :return: the
+00021f80: 206d 6f64 756c 650a 2020 2020 3a72 7479   module.    :rty
+00021f90: 7065 3a20 7479 7065 732e 4d6f 6475 6c65  pe: types.Module
+00021fa0: 5479 7065 0a20 2020 2022 2222 0a20 2020  Type.    """.   
+00021fb0: 2061 7373 6572 7420 6669 6c65 6e61 6d65   assert filename
+00021fc0: 0a20 2020 2069 6d70 6f72 7420 696d 706f  .    import impo
+00021fd0: 7274 6c69 620a 0a20 2020 2069 6620 222f  rtlib..    if "/
+00021fe0: 2220 6e6f 7420 696e 2066 696c 656e 616d  " not in filenam
+00021ff0: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
+00022000: 6e20 696d 706f 7274 6c69 622e 696d 706f  n importlib.impo
+00022010: 7274 5f6d 6f64 756c 6528 6669 6c65 6e61  rt_module(filena
+00022020: 6d65 290a 2020 2020 7072 6566 6978 5f64  me).    prefix_d
+00022030: 6972 203d 2022 220a 2020 2020 6966 206e  ir = "".    if n
+00022040: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+00022050: 7328 6669 6c65 6e61 6d65 293a 0a20 2020  s(filename):.   
+00022060: 2020 2020 2061 7373 6572 7420 6669 6c65       assert file
+00022070: 6e61 6d65 5b30 5d20 213d 2022 2f22 0a20  name[0] != "/". 
+00022080: 2020 2020 2020 2023 204d 6179 6265 2072         # Maybe r
+00022090: 656c 6174 6976 6520 746f 2052 6574 7572  elative to Retur
+000220a0: 6e6e 3f0a 2020 2020 2020 2020 7072 6566  nn?.        pref
+000220b0: 6978 5f64 6972 203d 2022 2573 2f22 2025  ix_dir = "%s/" %
+000220c0: 2072 6574 7572 6e6e 5f72 6f6f 745f 6469   returnn_root_di
+000220d0: 720a 2020 2020 6173 7365 7274 206f 732e  r.    assert os.
+000220e0: 7061 7468 2e65 7869 7374 7328 7072 6566  path.exists(pref
+000220f0: 6978 5f64 6972 202b 2066 696c 656e 616d  ix_dir + filenam
+00022100: 6529 0a20 2020 2061 7373 6572 7420 6669  e).    assert fi
+00022110: 6c65 6e61 6d65 2e65 6e64 7377 6974 6828  lename.endswith(
+00022120: 222e 7079 2229 206f 7220 6f73 2e70 6174  ".py") or os.pat
+00022130: 682e 6973 6469 7228 7072 6566 6978 5f64  h.isdir(prefix_d
+00022140: 6972 202b 2066 696c 656e 616d 6529 0a20  ir + filename). 
+00022150: 2020 2064 6972 7320 3d20 6669 6c65 6e61     dirs = filena
+00022160: 6d65 2e73 706c 6974 2822 2f22 290a 2020  me.split("/").  
+00022170: 2020 6469 7273 2c20 6261 7365 5f66 6e20    dirs, base_fn 
+00022180: 3d20 6469 7273 5b3a 2d31 5d2c 2064 6972  = dirs[:-1], dir
+00022190: 735b 2d31 5d0a 2020 2020 6173 7365 7274  s[-1].    assert
+000221a0: 206c 656e 2864 6972 7329 203e 3d20 310a   len(dirs) >= 1.
+000221b0: 2020 2020 666f 7220 6920 696e 2072 6576      for i in rev
+000221c0: 6572 7365 6428 7261 6e67 6528 6c65 6e28  ersed(range(len(
+000221d0: 6469 7273 2929 293a 0a20 2020 2020 2020  dirs))):.       
+000221e0: 2064 203d 2070 7265 6669 785f 6469 7220   d = prefix_dir 
+000221f0: 2b20 222f 222e 6a6f 696e 2864 6972 735b  + "/".join(dirs[
+00022200: 3a20 6920 2b20 315d 290a 2020 2020 2020  : i + 1]).      
+00022210: 2020 6173 7365 7274 206f 732e 7061 7468    assert os.path
+00022220: 2e69 7364 6972 2864 290a 2020 2020 2020  .isdir(d).      
+00022230: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+00022240: 7374 7328 2225 732f 5f5f 696e 6974 5f5f  sts("%s/__init__
+00022250: 2e70 7922 2025 2064 293a 0a20 2020 2020  .py" % d):.     
+00022260: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00022270: 2020 2020 2020 2020 6966 2064 206e 6f74          if d not
+00022280: 2069 6e20 7379 732e 7061 7468 3a0a 2020   in sys.path:.  
+00022290: 2020 2020 2020 2020 2020 7379 732e 7061            sys.pa
+000222a0: 7468 2e61 7070 656e 6428 6429 0a20 2020  th.append(d).   
+000222b0: 2020 2020 206d 203d 2022 2e22 2e6a 6f69       m = ".".joi
+000222c0: 6e28 6469 7273 5b69 202b 2031 203a 5d20  n(dirs[i + 1 :] 
+000222d0: 2b20 5b62 6173 655f 666e 5d29 0a20 2020  + [base_fn]).   
+000222e0: 2020 2020 2069 6620 6261 7365 5f66 6e2e       if base_fn.
+000222f0: 656e 6473 7769 7468 2822 2e70 7922 293a  endswith(".py"):
+00022300: 0a20 2020 2020 2020 2020 2020 206d 203d  .            m =
+00022310: 206d 5b3a 2d33 5d0a 2020 2020 2020 2020   m[:-3].        
+00022320: 7265 7475 726e 2069 6d70 6f72 746c 6962  return importlib
+00022330: 2e69 6d70 6f72 745f 6d6f 6475 6c65 286d  .import_module(m
+00022340: 290a 2020 2020 7261 6973 6520 5661 6c75  ).    raise Valu
+00022350: 6545 7272 6f72 2822 6361 6e6e 6f74 2066  eError("cannot f
+00022360: 6967 7572 6520 6f75 7420 6261 7365 206d  igure out base m
+00022370: 6f64 756c 6520 7061 7468 2066 726f 6d20  odule path from 
+00022380: 2572 2220 2520 6669 6c65 6e61 6d65 290a  %r" % filename).
+00022390: 0a0a 6465 6620 736f 6674 6d61 7828 782c  ..def softmax(x,
+000223a0: 2061 7869 733d 4e6f 6e65 293a 0a20 2020   axis=None):.   
+000223b0: 2022 2222 0a20 2020 203a 7061 7261 6d20   """.    :param 
+000223c0: 6e75 6d70 792e 6e64 6172 7261 7920 783a  numpy.ndarray x:
+000223d0: 0a20 2020 203a 7061 7261 6d20 696e 747c  .    :param int|
+000223e0: 4e6f 6e65 2061 7869 733a 0a20 2020 203a  None axis:.    :
+000223f0: 7274 7970 653a 206e 756d 7079 2e6e 6461  rtype: numpy.nda
+00022400: 7272 6179 0a20 2020 2022 2222 0a20 2020  rray.    """.   
+00022410: 2069 6d70 6f72 7420 6e75 6d70 790a 0a20   import numpy.. 
+00022420: 2020 2065 5f78 203d 206e 756d 7079 2e65     e_x = numpy.e
+00022430: 7870 2878 202d 206e 756d 7079 2e6d 6178  xp(x - numpy.max
+00022440: 2878 2c20 6178 6973 3d61 7869 732c 206b  (x, axis=axis, k
+00022450: 6565 7064 696d 733d 5472 7565 2929 0a20  eepdims=True)). 
+00022460: 2020 2072 6574 7572 6e20 655f 7820 2f20     return e_x / 
+00022470: 6e75 6d70 792e 7375 6d28 655f 782c 2061  numpy.sum(e_x, a
+00022480: 7869 733d 6178 6973 2c20 6b65 6570 6469  xis=axis, keepdi
+00022490: 6d73 3d54 7275 6529 0a0a 0a64 6566 2063  ms=True)...def c
+000224a0: 6f6c 6c65 6374 5f70 726f 635f 6d61 7073  ollect_proc_maps
+000224b0: 5f65 7865 635f 6669 6c65 7328 293a 0a20  _exec_files():. 
+000224c0: 2020 2022 2222 0a20 2020 2043 7572 7265     """.    Curre
+000224d0: 6e74 6c79 206f 6e6c 7920 776f 726b 7320  ntly only works 
+000224e0: 6f6e 204c 696e 7578 2e2e 2e0a 0a20 2020  on Linux.....   
+000224f0: 203a 7265 7475 726e 3a20 6c69 7374 206f   :return: list o
+00022500: 6620 6d61 7070 6564 2065 7865 6375 7461  f mapped executa
+00022510: 626c 6573 2028 6c69 6273 290a 2020 2020  bles (libs).    
+00022520: 3a72 7479 7065 3a20 6c69 7374 5b73 7472  :rtype: list[str
+00022530: 5d0a 2020 2020 2222 220a 2020 2020 696d  ].    """.    im
+00022540: 706f 7274 2072 650a 0a20 2020 2070 6964  port re..    pid
+00022550: 203d 206f 732e 6765 7470 6964 2829 0a20   = os.getpid(). 
+00022560: 2020 2066 6e73 203d 205b 5d0a 2020 2020     fns = [].    
+00022570: 666f 7220 6c69 6e65 2069 6e20 6f70 656e  for line in open
+00022580: 2822 2f70 726f 632f 2569 2f6d 6170 7322  ("/proc/%i/maps"
+00022590: 2025 2070 6964 2c20 2272 2229 2e72 6561   % pid, "r").rea
+000225a0: 6428 292e 7370 6c69 746c 696e 6573 2829  d().splitlines()
+000225b0: 3a20 2023 2066 6f72 2065 6163 6820 6d61  :  # for each ma
+000225c0: 7070 6564 2072 6567 696f 6e0a 2020 2020  pped region.    
+000225d0: 2020 2020 2320 6874 7470 733a 2f2f 7374      # https://st
+000225e0: 6163 6b6f 7665 7266 6c6f 772e 636f 6d2f  ackoverflow.com/
+000225f0: 7175 6573 7469 6f6e 732f 3134 3031 3335  questions/140135
+00022600: 392f 756e 6465 7273 7461 6e64 696e 672d  9/understanding-
+00022610: 6c69 6e75 782d 7072 6f63 2d69 642d 6d61  linux-proc-id-ma
+00022620: 7073 0a20 2020 2020 2020 2023 2061 6464  ps.        # add
+00022630: 7265 7373 2020 2020 2020 2020 2020 2070  ress           p
+00022640: 6572 6d73 206f 6666 7365 7420 2064 6576  erms offset  dev
+00022650: 2020 2069 6e6f 6465 2020 2070 6174 686e     inode   pathn
+00022660: 616d 650a 2020 2020 2020 2020 2320 452e  ame.        # E.
+00022670: 672e 3a0a 2020 2020 2020 2020 2320 3766  g.:.        # 7f
+00022680: 6632 6465 3931 6330 3030 2d37 6666 3264  f2de91c000-7ff2d
+00022690: 6539 3165 3030 3020 7277 2d70 2030 3031  e91e000 rw-p 001
+000226a0: 3763 3030 3020 3038 3a30 3220 3739 3438  7c000 08:02 7948
+000226b0: 3434 2020 2020 2020 2020 2020 2020 2020  44              
+000226c0: 2020 2020 2020 202f 7573 722f 6c69 622f         /usr/lib/
+000226d0: 7838 365f 3634 2d6c 696e 7578 2d67 6e75  x86_64-linux-gnu
+000226e0: 2f6c 6962 7374 6463 2b2e 2e2e 0a20 2020  /libstdc+....   
+000226f0: 2020 2020 206d 203d 2072 652e 6d61 7463       m = re.matc
+00022700: 6828 0a20 2020 2020 2020 2020 2020 2072  h(.            r
+00022710: 225e 285b 302d 3941 2d46 612d 665d 2b29  "^([0-9A-Fa-f]+)
+00022720: 2d28 5b30 2d39 412d 4661 2d66 5d2b 295c  -([0-9A-Fa-f]+)\
+00022730: 732b 285b 7277 7870 735c 2d5d 2b29 5c73  s+([rwxps\-]+)\s
+00022740: 2b28 5b30 2d39 412d 4661 2d66 5d2b 295c  +([0-9A-Fa-f]+)\
+00022750: 732b 285b 302d 3941 2d46 612d 663a 5d2b  s+([0-9A-Fa-f:]+
+00022760: 295c 732b 285b 302d 395d 2b29 5c73 2a28  )\s+([0-9]+)\s*(
+00022770: 2e2a 2924 222c 206c 696e 650a 2020 2020  .*)$", line.    
+00022780: 2020 2020 290a 2020 2020 2020 2020 6173      ).        as
+00022790: 7365 7274 206d 2c20 226e 6f20 6d61 7463  sert m, "no matc
+000227a0: 6820 666f 7220 2572 2220 2520 6c69 6e65  h for %r" % line
+000227b0: 0a20 2020 2020 2020 2061 6464 7265 7373  .        address
+000227c0: 5f73 7461 7274 2c20 6164 6472 6573 735f  _start, address_
+000227d0: 656e 642c 2070 6572 6d73 2c20 6f66 6673  end, perms, offs
+000227e0: 6574 2c20 6465 762c 2069 5f6e 6f64 652c  et, dev, i_node,
+000227f0: 2070 6174 685f 6e61 6d65 203d 206d 2e67   path_name = m.g
+00022800: 726f 7570 7328 290a 2020 2020 2020 2020  roups().        
+00022810: 6966 2022 7822 206e 6f74 2069 6e20 7065  if "x" not in pe
+00022820: 726d 733a 0a20 2020 2020 2020 2020 2020  rms:.           
+00022830: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00022840: 2020 6966 206e 6f74 2070 6174 685f 6e61    if not path_na
+00022850: 6d65 206f 7220 7061 7468 5f6e 616d 652e  me or path_name.
+00022860: 7374 6172 7473 7769 7468 2822 5b22 2920  startswith("[") 
+00022870: 6f72 2022 2864 656c 6574 6564 2922 2069  or "(deleted)" i
+00022880: 6e20 7061 7468 5f6e 616d 653a 0a20 2020  n path_name:.   
+00022890: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+000228a0: 650a 2020 2020 2020 2020 6966 2070 6174  e.        if pat
+000228b0: 685f 6e61 6d65 206e 6f74 2069 6e20 666e  h_name not in fn
+000228c0: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
+000228d0: 6e73 2e61 7070 656e 6428 7061 7468 5f6e  ns.append(path_n
+000228e0: 616d 6529 0a20 2020 2072 6574 7572 6e20  ame).    return 
+000228f0: 666e 730a 0a0a 6465 6620 6669 6e64 5f73  fns...def find_s
+00022900: 796d 5f69 6e5f 6578 6563 2866 6e2c 2073  ym_in_exec(fn, s
+00022910: 796d 293a 0a20 2020 2022 2222 0a20 2020  ym):.    """.   
+00022920: 2055 7365 7320 6060 6f62 6a64 756d 7060   Uses ``objdump`
+00022930: 6020 746f 206c 6973 7420 6176 6169 6c61  ` to list availa
+00022940: 626c 6520 7379 6d62 6f6c 732c 2061 6e64  ble symbols, and
+00022950: 2066 696c 7465 7273 2074 6865 6d20 6279   filters them by
+00022960: 2074 6865 2067 6976 656e 2060 6073 796d   the given ``sym
+00022970: 6060 2e0a 0a20 2020 203a 7061 7261 6d20  ``...    :param 
+00022980: 7374 7220 666e 3a20 7061 7468 0a20 2020  str fn: path.   
+00022990: 203a 7061 7261 6d20 7374 7220 7379 6d3a   :param str sym:
+000229a0: 0a20 2020 203a 7265 7475 726e 3a20 6d61  .    :return: ma
+000229b0: 7463 6865 6420 6f75 742c 206f 7220 4e6f  tched out, or No
+000229c0: 6e65 0a20 2020 203a 7274 7970 653a 2073  ne.    :rtype: s
+000229d0: 7472 7c4e 6f6e 650a 2020 2020 2222 220a  tr|None.    """.
+000229e0: 2020 2020 6672 6f6d 2073 7562 7072 6f63      from subproc
+000229f0: 6573 7320 696d 706f 7274 2043 616c 6c65  ess import Calle
+00022a00: 6450 726f 6365 7373 4572 726f 720a 0a20  dProcessError.. 
+00022a10: 2020 206f 626a 6475 6d70 203d 2022 6f62     objdump = "ob
+00022a20: 6a64 756d 7020 2d54 220a 2020 2020 6966  jdump -T".    if
+00022a30: 2073 7973 2e70 6c61 7466 6f72 6d20 3d3d   sys.platform ==
+00022a40: 2022 6461 7277 696e 223a 0a20 2020 2020   "darwin":.     
+00022a50: 2020 206f 626a 6475 6d70 203d 2022 6f74     objdump = "ot
+00022a60: 6f6f 6c20 2d49 4847 7622 0a20 2020 2073  ool -IHGv".    s
+00022a70: 6865 6c6c 5f63 6d64 203d 2022 2573 2025  hell_cmd = "%s %
+00022a80: 7320 7c20 6772 6570 2025 7322 2025 2028  s | grep %s" % (
+00022a90: 6f62 6a64 756d 702c 2066 6e2c 2073 796d  objdump, fn, sym
+00022aa0: 290a 2020 2020 7472 793a 0a20 2020 2020  ).    try:.     
+00022ab0: 2020 206f 7574 203d 2073 7973 5f65 7865     out = sys_exe
+00022ac0: 635f 6f75 7428 7368 656c 6c5f 636d 642c  c_out(shell_cmd,
+00022ad0: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
+00022ae0: 2065 7863 6570 7420 4361 6c6c 6564 5072   except CalledPr
+00022af0: 6f63 6573 7345 7272 6f72 3a20 2023 206e  ocessError:  # n
+00022b00: 6f6e 6520 666f 756e 640a 2020 2020 2020  one found.      
+00022b10: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
+00022b20: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
+00022b30: 6e63 6528 6f75 742c 2028 7374 722c 2075  nce(out, (str, u
+00022b40: 6e69 636f 6465 2929 0a20 2020 206f 7574  nicode)).    out
+00022b50: 5f6c 6e73 203d 206f 7574 2e73 706c 6974  _lns = out.split
+00022b60: 6c69 6e65 7328 290a 2020 2020 6f75 745f  lines().    out_
+00022b70: 6c6e 7320 3d20 5b6c 6e20 666f 7220 6c6e  lns = [ln for ln
+00022b80: 2069 6e20 6f75 745f 6c6e 7320 6966 2022   in out_lns if "
+00022b90: 2e74 6578 7422 2069 6e20 6c6e 5d20 2023  .text" in ln]  #
+00022ba0: 2073 6565 206f 626a 6475 6d70 0a20 2020   see objdump.   
+00022bb0: 206f 7574 5f6c 6e73 203d 205b 6c6e 2066   out_lns = [ln f
+00022bc0: 6f72 206c 6e20 696e 206f 7574 5f6c 6e73  or ln in out_lns
+00022bd0: 2069 6620 7379 6d20 696e 206c 6e2e 7370   if sym in ln.sp
+00022be0: 6c69 7428 295d 0a20 2020 2069 6620 6e6f  lit()].    if no
+00022bf0: 7420 6f75 745f 6c6e 733a 0a20 2020 2020  t out_lns:.     
+00022c00: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
+00022c10: 2020 2072 6574 7572 6e20 2246 6f75 6e64     return "Found
+00022c20: 2025 7220 696e 2025 723a 5c6e 2573 2220   %r in %r:\n%s" 
+00022c30: 2520 2873 796d 2c20 666e 2c20 225c 6e22  % (sym, fn, "\n"
+00022c40: 2e6a 6f69 6e28 6f75 745f 6c6e 7329 290a  .join(out_lns)).
+00022c50: 0a0a 6465 6620 6475 6d6d 795f 6e75 6d70  ..def dummy_nump
+00022c60: 795f 6765 6d6d 5f63 616c 6c28 293a 0a20  y_gemm_call():. 
+00022c70: 2020 2022 2222 0a20 2020 204a 7573 7420     """.    Just 
+00022c80: 7065 7266 6f72 6d73 2073 6f6d 6520 4745  performs some GE
+00022c90: 4d4d 2063 616c 6c20 7669 6120 4e75 6d70  MM call via Nump
+00022ca0: 792e 0a20 2020 2054 6869 7320 6d61 6b65  y..    This make
+00022cb0: 7320 7375 7265 2074 6861 7420 7468 6520  s sure that the 
+00022cc0: 424c 4153 206c 6962 7261 7279 2069 7320  BLAS library is 
+00022cd0: 6c6f 6164 6564 2e0a 2020 2020 2222 220a  loaded..    """.
+00022ce0: 2020 2020 696d 706f 7274 206e 756d 7079      import numpy
+00022cf0: 0a0a 2020 2020 6120 3d20 6e75 6d70 792e  ..    a = numpy.
+00022d00: 7261 6e64 6f6d 2e72 616e 646e 2835 2c20  random.randn(5, 
+00022d10: 3329 2e61 7374 7970 6528 6e75 6d70 792e  3).astype(numpy.
+00022d20: 666c 6f61 7433 3229 0a20 2020 2062 203d  float32).    b =
+00022d30: 206e 756d 7079 2e72 616e 646f 6d2e 7261   numpy.random.ra
+00022d40: 6e64 6e28 332c 2037 292e 6173 7479 7065  ndn(3, 7).astype
+00022d50: 286e 756d 7079 2e66 6c6f 6174 3332 290a  (numpy.float32).
+00022d60: 2020 2020 6320 3d20 6e75 6d70 792e 646f      c = numpy.do
+00022d70: 7428 612c 2062 290a 2020 2020 6173 7365  t(a, b).    asse
+00022d80: 7274 206e 756d 7079 2e69 7366 696e 6974  rt numpy.isfinit
+00022d90: 6528 6329 2e61 6c6c 2829 0a0a 0a5f 6669  e(c).all()..._fi
+00022da0: 6e64 5f73 6765 6d6d 5f6c 6962 5f66 726f  nd_sgemm_lib_fro
+00022db0: 6d5f 7275 6e74 696d 655f 6361 6368 6564  m_runtime_cached
+00022dc0: 203d 204e 6f6e 650a 0a0a 6465 6620 6669   = None...def fi
+00022dd0: 6e64 5f73 6765 6d6d 5f6c 6962 735f 6672  nd_sgemm_libs_fr
+00022de0: 6f6d 5f72 756e 7469 6d65 2829 3a0a 2020  om_runtime():.  
+00022df0: 2020 2222 220a 2020 2020 4c6f 6f6b 7320    """.    Looks 
+00022e00: 7468 726f 7567 6820 616c 6c20 6c69 6273  through all libs
+00022e10: 2076 6961 203a 6675 6e63 3a60 636f 6c6c   via :func:`coll
+00022e20: 6563 745f 7072 6f63 5f6d 6170 735f 6578  ect_proc_maps_ex
+00022e30: 6563 5f66 696c 6573 602c 0a20 2020 2061  ec_files`,.    a
+00022e40: 6e64 2073 6561 7263 6865 7320 666f 7220  nd searches for 
+00022e50: 616c 6c20 7768 6963 6820 6861 7665 2074  all which have t
+00022e60: 6865 2060 6073 6765 6d6d 6060 2073 796d  he ``sgemm`` sym
+00022e70: 626f 6c2e 0a20 2020 2043 7572 7265 6e74  bol..    Current
+00022e80: 6c79 206f 6e6c 7920 776f 726b 7320 6f6e  ly only works on
+00022e90: 204c 696e 7578 2028 6265 6361 7573 6520   Linux (because 
+00022ea0: 636f 6c6c 6563 745f 7072 6f63 5f6d 6170  collect_proc_map
+00022eb0: 735f 6578 6563 5f66 696c 6573 292e 0a0a  s_exec_files)...
+00022ec0: 2020 2020 3a72 6574 7572 6e3a 206c 6973      :return: lis
+00022ed0: 7420 6f66 206c 6962 7320 2874 6865 6972  t of libs (their
+00022ee0: 2070 6174 6829 0a20 2020 203a 7274 7970   path).    :rtyp
+00022ef0: 653a 206c 6973 745b 7374 725d 0a20 2020  e: list[str].   
+00022f00: 2022 2222 0a20 2020 2069 6620 6e6f 7420   """.    if not 
+00022f10: 6f73 2e70 6174 682e 6578 6973 7473 2822  os.path.exists("
+00022f20: 2f70 726f 6322 293a 0a20 2020 2020 2020  /proc"):.       
+00022f30: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+00022f40: 2067 6c6f 6261 6c20 5f66 696e 645f 7367   global _find_sg
+00022f50: 656d 6d5f 6c69 625f 6672 6f6d 5f72 756e  emm_lib_from_run
+00022f60: 7469 6d65 5f63 6163 6865 640a 2020 2020  time_cached.    
+00022f70: 6966 205f 6669 6e64 5f73 6765 6d6d 5f6c  if _find_sgemm_l
+00022f80: 6962 5f66 726f 6d5f 7275 6e74 696d 655f  ib_from_runtime_
+00022f90: 6361 6368 6564 2069 7320 6e6f 7420 4e6f  cached is not No
+00022fa0: 6e65 3a0a 2020 2020 2020 2020 7265 7475  ne:.        retu
+00022fb0: 726e 205f 6669 6e64 5f73 6765 6d6d 5f6c  rn _find_sgemm_l
+00022fc0: 6962 5f66 726f 6d5f 7275 6e74 696d 655f  ib_from_runtime_
+00022fd0: 6361 6368 6564 0a20 2020 2064 756d 6d79  cached.    dummy
+00022fe0: 5f6e 756d 7079 5f67 656d 6d5f 6361 6c6c  _numpy_gemm_call
+00022ff0: 2829 2020 2320 6d61 6b65 2073 7572 6520  ()  # make sure 
+00023000: 7468 6174 204e 756d 7079 2069 7320 6c6f  that Numpy is lo
+00023010: 6164 6564 2061 6e64 204e 756d 7079 2073  aded and Numpy s
+00023020: 6765 6d6d 2069 7320 6176 6169 6c61 626c  gemm is availabl
+00023030: 650a 2020 2020 666e 7320 3d20 636f 6c6c  e.    fns = coll
+00023040: 6563 745f 7072 6f63 5f6d 6170 735f 6578  ect_proc_maps_ex
+00023050: 6563 5f66 696c 6573 2829 0a20 2020 2066  ec_files().    f
+00023060: 6e73 5f77 6974 685f 7367 656d 6d20 3d20  ns_with_sgemm = 
+00023070: 5b5d 0a20 2020 2066 6f72 2066 6e20 696e  [].    for fn in
+00023080: 2066 6e73 3a0a 2020 2020 2020 2020 6f75   fns:.        ou
+00023090: 7420 3d20 6669 6e64 5f73 796d 5f69 6e5f  t = find_sym_in_
+000230a0: 6578 6563 2866 6e2c 2022 7367 656d 6d5f  exec(fn, "sgemm_
+000230b0: 2229 0a20 2020 2020 2020 2069 6620 6f75  ").        if ou
+000230c0: 743a 0a20 2020 2020 2020 2020 2020 2066  t:.            f
+000230d0: 6e73 5f77 6974 685f 7367 656d 6d2e 6170  ns_with_sgemm.ap
+000230e0: 7065 6e64 2866 6e29 0a20 2020 205f 6669  pend(fn).    _fi
+000230f0: 6e64 5f73 6765 6d6d 5f6c 6962 5f66 726f  nd_sgemm_lib_fro
+00023100: 6d5f 7275 6e74 696d 655f 6361 6368 6564  m_runtime_cached
+00023110: 203d 2066 6e73 5f77 6974 685f 7367 656d   = fns_with_sgem
+00023120: 6d0a 2020 2020 7265 7475 726e 2066 6e73  m.    return fns
+00023130: 5f77 6974 685f 7367 656d 6d0a 0a0a 5f66  _with_sgemm..._f
+00023140: 696e 645f 6c69 6263 7564 6172 745f 6672  ind_libcudart_fr
+00023150: 6f6d 5f72 756e 7469 6d65 5f63 6163 6865  om_runtime_cache
+00023160: 6420 3d20 4e6f 6e65 0a0a 0a64 6566 2066  d = None...def f
+00023170: 696e 645f 6c69 6263 7564 6172 745f 6672  ind_libcudart_fr
+00023180: 6f6d 5f72 756e 7469 6d65 2829 3a0a 2020  om_runtime():.  
+00023190: 2020 2222 220a 2020 2020 4c6f 6f6b 7320    """.    Looks 
+000231a0: 7468 726f 7567 6820 616c 6c20 6c69 6273  through all libs
+000231b0: 2076 6961 203a 6675 6e63 3a60 636f 6c6c   via :func:`coll
+000231c0: 6563 745f 7072 6f63 5f6d 6170 735f 6578  ect_proc_maps_ex
+000231d0: 6563 5f66 696c 6573 602c 0a20 2020 2061  ec_files`,.    a
+000231e0: 6e64 2073 6561 7263 6865 7320 666f 7220  nd searches for 
+000231f0: 616c 6c20 7768 6963 6820 6861 7665 2074  all which have t
+00023200: 6865 2060 6073 6765 6d6d 6060 2073 796d  he ``sgemm`` sym
+00023210: 626f 6c2e 0a20 2020 2043 7572 7265 6e74  bol..    Current
+00023220: 6c79 206f 6e6c 7920 776f 726b 7320 6f6e  ly only works on
+00023230: 204c 696e 7578 2028 6265 6361 7573 6520   Linux (because 
+00023240: 636f 6c6c 6563 745f 7072 6f63 5f6d 6170  collect_proc_map
+00023250: 735f 6578 6563 5f66 696c 6573 292e 0a0a  s_exec_files)...
+00023260: 2020 2020 3a72 6574 7572 6e3a 206c 6973      :return: lis
+00023270: 7420 6f66 206c 6962 7320 2874 6865 6972  t of libs (their
+00023280: 2070 6174 6829 0a20 2020 203a 7274 7970   path).    :rtyp
+00023290: 653a 2073 7472 7c4e 6f6e 650a 2020 2020  e: str|None.    
+000232a0: 2222 220a 2020 2020 6966 206e 6f74 206f  """.    if not o
+000232b0: 732e 7061 7468 2e65 7869 7374 7328 222f  s.path.exists("/
+000232c0: 7072 6f63 2229 3a0a 2020 2020 2020 2020  proc"):.        
+000232d0: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
+000232e0: 676c 6f62 616c 205f 6669 6e64 5f6c 6962  global _find_lib
+000232f0: 6375 6461 7274 5f66 726f 6d5f 7275 6e74  cudart_from_runt
+00023300: 696d 655f 6361 6368 6564 0a20 2020 2069  ime_cached.    i
+00023310: 6620 5f66 696e 645f 6c69 6263 7564 6172  f _find_libcudar
+00023320: 745f 6672 6f6d 5f72 756e 7469 6d65 5f63  t_from_runtime_c
+00023330: 6163 6865 6420 6973 206e 6f74 204e 6f6e  ached is not Non
+00023340: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
+00023350: 6e20 5f66 696e 645f 6c69 6263 7564 6172  n _find_libcudar
+00023360: 745f 6672 6f6d 5f72 756e 7469 6d65 5f63  t_from_runtime_c
+00023370: 6163 6865 645b 305d 0a20 2020 2066 6e73  ached[0].    fns
+00023380: 203d 2063 6f6c 6c65 6374 5f70 726f 635f   = collect_proc_
+00023390: 6d61 7073 5f65 7865 635f 6669 6c65 7328  maps_exec_files(
+000233a0: 290a 2020 2020 666f 7220 666e 2069 6e20  ).    for fn in 
+000233b0: 666e 733a 0a20 2020 2020 2020 2069 6620  fns:.        if 
+000233c0: 7265 2e6d 6174 6368 2822 2e2a 2f6c 6962  re.match(".*/lib
+000233d0: 6375 6461 7274 5c5c 2e73 6f28 5c5c 2e2e  cudart\\.so(\\..
+000233e0: 2a29 3f22 2c20 666e 293a 0a20 2020 2020  *)?", fn):.     
+000233f0: 2020 2020 2020 205f 6669 6e64 5f6c 6962         _find_lib
+00023400: 6375 6461 7274 5f66 726f 6d5f 7275 6e74  cudart_from_runt
+00023410: 696d 655f 6361 6368 6564 203d 205b 666e  ime_cached = [fn
+00023420: 5d0a 2020 2020 2020 2020 2020 2020 7265  ].            re
+00023430: 7475 726e 2066 6e0a 2020 2020 5f66 696e  turn fn.    _fin
+00023440: 645f 6c69 6263 7564 6172 745f 6672 6f6d  d_libcudart_from
+00023450: 5f72 756e 7469 6d65 5f63 6163 6865 6420  _runtime_cached 
+00023460: 3d20 5b4e 6f6e 655d 0a20 2020 2072 6574  = [None].    ret
+00023470: 7572 6e20 4e6f 6e65 0a                   urn None.
```

### Comparing `returnn-1.20230411.4301/returnn/util/better_exchook.py` & `returnn-1.20230412.101550/returnn/util/better_exchook.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/util/bpe.py` & `returnn-1.20230412.101550/returnn/util/bpe.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/util/debug.py` & `returnn-1.20230412.101550/returnn/util/debug.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/util/debug_helpers.py` & `returnn-1.20230412.101550/returnn/util/debug_helpers.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/util/fsa.py` & `returnn-1.20230412.101550/returnn/util/fsa.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/util/literal_py_to_pickle.py` & `returnn-1.20230412.101550/returnn/util/literal_py_to_pickle.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/util/pprint.py` & `returnn-1.20230412.101550/returnn/util/pprint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/util/py-to-pickle.cpp` & `returnn-1.20230412.101550/returnn/util/py-to-pickle.cpp`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/util/sig_proc.py` & `returnn-1.20230412.101550/returnn/util/sig_proc.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn/util/task_system.py` & `returnn-1.20230412.101550/returnn/util/task_system.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/returnn.egg-info/PKG-INFO` & `returnn-1.20230412.101550/returnn.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: returnn
-Version: 1.20230411.4301
+Version: 1.20230412.101550
 Summary: The RWTH extensible training framework for universal recurrent neural networks
 Home-page: https://github.com/rwth-i6/returnn/
 Author: Albert Zeyer
 Author-email: albzey@gmail.com
 License: RETURNN license
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Environment :: Console
```

### Comparing `returnn-1.20230411.4301/returnn.egg-info/SOURCES.txt` & `returnn-1.20230412.101550/returnn.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/setup.py` & `returnn-1.20230412.101550/setup.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/DummySprintExec.py` & `returnn-1.20230412.101550/tests/DummySprintExec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/PyCharm-inspection-profile.xml` & `returnn-1.20230412.101550/tests/PyCharm-inspection-profile.xml`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/PyCharm.idea/codeStyleSettings.xml` & `returnn-1.20230412.101550/tests/PyCharm.idea/codeStyleSettings.xml`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml` & `returnn-1.20230412.101550/tests/PyCharm.idea/inspectionProfiles/Project_Default.xml`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/_set_num_threads1.py` & `returnn-1.20230412.101550/tests/_set_num_threads1.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/_setup_test_env.py` & `returnn-1.20230412.101550/tests/_setup_test_env.py`

 * *Files 2% similar despite different names*

```diff
@@ -60,21 +60,24 @@
 
     from returnn.log import log
 
     # No propagate, use stdout directly.
     log.initialize(verbosity=[5], propagate=False)
 
     # TF is optional.
-    # Note that importing TF still has a small side effect:
-    # BackendEngine._get_default_engine() will return TF by default, if TF is already loaded.
-    # For most tests, this does not matter.
-    try:
-        import tensorflow as tf
-    except ImportError:
+    if "RETURNN_DISABLE_TF" in os.environ and int(os.environ["RETURNN_DISABLE_TF"]) == 1:
         tf = None
+    else:
+        # Note that importing TF still has a small side effect:
+        # BackendEngine._get_default_engine() will return TF by default, if TF is already loaded.
+        # For most tests, this does not matter.
+        try:
+            import tensorflow as tf
+        except ImportError:
+            tf = None
 
     if tf:
         import returnn.tf.util.basic as tf_util
 
         tf_util.debug_register_better_repr()
 
     import returnn.util.debug as debug
```

### Comparing `returnn-1.20230411.4301/tests/bpe-unicode-demo.codes` & `returnn-1.20230412.101550/tests/bpe-unicode-demo.codes`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/bpe-unicode-demo.vocab` & `returnn-1.20230412.101550/tests/bpe-unicode-demo.vocab`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/lexicon_opt.isyms` & `returnn-1.20230412.101550/tests/lexicon_opt.isyms`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/lexicon_opt.jpg` & `returnn-1.20230412.101550/tests/lexicon_opt.jpg`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/lint_common.py` & `returnn-1.20230412.101550/tests/lint_common.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/pycharm-inspect.py` & `returnn-1.20230412.101550/tests/pycharm-inspect.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/pylint.py` & `returnn-1.20230412.101550/tests/pylint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/returnn-as-framework.py` & `returnn-1.20230412.101550/tests/returnn-as-framework.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/rf_utils.py` & `returnn-1.20230412.101550/tests/rf_utils.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/spelling.dic` & `returnn-1.20230412.101550/tests/spelling.dic`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_Config.py` & `returnn-1.20230412.101550/tests/test_Config.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_Dataset.py` & `returnn-1.20230412.101550/tests/test_Dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_Fsa.py` & `returnn-1.20230412.101550/tests/test_Fsa.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_GeneratingDataset.py` & `returnn-1.20230412.101550/tests/test_GeneratingDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_HDFDataset.py` & `returnn-1.20230412.101550/tests/test_HDFDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_LearningRateControl.py` & `returnn-1.20230412.101550/tests/test_LearningRateControl.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_Log.py` & `returnn-1.20230412.101550/tests/test_Log.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_MultiProcDataset.py` & `returnn-1.20230412.101550/tests/test_MultiProcDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_PTDataset.py` & `returnn-1.20230412.101550/tests/test_PTDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_Pretrain.py` & `returnn-1.20230412.101550/tests/test_Pretrain.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_ResNet.py` & `returnn-1.20230412.101550/tests/test_ResNet.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_SprintDataset.py` & `returnn-1.20230412.101550/tests/test_SprintDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_SprintInterface.py` & `returnn-1.20230412.101550/tests/test_SprintInterface.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_TFEngine.py` & `returnn-1.20230412.101550/tests/test_TFEngine.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_TFNativeOp.py` & `returnn-1.20230412.101550/tests/test_TFNativeOp.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_TFNetworkLayer.py` & `returnn-1.20230412.101550/tests/test_TFNetworkLayer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_TFNetworkRecLayer.py` & `returnn-1.20230412.101550/tests/test_TFNetworkRecLayer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_TFNetworkSigProcLayer.py` & `returnn-1.20230412.101550/tests/test_TFNetworkSigProcLayer.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_TFUpdater.py` & `returnn-1.20230412.101550/tests/test_TFUpdater.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_TFUtil.py` & `returnn-1.20230412.101550/tests/test_TFUtil.py`

 * *Files 0% similar despite different names*

```diff
@@ -420,15 +420,15 @@
     assert_equal(d1.find_matching_dims(d2.get_dim_tag(0), is_equal_opts=is_equal_opts_match), [1])
     assert_equal(d1.find_matching_dims(d2.get_dim_tag(1), is_equal_opts=is_equal_opts_match), [1, 2])
 
     mapping = d1.find_matching_dim_map(d2, list(range(d2.batch_ndim)), is_equal_opts)  # maps d2 -> d1
     assert mapping[0] == 1 and mapping[1] == 2
 
     copied = d2.copy_compatible_to(d1)
-    assert copied.batch_ndim == d1.batch_ndim and copied.batch.static_dim == 1 and copied.batch_shape == (1, 5, 1)
+    assert copied.batch_ndim == d1.batch_ndim and copied.get_static_batch_dim() == 1 and copied.batch_shape == (1, 5, 1)
     print("copied compatible:", copied)
 
 
 def test_Data_get_all_dimension_tags_same_spatial_dim_twice():
     from returnn.tf.util.data import batch_dim, SpatialDim, FeatureDim
 
     time_dim = SpatialDim("time")
@@ -629,22 +629,22 @@
 
 def test_Data_copy_compatible_to_src_no_batch():
     d1 = Data(name="d1", shape=(None, 1), time_dim_axis=None)
     d1.placeholder = tf.zeros([d if (d is not None) else 1 for d in d1.batch_shape])
     d2 = Data(name="d2", shape=(), batch_dim_axis=None, time_dim_axis=None)
     d2.placeholder = tf.zeros([d if (d is not None) else 1 for d in d2.batch_shape])
     d3 = d2.copy_compatible_to(d1)
-    assert d3.batch.static_dim == 1 and d3.batch_shape == (1, 1, 1)
+    assert d3.get_static_batch_dim() == 1 and d3.batch_shape == (1, 1, 1)
 
 
 def test_Data_copy_compatible_to_add_batch_dim():
     common_data = Data(name="accum_att_weights_output", shape=(None, 1))
     d1 = Data(name="att_weights_avg_output", shape=(1,), batch_dim_axis=None)
     d2 = d1.copy_compatible_to(common_data)
-    assert d2.have_batch_axis() and d2.batch.static_dim == 1 and d2.batch_shape == (1, 1, 1)
+    assert d2.have_batch_axis() and d2.get_static_batch_dim() == 1 and d2.batch_shape == (1, 1, 1)
 
 
 def test_Data_copy_compatible_to_add_feature_dim():
     common_data = Data(name="energy", shape=(None, 3), time_dim_axis=0, batch_dim_axis=None)  # [T,F]
     d1 = Data(name="mask", shape=(None,), batch_dim_axis=None, time_dim_axis=0, feature_dim_axis=None)  # [T]
     d2 = d1.copy_compatible_to(common_data)
     assert d2.batch_dim_axis is None and d2.time_dim_axis is not None and d2.batch_shape == (None, 1)
@@ -654,15 +654,15 @@
     common_data = Data(name="energy", shape=(None, 3))  # [B,T,F]
     assert common_data.batch_shape == (None, None, 3)
     d1 = Data(name="mask", shape=(None,), batch_dim_axis=None, time_dim_axis=0, feature_dim_axis=None)  # [T]
     assert d1.batch_shape == (None,)
     d2 = d1.copy_compatible_to(common_data)
     print(d2)
     assert d2.have_batch_axis() and d2.have_time_axis()
-    assert d2.batch.static_dim == 1  # batch-dim is broadcasted
+    assert d2.get_static_batch_dim() == 1  # batch-dim is broadcasted
     assert d2.batch_shape == (1, None, 1)
 
 
 def test_Data_copy_compatible_to_add_time_dim():
     common_data = Data(name="energy", shape=(None, 3))  # [B,T,F]
     d1 = Data(name="mask", shape=(3,))  # [B,F]
     d2 = d1.copy_compatible_to(common_data)
```

### Comparing `returnn-1.20230411.4301/tests/test_TF_determinism.py` & `returnn-1.20230412.101550/tests/test_TF_determinism.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_TaskSystem.py` & `returnn-1.20230412.101550/tests/test_TaskSystem.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_TaskSystem_SharedMem.py` & `returnn-1.20230412.101550/tests/test_TaskSystem_SharedMem.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_TranslationDataset.py` & `returnn-1.20230412.101550/tests/test_TranslationDataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_Util.py` & `returnn-1.20230412.101550/tests/test_Util.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_demos.py` & `returnn-1.20230412.101550/tests/test_demos.py`

 * *Files 5% similar despite different names*

```diff
@@ -62,16 +62,19 @@
         print("std out/err:\n---\n%s\n---\n" % out)
         raise CalledProcessError(cmd=args, returncode=p.returncode, output=out)
     if print_stdout:
         print("std out/err:\n---\n%s\n---\n" % out)
     return out
 
 
-def run_and_parse_last_fer(*args, **kwargs):
-    out = run(*args, **kwargs)
+def parse_last_fer(out: str) -> float:
+    """
+    :param out:
+    :return: FER
+    """
     parsed_fer = None
     for line in out.splitlines():
         # example: epoch 5 score: 0.0231807245472 elapsed: 0:00:04 dev: score 0.0137521058997 error 0.00268961807423
         m = re.match("epoch [0-9]+ score: .* dev: .* error ([0-9.]+)\\s?", line)
         if not m:
             # example: dev: score 0.03350000149202181 error 0.009919877954075871
             m = re.match("dev: score .* error ([0-9.]+)\\s?", line)
@@ -79,14 +82,19 @@
             continue
         parsed_fer = float(m.group(1))
     err_msg = "ERROR: No epoch dev errors found in output"
     assert parsed_fer is not None, "%s.\nOutput:\n\n%s\n\n%s." % (err_msg, out, err_msg)
     return parsed_fer
 
 
+def run_and_parse_last_fer(*args, **kwargs):
+    out = run(*args, **kwargs)
+    return parse_last_fer(out)
+
+
 def run_config_get_fer(config_filename, env_update=None, *, log_verbosity=5, print_stdout=False):
     cleanup_tmp_models(config_filename)
     fer = run_and_parse_last_fer(
         py,
         "rnn.py",
         config_filename,
         "++log_verbosity",
@@ -142,14 +150,24 @@
 @unittest.skipIf(not torch, "no PyTorch")
 def test_demo_rf_torch_task12ax():
     cleanup_tmp_models("demos/demo-rf.config")
     run(py, "rnn.py", "demos/demo-rf.config", print_stdout=True)
     # TODO also check FER. So far this is not properly reported. https://github.com/rwth-i6/returnn/issues/1120
 
 
+@unittest.skipIf(not tf, "no TF")
+def test_demo_rf_tf_task12ax():
+    cleanup_tmp_models("demos/demo-rf.config")
+    out = run(py, "rnn.py", "demos/demo-rf.config", "++backend", "tensorflow-net-dict", print_stdout=True)
+    # Currently this just uses linear layers, so it's not very good.
+    # Also see test_demo_tf_task12ax above.
+    fer = parse_last_fer(out)
+    assert_less(fer, 0.15)
+
+
 def test_demo_iter_dataset_task12ax():
     # there should be no actual TF dependency, we just iterate the dataset
     cleanup_tmp_models("demos/demo-tf-vanilla-lstm.12ax.config")
     # pick any 12ax config for the dataset test
     out = run(py, "demos/demo-iter-dataset.py", "demos/demo-tf-vanilla-lstm.12ax.config")
     assert_in("Epoch 5.", out.splitlines())
```

### Comparing `returnn-1.20230411.4301/tests/test_fork_exec.py` & `returnn-1.20230412.101550/tests/test_fork_exec.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_hdf_dump.py` & `returnn-1.20230412.101550/tests/test_hdf_dump.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_rf_base.py` & `returnn-1.20230412.101550/tests/test_rf_base.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_tensor.py` & `returnn-1.20230412.101550/tests/test_tensor.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_tools.py` & `returnn-1.20230412.101550/tests/test_tools.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_torch_frontend.py` & `returnn-1.20230412.101550/tests/test_torch_frontend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tests/test_torch_internal_frontend.py` & `returnn-1.20230412.101550/tests/test_torch_internal_frontend.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/analyze-dataset-batches.py` & `returnn-1.20230412.101550/tools/analyze-dataset-batches.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/bliss-collect-seq-lens.py` & `returnn-1.20230412.101550/tools/bliss-collect-seq-lens.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/bliss-dump-text.py` & `returnn-1.20230412.101550/tools/bliss-dump-text.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/bliss-get-segment-names.py` & `returnn-1.20230412.101550/tools/bliss-get-segment-names.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/bliss-to-ogg-zip.py` & `returnn-1.20230412.101550/tools/bliss-to-ogg-zip.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/bpe-create-lexicon.py` & `returnn-1.20230412.101550/tools/bpe-create-lexicon.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/calculate-word-error-rate.py` & `returnn-1.20230412.101550/tools/calculate-word-error-rate.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/cleanup-old-models.py` & `returnn-1.20230412.101550/tools/cleanup-old-models.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/collect-orth-symbols.py` & `returnn-1.20230412.101550/tools/collect-orth-symbols.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/collect-words.py` & `returnn-1.20230412.101550/tools/collect-words.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/compile_native_op.py` & `returnn-1.20230412.101550/tools/compile_native_op.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/compile_tf_graph.py` & `returnn-1.20230412.101550/tools/compile_tf_graph.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/debug-dump-search-scores.py` & `returnn-1.20230412.101550/tools/debug-dump-search-scores.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/debug-plot-search-scores.py` & `returnn-1.20230412.101550/tools/debug-plot-search-scores.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/dump-dataset-raw-strings.py` & `returnn-1.20230412.101550/tools/dump-dataset-raw-strings.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/dump-dataset.py` & `returnn-1.20230412.101550/tools/dump-dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/dump-forward-stats.py` & `returnn-1.20230412.101550/tools/dump-forward-stats.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/dump-forward.py` & `returnn-1.20230412.101550/tools/dump-forward.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/dump-network-json.py` & `returnn-1.20230412.101550/tools/dump-network-json.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/dump-pickle.py` & `returnn-1.20230412.101550/tools/dump-pickle.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/extract_state_tying_from_dataset.py` & `returnn-1.20230412.101550/tools/extract_state_tying_from_dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/get-attention-weights.py` & `returnn-1.20230412.101550/tools/get-attention-weights.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/get-best-model-epoch.py` & `returnn-1.20230412.101550/tools/get-best-model-epoch.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/hdf_dump.py` & `returnn-1.20230412.101550/tools/hdf_dump.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/hdf_dump_translation_dataset.py` & `returnn-1.20230412.101550/tools/hdf_dump_translation_dataset.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/import-blocks-mt-model.py` & `returnn-1.20230412.101550/tools/import-blocks-mt-model.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/import-t2t-mt-model.py` & `returnn-1.20230412.101550/tools/import-t2t-mt-model.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/Makefile` & `returnn-1.20230412.101550/tools/lattice_rescorer/Makefile`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/README.md` & `returnn-1.20230412.101550/tools/lattice_rescorer/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/example/README.md` & `returnn-1.20230412.101550/tools/lattice_rescorer/example/README.md`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config` & `returnn-1.20230412.101550/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config` & `returnn-1.20230412.101550/tools/lattice_rescorer/example/network.040/i600_m600_m600.sgd_b16_lr0_cl2.newbobabs.keep_over_epoch.lstm2.config`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/example/rescore_lattice.sh` & `returnn-1.20230412.101550/tools/lattice_rescorer/example/rescore_lattice.sh`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/file.h` & `returnn-1.20230412.101550/tools/lattice_rescorer/file.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/htklatticerescorer.cc` & `returnn-1.20230412.101550/tools/lattice_rescorer/htklatticerescorer.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/htklatticerescorer.h` & `returnn-1.20230412.101550/tools/lattice_rescorer/htklatticerescorer.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/main.cc` & `returnn-1.20230412.101550/tools/lattice_rescorer/main.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/rescorer.h` & `returnn-1.20230412.101550/tools/lattice_rescorer/rescorer.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/vocabulary.cc` & `returnn-1.20230412.101550/tools/lattice_rescorer/vocabulary.cc`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/lattice_rescorer/vocabulary.h` & `returnn-1.20230412.101550/tools/lattice_rescorer/vocabulary.h`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/tf_avg_checkpoints.py` & `returnn-1.20230412.101550/tools/tf_avg_checkpoints.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/tf_inspect_checkpoint.py` & `returnn-1.20230412.101550/tools/tf_inspect_checkpoint.py`

 * *Files identical despite different names*

### Comparing `returnn-1.20230411.4301/tools/tf_inspect_summary_log.py` & `returnn-1.20230412.101550/tools/tf_inspect_summary_log.py`

 * *Files identical despite different names*

