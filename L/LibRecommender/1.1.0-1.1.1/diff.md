# Comparing `tmp/LibRecommender-1.1.0.tar.gz` & `tmp/LibRecommender-1.1.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "LibRecommender-1.1.0.tar", last modified: Thu Apr  6 09:00:37 2023, max compression
+gzip compressed data, was "LibRecommender-1.1.1.tar", last modified: Wed Apr 12 08:39:53 2023, max compression
```

## Comparing `LibRecommender-1.1.0.tar` & `LibRecommender-1.1.1.tar`

### file list

```diff
@@ -1,163 +1,163 @@
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.182230 LibRecommender-1.1.0/
--rw-r--r--   0 runner    (1001) docker     (122)     1083 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/LICENSE
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.114229 LibRecommender-1.1.0/LibRecommender.egg-info/
--rw-r--r--   0 runner    (1001) docker     (122)    28129 2023-04-06 09:00:37.000000 LibRecommender-1.1.0/LibRecommender.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (122)     4103 2023-04-06 09:00:37.000000 LibRecommender-1.1.0/LibRecommender.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (122)        1 2023-04-06 09:00:37.000000 LibRecommender-1.1.0/LibRecommender.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (122)       19 2023-04-06 09:00:37.000000 LibRecommender-1.1.0/LibRecommender.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (122)       19 2023-04-06 09:00:37.000000 LibRecommender-1.1.0/LibRecommender.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (122)      252 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (122)    28129 2023-04-06 09:00:37.182230 LibRecommender-1.1.0/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (122)    27012 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/README.md
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.114229 LibRecommender-1.1.0/libreco/
--rwxr-xr-x   0 runner    (1001) docker     (122)       22 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.126229 LibRecommender-1.1.0/libreco/algorithms/
--rwxr-xr-x   0 runner    (1001) docker     (122)     1108 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)   948377 2023-04-06 09:00:33.000000 LibRecommender-1.1.0/libreco/algorithms/_als.cpp
--rwxr-xr-x   0 runner    (1001) docker     (122)     8810 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/_als.pyx
--rw-r--r--   0 runner    (1001) docker     (122)  1006940 2023-04-06 09:00:34.000000 LibRecommender-1.1.0/libreco/algorithms/_bpr.cpp
--rwxr-xr-x   0 runner    (1001) docker     (122)    16314 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/_bpr.pyx
--rwxr-xr-x   0 runner    (1001) docker     (122)    11324 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/als.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    11397 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/autoint.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    13580 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/bpr.py
--rw-r--r--   0 runner    (1001) docker     (122)     8247 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/caser.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    12159 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/deepfm.py
--rw-r--r--   0 runner    (1001) docker     (122)     3609 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/deepwalk.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    16879 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/din.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    11490 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/fm.py
--rw-r--r--   0 runner    (1001) docker     (122)     6364 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/graphsage.py
--rw-r--r--   0 runner    (1001) docker     (122)     7535 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/graphsage_dgl.py
--rw-r--r--   0 runner    (1001) docker     (122)     2579 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/item2vec.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     6082 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/item_cf.py
--rw-r--r--   0 runner    (1001) docker     (122)     4725 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/lightgcn.py
--rw-r--r--   0 runner    (1001) docker     (122)     6148 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/ncf.py
--rw-r--r--   0 runner    (1001) docker     (122)     5062 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/ngcf.py
--rw-r--r--   0 runner    (1001) docker     (122)     6749 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/pinsage.py
--rw-r--r--   0 runner    (1001) docker     (122)     7210 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/pinsage_dgl.py
--rw-r--r--   0 runner    (1001) docker     (122)     8733 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/rnn4rec.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     5438 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/svd.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     7620 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/svdpp.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.130229 LibRecommender-1.1.0/libreco/algorithms/torch_modules/
--rw-r--r--   0 runner    (1001) docker     (122)      343 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/torch_modules/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     6726 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/torch_modules/graphsage_module.py
--rw-r--r--   0 runner    (1001) docker     (122)     3560 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/torch_modules/lightgcn_module.py
--rw-r--r--   0 runner    (1001) docker     (122)     5240 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/torch_modules/ngcf_module.py
--rw-r--r--   0 runner    (1001) docker     (122)     7945 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/torch_modules/pinsage_module.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     6799 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/user_cf.py
--rw-r--r--   0 runner    (1001) docker     (122)     7960 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/wave_net.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    11945 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/wide_deep.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    11077 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/youtube_ranking.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    12797 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/algorithms/youtube_retrieval.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.134230 LibRecommender-1.1.0/libreco/bases/
--rw-r--r--   0 runner    (1001) docker     (122)      387 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/bases/__init__.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     4731 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/bases/base.py
--rw-r--r--   0 runner    (1001) docker     (122)    13085 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/bases/cf_base.py
--rw-r--r--   0 runner    (1001) docker     (122)    19006 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/bases/embed_base.py
--rw-r--r--   0 runner    (1001) docker     (122)     4865 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/bases/gensim_base.py
--rw-r--r--   0 runner    (1001) docker     (122)      545 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/bases/meta.py
--rw-r--r--   0 runner    (1001) docker     (122)     5920 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/bases/sage_base.py
--rw-r--r--   0 runner    (1001) docker     (122)     2853 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/bases/seq_base.py
--rw-r--r--   0 runner    (1001) docker     (122)    13317 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/bases/tf_base.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.138229 LibRecommender-1.1.0/libreco/batch/
--rw-r--r--   0 runner    (1001) docker     (122)      169 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/batch/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     3940 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/batch/batch_data.py
--rw-r--r--   0 runner    (1001) docker     (122)     5495 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/batch/batch_unit.py
--rw-r--r--   0 runner    (1001) docker     (122)    17782 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/batch/collators.py
--rw-r--r--   0 runner    (1001) docker     (122)      153 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/batch/enums.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     3475 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/batch/sequence.py
--rw-r--r--   0 runner    (1001) docker     (122)     2642 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/batch/tf_feed_dicts.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.142230 LibRecommender-1.1.0/libreco/data/
--rwxr-xr-x   0 runner    (1001) docker     (122)      599 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     2432 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/data/consumed.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    20843 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/data/data_info.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    26422 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/data/dataset.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     5947 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/data/processing.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    13829 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/data/split.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     4785 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/data/transformed.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.142230 LibRecommender-1.1.0/libreco/embedding/
--rw-r--r--   0 runner    (1001) docker     (122)        0 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/embedding/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.146230 LibRecommender-1.1.0/libreco/evaluation/
--rwxr-xr-x   0 runner    (1001) docker     (122)       87 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/evaluation/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     1896 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/evaluation/computation.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     5974 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/evaluation/evaluate.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     2259 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/evaluation/metrics.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.146230 LibRecommender-1.1.0/libreco/feature/
--rw-r--r--   0 runner    (1001) docker     (122)        0 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/feature/__init__.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     1979 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/feature/column_mapping.py
--rw-r--r--   0 runner    (1001) docker     (122)     5187 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/feature/multi_sparse.py
--rw-r--r--   0 runner    (1001) docker     (122)     7384 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/feature/sparse.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     2167 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/feature/unique.py
--rw-r--r--   0 runner    (1001) docker     (122)     8111 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/feature/update.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.150230 LibRecommender-1.1.0/libreco/graph/
--rw-r--r--   0 runner    (1001) docker     (122)      511 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/graph/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     4594 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/graph/from_dgl.py
--rw-r--r--   0 runner    (1001) docker     (122)     4371 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/graph/message.py
--rw-r--r--   0 runner    (1001) docker     (122)     6505 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/graph/neighbor_walk.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.150230 LibRecommender-1.1.0/libreco/prediction/
--rw-r--r--   0 runner    (1001) docker     (122)      256 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/prediction/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     4016 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/prediction/predict.py
--rw-r--r--   0 runner    (1001) docker     (122)     5571 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/prediction/preprocess.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.154230 LibRecommender-1.1.0/libreco/recommendation/
--rw-r--r--   0 runner    (1001) docker     (122)      362 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/recommendation/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     1091 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/recommendation/cold_start.py
--rw-r--r--   0 runner    (1001) docker     (122)     4309 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/recommendation/preprocess.py
--rw-r--r--   0 runner    (1001) docker     (122)     2428 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/recommendation/ranking.py
--rw-r--r--   0 runner    (1001) docker     (122)     2261 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/recommendation/recommend.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.154230 LibRecommender-1.1.0/libreco/sampling/
--rw-r--r--   0 runner    (1001) docker     (122)      624 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/sampling/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     3921 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/sampling/negatives.py
--rw-r--r--   0 runner    (1001) docker     (122)     5773 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/sampling/random_walks.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.158230 LibRecommender-1.1.0/libreco/tfops/
--rw-r--r--   0 runner    (1001) docker     (122)      742 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/tfops/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     1676 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/tfops/configs.py
--rw-r--r--   0 runner    (1001) docker     (122)     3525 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/tfops/features.py
--rw-r--r--   0 runner    (1001) docker     (122)     5644 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/tfops/layers.py
--rw-r--r--   0 runner    (1001) docker     (122)     1603 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/tfops/loss.py
--rw-r--r--   0 runner    (1001) docker     (122)     5114 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/tfops/rebuild.py
--rw-r--r--   0 runner    (1001) docker     (122)     2713 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/tfops/variables.py
--rw-r--r--   0 runner    (1001) docker     (122)       99 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/tfops/version.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.162230 LibRecommender-1.1.0/libreco/torchops/
--rw-r--r--   0 runner    (1001) docker     (122)      533 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/torchops/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)      693 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/torchops/configs.py
--rw-r--r--   0 runner    (1001) docker     (122)     3327 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/torchops/loss.py
--rw-r--r--   0 runner    (1001) docker     (122)     5559 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/torchops/rebuild.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.166230 LibRecommender-1.1.0/libreco/training/
--rw-r--r--   0 runner    (1001) docker     (122)        0 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/training/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     1467 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/training/dispatch.py
--rw-r--r--   0 runner    (1001) docker     (122)    10043 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/training/tf_trainer.py
--rw-r--r--   0 runner    (1001) docker     (122)     9466 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/training/torch_trainer.py
--rw-r--r--   0 runner    (1001) docker     (122)     1291 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/training/trainer.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.174230 LibRecommender-1.1.0/libreco/utils/
--rwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/utils/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)  1114597 2023-04-06 09:00:36.000000 LibRecommender-1.1.0/libreco/utils/_similarities.cpp
--rwxr-xr-x   0 runner    (1001) docker     (122)    16885 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/utils/_similarities.pyx
--rw-r--r--   0 runner    (1001) docker     (122)     1481 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/utils/constants.py
--rwxr-xr-x   0 runner    (1001) docker     (122)      319 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/utils/exception.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     1456 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/utils/initializers.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     2583 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/utils/misc.py
--rwxr-xr-x   0 runner    (1001) docker     (122)    14284 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/utils/sampling.py
--rw-r--r--   0 runner    (1001) docker     (122)     4024 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/utils/save_load.py
--rwxr-xr-x   0 runner    (1001) docker     (122)     7383 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/utils/similarities.py
--rw-r--r--   0 runner    (1001) docker     (122)     5408 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libreco/utils/validate.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.174230 LibRecommender-1.1.0/libserving/
--rw-r--r--   0 runner    (1001) docker     (122)       22 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)      981 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/request.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.178230 LibRecommender-1.1.0/libserving/sanic_serving/
--rw-r--r--   0 runner    (1001) docker     (122)        0 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/sanic_serving/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     2642 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/sanic_serving/benchmark.py
--rw-r--r--   0 runner    (1001) docker     (122)      728 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/sanic_serving/common.py
--rw-r--r--   0 runner    (1001) docker     (122)     2799 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/sanic_serving/embed_deploy.py
--rw-r--r--   0 runner    (1001) docker     (122)     2876 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/sanic_serving/knn_deploy.py
--rw-r--r--   0 runner    (1001) docker     (122)     7895 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/sanic_serving/tf_deploy.py
-drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-06 09:00:37.182230 LibRecommender-1.1.0/libserving/serialization/
--rw-r--r--   0 runner    (1001) docker     (122)      295 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/serialization/__init__.py
--rw-r--r--   0 runner    (1001) docker     (122)     1298 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/serialization/common.py
--rw-r--r--   0 runner    (1001) docker     (122)     1481 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/serialization/embed.py
--rw-r--r--   0 runner    (1001) docker     (122)     1190 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/serialization/knn.py
--rw-r--r--   0 runner    (1001) docker     (122)     5144 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/serialization/redis.py
--rw-r--r--   0 runner    (1001) docker     (122)     5288 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/libserving/serialization/tfmodel.py
--rw-r--r--   0 runner    (1001) docker     (122)     2874 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (122)      134 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/requirements-serving.txt
--rw-r--r--   0 runner    (1001) docker     (122)      217 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/requirements.txt
--rw-r--r--   0 runner    (1001) docker     (122)      158 2023-04-06 09:00:37.182230 LibRecommender-1.1.0/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (122)     3394 2023-04-06 08:59:10.000000 LibRecommender-1.1.0/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.288191 LibRecommender-1.1.1/
+-rw-r--r--   0 runner    (1001) docker     (122)     1083 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/LICENSE
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.216186 LibRecommender-1.1.1/LibRecommender.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (122)    28180 2023-04-12 08:39:53.000000 LibRecommender-1.1.1/LibRecommender.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (122)     4103 2023-04-12 08:39:53.000000 LibRecommender-1.1.1/LibRecommender.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (122)        1 2023-04-12 08:39:53.000000 LibRecommender-1.1.1/LibRecommender.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (122)       19 2023-04-12 08:39:53.000000 LibRecommender-1.1.1/LibRecommender.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (122)       19 2023-04-12 08:39:53.000000 LibRecommender-1.1.1/LibRecommender.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (122)      252 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (122)    28180 2023-04-12 08:39:53.288191 LibRecommender-1.1.1/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (122)    27012 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/README.md
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.220186 LibRecommender-1.1.1/libreco/
+-rwxr-xr-x   0 runner    (1001) docker     (122)       22 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.240188 LibRecommender-1.1.1/libreco/algorithms/
+-rwxr-xr-x   0 runner    (1001) docker     (122)     1108 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)   948884 2023-04-12 08:39:49.000000 LibRecommender-1.1.1/libreco/algorithms/_als.cpp
+-rwxr-xr-x   0 runner    (1001) docker     (122)     9206 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/_als.pyx
+-rw-r--r--   0 runner    (1001) docker     (122)   908989 2023-04-12 08:39:50.000000 LibRecommender-1.1.1/libreco/algorithms/_bpr.cpp
+-rwxr-xr-x   0 runner    (1001) docker     (122)    13747 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/_bpr.pyx
+-rwxr-xr-x   0 runner    (1001) docker     (122)    11356 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/als.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    11397 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/autoint.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    14010 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/bpr.py
+-rw-r--r--   0 runner    (1001) docker     (122)     8247 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/caser.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    12159 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/deepfm.py
+-rw-r--r--   0 runner    (1001) docker     (122)     3700 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/deepwalk.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    16879 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/din.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    11490 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/fm.py
+-rw-r--r--   0 runner    (1001) docker     (122)     6364 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/graphsage.py
+-rw-r--r--   0 runner    (1001) docker     (122)     7535 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/graphsage_dgl.py
+-rw-r--r--   0 runner    (1001) docker     (122)     2579 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/item2vec.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     6082 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/item_cf.py
+-rw-r--r--   0 runner    (1001) docker     (122)     4725 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/lightgcn.py
+-rw-r--r--   0 runner    (1001) docker     (122)     6148 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/ncf.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5062 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/ngcf.py
+-rw-r--r--   0 runner    (1001) docker     (122)     6749 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/pinsage.py
+-rw-r--r--   0 runner    (1001) docker     (122)     7210 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/pinsage_dgl.py
+-rw-r--r--   0 runner    (1001) docker     (122)     8733 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/rnn4rec.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     5438 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/svd.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     7620 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/svdpp.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.240188 LibRecommender-1.1.1/libreco/algorithms/torch_modules/
+-rw-r--r--   0 runner    (1001) docker     (122)      343 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/torch_modules/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     6726 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/torch_modules/graphsage_module.py
+-rw-r--r--   0 runner    (1001) docker     (122)     3560 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/torch_modules/lightgcn_module.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5240 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/torch_modules/ngcf_module.py
+-rw-r--r--   0 runner    (1001) docker     (122)     7945 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/torch_modules/pinsage_module.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     6799 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/user_cf.py
+-rw-r--r--   0 runner    (1001) docker     (122)     7960 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/wave_net.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    11945 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/wide_deep.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    11077 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/youtube_ranking.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    13564 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/algorithms/youtube_retrieval.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.248188 LibRecommender-1.1.1/libreco/bases/
+-rw-r--r--   0 runner    (1001) docker     (122)      387 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/bases/__init__.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     4731 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/bases/base.py
+-rw-r--r--   0 runner    (1001) docker     (122)    13085 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/bases/cf_base.py
+-rw-r--r--   0 runner    (1001) docker     (122)    19006 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/bases/embed_base.py
+-rw-r--r--   0 runner    (1001) docker     (122)     4865 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/bases/gensim_base.py
+-rw-r--r--   0 runner    (1001) docker     (122)      545 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/bases/meta.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5920 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/bases/sage_base.py
+-rw-r--r--   0 runner    (1001) docker     (122)     2853 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/bases/seq_base.py
+-rw-r--r--   0 runner    (1001) docker     (122)    13317 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/bases/tf_base.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.252188 LibRecommender-1.1.1/libreco/batch/
+-rw-r--r--   0 runner    (1001) docker     (122)      169 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/batch/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     3940 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/batch/batch_data.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5495 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/batch/batch_unit.py
+-rw-r--r--   0 runner    (1001) docker     (122)    17882 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/batch/collators.py
+-rw-r--r--   0 runner    (1001) docker     (122)      153 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/batch/enums.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     3464 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/batch/sequence.py
+-rw-r--r--   0 runner    (1001) docker     (122)     2642 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/batch/tf_feed_dicts.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.256189 LibRecommender-1.1.1/libreco/data/
+-rwxr-xr-x   0 runner    (1001) docker     (122)      599 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     2432 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/data/consumed.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    20843 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/data/data_info.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    26422 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/data/dataset.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     5947 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/data/processing.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    13860 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/data/split.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     4785 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/data/transformed.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.256189 LibRecommender-1.1.1/libreco/embedding/
+-rw-r--r--   0 runner    (1001) docker     (122)        0 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/embedding/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.256189 LibRecommender-1.1.1/libreco/evaluation/
+-rwxr-xr-x   0 runner    (1001) docker     (122)       87 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/evaluation/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     1896 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/evaluation/computation.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     5974 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/evaluation/evaluate.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     2259 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/evaluation/metrics.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.260189 LibRecommender-1.1.1/libreco/feature/
+-rw-r--r--   0 runner    (1001) docker     (122)        0 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/feature/__init__.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     1979 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/feature/column_mapping.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5187 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/feature/multi_sparse.py
+-rw-r--r--   0 runner    (1001) docker     (122)     7384 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/feature/sparse.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     2167 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/feature/unique.py
+-rw-r--r--   0 runner    (1001) docker     (122)     8111 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/feature/update.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.260189 LibRecommender-1.1.1/libreco/graph/
+-rw-r--r--   0 runner    (1001) docker     (122)      511 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/graph/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     4594 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/graph/from_dgl.py
+-rw-r--r--   0 runner    (1001) docker     (122)     4371 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/graph/message.py
+-rw-r--r--   0 runner    (1001) docker     (122)     6505 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/graph/neighbor_walk.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.264189 LibRecommender-1.1.1/libreco/prediction/
+-rw-r--r--   0 runner    (1001) docker     (122)      256 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/prediction/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     4016 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/prediction/predict.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5571 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/prediction/preprocess.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.264189 LibRecommender-1.1.1/libreco/recommendation/
+-rw-r--r--   0 runner    (1001) docker     (122)      362 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/recommendation/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     1091 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/recommendation/cold_start.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5332 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/recommendation/preprocess.py
+-rw-r--r--   0 runner    (1001) docker     (122)     2428 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/recommendation/ranking.py
+-rw-r--r--   0 runner    (1001) docker     (122)     2261 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/recommendation/recommend.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.268190 LibRecommender-1.1.1/libreco/sampling/
+-rw-r--r--   0 runner    (1001) docker     (122)      624 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/sampling/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     3921 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/sampling/negatives.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5773 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/sampling/random_walks.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.268190 LibRecommender-1.1.1/libreco/tfops/
+-rw-r--r--   0 runner    (1001) docker     (122)      809 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/tfops/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     1676 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/tfops/configs.py
+-rw-r--r--   0 runner    (1001) docker     (122)     4587 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/tfops/features.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5644 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/tfops/layers.py
+-rw-r--r--   0 runner    (1001) docker     (122)     1603 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/tfops/loss.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5114 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/tfops/rebuild.py
+-rw-r--r--   0 runner    (1001) docker     (122)     2713 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/tfops/variables.py
+-rw-r--r--   0 runner    (1001) docker     (122)       99 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/tfops/version.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.272190 LibRecommender-1.1.1/libreco/torchops/
+-rw-r--r--   0 runner    (1001) docker     (122)      533 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/torchops/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)      693 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/torchops/configs.py
+-rw-r--r--   0 runner    (1001) docker     (122)     3327 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/torchops/loss.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5559 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/torchops/rebuild.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.276190 LibRecommender-1.1.1/libreco/training/
+-rw-r--r--   0 runner    (1001) docker     (122)        0 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/training/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     1467 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/training/dispatch.py
+-rw-r--r--   0 runner    (1001) docker     (122)    10033 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/training/tf_trainer.py
+-rw-r--r--   0 runner    (1001) docker     (122)     9466 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/training/torch_trainer.py
+-rw-r--r--   0 runner    (1001) docker     (122)     1291 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/training/trainer.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.280191 LibRecommender-1.1.1/libreco/utils/
+-rwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/utils/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)  1113288 2023-04-12 08:39:52.000000 LibRecommender-1.1.1/libreco/utils/_similarities.cpp
+-rwxr-xr-x   0 runner    (1001) docker     (122)    16758 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/utils/_similarities.pyx
+-rw-r--r--   0 runner    (1001) docker     (122)     1505 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/utils/constants.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)      319 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/utils/exception.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     1634 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/utils/initializers.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     2588 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/utils/misc.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)    14284 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/utils/sampling.py
+-rw-r--r--   0 runner    (1001) docker     (122)     4024 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/utils/save_load.py
+-rwxr-xr-x   0 runner    (1001) docker     (122)     7383 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/utils/similarities.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5408 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libreco/utils/validate.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.280191 LibRecommender-1.1.1/libserving/
+-rw-r--r--   0 runner    (1001) docker     (122)       22 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)      981 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/request.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.284191 LibRecommender-1.1.1/libserving/sanic_serving/
+-rw-r--r--   0 runner    (1001) docker     (122)        0 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/sanic_serving/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     2642 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/sanic_serving/benchmark.py
+-rw-r--r--   0 runner    (1001) docker     (122)      728 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/sanic_serving/common.py
+-rw-r--r--   0 runner    (1001) docker     (122)     2799 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/sanic_serving/embed_deploy.py
+-rw-r--r--   0 runner    (1001) docker     (122)     2876 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/sanic_serving/knn_deploy.py
+-rw-r--r--   0 runner    (1001) docker     (122)     7895 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/sanic_serving/tf_deploy.py
+drwxr-xr-x   0 runner    (1001) docker     (122)        0 2023-04-12 08:39:53.288191 LibRecommender-1.1.1/libserving/serialization/
+-rw-r--r--   0 runner    (1001) docker     (122)      295 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/serialization/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (122)     1298 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/serialization/common.py
+-rw-r--r--   0 runner    (1001) docker     (122)     1481 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/serialization/embed.py
+-rw-r--r--   0 runner    (1001) docker     (122)     1190 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/serialization/knn.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5144 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/serialization/redis.py
+-rw-r--r--   0 runner    (1001) docker     (122)     5288 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/libserving/serialization/tfmodel.py
+-rw-r--r--   0 runner    (1001) docker     (122)     2949 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (122)      134 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/requirements-serving.txt
+-rw-r--r--   0 runner    (1001) docker     (122)      217 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/requirements.txt
+-rw-r--r--   0 runner    (1001) docker     (122)      158 2023-04-12 08:39:53.288191 LibRecommender-1.1.1/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (122)     3394 2023-04-12 08:38:05.000000 LibRecommender-1.1.1/setup.py
```

### Comparing `LibRecommender-1.1.0/LICENSE` & `LibRecommender-1.1.1/LICENSE`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/LibRecommender.egg-info/PKG-INFO` & `LibRecommender-1.1.1/LibRecommender.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: LibRecommender
-Version: 1.1.0
+Version: 1.1.1
 Summary: Versatile end-to-end recommender system.
 Home-page: https://github.com/massquantity/LibRecommender
 Author: massquantity
 Author-email: massquantity <jinxin_madie@163.com>
 License: MIT
 Project-URL: documentation, https://librecommender.readthedocs.io/en/latest/
 Project-URL: repository, https://github.com/massquantity/LibRecommender
@@ -15,14 +15,15 @@
 Classifier: Intended Audience :: Science/Research
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Programming Language :: Python :: 3.6
 Classifier: Programming Language :: Python :: 3.7
 Classifier: Programming Language :: Python :: 3.8
 Classifier: Programming Language :: Python :: 3.9
 Classifier: Programming Language :: Python :: 3.10
+Classifier: Programming Language :: Python :: 3.11
 Classifier: Programming Language :: Cython
 Classifier: Programming Language :: Rust
 Requires-Python: >=3.6
 Description-Content-Type: text/markdown
 License-File: LICENSE
 
 # LibRecommender
```

### Comparing `LibRecommender-1.1.0/LibRecommender.egg-info/SOURCES.txt` & `LibRecommender-1.1.1/LibRecommender.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/PKG-INFO` & `LibRecommender-1.1.1/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: LibRecommender
-Version: 1.1.0
+Version: 1.1.1
 Summary: Versatile end-to-end recommender system.
 Home-page: https://github.com/massquantity/LibRecommender
 Author: massquantity
 Author-email: massquantity <jinxin_madie@163.com>
 License: MIT
 Project-URL: documentation, https://librecommender.readthedocs.io/en/latest/
 Project-URL: repository, https://github.com/massquantity/LibRecommender
@@ -15,14 +15,15 @@
 Classifier: Intended Audience :: Science/Research
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Programming Language :: Python :: 3.6
 Classifier: Programming Language :: Python :: 3.7
 Classifier: Programming Language :: Python :: 3.8
 Classifier: Programming Language :: Python :: 3.9
 Classifier: Programming Language :: Python :: 3.10
+Classifier: Programming Language :: Python :: 3.11
 Classifier: Programming Language :: Cython
 Classifier: Programming Language :: Rust
 Requires-Python: >=3.6
 Description-Content-Type: text/markdown
 License-File: LICENSE
 
 # LibRecommender
```

### Comparing `LibRecommender-1.1.0/README.md` & `LibRecommender-1.1.1/README.md`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/__init__.py` & `LibRecommender-1.1.1/libreco/algorithms/__init__.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/_als.cpp` & `LibRecommender-1.1.1/libreco/algorithms/_als.cpp`

 * *Files 0% similar despite different names*

```diff
@@ -13,15 +13,15 @@
             "-std=c++11"
         ],
         "extra_link_args": [
             "-fopenmp",
             "-std=c++11"
         ],
         "include_dirs": [
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include"
+            "/tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/core/include"
         ],
         "language": "c++",
         "name": "libreco.algorithms._als",
         "sources": [
             "libreco/algorithms/_als.pyx"
         ]
     },
@@ -36,15 +36,15 @@
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
 #define CYTHON_ABI "0_29_34"
 #define CYTHON_HEX_VERSION 0x001D22F0
-#define CYTHON_FUTURE_DIVISION 0
+#define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
     #define __stdcall
@@ -1482,21 +1482,14 @@
 
 /* BytesEquals.proto */
 static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);
 
 /* UnicodeEquals.proto */
 static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);
 
-/* StrEquals.proto */
-#if PY_MAJOR_VERSION >= 3
-#define __Pyx_PyString_Equals __Pyx_PyUnicode_Equals
-#else
-#define __Pyx_PyString_Equals __Pyx_PyBytes_Equals
-#endif
-
 /* MemviewSliceInit.proto */
 #define __Pyx_BUF_MAX_NDIMS %(BUF_MAX_NDIMS)d
 #define __Pyx_MEMVIEW_DIRECT   1
 #define __Pyx_MEMVIEW_PTR      2
 #define __Pyx_MEMVIEW_FULL     4
 #define __Pyx_MEMVIEW_CONTIG   8
 #define __Pyx_MEMVIEW_STRIDED  16
@@ -1716,14 +1709,21 @@
 
 /* ArgTypeTest.proto */
 #define __Pyx_ArgTypeTest(obj, type, none_allowed, name, exact)\
     ((likely((Py_TYPE(obj) == type) | (none_allowed && (obj == Py_None)))) ? 1 :\
         __Pyx__ArgTypeTest(obj, type, name, exact))
 static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact);
 
+/* StrEquals.proto */
+#if PY_MAJOR_VERSION >= 3
+#define __Pyx_PyString_Equals __Pyx_PyUnicode_Equals
+#else
+#define __Pyx_PyString_Equals __Pyx_PyBytes_Equals
+#endif
+
 /* DivInt[Py_ssize_t].proto */
 static CYTHON_INLINE Py_ssize_t __Pyx_div_Py_ssize_t(Py_ssize_t, Py_ssize_t);
 
 /* UnaryNegOverflows.proto */
 #define UNARY_NEG_WOULD_OVERFLOW(x)\
         (((x) < 0) & ((unsigned long)(x) == 0-(unsigned long)(x)))
 
@@ -2433,16 +2433,16 @@
 static PyObject *__pyx_n_s_pyx_getbuffer;
 static PyObject *__pyx_n_s_pyx_result;
 static PyObject *__pyx_n_s_pyx_state;
 static PyObject *__pyx_n_s_pyx_type;
 static PyObject *__pyx_n_s_pyx_unpickle_Enum;
 static PyObject *__pyx_n_s_pyx_vtable;
 static PyObject *__pyx_n_s_range;
-static PyObject *__pyx_n_s_ranking;
-static PyObject *__pyx_n_s_rating;
+static PyObject *__pyx_n_u_ranking;
+static PyObject *__pyx_n_u_rating;
 static PyObject *__pyx_n_s_reduce;
 static PyObject *__pyx_n_s_reduce_cython;
 static PyObject *__pyx_n_s_reduce_ex;
 static PyObject *__pyx_n_s_reg;
 static PyObject *__pyx_n_s_setstate;
 static PyObject *__pyx_n_s_setstate_cython;
 static PyObject *__pyx_n_s_shape;
@@ -2545,174 +2545,174 @@
 static PyObject *__pyx_tuple__25;
 static PyObject *__pyx_tuple__26;
 static PyObject *__pyx_tuple__27;
 static PyObject *__pyx_codeobj__21;
 static PyObject *__pyx_codeobj__28;
 /* Late includes */
 
-/* "libreco/algorithms/_als.pyx":11
+/* "libreco/algorithms/_als.pyx":12
  * 
  * 
- * cdef inline void axpy(int *n, float *da, float *dx, int *incx, float *dy,             # <<<<<<<<<<<<<<
- *                       int *incy) nogil:
- *     cython_blas.saxpy(n, da, dx, incx, dy, incy)
+ * cdef inline void axpy(             # <<<<<<<<<<<<<<
+ *     int *n, float *da, float *dx, int *incx, float *dy, int *incy
+ * ) nogil:
  */
 
 static CYTHON_INLINE void __pyx_f_7libreco_10algorithms_4_als_axpy(int *__pyx_v_n, float *__pyx_v_da, float *__pyx_v_dx, int *__pyx_v_incx, float *__pyx_v_dy, int *__pyx_v_incy) {
 
-  /* "libreco/algorithms/_als.pyx":13
- * cdef inline void axpy(int *n, float *da, float *dx, int *incx, float *dy,
- *                       int *incy) nogil:
+  /* "libreco/algorithms/_als.pyx":15
+ *     int *n, float *da, float *dx, int *incx, float *dy, int *incy
+ * ) nogil:
  *     cython_blas.saxpy(n, da, dx, incx, dy, incy)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_f_5scipy_6linalg_11cython_blas_saxpy(__pyx_v_n, __pyx_v_da, __pyx_v_dx, __pyx_v_incx, __pyx_v_dy, __pyx_v_incy);
 
-  /* "libreco/algorithms/_als.pyx":11
+  /* "libreco/algorithms/_als.pyx":12
  * 
  * 
- * cdef inline void axpy(int *n, float *da, float *dx, int *incx, float *dy,             # <<<<<<<<<<<<<<
- *                       int *incy) nogil:
- *     cython_blas.saxpy(n, da, dx, incx, dy, incy)
+ * cdef inline void axpy(             # <<<<<<<<<<<<<<
+ *     int *n, float *da, float *dx, int *incx, float *dy, int *incy
+ * ) nogil:
  */
 
   /* function exit code */
 }
 
-/* "libreco/algorithms/_als.pyx":16
+/* "libreco/algorithms/_als.pyx":18
  * 
  * 
- * cdef inline void posv(char *u, int *n, int *nrhs, float *a, int *lda,             # <<<<<<<<<<<<<<
- *                       float *b, int *ldb, int *info) nogil:
- *     cython_lapack.sposv(u, n, nrhs, a, lda, b, ldb, info)
+ * cdef inline void posv(             # <<<<<<<<<<<<<<
+ *     char *u, int *n, int *nrhs, float *a, int *lda, float *b, int *ldb, int *info
+ * ) nogil:
  */
 
 static CYTHON_INLINE void __pyx_f_7libreco_10algorithms_4_als_posv(char *__pyx_v_u, int *__pyx_v_n, int *__pyx_v_nrhs, float *__pyx_v_a, int *__pyx_v_lda, float *__pyx_v_b, int *__pyx_v_ldb, int *__pyx_v_info) {
 
-  /* "libreco/algorithms/_als.pyx":18
- * cdef inline void posv(char *u, int *n, int *nrhs, float *a, int *lda,
- *                       float *b, int *ldb, int *info) nogil:
+  /* "libreco/algorithms/_als.pyx":21
+ *     char *u, int *n, int *nrhs, float *a, int *lda, float *b, int *ldb, int *info
+ * ) nogil:
  *     cython_lapack.sposv(u, n, nrhs, a, lda, b, ldb, info)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_f_5scipy_6linalg_13cython_lapack_sposv(__pyx_v_u, __pyx_v_n, __pyx_v_nrhs, __pyx_v_a, __pyx_v_lda, __pyx_v_b, __pyx_v_ldb, __pyx_v_info);
 
-  /* "libreco/algorithms/_als.pyx":16
+  /* "libreco/algorithms/_als.pyx":18
  * 
  * 
- * cdef inline void posv(char *u, int *n, int *nrhs, float *a, int *lda,             # <<<<<<<<<<<<<<
- *                       float *b, int *ldb, int *info) nogil:
- *     cython_lapack.sposv(u, n, nrhs, a, lda, b, ldb, info)
+ * cdef inline void posv(             # <<<<<<<<<<<<<<
+ *     char *u, int *n, int *nrhs, float *a, int *lda, float *b, int *ldb, int *info
+ * ) nogil:
  */
 
   /* function exit code */
 }
 
-/* "libreco/algorithms/_als.pyx":21
+/* "libreco/algorithms/_als.pyx":24
  * 
  * 
- * cdef inline void symv(char *u, int *n, float *alpha, float *a, int *lda,             # <<<<<<<<<<<<<<
- *                       float *x, int *incx, float *beta, float *y,
- *                       int *incy) nogil:
+ * cdef inline void symv(             # <<<<<<<<<<<<<<
+ *     char *u,
+ *     int *n,
  */
 
 static CYTHON_INLINE void __pyx_f_7libreco_10algorithms_4_als_symv(char *__pyx_v_u, int *__pyx_v_n, float *__pyx_v_alpha, float *__pyx_v_a, int *__pyx_v_lda, float *__pyx_v_x, int *__pyx_v_incx, float *__pyx_v_beta, float *__pyx_v_y, int *__pyx_v_incy) {
 
-  /* "libreco/algorithms/_als.pyx":24
- *                       float *x, int *incx, float *beta, float *y,
- *                       int *incy) nogil:
+  /* "libreco/algorithms/_als.pyx":36
+ *     int *incy,
+ * ) nogil:
  *     cython_blas.ssymv(u, n, alpha, a, lda, x, incx, beta, y, incy)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_f_5scipy_6linalg_11cython_blas_ssymv(__pyx_v_u, __pyx_v_n, __pyx_v_alpha, __pyx_v_a, __pyx_v_lda, __pyx_v_x, __pyx_v_incx, __pyx_v_beta, __pyx_v_y, __pyx_v_incy);
 
-  /* "libreco/algorithms/_als.pyx":21
+  /* "libreco/algorithms/_als.pyx":24
  * 
  * 
- * cdef inline void symv(char *u, int *n, float *alpha, float *a, int *lda,             # <<<<<<<<<<<<<<
- *                       float *x, int *incx, float *beta, float *y,
- *                       int *incy) nogil:
+ * cdef inline void symv(             # <<<<<<<<<<<<<<
+ *     char *u,
+ *     int *n,
  */
 
   /* function exit code */
 }
 
-/* "libreco/algorithms/_als.pyx":27
+/* "libreco/algorithms/_als.pyx":39
  * 
  * 
- * cdef inline float dot(int *n, float *sx, int *incx, float *sy,             # <<<<<<<<<<<<<<
- *                       int *incy) nogil:
+ * cdef inline float dot(int *n, float *sx, int *incx, float *sy, int *incy) nogil:             # <<<<<<<<<<<<<<
  *     return cython_blas.sdot(n, sx, incx, sy, incy)
+ * 
  */
 
 static CYTHON_INLINE float __pyx_f_7libreco_10algorithms_4_als_dot(int *__pyx_v_n, float *__pyx_v_sx, int *__pyx_v_incx, float *__pyx_v_sy, int *__pyx_v_incy) {
   float __pyx_r;
 
-  /* "libreco/algorithms/_als.pyx":29
- * cdef inline float dot(int *n, float *sx, int *incx, float *sy,
- *                       int *incy) nogil:
+  /* "libreco/algorithms/_als.pyx":40
+ * 
+ * cdef inline float dot(int *n, float *sx, int *incx, float *sy, int *incy) nogil:
  *     return cython_blas.sdot(n, sx, incx, sy, incy)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_f_5scipy_6linalg_11cython_blas_sdot(__pyx_v_n, __pyx_v_sx, __pyx_v_incx, __pyx_v_sy, __pyx_v_incy);
   goto __pyx_L0;
 
-  /* "libreco/algorithms/_als.pyx":27
+  /* "libreco/algorithms/_als.pyx":39
  * 
  * 
- * cdef inline float dot(int *n, float *sx, int *incx, float *sy,             # <<<<<<<<<<<<<<
- *                       int *incy) nogil:
+ * cdef inline float dot(int *n, float *sx, int *incx, float *sy, int *incy) nogil:             # <<<<<<<<<<<<<<
  *     return cython_blas.sdot(n, sx, incx, sy, incy)
+ * 
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "libreco/algorithms/_als.pyx":32
+/* "libreco/algorithms/_als.pyx":43
  * 
  * 
  * cdef inline void scal(int *n, float *sa, float *sx, int *incx) nogil:             # <<<<<<<<<<<<<<
  *     cython_blas.sscal(n, sa, sx, incx)
  * 
  */
 
 static CYTHON_INLINE void __pyx_f_7libreco_10algorithms_4_als_scal(int *__pyx_v_n, float *__pyx_v_sa, float *__pyx_v_sx, int *__pyx_v_incx) {
 
-  /* "libreco/algorithms/_als.pyx":33
+  /* "libreco/algorithms/_als.pyx":44
  * 
  * cdef inline void scal(int *n, float *sa, float *sx, int *incx) nogil:
  *     cython_blas.sscal(n, sa, sx, incx)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_f_5scipy_6linalg_11cython_blas_sscal(__pyx_v_n, __pyx_v_sa, __pyx_v_sx, __pyx_v_incx);
 
-  /* "libreco/algorithms/_als.pyx":32
+  /* "libreco/algorithms/_als.pyx":43
  * 
  * 
  * cdef inline void scal(int *n, float *sa, float *sx, int *incx) nogil:             # <<<<<<<<<<<<<<
  *     cython_blas.sscal(n, sa, sx, incx)
  * 
  */
 
   /* function exit code */
 }
 
-/* "libreco/algorithms/_als.pyx":36
+/* "libreco/algorithms/_als.pyx":47
  * 
  * 
- * def als_update(interaction, X, Y, reg, task, use_cg=True,             # <<<<<<<<<<<<<<
- *                num_threads=1, cg_steps=3):
+ * def als_update(interaction, X, Y, reg, task, use_cg=True, num_threads=1, cg_steps=3):             # <<<<<<<<<<<<<<
  *     if task == "rating" and use_cg:
+ *         _least_squares_cg(
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_7libreco_10algorithms_4_als_1als_update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static PyMethodDef __pyx_mdef_7libreco_10algorithms_4_als_1als_update = {"als_update", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_7libreco_10algorithms_4_als_1als_update, METH_VARARGS|METH_KEYWORDS, 0};
 static PyObject *__pyx_pw_7libreco_10algorithms_4_als_1als_update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_interaction = 0;
@@ -2763,33 +2763,33 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_interaction)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("als_update", 0, 5, 8, 1); __PYX_ERR(0, 36, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("als_update", 0, 5, 8, 1); __PYX_ERR(0, 47, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_Y)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("als_update", 0, 5, 8, 2); __PYX_ERR(0, 36, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("als_update", 0, 5, 8, 2); __PYX_ERR(0, 47, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_reg)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("als_update", 0, 5, 8, 3); __PYX_ERR(0, 36, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("als_update", 0, 5, 8, 3); __PYX_ERR(0, 47, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_task)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("als_update", 0, 5, 8, 4); __PYX_ERR(0, 36, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("als_update", 0, 5, 8, 4); __PYX_ERR(0, 47, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_use_cg);
           if (value) { values[5] = value; kw_args--; }
         }
@@ -2803,15 +2803,15 @@
         case  7:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cg_steps);
           if (value) { values[7] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "als_update") < 0)) __PYX_ERR(0, 36, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "als_update") < 0)) __PYX_ERR(0, 47, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
         CYTHON_FALLTHROUGH;
         case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
@@ -2833,15 +2833,15 @@
     __pyx_v_task = values[4];
     __pyx_v_use_cg = values[5];
     __pyx_v_num_threads = values[6];
     __pyx_v_cg_steps = values[7];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("als_update", 0, 5, 8, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 36, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("als_update", 0, 5, 8, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 47, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("libreco.algorithms._als.als_update", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_7libreco_10algorithms_4_als_als_update(__pyx_self, __pyx_v_interaction, __pyx_v_X, __pyx_v_Y, __pyx_v_reg, __pyx_v_task, __pyx_v_use_cg, __pyx_v_num_threads, __pyx_v_cg_steps);
 
@@ -2869,72 +2869,120 @@
   __Pyx_memviewslice __pyx_t_14 = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_t_15 = { 0, 0, { 0 }, { 0 }, { 0 } };
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("als_update", 0);
 
-  /* "libreco/algorithms/_als.pyx":38
- * def als_update(interaction, X, Y, reg, task, use_cg=True,
- *                num_threads=1, cg_steps=3):
+  /* "libreco/algorithms/_als.pyx":48
+ * 
+ * def als_update(interaction, X, Y, reg, task, use_cg=True, num_threads=1, cg_steps=3):
  *     if task == "rating" and use_cg:             # <<<<<<<<<<<<<<
- *         _least_squares_cg(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 0, cg_steps)
+ *         _least_squares_cg(
+ *             interaction.indices,
  */
-  __pyx_t_2 = (__Pyx_PyString_Equals(__pyx_v_task, __pyx_n_s_rating, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_task, __pyx_n_u_rating, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 48, __pyx_L1_error)
   if (__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_use_cg); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_use_cg); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 48, __pyx_L1_error)
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "libreco/algorithms/_als.pyx":39
- *                num_threads=1, cg_steps=3):
+    /* "libreco/algorithms/_als.pyx":50
  *     if task == "rating" and use_cg:
- *         _least_squares_cg(interaction.indices, interaction.indptr,             # <<<<<<<<<<<<<<
- *             interaction.data, X, Y, reg, num_threads, 0, cg_steps)
- *     elif task == "rating" and not use_cg:
+ *         _least_squares_cg(
+ *             interaction.indices,             # <<<<<<<<<<<<<<
+ *             interaction.indptr,
+ *             interaction.data,
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 39, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 50, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 39, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 50, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indptr); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 39, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":51
+ *         _least_squares_cg(
+ *             interaction.indices,
+ *             interaction.indptr,             # <<<<<<<<<<<<<<
+ *             interaction.data,
+ *             X,
+ */
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indptr); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 51, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 39, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 51, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "libreco/algorithms/_als.pyx":40
- *     if task == "rating" and use_cg:
- *         _least_squares_cg(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 0, cg_steps)             # <<<<<<<<<<<<<<
- *     elif task == "rating" and not use_cg:
- *         _least_squares(interaction.indices, interaction.indptr,
+    /* "libreco/algorithms/_als.pyx":52
+ *             interaction.indices,
+ *             interaction.indptr,
+ *             interaction.data,             # <<<<<<<<<<<<<<
+ *             X,
+ *             Y,
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_data); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 40, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_data); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 52, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 40, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 52, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_X, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 40, __pyx_L1_error)
-    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_Y, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 40, __pyx_L1_error)
-    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 40, __pyx_L1_error)
-    __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 40, __pyx_L1_error)
-    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_cg_steps); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 40, __pyx_L1_error)
 
-    /* "libreco/algorithms/_als.pyx":39
- *                num_threads=1, cg_steps=3):
- *     if task == "rating" and use_cg:
- *         _least_squares_cg(interaction.indices, interaction.indptr,             # <<<<<<<<<<<<<<
- *             interaction.data, X, Y, reg, num_threads, 0, cg_steps)
+    /* "libreco/algorithms/_als.pyx":53
+ *             interaction.indptr,
+ *             interaction.data,
+ *             X,             # <<<<<<<<<<<<<<
+ *             Y,
+ *             reg,
+ */
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_X, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 53, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":54
+ *             interaction.data,
+ *             X,
+ *             Y,             # <<<<<<<<<<<<<<
+ *             reg,
+ *             num_threads,
+ */
+    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_Y, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 54, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":55
+ *             X,
+ *             Y,
+ *             reg,             # <<<<<<<<<<<<<<
+ *             num_threads,
+ *             0,
+ */
+    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 55, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":56
+ *             Y,
+ *             reg,
+ *             num_threads,             # <<<<<<<<<<<<<<
+ *             0,
+ *             cg_steps,
+ */
+    __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 56, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":58
+ *             num_threads,
+ *             0,
+ *             cg_steps,             # <<<<<<<<<<<<<<
+ *         )
  *     elif task == "rating" and not use_cg:
  */
+    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_cg_steps); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 58, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":49
+ * def als_update(interaction, X, Y, reg, task, use_cg=True, num_threads=1, cg_steps=3):
+ *     if task == "rating" and use_cg:
+ *         _least_squares_cg(             # <<<<<<<<<<<<<<
+ *             interaction.indices,
+ *             interaction.indptr,
+ */
     __pyx_f_7libreco_10algorithms_4_als__least_squares_cg(__pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9, __pyx_t_10, 0, __pyx_t_11);
     __PYX_XDEC_MEMVIEW(&__pyx_t_4, 1);
     __pyx_t_4.memview = NULL;
     __pyx_t_4.data = NULL;
     __PYX_XDEC_MEMVIEW(&__pyx_t_5, 1);
     __pyx_t_5.memview = NULL;
     __pyx_t_5.data = NULL;
@@ -2944,81 +2992,121 @@
     __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
     __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
     __pyx_t_8.memview = NULL;
     __pyx_t_8.data = NULL;
 
-    /* "libreco/algorithms/_als.pyx":38
- * def als_update(interaction, X, Y, reg, task, use_cg=True,
- *                num_threads=1, cg_steps=3):
+    /* "libreco/algorithms/_als.pyx":48
+ * 
+ * def als_update(interaction, X, Y, reg, task, use_cg=True, num_threads=1, cg_steps=3):
  *     if task == "rating" and use_cg:             # <<<<<<<<<<<<<<
- *         _least_squares_cg(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 0, cg_steps)
+ *         _least_squares_cg(
+ *             interaction.indices,
  */
     goto __pyx_L3;
   }
 
-  /* "libreco/algorithms/_als.pyx":41
- *         _least_squares_cg(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 0, cg_steps)
+  /* "libreco/algorithms/_als.pyx":60
+ *             cg_steps,
+ *         )
  *     elif task == "rating" and not use_cg:             # <<<<<<<<<<<<<<
- *         _least_squares(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 0)
+ *         _least_squares(
+ *             interaction.indices,
  */
-  __pyx_t_2 = (__Pyx_PyString_Equals(__pyx_v_task, __pyx_n_s_rating, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_task, __pyx_n_u_rating, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 60, __pyx_L1_error)
   if (__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L6_bool_binop_done;
   }
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_use_cg); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_use_cg); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 60, __pyx_L1_error)
   __pyx_t_12 = ((!__pyx_t_2) != 0);
   __pyx_t_1 = __pyx_t_12;
   __pyx_L6_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "libreco/algorithms/_als.pyx":42
- *             interaction.data, X, Y, reg, num_threads, 0, cg_steps)
+    /* "libreco/algorithms/_als.pyx":62
  *     elif task == "rating" and not use_cg:
- *         _least_squares(interaction.indices, interaction.indptr,             # <<<<<<<<<<<<<<
- *             interaction.data, X, Y, reg, num_threads, 0)
- *     elif task == "ranking" and use_cg:
+ *         _least_squares(
+ *             interaction.indices,             # <<<<<<<<<<<<<<
+ *             interaction.indptr,
+ *             interaction.data,
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 42, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 62, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 42, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 62, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indptr); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 42, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":63
+ *         _least_squares(
+ *             interaction.indices,
+ *             interaction.indptr,             # <<<<<<<<<<<<<<
+ *             interaction.data,
+ *             X,
+ */
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indptr); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 63, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 42, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 63, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "libreco/algorithms/_als.pyx":43
- *     elif task == "rating" and not use_cg:
- *         _least_squares(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 0)             # <<<<<<<<<<<<<<
- *     elif task == "ranking" and use_cg:
- *         _least_squares_cg(interaction.indices, interaction.indptr,
+    /* "libreco/algorithms/_als.pyx":64
+ *             interaction.indices,
+ *             interaction.indptr,
+ *             interaction.data,             # <<<<<<<<<<<<<<
+ *             X,
+ *             Y,
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_data); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 43, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_data); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 64, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 64, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_X, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_Y, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
-    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 43, __pyx_L1_error)
-    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 43, __pyx_L1_error)
 
-    /* "libreco/algorithms/_als.pyx":42
- *             interaction.data, X, Y, reg, num_threads, 0, cg_steps)
+    /* "libreco/algorithms/_als.pyx":65
+ *             interaction.indptr,
+ *             interaction.data,
+ *             X,             # <<<<<<<<<<<<<<
+ *             Y,
+ *             reg,
+ */
+    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_X, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 65, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":66
+ *             interaction.data,
+ *             X,
+ *             Y,             # <<<<<<<<<<<<<<
+ *             reg,
+ *             num_threads,
+ */
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_Y, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 66, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":67
+ *             X,
+ *             Y,
+ *             reg,             # <<<<<<<<<<<<<<
+ *             num_threads,
+ *             0,
+ */
+    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 67, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":68
+ *             Y,
+ *             reg,
+ *             num_threads,             # <<<<<<<<<<<<<<
+ *             0,
+ *         )
+ */
+    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 68, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":61
+ *         )
  *     elif task == "rating" and not use_cg:
- *         _least_squares(interaction.indices, interaction.indptr,             # <<<<<<<<<<<<<<
- *             interaction.data, X, Y, reg, num_threads, 0)
- *     elif task == "ranking" and use_cg:
+ *         _least_squares(             # <<<<<<<<<<<<<<
+ *             interaction.indices,
+ *             interaction.indptr,
  */
     __pyx_f_7libreco_10algorithms_4_als__least_squares(__pyx_t_13, __pyx_t_14, __pyx_t_15, __pyx_t_8, __pyx_t_7, __pyx_t_9, __pyx_t_11, 0);
     __PYX_XDEC_MEMVIEW(&__pyx_t_13, 1);
     __pyx_t_13.memview = NULL;
     __pyx_t_13.data = NULL;
     __PYX_XDEC_MEMVIEW(&__pyx_t_14, 1);
     __pyx_t_14.memview = NULL;
@@ -3029,82 +3117,130 @@
     __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
     __pyx_t_8.memview = NULL;
     __pyx_t_8.data = NULL;
     __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
 
-    /* "libreco/algorithms/_als.pyx":41
- *         _least_squares_cg(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 0, cg_steps)
+    /* "libreco/algorithms/_als.pyx":60
+ *             cg_steps,
+ *         )
  *     elif task == "rating" and not use_cg:             # <<<<<<<<<<<<<<
- *         _least_squares(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 0)
+ *         _least_squares(
+ *             interaction.indices,
  */
     goto __pyx_L3;
   }
 
-  /* "libreco/algorithms/_als.pyx":44
- *         _least_squares(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 0)
+  /* "libreco/algorithms/_als.pyx":71
+ *             0,
+ *         )
  *     elif task == "ranking" and use_cg:             # <<<<<<<<<<<<<<
- *         _least_squares_cg(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 1, cg_steps)
+ *         _least_squares_cg(
+ *             interaction.indices,
  */
-  __pyx_t_12 = (__Pyx_PyString_Equals(__pyx_v_task, __pyx_n_s_ranking, Py_EQ)); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 44, __pyx_L1_error)
+  __pyx_t_12 = (__Pyx_PyUnicode_Equals(__pyx_v_task, __pyx_n_u_ranking, Py_EQ)); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 71, __pyx_L1_error)
   if (__pyx_t_12) {
   } else {
     __pyx_t_1 = __pyx_t_12;
     goto __pyx_L8_bool_binop_done;
   }
-  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_v_use_cg); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 44, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_v_use_cg); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 71, __pyx_L1_error)
   __pyx_t_1 = __pyx_t_12;
   __pyx_L8_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "libreco/algorithms/_als.pyx":45
- *             interaction.data, X, Y, reg, num_threads, 0)
+    /* "libreco/algorithms/_als.pyx":73
  *     elif task == "ranking" and use_cg:
- *         _least_squares_cg(interaction.indices, interaction.indptr,             # <<<<<<<<<<<<<<
- *             interaction.data, X, Y, reg, num_threads, 1, cg_steps)
- *     elif task == "ranking" and not use_cg:
+ *         _least_squares_cg(
+ *             interaction.indices,             # <<<<<<<<<<<<<<
+ *             interaction.indptr,
+ *             interaction.data,
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 45, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 45, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indptr); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 45, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":74
+ *         _least_squares_cg(
+ *             interaction.indices,
+ *             interaction.indptr,             # <<<<<<<<<<<<<<
+ *             interaction.data,
+ *             X,
+ */
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indptr); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 74, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 45, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 74, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "libreco/algorithms/_als.pyx":46
- *     elif task == "ranking" and use_cg:
- *         _least_squares_cg(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 1, cg_steps)             # <<<<<<<<<<<<<<
- *     elif task == "ranking" and not use_cg:
- *         _least_squares(interaction.indices, interaction.indptr,
+    /* "libreco/algorithms/_als.pyx":75
+ *             interaction.indices,
+ *             interaction.indptr,
+ *             interaction.data,             # <<<<<<<<<<<<<<
+ *             X,
+ *             Y,
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_data); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_data); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 75, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 75, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_X, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 46, __pyx_L1_error)
-    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_Y, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 46, __pyx_L1_error)
-    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 46, __pyx_L1_error)
-    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 46, __pyx_L1_error)
-    __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_v_cg_steps); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 46, __pyx_L1_error)
 
-    /* "libreco/algorithms/_als.pyx":45
- *             interaction.data, X, Y, reg, num_threads, 0)
- *     elif task == "ranking" and use_cg:
- *         _least_squares_cg(interaction.indices, interaction.indptr,             # <<<<<<<<<<<<<<
- *             interaction.data, X, Y, reg, num_threads, 1, cg_steps)
+    /* "libreco/algorithms/_als.pyx":76
+ *             interaction.indptr,
+ *             interaction.data,
+ *             X,             # <<<<<<<<<<<<<<
+ *             Y,
+ *             reg,
+ */
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_X, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 76, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":77
+ *             interaction.data,
+ *             X,
+ *             Y,             # <<<<<<<<<<<<<<
+ *             reg,
+ *             num_threads,
+ */
+    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_Y, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 77, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":78
+ *             X,
+ *             Y,
+ *             reg,             # <<<<<<<<<<<<<<
+ *             num_threads,
+ *             1,
+ */
+    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 78, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":79
+ *             Y,
+ *             reg,
+ *             num_threads,             # <<<<<<<<<<<<<<
+ *             1,
+ *             cg_steps,
+ */
+    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 79, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":81
+ *             num_threads,
+ *             1,
+ *             cg_steps,             # <<<<<<<<<<<<<<
+ *         )
  *     elif task == "ranking" and not use_cg:
  */
+    __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_v_cg_steps); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 81, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":72
+ *         )
+ *     elif task == "ranking" and use_cg:
+ *         _least_squares_cg(             # <<<<<<<<<<<<<<
+ *             interaction.indices,
+ *             interaction.indptr,
+ */
     __pyx_f_7libreco_10algorithms_4_als__least_squares_cg(__pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9, __pyx_t_11, 1, __pyx_t_10);
     __PYX_XDEC_MEMVIEW(&__pyx_t_4, 1);
     __pyx_t_4.memview = NULL;
     __pyx_t_4.data = NULL;
     __PYX_XDEC_MEMVIEW(&__pyx_t_5, 1);
     __pyx_t_5.memview = NULL;
     __pyx_t_5.data = NULL;
@@ -3114,81 +3250,121 @@
     __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
     __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
     __pyx_t_8.memview = NULL;
     __pyx_t_8.data = NULL;
 
-    /* "libreco/algorithms/_als.pyx":44
- *         _least_squares(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 0)
+    /* "libreco/algorithms/_als.pyx":71
+ *             0,
+ *         )
  *     elif task == "ranking" and use_cg:             # <<<<<<<<<<<<<<
- *         _least_squares_cg(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 1, cg_steps)
+ *         _least_squares_cg(
+ *             interaction.indices,
  */
     goto __pyx_L3;
   }
 
-  /* "libreco/algorithms/_als.pyx":47
- *         _least_squares_cg(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 1, cg_steps)
+  /* "libreco/algorithms/_als.pyx":83
+ *             cg_steps,
+ *         )
  *     elif task == "ranking" and not use_cg:             # <<<<<<<<<<<<<<
- *         _least_squares(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 1)
+ *         _least_squares(
+ *             interaction.indices,
  */
-  __pyx_t_12 = (__Pyx_PyString_Equals(__pyx_v_task, __pyx_n_s_ranking, Py_EQ)); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_12 = (__Pyx_PyUnicode_Equals(__pyx_v_task, __pyx_n_u_ranking, Py_EQ)); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 83, __pyx_L1_error)
   if (__pyx_t_12) {
   } else {
     __pyx_t_1 = __pyx_t_12;
     goto __pyx_L10_bool_binop_done;
   }
-  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_v_use_cg); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_v_use_cg); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 83, __pyx_L1_error)
   __pyx_t_2 = ((!__pyx_t_12) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L10_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "libreco/algorithms/_als.pyx":48
- *             interaction.data, X, Y, reg, num_threads, 1, cg_steps)
+    /* "libreco/algorithms/_als.pyx":85
  *     elif task == "ranking" and not use_cg:
- *         _least_squares(interaction.indices, interaction.indptr,             # <<<<<<<<<<<<<<
- *             interaction.data, X, Y, reg, num_threads, 1)
- * 
+ *         _least_squares(
+ *             interaction.indices,             # <<<<<<<<<<<<<<
+ *             interaction.indptr,
+ *             interaction.data,
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 48, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 85, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 48, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 85, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indptr); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 48, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":86
+ *         _least_squares(
+ *             interaction.indices,
+ *             interaction.indptr,             # <<<<<<<<<<<<<<
+ *             interaction.data,
+ *             X,
+ */
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_indptr); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 86, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 48, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 86, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "libreco/algorithms/_als.pyx":49
- *     elif task == "ranking" and not use_cg:
- *         _least_squares(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 1)             # <<<<<<<<<<<<<<
- * 
- * 
+    /* "libreco/algorithms/_als.pyx":87
+ *             interaction.indices,
+ *             interaction.indptr,
+ *             interaction.data,             # <<<<<<<<<<<<<<
+ *             X,
+ *             Y,
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_data); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 49, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_interaction, __pyx_n_s_data); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 87, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 49, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(__pyx_t_3, 0); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 87, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_X, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 49, __pyx_L1_error)
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_Y, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 49, __pyx_L1_error)
-    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 49, __pyx_L1_error)
-    __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 49, __pyx_L1_error)
 
-    /* "libreco/algorithms/_als.pyx":48
- *             interaction.data, X, Y, reg, num_threads, 1, cg_steps)
+    /* "libreco/algorithms/_als.pyx":88
+ *             interaction.indptr,
+ *             interaction.data,
+ *             X,             # <<<<<<<<<<<<<<
+ *             Y,
+ *             reg,
+ */
+    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_X, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 88, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":89
+ *             interaction.data,
+ *             X,
+ *             Y,             # <<<<<<<<<<<<<<
+ *             reg,
+ *             num_threads,
+ */
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_Y, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 89, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":90
+ *             X,
+ *             Y,
+ *             reg,             # <<<<<<<<<<<<<<
+ *             num_threads,
+ *             1,
+ */
+    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 90, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":91
+ *             Y,
+ *             reg,
+ *             num_threads,             # <<<<<<<<<<<<<<
+ *             1,
+ *         )
+ */
+    __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L1_error)
+
+    /* "libreco/algorithms/_als.pyx":84
+ *         )
  *     elif task == "ranking" and not use_cg:
- *         _least_squares(interaction.indices, interaction.indptr,             # <<<<<<<<<<<<<<
- *             interaction.data, X, Y, reg, num_threads, 1)
- * 
+ *         _least_squares(             # <<<<<<<<<<<<<<
+ *             interaction.indices,
+ *             interaction.indptr,
  */
     __pyx_f_7libreco_10algorithms_4_als__least_squares(__pyx_t_13, __pyx_t_14, __pyx_t_15, __pyx_t_8, __pyx_t_7, __pyx_t_9, __pyx_t_10, 1);
     __PYX_XDEC_MEMVIEW(&__pyx_t_13, 1);
     __pyx_t_13.memview = NULL;
     __pyx_t_13.data = NULL;
     __PYX_XDEC_MEMVIEW(&__pyx_t_14, 1);
     __pyx_t_14.memview = NULL;
@@ -3199,30 +3375,30 @@
     __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
     __pyx_t_8.memview = NULL;
     __pyx_t_8.data = NULL;
     __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
 
-    /* "libreco/algorithms/_als.pyx":47
- *         _least_squares_cg(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 1, cg_steps)
+    /* "libreco/algorithms/_als.pyx":83
+ *             cg_steps,
+ *         )
  *     elif task == "ranking" and not use_cg:             # <<<<<<<<<<<<<<
- *         _least_squares(interaction.indices, interaction.indptr,
- *             interaction.data, X, Y, reg, num_threads, 1)
+ *         _least_squares(
+ *             interaction.indices,
  */
   }
   __pyx_L3:;
 
-  /* "libreco/algorithms/_als.pyx":36
+  /* "libreco/algorithms/_als.pyx":47
  * 
  * 
- * def als_update(interaction, X, Y, reg, task, use_cg=True,             # <<<<<<<<<<<<<<
- *                num_threads=1, cg_steps=3):
+ * def als_update(interaction, X, Y, reg, task, use_cg=True, num_threads=1, cg_steps=3):             # <<<<<<<<<<<<<<
  *     if task == "rating" and use_cg:
+ *         _least_squares_cg(
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_3);
@@ -3238,20 +3414,20 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "libreco/algorithms/_als.pyx":55
+/* "libreco/algorithms/_als.pyx":99
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef void _least_squares(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *     const float[:] data, float[:, ::1] X, float[:, ::1] Y, double reg,
- *     int num_threads, int implicit):
+ * cdef void _least_squares(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
 static void __pyx_f_7libreco_10algorithms_4_als__least_squares(__Pyx_memviewslice __pyx_v_indices, __Pyx_memviewslice __pyx_v_indptr, __Pyx_memviewslice __pyx_v_data, __Pyx_memviewslice __pyx_v_X, __Pyx_memviewslice __pyx_v_Y, double __pyx_v_reg, int __pyx_v_num_threads, int __pyx_v_implicit) {
   CYTHON_UNUSED int __pyx_v_n_x;
   int __pyx_v_embed_size;
   int __pyx_v_m;
   int __pyx_v_i;
@@ -3301,79 +3477,79 @@
   PyObject *__pyx_t_32 = NULL;
   PyObject *__pyx_t_33 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_least_squares", 0);
 
-  /* "libreco/algorithms/_als.pyx":58
- *     const float[:] data, float[:, ::1] X, float[:, ::1] Y, double reg,
- *     int num_threads, int implicit):
+  /* "libreco/algorithms/_als.pyx":109
+ *     int implicit,
+ * ):
  *     cdef int n_x = X.shape[0], embed_size = X.shape[1]             # <<<<<<<<<<<<<<
  *     cdef int m, i, j, index, err, one = 1
  *     cdef float rating, confidence, temp
  */
   __pyx_v_n_x = (__pyx_v_X.shape[0]);
   __pyx_v_embed_size = (__pyx_v_X.shape[1]);
 
-  /* "libreco/algorithms/_als.pyx":59
- *     int num_threads, int implicit):
+  /* "libreco/algorithms/_als.pyx":110
+ * ):
  *     cdef int n_x = X.shape[0], embed_size = X.shape[1]
  *     cdef int m, i, j, index, err, one = 1             # <<<<<<<<<<<<<<
  *     cdef float rating, confidence, temp
  * 
  */
   __pyx_v_one = 1;
 
-  /* "libreco/algorithms/_als.pyx":63
+  /* "libreco/algorithms/_als.pyx":114
  * 
  *     cdef float[:, ::1] initialA
  *     if implicit > 0:             # <<<<<<<<<<<<<<
  *         initialA = np.dot(np.transpose(Y), Y) + reg * np.eye(embed_size, dtype=np.single)
  *     else:
  */
   __pyx_t_1 = ((__pyx_v_implicit > 0) != 0);
   if (__pyx_t_1) {
 
-    /* "libreco/algorithms/_als.pyx":64
+    /* "libreco/algorithms/_als.pyx":115
  *     cdef float[:, ::1] initialA
  *     if implicit > 0:
  *         initialA = np.dot(np.transpose(Y), Y) + reg * np.eye(embed_size, dtype=np.single)             # <<<<<<<<<<<<<<
  *     else:
  *         initialA = reg * np.eye(embed_size, dtype=np.single)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_dot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_dot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_transpose); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_transpose); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_Y, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_Y, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_7 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
         __Pyx_INCREF(__pyx_t_7);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_6, function);
       }
     }
     __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_7, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_5);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 64, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_Y, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_Y, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_t_5 = NULL;
     __pyx_t_8 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -3382,188 +3558,188 @@
         __Pyx_DECREF_SET(__pyx_t_4, function);
         __pyx_t_8 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_4)) {
       PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_6};
-      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 64, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 115, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
       PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_6};
-      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 64, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 115, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     } else
     #endif
     {
-      __pyx_t_7 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 64, __pyx_L1_error)
+      __pyx_t_7 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 115, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       if (__pyx_t_5) {
         __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
       }
       __Pyx_GIVEREF(__pyx_t_3);
       PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_8, __pyx_t_3);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_8, __pyx_t_6);
       __pyx_t_3 = 0;
       __pyx_t_6 = 0;
-      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 64, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 115, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyFloat_FromDouble(__pyx_v_reg); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_4 = PyFloat_FromDouble(__pyx_v_reg); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_eye); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_eye); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_embed_size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_embed_size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_single); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_single); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 64, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = PyNumber_Multiply(__pyx_t_4, __pyx_t_9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_7 = PyNumber_Multiply(__pyx_t_4, __pyx_t_9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = PyNumber_Add(__pyx_t_2, __pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_9 = PyNumber_Add(__pyx_t_2, __pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 115, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_v_initialA = __pyx_t_10;
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
 
-    /* "libreco/algorithms/_als.pyx":63
+    /* "libreco/algorithms/_als.pyx":114
  * 
  *     cdef float[:, ::1] initialA
  *     if implicit > 0:             # <<<<<<<<<<<<<<
  *         initialA = np.dot(np.transpose(Y), Y) + reg * np.eye(embed_size, dtype=np.single)
  *     else:
  */
     goto __pyx_L3;
   }
 
-  /* "libreco/algorithms/_als.pyx":66
+  /* "libreco/algorithms/_als.pyx":117
  *         initialA = np.dot(np.transpose(Y), Y) + reg * np.eye(embed_size, dtype=np.single)
  *     else:
  *         initialA = reg * np.eye(embed_size, dtype=np.single)             # <<<<<<<<<<<<<<
  *     cdef float[:] initialB = np.zeros(embed_size, dtype=np.single)
  *     cdef float *A
  */
   /*else*/ {
-    __pyx_t_9 = PyFloat_FromDouble(__pyx_v_reg); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_9 = PyFloat_FromDouble(__pyx_v_reg); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_eye); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_eye); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_embed_size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_embed_size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_single); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_single); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 66, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = PyNumber_Multiply(__pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_7 = PyNumber_Multiply(__pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 117, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_v_initialA = __pyx_t_10;
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
   }
   __pyx_L3:;
 
-  /* "libreco/algorithms/_als.pyx":67
+  /* "libreco/algorithms/_als.pyx":118
  *     else:
  *         initialA = reg * np.eye(embed_size, dtype=np.single)
  *     cdef float[:] initialB = np.zeros(embed_size, dtype=np.single)             # <<<<<<<<<<<<<<
  *     cdef float *A
  *     cdef float *b
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_embed_size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_embed_size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_single); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_single); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 67, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_9, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_9, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_initialB = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "libreco/algorithms/_als.pyx":71
+  /* "libreco/algorithms/_als.pyx":122
  *     cdef float *b
  * 
  *     with nogil, parallel(num_threads=num_threads):             # <<<<<<<<<<<<<<
  *         A = <float *> malloc(sizeof(float) * embed_size * embed_size)
  *         b = <float *> malloc(sizeof(float) * embed_size)
  */
   {
@@ -3594,42 +3770,42 @@
                 #endif
                 Py_BEGIN_ALLOW_THREADS
                 #endif /* _OPENMP */
                 /* Initialize private variables to invalid values */
                 __pyx_v_A = ((float *)1);
                 __pyx_v_b = ((float *)1);
 
-                /* "libreco/algorithms/_als.pyx":72
+                /* "libreco/algorithms/_als.pyx":123
  * 
  *     with nogil, parallel(num_threads=num_threads):
  *         A = <float *> malloc(sizeof(float) * embed_size * embed_size)             # <<<<<<<<<<<<<<
  *         b = <float *> malloc(sizeof(float) * embed_size)
  *         try:
  */
                 __pyx_v_A = ((float *)malloc((((sizeof(float)) * __pyx_v_embed_size) * __pyx_v_embed_size)));
 
-                /* "libreco/algorithms/_als.pyx":73
+                /* "libreco/algorithms/_als.pyx":124
  *     with nogil, parallel(num_threads=num_threads):
  *         A = <float *> malloc(sizeof(float) * embed_size * embed_size)
  *         b = <float *> malloc(sizeof(float) * embed_size)             # <<<<<<<<<<<<<<
  *         try:
  *             for m in prange(n_x, schedule="guided"):
  */
                 __pyx_v_b = ((float *)malloc(((sizeof(float)) * __pyx_v_embed_size)));
 
-                /* "libreco/algorithms/_als.pyx":74
+                /* "libreco/algorithms/_als.pyx":125
  *         A = <float *> malloc(sizeof(float) * embed_size * embed_size)
  *         b = <float *> malloc(sizeof(float) * embed_size)
  *         try:             # <<<<<<<<<<<<<<
  *             for m in prange(n_x, schedule="guided"):
  *                 memcpy(A, &initialA[0, 0], sizeof(float) * embed_size * embed_size)
  */
                 /*try:*/ {
 
-                  /* "libreco/algorithms/_als.pyx":75
+                  /* "libreco/algorithms/_als.pyx":126
  *         b = <float *> malloc(sizeof(float) * embed_size)
  *         try:
  *             for m in prange(n_x, schedule="guided"):             # <<<<<<<<<<<<<<
  *                 memcpy(A, &initialA[0, 0], sizeof(float) * embed_size * embed_size)
  *                 memcpy(b, &initialB[0], sizeof(float) * embed_size)
  */
                   __pyx_t_8 = __pyx_v_n_x;
@@ -3662,314 +3838,314 @@
                                   __pyx_v_err = ((int)0xbad0bad0);
                                   __pyx_v_i = ((int)0xbad0bad0);
                                   __pyx_v_index = ((int)0xbad0bad0);
                                   __pyx_v_j = ((int)0xbad0bad0);
                                   __pyx_v_rating = ((float)__PYX_NAN());
                                   __pyx_v_temp = ((float)__PYX_NAN());
 
-                                  /* "libreco/algorithms/_als.pyx":76
+                                  /* "libreco/algorithms/_als.pyx":127
  *         try:
  *             for m in prange(n_x, schedule="guided"):
  *                 memcpy(A, &initialA[0, 0], sizeof(float) * embed_size * embed_size)             # <<<<<<<<<<<<<<
  *                 memcpy(b, &initialB[0], sizeof(float) * embed_size)
  * 
  */
                                   __pyx_t_14 = 0;
                                   __pyx_t_15 = 0;
                                   (void)(memcpy(__pyx_v_A, (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_initialA.data + __pyx_t_14 * __pyx_v_initialA.strides[0]) )) + __pyx_t_15)) )))), (((sizeof(float)) * __pyx_v_embed_size) * __pyx_v_embed_size)));
 
-                                  /* "libreco/algorithms/_als.pyx":77
+                                  /* "libreco/algorithms/_als.pyx":128
  *             for m in prange(n_x, schedule="guided"):
  *                 memcpy(A, &initialA[0, 0], sizeof(float) * embed_size * embed_size)
  *                 memcpy(b, &initialB[0], sizeof(float) * embed_size)             # <<<<<<<<<<<<<<
  * 
  *                 for index in range(indptr[m], indptr[m+1]):
  */
                                   __pyx_t_15 = 0;
                                   (void)(memcpy(__pyx_v_b, (&(*((float *) ( /* dim=0 */ (__pyx_v_initialB.data + __pyx_t_15 * __pyx_v_initialB.strides[0]) )))), ((sizeof(float)) * __pyx_v_embed_size)));
 
-                                  /* "libreco/algorithms/_als.pyx":79
+                                  /* "libreco/algorithms/_als.pyx":130
  *                 memcpy(b, &initialB[0], sizeof(float) * embed_size)
  * 
  *                 for index in range(indptr[m], indptr[m+1]):             # <<<<<<<<<<<<<<
  *                     if implicit > 0:
  *                         i = indices[index]
  */
                                   __pyx_t_15 = (__pyx_v_m + 1);
                                   __pyx_t_16 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_15 * __pyx_v_indptr.strides[0]) )));
                                   __pyx_t_15 = __pyx_v_m;
                                   __pyx_t_17 = __pyx_t_16;
                                   for (__pyx_t_18 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_15 * __pyx_v_indptr.strides[0]) ))); __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
                                     __pyx_v_index = __pyx_t_18;
 
-                                    /* "libreco/algorithms/_als.pyx":80
+                                    /* "libreco/algorithms/_als.pyx":131
  * 
  *                 for index in range(indptr[m], indptr[m+1]):
  *                     if implicit > 0:             # <<<<<<<<<<<<<<
  *                         i = indices[index]
  *                         confidence = data[index]
  */
                                     __pyx_t_1 = ((__pyx_v_implicit > 0) != 0);
                                     if (__pyx_t_1) {
 
-                                      /* "libreco/algorithms/_als.pyx":81
+                                      /* "libreco/algorithms/_als.pyx":132
  *                 for index in range(indptr[m], indptr[m+1]):
  *                     if implicit > 0:
  *                         i = indices[index]             # <<<<<<<<<<<<<<
  *                         confidence = data[index]
  *                         # compute partial A = Yu^T @ Cu @ Yu + lambda * I
  */
                                       __pyx_t_14 = __pyx_v_index;
                                       __pyx_v_i = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_14 * __pyx_v_indices.strides[0]) )));
 
-                                      /* "libreco/algorithms/_als.pyx":82
+                                      /* "libreco/algorithms/_als.pyx":133
  *                     if implicit > 0:
  *                         i = indices[index]
  *                         confidence = data[index]             # <<<<<<<<<<<<<<
  *                         # compute partial A = Yu^T @ Cu @ Yu + lambda * I
  *                         for j in range(embed_size):
  */
                                       __pyx_t_14 = __pyx_v_index;
                                       __pyx_v_confidence = (*((float const  *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_14 * __pyx_v_data.strides[0]) )));
 
-                                      /* "libreco/algorithms/_als.pyx":84
+                                      /* "libreco/algorithms/_als.pyx":135
  *                         confidence = data[index]
  *                         # compute partial A = Yu^T @ Cu @ Yu + lambda * I
  *                         for j in range(embed_size):             # <<<<<<<<<<<<<<
  *                             temp = (confidence - 1) * Y[i, j]
  *                             axpy(&embed_size, &temp, &Y[i, 0], &one,
  */
                                       __pyx_t_19 = __pyx_v_embed_size;
                                       __pyx_t_20 = __pyx_t_19;
                                       for (__pyx_t_21 = 0; __pyx_t_21 < __pyx_t_20; __pyx_t_21+=1) {
                                         __pyx_v_j = __pyx_t_21;
 
-                                        /* "libreco/algorithms/_als.pyx":85
+                                        /* "libreco/algorithms/_als.pyx":136
  *                         # compute partial A = Yu^T @ Cu @ Yu + lambda * I
  *                         for j in range(embed_size):
  *                             temp = (confidence - 1) * Y[i, j]             # <<<<<<<<<<<<<<
  *                             axpy(&embed_size, &temp, &Y[i, 0], &one,
  *                                  A + j * embed_size, &one)
  */
                                         __pyx_t_14 = __pyx_v_i;
                                         __pyx_t_22 = __pyx_v_j;
                                         __pyx_v_temp = ((__pyx_v_confidence - 1.0) * (*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_14 * __pyx_v_Y.strides[0]) )) + __pyx_t_22)) ))));
 
-                                        /* "libreco/algorithms/_als.pyx":86
+                                        /* "libreco/algorithms/_als.pyx":137
  *                         for j in range(embed_size):
  *                             temp = (confidence - 1) * Y[i, j]
  *                             axpy(&embed_size, &temp, &Y[i, 0], &one,             # <<<<<<<<<<<<<<
  *                                  A + j * embed_size, &one)
  * 
  */
                                         __pyx_t_22 = __pyx_v_i;
                                         __pyx_t_14 = 0;
 
-                                        /* "libreco/algorithms/_als.pyx":87
+                                        /* "libreco/algorithms/_als.pyx":138
  *                             temp = (confidence - 1) * Y[i, j]
  *                             axpy(&embed_size, &temp, &Y[i, 0], &one,
  *                                  A + j * embed_size, &one)             # <<<<<<<<<<<<<<
  * 
  *                         # compute partial b = Yu^T @ Ru
  */
                                         __pyx_f_7libreco_10algorithms_4_als_axpy((&__pyx_v_embed_size), (&__pyx_v_temp), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_22 * __pyx_v_Y.strides[0]) )) + __pyx_t_14)) )))), (&__pyx_v_one), (__pyx_v_A + (__pyx_v_j * __pyx_v_embed_size)), (&__pyx_v_one));
                                       }
 
-                                      /* "libreco/algorithms/_als.pyx":90
+                                      /* "libreco/algorithms/_als.pyx":141
  * 
  *                         # compute partial b = Yu^T @ Ru
  *                         axpy(&embed_size, &confidence, &Y[i, 0], &one, b, &one)             # <<<<<<<<<<<<<<
  *                     else:
  *                         i = indices[index]
  */
                                       __pyx_t_14 = __pyx_v_i;
                                       __pyx_t_22 = 0;
                                       __pyx_f_7libreco_10algorithms_4_als_axpy((&__pyx_v_embed_size), (&__pyx_v_confidence), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_14 * __pyx_v_Y.strides[0]) )) + __pyx_t_22)) )))), (&__pyx_v_one), __pyx_v_b, (&__pyx_v_one));
 
-                                      /* "libreco/algorithms/_als.pyx":80
+                                      /* "libreco/algorithms/_als.pyx":131
  * 
  *                 for index in range(indptr[m], indptr[m+1]):
  *                     if implicit > 0:             # <<<<<<<<<<<<<<
  *                         i = indices[index]
  *                         confidence = data[index]
  */
                                       goto __pyx_L22;
                                     }
 
-                                    /* "libreco/algorithms/_als.pyx":92
+                                    /* "libreco/algorithms/_als.pyx":143
  *                         axpy(&embed_size, &confidence, &Y[i, 0], &one, b, &one)
  *                     else:
  *                         i = indices[index]             # <<<<<<<<<<<<<<
  *                         rating = data[index]
  *                         # compute partial A = Yu^T @ Yu + lambda * I
  */
                                     /*else*/ {
                                       __pyx_t_22 = __pyx_v_index;
                                       __pyx_v_i = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_22 * __pyx_v_indices.strides[0]) )));
 
-                                      /* "libreco/algorithms/_als.pyx":93
+                                      /* "libreco/algorithms/_als.pyx":144
  *                     else:
  *                         i = indices[index]
  *                         rating = data[index]             # <<<<<<<<<<<<<<
  *                         # compute partial A = Yu^T @ Yu + lambda * I
  *                         for j in range(embed_size):
  */
                                       __pyx_t_22 = __pyx_v_index;
                                       __pyx_v_rating = (*((float const  *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_22 * __pyx_v_data.strides[0]) )));
 
-                                      /* "libreco/algorithms/_als.pyx":95
+                                      /* "libreco/algorithms/_als.pyx":146
  *                         rating = data[index]
  *                         # compute partial A = Yu^T @ Yu + lambda * I
  *                         for j in range(embed_size):             # <<<<<<<<<<<<<<
  *                             axpy(&embed_size, &Y[i, j], &Y[i, 0], &one, A + j * embed_size, &one)
  * 
  */
                                       __pyx_t_19 = __pyx_v_embed_size;
                                       __pyx_t_20 = __pyx_t_19;
                                       for (__pyx_t_21 = 0; __pyx_t_21 < __pyx_t_20; __pyx_t_21+=1) {
                                         __pyx_v_j = __pyx_t_21;
 
-                                        /* "libreco/algorithms/_als.pyx":96
+                                        /* "libreco/algorithms/_als.pyx":147
  *                         # compute partial A = Yu^T @ Yu + lambda * I
  *                         for j in range(embed_size):
  *                             axpy(&embed_size, &Y[i, j], &Y[i, 0], &one, A + j * embed_size, &one)             # <<<<<<<<<<<<<<
  * 
  *                         # compute partial b = Yu^T @ Ru
  */
                                         __pyx_t_22 = __pyx_v_i;
                                         __pyx_t_14 = __pyx_v_j;
                                         __pyx_t_23 = __pyx_v_i;
                                         __pyx_t_24 = 0;
                                         __pyx_f_7libreco_10algorithms_4_als_axpy((&__pyx_v_embed_size), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_22 * __pyx_v_Y.strides[0]) )) + __pyx_t_14)) )))), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_23 * __pyx_v_Y.strides[0]) )) + __pyx_t_24)) )))), (&__pyx_v_one), (__pyx_v_A + (__pyx_v_j * __pyx_v_embed_size)), (&__pyx_v_one));
                                       }
 
-                                      /* "libreco/algorithms/_als.pyx":99
+                                      /* "libreco/algorithms/_als.pyx":150
  * 
  *                         # compute partial b = Yu^T @ Ru
  *                         axpy(&embed_size, &rating, &Y[i, 0], &one, b, &one)             # <<<<<<<<<<<<<<
  * 
  *                 err = 0
  */
                                       __pyx_t_24 = __pyx_v_i;
                                       __pyx_t_23 = 0;
                                       __pyx_f_7libreco_10algorithms_4_als_axpy((&__pyx_v_embed_size), (&__pyx_v_rating), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_24 * __pyx_v_Y.strides[0]) )) + __pyx_t_23)) )))), (&__pyx_v_one), __pyx_v_b, (&__pyx_v_one));
                                     }
                                     __pyx_L22:;
                                   }
 
-                                  /* "libreco/algorithms/_als.pyx":101
+                                  /* "libreco/algorithms/_als.pyx":152
  *                         axpy(&embed_size, &rating, &Y[i, 0], &one, b, &one)
  * 
  *                 err = 0             # <<<<<<<<<<<<<<
  *                 # solve Ax = b, x = A^-1 * b
  *                 posv("U", &embed_size, &one, A, &embed_size, b, &embed_size, &err)
  */
                                   __pyx_v_err = 0;
 
-                                  /* "libreco/algorithms/_als.pyx":103
+                                  /* "libreco/algorithms/_als.pyx":154
  *                 err = 0
  *                 # solve Ax = b, x = A^-1 * b
  *                 posv("U", &embed_size, &one, A, &embed_size, b, &embed_size, &err)             # <<<<<<<<<<<<<<
  *                 if not err:
  *                     memcpy(&X[m, 0], b, sizeof(float) * embed_size)
  */
                                   __pyx_f_7libreco_10algorithms_4_als_posv(((char *)"U"), (&__pyx_v_embed_size), (&__pyx_v_one), __pyx_v_A, (&__pyx_v_embed_size), __pyx_v_b, (&__pyx_v_embed_size), (&__pyx_v_err));
 
-                                  /* "libreco/algorithms/_als.pyx":104
+                                  /* "libreco/algorithms/_als.pyx":155
  *                 # solve Ax = b, x = A^-1 * b
  *                 posv("U", &embed_size, &one, A, &embed_size, b, &embed_size, &err)
  *                 if not err:             # <<<<<<<<<<<<<<
  *                     memcpy(&X[m, 0], b, sizeof(float) * embed_size)
  *                 else:
  */
                                   __pyx_t_1 = ((!(__pyx_v_err != 0)) != 0);
                                   if (__pyx_t_1) {
 
-                                    /* "libreco/algorithms/_als.pyx":105
+                                    /* "libreco/algorithms/_als.pyx":156
  *                 posv("U", &embed_size, &one, A, &embed_size, b, &embed_size, &err)
  *                 if not err:
  *                     memcpy(&X[m, 0], b, sizeof(float) * embed_size)             # <<<<<<<<<<<<<<
  *                 else:
  *                     with gil:
  */
                                     __pyx_t_15 = __pyx_v_m;
                                     __pyx_t_23 = 0;
                                     (void)(memcpy((&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_X.data + __pyx_t_15 * __pyx_v_X.strides[0]) )) + __pyx_t_23)) )))), __pyx_v_b, ((sizeof(float)) * __pyx_v_embed_size)));
 
-                                    /* "libreco/algorithms/_als.pyx":104
+                                    /* "libreco/algorithms/_als.pyx":155
  *                 # solve Ax = b, x = A^-1 * b
  *                 posv("U", &embed_size, &one, A, &embed_size, b, &embed_size, &err)
  *                 if not err:             # <<<<<<<<<<<<<<
  *                     memcpy(&X[m, 0], b, sizeof(float) * embed_size)
  *                 else:
  */
                                     goto __pyx_L27;
                                   }
 
-                                  /* "libreco/algorithms/_als.pyx":107
+                                  /* "libreco/algorithms/_als.pyx":158
  *                     memcpy(&X[m, 0], b, sizeof(float) * embed_size)
  *                 else:
  *                     with gil:             # <<<<<<<<<<<<<<
  *                         raise ValueError(f"cython_lapack.posv failed (err={err}) on row {m}. "
  *                                           "Try increasing the regularization parameter.")
  */
                                   /*else*/ {
                                     {
                                         #ifdef WITH_THREAD
                                         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
                                         #endif
                                         /*try:*/ {
 
-                                          /* "libreco/algorithms/_als.pyx":108
+                                          /* "libreco/algorithms/_als.pyx":159
  *                 else:
  *                     with gil:
  *                         raise ValueError(f"cython_lapack.posv failed (err={err}) on row {m}. "             # <<<<<<<<<<<<<<
  *                                           "Try increasing the regularization parameter.")
  * 
  */
-                                          __pyx_t_2 = PyTuple_New(5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 108, __pyx_L31_error)
+                                          __pyx_t_2 = PyTuple_New(5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 159, __pyx_L31_error)
                                           __Pyx_GOTREF(__pyx_t_2);
                                           __pyx_t_25 = 0;
                                           __pyx_t_26 = 127;
                                           __Pyx_INCREF(__pyx_kp_u_cython_lapack_posv_failed_err);
                                           __pyx_t_25 += 31;
                                           __Pyx_GIVEREF(__pyx_kp_u_cython_lapack_posv_failed_err);
                                           PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_cython_lapack_posv_failed_err);
-                                          __pyx_t_7 = __Pyx_PyUnicode_From_int(__pyx_v_err, 0, ' ', 'd'); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 108, __pyx_L31_error)
+                                          __pyx_t_7 = __Pyx_PyUnicode_From_int(__pyx_v_err, 0, ' ', 'd'); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 159, __pyx_L31_error)
                                           __Pyx_GOTREF(__pyx_t_7);
                                           __pyx_t_25 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_7);
                                           __Pyx_GIVEREF(__pyx_t_7);
                                           PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_7);
                                           __pyx_t_7 = 0;
                                           __Pyx_INCREF(__pyx_kp_u_on_row);
                                           __pyx_t_25 += 9;
                                           __Pyx_GIVEREF(__pyx_kp_u_on_row);
                                           PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u_on_row);
-                                          __pyx_t_7 = __Pyx_PyUnicode_From_int(__pyx_v_m, 0, ' ', 'd'); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 108, __pyx_L31_error)
+                                          __pyx_t_7 = __Pyx_PyUnicode_From_int(__pyx_v_m, 0, ' ', 'd'); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 159, __pyx_L31_error)
                                           __Pyx_GOTREF(__pyx_t_7);
                                           __pyx_t_25 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_7);
                                           __Pyx_GIVEREF(__pyx_t_7);
                                           PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_t_7);
                                           __pyx_t_7 = 0;
                                           __Pyx_INCREF(__pyx_kp_u_Try_increasing_the_regularizati);
                                           __pyx_t_25 += 46;
                                           __Pyx_GIVEREF(__pyx_kp_u_Try_increasing_the_regularizati);
                                           PyTuple_SET_ITEM(__pyx_t_2, 4, __pyx_kp_u_Try_increasing_the_regularizati);
-                                          __pyx_t_7 = __Pyx_PyUnicode_Join(__pyx_t_2, 5, __pyx_t_25, __pyx_t_26); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 108, __pyx_L31_error)
+                                          __pyx_t_7 = __Pyx_PyUnicode_Join(__pyx_t_2, 5, __pyx_t_25, __pyx_t_26); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 159, __pyx_L31_error)
                                           __Pyx_GOTREF(__pyx_t_7);
                                           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-                                          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 108, __pyx_L31_error)
+                                          __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 159, __pyx_L31_error)
                                           __Pyx_GOTREF(__pyx_t_2);
                                           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
                                           __Pyx_Raise(__pyx_t_2, 0, 0, 0);
                                           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-                                          __PYX_ERR(0, 108, __pyx_L31_error)
+                                          __PYX_ERR(0, 159, __pyx_L31_error)
                                         }
 
-                                        /* "libreco/algorithms/_als.pyx":107
+                                        /* "libreco/algorithms/_als.pyx":158
  *                     memcpy(&X[m, 0], b, sizeof(float) * embed_size)
  *                 else:
  *                     with gil:             # <<<<<<<<<<<<<<
  *                         raise ValueError(f"cython_lapack.posv failed (err={err}) on row {m}. "
  *                                           "Try increasing the regularization parameter.")
  */
                                         /*finally:*/ {
@@ -4052,26 +4228,26 @@
                           }
                           goto __pyx_L14_error;
                         }
                       }
                   }
                 }
 
-                /* "libreco/algorithms/_als.pyx":112
+                /* "libreco/algorithms/_als.pyx":163
  * 
  *         finally:
  *             free(A)             # <<<<<<<<<<<<<<
  *             free(b)
  * 
  */
                 /*finally:*/ {
                   /*normal exit:*/{
                     free(__pyx_v_A);
 
-                    /* "libreco/algorithms/_als.pyx":113
+                    /* "libreco/algorithms/_als.pyx":164
  *         finally:
  *             free(A)
  *             free(b)             # <<<<<<<<<<<<<<
  * 
  * 
  */
                     free(__pyx_v_b);
@@ -4107,24 +4283,24 @@
                     __Pyx_XGOTREF(__pyx_t_33);
                     __pyx_t_13 = __pyx_lineno; __pyx_t_12 = __pyx_clineno; __pyx_t_27 = __pyx_filename;
                     #ifdef WITH_THREAD
                     __Pyx_PyGILState_Release(__pyx_gilstate_save);
                     #endif
                     {
 
-                      /* "libreco/algorithms/_als.pyx":112
+                      /* "libreco/algorithms/_als.pyx":163
  * 
  *         finally:
  *             free(A)             # <<<<<<<<<<<<<<
  *             free(b)
  * 
  */
                       free(__pyx_v_A);
 
-                      /* "libreco/algorithms/_als.pyx":113
+                      /* "libreco/algorithms/_als.pyx":164
  *         finally:
  *             free(A)
  *             free(b)             # <<<<<<<<<<<<<<
  * 
  * 
  */
                       free(__pyx_v_b);
@@ -4230,15 +4406,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "libreco/algorithms/_als.pyx":71
+      /* "libreco/algorithms/_als.pyx":122
  *     cdef float *b
  * 
  *     with nogil, parallel(num_threads=num_threads):             # <<<<<<<<<<<<<<
  *         A = <float *> malloc(sizeof(float) * embed_size * embed_size)
  *         b = <float *> malloc(sizeof(float) * embed_size)
  */
       /*finally:*/ {
@@ -4256,20 +4432,20 @@
           #endif
           goto __pyx_L1_error;
         }
         __pyx_L6:;
       }
   }
 
-  /* "libreco/algorithms/_als.pyx":55
+  /* "libreco/algorithms/_als.pyx":99
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef void _least_squares(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *     const float[:] data, float[:, ::1] X, float[:, ::1] Y, double reg,
- *     int num_threads, int implicit):
+ * cdef void _least_squares(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
@@ -4283,20 +4459,20 @@
   __Pyx_WriteUnraisable("libreco.algorithms._als._least_squares", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __PYX_XDEC_MEMVIEW(&__pyx_v_initialA, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_initialB, 1);
   __Pyx_RefNannyFinishContext();
 }
 
-/* "libreco/algorithms/_als.pyx":119
+/* "libreco/algorithms/_als.pyx":170
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef void _least_squares_cg(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *     const float[:] data, float[:, ::1] X, float[:, ::1] Y, double reg,
- *     int num_threads, int implicit, int cg_steps):
+ * cdef void _least_squares_cg(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
 static void __pyx_f_7libreco_10algorithms_4_als__least_squares_cg(__Pyx_memviewslice __pyx_v_indices, __Pyx_memviewslice __pyx_v_indptr, __Pyx_memviewslice __pyx_v_data, __Pyx_memviewslice __pyx_v_X, __Pyx_memviewslice __pyx_v_Y, double __pyx_v_reg, int __pyx_v_num_threads, int __pyx_v_implicit, int __pyx_v_cg_steps) {
   CYTHON_UNUSED int __pyx_v_n_x;
   int __pyx_v_embed_size;
   int __pyx_v_m;
   int __pyx_v_i;
@@ -4339,88 +4515,88 @@
   int __pyx_t_20;
   int __pyx_t_21;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_least_squares_cg", 0);
 
-  /* "libreco/algorithms/_als.pyx":122
- *     const float[:] data, float[:, ::1] X, float[:, ::1] Y, double reg,
- *     int num_threads, int implicit, int cg_steps):
+  /* "libreco/algorithms/_als.pyx":181
+ *     int cg_steps,
+ * ):
  *     cdef int n_x = X.shape[0], embed_size = X.shape[1]             # <<<<<<<<<<<<<<
  *     cdef int m, i, j, index, err, one = 1
  *     cdef float rating, confidence, temp, rsold, rsnew, ak
  */
   __pyx_v_n_x = (__pyx_v_X.shape[0]);
   __pyx_v_embed_size = (__pyx_v_X.shape[1]);
 
-  /* "libreco/algorithms/_als.pyx":123
- *     int num_threads, int implicit, int cg_steps):
+  /* "libreco/algorithms/_als.pyx":182
+ * ):
  *     cdef int n_x = X.shape[0], embed_size = X.shape[1]
  *     cdef int m, i, j, index, err, one = 1             # <<<<<<<<<<<<<<
  *     cdef float rating, confidence, temp, rsold, rsnew, ak
  *     cdef float zero = 0.0
  */
   __pyx_v_one = 1;
 
-  /* "libreco/algorithms/_als.pyx":125
+  /* "libreco/algorithms/_als.pyx":184
  *     cdef int m, i, j, index, err, one = 1
  *     cdef float rating, confidence, temp, rsold, rsnew, ak
  *     cdef float zero = 0.0             # <<<<<<<<<<<<<<
  * 
  *     cdef float[:, ::1] initialA
  */
   __pyx_v_zero = 0.0;
 
-  /* "libreco/algorithms/_als.pyx":128
+  /* "libreco/algorithms/_als.pyx":187
  * 
  *     cdef float[:, ::1] initialA
  *     if implicit > 0:             # <<<<<<<<<<<<<<
  *         initialA = YtY = np.dot(np.transpose(Y), Y) + reg * np.eye(embed_size, dtype=np.single)
  *     else:
  */
   __pyx_t_1 = ((__pyx_v_implicit > 0) != 0);
   if (__pyx_t_1) {
 
-    /* "libreco/algorithms/_als.pyx":129
+    /* "libreco/algorithms/_als.pyx":188
  *     cdef float[:, ::1] initialA
  *     if implicit > 0:
  *         initialA = YtY = np.dot(np.transpose(Y), Y) + reg * np.eye(embed_size, dtype=np.single)             # <<<<<<<<<<<<<<
  *     else:
  *         initialA = reg * np.eye(embed_size, dtype=np.single)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_dot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_dot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_transpose); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_transpose); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_Y, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_Y, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_7 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
         __Pyx_INCREF(__pyx_t_7);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_6, function);
       }
     }
     __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_7, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_5);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 129, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_Y, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_Y, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_t_5 = NULL;
     __pyx_t_8 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -4429,153 +4605,153 @@
         __Pyx_DECREF_SET(__pyx_t_4, function);
         __pyx_t_8 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_4)) {
       PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_6};
-      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 129, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 188, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
       PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_6};
-      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 129, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 188, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     } else
     #endif
     {
-      __pyx_t_7 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 129, __pyx_L1_error)
+      __pyx_t_7 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 188, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       if (__pyx_t_5) {
         __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
       }
       __Pyx_GIVEREF(__pyx_t_3);
       PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_8, __pyx_t_3);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_8, __pyx_t_6);
       __pyx_t_3 = 0;
       __pyx_t_6 = 0;
-      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 129, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 188, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyFloat_FromDouble(__pyx_v_reg); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_4 = PyFloat_FromDouble(__pyx_v_reg); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_eye); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_eye); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_embed_size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_embed_size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_single); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_single); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 129, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_3, __pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = PyNumber_Multiply(__pyx_t_4, __pyx_t_9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_7 = PyNumber_Multiply(__pyx_t_4, __pyx_t_9); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = PyNumber_Add(__pyx_t_2, __pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_9 = PyNumber_Add(__pyx_t_2, __pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 188, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 129, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 188, __pyx_L1_error)
     __PYX_INC_MEMVIEW(&__pyx_t_10, 0);
     __pyx_v_initialA = __pyx_t_10;
     __Pyx_INCREF(__pyx_t_9);
     __pyx_v_YtY = __pyx_t_9;
     __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-    /* "libreco/algorithms/_als.pyx":128
+    /* "libreco/algorithms/_als.pyx":187
  * 
  *     cdef float[:, ::1] initialA
  *     if implicit > 0:             # <<<<<<<<<<<<<<
  *         initialA = YtY = np.dot(np.transpose(Y), Y) + reg * np.eye(embed_size, dtype=np.single)
  *     else:
  */
     goto __pyx_L3;
   }
 
-  /* "libreco/algorithms/_als.pyx":131
+  /* "libreco/algorithms/_als.pyx":190
  *         initialA = YtY = np.dot(np.transpose(Y), Y) + reg * np.eye(embed_size, dtype=np.single)
  *     else:
  *         initialA = reg * np.eye(embed_size, dtype=np.single)             # <<<<<<<<<<<<<<
  * 
  *     cdef float *x
  */
   /*else*/ {
-    __pyx_t_9 = PyFloat_FromDouble(__pyx_v_reg); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_9 = PyFloat_FromDouble(__pyx_v_reg); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_eye); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_eye); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_embed_size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_embed_size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_single); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_single); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 131, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = PyNumber_Multiply(__pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_7 = PyNumber_Multiply(__pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 131, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 190, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_v_initialA = __pyx_t_10;
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
   }
   __pyx_L3:;
 
-  /* "libreco/algorithms/_als.pyx":138
+  /* "libreco/algorithms/_als.pyx":197
  *     cdef float *Ap
  * 
  *     with nogil, parallel(num_threads=num_threads):             # <<<<<<<<<<<<<<
  *         Ap = <float *> malloc(sizeof(float) * embed_size)
  *         p = <float *> malloc(sizeof(float) * embed_size)
  */
   {
@@ -4597,51 +4773,51 @@
             #endif /* _OPENMP */
             {
                 /* Initialize private variables to invalid values */
                 __pyx_v_Ap = ((float *)1);
                 __pyx_v_p = ((float *)1);
                 __pyx_v_r = ((float *)1);
 
-                /* "libreco/algorithms/_als.pyx":139
+                /* "libreco/algorithms/_als.pyx":198
  * 
  *     with nogil, parallel(num_threads=num_threads):
  *         Ap = <float *> malloc(sizeof(float) * embed_size)             # <<<<<<<<<<<<<<
  *         p = <float *> malloc(sizeof(float) * embed_size)
  *         r = <float *> malloc(sizeof(float) * embed_size)
  */
                 __pyx_v_Ap = ((float *)malloc(((sizeof(float)) * __pyx_v_embed_size)));
 
-                /* "libreco/algorithms/_als.pyx":140
+                /* "libreco/algorithms/_als.pyx":199
  *     with nogil, parallel(num_threads=num_threads):
  *         Ap = <float *> malloc(sizeof(float) * embed_size)
  *         p = <float *> malloc(sizeof(float) * embed_size)             # <<<<<<<<<<<<<<
  *         r = <float *> malloc(sizeof(float) * embed_size)
  *         try:
  */
                 __pyx_v_p = ((float *)malloc(((sizeof(float)) * __pyx_v_embed_size)));
 
-                /* "libreco/algorithms/_als.pyx":141
+                /* "libreco/algorithms/_als.pyx":200
  *         Ap = <float *> malloc(sizeof(float) * embed_size)
  *         p = <float *> malloc(sizeof(float) * embed_size)
  *         r = <float *> malloc(sizeof(float) * embed_size)             # <<<<<<<<<<<<<<
  *         try:
  *             for m in prange(n_x, schedule="guided"):
  */
                 __pyx_v_r = ((float *)malloc(((sizeof(float)) * __pyx_v_embed_size)));
 
-                /* "libreco/algorithms/_als.pyx":142
+                /* "libreco/algorithms/_als.pyx":201
  *         p = <float *> malloc(sizeof(float) * embed_size)
  *         r = <float *> malloc(sizeof(float) * embed_size)
  *         try:             # <<<<<<<<<<<<<<
  *             for m in prange(n_x, schedule="guided"):
  *                 x = &X[m, 0]
  */
                 /*try:*/ {
 
-                  /* "libreco/algorithms/_als.pyx":143
+                  /* "libreco/algorithms/_als.pyx":202
  *         r = <float *> malloc(sizeof(float) * embed_size)
  *         try:
  *             for m in prange(n_x, schedule="guided"):             # <<<<<<<<<<<<<<
  *                 x = &X[m, 0]
  * 
  */
                   __pyx_t_8 = __pyx_v_n_x;
@@ -4664,467 +4840,467 @@
                                   __pyx_v_j = ((int)0xbad0bad0);
                                   __pyx_v_rating = ((float)__PYX_NAN());
                                   __pyx_v_rsnew = ((float)__PYX_NAN());
                                   __pyx_v_rsold = ((float)__PYX_NAN());
                                   __pyx_v_temp = ((float)__PYX_NAN());
                                   __pyx_v_x = ((float *)1);
 
-                                  /* "libreco/algorithms/_als.pyx":144
+                                  /* "libreco/algorithms/_als.pyx":203
  *         try:
  *             for m in prange(n_x, schedule="guided"):
  *                 x = &X[m, 0]             # <<<<<<<<<<<<<<
  * 
  *                 temp = -1.0
  */
                                   __pyx_t_13 = __pyx_v_m;
                                   __pyx_t_14 = 0;
                                   __pyx_v_x = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_X.data + __pyx_t_13 * __pyx_v_X.strides[0]) )) + __pyx_t_14)) ))));
 
-                                  /* "libreco/algorithms/_als.pyx":146
+                                  /* "libreco/algorithms/_als.pyx":205
  *                 x = &X[m, 0]
  * 
  *                 temp = -1.0             # <<<<<<<<<<<<<<
  *                 # compute residual r = b - Ax
  *                 # first step: r = -(YtY + lambdaI)^T @ x  or  -(lambdaI @ x)
  */
                                   __pyx_v_temp = -1.0;
 
-                                  /* "libreco/algorithms/_als.pyx":149
+                                  /* "libreco/algorithms/_als.pyx":208
  *                 # compute residual r = b - Ax
  *                 # first step: r = -(YtY + lambdaI)^T @ x  or  -(lambdaI @ x)
  *                 symv("U", &embed_size, &temp, &initialA[0, 0], &embed_size, x, &one, &zero, r, &one)             # <<<<<<<<<<<<<<
  *                 for index in range(indptr[m], indptr[m+1]):
  *                     if implicit > 0:
  */
                                   __pyx_t_14 = 0;
                                   __pyx_t_13 = 0;
                                   __pyx_f_7libreco_10algorithms_4_als_symv(((char *)"U"), (&__pyx_v_embed_size), (&__pyx_v_temp), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_initialA.data + __pyx_t_14 * __pyx_v_initialA.strides[0]) )) + __pyx_t_13)) )))), (&__pyx_v_embed_size), __pyx_v_x, (&__pyx_v_one), (&__pyx_v_zero), __pyx_v_r, (&__pyx_v_one));
 
-                                  /* "libreco/algorithms/_als.pyx":150
+                                  /* "libreco/algorithms/_als.pyx":209
  *                 # first step: r = -(YtY + lambdaI)^T @ x  or  -(lambdaI @ x)
  *                 symv("U", &embed_size, &temp, &initialA[0, 0], &embed_size, x, &one, &zero, r, &one)
  *                 for index in range(indptr[m], indptr[m+1]):             # <<<<<<<<<<<<<<
  *                     if implicit > 0:
  *                         i = indices[index]
  */
                                   __pyx_t_13 = (__pyx_v_m + 1);
                                   __pyx_t_15 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_13 * __pyx_v_indptr.strides[0]) )));
                                   __pyx_t_13 = __pyx_v_m;
                                   __pyx_t_16 = __pyx_t_15;
                                   for (__pyx_t_17 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_13 * __pyx_v_indptr.strides[0]) ))); __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
                                     __pyx_v_index = __pyx_t_17;
 
-                                    /* "libreco/algorithms/_als.pyx":151
+                                    /* "libreco/algorithms/_als.pyx":210
  *                 symv("U", &embed_size, &temp, &initialA[0, 0], &embed_size, x, &one, &zero, r, &one)
  *                 for index in range(indptr[m], indptr[m+1]):
  *                     if implicit > 0:             # <<<<<<<<<<<<<<
  *                         i = indices[index]
  *                         confidence = data[index]
  */
                                     __pyx_t_1 = ((__pyx_v_implicit > 0) != 0);
                                     if (__pyx_t_1) {
 
-                                      /* "libreco/algorithms/_als.pyx":152
+                                      /* "libreco/algorithms/_als.pyx":211
  *                 for index in range(indptr[m], indptr[m+1]):
  *                     if implicit > 0:
  *                         i = indices[index]             # <<<<<<<<<<<<<<
  *                         confidence = data[index]
  *                         # second step: r += (c - (c-1)y @ x) * y
  */
                                       __pyx_t_14 = __pyx_v_index;
                                       __pyx_v_i = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_14 * __pyx_v_indices.strides[0]) )));
 
-                                      /* "libreco/algorithms/_als.pyx":153
+                                      /* "libreco/algorithms/_als.pyx":212
  *                     if implicit > 0:
  *                         i = indices[index]
  *                         confidence = data[index]             # <<<<<<<<<<<<<<
  *                         # second step: r += (c - (c-1)y @ x) * y
  *                         temp = confidence - (confidence - 1) * dot(&embed_size, &Y[i, 0], &one, x, &one)
  */
                                       __pyx_t_14 = __pyx_v_index;
                                       __pyx_v_confidence = (*((float const  *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_14 * __pyx_v_data.strides[0]) )));
 
-                                      /* "libreco/algorithms/_als.pyx":155
+                                      /* "libreco/algorithms/_als.pyx":214
  *                         confidence = data[index]
  *                         # second step: r += (c - (c-1)y @ x) * y
  *                         temp = confidence - (confidence - 1) * dot(&embed_size, &Y[i, 0], &one, x, &one)             # <<<<<<<<<<<<<<
  *                         axpy(&embed_size, &temp, &Y[i, 0], &one, r, &one)
  *                     else:
  */
                                       __pyx_t_14 = __pyx_v_i;
                                       __pyx_t_18 = 0;
                                       __pyx_v_temp = (__pyx_v_confidence - ((__pyx_v_confidence - 1.0) * __pyx_f_7libreco_10algorithms_4_als_dot((&__pyx_v_embed_size), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_14 * __pyx_v_Y.strides[0]) )) + __pyx_t_18)) )))), (&__pyx_v_one), __pyx_v_x, (&__pyx_v_one))));
 
-                                      /* "libreco/algorithms/_als.pyx":156
+                                      /* "libreco/algorithms/_als.pyx":215
  *                         # second step: r += (c - (c-1)y @ x) * y
  *                         temp = confidence - (confidence - 1) * dot(&embed_size, &Y[i, 0], &one, x, &one)
  *                         axpy(&embed_size, &temp, &Y[i, 0], &one, r, &one)             # <<<<<<<<<<<<<<
  *                     else:
  *                         i = indices[index]
  */
                                       __pyx_t_18 = __pyx_v_i;
                                       __pyx_t_14 = 0;
                                       __pyx_f_7libreco_10algorithms_4_als_axpy((&__pyx_v_embed_size), (&__pyx_v_temp), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_18 * __pyx_v_Y.strides[0]) )) + __pyx_t_14)) )))), (&__pyx_v_one), __pyx_v_r, (&__pyx_v_one));
 
-                                      /* "libreco/algorithms/_als.pyx":151
+                                      /* "libreco/algorithms/_als.pyx":210
  *                 symv("U", &embed_size, &temp, &initialA[0, 0], &embed_size, x, &one, &zero, r, &one)
  *                 for index in range(indptr[m], indptr[m+1]):
  *                     if implicit > 0:             # <<<<<<<<<<<<<<
  *                         i = indices[index]
  *                         confidence = data[index]
  */
                                       goto __pyx_L22;
                                     }
 
-                                    /* "libreco/algorithms/_als.pyx":158
+                                    /* "libreco/algorithms/_als.pyx":217
  *                         axpy(&embed_size, &temp, &Y[i, 0], &one, r, &one)
  *                     else:
  *                         i = indices[index]             # <<<<<<<<<<<<<<
  *                         rating = data[index]
  *                         # second step: r += (rating - y @ x) * y
  */
                                     /*else*/ {
                                       __pyx_t_14 = __pyx_v_index;
                                       __pyx_v_i = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_14 * __pyx_v_indices.strides[0]) )));
 
-                                      /* "libreco/algorithms/_als.pyx":159
+                                      /* "libreco/algorithms/_als.pyx":218
  *                     else:
  *                         i = indices[index]
  *                         rating = data[index]             # <<<<<<<<<<<<<<
  *                         # second step: r += (rating - y @ x) * y
  *                         temp = rating - dot(&embed_size, &Y[i, 0], &one, x, &one)
  */
                                       __pyx_t_14 = __pyx_v_index;
                                       __pyx_v_rating = (*((float const  *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_14 * __pyx_v_data.strides[0]) )));
 
-                                      /* "libreco/algorithms/_als.pyx":161
+                                      /* "libreco/algorithms/_als.pyx":220
  *                         rating = data[index]
  *                         # second step: r += (rating - y @ x) * y
  *                         temp = rating - dot(&embed_size, &Y[i, 0], &one, x, &one)             # <<<<<<<<<<<<<<
  *                         axpy(&embed_size, &temp, &Y[i, 0], &one, r, &one)
  * 
  */
                                       __pyx_t_14 = __pyx_v_i;
                                       __pyx_t_18 = 0;
                                       __pyx_v_temp = (__pyx_v_rating - __pyx_f_7libreco_10algorithms_4_als_dot((&__pyx_v_embed_size), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_14 * __pyx_v_Y.strides[0]) )) + __pyx_t_18)) )))), (&__pyx_v_one), __pyx_v_x, (&__pyx_v_one)));
 
-                                      /* "libreco/algorithms/_als.pyx":162
+                                      /* "libreco/algorithms/_als.pyx":221
  *                         # second step: r += (rating - y @ x) * y
  *                         temp = rating - dot(&embed_size, &Y[i, 0], &one, x, &one)
  *                         axpy(&embed_size, &temp, &Y[i, 0], &one, r, &one)             # <<<<<<<<<<<<<<
  * 
  *                 memcpy(p, r, sizeof(float) * embed_size)
  */
                                       __pyx_t_18 = __pyx_v_i;
                                       __pyx_t_14 = 0;
                                       __pyx_f_7libreco_10algorithms_4_als_axpy((&__pyx_v_embed_size), (&__pyx_v_temp), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_18 * __pyx_v_Y.strides[0]) )) + __pyx_t_14)) )))), (&__pyx_v_one), __pyx_v_r, (&__pyx_v_one));
                                     }
                                     __pyx_L22:;
                                   }
 
-                                  /* "libreco/algorithms/_als.pyx":164
+                                  /* "libreco/algorithms/_als.pyx":223
  *                         axpy(&embed_size, &temp, &Y[i, 0], &one, r, &one)
  * 
  *                 memcpy(p, r, sizeof(float) * embed_size)             # <<<<<<<<<<<<<<
  *                 rsold = dot(&embed_size, r, &one, r, &one)
  *                 if rsold < 1e-10:
  */
                                   (void)(memcpy(__pyx_v_p, __pyx_v_r, ((sizeof(float)) * __pyx_v_embed_size)));
 
-                                  /* "libreco/algorithms/_als.pyx":165
+                                  /* "libreco/algorithms/_als.pyx":224
  * 
  *                 memcpy(p, r, sizeof(float) * embed_size)
  *                 rsold = dot(&embed_size, r, &one, r, &one)             # <<<<<<<<<<<<<<
  *                 if rsold < 1e-10:
  *                     continue
  */
                                   __pyx_v_rsold = __pyx_f_7libreco_10algorithms_4_als_dot((&__pyx_v_embed_size), __pyx_v_r, (&__pyx_v_one), __pyx_v_r, (&__pyx_v_one));
 
-                                  /* "libreco/algorithms/_als.pyx":166
+                                  /* "libreco/algorithms/_als.pyx":225
  *                 memcpy(p, r, sizeof(float) * embed_size)
  *                 rsold = dot(&embed_size, r, &one, r, &one)
  *                 if rsold < 1e-10:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                   __pyx_t_1 = ((__pyx_v_rsold < 1e-10) != 0);
                                   if (__pyx_t_1) {
 
-                                    /* "libreco/algorithms/_als.pyx":167
+                                    /* "libreco/algorithms/_als.pyx":226
  *                 rsold = dot(&embed_size, r, &one, r, &one)
  *                 if rsold < 1e-10:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 for j in range(cg_steps):
  */
                                     goto __pyx_L16_continue;
 
-                                    /* "libreco/algorithms/_als.pyx":166
+                                    /* "libreco/algorithms/_als.pyx":225
  *                 memcpy(p, r, sizeof(float) * embed_size)
  *                 rsold = dot(&embed_size, r, &one, r, &one)
  *                 if rsold < 1e-10:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                   }
 
-                                  /* "libreco/algorithms/_als.pyx":169
+                                  /* "libreco/algorithms/_als.pyx":228
  *                     continue
  * 
  *                 for j in range(cg_steps):             # <<<<<<<<<<<<<<
  *                     temp = 1.0
  *                     # compute Ap
  */
                                   __pyx_t_15 = __pyx_v_cg_steps;
                                   __pyx_t_16 = __pyx_t_15;
                                   for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
                                     __pyx_v_j = __pyx_t_17;
 
-                                    /* "libreco/algorithms/_als.pyx":170
+                                    /* "libreco/algorithms/_als.pyx":229
  * 
  *                 for j in range(cg_steps):
  *                     temp = 1.0             # <<<<<<<<<<<<<<
  *                     # compute Ap
  *                     # first step: Ap = -(YtY + lambdaI)^T @ p  or  -(lambdaI @ p)
  */
                                     __pyx_v_temp = 1.0;
 
-                                    /* "libreco/algorithms/_als.pyx":173
+                                    /* "libreco/algorithms/_als.pyx":232
  *                     # compute Ap
  *                     # first step: Ap = -(YtY + lambdaI)^T @ p  or  -(lambdaI @ p)
  *                     symv("U", &embed_size, &temp, &initialA[0, 0], &embed_size, p, &one, &zero, Ap, &one)             # <<<<<<<<<<<<<<
  *                     for index in range(indptr[m], indptr[m+1]):
  *                         if implicit > 0:
  */
                                     __pyx_t_13 = 0;
                                     __pyx_t_14 = 0;
                                     __pyx_f_7libreco_10algorithms_4_als_symv(((char *)"U"), (&__pyx_v_embed_size), (&__pyx_v_temp), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_initialA.data + __pyx_t_13 * __pyx_v_initialA.strides[0]) )) + __pyx_t_14)) )))), (&__pyx_v_embed_size), __pyx_v_p, (&__pyx_v_one), (&__pyx_v_zero), __pyx_v_Ap, (&__pyx_v_one));
 
-                                    /* "libreco/algorithms/_als.pyx":174
+                                    /* "libreco/algorithms/_als.pyx":233
  *                     # first step: Ap = -(YtY + lambdaI)^T @ p  or  -(lambdaI @ p)
  *                     symv("U", &embed_size, &temp, &initialA[0, 0], &embed_size, p, &one, &zero, Ap, &one)
  *                     for index in range(indptr[m], indptr[m+1]):             # <<<<<<<<<<<<<<
  *                         if implicit > 0:
  *                             i = indices[index]
  */
                                     __pyx_t_14 = (__pyx_v_m + 1);
                                     __pyx_t_19 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_14 * __pyx_v_indptr.strides[0]) )));
                                     __pyx_t_14 = __pyx_v_m;
                                     __pyx_t_20 = __pyx_t_19;
                                     for (__pyx_t_21 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_14 * __pyx_v_indptr.strides[0]) ))); __pyx_t_21 < __pyx_t_20; __pyx_t_21+=1) {
                                       __pyx_v_index = __pyx_t_21;
 
-                                      /* "libreco/algorithms/_als.pyx":175
+                                      /* "libreco/algorithms/_als.pyx":234
  *                     symv("U", &embed_size, &temp, &initialA[0, 0], &embed_size, p, &one, &zero, Ap, &one)
  *                     for index in range(indptr[m], indptr[m+1]):
  *                         if implicit > 0:             # <<<<<<<<<<<<<<
  *                             i = indices[index]
  *                             confidence = data[index]
  */
                                       __pyx_t_1 = ((__pyx_v_implicit > 0) != 0);
                                       if (__pyx_t_1) {
 
-                                        /* "libreco/algorithms/_als.pyx":176
+                                        /* "libreco/algorithms/_als.pyx":235
  *                     for index in range(indptr[m], indptr[m+1]):
  *                         if implicit > 0:
  *                             i = indices[index]             # <<<<<<<<<<<<<<
  *                             confidence = data[index]
  *                             # second step: Ap += (c-1) * (y @ x) * y
  */
                                         __pyx_t_13 = __pyx_v_index;
                                         __pyx_v_i = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_13 * __pyx_v_indices.strides[0]) )));
 
-                                        /* "libreco/algorithms/_als.pyx":177
+                                        /* "libreco/algorithms/_als.pyx":236
  *                         if implicit > 0:
  *                             i = indices[index]
  *                             confidence = data[index]             # <<<<<<<<<<<<<<
  *                             # second step: Ap += (c-1) * (y @ x) * y
  *                             temp = (confidence - 1) * dot(&embed_size, &Y[i, 0], &one, p, &one)
  */
                                         __pyx_t_13 = __pyx_v_index;
                                         __pyx_v_confidence = (*((float const  *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_13 * __pyx_v_data.strides[0]) )));
 
-                                        /* "libreco/algorithms/_als.pyx":179
+                                        /* "libreco/algorithms/_als.pyx":238
  *                             confidence = data[index]
  *                             # second step: Ap += (c-1) * (y @ x) * y
  *                             temp = (confidence - 1) * dot(&embed_size, &Y[i, 0], &one, p, &one)             # <<<<<<<<<<<<<<
  *                             axpy(&embed_size, &temp, &Y[i, 0], &one, Ap, &one)
  *                         else:
  */
                                         __pyx_t_13 = __pyx_v_i;
                                         __pyx_t_18 = 0;
                                         __pyx_v_temp = ((__pyx_v_confidence - 1.0) * __pyx_f_7libreco_10algorithms_4_als_dot((&__pyx_v_embed_size), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_13 * __pyx_v_Y.strides[0]) )) + __pyx_t_18)) )))), (&__pyx_v_one), __pyx_v_p, (&__pyx_v_one)));
 
-                                        /* "libreco/algorithms/_als.pyx":180
+                                        /* "libreco/algorithms/_als.pyx":239
  *                             # second step: Ap += (c-1) * (y @ x) * y
  *                             temp = (confidence - 1) * dot(&embed_size, &Y[i, 0], &one, p, &one)
  *                             axpy(&embed_size, &temp, &Y[i, 0], &one, Ap, &one)             # <<<<<<<<<<<<<<
  *                         else:
  *                             i = indices[index]
  */
                                         __pyx_t_18 = __pyx_v_i;
                                         __pyx_t_13 = 0;
                                         __pyx_f_7libreco_10algorithms_4_als_axpy((&__pyx_v_embed_size), (&__pyx_v_temp), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_18 * __pyx_v_Y.strides[0]) )) + __pyx_t_13)) )))), (&__pyx_v_one), __pyx_v_Ap, (&__pyx_v_one));
 
-                                        /* "libreco/algorithms/_als.pyx":175
+                                        /* "libreco/algorithms/_als.pyx":234
  *                     symv("U", &embed_size, &temp, &initialA[0, 0], &embed_size, p, &one, &zero, Ap, &one)
  *                     for index in range(indptr[m], indptr[m+1]):
  *                         if implicit > 0:             # <<<<<<<<<<<<<<
  *                             i = indices[index]
  *                             confidence = data[index]
  */
                                         goto __pyx_L28;
                                       }
 
-                                      /* "libreco/algorithms/_als.pyx":182
+                                      /* "libreco/algorithms/_als.pyx":241
  *                             axpy(&embed_size, &temp, &Y[i, 0], &one, Ap, &one)
  *                         else:
  *                             i = indices[index]             # <<<<<<<<<<<<<<
  *                             # second step: Ap += (y @ x) * y
  *                             temp = dot(&embed_size, &Y[i, 0], &one, p, &one)
  */
                                       /*else*/ {
                                         __pyx_t_13 = __pyx_v_index;
                                         __pyx_v_i = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_13 * __pyx_v_indices.strides[0]) )));
 
-                                        /* "libreco/algorithms/_als.pyx":184
+                                        /* "libreco/algorithms/_als.pyx":243
  *                             i = indices[index]
  *                             # second step: Ap += (y @ x) * y
  *                             temp = dot(&embed_size, &Y[i, 0], &one, p, &one)             # <<<<<<<<<<<<<<
  *                             axpy(&embed_size, &temp, &Y[i, 0], &one, Ap, &one)
  * 
  */
                                         __pyx_t_13 = __pyx_v_i;
                                         __pyx_t_18 = 0;
                                         __pyx_v_temp = __pyx_f_7libreco_10algorithms_4_als_dot((&__pyx_v_embed_size), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_13 * __pyx_v_Y.strides[0]) )) + __pyx_t_18)) )))), (&__pyx_v_one), __pyx_v_p, (&__pyx_v_one));
 
-                                        /* "libreco/algorithms/_als.pyx":185
+                                        /* "libreco/algorithms/_als.pyx":244
  *                             # second step: Ap += (y @ x) * y
  *                             temp = dot(&embed_size, &Y[i, 0], &one, p, &one)
  *                             axpy(&embed_size, &temp, &Y[i, 0], &one, Ap, &one)             # <<<<<<<<<<<<<<
  * 
  *                     # ak = rsold / p.dot(Ap)
  */
                                         __pyx_t_18 = __pyx_v_i;
                                         __pyx_t_13 = 0;
                                         __pyx_f_7libreco_10algorithms_4_als_axpy((&__pyx_v_embed_size), (&__pyx_v_temp), (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_Y.data + __pyx_t_18 * __pyx_v_Y.strides[0]) )) + __pyx_t_13)) )))), (&__pyx_v_one), __pyx_v_Ap, (&__pyx_v_one));
                                       }
                                       __pyx_L28:;
                                     }
 
-                                    /* "libreco/algorithms/_als.pyx":188
+                                    /* "libreco/algorithms/_als.pyx":247
  * 
  *                     # ak = rsold / p.dot(Ap)
  *                     ak = rsold / dot(&embed_size, p, &one, Ap, &one)             # <<<<<<<<<<<<<<
  *                     # x += ak * p
  *                     axpy(&embed_size, &ak, p, &one, x, &one)
  */
                                     __pyx_v_ak = (__pyx_v_rsold / __pyx_f_7libreco_10algorithms_4_als_dot((&__pyx_v_embed_size), __pyx_v_p, (&__pyx_v_one), __pyx_v_Ap, (&__pyx_v_one)));
 
-                                    /* "libreco/algorithms/_als.pyx":190
+                                    /* "libreco/algorithms/_als.pyx":249
  *                     ak = rsold / dot(&embed_size, p, &one, Ap, &one)
  *                     # x += ak * p
  *                     axpy(&embed_size, &ak, p, &one, x, &one)             # <<<<<<<<<<<<<<
  *                     # r -= alpha * Ap
  *                     temp = ak * -1
  */
                                     __pyx_f_7libreco_10algorithms_4_als_axpy((&__pyx_v_embed_size), (&__pyx_v_ak), __pyx_v_p, (&__pyx_v_one), __pyx_v_x, (&__pyx_v_one));
 
-                                    /* "libreco/algorithms/_als.pyx":192
+                                    /* "libreco/algorithms/_als.pyx":251
  *                     axpy(&embed_size, &ak, p, &one, x, &one)
  *                     # r -= alpha * Ap
  *                     temp = ak * -1             # <<<<<<<<<<<<<<
  *                     axpy(&embed_size, &temp, Ap, &one, r, &one)
  * 
  */
                                     __pyx_v_temp = (__pyx_v_ak * -1.0);
 
-                                    /* "libreco/algorithms/_als.pyx":193
+                                    /* "libreco/algorithms/_als.pyx":252
  *                     # r -= alpha * Ap
  *                     temp = ak * -1
  *                     axpy(&embed_size, &temp, Ap, &one, r, &one)             # <<<<<<<<<<<<<<
  * 
  *                     rsnew = dot(&embed_size, r, &one, r, &one)
  */
                                     __pyx_f_7libreco_10algorithms_4_als_axpy((&__pyx_v_embed_size), (&__pyx_v_temp), __pyx_v_Ap, (&__pyx_v_one), __pyx_v_r, (&__pyx_v_one));
 
-                                    /* "libreco/algorithms/_als.pyx":195
+                                    /* "libreco/algorithms/_als.pyx":254
  *                     axpy(&embed_size, &temp, Ap, &one, r, &one)
  * 
  *                     rsnew = dot(&embed_size, r, &one, r, &one)             # <<<<<<<<<<<<<<
  *                     if rsnew < 1e-10:
  *                         break
  */
                                     __pyx_v_rsnew = __pyx_f_7libreco_10algorithms_4_als_dot((&__pyx_v_embed_size), __pyx_v_r, (&__pyx_v_one), __pyx_v_r, (&__pyx_v_one));
 
-                                    /* "libreco/algorithms/_als.pyx":196
+                                    /* "libreco/algorithms/_als.pyx":255
  * 
  *                     rsnew = dot(&embed_size, r, &one, r, &one)
  *                     if rsnew < 1e-10:             # <<<<<<<<<<<<<<
  *                         break
  * 
  */
                                     __pyx_t_1 = ((__pyx_v_rsnew < 1e-10) != 0);
                                     if (__pyx_t_1) {
 
-                                      /* "libreco/algorithms/_als.pyx":197
+                                      /* "libreco/algorithms/_als.pyx":256
  *                     rsnew = dot(&embed_size, r, &one, r, &one)
  *                     if rsnew < 1e-10:
  *                         break             # <<<<<<<<<<<<<<
  * 
  *                     # p = r + (rsnew/rsold) * p
  */
                                       goto __pyx_L25_break;
 
-                                      /* "libreco/algorithms/_als.pyx":196
+                                      /* "libreco/algorithms/_als.pyx":255
  * 
  *                     rsnew = dot(&embed_size, r, &one, r, &one)
  *                     if rsnew < 1e-10:             # <<<<<<<<<<<<<<
  *                         break
  * 
  */
                                     }
 
-                                    /* "libreco/algorithms/_als.pyx":200
+                                    /* "libreco/algorithms/_als.pyx":259
  * 
  *                     # p = r + (rsnew/rsold) * p
  *                     temp = rsnew / rsold             # <<<<<<<<<<<<<<
  *                     scal(&embed_size, &temp, p, &one)
  *                     temp = 1.0
  */
                                     __pyx_v_temp = (__pyx_v_rsnew / __pyx_v_rsold);
 
-                                    /* "libreco/algorithms/_als.pyx":201
+                                    /* "libreco/algorithms/_als.pyx":260
  *                     # p = r + (rsnew/rsold) * p
  *                     temp = rsnew / rsold
  *                     scal(&embed_size, &temp, p, &one)             # <<<<<<<<<<<<<<
  *                     temp = 1.0
  *                     axpy(&embed_size, &temp, r, &one, p, &one)
  */
                                     __pyx_f_7libreco_10algorithms_4_als_scal((&__pyx_v_embed_size), (&__pyx_v_temp), __pyx_v_p, (&__pyx_v_one));
 
-                                    /* "libreco/algorithms/_als.pyx":202
+                                    /* "libreco/algorithms/_als.pyx":261
  *                     temp = rsnew / rsold
  *                     scal(&embed_size, &temp, p, &one)
  *                     temp = 1.0             # <<<<<<<<<<<<<<
  *                     axpy(&embed_size, &temp, r, &one, p, &one)
  *                     rsold = rsnew
  */
                                     __pyx_v_temp = 1.0;
 
-                                    /* "libreco/algorithms/_als.pyx":203
+                                    /* "libreco/algorithms/_als.pyx":262
  *                     scal(&embed_size, &temp, p, &one)
  *                     temp = 1.0
  *                     axpy(&embed_size, &temp, r, &one, p, &one)             # <<<<<<<<<<<<<<
  *                     rsold = rsnew
  * 
  */
                                     __pyx_f_7libreco_10algorithms_4_als_axpy((&__pyx_v_embed_size), (&__pyx_v_temp), __pyx_v_r, (&__pyx_v_one), __pyx_v_p, (&__pyx_v_one));
 
-                                    /* "libreco/algorithms/_als.pyx":204
+                                    /* "libreco/algorithms/_als.pyx":263
  *                     temp = 1.0
  *                     axpy(&embed_size, &temp, r, &one, p, &one)
  *                     rsold = rsnew             # <<<<<<<<<<<<<<
  * 
  *         finally:
  */
                                     __pyx_v_rsold = __pyx_v_rsnew;
@@ -5136,39 +5312,37 @@
                                   __pyx_L31:;
                               }
                           }
                       }
                   }
                 }
 
-                /* "libreco/algorithms/_als.pyx":207
+                /* "libreco/algorithms/_als.pyx":266
  * 
  *         finally:
  *             free(Ap)             # <<<<<<<<<<<<<<
  *             free(p)
  *             free(r)
  */
                 /*finally:*/ {
                   /*normal exit:*/{
                     free(__pyx_v_Ap);
 
-                    /* "libreco/algorithms/_als.pyx":208
+                    /* "libreco/algorithms/_als.pyx":267
  *         finally:
  *             free(Ap)
  *             free(p)             # <<<<<<<<<<<<<<
  *             free(r)
- * 
  */
                     free(__pyx_v_p);
 
-                    /* "libreco/algorithms/_als.pyx":209
+                    /* "libreco/algorithms/_als.pyx":268
  *             free(Ap)
  *             free(p)
  *             free(r)             # <<<<<<<<<<<<<<
- * 
  */
                     free(__pyx_v_r);
                     goto __pyx_L15;
                   }
                   __pyx_L15:;
                 }
             }
@@ -5177,15 +5351,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "libreco/algorithms/_als.pyx":138
+      /* "libreco/algorithms/_als.pyx":197
  *     cdef float *Ap
  * 
  *     with nogil, parallel(num_threads=num_threads):             # <<<<<<<<<<<<<<
  *         Ap = <float *> malloc(sizeof(float) * embed_size)
  *         p = <float *> malloc(sizeof(float) * embed_size)
  */
       /*finally:*/ {
@@ -5196,20 +5370,20 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "libreco/algorithms/_als.pyx":119
+  /* "libreco/algorithms/_als.pyx":170
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef void _least_squares_cg(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *     const float[:] data, float[:, ::1] X, float[:, ::1] Y, double reg,
- *     int num_threads, int implicit, int cg_steps):
+ * cdef void _least_squares_cg(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
@@ -19121,16 +19295,16 @@
   {&__pyx_n_s_pyx_getbuffer, __pyx_k_pyx_getbuffer, sizeof(__pyx_k_pyx_getbuffer), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_result, __pyx_k_pyx_result, sizeof(__pyx_k_pyx_result), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_state, __pyx_k_pyx_state, sizeof(__pyx_k_pyx_state), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_type, __pyx_k_pyx_type, sizeof(__pyx_k_pyx_type), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_unpickle_Enum, __pyx_k_pyx_unpickle_Enum, sizeof(__pyx_k_pyx_unpickle_Enum), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_vtable, __pyx_k_pyx_vtable, sizeof(__pyx_k_pyx_vtable), 0, 0, 1, 1},
   {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
-  {&__pyx_n_s_ranking, __pyx_k_ranking, sizeof(__pyx_k_ranking), 0, 0, 1, 1},
-  {&__pyx_n_s_rating, __pyx_k_rating, sizeof(__pyx_k_rating), 0, 0, 1, 1},
+  {&__pyx_n_u_ranking, __pyx_k_ranking, sizeof(__pyx_k_ranking), 0, 1, 0, 1},
+  {&__pyx_n_u_rating, __pyx_k_rating, sizeof(__pyx_k_rating), 0, 1, 0, 1},
   {&__pyx_n_s_reduce, __pyx_k_reduce, sizeof(__pyx_k_reduce), 0, 0, 1, 1},
   {&__pyx_n_s_reduce_cython, __pyx_k_reduce_cython, sizeof(__pyx_k_reduce_cython), 0, 0, 1, 1},
   {&__pyx_n_s_reduce_ex, __pyx_k_reduce_ex, sizeof(__pyx_k_reduce_ex), 0, 0, 1, 1},
   {&__pyx_n_s_reg, __pyx_k_reg, sizeof(__pyx_k_reg), 0, 0, 1, 1},
   {&__pyx_n_s_setstate, __pyx_k_setstate, sizeof(__pyx_k_setstate), 0, 0, 1, 1},
   {&__pyx_n_s_setstate_cython, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
   {&__pyx_n_s_shape, __pyx_k_shape, sizeof(__pyx_k_shape), 0, 0, 1, 1},
@@ -19152,16 +19326,16 @@
   {&__pyx_n_s_unpack, __pyx_k_unpack, sizeof(__pyx_k_unpack), 0, 0, 1, 1},
   {&__pyx_n_s_update, __pyx_k_update, sizeof(__pyx_k_update), 0, 0, 1, 1},
   {&__pyx_n_s_use_cg, __pyx_k_use_cg, sizeof(__pyx_k_use_cg), 0, 0, 1, 1},
   {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 79, __pyx_L1_error)
-  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 130, __pyx_L1_error)
+  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 159, __pyx_L1_error)
   __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(1, 149, __pyx_L1_error)
   __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(1, 152, __pyx_L1_error)
   __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 2, __pyx_L1_error)
   __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(1, 406, __pyx_L1_error)
   __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(1, 615, __pyx_L1_error)
   __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(1, 834, __pyx_L1_error)
   return 0;
@@ -19364,25 +19538,25 @@
   __pyx_tuple__18 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__18);
   __Pyx_GIVEREF(__pyx_tuple__18);
   __pyx_tuple__19 = PyTuple_Pack(3, __pyx_int_184977713, __pyx_int_136983863, __pyx_int_112105877); if (unlikely(!__pyx_tuple__19)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__19);
   __Pyx_GIVEREF(__pyx_tuple__19);
 
-  /* "libreco/algorithms/_als.pyx":36
+  /* "libreco/algorithms/_als.pyx":47
  * 
  * 
- * def als_update(interaction, X, Y, reg, task, use_cg=True,             # <<<<<<<<<<<<<<
- *                num_threads=1, cg_steps=3):
+ * def als_update(interaction, X, Y, reg, task, use_cg=True, num_threads=1, cg_steps=3):             # <<<<<<<<<<<<<<
  *     if task == "rating" and use_cg:
+ *         _least_squares_cg(
  */
-  __pyx_tuple__20 = PyTuple_Pack(8, __pyx_n_s_interaction, __pyx_n_s_X, __pyx_n_s_Y, __pyx_n_s_reg, __pyx_n_s_task, __pyx_n_s_use_cg, __pyx_n_s_num_threads, __pyx_n_s_cg_steps); if (unlikely(!__pyx_tuple__20)) __PYX_ERR(0, 36, __pyx_L1_error)
+  __pyx_tuple__20 = PyTuple_Pack(8, __pyx_n_s_interaction, __pyx_n_s_X, __pyx_n_s_Y, __pyx_n_s_reg, __pyx_n_s_task, __pyx_n_s_use_cg, __pyx_n_s_num_threads, __pyx_n_s_cg_steps); if (unlikely(!__pyx_tuple__20)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__20);
   __Pyx_GIVEREF(__pyx_tuple__20);
-  __pyx_codeobj__21 = (PyObject*)__Pyx_PyCode_New(8, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__20, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_libreco_algorithms__als_pyx, __pyx_n_s_als_update, 36, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__21)) __PYX_ERR(0, 36, __pyx_L1_error)
+  __pyx_codeobj__21 = (PyObject*)__Pyx_PyCode_New(8, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__20, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_libreco_algorithms__als_pyx, __pyx_n_s_als_update, 47, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__21)) __PYX_ERR(0, 47, __pyx_L1_error)
 
   /* "View.MemoryView":287
  *         return self.name
  * 
  * cdef generic = Enum("<strided and direct or indirect>")             # <<<<<<<<<<<<<<
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")
@@ -19814,40 +19988,41 @@
   (void)__Pyx_modinit_variable_import_code();
   if (unlikely(__Pyx_modinit_function_import_code() < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
-  /* "libreco/algorithms/_als.pyx":1
+  /* "libreco/algorithms/_als.pyx":2
+ * # cython: language_level=3
  * import numpy as np             # <<<<<<<<<<<<<<
  * import cython
  * from cython.parallel import parallel, prange
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "libreco/algorithms/_als.pyx":36
+  /* "libreco/algorithms/_als.pyx":47
  * 
  * 
- * def als_update(interaction, X, Y, reg, task, use_cg=True,             # <<<<<<<<<<<<<<
- *                num_threads=1, cg_steps=3):
+ * def als_update(interaction, X, Y, reg, task, use_cg=True, num_threads=1, cg_steps=3):             # <<<<<<<<<<<<<<
  *     if task == "rating" and use_cg:
+ *         _least_squares_cg(
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_7libreco_10algorithms_4_als_1als_update, NULL, __pyx_n_s_libreco_algorithms__als); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_7libreco_10algorithms_4_als_1als_update, NULL, __pyx_n_s_libreco_algorithms__als); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_als_update, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_als_update, __pyx_t_1) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "libreco/algorithms/_als.pyx":1
- * import numpy as np             # <<<<<<<<<<<<<<
+ * # cython: language_level=3             # <<<<<<<<<<<<<<
+ * import numpy as np
  * import cython
- * from cython.parallel import parallel, prange
  */
   __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "View.MemoryView":210
```

### Comparing `LibRecommender-1.1.0/libreco/algorithms/_als.pyx` & `LibRecommender-1.1.1/libreco/algorithms/_als.pyx`

 * *Files 14% similar despite different names*

```diff
@@ -1,64 +1,115 @@
+# cython: language_level=3
 import numpy as np
 import cython
 from cython.parallel import parallel, prange
 from libc.stdlib cimport malloc, free
-from libc.string cimport memcpy, memset
+from libc.string cimport memcpy
 
 cimport scipy.linalg.cython_lapack as cython_lapack
 cimport scipy.linalg.cython_blas as cython_blas
 
 
-cdef inline void axpy(int *n, float *da, float *dx, int *incx, float *dy, 
-                      int *incy) nogil:
+cdef inline void axpy(
+    int *n, float *da, float *dx, int *incx, float *dy, int *incy
+) nogil:
     cython_blas.saxpy(n, da, dx, incx, dy, incy)
 
 
-cdef inline void posv(char *u, int *n, int *nrhs, float *a, int *lda, 
-                      float *b, int *ldb, int *info) nogil:
+cdef inline void posv(
+    char *u, int *n, int *nrhs, float *a, int *lda, float *b, int *ldb, int *info
+) nogil:
     cython_lapack.sposv(u, n, nrhs, a, lda, b, ldb, info)
 
 
-cdef inline void symv(char *u, int *n, float *alpha, float *a, int *lda, 
-                      float *x, int *incx, float *beta, float *y, 
-                      int *incy) nogil:
+cdef inline void symv(
+    char *u,
+    int *n,
+    float *alpha,
+    float *a,
+    int *lda,
+    float *x,
+    int *incx,
+    float *beta,
+    float *y,
+    int *incy,
+) nogil:
     cython_blas.ssymv(u, n, alpha, a, lda, x, incx, beta, y, incy)
 
 
-cdef inline float dot(int *n, float *sx, int *incx, float *sy, 
-                      int *incy) nogil:
+cdef inline float dot(int *n, float *sx, int *incx, float *sy, int *incy) nogil:
     return cython_blas.sdot(n, sx, incx, sy, incy)
 
 
 cdef inline void scal(int *n, float *sa, float *sx, int *incx) nogil:
     cython_blas.sscal(n, sa, sx, incx)
 
 
-def als_update(interaction, X, Y, reg, task, use_cg=True, 
-               num_threads=1, cg_steps=3):
+def als_update(interaction, X, Y, reg, task, use_cg=True, num_threads=1, cg_steps=3):
     if task == "rating" and use_cg:
-        _least_squares_cg(interaction.indices, interaction.indptr, 
-            interaction.data, X, Y, reg, num_threads, 0, cg_steps)
+        _least_squares_cg(
+            interaction.indices,
+            interaction.indptr,
+            interaction.data,
+            X,
+            Y,
+            reg,
+            num_threads,
+            0,
+            cg_steps,
+        )
     elif task == "rating" and not use_cg:
-        _least_squares(interaction.indices, interaction.indptr, 
-            interaction.data, X, Y, reg, num_threads, 0)
+        _least_squares(
+            interaction.indices,
+            interaction.indptr,
+            interaction.data,
+            X,
+            Y,
+            reg,
+            num_threads,
+            0,
+        )
     elif task == "ranking" and use_cg:
-        _least_squares_cg(interaction.indices, interaction.indptr, 
-            interaction.data, X, Y, reg, num_threads, 1, cg_steps)
+        _least_squares_cg(
+            interaction.indices,
+            interaction.indptr,
+            interaction.data,
+            X,
+            Y,
+            reg,
+            num_threads,
+            1,
+            cg_steps,
+        )
     elif task == "ranking" and not use_cg:
-        _least_squares(interaction.indices, interaction.indptr, 
-            interaction.data, X, Y, reg, num_threads, 1)
+        _least_squares(
+            interaction.indices,
+            interaction.indptr,
+            interaction.data,
+            X,
+            Y,
+            reg,
+            num_threads,
+            1,
+        )
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
 @cython.cdivision(True)
-cdef void _least_squares(const int[:] indices, const int[:] indptr, 
-    const float[:] data, float[:, ::1] X, float[:, ::1] Y, double reg, 
-    int num_threads, int implicit):
+cdef void _least_squares(
+    const int[:] indices,
+    const int[:] indptr,
+    const float[:] data,
+    float[:, ::1] X,
+    float[:, ::1] Y,
+    double reg,
+    int num_threads,
+    int implicit,
+):
     cdef int n_x = X.shape[0], embed_size = X.shape[1]
     cdef int m, i, j, index, err, one = 1
     cdef float rating, confidence, temp
 
     cdef float[:, ::1] initialA
     if implicit > 0:
         initialA = np.dot(np.transpose(Y), Y) + reg * np.eye(embed_size, dtype=np.single)
@@ -112,17 +163,25 @@
             free(A)
             free(b)
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
 @cython.cdivision(True)
-cdef void _least_squares_cg(const int[:] indices, const int[:] indptr, 
-    const float[:] data, float[:, ::1] X, float[:, ::1] Y, double reg, 
-    int num_threads, int implicit, int cg_steps):
+cdef void _least_squares_cg(
+    const int[:] indices,
+    const int[:] indptr,
+    const float[:] data,
+    float[:, ::1] X,
+    float[:, ::1] Y,
+    double reg,
+    int num_threads,
+    int implicit,
+    int cg_steps,
+):
     cdef int n_x = X.shape[0], embed_size = X.shape[1]
     cdef int m, i, j, index, err, one = 1
     cdef float rating, confidence, temp, rsold, rsnew, ak
     cdef float zero = 0.0
 
     cdef float[:, ::1] initialA
     if implicit > 0:
@@ -203,8 +262,7 @@
                     axpy(&embed_size, &temp, r, &one, p, &one)
                     rsold = rsnew
 
         finally:
             free(Ap)
             free(p)
             free(r)
-
```

### Comparing `LibRecommender-1.1.0/libreco/algorithms/_bpr.cpp` & `LibRecommender-1.1.1/libreco/algorithms/_bpr.cpp`

 * *Files 5% similar despite different names*

```diff
@@ -1,33 +1,27 @@
 /* Generated by Cython 0.29.34 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
-        "depends": [
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include/numpy/arrayobject.h",
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include/numpy/arrayscalars.h",
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include/numpy/ndarrayobject.h",
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include/numpy/ndarraytypes.h",
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include/numpy/ufuncobject.h"
-        ],
+        "depends": [],
         "extra_compile_args": [
             "-Wno-unused-function",
             "-Wno-maybe-uninitialized",
             "-O3",
             "-ffast-math",
             "-fopenmp",
             "-std=c++11"
         ],
         "extra_link_args": [
             "-fopenmp",
             "-std=c++11"
         ],
         "include_dirs": [
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include"
+            "/tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/core/include"
         ],
         "language": "c++",
         "name": "libreco.algorithms._bpr",
         "sources": [
             "libreco/algorithms/_bpr.pyx"
         ]
     },
@@ -42,15 +36,15 @@
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
 #define CYTHON_ABI "0_29_34"
 #define CYTHON_HEX_VERSION 0x001D22F0
-#define CYTHON_FUTURE_DIVISION 0
+#define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
     #define __stdcall
@@ -786,34 +780,26 @@
     #define __PYX_EXTERN_C extern
   #endif
 #endif
 
 #define __PYX_HAVE__libreco__algorithms___bpr
 #define __PYX_HAVE_API__libreco__algorithms___bpr
 /* Early includes */
-#include <string.h>
-#include <stdio.h>
-#include "numpy/arrayobject.h"
-#include "numpy/ndarrayobject.h"
-#include "numpy/ndarraytypes.h"
-#include "numpy/arrayscalars.h"
-#include "numpy/ufuncobject.h"
-
-    /* NumPy API declarations from "numpy/__init__.pxd" */
-    
 #include <math.h>
 #include <algorithm>
 #include "ios"
 #include "new"
 #include "stdexcept"
 #include "typeinfo"
 #include <vector>
 #include <random>
 #include "pythread.h"
+#include <string.h>
 #include <stdlib.h>
+#include <stdio.h>
 #include "pystate.h"
 #ifdef _OPENMP
 #include <omp.h>
 #endif /* _OPENMP */
 
 #if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
 #define CYTHON_WITHOUT_ASSERTIONS
@@ -1014,42 +1000,18 @@
 static PyObject *__pyx_empty_bytes;
 static PyObject *__pyx_empty_unicode;
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm= __FILE__;
 static const char *__pyx_filename;
 
-/* Header.proto */
-#if !defined(CYTHON_CCOMPLEX)
-  #if defined(__cplusplus)
-    #define CYTHON_CCOMPLEX 1
-  #elif defined(_Complex_I)
-    #define CYTHON_CCOMPLEX 1
-  #else
-    #define CYTHON_CCOMPLEX 0
-  #endif
-#endif
-#if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    #include <complex>
-  #else
-    #include <complex.h>
-  #endif
-#endif
-#if CYTHON_CCOMPLEX && !defined(__cplusplus) && defined(__sun__) && defined(__GNUC__)
-  #undef _Complex_I
-  #define _Complex_I 1.0fj
-#endif
-
 
 static const char *__pyx_f[] = {
   "libreco/algorithms/_bpr.pyx",
-  "__init__.pxd",
   "stringsource",
-  "type.pxd",
 };
 /* MemviewSliceStruct.proto */
 struct __pyx_memoryview_obj;
 typedef struct {
   struct __pyx_memoryview_obj *memview;
   char *data;
   Py_ssize_t shape[8];
@@ -1148,276 +1110,27 @@
   char enc_type;
   char new_packmode;
   char enc_packmode;
   char is_valid_array;
 } __Pyx_BufFmt_Context;
 
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":689
- * # in Cython to enable them only on the right systems.
- * 
- * ctypedef npy_int8       int8_t             # <<<<<<<<<<<<<<
- * ctypedef npy_int16      int16_t
- * ctypedef npy_int32      int32_t
- */
-typedef npy_int8 __pyx_t_5numpy_int8_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":690
- * 
- * ctypedef npy_int8       int8_t
- * ctypedef npy_int16      int16_t             # <<<<<<<<<<<<<<
- * ctypedef npy_int32      int32_t
- * ctypedef npy_int64      int64_t
- */
-typedef npy_int16 __pyx_t_5numpy_int16_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":691
- * ctypedef npy_int8       int8_t
- * ctypedef npy_int16      int16_t
- * ctypedef npy_int32      int32_t             # <<<<<<<<<<<<<<
- * ctypedef npy_int64      int64_t
- * #ctypedef npy_int96      int96_t
- */
-typedef npy_int32 __pyx_t_5numpy_int32_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":692
- * ctypedef npy_int16      int16_t
- * ctypedef npy_int32      int32_t
- * ctypedef npy_int64      int64_t             # <<<<<<<<<<<<<<
- * #ctypedef npy_int96      int96_t
- * #ctypedef npy_int128     int128_t
- */
-typedef npy_int64 __pyx_t_5numpy_int64_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":696
- * #ctypedef npy_int128     int128_t
- * 
- * ctypedef npy_uint8      uint8_t             # <<<<<<<<<<<<<<
- * ctypedef npy_uint16     uint16_t
- * ctypedef npy_uint32     uint32_t
- */
-typedef npy_uint8 __pyx_t_5numpy_uint8_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":697
- * 
- * ctypedef npy_uint8      uint8_t
- * ctypedef npy_uint16     uint16_t             # <<<<<<<<<<<<<<
- * ctypedef npy_uint32     uint32_t
- * ctypedef npy_uint64     uint64_t
- */
-typedef npy_uint16 __pyx_t_5numpy_uint16_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":698
- * ctypedef npy_uint8      uint8_t
- * ctypedef npy_uint16     uint16_t
- * ctypedef npy_uint32     uint32_t             # <<<<<<<<<<<<<<
- * ctypedef npy_uint64     uint64_t
- * #ctypedef npy_uint96     uint96_t
- */
-typedef npy_uint32 __pyx_t_5numpy_uint32_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":699
- * ctypedef npy_uint16     uint16_t
- * ctypedef npy_uint32     uint32_t
- * ctypedef npy_uint64     uint64_t             # <<<<<<<<<<<<<<
- * #ctypedef npy_uint96     uint96_t
- * #ctypedef npy_uint128    uint128_t
- */
-typedef npy_uint64 __pyx_t_5numpy_uint64_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":703
- * #ctypedef npy_uint128    uint128_t
- * 
- * ctypedef npy_float32    float32_t             # <<<<<<<<<<<<<<
- * ctypedef npy_float64    float64_t
- * #ctypedef npy_float80    float80_t
- */
-typedef npy_float32 __pyx_t_5numpy_float32_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":704
- * 
- * ctypedef npy_float32    float32_t
- * ctypedef npy_float64    float64_t             # <<<<<<<<<<<<<<
- * #ctypedef npy_float80    float80_t
- * #ctypedef npy_float128   float128_t
- */
-typedef npy_float64 __pyx_t_5numpy_float64_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":713
- * # The int types are mapped a bit surprising --
- * # numpy.int corresponds to 'l' and numpy.long to 'q'
- * ctypedef npy_long       int_t             # <<<<<<<<<<<<<<
- * ctypedef npy_longlong   long_t
- * ctypedef npy_longlong   longlong_t
- */
-typedef npy_long __pyx_t_5numpy_int_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":714
- * # numpy.int corresponds to 'l' and numpy.long to 'q'
- * ctypedef npy_long       int_t
- * ctypedef npy_longlong   long_t             # <<<<<<<<<<<<<<
- * ctypedef npy_longlong   longlong_t
- * 
- */
-typedef npy_longlong __pyx_t_5numpy_long_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":715
- * ctypedef npy_long       int_t
- * ctypedef npy_longlong   long_t
- * ctypedef npy_longlong   longlong_t             # <<<<<<<<<<<<<<
- * 
- * ctypedef npy_ulong      uint_t
- */
-typedef npy_longlong __pyx_t_5numpy_longlong_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":717
- * ctypedef npy_longlong   longlong_t
- * 
- * ctypedef npy_ulong      uint_t             # <<<<<<<<<<<<<<
- * ctypedef npy_ulonglong  ulong_t
- * ctypedef npy_ulonglong  ulonglong_t
- */
-typedef npy_ulong __pyx_t_5numpy_uint_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":718
- * 
- * ctypedef npy_ulong      uint_t
- * ctypedef npy_ulonglong  ulong_t             # <<<<<<<<<<<<<<
- * ctypedef npy_ulonglong  ulonglong_t
- * 
- */
-typedef npy_ulonglong __pyx_t_5numpy_ulong_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":719
- * ctypedef npy_ulong      uint_t
- * ctypedef npy_ulonglong  ulong_t
- * ctypedef npy_ulonglong  ulonglong_t             # <<<<<<<<<<<<<<
- * 
- * ctypedef npy_intp       intp_t
- */
-typedef npy_ulonglong __pyx_t_5numpy_ulonglong_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":721
- * ctypedef npy_ulonglong  ulonglong_t
- * 
- * ctypedef npy_intp       intp_t             # <<<<<<<<<<<<<<
- * ctypedef npy_uintp      uintp_t
- * 
- */
-typedef npy_intp __pyx_t_5numpy_intp_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":722
- * 
- * ctypedef npy_intp       intp_t
- * ctypedef npy_uintp      uintp_t             # <<<<<<<<<<<<<<
- * 
- * ctypedef npy_double     float_t
- */
-typedef npy_uintp __pyx_t_5numpy_uintp_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":724
- * ctypedef npy_uintp      uintp_t
- * 
- * ctypedef npy_double     float_t             # <<<<<<<<<<<<<<
- * ctypedef npy_double     double_t
- * ctypedef npy_longdouble longdouble_t
- */
-typedef npy_double __pyx_t_5numpy_float_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":725
- * 
- * ctypedef npy_double     float_t
- * ctypedef npy_double     double_t             # <<<<<<<<<<<<<<
- * ctypedef npy_longdouble longdouble_t
- * 
- */
-typedef npy_double __pyx_t_5numpy_double_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":726
- * ctypedef npy_double     float_t
- * ctypedef npy_double     double_t
- * ctypedef npy_longdouble longdouble_t             # <<<<<<<<<<<<<<
- * 
- * ctypedef npy_cfloat      cfloat_t
- */
-typedef npy_longdouble __pyx_t_5numpy_longdouble_t;
-/* Declarations.proto */
-#if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    typedef ::std::complex< float > __pyx_t_float_complex;
-  #else
-    typedef float _Complex __pyx_t_float_complex;
-  #endif
-#else
-    typedef struct { float real, imag; } __pyx_t_float_complex;
-#endif
-static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float, float);
-
-/* Declarations.proto */
-#if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    typedef ::std::complex< double > __pyx_t_double_complex;
-  #else
-    typedef double _Complex __pyx_t_double_complex;
-  #endif
-#else
-    typedef struct { double real, imag; } __pyx_t_double_complex;
-#endif
-static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double, double);
-
-
 /*--- Type declarations ---*/
 struct __pyx_array_obj;
 struct __pyx_MemviewEnum_obj;
 struct __pyx_memoryview_obj;
 struct __pyx_memoryviewslice_obj;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":728
- * ctypedef npy_longdouble longdouble_t
- * 
- * ctypedef npy_cfloat      cfloat_t             # <<<<<<<<<<<<<<
- * ctypedef npy_cdouble     cdouble_t
- * ctypedef npy_clongdouble clongdouble_t
- */
-typedef npy_cfloat __pyx_t_5numpy_cfloat_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":729
- * 
- * ctypedef npy_cfloat      cfloat_t
- * ctypedef npy_cdouble     cdouble_t             # <<<<<<<<<<<<<<
- * ctypedef npy_clongdouble clongdouble_t
- * 
- */
-typedef npy_cdouble __pyx_t_5numpy_cdouble_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":730
- * ctypedef npy_cfloat      cfloat_t
- * ctypedef npy_cdouble     cdouble_t
- * ctypedef npy_clongdouble clongdouble_t             # <<<<<<<<<<<<<<
- * 
- * ctypedef npy_cdouble     complex_t
- */
-typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":732
- * ctypedef npy_clongdouble clongdouble_t
- * 
- * ctypedef npy_cdouble     complex_t             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew1(a):
- */
-typedef npy_cdouble __pyx_t_5numpy_complex_t;
 struct __pyx_opt_args_7libreco_10algorithms_4_bpr_bpr_update;
 
-/* "libreco/algorithms/_bpr.pyx":35
- * @cython.wraparound(False)
+/* "libreco/algorithms/_bpr.pyx":31
  * @cython.cdivision(True)
- * cpdef bpr_update(optimizer, train_data, user_embed, item_embed, lr, reg,             # <<<<<<<<<<<<<<
- *                  n_users, n_items, shuffle, num_threads, seed, epoch,
- *                  u_velocity=None, i_velocity=None, momentum=0.9,
+ * cpdef bpr_update(
+ *     optimizer,             # <<<<<<<<<<<<<<
+ *     user_indices,
+ *     item_indices,
  */
 struct __pyx_opt_args_7libreco_10algorithms_4_bpr_bpr_update {
   int __pyx_n;
   PyObject *u_velocity;
   PyObject *i_velocity;
   PyObject *momentum;
   PyObject *u_1st_mom;
@@ -1623,145 +1336,23 @@
 #else
 #define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
 #endif
 
 /* GetBuiltinName.proto */
 static PyObject *__Pyx_GetBuiltinName(PyObject *name);
 
-/* PyDictVersioning.proto */
-#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
-#define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
-#define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
-#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
-    (version_var) = __PYX_GET_DICT_VERSION(dict);\
-    (cache_var) = (value);
-#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP) {\
-    static PY_UINT64_T __pyx_dict_version = 0;\
-    static PyObject *__pyx_dict_cached_value = NULL;\
-    if (likely(__PYX_GET_DICT_VERSION(DICT) == __pyx_dict_version)) {\
-        (VAR) = __pyx_dict_cached_value;\
-    } else {\
-        (VAR) = __pyx_dict_cached_value = (LOOKUP);\
-        __pyx_dict_version = __PYX_GET_DICT_VERSION(DICT);\
-    }\
-}
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj);
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj);
-static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version);
-#else
-#define __PYX_GET_DICT_VERSION(dict)  (0)
-#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
-#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
-#endif
-
-/* GetModuleGlobalName.proto */
-#if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  do {\
-    static PY_UINT64_T __pyx_dict_version = 0;\
-    static PyObject *__pyx_dict_cached_value = NULL;\
-    (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
-        (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
-        __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-} while(0)
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
-    PY_UINT64_T __pyx_dict_version;\
-    PyObject *__pyx_dict_cached_value;\
-    (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-} while(0)
-static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
-#else
-#define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
-static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
-#endif
-
-/* PyCFunctionFastCall.proto */
-#if CYTHON_FAST_PYCCALL
-static CYTHON_INLINE PyObject *__Pyx_PyCFunction_FastCall(PyObject *func, PyObject **args, Py_ssize_t nargs);
-#else
-#define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
-#endif
-
-/* PyFunctionFastCall.proto */
-#if CYTHON_FAST_PYCALL
-#define __Pyx_PyFunction_FastCall(func, args, nargs)\
-    __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
-#if 1 || PY_VERSION_HEX < 0x030600B1
-static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs);
-#else
-#define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
-#endif
-#define __Pyx_BUILD_ASSERT_EXPR(cond)\
-    (sizeof(char [1 - 2*!(cond)]) - 1)
-#ifndef Py_MEMBER_SIZE
-#define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
-#endif
-#if CYTHON_FAST_PYCALL
-  static size_t __pyx_pyframe_localsplus_offset = 0;
-  #include "frameobject.h"
-#if PY_VERSION_HEX >= 0x030b00a6
-  #ifndef Py_BUILD_CORE
-    #define Py_BUILD_CORE 1
-  #endif
-  #include "internal/pycore_frame.h"
-#endif
-  #define __Pxy_PyFrame_Initialize_Offsets()\
-    ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
-     (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
-  #define __Pyx_PyFrame_GetLocalsplus(frame)\
-    (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
-#endif // CYTHON_FAST_PYCALL
-#endif
-
-/* PyObjectCall.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
-#else
-#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
-#endif
-
-/* PyObjectCall2Args.proto */
-static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
-
-/* PyObjectCallMethO.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
-#endif
-
-/* PyObjectCallOneArg.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
-
-/* RaiseTooManyValuesToUnpack.proto */
-static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected);
-
-/* RaiseNeedMoreValuesToUnpack.proto */
-static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);
-
-/* IterFinish.proto */
-static CYTHON_INLINE int __Pyx_IterFinish(void);
-
-/* UnpackItemEndCheck.proto */
-static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected);
-
 /* IncludeStringH.proto */
 #include <string.h>
 
 /* BytesEquals.proto */
 static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);
 
 /* UnicodeEquals.proto */
 static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);
 
-/* StrEquals.proto */
-#if PY_MAJOR_VERSION >= 3
-#define __Pyx_PyString_Equals __Pyx_PyUnicode_Equals
-#else
-#define __Pyx_PyString_Equals __Pyx_PyBytes_Equals
-#endif
-
 /* MemviewSliceInit.proto */
 #define __Pyx_BUF_MAX_NDIMS %(BUF_MAX_NDIMS)d
 #define __Pyx_MEMVIEW_DIRECT   1
 #define __Pyx_MEMVIEW_PTR      2
 #define __Pyx_MEMVIEW_FULL     4
 #define __Pyx_MEMVIEW_CONTIG   8
 #define __Pyx_MEMVIEW_STRIDED  16
@@ -1833,54 +1424,85 @@
 #endif
 
 /* WriteUnraisableException.proto */
 static void __Pyx_WriteUnraisable(const char *name, int clineno,
                                   int lineno, const char *filename,
                                   int full_traceback, int nogil);
 
-/* GetTopmostException.proto */
-#if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
-#endif
+/* ArgTypeTest.proto */
+#define __Pyx_ArgTypeTest(obj, type, none_allowed, name, exact)\
+    ((likely((Py_TYPE(obj) == type) | (none_allowed && (obj == Py_None)))) ? 1 :\
+        __Pyx__ArgTypeTest(obj, type, name, exact))
+static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact);
 
-/* SaveResetException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
+/* PyObjectCall.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
 #else
-#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
-#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
+#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
 #endif
 
-/* PyErrExceptionMatches.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
+/* RaiseException.proto */
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
+
+/* PyCFunctionFastCall.proto */
+#if CYTHON_FAST_PYCCALL
+static CYTHON_INLINE PyObject *__Pyx_PyCFunction_FastCall(PyObject *func, PyObject **args, Py_ssize_t nargs);
 #else
-#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
+#define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
 #endif
 
-/* GetException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
-static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+/* PyFunctionFastCall.proto */
+#if CYTHON_FAST_PYCALL
+#define __Pyx_PyFunction_FastCall(func, args, nargs)\
+    __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
+#if 1 || PY_VERSION_HEX < 0x030600B1
+static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs);
 #else
-static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
+#define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
+#endif
+#define __Pyx_BUILD_ASSERT_EXPR(cond)\
+    (sizeof(char [1 - 2*!(cond)]) - 1)
+#ifndef Py_MEMBER_SIZE
+#define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
+#endif
+#if CYTHON_FAST_PYCALL
+  static size_t __pyx_pyframe_localsplus_offset = 0;
+  #include "frameobject.h"
+#if PY_VERSION_HEX >= 0x030b00a6
+  #ifndef Py_BUILD_CORE
+    #define Py_BUILD_CORE 1
+  #endif
+  #include "internal/pycore_frame.h"
+#endif
+  #define __Pxy_PyFrame_Initialize_Offsets()\
+    ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
+     (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
+  #define __Pyx_PyFrame_GetLocalsplus(frame)\
+    (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
+#endif // CYTHON_FAST_PYCALL
 #endif
 
-/* RaiseException.proto */
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
+/* PyObjectCall2Args.proto */
+static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
 
-/* ArgTypeTest.proto */
-#define __Pyx_ArgTypeTest(obj, type, none_allowed, name, exact)\
-    ((likely((Py_TYPE(obj) == type) | (none_allowed && (obj == Py_None)))) ? 1 :\
-        __Pyx__ArgTypeTest(obj, type, name, exact))
-static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact);
+/* PyObjectCallMethO.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
+#endif
+
+/* PyObjectCallOneArg.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
+
+/* StrEquals.proto */
+#if PY_MAJOR_VERSION >= 3
+#define __Pyx_PyString_Equals __Pyx_PyUnicode_Equals
+#else
+#define __Pyx_PyString_Equals __Pyx_PyBytes_Equals
+#endif
 
 /* DivInt[Py_ssize_t].proto */
 static CYTHON_INLINE Py_ssize_t __Pyx_div_Py_ssize_t(Py_ssize_t, Py_ssize_t);
 
 /* UnaryNegOverflows.proto */
 #define UNARY_NEG_WOULD_OVERFLOW(x)\
         (((x) < 0) & ((unsigned long)(x) == 0-(unsigned long)(x)))
@@ -1935,23 +1557,108 @@
 
 /* decode_c_string.proto */
 static CYTHON_INLINE PyObject* __Pyx_decode_c_string(
          const char* cstring, Py_ssize_t start, Py_ssize_t stop,
          const char* encoding, const char* errors,
          PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors));
 
+/* PyErrExceptionMatches.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
+#else
+#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
+#endif
+
 /* GetAttr3.proto */
 static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *, PyObject *, PyObject *);
 
+/* PyDictVersioning.proto */
+#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
+#define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
+#define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
+#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
+    (version_var) = __PYX_GET_DICT_VERSION(dict);\
+    (cache_var) = (value);
+#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP) {\
+    static PY_UINT64_T __pyx_dict_version = 0;\
+    static PyObject *__pyx_dict_cached_value = NULL;\
+    if (likely(__PYX_GET_DICT_VERSION(DICT) == __pyx_dict_version)) {\
+        (VAR) = __pyx_dict_cached_value;\
+    } else {\
+        (VAR) = __pyx_dict_cached_value = (LOOKUP);\
+        __pyx_dict_version = __PYX_GET_DICT_VERSION(DICT);\
+    }\
+}
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj);
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj);
+static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version);
+#else
+#define __PYX_GET_DICT_VERSION(dict)  (0)
+#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
+#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
+#endif
+
+/* GetModuleGlobalName.proto */
+#if CYTHON_USE_DICT_VERSIONS
+#define __Pyx_GetModuleGlobalName(var, name)  do {\
+    static PY_UINT64_T __pyx_dict_version = 0;\
+    static PyObject *__pyx_dict_cached_value = NULL;\
+    (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
+        (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
+        __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
+} while(0)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
+    PY_UINT64_T __pyx_dict_version;\
+    PyObject *__pyx_dict_cached_value;\
+    (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
+} while(0)
+static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
+#else
+#define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
+static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
+#endif
+
+/* RaiseTooManyValuesToUnpack.proto */
+static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected);
+
+/* RaiseNeedMoreValuesToUnpack.proto */
+static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);
+
 /* RaiseNoneIterError.proto */
 static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void);
 
 /* ExtTypeTest.proto */
 static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type);
 
+/* GetTopmostException.proto */
+#if CYTHON_USE_EXC_INFO_STACK
+static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
+#endif
+
+/* SaveResetException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
+#else
+#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
+#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
+#endif
+
+/* GetException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
+static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#else
+static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
+#endif
+
 /* SwapException.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_ExceptionSwap(type, value, tb)  __Pyx__ExceptionSwap(__pyx_tstate, type, value, tb)
 static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
 #else
 static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb);
 #endif
@@ -2065,33 +1772,14 @@
 
 /* PyObjectGetAttrStrNoError.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
-/* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto
-#define __PYX_HAVE_RT_ImportType_proto
-#if __STDC_VERSION__ >= 201112L
-#include <stdalign.h>
-#endif
-#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
-#define __PYX_GET_STRUCT_ALIGNMENT(s) alignof(s)
-#else
-#define __PYX_GET_STRUCT_ALIGNMENT(s) sizeof(void*)
-#endif
-enum __Pyx_ImportType_CheckSize {
-   __Pyx_ImportType_CheckSize_Error = 0,
-   __Pyx_ImportType_CheckSize_Warn = 1,
-   __Pyx_ImportType_CheckSize_Ignore = 2
-};
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size);
-#endif
-
 /* CLineInTraceback.proto */
 #ifdef CYTHON_CLINE_IN_TRACEBACK
 #define __Pyx_CLineForTraceback(tstate, c_line)  (((CYTHON_CLINE_IN_TRACEBACK)) ? c_line : 0)
 #else
 static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line);
 #endif
 
@@ -2223,112 +1911,14 @@
   catch (...)
   {
     PyErr_SetString(PyExc_RuntimeError, "Unknown exception");
   }
 }
 #endif
 
-/* RealImag.proto */
-#if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    #define __Pyx_CREAL(z) ((z).real())
-    #define __Pyx_CIMAG(z) ((z).imag())
-  #else
-    #define __Pyx_CREAL(z) (__real__(z))
-    #define __Pyx_CIMAG(z) (__imag__(z))
-  #endif
-#else
-    #define __Pyx_CREAL(z) ((z).real)
-    #define __Pyx_CIMAG(z) ((z).imag)
-#endif
-#if defined(__cplusplus) && CYTHON_CCOMPLEX\
-        && (defined(_WIN32) || defined(__clang__) || (defined(__GNUC__) && (__GNUC__ >= 5 || __GNUC__ == 4 && __GNUC_MINOR__ >= 4 )) || __cplusplus >= 201103)
-    #define __Pyx_SET_CREAL(z,x) ((z).real(x))
-    #define __Pyx_SET_CIMAG(z,y) ((z).imag(y))
-#else
-    #define __Pyx_SET_CREAL(z,x) __Pyx_CREAL(z) = (x)
-    #define __Pyx_SET_CIMAG(z,y) __Pyx_CIMAG(z) = (y)
-#endif
-
-/* Arithmetic.proto */
-#if CYTHON_CCOMPLEX
-    #define __Pyx_c_eq_float(a, b)   ((a)==(b))
-    #define __Pyx_c_sum_float(a, b)  ((a)+(b))
-    #define __Pyx_c_diff_float(a, b) ((a)-(b))
-    #define __Pyx_c_prod_float(a, b) ((a)*(b))
-    #define __Pyx_c_quot_float(a, b) ((a)/(b))
-    #define __Pyx_c_neg_float(a)     (-(a))
-  #ifdef __cplusplus
-    #define __Pyx_c_is_zero_float(z) ((z)==(float)0)
-    #define __Pyx_c_conj_float(z)    (::std::conj(z))
-    #if 1
-        #define __Pyx_c_abs_float(z)     (::std::abs(z))
-        #define __Pyx_c_pow_float(a, b)  (::std::pow(a, b))
-    #endif
-  #else
-    #define __Pyx_c_is_zero_float(z) ((z)==0)
-    #define __Pyx_c_conj_float(z)    (conjf(z))
-    #if 1
-        #define __Pyx_c_abs_float(z)     (cabsf(z))
-        #define __Pyx_c_pow_float(a, b)  (cpowf(a, b))
-    #endif
- #endif
-#else
-    static CYTHON_INLINE int __Pyx_c_eq_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_sum_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_diff_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_prod_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_quot_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_neg_float(__pyx_t_float_complex);
-    static CYTHON_INLINE int __Pyx_c_is_zero_float(__pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_conj_float(__pyx_t_float_complex);
-    #if 1
-        static CYTHON_INLINE float __Pyx_c_abs_float(__pyx_t_float_complex);
-        static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_pow_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    #endif
-#endif
-
-/* Arithmetic.proto */
-#if CYTHON_CCOMPLEX
-    #define __Pyx_c_eq_double(a, b)   ((a)==(b))
-    #define __Pyx_c_sum_double(a, b)  ((a)+(b))
-    #define __Pyx_c_diff_double(a, b) ((a)-(b))
-    #define __Pyx_c_prod_double(a, b) ((a)*(b))
-    #define __Pyx_c_quot_double(a, b) ((a)/(b))
-    #define __Pyx_c_neg_double(a)     (-(a))
-  #ifdef __cplusplus
-    #define __Pyx_c_is_zero_double(z) ((z)==(double)0)
-    #define __Pyx_c_conj_double(z)    (::std::conj(z))
-    #if 1
-        #define __Pyx_c_abs_double(z)     (::std::abs(z))
-        #define __Pyx_c_pow_double(a, b)  (::std::pow(a, b))
-    #endif
-  #else
-    #define __Pyx_c_is_zero_double(z) ((z)==0)
-    #define __Pyx_c_conj_double(z)    (conj(z))
-    #if 1
-        #define __Pyx_c_abs_double(z)     (cabs(z))
-        #define __Pyx_c_pow_double(a, b)  (cpow(a, b))
-    #endif
- #endif
-#else
-    static CYTHON_INLINE int __Pyx_c_eq_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_sum_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_diff_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_prod_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_quot_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_neg_double(__pyx_t_double_complex);
-    static CYTHON_INLINE int __Pyx_c_is_zero_double(__pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_conj_double(__pyx_t_double_complex);
-    #if 1
-        static CYTHON_INLINE double __Pyx_c_abs_double(__pyx_t_double_complex);
-        static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_pow_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    #endif
-#endif
-
 /* MemviewSliceCopyTemplate.proto */
 static __Pyx_memviewslice
 __pyx_memoryview_copy_new_contig(const __Pyx_memviewslice *from_mvs,
                                  const char *mode, int ndim,
                                  size_t sizeof_dtype, int contig_flag,
                                  int dtype_is_object);
 
@@ -2360,52 +1950,14 @@
 static PyObject *__pyx_memoryview_setitem_slice_assign_scalar(struct __pyx_memoryview_obj *__pyx_v_self, struct __pyx_memoryview_obj *__pyx_v_dst, PyObject *__pyx_v_value); /* proto*/
 static PyObject *__pyx_memoryview_setitem_indexed(struct __pyx_memoryview_obj *__pyx_v_self, PyObject *__pyx_v_index, PyObject *__pyx_v_value); /* proto*/
 static PyObject *__pyx_memoryview_convert_item_to_object(struct __pyx_memoryview_obj *__pyx_v_self, char *__pyx_v_itemp); /* proto*/
 static PyObject *__pyx_memoryview_assign_item_from_object(struct __pyx_memoryview_obj *__pyx_v_self, char *__pyx_v_itemp, PyObject *__pyx_v_value); /* proto*/
 static PyObject *__pyx_memoryviewslice_convert_item_to_object(struct __pyx_memoryviewslice_obj *__pyx_v_self, char *__pyx_v_itemp); /* proto*/
 static PyObject *__pyx_memoryviewslice_assign_item_from_object(struct __pyx_memoryviewslice_obj *__pyx_v_self, char *__pyx_v_itemp, PyObject *__pyx_v_value); /* proto*/
 
-/* Module declarations from 'cpython.buffer' */
-
-/* Module declarations from 'libc.string' */
-
-/* Module declarations from 'libc.stdio' */
-
-/* Module declarations from '__builtin__' */
-
-/* Module declarations from 'cpython.type' */
-static PyTypeObject *__pyx_ptype_7cpython_4type_type = 0;
-
-/* Module declarations from 'cpython' */
-
-/* Module declarations from 'cpython.object' */
-
-/* Module declarations from 'cpython.ref' */
-
-/* Module declarations from 'cpython.mem' */
-
-/* Module declarations from 'numpy' */
-
-/* Module declarations from 'numpy' */
-static PyTypeObject *__pyx_ptype_5numpy_dtype = 0;
-static PyTypeObject *__pyx_ptype_5numpy_flatiter = 0;
-static PyTypeObject *__pyx_ptype_5numpy_broadcast = 0;
-static PyTypeObject *__pyx_ptype_5numpy_ndarray = 0;
-static PyTypeObject *__pyx_ptype_5numpy_generic = 0;
-static PyTypeObject *__pyx_ptype_5numpy_number = 0;
-static PyTypeObject *__pyx_ptype_5numpy_integer = 0;
-static PyTypeObject *__pyx_ptype_5numpy_signedinteger = 0;
-static PyTypeObject *__pyx_ptype_5numpy_unsignedinteger = 0;
-static PyTypeObject *__pyx_ptype_5numpy_inexact = 0;
-static PyTypeObject *__pyx_ptype_5numpy_floating = 0;
-static PyTypeObject *__pyx_ptype_5numpy_complexfloating = 0;
-static PyTypeObject *__pyx_ptype_5numpy_flexible = 0;
-static PyTypeObject *__pyx_ptype_5numpy_character = 0;
-static PyTypeObject *__pyx_ptype_5numpy_ufunc = 0;
-
 /* Module declarations from 'cython.view' */
 
 /* Module declarations from 'cython' */
 
 /* Module declarations from 'libc.math' */
 
 /* Module declarations from 'libcpp' */
@@ -2423,15 +1975,15 @@
 static PyObject *strided = 0;
 static PyObject *indirect = 0;
 static PyObject *contiguous = 0;
 static PyObject *indirect_contiguous = 0;
 static int __pyx_memoryview_thread_locks_used;
 static PyThread_type_lock __pyx_memoryview_thread_locks[8];
 static bool __pyx_f_7libreco_10algorithms_4_bpr_check_consumed(__Pyx_memviewslice, __Pyx_memviewslice, int, int); /*proto*/
-static PyObject *__pyx_f_7libreco_10algorithms_4_bpr_bpr_update(PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_7libreco_10algorithms_4_bpr_bpr_update *__pyx_optional_args); /*proto*/
+static PyObject *__pyx_f_7libreco_10algorithms_4_bpr_bpr_update(PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_7libreco_10algorithms_4_bpr_bpr_update *__pyx_optional_args); /*proto*/
 static void __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_sgd(__Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, double, double, int, int, int, int); /*proto*/
 static void __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_momentum(__Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, double, double, int, int, __Pyx_memviewslice, __Pyx_memviewslice, double, int, int); /*proto*/
 static void __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_adam(__Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, double, double, int, int, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, __Pyx_memviewslice, double, double, int, int, int); /*proto*/
 static struct __pyx_array_obj *__pyx_array_new(PyObject *, Py_ssize_t, char *, char *, char *); /*proto*/
 static void *__pyx_align_pointer(void *, size_t); /*proto*/
 static PyObject *__pyx_memoryview_new(PyObject *, int, int, __Pyx_TypeInfo *); /*proto*/
 static CYTHON_INLINE int __pyx_memoryview_check(PyObject *); /*proto*/
@@ -2468,27 +2020,25 @@
 static __Pyx_TypeInfo __Pyx_TypeInfo_float = { "float", NULL, sizeof(float), { 0 }, 0, 'R', 0, 0 };
 #define __Pyx_MODULE_NAME "libreco.algorithms._bpr"
 extern int __pyx_module_is_main_libreco__algorithms___bpr;
 int __pyx_module_is_main_libreco__algorithms___bpr = 0;
 
 /* Implementation of 'libreco.algorithms._bpr' */
 static PyObject *__pyx_builtin_range;
-static PyObject *__pyx_builtin_ImportError;
 static PyObject *__pyx_builtin_ValueError;
 static PyObject *__pyx_builtin_MemoryError;
 static PyObject *__pyx_builtin_enumerate;
 static PyObject *__pyx_builtin_TypeError;
 static PyObject *__pyx_builtin_Ellipsis;
 static PyObject *__pyx_builtin_id;
 static PyObject *__pyx_builtin_IndexError;
 static const char __pyx_k_O[] = "O";
 static const char __pyx_k_c[] = "c";
 static const char __pyx_k_id[] = "id";
 static const char __pyx_k_lr[] = "lr";
-static const char __pyx_k_np[] = "np";
 static const char __pyx_k_new[] = "__new__";
 static const char __pyx_k_obj[] = "obj";
 static const char __pyx_k_reg[] = "reg";
 static const char __pyx_k_sgd[] = "sgd";
 static const char __pyx_k_adam[] = "adam";
 static const char __pyx_k_base[] = "base";
 static const char __pyx_k_dict[] = "__dict__";
@@ -2505,20 +2055,17 @@
 static const char __pyx_k_stop[] = "stop";
 static const char __pyx_k_test[] = "__test__";
 static const char __pyx_k_ASCII[] = "ASCII";
 static const char __pyx_k_class[] = "__class__";
 static const char __pyx_k_epoch[] = "epoch";
 static const char __pyx_k_error[] = "error";
 static const char __pyx_k_flags[] = "flags";
-static const char __pyx_k_int32[] = "int32";
-static const char __pyx_k_numpy[] = "numpy";
 static const char __pyx_k_range[] = "range";
 static const char __pyx_k_shape[] = "shape";
 static const char __pyx_k_start[] = "start";
-static const char __pyx_k_astype[] = "astype";
 static const char __pyx_k_encode[] = "encode";
 static const char __pyx_k_format[] = "format";
 static const char __pyx_k_import[] = "__import__";
 static const char __pyx_k_indptr[] = "indptr";
 static const char __pyx_k_name_2[] = "__name__";
 static const char __pyx_k_pickle[] = "pickle";
 static const char __pyx_k_reduce[] = "__reduce__";
@@ -2526,15 +2073,14 @@
 static const char __pyx_k_unpack[] = "unpack";
 static const char __pyx_k_update[] = "update";
 static const char __pyx_k_fortran[] = "fortran";
 static const char __pyx_k_indices[] = "indices";
 static const char __pyx_k_memview[] = "memview";
 static const char __pyx_k_n_items[] = "n_items";
 static const char __pyx_k_n_users[] = "n_users";
-static const char __pyx_k_shuffle[] = "shuffle";
 static const char __pyx_k_Ellipsis[] = "Ellipsis";
 static const char __pyx_k_getstate[] = "__getstate__";
 static const char __pyx_k_itemsize[] = "itemsize";
 static const char __pyx_k_momentum[] = "momentum";
 static const char __pyx_k_pyx_type[] = "__pyx_type";
 static const char __pyx_k_setstate[] = "__setstate__";
 static const char __pyx_k_TypeError[] = "TypeError";
@@ -2548,75 +2094,65 @@
 static const char __pyx_k_u_2nd_mom[] = "u_2nd_mom";
 static const char __pyx_k_IndexError[] = "IndexError";
 static const char __pyx_k_ValueError[] = "ValueError";
 static const char __pyx_k_i_velocity[] = "i_velocity";
 static const char __pyx_k_item_embed[] = "item_embed";
 static const char __pyx_k_pyx_result[] = "__pyx_result";
 static const char __pyx_k_pyx_vtable[] = "__pyx_vtable__";
-static const char __pyx_k_train_data[] = "train_data";
 static const char __pyx_k_u_velocity[] = "u_velocity";
 static const char __pyx_k_user_embed[] = "user_embed";
-static const char __pyx_k_utils_misc[] = "utils.misc";
-static const char __pyx_k_ImportError[] = "ImportError";
 static const char __pyx_k_MemoryError[] = "MemoryError";
 static const char __pyx_k_PickleError[] = "PickleError";
-static const char __pyx_k_has_sampled[] = "has_sampled";
 static const char __pyx_k_num_threads[] = "num_threads";
 static const char __pyx_k_item_indices[] = "item_indices";
 static const char __pyx_k_pyx_checksum[] = "__pyx_checksum";
-static const char __pyx_k_shuffle_data[] = "shuffle_data";
 static const char __pyx_k_stringsource[] = "stringsource";
 static const char __pyx_k_user_indices[] = "user_indices";
 static const char __pyx_k_pyx_getbuffer[] = "__pyx_getbuffer";
 static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
 static const char __pyx_k_View_MemoryView[] = "View.MemoryView";
 static const char __pyx_k_allocate_buffer[] = "allocate_buffer";
 static const char __pyx_k_dtype_is_object[] = "dtype_is_object";
 static const char __pyx_k_pyx_PickleError[] = "__pyx_PickleError";
 static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
-static const char __pyx_k_item_indices_orig[] = "item_indices_orig";
 static const char __pyx_k_pyx_unpickle_Enum[] = "__pyx_unpickle_Enum";
-static const char __pyx_k_user_indices_orig[] = "user_indices_orig";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_sparse_interaction[] = "sparse_interaction";
 static const char __pyx_k_strided_and_direct[] = "<strided and direct>";
 static const char __pyx_k_strided_and_indirect[] = "<strided and indirect>";
 static const char __pyx_k_contiguous_and_direct[] = "<contiguous and direct>";
 static const char __pyx_k_MemoryView_of_r_object[] = "<MemoryView of %r object>";
 static const char __pyx_k_MemoryView_of_r_at_0x_x[] = "<MemoryView of %r at 0x%x>";
 static const char __pyx_k_contiguous_and_indirect[] = "<contiguous and indirect>";
 static const char __pyx_k_Cannot_index_with_type_s[] = "Cannot index with type '%s'";
 static const char __pyx_k_Invalid_shape_in_axis_d_d[] = "Invalid shape in axis %d: %d.";
 static const char __pyx_k_itemsize_0_for_cython_array[] = "itemsize <= 0 for cython.array";
 static const char __pyx_k_unable_to_allocate_array_data[] = "unable to allocate array data.";
 static const char __pyx_k_strided_and_direct_or_indirect[] = "<strided and direct or indirect>";
-static const char __pyx_k_numpy_core_multiarray_failed_to[] = "numpy.core.multiarray failed to import";
 static const char __pyx_k_Buffer_view_does_not_expose_stri[] = "Buffer view does not expose strides";
 static const char __pyx_k_Can_only_create_a_buffer_that_is[] = "Can only create a buffer that is contiguous in memory.";
 static const char __pyx_k_Cannot_assign_to_read_only_memor[] = "Cannot assign to read-only memoryview";
 static const char __pyx_k_Cannot_create_writable_memory_vi[] = "Cannot create writable memory view from read-only memoryview";
 static const char __pyx_k_Empty_shape_tuple_for_cython_arr[] = "Empty shape tuple for cython.array";
 static const char __pyx_k_Incompatible_checksums_0x_x_vs_0[] = "Incompatible checksums (0x%x vs (0xb068931, 0x82a3537, 0x6ae9995) = (name))";
 static const char __pyx_k_Indirect_dimensions_not_supporte[] = "Indirect dimensions not supported";
 static const char __pyx_k_Invalid_mode_expected_c_or_fortr[] = "Invalid mode, expected 'c' or 'fortran', got %s";
 static const char __pyx_k_Out_of_bounds_on_buffer_access_a[] = "Out of bounds on buffer access (axis %d)";
 static const char __pyx_k_Unable_to_convert_item_to_object[] = "Unable to convert item to object";
 static const char __pyx_k_got_differing_extents_in_dimensi[] = "got differing extents in dimension %d (got %d and %d)";
 static const char __pyx_k_no_default___reduce___due_to_non[] = "no default __reduce__ due to non-trivial __cinit__";
-static const char __pyx_k_numpy_core_umath_failed_to_impor[] = "numpy.core.umath failed to import";
 static const char __pyx_k_unable_to_allocate_shape_and_str[] = "unable to allocate shape and strides.";
 static PyObject *__pyx_n_s_ASCII;
 static PyObject *__pyx_kp_s_Buffer_view_does_not_expose_stri;
 static PyObject *__pyx_kp_s_Can_only_create_a_buffer_that_is;
 static PyObject *__pyx_kp_s_Cannot_assign_to_read_only_memor;
 static PyObject *__pyx_kp_s_Cannot_create_writable_memory_vi;
 static PyObject *__pyx_kp_s_Cannot_index_with_type_s;
 static PyObject *__pyx_n_s_Ellipsis;
 static PyObject *__pyx_kp_s_Empty_shape_tuple_for_cython_arr;
-static PyObject *__pyx_n_s_ImportError;
 static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0;
 static PyObject *__pyx_n_s_IndexError;
 static PyObject *__pyx_kp_s_Indirect_dimensions_not_supporte;
 static PyObject *__pyx_kp_s_Invalid_mode_expected_c_or_fortr;
 static PyObject *__pyx_kp_s_Invalid_shape_in_axis_d_d;
 static PyObject *__pyx_n_s_MemoryError;
 static PyObject *__pyx_kp_s_MemoryView_of_r_at_0x_x;
@@ -2624,17 +2160,16 @@
 static PyObject *__pyx_n_b_O;
 static PyObject *__pyx_kp_s_Out_of_bounds_on_buffer_access_a;
 static PyObject *__pyx_n_s_PickleError;
 static PyObject *__pyx_n_s_TypeError;
 static PyObject *__pyx_kp_s_Unable_to_convert_item_to_object;
 static PyObject *__pyx_n_s_ValueError;
 static PyObject *__pyx_n_s_View_MemoryView;
-static PyObject *__pyx_n_s_adam;
+static PyObject *__pyx_n_u_adam;
 static PyObject *__pyx_n_s_allocate_buffer;
-static PyObject *__pyx_n_s_astype;
 static PyObject *__pyx_n_s_base;
 static PyObject *__pyx_n_s_c;
 static PyObject *__pyx_n_u_c;
 static PyObject *__pyx_n_s_class;
 static PyObject *__pyx_n_s_cline_in_traceback;
 static PyObject *__pyx_kp_s_contiguous_and_direct;
 static PyObject *__pyx_kp_s_contiguous_and_indirect;
@@ -2646,45 +2181,39 @@
 static PyObject *__pyx_n_s_error;
 static PyObject *__pyx_n_s_flags;
 static PyObject *__pyx_n_s_format;
 static PyObject *__pyx_n_s_fortran;
 static PyObject *__pyx_n_u_fortran;
 static PyObject *__pyx_n_s_getstate;
 static PyObject *__pyx_kp_s_got_differing_extents_in_dimensi;
-static PyObject *__pyx_n_s_has_sampled;
 static PyObject *__pyx_n_s_i_1st_mom;
 static PyObject *__pyx_n_s_i_2nd_mom;
 static PyObject *__pyx_n_s_i_velocity;
 static PyObject *__pyx_n_s_id;
 static PyObject *__pyx_n_s_import;
 static PyObject *__pyx_n_s_indices;
 static PyObject *__pyx_n_s_indptr;
-static PyObject *__pyx_n_s_int32;
 static PyObject *__pyx_n_s_item_embed;
 static PyObject *__pyx_n_s_item_indices;
-static PyObject *__pyx_n_s_item_indices_orig;
 static PyObject *__pyx_n_s_itemsize;
 static PyObject *__pyx_kp_s_itemsize_0_for_cython_array;
 static PyObject *__pyx_n_s_lr;
 static PyObject *__pyx_n_s_main;
 static PyObject *__pyx_n_s_memview;
 static PyObject *__pyx_n_s_mode;
 static PyObject *__pyx_n_s_momentum;
+static PyObject *__pyx_n_u_momentum;
 static PyObject *__pyx_n_s_n_items;
 static PyObject *__pyx_n_s_n_users;
 static PyObject *__pyx_n_s_name;
 static PyObject *__pyx_n_s_name_2;
 static PyObject *__pyx_n_s_ndim;
 static PyObject *__pyx_n_s_new;
 static PyObject *__pyx_kp_s_no_default___reduce___due_to_non;
-static PyObject *__pyx_n_s_np;
 static PyObject *__pyx_n_s_num_threads;
-static PyObject *__pyx_n_s_numpy;
-static PyObject *__pyx_kp_s_numpy_core_multiarray_failed_to;
-static PyObject *__pyx_kp_s_numpy_core_umath_failed_to_impor;
 static PyObject *__pyx_n_s_obj;
 static PyObject *__pyx_n_s_optimizer;
 static PyObject *__pyx_n_s_pack;
 static PyObject *__pyx_n_s_pickle;
 static PyObject *__pyx_n_s_pyx_PickleError;
 static PyObject *__pyx_n_s_pyx_checksum;
 static PyObject *__pyx_n_s_pyx_getbuffer;
@@ -2699,42 +2228,37 @@
 static PyObject *__pyx_n_s_reduce_ex;
 static PyObject *__pyx_n_s_reg;
 static PyObject *__pyx_n_s_rho1;
 static PyObject *__pyx_n_s_rho2;
 static PyObject *__pyx_n_s_seed;
 static PyObject *__pyx_n_s_setstate;
 static PyObject *__pyx_n_s_setstate_cython;
-static PyObject *__pyx_n_s_sgd;
+static PyObject *__pyx_n_u_sgd;
 static PyObject *__pyx_n_s_shape;
-static PyObject *__pyx_n_s_shuffle;
-static PyObject *__pyx_n_s_shuffle_data;
 static PyObject *__pyx_n_s_size;
 static PyObject *__pyx_n_s_sparse_interaction;
 static PyObject *__pyx_n_s_start;
 static PyObject *__pyx_n_s_step;
 static PyObject *__pyx_n_s_stop;
 static PyObject *__pyx_kp_s_strided_and_direct;
 static PyObject *__pyx_kp_s_strided_and_direct_or_indirect;
 static PyObject *__pyx_kp_s_strided_and_indirect;
 static PyObject *__pyx_kp_s_stringsource;
 static PyObject *__pyx_n_s_struct;
 static PyObject *__pyx_n_s_test;
-static PyObject *__pyx_n_s_train_data;
 static PyObject *__pyx_n_s_u_1st_mom;
 static PyObject *__pyx_n_s_u_2nd_mom;
 static PyObject *__pyx_n_s_u_velocity;
 static PyObject *__pyx_kp_s_unable_to_allocate_array_data;
 static PyObject *__pyx_kp_s_unable_to_allocate_shape_and_str;
 static PyObject *__pyx_n_s_unpack;
 static PyObject *__pyx_n_s_update;
 static PyObject *__pyx_n_s_user_embed;
 static PyObject *__pyx_n_s_user_indices;
-static PyObject *__pyx_n_s_user_indices_orig;
-static PyObject *__pyx_n_s_utils_misc;
-static PyObject *__pyx_pf_7libreco_10algorithms_4_bpr_bpr_update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_optimizer, PyObject *__pyx_v_train_data, PyObject *__pyx_v_user_embed, PyObject *__pyx_v_item_embed, PyObject *__pyx_v_lr, PyObject *__pyx_v_reg, PyObject *__pyx_v_n_users, PyObject *__pyx_v_n_items, PyObject *__pyx_v_shuffle, PyObject *__pyx_v_num_threads, PyObject *__pyx_v_seed, PyObject *__pyx_v_epoch, PyObject *__pyx_v_u_velocity, PyObject *__pyx_v_i_velocity, PyObject *__pyx_v_momentum, PyObject *__pyx_v_u_1st_mom, PyObject *__pyx_v_i_1st_mom, PyObject *__pyx_v_u_2nd_mom, PyObject *__pyx_v_i_2nd_mom, PyObject *__pyx_v_rho1, PyObject *__pyx_v_rho2); /* proto */
+static PyObject *__pyx_pf_7libreco_10algorithms_4_bpr_bpr_update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_optimizer, PyObject *__pyx_v_user_indices, PyObject *__pyx_v_item_indices, PyObject *__pyx_v_sparse_interaction, PyObject *__pyx_v_user_embed, PyObject *__pyx_v_item_embed, PyObject *__pyx_v_lr, PyObject *__pyx_v_reg, PyObject *__pyx_v_n_users, PyObject *__pyx_v_n_items, PyObject *__pyx_v_num_threads, PyObject *__pyx_v_seed, PyObject *__pyx_v_epoch, PyObject *__pyx_v_u_velocity, PyObject *__pyx_v_i_velocity, PyObject *__pyx_v_momentum, PyObject *__pyx_v_u_1st_mom, PyObject *__pyx_v_i_1st_mom, PyObject *__pyx_v_u_2nd_mom, PyObject *__pyx_v_i_2nd_mom, PyObject *__pyx_v_rho1, PyObject *__pyx_v_rho2); /* proto */
 static int __pyx_array___pyx_pf_15View_dot_MemoryView_5array___cinit__(struct __pyx_array_obj *__pyx_v_self, PyObject *__pyx_v_shape, Py_ssize_t __pyx_v_itemsize, PyObject *__pyx_v_format, PyObject *__pyx_v_mode, int __pyx_v_allocate_buffer); /* proto */
 static int __pyx_array___pyx_pf_15View_dot_MemoryView_5array_2__getbuffer__(struct __pyx_array_obj *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags); /* proto */
 static void __pyx_array___pyx_pf_15View_dot_MemoryView_5array_4__dealloc__(struct __pyx_array_obj *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_15View_dot_MemoryView_5array_7memview___get__(struct __pyx_array_obj *__pyx_v_self); /* proto */
 static Py_ssize_t __pyx_array___pyx_pf_15View_dot_MemoryView_5array_6__len__(struct __pyx_array_obj *__pyx_v_self); /* proto */
 static PyObject *__pyx_array___pyx_pf_15View_dot_MemoryView_5array_8__getattr__(struct __pyx_array_obj *__pyx_v_self, PyObject *__pyx_v_attr); /* proto */
 static PyObject *__pyx_array___pyx_pf_15View_dot_MemoryView_5array_10__getitem__(struct __pyx_array_obj *__pyx_v_self, PyObject *__pyx_v_item); /* proto */
@@ -2773,15 +2297,14 @@
 static PyObject *__pyx_pf___pyx_memoryviewslice___reduce_cython__(CYTHON_UNUSED struct __pyx_memoryviewslice_obj *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf___pyx_memoryviewslice_2__setstate_cython__(CYTHON_UNUSED struct __pyx_memoryviewslice_obj *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state); /* proto */
 static PyObject *__pyx_pf_15View_dot_MemoryView___pyx_unpickle_Enum(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
 static PyObject *__pyx_tp_new_array(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_float_0_0;
 static PyObject *__pyx_float_0_9;
 static PyObject *__pyx_float_0_999;
 static PyObject *__pyx_int_0;
 static PyObject *__pyx_int_1;
 static PyObject *__pyx_int_112105877;
 static PyObject *__pyx_int_136983863;
 static PyObject *__pyx_int_184977713;
@@ -2791,179 +2314,175 @@
 static PyObject *__pyx_tuple__3;
 static PyObject *__pyx_tuple__4;
 static PyObject *__pyx_tuple__5;
 static PyObject *__pyx_tuple__6;
 static PyObject *__pyx_tuple__7;
 static PyObject *__pyx_tuple__8;
 static PyObject *__pyx_tuple__9;
-static PyObject *__pyx_slice__17;
+static PyObject *__pyx_slice__15;
 static PyObject *__pyx_tuple__10;
 static PyObject *__pyx_tuple__11;
 static PyObject *__pyx_tuple__12;
 static PyObject *__pyx_tuple__13;
 static PyObject *__pyx_tuple__14;
-static PyObject *__pyx_tuple__15;
 static PyObject *__pyx_tuple__16;
+static PyObject *__pyx_tuple__17;
 static PyObject *__pyx_tuple__18;
 static PyObject *__pyx_tuple__19;
 static PyObject *__pyx_tuple__20;
 static PyObject *__pyx_tuple__21;
 static PyObject *__pyx_tuple__22;
 static PyObject *__pyx_tuple__23;
 static PyObject *__pyx_tuple__24;
 static PyObject *__pyx_tuple__25;
-static PyObject *__pyx_tuple__26;
-static PyObject *__pyx_tuple__27;
-static PyObject *__pyx_codeobj__28;
+static PyObject *__pyx_codeobj__26;
 /* Late includes */
 
-/* "libreco/algorithms/_bpr.pyx":25
+/* "libreco/algorithms/_bpr.pyx":23
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef bool check_consumed(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *                          int user, int item_neg) nogil:
- *     return binary_search(&indices[indptr[user]],
+ * cdef bool check_consumed(const int[:] indices, const int[:] indptr,  int user, int item_neg) nogil:             # <<<<<<<<<<<<<<
+ *     return binary_search(&indices[indptr[user]], &indices[indptr[user+1]], item_neg)
+ * 
  */
 
 static bool __pyx_f_7libreco_10algorithms_4_bpr_check_consumed(__Pyx_memviewslice __pyx_v_indices, __Pyx_memviewslice __pyx_v_indptr, int __pyx_v_user, int __pyx_v_item_neg) {
   bool __pyx_r;
   Py_ssize_t __pyx_t_1;
   Py_ssize_t __pyx_t_2;
   Py_ssize_t __pyx_t_3;
   Py_ssize_t __pyx_t_4;
 
-  /* "libreco/algorithms/_bpr.pyx":27
- * cdef bool check_consumed(const int[:] indices, const int[:] indptr,
- *                          int user, int item_neg) nogil:
- *     return binary_search(&indices[indptr[user]],             # <<<<<<<<<<<<<<
- *                          &indices[indptr[user+1]],
- *                          item_neg)
+  /* "libreco/algorithms/_bpr.pyx":24
+ * @cython.cdivision(True)
+ * cdef bool check_consumed(const int[:] indices, const int[:] indptr,  int user, int item_neg) nogil:
+ *     return binary_search(&indices[indptr[user]], &indices[indptr[user+1]], item_neg)             # <<<<<<<<<<<<<<
+ * 
+ * 
  */
   __pyx_t_1 = __pyx_v_user;
   __pyx_t_2 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_1 * __pyx_v_indptr.strides[0]) )));
-
-  /* "libreco/algorithms/_bpr.pyx":28
- *                          int user, int item_neg) nogil:
- *     return binary_search(&indices[indptr[user]],
- *                          &indices[indptr[user+1]],             # <<<<<<<<<<<<<<
- *                          item_neg)
- * 
- */
   __pyx_t_3 = (__pyx_v_user + 1);
   __pyx_t_4 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_3 * __pyx_v_indptr.strides[0]) )));
-
-  /* "libreco/algorithms/_bpr.pyx":27
- * cdef bool check_consumed(const int[:] indices, const int[:] indptr,
- *                          int user, int item_neg) nogil:
- *     return binary_search(&indices[indptr[user]],             # <<<<<<<<<<<<<<
- *                          &indices[indptr[user+1]],
- *                          item_neg)
- */
   __pyx_r = std::binary_search<int const *,int>((&(*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_2 * __pyx_v_indices.strides[0]) )))), (&(*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_4 * __pyx_v_indices.strides[0]) )))), __pyx_v_item_neg);
   goto __pyx_L0;
 
-  /* "libreco/algorithms/_bpr.pyx":25
+  /* "libreco/algorithms/_bpr.pyx":23
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef bool check_consumed(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *                          int user, int item_neg) nogil:
- *     return binary_search(&indices[indptr[user]],
+ * cdef bool check_consumed(const int[:] indices, const int[:] indptr,  int user, int item_neg) nogil:             # <<<<<<<<<<<<<<
+ *     return binary_search(&indices[indptr[user]], &indices[indptr[user+1]], item_neg)
+ * 
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "libreco/algorithms/_bpr.pyx":35
+/* "libreco/algorithms/_bpr.pyx":30
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cpdef bpr_update(optimizer, train_data, user_embed, item_embed, lr, reg,             # <<<<<<<<<<<<<<
- *                  n_users, n_items, shuffle, num_threads, seed, epoch,
- *                  u_velocity=None, i_velocity=None, momentum=0.9,
+ * cpdef bpr_update(             # <<<<<<<<<<<<<<
+ *     optimizer,
+ *     user_indices,
  */
 
 static PyObject *__pyx_pw_7libreco_10algorithms_4_bpr_1bpr_update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_f_7libreco_10algorithms_4_bpr_bpr_update(PyObject *__pyx_v_optimizer, PyObject *__pyx_v_train_data, PyObject *__pyx_v_user_embed, PyObject *__pyx_v_item_embed, PyObject *__pyx_v_lr, PyObject *__pyx_v_reg, PyObject *__pyx_v_n_users, PyObject *__pyx_v_n_items, PyObject *__pyx_v_shuffle, PyObject *__pyx_v_num_threads, PyObject *__pyx_v_seed, PyObject *__pyx_v_epoch, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7libreco_10algorithms_4_bpr_bpr_update *__pyx_optional_args) {
+static PyObject *__pyx_f_7libreco_10algorithms_4_bpr_bpr_update(PyObject *__pyx_v_optimizer, PyObject *__pyx_v_user_indices, PyObject *__pyx_v_item_indices, PyObject *__pyx_v_sparse_interaction, PyObject *__pyx_v_user_embed, PyObject *__pyx_v_item_embed, PyObject *__pyx_v_lr, PyObject *__pyx_v_reg, PyObject *__pyx_v_n_users, PyObject *__pyx_v_n_items, PyObject *__pyx_v_num_threads, PyObject *__pyx_v_seed, PyObject *__pyx_v_epoch, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7libreco_10algorithms_4_bpr_bpr_update *__pyx_optional_args) {
 
-  /* "libreco/algorithms/_bpr.pyx":37
- * cpdef bpr_update(optimizer, train_data, user_embed, item_embed, lr, reg,
- *                  n_users, n_items, shuffle, num_threads, seed, epoch,
- *                  u_velocity=None, i_velocity=None, momentum=0.9,             # <<<<<<<<<<<<<<
- *                  u_1st_mom=None, i_1st_mom=None, u_2nd_mom=None,
- *                  i_2nd_mom=None, rho1=0.9, rho2=0.999):
+  /* "libreco/algorithms/_bpr.pyx":44
+ *     seed,
+ *     epoch,
+ *     u_velocity=None,             # <<<<<<<<<<<<<<
+ *     i_velocity=None,
+ *     momentum=0.9,
  */
   PyObject *__pyx_v_u_velocity = ((PyObject *)Py_None);
+
+  /* "libreco/algorithms/_bpr.pyx":45
+ *     epoch,
+ *     u_velocity=None,
+ *     i_velocity=None,             # <<<<<<<<<<<<<<
+ *     momentum=0.9,
+ *     u_1st_mom=None,
+ */
   PyObject *__pyx_v_i_velocity = ((PyObject *)Py_None);
   PyObject *__pyx_v_momentum = ((PyObject *)__pyx_float_0_9);
 
-  /* "libreco/algorithms/_bpr.pyx":38
- *                  n_users, n_items, shuffle, num_threads, seed, epoch,
- *                  u_velocity=None, i_velocity=None, momentum=0.9,
- *                  u_1st_mom=None, i_1st_mom=None, u_2nd_mom=None,             # <<<<<<<<<<<<<<
- *                  i_2nd_mom=None, rho1=0.9, rho2=0.999):
- * 
+  /* "libreco/algorithms/_bpr.pyx":47
+ *     i_velocity=None,
+ *     momentum=0.9,
+ *     u_1st_mom=None,             # <<<<<<<<<<<<<<
+ *     i_1st_mom=None,
+ *     u_2nd_mom=None,
  */
   PyObject *__pyx_v_u_1st_mom = ((PyObject *)Py_None);
+
+  /* "libreco/algorithms/_bpr.pyx":48
+ *     momentum=0.9,
+ *     u_1st_mom=None,
+ *     i_1st_mom=None,             # <<<<<<<<<<<<<<
+ *     u_2nd_mom=None,
+ *     i_2nd_mom=None,
+ */
   PyObject *__pyx_v_i_1st_mom = ((PyObject *)Py_None);
+
+  /* "libreco/algorithms/_bpr.pyx":49
+ *     u_1st_mom=None,
+ *     i_1st_mom=None,
+ *     u_2nd_mom=None,             # <<<<<<<<<<<<<<
+ *     i_2nd_mom=None,
+ *     rho1=0.9,
+ */
   PyObject *__pyx_v_u_2nd_mom = ((PyObject *)Py_None);
 
-  /* "libreco/algorithms/_bpr.pyx":39
- *                  u_velocity=None, i_velocity=None, momentum=0.9,
- *                  u_1st_mom=None, i_1st_mom=None, u_2nd_mom=None,
- *                  i_2nd_mom=None, rho1=0.9, rho2=0.999):             # <<<<<<<<<<<<<<
- * 
- *     if train_data.has_sampled:
+  /* "libreco/algorithms/_bpr.pyx":50
+ *     i_1st_mom=None,
+ *     u_2nd_mom=None,
+ *     i_2nd_mom=None,             # <<<<<<<<<<<<<<
+ *     rho1=0.9,
+ *     rho2=0.999,
  */
   PyObject *__pyx_v_i_2nd_mom = ((PyObject *)Py_None);
   PyObject *__pyx_v_rho1 = ((PyObject *)__pyx_float_0_9);
   PyObject *__pyx_v_rho2 = ((PyObject *)__pyx_float_0_999);
-  PyObject *__pyx_v_user_indices = NULL;
-  PyObject *__pyx_v_item_indices = NULL;
-  PyObject *__pyx_v_sparse_interaction = NULL;
   PyObject *__pyx_v_sparse_indices = NULL;
   PyObject *__pyx_v_sparse_indptr = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  int __pyx_t_6;
-  Py_ssize_t __pyx_t_7;
-  int __pyx_t_8;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *(*__pyx_t_10)(PyObject *);
-  __Pyx_memviewslice __pyx_t_11 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  __Pyx_memviewslice __pyx_t_12 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  __Pyx_memviewslice __pyx_t_13 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  __Pyx_memviewslice __pyx_t_14 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  __Pyx_memviewslice __pyx_t_3 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  __Pyx_memviewslice __pyx_t_4 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  __Pyx_memviewslice __pyx_t_5 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  __Pyx_memviewslice __pyx_t_6 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  __Pyx_memviewslice __pyx_t_7 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  __Pyx_memviewslice __pyx_t_8 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  double __pyx_t_9;
+  double __pyx_t_10;
+  int __pyx_t_11;
+  int __pyx_t_12;
+  int __pyx_t_13;
+  int __pyx_t_14;
   __Pyx_memviewslice __pyx_t_15 = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_t_16 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  double __pyx_t_17;
-  double __pyx_t_18;
-  int __pyx_t_19;
-  int __pyx_t_20;
-  int __pyx_t_21;
+  __Pyx_memviewslice __pyx_t_17 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  __Pyx_memviewslice __pyx_t_18 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  __Pyx_memviewslice __pyx_t_19 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  __Pyx_memviewslice __pyx_t_20 = { 0, 0, { 0 }, { 0 }, { 0 } };
+  double __pyx_t_21;
   __Pyx_memviewslice __pyx_t_22 = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_t_23 = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_t_24 = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_t_25 = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_t_26 = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_t_27 = { 0, 0, { 0 }, { 0 }, { 0 } };
   double __pyx_t_28;
-  __Pyx_memviewslice __pyx_t_29 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  __Pyx_memviewslice __pyx_t_30 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  __Pyx_memviewslice __pyx_t_31 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  __Pyx_memviewslice __pyx_t_32 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  __Pyx_memviewslice __pyx_t_33 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  __Pyx_memviewslice __pyx_t_34 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  double __pyx_t_35;
-  int __pyx_t_36;
+  int __pyx_t_29;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("bpr_update", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_u_velocity = __pyx_optional_args->u_velocity;
@@ -2989,1034 +2508,666 @@
               }
             }
           }
         }
       }
     }
   }
-  __Pyx_INCREF(__pyx_v_reg);
-
-  /* "libreco/algorithms/_bpr.pyx":41
- *                  i_2nd_mom=None, rho1=0.9, rho2=0.999):
- * 
- *     if train_data.has_sampled:             # <<<<<<<<<<<<<<
- *         user_indices = train_data.user_indices_orig.astype(np.int32)
- *         item_indices = train_data.item_indices_orig.astype(np.int32)
- */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_train_data, __pyx_n_s_has_sampled); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (__pyx_t_2) {
-
-    /* "libreco/algorithms/_bpr.pyx":42
- * 
- *     if train_data.has_sampled:
- *         user_indices = train_data.user_indices_orig.astype(np.int32)             # <<<<<<<<<<<<<<
- *         item_indices = train_data.item_indices_orig.astype(np.int32)
- *     else:
- */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_train_data, __pyx_n_s_user_indices_orig); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 42, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 42, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 42, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 42, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
-      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
-      if (likely(__pyx_t_3)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-        __Pyx_INCREF(__pyx_t_3);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_4, function);
-      }
-    }
-    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 42, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_v_user_indices = __pyx_t_1;
-    __pyx_t_1 = 0;
-
-    /* "libreco/algorithms/_bpr.pyx":43
- *     if train_data.has_sampled:
- *         user_indices = train_data.user_indices_orig.astype(np.int32)
- *         item_indices = train_data.item_indices_orig.astype(np.int32)             # <<<<<<<<<<<<<<
- *     else:
- *         user_indices = train_data.user_indices.astype(np.int32)
- */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_train_data, __pyx_n_s_item_indices_orig); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 43, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 43, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 43, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
-      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
-      if (likely(__pyx_t_4)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
-        __Pyx_INCREF(__pyx_t_4);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_5, function);
-      }
-    }
-    __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_3);
-    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_v_item_indices = __pyx_t_1;
-    __pyx_t_1 = 0;
-
-    /* "libreco/algorithms/_bpr.pyx":41
- *                  i_2nd_mom=None, rho1=0.9, rho2=0.999):
- * 
- *     if train_data.has_sampled:             # <<<<<<<<<<<<<<
- *         user_indices = train_data.user_indices_orig.astype(np.int32)
- *         item_indices = train_data.item_indices_orig.astype(np.int32)
- */
-    goto __pyx_L3;
-  }
-
-  /* "libreco/algorithms/_bpr.pyx":45
- *         item_indices = train_data.item_indices_orig.astype(np.int32)
- *     else:
- *         user_indices = train_data.user_indices.astype(np.int32)             # <<<<<<<<<<<<<<
- *         item_indices = train_data.item_indices.astype(np.int32)
- * 
- */
-  /*else*/ {
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_train_data, __pyx_n_s_user_indices); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 45, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 45, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 45, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 45, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
-      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
-      if (likely(__pyx_t_5)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
-        __Pyx_INCREF(__pyx_t_5);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_3, function);
-      }
-    }
-    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
-    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_v_user_indices = __pyx_t_1;
-    __pyx_t_1 = 0;
-
-    /* "libreco/algorithms/_bpr.pyx":46
- *     else:
- *         user_indices = train_data.user_indices.astype(np.int32)
- *         item_indices = train_data.item_indices.astype(np.int32)             # <<<<<<<<<<<<<<
- * 
- *     sparse_interaction = train_data.sparse_interaction
- */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_train_data, __pyx_n_s_item_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 46, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 46, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 46, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 46, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
-      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
-      if (likely(__pyx_t_3)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-        __Pyx_INCREF(__pyx_t_3);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_4, function);
-      }
-    }
-    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_v_item_indices = __pyx_t_1;
-    __pyx_t_1 = 0;
-  }
-  __pyx_L3:;
-
-  /* "libreco/algorithms/_bpr.pyx":48
- *         item_indices = train_data.item_indices.astype(np.int32)
- * 
- *     sparse_interaction = train_data.sparse_interaction             # <<<<<<<<<<<<<<
- *     sparse_indices = sparse_interaction.indices
- *     sparse_indptr = sparse_interaction.indptr
- */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_train_data, __pyx_n_s_sparse_interaction); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 48, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_v_sparse_interaction = __pyx_t_1;
-  __pyx_t_1 = 0;
 
-  /* "libreco/algorithms/_bpr.pyx":49
- * 
- *     sparse_interaction = train_data.sparse_interaction
+  /* "libreco/algorithms/_bpr.pyx":54
+ *     rho2=0.999,
+ * ):
  *     sparse_indices = sparse_interaction.indices             # <<<<<<<<<<<<<<
  *     sparse_indptr = sparse_interaction.indptr
- * 
+ *     if optimizer == "sgd":
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_sparse_interaction, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 49, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_sparse_interaction, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 54, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_sparse_indices = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "libreco/algorithms/_bpr.pyx":50
- *     sparse_interaction = train_data.sparse_interaction
+  /* "libreco/algorithms/_bpr.pyx":55
+ * ):
  *     sparse_indices = sparse_interaction.indices
  *     sparse_indptr = sparse_interaction.indptr             # <<<<<<<<<<<<<<
- * 
- *     if not reg:
+ *     if optimizer == "sgd":
+ *         _bpr_update_sgd(
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_sparse_interaction, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 50, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_sparse_interaction, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 55, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_sparse_indptr = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "libreco/algorithms/_bpr.pyx":52
- *     sparse_indptr = sparse_interaction.indptr
- * 
- *     if not reg:             # <<<<<<<<<<<<<<
- *         reg = 0.0
- * 
- */
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_reg); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 52, __pyx_L1_error)
-  __pyx_t_6 = ((!__pyx_t_2) != 0);
-  if (__pyx_t_6) {
-
-    /* "libreco/algorithms/_bpr.pyx":53
- * 
- *     if not reg:
- *         reg = 0.0             # <<<<<<<<<<<<<<
- * 
- *     if shuffle:
- */
-    __Pyx_INCREF(__pyx_float_0_0);
-    __Pyx_DECREF_SET(__pyx_v_reg, __pyx_float_0_0);
-
-    /* "libreco/algorithms/_bpr.pyx":52
+  /* "libreco/algorithms/_bpr.pyx":56
+ *     sparse_indices = sparse_interaction.indices
  *     sparse_indptr = sparse_interaction.indptr
- * 
- *     if not reg:             # <<<<<<<<<<<<<<
- *         reg = 0.0
- * 
- */
-  }
-
-  /* "libreco/algorithms/_bpr.pyx":55
- *         reg = 0.0
- * 
- *     if shuffle:             # <<<<<<<<<<<<<<
- *         user_indices, item_indices = shuffle_data(
- *             len(user_indices), user_indices, item_indices)
- */
-  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_shuffle); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 55, __pyx_L1_error)
-  if (__pyx_t_6) {
-
-    /* "libreco/algorithms/_bpr.pyx":56
- * 
- *     if shuffle:
- *         user_indices, item_indices = shuffle_data(             # <<<<<<<<<<<<<<
- *             len(user_indices), user_indices, item_indices)
- * 
+ *     if optimizer == "sgd":             # <<<<<<<<<<<<<<
+ *         _bpr_update_sgd(
+ *             user_indices,
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_shuffle_data); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 56, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_optimizer, __pyx_n_u_sgd, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 56, __pyx_L1_error)
+  if (__pyx_t_2) {
 
-    /* "libreco/algorithms/_bpr.pyx":57
- *     if shuffle:
- *         user_indices, item_indices = shuffle_data(
- *             len(user_indices), user_indices, item_indices)             # <<<<<<<<<<<<<<
- * 
+    /* "libreco/algorithms/_bpr.pyx":58
  *     if optimizer == "sgd":
+ *         _bpr_update_sgd(
+ *             user_indices,             # <<<<<<<<<<<<<<
+ *             item_indices,
+ *             sparse_indices,
  */
-    __pyx_t_7 = PyObject_Length(__pyx_v_user_indices); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 57, __pyx_L1_error)
-    __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 57, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_3 = NULL;
-    __pyx_t_8 = 0;
-    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
-      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
-      if (likely(__pyx_t_3)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-        __Pyx_INCREF(__pyx_t_3);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_4, function);
-        __pyx_t_8 = 1;
-      }
-    }
-    #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(__pyx_t_4)) {
-      PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_t_5, __pyx_v_user_indices, __pyx_v_item_indices};
-      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 56, __pyx_L1_error)
-      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __Pyx_GOTREF(__pyx_t_1);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    } else
-    #endif
-    #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
-      PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_t_5, __pyx_v_user_indices, __pyx_v_item_indices};
-      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 56, __pyx_L1_error)
-      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __Pyx_GOTREF(__pyx_t_1);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    } else
-    #endif
-    {
-      __pyx_t_9 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 56, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_9);
-      if (__pyx_t_3) {
-        __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_3); __pyx_t_3 = NULL;
-      }
-      __Pyx_GIVEREF(__pyx_t_5);
-      PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_t_5);
-      __Pyx_INCREF(__pyx_v_user_indices);
-      __Pyx_GIVEREF(__pyx_v_user_indices);
-      PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_v_user_indices);
-      __Pyx_INCREF(__pyx_v_item_indices);
-      __Pyx_GIVEREF(__pyx_v_item_indices);
-      PyTuple_SET_ITEM(__pyx_t_9, 2+__pyx_t_8, __pyx_v_item_indices);
-      __pyx_t_5 = 0;
-      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 56, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    }
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
-      PyObject* sequence = __pyx_t_1;
-      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
-      if (unlikely(size != 2)) {
-        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
-        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-        __PYX_ERR(0, 56, __pyx_L1_error)
-      }
-      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      if (likely(PyTuple_CheckExact(sequence))) {
-        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
-        __pyx_t_9 = PyTuple_GET_ITEM(sequence, 1); 
-      } else {
-        __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
-        __pyx_t_9 = PyList_GET_ITEM(sequence, 1); 
-      }
-      __Pyx_INCREF(__pyx_t_4);
-      __Pyx_INCREF(__pyx_t_9);
-      #else
-      __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 56, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_9 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 56, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_9);
-      #endif
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    } else {
-      Py_ssize_t index = -1;
-      __pyx_t_5 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 56, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_10 = Py_TYPE(__pyx_t_5)->tp_iternext;
-      index = 0; __pyx_t_4 = __pyx_t_10(__pyx_t_5); if (unlikely(!__pyx_t_4)) goto __pyx_L6_unpacking_failed;
-      __Pyx_GOTREF(__pyx_t_4);
-      index = 1; __pyx_t_9 = __pyx_t_10(__pyx_t_5); if (unlikely(!__pyx_t_9)) goto __pyx_L6_unpacking_failed;
-      __Pyx_GOTREF(__pyx_t_9);
-      if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_5), 2) < 0) __PYX_ERR(0, 56, __pyx_L1_error)
-      __pyx_t_10 = NULL;
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      goto __pyx_L7_unpacking_done;
-      __pyx_L6_unpacking_failed:;
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_10 = NULL;
-      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-      __PYX_ERR(0, 56, __pyx_L1_error)
-      __pyx_L7_unpacking_done:;
-    }
-
-    /* "libreco/algorithms/_bpr.pyx":56
- * 
- *     if shuffle:
- *         user_indices, item_indices = shuffle_data(             # <<<<<<<<<<<<<<
- *             len(user_indices), user_indices, item_indices)
- * 
- */
-    __Pyx_DECREF_SET(__pyx_v_user_indices, __pyx_t_4);
-    __pyx_t_4 = 0;
-    __Pyx_DECREF_SET(__pyx_v_item_indices, __pyx_t_9);
-    __pyx_t_9 = 0;
-
-    /* "libreco/algorithms/_bpr.pyx":55
- *         reg = 0.0
- * 
- *     if shuffle:             # <<<<<<<<<<<<<<
- *         user_indices, item_indices = shuffle_data(
- *             len(user_indices), user_indices, item_indices)
- */
-  }
+    __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_user_indices, 0); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 58, __pyx_L1_error)
 
-  /* "libreco/algorithms/_bpr.pyx":59
- *             len(user_indices), user_indices, item_indices)
- * 
- *     if optimizer == "sgd":             # <<<<<<<<<<<<<<
- *         _bpr_update_sgd(user_indices,
- *                         item_indices,
+    /* "libreco/algorithms/_bpr.pyx":59
+ *         _bpr_update_sgd(
+ *             user_indices,
+ *             item_indices,             # <<<<<<<<<<<<<<
+ *             sparse_indices,
+ *             sparse_indptr,
  */
-  __pyx_t_6 = (__Pyx_PyString_Equals(__pyx_v_optimizer, __pyx_n_s_sgd, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 59, __pyx_L1_error)
-  if (__pyx_t_6) {
+    __pyx_t_4 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_item_indices, 0); if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 59, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":60
- * 
- *     if optimizer == "sgd":
- *         _bpr_update_sgd(user_indices,             # <<<<<<<<<<<<<<
- *                         item_indices,
- *                         sparse_indices,
+ *             user_indices,
+ *             item_indices,
+ *             sparse_indices,             # <<<<<<<<<<<<<<
+ *             sparse_indptr,
+ *             user_embed,
  */
-    __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_user_indices, 0); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 60, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indices, 0); if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 60, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":61
- *     if optimizer == "sgd":
- *         _bpr_update_sgd(user_indices,
- *                         item_indices,             # <<<<<<<<<<<<<<
- *                         sparse_indices,
- *                         sparse_indptr,
+ *             item_indices,
+ *             sparse_indices,
+ *             sparse_indptr,             # <<<<<<<<<<<<<<
+ *             user_embed,
+ *             item_embed,
  */
-    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_item_indices, 0); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 61, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indptr, 0); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 61, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":62
- *         _bpr_update_sgd(user_indices,
- *                         item_indices,
- *                         sparse_indices,             # <<<<<<<<<<<<<<
- *                         sparse_indptr,
- *                         user_embed,
+ *             sparse_indices,
+ *             sparse_indptr,
+ *             user_embed,             # <<<<<<<<<<<<<<
+ *             item_embed,
+ *             lr,
  */
-    __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indices, 0); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 62, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_user_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 62, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":63
- *                         item_indices,
- *                         sparse_indices,
- *                         sparse_indptr,             # <<<<<<<<<<<<<<
- *                         user_embed,
- *                         item_embed,
+ *             sparse_indptr,
+ *             user_embed,
+ *             item_embed,             # <<<<<<<<<<<<<<
+ *             lr,
+ *             reg,
  */
-    __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indptr, 0); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 63, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_item_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 63, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":64
- *                         sparse_indices,
- *                         sparse_indptr,
- *                         user_embed,             # <<<<<<<<<<<<<<
- *                         item_embed,
- *                         lr,
+ *             user_embed,
+ *             item_embed,
+ *             lr,             # <<<<<<<<<<<<<<
+ *             reg,
+ *             n_users,
  */
-    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_user_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_lr); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 64, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":65
- *                         sparse_indptr,
- *                         user_embed,
- *                         item_embed,             # <<<<<<<<<<<<<<
- *                         lr,
- *                         reg,
+ *             item_embed,
+ *             lr,
+ *             reg,             # <<<<<<<<<<<<<<
+ *             n_users,
+ *             n_items,
  */
-    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_item_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_10 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 65, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":66
- *                         user_embed,
- *                         item_embed,
- *                         lr,             # <<<<<<<<<<<<<<
- *                         reg,
- *                         n_users,
+ *             lr,
+ *             reg,
+ *             n_users,             # <<<<<<<<<<<<<<
+ *             n_items,
+ *             num_threads,
  */
-    __pyx_t_17 = __pyx_PyFloat_AsDouble(__pyx_v_lr); if (unlikely((__pyx_t_17 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_n_users); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 66, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":67
- *                         item_embed,
- *                         lr,
- *                         reg,             # <<<<<<<<<<<<<<
- *                         n_users,
- *                         n_items,
+ *             reg,
+ *             n_users,
+ *             n_items,             # <<<<<<<<<<<<<<
+ *             num_threads,
+ *             seed,
  */
-    __pyx_t_18 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_18 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 67, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_v_n_items); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 67, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":68
- *                         lr,
- *                         reg,
- *                         n_users,             # <<<<<<<<<<<<<<
- *                         n_items,
- *                         num_threads,
+ *             n_users,
+ *             n_items,
+ *             num_threads,             # <<<<<<<<<<<<<<
+ *             seed,
+ *         )
  */
-    __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_v_n_users); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 68, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_13 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 68, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":69
- *                         reg,
- *                         n_users,
- *                         n_items,             # <<<<<<<<<<<<<<
- *                         num_threads,
- *                         seed)
- */
-    __pyx_t_19 = __Pyx_PyInt_As_int(__pyx_v_n_items); if (unlikely((__pyx_t_19 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 69, __pyx_L1_error)
-
-    /* "libreco/algorithms/_bpr.pyx":70
- *                         n_users,
- *                         n_items,
- *                         num_threads,             # <<<<<<<<<<<<<<
- *                         seed)
- * 
- */
-    __pyx_t_20 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_20 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 70, __pyx_L1_error)
-
-    /* "libreco/algorithms/_bpr.pyx":71
- *                         n_items,
- *                         num_threads,
- *                         seed)             # <<<<<<<<<<<<<<
- * 
+ *             n_items,
+ *             num_threads,
+ *             seed,             # <<<<<<<<<<<<<<
+ *         )
  *     elif optimizer == "momentum":
  */
-    __pyx_t_21 = __Pyx_PyInt_As_int(__pyx_v_seed); if (unlikely((__pyx_t_21 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 71, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_As_int(__pyx_v_seed); if (unlikely((__pyx_t_14 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 69, __pyx_L1_error)
 
-    /* "libreco/algorithms/_bpr.pyx":60
- * 
+    /* "libreco/algorithms/_bpr.pyx":57
+ *     sparse_indptr = sparse_interaction.indptr
  *     if optimizer == "sgd":
- *         _bpr_update_sgd(user_indices,             # <<<<<<<<<<<<<<
- *                         item_indices,
- *                         sparse_indices,
- */
-    __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_sgd(__pyx_t_11, __pyx_t_12, __pyx_t_13, __pyx_t_14, __pyx_t_15, __pyx_t_16, __pyx_t_17, __pyx_t_18, __pyx_t_8, __pyx_t_19, __pyx_t_20, __pyx_t_21);
-    __PYX_XDEC_MEMVIEW(&__pyx_t_11, 1);
-    __pyx_t_11.memview = NULL;
-    __pyx_t_11.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_12, 1);
-    __pyx_t_12.memview = NULL;
-    __pyx_t_12.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_13, 1);
-    __pyx_t_13.memview = NULL;
-    __pyx_t_13.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_14, 1);
-    __pyx_t_14.memview = NULL;
-    __pyx_t_14.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_15, 1);
-    __pyx_t_15.memview = NULL;
-    __pyx_t_15.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_16, 1);
-    __pyx_t_16.memview = NULL;
-    __pyx_t_16.data = NULL;
+ *         _bpr_update_sgd(             # <<<<<<<<<<<<<<
+ *             user_indices,
+ *             item_indices,
+ */
+    __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_sgd(__pyx_t_3, __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9, __pyx_t_10, __pyx_t_11, __pyx_t_12, __pyx_t_13, __pyx_t_14);
+    __PYX_XDEC_MEMVIEW(&__pyx_t_3, 1);
+    __pyx_t_3.memview = NULL;
+    __pyx_t_3.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_4, 1);
+    __pyx_t_4.memview = NULL;
+    __pyx_t_4.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_5, 1);
+    __pyx_t_5.memview = NULL;
+    __pyx_t_5.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_6, 1);
+    __pyx_t_6.memview = NULL;
+    __pyx_t_6.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
+    __pyx_t_7.memview = NULL;
+    __pyx_t_7.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
+    __pyx_t_8.memview = NULL;
+    __pyx_t_8.data = NULL;
 
-    /* "libreco/algorithms/_bpr.pyx":59
- *             len(user_indices), user_indices, item_indices)
- * 
+    /* "libreco/algorithms/_bpr.pyx":56
+ *     sparse_indices = sparse_interaction.indices
+ *     sparse_indptr = sparse_interaction.indptr
  *     if optimizer == "sgd":             # <<<<<<<<<<<<<<
- *         _bpr_update_sgd(user_indices,
- *                         item_indices,
+ *         _bpr_update_sgd(
+ *             user_indices,
  */
-    goto __pyx_L8;
+    goto __pyx_L3;
   }
 
-  /* "libreco/algorithms/_bpr.pyx":73
- *                         seed)
- * 
+  /* "libreco/algorithms/_bpr.pyx":71
+ *             seed,
+ *         )
  *     elif optimizer == "momentum":             # <<<<<<<<<<<<<<
- *         _bpr_update_momentum(user_indices,
- *                              item_indices,
+ *         _bpr_update_momentum(
+ *             user_indices,
  */
-  __pyx_t_6 = (__Pyx_PyString_Equals(__pyx_v_optimizer, __pyx_n_s_momentum, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 73, __pyx_L1_error)
-  if (__pyx_t_6) {
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_optimizer, __pyx_n_u_momentum, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 71, __pyx_L1_error)
+  if (__pyx_t_2) {
 
-    /* "libreco/algorithms/_bpr.pyx":74
- * 
+    /* "libreco/algorithms/_bpr.pyx":73
  *     elif optimizer == "momentum":
- *         _bpr_update_momentum(user_indices,             # <<<<<<<<<<<<<<
- *                              item_indices,
- *                              sparse_indices,
+ *         _bpr_update_momentum(
+ *             user_indices,             # <<<<<<<<<<<<<<
+ *             item_indices,
+ *             sparse_indices,
  */
-    __pyx_t_22 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_user_indices, 0); if (unlikely(!__pyx_t_22.memview)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_user_indices, 0); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 73, __pyx_L1_error)
+
+    /* "libreco/algorithms/_bpr.pyx":74
+ *         _bpr_update_momentum(
+ *             user_indices,
+ *             item_indices,             # <<<<<<<<<<<<<<
+ *             sparse_indices,
+ *             sparse_indptr,
+ */
+    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_item_indices, 0); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 74, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":75
- *     elif optimizer == "momentum":
- *         _bpr_update_momentum(user_indices,
- *                              item_indices,             # <<<<<<<<<<<<<<
- *                              sparse_indices,
- *                              sparse_indptr,
+ *             user_indices,
+ *             item_indices,
+ *             sparse_indices,             # <<<<<<<<<<<<<<
+ *             sparse_indptr,
+ *             user_embed,
  */
-    __pyx_t_23 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_item_indices, 0); if (unlikely(!__pyx_t_23.memview)) __PYX_ERR(0, 75, __pyx_L1_error)
+    __pyx_t_17 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indices, 0); if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 75, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":76
- *         _bpr_update_momentum(user_indices,
- *                              item_indices,
- *                              sparse_indices,             # <<<<<<<<<<<<<<
- *                              sparse_indptr,
- *                              user_embed,
+ *             item_indices,
+ *             sparse_indices,
+ *             sparse_indptr,             # <<<<<<<<<<<<<<
+ *             user_embed,
+ *             item_embed,
  */
-    __pyx_t_24 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indices, 0); if (unlikely(!__pyx_t_24.memview)) __PYX_ERR(0, 76, __pyx_L1_error)
+    __pyx_t_18 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indptr, 0); if (unlikely(!__pyx_t_18.memview)) __PYX_ERR(0, 76, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":77
- *                              item_indices,
- *                              sparse_indices,
- *                              sparse_indptr,             # <<<<<<<<<<<<<<
- *                              user_embed,
- *                              item_embed,
+ *             sparse_indices,
+ *             sparse_indptr,
+ *             user_embed,             # <<<<<<<<<<<<<<
+ *             item_embed,
+ *             lr,
  */
-    __pyx_t_25 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indptr, 0); if (unlikely(!__pyx_t_25.memview)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_user_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 77, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":78
- *                              sparse_indices,
- *                              sparse_indptr,
- *                              user_embed,             # <<<<<<<<<<<<<<
- *                              item_embed,
- *                              lr,
+ *             sparse_indptr,
+ *             user_embed,
+ *             item_embed,             # <<<<<<<<<<<<<<
+ *             lr,
+ *             reg,
  */
-    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_user_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 78, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_item_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 78, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":79
- *                              sparse_indptr,
- *                              user_embed,
- *                              item_embed,             # <<<<<<<<<<<<<<
- *                              lr,
- *                              reg,
+ *             user_embed,
+ *             item_embed,
+ *             lr,             # <<<<<<<<<<<<<<
+ *             reg,
+ *             n_users,
  */
-    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_item_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 79, __pyx_L1_error)
+    __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_v_lr); if (unlikely((__pyx_t_10 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 79, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":80
- *                              user_embed,
- *                              item_embed,
- *                              lr,             # <<<<<<<<<<<<<<
- *                              reg,
- *                              n_users,
+ *             item_embed,
+ *             lr,
+ *             reg,             # <<<<<<<<<<<<<<
+ *             n_users,
+ *             n_items,
  */
-    __pyx_t_18 = __pyx_PyFloat_AsDouble(__pyx_v_lr); if (unlikely((__pyx_t_18 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 80, __pyx_L1_error)
+    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 80, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":81
- *                              item_embed,
- *                              lr,
- *                              reg,             # <<<<<<<<<<<<<<
- *                              n_users,
- *                              n_items,
+ *             lr,
+ *             reg,
+ *             n_users,             # <<<<<<<<<<<<<<
+ *             n_items,
+ *             u_velocity,
  */
-    __pyx_t_17 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_17 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 81, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_As_int(__pyx_v_n_users); if (unlikely((__pyx_t_14 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 81, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":82
- *                              lr,
- *                              reg,
- *                              n_users,             # <<<<<<<<<<<<<<
- *                              n_items,
- *                              u_velocity,
+ *             reg,
+ *             n_users,
+ *             n_items,             # <<<<<<<<<<<<<<
+ *             u_velocity,
+ *             i_velocity,
  */
-    __pyx_t_21 = __Pyx_PyInt_As_int(__pyx_v_n_users); if (unlikely((__pyx_t_21 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_As_int(__pyx_v_n_items); if (unlikely((__pyx_t_13 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":83
- *                              reg,
- *                              n_users,
- *                              n_items,             # <<<<<<<<<<<<<<
- *                              u_velocity,
- *                              i_velocity,
+ *             n_users,
+ *             n_items,
+ *             u_velocity,             # <<<<<<<<<<<<<<
+ *             i_velocity,
+ *             momentum,
  */
-    __pyx_t_20 = __Pyx_PyInt_As_int(__pyx_v_n_items); if (unlikely((__pyx_t_20 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 83, __pyx_L1_error)
+    __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_u_velocity, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":84
- *                              n_users,
- *                              n_items,
- *                              u_velocity,             # <<<<<<<<<<<<<<
- *                              i_velocity,
- *                              momentum,
+ *             n_items,
+ *             u_velocity,
+ *             i_velocity,             # <<<<<<<<<<<<<<
+ *             momentum,
+ *             num_threads,
  */
-    __pyx_t_26 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_u_velocity, PyBUF_WRITABLE); if (unlikely(!__pyx_t_26.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
+    __pyx_t_20 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_i_velocity, PyBUF_WRITABLE); if (unlikely(!__pyx_t_20.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":85
- *                              n_items,
- *                              u_velocity,
- *                              i_velocity,             # <<<<<<<<<<<<<<
- *                              momentum,
- *                              num_threads,
+ *             u_velocity,
+ *             i_velocity,
+ *             momentum,             # <<<<<<<<<<<<<<
+ *             num_threads,
+ *             seed,
  */
-    __pyx_t_27 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_i_velocity, PyBUF_WRITABLE); if (unlikely(!__pyx_t_27.memview)) __PYX_ERR(0, 85, __pyx_L1_error)
+    __pyx_t_21 = __pyx_PyFloat_AsDouble(__pyx_v_momentum); if (unlikely((__pyx_t_21 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 85, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":86
- *                              u_velocity,
- *                              i_velocity,
- *                              momentum,             # <<<<<<<<<<<<<<
- *                              num_threads,
- *                              seed)
+ *             i_velocity,
+ *             momentum,
+ *             num_threads,             # <<<<<<<<<<<<<<
+ *             seed,
+ *         )
  */
-    __pyx_t_28 = __pyx_PyFloat_AsDouble(__pyx_v_momentum); if (unlikely((__pyx_t_28 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 86, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 86, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":87
- *                              i_velocity,
- *                              momentum,
- *                              num_threads,             # <<<<<<<<<<<<<<
- *                              seed)
- * 
- */
-    __pyx_t_19 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_19 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 87, __pyx_L1_error)
-
-    /* "libreco/algorithms/_bpr.pyx":88
- *                              momentum,
- *                              num_threads,
- *                              seed)             # <<<<<<<<<<<<<<
- * 
+ *             momentum,
+ *             num_threads,
+ *             seed,             # <<<<<<<<<<<<<<
+ *         )
  *     elif optimizer == "adam":
  */
-    __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_v_seed); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_seed); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 87, __pyx_L1_error)
 
-    /* "libreco/algorithms/_bpr.pyx":74
- * 
+    /* "libreco/algorithms/_bpr.pyx":72
+ *         )
  *     elif optimizer == "momentum":
- *         _bpr_update_momentum(user_indices,             # <<<<<<<<<<<<<<
- *                              item_indices,
- *                              sparse_indices,
+ *         _bpr_update_momentum(             # <<<<<<<<<<<<<<
+ *             user_indices,
+ *             item_indices,
  */
-    __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_momentum(__pyx_t_22, __pyx_t_23, __pyx_t_24, __pyx_t_25, __pyx_t_16, __pyx_t_15, __pyx_t_18, __pyx_t_17, __pyx_t_21, __pyx_t_20, __pyx_t_26, __pyx_t_27, __pyx_t_28, __pyx_t_19, __pyx_t_8);
-    __PYX_XDEC_MEMVIEW(&__pyx_t_22, 1);
-    __pyx_t_22.memview = NULL;
-    __pyx_t_22.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_23, 1);
-    __pyx_t_23.memview = NULL;
-    __pyx_t_23.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_24, 1);
-    __pyx_t_24.memview = NULL;
-    __pyx_t_24.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_25, 1);
-    __pyx_t_25.memview = NULL;
-    __pyx_t_25.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_16, 1);
-    __pyx_t_16.memview = NULL;
-    __pyx_t_16.data = NULL;
+    __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_momentum(__pyx_t_15, __pyx_t_16, __pyx_t_17, __pyx_t_18, __pyx_t_8, __pyx_t_7, __pyx_t_10, __pyx_t_9, __pyx_t_14, __pyx_t_13, __pyx_t_19, __pyx_t_20, __pyx_t_21, __pyx_t_12, __pyx_t_11);
     __PYX_XDEC_MEMVIEW(&__pyx_t_15, 1);
     __pyx_t_15.memview = NULL;
     __pyx_t_15.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_26, 1);
-    __pyx_t_26.memview = NULL;
-    __pyx_t_26.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_27, 1);
-    __pyx_t_27.memview = NULL;
-    __pyx_t_27.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_16, 1);
+    __pyx_t_16.memview = NULL;
+    __pyx_t_16.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_17, 1);
+    __pyx_t_17.memview = NULL;
+    __pyx_t_17.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_18, 1);
+    __pyx_t_18.memview = NULL;
+    __pyx_t_18.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
+    __pyx_t_8.memview = NULL;
+    __pyx_t_8.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
+    __pyx_t_7.memview = NULL;
+    __pyx_t_7.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_19, 1);
+    __pyx_t_19.memview = NULL;
+    __pyx_t_19.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_20, 1);
+    __pyx_t_20.memview = NULL;
+    __pyx_t_20.data = NULL;
 
-    /* "libreco/algorithms/_bpr.pyx":73
- *                         seed)
- * 
+    /* "libreco/algorithms/_bpr.pyx":71
+ *             seed,
+ *         )
  *     elif optimizer == "momentum":             # <<<<<<<<<<<<<<
- *         _bpr_update_momentum(user_indices,
- *                              item_indices,
+ *         _bpr_update_momentum(
+ *             user_indices,
  */
-    goto __pyx_L8;
+    goto __pyx_L3;
   }
 
-  /* "libreco/algorithms/_bpr.pyx":90
- *                              seed)
- * 
+  /* "libreco/algorithms/_bpr.pyx":89
+ *             seed,
+ *         )
  *     elif optimizer == "adam":             # <<<<<<<<<<<<<<
- *         _bpr_update_adam(user_indices,
- *                          item_indices,
+ *         _bpr_update_adam(
+ *             user_indices,
  */
-  __pyx_t_6 = (__Pyx_PyString_Equals(__pyx_v_optimizer, __pyx_n_s_adam, Py_EQ)); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 90, __pyx_L1_error)
-  if (__pyx_t_6) {
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_optimizer, __pyx_n_u_adam, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 89, __pyx_L1_error)
+  if (__pyx_t_2) {
 
     /* "libreco/algorithms/_bpr.pyx":91
- * 
  *     elif optimizer == "adam":
- *         _bpr_update_adam(user_indices,             # <<<<<<<<<<<<<<
- *                          item_indices,
- *                          sparse_indices,
+ *         _bpr_update_adam(
+ *             user_indices,             # <<<<<<<<<<<<<<
+ *             item_indices,
+ *             sparse_indices,
  */
-    __pyx_t_29 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_user_indices, 0); if (unlikely(!__pyx_t_29.memview)) __PYX_ERR(0, 91, __pyx_L1_error)
+    __pyx_t_22 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_user_indices, 0); if (unlikely(!__pyx_t_22.memview)) __PYX_ERR(0, 91, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":92
- *     elif optimizer == "adam":
- *         _bpr_update_adam(user_indices,
- *                          item_indices,             # <<<<<<<<<<<<<<
- *                          sparse_indices,
- *                          sparse_indptr,
+ *         _bpr_update_adam(
+ *             user_indices,
+ *             item_indices,             # <<<<<<<<<<<<<<
+ *             sparse_indices,
+ *             sparse_indptr,
  */
-    __pyx_t_30 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_item_indices, 0); if (unlikely(!__pyx_t_30.memview)) __PYX_ERR(0, 92, __pyx_L1_error)
+    __pyx_t_23 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_item_indices, 0); if (unlikely(!__pyx_t_23.memview)) __PYX_ERR(0, 92, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":93
- *         _bpr_update_adam(user_indices,
- *                          item_indices,
- *                          sparse_indices,             # <<<<<<<<<<<<<<
- *                          sparse_indptr,
- *                          user_embed,
+ *             user_indices,
+ *             item_indices,
+ *             sparse_indices,             # <<<<<<<<<<<<<<
+ *             sparse_indptr,
+ *             user_embed,
  */
-    __pyx_t_31 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indices, 0); if (unlikely(!__pyx_t_31.memview)) __PYX_ERR(0, 93, __pyx_L1_error)
+    __pyx_t_24 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indices, 0); if (unlikely(!__pyx_t_24.memview)) __PYX_ERR(0, 93, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":94
- *                          item_indices,
- *                          sparse_indices,
- *                          sparse_indptr,             # <<<<<<<<<<<<<<
- *                          user_embed,
- *                          item_embed,
+ *             item_indices,
+ *             sparse_indices,
+ *             sparse_indptr,             # <<<<<<<<<<<<<<
+ *             user_embed,
+ *             item_embed,
  */
-    __pyx_t_32 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indptr, 0); if (unlikely(!__pyx_t_32.memview)) __PYX_ERR(0, 94, __pyx_L1_error)
+    __pyx_t_25 = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(__pyx_v_sparse_indptr, 0); if (unlikely(!__pyx_t_25.memview)) __PYX_ERR(0, 94, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":95
- *                          sparse_indices,
- *                          sparse_indptr,
- *                          user_embed,             # <<<<<<<<<<<<<<
- *                          item_embed,
- *                          lr,
+ *             sparse_indices,
+ *             sparse_indptr,
+ *             user_embed,             # <<<<<<<<<<<<<<
+ *             item_embed,
+ *             lr,
  */
-    __pyx_t_27 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_user_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_27.memview)) __PYX_ERR(0, 95, __pyx_L1_error)
+    __pyx_t_20 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_user_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_20.memview)) __PYX_ERR(0, 95, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":96
- *                          sparse_indptr,
- *                          user_embed,
- *                          item_embed,             # <<<<<<<<<<<<<<
- *                          lr,
- *                          reg,
+ *             sparse_indptr,
+ *             user_embed,
+ *             item_embed,             # <<<<<<<<<<<<<<
+ *             lr,
+ *             reg,
  */
-    __pyx_t_26 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_item_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_26.memview)) __PYX_ERR(0, 96, __pyx_L1_error)
+    __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_item_embed, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 96, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":97
- *                          user_embed,
- *                          item_embed,
- *                          lr,             # <<<<<<<<<<<<<<
- *                          reg,
- *                          n_users,
+ *             user_embed,
+ *             item_embed,
+ *             lr,             # <<<<<<<<<<<<<<
+ *             reg,
+ *             n_users,
  */
-    __pyx_t_28 = __pyx_PyFloat_AsDouble(__pyx_v_lr); if (unlikely((__pyx_t_28 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
+    __pyx_t_21 = __pyx_PyFloat_AsDouble(__pyx_v_lr); if (unlikely((__pyx_t_21 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":98
- *                          item_embed,
- *                          lr,
- *                          reg,             # <<<<<<<<<<<<<<
- *                          n_users,
- *                          n_items,
+ *             item_embed,
+ *             lr,
+ *             reg,             # <<<<<<<<<<<<<<
+ *             n_users,
+ *             n_items,
  */
-    __pyx_t_17 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_17 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 98, __pyx_L1_error)
+    __pyx_t_9 = __pyx_PyFloat_AsDouble(__pyx_v_reg); if (unlikely((__pyx_t_9 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 98, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":99
- *                          lr,
- *                          reg,
- *                          n_users,             # <<<<<<<<<<<<<<
- *                          n_items,
- *                          u_1st_mom,
+ *             lr,
+ *             reg,
+ *             n_users,             # <<<<<<<<<<<<<<
+ *             n_items,
+ *             u_1st_mom,
  */
-    __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_v_n_users); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 99, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_n_users); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 99, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":100
- *                          reg,
- *                          n_users,
- *                          n_items,             # <<<<<<<<<<<<<<
- *                          u_1st_mom,
- *                          i_1st_mom,
+ *             reg,
+ *             n_users,
+ *             n_items,             # <<<<<<<<<<<<<<
+ *             u_1st_mom,
+ *             i_1st_mom,
  */
-    __pyx_t_19 = __Pyx_PyInt_As_int(__pyx_v_n_items); if (unlikely((__pyx_t_19 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 100, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_v_n_items); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 100, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":101
- *                          n_users,
- *                          n_items,
- *                          u_1st_mom,             # <<<<<<<<<<<<<<
- *                          i_1st_mom,
- *                          u_2nd_mom,
+ *             n_users,
+ *             n_items,
+ *             u_1st_mom,             # <<<<<<<<<<<<<<
+ *             i_1st_mom,
+ *             u_2nd_mom,
  */
-    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_u_1st_mom, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_u_1st_mom, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 101, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":102
- *                          n_items,
- *                          u_1st_mom,
- *                          i_1st_mom,             # <<<<<<<<<<<<<<
- *                          u_2nd_mom,
- *                          i_2nd_mom,
+ *             n_items,
+ *             u_1st_mom,
+ *             i_1st_mom,             # <<<<<<<<<<<<<<
+ *             u_2nd_mom,
+ *             i_2nd_mom,
  */
-    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_i_1st_mom, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 102, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_i_1st_mom, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 102, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":103
- *                          u_1st_mom,
- *                          i_1st_mom,
- *                          u_2nd_mom,             # <<<<<<<<<<<<<<
- *                          i_2nd_mom,
- *                          rho1,
+ *             u_1st_mom,
+ *             i_1st_mom,
+ *             u_2nd_mom,             # <<<<<<<<<<<<<<
+ *             i_2nd_mom,
+ *             rho1,
  */
-    __pyx_t_33 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_u_2nd_mom, PyBUF_WRITABLE); if (unlikely(!__pyx_t_33.memview)) __PYX_ERR(0, 103, __pyx_L1_error)
+    __pyx_t_26 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_u_2nd_mom, PyBUF_WRITABLE); if (unlikely(!__pyx_t_26.memview)) __PYX_ERR(0, 103, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":104
- *                          i_1st_mom,
- *                          u_2nd_mom,
- *                          i_2nd_mom,             # <<<<<<<<<<<<<<
- *                          rho1,
- *                          rho2,
+ *             i_1st_mom,
+ *             u_2nd_mom,
+ *             i_2nd_mom,             # <<<<<<<<<<<<<<
+ *             rho1,
+ *             rho2,
  */
-    __pyx_t_34 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_i_2nd_mom, PyBUF_WRITABLE); if (unlikely(!__pyx_t_34.memview)) __PYX_ERR(0, 104, __pyx_L1_error)
+    __pyx_t_27 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_float(__pyx_v_i_2nd_mom, PyBUF_WRITABLE); if (unlikely(!__pyx_t_27.memview)) __PYX_ERR(0, 104, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":105
- *                          u_2nd_mom,
- *                          i_2nd_mom,
- *                          rho1,             # <<<<<<<<<<<<<<
- *                          rho2,
- *                          epoch,
+ *             u_2nd_mom,
+ *             i_2nd_mom,
+ *             rho1,             # <<<<<<<<<<<<<<
+ *             rho2,
+ *             epoch,
  */
-    __pyx_t_18 = __pyx_PyFloat_AsDouble(__pyx_v_rho1); if (unlikely((__pyx_t_18 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 105, __pyx_L1_error)
+    __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_v_rho1); if (unlikely((__pyx_t_10 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 105, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":106
- *                          i_2nd_mom,
- *                          rho1,
- *                          rho2,             # <<<<<<<<<<<<<<
- *                          epoch,
- *                          num_threads,
+ *             i_2nd_mom,
+ *             rho1,
+ *             rho2,             # <<<<<<<<<<<<<<
+ *             epoch,
+ *             num_threads,
  */
-    __pyx_t_35 = __pyx_PyFloat_AsDouble(__pyx_v_rho2); if (unlikely((__pyx_t_35 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 106, __pyx_L1_error)
+    __pyx_t_28 = __pyx_PyFloat_AsDouble(__pyx_v_rho2); if (unlikely((__pyx_t_28 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 106, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":107
- *                          rho1,
- *                          rho2,
- *                          epoch,             # <<<<<<<<<<<<<<
- *                          num_threads,
- *                          seed)
+ *             rho1,
+ *             rho2,
+ *             epoch,             # <<<<<<<<<<<<<<
+ *             num_threads,
+ *             seed,
  */
-    __pyx_t_20 = __Pyx_PyInt_As_int(__pyx_v_epoch); if (unlikely((__pyx_t_20 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 107, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_As_int(__pyx_v_epoch); if (unlikely((__pyx_t_13 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 107, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":108
- *                          rho2,
- *                          epoch,
- *                          num_threads,             # <<<<<<<<<<<<<<
- *                          seed)
- * 
+ *             rho2,
+ *             epoch,
+ *             num_threads,             # <<<<<<<<<<<<<<
+ *             seed,
+ *         )
  */
-    __pyx_t_21 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_21 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 108, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_As_int(__pyx_v_num_threads); if (unlikely((__pyx_t_14 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 108, __pyx_L1_error)
 
     /* "libreco/algorithms/_bpr.pyx":109
- *                          epoch,
- *                          num_threads,
- *                          seed)             # <<<<<<<<<<<<<<
- * 
+ *             epoch,
+ *             num_threads,
+ *             seed,             # <<<<<<<<<<<<<<
+ *         )
  * 
  */
-    __pyx_t_36 = __Pyx_PyInt_As_int(__pyx_v_seed); if (unlikely((__pyx_t_36 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 109, __pyx_L1_error)
+    __pyx_t_29 = __Pyx_PyInt_As_int(__pyx_v_seed); if (unlikely((__pyx_t_29 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 109, __pyx_L1_error)
 
-    /* "libreco/algorithms/_bpr.pyx":91
- * 
+    /* "libreco/algorithms/_bpr.pyx":90
+ *         )
  *     elif optimizer == "adam":
- *         _bpr_update_adam(user_indices,             # <<<<<<<<<<<<<<
- *                          item_indices,
- *                          sparse_indices,
- */
-    __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_adam(__pyx_t_29, __pyx_t_30, __pyx_t_31, __pyx_t_32, __pyx_t_27, __pyx_t_26, __pyx_t_28, __pyx_t_17, __pyx_t_8, __pyx_t_19, __pyx_t_15, __pyx_t_16, __pyx_t_33, __pyx_t_34, __pyx_t_18, __pyx_t_35, __pyx_t_20, __pyx_t_21, __pyx_t_36);
-    __PYX_XDEC_MEMVIEW(&__pyx_t_29, 1);
-    __pyx_t_29.memview = NULL;
-    __pyx_t_29.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_30, 1);
-    __pyx_t_30.memview = NULL;
-    __pyx_t_30.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_31, 1);
-    __pyx_t_31.memview = NULL;
-    __pyx_t_31.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_32, 1);
-    __pyx_t_32.memview = NULL;
-    __pyx_t_32.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_27, 1);
-    __pyx_t_27.memview = NULL;
-    __pyx_t_27.data = NULL;
+ *         _bpr_update_adam(             # <<<<<<<<<<<<<<
+ *             user_indices,
+ *             item_indices,
+ */
+    __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_adam(__pyx_t_22, __pyx_t_23, __pyx_t_24, __pyx_t_25, __pyx_t_20, __pyx_t_19, __pyx_t_21, __pyx_t_9, __pyx_t_11, __pyx_t_12, __pyx_t_7, __pyx_t_8, __pyx_t_26, __pyx_t_27, __pyx_t_10, __pyx_t_28, __pyx_t_13, __pyx_t_14, __pyx_t_29);
+    __PYX_XDEC_MEMVIEW(&__pyx_t_22, 1);
+    __pyx_t_22.memview = NULL;
+    __pyx_t_22.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_23, 1);
+    __pyx_t_23.memview = NULL;
+    __pyx_t_23.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_24, 1);
+    __pyx_t_24.memview = NULL;
+    __pyx_t_24.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_25, 1);
+    __pyx_t_25.memview = NULL;
+    __pyx_t_25.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_20, 1);
+    __pyx_t_20.memview = NULL;
+    __pyx_t_20.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_19, 1);
+    __pyx_t_19.memview = NULL;
+    __pyx_t_19.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
+    __pyx_t_7.memview = NULL;
+    __pyx_t_7.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
+    __pyx_t_8.memview = NULL;
+    __pyx_t_8.data = NULL;
     __PYX_XDEC_MEMVIEW(&__pyx_t_26, 1);
     __pyx_t_26.memview = NULL;
     __pyx_t_26.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_15, 1);
-    __pyx_t_15.memview = NULL;
-    __pyx_t_15.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_16, 1);
-    __pyx_t_16.memview = NULL;
-    __pyx_t_16.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_33, 1);
-    __pyx_t_33.memview = NULL;
-    __pyx_t_33.data = NULL;
-    __PYX_XDEC_MEMVIEW(&__pyx_t_34, 1);
-    __pyx_t_34.memview = NULL;
-    __pyx_t_34.data = NULL;
+    __PYX_XDEC_MEMVIEW(&__pyx_t_27, 1);
+    __pyx_t_27.memview = NULL;
+    __pyx_t_27.data = NULL;
 
-    /* "libreco/algorithms/_bpr.pyx":90
- *                              seed)
- * 
+    /* "libreco/algorithms/_bpr.pyx":89
+ *             seed,
+ *         )
  *     elif optimizer == "adam":             # <<<<<<<<<<<<<<
- *         _bpr_update_adam(user_indices,
- *                          item_indices,
+ *         _bpr_update_adam(
+ *             user_indices,
  */
   }
-  __pyx_L8:;
+  __pyx_L3:;
 
-  /* "libreco/algorithms/_bpr.pyx":35
+  /* "libreco/algorithms/_bpr.pyx":30
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cpdef bpr_update(optimizer, train_data, user_embed, item_embed, lr, reg,             # <<<<<<<<<<<<<<
- *                  n_users, n_items, shuffle, num_threads, seed, epoch,
- *                  u_velocity=None, i_velocity=None, momentum=0.9,
+ * cpdef bpr_update(             # <<<<<<<<<<<<<<
+ *     optimizer,
+ *     user_indices,
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_9);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_11, 1);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_12, 1);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_13, 1);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_14, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_3, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_4, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_5, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_6, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_t_15, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_t_16, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_17, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_18, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_19, 1);
+  __PYX_XDEC_MEMVIEW(&__pyx_t_20, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_t_22, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_t_23, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_t_24, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_t_25, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_t_26, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_t_27, 1);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_29, 1);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_30, 1);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_31, 1);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_32, 1);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_33, 1);
-  __PYX_XDEC_MEMVIEW(&__pyx_t_34, 1);
   __Pyx_AddTraceback("libreco.algorithms._bpr.bpr_update", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_user_indices);
-  __Pyx_XDECREF(__pyx_v_item_indices);
-  __Pyx_XDECREF(__pyx_v_sparse_interaction);
   __Pyx_XDECREF(__pyx_v_sparse_indices);
   __Pyx_XDECREF(__pyx_v_sparse_indptr);
-  __Pyx_XDECREF(__pyx_v_reg);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_7libreco_10algorithms_4_bpr_1bpr_update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static PyObject *__pyx_pw_7libreco_10algorithms_4_bpr_1bpr_update(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_optimizer = 0;
-  PyObject *__pyx_v_train_data = 0;
+  PyObject *__pyx_v_user_indices = 0;
+  PyObject *__pyx_v_item_indices = 0;
+  PyObject *__pyx_v_sparse_interaction = 0;
   PyObject *__pyx_v_user_embed = 0;
   PyObject *__pyx_v_item_embed = 0;
   PyObject *__pyx_v_lr = 0;
   PyObject *__pyx_v_reg = 0;
   PyObject *__pyx_v_n_users = 0;
   PyObject *__pyx_v_n_items = 0;
-  PyObject *__pyx_v_shuffle = 0;
   PyObject *__pyx_v_num_threads = 0;
   PyObject *__pyx_v_seed = 0;
   PyObject *__pyx_v_epoch = 0;
   PyObject *__pyx_v_u_velocity = 0;
   PyObject *__pyx_v_i_velocity = 0;
   PyObject *__pyx_v_momentum = 0;
   PyObject *__pyx_v_u_1st_mom = 0;
@@ -4028,53 +3179,79 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("bpr_update (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_optimizer,&__pyx_n_s_train_data,&__pyx_n_s_user_embed,&__pyx_n_s_item_embed,&__pyx_n_s_lr,&__pyx_n_s_reg,&__pyx_n_s_n_users,&__pyx_n_s_n_items,&__pyx_n_s_shuffle,&__pyx_n_s_num_threads,&__pyx_n_s_seed,&__pyx_n_s_epoch,&__pyx_n_s_u_velocity,&__pyx_n_s_i_velocity,&__pyx_n_s_momentum,&__pyx_n_s_u_1st_mom,&__pyx_n_s_i_1st_mom,&__pyx_n_s_u_2nd_mom,&__pyx_n_s_i_2nd_mom,&__pyx_n_s_rho1,&__pyx_n_s_rho2,0};
-    PyObject* values[21] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_optimizer,&__pyx_n_s_user_indices,&__pyx_n_s_item_indices,&__pyx_n_s_sparse_interaction,&__pyx_n_s_user_embed,&__pyx_n_s_item_embed,&__pyx_n_s_lr,&__pyx_n_s_reg,&__pyx_n_s_n_users,&__pyx_n_s_n_items,&__pyx_n_s_num_threads,&__pyx_n_s_seed,&__pyx_n_s_epoch,&__pyx_n_s_u_velocity,&__pyx_n_s_i_velocity,&__pyx_n_s_momentum,&__pyx_n_s_u_1st_mom,&__pyx_n_s_i_1st_mom,&__pyx_n_s_u_2nd_mom,&__pyx_n_s_i_2nd_mom,&__pyx_n_s_rho1,&__pyx_n_s_rho2,0};
+    PyObject* values[22] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
 
-    /* "libreco/algorithms/_bpr.pyx":37
- * cpdef bpr_update(optimizer, train_data, user_embed, item_embed, lr, reg,
- *                  n_users, n_items, shuffle, num_threads, seed, epoch,
- *                  u_velocity=None, i_velocity=None, momentum=0.9,             # <<<<<<<<<<<<<<
- *                  u_1st_mom=None, i_1st_mom=None, u_2nd_mom=None,
- *                  i_2nd_mom=None, rho1=0.9, rho2=0.999):
+    /* "libreco/algorithms/_bpr.pyx":44
+ *     seed,
+ *     epoch,
+ *     u_velocity=None,             # <<<<<<<<<<<<<<
+ *     i_velocity=None,
+ *     momentum=0.9,
  */
-    values[12] = ((PyObject *)Py_None);
     values[13] = ((PyObject *)Py_None);
-    values[14] = ((PyObject *)__pyx_float_0_9);
 
-    /* "libreco/algorithms/_bpr.pyx":38
- *                  n_users, n_items, shuffle, num_threads, seed, epoch,
- *                  u_velocity=None, i_velocity=None, momentum=0.9,
- *                  u_1st_mom=None, i_1st_mom=None, u_2nd_mom=None,             # <<<<<<<<<<<<<<
- *                  i_2nd_mom=None, rho1=0.9, rho2=0.999):
- * 
+    /* "libreco/algorithms/_bpr.pyx":45
+ *     epoch,
+ *     u_velocity=None,
+ *     i_velocity=None,             # <<<<<<<<<<<<<<
+ *     momentum=0.9,
+ *     u_1st_mom=None,
+ */
+    values[14] = ((PyObject *)Py_None);
+    values[15] = ((PyObject *)__pyx_float_0_9);
+
+    /* "libreco/algorithms/_bpr.pyx":47
+ *     i_velocity=None,
+ *     momentum=0.9,
+ *     u_1st_mom=None,             # <<<<<<<<<<<<<<
+ *     i_1st_mom=None,
+ *     u_2nd_mom=None,
  */
-    values[15] = ((PyObject *)Py_None);
     values[16] = ((PyObject *)Py_None);
+
+    /* "libreco/algorithms/_bpr.pyx":48
+ *     momentum=0.9,
+ *     u_1st_mom=None,
+ *     i_1st_mom=None,             # <<<<<<<<<<<<<<
+ *     u_2nd_mom=None,
+ *     i_2nd_mom=None,
+ */
     values[17] = ((PyObject *)Py_None);
 
-    /* "libreco/algorithms/_bpr.pyx":39
- *                  u_velocity=None, i_velocity=None, momentum=0.9,
- *                  u_1st_mom=None, i_1st_mom=None, u_2nd_mom=None,
- *                  i_2nd_mom=None, rho1=0.9, rho2=0.999):             # <<<<<<<<<<<<<<
- * 
- *     if train_data.has_sampled:
+    /* "libreco/algorithms/_bpr.pyx":49
+ *     u_1st_mom=None,
+ *     i_1st_mom=None,
+ *     u_2nd_mom=None,             # <<<<<<<<<<<<<<
+ *     i_2nd_mom=None,
+ *     rho1=0.9,
  */
     values[18] = ((PyObject *)Py_None);
-    values[19] = ((PyObject *)__pyx_float_0_9);
-    values[20] = ((PyObject *)__pyx_float_0_999);
+
+    /* "libreco/algorithms/_bpr.pyx":50
+ *     i_1st_mom=None,
+ *     u_2nd_mom=None,
+ *     i_2nd_mom=None,             # <<<<<<<<<<<<<<
+ *     rho1=0.9,
+ *     rho2=0.999,
+ */
+    values[19] = ((PyObject *)Py_None);
+    values[20] = ((PyObject *)__pyx_float_0_9);
+    values[21] = ((PyObject *)__pyx_float_0_999);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
+        case 22: values[21] = PyTuple_GET_ITEM(__pyx_args, 21);
+        CYTHON_FALLTHROUGH;
         case 21: values[20] = PyTuple_GET_ITEM(__pyx_args, 20);
         CYTHON_FALLTHROUGH;
         case 20: values[19] = PyTuple_GET_ITEM(__pyx_args, 19);
         CYTHON_FALLTHROUGH;
         case 19: values[18] = PyTuple_GET_ITEM(__pyx_args, 18);
         CYTHON_FALLTHROUGH;
         case 18: values[17] = PyTuple_GET_ITEM(__pyx_args, 17);
@@ -4119,138 +3296,146 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_optimizer)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_train_data)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_user_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, 1); __PYX_ERR(0, 35, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 1); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
-        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_user_embed)) != 0)) kw_args--;
+        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_item_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, 2); __PYX_ERR(0, 35, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 2); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
-        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_item_embed)) != 0)) kw_args--;
+        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_sparse_interaction)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, 3); __PYX_ERR(0, 35, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 3); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
-        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lr)) != 0)) kw_args--;
+        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_user_embed)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, 4); __PYX_ERR(0, 35, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 4); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
-        if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_reg)) != 0)) kw_args--;
+        if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_item_embed)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, 5); __PYX_ERR(0, 35, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 5); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
-        if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n_users)) != 0)) kw_args--;
+        if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, 6); __PYX_ERR(0, 35, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 6); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  7:
-        if (likely((values[7] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n_items)) != 0)) kw_args--;
+        if (likely((values[7] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_reg)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, 7); __PYX_ERR(0, 35, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 7); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  8:
-        if (likely((values[8] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_shuffle)) != 0)) kw_args--;
+        if (likely((values[8] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n_users)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, 8); __PYX_ERR(0, 35, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 8); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  9:
-        if (likely((values[9] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_num_threads)) != 0)) kw_args--;
+        if (likely((values[9] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n_items)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, 9); __PYX_ERR(0, 35, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 9); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case 10:
-        if (likely((values[10] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_seed)) != 0)) kw_args--;
+        if (likely((values[10] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_num_threads)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, 10); __PYX_ERR(0, 35, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 10); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case 11:
-        if (likely((values[11] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_epoch)) != 0)) kw_args--;
+        if (likely((values[11] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_seed)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, 11); __PYX_ERR(0, 35, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 11); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case 12:
-        if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_u_velocity);
-          if (value) { values[12] = value; kw_args--; }
+        if (likely((values[12] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_epoch)) != 0)) kw_args--;
+        else {
+          __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, 12); __PYX_ERR(0, 30, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case 13:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_velocity);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_u_velocity);
           if (value) { values[13] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case 14:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_momentum);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_velocity);
           if (value) { values[14] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case 15:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_u_1st_mom);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_momentum);
           if (value) { values[15] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case 16:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_1st_mom);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_u_1st_mom);
           if (value) { values[16] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case 17:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_u_2nd_mom);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_1st_mom);
           if (value) { values[17] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case 18:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_2nd_mom);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_u_2nd_mom);
           if (value) { values[18] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case 19:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rho1);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_2nd_mom);
           if (value) { values[19] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case 20:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rho2);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rho1);
           if (value) { values[20] = value; kw_args--; }
         }
+        CYTHON_FALLTHROUGH;
+        case 21:
+        if (kw_args > 0) {
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rho2);
+          if (value) { values[21] = value; kw_args--; }
+        }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "bpr_update") < 0)) __PYX_ERR(0, 35, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "bpr_update") < 0)) __PYX_ERR(0, 30, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
+        case 22: values[21] = PyTuple_GET_ITEM(__pyx_args, 21);
+        CYTHON_FALLTHROUGH;
         case 21: values[20] = PyTuple_GET_ITEM(__pyx_args, 20);
         CYTHON_FALLTHROUGH;
         case 20: values[19] = PyTuple_GET_ITEM(__pyx_args, 19);
         CYTHON_FALLTHROUGH;
         case 19: values[18] = PyTuple_GET_ITEM(__pyx_args, 18);
         CYTHON_FALLTHROUGH;
         case 18: values[17] = PyTuple_GET_ITEM(__pyx_args, 17);
@@ -4260,16 +3445,15 @@
         case 16: values[15] = PyTuple_GET_ITEM(__pyx_args, 15);
         CYTHON_FALLTHROUGH;
         case 15: values[14] = PyTuple_GET_ITEM(__pyx_args, 14);
         CYTHON_FALLTHROUGH;
         case 14: values[13] = PyTuple_GET_ITEM(__pyx_args, 13);
         CYTHON_FALLTHROUGH;
         case 13: values[12] = PyTuple_GET_ITEM(__pyx_args, 12);
-        CYTHON_FALLTHROUGH;
-        case 12: values[11] = PyTuple_GET_ITEM(__pyx_args, 11);
+        values[11] = PyTuple_GET_ITEM(__pyx_args, 11);
         values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
         values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
         values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
         values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
         values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
         values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
@@ -4278,59 +3462,60 @@
         values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_optimizer = values[0];
-    __pyx_v_train_data = values[1];
-    __pyx_v_user_embed = values[2];
-    __pyx_v_item_embed = values[3];
-    __pyx_v_lr = values[4];
-    __pyx_v_reg = values[5];
-    __pyx_v_n_users = values[6];
-    __pyx_v_n_items = values[7];
-    __pyx_v_shuffle = values[8];
-    __pyx_v_num_threads = values[9];
-    __pyx_v_seed = values[10];
-    __pyx_v_epoch = values[11];
-    __pyx_v_u_velocity = values[12];
-    __pyx_v_i_velocity = values[13];
-    __pyx_v_momentum = values[14];
-    __pyx_v_u_1st_mom = values[15];
-    __pyx_v_i_1st_mom = values[16];
-    __pyx_v_u_2nd_mom = values[17];
-    __pyx_v_i_2nd_mom = values[18];
-    __pyx_v_rho1 = values[19];
-    __pyx_v_rho2 = values[20];
+    __pyx_v_user_indices = values[1];
+    __pyx_v_item_indices = values[2];
+    __pyx_v_sparse_interaction = values[3];
+    __pyx_v_user_embed = values[4];
+    __pyx_v_item_embed = values[5];
+    __pyx_v_lr = values[6];
+    __pyx_v_reg = values[7];
+    __pyx_v_n_users = values[8];
+    __pyx_v_n_items = values[9];
+    __pyx_v_num_threads = values[10];
+    __pyx_v_seed = values[11];
+    __pyx_v_epoch = values[12];
+    __pyx_v_u_velocity = values[13];
+    __pyx_v_i_velocity = values[14];
+    __pyx_v_momentum = values[15];
+    __pyx_v_u_1st_mom = values[16];
+    __pyx_v_i_1st_mom = values[17];
+    __pyx_v_u_2nd_mom = values[18];
+    __pyx_v_i_2nd_mom = values[19];
+    __pyx_v_rho1 = values[20];
+    __pyx_v_rho2 = values[21];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 12, 21, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 35, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("bpr_update", 0, 13, 22, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 30, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("libreco.algorithms._bpr.bpr_update", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_7libreco_10algorithms_4_bpr_bpr_update(__pyx_self, __pyx_v_optimizer, __pyx_v_train_data, __pyx_v_user_embed, __pyx_v_item_embed, __pyx_v_lr, __pyx_v_reg, __pyx_v_n_users, __pyx_v_n_items, __pyx_v_shuffle, __pyx_v_num_threads, __pyx_v_seed, __pyx_v_epoch, __pyx_v_u_velocity, __pyx_v_i_velocity, __pyx_v_momentum, __pyx_v_u_1st_mom, __pyx_v_i_1st_mom, __pyx_v_u_2nd_mom, __pyx_v_i_2nd_mom, __pyx_v_rho1, __pyx_v_rho2);
+  __pyx_r = __pyx_pf_7libreco_10algorithms_4_bpr_bpr_update(__pyx_self, __pyx_v_optimizer, __pyx_v_user_indices, __pyx_v_item_indices, __pyx_v_sparse_interaction, __pyx_v_user_embed, __pyx_v_item_embed, __pyx_v_lr, __pyx_v_reg, __pyx_v_n_users, __pyx_v_n_items, __pyx_v_num_threads, __pyx_v_seed, __pyx_v_epoch, __pyx_v_u_velocity, __pyx_v_i_velocity, __pyx_v_momentum, __pyx_v_u_1st_mom, __pyx_v_i_1st_mom, __pyx_v_u_2nd_mom, __pyx_v_i_2nd_mom, __pyx_v_rho1, __pyx_v_rho2);
 
-  /* "libreco/algorithms/_bpr.pyx":35
+  /* "libreco/algorithms/_bpr.pyx":30
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cpdef bpr_update(optimizer, train_data, user_embed, item_embed, lr, reg,             # <<<<<<<<<<<<<<
- *                  n_users, n_items, shuffle, num_threads, seed, epoch,
- *                  u_velocity=None, i_velocity=None, momentum=0.9,
+ * cpdef bpr_update(             # <<<<<<<<<<<<<<
+ *     optimizer,
+ *     user_indices,
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_7libreco_10algorithms_4_bpr_bpr_update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_optimizer, PyObject *__pyx_v_train_data, PyObject *__pyx_v_user_embed, PyObject *__pyx_v_item_embed, PyObject *__pyx_v_lr, PyObject *__pyx_v_reg, PyObject *__pyx_v_n_users, PyObject *__pyx_v_n_items, PyObject *__pyx_v_shuffle, PyObject *__pyx_v_num_threads, PyObject *__pyx_v_seed, PyObject *__pyx_v_epoch, PyObject *__pyx_v_u_velocity, PyObject *__pyx_v_i_velocity, PyObject *__pyx_v_momentum, PyObject *__pyx_v_u_1st_mom, PyObject *__pyx_v_i_1st_mom, PyObject *__pyx_v_u_2nd_mom, PyObject *__pyx_v_i_2nd_mom, PyObject *__pyx_v_rho1, PyObject *__pyx_v_rho2) {
+static PyObject *__pyx_pf_7libreco_10algorithms_4_bpr_bpr_update(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_optimizer, PyObject *__pyx_v_user_indices, PyObject *__pyx_v_item_indices, PyObject *__pyx_v_sparse_interaction, PyObject *__pyx_v_user_embed, PyObject *__pyx_v_item_embed, PyObject *__pyx_v_lr, PyObject *__pyx_v_reg, PyObject *__pyx_v_n_users, PyObject *__pyx_v_n_items, PyObject *__pyx_v_num_threads, PyObject *__pyx_v_seed, PyObject *__pyx_v_epoch, PyObject *__pyx_v_u_velocity, PyObject *__pyx_v_i_velocity, PyObject *__pyx_v_momentum, PyObject *__pyx_v_u_1st_mom, PyObject *__pyx_v_i_1st_mom, PyObject *__pyx_v_u_2nd_mom, PyObject *__pyx_v_i_2nd_mom, PyObject *__pyx_v_rho1, PyObject *__pyx_v_rho2) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   struct __pyx_opt_args_7libreco_10algorithms_4_bpr_bpr_update __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
@@ -4342,15 +3527,15 @@
   __pyx_t_2.momentum = __pyx_v_momentum;
   __pyx_t_2.u_1st_mom = __pyx_v_u_1st_mom;
   __pyx_t_2.i_1st_mom = __pyx_v_i_1st_mom;
   __pyx_t_2.u_2nd_mom = __pyx_v_u_2nd_mom;
   __pyx_t_2.i_2nd_mom = __pyx_v_i_2nd_mom;
   __pyx_t_2.rho1 = __pyx_v_rho1;
   __pyx_t_2.rho2 = __pyx_v_rho2;
-  __pyx_t_1 = __pyx_f_7libreco_10algorithms_4_bpr_bpr_update(__pyx_v_optimizer, __pyx_v_train_data, __pyx_v_user_embed, __pyx_v_item_embed, __pyx_v_lr, __pyx_v_reg, __pyx_v_n_users, __pyx_v_n_items, __pyx_v_shuffle, __pyx_v_num_threads, __pyx_v_seed, __pyx_v_epoch, 0, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 35, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_7libreco_10algorithms_4_bpr_bpr_update(__pyx_v_optimizer, __pyx_v_user_indices, __pyx_v_item_indices, __pyx_v_sparse_interaction, __pyx_v_user_embed, __pyx_v_item_embed, __pyx_v_lr, __pyx_v_reg, __pyx_v_n_users, __pyx_v_n_items, __pyx_v_num_threads, __pyx_v_seed, __pyx_v_epoch, 0, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -4359,20 +3544,20 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "libreco/algorithms/_bpr.pyx":115
+/* "libreco/algorithms/_bpr.pyx":116
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef void _bpr_update_sgd(const int[:] user_indices,             # <<<<<<<<<<<<<<
- *                           const int[:] item_indices,
- *                           const int[:] sparse_indices,
+ * cdef void _bpr_update_sgd(             # <<<<<<<<<<<<<<
+ *     const int[:] user_indices,
+ *     const int[:] item_indices,
  */
 
 static void __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_sgd(__Pyx_memviewslice __pyx_v_user_indices, __Pyx_memviewslice __pyx_v_item_indices, __Pyx_memviewslice __pyx_v_sparse_indices, __Pyx_memviewslice __pyx_v_sparse_indptr, __Pyx_memviewslice __pyx_v_user_embed, __Pyx_memviewslice __pyx_v_item_embed, double __pyx_v_lr, double __pyx_v_reg, CYTHON_UNUSED int __pyx_v_n_users, int __pyx_v_n_items, int __pyx_v_num_threads, int __pyx_v_seed) {
   Py_ssize_t __pyx_v_i;
   Py_ssize_t __pyx_v_j;
   Py_ssize_t __pyx_v_t;
   Py_ssize_t __pyx_v_random_seed;
@@ -4408,87 +3593,87 @@
   int __pyx_t_12;
   Py_ssize_t __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_bpr_update_sgd", 0);
 
-  /* "libreco/algorithms/_bpr.pyx":129
- * 
+  /* "libreco/algorithms/_bpr.pyx":131
+ * ):
  *     cdef Py_ssize_t i, j, t, random_seed, user, item_pos, item_neg
  *     cdef int length = len(user_indices), embed_size = user_embed.shape[1] - 1             # <<<<<<<<<<<<<<
  *     cdef float item_diff, log_sigmoid_grad
  *     cdef float user_grad, item_pos_grad, item_neg_grad
  */
   __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_user_indices); 
   __pyx_v_length = __pyx_t_1;
   __pyx_v_embed_size = ((__pyx_v_user_embed.shape[1]) - 1);
 
-  /* "libreco/algorithms/_bpr.pyx":132
+  /* "libreco/algorithms/_bpr.pyx":134
  *     cdef float item_diff, log_sigmoid_grad
  *     cdef float user_grad, item_pos_grad, item_neg_grad
  *     cdef long lower_bound = 0, upper_bound = n_items - 1             # <<<<<<<<<<<<<<
  * 
  *     cdef float *user_embed_ptr
  */
   __pyx_v_lower_bound = 0;
   __pyx_v_upper_bound = (__pyx_v_n_items - 1);
 
-  /* "libreco/algorithms/_bpr.pyx":141
+  /* "libreco/algorithms/_bpr.pyx":143
  *     cdef vector[uniform_int_distribution[long]] dist
  * 
  *     for i in range(num_threads):             # <<<<<<<<<<<<<<
  *         random_seed = (seed + i * 11) % 7
  *         rng.push_back(mt19937(random_seed))
  */
   __pyx_t_2 = __pyx_v_num_threads;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_i = __pyx_t_4;
 
-    /* "libreco/algorithms/_bpr.pyx":142
+    /* "libreco/algorithms/_bpr.pyx":144
  * 
  *     for i in range(num_threads):
  *         random_seed = (seed + i * 11) % 7             # <<<<<<<<<<<<<<
  *         rng.push_back(mt19937(random_seed))
- *         dist.push_back(uniform_int_distribution[long](
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
  */
     __pyx_v_random_seed = ((__pyx_v_seed + (__pyx_v_i * 11)) % 7);
 
-    /* "libreco/algorithms/_bpr.pyx":143
+    /* "libreco/algorithms/_bpr.pyx":145
  *     for i in range(num_threads):
  *         random_seed = (seed + i * 11) % 7
  *         rng.push_back(mt19937(random_seed))             # <<<<<<<<<<<<<<
- *         dist.push_back(uniform_int_distribution[long](
- *             lower_bound, upper_bound))
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
+ * 
  */
     try {
       __pyx_v_rng.push_back(std::mt19937(__pyx_v_random_seed));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 143, __pyx_L1_error)
+      __PYX_ERR(0, 145, __pyx_L1_error)
     }
 
-    /* "libreco/algorithms/_bpr.pyx":144
+    /* "libreco/algorithms/_bpr.pyx":146
  *         random_seed = (seed + i * 11) % 7
  *         rng.push_back(mt19937(random_seed))
- *         dist.push_back(uniform_int_distribution[long](             # <<<<<<<<<<<<<<
- *             lower_bound, upper_bound))
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))             # <<<<<<<<<<<<<<
  * 
+ *     with nogil, parallel(num_threads=num_threads):
  */
     try {
       __pyx_v_dist.push_back(std::uniform_int_distribution<long> (__pyx_v_lower_bound, __pyx_v_upper_bound));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 144, __pyx_L1_error)
+      __PYX_ERR(0, 146, __pyx_L1_error)
     }
   }
 
-  /* "libreco/algorithms/_bpr.pyx":147
- *             lower_bound, upper_bound))
+  /* "libreco/algorithms/_bpr.pyx":148
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
  * 
  *     with nogil, parallel(num_threads=num_threads):             # <<<<<<<<<<<<<<
  *         for i in prange(length):
  *             t = i % num_threads
  */
   {
       #ifdef WITH_THREAD
@@ -4505,15 +3690,15 @@
                 #define unlikely(x) (x)
             #endif
             #ifdef _OPENMP
             #pragma omp parallel  private(__pyx_t_10, __pyx_t_11, __pyx_t_12, __pyx_t_13, __pyx_t_2, __pyx_t_3, __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9) num_threads(__pyx_v_num_threads)
             #endif /* _OPENMP */
             {
 
-                /* "libreco/algorithms/_bpr.pyx":148
+                /* "libreco/algorithms/_bpr.pyx":149
  * 
  *     with nogil, parallel(num_threads=num_threads):
  *         for i in prange(length):             # <<<<<<<<<<<<<<
  *             t = i % num_threads
  *             user = user_indices[i]
  */
                 __pyx_t_2 = __pyx_v_length;
@@ -4539,74 +3724,66 @@
                                 __pyx_v_j = ((Py_ssize_t)0xbad0bad0);
                                 __pyx_v_log_sigmoid_grad = ((float)__PYX_NAN());
                                 __pyx_v_t = ((Py_ssize_t)0xbad0bad0);
                                 __pyx_v_user = ((Py_ssize_t)0xbad0bad0);
                                 __pyx_v_user_embed_ptr = ((float *)1);
                                 __pyx_v_user_grad = ((float)__PYX_NAN());
 
-                                /* "libreco/algorithms/_bpr.pyx":149
+                                /* "libreco/algorithms/_bpr.pyx":150
  *     with nogil, parallel(num_threads=num_threads):
  *         for i in prange(length):
  *             t = i % num_threads             # <<<<<<<<<<<<<<
  *             user = user_indices[i]
  *             item_pos = item_indices[i]
  */
                                 __pyx_v_t = (__pyx_v_i % __pyx_v_num_threads);
 
-                                /* "libreco/algorithms/_bpr.pyx":150
+                                /* "libreco/algorithms/_bpr.pyx":151
  *         for i in prange(length):
  *             t = i % num_threads
  *             user = user_indices[i]             # <<<<<<<<<<<<<<
  *             item_pos = item_indices[i]
  *             item_neg = dist[t](rng[t])
  */
                                 __pyx_t_6 = __pyx_v_i;
                                 __pyx_v_user = (*((int const  *) ( /* dim=0 */ (__pyx_v_user_indices.data + __pyx_t_6 * __pyx_v_user_indices.strides[0]) )));
 
-                                /* "libreco/algorithms/_bpr.pyx":151
+                                /* "libreco/algorithms/_bpr.pyx":152
  *             t = i % num_threads
  *             user = user_indices[i]
  *             item_pos = item_indices[i]             # <<<<<<<<<<<<<<
  *             item_neg = dist[t](rng[t])
- *             while check_consumed(sparse_indices, sparse_indptr,
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
  */
                                 __pyx_t_6 = __pyx_v_i;
                                 __pyx_v_item_pos = (*((int const  *) ( /* dim=0 */ (__pyx_v_item_indices.data + __pyx_t_6 * __pyx_v_item_indices.strides[0]) )));
 
-                                /* "libreco/algorithms/_bpr.pyx":152
+                                /* "libreco/algorithms/_bpr.pyx":153
  *             user = user_indices[i]
  *             item_pos = item_indices[i]
  *             item_neg = dist[t](rng[t])             # <<<<<<<<<<<<<<
- *             while check_consumed(sparse_indices, sparse_indptr,
- *                                  user, item_neg):
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
+ *                 item_neg = dist[t](rng[t])
  */
                                 __pyx_v_item_neg = (__pyx_v_dist[__pyx_v_t])((__pyx_v_rng[__pyx_v_t]));
 
-                                /* "libreco/algorithms/_bpr.pyx":153
+                                /* "libreco/algorithms/_bpr.pyx":154
  *             item_pos = item_indices[i]
  *             item_neg = dist[t](rng[t])
- *             while check_consumed(sparse_indices, sparse_indptr,             # <<<<<<<<<<<<<<
- *                                  user, item_neg):
- *                 item_neg = dist[t](rng[t])
- */
-                                while (1) {
-
-                                  /* "libreco/algorithms/_bpr.pyx":154
- *             item_neg = dist[t](rng[t])
- *             while check_consumed(sparse_indices, sparse_indptr,
- *                                  user, item_neg):             # <<<<<<<<<<<<<<
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):             # <<<<<<<<<<<<<<
  *                 item_neg = dist[t](rng[t])
  * 
  */
+                                while (1) {
                                   __pyx_t_7 = (__pyx_f_7libreco_10algorithms_4_bpr_check_consumed(__pyx_v_sparse_indices, __pyx_v_sparse_indptr, __pyx_v_user, __pyx_v_item_neg) != 0);
                                   if (!__pyx_t_7) break;
 
                                   /* "libreco/algorithms/_bpr.pyx":155
- *             while check_consumed(sparse_indices, sparse_indptr,
- *                                  user, item_neg):
+ *             item_neg = dist[t](rng[t])
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
  *                 item_neg = dist[t](rng[t])             # <<<<<<<<<<<<<<
  * 
  *             user_embed_ptr = &user_embed[user, 0]
  */
                                   __pyx_v_item_neg = (__pyx_v_dist[__pyx_v_t])((__pyx_v_rng[__pyx_v_t]));
                                 }
 
@@ -4653,142 +3830,142 @@
                                 __pyx_v_item_diff = 0.0;
 
                                 /* "libreco/algorithms/_bpr.pyx":162
  * 
  *             item_diff = 0
  *             for j in range(embed_size + 1):             # <<<<<<<<<<<<<<
  *                 item_diff = item_diff + user_embed_ptr[j] * (
- *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
+ *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
  */
                                 __pyx_t_9 = (__pyx_v_embed_size + 1);
                                 __pyx_t_10 = __pyx_t_9;
                                 for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                                   __pyx_v_j = __pyx_t_11;
 
                                   /* "libreco/algorithms/_bpr.pyx":163
  *             item_diff = 0
  *             for j in range(embed_size + 1):
  *                 item_diff = item_diff + user_embed_ptr[j] * (             # <<<<<<<<<<<<<<
- *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
- *             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))
+ *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
+ *                 )
  */
                                   __pyx_v_item_diff = (__pyx_v_item_diff + ((__pyx_v_user_embed_ptr[__pyx_v_j]) * ((__pyx_v_item_pos_embed_ptr[__pyx_v_j]) - (__pyx_v_item_neg_embed_ptr[__pyx_v_j]))));
                                 }
 
-                                /* "libreco/algorithms/_bpr.pyx":165
- *                 item_diff = item_diff + user_embed_ptr[j] * (
- *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
+                                /* "libreco/algorithms/_bpr.pyx":166
+ *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
+ *                 )
  *             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))             # <<<<<<<<<<<<<<
  * 
  *             for j in range(embed_size):
  */
                                 __pyx_v_log_sigmoid_grad = (1.0 / (1.0 + exp(__pyx_v_item_diff)));
 
-                                /* "libreco/algorithms/_bpr.pyx":167
+                                /* "libreco/algorithms/_bpr.pyx":168
  *             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))
  * 
  *             for j in range(embed_size):             # <<<<<<<<<<<<<<
  *                 user_grad = log_sigmoid_grad * (
  *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
  */
                                 __pyx_t_3 = __pyx_v_embed_size;
                                 __pyx_t_12 = __pyx_t_3;
                                 for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_12; __pyx_t_11+=1) {
                                   __pyx_v_j = __pyx_t_11;
 
-                                  /* "libreco/algorithms/_bpr.pyx":170
+                                  /* "libreco/algorithms/_bpr.pyx":171
  *                 user_grad = log_sigmoid_grad * (
  *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
  *                 ) - reg * user_embed_ptr[j]             # <<<<<<<<<<<<<<
  *                 item_pos_grad = (
  *                     log_sigmoid_grad * user_embed_ptr[j]
  */
                                   __pyx_v_user_grad = ((__pyx_v_log_sigmoid_grad * ((__pyx_v_item_pos_embed_ptr[__pyx_v_j]) - (__pyx_v_item_neg_embed_ptr[__pyx_v_j]))) - (__pyx_v_reg * (__pyx_v_user_embed_ptr[__pyx_v_j])));
 
-                                  /* "libreco/algorithms/_bpr.pyx":173
+                                  /* "libreco/algorithms/_bpr.pyx":174
  *                 item_pos_grad = (
  *                     log_sigmoid_grad * user_embed_ptr[j]
  *                     - reg * item_pos_embed_ptr[j]             # <<<<<<<<<<<<<<
  *                 )
  *                 item_neg_grad = (
  */
                                   __pyx_v_item_pos_grad = ((__pyx_v_log_sigmoid_grad * (__pyx_v_user_embed_ptr[__pyx_v_j])) - (__pyx_v_reg * (__pyx_v_item_pos_embed_ptr[__pyx_v_j])));
 
-                                  /* "libreco/algorithms/_bpr.pyx":177
+                                  /* "libreco/algorithms/_bpr.pyx":178
  *                 item_neg_grad = (
  *                     - log_sigmoid_grad * user_embed_ptr[j]
  *                     - reg * item_neg_embed_ptr[j]             # <<<<<<<<<<<<<<
  *                 )
  * 
  */
                                   __pyx_v_item_neg_grad = (((-__pyx_v_log_sigmoid_grad) * (__pyx_v_user_embed_ptr[__pyx_v_j])) - (__pyx_v_reg * (__pyx_v_item_neg_embed_ptr[__pyx_v_j])));
 
-                                  /* "libreco/algorithms/_bpr.pyx":180
+                                  /* "libreco/algorithms/_bpr.pyx":181
  *                 )
  * 
  *                 user_embed_ptr[j] += lr * user_grad             # <<<<<<<<<<<<<<
  *                 item_pos_embed_ptr[j] += lr * item_pos_grad
  *                 item_neg_embed_ptr[j] += lr * item_neg_grad
  */
                                   __pyx_t_13 = __pyx_v_j;
                                   (__pyx_v_user_embed_ptr[__pyx_t_13]) = ((__pyx_v_user_embed_ptr[__pyx_t_13]) + (__pyx_v_lr * __pyx_v_user_grad));
 
-                                  /* "libreco/algorithms/_bpr.pyx":181
+                                  /* "libreco/algorithms/_bpr.pyx":182
  * 
  *                 user_embed_ptr[j] += lr * user_grad
  *                 item_pos_embed_ptr[j] += lr * item_pos_grad             # <<<<<<<<<<<<<<
  *                 item_neg_embed_ptr[j] += lr * item_neg_grad
  * 
  */
                                   __pyx_t_13 = __pyx_v_j;
                                   (__pyx_v_item_pos_embed_ptr[__pyx_t_13]) = ((__pyx_v_item_pos_embed_ptr[__pyx_t_13]) + (__pyx_v_lr * __pyx_v_item_pos_grad));
 
-                                  /* "libreco/algorithms/_bpr.pyx":182
+                                  /* "libreco/algorithms/_bpr.pyx":183
  *                 user_embed_ptr[j] += lr * user_grad
  *                 item_pos_embed_ptr[j] += lr * item_pos_grad
  *                 item_neg_embed_ptr[j] += lr * item_neg_grad             # <<<<<<<<<<<<<<
  * 
  *             item_pos_embed_ptr[embed_size] += lr * (
  */
                                   __pyx_t_13 = __pyx_v_j;
                                   (__pyx_v_item_neg_embed_ptr[__pyx_t_13]) = ((__pyx_v_item_neg_embed_ptr[__pyx_t_13]) + (__pyx_v_lr * __pyx_v_item_neg_grad));
                                 }
 
-                                /* "libreco/algorithms/_bpr.pyx":184
+                                /* "libreco/algorithms/_bpr.pyx":185
  *                 item_neg_embed_ptr[j] += lr * item_neg_grad
  * 
  *             item_pos_embed_ptr[embed_size] += lr * (             # <<<<<<<<<<<<<<
- *                 log_sigmoid_grad - reg * item_pos_embed_ptr[embed_size])
- *             item_neg_embed_ptr[embed_size] += lr * (
+ *                 log_sigmoid_grad - reg * item_pos_embed_ptr[embed_size]
+ *             )
  */
                                 __pyx_t_3 = __pyx_v_embed_size;
 
-                                /* "libreco/algorithms/_bpr.pyx":185
+                                /* "libreco/algorithms/_bpr.pyx":186
  * 
  *             item_pos_embed_ptr[embed_size] += lr * (
- *                 log_sigmoid_grad - reg * item_pos_embed_ptr[embed_size])             # <<<<<<<<<<<<<<
+ *                 log_sigmoid_grad - reg * item_pos_embed_ptr[embed_size]             # <<<<<<<<<<<<<<
+ *             )
  *             item_neg_embed_ptr[embed_size] += lr * (
- *                 -log_sigmoid_grad - reg * item_neg_embed_ptr[embed_size])
  */
                                 (__pyx_v_item_pos_embed_ptr[__pyx_t_3]) = ((__pyx_v_item_pos_embed_ptr[__pyx_t_3]) + (__pyx_v_lr * (__pyx_v_log_sigmoid_grad - (__pyx_v_reg * (__pyx_v_item_pos_embed_ptr[__pyx_v_embed_size])))));
 
-                                /* "libreco/algorithms/_bpr.pyx":186
- *             item_pos_embed_ptr[embed_size] += lr * (
- *                 log_sigmoid_grad - reg * item_pos_embed_ptr[embed_size])
+                                /* "libreco/algorithms/_bpr.pyx":188
+ *                 log_sigmoid_grad - reg * item_pos_embed_ptr[embed_size]
+ *             )
  *             item_neg_embed_ptr[embed_size] += lr * (             # <<<<<<<<<<<<<<
- *                 -log_sigmoid_grad - reg * item_neg_embed_ptr[embed_size])
- * 
+ *                 -log_sigmoid_grad - reg * item_neg_embed_ptr[embed_size]
+ *             )
  */
                                 __pyx_t_3 = __pyx_v_embed_size;
 
-                                /* "libreco/algorithms/_bpr.pyx":187
- *                 log_sigmoid_grad - reg * item_pos_embed_ptr[embed_size])
+                                /* "libreco/algorithms/_bpr.pyx":189
+ *             )
  *             item_neg_embed_ptr[embed_size] += lr * (
- *                 -log_sigmoid_grad - reg * item_neg_embed_ptr[embed_size])             # <<<<<<<<<<<<<<
- * 
+ *                 -log_sigmoid_grad - reg * item_neg_embed_ptr[embed_size]             # <<<<<<<<<<<<<<
+ *             )
  * 
  */
                                 (__pyx_v_item_neg_embed_ptr[__pyx_t_3]) = ((__pyx_v_item_neg_embed_ptr[__pyx_t_3]) + (__pyx_v_lr * ((-__pyx_v_log_sigmoid_grad) - (__pyx_v_reg * (__pyx_v_item_neg_embed_ptr[__pyx_v_embed_size])))));
                             }
                         }
                     }
                 }
@@ -4798,16 +3975,16 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "libreco/algorithms/_bpr.pyx":147
- *             lower_bound, upper_bound))
+      /* "libreco/algorithms/_bpr.pyx":148
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
  * 
  *     with nogil, parallel(num_threads=num_threads):             # <<<<<<<<<<<<<<
  *         for i in prange(length):
  *             t = i % num_threads
  */
       /*finally:*/ {
         /*normal exit:*/{
@@ -4817,36 +3994,36 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "libreco/algorithms/_bpr.pyx":115
+  /* "libreco/algorithms/_bpr.pyx":116
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef void _bpr_update_sgd(const int[:] user_indices,             # <<<<<<<<<<<<<<
- *                           const int[:] item_indices,
- *                           const int[:] sparse_indices,
+ * cdef void _bpr_update_sgd(             # <<<<<<<<<<<<<<
+ *     const int[:] user_indices,
+ *     const int[:] item_indices,
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("libreco.algorithms._bpr._bpr_update_sgd", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "libreco/algorithms/_bpr.pyx":193
+/* "libreco/algorithms/_bpr.pyx":196
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef void _bpr_update_momentum(const int[:] user_indices,             # <<<<<<<<<<<<<<
- *                                const int[:] item_indices,
- *                                const int[:] sparse_indices,
+ * cdef void _bpr_update_momentum(             # <<<<<<<<<<<<<<
+ *     const int[:] user_indices,
+ *     const int[:] item_indices,
  */
 
 static void __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_momentum(__Pyx_memviewslice __pyx_v_user_indices, __Pyx_memviewslice __pyx_v_item_indices, __Pyx_memviewslice __pyx_v_sparse_indices, __Pyx_memviewslice __pyx_v_sparse_indptr, __Pyx_memviewslice __pyx_v_user_embed, __Pyx_memviewslice __pyx_v_item_embed, double __pyx_v_lr, double __pyx_v_reg, CYTHON_UNUSED int __pyx_v_n_users, int __pyx_v_n_items, __Pyx_memviewslice __pyx_v_u_velocity, __Pyx_memviewslice __pyx_v_i_velocity, double __pyx_v_momentum, int __pyx_v_num_threads, int __pyx_v_seed) {
   Py_ssize_t __pyx_v_i;
   Py_ssize_t __pyx_v_j;
   Py_ssize_t __pyx_v_t;
   Py_ssize_t __pyx_v_random_seed;
@@ -4884,87 +4061,87 @@
   Py_ssize_t __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_bpr_update_momentum", 0);
 
-  /* "libreco/algorithms/_bpr.pyx":210
- * 
+  /* "libreco/algorithms/_bpr.pyx":214
+ * ):
  *     cdef Py_ssize_t i, j, t, random_seed, user, item_pos, item_neg
  *     cdef int length = len(user_indices), embed_size = user_embed.shape[1] - 1             # <<<<<<<<<<<<<<
  *     cdef float item_diff, log_sigmoid_grad
  *     cdef float user_grad, item_pos_grad, item_neg_grad
  */
   __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_user_indices); 
   __pyx_v_length = __pyx_t_1;
   __pyx_v_embed_size = ((__pyx_v_user_embed.shape[1]) - 1);
 
-  /* "libreco/algorithms/_bpr.pyx":213
+  /* "libreco/algorithms/_bpr.pyx":217
  *     cdef float item_diff, log_sigmoid_grad
  *     cdef float user_grad, item_pos_grad, item_neg_grad
  *     cdef long lower_bound = 0, upper_bound = n_items - 1             # <<<<<<<<<<<<<<
  * 
  *     cdef float *user_embed_ptr
  */
   __pyx_v_lower_bound = 0;
   __pyx_v_upper_bound = (__pyx_v_n_items - 1);
 
-  /* "libreco/algorithms/_bpr.pyx":226
+  /* "libreco/algorithms/_bpr.pyx":230
  *     cdef vector[uniform_int_distribution[long]] dist
  * 
  *     for i in range(num_threads):             # <<<<<<<<<<<<<<
  *         random_seed = (seed + i * 11) % 7
  *         rng.push_back(mt19937(random_seed))
  */
   __pyx_t_2 = __pyx_v_num_threads;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_i = __pyx_t_4;
 
-    /* "libreco/algorithms/_bpr.pyx":227
+    /* "libreco/algorithms/_bpr.pyx":231
  * 
  *     for i in range(num_threads):
  *         random_seed = (seed + i * 11) % 7             # <<<<<<<<<<<<<<
  *         rng.push_back(mt19937(random_seed))
- *         dist.push_back(uniform_int_distribution[long](
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
  */
     __pyx_v_random_seed = ((__pyx_v_seed + (__pyx_v_i * 11)) % 7);
 
-    /* "libreco/algorithms/_bpr.pyx":228
+    /* "libreco/algorithms/_bpr.pyx":232
  *     for i in range(num_threads):
  *         random_seed = (seed + i * 11) % 7
  *         rng.push_back(mt19937(random_seed))             # <<<<<<<<<<<<<<
- *         dist.push_back(uniform_int_distribution[long](
- *             lower_bound, upper_bound))
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
+ * 
  */
     try {
       __pyx_v_rng.push_back(std::mt19937(__pyx_v_random_seed));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 228, __pyx_L1_error)
+      __PYX_ERR(0, 232, __pyx_L1_error)
     }
 
-    /* "libreco/algorithms/_bpr.pyx":229
+    /* "libreco/algorithms/_bpr.pyx":233
  *         random_seed = (seed + i * 11) % 7
  *         rng.push_back(mt19937(random_seed))
- *         dist.push_back(uniform_int_distribution[long](             # <<<<<<<<<<<<<<
- *             lower_bound, upper_bound))
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))             # <<<<<<<<<<<<<<
  * 
+ *     with nogil, parallel(num_threads=num_threads):
  */
     try {
       __pyx_v_dist.push_back(std::uniform_int_distribution<long> (__pyx_v_lower_bound, __pyx_v_upper_bound));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 229, __pyx_L1_error)
+      __PYX_ERR(0, 233, __pyx_L1_error)
     }
   }
 
-  /* "libreco/algorithms/_bpr.pyx":232
- *             lower_bound, upper_bound))
+  /* "libreco/algorithms/_bpr.pyx":235
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
  * 
  *     with nogil, parallel(num_threads=num_threads):             # <<<<<<<<<<<<<<
  *         for i in prange(length):
  *             t = i % num_threads
  */
   {
       #ifdef WITH_THREAD
@@ -4981,15 +4158,15 @@
                 #define unlikely(x) (x)
             #endif
             #ifdef _OPENMP
             #pragma omp parallel  private(__pyx_t_10, __pyx_t_11, __pyx_t_12, __pyx_t_2, __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9) num_threads(__pyx_v_num_threads)
             #endif /* _OPENMP */
             {
 
-                /* "libreco/algorithms/_bpr.pyx":233
+                /* "libreco/algorithms/_bpr.pyx":236
  * 
  *     with nogil, parallel(num_threads=num_threads):
  *         for i in prange(length):             # <<<<<<<<<<<<<<
  *             t = i % num_threads
  *             user = user_indices[i]
  */
                 __pyx_t_2 = __pyx_v_length;
@@ -5018,314 +4195,306 @@
                                 __pyx_v_log_sigmoid_grad = ((float)__PYX_NAN());
                                 __pyx_v_t = ((Py_ssize_t)0xbad0bad0);
                                 __pyx_v_user = ((Py_ssize_t)0xbad0bad0);
                                 __pyx_v_user_embed_ptr = ((float *)1);
                                 __pyx_v_user_embed_v_ptr = ((float *)1);
                                 __pyx_v_user_grad = ((float)__PYX_NAN());
 
-                                /* "libreco/algorithms/_bpr.pyx":234
+                                /* "libreco/algorithms/_bpr.pyx":237
  *     with nogil, parallel(num_threads=num_threads):
  *         for i in prange(length):
  *             t = i % num_threads             # <<<<<<<<<<<<<<
  *             user = user_indices[i]
  *             item_pos = item_indices[i]
  */
                                 __pyx_v_t = (__pyx_v_i % __pyx_v_num_threads);
 
-                                /* "libreco/algorithms/_bpr.pyx":235
+                                /* "libreco/algorithms/_bpr.pyx":238
  *         for i in prange(length):
  *             t = i % num_threads
  *             user = user_indices[i]             # <<<<<<<<<<<<<<
  *             item_pos = item_indices[i]
  *             item_neg = dist[t](rng[t])
  */
                                 __pyx_t_6 = __pyx_v_i;
                                 __pyx_v_user = (*((int const  *) ( /* dim=0 */ (__pyx_v_user_indices.data + __pyx_t_6 * __pyx_v_user_indices.strides[0]) )));
 
-                                /* "libreco/algorithms/_bpr.pyx":236
+                                /* "libreco/algorithms/_bpr.pyx":239
  *             t = i % num_threads
  *             user = user_indices[i]
  *             item_pos = item_indices[i]             # <<<<<<<<<<<<<<
  *             item_neg = dist[t](rng[t])
- *             while check_consumed(sparse_indices, sparse_indptr,
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
  */
                                 __pyx_t_6 = __pyx_v_i;
                                 __pyx_v_item_pos = (*((int const  *) ( /* dim=0 */ (__pyx_v_item_indices.data + __pyx_t_6 * __pyx_v_item_indices.strides[0]) )));
 
-                                /* "libreco/algorithms/_bpr.pyx":237
+                                /* "libreco/algorithms/_bpr.pyx":240
  *             user = user_indices[i]
  *             item_pos = item_indices[i]
  *             item_neg = dist[t](rng[t])             # <<<<<<<<<<<<<<
- *             while check_consumed(sparse_indices, sparse_indptr,
- *                                  user, item_neg):
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
+ *                 item_neg = dist[t](rng[t])
  */
                                 __pyx_v_item_neg = (__pyx_v_dist[__pyx_v_t])((__pyx_v_rng[__pyx_v_t]));
 
-                                /* "libreco/algorithms/_bpr.pyx":238
+                                /* "libreco/algorithms/_bpr.pyx":241
  *             item_pos = item_indices[i]
  *             item_neg = dist[t](rng[t])
- *             while check_consumed(sparse_indices, sparse_indptr,             # <<<<<<<<<<<<<<
- *                                  user, item_neg):
- *                 item_neg = dist[t](rng[t])
- */
-                                while (1) {
-
-                                  /* "libreco/algorithms/_bpr.pyx":239
- *             item_neg = dist[t](rng[t])
- *             while check_consumed(sparse_indices, sparse_indptr,
- *                                  user, item_neg):             # <<<<<<<<<<<<<<
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):             # <<<<<<<<<<<<<<
  *                 item_neg = dist[t](rng[t])
  * 
  */
+                                while (1) {
                                   __pyx_t_7 = (__pyx_f_7libreco_10algorithms_4_bpr_check_consumed(__pyx_v_sparse_indices, __pyx_v_sparse_indptr, __pyx_v_user, __pyx_v_item_neg) != 0);
                                   if (!__pyx_t_7) break;
 
-                                  /* "libreco/algorithms/_bpr.pyx":240
- *             while check_consumed(sparse_indices, sparse_indptr,
- *                                  user, item_neg):
+                                  /* "libreco/algorithms/_bpr.pyx":242
+ *             item_neg = dist[t](rng[t])
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
  *                 item_neg = dist[t](rng[t])             # <<<<<<<<<<<<<<
  * 
  *             user_embed_ptr = &user_embed[user, 0]
  */
                                   __pyx_v_item_neg = (__pyx_v_dist[__pyx_v_t])((__pyx_v_rng[__pyx_v_t]));
                                 }
 
-                                /* "libreco/algorithms/_bpr.pyx":242
+                                /* "libreco/algorithms/_bpr.pyx":244
  *                 item_neg = dist[t](rng[t])
  * 
  *             user_embed_ptr = &user_embed[user, 0]             # <<<<<<<<<<<<<<
  *             item_pos_embed_ptr = &item_embed[item_pos, 0]
  *             item_neg_embed_ptr = &item_embed[item_neg, 0]
  */
                                 __pyx_t_6 = __pyx_v_user;
                                 __pyx_t_8 = 0;
                                 __pyx_v_user_embed_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_user_embed.data + __pyx_t_6 * __pyx_v_user_embed.strides[0]) )) + __pyx_t_8)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":243
+                                /* "libreco/algorithms/_bpr.pyx":245
  * 
  *             user_embed_ptr = &user_embed[user, 0]
  *             item_pos_embed_ptr = &item_embed[item_pos, 0]             # <<<<<<<<<<<<<<
  *             item_neg_embed_ptr = &item_embed[item_neg, 0]
  * 
  */
                                 __pyx_t_8 = __pyx_v_item_pos;
                                 __pyx_t_6 = 0;
                                 __pyx_v_item_pos_embed_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_item_embed.data + __pyx_t_8 * __pyx_v_item_embed.strides[0]) )) + __pyx_t_6)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":244
+                                /* "libreco/algorithms/_bpr.pyx":246
  *             user_embed_ptr = &user_embed[user, 0]
  *             item_pos_embed_ptr = &item_embed[item_pos, 0]
  *             item_neg_embed_ptr = &item_embed[item_neg, 0]             # <<<<<<<<<<<<<<
  * 
  *             user_embed_v_ptr = &u_velocity[user, 0]
  */
                                 __pyx_t_6 = __pyx_v_item_neg;
                                 __pyx_t_8 = 0;
                                 __pyx_v_item_neg_embed_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_item_embed.data + __pyx_t_6 * __pyx_v_item_embed.strides[0]) )) + __pyx_t_8)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":246
+                                /* "libreco/algorithms/_bpr.pyx":248
  *             item_neg_embed_ptr = &item_embed[item_neg, 0]
  * 
  *             user_embed_v_ptr = &u_velocity[user, 0]             # <<<<<<<<<<<<<<
  *             item_pos_embed_v_ptr = &i_velocity[item_pos, 0]
  *             item_neg_embed_v_ptr = &i_velocity[item_neg, 0]
  */
                                 __pyx_t_8 = __pyx_v_user;
                                 __pyx_t_6 = 0;
                                 __pyx_v_user_embed_v_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_u_velocity.data + __pyx_t_8 * __pyx_v_u_velocity.strides[0]) )) + __pyx_t_6)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":247
+                                /* "libreco/algorithms/_bpr.pyx":249
  * 
  *             user_embed_v_ptr = &u_velocity[user, 0]
  *             item_pos_embed_v_ptr = &i_velocity[item_pos, 0]             # <<<<<<<<<<<<<<
  *             item_neg_embed_v_ptr = &i_velocity[item_neg, 0]
  * 
  */
                                 __pyx_t_6 = __pyx_v_item_pos;
                                 __pyx_t_8 = 0;
                                 __pyx_v_item_pos_embed_v_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_i_velocity.data + __pyx_t_6 * __pyx_v_i_velocity.strides[0]) )) + __pyx_t_8)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":248
+                                /* "libreco/algorithms/_bpr.pyx":250
  *             user_embed_v_ptr = &u_velocity[user, 0]
  *             item_pos_embed_v_ptr = &i_velocity[item_pos, 0]
  *             item_neg_embed_v_ptr = &i_velocity[item_neg, 0]             # <<<<<<<<<<<<<<
  * 
  *             item_diff = 0
  */
                                 __pyx_t_8 = __pyx_v_item_neg;
                                 __pyx_t_6 = 0;
                                 __pyx_v_item_neg_embed_v_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_i_velocity.data + __pyx_t_8 * __pyx_v_i_velocity.strides[0]) )) + __pyx_t_6)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":250
+                                /* "libreco/algorithms/_bpr.pyx":252
  *             item_neg_embed_v_ptr = &i_velocity[item_neg, 0]
  * 
  *             item_diff = 0             # <<<<<<<<<<<<<<
  *             for j in range(embed_size + 1):
  *                 item_diff = item_diff + user_embed_ptr[j] * (
  */
                                 __pyx_v_item_diff = 0.0;
 
-                                /* "libreco/algorithms/_bpr.pyx":251
+                                /* "libreco/algorithms/_bpr.pyx":253
  * 
  *             item_diff = 0
  *             for j in range(embed_size + 1):             # <<<<<<<<<<<<<<
  *                 item_diff = item_diff + user_embed_ptr[j] * (
- *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
+ *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
  */
                                 __pyx_t_9 = (__pyx_v_embed_size + 1);
                                 __pyx_t_10 = __pyx_t_9;
                                 for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                                   __pyx_v_j = __pyx_t_11;
 
-                                  /* "libreco/algorithms/_bpr.pyx":252
+                                  /* "libreco/algorithms/_bpr.pyx":254
  *             item_diff = 0
  *             for j in range(embed_size + 1):
  *                 item_diff = item_diff + user_embed_ptr[j] * (             # <<<<<<<<<<<<<<
- *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
- *             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))
+ *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
+ *                 )
  */
                                   __pyx_v_item_diff = (__pyx_v_item_diff + ((__pyx_v_user_embed_ptr[__pyx_v_j]) * ((__pyx_v_item_pos_embed_ptr[__pyx_v_j]) - (__pyx_v_item_neg_embed_ptr[__pyx_v_j]))));
                                 }
 
-                                /* "libreco/algorithms/_bpr.pyx":254
- *                 item_diff = item_diff + user_embed_ptr[j] * (
- *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
+                                /* "libreco/algorithms/_bpr.pyx":257
+ *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
+ *                 )
  *             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))             # <<<<<<<<<<<<<<
  * 
  *             for j in range(embed_size + 1):
  */
                                 __pyx_v_log_sigmoid_grad = (1.0 / (1.0 + exp(__pyx_v_item_diff)));
 
-                                /* "libreco/algorithms/_bpr.pyx":256
+                                /* "libreco/algorithms/_bpr.pyx":259
  *             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))
  * 
  *             for j in range(embed_size + 1):             # <<<<<<<<<<<<<<
  *                 if j < embed_size:
  *                     user_grad = log_sigmoid_grad * (
  */
                                 __pyx_t_9 = (__pyx_v_embed_size + 1);
                                 __pyx_t_10 = __pyx_t_9;
                                 for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                                   __pyx_v_j = __pyx_t_11;
 
-                                  /* "libreco/algorithms/_bpr.pyx":257
+                                  /* "libreco/algorithms/_bpr.pyx":260
  * 
  *             for j in range(embed_size + 1):
  *                 if j < embed_size:             # <<<<<<<<<<<<<<
  *                     user_grad = log_sigmoid_grad * (
  *                         item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
  */
                                   __pyx_t_7 = ((__pyx_v_j < __pyx_v_embed_size) != 0);
                                   if (__pyx_t_7) {
 
-                                    /* "libreco/algorithms/_bpr.pyx":260
+                                    /* "libreco/algorithms/_bpr.pyx":263
  *                     user_grad = log_sigmoid_grad * (
  *                         item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
  *                     ) - reg * user_embed_ptr[j]             # <<<<<<<<<<<<<<
  *                 item_pos_grad = (
  *                     log_sigmoid_grad * user_embed_ptr[j]
  */
                                     __pyx_v_user_grad = ((__pyx_v_log_sigmoid_grad * ((__pyx_v_item_pos_embed_ptr[__pyx_v_j]) - (__pyx_v_item_neg_embed_ptr[__pyx_v_j]))) - (__pyx_v_reg * (__pyx_v_user_embed_ptr[__pyx_v_j])));
 
-                                    /* "libreco/algorithms/_bpr.pyx":257
+                                    /* "libreco/algorithms/_bpr.pyx":260
  * 
  *             for j in range(embed_size + 1):
  *                 if j < embed_size:             # <<<<<<<<<<<<<<
  *                     user_grad = log_sigmoid_grad * (
  *                         item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
  */
                                   }
 
-                                  /* "libreco/algorithms/_bpr.pyx":263
+                                  /* "libreco/algorithms/_bpr.pyx":266
  *                 item_pos_grad = (
  *                     log_sigmoid_grad * user_embed_ptr[j]
  *                     - reg * item_pos_embed_ptr[j]             # <<<<<<<<<<<<<<
  *                 )
  *                 item_neg_grad = (
  */
                                   __pyx_v_item_pos_grad = ((__pyx_v_log_sigmoid_grad * (__pyx_v_user_embed_ptr[__pyx_v_j])) - (__pyx_v_reg * (__pyx_v_item_pos_embed_ptr[__pyx_v_j])));
 
-                                  /* "libreco/algorithms/_bpr.pyx":267
+                                  /* "libreco/algorithms/_bpr.pyx":270
  *                 item_neg_grad = (
  *                     - log_sigmoid_grad * user_embed_ptr[j]
  *                     - reg * item_neg_embed_ptr[j]             # <<<<<<<<<<<<<<
  *                 )
  * 
  */
                                   __pyx_v_item_neg_grad = (((-__pyx_v_log_sigmoid_grad) * (__pyx_v_user_embed_ptr[__pyx_v_j])) - (__pyx_v_reg * (__pyx_v_item_neg_embed_ptr[__pyx_v_j])));
 
-                                  /* "libreco/algorithms/_bpr.pyx":270
+                                  /* "libreco/algorithms/_bpr.pyx":273
  *                 )
  * 
  *                 if j < embed_size:             # <<<<<<<<<<<<<<
- *                     user_embed_v_ptr[j] = (
- *                         momentum * user_embed_v_ptr[j] + lr * user_grad)
+ *                     user_embed_v_ptr[j] = (momentum * user_embed_v_ptr[j] + lr * user_grad)
+ *                     user_embed_ptr[j] += user_embed_v_ptr[j]
  */
                                   __pyx_t_7 = ((__pyx_v_j < __pyx_v_embed_size) != 0);
                                   if (__pyx_t_7) {
 
-                                    /* "libreco/algorithms/_bpr.pyx":271
+                                    /* "libreco/algorithms/_bpr.pyx":274
  * 
  *                 if j < embed_size:
- *                     user_embed_v_ptr[j] = (             # <<<<<<<<<<<<<<
- *                         momentum * user_embed_v_ptr[j] + lr * user_grad)
+ *                     user_embed_v_ptr[j] = (momentum * user_embed_v_ptr[j] + lr * user_grad)             # <<<<<<<<<<<<<<
  *                     user_embed_ptr[j] += user_embed_v_ptr[j]
+ * 
  */
                                     (__pyx_v_user_embed_v_ptr[__pyx_v_j]) = ((__pyx_v_momentum * (__pyx_v_user_embed_v_ptr[__pyx_v_j])) + (__pyx_v_lr * __pyx_v_user_grad));
 
-                                    /* "libreco/algorithms/_bpr.pyx":273
- *                     user_embed_v_ptr[j] = (
- *                         momentum * user_embed_v_ptr[j] + lr * user_grad)
+                                    /* "libreco/algorithms/_bpr.pyx":275
+ *                 if j < embed_size:
+ *                     user_embed_v_ptr[j] = (momentum * user_embed_v_ptr[j] + lr * user_grad)
  *                     user_embed_ptr[j] += user_embed_v_ptr[j]             # <<<<<<<<<<<<<<
  * 
- *                 item_pos_embed_v_ptr[j] = (
+ *                 item_pos_embed_v_ptr[j] = (momentum * item_pos_embed_v_ptr[j] + lr * item_pos_grad)
  */
                                     __pyx_t_12 = __pyx_v_j;
                                     (__pyx_v_user_embed_ptr[__pyx_t_12]) = ((__pyx_v_user_embed_ptr[__pyx_t_12]) + (__pyx_v_user_embed_v_ptr[__pyx_v_j]));
 
-                                    /* "libreco/algorithms/_bpr.pyx":270
+                                    /* "libreco/algorithms/_bpr.pyx":273
  *                 )
  * 
  *                 if j < embed_size:             # <<<<<<<<<<<<<<
- *                     user_embed_v_ptr[j] = (
- *                         momentum * user_embed_v_ptr[j] + lr * user_grad)
+ *                     user_embed_v_ptr[j] = (momentum * user_embed_v_ptr[j] + lr * user_grad)
+ *                     user_embed_ptr[j] += user_embed_v_ptr[j]
  */
                                   }
 
-                                  /* "libreco/algorithms/_bpr.pyx":275
+                                  /* "libreco/algorithms/_bpr.pyx":277
  *                     user_embed_ptr[j] += user_embed_v_ptr[j]
  * 
- *                 item_pos_embed_v_ptr[j] = (             # <<<<<<<<<<<<<<
- *                     momentum * item_pos_embed_v_ptr[j] + lr * item_pos_grad)
+ *                 item_pos_embed_v_ptr[j] = (momentum * item_pos_embed_v_ptr[j] + lr * item_pos_grad)             # <<<<<<<<<<<<<<
  *                 item_pos_embed_ptr[j] += item_pos_embed_v_ptr[j]
+ *                 item_neg_embed_v_ptr[j] = (momentum * item_neg_embed_v_ptr[j] + lr * item_neg_grad)
  */
                                   (__pyx_v_item_pos_embed_v_ptr[__pyx_v_j]) = ((__pyx_v_momentum * (__pyx_v_item_pos_embed_v_ptr[__pyx_v_j])) + (__pyx_v_lr * __pyx_v_item_pos_grad));
 
-                                  /* "libreco/algorithms/_bpr.pyx":277
- *                 item_pos_embed_v_ptr[j] = (
- *                     momentum * item_pos_embed_v_ptr[j] + lr * item_pos_grad)
- *                 item_pos_embed_ptr[j] += item_pos_embed_v_ptr[j]             # <<<<<<<<<<<<<<
+                                  /* "libreco/algorithms/_bpr.pyx":278
  * 
- *                 item_neg_embed_v_ptr[j] = (
+ *                 item_pos_embed_v_ptr[j] = (momentum * item_pos_embed_v_ptr[j] + lr * item_pos_grad)
+ *                 item_pos_embed_ptr[j] += item_pos_embed_v_ptr[j]             # <<<<<<<<<<<<<<
+ *                 item_neg_embed_v_ptr[j] = (momentum * item_neg_embed_v_ptr[j] + lr * item_neg_grad)
+ *                 item_neg_embed_ptr[j] += item_neg_embed_v_ptr[j]
  */
                                   __pyx_t_12 = __pyx_v_j;
                                   (__pyx_v_item_pos_embed_ptr[__pyx_t_12]) = ((__pyx_v_item_pos_embed_ptr[__pyx_t_12]) + (__pyx_v_item_pos_embed_v_ptr[__pyx_v_j]));
 
                                   /* "libreco/algorithms/_bpr.pyx":279
+ *                 item_pos_embed_v_ptr[j] = (momentum * item_pos_embed_v_ptr[j] + lr * item_pos_grad)
  *                 item_pos_embed_ptr[j] += item_pos_embed_v_ptr[j]
- * 
- *                 item_neg_embed_v_ptr[j] = (             # <<<<<<<<<<<<<<
- *                     momentum * item_neg_embed_v_ptr[j] + lr * item_neg_grad)
+ *                 item_neg_embed_v_ptr[j] = (momentum * item_neg_embed_v_ptr[j] + lr * item_neg_grad)             # <<<<<<<<<<<<<<
  *                 item_neg_embed_ptr[j] += item_neg_embed_v_ptr[j]
+ * 
  */
                                   (__pyx_v_item_neg_embed_v_ptr[__pyx_v_j]) = ((__pyx_v_momentum * (__pyx_v_item_neg_embed_v_ptr[__pyx_v_j])) + (__pyx_v_lr * __pyx_v_item_neg_grad));
 
-                                  /* "libreco/algorithms/_bpr.pyx":281
- *                 item_neg_embed_v_ptr[j] = (
- *                     momentum * item_neg_embed_v_ptr[j] + lr * item_neg_grad)
+                                  /* "libreco/algorithms/_bpr.pyx":280
+ *                 item_pos_embed_ptr[j] += item_pos_embed_v_ptr[j]
+ *                 item_neg_embed_v_ptr[j] = (momentum * item_neg_embed_v_ptr[j] + lr * item_neg_grad)
  *                 item_neg_embed_ptr[j] += item_neg_embed_v_ptr[j]             # <<<<<<<<<<<<<<
  * 
  * 
  */
                                   __pyx_t_12 = __pyx_v_j;
                                   (__pyx_v_item_neg_embed_ptr[__pyx_t_12]) = ((__pyx_v_item_neg_embed_ptr[__pyx_t_12]) + (__pyx_v_item_neg_embed_v_ptr[__pyx_v_j]));
                                 }
@@ -5339,16 +4508,16 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "libreco/algorithms/_bpr.pyx":232
- *             lower_bound, upper_bound))
+      /* "libreco/algorithms/_bpr.pyx":235
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
  * 
  *     with nogil, parallel(num_threads=num_threads):             # <<<<<<<<<<<<<<
  *         for i in prange(length):
  *             t = i % num_threads
  */
       /*finally:*/ {
         /*normal exit:*/{
@@ -5358,36 +4527,36 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "libreco/algorithms/_bpr.pyx":193
+  /* "libreco/algorithms/_bpr.pyx":196
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef void _bpr_update_momentum(const int[:] user_indices,             # <<<<<<<<<<<<<<
- *                                const int[:] item_indices,
- *                                const int[:] sparse_indices,
+ * cdef void _bpr_update_momentum(             # <<<<<<<<<<<<<<
+ *     const int[:] user_indices,
+ *     const int[:] item_indices,
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("libreco.algorithms._bpr._bpr_update_momentum", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "libreco/algorithms/_bpr.pyx":287
+/* "libreco/algorithms/_bpr.pyx":286
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef void _bpr_update_adam(const int[:] user_indices,             # <<<<<<<<<<<<<<
- *                            const int[:] item_indices,
- *                            const int[:] sparse_indices,
+ * cdef void _bpr_update_adam(             # <<<<<<<<<<<<<<
+ *     const int[:] user_indices,
+ *     const int[:] item_indices,
  */
 
 static void __pyx_f_7libreco_10algorithms_4_bpr__bpr_update_adam(__Pyx_memviewslice __pyx_v_user_indices, __Pyx_memviewslice __pyx_v_item_indices, __Pyx_memviewslice __pyx_v_sparse_indices, __Pyx_memviewslice __pyx_v_sparse_indptr, __Pyx_memviewslice __pyx_v_user_embed, __Pyx_memviewslice __pyx_v_item_embed, double __pyx_v_lr, double __pyx_v_reg, CYTHON_UNUSED int __pyx_v_n_users, int __pyx_v_n_items, __Pyx_memviewslice __pyx_v_u_1st_mom, __Pyx_memviewslice __pyx_v_i_1st_mom, __Pyx_memviewslice __pyx_v_u_2nd_mom, __Pyx_memviewslice __pyx_v_i_2nd_mom, double __pyx_v_rho1, double __pyx_v_rho2, int __pyx_v_epoch, int __pyx_v_num_threads, int __pyx_v_seed) {
   Py_ssize_t __pyx_v_i;
   Py_ssize_t __pyx_v_j;
   Py_ssize_t __pyx_v_t;
   Py_ssize_t __pyx_v_random_seed;
@@ -5434,15 +4603,15 @@
   Py_ssize_t __pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_bpr_update_adam", 0);
 
   /* "libreco/algorithms/_bpr.pyx":308
- * 
+ * ):
  *     cdef Py_ssize_t i, j, t, random_seed, user, item_pos, item_neg
  *     cdef int length = len(user_indices), embed_size = user_embed.shape[1] - 1             # <<<<<<<<<<<<<<
  *     cdef float item_diff, log_sigmoid_grad
  *     cdef float user_grad, item_pos_grad, item_neg_grad
  */
   __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_user_indices); 
   __pyx_v_length = __pyx_t_1;
@@ -5471,49 +4640,49 @@
     __pyx_v_i = __pyx_t_4;
 
     /* "libreco/algorithms/_bpr.pyx":331
  * 
  *     for i in range(num_threads):
  *         random_seed = (seed + i * 11) % 7             # <<<<<<<<<<<<<<
  *         rng.push_back(mt19937(random_seed))
- *         dist.push_back(uniform_int_distribution[long](
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
  */
     __pyx_v_random_seed = ((__pyx_v_seed + (__pyx_v_i * 11)) % 7);
 
     /* "libreco/algorithms/_bpr.pyx":332
  *     for i in range(num_threads):
  *         random_seed = (seed + i * 11) % 7
  *         rng.push_back(mt19937(random_seed))             # <<<<<<<<<<<<<<
- *         dist.push_back(uniform_int_distribution[long](
- *             lower_bound, upper_bound))
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
+ * 
  */
     try {
       __pyx_v_rng.push_back(std::mt19937(__pyx_v_random_seed));
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 332, __pyx_L1_error)
     }
 
     /* "libreco/algorithms/_bpr.pyx":333
  *         random_seed = (seed + i * 11) % 7
  *         rng.push_back(mt19937(random_seed))
- *         dist.push_back(uniform_int_distribution[long](             # <<<<<<<<<<<<<<
- *             lower_bound, upper_bound))
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))             # <<<<<<<<<<<<<<
  * 
+ *     with nogil, parallel(num_threads=num_threads):
  */
     try {
       __pyx_v_dist.push_back(std::uniform_int_distribution<long> (__pyx_v_lower_bound, __pyx_v_upper_bound));
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 333, __pyx_L1_error)
     }
   }
 
-  /* "libreco/algorithms/_bpr.pyx":336
- *             lower_bound, upper_bound))
+  /* "libreco/algorithms/_bpr.pyx":335
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
  * 
  *     with nogil, parallel(num_threads=num_threads):             # <<<<<<<<<<<<<<
  *         for i in prange(length):
  *             t = i % num_threads
  */
   {
       #ifdef WITH_THREAD
@@ -5530,15 +4699,15 @@
                 #define unlikely(x) (x)
             #endif
             #ifdef _OPENMP
             #pragma omp parallel  private(__pyx_t_10, __pyx_t_11, __pyx_t_2, __pyx_t_4, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9) num_threads(__pyx_v_num_threads)
             #endif /* _OPENMP */
             {
 
-                /* "libreco/algorithms/_bpr.pyx":337
+                /* "libreco/algorithms/_bpr.pyx":336
  * 
  *     with nogil, parallel(num_threads=num_threads):
  *         for i in prange(length):             # <<<<<<<<<<<<<<
  *             t = i % num_threads
  *             user = user_indices[i]
  */
                 __pyx_t_2 = __pyx_v_length;
@@ -5576,429 +4745,421 @@
                                 __pyx_v_unbias_v_user = ((float)__PYX_NAN());
                                 __pyx_v_user = ((Py_ssize_t)0xbad0bad0);
                                 __pyx_v_user_embed_h_ptr = ((float *)1);
                                 __pyx_v_user_embed_ptr = ((float *)1);
                                 __pyx_v_user_embed_v_ptr = ((float *)1);
                                 __pyx_v_user_grad = ((float)__PYX_NAN());
 
-                                /* "libreco/algorithms/_bpr.pyx":338
+                                /* "libreco/algorithms/_bpr.pyx":337
  *     with nogil, parallel(num_threads=num_threads):
  *         for i in prange(length):
  *             t = i % num_threads             # <<<<<<<<<<<<<<
  *             user = user_indices[i]
  *             item_pos = item_indices[i]
  */
                                 __pyx_v_t = (__pyx_v_i % __pyx_v_num_threads);
 
-                                /* "libreco/algorithms/_bpr.pyx":339
+                                /* "libreco/algorithms/_bpr.pyx":338
  *         for i in prange(length):
  *             t = i % num_threads
  *             user = user_indices[i]             # <<<<<<<<<<<<<<
  *             item_pos = item_indices[i]
  *             item_neg = dist[t](rng[t])
  */
                                 __pyx_t_6 = __pyx_v_i;
                                 __pyx_v_user = (*((int const  *) ( /* dim=0 */ (__pyx_v_user_indices.data + __pyx_t_6 * __pyx_v_user_indices.strides[0]) )));
 
-                                /* "libreco/algorithms/_bpr.pyx":340
+                                /* "libreco/algorithms/_bpr.pyx":339
  *             t = i % num_threads
  *             user = user_indices[i]
  *             item_pos = item_indices[i]             # <<<<<<<<<<<<<<
  *             item_neg = dist[t](rng[t])
- *             while check_consumed(sparse_indices, sparse_indptr,
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
  */
                                 __pyx_t_6 = __pyx_v_i;
                                 __pyx_v_item_pos = (*((int const  *) ( /* dim=0 */ (__pyx_v_item_indices.data + __pyx_t_6 * __pyx_v_item_indices.strides[0]) )));
 
-                                /* "libreco/algorithms/_bpr.pyx":341
+                                /* "libreco/algorithms/_bpr.pyx":340
  *             user = user_indices[i]
  *             item_pos = item_indices[i]
  *             item_neg = dist[t](rng[t])             # <<<<<<<<<<<<<<
- *             while check_consumed(sparse_indices, sparse_indptr,
- *                                  user, item_neg):
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
+ *                 item_neg = dist[t](rng[t])
  */
                                 __pyx_v_item_neg = (__pyx_v_dist[__pyx_v_t])((__pyx_v_rng[__pyx_v_t]));
 
-                                /* "libreco/algorithms/_bpr.pyx":342
+                                /* "libreco/algorithms/_bpr.pyx":341
  *             item_pos = item_indices[i]
  *             item_neg = dist[t](rng[t])
- *             while check_consumed(sparse_indices, sparse_indptr,             # <<<<<<<<<<<<<<
- *                                  user, item_neg):
- *                 item_neg = dist[t](rng[t])
- */
-                                while (1) {
-
-                                  /* "libreco/algorithms/_bpr.pyx":343
- *             item_neg = dist[t](rng[t])
- *             while check_consumed(sparse_indices, sparse_indptr,
- *                                  user, item_neg):             # <<<<<<<<<<<<<<
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):             # <<<<<<<<<<<<<<
  *                 item_neg = dist[t](rng[t])
  * 
  */
+                                while (1) {
                                   __pyx_t_7 = (__pyx_f_7libreco_10algorithms_4_bpr_check_consumed(__pyx_v_sparse_indices, __pyx_v_sparse_indptr, __pyx_v_user, __pyx_v_item_neg) != 0);
                                   if (!__pyx_t_7) break;
 
-                                  /* "libreco/algorithms/_bpr.pyx":344
- *             while check_consumed(sparse_indices, sparse_indptr,
- *                                  user, item_neg):
+                                  /* "libreco/algorithms/_bpr.pyx":342
+ *             item_neg = dist[t](rng[t])
+ *             while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
  *                 item_neg = dist[t](rng[t])             # <<<<<<<<<<<<<<
  * 
  *             user_embed_ptr = &user_embed[user, 0]
  */
                                   __pyx_v_item_neg = (__pyx_v_dist[__pyx_v_t])((__pyx_v_rng[__pyx_v_t]));
                                 }
 
-                                /* "libreco/algorithms/_bpr.pyx":346
+                                /* "libreco/algorithms/_bpr.pyx":344
  *                 item_neg = dist[t](rng[t])
  * 
  *             user_embed_ptr = &user_embed[user, 0]             # <<<<<<<<<<<<<<
  *             item_pos_embed_ptr = &item_embed[item_pos, 0]
  *             item_neg_embed_ptr = &item_embed[item_neg, 0]
  */
                                 __pyx_t_6 = __pyx_v_user;
                                 __pyx_t_8 = 0;
                                 __pyx_v_user_embed_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_user_embed.data + __pyx_t_6 * __pyx_v_user_embed.strides[0]) )) + __pyx_t_8)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":347
+                                /* "libreco/algorithms/_bpr.pyx":345
  * 
  *             user_embed_ptr = &user_embed[user, 0]
  *             item_pos_embed_ptr = &item_embed[item_pos, 0]             # <<<<<<<<<<<<<<
  *             item_neg_embed_ptr = &item_embed[item_neg, 0]
  * 
  */
                                 __pyx_t_8 = __pyx_v_item_pos;
                                 __pyx_t_6 = 0;
                                 __pyx_v_item_pos_embed_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_item_embed.data + __pyx_t_8 * __pyx_v_item_embed.strides[0]) )) + __pyx_t_6)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":348
+                                /* "libreco/algorithms/_bpr.pyx":346
  *             user_embed_ptr = &user_embed[user, 0]
  *             item_pos_embed_ptr = &item_embed[item_pos, 0]
  *             item_neg_embed_ptr = &item_embed[item_neg, 0]             # <<<<<<<<<<<<<<
  * 
  *             user_embed_v_ptr = &u_1st_mom[user, 0]
  */
                                 __pyx_t_6 = __pyx_v_item_neg;
                                 __pyx_t_8 = 0;
                                 __pyx_v_item_neg_embed_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_item_embed.data + __pyx_t_6 * __pyx_v_item_embed.strides[0]) )) + __pyx_t_8)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":350
+                                /* "libreco/algorithms/_bpr.pyx":348
  *             item_neg_embed_ptr = &item_embed[item_neg, 0]
  * 
  *             user_embed_v_ptr = &u_1st_mom[user, 0]             # <<<<<<<<<<<<<<
  *             user_embed_h_ptr = &u_2nd_mom[user, 0]
  *             item_pos_embed_v_ptr = &i_1st_mom[item_pos, 0]
  */
                                 __pyx_t_8 = __pyx_v_user;
                                 __pyx_t_6 = 0;
                                 __pyx_v_user_embed_v_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_u_1st_mom.data + __pyx_t_8 * __pyx_v_u_1st_mom.strides[0]) )) + __pyx_t_6)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":351
+                                /* "libreco/algorithms/_bpr.pyx":349
  * 
  *             user_embed_v_ptr = &u_1st_mom[user, 0]
  *             user_embed_h_ptr = &u_2nd_mom[user, 0]             # <<<<<<<<<<<<<<
  *             item_pos_embed_v_ptr = &i_1st_mom[item_pos, 0]
  *             item_pos_embed_h_ptr = &i_2nd_mom[item_pos, 0]
  */
                                 __pyx_t_6 = __pyx_v_user;
                                 __pyx_t_8 = 0;
                                 __pyx_v_user_embed_h_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_u_2nd_mom.data + __pyx_t_6 * __pyx_v_u_2nd_mom.strides[0]) )) + __pyx_t_8)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":352
+                                /* "libreco/algorithms/_bpr.pyx":350
  *             user_embed_v_ptr = &u_1st_mom[user, 0]
  *             user_embed_h_ptr = &u_2nd_mom[user, 0]
  *             item_pos_embed_v_ptr = &i_1st_mom[item_pos, 0]             # <<<<<<<<<<<<<<
  *             item_pos_embed_h_ptr = &i_2nd_mom[item_pos, 0]
  *             item_neg_embed_v_ptr = &i_1st_mom[item_neg, 0]
  */
                                 __pyx_t_8 = __pyx_v_item_pos;
                                 __pyx_t_6 = 0;
                                 __pyx_v_item_pos_embed_v_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_i_1st_mom.data + __pyx_t_8 * __pyx_v_i_1st_mom.strides[0]) )) + __pyx_t_6)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":353
+                                /* "libreco/algorithms/_bpr.pyx":351
  *             user_embed_h_ptr = &u_2nd_mom[user, 0]
  *             item_pos_embed_v_ptr = &i_1st_mom[item_pos, 0]
  *             item_pos_embed_h_ptr = &i_2nd_mom[item_pos, 0]             # <<<<<<<<<<<<<<
  *             item_neg_embed_v_ptr = &i_1st_mom[item_neg, 0]
  *             item_neg_embed_h_ptr = &i_2nd_mom[item_neg, 0]
  */
                                 __pyx_t_6 = __pyx_v_item_pos;
                                 __pyx_t_8 = 0;
                                 __pyx_v_item_pos_embed_h_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_i_2nd_mom.data + __pyx_t_6 * __pyx_v_i_2nd_mom.strides[0]) )) + __pyx_t_8)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":354
+                                /* "libreco/algorithms/_bpr.pyx":352
  *             item_pos_embed_v_ptr = &i_1st_mom[item_pos, 0]
  *             item_pos_embed_h_ptr = &i_2nd_mom[item_pos, 0]
  *             item_neg_embed_v_ptr = &i_1st_mom[item_neg, 0]             # <<<<<<<<<<<<<<
  *             item_neg_embed_h_ptr = &i_2nd_mom[item_neg, 0]
  * 
  */
                                 __pyx_t_8 = __pyx_v_item_neg;
                                 __pyx_t_6 = 0;
                                 __pyx_v_item_neg_embed_v_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_i_1st_mom.data + __pyx_t_8 * __pyx_v_i_1st_mom.strides[0]) )) + __pyx_t_6)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":355
+                                /* "libreco/algorithms/_bpr.pyx":353
  *             item_pos_embed_h_ptr = &i_2nd_mom[item_pos, 0]
  *             item_neg_embed_v_ptr = &i_1st_mom[item_neg, 0]
  *             item_neg_embed_h_ptr = &i_2nd_mom[item_neg, 0]             # <<<<<<<<<<<<<<
  * 
  *             item_diff = 0
  */
                                 __pyx_t_6 = __pyx_v_item_neg;
                                 __pyx_t_8 = 0;
                                 __pyx_v_item_neg_embed_h_ptr = (&(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_i_2nd_mom.data + __pyx_t_6 * __pyx_v_i_2nd_mom.strides[0]) )) + __pyx_t_8)) ))));
 
-                                /* "libreco/algorithms/_bpr.pyx":357
+                                /* "libreco/algorithms/_bpr.pyx":355
  *             item_neg_embed_h_ptr = &i_2nd_mom[item_neg, 0]
  * 
  *             item_diff = 0             # <<<<<<<<<<<<<<
  *             for j in range(embed_size + 1):
  *                 item_diff = item_diff + user_embed_ptr[j] * (
  */
                                 __pyx_v_item_diff = 0.0;
 
-                                /* "libreco/algorithms/_bpr.pyx":358
+                                /* "libreco/algorithms/_bpr.pyx":356
  * 
  *             item_diff = 0
  *             for j in range(embed_size + 1):             # <<<<<<<<<<<<<<
  *                 item_diff = item_diff + user_embed_ptr[j] * (
- *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
+ *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
  */
                                 __pyx_t_9 = (__pyx_v_embed_size + 1);
                                 __pyx_t_10 = __pyx_t_9;
                                 for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                                   __pyx_v_j = __pyx_t_11;
 
-                                  /* "libreco/algorithms/_bpr.pyx":359
+                                  /* "libreco/algorithms/_bpr.pyx":357
  *             item_diff = 0
  *             for j in range(embed_size + 1):
  *                 item_diff = item_diff + user_embed_ptr[j] * (             # <<<<<<<<<<<<<<
- *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
- *             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))
+ *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
+ *                 )
  */
                                   __pyx_v_item_diff = (__pyx_v_item_diff + ((__pyx_v_user_embed_ptr[__pyx_v_j]) * ((__pyx_v_item_pos_embed_ptr[__pyx_v_j]) - (__pyx_v_item_neg_embed_ptr[__pyx_v_j]))));
                                 }
 
-                                /* "libreco/algorithms/_bpr.pyx":361
- *                 item_diff = item_diff + user_embed_ptr[j] * (
- *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
+                                /* "libreco/algorithms/_bpr.pyx":360
+ *                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
+ *                 )
  *             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))             # <<<<<<<<<<<<<<
  * 
  *             for j in range(embed_size + 1):
  */
                                 __pyx_v_log_sigmoid_grad = (1.0 / (1.0 + exp(__pyx_v_item_diff)));
 
-                                /* "libreco/algorithms/_bpr.pyx":363
+                                /* "libreco/algorithms/_bpr.pyx":362
  *             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))
  * 
  *             for j in range(embed_size + 1):             # <<<<<<<<<<<<<<
  *                 if j < embed_size:
  *                     user_grad = log_sigmoid_grad * (
  */
                                 __pyx_t_9 = (__pyx_v_embed_size + 1);
                                 __pyx_t_10 = __pyx_t_9;
                                 for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                                   __pyx_v_j = __pyx_t_11;
 
-                                  /* "libreco/algorithms/_bpr.pyx":364
+                                  /* "libreco/algorithms/_bpr.pyx":363
  * 
  *             for j in range(embed_size + 1):
  *                 if j < embed_size:             # <<<<<<<<<<<<<<
  *                     user_grad = log_sigmoid_grad * (
  *                         item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
  */
                                   __pyx_t_7 = ((__pyx_v_j < __pyx_v_embed_size) != 0);
                                   if (__pyx_t_7) {
 
-                                    /* "libreco/algorithms/_bpr.pyx":367
+                                    /* "libreco/algorithms/_bpr.pyx":366
  *                     user_grad = log_sigmoid_grad * (
  *                         item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
  *                     ) - reg * user_embed_ptr[j]             # <<<<<<<<<<<<<<
  *                 item_pos_grad = (
  *                     log_sigmoid_grad * user_embed_ptr[j]
  */
                                     __pyx_v_user_grad = ((__pyx_v_log_sigmoid_grad * ((__pyx_v_item_pos_embed_ptr[__pyx_v_j]) - (__pyx_v_item_neg_embed_ptr[__pyx_v_j]))) - (__pyx_v_reg * (__pyx_v_user_embed_ptr[__pyx_v_j])));
 
-                                    /* "libreco/algorithms/_bpr.pyx":364
+                                    /* "libreco/algorithms/_bpr.pyx":363
  * 
  *             for j in range(embed_size + 1):
  *                 if j < embed_size:             # <<<<<<<<<<<<<<
  *                     user_grad = log_sigmoid_grad * (
  *                         item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
  */
                                   }
 
-                                  /* "libreco/algorithms/_bpr.pyx":370
+                                  /* "libreco/algorithms/_bpr.pyx":369
  *                 item_pos_grad = (
  *                     log_sigmoid_grad * user_embed_ptr[j]
  *                     - reg * item_pos_embed_ptr[j]             # <<<<<<<<<<<<<<
  *                 )
  *                 item_neg_grad = (
  */
                                   __pyx_v_item_pos_grad = ((__pyx_v_log_sigmoid_grad * (__pyx_v_user_embed_ptr[__pyx_v_j])) - (__pyx_v_reg * (__pyx_v_item_pos_embed_ptr[__pyx_v_j])));
 
-                                  /* "libreco/algorithms/_bpr.pyx":374
+                                  /* "libreco/algorithms/_bpr.pyx":373
  *                 item_neg_grad = (
  *                     - log_sigmoid_grad * user_embed_ptr[j]
  *                     - reg * item_neg_embed_ptr[j]             # <<<<<<<<<<<<<<
  *                 )
  * 
  */
                                   __pyx_v_item_neg_grad = (((-__pyx_v_log_sigmoid_grad) * (__pyx_v_user_embed_ptr[__pyx_v_j])) - (__pyx_v_reg * (__pyx_v_item_neg_embed_ptr[__pyx_v_j])));
 
-                                  /* "libreco/algorithms/_bpr.pyx":377
+                                  /* "libreco/algorithms/_bpr.pyx":376
  *                 )
  * 
  *                 if j < embed_size:             # <<<<<<<<<<<<<<
- *                     user_embed_v_ptr[j] = rho1 * user_embed_v_ptr[j] + (
- *                         1.0 - rho1) * user_grad
+ *                     user_embed_v_ptr[j] = rho1 * user_embed_v_ptr[j] + (1.0 - rho1) * user_grad
+ *                     user_embed_h_ptr[j] = rho2 * user_embed_h_ptr[j] + (1.0 - rho2) * cpow(user_grad, 2)
  */
                                   __pyx_t_7 = ((__pyx_v_j < __pyx_v_embed_size) != 0);
                                   if (__pyx_t_7) {
 
-                                    /* "libreco/algorithms/_bpr.pyx":378
+                                    /* "libreco/algorithms/_bpr.pyx":377
  * 
  *                 if j < embed_size:
- *                     user_embed_v_ptr[j] = rho1 * user_embed_v_ptr[j] + (             # <<<<<<<<<<<<<<
- *                         1.0 - rho1) * user_grad
- *                     user_embed_h_ptr[j] = rho2 * user_embed_h_ptr[j] + (
+ *                     user_embed_v_ptr[j] = rho1 * user_embed_v_ptr[j] + (1.0 - rho1) * user_grad             # <<<<<<<<<<<<<<
+ *                     user_embed_h_ptr[j] = rho2 * user_embed_h_ptr[j] + (1.0 - rho2) * cpow(user_grad, 2)
+ *                     unbias_v_user = user_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
  */
                                     (__pyx_v_user_embed_v_ptr[__pyx_v_j]) = ((__pyx_v_rho1 * (__pyx_v_user_embed_v_ptr[__pyx_v_j])) + ((1.0 - __pyx_v_rho1) * __pyx_v_user_grad));
 
-                                    /* "libreco/algorithms/_bpr.pyx":380
- *                     user_embed_v_ptr[j] = rho1 * user_embed_v_ptr[j] + (
- *                         1.0 - rho1) * user_grad
- *                     user_embed_h_ptr[j] = rho2 * user_embed_h_ptr[j] + (             # <<<<<<<<<<<<<<
- *                         1.0 - rho2) * cpow(user_grad, 2)
- *                     unbias_v_user = user_embed_v_ptr[j] / (
+                                    /* "libreco/algorithms/_bpr.pyx":378
+ *                 if j < embed_size:
+ *                     user_embed_v_ptr[j] = rho1 * user_embed_v_ptr[j] + (1.0 - rho1) * user_grad
+ *                     user_embed_h_ptr[j] = rho2 * user_embed_h_ptr[j] + (1.0 - rho2) * cpow(user_grad, 2)             # <<<<<<<<<<<<<<
+ *                     unbias_v_user = user_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+ *                     unbias_h_user = user_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
  */
                                     (__pyx_v_user_embed_h_ptr[__pyx_v_j]) = ((__pyx_v_rho2 * (__pyx_v_user_embed_h_ptr[__pyx_v_j])) + ((1.0 - __pyx_v_rho2) * pow(__pyx_v_user_grad, 2.0)));
 
-                                    /* "libreco/algorithms/_bpr.pyx":382
- *                     user_embed_h_ptr[j] = rho2 * user_embed_h_ptr[j] + (
- *                         1.0 - rho2) * cpow(user_grad, 2)
- *                     unbias_v_user = user_embed_v_ptr[j] / (             # <<<<<<<<<<<<<<
- *                         1.0 - cpow(rho1, epoch))
- *                     unbias_h_user = user_embed_h_ptr[j] / (
- */
-                                    __pyx_v_unbias_v_user = ((__pyx_v_user_embed_v_ptr[__pyx_v_j]) / (1.0 - pow(__pyx_v_rho1, __pyx_v_epoch)));
-
-                                    /* "libreco/algorithms/_bpr.pyx":384
- *                     unbias_v_user = user_embed_v_ptr[j] / (
- *                         1.0 - cpow(rho1, epoch))
- *                     unbias_h_user = user_embed_h_ptr[j] / (             # <<<<<<<<<<<<<<
- *                         1.0 - cpow(rho2, epoch))
+                                    /* "libreco/algorithms/_bpr.pyx":379
+ *                     user_embed_v_ptr[j] = rho1 * user_embed_v_ptr[j] + (1.0 - rho1) * user_grad
+ *                     user_embed_h_ptr[j] = rho2 * user_embed_h_ptr[j] + (1.0 - rho2) * cpow(user_grad, 2)
+ *                     unbias_v_user = user_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))             # <<<<<<<<<<<<<<
+ *                     unbias_h_user = user_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
  *                     user_embed_ptr[j] = user_embed_ptr[j] + (
  */
-                                    __pyx_v_unbias_h_user = ((__pyx_v_user_embed_h_ptr[__pyx_v_j]) / (1.0 - pow(__pyx_v_rho2, __pyx_v_epoch)));
+                                    __pyx_v_unbias_v_user = (((double)(__pyx_v_user_embed_v_ptr[__pyx_v_j])) / (1.0 - pow(__pyx_v_rho1, __pyx_v_epoch)));
 
-                                    /* "libreco/algorithms/_bpr.pyx":386
- *                     unbias_h_user = user_embed_h_ptr[j] / (
- *                         1.0 - cpow(rho2, epoch))
+                                    /* "libreco/algorithms/_bpr.pyx":380
+ *                     user_embed_h_ptr[j] = rho2 * user_embed_h_ptr[j] + (1.0 - rho2) * cpow(user_grad, 2)
+ *                     unbias_v_user = user_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+ *                     unbias_h_user = user_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))             # <<<<<<<<<<<<<<
+ *                     user_embed_ptr[j] = user_embed_ptr[j] + (
+ *                         lr * unbias_v_user / (csqrt(unbias_h_user) + 1e-8)
+ */
+                                    __pyx_v_unbias_h_user = (((double)(__pyx_v_user_embed_h_ptr[__pyx_v_j])) / (1.0 - pow(__pyx_v_rho2, __pyx_v_epoch)));
+
+                                    /* "libreco/algorithms/_bpr.pyx":381
+ *                     unbias_v_user = user_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+ *                     unbias_h_user = user_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
  *                     user_embed_ptr[j] = user_embed_ptr[j] + (             # <<<<<<<<<<<<<<
- *                         lr * unbias_v_user / (csqrt(unbias_h_user) + 1e-8))
- * 
+ *                         lr * unbias_v_user / (csqrt(unbias_h_user) + 1e-8)
+ *                     )
  */
                                     (__pyx_v_user_embed_ptr[__pyx_v_j]) = ((__pyx_v_user_embed_ptr[__pyx_v_j]) + ((__pyx_v_lr * __pyx_v_unbias_v_user) / (sqrt(__pyx_v_unbias_h_user) + 1e-8)));
 
-                                    /* "libreco/algorithms/_bpr.pyx":377
+                                    /* "libreco/algorithms/_bpr.pyx":376
  *                 )
  * 
  *                 if j < embed_size:             # <<<<<<<<<<<<<<
- *                     user_embed_v_ptr[j] = rho1 * user_embed_v_ptr[j] + (
- *                         1.0 - rho1) * user_grad
+ *                     user_embed_v_ptr[j] = rho1 * user_embed_v_ptr[j] + (1.0 - rho1) * user_grad
+ *                     user_embed_h_ptr[j] = rho2 * user_embed_h_ptr[j] + (1.0 - rho2) * cpow(user_grad, 2)
  */
                                   }
 
-                                  /* "libreco/algorithms/_bpr.pyx":389
- *                         lr * unbias_v_user / (csqrt(unbias_h_user) + 1e-8))
+                                  /* "libreco/algorithms/_bpr.pyx":385
+ *                     )
  * 
- *                 item_pos_embed_v_ptr[j] = rho1 * item_pos_embed_v_ptr[j] + (             # <<<<<<<<<<<<<<
- *                     1.0 - rho1) * item_pos_grad
- *                 item_pos_embed_h_ptr[j] = rho2 * item_pos_embed_h_ptr[j] + (
+ *                 item_pos_embed_v_ptr[j] = rho1 * item_pos_embed_v_ptr[j] + (1.0 - rho1) * item_pos_grad             # <<<<<<<<<<<<<<
+ *                 item_pos_embed_h_ptr[j] = rho2 * item_pos_embed_h_ptr[j] + (1.0 - rho2) * cpow(item_pos_grad, 2)
+ *                 unbias_v_pos_item = item_pos_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
  */
                                   (__pyx_v_item_pos_embed_v_ptr[__pyx_v_j]) = ((__pyx_v_rho1 * (__pyx_v_item_pos_embed_v_ptr[__pyx_v_j])) + ((1.0 - __pyx_v_rho1) * __pyx_v_item_pos_grad));
 
-                                  /* "libreco/algorithms/_bpr.pyx":391
- *                 item_pos_embed_v_ptr[j] = rho1 * item_pos_embed_v_ptr[j] + (
- *                     1.0 - rho1) * item_pos_grad
- *                 item_pos_embed_h_ptr[j] = rho2 * item_pos_embed_h_ptr[j] + (             # <<<<<<<<<<<<<<
- *                     1.0 - rho2) * cpow(item_pos_grad, 2)
- *                 unbias_v_pos_item = item_pos_embed_v_ptr[j] / (
+                                  /* "libreco/algorithms/_bpr.pyx":386
+ * 
+ *                 item_pos_embed_v_ptr[j] = rho1 * item_pos_embed_v_ptr[j] + (1.0 - rho1) * item_pos_grad
+ *                 item_pos_embed_h_ptr[j] = rho2 * item_pos_embed_h_ptr[j] + (1.0 - rho2) * cpow(item_pos_grad, 2)             # <<<<<<<<<<<<<<
+ *                 unbias_v_pos_item = item_pos_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+ *                 unbias_h_pos_item = item_pos_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
  */
                                   (__pyx_v_item_pos_embed_h_ptr[__pyx_v_j]) = ((__pyx_v_rho2 * (__pyx_v_item_pos_embed_h_ptr[__pyx_v_j])) + ((1.0 - __pyx_v_rho2) * pow(__pyx_v_item_pos_grad, 2.0)));
 
-                                  /* "libreco/algorithms/_bpr.pyx":393
- *                 item_pos_embed_h_ptr[j] = rho2 * item_pos_embed_h_ptr[j] + (
- *                     1.0 - rho2) * cpow(item_pos_grad, 2)
- *                 unbias_v_pos_item = item_pos_embed_v_ptr[j] / (             # <<<<<<<<<<<<<<
- *                     1.0 - cpow(rho1, epoch))
- *                 unbias_h_pos_item = item_pos_embed_h_ptr[j] / (
+                                  /* "libreco/algorithms/_bpr.pyx":387
+ *                 item_pos_embed_v_ptr[j] = rho1 * item_pos_embed_v_ptr[j] + (1.0 - rho1) * item_pos_grad
+ *                 item_pos_embed_h_ptr[j] = rho2 * item_pos_embed_h_ptr[j] + (1.0 - rho2) * cpow(item_pos_grad, 2)
+ *                 unbias_v_pos_item = item_pos_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))             # <<<<<<<<<<<<<<
+ *                 unbias_h_pos_item = item_pos_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
+ *                 item_pos_embed_ptr[j] = item_pos_embed_ptr[j] + (
  */
-                                  __pyx_v_unbias_v_pos_item = ((__pyx_v_item_pos_embed_v_ptr[__pyx_v_j]) / (1.0 - pow(__pyx_v_rho1, __pyx_v_epoch)));
+                                  __pyx_v_unbias_v_pos_item = (((double)(__pyx_v_item_pos_embed_v_ptr[__pyx_v_j])) / (1.0 - pow(__pyx_v_rho1, __pyx_v_epoch)));
 
-                                  /* "libreco/algorithms/_bpr.pyx":395
- *                 unbias_v_pos_item = item_pos_embed_v_ptr[j] / (
- *                     1.0 - cpow(rho1, epoch))
- *                 unbias_h_pos_item = item_pos_embed_h_ptr[j] / (             # <<<<<<<<<<<<<<
- *                     1.0 - cpow(rho2, epoch))
+                                  /* "libreco/algorithms/_bpr.pyx":388
+ *                 item_pos_embed_h_ptr[j] = rho2 * item_pos_embed_h_ptr[j] + (1.0 - rho2) * cpow(item_pos_grad, 2)
+ *                 unbias_v_pos_item = item_pos_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+ *                 unbias_h_pos_item = item_pos_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))             # <<<<<<<<<<<<<<
  *                 item_pos_embed_ptr[j] = item_pos_embed_ptr[j] + (
+ *                     lr * unbias_v_pos_item / (csqrt(unbias_h_pos_item) + 1e-8)
  */
-                                  __pyx_v_unbias_h_pos_item = ((__pyx_v_item_pos_embed_h_ptr[__pyx_v_j]) / (1.0 - pow(__pyx_v_rho2, __pyx_v_epoch)));
+                                  __pyx_v_unbias_h_pos_item = (((double)(__pyx_v_item_pos_embed_h_ptr[__pyx_v_j])) / (1.0 - pow(__pyx_v_rho2, __pyx_v_epoch)));
 
-                                  /* "libreco/algorithms/_bpr.pyx":397
- *                 unbias_h_pos_item = item_pos_embed_h_ptr[j] / (
- *                     1.0 - cpow(rho2, epoch))
+                                  /* "libreco/algorithms/_bpr.pyx":389
+ *                 unbias_v_pos_item = item_pos_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+ *                 unbias_h_pos_item = item_pos_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
  *                 item_pos_embed_ptr[j] = item_pos_embed_ptr[j] + (             # <<<<<<<<<<<<<<
- *                     lr * unbias_v_pos_item / (csqrt(unbias_h_pos_item) + 1e-8))
- * 
+ *                     lr * unbias_v_pos_item / (csqrt(unbias_h_pos_item) + 1e-8)
+ *                 )
  */
                                   (__pyx_v_item_pos_embed_ptr[__pyx_v_j]) = ((__pyx_v_item_pos_embed_ptr[__pyx_v_j]) + ((__pyx_v_lr * __pyx_v_unbias_v_pos_item) / (sqrt(__pyx_v_unbias_h_pos_item) + 1e-8)));
 
-                                  /* "libreco/algorithms/_bpr.pyx":400
- *                     lr * unbias_v_pos_item / (csqrt(unbias_h_pos_item) + 1e-8))
+                                  /* "libreco/algorithms/_bpr.pyx":393
+ *                 )
  * 
- *                 item_neg_embed_v_ptr[j] = rho1 * item_neg_embed_v_ptr[j] + (             # <<<<<<<<<<<<<<
- *                     1.0 - rho1) * item_neg_grad
- *                 item_neg_embed_h_ptr[j] = rho2 * item_neg_embed_h_ptr[j] + (
+ *                 item_neg_embed_v_ptr[j] = rho1 * item_neg_embed_v_ptr[j] + (1.0 - rho1) * item_neg_grad             # <<<<<<<<<<<<<<
+ *                 item_neg_embed_h_ptr[j] = rho2 * item_neg_embed_h_ptr[j] + (1.0 - rho2) * cpow(item_neg_grad, 2)
+ *                 unbias_v_neg_item = item_neg_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
  */
                                   (__pyx_v_item_neg_embed_v_ptr[__pyx_v_j]) = ((__pyx_v_rho1 * (__pyx_v_item_neg_embed_v_ptr[__pyx_v_j])) + ((1.0 - __pyx_v_rho1) * __pyx_v_item_neg_grad));
 
-                                  /* "libreco/algorithms/_bpr.pyx":402
- *                 item_neg_embed_v_ptr[j] = rho1 * item_neg_embed_v_ptr[j] + (
- *                     1.0 - rho1) * item_neg_grad
- *                 item_neg_embed_h_ptr[j] = rho2 * item_neg_embed_h_ptr[j] + (             # <<<<<<<<<<<<<<
- *                     1.0 - rho2) * cpow(item_neg_grad, 2)
- *                 unbias_v_neg_item = item_neg_embed_v_ptr[j] / (
+                                  /* "libreco/algorithms/_bpr.pyx":394
+ * 
+ *                 item_neg_embed_v_ptr[j] = rho1 * item_neg_embed_v_ptr[j] + (1.0 - rho1) * item_neg_grad
+ *                 item_neg_embed_h_ptr[j] = rho2 * item_neg_embed_h_ptr[j] + (1.0 - rho2) * cpow(item_neg_grad, 2)             # <<<<<<<<<<<<<<
+ *                 unbias_v_neg_item = item_neg_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+ *                 unbias_h_neg_item = item_neg_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
  */
                                   (__pyx_v_item_neg_embed_h_ptr[__pyx_v_j]) = ((__pyx_v_rho2 * (__pyx_v_item_neg_embed_h_ptr[__pyx_v_j])) + ((1.0 - __pyx_v_rho2) * pow(__pyx_v_item_neg_grad, 2.0)));
 
-                                  /* "libreco/algorithms/_bpr.pyx":404
- *                 item_neg_embed_h_ptr[j] = rho2 * item_neg_embed_h_ptr[j] + (
- *                     1.0 - rho2) * cpow(item_neg_grad, 2)
- *                 unbias_v_neg_item = item_neg_embed_v_ptr[j] / (             # <<<<<<<<<<<<<<
- *                     1.0 - cpow(rho1, epoch))
- *                 unbias_h_neg_item = item_neg_embed_h_ptr[j] / (
- */
-                                  __pyx_v_unbias_v_neg_item = ((__pyx_v_item_neg_embed_v_ptr[__pyx_v_j]) / (1.0 - pow(__pyx_v_rho1, __pyx_v_epoch)));
-
-                                  /* "libreco/algorithms/_bpr.pyx":406
- *                 unbias_v_neg_item = item_neg_embed_v_ptr[j] / (
- *                     1.0 - cpow(rho1, epoch))
- *                 unbias_h_neg_item = item_neg_embed_h_ptr[j] / (             # <<<<<<<<<<<<<<
- *                     1.0 - cpow(rho2, epoch))
+                                  /* "libreco/algorithms/_bpr.pyx":395
+ *                 item_neg_embed_v_ptr[j] = rho1 * item_neg_embed_v_ptr[j] + (1.0 - rho1) * item_neg_grad
+ *                 item_neg_embed_h_ptr[j] = rho2 * item_neg_embed_h_ptr[j] + (1.0 - rho2) * cpow(item_neg_grad, 2)
+ *                 unbias_v_neg_item = item_neg_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))             # <<<<<<<<<<<<<<
+ *                 unbias_h_neg_item = item_neg_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
+ *                 item_neg_embed_ptr[j] = item_neg_embed_ptr[j] + (
+ */
+                                  __pyx_v_unbias_v_neg_item = (((double)(__pyx_v_item_neg_embed_v_ptr[__pyx_v_j])) / (1.0 - pow(__pyx_v_rho1, __pyx_v_epoch)));
+
+                                  /* "libreco/algorithms/_bpr.pyx":396
+ *                 item_neg_embed_h_ptr[j] = rho2 * item_neg_embed_h_ptr[j] + (1.0 - rho2) * cpow(item_neg_grad, 2)
+ *                 unbias_v_neg_item = item_neg_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+ *                 unbias_h_neg_item = item_neg_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))             # <<<<<<<<<<<<<<
  *                 item_neg_embed_ptr[j] = item_neg_embed_ptr[j] + (
+ *                     lr * unbias_v_neg_item / (csqrt(unbias_h_neg_item) + 1e-8)
  */
-                                  __pyx_v_unbias_h_neg_item = ((__pyx_v_item_neg_embed_h_ptr[__pyx_v_j]) / (1.0 - pow(__pyx_v_rho2, __pyx_v_epoch)));
+                                  __pyx_v_unbias_h_neg_item = (((double)(__pyx_v_item_neg_embed_h_ptr[__pyx_v_j])) / (1.0 - pow(__pyx_v_rho2, __pyx_v_epoch)));
 
-                                  /* "libreco/algorithms/_bpr.pyx":408
- *                 unbias_h_neg_item = item_neg_embed_h_ptr[j] / (
- *                     1.0 - cpow(rho2, epoch))
+                                  /* "libreco/algorithms/_bpr.pyx":397
+ *                 unbias_v_neg_item = item_neg_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+ *                 unbias_h_neg_item = item_neg_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
  *                 item_neg_embed_ptr[j] = item_neg_embed_ptr[j] + (             # <<<<<<<<<<<<<<
- *                     lr * unbias_v_neg_item / (csqrt(unbias_h_neg_item) + 1e-8))
- * 
+ *                     lr * unbias_v_neg_item / (csqrt(unbias_h_neg_item) + 1e-8)
+ *                 )
  */
                                   (__pyx_v_item_neg_embed_ptr[__pyx_v_j]) = ((__pyx_v_item_neg_embed_ptr[__pyx_v_j]) + ((__pyx_v_lr * __pyx_v_unbias_v_neg_item) / (sqrt(__pyx_v_unbias_h_neg_item) + 1e-8)));
                                 }
                             }
                         }
                     }
                 }
@@ -6008,16 +5169,16 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "libreco/algorithms/_bpr.pyx":336
- *             lower_bound, upper_bound))
+      /* "libreco/algorithms/_bpr.pyx":335
+ *         dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
  * 
  *     with nogil, parallel(num_threads=num_threads):             # <<<<<<<<<<<<<<
  *         for i in prange(length):
  *             t = i % num_threads
  */
       /*finally:*/ {
         /*normal exit:*/{
@@ -6027,1047 +5188,30 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "libreco/algorithms/_bpr.pyx":287
+  /* "libreco/algorithms/_bpr.pyx":286
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cdef void _bpr_update_adam(const int[:] user_indices,             # <<<<<<<<<<<<<<
- *                            const int[:] item_indices,
- *                            const int[:] sparse_indices,
+ * cdef void _bpr_update_adam(             # <<<<<<<<<<<<<<
+ *     const int[:] user_indices,
+ *     const int[:] item_indices,
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("libreco.algorithms._bpr._bpr_update_adam", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":734
- * ctypedef npy_cdouble     complex_t
- * 
- * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew1(PyObject *__pyx_v_a) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew1", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":735
- * 
- * cdef inline object PyArray_MultiIterNew1(a):
- *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(1, ((void *)__pyx_v_a)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 735, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":734
- * ctypedef npy_cdouble     complex_t
- * 
- * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew1", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":737
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew2(PyObject *__pyx_v_a, PyObject *__pyx_v_b) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew2", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":738
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(2, ((void *)__pyx_v_a), ((void *)__pyx_v_b)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 738, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":737
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew2", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":740
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew3(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew3", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":741
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(3, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 741, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":740
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew3", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":743
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew4(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c, PyObject *__pyx_v_d) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew4", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":744
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(4, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 744, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":743
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew4", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":746
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew5(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c, PyObject *__pyx_v_d, PyObject *__pyx_v_e) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew5", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":747
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(5, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d), ((void *)__pyx_v_e)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 747, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":746
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew5", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":749
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
- *     if PyDataType_HASSUBARRAY(d):
- *         return <tuple>d.subarray.shape
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyDataType_SHAPE(PyArray_Descr *__pyx_v_d) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  __Pyx_RefNannySetupContext("PyDataType_SHAPE", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":750
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):
- *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
- *         return <tuple>d.subarray.shape
- *     else:
- */
-  __pyx_t_1 = (PyDataType_HASSUBARRAY(__pyx_v_d) != 0);
-  if (__pyx_t_1) {
-
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":751
- * cdef inline tuple PyDataType_SHAPE(dtype d):
- *     if PyDataType_HASSUBARRAY(d):
- *         return <tuple>d.subarray.shape             # <<<<<<<<<<<<<<
- *     else:
- *         return ()
- */
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(((PyObject*)__pyx_v_d->subarray->shape));
-    __pyx_r = ((PyObject*)__pyx_v_d->subarray->shape);
-    goto __pyx_L0;
-
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":750
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):
- *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
- *         return <tuple>d.subarray.shape
- *     else:
- */
-  }
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":753
- *         return <tuple>d.subarray.shape
- *     else:
- *         return ()             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  /*else*/ {
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_empty_tuple);
-    __pyx_r = __pyx_empty_tuple;
-    goto __pyx_L0;
-  }
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":749
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
- *     if PyDataType_HASSUBARRAY(d):
- *         return <tuple>d.subarray.shape
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":928
- *     int _import_umath() except -1
- * 
- * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
- *     Py_INCREF(base) # important to do this before stealing the reference below!
- *     PyArray_SetBaseObject(arr, base)
- */
-
-static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("set_array_base", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":929
- * 
- * cdef inline void set_array_base(ndarray arr, object base):
- *     Py_INCREF(base) # important to do this before stealing the reference below!             # <<<<<<<<<<<<<<
- *     PyArray_SetBaseObject(arr, base)
- * 
- */
-  Py_INCREF(__pyx_v_base);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":930
- * cdef inline void set_array_base(ndarray arr, object base):
- *     Py_INCREF(base) # important to do this before stealing the reference below!
- *     PyArray_SetBaseObject(arr, base)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object get_array_base(ndarray arr):
- */
-  (void)(PyArray_SetBaseObject(__pyx_v_arr, __pyx_v_base));
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":928
- *     int _import_umath() except -1
- * 
- * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
- *     Py_INCREF(base) # important to do this before stealing the reference below!
- *     PyArray_SetBaseObject(arr, base)
- */
-
-  /* function exit code */
-  __Pyx_RefNannyFinishContext();
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":932
- *     PyArray_SetBaseObject(arr, base)
- * 
- * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
- *     base = PyArray_BASE(arr)
- *     if base is NULL:
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__pyx_v_arr) {
-  PyObject *__pyx_v_base;
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  __Pyx_RefNannySetupContext("get_array_base", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":933
- * 
- * cdef inline object get_array_base(ndarray arr):
- *     base = PyArray_BASE(arr)             # <<<<<<<<<<<<<<
- *     if base is NULL:
- *         return None
- */
-  __pyx_v_base = PyArray_BASE(__pyx_v_arr);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":934
- * cdef inline object get_array_base(ndarray arr):
- *     base = PyArray_BASE(arr)
- *     if base is NULL:             # <<<<<<<<<<<<<<
- *         return None
- *     return <object>base
- */
-  __pyx_t_1 = ((__pyx_v_base == NULL) != 0);
-  if (__pyx_t_1) {
-
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":935
- *     base = PyArray_BASE(arr)
- *     if base is NULL:
- *         return None             # <<<<<<<<<<<<<<
- *     return <object>base
- * 
- */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-    goto __pyx_L0;
-
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":934
- * cdef inline object get_array_base(ndarray arr):
- *     base = PyArray_BASE(arr)
- *     if base is NULL:             # <<<<<<<<<<<<<<
- *         return None
- *     return <object>base
- */
-  }
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":936
- *     if base is NULL:
- *         return None
- *     return <object>base             # <<<<<<<<<<<<<<
- * 
- * # Versions of the import_* functions which are more suitable for
- */
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_base));
-  __pyx_r = ((PyObject *)__pyx_v_base);
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":932
- *     PyArray_SetBaseObject(arr, base)
- * 
- * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
- *     base = PyArray_BASE(arr)
- *     if base is NULL:
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":940
- * # Versions of the import_* functions which are more suitable for
- * # Cython code.
- * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         __pyx_import_array()
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_import_array(void) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("import_array", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":941
- * # Cython code.
- * cdef inline int import_array() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         __pyx_import_array()
- *     except Exception:
- */
-  {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
-    __Pyx_XGOTREF(__pyx_t_1);
-    __Pyx_XGOTREF(__pyx_t_2);
-    __Pyx_XGOTREF(__pyx_t_3);
-    /*try:*/ {
-
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":942
- * cdef inline int import_array() except -1:
- *     try:
- *         __pyx_import_array()             # <<<<<<<<<<<<<<
- *     except Exception:
- *         raise ImportError("numpy.core.multiarray failed to import")
- */
-      __pyx_t_4 = _import_array(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 942, __pyx_L3_error)
-
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":941
- * # Cython code.
- * cdef inline int import_array() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         __pyx_import_array()
- *     except Exception:
- */
-    }
-    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L8_try_end;
-    __pyx_L3_error:;
-
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":943
- *     try:
- *         __pyx_import_array()
- *     except Exception:             # <<<<<<<<<<<<<<
- *         raise ImportError("numpy.core.multiarray failed to import")
- * 
- */
-    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
-    if (__pyx_t_4) {
-      __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 943, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_GOTREF(__pyx_t_7);
-
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":944
- *         __pyx_import_array()
- *     except Exception:
- *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef inline int import_umath() except -1:
- */
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 944, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __PYX_ERR(1, 944, __pyx_L5_except_error)
-    }
-    goto __pyx_L5_except_error;
-    __pyx_L5_except_error:;
-
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":941
- * # Cython code.
- * cdef inline int import_array() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         __pyx_import_array()
- *     except Exception:
- */
-    __Pyx_XGIVEREF(__pyx_t_1);
-    __Pyx_XGIVEREF(__pyx_t_2);
-    __Pyx_XGIVEREF(__pyx_t_3);
-    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
-    goto __pyx_L1_error;
-    __pyx_L8_try_end:;
-  }
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":940
- * # Versions of the import_* functions which are more suitable for
- * # Cython code.
- * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         __pyx_import_array()
- */
-
-  /* function exit code */
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":946
- *         raise ImportError("numpy.core.multiarray failed to import")
- * 
- * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_import_umath(void) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("import_umath", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":947
- * 
- * cdef inline int import_umath() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-  {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
-    __Pyx_XGOTREF(__pyx_t_1);
-    __Pyx_XGOTREF(__pyx_t_2);
-    __Pyx_XGOTREF(__pyx_t_3);
-    /*try:*/ {
-
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":948
- * cdef inline int import_umath() except -1:
- *     try:
- *         _import_umath()             # <<<<<<<<<<<<<<
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")
- */
-      __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 948, __pyx_L3_error)
-
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":947
- * 
- * cdef inline int import_umath() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-    }
-    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L8_try_end;
-    __pyx_L3_error:;
-
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":949
- *     try:
- *         _import_umath()
- *     except Exception:             # <<<<<<<<<<<<<<
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- */
-    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
-    if (__pyx_t_4) {
-      __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 949, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_GOTREF(__pyx_t_7);
-
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":950
- *         _import_umath()
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef inline int import_ufunc() except -1:
- */
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 950, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __PYX_ERR(1, 950, __pyx_L5_except_error)
-    }
-    goto __pyx_L5_except_error;
-    __pyx_L5_except_error:;
-
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":947
- * 
- * cdef inline int import_umath() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-    __Pyx_XGIVEREF(__pyx_t_1);
-    __Pyx_XGIVEREF(__pyx_t_2);
-    __Pyx_XGIVEREF(__pyx_t_3);
-    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
-    goto __pyx_L1_error;
-    __pyx_L8_try_end:;
-  }
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":946
- *         raise ImportError("numpy.core.multiarray failed to import")
- * 
- * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
- */
-
-  /* function exit code */
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":952
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_import_ufunc(void) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("import_ufunc", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":953
- * 
- * cdef inline int import_ufunc() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-  {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
-    __Pyx_XGOTREF(__pyx_t_1);
-    __Pyx_XGOTREF(__pyx_t_2);
-    __Pyx_XGOTREF(__pyx_t_3);
-    /*try:*/ {
-
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":954
- * cdef inline int import_ufunc() except -1:
- *     try:
- *         _import_umath()             # <<<<<<<<<<<<<<
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")
- */
-      __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 954, __pyx_L3_error)
-
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":953
- * 
- * cdef inline int import_ufunc() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-    }
-    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L8_try_end;
-    __pyx_L3_error:;
-
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":955
- *     try:
- *         _import_umath()
- *     except Exception:             # <<<<<<<<<<<<<<
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- */
-    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
-    if (__pyx_t_4) {
-      __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 955, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_GOTREF(__pyx_t_7);
-
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":956
- *         _import_umath()
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef extern from *:
- */
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 956, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __PYX_ERR(1, 956, __pyx_L5_except_error)
-    }
-    goto __pyx_L5_except_error;
-    __pyx_L5_except_error:;
-
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":953
- * 
- * cdef inline int import_ufunc() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-    __Pyx_XGIVEREF(__pyx_t_1);
-    __Pyx_XGIVEREF(__pyx_t_2);
-    __Pyx_XGIVEREF(__pyx_t_3);
-    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
-    goto __pyx_L1_error;
-    __pyx_L8_try_end:;
-  }
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":952
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
- */
-
-  /* function exit code */
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":966
- * 
- * 
- * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
- *     """
- *     Cython equivalent of `isinstance(obj, np.timedelta64)`
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_is_timedelta64_object(PyObject *__pyx_v_obj) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("is_timedelta64_object", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":978
- *     bool
- *     """
- *     return PyObject_TypeCheck(obj, &PyTimedeltaArrType_Type)             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyTimedeltaArrType_Type));
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":966
- * 
- * 
- * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
- *     """
- *     Cython equivalent of `isinstance(obj, np.timedelta64)`
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":981
- * 
- * 
- * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
- *     """
- *     Cython equivalent of `isinstance(obj, np.datetime64)`
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_is_datetime64_object(PyObject *__pyx_v_obj) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("is_datetime64_object", 0);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":993
- *     bool
- *     """
- *     return PyObject_TypeCheck(obj, &PyDatetimeArrType_Type)             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyDatetimeArrType_Type));
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":981
- * 
- * 
- * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
- *     """
- *     Cython equivalent of `isinstance(obj, np.datetime64)`
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":996
- * 
- * 
- * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the int64 value underlying scalar numpy datetime64 object
- */
-
-static CYTHON_INLINE npy_datetime __pyx_f_5numpy_get_datetime64_value(PyObject *__pyx_v_obj) {
-  npy_datetime __pyx_r;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1003
- *     also needed.  That can be found using `get_datetime64_unit`.
- *     """
- *     return (<PyDatetimeScalarObject*>obj).obval             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __pyx_r = ((PyDatetimeScalarObject *)__pyx_v_obj)->obval;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":996
- * 
- * 
- * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the int64 value underlying scalar numpy datetime64 object
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1006
- * 
- * 
- * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the int64 value underlying scalar numpy timedelta64 object
- */
-
-static CYTHON_INLINE npy_timedelta __pyx_f_5numpy_get_timedelta64_value(PyObject *__pyx_v_obj) {
-  npy_timedelta __pyx_r;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1010
- *     returns the int64 value underlying scalar numpy timedelta64 object
- *     """
- *     return (<PyTimedeltaScalarObject*>obj).obval             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __pyx_r = ((PyTimedeltaScalarObject *)__pyx_v_obj)->obval;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1006
- * 
- * 
- * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the int64 value underlying scalar numpy timedelta64 object
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1013
- * 
- * 
- * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the unit part of the dtype for a numpy datetime64 object.
- */
-
-static CYTHON_INLINE NPY_DATETIMEUNIT __pyx_f_5numpy_get_datetime64_unit(PyObject *__pyx_v_obj) {
-  NPY_DATETIMEUNIT __pyx_r;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1017
- *     returns the unit part of the dtype for a numpy datetime64 object.
- *     """
- *     return <NPY_DATETIMEUNIT>(<PyDatetimeScalarObject*>obj).obmeta.base             # <<<<<<<<<<<<<<
- */
-  __pyx_r = ((NPY_DATETIMEUNIT)((PyDatetimeScalarObject *)__pyx_v_obj)->obmeta.base);
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1013
- * 
- * 
- * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the unit part of the dtype for a numpy datetime64 object.
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  return __pyx_r;
-}
-
 /* "View.MemoryView":123
  *         cdef bint dtype_is_object
  * 
  *     def __cinit__(array self, tuple shape, Py_ssize_t itemsize, format not None,             # <<<<<<<<<<<<<<
  *                   mode="c", bint allocate_buffer=True):
  * 
  */
@@ -7112,21 +5256,21 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_shape)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_itemsize)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 3, 5, 1); __PYX_ERR(2, 123, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 3, 5, 1); __PYX_ERR(1, 123, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_format)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 3, 5, 2); __PYX_ERR(2, 123, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 3, 5, 2); __PYX_ERR(1, 123, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mode);
           if (value) { values[3] = value; kw_args--; }
         }
@@ -7134,15 +5278,15 @@
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_allocate_buffer);
           if (value) { values[4] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(2, 123, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(1, 123, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
@@ -7150,42 +5294,42 @@
         values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_shape = ((PyObject*)values[0]);
-    __pyx_v_itemsize = __Pyx_PyIndex_AsSsize_t(values[1]); if (unlikely((__pyx_v_itemsize == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(2, 123, __pyx_L3_error)
+    __pyx_v_itemsize = __Pyx_PyIndex_AsSsize_t(values[1]); if (unlikely((__pyx_v_itemsize == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(1, 123, __pyx_L3_error)
     __pyx_v_format = values[2];
     __pyx_v_mode = values[3];
     if (values[4]) {
-      __pyx_v_allocate_buffer = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_allocate_buffer == (int)-1) && PyErr_Occurred())) __PYX_ERR(2, 124, __pyx_L3_error)
+      __pyx_v_allocate_buffer = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_allocate_buffer == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 124, __pyx_L3_error)
     } else {
 
       /* "View.MemoryView":124
  * 
  *     def __cinit__(array self, tuple shape, Py_ssize_t itemsize, format not None,
  *                   mode="c", bint allocate_buffer=True):             # <<<<<<<<<<<<<<
  * 
  *         cdef int idx
  */
       __pyx_v_allocate_buffer = ((int)1);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 3, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(2, 123, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 3, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 123, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("View.MemoryView.array.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_shape), (&PyTuple_Type), 1, "shape", 1))) __PYX_ERR(2, 123, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_shape), (&PyTuple_Type), 1, "shape", 1))) __PYX_ERR(1, 123, __pyx_L1_error)
   if (unlikely(((PyObject *)__pyx_v_format) == Py_None)) {
-    PyErr_Format(PyExc_TypeError, "Argument '%.200s' must not be None", "format"); __PYX_ERR(2, 123, __pyx_L1_error)
+    PyErr_Format(PyExc_TypeError, "Argument '%.200s' must not be None", "format"); __PYX_ERR(1, 123, __pyx_L1_error)
   }
   __pyx_r = __pyx_array___pyx_pf_15View_dot_MemoryView_5array___cinit__(((struct __pyx_array_obj *)__pyx_v_self), __pyx_v_shape, __pyx_v_itemsize, __pyx_v_format, __pyx_v_mode, __pyx_v_allocate_buffer);
 
   /* "View.MemoryView":123
  *         cdef bint dtype_is_object
  * 
  *     def __cinit__(array self, tuple shape, Py_ssize_t itemsize, format not None,             # <<<<<<<<<<<<<<
@@ -7232,17 +5376,17 @@
  * 
  *         self.ndim = <int> len(shape)             # <<<<<<<<<<<<<<
  *         self.itemsize = itemsize
  * 
  */
   if (unlikely(__pyx_v_shape == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(2, 130, __pyx_L1_error)
+    __PYX_ERR(1, 130, __pyx_L1_error)
   }
-  __pyx_t_1 = PyTuple_GET_SIZE(__pyx_v_shape); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(2, 130, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_GET_SIZE(__pyx_v_shape); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(1, 130, __pyx_L1_error)
   __pyx_v_self->ndim = ((int)__pyx_t_1);
 
   /* "View.MemoryView":131
  * 
  *         self.ndim = <int> len(shape)
  *         self.itemsize = itemsize             # <<<<<<<<<<<<<<
  * 
@@ -7263,19 +5407,19 @@
     /* "View.MemoryView":134
  * 
  *         if not self.ndim:
  *             raise ValueError("Empty shape tuple for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if itemsize <= 0:
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 134, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 134, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(2, 134, __pyx_L1_error)
+    __PYX_ERR(1, 134, __pyx_L1_error)
 
     /* "View.MemoryView":133
  *         self.itemsize = itemsize
  * 
  *         if not self.ndim:             # <<<<<<<<<<<<<<
  *             raise ValueError("Empty shape tuple for cython.array")
  * 
@@ -7295,19 +5439,19 @@
     /* "View.MemoryView":137
  * 
  *         if itemsize <= 0:
  *             raise ValueError("itemsize <= 0 for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if not isinstance(format, bytes):
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 137, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(2, 137, __pyx_L1_error)
+    __PYX_ERR(1, 137, __pyx_L1_error)
 
     /* "View.MemoryView":136
  *             raise ValueError("Empty shape tuple for cython.array")
  * 
  *         if itemsize <= 0:             # <<<<<<<<<<<<<<
  *             raise ValueError("itemsize <= 0 for cython.array")
  * 
@@ -7328,29 +5472,29 @@
     /* "View.MemoryView":140
  * 
  *         if not isinstance(format, bytes):
  *             format = format.encode('ASCII')             # <<<<<<<<<<<<<<
  *         self._format = format  # keep a reference to the byte string
  *         self.format = self._format
  */
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_format, __pyx_n_s_encode); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 140, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_format, __pyx_n_s_encode); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 140, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_6 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_6)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
         __Pyx_INCREF(__pyx_t_6);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
       }
     }
     __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_n_s_ASCII) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_n_s_ASCII);
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 140, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 140, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF_SET(__pyx_v_format, __pyx_t_3);
     __pyx_t_3 = 0;
 
     /* "View.MemoryView":139
  *             raise ValueError("itemsize <= 0 for cython.array")
@@ -7364,15 +5508,15 @@
   /* "View.MemoryView":141
  *         if not isinstance(format, bytes):
  *             format = format.encode('ASCII')
  *         self._format = format  # keep a reference to the byte string             # <<<<<<<<<<<<<<
  *         self.format = self._format
  * 
  */
-  if (!(likely(PyBytes_CheckExact(__pyx_v_format))||((__pyx_v_format) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_format)->tp_name), 0))) __PYX_ERR(2, 141, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_v_format))||((__pyx_v_format) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_v_format)->tp_name), 0))) __PYX_ERR(1, 141, __pyx_L1_error)
   __pyx_t_3 = __pyx_v_format;
   __Pyx_INCREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_3);
   __Pyx_GOTREF(__pyx_v_self->_format);
   __Pyx_DECREF(__pyx_v_self->_format);
   __pyx_v_self->_format = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
@@ -7382,17 +5526,17 @@
  *         self._format = format  # keep a reference to the byte string
  *         self.format = self._format             # <<<<<<<<<<<<<<
  * 
  * 
  */
   if (unlikely(__pyx_v_self->_format == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(2, 142, __pyx_L1_error)
+    __PYX_ERR(1, 142, __pyx_L1_error)
   }
-  __pyx_t_7 = __Pyx_PyBytes_AsWritableString(__pyx_v_self->_format); if (unlikely((!__pyx_t_7) && PyErr_Occurred())) __PYX_ERR(2, 142, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyBytes_AsWritableString(__pyx_v_self->_format); if (unlikely((!__pyx_t_7) && PyErr_Occurred())) __PYX_ERR(1, 142, __pyx_L1_error)
   __pyx_v_self->format = __pyx_t_7;
 
   /* "View.MemoryView":145
  * 
  * 
  *         self._shape = <Py_ssize_t *> PyObject_Malloc(sizeof(Py_ssize_t)*self.ndim*2)             # <<<<<<<<<<<<<<
  *         self._strides = self._shape + self.ndim
@@ -7422,19 +5566,19 @@
     /* "View.MemoryView":149
  * 
  *         if not self._shape:
  *             raise MemoryError("unable to allocate shape and strides.")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 149, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 149, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(2, 149, __pyx_L1_error)
+    __PYX_ERR(1, 149, __pyx_L1_error)
 
     /* "View.MemoryView":148
  *         self._strides = self._shape + self.ndim
  * 
  *         if not self._shape:             # <<<<<<<<<<<<<<
  *             raise MemoryError("unable to allocate shape and strides.")
  * 
@@ -7449,20 +5593,20 @@
  *                 raise ValueError("Invalid shape in axis %d: %d." % (idx, dim))
  */
   __pyx_t_8 = 0;
   __pyx_t_3 = __pyx_v_shape; __Pyx_INCREF(__pyx_t_3); __pyx_t_1 = 0;
   for (;;) {
     if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_5); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(2, 152, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_5); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(1, 152, __pyx_L1_error)
     #else
-    __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 152, __pyx_L1_error)
+    __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 152, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     #endif
-    __pyx_t_9 = __Pyx_PyIndex_AsSsize_t(__pyx_t_5); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(2, 152, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyIndex_AsSsize_t(__pyx_t_5); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(1, 152, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_v_dim = __pyx_t_9;
     __pyx_v_idx = __pyx_t_8;
     __pyx_t_8 = (__pyx_t_8 + 1);
 
     /* "View.MemoryView":153
  * 
@@ -7477,35 +5621,35 @@
       /* "View.MemoryView":154
  *         for idx, dim in enumerate(shape):
  *             if dim <= 0:
  *                 raise ValueError("Invalid shape in axis %d: %d." % (idx, dim))             # <<<<<<<<<<<<<<
  *             self._shape[idx] = dim
  * 
  */
-      __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_idx); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 154, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_idx); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 154, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = PyInt_FromSsize_t(__pyx_v_dim); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 154, __pyx_L1_error)
+      __pyx_t_6 = PyInt_FromSsize_t(__pyx_v_dim); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 154, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(2, 154, __pyx_L1_error)
+      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 154, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_GIVEREF(__pyx_t_5);
       PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_5);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_6);
       __pyx_t_5 = 0;
       __pyx_t_6 = 0;
-      __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Invalid_shape_in_axis_d_d, __pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 154, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Invalid_shape_in_axis_d_d, __pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 154, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_6); if (unlikely(!__pyx_t_10)) __PYX_ERR(2, 154, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_6); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 154, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_Raise(__pyx_t_10, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __PYX_ERR(2, 154, __pyx_L1_error)
+      __PYX_ERR(1, 154, __pyx_L1_error)
 
       /* "View.MemoryView":153
  * 
  *         for idx, dim in enumerate(shape):
  *             if dim <= 0:             # <<<<<<<<<<<<<<
  *                 raise ValueError("Invalid shape in axis %d: %d." % (idx, dim))
  *             self._shape[idx] = dim
@@ -7534,15 +5678,15 @@
   /* "View.MemoryView":158
  * 
  *         cdef char order
  *         if mode == 'fortran':             # <<<<<<<<<<<<<<
  *             order = b'F'
  *             self.mode = u'fortran'
  */
-  __pyx_t_4 = (__Pyx_PyString_Equals(__pyx_v_mode, __pyx_n_s_fortran, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(2, 158, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyString_Equals(__pyx_v_mode, __pyx_n_s_fortran, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(1, 158, __pyx_L1_error)
   if (__pyx_t_4) {
 
     /* "View.MemoryView":159
  *         cdef char order
  *         if mode == 'fortran':
  *             order = b'F'             # <<<<<<<<<<<<<<
  *             self.mode = u'fortran'
@@ -7576,15 +5720,15 @@
   /* "View.MemoryView":161
  *             order = b'F'
  *             self.mode = u'fortran'
  *         elif mode == 'c':             # <<<<<<<<<<<<<<
  *             order = b'C'
  *             self.mode = u'c'
  */
-  __pyx_t_4 = (__Pyx_PyString_Equals(__pyx_v_mode, __pyx_n_s_c, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(2, 161, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyString_Equals(__pyx_v_mode, __pyx_n_s_c, Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(1, 161, __pyx_L1_error)
   if (likely(__pyx_t_4)) {
 
     /* "View.MemoryView":162
  *             self.mode = u'fortran'
  *         elif mode == 'c':
  *             order = b'C'             # <<<<<<<<<<<<<<
  *             self.mode = u'c'
@@ -7619,22 +5763,22 @@
  *             self.mode = u'c'
  *         else:
  *             raise ValueError("Invalid mode, expected 'c' or 'fortran', got %s" % mode)             # <<<<<<<<<<<<<<
  * 
  *         self.len = fill_contig_strides_array(self._shape, self._strides,
  */
   /*else*/ {
-    __pyx_t_3 = __Pyx_PyString_FormatSafe(__pyx_kp_s_Invalid_mode_expected_c_or_fortr, __pyx_v_mode); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 165, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyString_FormatSafe(__pyx_kp_s_Invalid_mode_expected_c_or_fortr, __pyx_v_mode); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_10)) __PYX_ERR(2, 165, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_10, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    __PYX_ERR(2, 165, __pyx_L1_error)
+    __PYX_ERR(1, 165, __pyx_L1_error)
   }
   __pyx_L10:;
 
   /* "View.MemoryView":167
  *             raise ValueError("Invalid mode, expected 'c' or 'fortran', got %s" % mode)
  * 
  *         self.len = fill_contig_strides_array(self._shape, self._strides,             # <<<<<<<<<<<<<<
@@ -7655,16 +5799,16 @@
   /* "View.MemoryView":171
  * 
  *         self.free_data = allocate_buffer
  *         self.dtype_is_object = format == b'O'             # <<<<<<<<<<<<<<
  *         if allocate_buffer:
  * 
  */
-  __pyx_t_10 = PyObject_RichCompare(__pyx_v_format, __pyx_n_b_O, Py_EQ); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(2, 171, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(2, 171, __pyx_L1_error)
+  __pyx_t_10 = PyObject_RichCompare(__pyx_v_format, __pyx_n_b_O, Py_EQ); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 171, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 171, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_v_self->dtype_is_object = __pyx_t_4;
 
   /* "View.MemoryView":172
  *         self.free_data = allocate_buffer
  *         self.dtype_is_object = format == b'O'
  *         if allocate_buffer:             # <<<<<<<<<<<<<<
@@ -7696,19 +5840,19 @@
       /* "View.MemoryView":177
  *             self.data = <char *>malloc(self.len)
  *             if not self.data:
  *                 raise MemoryError("unable to allocate array data.")             # <<<<<<<<<<<<<<
  * 
  *             if self.dtype_is_object:
  */
-      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(2, 177, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_builtin_MemoryError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 177, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_Raise(__pyx_t_10, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __PYX_ERR(2, 177, __pyx_L1_error)
+      __PYX_ERR(1, 177, __pyx_L1_error)
 
       /* "View.MemoryView":176
  * 
  *             self.data = <char *>malloc(self.len)
  *             if not self.data:             # <<<<<<<<<<<<<<
  *                 raise MemoryError("unable to allocate array data.")
  * 
@@ -7739,19 +5883,19 @@
  *                 p = <PyObject **> self.data
  *                 for i in range(self.len / itemsize):             # <<<<<<<<<<<<<<
  *                     p[i] = Py_None
  *                     Py_INCREF(Py_None)
  */
       if (unlikely(__pyx_v_itemsize == 0)) {
         PyErr_SetString(PyExc_ZeroDivisionError, "integer division or modulo by zero");
-        __PYX_ERR(2, 181, __pyx_L1_error)
+        __PYX_ERR(1, 181, __pyx_L1_error)
       }
       else if (sizeof(Py_ssize_t) == sizeof(long) && (!(((Py_ssize_t)-1) > 0)) && unlikely(__pyx_v_itemsize == (Py_ssize_t)-1)  && unlikely(UNARY_NEG_WOULD_OVERFLOW(__pyx_v_self->len))) {
         PyErr_SetString(PyExc_OverflowError, "value too large to perform division");
-        __PYX_ERR(2, 181, __pyx_L1_error)
+        __PYX_ERR(1, 181, __pyx_L1_error)
       }
       __pyx_t_1 = __Pyx_div_Py_ssize_t(__pyx_v_self->len, __pyx_v_itemsize);
       __pyx_t_9 = __pyx_t_1;
       for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_9; __pyx_t_11+=1) {
         __pyx_v_i = __pyx_t_11;
 
         /* "View.MemoryView":182
@@ -7870,15 +6014,15 @@
   /* "View.MemoryView":188
  *     def __getbuffer__(self, Py_buffer *info, int flags):
  *         cdef int bufmode = -1
  *         if self.mode == u"c":             # <<<<<<<<<<<<<<
  *             bufmode = PyBUF_C_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS
  *         elif self.mode == u"fortran":
  */
-  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_self->mode, __pyx_n_u_c, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(2, 188, __pyx_L1_error)
+  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_self->mode, __pyx_n_u_c, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(1, 188, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
     /* "View.MemoryView":189
  *         cdef int bufmode = -1
  *         if self.mode == u"c":
  *             bufmode = PyBUF_C_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS             # <<<<<<<<<<<<<<
@@ -7900,15 +6044,15 @@
   /* "View.MemoryView":190
  *         if self.mode == u"c":
  *             bufmode = PyBUF_C_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS
  *         elif self.mode == u"fortran":             # <<<<<<<<<<<<<<
  *             bufmode = PyBUF_F_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS
  *         if not (flags & bufmode):
  */
-  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_self->mode, __pyx_n_u_fortran, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(2, 190, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_self->mode, __pyx_n_u_fortran, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(1, 190, __pyx_L1_error)
   __pyx_t_1 = (__pyx_t_2 != 0);
   if (__pyx_t_1) {
 
     /* "View.MemoryView":191
  *             bufmode = PyBUF_C_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS
  *         elif self.mode == u"fortran":
  *             bufmode = PyBUF_F_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS             # <<<<<<<<<<<<<<
@@ -7940,19 +6084,19 @@
     /* "View.MemoryView":193
  *             bufmode = PyBUF_F_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS
  *         if not (flags & bufmode):
  *             raise ValueError("Can only create a buffer that is contiguous in memory.")             # <<<<<<<<<<<<<<
  *         info.buf = self.data
  *         info.len = self.len
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 193, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 193, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(2, 193, __pyx_L1_error)
+    __PYX_ERR(1, 193, __pyx_L1_error)
 
     /* "View.MemoryView":192
  *         elif self.mode == u"fortran":
  *             bufmode = PyBUF_F_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS
  *         if not (flags & bufmode):             # <<<<<<<<<<<<<<
  *             raise ValueError("Can only create a buffer that is contiguous in memory.")
  *         info.buf = self.data
@@ -8287,15 +6431,15 @@
  *     @property
  *     def memview(self):
  *         return self.get_memview()             # <<<<<<<<<<<<<<
  * 
  *     @cname('get_memview')
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_array *)__pyx_v_self->__pyx_vtab)->get_memview(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 224, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_array *)__pyx_v_self->__pyx_vtab)->get_memview(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":223
  * 
@@ -8349,30 +6493,30 @@
  *     cdef get_memview(self):
  *         flags =  PyBUF_ANY_CONTIGUOUS|PyBUF_FORMAT|PyBUF_WRITABLE
  *         return  memoryview(self, flags, self.dtype_is_object)             # <<<<<<<<<<<<<<
  * 
  *     def __len__(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 229, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 229, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->dtype_is_object); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 229, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_self->dtype_is_object); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 229, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 229, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 229, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(((PyObject *)__pyx_v_self));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
   PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_self));
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_2);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_memoryview_type), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 229, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_memoryview_type), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 229, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":227
@@ -8481,17 +6625,17 @@
  * 
  *     def __getattr__(self, attr):
  *         return getattr(self.memview, attr)             # <<<<<<<<<<<<<<
  * 
  *     def __getitem__(self, item):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_memview); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 235, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_memview); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 235, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_GetAttr(__pyx_t_1, __pyx_v_attr); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 235, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_GetAttr(__pyx_t_1, __pyx_v_attr); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 235, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":234
@@ -8549,17 +6693,17 @@
  * 
  *     def __getitem__(self, item):
  *         return self.memview[item]             # <<<<<<<<<<<<<<
  * 
  *     def __setitem__(self, item, value):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_memview); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 238, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_memview); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 238, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_item); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 238, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_item); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 238, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":237
@@ -8615,17 +6759,17 @@
   /* "View.MemoryView":241
  * 
  *     def __setitem__(self, item, value):
  *         self.memview[item] = value             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_memview); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 241, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_memview); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 241, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (unlikely(PyObject_SetItem(__pyx_t_1, __pyx_v_item, __pyx_v_value) < 0)) __PYX_ERR(2, 241, __pyx_L1_error)
+  if (unlikely(PyObject_SetItem(__pyx_t_1, __pyx_v_item, __pyx_v_value) < 0)) __PYX_ERR(1, 241, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "View.MemoryView":240
  *         return self.memview[item]
  * 
  *     def __setitem__(self, item, value):             # <<<<<<<<<<<<<<
  *         self.memview[item] = value
@@ -8674,19 +6818,19 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(2, 2, __pyx_L1_error)
+  __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  */
 
@@ -8730,19 +6874,19 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(2, 4, __pyx_L1_error)
+  __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
@@ -8792,35 +6936,35 @@
     /* "View.MemoryView":250
  * 
  *     if buf == NULL:
  *         result = array(shape, itemsize, format, mode.decode('ASCII'))             # <<<<<<<<<<<<<<
  *     else:
  *         result = array(shape, itemsize, format, mode.decode('ASCII'),
  */
-    __pyx_t_2 = PyInt_FromSsize_t(__pyx_v_itemsize); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 250, __pyx_L1_error)
+    __pyx_t_2 = PyInt_FromSsize_t(__pyx_v_itemsize); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 250, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyBytes_FromString(__pyx_v_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_decode_c_string(__pyx_v_mode, 0, strlen(__pyx_v_mode), NULL, NULL, PyUnicode_DecodeASCII); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 250, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_decode_c_string(__pyx_v_mode, 0, strlen(__pyx_v_mode), NULL, NULL, PyUnicode_DecodeASCII); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 250, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_INCREF(__pyx_v_shape);
     __Pyx_GIVEREF(__pyx_v_shape);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_shape);
     __Pyx_GIVEREF(__pyx_t_2);
     PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
     __Pyx_GIVEREF(__pyx_t_3);
     PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_t_4);
     __pyx_t_2 = 0;
     __pyx_t_3 = 0;
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)__pyx_array_type), __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 250, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)__pyx_array_type), __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_v_result = ((struct __pyx_array_obj *)__pyx_t_4);
     __pyx_t_4 = 0;
 
     /* "View.MemoryView":249
  *     cdef array result
@@ -8836,21 +6980,21 @@
  *         result = array(shape, itemsize, format, mode.decode('ASCII'))
  *     else:
  *         result = array(shape, itemsize, format, mode.decode('ASCII'),             # <<<<<<<<<<<<<<
  *                        allocate_buffer=False)
  *         result.data = buf
  */
   /*else*/ {
-    __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_itemsize); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 252, __pyx_L1_error)
+    __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_itemsize); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 252, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyBytes_FromString(__pyx_v_format); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 252, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyBytes_FromString(__pyx_v_format); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 252, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_3 = __Pyx_decode_c_string(__pyx_v_mode, 0, strlen(__pyx_v_mode), NULL, NULL, PyUnicode_DecodeASCII); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 252, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_decode_c_string(__pyx_v_mode, 0, strlen(__pyx_v_mode), NULL, NULL, PyUnicode_DecodeASCII); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 252, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 252, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 252, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_v_shape);
     __Pyx_GIVEREF(__pyx_v_shape);
     PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_shape);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_5);
@@ -8864,26 +7008,26 @@
     /* "View.MemoryView":253
  *     else:
  *         result = array(shape, itemsize, format, mode.decode('ASCII'),
  *                        allocate_buffer=False)             # <<<<<<<<<<<<<<
  *         result.data = buf
  * 
  */
-    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 253, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 253, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_allocate_buffer, Py_False) < 0) __PYX_ERR(2, 253, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_allocate_buffer, Py_False) < 0) __PYX_ERR(1, 253, __pyx_L1_error)
 
     /* "View.MemoryView":252
  *         result = array(shape, itemsize, format, mode.decode('ASCII'))
  *     else:
  *         result = array(shape, itemsize, format, mode.decode('ASCII'),             # <<<<<<<<<<<<<<
  *                        allocate_buffer=False)
  *         result.data = buf
  */
-    __pyx_t_5 = __Pyx_PyObject_Call(((PyObject *)__pyx_array_type), __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 252, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(((PyObject *)__pyx_array_type), __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 252, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_result = ((struct __pyx_array_obj *)__pyx_t_5);
     __pyx_t_5 = 0;
 
     /* "View.MemoryView":254
@@ -8965,26 +7109,26 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(2, 282, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(1, 282, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_name = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(2, 282, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 282, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("View.MemoryView.Enum.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_MemviewEnum___pyx_pf_15View_dot_MemoryView_4Enum___init__(((struct __pyx_MemviewEnum_obj *)__pyx_v_self), __pyx_v_name);
 
@@ -9116,30 +7260,30 @@
   /* "(tree fragment)":5
  *     cdef object _dict
  *     cdef bint use_setstate
  *     state = (self.name,)             # <<<<<<<<<<<<<<
  *     _dict = getattr(self, '__dict__', None)
  *     if _dict is not None:
  */
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 5, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 5, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_v_self->name);
   __Pyx_GIVEREF(__pyx_v_self->name);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_self->name);
   __pyx_v_state = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":6
  *     cdef bint use_setstate
  *     state = (self.name,)
  *     _dict = getattr(self, '__dict__', None)             # <<<<<<<<<<<<<<
  *     if _dict is not None:
  *         state += (_dict,)
  */
-  __pyx_t_1 = __Pyx_GetAttr3(((PyObject *)__pyx_v_self), __pyx_n_s_dict, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 6, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetAttr3(((PyObject *)__pyx_v_self), __pyx_n_s_dict, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 6, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v__dict = __pyx_t_1;
   __pyx_t_1 = 0;
 
   /* "(tree fragment)":7
  *     state = (self.name,)
  *     _dict = getattr(self, '__dict__', None)
@@ -9154,20 +7298,20 @@
     /* "(tree fragment)":8
  *     _dict = getattr(self, '__dict__', None)
  *     if _dict is not None:
  *         state += (_dict,)             # <<<<<<<<<<<<<<
  *         use_setstate = True
  *     else:
  */
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 8, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 8, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_v__dict);
     __Pyx_GIVEREF(__pyx_v__dict);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v__dict);
-    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_state, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 8, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceAdd(__pyx_v_state, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 8, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF_SET(__pyx_v_state, ((PyObject*)__pyx_t_4));
     __pyx_t_4 = 0;
 
     /* "(tree fragment)":9
  *     if _dict is not None:
@@ -9215,28 +7359,28 @@
  *         use_setstate = self.name is not None
  *     if use_setstate:
  *         return __pyx_unpickle_Enum, (type(self), 0xb068931, None), state             # <<<<<<<<<<<<<<
  *     else:
  *         return __pyx_unpickle_Enum, (type(self), 0xb068931, state)
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pyx_unpickle_Enum); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 13, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pyx_unpickle_Enum); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 13, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 13, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 13, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
     __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
     PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
     __Pyx_INCREF(__pyx_int_184977713);
     __Pyx_GIVEREF(__pyx_int_184977713);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_184977713);
     __Pyx_INCREF(Py_None);
     __Pyx_GIVEREF(Py_None);
     PyTuple_SET_ITEM(__pyx_t_1, 2, Py_None);
-    __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 13, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 13, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_1);
     __Pyx_INCREF(__pyx_v_state);
     __Pyx_GIVEREF(__pyx_v_state);
@@ -9261,28 +7405,28 @@
  *     else:
  *         return __pyx_unpickle_Enum, (type(self), 0xb068931, state)             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Enum__set_state(self, __pyx_state)
  */
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_pyx_unpickle_Enum); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 15, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_pyx_unpickle_Enum); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 15, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 15, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 15, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
     __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
     PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
     __Pyx_INCREF(__pyx_int_184977713);
     __Pyx_GIVEREF(__pyx_int_184977713);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_184977713);
     __Pyx_INCREF(__pyx_v_state);
     __Pyx_GIVEREF(__pyx_v_state);
     PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_state);
-    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 15, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 15, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_5);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
     __pyx_t_5 = 0;
     __pyx_t_1 = 0;
@@ -9342,16 +7486,16 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":17
  *         return __pyx_unpickle_Enum, (type(self), 0xb068931, state)
  * def __setstate_cython__(self, __pyx_state):
  *     __pyx_unpickle_Enum__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
  */
-  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 17, __pyx_L1_error)
-  __pyx_t_1 = __pyx_unpickle_Enum__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 17, __pyx_L1_error)
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 17, __pyx_L1_error)
+  __pyx_t_1 = __pyx_unpickle_Enum__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":16
  *     else:
  *         return __pyx_unpickle_Enum, (type(self), 0xb068931, state)
  * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
@@ -9495,47 +7639,47 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obj)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_flags)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 2, 3, 1); __PYX_ERR(2, 346, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 2, 3, 1); __PYX_ERR(1, 346, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype_is_object);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(2, 346, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(1, 346, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_obj = values[0];
-    __pyx_v_flags = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) __PYX_ERR(2, 346, __pyx_L3_error)
+    __pyx_v_flags = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_flags == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 346, __pyx_L3_error)
     if (values[2]) {
-      __pyx_v_dtype_is_object = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_dtype_is_object == (int)-1) && PyErr_Occurred())) __PYX_ERR(2, 346, __pyx_L3_error)
+      __pyx_v_dtype_is_object = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_dtype_is_object == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 346, __pyx_L3_error)
     } else {
       __pyx_v_dtype_is_object = ((int)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(2, 346, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__cinit__", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 346, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("View.MemoryView.memoryview.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_memoryview___pyx_pf_15View_dot_MemoryView_10memoryview___cinit__(((struct __pyx_memoryview_obj *)__pyx_v_self), __pyx_v_obj, __pyx_v_flags, __pyx_v_dtype_is_object);
 
@@ -9601,15 +7745,15 @@
     /* "View.MemoryView":350
  *         self.flags = flags
  *         if type(self) is memoryview or obj is not None:
  *             __Pyx_GetBuffer(obj, &self.view, flags)             # <<<<<<<<<<<<<<
  *             if <PyObject *> self.view.obj == NULL:
  *                 (<__pyx_buffer *> &self.view).obj = Py_None
  */
-    __pyx_t_4 = __Pyx_GetBuffer(__pyx_v_obj, (&__pyx_v_self->view), __pyx_v_flags); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(2, 350, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_GetBuffer(__pyx_v_obj, (&__pyx_v_self->view), __pyx_v_flags); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 350, __pyx_L1_error)
 
     /* "View.MemoryView":351
  *         if type(self) is memoryview or obj is not None:
  *             __Pyx_GetBuffer(obj, &self.view, flags)
  *             if <PyObject *> self.view.obj == NULL:             # <<<<<<<<<<<<<<
  *                 (<__pyx_buffer *> &self.view).obj = Py_None
  *                 Py_INCREF(Py_None)
@@ -9732,15 +7876,15 @@
         /* "View.MemoryView":363
  *                 self.lock = PyThread_allocate_lock()
  *                 if self.lock is NULL:
  *                     raise MemoryError             # <<<<<<<<<<<<<<
  * 
  *         if flags & PyBUF_FORMAT:
  */
-        PyErr_NoMemory(); __PYX_ERR(2, 363, __pyx_L1_error)
+        PyErr_NoMemory(); __PYX_ERR(1, 363, __pyx_L1_error)
 
         /* "View.MemoryView":362
  *             if self.lock is NULL:
  *                 self.lock = PyThread_allocate_lock()
  *                 if self.lock is NULL:             # <<<<<<<<<<<<<<
  *                     raise MemoryError
  * 
@@ -10126,44 +8270,44 @@
  * 
  */
   __pyx_t_1 = 0;
   if (likely(PyList_CheckExact(__pyx_v_index)) || PyTuple_CheckExact(__pyx_v_index)) {
     __pyx_t_2 = __pyx_v_index; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
     __pyx_t_4 = NULL;
   } else {
-    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 399, __pyx_L1_error)
+    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 399, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 399, __pyx_L1_error)
+    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 399, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_4)) {
       if (likely(PyList_CheckExact(__pyx_t_2))) {
         if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(2, 399, __pyx_L1_error)
+        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(1, 399, __pyx_L1_error)
         #else
-        __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 399, __pyx_L1_error)
+        __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 399, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         #endif
       } else {
         if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(2, 399, __pyx_L1_error)
+        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_5); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(1, 399, __pyx_L1_error)
         #else
-        __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 399, __pyx_L1_error)
+        __pyx_t_5 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 399, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         #endif
       }
     } else {
       __pyx_t_5 = __pyx_t_4(__pyx_t_2);
       if (unlikely(!__pyx_t_5)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(2, 399, __pyx_L1_error)
+          else __PYX_ERR(1, 399, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_5);
     }
     __Pyx_XDECREF_SET(__pyx_v_idx, __pyx_t_5);
     __pyx_t_5 = 0;
@@ -10173,16 +8317,16 @@
     /* "View.MemoryView":400
  * 
  *         for dim, idx in enumerate(index):
  *             itemp = pybuffer_index(&self.view, itemp, idx, dim)             # <<<<<<<<<<<<<<
  * 
  *         return itemp
  */
-    __pyx_t_6 = __Pyx_PyIndex_AsSsize_t(__pyx_v_idx); if (unlikely((__pyx_t_6 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(2, 400, __pyx_L1_error)
-    __pyx_t_7 = __pyx_pybuffer_index((&__pyx_v_self->view), __pyx_v_itemp, __pyx_t_6, __pyx_v_dim); if (unlikely(__pyx_t_7 == ((char *)NULL))) __PYX_ERR(2, 400, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyIndex_AsSsize_t(__pyx_v_idx); if (unlikely((__pyx_t_6 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(1, 400, __pyx_L1_error)
+    __pyx_t_7 = __pyx_pybuffer_index((&__pyx_v_self->view), __pyx_v_itemp, __pyx_t_6, __pyx_v_dim); if (unlikely(__pyx_t_7 == ((char *)NULL))) __PYX_ERR(1, 400, __pyx_L1_error)
     __pyx_v_itemp = __pyx_t_7;
 
     /* "View.MemoryView":399
  *         cdef char *itemp = <char *> self.view.buf
  * 
  *         for dim, idx in enumerate(index):             # <<<<<<<<<<<<<<
  *             itemp = pybuffer_index(&self.view, itemp, idx, dim)
@@ -10294,63 +8438,63 @@
   /* "View.MemoryView":409
  *             return self
  * 
  *         have_slices, indices = _unellipsify(index, self.view.ndim)             # <<<<<<<<<<<<<<
  * 
  *         cdef char *itemp
  */
-  __pyx_t_3 = _unellipsify(__pyx_v_index, __pyx_v_self->view.ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 409, __pyx_L1_error)
+  __pyx_t_3 = _unellipsify(__pyx_v_index, __pyx_v_self->view.ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 409, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   if (likely(__pyx_t_3 != Py_None)) {
     PyObject* sequence = __pyx_t_3;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(2, 409, __pyx_L1_error)
+      __PYX_ERR(1, 409, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
     __pyx_t_5 = PyTuple_GET_ITEM(sequence, 1); 
     __Pyx_INCREF(__pyx_t_4);
     __Pyx_INCREF(__pyx_t_5);
     #else
-    __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 409, __pyx_L1_error)
+    __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 409, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 409, __pyx_L1_error)
+    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 409, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     #endif
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   } else {
-    __Pyx_RaiseNoneNotIterableError(); __PYX_ERR(2, 409, __pyx_L1_error)
+    __Pyx_RaiseNoneNotIterableError(); __PYX_ERR(1, 409, __pyx_L1_error)
   }
   __pyx_v_have_slices = __pyx_t_4;
   __pyx_t_4 = 0;
   __pyx_v_indices = __pyx_t_5;
   __pyx_t_5 = 0;
 
   /* "View.MemoryView":412
  * 
  *         cdef char *itemp
  *         if have_slices:             # <<<<<<<<<<<<<<
  *             return memview_slice(self, indices)
  *         else:
  */
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_have_slices); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(2, 412, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_have_slices); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(1, 412, __pyx_L1_error)
   if (__pyx_t_2) {
 
     /* "View.MemoryView":413
  *         cdef char *itemp
  *         if have_slices:
  *             return memview_slice(self, indices)             # <<<<<<<<<<<<<<
  *         else:
  *             itemp = self.get_item_pointer(indices)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = ((PyObject *)__pyx_memview_slice(__pyx_v_self, __pyx_v_indices)); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 413, __pyx_L1_error)
+    __pyx_t_3 = ((PyObject *)__pyx_memview_slice(__pyx_v_self, __pyx_v_indices)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 413, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
     /* "View.MemoryView":412
  * 
@@ -10365,26 +8509,26 @@
  *             return memview_slice(self, indices)
  *         else:
  *             itemp = self.get_item_pointer(indices)             # <<<<<<<<<<<<<<
  *             return self.convert_item_to_object(itemp)
  * 
  */
   /*else*/ {
-    __pyx_t_6 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->get_item_pointer(__pyx_v_self, __pyx_v_indices); if (unlikely(__pyx_t_6 == ((char *)NULL))) __PYX_ERR(2, 415, __pyx_L1_error)
+    __pyx_t_6 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->get_item_pointer(__pyx_v_self, __pyx_v_indices); if (unlikely(__pyx_t_6 == ((char *)NULL))) __PYX_ERR(1, 415, __pyx_L1_error)
     __pyx_v_itemp = __pyx_t_6;
 
     /* "View.MemoryView":416
  *         else:
  *             itemp = self.get_item_pointer(indices)
  *             return self.convert_item_to_object(itemp)             # <<<<<<<<<<<<<<
  * 
  *     def __setitem__(memoryview self, object index, object value):
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->convert_item_to_object(__pyx_v_self, __pyx_v_itemp); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 416, __pyx_L1_error)
+    __pyx_t_3 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->convert_item_to_object(__pyx_v_self, __pyx_v_itemp); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 416, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
   }
 
   /* "View.MemoryView":405
@@ -10459,19 +8603,19 @@
     /* "View.MemoryView":420
  *     def __setitem__(memoryview self, object index, object value):
  *         if self.view.readonly:
  *             raise TypeError("Cannot assign to read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         have_slices, index = _unellipsify(index, self.view.ndim)
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__10, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 420, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 420, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(2, 420, __pyx_L1_error)
+    __PYX_ERR(1, 420, __pyx_L1_error)
 
     /* "View.MemoryView":419
  * 
  *     def __setitem__(memoryview self, object index, object value):
  *         if self.view.readonly:             # <<<<<<<<<<<<<<
  *             raise TypeError("Cannot assign to read-only memoryview")
  * 
@@ -10481,86 +8625,86 @@
   /* "View.MemoryView":422
  *             raise TypeError("Cannot assign to read-only memoryview")
  * 
  *         have_slices, index = _unellipsify(index, self.view.ndim)             # <<<<<<<<<<<<<<
  * 
  *         if have_slices:
  */
-  __pyx_t_2 = _unellipsify(__pyx_v_index, __pyx_v_self->view.ndim); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 422, __pyx_L1_error)
+  __pyx_t_2 = _unellipsify(__pyx_v_index, __pyx_v_self->view.ndim); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 422, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if (likely(__pyx_t_2 != Py_None)) {
     PyObject* sequence = __pyx_t_2;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(2, 422, __pyx_L1_error)
+      __PYX_ERR(1, 422, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
     __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
     __Pyx_INCREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_t_4);
     #else
-    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 422, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 422, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 422, __pyx_L1_error)
+    __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 422, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     #endif
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   } else {
-    __Pyx_RaiseNoneNotIterableError(); __PYX_ERR(2, 422, __pyx_L1_error)
+    __Pyx_RaiseNoneNotIterableError(); __PYX_ERR(1, 422, __pyx_L1_error)
   }
   __pyx_v_have_slices = __pyx_t_3;
   __pyx_t_3 = 0;
   __Pyx_DECREF_SET(__pyx_v_index, __pyx_t_4);
   __pyx_t_4 = 0;
 
   /* "View.MemoryView":424
  *         have_slices, index = _unellipsify(index, self.view.ndim)
  * 
  *         if have_slices:             # <<<<<<<<<<<<<<
  *             obj = self.is_slice(value)
  *             if obj:
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_have_slices); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(2, 424, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_have_slices); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(1, 424, __pyx_L1_error)
   if (__pyx_t_1) {
 
     /* "View.MemoryView":425
  * 
  *         if have_slices:
  *             obj = self.is_slice(value)             # <<<<<<<<<<<<<<
  *             if obj:
  *                 self.setitem_slice_assignment(self[index], obj)
  */
-    __pyx_t_2 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->is_slice(__pyx_v_self, __pyx_v_value); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 425, __pyx_L1_error)
+    __pyx_t_2 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->is_slice(__pyx_v_self, __pyx_v_value); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 425, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_v_obj = __pyx_t_2;
     __pyx_t_2 = 0;
 
     /* "View.MemoryView":426
  *         if have_slices:
  *             obj = self.is_slice(value)
  *             if obj:             # <<<<<<<<<<<<<<
  *                 self.setitem_slice_assignment(self[index], obj)
  *             else:
  */
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_obj); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(2, 426, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_obj); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(1, 426, __pyx_L1_error)
     if (__pyx_t_1) {
 
       /* "View.MemoryView":427
  *             obj = self.is_slice(value)
  *             if obj:
  *                 self.setitem_slice_assignment(self[index], obj)             # <<<<<<<<<<<<<<
  *             else:
  *                 self.setitem_slice_assign_scalar(self[index], value)
  */
-      __pyx_t_2 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_self), __pyx_v_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 427, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_self), __pyx_v_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 427, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_4 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->setitem_slice_assignment(__pyx_v_self, __pyx_t_2, __pyx_v_obj); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 427, __pyx_L1_error)
+      __pyx_t_4 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->setitem_slice_assignment(__pyx_v_self, __pyx_t_2, __pyx_v_obj); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 427, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
       /* "View.MemoryView":426
  *         if have_slices:
  *             obj = self.is_slice(value)
@@ -10575,18 +8719,18 @@
  *                 self.setitem_slice_assignment(self[index], obj)
  *             else:
  *                 self.setitem_slice_assign_scalar(self[index], value)             # <<<<<<<<<<<<<<
  *         else:
  *             self.setitem_indexed(index, value)
  */
     /*else*/ {
-      __pyx_t_4 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_self), __pyx_v_index); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 429, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_self), __pyx_v_index); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 429, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_memoryview_type))))) __PYX_ERR(2, 429, __pyx_L1_error)
-      __pyx_t_2 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->setitem_slice_assign_scalar(__pyx_v_self, ((struct __pyx_memoryview_obj *)__pyx_t_4), __pyx_v_value); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 429, __pyx_L1_error)
+      if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_memoryview_type))))) __PYX_ERR(1, 429, __pyx_L1_error)
+      __pyx_t_2 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->setitem_slice_assign_scalar(__pyx_v_self, ((struct __pyx_memoryview_obj *)__pyx_t_4), __pyx_v_value); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 429, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     }
     __pyx_L5:;
 
     /* "View.MemoryView":424
@@ -10603,15 +8747,15 @@
  *                 self.setitem_slice_assign_scalar(self[index], value)
  *         else:
  *             self.setitem_indexed(index, value)             # <<<<<<<<<<<<<<
  * 
  *     cdef is_slice(self, obj):
  */
   /*else*/ {
-    __pyx_t_2 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->setitem_indexed(__pyx_v_self, __pyx_v_index, __pyx_v_value); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 431, __pyx_L1_error)
+    __pyx_t_2 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->setitem_indexed(__pyx_v_self, __pyx_v_index, __pyx_v_value); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 431, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
   __pyx_L4:;
 
   /* "View.MemoryView":418
  *             return self.convert_item_to_object(itemp)
@@ -10694,46 +8838,46 @@
         /* "View.MemoryView":436
  *         if not isinstance(obj, memoryview):
  *             try:
  *                 obj = memoryview(obj, self.flags & ~PyBUF_WRITABLE | PyBUF_ANY_CONTIGUOUS,             # <<<<<<<<<<<<<<
  *                                  self.dtype_is_object)
  *             except TypeError:
  */
-        __pyx_t_6 = __Pyx_PyInt_From_int(((__pyx_v_self->flags & (~PyBUF_WRITABLE)) | PyBUF_ANY_CONTIGUOUS)); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 436, __pyx_L4_error)
+        __pyx_t_6 = __Pyx_PyInt_From_int(((__pyx_v_self->flags & (~PyBUF_WRITABLE)) | PyBUF_ANY_CONTIGUOUS)); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 436, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_6);
 
         /* "View.MemoryView":437
  *             try:
  *                 obj = memoryview(obj, self.flags & ~PyBUF_WRITABLE | PyBUF_ANY_CONTIGUOUS,
  *                                  self.dtype_is_object)             # <<<<<<<<<<<<<<
  *             except TypeError:
  *                 return None
  */
-        __pyx_t_7 = __Pyx_PyBool_FromLong(__pyx_v_self->dtype_is_object); if (unlikely(!__pyx_t_7)) __PYX_ERR(2, 437, __pyx_L4_error)
+        __pyx_t_7 = __Pyx_PyBool_FromLong(__pyx_v_self->dtype_is_object); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 437, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_7);
 
         /* "View.MemoryView":436
  *         if not isinstance(obj, memoryview):
  *             try:
  *                 obj = memoryview(obj, self.flags & ~PyBUF_WRITABLE | PyBUF_ANY_CONTIGUOUS,             # <<<<<<<<<<<<<<
  *                                  self.dtype_is_object)
  *             except TypeError:
  */
-        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(2, 436, __pyx_L4_error)
+        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 436, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_INCREF(__pyx_v_obj);
         __Pyx_GIVEREF(__pyx_v_obj);
         PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_obj);
         __Pyx_GIVEREF(__pyx_t_6);
         PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_6);
         __Pyx_GIVEREF(__pyx_t_7);
         PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_7);
         __pyx_t_6 = 0;
         __pyx_t_7 = 0;
-        __pyx_t_7 = __Pyx_PyObject_Call(((PyObject *)__pyx_memoryview_type), __pyx_t_8, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(2, 436, __pyx_L4_error)
+        __pyx_t_7 = __Pyx_PyObject_Call(((PyObject *)__pyx_memoryview_type), __pyx_t_8, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 436, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF_SET(__pyx_v_obj, __pyx_t_7);
         __pyx_t_7 = 0;
 
         /* "View.MemoryView":435
  *     cdef is_slice(self, obj):
@@ -10758,15 +8902,15 @@
  *             except TypeError:             # <<<<<<<<<<<<<<
  *                 return None
  * 
  */
       __pyx_t_9 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_TypeError);
       if (__pyx_t_9) {
         __Pyx_AddTraceback("View.MemoryView.memoryview.is_slice", __pyx_clineno, __pyx_lineno, __pyx_filename);
-        if (__Pyx_GetException(&__pyx_t_7, &__pyx_t_8, &__pyx_t_6) < 0) __PYX_ERR(2, 438, __pyx_L6_except_error)
+        if (__Pyx_GetException(&__pyx_t_7, &__pyx_t_8, &__pyx_t_6) < 0) __PYX_ERR(1, 438, __pyx_L6_except_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_GOTREF(__pyx_t_6);
 
         /* "View.MemoryView":439
  *                                  self.dtype_is_object)
  *             except TypeError:
@@ -10875,51 +9019,51 @@
   /* "View.MemoryView":447
  *         cdef __Pyx_memviewslice src_slice
  * 
  *         memoryview_copy_contents(get_slice_from_memview(src, &src_slice)[0],             # <<<<<<<<<<<<<<
  *                                  get_slice_from_memview(dst, &dst_slice)[0],
  *                                  src.ndim, dst.ndim, self.dtype_is_object)
  */
-  if (!(likely(((__pyx_v_src) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_src, __pyx_memoryview_type))))) __PYX_ERR(2, 447, __pyx_L1_error)
-  __pyx_t_1 = __pyx_memoryview_get_slice_from_memoryview(((struct __pyx_memoryview_obj *)__pyx_v_src), (&__pyx_v_src_slice)); if (unlikely(__pyx_t_1 == ((__Pyx_memviewslice *)NULL))) __PYX_ERR(2, 447, __pyx_L1_error)
+  if (!(likely(((__pyx_v_src) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_src, __pyx_memoryview_type))))) __PYX_ERR(1, 447, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_get_slice_from_memoryview(((struct __pyx_memoryview_obj *)__pyx_v_src), (&__pyx_v_src_slice)); if (unlikely(__pyx_t_1 == ((__Pyx_memviewslice *)NULL))) __PYX_ERR(1, 447, __pyx_L1_error)
 
   /* "View.MemoryView":448
  * 
  *         memoryview_copy_contents(get_slice_from_memview(src, &src_slice)[0],
  *                                  get_slice_from_memview(dst, &dst_slice)[0],             # <<<<<<<<<<<<<<
  *                                  src.ndim, dst.ndim, self.dtype_is_object)
  * 
  */
-  if (!(likely(((__pyx_v_dst) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_dst, __pyx_memoryview_type))))) __PYX_ERR(2, 448, __pyx_L1_error)
-  __pyx_t_2 = __pyx_memoryview_get_slice_from_memoryview(((struct __pyx_memoryview_obj *)__pyx_v_dst), (&__pyx_v_dst_slice)); if (unlikely(__pyx_t_2 == ((__Pyx_memviewslice *)NULL))) __PYX_ERR(2, 448, __pyx_L1_error)
+  if (!(likely(((__pyx_v_dst) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_dst, __pyx_memoryview_type))))) __PYX_ERR(1, 448, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_get_slice_from_memoryview(((struct __pyx_memoryview_obj *)__pyx_v_dst), (&__pyx_v_dst_slice)); if (unlikely(__pyx_t_2 == ((__Pyx_memviewslice *)NULL))) __PYX_ERR(1, 448, __pyx_L1_error)
 
   /* "View.MemoryView":449
  *         memoryview_copy_contents(get_slice_from_memview(src, &src_slice)[0],
  *                                  get_slice_from_memview(dst, &dst_slice)[0],
  *                                  src.ndim, dst.ndim, self.dtype_is_object)             # <<<<<<<<<<<<<<
  * 
  *     cdef setitem_slice_assign_scalar(self, memoryview dst, value):
  */
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_src, __pyx_n_s_ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 449, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_src, __pyx_n_s_ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 449, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(2, 449, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 449, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_dst, __pyx_n_s_ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 449, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_dst, __pyx_n_s_ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 449, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(2, 449, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(1, 449, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
   /* "View.MemoryView":447
  *         cdef __Pyx_memviewslice src_slice
  * 
  *         memoryview_copy_contents(get_slice_from_memview(src, &src_slice)[0],             # <<<<<<<<<<<<<<
  *                                  get_slice_from_memview(dst, &dst_slice)[0],
  *                                  src.ndim, dst.ndim, self.dtype_is_object)
  */
-  __pyx_t_6 = __pyx_memoryview_copy_contents((__pyx_t_1[0]), (__pyx_t_2[0]), __pyx_t_4, __pyx_t_5, __pyx_v_self->dtype_is_object); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(2, 447, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_copy_contents((__pyx_t_1[0]), (__pyx_t_2[0]), __pyx_t_4, __pyx_t_5, __pyx_v_self->dtype_is_object); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(1, 447, __pyx_L1_error)
 
   /* "View.MemoryView":443
  *         return obj
  * 
  *     cdef setitem_slice_assignment(self, dst, src):             # <<<<<<<<<<<<<<
  *         cdef __Pyx_memviewslice dst_slice
  *         cdef __Pyx_memviewslice src_slice
@@ -10983,15 +9127,15 @@
   /* "View.MemoryView":458
  *         cdef __Pyx_memviewslice *dst_slice
  *         cdef __Pyx_memviewslice tmp_slice
  *         dst_slice = get_slice_from_memview(dst, &tmp_slice)             # <<<<<<<<<<<<<<
  * 
  *         if <size_t>self.view.itemsize > sizeof(array):
  */
-  __pyx_t_1 = __pyx_memoryview_get_slice_from_memoryview(__pyx_v_dst, (&__pyx_v_tmp_slice)); if (unlikely(__pyx_t_1 == ((__Pyx_memviewslice *)NULL))) __PYX_ERR(2, 458, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_get_slice_from_memoryview(__pyx_v_dst, (&__pyx_v_tmp_slice)); if (unlikely(__pyx_t_1 == ((__Pyx_memviewslice *)NULL))) __PYX_ERR(1, 458, __pyx_L1_error)
   __pyx_v_dst_slice = __pyx_t_1;
 
   /* "View.MemoryView":460
  *         dst_slice = get_slice_from_memview(dst, &tmp_slice)
  * 
  *         if <size_t>self.view.itemsize > sizeof(array):             # <<<<<<<<<<<<<<
  *             tmp = PyMem_Malloc(self.view.itemsize)
@@ -11022,15 +9166,15 @@
       /* "View.MemoryView":463
  *             tmp = PyMem_Malloc(self.view.itemsize)
  *             if tmp == NULL:
  *                 raise MemoryError             # <<<<<<<<<<<<<<
  *             item = tmp
  *         else:
  */
-      PyErr_NoMemory(); __PYX_ERR(2, 463, __pyx_L1_error)
+      PyErr_NoMemory(); __PYX_ERR(1, 463, __pyx_L1_error)
 
       /* "View.MemoryView":462
  *         if <size_t>self.view.itemsize > sizeof(array):
  *             tmp = PyMem_Malloc(self.view.itemsize)
  *             if tmp == NULL:             # <<<<<<<<<<<<<<
  *                 raise MemoryError
  *             item = tmp
@@ -11110,15 +9254,15 @@
  *                 (<PyObject **> item)[0] = <PyObject *> value
  *             else:
  *                 self.assign_item_from_object(<char *> item, value)             # <<<<<<<<<<<<<<
  * 
  * 
  */
     /*else*/ {
-      __pyx_t_3 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->assign_item_from_object(__pyx_v_self, ((char *)__pyx_v_item), __pyx_v_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 472, __pyx_L6_error)
+      __pyx_t_3 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->assign_item_from_object(__pyx_v_self, ((char *)__pyx_v_item), __pyx_v_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 472, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     }
     __pyx_L8:;
 
     /* "View.MemoryView":476
  * 
@@ -11133,15 +9277,15 @@
       /* "View.MemoryView":477
  * 
  *             if self.view.suboffsets != NULL:
  *                 assert_direct_dimensions(self.view.suboffsets, self.view.ndim)             # <<<<<<<<<<<<<<
  *             slice_assign_scalar(dst_slice, dst.view.ndim, self.view.itemsize,
  *                                 item, self.dtype_is_object)
  */
-      __pyx_t_3 = assert_direct_dimensions(__pyx_v_self->view.suboffsets, __pyx_v_self->view.ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 477, __pyx_L6_error)
+      __pyx_t_3 = assert_direct_dimensions(__pyx_v_self->view.suboffsets, __pyx_v_self->view.ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 477, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
       /* "View.MemoryView":476
  * 
  * 
  *             if self.view.suboffsets != NULL:             # <<<<<<<<<<<<<<
@@ -11250,25 +9394,25 @@
   /* "View.MemoryView":484
  * 
  *     cdef setitem_indexed(self, index, value):
  *         cdef char *itemp = self.get_item_pointer(index)             # <<<<<<<<<<<<<<
  *         self.assign_item_from_object(itemp, value)
  * 
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->get_item_pointer(__pyx_v_self, __pyx_v_index); if (unlikely(__pyx_t_1 == ((char *)NULL))) __PYX_ERR(2, 484, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->get_item_pointer(__pyx_v_self, __pyx_v_index); if (unlikely(__pyx_t_1 == ((char *)NULL))) __PYX_ERR(1, 484, __pyx_L1_error)
   __pyx_v_itemp = __pyx_t_1;
 
   /* "View.MemoryView":485
  *     cdef setitem_indexed(self, index, value):
  *         cdef char *itemp = self.get_item_pointer(index)
  *         self.assign_item_from_object(itemp, value)             # <<<<<<<<<<<<<<
  * 
  *     cdef convert_item_to_object(self, char *itemp):
  */
-  __pyx_t_2 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->assign_item_from_object(__pyx_v_self, __pyx_v_itemp, __pyx_v_value); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 485, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_memoryview *)__pyx_v_self->__pyx_vtab)->assign_item_from_object(__pyx_v_self, __pyx_v_itemp, __pyx_v_value); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "View.MemoryView":483
  *             PyMem_Free(tmp)
  * 
  *     cdef setitem_indexed(self, index, value):             # <<<<<<<<<<<<<<
@@ -11322,27 +9466,27 @@
   /* "View.MemoryView":490
  *         """Only used if instantiated manually by the user, or if Cython doesn't
  *         know how to convert the type"""
  *         import struct             # <<<<<<<<<<<<<<
  *         cdef bytes bytesitem
  * 
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_struct, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 490, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_struct, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 490, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_struct = __pyx_t_1;
   __pyx_t_1 = 0;
 
   /* "View.MemoryView":493
  *         cdef bytes bytesitem
  * 
  *         bytesitem = itemp[:self.view.itemsize]             # <<<<<<<<<<<<<<
  *         try:
  *             result = struct.unpack(self.view.format, bytesitem)
  */
-  __pyx_t_1 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_itemp + 0, __pyx_v_self->view.itemsize - 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 493, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_itemp + 0, __pyx_v_self->view.itemsize - 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 493, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_bytesitem = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "View.MemoryView":494
  * 
  *         bytesitem = itemp[:self.view.itemsize]
@@ -11362,17 +9506,17 @@
       /* "View.MemoryView":495
  *         bytesitem = itemp[:self.view.itemsize]
  *         try:
  *             result = struct.unpack(self.view.format, bytesitem)             # <<<<<<<<<<<<<<
  *         except struct.error:
  *             raise ValueError("Unable to convert item to object")
  */
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_struct, __pyx_n_s_unpack); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 495, __pyx_L3_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_struct, __pyx_n_s_unpack); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 495, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = __Pyx_PyBytes_FromString(__pyx_v_self->view.format); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 495, __pyx_L3_error)
+      __pyx_t_6 = __Pyx_PyBytes_FromString(__pyx_v_self->view.format); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 495, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_6);
       __pyx_t_7 = NULL;
       __pyx_t_8 = 0;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
         __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
         if (likely(__pyx_t_7)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
@@ -11381,42 +9525,42 @@
           __Pyx_DECREF_SET(__pyx_t_5, function);
           __pyx_t_8 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_5)) {
         PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_6, __pyx_v_bytesitem};
-        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 495, __pyx_L3_error)
+        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 495, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
         PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_6, __pyx_v_bytesitem};
-        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 495, __pyx_L3_error)
+        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 495, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       } else
       #endif
       {
-        __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(2, 495, __pyx_L3_error)
+        __pyx_t_9 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 495, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_9);
         if (__pyx_t_7) {
           __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7); __pyx_t_7 = NULL;
         }
         __Pyx_GIVEREF(__pyx_t_6);
         PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_8, __pyx_t_6);
         __Pyx_INCREF(__pyx_v_bytesitem);
         __Pyx_GIVEREF(__pyx_v_bytesitem);
         PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_8, __pyx_v_bytesitem);
         __pyx_t_6 = 0;
-        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 495, __pyx_L3_error)
+        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 495, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       }
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __pyx_v_result = __pyx_t_1;
       __pyx_t_1 = 0;
 
@@ -11445,15 +9589,15 @@
  *         else:
  *             if len(self.view.format) == 1:
  *                 return result[0]             # <<<<<<<<<<<<<<
  *             return result
  * 
  */
         __Pyx_XDECREF(__pyx_r);
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_result, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 500, __pyx_L5_except_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_result, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 500, __pyx_L5_except_error)
         __Pyx_GOTREF(__pyx_t_1);
         __pyx_r = __pyx_t_1;
         __pyx_t_1 = 0;
         goto __pyx_L6_except_return;
 
         /* "View.MemoryView":499
  *             raise ValueError("Unable to convert item to object")
@@ -11487,39 +9631,39 @@
  *         try:
  *             result = struct.unpack(self.view.format, bytesitem)
  *         except struct.error:             # <<<<<<<<<<<<<<
  *             raise ValueError("Unable to convert item to object")
  *         else:
  */
     __Pyx_ErrFetch(&__pyx_t_1, &__pyx_t_5, &__pyx_t_9);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_struct, __pyx_n_s_error); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 496, __pyx_L5_except_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_struct, __pyx_n_s_error); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 496, __pyx_L5_except_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_t_8 = __Pyx_PyErr_GivenExceptionMatches(__pyx_t_1, __pyx_t_6);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_ErrRestore(__pyx_t_1, __pyx_t_5, __pyx_t_9);
     __pyx_t_1 = 0; __pyx_t_5 = 0; __pyx_t_9 = 0;
     if (__pyx_t_8) {
       __Pyx_AddTraceback("View.MemoryView.memoryview.convert_item_to_object", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_9, &__pyx_t_5, &__pyx_t_1) < 0) __PYX_ERR(2, 496, __pyx_L5_except_error)
+      if (__Pyx_GetException(&__pyx_t_9, &__pyx_t_5, &__pyx_t_1) < 0) __PYX_ERR(1, 496, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_1);
 
       /* "View.MemoryView":497
  *             result = struct.unpack(self.view.format, bytesitem)
  *         except struct.error:
  *             raise ValueError("Unable to convert item to object")             # <<<<<<<<<<<<<<
  *         else:
  *             if len(self.view.format) == 1:
  */
-      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 497, __pyx_L5_except_error)
+      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 497, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_Raise(__pyx_t_6, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __PYX_ERR(2, 497, __pyx_L5_except_error)
+      __PYX_ERR(1, 497, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
     /* "View.MemoryView":494
  * 
  *         bytesitem = itemp[:self.view.itemsize]
@@ -11603,15 +9747,15 @@
   /* "View.MemoryView":506
  *         """Only used if instantiated manually by the user, or if Cython doesn't
  *         know how to convert the type"""
  *         import struct             # <<<<<<<<<<<<<<
  *         cdef char c
  *         cdef bytes bytesvalue
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_struct, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 506, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_struct, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_struct = __pyx_t_1;
   __pyx_t_1 = 0;
 
   /* "View.MemoryView":511
  *         cdef Py_ssize_t i
  * 
@@ -11626,34 +9770,34 @@
     /* "View.MemoryView":512
  * 
  *         if isinstance(value, tuple):
  *             bytesvalue = struct.pack(self.view.format, *value)             # <<<<<<<<<<<<<<
  *         else:
  *             bytesvalue = struct.pack(self.view.format, value)
  */
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_struct, __pyx_n_s_pack); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 512, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_struct, __pyx_n_s_pack); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 512, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_self->view.format); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 512, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyBytes_FromString(__pyx_v_self->view.format); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 512, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 512, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 512, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PySequence_Tuple(__pyx_v_value); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 512, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PySequence_Tuple(__pyx_v_value); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 512, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_6 = PyNumber_Add(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 512, __pyx_L1_error)
+    __pyx_t_6 = PyNumber_Add(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 512, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 512, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 512, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(2, 512, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(1, 512, __pyx_L1_error)
     __pyx_v_bytesvalue = ((PyObject*)__pyx_t_4);
     __pyx_t_4 = 0;
 
     /* "View.MemoryView":511
  *         cdef Py_ssize_t i
  * 
  *         if isinstance(value, tuple):             # <<<<<<<<<<<<<<
@@ -11667,17 +9811,17 @@
  *             bytesvalue = struct.pack(self.view.format, *value)
  *         else:
  *             bytesvalue = struct.pack(self.view.format, value)             # <<<<<<<<<<<<<<
  * 
  *         for i, c in enumerate(bytesvalue):
  */
   /*else*/ {
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_struct, __pyx_n_s_pack); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 514, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_struct, __pyx_n_s_pack); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 514, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_self->view.format); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 514, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyBytes_FromString(__pyx_v_self->view.format); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 514, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_5 = NULL;
     __pyx_t_7 = 0;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
@@ -11686,47 +9830,47 @@
         __Pyx_DECREF_SET(__pyx_t_6, function);
         __pyx_t_7 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_6)) {
       PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_1, __pyx_v_value};
-      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 514, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 514, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
       PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_1, __pyx_v_value};
-      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 514, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 514, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     } else
     #endif
     {
-      __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(2, 514, __pyx_L1_error)
+      __pyx_t_8 = PyTuple_New(2+__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 514, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       if (__pyx_t_5) {
         __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5); __pyx_t_5 = NULL;
       }
       __Pyx_GIVEREF(__pyx_t_1);
       PyTuple_SET_ITEM(__pyx_t_8, 0+__pyx_t_7, __pyx_t_1);
       __Pyx_INCREF(__pyx_v_value);
       __Pyx_GIVEREF(__pyx_v_value);
       PyTuple_SET_ITEM(__pyx_t_8, 1+__pyx_t_7, __pyx_v_value);
       __pyx_t_1 = 0;
-      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 514, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_8, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 514, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(2, 514, __pyx_L1_error)
+    if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(1, 514, __pyx_L1_error)
     __pyx_v_bytesvalue = ((PyObject*)__pyx_t_4);
     __pyx_t_4 = 0;
   }
   __pyx_L3:;
 
   /* "View.MemoryView":516
  *             bytesvalue = struct.pack(self.view.format, value)
@@ -11734,15 +9878,15 @@
  *         for i, c in enumerate(bytesvalue):             # <<<<<<<<<<<<<<
  *             itemp[i] = c
  * 
  */
   __pyx_t_9 = 0;
   if (unlikely(__pyx_v_bytesvalue == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' is not iterable");
-    __PYX_ERR(2, 516, __pyx_L1_error)
+    __PYX_ERR(1, 516, __pyx_L1_error)
   }
   __Pyx_INCREF(__pyx_v_bytesvalue);
   __pyx_t_10 = __pyx_v_bytesvalue;
   __pyx_t_12 = PyBytes_AS_STRING(__pyx_t_10);
   __pyx_t_13 = (__pyx_t_12 + PyBytes_GET_SIZE(__pyx_t_10));
   for (__pyx_t_14 = __pyx_t_12; __pyx_t_14 < __pyx_t_13; __pyx_t_14++) {
     __pyx_t_11 = __pyx_t_14;
@@ -11869,19 +10013,19 @@
     /* "View.MemoryView":522
  *     def __getbuffer__(self, Py_buffer *info, int flags):
  *         if flags & PyBUF_WRITABLE and self.view.readonly:
  *             raise ValueError("Cannot create writable memory view from read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         if flags & PyBUF_ND:
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__12, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 522, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__10, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 522, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(2, 522, __pyx_L1_error)
+    __PYX_ERR(1, 522, __pyx_L1_error)
 
     /* "View.MemoryView":521
  *     @cname('getbuffer')
  *     def __getbuffer__(self, Py_buffer *info, int flags):
  *         if flags & PyBUF_WRITABLE and self.view.readonly:             # <<<<<<<<<<<<<<
  *             raise ValueError("Cannot create writable memory view from read-only memoryview")
  * 
@@ -12184,28 +10328,28 @@
   /* "View.MemoryView":556
  *     @property
  *     def T(self):
  *         cdef _memoryviewslice result = memoryview_copy(self)             # <<<<<<<<<<<<<<
  *         transpose_memslice(&result.from_slice)
  *         return result
  */
-  __pyx_t_1 = __pyx_memoryview_copy_object(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 556, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_copy_object(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 556, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_memoryviewslice_type))))) __PYX_ERR(2, 556, __pyx_L1_error)
+  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_memoryviewslice_type))))) __PYX_ERR(1, 556, __pyx_L1_error)
   __pyx_v_result = ((struct __pyx_memoryviewslice_obj *)__pyx_t_1);
   __pyx_t_1 = 0;
 
   /* "View.MemoryView":557
  *     def T(self):
  *         cdef _memoryviewslice result = memoryview_copy(self)
  *         transpose_memslice(&result.from_slice)             # <<<<<<<<<<<<<<
  *         return result
  * 
  */
-  __pyx_t_2 = __pyx_memslice_transpose((&__pyx_v_result->from_slice)); if (unlikely(__pyx_t_2 == ((int)0))) __PYX_ERR(2, 557, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memslice_transpose((&__pyx_v_result->from_slice)); if (unlikely(__pyx_t_2 == ((int)0))) __PYX_ERR(1, 557, __pyx_L1_error)
 
   /* "View.MemoryView":558
  *         cdef _memoryviewslice result = memoryview_copy(self)
  *         transpose_memslice(&result.from_slice)
  *         return result             # <<<<<<<<<<<<<<
  * 
  *     @property
@@ -12327,26 +10471,26 @@
  *     @property
  *     def shape(self):
  *         return tuple([length for length in self.view.shape[:self.view.ndim]])             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 566, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 566, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_3 = (__pyx_v_self->view.shape + __pyx_v_self->view.ndim);
   for (__pyx_t_4 = __pyx_v_self->view.shape; __pyx_t_4 < __pyx_t_3; __pyx_t_4++) {
     __pyx_t_2 = __pyx_t_4;
     __pyx_v_length = (__pyx_t_2[0]);
-    __pyx_t_5 = PyInt_FromSsize_t(__pyx_v_length); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 566, __pyx_L1_error)
+    __pyx_t_5 = PyInt_FromSsize_t(__pyx_v_length); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 566, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_5))) __PYX_ERR(2, 566, __pyx_L1_error)
+    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_5))) __PYX_ERR(1, 566, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
-  __pyx_t_5 = PyList_AsTuple(((PyObject*)__pyx_t_1)); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 566, __pyx_L1_error)
+  __pyx_t_5 = PyList_AsTuple(((PyObject*)__pyx_t_1)); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 566, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":565
@@ -12418,19 +10562,19 @@
     /* "View.MemoryView":572
  *         if self.view.strides == NULL:
  * 
  *             raise ValueError("Buffer view does not expose strides")             # <<<<<<<<<<<<<<
  * 
  *         return tuple([stride for stride in self.view.strides[:self.view.ndim]])
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__13, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 572, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 572, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(2, 572, __pyx_L1_error)
+    __PYX_ERR(1, 572, __pyx_L1_error)
 
     /* "View.MemoryView":570
  *     @property
  *     def strides(self):
  *         if self.view.strides == NULL:             # <<<<<<<<<<<<<<
  * 
  *             raise ValueError("Buffer view does not expose strides")
@@ -12441,26 +10585,26 @@
  *             raise ValueError("Buffer view does not expose strides")
  * 
  *         return tuple([stride for stride in self.view.strides[:self.view.ndim]])             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 574, __pyx_L1_error)
+  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 574, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_4 = (__pyx_v_self->view.strides + __pyx_v_self->view.ndim);
   for (__pyx_t_5 = __pyx_v_self->view.strides; __pyx_t_5 < __pyx_t_4; __pyx_t_5++) {
     __pyx_t_3 = __pyx_t_5;
     __pyx_v_stride = (__pyx_t_3[0]);
-    __pyx_t_6 = PyInt_FromSsize_t(__pyx_v_stride); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 574, __pyx_L1_error)
+    __pyx_t_6 = PyInt_FromSsize_t(__pyx_v_stride); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 574, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_6))) __PYX_ERR(2, 574, __pyx_L1_error)
+    if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_6))) __PYX_ERR(1, 574, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   }
-  __pyx_t_6 = PyList_AsTuple(((PyObject*)__pyx_t_2)); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 574, __pyx_L1_error)
+  __pyx_t_6 = PyList_AsTuple(((PyObject*)__pyx_t_2)); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 574, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_6;
   __pyx_t_6 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":569
@@ -12533,17 +10677,17 @@
  *     def suboffsets(self):
  *         if self.view.suboffsets == NULL:
  *             return (-1,) * self.view.ndim             # <<<<<<<<<<<<<<
  * 
  *         return tuple([suboffset for suboffset in self.view.suboffsets[:self.view.ndim]])
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->view.ndim); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 579, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_self->view.ndim); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 579, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyNumber_Multiply(__pyx_tuple__14, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 579, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Multiply(__pyx_tuple__12, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 579, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
     /* "View.MemoryView":578
@@ -12559,26 +10703,26 @@
  *             return (-1,) * self.view.ndim
  * 
  *         return tuple([suboffset for suboffset in self.view.suboffsets[:self.view.ndim]])             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 581, __pyx_L1_error)
+  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 581, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_5 = (__pyx_v_self->view.suboffsets + __pyx_v_self->view.ndim);
   for (__pyx_t_6 = __pyx_v_self->view.suboffsets; __pyx_t_6 < __pyx_t_5; __pyx_t_6++) {
     __pyx_t_4 = __pyx_t_6;
     __pyx_v_suboffset = (__pyx_t_4[0]);
-    __pyx_t_2 = PyInt_FromSsize_t(__pyx_v_suboffset); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 581, __pyx_L1_error)
+    __pyx_t_2 = PyInt_FromSsize_t(__pyx_v_suboffset); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 581, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_2))) __PYX_ERR(2, 581, __pyx_L1_error)
+    if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_2))) __PYX_ERR(1, 581, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
-  __pyx_t_2 = PyList_AsTuple(((PyObject*)__pyx_t_3)); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 581, __pyx_L1_error)
+  __pyx_t_2 = PyList_AsTuple(((PyObject*)__pyx_t_3)); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 581, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":577
@@ -12635,15 +10779,15 @@
  *     @property
  *     def ndim(self):
  *         return self.view.ndim             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->view.ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 585, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_self->view.ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":584
  * 
@@ -12698,15 +10842,15 @@
  *     @property
  *     def itemsize(self):
  *         return self.view.itemsize             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyInt_FromSsize_t(__pyx_v_self->view.itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 589, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_v_self->view.itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":588
  * 
@@ -12763,19 +10907,19 @@
  *     @property
  *     def nbytes(self):
  *         return self.size * self.view.itemsize             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_size); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 593, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_size); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_v_self->view.itemsize); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 593, __pyx_L1_error)
+  __pyx_t_2 = PyInt_FromSsize_t(__pyx_v_self->view.itemsize); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 593, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
@@ -12864,27 +11008,27 @@
  *             for length in self.view.shape[:self.view.ndim]:             # <<<<<<<<<<<<<<
  *                 result *= length
  * 
  */
     __pyx_t_4 = (__pyx_v_self->view.shape + __pyx_v_self->view.ndim);
     for (__pyx_t_5 = __pyx_v_self->view.shape; __pyx_t_5 < __pyx_t_4; __pyx_t_5++) {
       __pyx_t_3 = __pyx_t_5;
-      __pyx_t_6 = PyInt_FromSsize_t((__pyx_t_3[0])); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 600, __pyx_L1_error)
+      __pyx_t_6 = PyInt_FromSsize_t((__pyx_t_3[0])); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 600, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_XDECREF_SET(__pyx_v_length, __pyx_t_6);
       __pyx_t_6 = 0;
 
       /* "View.MemoryView":601
  * 
  *             for length in self.view.shape[:self.view.ndim]:
  *                 result *= length             # <<<<<<<<<<<<<<
  * 
  *             self._size = result
  */
-      __pyx_t_6 = PyNumber_InPlaceMultiply(__pyx_v_result, __pyx_v_length); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 601, __pyx_L1_error)
+      __pyx_t_6 = PyNumber_InPlaceMultiply(__pyx_v_result, __pyx_v_length); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 601, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF_SET(__pyx_v_result, __pyx_t_6);
       __pyx_t_6 = 0;
     }
 
     /* "View.MemoryView":603
  *                 result *= length
@@ -13057,49 +11201,49 @@
  * 
  *     def __repr__(self):
  *         return "<MemoryView of %r at 0x%x>" % (self.base.__class__.__name__,             # <<<<<<<<<<<<<<
  *                                                id(self))
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 614, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 614, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_class); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 614, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_class); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 614, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_name_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 614, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_name_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 614, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "View.MemoryView":615
  *     def __repr__(self):
  *         return "<MemoryView of %r at 0x%x>" % (self.base.__class__.__name__,
  *                                                id(self))             # <<<<<<<<<<<<<<
  * 
  *     def __str__(self):
  */
-  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 615, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_id, ((PyObject *)__pyx_v_self)); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 615, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
   /* "View.MemoryView":614
  * 
  *     def __repr__(self):
  *         return "<MemoryView of %r at 0x%x>" % (self.base.__class__.__name__,             # <<<<<<<<<<<<<<
  *                                                id(self))
  * 
  */
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 614, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 614, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_MemoryView_of_r_at_0x_x, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 614, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyString_Format(__pyx_kp_s_MemoryView_of_r_at_0x_x, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 614, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":613
@@ -13158,28 +11302,28 @@
  * 
  *     def __str__(self):
  *         return "<MemoryView of %r object>" % (self.base.__class__.__name__,)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 618, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 618, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_class); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 618, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_class); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 618, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_name_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 618, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_name_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 618, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 618, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 618, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_MemoryView_of_r_object, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 618, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_MemoryView_of_r_object, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 618, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":617
@@ -13238,26 +11382,26 @@
   /* "View.MemoryView":624
  *         cdef __Pyx_memviewslice *mslice
  *         cdef __Pyx_memviewslice tmp
  *         mslice = get_slice_from_memview(self, &tmp)             # <<<<<<<<<<<<<<
  *         return slice_is_contig(mslice[0], 'C', self.view.ndim)
  * 
  */
-  __pyx_t_1 = __pyx_memoryview_get_slice_from_memoryview(__pyx_v_self, (&__pyx_v_tmp)); if (unlikely(__pyx_t_1 == ((__Pyx_memviewslice *)NULL))) __PYX_ERR(2, 624, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_get_slice_from_memoryview(__pyx_v_self, (&__pyx_v_tmp)); if (unlikely(__pyx_t_1 == ((__Pyx_memviewslice *)NULL))) __PYX_ERR(1, 624, __pyx_L1_error)
   __pyx_v_mslice = __pyx_t_1;
 
   /* "View.MemoryView":625
  *         cdef __Pyx_memviewslice tmp
  *         mslice = get_slice_from_memview(self, &tmp)
  *         return slice_is_contig(mslice[0], 'C', self.view.ndim)             # <<<<<<<<<<<<<<
  * 
  *     def is_f_contig(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_memviewslice_is_contig((__pyx_v_mslice[0]), 'C', __pyx_v_self->view.ndim)); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 625, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_memviewslice_is_contig((__pyx_v_mslice[0]), 'C', __pyx_v_self->view.ndim)); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 625, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":621
  * 
@@ -13314,26 +11458,26 @@
   /* "View.MemoryView":630
  *         cdef __Pyx_memviewslice *mslice
  *         cdef __Pyx_memviewslice tmp
  *         mslice = get_slice_from_memview(self, &tmp)             # <<<<<<<<<<<<<<
  *         return slice_is_contig(mslice[0], 'F', self.view.ndim)
  * 
  */
-  __pyx_t_1 = __pyx_memoryview_get_slice_from_memoryview(__pyx_v_self, (&__pyx_v_tmp)); if (unlikely(__pyx_t_1 == ((__Pyx_memviewslice *)NULL))) __PYX_ERR(2, 630, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_get_slice_from_memoryview(__pyx_v_self, (&__pyx_v_tmp)); if (unlikely(__pyx_t_1 == ((__Pyx_memviewslice *)NULL))) __PYX_ERR(1, 630, __pyx_L1_error)
   __pyx_v_mslice = __pyx_t_1;
 
   /* "View.MemoryView":631
  *         cdef __Pyx_memviewslice tmp
  *         mslice = get_slice_from_memview(self, &tmp)
  *         return slice_is_contig(mslice[0], 'F', self.view.ndim)             # <<<<<<<<<<<<<<
  * 
  *     def copy(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_memviewslice_is_contig((__pyx_v_mslice[0]), 'F', __pyx_v_self->view.ndim)); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 631, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_memviewslice_is_contig((__pyx_v_mslice[0]), 'F', __pyx_v_self->view.ndim)); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 631, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":627
  *         return slice_is_contig(mslice[0], 'C', self.view.ndim)
@@ -13408,26 +11552,26 @@
   /* "View.MemoryView":638
  * 
  *         slice_copy(self, &mslice)
  *         mslice = slice_copy_contig(&mslice, "c", self.view.ndim,             # <<<<<<<<<<<<<<
  *                                    self.view.itemsize,
  *                                    flags|PyBUF_C_CONTIGUOUS,
  */
-  __pyx_t_1 = __pyx_memoryview_copy_new_contig((&__pyx_v_mslice), ((char *)"c"), __pyx_v_self->view.ndim, __pyx_v_self->view.itemsize, (__pyx_v_flags | PyBUF_C_CONTIGUOUS), __pyx_v_self->dtype_is_object); if (unlikely(PyErr_Occurred())) __PYX_ERR(2, 638, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_copy_new_contig((&__pyx_v_mslice), ((char *)"c"), __pyx_v_self->view.ndim, __pyx_v_self->view.itemsize, (__pyx_v_flags | PyBUF_C_CONTIGUOUS), __pyx_v_self->dtype_is_object); if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 638, __pyx_L1_error)
   __pyx_v_mslice = __pyx_t_1;
 
   /* "View.MemoryView":643
  *                                    self.dtype_is_object)
  * 
  *         return memoryview_copy_from_slice(self, &mslice)             # <<<<<<<<<<<<<<
  * 
  *     def copy_fortran(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __pyx_memoryview_copy_object_from_slice(__pyx_v_self, (&__pyx_v_mslice)); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 643, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_copy_object_from_slice(__pyx_v_self, (&__pyx_v_mslice)); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 643, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":633
  *         return slice_is_contig(mslice[0], 'F', self.view.ndim)
@@ -13503,26 +11647,26 @@
   /* "View.MemoryView":650
  * 
  *         slice_copy(self, &src)
  *         dst = slice_copy_contig(&src, "fortran", self.view.ndim,             # <<<<<<<<<<<<<<
  *                                 self.view.itemsize,
  *                                 flags|PyBUF_F_CONTIGUOUS,
  */
-  __pyx_t_1 = __pyx_memoryview_copy_new_contig((&__pyx_v_src), ((char *)"fortran"), __pyx_v_self->view.ndim, __pyx_v_self->view.itemsize, (__pyx_v_flags | PyBUF_F_CONTIGUOUS), __pyx_v_self->dtype_is_object); if (unlikely(PyErr_Occurred())) __PYX_ERR(2, 650, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_copy_new_contig((&__pyx_v_src), ((char *)"fortran"), __pyx_v_self->view.ndim, __pyx_v_self->view.itemsize, (__pyx_v_flags | PyBUF_F_CONTIGUOUS), __pyx_v_self->dtype_is_object); if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 650, __pyx_L1_error)
   __pyx_v_dst = __pyx_t_1;
 
   /* "View.MemoryView":655
  *                                 self.dtype_is_object)
  * 
  *         return memoryview_copy_from_slice(self, &dst)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __pyx_memoryview_copy_object_from_slice(__pyx_v_self, (&__pyx_v_dst)); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 655, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_copy_object_from_slice(__pyx_v_self, (&__pyx_v_dst)); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 655, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":645
  *         return memoryview_copy_from_slice(self, &mslice)
@@ -13573,19 +11717,19 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__13, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(2, 2, __pyx_L1_error)
+  __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  */
 
@@ -13629,19 +11773,19 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__14, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(2, 4, __pyx_L1_error)
+  __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
@@ -13679,30 +11823,30 @@
   /* "View.MemoryView":660
  * @cname('__pyx_memoryview_new')
  * cdef memoryview_cwrapper(object o, int flags, bint dtype_is_object, __Pyx_TypeInfo *typeinfo):
  *     cdef memoryview result = memoryview(o, flags, dtype_is_object)             # <<<<<<<<<<<<<<
  *     result.typeinfo = typeinfo
  *     return result
  */
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 660, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 660, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_dtype_is_object); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 660, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_dtype_is_object); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 660, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 660, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 660, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_v_o);
   __Pyx_GIVEREF(__pyx_v_o);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_o);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_2);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_memoryview_type), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 660, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_memoryview_type), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 660, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_result = ((struct __pyx_memoryview_obj *)__pyx_t_2);
   __pyx_t_2 = 0;
 
   /* "View.MemoryView":661
  * cdef memoryview_cwrapper(object o, int flags, bint dtype_is_object, __Pyx_TypeInfo *typeinfo):
@@ -13834,15 +11978,15 @@
     /* "View.MemoryView":674
  *     """
  *     if not isinstance(index, tuple):
  *         tup = (index,)             # <<<<<<<<<<<<<<
  *     else:
  *         tup = index
  */
-    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 674, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 674, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_v_index);
     __Pyx_GIVEREF(__pyx_v_index);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_index);
     __pyx_v_tup = __pyx_t_3;
     __pyx_t_3 = 0;
 
@@ -13872,15 +12016,15 @@
   /* "View.MemoryView":678
  *         tup = index
  * 
  *     result = []             # <<<<<<<<<<<<<<
  *     have_slices = False
  *     seen_ellipsis = False
  */
-  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 678, __pyx_L1_error)
+  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_v_result = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
 
   /* "View.MemoryView":679
  * 
  *     result = []
@@ -13908,54 +12052,54 @@
  */
   __Pyx_INCREF(__pyx_int_0);
   __pyx_t_3 = __pyx_int_0;
   if (likely(PyList_CheckExact(__pyx_v_tup)) || PyTuple_CheckExact(__pyx_v_tup)) {
     __pyx_t_4 = __pyx_v_tup; __Pyx_INCREF(__pyx_t_4); __pyx_t_5 = 0;
     __pyx_t_6 = NULL;
   } else {
-    __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_tup); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 681, __pyx_L1_error)
+    __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_tup); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 681, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 681, __pyx_L1_error)
+    __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 681, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_6)) {
       if (likely(PyList_CheckExact(__pyx_t_4))) {
         if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_4)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_7 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(2, 681, __pyx_L1_error)
+        __pyx_t_7 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(1, 681, __pyx_L1_error)
         #else
-        __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(2, 681, __pyx_L1_error)
+        __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 681, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         #endif
       } else {
         if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(2, 681, __pyx_L1_error)
+        __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(1, 681, __pyx_L1_error)
         #else
-        __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(2, 681, __pyx_L1_error)
+        __pyx_t_7 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 681, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         #endif
       }
     } else {
       __pyx_t_7 = __pyx_t_6(__pyx_t_4);
       if (unlikely(!__pyx_t_7)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(2, 681, __pyx_L1_error)
+          else __PYX_ERR(1, 681, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_7);
     }
     __Pyx_XDECREF_SET(__pyx_v_item, __pyx_t_7);
     __pyx_t_7 = 0;
     __Pyx_INCREF(__pyx_t_3);
     __Pyx_XDECREF_SET(__pyx_v_idx, __pyx_t_3);
-    __pyx_t_7 = __Pyx_PyInt_AddObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(2, 681, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_AddObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 681, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_3);
     __pyx_t_3 = __pyx_t_7;
     __pyx_t_7 = 0;
 
     /* "View.MemoryView":682
  *     seen_ellipsis = False
@@ -13981,25 +12125,25 @@
         /* "View.MemoryView":684
  *         if item is Ellipsis:
  *             if not seen_ellipsis:
  *                 result.extend([slice(None)] * (ndim - len(tup) + 1))             # <<<<<<<<<<<<<<
  *                 seen_ellipsis = True
  *             else:
  */
-        __pyx_t_8 = PyObject_Length(__pyx_v_tup); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(2, 684, __pyx_L1_error)
-        __pyx_t_7 = PyList_New(1 * ((((__pyx_v_ndim - __pyx_t_8) + 1)<0) ? 0:((__pyx_v_ndim - __pyx_t_8) + 1))); if (unlikely(!__pyx_t_7)) __PYX_ERR(2, 684, __pyx_L1_error)
+        __pyx_t_8 = PyObject_Length(__pyx_v_tup); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(1, 684, __pyx_L1_error)
+        __pyx_t_7 = PyList_New(1 * ((((__pyx_v_ndim - __pyx_t_8) + 1)<0) ? 0:((__pyx_v_ndim - __pyx_t_8) + 1))); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 684, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         { Py_ssize_t __pyx_temp;
           for (__pyx_temp=0; __pyx_temp < ((__pyx_v_ndim - __pyx_t_8) + 1); __pyx_temp++) {
-            __Pyx_INCREF(__pyx_slice__17);
-            __Pyx_GIVEREF(__pyx_slice__17);
-            PyList_SET_ITEM(__pyx_t_7, __pyx_temp, __pyx_slice__17);
+            __Pyx_INCREF(__pyx_slice__15);
+            __Pyx_GIVEREF(__pyx_slice__15);
+            PyList_SET_ITEM(__pyx_t_7, __pyx_temp, __pyx_slice__15);
           }
         }
-        __pyx_t_9 = __Pyx_PyList_Extend(__pyx_v_result, __pyx_t_7); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(2, 684, __pyx_L1_error)
+        __pyx_t_9 = __Pyx_PyList_Extend(__pyx_v_result, __pyx_t_7); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 684, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
         /* "View.MemoryView":685
  *             if not seen_ellipsis:
  *                 result.extend([slice(None)] * (ndim - len(tup) + 1))
  *                 seen_ellipsis = True             # <<<<<<<<<<<<<<
  *             else:
@@ -14021,15 +12165,15 @@
  *                 seen_ellipsis = True
  *             else:
  *                 result.append(slice(None))             # <<<<<<<<<<<<<<
  *             have_slices = True
  *         else:
  */
       /*else*/ {
-        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_result, __pyx_slice__17); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(2, 687, __pyx_L1_error)
+        __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_result, __pyx_slice__15); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 687, __pyx_L1_error)
       }
       __pyx_L7:;
 
       /* "View.MemoryView":688
  *             else:
  *                 result.append(slice(None))
  *             have_slices = True             # <<<<<<<<<<<<<<
@@ -14071,22 +12215,22 @@
         /* "View.MemoryView":691
  *         else:
  *             if not isinstance(item, slice) and not PyIndex_Check(item):
  *                 raise TypeError("Cannot index with type '%s'" % type(item))             # <<<<<<<<<<<<<<
  * 
  *             have_slices = have_slices or isinstance(item, slice)
  */
-        __pyx_t_7 = __Pyx_PyString_FormatSafe(__pyx_kp_s_Cannot_index_with_type_s, ((PyObject *)Py_TYPE(__pyx_v_item))); if (unlikely(!__pyx_t_7)) __PYX_ERR(2, 691, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyString_FormatSafe(__pyx_kp_s_Cannot_index_with_type_s, ((PyObject *)Py_TYPE(__pyx_v_item))); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 691, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_11 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_7); if (unlikely(!__pyx_t_11)) __PYX_ERR(2, 691, __pyx_L1_error)
+        __pyx_t_11 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_7); if (unlikely(!__pyx_t_11)) __PYX_ERR(1, 691, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_Raise(__pyx_t_11, 0, 0, 0);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-        __PYX_ERR(2, 691, __pyx_L1_error)
+        __PYX_ERR(1, 691, __pyx_L1_error)
 
         /* "View.MemoryView":690
  *             have_slices = True
  *         else:
  *             if not isinstance(item, slice) and not PyIndex_Check(item):             # <<<<<<<<<<<<<<
  *                 raise TypeError("Cannot index with type '%s'" % type(item))
  * 
@@ -14115,15 +12259,15 @@
       /* "View.MemoryView":694
  * 
  *             have_slices = have_slices or isinstance(item, slice)
  *             result.append(item)             # <<<<<<<<<<<<<<
  * 
  *     nslices = ndim - len(result)
  */
-      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_result, __pyx_v_item); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(2, 694, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_result, __pyx_v_item); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 694, __pyx_L1_error)
     }
     __pyx_L6:;
 
     /* "View.MemoryView":681
  *     have_slices = False
  *     seen_ellipsis = False
  *     for idx, item in enumerate(tup):             # <<<<<<<<<<<<<<
@@ -14137,15 +12281,15 @@
   /* "View.MemoryView":696
  *             result.append(item)
  * 
  *     nslices = ndim - len(result)             # <<<<<<<<<<<<<<
  *     if nslices:
  *         result.extend([slice(None)] * nslices)
  */
-  __pyx_t_5 = PyList_GET_SIZE(__pyx_v_result); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(2, 696, __pyx_L1_error)
+  __pyx_t_5 = PyList_GET_SIZE(__pyx_v_result); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(1, 696, __pyx_L1_error)
   __pyx_v_nslices = (__pyx_v_ndim - __pyx_t_5);
 
   /* "View.MemoryView":697
  * 
  *     nslices = ndim - len(result)
  *     if nslices:             # <<<<<<<<<<<<<<
  *         result.extend([slice(None)] * nslices)
@@ -14157,24 +12301,24 @@
     /* "View.MemoryView":698
  *     nslices = ndim - len(result)
  *     if nslices:
  *         result.extend([slice(None)] * nslices)             # <<<<<<<<<<<<<<
  * 
  *     return have_slices or nslices, tuple(result)
  */
-    __pyx_t_3 = PyList_New(1 * ((__pyx_v_nslices<0) ? 0:__pyx_v_nslices)); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 698, __pyx_L1_error)
+    __pyx_t_3 = PyList_New(1 * ((__pyx_v_nslices<0) ? 0:__pyx_v_nslices)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 698, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     { Py_ssize_t __pyx_temp;
       for (__pyx_temp=0; __pyx_temp < __pyx_v_nslices; __pyx_temp++) {
-        __Pyx_INCREF(__pyx_slice__17);
-        __Pyx_GIVEREF(__pyx_slice__17);
-        PyList_SET_ITEM(__pyx_t_3, __pyx_temp, __pyx_slice__17);
+        __Pyx_INCREF(__pyx_slice__15);
+        __Pyx_GIVEREF(__pyx_slice__15);
+        PyList_SET_ITEM(__pyx_t_3, __pyx_temp, __pyx_slice__15);
       }
     }
-    __pyx_t_9 = __Pyx_PyList_Extend(__pyx_v_result, __pyx_t_3); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(2, 698, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyList_Extend(__pyx_v_result, __pyx_t_3); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 698, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
     /* "View.MemoryView":697
  * 
  *     nslices = ndim - len(result)
  *     if nslices:             # <<<<<<<<<<<<<<
  *         result.extend([slice(None)] * nslices)
@@ -14188,28 +12332,28 @@
  *     return have_slices or nslices, tuple(result)             # <<<<<<<<<<<<<<
  * 
  * cdef assert_direct_dimensions(Py_ssize_t *suboffsets, int ndim):
  */
   __Pyx_XDECREF(__pyx_r);
   if (!__pyx_v_have_slices) {
   } else {
-    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_have_slices); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 700, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_have_slices); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 700, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_3 = __pyx_t_4;
     __pyx_t_4 = 0;
     goto __pyx_L14_bool_binop_done;
   }
-  __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_nslices); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 700, __pyx_L1_error)
+  __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_nslices); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 700, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_3 = __pyx_t_4;
   __pyx_t_4 = 0;
   __pyx_L14_bool_binop_done:;
-  __pyx_t_4 = PyList_AsTuple(__pyx_v_result); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 700, __pyx_L1_error)
+  __pyx_t_4 = PyList_AsTuple(__pyx_v_result); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 700, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(2, 700, __pyx_L1_error)
+  __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(1, 700, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_4);
   __pyx_t_3 = 0;
   __pyx_t_4 = 0;
@@ -14290,19 +12434,19 @@
       /* "View.MemoryView":705
  *     for suboffset in suboffsets[:ndim]:
  *         if suboffset >= 0:
  *             raise ValueError("Indirect dimensions not supported")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__18, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 705, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 705, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_Raise(__pyx_t_5, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __PYX_ERR(2, 705, __pyx_L1_error)
+      __PYX_ERR(1, 705, __pyx_L1_error)
 
       /* "View.MemoryView":704
  * cdef assert_direct_dimensions(Py_ssize_t *suboffsets, int ndim):
  *     for suboffset in suboffsets[:ndim]:
  *         if suboffset >= 0:             # <<<<<<<<<<<<<<
  *             raise ValueError("Indirect dimensions not supported")
  * 
@@ -14401,15 +12545,15 @@
  * 
  *     if isinstance(memview, _memoryviewslice):
  */
   #ifndef CYTHON_WITHOUT_ASSERTIONS
   if (unlikely(!Py_OptimizeFlag)) {
     if (unlikely(!((__pyx_v_memview->view.ndim > 0) != 0))) {
       PyErr_SetNone(PyExc_AssertionError);
-      __PYX_ERR(2, 724, __pyx_L1_error)
+      __PYX_ERR(1, 724, __pyx_L1_error)
     }
   }
   #endif
 
   /* "View.MemoryView":726
  *     assert memview.view.ndim > 0
  * 
@@ -14424,15 +12568,15 @@
     /* "View.MemoryView":727
  * 
  *     if isinstance(memview, _memoryviewslice):
  *         memviewsliceobj = memview             # <<<<<<<<<<<<<<
  *         p_src = &memviewsliceobj.from_slice
  *     else:
  */
-    if (!(likely(((((PyObject *)__pyx_v_memview)) == Py_None) || likely(__Pyx_TypeTest(((PyObject *)__pyx_v_memview), __pyx_memoryviewslice_type))))) __PYX_ERR(2, 727, __pyx_L1_error)
+    if (!(likely(((((PyObject *)__pyx_v_memview)) == Py_None) || likely(__Pyx_TypeTest(((PyObject *)__pyx_v_memview), __pyx_memoryviewslice_type))))) __PYX_ERR(1, 727, __pyx_L1_error)
     __pyx_t_3 = ((PyObject *)__pyx_v_memview);
     __Pyx_INCREF(__pyx_t_3);
     __pyx_v_memviewsliceobj = ((struct __pyx_memoryviewslice_obj *)__pyx_t_3);
     __pyx_t_3 = 0;
 
     /* "View.MemoryView":728
  *     if isinstance(memview, _memoryviewslice):
@@ -14520,44 +12664,44 @@
  *             slice_memviewslice(
  */
   __pyx_t_6 = 0;
   if (likely(PyList_CheckExact(__pyx_v_indices)) || PyTuple_CheckExact(__pyx_v_indices)) {
     __pyx_t_3 = __pyx_v_indices; __Pyx_INCREF(__pyx_t_3); __pyx_t_7 = 0;
     __pyx_t_8 = NULL;
   } else {
-    __pyx_t_7 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 748, __pyx_L1_error)
+    __pyx_t_7 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 748, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_8 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(2, 748, __pyx_L1_error)
+    __pyx_t_8 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 748, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_8)) {
       if (likely(PyList_CheckExact(__pyx_t_3))) {
         if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_3)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_9 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(2, 748, __pyx_L1_error)
+        __pyx_t_9 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(1, 748, __pyx_L1_error)
         #else
-        __pyx_t_9 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) __PYX_ERR(2, 748, __pyx_L1_error)
+        __pyx_t_9 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 748, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         #endif
       } else {
         if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(2, 748, __pyx_L1_error)
+        __pyx_t_9 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_9); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(1, 748, __pyx_L1_error)
         #else
-        __pyx_t_9 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) __PYX_ERR(2, 748, __pyx_L1_error)
+        __pyx_t_9 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 748, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         #endif
       }
     } else {
       __pyx_t_9 = __pyx_t_8(__pyx_t_3);
       if (unlikely(!__pyx_t_9)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(2, 748, __pyx_L1_error)
+          else __PYX_ERR(1, 748, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_9);
     }
     __Pyx_XDECREF_SET(__pyx_v_index, __pyx_t_9);
     __pyx_t_9 = 0;
@@ -14577,24 +12721,24 @@
       /* "View.MemoryView":753
  *                 p_dst, p_src.shape[dim], p_src.strides[dim], p_src.suboffsets[dim],
  *                 dim, new_ndim, p_suboffset_dim,
  *                 index, 0, 0, # start, stop, step             # <<<<<<<<<<<<<<
  *                 0, 0, 0, # have_{start,stop,step}
  *                 False)
  */
-      __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_v_index); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(2, 753, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_v_index); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(1, 753, __pyx_L1_error)
 
       /* "View.MemoryView":750
  *     for dim, index in enumerate(indices):
  *         if PyIndex_Check(index):
  *             slice_memviewslice(             # <<<<<<<<<<<<<<
  *                 p_dst, p_src.shape[dim], p_src.strides[dim], p_src.suboffsets[dim],
  *                 dim, new_ndim, p_suboffset_dim,
  */
-      __pyx_t_11 = __pyx_memoryview_slice_memviewslice(__pyx_v_p_dst, (__pyx_v_p_src->shape[__pyx_v_dim]), (__pyx_v_p_src->strides[__pyx_v_dim]), (__pyx_v_p_src->suboffsets[__pyx_v_dim]), __pyx_v_dim, __pyx_v_new_ndim, __pyx_v_p_suboffset_dim, __pyx_t_10, 0, 0, 0, 0, 0, 0); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(2, 750, __pyx_L1_error)
+      __pyx_t_11 = __pyx_memoryview_slice_memviewslice(__pyx_v_p_dst, (__pyx_v_p_src->shape[__pyx_v_dim]), (__pyx_v_p_src->strides[__pyx_v_dim]), (__pyx_v_p_src->suboffsets[__pyx_v_dim]), __pyx_v_dim, __pyx_v_new_ndim, __pyx_v_p_suboffset_dim, __pyx_t_10, 0, 0, 0, 0, 0, 0); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(1, 750, __pyx_L1_error)
 
       /* "View.MemoryView":749
  * 
  *     for dim, index in enumerate(indices):
  *         if PyIndex_Check(index):             # <<<<<<<<<<<<<<
  *             slice_memviewslice(
  *                 p_dst, p_src.shape[dim], p_src.strides[dim], p_src.suboffsets[dim],
@@ -14663,21 +12807,21 @@
  *             new_ndim += 1
  *         else:
  *             start = index.start or 0             # <<<<<<<<<<<<<<
  *             stop = index.stop or 0
  *             step = index.step or 0
  */
     /*else*/ {
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_start); if (unlikely(!__pyx_t_9)) __PYX_ERR(2, 762, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_start); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 762, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(2, 762, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(1, 762, __pyx_L1_error)
       if (!__pyx_t_1) {
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       } else {
-        __pyx_t_12 = __Pyx_PyIndex_AsSsize_t(__pyx_t_9); if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(2, 762, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_PyIndex_AsSsize_t(__pyx_t_9); if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(1, 762, __pyx_L1_error)
         __pyx_t_10 = __pyx_t_12;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         goto __pyx_L7_bool_binop_done;
       }
       __pyx_t_10 = 0;
       __pyx_L7_bool_binop_done:;
       __pyx_v_start = __pyx_t_10;
@@ -14685,21 +12829,21 @@
       /* "View.MemoryView":763
  *         else:
  *             start = index.start or 0
  *             stop = index.stop or 0             # <<<<<<<<<<<<<<
  *             step = index.step or 0
  * 
  */
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_stop); if (unlikely(!__pyx_t_9)) __PYX_ERR(2, 763, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_stop); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 763, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(2, 763, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(1, 763, __pyx_L1_error)
       if (!__pyx_t_1) {
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       } else {
-        __pyx_t_12 = __Pyx_PyIndex_AsSsize_t(__pyx_t_9); if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(2, 763, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_PyIndex_AsSsize_t(__pyx_t_9); if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(1, 763, __pyx_L1_error)
         __pyx_t_10 = __pyx_t_12;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         goto __pyx_L9_bool_binop_done;
       }
       __pyx_t_10 = 0;
       __pyx_L9_bool_binop_done:;
       __pyx_v_stop = __pyx_t_10;
@@ -14707,21 +12851,21 @@
       /* "View.MemoryView":764
  *             start = index.start or 0
  *             stop = index.stop or 0
  *             step = index.step or 0             # <<<<<<<<<<<<<<
  * 
  *             have_start = index.start is not None
  */
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_step); if (unlikely(!__pyx_t_9)) __PYX_ERR(2, 764, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_step); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 764, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(2, 764, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(1, 764, __pyx_L1_error)
       if (!__pyx_t_1) {
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       } else {
-        __pyx_t_12 = __Pyx_PyIndex_AsSsize_t(__pyx_t_9); if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(2, 764, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_PyIndex_AsSsize_t(__pyx_t_9); if (unlikely((__pyx_t_12 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(1, 764, __pyx_L1_error)
         __pyx_t_10 = __pyx_t_12;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         goto __pyx_L11_bool_binop_done;
       }
       __pyx_t_10 = 0;
       __pyx_L11_bool_binop_done:;
       __pyx_v_step = __pyx_t_10;
@@ -14729,54 +12873,54 @@
       /* "View.MemoryView":766
  *             step = index.step or 0
  * 
  *             have_start = index.start is not None             # <<<<<<<<<<<<<<
  *             have_stop = index.stop is not None
  *             have_step = index.step is not None
  */
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_start); if (unlikely(!__pyx_t_9)) __PYX_ERR(2, 766, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_start); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 766, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __pyx_t_1 = (__pyx_t_9 != Py_None);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __pyx_v_have_start = __pyx_t_1;
 
       /* "View.MemoryView":767
  * 
  *             have_start = index.start is not None
  *             have_stop = index.stop is not None             # <<<<<<<<<<<<<<
  *             have_step = index.step is not None
  * 
  */
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_stop); if (unlikely(!__pyx_t_9)) __PYX_ERR(2, 767, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_stop); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 767, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __pyx_t_1 = (__pyx_t_9 != Py_None);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __pyx_v_have_stop = __pyx_t_1;
 
       /* "View.MemoryView":768
  *             have_start = index.start is not None
  *             have_stop = index.stop is not None
  *             have_step = index.step is not None             # <<<<<<<<<<<<<<
  * 
  *             slice_memviewslice(
  */
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_step); if (unlikely(!__pyx_t_9)) __PYX_ERR(2, 768, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_index, __pyx_n_s_step); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 768, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __pyx_t_1 = (__pyx_t_9 != Py_None);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __pyx_v_have_step = __pyx_t_1;
 
       /* "View.MemoryView":770
  *             have_step = index.step is not None
  * 
  *             slice_memviewslice(             # <<<<<<<<<<<<<<
  *                 p_dst, p_src.shape[dim], p_src.strides[dim], p_src.suboffsets[dim],
  *                 dim, new_ndim, p_suboffset_dim,
  */
-      __pyx_t_11 = __pyx_memoryview_slice_memviewslice(__pyx_v_p_dst, (__pyx_v_p_src->shape[__pyx_v_dim]), (__pyx_v_p_src->strides[__pyx_v_dim]), (__pyx_v_p_src->suboffsets[__pyx_v_dim]), __pyx_v_dim, __pyx_v_new_ndim, __pyx_v_p_suboffset_dim, __pyx_v_start, __pyx_v_stop, __pyx_v_step, __pyx_v_have_start, __pyx_v_have_stop, __pyx_v_have_step, 1); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(2, 770, __pyx_L1_error)
+      __pyx_t_11 = __pyx_memoryview_slice_memviewslice(__pyx_v_p_dst, (__pyx_v_p_src->shape[__pyx_v_dim]), (__pyx_v_p_src->strides[__pyx_v_dim]), (__pyx_v_p_src->suboffsets[__pyx_v_dim]), __pyx_v_dim, __pyx_v_new_ndim, __pyx_v_p_suboffset_dim, __pyx_v_start, __pyx_v_stop, __pyx_v_step, __pyx_v_have_start, __pyx_v_have_stop, __pyx_v_have_step, 1); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(1, 770, __pyx_L1_error)
 
       /* "View.MemoryView":776
  *                 have_start, have_stop, have_step,
  *                 True)
  *             new_ndim += 1             # <<<<<<<<<<<<<<
  * 
  *     if isinstance(memview, _memoryviewslice):
@@ -14818,35 +12962,35 @@
     /* "View.MemoryView":780
  *     if isinstance(memview, _memoryviewslice):
  *         return memoryview_fromslice(dst, new_ndim,
  *                                     memviewsliceobj.to_object_func,             # <<<<<<<<<<<<<<
  *                                     memviewsliceobj.to_dtype_func,
  *                                     memview.dtype_is_object)
  */
-    if (unlikely(!__pyx_v_memviewsliceobj)) { __Pyx_RaiseUnboundLocalError("memviewsliceobj"); __PYX_ERR(2, 780, __pyx_L1_error) }
+    if (unlikely(!__pyx_v_memviewsliceobj)) { __Pyx_RaiseUnboundLocalError("memviewsliceobj"); __PYX_ERR(1, 780, __pyx_L1_error) }
 
     /* "View.MemoryView":781
  *         return memoryview_fromslice(dst, new_ndim,
  *                                     memviewsliceobj.to_object_func,
  *                                     memviewsliceobj.to_dtype_func,             # <<<<<<<<<<<<<<
  *                                     memview.dtype_is_object)
  *     else:
  */
-    if (unlikely(!__pyx_v_memviewsliceobj)) { __Pyx_RaiseUnboundLocalError("memviewsliceobj"); __PYX_ERR(2, 781, __pyx_L1_error) }
+    if (unlikely(!__pyx_v_memviewsliceobj)) { __Pyx_RaiseUnboundLocalError("memviewsliceobj"); __PYX_ERR(1, 781, __pyx_L1_error) }
 
     /* "View.MemoryView":779
  * 
  *     if isinstance(memview, _memoryviewslice):
  *         return memoryview_fromslice(dst, new_ndim,             # <<<<<<<<<<<<<<
  *                                     memviewsliceobj.to_object_func,
  *                                     memviewsliceobj.to_dtype_func,
  */
-    __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_dst, __pyx_v_new_ndim, __pyx_v_memviewsliceobj->to_object_func, __pyx_v_memviewsliceobj->to_dtype_func, __pyx_v_memview->dtype_is_object); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 779, __pyx_L1_error)
+    __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_dst, __pyx_v_new_ndim, __pyx_v_memviewsliceobj->to_object_func, __pyx_v_memviewsliceobj->to_dtype_func, __pyx_v_memview->dtype_is_object); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 779, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_memoryview_type))))) __PYX_ERR(2, 779, __pyx_L1_error)
+    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_memoryview_type))))) __PYX_ERR(1, 779, __pyx_L1_error)
     __pyx_r = ((struct __pyx_memoryview_obj *)__pyx_t_3);
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
     /* "View.MemoryView":778
  *             new_ndim += 1
  * 
@@ -14869,25 +13013,25 @@
     /* "View.MemoryView":785
  *     else:
  *         return memoryview_fromslice(dst, new_ndim, NULL, NULL,
  *                                     memview.dtype_is_object)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-    __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_dst, __pyx_v_new_ndim, NULL, NULL, __pyx_v_memview->dtype_is_object); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 784, __pyx_L1_error)
+    __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_dst, __pyx_v_new_ndim, NULL, NULL, __pyx_v_memview->dtype_is_object); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 784, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
 
     /* "View.MemoryView":784
  *                                     memview.dtype_is_object)
  *     else:
  *         return memoryview_fromslice(dst, new_ndim, NULL, NULL,             # <<<<<<<<<<<<<<
  *                                     memview.dtype_is_object)
  * 
  */
-    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_memoryview_type))))) __PYX_ERR(2, 784, __pyx_L1_error)
+    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_memoryview_type))))) __PYX_ERR(1, 784, __pyx_L1_error)
     __pyx_r = ((struct __pyx_memoryview_obj *)__pyx_t_3);
     __pyx_t_3 = 0;
     goto __pyx_L0;
   }
 
   /* "View.MemoryView":712
  * 
@@ -14985,15 +13129,15 @@
       /* "View.MemoryView":834
  *             start += shape
  *         if not 0 <= start < shape:
  *             _err_dim(IndexError, "Index out of bounds (axis %d)", dim)             # <<<<<<<<<<<<<<
  *     else:
  * 
  */
-      __pyx_t_3 = __pyx_memoryview_err_dim(__pyx_builtin_IndexError, ((char *)"Index out of bounds (axis %d)"), __pyx_v_dim); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(2, 834, __pyx_L1_error)
+      __pyx_t_3 = __pyx_memoryview_err_dim(__pyx_builtin_IndexError, ((char *)"Index out of bounds (axis %d)"), __pyx_v_dim); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(1, 834, __pyx_L1_error)
 
       /* "View.MemoryView":833
  *         if start < 0:
  *             start += shape
  *         if not 0 <= start < shape:             # <<<<<<<<<<<<<<
  *             _err_dim(IndexError, "Index out of bounds (axis %d)", dim)
  *     else:
@@ -15050,15 +13194,15 @@
       /* "View.MemoryView":840
  * 
  *         if have_step and step == 0:
  *             _err_dim(ValueError, "Step may not be zero (axis %d)", dim)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-      __pyx_t_3 = __pyx_memoryview_err_dim(__pyx_builtin_ValueError, ((char *)"Step may not be zero (axis %d)"), __pyx_v_dim); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(2, 840, __pyx_L1_error)
+      __pyx_t_3 = __pyx_memoryview_err_dim(__pyx_builtin_ValueError, ((char *)"Step may not be zero (axis %d)"), __pyx_v_dim); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(1, 840, __pyx_L1_error)
 
       /* "View.MemoryView":839
  *         negative_step = have_step != 0 and step < 0
  * 
  *         if have_step and step == 0:             # <<<<<<<<<<<<<<
  *             _err_dim(ValueError, "Step may not be zero (axis %d)", dim)
  * 
@@ -15622,15 +13766,15 @@
         /* "View.MemoryView":902
  *             else:
  *                 _err_dim(IndexError, "All dimensions preceding dimension %d "
  *                                      "must be indexed and not sliced", dim)             # <<<<<<<<<<<<<<
  *         else:
  *             suboffset_dim[0] = new_ndim
  */
-        __pyx_t_3 = __pyx_memoryview_err_dim(__pyx_builtin_IndexError, ((char *)"All dimensions preceding dimension %d must be indexed and not sliced"), __pyx_v_dim); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(2, 901, __pyx_L1_error)
+        __pyx_t_3 = __pyx_memoryview_err_dim(__pyx_builtin_IndexError, ((char *)"All dimensions preceding dimension %d must be indexed and not sliced"), __pyx_v_dim); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(1, 901, __pyx_L1_error)
       }
       __pyx_L26:;
 
       /* "View.MemoryView":897
  * 
  *     if suboffset >= 0:
  *         if not is_slice:             # <<<<<<<<<<<<<<
@@ -15754,19 +13898,19 @@
  *     if view.ndim == 0:
  *         shape = view.len / itemsize             # <<<<<<<<<<<<<<
  *         stride = itemsize
  *     else:
  */
     if (unlikely(__pyx_v_itemsize == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "integer division or modulo by zero");
-      __PYX_ERR(2, 919, __pyx_L1_error)
+      __PYX_ERR(1, 919, __pyx_L1_error)
     }
     else if (sizeof(Py_ssize_t) == sizeof(long) && (!(((Py_ssize_t)-1) > 0)) && unlikely(__pyx_v_itemsize == (Py_ssize_t)-1)  && unlikely(UNARY_NEG_WOULD_OVERFLOW(__pyx_v_view->len))) {
       PyErr_SetString(PyExc_OverflowError, "value too large to perform division");
-      __PYX_ERR(2, 919, __pyx_L1_error)
+      __PYX_ERR(1, 919, __pyx_L1_error)
     }
     __pyx_v_shape = __Pyx_div_Py_ssize_t(__pyx_v_view->len, __pyx_v_itemsize);
 
     /* "View.MemoryView":920
  *     if view.ndim == 0:
  *         shape = view.len / itemsize
  *         stride = itemsize             # <<<<<<<<<<<<<<
@@ -15866,25 +14010,25 @@
       /* "View.MemoryView":930
  *         index += view.shape[dim]
  *         if index < 0:
  *             raise IndexError("Out of bounds on buffer access (axis %d)" % dim)             # <<<<<<<<<<<<<<
  * 
  *     if index >= shape:
  */
-      __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 930, __pyx_L1_error)
+      __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 930, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Out_of_bounds_on_buffer_access_a, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 930, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Out_of_bounds_on_buffer_access_a, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 930, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_IndexError, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 930, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_IndexError, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 930, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_Raise(__pyx_t_3, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __PYX_ERR(2, 930, __pyx_L1_error)
+      __PYX_ERR(1, 930, __pyx_L1_error)
 
       /* "View.MemoryView":929
  *     if index < 0:
  *         index += view.shape[dim]
  *         if index < 0:             # <<<<<<<<<<<<<<
  *             raise IndexError("Out of bounds on buffer access (axis %d)" % dim)
  * 
@@ -15913,25 +14057,25 @@
     /* "View.MemoryView":933
  * 
  *     if index >= shape:
  *         raise IndexError("Out of bounds on buffer access (axis %d)" % dim)             # <<<<<<<<<<<<<<
  * 
  *     resultp = bufp + index * stride
  */
-    __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 933, __pyx_L1_error)
+    __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 933, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Out_of_bounds_on_buffer_access_a, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 933, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyString_Format(__pyx_kp_s_Out_of_bounds_on_buffer_access_a, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 933, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_IndexError, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 933, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_IndexError, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 933, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(2, 933, __pyx_L1_error)
+    __PYX_ERR(1, 933, __pyx_L1_error)
 
     /* "View.MemoryView":932
  *             raise IndexError("Out of bounds on buffer access (axis %d)" % dim)
  * 
  *     if index >= shape:             # <<<<<<<<<<<<<<
  *         raise IndexError("Out of bounds on buffer access (axis %d)" % dim)
  * 
@@ -16128,15 +14272,15 @@
       /* "View.MemoryView":959
  * 
  *         if memslice.suboffsets[i] >= 0 or memslice.suboffsets[j] >= 0:
  *             _err(ValueError, "Cannot transpose memoryview with indirect dimensions")             # <<<<<<<<<<<<<<
  * 
  *     return 1
  */
-      __pyx_t_9 = __pyx_memoryview_err(__pyx_builtin_ValueError, ((char *)"Cannot transpose memoryview with indirect dimensions")); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(2, 959, __pyx_L1_error)
+      __pyx_t_9 = __pyx_memoryview_err(__pyx_builtin_ValueError, ((char *)"Cannot transpose memoryview with indirect dimensions")); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(1, 959, __pyx_L1_error)
 
       /* "View.MemoryView":958
  *         shape[i], shape[j] = shape[j], shape[i]
  * 
  *         if memslice.suboffsets[i] >= 0 or memslice.suboffsets[j] >= 0:             # <<<<<<<<<<<<<<
  *             _err(ValueError, "Cannot transpose memoryview with indirect dimensions")
  * 
@@ -16254,15 +14398,15 @@
  *     cdef convert_item_to_object(self, char *itemp):
  *         if self.to_object_func != NULL:
  *             return self.to_object_func(itemp)             # <<<<<<<<<<<<<<
  *         else:
  *             return memoryview.convert_item_to_object(self, itemp)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_2 = __pyx_v_self->to_object_func(__pyx_v_itemp); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 983, __pyx_L1_error)
+    __pyx_t_2 = __pyx_v_self->to_object_func(__pyx_v_itemp); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 983, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_r = __pyx_t_2;
     __pyx_t_2 = 0;
     goto __pyx_L0;
 
     /* "View.MemoryView":982
  * 
@@ -16278,15 +14422,15 @@
  *         else:
  *             return memoryview.convert_item_to_object(self, itemp)             # <<<<<<<<<<<<<<
  * 
  *     cdef assign_item_from_object(self, char *itemp, object value):
  */
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_2 = __pyx_memoryview_convert_item_to_object(((struct __pyx_memoryview_obj *)__pyx_v_self), __pyx_v_itemp); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 985, __pyx_L1_error)
+    __pyx_t_2 = __pyx_memoryview_convert_item_to_object(((struct __pyx_memoryview_obj *)__pyx_v_self), __pyx_v_itemp); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 985, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_r = __pyx_t_2;
     __pyx_t_2 = 0;
     goto __pyx_L0;
   }
 
   /* "View.MemoryView":981
@@ -16340,15 +14484,15 @@
     /* "View.MemoryView":989
  *     cdef assign_item_from_object(self, char *itemp, object value):
  *         if self.to_dtype_func != NULL:
  *             self.to_dtype_func(itemp, value)             # <<<<<<<<<<<<<<
  *         else:
  *             memoryview.assign_item_from_object(self, itemp, value)
  */
-    __pyx_t_2 = __pyx_v_self->to_dtype_func(__pyx_v_itemp, __pyx_v_value); if (unlikely(__pyx_t_2 == ((int)0))) __PYX_ERR(2, 989, __pyx_L1_error)
+    __pyx_t_2 = __pyx_v_self->to_dtype_func(__pyx_v_itemp, __pyx_v_value); if (unlikely(__pyx_t_2 == ((int)0))) __PYX_ERR(1, 989, __pyx_L1_error)
 
     /* "View.MemoryView":988
  * 
  *     cdef assign_item_from_object(self, char *itemp, object value):
  *         if self.to_dtype_func != NULL:             # <<<<<<<<<<<<<<
  *             self.to_dtype_func(itemp, value)
  *         else:
@@ -16360,15 +14504,15 @@
  *             self.to_dtype_func(itemp, value)
  *         else:
  *             memoryview.assign_item_from_object(self, itemp, value)             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   /*else*/ {
-    __pyx_t_3 = __pyx_memoryview_assign_item_from_object(((struct __pyx_memoryview_obj *)__pyx_v_self), __pyx_v_itemp, __pyx_v_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 991, __pyx_L1_error)
+    __pyx_t_3 = __pyx_memoryview_assign_item_from_object(((struct __pyx_memoryview_obj *)__pyx_v_self), __pyx_v_itemp, __pyx_v_value); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 991, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __pyx_L3:;
 
   /* "View.MemoryView":987
  *             return memoryview.convert_item_to_object(self, itemp)
@@ -16474,19 +14618,19 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__19, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__17, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(2, 2, __pyx_L1_error)
+  __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  */
 
@@ -16530,19 +14674,19 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__20, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__18, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(2, 4, __pyx_L1_error)
+  __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
@@ -16618,28 +14762,28 @@
   /* "View.MemoryView":1015
  * 
  * 
  *     result = _memoryviewslice(None, 0, dtype_is_object)             # <<<<<<<<<<<<<<
  * 
  *     result.from_slice = memviewslice
  */
-  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_dtype_is_object); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1015, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_v_dtype_is_object); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1015, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 1015, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 1015, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyTuple_SET_ITEM(__pyx_t_3, 0, Py_None);
   __Pyx_INCREF(__pyx_int_0);
   __Pyx_GIVEREF(__pyx_int_0);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_int_0);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_memoryviewslice_type), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1015, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_memoryviewslice_type), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1015, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_result = ((struct __pyx_memoryviewslice_obj *)__pyx_t_2);
   __pyx_t_2 = 0;
 
   /* "View.MemoryView":1017
  *     result = _memoryviewslice(None, 0, dtype_is_object)
@@ -16662,15 +14806,15 @@
   /* "View.MemoryView":1020
  *     __PYX_INC_MEMVIEW(&memviewslice, 1)
  * 
  *     result.from_object = (<memoryview> memviewslice.memview).base             # <<<<<<<<<<<<<<
  *     result.typeinfo = memviewslice.memview.typeinfo
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_memviewslice.memview), __pyx_n_s_base); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1020, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_memviewslice.memview), __pyx_n_s_base); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1020, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_2);
   __Pyx_GOTREF(__pyx_v_result->from_object);
   __Pyx_DECREF(__pyx_v_result->from_object);
   __pyx_v_result->from_object = __pyx_t_2;
   __pyx_t_2 = 0;
 
@@ -16865,32 +15009,32 @@
  *     for length in result.view.shape[:ndim]:             # <<<<<<<<<<<<<<
  *         result.view.len *= length
  * 
  */
   __pyx_t_7 = (__pyx_v_result->__pyx_base.view.shape + __pyx_v_ndim);
   for (__pyx_t_8 = __pyx_v_result->__pyx_base.view.shape; __pyx_t_8 < __pyx_t_7; __pyx_t_8++) {
     __pyx_t_6 = __pyx_t_8;
-    __pyx_t_2 = PyInt_FromSsize_t((__pyx_t_6[0])); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1045, __pyx_L1_error)
+    __pyx_t_2 = PyInt_FromSsize_t((__pyx_t_6[0])); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1045, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_XDECREF_SET(__pyx_v_length, __pyx_t_2);
     __pyx_t_2 = 0;
 
     /* "View.MemoryView":1046
  *     result.view.len = result.view.itemsize
  *     for length in result.view.shape[:ndim]:
  *         result.view.len *= length             # <<<<<<<<<<<<<<
  * 
  *     result.to_object_func = to_object_func
  */
-    __pyx_t_2 = PyInt_FromSsize_t(__pyx_v_result->__pyx_base.view.len); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1046, __pyx_L1_error)
+    __pyx_t_2 = PyInt_FromSsize_t(__pyx_v_result->__pyx_base.view.len); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1046, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyNumber_InPlaceMultiply(__pyx_t_2, __pyx_v_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 1046, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_InPlaceMultiply(__pyx_t_2, __pyx_v_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 1046, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_9 = __Pyx_PyIndex_AsSsize_t(__pyx_t_3); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(2, 1046, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyIndex_AsSsize_t(__pyx_t_3); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(1, 1046, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_result->__pyx_base.view.len = __pyx_t_9;
   }
 
   /* "View.MemoryView":1048
  *         result.view.len *= length
  * 
@@ -16977,15 +15121,15 @@
     /* "View.MemoryView":1058
  *     cdef _memoryviewslice obj
  *     if isinstance(memview, _memoryviewslice):
  *         obj = memview             # <<<<<<<<<<<<<<
  *         return &obj.from_slice
  *     else:
  */
-    if (!(likely(((((PyObject *)__pyx_v_memview)) == Py_None) || likely(__Pyx_TypeTest(((PyObject *)__pyx_v_memview), __pyx_memoryviewslice_type))))) __PYX_ERR(2, 1058, __pyx_L1_error)
+    if (!(likely(((((PyObject *)__pyx_v_memview)) == Py_None) || likely(__Pyx_TypeTest(((PyObject *)__pyx_v_memview), __pyx_memoryviewslice_type))))) __PYX_ERR(1, 1058, __pyx_L1_error)
     __pyx_t_3 = ((PyObject *)__pyx_v_memview);
     __Pyx_INCREF(__pyx_t_3);
     __pyx_v_obj = ((struct __pyx_memoryviewslice_obj *)__pyx_t_3);
     __pyx_t_3 = 0;
 
     /* "View.MemoryView":1059
  *     if isinstance(memview, _memoryviewslice):
@@ -17203,15 +15347,15 @@
  *     cdef __Pyx_memviewslice memviewslice
  *     slice_copy(memview, &memviewslice)
  *     return memoryview_copy_from_slice(memview, &memviewslice)             # <<<<<<<<<<<<<<
  * 
  * @cname('__pyx_memoryview_copy_object_from_slice')
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_memoryview_copy_object_from_slice(__pyx_v_memview, (&__pyx_v_memviewslice)); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 1086, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_copy_object_from_slice(__pyx_v_memview, (&__pyx_v_memviewslice)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1086, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":1082
  * 
@@ -17329,15 +15473,15 @@
   /* "View.MemoryView":1105
  *     return memoryview_fromslice(memviewslice[0], memview.view.ndim,
  *                                 to_object_func, to_dtype_func,
  *                                 memview.dtype_is_object)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_5 = __pyx_memoryview_fromslice((__pyx_v_memviewslice[0]), __pyx_v_memview->view.ndim, __pyx_v_to_object_func, __pyx_v_to_dtype_func, __pyx_v_memview->dtype_is_object); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 1103, __pyx_L1_error)
+  __pyx_t_5 = __pyx_memoryview_fromslice((__pyx_v_memviewslice[0]), __pyx_v_memview->view.ndim, __pyx_v_to_object_func, __pyx_v_to_dtype_func, __pyx_v_memview->dtype_is_object); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 1103, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
   /* "View.MemoryView":1089
  * 
@@ -18140,15 +16284,15 @@
     /* "View.MemoryView":1226
  *     result = malloc(size)
  *     if not result:
  *         _err(MemoryError, NULL)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-    __pyx_t_3 = __pyx_memoryview_err(__pyx_builtin_MemoryError, NULL); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(2, 1226, __pyx_L1_error)
+    __pyx_t_3 = __pyx_memoryview_err(__pyx_builtin_MemoryError, NULL); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(1, 1226, __pyx_L1_error)
 
     /* "View.MemoryView":1225
  * 
  *     result = malloc(size)
  *     if not result:             # <<<<<<<<<<<<<<
  *         _err(MemoryError, NULL)
  * 
@@ -18356,21 +16500,21 @@
   /* "View.MemoryView":1256
  *                              Py_ssize_t extent2) except -1 with gil:
  *     raise ValueError("got differing extents in dimension %d (got %d and %d)" %
  *                                                         (i, extent1, extent2))             # <<<<<<<<<<<<<<
  * 
  * @cname('__pyx_memoryview_err_dim')
  */
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 1256, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1256, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_v_extent1); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1256, __pyx_L1_error)
+  __pyx_t_2 = PyInt_FromSsize_t(__pyx_v_extent1); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1256, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_extent2); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 1256, __pyx_L1_error)
+  __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_extent2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 1256, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 1256, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 1256, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_3);
@@ -18381,23 +16525,23 @@
   /* "View.MemoryView":1255
  * cdef int _err_extents(int i, Py_ssize_t extent1,
  *                              Py_ssize_t extent2) except -1 with gil:
  *     raise ValueError("got differing extents in dimension %d (got %d and %d)" %             # <<<<<<<<<<<<<<
  *                                                         (i, extent1, extent2))
  * 
  */
-  __pyx_t_3 = __Pyx_PyString_Format(__pyx_kp_s_got_differing_extents_in_dimensi, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 1255, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyString_Format(__pyx_kp_s_got_differing_extents_in_dimensi, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 1255, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 1255, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 1255, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_Raise(__pyx_t_4, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __PYX_ERR(2, 1255, __pyx_L1_error)
+  __PYX_ERR(1, 1255, __pyx_L1_error)
 
   /* "View.MemoryView":1253
  * 
  * @cname('__pyx_memoryview_err_extents')
  * cdef int _err_extents(int i, Py_ssize_t extent1,             # <<<<<<<<<<<<<<
  *                              Py_ssize_t extent2) except -1 with gil:
  *     raise ValueError("got differing extents in dimension %d (got %d and %d)" %
@@ -18445,19 +16589,19 @@
   /* "View.MemoryView":1260
  * @cname('__pyx_memoryview_err_dim')
  * cdef int _err_dim(object error, char *msg, int dim) except -1 with gil:
  *     raise error(msg.decode('ascii') % dim)             # <<<<<<<<<<<<<<
  * 
  * @cname('__pyx_memoryview_err')
  */
-  __pyx_t_2 = __Pyx_decode_c_string(__pyx_v_msg, 0, strlen(__pyx_v_msg), NULL, NULL, PyUnicode_DecodeASCII); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1260, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_decode_c_string(__pyx_v_msg, 0, strlen(__pyx_v_msg), NULL, NULL, PyUnicode_DecodeASCII); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1260, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 1260, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 1260, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyUnicode_Format(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 1260, __pyx_L1_error)
+  __pyx_t_4 = PyUnicode_Format(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 1260, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_INCREF(__pyx_v_error);
   __pyx_t_3 = __pyx_v_error; __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
@@ -18467,20 +16611,20 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 1260, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1260, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(2, 1260, __pyx_L1_error)
+  __PYX_ERR(1, 1260, __pyx_L1_error)
 
   /* "View.MemoryView":1259
  * 
  * @cname('__pyx_memoryview_err_dim')
  * cdef int _err_dim(object error, char *msg, int dim) except -1 with gil:             # <<<<<<<<<<<<<<
  *     raise error(msg.decode('ascii') % dim)
  * 
@@ -18540,15 +16684,15 @@
     /* "View.MemoryView":1265
  * cdef int _err(object error, char *msg) except -1 with gil:
  *     if msg != NULL:
  *         raise error(msg.decode('ascii'))             # <<<<<<<<<<<<<<
  *     else:
  *         raise error
  */
-    __pyx_t_3 = __Pyx_decode_c_string(__pyx_v_msg, 0, strlen(__pyx_v_msg), NULL, NULL, PyUnicode_DecodeASCII); if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 1265, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_decode_c_string(__pyx_v_msg, 0, strlen(__pyx_v_msg), NULL, NULL, PyUnicode_DecodeASCII); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 1265, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_v_error);
     __pyx_t_4 = __pyx_v_error; __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -18556,20 +16700,20 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1265, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1265, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(2, 1265, __pyx_L1_error)
+    __PYX_ERR(1, 1265, __pyx_L1_error)
 
     /* "View.MemoryView":1264
  * @cname('__pyx_memoryview_err')
  * cdef int _err(object error, char *msg) except -1 with gil:
  *     if msg != NULL:             # <<<<<<<<<<<<<<
  *         raise error(msg.decode('ascii'))
  *     else:
@@ -18581,15 +16725,15 @@
  *     else:
  *         raise error             # <<<<<<<<<<<<<<
  * 
  * @cname('__pyx_memoryview_copy_contents')
  */
   /*else*/ {
     __Pyx_Raise(__pyx_v_error, 0, 0, 0);
-    __PYX_ERR(2, 1267, __pyx_L1_error)
+    __PYX_ERR(1, 1267, __pyx_L1_error)
   }
 
   /* "View.MemoryView":1263
  * 
  * @cname('__pyx_memoryview_err')
  * cdef int _err(object error, char *msg) except -1 with gil:             # <<<<<<<<<<<<<<
  *     if msg != NULL:
@@ -18826,15 +16970,15 @@
  *                 src.strides[i] = 0
  *             else:
  *                 _err_extents(i, dst.shape[i], src.shape[i])             # <<<<<<<<<<<<<<
  * 
  *         if src.suboffsets[i] >= 0:
  */
       /*else*/ {
-        __pyx_t_6 = __pyx_memoryview_err_extents(__pyx_v_i, (__pyx_v_dst.shape[__pyx_v_i]), (__pyx_v_src.shape[__pyx_v_i])); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(2, 1299, __pyx_L1_error)
+        __pyx_t_6 = __pyx_memoryview_err_extents(__pyx_v_i, (__pyx_v_dst.shape[__pyx_v_i]), (__pyx_v_src.shape[__pyx_v_i])); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(1, 1299, __pyx_L1_error)
       }
       __pyx_L7:;
 
       /* "View.MemoryView":1294
  * 
  *     for i in range(ndim):
  *         if src.shape[i] != dst.shape[i]:             # <<<<<<<<<<<<<<
@@ -18856,15 +17000,15 @@
       /* "View.MemoryView":1302
  * 
  *         if src.suboffsets[i] >= 0:
  *             _err_dim(ValueError, "Dimension %d is not direct", i)             # <<<<<<<<<<<<<<
  * 
  *     if slices_overlap(&src, &dst, ndim, itemsize):
  */
-      __pyx_t_6 = __pyx_memoryview_err_dim(__pyx_builtin_ValueError, ((char *)"Dimension %d is not direct"), __pyx_v_i); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(2, 1302, __pyx_L1_error)
+      __pyx_t_6 = __pyx_memoryview_err_dim(__pyx_builtin_ValueError, ((char *)"Dimension %d is not direct"), __pyx_v_i); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(1, 1302, __pyx_L1_error)
 
       /* "View.MemoryView":1301
  *                 _err_extents(i, dst.shape[i], src.shape[i])
  * 
  *         if src.suboffsets[i] >= 0:             # <<<<<<<<<<<<<<
  *             _err_dim(ValueError, "Dimension %d is not direct", i)
  * 
@@ -18913,15 +17057,15 @@
     /* "View.MemoryView":1309
  *             order = get_best_order(&dst, ndim)
  * 
  *         tmpdata = copy_data_to_temp(&src, &tmp, order, ndim)             # <<<<<<<<<<<<<<
  *         src = tmp
  * 
  */
-    __pyx_t_7 = __pyx_memoryview_copy_data_to_temp((&__pyx_v_src), (&__pyx_v_tmp), __pyx_v_order, __pyx_v_ndim); if (unlikely(__pyx_t_7 == ((void *)NULL))) __PYX_ERR(2, 1309, __pyx_L1_error)
+    __pyx_t_7 = __pyx_memoryview_copy_data_to_temp((&__pyx_v_src), (&__pyx_v_tmp), __pyx_v_order, __pyx_v_ndim); if (unlikely(__pyx_t_7 == ((void *)NULL))) __PYX_ERR(1, 1309, __pyx_L1_error)
     __pyx_v_tmpdata = __pyx_t_7;
 
     /* "View.MemoryView":1310
  * 
  *         tmpdata = copy_data_to_temp(&src, &tmp, order, ndim)
  *         src = tmp             # <<<<<<<<<<<<<<
  * 
@@ -19097,24 +17241,24 @@
     /* "View.MemoryView":1331
  * 
  * 
  *         transpose_memslice(&src)             # <<<<<<<<<<<<<<
  *         transpose_memslice(&dst)
  * 
  */
-    __pyx_t_5 = __pyx_memslice_transpose((&__pyx_v_src)); if (unlikely(__pyx_t_5 == ((int)0))) __PYX_ERR(2, 1331, __pyx_L1_error)
+    __pyx_t_5 = __pyx_memslice_transpose((&__pyx_v_src)); if (unlikely(__pyx_t_5 == ((int)0))) __PYX_ERR(1, 1331, __pyx_L1_error)
 
     /* "View.MemoryView":1332
  * 
  *         transpose_memslice(&src)
  *         transpose_memslice(&dst)             # <<<<<<<<<<<<<<
  * 
  *     refcount_copying(&dst, dtype_is_object, ndim, False)
  */
-    __pyx_t_5 = __pyx_memslice_transpose((&__pyx_v_dst)); if (unlikely(__pyx_t_5 == ((int)0))) __PYX_ERR(2, 1332, __pyx_L1_error)
+    __pyx_t_5 = __pyx_memslice_transpose((&__pyx_v_dst)); if (unlikely(__pyx_t_5 == ((int)0))) __PYX_ERR(1, 1332, __pyx_L1_error)
 
     /* "View.MemoryView":1328
  *             return 0
  * 
  *     if order == 'F' == get_best_order(&dst, ndim):             # <<<<<<<<<<<<<<
  * 
  * 
@@ -19744,40 +17888,40 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_type)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_checksum)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Enum", 1, 3, 3, 1); __PYX_ERR(2, 1, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Enum", 1, 3, 3, 1); __PYX_ERR(1, 1, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_pyx_state)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Enum", 1, 3, 3, 2); __PYX_ERR(2, 1, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Enum", 1, 3, 3, 2); __PYX_ERR(1, 1, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_unpickle_Enum") < 0)) __PYX_ERR(2, 1, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_unpickle_Enum") < 0)) __PYX_ERR(1, 1, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v___pyx_type = values[0];
-    __pyx_v___pyx_checksum = __Pyx_PyInt_As_long(values[1]); if (unlikely((__pyx_v___pyx_checksum == (long)-1) && PyErr_Occurred())) __PYX_ERR(2, 1, __pyx_L3_error)
+    __pyx_v___pyx_checksum = __Pyx_PyInt_As_long(values[1]); if (unlikely((__pyx_v___pyx_checksum == (long)-1) && PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
     __pyx_v___pyx_state = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Enum", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(2, 1, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_unpickle_Enum", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(1, 1, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("View.MemoryView.__pyx_unpickle_Enum", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_15View_dot_MemoryView___pyx_unpickle_Enum(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);
 
@@ -19805,53 +17949,53 @@
   /* "(tree fragment)":4
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xb068931, 0x82a3537, 0x6ae9995):             # <<<<<<<<<<<<<<
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb068931, 0x82a3537, 0x6ae9995) = (name))" % __pyx_checksum)
  */
-  __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_tuple__21, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(2, 4, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_tuple__19, Py_NE)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
     /* "(tree fragment)":5
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xb068931, 0x82a3537, 0x6ae9995):
  *         from pickle import PickleError as __pyx_PickleError             # <<<<<<<<<<<<<<
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb068931, 0x82a3537, 0x6ae9995) = (name))" % __pyx_checksum)
  *     __pyx_result = Enum.__new__(__pyx_type)
  */
-    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 5, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 5, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_n_s_PickleError);
     __Pyx_GIVEREF(__pyx_n_s_PickleError);
     PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_PickleError);
-    __pyx_t_4 = __Pyx_Import(__pyx_n_s_pickle, __pyx_t_1, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 5, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_Import(__pyx_n_s_pickle, __pyx_t_1, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 5, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_4, __pyx_n_s_PickleError); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 5, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_4, __pyx_n_s_PickleError); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 5, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v___pyx_PickleError = __pyx_t_1;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":6
  *     if __pyx_checksum not in (0xb068931, 0x82a3537, 0x6ae9995):
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb068931, 0x82a3537, 0x6ae9995) = (name))" % __pyx_checksum)             # <<<<<<<<<<<<<<
  *     __pyx_result = Enum.__new__(__pyx_type)
  *     if __pyx_state is not None:
  */
-    __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 6, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 6, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_5 = __Pyx_PyString_Format(__pyx_kp_s_Incompatible_checksums_0x_x_vs_0, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(2, 6, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyString_Format(__pyx_kp_s_Incompatible_checksums_0x_x_vs_0, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 6, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_INCREF(__pyx_v___pyx_PickleError);
     __pyx_t_1 = __pyx_v___pyx_PickleError; __pyx_t_6 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
       if (likely(__pyx_t_6)) {
@@ -19860,20 +18004,20 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
     __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_5);
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 6, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 6, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(2, 6, __pyx_L1_error)
+    __PYX_ERR(1, 6, __pyx_L1_error)
 
     /* "(tree fragment)":4
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  *     if __pyx_checksum not in (0xb068931, 0x82a3537, 0x6ae9995):             # <<<<<<<<<<<<<<
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb068931, 0x82a3537, 0x6ae9995) = (name))" % __pyx_checksum)
@@ -19883,29 +18027,29 @@
   /* "(tree fragment)":7
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb068931, 0x82a3537, 0x6ae9995) = (name))" % __pyx_checksum)
  *     __pyx_result = Enum.__new__(__pyx_type)             # <<<<<<<<<<<<<<
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Enum__set_state(<Enum> __pyx_result, __pyx_state)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_MemviewEnum_type), __pyx_n_s_new); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 7, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_MemviewEnum_type), __pyx_n_s_new); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 7, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_v___pyx_type) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v___pyx_type);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 7, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 7, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v___pyx_result = __pyx_t_4;
   __pyx_t_4 = 0;
 
   /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb068931, 0x82a3537, 0x6ae9995) = (name))" % __pyx_checksum)
@@ -19921,16 +18065,16 @@
     /* "(tree fragment)":9
  *     __pyx_result = Enum.__new__(__pyx_type)
  *     if __pyx_state is not None:
  *         __pyx_unpickle_Enum__set_state(<Enum> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
  *     return __pyx_result
  * cdef __pyx_unpickle_Enum__set_state(Enum __pyx_result, tuple __pyx_state):
  */
-    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(2, 9, __pyx_L1_error)
-    __pyx_t_4 = __pyx_unpickle_Enum__set_state(((struct __pyx_MemviewEnum_obj *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 9, __pyx_L1_error)
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None)||((void)PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "tuple", Py_TYPE(__pyx_v___pyx_state)->tp_name), 0))) __PYX_ERR(1, 9, __pyx_L1_error)
+    __pyx_t_4 = __pyx_unpickle_Enum__set_state(((struct __pyx_MemviewEnum_obj *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 9, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
     /* "(tree fragment)":8
  *         raise __pyx_PickleError("Incompatible checksums (0x%x vs (0xb068931, 0x82a3537, 0x6ae9995) = (name))" % __pyx_checksum)
  *     __pyx_result = Enum.__new__(__pyx_type)
  *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
@@ -20002,17 +18146,17 @@
  * cdef __pyx_unpickle_Enum__set_state(Enum __pyx_result, tuple __pyx_state):
  *     __pyx_result.name = __pyx_state[0]             # <<<<<<<<<<<<<<
  *     if len(__pyx_state) > 1 and hasattr(__pyx_result, '__dict__'):
  *         __pyx_result.__dict__.update(__pyx_state[1])
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(2, 12, __pyx_L1_error)
+    __PYX_ERR(1, 12, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 12, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __Pyx_GOTREF(__pyx_v___pyx_result->name);
   __Pyx_DECREF(__pyx_v___pyx_result->name);
   __pyx_v___pyx_result->name = __pyx_t_1;
   __pyx_t_1 = 0;
 
@@ -20020,59 +18164,59 @@
  * cdef __pyx_unpickle_Enum__set_state(Enum __pyx_result, tuple __pyx_state):
  *     __pyx_result.name = __pyx_state[0]
  *     if len(__pyx_state) > 1 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
  *         __pyx_result.__dict__.update(__pyx_state[1])
  */
   if (unlikely(__pyx_v___pyx_state == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(2, 13, __pyx_L1_error)
+    __PYX_ERR(1, 13, __pyx_L1_error)
   }
-  __pyx_t_3 = PyTuple_GET_SIZE(__pyx_v___pyx_state); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(2, 13, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_GET_SIZE(__pyx_v___pyx_state); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(1, 13, __pyx_L1_error)
   __pyx_t_4 = ((__pyx_t_3 > 1) != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_HasAttr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(2, 13, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_HasAttr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 13, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_5;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
 
     /* "(tree fragment)":14
  *     __pyx_result.name = __pyx_state[0]
  *     if len(__pyx_state) > 1 and hasattr(__pyx_result, '__dict__'):
  *         __pyx_result.__dict__.update(__pyx_state[1])             # <<<<<<<<<<<<<<
  */
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 14, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_update); if (unlikely(!__pyx_t_7)) __PYX_ERR(2, 14, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_update); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     if (unlikely(__pyx_v___pyx_state == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(2, 14, __pyx_L1_error)
+      __PYX_ERR(1, 14, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(2, 14, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_t_8 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
       __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
       if (likely(__pyx_t_8)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
         __Pyx_INCREF(__pyx_t_8);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_7, function);
       }
     }
     __pyx_t_1 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_8, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 14, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
     /* "(tree fragment)":13
  * cdef __pyx_unpickle_Enum__set_state(Enum __pyx_result, tuple __pyx_state):
  *     __pyx_result.name = __pyx_state[0]
@@ -20883,15 +19027,14 @@
   {&__pyx_kp_s_Buffer_view_does_not_expose_stri, __pyx_k_Buffer_view_does_not_expose_stri, sizeof(__pyx_k_Buffer_view_does_not_expose_stri), 0, 0, 1, 0},
   {&__pyx_kp_s_Can_only_create_a_buffer_that_is, __pyx_k_Can_only_create_a_buffer_that_is, sizeof(__pyx_k_Can_only_create_a_buffer_that_is), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_assign_to_read_only_memor, __pyx_k_Cannot_assign_to_read_only_memor, sizeof(__pyx_k_Cannot_assign_to_read_only_memor), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_create_writable_memory_vi, __pyx_k_Cannot_create_writable_memory_vi, sizeof(__pyx_k_Cannot_create_writable_memory_vi), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_index_with_type_s, __pyx_k_Cannot_index_with_type_s, sizeof(__pyx_k_Cannot_index_with_type_s), 0, 0, 1, 0},
   {&__pyx_n_s_Ellipsis, __pyx_k_Ellipsis, sizeof(__pyx_k_Ellipsis), 0, 0, 1, 1},
   {&__pyx_kp_s_Empty_shape_tuple_for_cython_arr, __pyx_k_Empty_shape_tuple_for_cython_arr, sizeof(__pyx_k_Empty_shape_tuple_for_cython_arr), 0, 0, 1, 0},
-  {&__pyx_n_s_ImportError, __pyx_k_ImportError, sizeof(__pyx_k_ImportError), 0, 0, 1, 1},
   {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0, __pyx_k_Incompatible_checksums_0x_x_vs_0, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0), 0, 0, 1, 0},
   {&__pyx_n_s_IndexError, __pyx_k_IndexError, sizeof(__pyx_k_IndexError), 0, 0, 1, 1},
   {&__pyx_kp_s_Indirect_dimensions_not_supporte, __pyx_k_Indirect_dimensions_not_supporte, sizeof(__pyx_k_Indirect_dimensions_not_supporte), 0, 0, 1, 0},
   {&__pyx_kp_s_Invalid_mode_expected_c_or_fortr, __pyx_k_Invalid_mode_expected_c_or_fortr, sizeof(__pyx_k_Invalid_mode_expected_c_or_fortr), 0, 0, 1, 0},
   {&__pyx_kp_s_Invalid_shape_in_axis_d_d, __pyx_k_Invalid_shape_in_axis_d_d, sizeof(__pyx_k_Invalid_shape_in_axis_d_d), 0, 0, 1, 0},
   {&__pyx_n_s_MemoryError, __pyx_k_MemoryError, sizeof(__pyx_k_MemoryError), 0, 0, 1, 1},
   {&__pyx_kp_s_MemoryView_of_r_at_0x_x, __pyx_k_MemoryView_of_r_at_0x_x, sizeof(__pyx_k_MemoryView_of_r_at_0x_x), 0, 0, 1, 0},
@@ -20899,17 +19042,16 @@
   {&__pyx_n_b_O, __pyx_k_O, sizeof(__pyx_k_O), 0, 0, 0, 1},
   {&__pyx_kp_s_Out_of_bounds_on_buffer_access_a, __pyx_k_Out_of_bounds_on_buffer_access_a, sizeof(__pyx_k_Out_of_bounds_on_buffer_access_a), 0, 0, 1, 0},
   {&__pyx_n_s_PickleError, __pyx_k_PickleError, sizeof(__pyx_k_PickleError), 0, 0, 1, 1},
   {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
   {&__pyx_kp_s_Unable_to_convert_item_to_object, __pyx_k_Unable_to_convert_item_to_object, sizeof(__pyx_k_Unable_to_convert_item_to_object), 0, 0, 1, 0},
   {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
   {&__pyx_n_s_View_MemoryView, __pyx_k_View_MemoryView, sizeof(__pyx_k_View_MemoryView), 0, 0, 1, 1},
-  {&__pyx_n_s_adam, __pyx_k_adam, sizeof(__pyx_k_adam), 0, 0, 1, 1},
+  {&__pyx_n_u_adam, __pyx_k_adam, sizeof(__pyx_k_adam), 0, 1, 0, 1},
   {&__pyx_n_s_allocate_buffer, __pyx_k_allocate_buffer, sizeof(__pyx_k_allocate_buffer), 0, 0, 1, 1},
-  {&__pyx_n_s_astype, __pyx_k_astype, sizeof(__pyx_k_astype), 0, 0, 1, 1},
   {&__pyx_n_s_base, __pyx_k_base, sizeof(__pyx_k_base), 0, 0, 1, 1},
   {&__pyx_n_s_c, __pyx_k_c, sizeof(__pyx_k_c), 0, 0, 1, 1},
   {&__pyx_n_u_c, __pyx_k_c, sizeof(__pyx_k_c), 0, 1, 0, 1},
   {&__pyx_n_s_class, __pyx_k_class, sizeof(__pyx_k_class), 0, 0, 1, 1},
   {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
   {&__pyx_kp_s_contiguous_and_direct, __pyx_k_contiguous_and_direct, sizeof(__pyx_k_contiguous_and_direct), 0, 0, 1, 0},
   {&__pyx_kp_s_contiguous_and_indirect, __pyx_k_contiguous_and_indirect, sizeof(__pyx_k_contiguous_and_indirect), 0, 0, 1, 0},
@@ -20921,45 +19063,39 @@
   {&__pyx_n_s_error, __pyx_k_error, sizeof(__pyx_k_error), 0, 0, 1, 1},
   {&__pyx_n_s_flags, __pyx_k_flags, sizeof(__pyx_k_flags), 0, 0, 1, 1},
   {&__pyx_n_s_format, __pyx_k_format, sizeof(__pyx_k_format), 0, 0, 1, 1},
   {&__pyx_n_s_fortran, __pyx_k_fortran, sizeof(__pyx_k_fortran), 0, 0, 1, 1},
   {&__pyx_n_u_fortran, __pyx_k_fortran, sizeof(__pyx_k_fortran), 0, 1, 0, 1},
   {&__pyx_n_s_getstate, __pyx_k_getstate, sizeof(__pyx_k_getstate), 0, 0, 1, 1},
   {&__pyx_kp_s_got_differing_extents_in_dimensi, __pyx_k_got_differing_extents_in_dimensi, sizeof(__pyx_k_got_differing_extents_in_dimensi), 0, 0, 1, 0},
-  {&__pyx_n_s_has_sampled, __pyx_k_has_sampled, sizeof(__pyx_k_has_sampled), 0, 0, 1, 1},
   {&__pyx_n_s_i_1st_mom, __pyx_k_i_1st_mom, sizeof(__pyx_k_i_1st_mom), 0, 0, 1, 1},
   {&__pyx_n_s_i_2nd_mom, __pyx_k_i_2nd_mom, sizeof(__pyx_k_i_2nd_mom), 0, 0, 1, 1},
   {&__pyx_n_s_i_velocity, __pyx_k_i_velocity, sizeof(__pyx_k_i_velocity), 0, 0, 1, 1},
   {&__pyx_n_s_id, __pyx_k_id, sizeof(__pyx_k_id), 0, 0, 1, 1},
   {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
   {&__pyx_n_s_indices, __pyx_k_indices, sizeof(__pyx_k_indices), 0, 0, 1, 1},
   {&__pyx_n_s_indptr, __pyx_k_indptr, sizeof(__pyx_k_indptr), 0, 0, 1, 1},
-  {&__pyx_n_s_int32, __pyx_k_int32, sizeof(__pyx_k_int32), 0, 0, 1, 1},
   {&__pyx_n_s_item_embed, __pyx_k_item_embed, sizeof(__pyx_k_item_embed), 0, 0, 1, 1},
   {&__pyx_n_s_item_indices, __pyx_k_item_indices, sizeof(__pyx_k_item_indices), 0, 0, 1, 1},
-  {&__pyx_n_s_item_indices_orig, __pyx_k_item_indices_orig, sizeof(__pyx_k_item_indices_orig), 0, 0, 1, 1},
   {&__pyx_n_s_itemsize, __pyx_k_itemsize, sizeof(__pyx_k_itemsize), 0, 0, 1, 1},
   {&__pyx_kp_s_itemsize_0_for_cython_array, __pyx_k_itemsize_0_for_cython_array, sizeof(__pyx_k_itemsize_0_for_cython_array), 0, 0, 1, 0},
   {&__pyx_n_s_lr, __pyx_k_lr, sizeof(__pyx_k_lr), 0, 0, 1, 1},
   {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {&__pyx_n_s_memview, __pyx_k_memview, sizeof(__pyx_k_memview), 0, 0, 1, 1},
   {&__pyx_n_s_mode, __pyx_k_mode, sizeof(__pyx_k_mode), 0, 0, 1, 1},
   {&__pyx_n_s_momentum, __pyx_k_momentum, sizeof(__pyx_k_momentum), 0, 0, 1, 1},
+  {&__pyx_n_u_momentum, __pyx_k_momentum, sizeof(__pyx_k_momentum), 0, 1, 0, 1},
   {&__pyx_n_s_n_items, __pyx_k_n_items, sizeof(__pyx_k_n_items), 0, 0, 1, 1},
   {&__pyx_n_s_n_users, __pyx_k_n_users, sizeof(__pyx_k_n_users), 0, 0, 1, 1},
   {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
   {&__pyx_n_s_name_2, __pyx_k_name_2, sizeof(__pyx_k_name_2), 0, 0, 1, 1},
   {&__pyx_n_s_ndim, __pyx_k_ndim, sizeof(__pyx_k_ndim), 0, 0, 1, 1},
   {&__pyx_n_s_new, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
   {&__pyx_kp_s_no_default___reduce___due_to_non, __pyx_k_no_default___reduce___due_to_non, sizeof(__pyx_k_no_default___reduce___due_to_non), 0, 0, 1, 0},
-  {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
   {&__pyx_n_s_num_threads, __pyx_k_num_threads, sizeof(__pyx_k_num_threads), 0, 0, 1, 1},
-  {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
-  {&__pyx_kp_s_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 0, 1, 0},
-  {&__pyx_kp_s_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 0, 1, 0},
   {&__pyx_n_s_obj, __pyx_k_obj, sizeof(__pyx_k_obj), 0, 0, 1, 1},
   {&__pyx_n_s_optimizer, __pyx_k_optimizer, sizeof(__pyx_k_optimizer), 0, 0, 1, 1},
   {&__pyx_n_s_pack, __pyx_k_pack, sizeof(__pyx_k_pack), 0, 0, 1, 1},
   {&__pyx_n_s_pickle, __pyx_k_pickle, sizeof(__pyx_k_pickle), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_PickleError, __pyx_k_pyx_PickleError, sizeof(__pyx_k_pyx_PickleError), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_checksum, __pyx_k_pyx_checksum, sizeof(__pyx_k_pyx_checksum), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_getbuffer, __pyx_k_pyx_getbuffer, sizeof(__pyx_k_pyx_getbuffer), 0, 0, 1, 1},
@@ -20974,343 +19110,315 @@
   {&__pyx_n_s_reduce_ex, __pyx_k_reduce_ex, sizeof(__pyx_k_reduce_ex), 0, 0, 1, 1},
   {&__pyx_n_s_reg, __pyx_k_reg, sizeof(__pyx_k_reg), 0, 0, 1, 1},
   {&__pyx_n_s_rho1, __pyx_k_rho1, sizeof(__pyx_k_rho1), 0, 0, 1, 1},
   {&__pyx_n_s_rho2, __pyx_k_rho2, sizeof(__pyx_k_rho2), 0, 0, 1, 1},
   {&__pyx_n_s_seed, __pyx_k_seed, sizeof(__pyx_k_seed), 0, 0, 1, 1},
   {&__pyx_n_s_setstate, __pyx_k_setstate, sizeof(__pyx_k_setstate), 0, 0, 1, 1},
   {&__pyx_n_s_setstate_cython, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
-  {&__pyx_n_s_sgd, __pyx_k_sgd, sizeof(__pyx_k_sgd), 0, 0, 1, 1},
+  {&__pyx_n_u_sgd, __pyx_k_sgd, sizeof(__pyx_k_sgd), 0, 1, 0, 1},
   {&__pyx_n_s_shape, __pyx_k_shape, sizeof(__pyx_k_shape), 0, 0, 1, 1},
-  {&__pyx_n_s_shuffle, __pyx_k_shuffle, sizeof(__pyx_k_shuffle), 0, 0, 1, 1},
-  {&__pyx_n_s_shuffle_data, __pyx_k_shuffle_data, sizeof(__pyx_k_shuffle_data), 0, 0, 1, 1},
   {&__pyx_n_s_size, __pyx_k_size, sizeof(__pyx_k_size), 0, 0, 1, 1},
   {&__pyx_n_s_sparse_interaction, __pyx_k_sparse_interaction, sizeof(__pyx_k_sparse_interaction), 0, 0, 1, 1},
   {&__pyx_n_s_start, __pyx_k_start, sizeof(__pyx_k_start), 0, 0, 1, 1},
   {&__pyx_n_s_step, __pyx_k_step, sizeof(__pyx_k_step), 0, 0, 1, 1},
   {&__pyx_n_s_stop, __pyx_k_stop, sizeof(__pyx_k_stop), 0, 0, 1, 1},
   {&__pyx_kp_s_strided_and_direct, __pyx_k_strided_and_direct, sizeof(__pyx_k_strided_and_direct), 0, 0, 1, 0},
   {&__pyx_kp_s_strided_and_direct_or_indirect, __pyx_k_strided_and_direct_or_indirect, sizeof(__pyx_k_strided_and_direct_or_indirect), 0, 0, 1, 0},
   {&__pyx_kp_s_strided_and_indirect, __pyx_k_strided_and_indirect, sizeof(__pyx_k_strided_and_indirect), 0, 0, 1, 0},
   {&__pyx_kp_s_stringsource, __pyx_k_stringsource, sizeof(__pyx_k_stringsource), 0, 0, 1, 0},
   {&__pyx_n_s_struct, __pyx_k_struct, sizeof(__pyx_k_struct), 0, 0, 1, 1},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
-  {&__pyx_n_s_train_data, __pyx_k_train_data, sizeof(__pyx_k_train_data), 0, 0, 1, 1},
   {&__pyx_n_s_u_1st_mom, __pyx_k_u_1st_mom, sizeof(__pyx_k_u_1st_mom), 0, 0, 1, 1},
   {&__pyx_n_s_u_2nd_mom, __pyx_k_u_2nd_mom, sizeof(__pyx_k_u_2nd_mom), 0, 0, 1, 1},
   {&__pyx_n_s_u_velocity, __pyx_k_u_velocity, sizeof(__pyx_k_u_velocity), 0, 0, 1, 1},
   {&__pyx_kp_s_unable_to_allocate_array_data, __pyx_k_unable_to_allocate_array_data, sizeof(__pyx_k_unable_to_allocate_array_data), 0, 0, 1, 0},
   {&__pyx_kp_s_unable_to_allocate_shape_and_str, __pyx_k_unable_to_allocate_shape_and_str, sizeof(__pyx_k_unable_to_allocate_shape_and_str), 0, 0, 1, 0},
   {&__pyx_n_s_unpack, __pyx_k_unpack, sizeof(__pyx_k_unpack), 0, 0, 1, 1},
   {&__pyx_n_s_update, __pyx_k_update, sizeof(__pyx_k_update), 0, 0, 1, 1},
   {&__pyx_n_s_user_embed, __pyx_k_user_embed, sizeof(__pyx_k_user_embed), 0, 0, 1, 1},
   {&__pyx_n_s_user_indices, __pyx_k_user_indices, sizeof(__pyx_k_user_indices), 0, 0, 1, 1},
-  {&__pyx_n_s_user_indices_orig, __pyx_k_user_indices_orig, sizeof(__pyx_k_user_indices_orig), 0, 0, 1, 1},
-  {&__pyx_n_s_utils_misc, __pyx_k_utils_misc, sizeof(__pyx_k_utils_misc), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 141, __pyx_L1_error)
-  __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(1, 944, __pyx_L1_error)
-  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(2, 134, __pyx_L1_error)
-  __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(2, 149, __pyx_L1_error)
-  __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(2, 152, __pyx_L1_error)
-  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(2, 2, __pyx_L1_error)
-  __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(2, 406, __pyx_L1_error)
-  __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(2, 615, __pyx_L1_error)
-  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(2, 834, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 143, __pyx_L1_error)
+  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(1, 134, __pyx_L1_error)
+  __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(1, 149, __pyx_L1_error)
+  __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(1, 152, __pyx_L1_error)
+  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(1, 406, __pyx_L1_error)
+  __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(1, 615, __pyx_L1_error)
+  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(1, 834, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":944
- *         __pyx_import_array()
- *     except Exception:
- *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef inline int import_umath() except -1:
- */
-  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_s_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple_)) __PYX_ERR(1, 944, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple_);
-  __Pyx_GIVEREF(__pyx_tuple_);
-
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":950
- *         _import_umath()
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef inline int import_ufunc() except -1:
- */
-  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_s_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(1, 950, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__2);
-  __Pyx_GIVEREF(__pyx_tuple__2);
-
   /* "View.MemoryView":134
  * 
  *         if not self.ndim:
  *             raise ValueError("Empty shape tuple for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if itemsize <= 0:
  */
-  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_s_Empty_shape_tuple_for_cython_arr); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(2, 134, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__3);
-  __Pyx_GIVEREF(__pyx_tuple__3);
+  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_s_Empty_shape_tuple_for_cython_arr); if (unlikely(!__pyx_tuple_)) __PYX_ERR(1, 134, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple_);
+  __Pyx_GIVEREF(__pyx_tuple_);
 
   /* "View.MemoryView":137
  * 
  *         if itemsize <= 0:
  *             raise ValueError("itemsize <= 0 for cython.array")             # <<<<<<<<<<<<<<
  * 
  *         if not isinstance(format, bytes):
  */
-  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_itemsize_0_for_cython_array); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(2, 137, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__4);
-  __Pyx_GIVEREF(__pyx_tuple__4);
+  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_s_itemsize_0_for_cython_array); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(1, 137, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__2);
+  __Pyx_GIVEREF(__pyx_tuple__2);
 
   /* "View.MemoryView":149
  * 
  *         if not self._shape:
  *             raise MemoryError("unable to allocate shape and strides.")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_shape_and_str); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(2, 149, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__5);
-  __Pyx_GIVEREF(__pyx_tuple__5);
+  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_shape_and_str); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(1, 149, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__3);
+  __Pyx_GIVEREF(__pyx_tuple__3);
 
   /* "View.MemoryView":177
  *             self.data = <char *>malloc(self.len)
  *             if not self.data:
  *                 raise MemoryError("unable to allocate array data.")             # <<<<<<<<<<<<<<
  * 
  *             if self.dtype_is_object:
  */
-  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_array_data); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(2, 177, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__6);
-  __Pyx_GIVEREF(__pyx_tuple__6);
+  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_unable_to_allocate_array_data); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(1, 177, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__4);
+  __Pyx_GIVEREF(__pyx_tuple__4);
 
   /* "View.MemoryView":193
  *             bufmode = PyBUF_F_CONTIGUOUS | PyBUF_ANY_CONTIGUOUS
  *         if not (flags & bufmode):
  *             raise ValueError("Can only create a buffer that is contiguous in memory.")             # <<<<<<<<<<<<<<
  *         info.buf = self.data
  *         info.len = self.len
  */
-  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_s_Can_only_create_a_buffer_that_is); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(2, 193, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__7);
-  __Pyx_GIVEREF(__pyx_tuple__7);
+  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_s_Can_only_create_a_buffer_that_is); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(1, 193, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__5);
+  __Pyx_GIVEREF(__pyx_tuple__5);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__8 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(2, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__8);
-  __Pyx_GIVEREF(__pyx_tuple__8);
+  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__6);
+  __Pyx_GIVEREF(__pyx_tuple__6);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(2, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__9);
-  __Pyx_GIVEREF(__pyx_tuple__9);
+  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__7);
+  __Pyx_GIVEREF(__pyx_tuple__7);
 
   /* "View.MemoryView":420
  *     def __setitem__(memoryview self, object index, object value):
  *         if self.view.readonly:
  *             raise TypeError("Cannot assign to read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         have_slices, index = _unellipsify(index, self.view.ndim)
  */
-  __pyx_tuple__10 = PyTuple_Pack(1, __pyx_kp_s_Cannot_assign_to_read_only_memor); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(2, 420, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__10);
-  __Pyx_GIVEREF(__pyx_tuple__10);
+  __pyx_tuple__8 = PyTuple_Pack(1, __pyx_kp_s_Cannot_assign_to_read_only_memor); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(1, 420, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__8);
+  __Pyx_GIVEREF(__pyx_tuple__8);
 
   /* "View.MemoryView":497
  *             result = struct.unpack(self.view.format, bytesitem)
  *         except struct.error:
  *             raise ValueError("Unable to convert item to object")             # <<<<<<<<<<<<<<
  *         else:
  *             if len(self.view.format) == 1:
  */
-  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_kp_s_Unable_to_convert_item_to_object); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(2, 497, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__11);
-  __Pyx_GIVEREF(__pyx_tuple__11);
+  __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_s_Unable_to_convert_item_to_object); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(1, 497, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__9);
+  __Pyx_GIVEREF(__pyx_tuple__9);
 
   /* "View.MemoryView":522
  *     def __getbuffer__(self, Py_buffer *info, int flags):
  *         if flags & PyBUF_WRITABLE and self.view.readonly:
  *             raise ValueError("Cannot create writable memory view from read-only memoryview")             # <<<<<<<<<<<<<<
  * 
  *         if flags & PyBUF_ND:
  */
-  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_kp_s_Cannot_create_writable_memory_vi); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(2, 522, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__12);
-  __Pyx_GIVEREF(__pyx_tuple__12);
+  __pyx_tuple__10 = PyTuple_Pack(1, __pyx_kp_s_Cannot_create_writable_memory_vi); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(1, 522, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__10);
+  __Pyx_GIVEREF(__pyx_tuple__10);
 
   /* "View.MemoryView":572
  *         if self.view.strides == NULL:
  * 
  *             raise ValueError("Buffer view does not expose strides")             # <<<<<<<<<<<<<<
  * 
  *         return tuple([stride for stride in self.view.strides[:self.view.ndim]])
  */
-  __pyx_tuple__13 = PyTuple_Pack(1, __pyx_kp_s_Buffer_view_does_not_expose_stri); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(2, 572, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__13);
-  __Pyx_GIVEREF(__pyx_tuple__13);
+  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_kp_s_Buffer_view_does_not_expose_stri); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(1, 572, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__11);
+  __Pyx_GIVEREF(__pyx_tuple__11);
 
   /* "View.MemoryView":579
  *     def suboffsets(self):
  *         if self.view.suboffsets == NULL:
  *             return (-1,) * self.view.ndim             # <<<<<<<<<<<<<<
  * 
  *         return tuple([suboffset for suboffset in self.view.suboffsets[:self.view.ndim]])
  */
-  __pyx_tuple__14 = PyTuple_New(1); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(2, 579, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__14);
+  __pyx_tuple__12 = PyTuple_New(1); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(1, 579, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__12);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
-  PyTuple_SET_ITEM(__pyx_tuple__14, 0, __pyx_int_neg_1);
-  __Pyx_GIVEREF(__pyx_tuple__14);
+  PyTuple_SET_ITEM(__pyx_tuple__12, 0, __pyx_int_neg_1);
+  __Pyx_GIVEREF(__pyx_tuple__12);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__15 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__15)) __PYX_ERR(2, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__15);
-  __Pyx_GIVEREF(__pyx_tuple__15);
+  __pyx_tuple__13 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__13);
+  __Pyx_GIVEREF(__pyx_tuple__13);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__16 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(2, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__16);
-  __Pyx_GIVEREF(__pyx_tuple__16);
+  __pyx_tuple__14 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__14);
+  __Pyx_GIVEREF(__pyx_tuple__14);
 
   /* "View.MemoryView":684
  *         if item is Ellipsis:
  *             if not seen_ellipsis:
  *                 result.extend([slice(None)] * (ndim - len(tup) + 1))             # <<<<<<<<<<<<<<
  *                 seen_ellipsis = True
  *             else:
  */
-  __pyx_slice__17 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__17)) __PYX_ERR(2, 684, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_slice__17);
-  __Pyx_GIVEREF(__pyx_slice__17);
+  __pyx_slice__15 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__15)) __PYX_ERR(1, 684, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_slice__15);
+  __Pyx_GIVEREF(__pyx_slice__15);
 
   /* "View.MemoryView":705
  *     for suboffset in suboffsets[:ndim]:
  *         if suboffset >= 0:
  *             raise ValueError("Indirect dimensions not supported")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__18 = PyTuple_Pack(1, __pyx_kp_s_Indirect_dimensions_not_supporte); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(2, 705, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__18);
-  __Pyx_GIVEREF(__pyx_tuple__18);
+  __pyx_tuple__16 = PyTuple_Pack(1, __pyx_kp_s_Indirect_dimensions_not_supporte); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(1, 705, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__16);
+  __Pyx_GIVEREF(__pyx_tuple__16);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__19 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__19)) __PYX_ERR(2, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__19);
-  __Pyx_GIVEREF(__pyx_tuple__19);
+  __pyx_tuple__17 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__17);
+  __Pyx_GIVEREF(__pyx_tuple__17);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__20 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__20)) __PYX_ERR(2, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__20);
-  __Pyx_GIVEREF(__pyx_tuple__20);
-  __pyx_tuple__21 = PyTuple_Pack(3, __pyx_int_184977713, __pyx_int_136983863, __pyx_int_112105877); if (unlikely(!__pyx_tuple__21)) __PYX_ERR(2, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__21);
-  __Pyx_GIVEREF(__pyx_tuple__21);
+  __pyx_tuple__18 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__18);
+  __Pyx_GIVEREF(__pyx_tuple__18);
+  __pyx_tuple__19 = PyTuple_Pack(3, __pyx_int_184977713, __pyx_int_136983863, __pyx_int_112105877); if (unlikely(!__pyx_tuple__19)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__19);
+  __Pyx_GIVEREF(__pyx_tuple__19);
 
   /* "View.MemoryView":287
  *         return self.name
  * 
  * cdef generic = Enum("<strided and direct or indirect>")             # <<<<<<<<<<<<<<
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")
  */
-  __pyx_tuple__22 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct_or_indirect); if (unlikely(!__pyx_tuple__22)) __PYX_ERR(2, 287, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__22);
-  __Pyx_GIVEREF(__pyx_tuple__22);
+  __pyx_tuple__20 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct_or_indirect); if (unlikely(!__pyx_tuple__20)) __PYX_ERR(1, 287, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__20);
+  __Pyx_GIVEREF(__pyx_tuple__20);
 
   /* "View.MemoryView":288
  * 
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default             # <<<<<<<<<<<<<<
  * cdef indirect = Enum("<strided and indirect>")
  * 
  */
-  __pyx_tuple__23 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct); if (unlikely(!__pyx_tuple__23)) __PYX_ERR(2, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__23);
-  __Pyx_GIVEREF(__pyx_tuple__23);
+  __pyx_tuple__21 = PyTuple_Pack(1, __pyx_kp_s_strided_and_direct); if (unlikely(!__pyx_tuple__21)) __PYX_ERR(1, 288, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__21);
+  __Pyx_GIVEREF(__pyx_tuple__21);
 
   /* "View.MemoryView":289
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_s_strided_and_indirect); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(2, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__24);
-  __Pyx_GIVEREF(__pyx_tuple__24);
+  __pyx_tuple__22 = PyTuple_Pack(1, __pyx_kp_s_strided_and_indirect); if (unlikely(!__pyx_tuple__22)) __PYX_ERR(1, 289, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__22);
+  __Pyx_GIVEREF(__pyx_tuple__22);
 
   /* "View.MemoryView":292
  * 
  * 
  * cdef contiguous = Enum("<contiguous and direct>")             # <<<<<<<<<<<<<<
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")
  * 
  */
-  __pyx_tuple__25 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_direct); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(2, 292, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__25);
-  __Pyx_GIVEREF(__pyx_tuple__25);
+  __pyx_tuple__23 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_direct); if (unlikely(!__pyx_tuple__23)) __PYX_ERR(1, 292, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__23);
+  __Pyx_GIVEREF(__pyx_tuple__23);
 
   /* "View.MemoryView":293
  * 
  * cdef contiguous = Enum("<contiguous and direct>")
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_tuple__26 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_indirect); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(2, 293, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__26);
-  __Pyx_GIVEREF(__pyx_tuple__26);
+  __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_s_contiguous_and_indirect); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(1, 293, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__24);
+  __Pyx_GIVEREF(__pyx_tuple__24);
 
   /* "(tree fragment)":1
  * def __pyx_unpickle_Enum(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
-  __pyx_tuple__27 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(2, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__27);
-  __Pyx_GIVEREF(__pyx_tuple__27);
-  __pyx_codeobj__28 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Enum, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(2, 1, __pyx_L1_error)
+  __pyx_tuple__25 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__25);
+  __Pyx_GIVEREF(__pyx_tuple__25);
+  __pyx_codeobj__26 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__25, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Enum, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__26)) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
@@ -21319,15 +19427,14 @@
   #if defined(WITH_THREAD) && PY_VERSION_HEX < 0x030700F0
 PyEval_InitThreads();
 #endif
 
 if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1, __pyx_L1_error)
 
   if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_float_0_0 = PyFloat_FromDouble(0.0); if (unlikely(!__pyx_float_0_0)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_float_0_9 = PyFloat_FromDouble(0.9); if (unlikely(!__pyx_float_0_9)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_float_0_999 = PyFloat_FromDouble(0.999); if (unlikely(!__pyx_float_0_999)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_112105877 = PyInt_FromLong(112105877L); if (unlikely(!__pyx_int_112105877)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_136983863 = PyInt_FromLong(136983863L); if (unlikely(!__pyx_int_136983863)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_184977713 = PyInt_FromLong(184977713L); if (unlikely(!__pyx_int_184977713)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -21379,143 +19486,76 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_init_code", 0);
   /*--- Type init code ---*/
   __pyx_vtabptr_array = &__pyx_vtable_array;
   __pyx_vtable_array.get_memview = (PyObject *(*)(struct __pyx_array_obj *))__pyx_array_get_memview;
-  if (PyType_Ready(&__pyx_type___pyx_array) < 0) __PYX_ERR(2, 106, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type___pyx_array) < 0) __PYX_ERR(1, 106, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type___pyx_array.tp_print = 0;
   #endif
-  if (__Pyx_SetVtable(__pyx_type___pyx_array.tp_dict, __pyx_vtabptr_array) < 0) __PYX_ERR(2, 106, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type___pyx_array) < 0) __PYX_ERR(2, 106, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type___pyx_array.tp_dict, __pyx_vtabptr_array) < 0) __PYX_ERR(1, 106, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type___pyx_array) < 0) __PYX_ERR(1, 106, __pyx_L1_error)
   __pyx_array_type = &__pyx_type___pyx_array;
-  if (PyType_Ready(&__pyx_type___pyx_MemviewEnum) < 0) __PYX_ERR(2, 280, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type___pyx_MemviewEnum) < 0) __PYX_ERR(1, 280, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type___pyx_MemviewEnum.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type___pyx_MemviewEnum.tp_dictoffset && __pyx_type___pyx_MemviewEnum.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type___pyx_MemviewEnum.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type___pyx_MemviewEnum) < 0) __PYX_ERR(2, 280, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type___pyx_MemviewEnum) < 0) __PYX_ERR(1, 280, __pyx_L1_error)
   __pyx_MemviewEnum_type = &__pyx_type___pyx_MemviewEnum;
   __pyx_vtabptr_memoryview = &__pyx_vtable_memoryview;
   __pyx_vtable_memoryview.get_item_pointer = (char *(*)(struct __pyx_memoryview_obj *, PyObject *))__pyx_memoryview_get_item_pointer;
   __pyx_vtable_memoryview.is_slice = (PyObject *(*)(struct __pyx_memoryview_obj *, PyObject *))__pyx_memoryview_is_slice;
   __pyx_vtable_memoryview.setitem_slice_assignment = (PyObject *(*)(struct __pyx_memoryview_obj *, PyObject *, PyObject *))__pyx_memoryview_setitem_slice_assignment;
   __pyx_vtable_memoryview.setitem_slice_assign_scalar = (PyObject *(*)(struct __pyx_memoryview_obj *, struct __pyx_memoryview_obj *, PyObject *))__pyx_memoryview_setitem_slice_assign_scalar;
   __pyx_vtable_memoryview.setitem_indexed = (PyObject *(*)(struct __pyx_memoryview_obj *, PyObject *, PyObject *))__pyx_memoryview_setitem_indexed;
   __pyx_vtable_memoryview.convert_item_to_object = (PyObject *(*)(struct __pyx_memoryview_obj *, char *))__pyx_memoryview_convert_item_to_object;
   __pyx_vtable_memoryview.assign_item_from_object = (PyObject *(*)(struct __pyx_memoryview_obj *, char *, PyObject *))__pyx_memoryview_assign_item_from_object;
-  if (PyType_Ready(&__pyx_type___pyx_memoryview) < 0) __PYX_ERR(2, 331, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type___pyx_memoryview) < 0) __PYX_ERR(1, 331, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type___pyx_memoryview.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type___pyx_memoryview.tp_dictoffset && __pyx_type___pyx_memoryview.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type___pyx_memoryview.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type___pyx_memoryview.tp_dict, __pyx_vtabptr_memoryview) < 0) __PYX_ERR(2, 331, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type___pyx_memoryview) < 0) __PYX_ERR(2, 331, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type___pyx_memoryview.tp_dict, __pyx_vtabptr_memoryview) < 0) __PYX_ERR(1, 331, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type___pyx_memoryview) < 0) __PYX_ERR(1, 331, __pyx_L1_error)
   __pyx_memoryview_type = &__pyx_type___pyx_memoryview;
   __pyx_vtabptr__memoryviewslice = &__pyx_vtable__memoryviewslice;
   __pyx_vtable__memoryviewslice.__pyx_base = *__pyx_vtabptr_memoryview;
   __pyx_vtable__memoryviewslice.__pyx_base.convert_item_to_object = (PyObject *(*)(struct __pyx_memoryview_obj *, char *))__pyx_memoryviewslice_convert_item_to_object;
   __pyx_vtable__memoryviewslice.__pyx_base.assign_item_from_object = (PyObject *(*)(struct __pyx_memoryview_obj *, char *, PyObject *))__pyx_memoryviewslice_assign_item_from_object;
   __pyx_type___pyx_memoryviewslice.tp_base = __pyx_memoryview_type;
-  if (PyType_Ready(&__pyx_type___pyx_memoryviewslice) < 0) __PYX_ERR(2, 967, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type___pyx_memoryviewslice) < 0) __PYX_ERR(1, 967, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type___pyx_memoryviewslice.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type___pyx_memoryviewslice.tp_dictoffset && __pyx_type___pyx_memoryviewslice.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type___pyx_memoryviewslice.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type___pyx_memoryviewslice.tp_dict, __pyx_vtabptr__memoryviewslice) < 0) __PYX_ERR(2, 967, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type___pyx_memoryviewslice) < 0) __PYX_ERR(2, 967, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type___pyx_memoryviewslice.tp_dict, __pyx_vtabptr__memoryviewslice) < 0) __PYX_ERR(1, 967, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type___pyx_memoryviewslice) < 0) __PYX_ERR(1, 967, __pyx_L1_error)
   __pyx_memoryviewslice_type = &__pyx_type___pyx_memoryviewslice;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static int __Pyx_modinit_type_import_code(void) {
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
-  __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
-  #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyTypeObject),
-  #else
-  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyHeapTypeObject),
-  #endif
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 199, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_5numpy_dtype = __Pyx_ImportType(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT(PyArray_Descr),
-  __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
-  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT(PyArrayIterObject),
-  __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
-  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT(PyArrayMultiIterObject),
-  __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
-  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT(PyArrayObject),
-  __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
-  __pyx_ptype_5numpy_generic = __Pyx_ImportType(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT(PyObject),
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
-  __pyx_ptype_5numpy_number = __Pyx_ImportType(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT(PyObject),
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
-  __pyx_ptype_5numpy_integer = __Pyx_ImportType(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT(PyObject),
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
-  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT(PyObject),
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
-  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT(PyObject),
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
-  __pyx_ptype_5numpy_inexact = __Pyx_ImportType(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT(PyObject),
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
-  __pyx_ptype_5numpy_floating = __Pyx_ImportType(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT(PyObject),
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
-  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT(PyObject),
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
-  __pyx_ptype_5numpy_flexible = __Pyx_ImportType(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT(PyObject),
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
-  __pyx_ptype_5numpy_character = __Pyx_ImportType(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT(PyObject),
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
-  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT(PyUFuncObject),
-  __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_RefNannyFinishContext();
-  return -1;
 }
 
 static int __Pyx_modinit_variable_import_code(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_modinit_variable_import_code", 0);
   /*--- Variable import code ---*/
   __Pyx_RefNannyFinishContext();
@@ -21621,16 +19661,15 @@
 
 
 static CYTHON_SMALL_CODE int __pyx_pymod_exec__bpr(PyObject *__pyx_pyinit_module)
 #endif
 #endif
 {
   PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  static PyThread_type_lock __pyx_t_3[8];
+  static PyThread_type_lock __pyx_t_2[8];
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   if (__pyx_m) {
     if (__pyx_m == __pyx_pyinit_module) return 0;
@@ -21720,145 +19759,114 @@
   /*--- Constants init code ---*/
   if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Global type/function init code ---*/
   (void)__Pyx_modinit_global_init_code();
   (void)__Pyx_modinit_variable_export_code();
   (void)__Pyx_modinit_function_export_code();
   if (unlikely(__Pyx_modinit_type_init_code() < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
-  if (unlikely(__Pyx_modinit_type_import_code() < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
+  (void)__Pyx_modinit_type_import_code();
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
   /* "libreco/algorithms/_bpr.pyx":1
- * import numpy as np             # <<<<<<<<<<<<<<
- * cimport numpy as np
+ * # cython: language_level=3             # <<<<<<<<<<<<<<
  * cimport cython
- */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "libreco/algorithms/_bpr.pyx":10
- * from libcpp.vector cimport vector
- * 
- * from ..utils.misc import shuffle_data             # <<<<<<<<<<<<<<
- * 
  * 
  */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_INCREF(__pyx_n_s_shuffle_data);
-  __Pyx_GIVEREF(__pyx_n_s_shuffle_data);
-  PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_shuffle_data);
-  __pyx_t_2 = __Pyx_Import(__pyx_n_s_utils_misc, __pyx_t_1, 2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 10, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_shuffle_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_shuffle_data, __pyx_t_1) < 0) __PYX_ERR(0, 10, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-  /* "libreco/algorithms/_bpr.pyx":1
- * import numpy as np             # <<<<<<<<<<<<<<
- * cimport numpy as np
- * cimport cython
- */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "View.MemoryView":210
  *         info.obj = self
  * 
  *     __pyx_getbuffer = capsule(<void *> &__pyx_array_getbuffer, "getbuffer(obj, view, flags)")             # <<<<<<<<<<<<<<
  * 
  *     def __dealloc__(array self):
  */
-  __pyx_t_2 = __pyx_capsule_create(((void *)(&__pyx_array_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 210, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem((PyObject *)__pyx_array_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_2) < 0) __PYX_ERR(2, 210, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_1 = __pyx_capsule_create(((void *)(&__pyx_array_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 210, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem((PyObject *)__pyx_array_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_1) < 0) __PYX_ERR(1, 210, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   PyType_Modified(__pyx_array_type);
 
   /* "View.MemoryView":287
  *         return self.name
  * 
  * cdef generic = Enum("<strided and direct or indirect>")             # <<<<<<<<<<<<<<
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")
  */
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 287, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__20, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 287, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XGOTREF(generic);
-  __Pyx_DECREF_SET(generic, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
+  __Pyx_DECREF_SET(generic, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
 
   /* "View.MemoryView":288
  * 
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default             # <<<<<<<<<<<<<<
  * cdef indirect = Enum("<strided and indirect>")
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__23, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__21, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 288, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XGOTREF(strided);
-  __Pyx_DECREF_SET(strided, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
+  __Pyx_DECREF_SET(strided, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
 
   /* "View.MemoryView":289
  * cdef generic = Enum("<strided and direct or indirect>")
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__22, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 289, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XGOTREF(indirect);
-  __Pyx_DECREF_SET(indirect, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
+  __Pyx_DECREF_SET(indirect, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
 
   /* "View.MemoryView":292
  * 
  * 
  * cdef contiguous = Enum("<contiguous and direct>")             # <<<<<<<<<<<<<<
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__25, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 292, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__23, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 292, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XGOTREF(contiguous);
-  __Pyx_DECREF_SET(contiguous, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
+  __Pyx_DECREF_SET(contiguous, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
 
   /* "View.MemoryView":293
  * 
  * cdef contiguous = Enum("<contiguous and direct>")
  * cdef indirect_contiguous = Enum("<contiguous and indirect>")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__26, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 293, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)__pyx_MemviewEnum_type), __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 293, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XGOTREF(indirect_contiguous);
-  __Pyx_DECREF_SET(indirect_contiguous, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
+  __Pyx_DECREF_SET(indirect_contiguous, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
 
   /* "View.MemoryView":317
  * 
  * DEF THREAD_LOCKS_PREALLOCATED = 8
  * cdef int __pyx_memoryview_thread_locks_used = 0             # <<<<<<<<<<<<<<
  * cdef PyThread_type_lock[THREAD_LOCKS_PREALLOCATED] __pyx_memoryview_thread_locks = [
  *     PyThread_allocate_lock(),
@@ -21868,74 +19876,73 @@
   /* "View.MemoryView":318
  * DEF THREAD_LOCKS_PREALLOCATED = 8
  * cdef int __pyx_memoryview_thread_locks_used = 0
  * cdef PyThread_type_lock[THREAD_LOCKS_PREALLOCATED] __pyx_memoryview_thread_locks = [             # <<<<<<<<<<<<<<
  *     PyThread_allocate_lock(),
  *     PyThread_allocate_lock(),
  */
-  __pyx_t_3[0] = PyThread_allocate_lock();
-  __pyx_t_3[1] = PyThread_allocate_lock();
-  __pyx_t_3[2] = PyThread_allocate_lock();
-  __pyx_t_3[3] = PyThread_allocate_lock();
-  __pyx_t_3[4] = PyThread_allocate_lock();
-  __pyx_t_3[5] = PyThread_allocate_lock();
-  __pyx_t_3[6] = PyThread_allocate_lock();
-  __pyx_t_3[7] = PyThread_allocate_lock();
-  memcpy(&(__pyx_memoryview_thread_locks[0]), __pyx_t_3, sizeof(__pyx_memoryview_thread_locks[0]) * (8));
+  __pyx_t_2[0] = PyThread_allocate_lock();
+  __pyx_t_2[1] = PyThread_allocate_lock();
+  __pyx_t_2[2] = PyThread_allocate_lock();
+  __pyx_t_2[3] = PyThread_allocate_lock();
+  __pyx_t_2[4] = PyThread_allocate_lock();
+  __pyx_t_2[5] = PyThread_allocate_lock();
+  __pyx_t_2[6] = PyThread_allocate_lock();
+  __pyx_t_2[7] = PyThread_allocate_lock();
+  memcpy(&(__pyx_memoryview_thread_locks[0]), __pyx_t_2, sizeof(__pyx_memoryview_thread_locks[0]) * (8));
 
   /* "View.MemoryView":551
  *         info.obj = self
  * 
  *     __pyx_getbuffer = capsule(<void *> &__pyx_memoryview_getbuffer, "getbuffer(obj, view, flags)")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __pyx_capsule_create(((void *)(&__pyx_memoryview_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 551, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem((PyObject *)__pyx_memoryview_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_2) < 0) __PYX_ERR(2, 551, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_1 = __pyx_capsule_create(((void *)(&__pyx_memoryview_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 551, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem((PyObject *)__pyx_memoryview_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_1) < 0) __PYX_ERR(1, 551, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   PyType_Modified(__pyx_memoryview_type);
 
   /* "View.MemoryView":997
  *         return self.from_object
  * 
  *     __pyx_getbuffer = capsule(<void *> &__pyx_memoryview_getbuffer, "getbuffer(obj, view, flags)")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __pyx_capsule_create(((void *)(&__pyx_memoryview_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 997, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem((PyObject *)__pyx_memoryviewslice_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_2) < 0) __PYX_ERR(2, 997, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_1 = __pyx_capsule_create(((void *)(&__pyx_memoryview_getbuffer)), ((char *)"getbuffer(obj, view, flags)")); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 997, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem((PyObject *)__pyx_memoryviewslice_type->tp_dict, __pyx_n_s_pyx_getbuffer, __pyx_t_1) < 0) __PYX_ERR(1, 997, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   PyType_Modified(__pyx_memoryviewslice_type);
 
   /* "(tree fragment)":1
  * def __pyx_unpickle_Enum(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
-  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_15View_dot_MemoryView_1__pyx_unpickle_Enum, NULL, __pyx_n_s_View_MemoryView); if (unlikely(!__pyx_t_2)) __PYX_ERR(2, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Enum, __pyx_t_2) < 0) __PYX_ERR(2, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_15View_dot_MemoryView_1__pyx_unpickle_Enum, NULL, __pyx_n_s_View_MemoryView); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle_Enum, __pyx_t_1) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "(tree fragment)":11
  *         __pyx_unpickle_Enum__set_state(<Enum> __pyx_result, __pyx_state)
  *     return __pyx_result
  * cdef __pyx_unpickle_Enum__set_state(Enum __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
  *     __pyx_result.name = __pyx_state[0]
  *     if len(__pyx_state) > 1 and hasattr(__pyx_result, '__dict__'):
  */
 
   /*--- Wrapped vars code ---*/
 
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
   if (__pyx_m) {
     if (__pyx_d) {
       __Pyx_AddTraceback("init libreco.algorithms._bpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
     }
     Py_CLEAR(__pyx_m);
   } else if (!PyErr_Occurred()) {
     PyErr_SetString(PyExc_ImportError, "init libreco.algorithms._bpr");
@@ -21993,384 +20000,14 @@
 #else
             "name '%.200s' is not defined", PyString_AS_STRING(name));
 #endif
     }
     return result;
 }
 
-/* PyDictVersioning */
-#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
-}
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
-    PyObject **dictptr = NULL;
-    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
-    if (offset) {
-#if CYTHON_COMPILING_IN_CPYTHON
-        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
-#else
-        dictptr = _PyObject_GetDictPtr(obj);
-#endif
-    }
-    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
-}
-static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
-        return 0;
-    return obj_dict_version == __Pyx_get_object_dict_version(obj);
-}
-#endif
-
-/* GetModuleGlobalName */
-#if CYTHON_USE_DICT_VERSIONS
-static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
-#else
-static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
-#endif
-{
-    PyObject *result;
-#if !CYTHON_AVOID_BORROWED_REFS
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
-    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    } else if (unlikely(PyErr_Occurred())) {
-        return NULL;
-    }
-#else
-    result = PyDict_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    }
-#endif
-#else
-    result = PyObject_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    }
-    PyErr_Clear();
-#endif
-    return __Pyx_GetBuiltinName(name);
-}
-
-/* PyCFunctionFastCall */
-#if CYTHON_FAST_PYCCALL
-static CYTHON_INLINE PyObject * __Pyx_PyCFunction_FastCall(PyObject *func_obj, PyObject **args, Py_ssize_t nargs) {
-    PyCFunctionObject *func = (PyCFunctionObject*)func_obj;
-    PyCFunction meth = PyCFunction_GET_FUNCTION(func);
-    PyObject *self = PyCFunction_GET_SELF(func);
-    int flags = PyCFunction_GET_FLAGS(func);
-    assert(PyCFunction_Check(func));
-    assert(METH_FASTCALL == (flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)));
-    assert(nargs >= 0);
-    assert(nargs == 0 || args != NULL);
-    /* _PyCFunction_FastCallDict() must not be called with an exception set,
-       because it may clear it (directly or indirectly) and so the
-       caller loses its exception */
-    assert(!PyErr_Occurred());
-    if ((PY_VERSION_HEX < 0x030700A0) || unlikely(flags & METH_KEYWORDS)) {
-        return (*((__Pyx_PyCFunctionFastWithKeywords)(void*)meth)) (self, args, nargs, NULL);
-    } else {
-        return (*((__Pyx_PyCFunctionFast)(void*)meth)) (self, args, nargs);
-    }
-}
-#endif
-
-/* PyFunctionFastCall */
-#if CYTHON_FAST_PYCALL
-static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
-                                               PyObject *globals) {
-    PyFrameObject *f;
-    PyThreadState *tstate = __Pyx_PyThreadState_Current;
-    PyObject **fastlocals;
-    Py_ssize_t i;
-    PyObject *result;
-    assert(globals != NULL);
-    /* XXX Perhaps we should create a specialized
-       PyFrame_New() that doesn't take locals, but does
-       take builtins without sanity checking them.
-       */
-    assert(tstate != NULL);
-    f = PyFrame_New(tstate, co, globals, NULL);
-    if (f == NULL) {
-        return NULL;
-    }
-    fastlocals = __Pyx_PyFrame_GetLocalsplus(f);
-    for (i = 0; i < na; i++) {
-        Py_INCREF(*args);
-        fastlocals[i] = *args++;
-    }
-    result = PyEval_EvalFrameEx(f,0);
-    ++tstate->recursion_depth;
-    Py_DECREF(f);
-    --tstate->recursion_depth;
-    return result;
-}
-#if 1 || PY_VERSION_HEX < 0x030600B1
-static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs) {
-    PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
-    PyObject *globals = PyFunction_GET_GLOBALS(func);
-    PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
-    PyObject *closure;
-#if PY_MAJOR_VERSION >= 3
-    PyObject *kwdefs;
-#endif
-    PyObject *kwtuple, **k;
-    PyObject **d;
-    Py_ssize_t nd;
-    Py_ssize_t nk;
-    PyObject *result;
-    assert(kwargs == NULL || PyDict_Check(kwargs));
-    nk = kwargs ? PyDict_Size(kwargs) : 0;
-    if (Py_EnterRecursiveCall((char*)" while calling a Python object")) {
-        return NULL;
-    }
-    if (
-#if PY_MAJOR_VERSION >= 3
-            co->co_kwonlyargcount == 0 &&
-#endif
-            likely(kwargs == NULL || nk == 0) &&
-            co->co_flags == (CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE)) {
-        if (argdefs == NULL && co->co_argcount == nargs) {
-            result = __Pyx_PyFunction_FastCallNoKw(co, args, nargs, globals);
-            goto done;
-        }
-        else if (nargs == 0 && argdefs != NULL
-                 && co->co_argcount == Py_SIZE(argdefs)) {
-            /* function called with no arguments, but all parameters have
-               a default value: use default values as arguments .*/
-            args = &PyTuple_GET_ITEM(argdefs, 0);
-            result =__Pyx_PyFunction_FastCallNoKw(co, args, Py_SIZE(argdefs), globals);
-            goto done;
-        }
-    }
-    if (kwargs != NULL) {
-        Py_ssize_t pos, i;
-        kwtuple = PyTuple_New(2 * nk);
-        if (kwtuple == NULL) {
-            result = NULL;
-            goto done;
-        }
-        k = &PyTuple_GET_ITEM(kwtuple, 0);
-        pos = i = 0;
-        while (PyDict_Next(kwargs, &pos, &k[i], &k[i+1])) {
-            Py_INCREF(k[i]);
-            Py_INCREF(k[i+1]);
-            i += 2;
-        }
-        nk = i / 2;
-    }
-    else {
-        kwtuple = NULL;
-        k = NULL;
-    }
-    closure = PyFunction_GET_CLOSURE(func);
-#if PY_MAJOR_VERSION >= 3
-    kwdefs = PyFunction_GET_KW_DEFAULTS(func);
-#endif
-    if (argdefs != NULL) {
-        d = &PyTuple_GET_ITEM(argdefs, 0);
-        nd = Py_SIZE(argdefs);
-    }
-    else {
-        d = NULL;
-        nd = 0;
-    }
-#if PY_MAJOR_VERSION >= 3
-    result = PyEval_EvalCodeEx((PyObject*)co, globals, (PyObject *)NULL,
-                               args, (int)nargs,
-                               k, (int)nk,
-                               d, (int)nd, kwdefs, closure);
-#else
-    result = PyEval_EvalCodeEx(co, globals, (PyObject *)NULL,
-                               args, (int)nargs,
-                               k, (int)nk,
-                               d, (int)nd, closure);
-#endif
-    Py_XDECREF(kwtuple);
-done:
-    Py_LeaveRecursiveCall();
-    return result;
-}
-#endif
-#endif
-
-/* PyObjectCall */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
-    PyObject *result;
-    ternaryfunc call = Py_TYPE(func)->tp_call;
-    if (unlikely(!call))
-        return PyObject_Call(func, arg, kw);
-    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
-        return NULL;
-    result = (*call)(func, arg, kw);
-    Py_LeaveRecursiveCall();
-    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
-        PyErr_SetString(
-            PyExc_SystemError,
-            "NULL result without error in PyObject_Call");
-    }
-    return result;
-}
-#endif
-
-/* PyObjectCall2Args */
-static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
-    PyObject *args, *result = NULL;
-    #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(function)) {
-        PyObject *args[2] = {arg1, arg2};
-        return __Pyx_PyFunction_FastCall(function, args, 2);
-    }
-    #endif
-    #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(function)) {
-        PyObject *args[2] = {arg1, arg2};
-        return __Pyx_PyCFunction_FastCall(function, args, 2);
-    }
-    #endif
-    args = PyTuple_New(2);
-    if (unlikely(!args)) goto done;
-    Py_INCREF(arg1);
-    PyTuple_SET_ITEM(args, 0, arg1);
-    Py_INCREF(arg2);
-    PyTuple_SET_ITEM(args, 1, arg2);
-    Py_INCREF(function);
-    result = __Pyx_PyObject_Call(function, args, NULL);
-    Py_DECREF(args);
-    Py_DECREF(function);
-done:
-    return result;
-}
-
-/* PyObjectCallMethO */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
-    PyObject *self, *result;
-    PyCFunction cfunc;
-    cfunc = PyCFunction_GET_FUNCTION(func);
-    self = PyCFunction_GET_SELF(func);
-    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
-        return NULL;
-    result = cfunc(self, arg);
-    Py_LeaveRecursiveCall();
-    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
-        PyErr_SetString(
-            PyExc_SystemError,
-            "NULL result without error in PyObject_Call");
-    }
-    return result;
-}
-#endif
-
-/* PyObjectCallOneArg */
-#if CYTHON_COMPILING_IN_CPYTHON
-static PyObject* __Pyx__PyObject_CallOneArg(PyObject *func, PyObject *arg) {
-    PyObject *result;
-    PyObject *args = PyTuple_New(1);
-    if (unlikely(!args)) return NULL;
-    Py_INCREF(arg);
-    PyTuple_SET_ITEM(args, 0, arg);
-    result = __Pyx_PyObject_Call(func, args, NULL);
-    Py_DECREF(args);
-    return result;
-}
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
-#if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(func)) {
-        return __Pyx_PyFunction_FastCall(func, &arg, 1);
-    }
-#endif
-    if (likely(PyCFunction_Check(func))) {
-        if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
-            return __Pyx_PyObject_CallMethO(func, arg);
-#if CYTHON_FAST_PYCCALL
-        } else if (__Pyx_PyFastCFunction_Check(func)) {
-            return __Pyx_PyCFunction_FastCall(func, &arg, 1);
-#endif
-        }
-    }
-    return __Pyx__PyObject_CallOneArg(func, arg);
-}
-#else
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
-    PyObject *result;
-    PyObject *args = PyTuple_Pack(1, arg);
-    if (unlikely(!args)) return NULL;
-    result = __Pyx_PyObject_Call(func, args, NULL);
-    Py_DECREF(args);
-    return result;
-}
-#endif
-
-/* RaiseTooManyValuesToUnpack */
-static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected) {
-    PyErr_Format(PyExc_ValueError,
-                 "too many values to unpack (expected %" CYTHON_FORMAT_SSIZE_T "d)", expected);
-}
-
-/* RaiseNeedMoreValuesToUnpack */
-static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
-    PyErr_Format(PyExc_ValueError,
-                 "need more than %" CYTHON_FORMAT_SSIZE_T "d value%.1s to unpack",
-                 index, (index == 1) ? "" : "s");
-}
-
-/* IterFinish */
-static CYTHON_INLINE int __Pyx_IterFinish(void) {
-#if CYTHON_FAST_THREAD_STATE
-    PyThreadState *tstate = __Pyx_PyThreadState_Current;
-    PyObject* exc_type = tstate->curexc_type;
-    if (unlikely(exc_type)) {
-        if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) {
-            PyObject *exc_value, *exc_tb;
-            exc_value = tstate->curexc_value;
-            exc_tb = tstate->curexc_traceback;
-            tstate->curexc_type = 0;
-            tstate->curexc_value = 0;
-            tstate->curexc_traceback = 0;
-            Py_DECREF(exc_type);
-            Py_XDECREF(exc_value);
-            Py_XDECREF(exc_tb);
-            return 0;
-        } else {
-            return -1;
-        }
-    }
-    return 0;
-#else
-    if (unlikely(PyErr_Occurred())) {
-        if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) {
-            PyErr_Clear();
-            return 0;
-        } else {
-            return -1;
-        }
-    }
-    return 0;
-#endif
-}
-
-/* UnpackItemEndCheck */
-static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
-    if (unlikely(retval)) {
-        Py_DECREF(retval);
-        __Pyx_RaiseTooManyValuesError(expected);
-        return -1;
-    }
-    return __Pyx_IterFinish();
-}
-
 /* BytesEquals */
 static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
 #if CYTHON_COMPILING_IN_PYPY
     return PyObject_RichCompareBool(s1, s2, equals);
 #else
     if (s1 == s2) {
         return (equals == Py_EQ);
@@ -22850,168 +20487,54 @@
     }
 #ifdef WITH_THREAD
     if (nogil)
         PyGILState_Release(state);
 #endif
 }
 
-/* GetTopmostException */
-#if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem *
-__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
+/* ArgTypeTest */
+static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact)
 {
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
-           exc_info->previous_item != NULL)
-    {
-        exc_info = exc_info->previous_item;
+    if (unlikely(!type)) {
+        PyErr_SetString(PyExc_SystemError, "Missing type object");
+        return 0;
     }
-    return exc_info;
-}
-#endif
-
-/* SaveResetException */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
-    *type = exc_info->exc_type;
-    *value = exc_info->exc_value;
-    *tb = exc_info->exc_traceback;
-    #else
-    *type = tstate->exc_type;
-    *value = tstate->exc_value;
-    *tb = tstate->exc_traceback;
-    #endif
-    Py_XINCREF(*type);
-    Py_XINCREF(*value);
-    Py_XINCREF(*tb);
-}
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    tmp_type = exc_info->exc_type;
-    tmp_value = exc_info->exc_value;
-    tmp_tb = exc_info->exc_traceback;
-    exc_info->exc_type = type;
-    exc_info->exc_value = value;
-    exc_info->exc_traceback = tb;
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = type;
-    tstate->exc_value = value;
-    tstate->exc_traceback = tb;
-    #endif
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-#endif
-
-/* PyErrExceptionMatches */
-#if CYTHON_FAST_THREAD_STATE
-static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
-    Py_ssize_t i, n;
-    n = PyTuple_GET_SIZE(tuple);
-#if PY_MAJOR_VERSION >= 3
-    for (i=0; i<n; i++) {
-        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
+    else if (exact) {
+        #if PY_MAJOR_VERSION == 2
+        if ((type == &PyBaseString_Type) && likely(__Pyx_PyBaseString_CheckExact(obj))) return 1;
+        #endif
     }
-#endif
-    for (i=0; i<n; i++) {
-        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
+    else {
+        if (likely(__Pyx_TypeCheck(obj, type))) return 1;
     }
+    PyErr_Format(PyExc_TypeError,
+        "Argument '%.200s' has incorrect type (expected %.200s, got %.200s)",
+        name, type->tp_name, Py_TYPE(obj)->tp_name);
     return 0;
 }
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
-    PyObject *exc_type = tstate->curexc_type;
-    if (exc_type == err) return 1;
-    if (unlikely(!exc_type)) return 0;
-    if (unlikely(PyTuple_Check(err)))
-        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
-    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
-}
-#endif
 
-/* GetException */
-#if CYTHON_FAST_THREAD_STATE
-static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
-#else
-static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
-#endif
-{
-    PyObject *local_type, *local_value, *local_tb;
-#if CYTHON_FAST_THREAD_STATE
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    local_type = tstate->curexc_type;
-    local_value = tstate->curexc_value;
-    local_tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
-#else
-    PyErr_Fetch(&local_type, &local_value, &local_tb);
-#endif
-    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
-#if CYTHON_FAST_THREAD_STATE
-    if (unlikely(tstate->curexc_type))
-#else
-    if (unlikely(PyErr_Occurred()))
-#endif
-        goto bad;
-    #if PY_MAJOR_VERSION >= 3
-    if (local_tb) {
-        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
-            goto bad;
-    }
-    #endif
-    Py_XINCREF(local_tb);
-    Py_XINCREF(local_type);
-    Py_XINCREF(local_value);
-    *type = local_type;
-    *value = local_value;
-    *tb = local_tb;
-#if CYTHON_FAST_THREAD_STATE
-    #if CYTHON_USE_EXC_INFO_STACK
-    {
-        _PyErr_StackItem *exc_info = tstate->exc_info;
-        tmp_type = exc_info->exc_type;
-        tmp_value = exc_info->exc_value;
-        tmp_tb = exc_info->exc_traceback;
-        exc_info->exc_type = local_type;
-        exc_info->exc_value = local_value;
-        exc_info->exc_traceback = local_tb;
+/* PyObjectCall */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
+    PyObject *result;
+    ternaryfunc call = Py_TYPE(func)->tp_call;
+    if (unlikely(!call))
+        return PyObject_Call(func, arg, kw);
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
+        return NULL;
+    result = (*call)(func, arg, kw);
+    Py_LeaveRecursiveCall();
+    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
+        PyErr_SetString(
+            PyExc_SystemError,
+            "NULL result without error in PyObject_Call");
     }
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = local_type;
-    tstate->exc_value = local_value;
-    tstate->exc_traceback = local_tb;
-    #endif
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-#else
-    PyErr_SetExcInfo(local_type, local_value, local_tb);
-#endif
-    return 0;
-bad:
-    *type = 0;
-    *value = 0;
-    *tb = 0;
-    Py_XDECREF(local_type);
-    Py_XDECREF(local_value);
-    Py_XDECREF(local_tb);
-    return -1;
+    return result;
 }
+#endif
 
 /* RaiseException */
 #if PY_MAJOR_VERSION < 3
 static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
                         CYTHON_UNUSED PyObject *cause) {
     __Pyx_PyThreadState_declare
     Py_XINCREF(type);
@@ -23164,34 +20687,244 @@
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
 
-/* ArgTypeTest */
-static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact)
-{
-    if (unlikely(!type)) {
-        PyErr_SetString(PyExc_SystemError, "Missing type object");
-        return 0;
+/* PyCFunctionFastCall */
+#if CYTHON_FAST_PYCCALL
+static CYTHON_INLINE PyObject * __Pyx_PyCFunction_FastCall(PyObject *func_obj, PyObject **args, Py_ssize_t nargs) {
+    PyCFunctionObject *func = (PyCFunctionObject*)func_obj;
+    PyCFunction meth = PyCFunction_GET_FUNCTION(func);
+    PyObject *self = PyCFunction_GET_SELF(func);
+    int flags = PyCFunction_GET_FLAGS(func);
+    assert(PyCFunction_Check(func));
+    assert(METH_FASTCALL == (flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)));
+    assert(nargs >= 0);
+    assert(nargs == 0 || args != NULL);
+    /* _PyCFunction_FastCallDict() must not be called with an exception set,
+       because it may clear it (directly or indirectly) and so the
+       caller loses its exception */
+    assert(!PyErr_Occurred());
+    if ((PY_VERSION_HEX < 0x030700A0) || unlikely(flags & METH_KEYWORDS)) {
+        return (*((__Pyx_PyCFunctionFastWithKeywords)(void*)meth)) (self, args, nargs, NULL);
+    } else {
+        return (*((__Pyx_PyCFunctionFast)(void*)meth)) (self, args, nargs);
     }
-    else if (exact) {
-        #if PY_MAJOR_VERSION == 2
-        if ((type == &PyBaseString_Type) && likely(__Pyx_PyBaseString_CheckExact(obj))) return 1;
-        #endif
+}
+#endif
+
+/* PyFunctionFastCall */
+#if CYTHON_FAST_PYCALL
+static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
+                                               PyObject *globals) {
+    PyFrameObject *f;
+    PyThreadState *tstate = __Pyx_PyThreadState_Current;
+    PyObject **fastlocals;
+    Py_ssize_t i;
+    PyObject *result;
+    assert(globals != NULL);
+    /* XXX Perhaps we should create a specialized
+       PyFrame_New() that doesn't take locals, but does
+       take builtins without sanity checking them.
+       */
+    assert(tstate != NULL);
+    f = PyFrame_New(tstate, co, globals, NULL);
+    if (f == NULL) {
+        return NULL;
+    }
+    fastlocals = __Pyx_PyFrame_GetLocalsplus(f);
+    for (i = 0; i < na; i++) {
+        Py_INCREF(*args);
+        fastlocals[i] = *args++;
+    }
+    result = PyEval_EvalFrameEx(f,0);
+    ++tstate->recursion_depth;
+    Py_DECREF(f);
+    --tstate->recursion_depth;
+    return result;
+}
+#if 1 || PY_VERSION_HEX < 0x030600B1
+static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs) {
+    PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
+    PyObject *globals = PyFunction_GET_GLOBALS(func);
+    PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
+    PyObject *closure;
+#if PY_MAJOR_VERSION >= 3
+    PyObject *kwdefs;
+#endif
+    PyObject *kwtuple, **k;
+    PyObject **d;
+    Py_ssize_t nd;
+    Py_ssize_t nk;
+    PyObject *result;
+    assert(kwargs == NULL || PyDict_Check(kwargs));
+    nk = kwargs ? PyDict_Size(kwargs) : 0;
+    if (Py_EnterRecursiveCall((char*)" while calling a Python object")) {
+        return NULL;
+    }
+    if (
+#if PY_MAJOR_VERSION >= 3
+            co->co_kwonlyargcount == 0 &&
+#endif
+            likely(kwargs == NULL || nk == 0) &&
+            co->co_flags == (CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE)) {
+        if (argdefs == NULL && co->co_argcount == nargs) {
+            result = __Pyx_PyFunction_FastCallNoKw(co, args, nargs, globals);
+            goto done;
+        }
+        else if (nargs == 0 && argdefs != NULL
+                 && co->co_argcount == Py_SIZE(argdefs)) {
+            /* function called with no arguments, but all parameters have
+               a default value: use default values as arguments .*/
+            args = &PyTuple_GET_ITEM(argdefs, 0);
+            result =__Pyx_PyFunction_FastCallNoKw(co, args, Py_SIZE(argdefs), globals);
+            goto done;
+        }
+    }
+    if (kwargs != NULL) {
+        Py_ssize_t pos, i;
+        kwtuple = PyTuple_New(2 * nk);
+        if (kwtuple == NULL) {
+            result = NULL;
+            goto done;
+        }
+        k = &PyTuple_GET_ITEM(kwtuple, 0);
+        pos = i = 0;
+        while (PyDict_Next(kwargs, &pos, &k[i], &k[i+1])) {
+            Py_INCREF(k[i]);
+            Py_INCREF(k[i+1]);
+            i += 2;
+        }
+        nk = i / 2;
     }
     else {
-        if (likely(__Pyx_TypeCheck(obj, type))) return 1;
+        kwtuple = NULL;
+        k = NULL;
     }
-    PyErr_Format(PyExc_TypeError,
-        "Argument '%.200s' has incorrect type (expected %.200s, got %.200s)",
-        name, type->tp_name, Py_TYPE(obj)->tp_name);
-    return 0;
+    closure = PyFunction_GET_CLOSURE(func);
+#if PY_MAJOR_VERSION >= 3
+    kwdefs = PyFunction_GET_KW_DEFAULTS(func);
+#endif
+    if (argdefs != NULL) {
+        d = &PyTuple_GET_ITEM(argdefs, 0);
+        nd = Py_SIZE(argdefs);
+    }
+    else {
+        d = NULL;
+        nd = 0;
+    }
+#if PY_MAJOR_VERSION >= 3
+    result = PyEval_EvalCodeEx((PyObject*)co, globals, (PyObject *)NULL,
+                               args, (int)nargs,
+                               k, (int)nk,
+                               d, (int)nd, kwdefs, closure);
+#else
+    result = PyEval_EvalCodeEx(co, globals, (PyObject *)NULL,
+                               args, (int)nargs,
+                               k, (int)nk,
+                               d, (int)nd, closure);
+#endif
+    Py_XDECREF(kwtuple);
+done:
+    Py_LeaveRecursiveCall();
+    return result;
+}
+#endif
+#endif
+
+/* PyObjectCall2Args */
+static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
+    PyObject *args, *result = NULL;
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(function)) {
+        PyObject *args[2] = {arg1, arg2};
+        return __Pyx_PyFunction_FastCall(function, args, 2);
+    }
+    #endif
+    #if CYTHON_FAST_PYCCALL
+    if (__Pyx_PyFastCFunction_Check(function)) {
+        PyObject *args[2] = {arg1, arg2};
+        return __Pyx_PyCFunction_FastCall(function, args, 2);
+    }
+    #endif
+    args = PyTuple_New(2);
+    if (unlikely(!args)) goto done;
+    Py_INCREF(arg1);
+    PyTuple_SET_ITEM(args, 0, arg1);
+    Py_INCREF(arg2);
+    PyTuple_SET_ITEM(args, 1, arg2);
+    Py_INCREF(function);
+    result = __Pyx_PyObject_Call(function, args, NULL);
+    Py_DECREF(args);
+    Py_DECREF(function);
+done:
+    return result;
+}
+
+/* PyObjectCallMethO */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
+    PyObject *self, *result;
+    PyCFunction cfunc;
+    cfunc = PyCFunction_GET_FUNCTION(func);
+    self = PyCFunction_GET_SELF(func);
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
+        return NULL;
+    result = cfunc(self, arg);
+    Py_LeaveRecursiveCall();
+    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
+        PyErr_SetString(
+            PyExc_SystemError,
+            "NULL result without error in PyObject_Call");
+    }
+    return result;
+}
+#endif
+
+/* PyObjectCallOneArg */
+#if CYTHON_COMPILING_IN_CPYTHON
+static PyObject* __Pyx__PyObject_CallOneArg(PyObject *func, PyObject *arg) {
+    PyObject *result;
+    PyObject *args = PyTuple_New(1);
+    if (unlikely(!args)) return NULL;
+    Py_INCREF(arg);
+    PyTuple_SET_ITEM(args, 0, arg);
+    result = __Pyx_PyObject_Call(func, args, NULL);
+    Py_DECREF(args);
+    return result;
+}
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
+#if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(func)) {
+        return __Pyx_PyFunction_FastCall(func, &arg, 1);
+    }
+#endif
+    if (likely(PyCFunction_Check(func))) {
+        if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
+            return __Pyx_PyObject_CallMethO(func, arg);
+#if CYTHON_FAST_PYCCALL
+        } else if (__Pyx_PyFastCFunction_Check(func)) {
+            return __Pyx_PyCFunction_FastCall(func, &arg, 1);
+#endif
+        }
+    }
+    return __Pyx__PyObject_CallOneArg(func, arg);
+}
+#else
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
+    PyObject *result;
+    PyObject *args = PyTuple_Pack(1, arg);
+    if (unlikely(!args)) return NULL;
+    result = __Pyx_PyObject_Call(func, args, NULL);
+    Py_DECREF(args);
+    return result;
 }
+#endif
 
 /* DivInt[Py_ssize_t] */
 static CYTHON_INLINE Py_ssize_t __Pyx_div_Py_ssize_t(Py_ssize_t a, Py_ssize_t b) {
     Py_ssize_t q = a / b;
     Py_ssize_t r = a - q*b;
     q -= ((r != 0) & ((r ^ b) < 0));
     return q;
@@ -23355,14 +21088,39 @@
     if (decode_func) {
         return decode_func(cstring, length, errors);
     } else {
         return PyUnicode_Decode(cstring, length, encoding, errors);
     }
 }
 
+/* PyErrExceptionMatches */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
+    Py_ssize_t i, n;
+    n = PyTuple_GET_SIZE(tuple);
+#if PY_MAJOR_VERSION >= 3
+    for (i=0; i<n; i++) {
+        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
+    }
+#endif
+    for (i=0; i<n; i++) {
+        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
+    }
+    return 0;
+}
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
+    PyObject *exc_type = tstate->curexc_type;
+    if (exc_type == err) return 1;
+    if (unlikely(!exc_type)) return 0;
+    if (unlikely(PyTuple_Check(err)))
+        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
+    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
+}
+#endif
+
 /* GetAttr3 */
 static PyObject *__Pyx_GetAttr3Default(PyObject *d) {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     if (unlikely(!__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
         return NULL;
     __Pyx_PyErr_Clear();
@@ -23370,14 +21128,88 @@
     return d;
 }
 static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *o, PyObject *n, PyObject *d) {
     PyObject *r = __Pyx_GetAttr(o, n);
     return (likely(r)) ? r : __Pyx_GetAttr3Default(d);
 }
 
+/* PyDictVersioning */
+#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
+}
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
+    PyObject **dictptr = NULL;
+    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
+    if (offset) {
+#if CYTHON_COMPILING_IN_CPYTHON
+        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
+#else
+        dictptr = _PyObject_GetDictPtr(obj);
+#endif
+    }
+    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
+}
+static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
+        return 0;
+    return obj_dict_version == __Pyx_get_object_dict_version(obj);
+}
+#endif
+
+/* GetModuleGlobalName */
+#if CYTHON_USE_DICT_VERSIONS
+static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
+#else
+static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
+#endif
+{
+    PyObject *result;
+#if !CYTHON_AVOID_BORROWED_REFS
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
+    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    } else if (unlikely(PyErr_Occurred())) {
+        return NULL;
+    }
+#else
+    result = PyDict_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    }
+#endif
+#else
+    result = PyObject_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    }
+    PyErr_Clear();
+#endif
+    return __Pyx_GetBuiltinName(name);
+}
+
+/* RaiseTooManyValuesToUnpack */
+static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected) {
+    PyErr_Format(PyExc_ValueError,
+                 "too many values to unpack (expected %" CYTHON_FORMAT_SSIZE_T "d)", expected);
+}
+
+/* RaiseNeedMoreValuesToUnpack */
+static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
+    PyErr_Format(PyExc_ValueError,
+                 "need more than %" CYTHON_FORMAT_SSIZE_T "d value%.1s to unpack",
+                 index, (index == 1) ? "" : "s");
+}
+
 /* RaiseNoneIterError */
 static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
 }
 
 /* ExtTypeTest */
 static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
@@ -23388,14 +21220,144 @@
     if (likely(__Pyx_TypeCheck(obj, type)))
         return 1;
     PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
                  Py_TYPE(obj)->tp_name, type->tp_name);
     return 0;
 }
 
+/* GetTopmostException */
+#if CYTHON_USE_EXC_INFO_STACK
+static _PyErr_StackItem *
+__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
+{
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
+           exc_info->previous_item != NULL)
+    {
+        exc_info = exc_info->previous_item;
+    }
+    return exc_info;
+}
+#endif
+
+/* SaveResetException */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+    #if CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
+    *type = exc_info->exc_type;
+    *value = exc_info->exc_value;
+    *tb = exc_info->exc_traceback;
+    #else
+    *type = tstate->exc_type;
+    *value = tstate->exc_value;
+    *tb = tstate->exc_traceback;
+    #endif
+    Py_XINCREF(*type);
+    Py_XINCREF(*value);
+    Py_XINCREF(*tb);
+}
+static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    #if CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    tmp_type = exc_info->exc_type;
+    tmp_value = exc_info->exc_value;
+    tmp_tb = exc_info->exc_traceback;
+    exc_info->exc_type = type;
+    exc_info->exc_value = value;
+    exc_info->exc_traceback = tb;
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = type;
+    tstate->exc_value = value;
+    tstate->exc_traceback = tb;
+    #endif
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+}
+#endif
+
+/* GetException */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
+#else
+static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
+#endif
+{
+    PyObject *local_type, *local_value, *local_tb;
+#if CYTHON_FAST_THREAD_STATE
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    local_type = tstate->curexc_type;
+    local_value = tstate->curexc_value;
+    local_tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+#else
+    PyErr_Fetch(&local_type, &local_value, &local_tb);
+#endif
+    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
+#if CYTHON_FAST_THREAD_STATE
+    if (unlikely(tstate->curexc_type))
+#else
+    if (unlikely(PyErr_Occurred()))
+#endif
+        goto bad;
+    #if PY_MAJOR_VERSION >= 3
+    if (local_tb) {
+        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
+            goto bad;
+    }
+    #endif
+    Py_XINCREF(local_tb);
+    Py_XINCREF(local_type);
+    Py_XINCREF(local_value);
+    *type = local_type;
+    *value = local_value;
+    *tb = local_tb;
+#if CYTHON_FAST_THREAD_STATE
+    #if CYTHON_USE_EXC_INFO_STACK
+    {
+        _PyErr_StackItem *exc_info = tstate->exc_info;
+        tmp_type = exc_info->exc_type;
+        tmp_value = exc_info->exc_value;
+        tmp_tb = exc_info->exc_traceback;
+        exc_info->exc_type = local_type;
+        exc_info->exc_value = local_value;
+        exc_info->exc_traceback = local_tb;
+    }
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = local_type;
+    tstate->exc_value = local_value;
+    tstate->exc_traceback = local_tb;
+    #endif
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+#else
+    PyErr_SetExcInfo(local_type, local_value, local_tb);
+#endif
+    return 0;
+bad:
+    *type = 0;
+    *value = 0;
+    *tb = 0;
+    Py_XDECREF(local_type);
+    Py_XDECREF(local_value);
+    Py_XDECREF(local_tb);
+    return -1;
+}
+
 /* SwapException */
 #if CYTHON_FAST_THREAD_STATE
 static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
     PyObject *tmp_type, *tmp_value, *tmp_tb;
     #if CYTHON_USE_EXC_INFO_STACK
     _PyErr_StackItem *exc_info = tstate->exc_info;
     tmp_type = exc_info->exc_type;
@@ -23951,93 +21913,14 @@
     Py_XDECREF(reduce_ex);
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
-/* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
-#define __PYX_HAVE_RT_ImportType
-static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size)
-{
-    PyObject *result = 0;
-    char warning[200];
-    Py_ssize_t basicsize;
-    Py_ssize_t itemsize;
-#ifdef Py_LIMITED_API
-    PyObject *py_basicsize;
-    PyObject *py_itemsize;
-#endif
-    result = PyObject_GetAttrString(module, class_name);
-    if (!result)
-        goto bad;
-    if (!PyType_Check(result)) {
-        PyErr_Format(PyExc_TypeError,
-            "%.200s.%.200s is not a type object",
-            module_name, class_name);
-        goto bad;
-    }
-#ifndef Py_LIMITED_API
-    basicsize = ((PyTypeObject *)result)->tp_basicsize;
-    itemsize = ((PyTypeObject *)result)->tp_itemsize;
-#else
-    py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
-    if (!py_basicsize)
-        goto bad;
-    basicsize = PyLong_AsSsize_t(py_basicsize);
-    Py_DECREF(py_basicsize);
-    py_basicsize = 0;
-    if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
-        goto bad;
-    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
-    if (!py_itemsize)
-        goto bad;
-    itemsize = PyLong_AsSsize_t(py_itemsize);
-    Py_DECREF(py_itemsize);
-    py_itemsize = 0;
-    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
-        goto bad;
-#endif
-    if (itemsize) {
-        if (size % alignment) {
-            alignment = size % alignment;
-        }
-        if (itemsize < (Py_ssize_t)alignment)
-            itemsize = (Py_ssize_t)alignment;
-    }
-    if ((size_t)(basicsize + itemsize) < size) {
-        PyErr_Format(PyExc_ValueError,
-            "%.200s.%.200s size changed, may indicate binary incompatibility. "
-            "Expected %zd from C header, got %zd from PyObject",
-            module_name, class_name, size, basicsize);
-        goto bad;
-    }
-    if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
-        PyErr_Format(PyExc_ValueError,
-            "%.200s.%.200s size changed, may indicate binary incompatibility. "
-            "Expected %zd from C header, got %zd from PyObject",
-            module_name, class_name, size, basicsize);
-        goto bad;
-    }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn && (size_t)basicsize > size) {
-        PyOS_snprintf(warning, sizeof(warning),
-            "%s.%s size changed, may indicate binary incompatibility. "
-            "Expected %zd from C header, got %zd from PyObject",
-            module_name, class_name, size, basicsize);
-        if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
-    }
-    return (PyTypeObject *)result;
-bad:
-    Py_XDECREF(result);
-    return NULL;
-}
-#endif
-
 /* CLineInTraceback */
 #ifndef CYTHON_CLINE_IN_TRACEBACK
 static int __Pyx_CLineForTraceback(CYTHON_UNUSED PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
@@ -25160,322 +23043,14 @@
     }
 
 /* MemviewDtypeToObject */
   static CYTHON_INLINE PyObject *__pyx_memview_get_int__const__(const char *itemp) {
     return (PyObject *) __Pyx_PyInt_From_int(*(int const  *) itemp);
 }
 
-/* Declarations */
-  #if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
-      return ::std::complex< float >(x, y);
-    }
-  #else
-    static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
-      return x + y*(__pyx_t_float_complex)_Complex_I;
-    }
-  #endif
-#else
-    static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
-      __pyx_t_float_complex z;
-      z.real = x;
-      z.imag = y;
-      return z;
-    }
-#endif
-
-/* Arithmetic */
-  #if CYTHON_CCOMPLEX
-#else
-    static CYTHON_INLINE int __Pyx_c_eq_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-       return (a.real == b.real) && (a.imag == b.imag);
-    }
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_sum_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-        __pyx_t_float_complex z;
-        z.real = a.real + b.real;
-        z.imag = a.imag + b.imag;
-        return z;
-    }
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_diff_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-        __pyx_t_float_complex z;
-        z.real = a.real - b.real;
-        z.imag = a.imag - b.imag;
-        return z;
-    }
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_prod_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-        __pyx_t_float_complex z;
-        z.real = a.real * b.real - a.imag * b.imag;
-        z.imag = a.real * b.imag + a.imag * b.real;
-        return z;
-    }
-    #if 1
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_quot_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-        if (b.imag == 0) {
-            return __pyx_t_float_complex_from_parts(a.real / b.real, a.imag / b.real);
-        } else if (fabsf(b.real) >= fabsf(b.imag)) {
-            if (b.real == 0 && b.imag == 0) {
-                return __pyx_t_float_complex_from_parts(a.real / b.real, a.imag / b.imag);
-            } else {
-                float r = b.imag / b.real;
-                float s = (float)(1.0) / (b.real + b.imag * r);
-                return __pyx_t_float_complex_from_parts(
-                    (a.real + a.imag * r) * s, (a.imag - a.real * r) * s);
-            }
-        } else {
-            float r = b.real / b.imag;
-            float s = (float)(1.0) / (b.imag + b.real * r);
-            return __pyx_t_float_complex_from_parts(
-                (a.real * r + a.imag) * s, (a.imag * r - a.real) * s);
-        }
-    }
-    #else
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_quot_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-        if (b.imag == 0) {
-            return __pyx_t_float_complex_from_parts(a.real / b.real, a.imag / b.real);
-        } else {
-            float denom = b.real * b.real + b.imag * b.imag;
-            return __pyx_t_float_complex_from_parts(
-                (a.real * b.real + a.imag * b.imag) / denom,
-                (a.imag * b.real - a.real * b.imag) / denom);
-        }
-    }
-    #endif
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_neg_float(__pyx_t_float_complex a) {
-        __pyx_t_float_complex z;
-        z.real = -a.real;
-        z.imag = -a.imag;
-        return z;
-    }
-    static CYTHON_INLINE int __Pyx_c_is_zero_float(__pyx_t_float_complex a) {
-       return (a.real == 0) && (a.imag == 0);
-    }
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_conj_float(__pyx_t_float_complex a) {
-        __pyx_t_float_complex z;
-        z.real =  a.real;
-        z.imag = -a.imag;
-        return z;
-    }
-    #if 1
-        static CYTHON_INLINE float __Pyx_c_abs_float(__pyx_t_float_complex z) {
-          #if !defined(HAVE_HYPOT) || defined(_MSC_VER)
-            return sqrtf(z.real*z.real + z.imag*z.imag);
-          #else
-            return hypotf(z.real, z.imag);
-          #endif
-        }
-        static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_pow_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-            __pyx_t_float_complex z;
-            float r, lnr, theta, z_r, z_theta;
-            if (b.imag == 0 && b.real == (int)b.real) {
-                if (b.real < 0) {
-                    float denom = a.real * a.real + a.imag * a.imag;
-                    a.real = a.real / denom;
-                    a.imag = -a.imag / denom;
-                    b.real = -b.real;
-                }
-                switch ((int)b.real) {
-                    case 0:
-                        z.real = 1;
-                        z.imag = 0;
-                        return z;
-                    case 1:
-                        return a;
-                    case 2:
-                        return __Pyx_c_prod_float(a, a);
-                    case 3:
-                        z = __Pyx_c_prod_float(a, a);
-                        return __Pyx_c_prod_float(z, a);
-                    case 4:
-                        z = __Pyx_c_prod_float(a, a);
-                        return __Pyx_c_prod_float(z, z);
-                }
-            }
-            if (a.imag == 0) {
-                if (a.real == 0) {
-                    return a;
-                } else if ((b.imag == 0) && (a.real >= 0)) {
-                    z.real = powf(a.real, b.real);
-                    z.imag = 0;
-                    return z;
-                } else if (a.real > 0) {
-                    r = a.real;
-                    theta = 0;
-                } else {
-                    r = -a.real;
-                    theta = atan2f(0.0, -1.0);
-                }
-            } else {
-                r = __Pyx_c_abs_float(a);
-                theta = atan2f(a.imag, a.real);
-            }
-            lnr = logf(r);
-            z_r = expf(lnr * b.real - theta * b.imag);
-            z_theta = theta * b.real + lnr * b.imag;
-            z.real = z_r * cosf(z_theta);
-            z.imag = z_r * sinf(z_theta);
-            return z;
-        }
-    #endif
-#endif
-
-/* Declarations */
-  #if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
-      return ::std::complex< double >(x, y);
-    }
-  #else
-    static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
-      return x + y*(__pyx_t_double_complex)_Complex_I;
-    }
-  #endif
-#else
-    static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
-      __pyx_t_double_complex z;
-      z.real = x;
-      z.imag = y;
-      return z;
-    }
-#endif
-
-/* Arithmetic */
-  #if CYTHON_CCOMPLEX
-#else
-    static CYTHON_INLINE int __Pyx_c_eq_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-       return (a.real == b.real) && (a.imag == b.imag);
-    }
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_sum_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-        __pyx_t_double_complex z;
-        z.real = a.real + b.real;
-        z.imag = a.imag + b.imag;
-        return z;
-    }
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_diff_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-        __pyx_t_double_complex z;
-        z.real = a.real - b.real;
-        z.imag = a.imag - b.imag;
-        return z;
-    }
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_prod_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-        __pyx_t_double_complex z;
-        z.real = a.real * b.real - a.imag * b.imag;
-        z.imag = a.real * b.imag + a.imag * b.real;
-        return z;
-    }
-    #if 1
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_quot_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-        if (b.imag == 0) {
-            return __pyx_t_double_complex_from_parts(a.real / b.real, a.imag / b.real);
-        } else if (fabs(b.real) >= fabs(b.imag)) {
-            if (b.real == 0 && b.imag == 0) {
-                return __pyx_t_double_complex_from_parts(a.real / b.real, a.imag / b.imag);
-            } else {
-                double r = b.imag / b.real;
-                double s = (double)(1.0) / (b.real + b.imag * r);
-                return __pyx_t_double_complex_from_parts(
-                    (a.real + a.imag * r) * s, (a.imag - a.real * r) * s);
-            }
-        } else {
-            double r = b.real / b.imag;
-            double s = (double)(1.0) / (b.imag + b.real * r);
-            return __pyx_t_double_complex_from_parts(
-                (a.real * r + a.imag) * s, (a.imag * r - a.real) * s);
-        }
-    }
-    #else
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_quot_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-        if (b.imag == 0) {
-            return __pyx_t_double_complex_from_parts(a.real / b.real, a.imag / b.real);
-        } else {
-            double denom = b.real * b.real + b.imag * b.imag;
-            return __pyx_t_double_complex_from_parts(
-                (a.real * b.real + a.imag * b.imag) / denom,
-                (a.imag * b.real - a.real * b.imag) / denom);
-        }
-    }
-    #endif
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_neg_double(__pyx_t_double_complex a) {
-        __pyx_t_double_complex z;
-        z.real = -a.real;
-        z.imag = -a.imag;
-        return z;
-    }
-    static CYTHON_INLINE int __Pyx_c_is_zero_double(__pyx_t_double_complex a) {
-       return (a.real == 0) && (a.imag == 0);
-    }
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_conj_double(__pyx_t_double_complex a) {
-        __pyx_t_double_complex z;
-        z.real =  a.real;
-        z.imag = -a.imag;
-        return z;
-    }
-    #if 1
-        static CYTHON_INLINE double __Pyx_c_abs_double(__pyx_t_double_complex z) {
-          #if !defined(HAVE_HYPOT) || defined(_MSC_VER)
-            return sqrt(z.real*z.real + z.imag*z.imag);
-          #else
-            return hypot(z.real, z.imag);
-          #endif
-        }
-        static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_pow_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-            __pyx_t_double_complex z;
-            double r, lnr, theta, z_r, z_theta;
-            if (b.imag == 0 && b.real == (int)b.real) {
-                if (b.real < 0) {
-                    double denom = a.real * a.real + a.imag * a.imag;
-                    a.real = a.real / denom;
-                    a.imag = -a.imag / denom;
-                    b.real = -b.real;
-                }
-                switch ((int)b.real) {
-                    case 0:
-                        z.real = 1;
-                        z.imag = 0;
-                        return z;
-                    case 1:
-                        return a;
-                    case 2:
-                        return __Pyx_c_prod_double(a, a);
-                    case 3:
-                        z = __Pyx_c_prod_double(a, a);
-                        return __Pyx_c_prod_double(z, a);
-                    case 4:
-                        z = __Pyx_c_prod_double(a, a);
-                        return __Pyx_c_prod_double(z, z);
-                }
-            }
-            if (a.imag == 0) {
-                if (a.real == 0) {
-                    return a;
-                } else if ((b.imag == 0) && (a.real >= 0)) {
-                    z.real = pow(a.real, b.real);
-                    z.imag = 0;
-                    return z;
-                } else if (a.real > 0) {
-                    r = a.real;
-                    theta = 0;
-                } else {
-                    r = -a.real;
-                    theta = atan2(0.0, -1.0);
-                }
-            } else {
-                r = __Pyx_c_abs_double(a);
-                theta = atan2(a.imag, a.real);
-            }
-            lnr = log(r);
-            z_r = exp(lnr * b.real - theta * b.imag);
-            z_theta = theta * b.real + lnr * b.imag;
-            z.real = z_r * cos(z_theta);
-            z.imag = z_r * sin(z_theta);
-            return z;
-        }
-    #endif
-#endif
-
 /* MemviewSliceCopyTemplate */
   static __Pyx_memviewslice
 __pyx_memoryview_copy_new_contig(const __Pyx_memviewslice *from_mvs,
                                  const char *mode, int ndim,
                                  size_t sizeof_dtype, int contig_flag,
                                  int dtype_is_object)
 {
```

### Comparing `LibRecommender-1.1.0/libreco/algorithms/_bpr.pyx` & `LibRecommender-1.1.1/libreco/algorithms/_bpr.pyx`

 * *Files 16% similar despite different names*

```diff
@@ -1,134 +1,136 @@
-import numpy as np
-cimport numpy as np
+# cython: language_level=3
 cimport cython
+
 from cython.parallel import parallel, prange
 from libc.math cimport exp as cexp, pow as cpow, sqrt as csqrt
 from libcpp cimport bool
 from libcpp.algorithm cimport binary_search
 from libcpp.vector cimport vector
 
-from ..utils.misc import shuffle_data
-
 
 cdef extern from "<random>" namespace "std" nogil:
     cdef cppclass mt19937:
         mt19937(unsigned int)
     
     cdef cppclass uniform_int_distribution[T]:
         uniform_int_distribution(T, T)
         T operator()(mt19937)
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
 @cython.cdivision(True)
-cdef bool check_consumed(const int[:] indices, const int[:] indptr, 
-                         int user, int item_neg) nogil:
-    return binary_search(&indices[indptr[user]], 
-                         &indices[indptr[user+1]], 
-                         item_neg)
+cdef bool check_consumed(const int[:] indices, const int[:] indptr,  int user, int item_neg) nogil:
+    return binary_search(&indices[indptr[user]], &indices[indptr[user+1]], item_neg)
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
 @cython.cdivision(True)
-cpdef bpr_update(optimizer, train_data, user_embed, item_embed, lr, reg, 
-                 n_users, n_items, shuffle, num_threads, seed, epoch, 
-                 u_velocity=None, i_velocity=None, momentum=0.9, 
-                 u_1st_mom=None, i_1st_mom=None, u_2nd_mom=None, 
-                 i_2nd_mom=None, rho1=0.9, rho2=0.999):
-
-    if train_data.has_sampled:
-        user_indices = train_data.user_indices_orig.astype(np.int32)
-        item_indices = train_data.item_indices_orig.astype(np.int32)
-    else:
-        user_indices = train_data.user_indices.astype(np.int32)
-        item_indices = train_data.item_indices.astype(np.int32)
-    
-    sparse_interaction = train_data.sparse_interaction
+cpdef bpr_update(
+    optimizer,
+    user_indices,
+    item_indices,
+    sparse_interaction,
+    user_embed,
+    item_embed,
+    lr,
+    reg,
+    n_users,
+    n_items,
+    num_threads,
+    seed,
+    epoch,
+    u_velocity=None,
+    i_velocity=None,
+    momentum=0.9,
+    u_1st_mom=None,
+    i_1st_mom=None,
+    u_2nd_mom=None,
+    i_2nd_mom=None,
+    rho1=0.9,
+    rho2=0.999,
+):
     sparse_indices = sparse_interaction.indices
     sparse_indptr = sparse_interaction.indptr
-
-    if not reg:
-        reg = 0.0
-
-    if shuffle:
-        user_indices, item_indices = shuffle_data(
-            len(user_indices), user_indices, item_indices)
-
     if optimizer == "sgd":
-        _bpr_update_sgd(user_indices,
-                        item_indices,
-                        sparse_indices,
-                        sparse_indptr,
-                        user_embed,
-                        item_embed,
-                        lr,
-                        reg,
-                        n_users,
-                        n_items,
-                        num_threads,
-                        seed)
-
+        _bpr_update_sgd(
+            user_indices,
+            item_indices,
+            sparse_indices,
+            sparse_indptr,
+            user_embed,
+            item_embed,
+            lr,
+            reg,
+            n_users,
+            n_items,
+            num_threads,
+            seed,
+        )
     elif optimizer == "momentum":
-        _bpr_update_momentum(user_indices,
-                             item_indices,
-                             sparse_indices,
-                             sparse_indptr,
-                             user_embed,
-                             item_embed,
-                             lr,
-                             reg,
-                             n_users,
-                             n_items,
-                             u_velocity, 
-                             i_velocity,  
-                             momentum, 
-                             num_threads,
-                             seed)
-
+        _bpr_update_momentum(
+            user_indices,
+            item_indices,
+            sparse_indices,
+            sparse_indptr,
+            user_embed,
+            item_embed,
+            lr,
+            reg,
+            n_users,
+            n_items,
+            u_velocity,
+            i_velocity,
+            momentum,
+            num_threads,
+            seed,
+        )
     elif optimizer == "adam":
-        _bpr_update_adam(user_indices,
-                         item_indices,
-                         sparse_indices,
-                         sparse_indptr,
-                         user_embed,
-                         item_embed,
-                         lr,
-                         reg,
-                         n_users,
-                         n_items,
-                         u_1st_mom, 
-                         i_1st_mom, 
-                         u_2nd_mom, 
-                         i_2nd_mom, 
-                         rho1, 
-                         rho2, 
-                         epoch, 
-                         num_threads,
-                         seed)
+        _bpr_update_adam(
+            user_indices,
+            item_indices,
+            sparse_indices,
+            sparse_indptr,
+            user_embed,
+            item_embed,
+            lr,
+            reg,
+            n_users,
+            n_items,
+            u_1st_mom,
+            i_1st_mom,
+            u_2nd_mom,
+            i_2nd_mom,
+            rho1,
+            rho2,
+            epoch,
+            num_threads,
+            seed,
+        )
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
 @cython.cdivision(True)
-cdef void _bpr_update_sgd(const int[:] user_indices, 
-                          const int[:] item_indices, 
-                          const int[:] sparse_indices, 
-                          const int[:] sparse_indptr, 
-                          float[:, ::1] user_embed, 
-                          float[:, ::1] item_embed, 
-                          double lr, 
-                          double reg, 
-                          int n_users, 
-                          int n_items, 
-                          int num_threads, 
-                          int seed):
-
+cdef void _bpr_update_sgd(
+    const int[:] user_indices,
+    const int[:] item_indices,
+    const int[:] sparse_indices,
+    const int[:] sparse_indptr,
+    float[:, ::1] user_embed,
+    float[:, ::1] item_embed,
+    double lr,
+    double reg,
+    int n_users,
+    int n_items,
+    int num_threads,
+    int seed,
+):
     cdef Py_ssize_t i, j, t, random_seed, user, item_pos, item_neg
     cdef int length = len(user_indices), embed_size = user_embed.shape[1] - 1
     cdef float item_diff, log_sigmoid_grad
     cdef float user_grad, item_pos_grad, item_neg_grad
     cdef long lower_bound = 0, upper_bound = n_items - 1
 
     cdef float *user_embed_ptr
@@ -137,79 +139,81 @@
     
     cdef vector[mt19937] rng
     cdef vector[uniform_int_distribution[long]] dist
 
     for i in range(num_threads):
         random_seed = (seed + i * 11) % 7
         rng.push_back(mt19937(random_seed))
-        dist.push_back(uniform_int_distribution[long](
-            lower_bound, upper_bound))
+        dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
 
     with nogil, parallel(num_threads=num_threads):
         for i in prange(length):
             t = i % num_threads
             user = user_indices[i]
             item_pos = item_indices[i]
             item_neg = dist[t](rng[t])
-            while check_consumed(sparse_indices, sparse_indptr, 
-                                 user, item_neg):
+            while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
                 item_neg = dist[t](rng[t])
 
             user_embed_ptr = &user_embed[user, 0]
             item_pos_embed_ptr = &item_embed[item_pos, 0]
             item_neg_embed_ptr = &item_embed[item_neg, 0]
 
             item_diff = 0
             for j in range(embed_size + 1):
                 item_diff = item_diff + user_embed_ptr[j] * (
-                    item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
+                    item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
+                )
             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))
 
             for j in range(embed_size):
                 user_grad = log_sigmoid_grad * (
                     item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
                 ) - reg * user_embed_ptr[j]
                 item_pos_grad = (
-                    log_sigmoid_grad * user_embed_ptr[j] 
+                    log_sigmoid_grad * user_embed_ptr[j]
                     - reg * item_pos_embed_ptr[j]
                 )
                 item_neg_grad = (
                     - log_sigmoid_grad * user_embed_ptr[j] 
                     - reg * item_neg_embed_ptr[j]
                 )
 
                 user_embed_ptr[j] += lr * user_grad
                 item_pos_embed_ptr[j] += lr * item_pos_grad
                 item_neg_embed_ptr[j] += lr * item_neg_grad
 
             item_pos_embed_ptr[embed_size] += lr * (
-                log_sigmoid_grad - reg * item_pos_embed_ptr[embed_size])
+                log_sigmoid_grad - reg * item_pos_embed_ptr[embed_size]
+            )
             item_neg_embed_ptr[embed_size] += lr * (
-                -log_sigmoid_grad - reg * item_neg_embed_ptr[embed_size])
+                -log_sigmoid_grad - reg * item_neg_embed_ptr[embed_size]
+            )
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
 @cython.cdivision(True)
-cdef void _bpr_update_momentum(const int[:] user_indices, 
-                               const int[:] item_indices, 
-                               const int[:] sparse_indices, 
-                               const int[:] sparse_indptr, 
-                               float[:, ::1] user_embed, 
-                               float[:, ::1] item_embed, 
-                               double lr, 
-                               double reg, 
-                               int n_users, 
-                               int n_items, 
-                               float[:, ::1] u_velocity, 
-                               float[:, ::1] i_velocity, 
-                               double momentum, 
-                               int num_threads, 
-                               int seed):
-
+cdef void _bpr_update_momentum(
+    const int[:] user_indices,
+    const int[:] item_indices,
+    const int[:] sparse_indices,
+    const int[:] sparse_indptr,
+    float[:, ::1] user_embed,
+    float[:, ::1] item_embed,
+    double lr,
+    double reg,
+    int n_users,
+    int n_items,
+    float[:, ::1] u_velocity,
+    float[:, ::1] i_velocity,
+    double momentum,
+    int num_threads,
+    int seed,
+):
     cdef Py_ssize_t i, j, t, random_seed, user, item_pos, item_neg
     cdef int length = len(user_indices), embed_size = user_embed.shape[1] - 1
     cdef float item_diff, log_sigmoid_grad
     cdef float user_grad, item_pos_grad, item_neg_grad
     cdef long lower_bound = 0, upper_bound = n_items - 1
 
     cdef float *user_embed_ptr
@@ -222,39 +226,38 @@
     
     cdef vector[mt19937] rng
     cdef vector[uniform_int_distribution[long]] dist
 
     for i in range(num_threads):
         random_seed = (seed + i * 11) % 7
         rng.push_back(mt19937(random_seed))
-        dist.push_back(uniform_int_distribution[long](
-            lower_bound, upper_bound))
+        dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
 
     with nogil, parallel(num_threads=num_threads):
         for i in prange(length):
             t = i % num_threads
             user = user_indices[i]
             item_pos = item_indices[i]
             item_neg = dist[t](rng[t])
-            while check_consumed(sparse_indices, sparse_indptr, 
-                                 user, item_neg):
+            while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
                 item_neg = dist[t](rng[t])
 
             user_embed_ptr = &user_embed[user, 0]
             item_pos_embed_ptr = &item_embed[item_pos, 0]
             item_neg_embed_ptr = &item_embed[item_neg, 0]
 
             user_embed_v_ptr = &u_velocity[user, 0]
             item_pos_embed_v_ptr = &i_velocity[item_pos, 0]
             item_neg_embed_v_ptr = &i_velocity[item_neg, 0]
 
             item_diff = 0
             for j in range(embed_size + 1):
                 item_diff = item_diff + user_embed_ptr[j] * (
-                    item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
+                    item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
+                )
             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))
 
             for j in range(embed_size + 1):
                 if j < embed_size:
                     user_grad = log_sigmoid_grad * (
                         item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
                     ) - reg * user_embed_ptr[j]
@@ -264,50 +267,47 @@
                 )
                 item_neg_grad = (
                     - log_sigmoid_grad * user_embed_ptr[j] 
                     - reg * item_neg_embed_ptr[j]
                 )
 
                 if j < embed_size:
-                    user_embed_v_ptr[j] = (
-                        momentum * user_embed_v_ptr[j] + lr * user_grad)
+                    user_embed_v_ptr[j] = (momentum * user_embed_v_ptr[j] + lr * user_grad)
                     user_embed_ptr[j] += user_embed_v_ptr[j]
 
-                item_pos_embed_v_ptr[j] = (
-                    momentum * item_pos_embed_v_ptr[j] + lr * item_pos_grad)
+                item_pos_embed_v_ptr[j] = (momentum * item_pos_embed_v_ptr[j] + lr * item_pos_grad)
                 item_pos_embed_ptr[j] += item_pos_embed_v_ptr[j]
-
-                item_neg_embed_v_ptr[j] = (
-                    momentum * item_neg_embed_v_ptr[j] + lr * item_neg_grad)
+                item_neg_embed_v_ptr[j] = (momentum * item_neg_embed_v_ptr[j] + lr * item_neg_grad)
                 item_neg_embed_ptr[j] += item_neg_embed_v_ptr[j]
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
 @cython.cdivision(True)
-cdef void _bpr_update_adam(const int[:] user_indices, 
-                           const int[:] item_indices, 
-                           const int[:] sparse_indices, 
-                           const int[:] sparse_indptr, 
-                           float[:, ::1] user_embed, 
-                           float[:, ::1] item_embed, 
-                           double lr, 
-                           double reg, 
-                           int n_users, 
-                           int n_items, 
-                           float[:, ::1] u_1st_mom, 
-                           float[:, ::1] i_1st_mom, 
-                           float[:, ::1] u_2nd_mom, 
-                           float[:, ::1] i_2nd_mom,  
-                           double rho1, 
-                           double rho2, 
-                           int epoch, 
-                           int num_threads, 
-                           int seed):
-
+cdef void _bpr_update_adam(
+    const int[:] user_indices,
+    const int[:] item_indices,
+    const int[:] sparse_indices,
+    const int[:] sparse_indptr,
+    float[:, ::1] user_embed,
+    float[:, ::1] item_embed,
+    double lr,
+    double reg,
+    int n_users,
+    int n_items,
+    float[:, ::1] u_1st_mom,
+    float[:, ::1] i_1st_mom,
+    float[:, ::1] u_2nd_mom,
+    float[:, ::1] i_2nd_mom,
+    double rho1,
+    double rho2,
+    int epoch,
+    int num_threads,
+    int seed,
+):
     cdef Py_ssize_t i, j, t, random_seed, user, item_pos, item_neg
     cdef int length = len(user_indices), embed_size = user_embed.shape[1] - 1
     cdef float item_diff, log_sigmoid_grad
     cdef float user_grad, item_pos_grad, item_neg_grad
     cdef float unbias_v_user, unbias_h_user
     cdef float unbias_v_pos_item, unbias_h_pos_item
     cdef float unbias_v_neg_item, unbias_h_neg_item
@@ -326,25 +326,23 @@
     
     cdef vector[mt19937] rng
     cdef vector[uniform_int_distribution[long]] dist
 
     for i in range(num_threads):
         random_seed = (seed + i * 11) % 7
         rng.push_back(mt19937(random_seed))
-        dist.push_back(uniform_int_distribution[long](
-            lower_bound, upper_bound))
+        dist.push_back(uniform_int_distribution[long](lower_bound, upper_bound))
 
     with nogil, parallel(num_threads=num_threads):
         for i in prange(length):
             t = i % num_threads
             user = user_indices[i]
             item_pos = item_indices[i]
             item_neg = dist[t](rng[t])
-            while check_consumed(sparse_indices, sparse_indptr, 
-                                 user, item_neg):
+            while check_consumed(sparse_indices, sparse_indptr, user, item_neg):
                 item_neg = dist[t](rng[t])
 
             user_embed_ptr = &user_embed[user, 0]
             item_pos_embed_ptr = &item_embed[item_pos, 0]
             item_neg_embed_ptr = &item_embed[item_neg, 0]
 
             user_embed_v_ptr = &u_1st_mom[user, 0]
@@ -353,15 +351,16 @@
             item_pos_embed_h_ptr = &i_2nd_mom[item_pos, 0]
             item_neg_embed_v_ptr = &i_1st_mom[item_neg, 0]
             item_neg_embed_h_ptr = &i_2nd_mom[item_neg, 0]
 
             item_diff = 0
             for j in range(embed_size + 1):
                 item_diff = item_diff + user_embed_ptr[j] * (
-                    item_pos_embed_ptr[j] - item_neg_embed_ptr[j])
+                    item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
+                )
             log_sigmoid_grad = 1.0 / (1.0 + cexp(item_diff))
 
             for j in range(embed_size + 1):
                 if j < embed_size:
                     user_grad = log_sigmoid_grad * (
                         item_pos_embed_ptr[j] - item_neg_embed_ptr[j]
                     ) - reg * user_embed_ptr[j]
@@ -371,40 +370,30 @@
                 )
                 item_neg_grad = (
                     - log_sigmoid_grad * user_embed_ptr[j] 
                     - reg * item_neg_embed_ptr[j]
                 )
 
                 if j < embed_size:
-                    user_embed_v_ptr[j] = rho1 * user_embed_v_ptr[j] + (
-                        1.0 - rho1) * user_grad
-                    user_embed_h_ptr[j] = rho2 * user_embed_h_ptr[j] + (
-                        1.0 - rho2) * cpow(user_grad, 2)
-                    unbias_v_user = user_embed_v_ptr[j] / (
-                        1.0 - cpow(rho1, epoch))
-                    unbias_h_user = user_embed_h_ptr[j] / (
-                        1.0 - cpow(rho2, epoch))
+                    user_embed_v_ptr[j] = rho1 * user_embed_v_ptr[j] + (1.0 - rho1) * user_grad
+                    user_embed_h_ptr[j] = rho2 * user_embed_h_ptr[j] + (1.0 - rho2) * cpow(user_grad, 2)
+                    unbias_v_user = user_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+                    unbias_h_user = user_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
                     user_embed_ptr[j] = user_embed_ptr[j] + (
-                        lr * unbias_v_user / (csqrt(unbias_h_user) + 1e-8))
+                        lr * unbias_v_user / (csqrt(unbias_h_user) + 1e-8)
+                    )
 
-                item_pos_embed_v_ptr[j] = rho1 * item_pos_embed_v_ptr[j] + (
-                    1.0 - rho1) * item_pos_grad
-                item_pos_embed_h_ptr[j] = rho2 * item_pos_embed_h_ptr[j] + (
-                    1.0 - rho2) * cpow(item_pos_grad, 2)
-                unbias_v_pos_item = item_pos_embed_v_ptr[j] / (
-                    1.0 - cpow(rho1, epoch))
-                unbias_h_pos_item = item_pos_embed_h_ptr[j] / (
-                    1.0 - cpow(rho2, epoch))
+                item_pos_embed_v_ptr[j] = rho1 * item_pos_embed_v_ptr[j] + (1.0 - rho1) * item_pos_grad
+                item_pos_embed_h_ptr[j] = rho2 * item_pos_embed_h_ptr[j] + (1.0 - rho2) * cpow(item_pos_grad, 2)
+                unbias_v_pos_item = item_pos_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+                unbias_h_pos_item = item_pos_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
                 item_pos_embed_ptr[j] = item_pos_embed_ptr[j] + (
-                    lr * unbias_v_pos_item / (csqrt(unbias_h_pos_item) + 1e-8))
+                    lr * unbias_v_pos_item / (csqrt(unbias_h_pos_item) + 1e-8)
+                )
 
-                item_neg_embed_v_ptr[j] = rho1 * item_neg_embed_v_ptr[j] + (
-                    1.0 - rho1) * item_neg_grad
-                item_neg_embed_h_ptr[j] = rho2 * item_neg_embed_h_ptr[j] + (
-                    1.0 - rho2) * cpow(item_neg_grad, 2)
-                unbias_v_neg_item = item_neg_embed_v_ptr[j] / (
-                    1.0 - cpow(rho1, epoch))
-                unbias_h_neg_item = item_neg_embed_h_ptr[j] / (
-                    1.0 - cpow(rho2, epoch))
+                item_neg_embed_v_ptr[j] = rho1 * item_neg_embed_v_ptr[j] + (1.0 - rho1) * item_neg_grad
+                item_neg_embed_h_ptr[j] = rho2 * item_neg_embed_h_ptr[j] + (1.0 - rho2) * cpow(item_neg_grad, 2)
+                unbias_v_neg_item = item_neg_embed_v_ptr[j] / (1.0 - cpow(rho1, epoch))
+                unbias_h_neg_item = item_neg_embed_h_ptr[j] / (1.0 - cpow(rho2, epoch))
                 item_neg_embed_ptr[j] = item_neg_embed_ptr[j] + (
-                    lr * unbias_v_neg_item / (csqrt(unbias_h_neg_item) + 1e-8))
-
+                    lr * unbias_v_neg_item / (csqrt(unbias_h_neg_item) + 1e-8)
+                )
```

### Comparing `LibRecommender-1.1.0/libreco/algorithms/als.py` & `LibRecommender-1.1.1/libreco/algorithms/als.py`

 * *Files 2% similar despite different names*

```diff
@@ -78,20 +78,20 @@
         self.reg = self._check_reg(reg)
         self.alpha = alpha
         self.use_cg = use_cg
         self.n_threads = n_threads
         self.seed = seed
 
     def build_model(self):
-        np.random.seed(self.seed)
+        np_rng = np.random.default_rng(self.seed)
         self.user_embed = truncated_normal(
-            shape=[self.n_users, self.embed_size], mean=0.0, scale=0.03
+            np_rng, shape=[self.n_users, self.embed_size], mean=0.0, scale=0.03
         )
         self.item_embed = truncated_normal(
-            shape=[self.n_items, self.embed_size], mean=0.0, scale=0.03
+            np_rng, shape=[self.n_items, self.embed_size], mean=0.0, scale=0.03
         )
 
     def fit(
         self,
         train_data,
         neg_sampling,
         verbose=1,
```

### Comparing `LibRecommender-1.1.0/libreco/algorithms/autoint.py` & `LibRecommender-1.1.1/libreco/algorithms/autoint.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/bpr.py` & `LibRecommender-1.1.1/libreco/algorithms/bpr.py`

 * *Files 3% similar despite different names*

```diff
@@ -6,15 +6,15 @@
 
 from ..bases import EmbedBase, ModelMeta
 from ..evaluation import print_metrics
 from ..recommendation import recommend_from_embedding
 from ..tfops import reg_config, sess_config, tf
 from ..training.dispatch import get_trainer
 from ..utils.initializers import truncated_normal
-from ..utils.misc import time_block
+from ..utils.misc import shuffle_data, time_block
 from ..utils.validate import check_fitting
 
 LOG_FORMAT = "%(asctime)s - %(levelname)s - %(message)s"
 logging.basicConfig(format=LOG_FORMAT)
 
 
 class BPR(EmbedBase, metaclass=ModelMeta, backend="tensorflow"):
@@ -132,22 +132,28 @@
     def build_model(self):
         if self.use_tf:
             self._build_model_tf()
         else:
             self._build_model_cython()
 
     def _build_model_cython(self):
-        np.random.seed(self.seed)
+        np_rng = np.random.default_rng(self.seed)
         # last dimension is item bias, so for user all set to 1.0
         self.user_embed = truncated_normal(
-            shape=(self.n_users, self.embed_size + 1), mean=0.0, scale=0.03
+            np_rng,
+            shape=(self.n_users, self.embed_size + 1),
+            mean=0.0,
+            scale=0.03,
         )
         self.user_embed[:, self.embed_size] = 1.0
         self.item_embed = truncated_normal(
-            shape=(self.n_items, self.embed_size + 1), mean=0.0, scale=0.03
+            np_rng,
+            shape=(self.n_items, self.embed_size + 1),
+            mean=0.0,
+            scale=0.03,
         )
         self.item_embed[:, self.embed_size] = 0.0
 
     def _build_model_tf(self):
         self.user_indices = tf.placeholder(tf.int32, shape=[None])
         self.item_indices_pos = tf.placeholder(tf.int32, shape=[None])
         self.item_indices_neg = tf.placeholder(tf.int32, shape=[None])
@@ -295,61 +301,61 @@
             from ._bpr import bpr_update
         except (ImportError, ModuleNotFoundError):
             logging.warning("BPR cython version is not available")
             raise
 
         if self.optimizer == "sgd":
             trainer = partial(bpr_update)
-
         elif self.optimizer == "momentum":
             user_velocity = np.zeros_like(self.user_embed, dtype=np.float32)
             item_velocity = np.zeros_like(self.item_embed, dtype=np.float32)
             momentum = 0.9
             trainer = partial(
                 bpr_update,
                 u_velocity=user_velocity,
                 i_velocity=item_velocity,
                 momentum=momentum,
             )
-
         elif self.optimizer == "adam":
-            # refer to the `Deep Learning` book,
-            # which is called first and second moment
+            # Refer to the `Deep Learning` book, which is called first and second moment
             user_1st_moment = np.zeros_like(self.user_embed, dtype=np.float32)
             item_1st_moment = np.zeros_like(self.item_embed, dtype=np.float32)
             user_2nd_moment = np.zeros_like(self.user_embed, dtype=np.float32)
             item_2nd_moment = np.zeros_like(self.item_embed, dtype=np.float32)
-            rho1, rho2 = 0.9, 0.999
             trainer = partial(
                 bpr_update,
                 u_1st_mom=user_1st_moment,
                 i_1st_mom=item_1st_moment,
                 u_2nd_mom=user_2nd_moment,
                 i_2nd_mom=item_2nd_moment,
-                rho1=rho1,
-                rho2=rho2,
             )
-
         else:
             raise ValueError(
-                "optimizer must be one of these: ('sgd', 'momentum', 'adam')"
+                "optimizer must be one of these: (`sgd`, `momentum`, `adam`)"
             )
 
         for epoch in range(1, self.n_epochs + 1):
+            user_indices = train_data.user_indices.astype(np.int32)
+            item_indices = train_data.item_indices.astype(np.int32)
+            if shuffle:
+                user_indices, item_indices = shuffle_data(
+                    self.data_info.np_rng, len(user_indices), user_indices, item_indices
+                )
             with time_block(f"Epoch {epoch}", verbose):
                 trainer(
                     optimizer=self.optimizer,
-                    train_data=train_data,
+                    user_indices=user_indices,
+                    item_indices=item_indices,
+                    sparse_interaction=train_data.sparse_interaction,
                     user_embed=self.user_embed,
                     item_embed=self.item_embed,
                     lr=self.lr,
-                    reg=self.reg,
+                    reg=self.reg or 0.0,
                     n_users=self.n_users,
                     n_items=self.n_items,
-                    shuffle=shuffle,
                     num_threads=self.num_threads,
                     seed=self.seed,
                     epoch=epoch,
                 )
 
             if verbose > 1:
                 print_metrics(
```

### Comparing `LibRecommender-1.1.0/libreco/algorithms/caser.py` & `LibRecommender-1.1.1/libreco/algorithms/caser.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/deepfm.py` & `LibRecommender-1.1.1/libreco/algorithms/deepfm.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/deepwalk.py` & `LibRecommender-1.1.1/libreco/algorithms/deepwalk.py`

 * *Files 4% similar despite different names*

```diff
@@ -81,15 +81,17 @@
         for items in self.user_consumed.values():
             for i in range(len(items) - 1):
                 graph[items[i]].append(items[i + 1])
         return graph
 
     def get_data(self):
         graph = self._build_graph()
-        return _ItemCorpus(graph, self.n_items, self.n_walks, self.walk_length)
+        return _ItemCorpus(
+            graph, self.n_items, self.n_walks, self.walk_length, self.seed
+        )
 
     def build_model(self):
         model = Word2Vec(
             vector_size=self.embed_size,
             window=self.window_size,
             sg=1,
             hs=1,
@@ -99,24 +101,25 @@
             sorted_vocab=0,
         )
         model.build_vocab(self.data, update=False)
         return model
 
 
 class _ItemCorpus:
-    def __init__(self, graph, n_items, n_walks, walk_length):
+    def __init__(self, graph, n_items, n_walks, walk_length, seed):
         self.graph = graph
         self.n_items = n_items
         self.n_walks = n_walks
         self.walk_length = walk_length
+        self.np_rng = np.random.default_rng(seed)
         self.i = 0
 
     def __iter__(self):
         for _ in tqdm(range(self.n_walks), desc=f"DeepWalk iter {self.i}"):
-            for node in np.random.permutation(self.n_items):
+            for node in self.np_rng.permutation(self.n_items):
                 walk = [node]
                 while len(walk) < self.walk_length:
                     neighbors = self.graph[walk[-1]]
                     if len(neighbors) > 0:
                         walk.append(random.choice(neighbors))
                     else:
                         break
```

### Comparing `LibRecommender-1.1.0/libreco/algorithms/din.py` & `LibRecommender-1.1.1/libreco/algorithms/din.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/fm.py` & `LibRecommender-1.1.1/libreco/algorithms/fm.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/graphsage.py` & `LibRecommender-1.1.1/libreco/algorithms/graphsage.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/graphsage_dgl.py` & `LibRecommender-1.1.1/libreco/algorithms/graphsage_dgl.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/item2vec.py` & `LibRecommender-1.1.1/libreco/algorithms/item2vec.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/item_cf.py` & `LibRecommender-1.1.1/libreco/algorithms/item_cf.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/lightgcn.py` & `LibRecommender-1.1.1/libreco/algorithms/lightgcn.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/ncf.py` & `LibRecommender-1.1.1/libreco/algorithms/ncf.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/ngcf.py` & `LibRecommender-1.1.1/libreco/algorithms/ngcf.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/pinsage.py` & `LibRecommender-1.1.1/libreco/algorithms/pinsage.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/pinsage_dgl.py` & `LibRecommender-1.1.1/libreco/algorithms/pinsage_dgl.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/rnn4rec.py` & `LibRecommender-1.1.1/libreco/algorithms/rnn4rec.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/svd.py` & `LibRecommender-1.1.1/libreco/algorithms/svd.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/svdpp.py` & `LibRecommender-1.1.1/libreco/algorithms/svdpp.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/torch_modules/graphsage_module.py` & `LibRecommender-1.1.1/libreco/algorithms/torch_modules/graphsage_module.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/torch_modules/lightgcn_module.py` & `LibRecommender-1.1.1/libreco/algorithms/torch_modules/lightgcn_module.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/torch_modules/ngcf_module.py` & `LibRecommender-1.1.1/libreco/algorithms/torch_modules/ngcf_module.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/torch_modules/pinsage_module.py` & `LibRecommender-1.1.1/libreco/algorithms/torch_modules/pinsage_module.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/user_cf.py` & `LibRecommender-1.1.1/libreco/algorithms/user_cf.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/wave_net.py` & `LibRecommender-1.1.1/libreco/algorithms/wave_net.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/wide_deep.py` & `LibRecommender-1.1.1/libreco/algorithms/wide_deep.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/youtube_ranking.py` & `LibRecommender-1.1.1/libreco/algorithms/youtube_ranking.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/algorithms/youtube_retrieval.py` & `LibRecommender-1.1.1/libreco/algorithms/youtube_retrieval.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,22 +1,25 @@
 """Implementation of YouTubeRetrieval."""
+import os
+
 import numpy as np
 
 from ..bases import EmbedBase, ModelMeta
 from ..feature.multi_sparse import true_sparse_field_size
 from ..tfops import (
     dense_nn,
     dropout_config,
     multi_sparse_combine_embedding,
     reg_config,
     sess_config,
     tf,
 )
 from ..torchops import hidden_units_config
 from ..utils.misc import count_params
+from ..utils.save_load import load_tf_variables
 from ..utils.validate import (
     check_dense_values,
     check_multi_sparse,
     check_seq_mode,
     check_sparse_indices,
     dense_field_size,
     sparse_feat_size,
@@ -127,28 +130,28 @@
     ):
         super().__init__(task, data_info, embed_size, lower_upper_bound)
 
         assert task == "ranking", "YouTube-type models is only suitable for ranking"
         if len(data_info.item_col) > 0:
             raise ValueError("The `YouTuBeRetrieval` model assumes no item features.")
         self.all_args = locals()
+        self.sess = sess_config(tf_sess_config)
         self.loss_type = loss_type
         self.n_epochs = n_epochs
         self.lr = lr
         self.lr_decay = lr_decay
         self.epsilon = epsilon
         self.hidden_units = [*hidden_units_config(hidden_units), self.embed_size]
         self.reg = reg_config(reg)
         self.batch_size = batch_size
         self.use_bn = use_bn
         self.dropout_rate = dropout_config(dropout_rate)
         self.num_sampled_per_batch = num_sampled_per_batch
         self.sampler = sampler
         self.seed = seed
-        self.sess = sess_config(tf_sess_config)
         self.seq_mode, self.max_seq_len = check_seq_mode(recent_num, random_num)
         self.recent_seq_indices, self.recent_seq_values = self._set_recent_seqs()
         self.sparse = check_sparse_indices(data_info)
         self.dense = check_dense_values(data_info)
         if self.sparse:
             self.sparse_feature_size = sparse_feat_size(data_info)
             self.sparse_field_size = sparse_field_size(data_info)
@@ -172,26 +175,26 @@
         self._build_variables()
         if self.sparse:
             self._build_sparse()
         if self.dense:
             self._build_dense()
 
         concat_features = tf.concat(self.concat_embed, axis=1)
-        self.user_vector_repr = dense_nn(
+        self.user_vector = dense_nn(
             concat_features,
             self.hidden_units,
             use_bn=self.use_bn,
             dropout_rate=self.dropout_rate,
             is_training=self.is_training,
         )
         count_params()
 
     def _build_item_interaction(self):
         self.item_interaction_indices = tf.placeholder(tf.int64, shape=[None, 2])
-        self.item_interaction_values = tf.placeholder(tf.int32, shape=[None])
+        self.item_interaction_values = tf.placeholder(tf.int64, shape=[None])
         # `batch_size` may change during training, especially first item in sequence
         self.modified_batch_size = tf.placeholder(tf.int32, shape=[])
 
         item_interaction_features = tf.get_variable(
             name="item_interaction_features",
             shape=[self.n_items, self.embed_size],
             initializer=tf.glorot_uniform_initializer(),
@@ -295,32 +298,49 @@
                 interacted_indices.extend([u] * self.max_seq_len)
                 interacted_items.extend(u_consumed_items[-self.max_seq_len:])
 
         interacted_indices = np.array(interacted_indices).reshape(-1, 1)
         indices = np.concatenate(
             [interacted_indices, np.zeros_like(interacted_indices)], axis=1
         )
-        return indices, interacted_items
+        return indices, np.array(interacted_items, dtype=np.int64)
 
     def set_embeddings(self):
         feed_dict = {
             self.item_interaction_indices: self.recent_seq_indices,
             self.item_interaction_values: self.recent_seq_values,
             self.modified_batch_size: self.n_users,
             self.is_training: False,
         }
         if self.sparse:
-            # remove oov
             user_sparse_indices = self.data_info.user_sparse_unique[:-1]
             feed_dict.update({self.sparse_indices: user_sparse_indices})
         if self.dense:
             user_dense_values = self.data_info.user_dense_unique[:-1]
             feed_dict.update({self.dense_values: user_dense_values})
 
-        user_vector = self.sess.run(self.user_vector_repr, feed_dict)
+        user_vector = self.sess.run(self.user_vector, feed_dict)
         item_weights = self.sess.run(self.nce_weights)
         item_biases = self.sess.run(self.nce_biases)
 
         user_bias = np.ones([len(user_vector), 1], dtype=user_vector.dtype)
         item_bias = item_biases[:, None]
         self.user_embed = np.hstack([user_vector, user_bias])
         self.item_embed = np.hstack([item_weights, item_bias])
+
+    def save(self, path, model_name, inference_only=False, **_):
+        super().save(path, model_name, inference_only=False)
+        if inference_only:
+            embed_path = os.path.join(path, model_name)
+            np.savez_compressed(
+                file=embed_path,
+                user_embed=self.user_embed,
+                item_embed=self.item_embed,
+            )
+
+    @classmethod
+    def load(cls, path, model_name, data_info, **kwargs):
+        model = load_tf_variables(cls, path, model_name, data_info)
+        embeddings = np.load(os.path.join(path, f"{model_name}.npz"))
+        model.user_embed = embeddings["user_embed"]
+        model.item_embed = embeddings["item_embed"]
+        return model
```

### Comparing `LibRecommender-1.1.0/libreco/bases/base.py` & `LibRecommender-1.1.1/libreco/bases/base.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/bases/cf_base.py` & `LibRecommender-1.1.1/libreco/bases/cf_base.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/bases/embed_base.py` & `LibRecommender-1.1.1/libreco/bases/embed_base.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/bases/gensim_base.py` & `LibRecommender-1.1.1/libreco/bases/gensim_base.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/bases/meta.py` & `LibRecommender-1.1.1/libreco/bases/meta.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/bases/sage_base.py` & `LibRecommender-1.1.1/libreco/bases/sage_base.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/bases/seq_base.py` & `LibRecommender-1.1.1/libreco/bases/seq_base.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/bases/tf_base.py` & `LibRecommender-1.1.1/libreco/bases/tf_base.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/batch/batch_data.py` & `LibRecommender-1.1.1/libreco/batch/batch_data.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/batch/batch_unit.py` & `LibRecommender-1.1.1/libreco/batch/batch_unit.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/batch/collators.py` & `LibRecommender-1.1.1/libreco/batch/collators.py`

 * *Files 0% similar despite different names*

```diff
@@ -176,20 +176,23 @@
             seqs=seq_batch,
             items=batch["item"],
             sparse_indices=sparse_batch,
             dense_values=dense_batch,
         )
 
     def get_seqs(self, user_indices, item_indices):
+        if self.seq_mode == "random":
+            self._set_random_seeds()
         batch_indices, batch_values, batch_size = get_sparse_interacted(
             user_indices,
             item_indices,
             self.user_consumed,
             self.seq_mode,
             self.max_seq_len,
+            self.np_rng,
         )
         return SparseSeqFeats(batch_indices, batch_values, batch_size)
 
 
 class PointwiseCollator(BaseCollator):
     def __init__(self, model, data_info, backend):
         super().__init__(model, data_info, backend)
```

### Comparing `LibRecommender-1.1.0/libreco/batch/sequence.py` & `LibRecommender-1.1.1/libreco/batch/sequence.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,15 +1,13 @@
 import random
 
 import numpy as np
 
 
-def get_sparse_interacted(
-    user_indices, item_indices, user_consumed, mode=None, num=None
-):
+def get_sparse_interacted(user_indices, item_indices, user_consumed, mode, num, np_rng):
     interacted_indices = []
     interacted_items = []
     for j, (u, i) in enumerate(zip(user_indices, item_indices)):
         consumed_items = user_consumed[u]
         position = consumed_items.index(i)
         if position == 0:  # first item, no history interaction
             continue
@@ -18,15 +16,15 @@
             interacted_items.extend(consumed_items[:position])
         elif position >= num and mode == "recent":
             start_index = position - num
             interacted_indices.extend([j] * num)
             interacted_items.extend(consumed_items[start_index:position])
         elif position >= num and mode == "random":
             interacted_indices.extend([j] * num)
-            chosen_items = np.random.choice(consumed_items, num, replace=False)
+            chosen_items = np_rng.choice(consumed_items, num, replace=False)
             interacted_items.extend(chosen_items.tolist())
 
     interacted_indices = np.asarray(interacted_indices).reshape(-1, 1)
     indices = np.concatenate(
         [interacted_indices, np.zeros_like(interacted_indices)], axis=1
     )
     return indices, np.array(interacted_items), len(user_indices)
```

### Comparing `LibRecommender-1.1.0/libreco/batch/tf_feed_dicts.py` & `LibRecommender-1.1.1/libreco/batch/tf_feed_dicts.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/data/__init__.py` & `LibRecommender-1.1.1/libreco/data/__init__.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/data/consumed.py` & `LibRecommender-1.1.1/libreco/data/consumed.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/data/data_info.py` & `LibRecommender-1.1.1/libreco/data/data_info.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/data/dataset.py` & `LibRecommender-1.1.1/libreco/data/dataset.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/data/processing.py` & `LibRecommender-1.1.1/libreco/data/processing.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/data/split.py` & `LibRecommender-1.1.1/libreco/data/split.py`

 * *Files 4% similar despite different names*

```diff
@@ -171,15 +171,14 @@
     ValueError
         If neither `test_size` nor `multi_ratio` is provided.
 
     See Also
     --------
     split_by_ratio_chrono
     """
-    np.random.seed(seed)
     assert "user" in data.columns, "data must contains user column"
     ratios, n_splits = _check_and_convert_ratio(test_size, multi_ratios)
 
     n_users = data.user.nunique()
     user_indices = data.user.to_numpy()
     user_split_indices = _groupby_user(user_indices, order)
 
@@ -194,16 +193,17 @@
             u_split_data = np.split(
                 u_data, [round(cum * u_data_len) for cum in cum_ratios]
             )
             for i in range(n_splits):
                 split_indices_all[i].extend(list(u_split_data[i]))
 
     if shuffle:
+        np_rng = np.random.default_rng(seed)
         split_data_all = tuple(
-            data.iloc[np.random.permutation(idx)] for idx in split_indices_all
+            data.iloc[np_rng.permutation(idx)] for idx in split_indices_all
         )
     else:
         split_data_all = list(data.iloc[idx] for idx in split_indices_all)
 
     if filter_unknown:
         split_data_all = _filter_unknown_user_item(split_data_all)
     elif pad_unknown and pad_val is not None:
@@ -258,15 +258,14 @@
     ValueError
         If neither `test_size` nor `multi_ratio` is provided.
 
     See Also
     --------
     split_by_num_chrono
     """
-    np.random.seed(seed)
     assert "user" in data.columns, "data must contains user column"
     assert isinstance(test_size, int), "test_size must be int value"
     assert 0 < test_size < len(data), "test_size must be in (0, len(data))"
 
     n_users = data.user.nunique()
     user_indices = data.user.to_numpy()
     user_split_indices = _groupby_user(user_indices, order)
@@ -283,16 +282,17 @@
             test_indices.extend(u_data[-1:])
         else:
             k = test_size
             train_indices.extend(u_data[: (u_data_len - k)])
             test_indices.extend(u_data[-k:])
 
     if shuffle:
-        train_indices = np.random.permutation(train_indices)
-        test_indices = np.random.permutation(test_indices)
+        np_rng = np.random.default_rng(seed)
+        train_indices = np_rng.permutation(train_indices)
+        test_indices = np_rng.permutation(test_indices)
 
     split_data_all = (data.iloc[train_indices], data.iloc[test_indices])
     if filter_unknown:
         split_data_all = _filter_unknown_user_item(split_data_all)
     elif pad_unknown and pad_val is not None:
         split_data_all = _pad_unknown_user_item(split_data_all, pad_val)
     return split_data_all
```

### Comparing `LibRecommender-1.1.0/libreco/data/transformed.py` & `LibRecommender-1.1.1/libreco/data/transformed.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/evaluation/computation.py` & `LibRecommender-1.1.1/libreco/evaluation/computation.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/evaluation/evaluate.py` & `LibRecommender-1.1.1/libreco/evaluation/evaluate.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/evaluation/metrics.py` & `LibRecommender-1.1.1/libreco/evaluation/metrics.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/feature/column_mapping.py` & `LibRecommender-1.1.1/libreco/feature/column_mapping.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/feature/multi_sparse.py` & `LibRecommender-1.1.1/libreco/feature/multi_sparse.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/feature/sparse.py` & `LibRecommender-1.1.1/libreco/feature/sparse.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/feature/unique.py` & `LibRecommender-1.1.1/libreco/feature/unique.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/feature/update.py` & `LibRecommender-1.1.1/libreco/feature/update.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/graph/from_dgl.py` & `LibRecommender-1.1.1/libreco/graph/from_dgl.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/graph/message.py` & `LibRecommender-1.1.1/libreco/graph/message.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/graph/neighbor_walk.py` & `LibRecommender-1.1.1/libreco/graph/neighbor_walk.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/prediction/predict.py` & `LibRecommender-1.1.1/libreco/prediction/predict.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/prediction/preprocess.py` & `LibRecommender-1.1.1/libreco/prediction/preprocess.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/recommendation/cold_start.py` & `LibRecommender-1.1.1/libreco/recommendation/cold_start.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/recommendation/preprocess.py` & `LibRecommender-1.1.1/libreco/recommendation/preprocess.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,41 +1,61 @@
 import numpy as np
 
 from ..prediction.preprocess import get_cached_seqs, set_temp_feats
-from ..tfops import get_feed_dict
+from ..tfops import get_feed_dict, get_sparse_feed_dict
 
 
 def embed_from_seq(model, user_ids, seq, inner_id):
-    seq, seq_len = build_rec_seq(seq, model, inner_id)
-    feed_dict = {
-        model.user_interacted_seq: seq,
-        model.user_interacted_len: seq_len,
-    }
-    if hasattr(model, "user_indices"):
-        feed_dict[model.user_indices] = np.array(user_ids, dtype=np.int32)
+    if model.model_name == "YouTubeRetrieval":
+        sparse_tensor_indices, sparse_tensor_values = build_sparse_seq(
+            seq, model, inner_id
+        )
+        feed_dict = get_sparse_feed_dict(
+            model=model,
+            sparse_tensor_indices=sparse_tensor_indices,
+            sparse_tensor_values=sparse_tensor_values,
+            user_ids=user_ids,
+            batch_size=1,
+            is_training=False,
+        )
+    else:
+        seq, seq_len = build_rec_seq(seq, model, inner_id)
+        feed_dict = get_feed_dict(
+            model=model,
+            user_indices=np.array(user_ids, dtype=np.int32),
+            user_interacted_seq=seq,
+            user_interacted_len=seq_len,
+            is_training=False,
+        )
     embed = model.sess.run(model.user_vector, feed_dict)
     # embed = embed / np.linalg.norm(embed, axis=1, keepdims=True)
     bias = np.ones([1, 1], dtype=embed.dtype)
     return np.hstack([embed, bias])
 
 
 def build_rec_seq(seq, model, inner_id, repeat=False):
-    assert isinstance(seq, (list, np.ndarray)), "`seq` must be list or numpy.ndarray."
-    if not inner_id:
-        seq = [model.data_info.item2id.get(i, model.n_items) for i in seq]
+    seq, seq_len = _extract_seq(seq, model, inner_id)
     recent_seq = np.full((1, model.max_seq_len), model.n_items, dtype=np.int32)
-    seq_len = min(model.max_seq_len, len(seq))
     recent_seq[0, -seq_len:] = seq[-seq_len:]
     seq_len = np.array([seq_len], dtype=np.float32)
     if repeat:
         recent_seq = np.repeat(recent_seq, model.n_items, axis=0)
         seq_len = np.repeat(seq_len, model.n_items)
     return recent_seq, seq_len
 
 
+def build_sparse_seq(seq, model, inner_id):
+    seq, seq_len = _extract_seq(seq, model, inner_id)
+    sparse_tensor_indices = np.zeros((seq_len, 2), dtype=np.int64)
+    # -1 will be pruned in `tf.nn.safe_embedding_lookup_sparse`
+    seq = [i if i < model.n_items else -1 for i in seq[-seq_len:]]
+    sparse_tensor_values = np.array(seq, dtype=np.int64)
+    return sparse_tensor_indices, sparse_tensor_values
+
+
 def process_tf_feat(model, user_ids, user_feats, seq, inner_id):
     user_indices, item_indices, sparse_indices, dense_values = [], [], [], []
     has_sparse = model.sparse if hasattr(model, "sparse") else None
     has_dense = model.dense if hasattr(model, "dense") else None
     all_items = np.arange(model.n_items)
     for u in user_ids:
         user_indices.append(np.repeat(u, model.n_items))
@@ -107,7 +127,15 @@
     if user_col and item_col:
         orig_cols = user_col + item_col
         # keep column names in original order
         col_reindex = np.arange(len(orig_cols))[np.argsort(orig_cols)]
         features = np.concatenate([user_feats, item_feats], axis=1)
         return features[:, col_reindex]
     return user_feats if user_col else item_feats
+
+
+def _extract_seq(seq, model, inner_id):
+    assert isinstance(seq, (list, np.ndarray)), "`seq` must be list or numpy.ndarray."
+    if not inner_id:
+        seq = [model.data_info.item2id.get(i, model.n_items) for i in seq]
+    seq_len = min(model.max_seq_len, len(seq))
+    return seq, seq_len
```

### Comparing `LibRecommender-1.1.0/libreco/recommendation/ranking.py` & `LibRecommender-1.1.1/libreco/recommendation/ranking.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/recommendation/recommend.py` & `LibRecommender-1.1.1/libreco/recommendation/recommend.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/sampling/__init__.py` & `LibRecommender-1.1.1/libreco/sampling/__init__.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/sampling/negatives.py` & `LibRecommender-1.1.1/libreco/sampling/negatives.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/sampling/random_walks.py` & `LibRecommender-1.1.1/libreco/sampling/random_walks.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/tfops/__init__.py` & `LibRecommender-1.1.1/libreco/tfops/__init__.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,21 +1,26 @@
 from .configs import dropout_config, lr_decay_config, reg_config, sess_config
-from .features import get_feed_dict, multi_sparse_combine_embedding
+from .features import (
+    get_feed_dict,
+    get_sparse_feed_dict,
+    multi_sparse_combine_embedding,
+)
 from .layers import conv_nn, dense_nn, max_pool, tf_dense, tf_rnn
 from .loss import choose_tf_loss
 from .rebuild import rebuild_tf_model
 from .variables import modify_variable_names, var_list_by_name
 from .version import TF_VERSION, tf
 
 __all__ = [
     "dropout_config",
     "lr_decay_config",
     "reg_config",
     "sess_config",
     "get_feed_dict",
+    "get_sparse_feed_dict",
     "multi_sparse_combine_embedding",
     "dense_nn",
     "conv_nn",
     "max_pool",
     "rebuild_tf_model",
     "tf_rnn",
     "tf_dense",
```

### Comparing `LibRecommender-1.1.0/libreco/tfops/configs.py` & `LibRecommender-1.1.1/libreco/tfops/configs.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/tfops/features.py` & `LibRecommender-1.1.1/libreco/tfops/features.py`

 * *Files 19% similar despite different names*

```diff
@@ -73,33 +73,60 @@
         res_embed = tf.div_no_nan(res_embed, multi_sparse_lens)
 
     return res_embed
 
 
 def get_feed_dict(
     model,
-    user_indices,
-    item_indices,
+    user_indices=None,
+    item_indices=None,
     labels=None,
     sparse_indices=None,
     dense_values=None,
     user_interacted_seq=None,
     user_interacted_len=None,
     is_training=False,
 ):
-    feed_dict = {model.user_indices: user_indices, model.item_indices: item_indices}
-    if labels is not None:
+    feed_dict = dict()
+    if hasattr(model, "user_indices") and user_indices is not None:
+        feed_dict.update({model.user_indices: user_indices})
+    if hasattr(model, "item_indices") and item_indices is not None:
+        feed_dict.update({model.item_indices: item_indices})
+    if hasattr(model, "labels") and labels is not None:
         feed_dict.update({model.labels: labels})
     if hasattr(model, "is_training"):
         feed_dict.update({model.is_training: is_training})
-    if hasattr(model, "sparse") and model.sparse:
+    if hasattr(model, "sparse") and model.sparse and sparse_indices is not None:
         feed_dict.update({model.sparse_indices: sparse_indices})
-    if hasattr(model, "dense") and model.dense:
+    if hasattr(model, "dense") and model.dense and dense_values is not None:
         feed_dict.update({model.dense_values: dense_values})
     if model.model_category == "sequence":
         feed_dict.update(
             {
                 model.user_interacted_seq: user_interacted_seq,
                 model.user_interacted_len: user_interacted_len,
             }
         )
     return feed_dict
+
+
+def get_sparse_feed_dict(
+    model,
+    sparse_tensor_indices,
+    sparse_tensor_values,
+    user_ids,
+    batch_size=1,
+    is_training=False,
+):
+    feed_dict = {
+        model.item_interaction_indices: sparse_tensor_indices,
+        model.item_interaction_values: sparse_tensor_values,
+        model.modified_batch_size: batch_size,
+        model.is_training: is_training,
+    }
+    if hasattr(model, "sparse") and model.sparse:
+        sparse_indices = model.data_info.user_sparse_unique[user_ids]
+        feed_dict.update({model.sparse_indices: sparse_indices})
+    if hasattr(model, "dense") and model.dense:
+        dense_values = model.data_info.user_dense_unique[user_ids]
+        feed_dict.update({model.dense_values: dense_values})
+    return feed_dict
```

### Comparing `LibRecommender-1.1.0/libreco/tfops/layers.py` & `LibRecommender-1.1.1/libreco/tfops/layers.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/tfops/loss.py` & `LibRecommender-1.1.1/libreco/tfops/loss.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/tfops/rebuild.py` & `LibRecommender-1.1.1/libreco/tfops/rebuild.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/tfops/variables.py` & `LibRecommender-1.1.1/libreco/tfops/variables.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/torchops/__init__.py` & `LibRecommender-1.1.1/libreco/torchops/__init__.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/torchops/configs.py` & `LibRecommender-1.1.1/libreco/torchops/configs.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/torchops/loss.py` & `LibRecommender-1.1.1/libreco/torchops/loss.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/torchops/rebuild.py` & `LibRecommender-1.1.1/libreco/torchops/rebuild.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/training/dispatch.py` & `LibRecommender-1.1.1/libreco/training/dispatch.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/training/tf_trainer.py` & `LibRecommender-1.1.1/libreco/training/tf_trainer.py`

 * *Files 0% similar despite different names*

```diff
@@ -175,30 +175,30 @@
 
         if self.loss_type == "nce":
             self.loss = tf.reduce_mean(
                 tf.nn.nce_loss(
                     weights=self.model.nce_weights,
                     biases=self.model.nce_biases,
                     labels=labels,
-                    inputs=self.model.user_vector_repr,
+                    inputs=self.model.user_vector,
                     num_sampled=num_sampled_per_batch,
                     num_classes=self.model.n_items,
                     num_true=1,
                     sampled_values=sampled_values,
                     remove_accidental_hits=True,
                     partition_strategy="div",
                 )
             )
         elif self.loss_type == "sampled_softmax":
             self.loss = tf.reduce_mean(
                 tf.nn.sampled_softmax_loss(
                     weights=self.model.nce_weights,
                     biases=self.model.nce_biases,
                     labels=labels,
-                    inputs=self.model.user_vector_repr,
+                    inputs=self.model.user_vector,
                     num_sampled=num_sampled_per_batch,
                     num_classes=self.model.n_items,
                     num_true=1,
                     sampled_values=sampled_values,
                     remove_accidental_hits=True,
                     seed=self.model.seed,
                     partition_strategy="div",
```

### Comparing `LibRecommender-1.1.0/libreco/training/torch_trainer.py` & `LibRecommender-1.1.1/libreco/training/torch_trainer.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/training/trainer.py` & `LibRecommender-1.1.1/libreco/training/trainer.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/utils/_similarities.cpp` & `LibRecommender-1.1.1/libreco/utils/_similarities.cpp`

 * *Files 0% similar despite different names*

```diff
@@ -1,33 +1,33 @@
 /* Generated by Cython 0.29.34 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include/numpy/arrayobject.h",
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include/numpy/arrayscalars.h",
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include/numpy/ndarrayobject.h",
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include/numpy/ndarraytypes.h",
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include/numpy/ufuncobject.h"
+            "/tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/core/include/numpy/arrayobject.h",
+            "/tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/core/include/numpy/arrayscalars.h",
+            "/tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/core/include/numpy/ndarrayobject.h",
+            "/tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/core/include/numpy/ndarraytypes.h",
+            "/tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/core/include/numpy/ufuncobject.h"
         ],
         "extra_compile_args": [
             "-Wno-unused-function",
             "-Wno-maybe-uninitialized",
             "-O3",
             "-ffast-math",
             "-fopenmp",
             "-std=c++11"
         ],
         "extra_link_args": [
             "-fopenmp",
             "-std=c++11"
         ],
         "include_dirs": [
-            "/tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/core/include"
+            "/tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/core/include"
         ],
         "language": "c++",
         "name": "libreco.utils._similarities",
         "sources": [
             "libreco/utils/_similarities.pyx"
         ]
     },
@@ -796,15 +796,14 @@
 #include "numpy/ndarrayobject.h"
 #include "numpy/ndarraytypes.h"
 #include "numpy/arrayscalars.h"
 #include "numpy/ufuncobject.h"
 
     /* NumPy API declarations from "numpy/__init__.pxd" */
     
-#include <math.h>
 #include "ios"
 #include "new"
 #include "stdexcept"
 #include "typeinfo"
 #include <vector>
 #include <stdlib.h>
 #include "pythread.h"
@@ -1146,195 +1145,195 @@
   char enc_type;
   char new_packmode;
   char enc_packmode;
   char is_valid_array;
 } __Pyx_BufFmt_Context;
 
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":689
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":689
  * # in Cython to enable them only on the right systems.
  * 
  * ctypedef npy_int8       int8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  */
 typedef npy_int8 __pyx_t_5numpy_int8_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":690
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":690
  * 
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t
  */
 typedef npy_int16 __pyx_t_5numpy_int16_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":691
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":691
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int64      int64_t
  * #ctypedef npy_int96      int96_t
  */
 typedef npy_int32 __pyx_t_5numpy_int32_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":692
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":692
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_int96      int96_t
  * #ctypedef npy_int128     int128_t
  */
 typedef npy_int64 __pyx_t_5numpy_int64_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":696
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":696
  * #ctypedef npy_int128     int128_t
  * 
  * ctypedef npy_uint8      uint8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  */
 typedef npy_uint8 __pyx_t_5numpy_uint8_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":697
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":697
  * 
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t
  */
 typedef npy_uint16 __pyx_t_5numpy_uint16_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":698
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":698
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint64     uint64_t
  * #ctypedef npy_uint96     uint96_t
  */
 typedef npy_uint32 __pyx_t_5numpy_uint32_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":699
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":699
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_uint96     uint96_t
  * #ctypedef npy_uint128    uint128_t
  */
 typedef npy_uint64 __pyx_t_5numpy_uint64_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":703
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":703
  * #ctypedef npy_uint128    uint128_t
  * 
  * ctypedef npy_float32    float32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_float64    float64_t
  * #ctypedef npy_float80    float80_t
  */
 typedef npy_float32 __pyx_t_5numpy_float32_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":704
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":704
  * 
  * ctypedef npy_float32    float32_t
  * ctypedef npy_float64    float64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_float80    float80_t
  * #ctypedef npy_float128   float128_t
  */
 typedef npy_float64 __pyx_t_5numpy_float64_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":713
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":713
  * # The int types are mapped a bit surprising --
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t
  */
 typedef npy_long __pyx_t_5numpy_int_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":714
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":714
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   longlong_t
  * 
  */
 typedef npy_longlong __pyx_t_5numpy_long_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":715
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":715
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_ulong      uint_t
  */
 typedef npy_longlong __pyx_t_5numpy_longlong_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":717
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":717
  * ctypedef npy_longlong   longlong_t
  * 
  * ctypedef npy_ulong      uint_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t
  */
 typedef npy_ulong __pyx_t_5numpy_uint_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":718
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":718
  * 
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulong_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":719
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":719
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_intp       intp_t
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulonglong_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":721
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":721
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  * ctypedef npy_intp       intp_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uintp      uintp_t
  * 
  */
 typedef npy_intp __pyx_t_5numpy_intp_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":722
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":722
  * 
  * ctypedef npy_intp       intp_t
  * ctypedef npy_uintp      uintp_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_double     float_t
  */
 typedef npy_uintp __pyx_t_5numpy_uintp_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":724
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":724
  * ctypedef npy_uintp      uintp_t
  * 
  * ctypedef npy_double     float_t             # <<<<<<<<<<<<<<
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t
  */
 typedef npy_double __pyx_t_5numpy_float_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":725
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":725
  * 
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longdouble longdouble_t
  * 
  */
 typedef npy_double __pyx_t_5numpy_double_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":726
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":726
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cfloat      cfloat_t
  */
 typedef npy_longdouble __pyx_t_5numpy_longdouble_t;
@@ -1374,42 +1373,42 @@
 
 /*--- Type declarations ---*/
 struct __pyx_array_obj;
 struct __pyx_MemviewEnum_obj;
 struct __pyx_memoryview_obj;
 struct __pyx_memoryviewslice_obj;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":728
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":728
  * ctypedef npy_longdouble longdouble_t
  * 
  * ctypedef npy_cfloat      cfloat_t             # <<<<<<<<<<<<<<
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t
  */
 typedef npy_cfloat __pyx_t_5numpy_cfloat_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":729
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":729
  * 
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t             # <<<<<<<<<<<<<<
  * ctypedef npy_clongdouble clongdouble_t
  * 
  */
 typedef npy_cdouble __pyx_t_5numpy_cdouble_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":730
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":730
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cdouble     complex_t
  */
 typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":732
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":732
  * ctypedef npy_clongdouble clongdouble_t
  * 
  * ctypedef npy_cdouble     complex_t             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  */
 typedef npy_cdouble __pyx_t_5numpy_complex_t;
@@ -1437,20 +1436,20 @@
  *     const float[:] data,
  */
 struct __pyx_opt_args_7libreco_5utils_13_similarities_invert_pearson {
   int __pyx_n;
   int num_threads;
 };
 
-/* "libreco/utils/_similarities.pyx":346
- * @cython.wraparound(False)
+/* "libreco/utils/_similarities.pyx":347
  * @cython.cdivision(True)
- * cpdef invert_jaccard(const int[:] indices, const int[:] indptr, const float[:] data,             # <<<<<<<<<<<<<<
- *                     const int[:] x_count, int min_common, int n_x, int n_y,
- *                     int block_size, int block_num, int num_threads=1):
+ * cpdef invert_jaccard(
+ *     const int[:] indices,             # <<<<<<<<<<<<<<
+ *     const int[:] indptr,
+ *     const float[:] data,
  */
 struct __pyx_opt_args_7libreco_5utils_13_similarities_invert_jaccard {
   int __pyx_n;
   int num_threads;
 };
 
 /* "View.MemoryView":106
@@ -2436,16 +2435,14 @@
 static PyTypeObject *__pyx_ptype_5numpy_character = 0;
 static PyTypeObject *__pyx_ptype_5numpy_ufunc = 0;
 
 /* Module declarations from 'cython.view' */
 
 /* Module declarations from 'cython' */
 
-/* Module declarations from 'libc.math' */
-
 /* Module declarations from 'libcpp.vector' */
 
 /* Module declarations from 'libc.stdlib' */
 
 /* Module declarations from 'libreco.utils._similarities' */
 static PyTypeObject *__pyx_array_type = 0;
 static PyTypeObject *__pyx_MemviewEnum_type = 0;
@@ -5612,17 +5609,17 @@
 
   /* function exit code */
 }
 
 /* "libreco/utils/_similarities.pyx":346
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cpdef invert_jaccard(const int[:] indices, const int[:] indptr, const float[:] data,             # <<<<<<<<<<<<<<
- *                     const int[:] x_count, int min_common, int n_x, int n_y,
- *                     int block_size, int block_num, int num_threads=1):
+ * cpdef invert_jaccard(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
 static PyObject *__pyx_pw_7libreco_5utils_13_similarities_5invert_jaccard(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static PyObject *__pyx_f_7libreco_5utils_13_similarities_invert_jaccard(__Pyx_memviewslice __pyx_v_indices, __Pyx_memviewslice __pyx_v_indptr, __Pyx_memviewslice __pyx_v_data, __Pyx_memviewslice __pyx_v_x_count, int __pyx_v_min_common, int __pyx_v_n_x, int __pyx_v_n_y, int __pyx_v_block_size, int __pyx_v_block_num, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_7libreco_5utils_13_similarities_invert_jaccard *__pyx_optional_args) {
   int __pyx_v_num_threads = ((int)1);
   Py_ssize_t __pyx_v_res_count;
   __Pyx_memviewslice __pyx_v_res_data = { 0, 0, { 0 }, { 0 }, { 0 } };
@@ -5644,227 +5641,227 @@
   __Pyx_RefNannySetupContext("invert_jaccard", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_num_threads = __pyx_optional_args->num_threads;
     }
   }
 
-  /* "libreco/utils/_similarities.pyx":350
- *                     int block_size, int block_num, int num_threads=1):
- * 
+  /* "libreco/utils/_similarities.pyx":358
+ *     int num_threads=1,
+ * ):
  *     cdef Py_ssize_t res_count = count_freq(             # <<<<<<<<<<<<<<
  *         indices, indptr, min_common, n_x, n_y, block_size, block_num, num_threads)
  * 
  */
   __pyx_v_res_count = __pyx_f_7libreco_5utils_13_similarities_count_freq(__pyx_v_indices, __pyx_v_indptr, __pyx_v_min_common, __pyx_v_n_x, __pyx_v_n_y, __pyx_v_block_size, __pyx_v_block_num, __pyx_v_num_threads);
 
-  /* "libreco/utils/_similarities.pyx":353
+  /* "libreco/utils/_similarities.pyx":361
  *         indices, indptr, min_common, n_x, n_y, block_size, block_num, num_threads)
  * 
  *     cdef float[:] res_data = np.zeros(res_count, dtype=np.single)             # <<<<<<<<<<<<<<
  *     cdef uint[:] res_indices = np.zeros(res_count, dtype=np.uintc)
  *     cdef uint[:] res_indptr = np.zeros(n_x + 1, dtype=np.uintc)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromSsize_t(__pyx_v_res_count); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_v_res_count); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_single); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_single); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 353, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 361, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 353, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 361, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_res_data = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "libreco/utils/_similarities.pyx":354
+  /* "libreco/utils/_similarities.pyx":362
  * 
  *     cdef float[:] res_data = np.zeros(res_count, dtype=np.single)
  *     cdef uint[:] res_indices = np.zeros(res_count, dtype=np.uintc)             # <<<<<<<<<<<<<<
  *     cdef uint[:] res_indptr = np.zeros(n_x + 1, dtype=np.uintc)
  * #    res_indptr[0] = 0
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 362, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 362, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyInt_FromSsize_t(__pyx_v_res_count); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __pyx_t_5 = PyInt_FromSsize_t(__pyx_v_res_count); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 362, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 362, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 362, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 362, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_uintc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_uintc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 362, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 354, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 362, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 362, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_7libreco_5utils_13_similarities_uint(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_7libreco_5utils_13_similarities_uint(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 362, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_res_indices = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "libreco/utils/_similarities.pyx":355
+  /* "libreco/utils/_similarities.pyx":363
  *     cdef float[:] res_data = np.zeros(res_count, dtype=np.single)
  *     cdef uint[:] res_indices = np.zeros(res_count, dtype=np.uintc)
  *     cdef uint[:] res_indptr = np.zeros(n_x + 1, dtype=np.uintc)             # <<<<<<<<<<<<<<
  * #    res_indptr[0] = 0
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_long((__pyx_v_n_x + 1)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_long((__pyx_v_n_x + 1)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_uintc); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_uintc); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 355, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 363, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_7libreco_5utils_13_similarities_uint(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_7libreco_5utils_13_similarities_uint(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 363, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_res_indptr = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "libreco/utils/_similarities.pyx":358
+  /* "libreco/utils/_similarities.pyx":366
  * #    res_indptr[0] = 0
  * 
  *     compute_jaccard(indices, indptr, data, x_count, min_common, n_x, n_y,             # <<<<<<<<<<<<<<
  *         block_size, block_num, num_threads, res_data, res_indices, res_indptr)
  * 
  */
   __pyx_f_7libreco_5utils_13_similarities_compute_jaccard(__pyx_v_indices, __pyx_v_indptr, __pyx_v_data, __pyx_v_x_count, __pyx_v_min_common, __pyx_v_n_x, __pyx_v_n_y, __pyx_v_block_size, __pyx_v_block_num, __pyx_v_num_threads, __pyx_v_res_data, __pyx_v_res_indices, __pyx_v_res_indptr);
 
-  /* "libreco/utils/_similarities.pyx":361
+  /* "libreco/utils/_similarities.pyx":369
  *         block_size, block_num, num_threads, res_data, res_indices, res_indptr)
  * 
  *     return np.asarray(res_indices), np.asarray(res_indptr), np.asarray(res_data)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 361, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 361, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res_indices, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_7libreco_5utils_13_similarities_uint, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_7libreco_5utils_13_similarities_uint, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 361, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res_indices, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_7libreco_5utils_13_similarities_uint, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_7libreco_5utils_13_similarities_uint, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 361, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 361, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 361, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res_indptr, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_7libreco_5utils_13_similarities_uint, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_7libreco_5utils_13_similarities_uint, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 361, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res_indptr, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_7libreco_5utils_13_similarities_uint, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_7libreco_5utils_13_similarities_uint, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_1 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_1)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_1, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 361, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 361, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 361, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res_data, 1, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 361, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res_data, 1, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_8 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_8)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_8);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_5 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_8, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 361, __pyx_L1_error)
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 361, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_5);
@@ -5874,17 +5871,17 @@
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* "libreco/utils/_similarities.pyx":346
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cpdef invert_jaccard(const int[:] indices, const int[:] indptr, const float[:] data,             # <<<<<<<<<<<<<<
- *                     const int[:] x_count, int min_common, int n_x, int n_y,
- *                     int block_size, int block_num, int num_threads=1):
+ * cpdef invert_jaccard(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
@@ -6029,25 +6026,25 @@
         values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[0], 0); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 346, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[1], 0); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 346, __pyx_L3_error)
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[2], 0); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 346, __pyx_L3_error)
-    __pyx_v_x_count = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[3], 0); if (unlikely(!__pyx_v_x_count.memview)) __PYX_ERR(0, 347, __pyx_L3_error)
-    __pyx_v_min_common = __Pyx_PyInt_As_int(values[4]); if (unlikely((__pyx_v_min_common == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 347, __pyx_L3_error)
-    __pyx_v_n_x = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_n_x == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 347, __pyx_L3_error)
-    __pyx_v_n_y = __Pyx_PyInt_As_int(values[6]); if (unlikely((__pyx_v_n_y == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 347, __pyx_L3_error)
-    __pyx_v_block_size = __Pyx_PyInt_As_int(values[7]); if (unlikely((__pyx_v_block_size == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 348, __pyx_L3_error)
-    __pyx_v_block_num = __Pyx_PyInt_As_int(values[8]); if (unlikely((__pyx_v_block_num == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 348, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[0], 0); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 347, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[1], 0); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 348, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[2], 0); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 349, __pyx_L3_error)
+    __pyx_v_x_count = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[3], 0); if (unlikely(!__pyx_v_x_count.memview)) __PYX_ERR(0, 350, __pyx_L3_error)
+    __pyx_v_min_common = __Pyx_PyInt_As_int(values[4]); if (unlikely((__pyx_v_min_common == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 351, __pyx_L3_error)
+    __pyx_v_n_x = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_n_x == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 352, __pyx_L3_error)
+    __pyx_v_n_y = __Pyx_PyInt_As_int(values[6]); if (unlikely((__pyx_v_n_y == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 353, __pyx_L3_error)
+    __pyx_v_block_size = __Pyx_PyInt_As_int(values[7]); if (unlikely((__pyx_v_block_size == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 354, __pyx_L3_error)
+    __pyx_v_block_num = __Pyx_PyInt_As_int(values[8]); if (unlikely((__pyx_v_block_num == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 355, __pyx_L3_error)
     if (values[9]) {
-      __pyx_v_num_threads = __Pyx_PyInt_As_int(values[9]); if (unlikely((__pyx_v_num_threads == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 348, __pyx_L3_error)
+      __pyx_v_num_threads = __Pyx_PyInt_As_int(values[9]); if (unlikely((__pyx_v_num_threads == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 356, __pyx_L3_error)
     } else {
       __pyx_v_num_threads = ((int)1);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
   __Pyx_RaiseArgtupleInvalid("invert_jaccard", 0, 9, 10, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 346, __pyx_L3_error)
@@ -6096,20 +6093,20 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_data, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_x_count, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "libreco/utils/_similarities.pyx":367
+/* "libreco/utils/_similarities.pyx":375
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cpdef forward_cosine(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *                      const float[:] data, const float[:] x_norm,
- *                      int min_common, int n_x):
+ * cpdef forward_cosine(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
 static PyObject *__pyx_pw_7libreco_5utils_13_similarities_7forward_cosine(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static PyObject *__pyx_f_7libreco_5utils_13_similarities_forward_cosine(__Pyx_memviewslice __pyx_v_indices, __Pyx_memviewslice __pyx_v_indptr, __Pyx_memviewslice __pyx_v_data, __Pyx_memviewslice __pyx_v_x_norm, int __pyx_v_min_common, int __pyx_v_n_x, CYTHON_UNUSED int __pyx_skip_dispatch) {
   Py_ssize_t __pyx_v_x1;
   Py_ssize_t __pyx_v_x2;
   Py_ssize_t __pyx_v_y1;
@@ -6143,135 +6140,135 @@
   PyObject *__pyx_t_13 = NULL;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("forward_cosine", 0);
 
-  /* "libreco/utils/_similarities.pyx":375
+  /* "libreco/utils/_similarities.pyx":387
  *     cdef vector[uint] res_indices, res_indptr
  *     cdef vector[float] res_data
  *     res_indptr.reserve(n_x + 1)             # <<<<<<<<<<<<<<
  *     res_indptr.push_back(0)
  * 
  */
   __pyx_v_res_indptr.reserve((__pyx_v_n_x + 1));
 
-  /* "libreco/utils/_similarities.pyx":376
+  /* "libreco/utils/_similarities.pyx":388
  *     cdef vector[float] res_data
  *     res_indptr.reserve(n_x + 1)
  *     res_indptr.push_back(0)             # <<<<<<<<<<<<<<
  * 
  *     with nogil:
  */
   try {
     __pyx_v_res_indptr.push_back(0);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 376, __pyx_L1_error)
+    __PYX_ERR(0, 388, __pyx_L1_error)
   }
 
-  /* "libreco/utils/_similarities.pyx":378
+  /* "libreco/utils/_similarities.pyx":390
  *     res_indptr.push_back(0)
  * 
  *     with nogil:             # <<<<<<<<<<<<<<
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):
  */
   {
       #ifdef WITH_THREAD
       PyThreadState *_save;
       Py_UNBLOCK_THREADS
       __Pyx_FastGIL_Remember();
       #endif
       /*try:*/ {
 
-        /* "libreco/utils/_similarities.pyx":379
+        /* "libreco/utils/_similarities.pyx":391
  * 
  *     with nogil:
  *         for x1 in range(n_x):             # <<<<<<<<<<<<<<
  *             for x2 in range(x1 + 1, n_x):
  *                 i = indptr[x1]
  */
         __pyx_t_1 = __pyx_v_n_x;
         __pyx_t_2 = __pyx_t_1;
         for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
           __pyx_v_x1 = __pyx_t_3;
 
-          /* "libreco/utils/_similarities.pyx":380
+          /* "libreco/utils/_similarities.pyx":392
  *     with nogil:
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):             # <<<<<<<<<<<<<<
  *                 i = indptr[x1]
  *                 j = indptr[x2]
  */
           __pyx_t_4 = __pyx_v_n_x;
           __pyx_t_5 = __pyx_t_4;
           for (__pyx_t_6 = (__pyx_v_x1 + 1); __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
             __pyx_v_x2 = __pyx_t_6;
 
-            /* "libreco/utils/_similarities.pyx":381
+            /* "libreco/utils/_similarities.pyx":393
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):
  *                 i = indptr[x1]             # <<<<<<<<<<<<<<
  *                 j = indptr[x2]
  *                 end1 = indptr[x1 + 1]
  */
             __pyx_t_7 = __pyx_v_x1;
             __pyx_v_i = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":382
+            /* "libreco/utils/_similarities.pyx":394
  *             for x2 in range(x1 + 1, n_x):
  *                 i = indptr[x1]
  *                 j = indptr[x2]             # <<<<<<<<<<<<<<
  *                 end1 = indptr[x1 + 1]
  *                 end2 = indptr[x2 + 1]
  */
             __pyx_t_7 = __pyx_v_x2;
             __pyx_v_j = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":383
+            /* "libreco/utils/_similarities.pyx":395
  *                 i = indptr[x1]
  *                 j = indptr[x2]
  *                 end1 = indptr[x1 + 1]             # <<<<<<<<<<<<<<
  *                 end2 = indptr[x2 + 1]
  * 
  */
             __pyx_t_7 = (__pyx_v_x1 + 1);
             __pyx_v_end1 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":384
+            /* "libreco/utils/_similarities.pyx":396
  *                 j = indptr[x2]
  *                 end1 = indptr[x1 + 1]
  *                 end2 = indptr[x2 + 1]             # <<<<<<<<<<<<<<
  * 
  *                 prods = 0.0
  */
             __pyx_t_7 = (__pyx_v_x2 + 1);
             __pyx_v_end2 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":386
+            /* "libreco/utils/_similarities.pyx":398
  *                 end2 = indptr[x2 + 1]
  * 
  *                 prods = 0.0             # <<<<<<<<<<<<<<
  *                 count = 0
  *                 # compute common items
  */
             __pyx_v_prods = 0.0;
 
-            /* "libreco/utils/_similarities.pyx":387
+            /* "libreco/utils/_similarities.pyx":399
  * 
  *                 prods = 0.0
  *                 count = 0             # <<<<<<<<<<<<<<
  *                 # compute common items
  *                 while (i < end1 and j < end2):
  */
             __pyx_v_count = 0;
 
-            /* "libreco/utils/_similarities.pyx":389
+            /* "libreco/utils/_similarities.pyx":401
  *                 count = 0
  *                 # compute common items
  *                 while (i < end1 and j < end2):             # <<<<<<<<<<<<<<
  *                     y1 = indices[i]
  *                     y2 = indices[j]
  */
             while (1) {
@@ -6282,145 +6279,145 @@
                 goto __pyx_L12_bool_binop_done;
               }
               __pyx_t_9 = ((__pyx_v_j < __pyx_v_end2) != 0);
               __pyx_t_8 = __pyx_t_9;
               __pyx_L12_bool_binop_done:;
               if (!__pyx_t_8) break;
 
-              /* "libreco/utils/_similarities.pyx":390
+              /* "libreco/utils/_similarities.pyx":402
  *                 # compute common items
  *                 while (i < end1 and j < end2):
  *                     y1 = indices[i]             # <<<<<<<<<<<<<<
  *                     y2 = indices[j]
  *                     if y1 < y2:
  */
               __pyx_t_7 = __pyx_v_i;
               __pyx_v_y1 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_7 * __pyx_v_indices.strides[0]) )));
 
-              /* "libreco/utils/_similarities.pyx":391
+              /* "libreco/utils/_similarities.pyx":403
  *                 while (i < end1 and j < end2):
  *                     y1 = indices[i]
  *                     y2 = indices[j]             # <<<<<<<<<<<<<<
  *                     if y1 < y2:
  *                         i += 1
  */
               __pyx_t_7 = __pyx_v_j;
               __pyx_v_y2 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_7 * __pyx_v_indices.strides[0]) )));
 
-              /* "libreco/utils/_similarities.pyx":392
+              /* "libreco/utils/_similarities.pyx":404
  *                     y1 = indices[i]
  *                     y2 = indices[j]
  *                     if y1 < y2:             # <<<<<<<<<<<<<<
  *                         i += 1
  *                     elif y1 > y2:
  */
               __pyx_t_8 = ((__pyx_v_y1 < __pyx_v_y2) != 0);
               if (__pyx_t_8) {
 
-                /* "libreco/utils/_similarities.pyx":393
+                /* "libreco/utils/_similarities.pyx":405
  *                     y2 = indices[j]
  *                     if y1 < y2:
  *                         i += 1             # <<<<<<<<<<<<<<
  *                     elif y1 > y2:
  *                         j += 1
  */
                 __pyx_v_i = (__pyx_v_i + 1);
 
-                /* "libreco/utils/_similarities.pyx":392
+                /* "libreco/utils/_similarities.pyx":404
  *                     y1 = indices[i]
  *                     y2 = indices[j]
  *                     if y1 < y2:             # <<<<<<<<<<<<<<
  *                         i += 1
  *                     elif y1 > y2:
  */
                 goto __pyx_L14;
               }
 
-              /* "libreco/utils/_similarities.pyx":394
+              /* "libreco/utils/_similarities.pyx":406
  *                     if y1 < y2:
  *                         i += 1
  *                     elif y1 > y2:             # <<<<<<<<<<<<<<
  *                         j += 1
  *                     else:
  */
               __pyx_t_8 = ((__pyx_v_y1 > __pyx_v_y2) != 0);
               if (__pyx_t_8) {
 
-                /* "libreco/utils/_similarities.pyx":395
+                /* "libreco/utils/_similarities.pyx":407
  *                         i += 1
  *                     elif y1 > y2:
  *                         j += 1             # <<<<<<<<<<<<<<
  *                     else:
  *                         count += 1
  */
                 __pyx_v_j = (__pyx_v_j + 1);
 
-                /* "libreco/utils/_similarities.pyx":394
+                /* "libreco/utils/_similarities.pyx":406
  *                     if y1 < y2:
  *                         i += 1
  *                     elif y1 > y2:             # <<<<<<<<<<<<<<
  *                         j += 1
  *                     else:
  */
                 goto __pyx_L14;
               }
 
-              /* "libreco/utils/_similarities.pyx":397
+              /* "libreco/utils/_similarities.pyx":409
  *                         j += 1
  *                     else:
  *                         count += 1             # <<<<<<<<<<<<<<
  *                         prods += data[i] * data[j]
  *                         i += 1
  */
               /*else*/ {
                 __pyx_v_count = (__pyx_v_count + 1);
 
-                /* "libreco/utils/_similarities.pyx":398
+                /* "libreco/utils/_similarities.pyx":410
  *                     else:
  *                         count += 1
  *                         prods += data[i] * data[j]             # <<<<<<<<<<<<<<
  *                         i += 1
  *                         j += 1
  */
                 __pyx_t_7 = __pyx_v_i;
                 __pyx_t_10 = __pyx_v_j;
                 __pyx_v_prods = (__pyx_v_prods + ((*((float const  *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_7 * __pyx_v_data.strides[0]) ))) * (*((float const  *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_10 * __pyx_v_data.strides[0]) )))));
 
-                /* "libreco/utils/_similarities.pyx":399
+                /* "libreco/utils/_similarities.pyx":411
  *                         count += 1
  *                         prods += data[i] * data[j]
  *                         i += 1             # <<<<<<<<<<<<<<
  *                         j += 1
  * 
  */
                 __pyx_v_i = (__pyx_v_i + 1);
 
-                /* "libreco/utils/_similarities.pyx":400
+                /* "libreco/utils/_similarities.pyx":412
  *                         prods += data[i] * data[j]
  *                         i += 1
  *                         j += 1             # <<<<<<<<<<<<<<
  * 
  *                 if count >= min_common:
  */
                 __pyx_v_j = (__pyx_v_j + 1);
               }
               __pyx_L14:;
             }
 
-            /* "libreco/utils/_similarities.pyx":402
+            /* "libreco/utils/_similarities.pyx":414
  *                         j += 1
  * 
  *                 if count >= min_common:             # <<<<<<<<<<<<<<
  *                     res_indices.push_back(x2)
  *                     sqi = x_norm[x1]
  */
             __pyx_t_8 = ((__pyx_v_count >= __pyx_v_min_common) != 0);
             if (__pyx_t_8) {
 
-              /* "libreco/utils/_similarities.pyx":403
+              /* "libreco/utils/_similarities.pyx":415
  * 
  *                 if count >= min_common:
  *                     res_indices.push_back(x2)             # <<<<<<<<<<<<<<
  *                     sqi = x_norm[x1]
  *                     sqj = x_norm[x2]
  */
               try {
@@ -6429,38 +6426,38 @@
                 #ifdef WITH_THREAD
                 PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
                 #endif
                 __Pyx_CppExn2PyErr();
                 #ifdef WITH_THREAD
                 __Pyx_PyGILState_Release(__pyx_gilstate_save);
                 #endif
-                __PYX_ERR(0, 403, __pyx_L4_error)
+                __PYX_ERR(0, 415, __pyx_L4_error)
               }
 
-              /* "libreco/utils/_similarities.pyx":404
+              /* "libreco/utils/_similarities.pyx":416
  *                 if count >= min_common:
  *                     res_indices.push_back(x2)
  *                     sqi = x_norm[x1]             # <<<<<<<<<<<<<<
  *                     sqj = x_norm[x2]
  *                     if prods == 0.0 or sqi == 0.0 or sqj == 0.0:
  */
               __pyx_t_10 = __pyx_v_x1;
               __pyx_v_sqi = (*((float const  *) ( /* dim=0 */ (__pyx_v_x_norm.data + __pyx_t_10 * __pyx_v_x_norm.strides[0]) )));
 
-              /* "libreco/utils/_similarities.pyx":405
+              /* "libreco/utils/_similarities.pyx":417
  *                     res_indices.push_back(x2)
  *                     sqi = x_norm[x1]
  *                     sqj = x_norm[x2]             # <<<<<<<<<<<<<<
  *                     if prods == 0.0 or sqi == 0.0 or sqj == 0.0:
  *                         cos = 0.0
  */
               __pyx_t_10 = __pyx_v_x2;
               __pyx_v_sqj = (*((float const  *) ( /* dim=0 */ (__pyx_v_x_norm.data + __pyx_t_10 * __pyx_v_x_norm.strides[0]) )));
 
-              /* "libreco/utils/_similarities.pyx":406
+              /* "libreco/utils/_similarities.pyx":418
  *                     sqi = x_norm[x1]
  *                     sqj = x_norm[x2]
  *                     if prods == 0.0 or sqi == 0.0 or sqj == 0.0:             # <<<<<<<<<<<<<<
  *                         cos = 0.0
  *                     else:
  */
               __pyx_t_9 = ((__pyx_v_prods == 0.0) != 0);
@@ -6476,46 +6473,46 @@
                 goto __pyx_L17_bool_binop_done;
               }
               __pyx_t_9 = ((__pyx_v_sqj == 0.0) != 0);
               __pyx_t_8 = __pyx_t_9;
               __pyx_L17_bool_binop_done:;
               if (__pyx_t_8) {
 
-                /* "libreco/utils/_similarities.pyx":407
+                /* "libreco/utils/_similarities.pyx":419
  *                     sqj = x_norm[x2]
  *                     if prods == 0.0 or sqi == 0.0 or sqj == 0.0:
  *                         cos = 0.0             # <<<<<<<<<<<<<<
  *                     else:
  *                         cos = prods / (sqi * sqj)
  */
                 __pyx_v_cos = 0.0;
 
-                /* "libreco/utils/_similarities.pyx":406
+                /* "libreco/utils/_similarities.pyx":418
  *                     sqi = x_norm[x1]
  *                     sqj = x_norm[x2]
  *                     if prods == 0.0 or sqi == 0.0 or sqj == 0.0:             # <<<<<<<<<<<<<<
  *                         cos = 0.0
  *                     else:
  */
                 goto __pyx_L16;
               }
 
-              /* "libreco/utils/_similarities.pyx":409
+              /* "libreco/utils/_similarities.pyx":421
  *                         cos = 0.0
  *                     else:
  *                         cos = prods / (sqi * sqj)             # <<<<<<<<<<<<<<
  *                     res_data.push_back(cos)
  *             res_indptr.push_back(res_indices.size())
  */
               /*else*/ {
                 __pyx_v_cos = (__pyx_v_prods / (__pyx_v_sqi * __pyx_v_sqj));
               }
               __pyx_L16:;
 
-              /* "libreco/utils/_similarities.pyx":410
+              /* "libreco/utils/_similarities.pyx":422
  *                     else:
  *                         cos = prods / (sqi * sqj)
  *                     res_data.push_back(cos)             # <<<<<<<<<<<<<<
  *             res_indptr.push_back(res_indices.size())
  * 
  */
               try {
@@ -6524,28 +6521,28 @@
                 #ifdef WITH_THREAD
                 PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
                 #endif
                 __Pyx_CppExn2PyErr();
                 #ifdef WITH_THREAD
                 __Pyx_PyGILState_Release(__pyx_gilstate_save);
                 #endif
-                __PYX_ERR(0, 410, __pyx_L4_error)
+                __PYX_ERR(0, 422, __pyx_L4_error)
               }
 
-              /* "libreco/utils/_similarities.pyx":402
+              /* "libreco/utils/_similarities.pyx":414
  *                         j += 1
  * 
  *                 if count >= min_common:             # <<<<<<<<<<<<<<
  *                     res_indices.push_back(x2)
  *                     sqi = x_norm[x1]
  */
             }
           }
 
-          /* "libreco/utils/_similarities.pyx":411
+          /* "libreco/utils/_similarities.pyx":423
  *                         cos = prods / (sqi * sqj)
  *                     res_data.push_back(cos)
  *             res_indptr.push_back(res_indices.size())             # <<<<<<<<<<<<<<
  * 
  *     return res_indices, res_indptr, res_data
  */
           try {
@@ -6554,20 +6551,20 @@
             #ifdef WITH_THREAD
             PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
             #endif
             __Pyx_CppExn2PyErr();
             #ifdef WITH_THREAD
             __Pyx_PyGILState_Release(__pyx_gilstate_save);
             #endif
-            __PYX_ERR(0, 411, __pyx_L4_error)
+            __PYX_ERR(0, 423, __pyx_L4_error)
           }
         }
       }
 
-      /* "libreco/utils/_similarities.pyx":378
+      /* "libreco/utils/_similarities.pyx":390
  *     res_indptr.push_back(0)
  * 
  *     with nogil:             # <<<<<<<<<<<<<<
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):
  */
       /*finally:*/ {
@@ -6585,49 +6582,49 @@
           #endif
           goto __pyx_L1_error;
         }
         __pyx_L5:;
       }
   }
 
-  /* "libreco/utils/_similarities.pyx":413
+  /* "libreco/utils/_similarities.pyx":425
  *             res_indptr.push_back(res_indices.size())
  * 
  *     return res_indices, res_indptr, res_data             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_11 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indices); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 413, __pyx_L1_error)
+  __pyx_t_11 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indices); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
-  __pyx_t_12 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indptr); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 413, __pyx_L1_error)
+  __pyx_t_12 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indptr); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_12);
-  __pyx_t_13 = __pyx_convert_vector_to_py_float(__pyx_v_res_data); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 413, __pyx_L1_error)
+  __pyx_t_13 = __pyx_convert_vector_to_py_float(__pyx_v_res_data); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 413, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_GIVEREF(__pyx_t_11);
   PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_11);
   __Pyx_GIVEREF(__pyx_t_12);
   PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_12);
   __Pyx_GIVEREF(__pyx_t_13);
   PyTuple_SET_ITEM(__pyx_t_14, 2, __pyx_t_13);
   __pyx_t_11 = 0;
   __pyx_t_12 = 0;
   __pyx_t_13 = 0;
   __pyx_r = __pyx_t_14;
   __pyx_t_14 = 0;
   goto __pyx_L0;
 
-  /* "libreco/utils/_similarities.pyx":367
+  /* "libreco/utils/_similarities.pyx":375
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cpdef forward_cosine(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *                      const float[:] data, const float[:] x_norm,
- *                      int min_common, int n_x):
+ * cpdef forward_cosine(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_11);
   __Pyx_XDECREF(__pyx_t_12);
   __Pyx_XDECREF(__pyx_t_13);
@@ -6682,64 +6679,64 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indptr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, 1); __PYX_ERR(0, 367, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, 1); __PYX_ERR(0, 375, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, 2); __PYX_ERR(0, 367, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, 2); __PYX_ERR(0, 375, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_x_norm)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, 3); __PYX_ERR(0, 367, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, 3); __PYX_ERR(0, 375, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_min_common)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, 4); __PYX_ERR(0, 367, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, 4); __PYX_ERR(0, 375, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n_x)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, 5); __PYX_ERR(0, 367, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, 5); __PYX_ERR(0, 375, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "forward_cosine") < 0)) __PYX_ERR(0, 367, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "forward_cosine") < 0)) __PYX_ERR(0, 375, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
     }
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[0], 0); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 367, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[1], 0); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 367, __pyx_L3_error)
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[2], 0); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 368, __pyx_L3_error)
-    __pyx_v_x_norm = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[3], 0); if (unlikely(!__pyx_v_x_norm.memview)) __PYX_ERR(0, 368, __pyx_L3_error)
-    __pyx_v_min_common = __Pyx_PyInt_As_int(values[4]); if (unlikely((__pyx_v_min_common == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 369, __pyx_L3_error)
-    __pyx_v_n_x = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_n_x == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 369, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[0], 0); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 376, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[1], 0); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 377, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[2], 0); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 378, __pyx_L3_error)
+    __pyx_v_x_norm = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[3], 0); if (unlikely(!__pyx_v_x_norm.memview)) __PYX_ERR(0, 379, __pyx_L3_error)
+    __pyx_v_min_common = __Pyx_PyInt_As_int(values[4]); if (unlikely((__pyx_v_min_common == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 380, __pyx_L3_error)
+    __pyx_v_n_x = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_n_x == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 381, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 367, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("forward_cosine", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 375, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("libreco.utils._similarities.forward_cosine", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_7libreco_5utils_13_similarities_6forward_cosine(__pyx_self, __pyx_v_indices, __pyx_v_indptr, __pyx_v_data, __pyx_v_x_norm, __pyx_v_min_common, __pyx_v_n_x);
 
@@ -6753,19 +6750,19 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("forward_cosine", 0);
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_v_indices.memview)) { __Pyx_RaiseUnboundLocalError("indices"); __PYX_ERR(0, 367, __pyx_L1_error) }
-  if (unlikely(!__pyx_v_indptr.memview)) { __Pyx_RaiseUnboundLocalError("indptr"); __PYX_ERR(0, 367, __pyx_L1_error) }
-  if (unlikely(!__pyx_v_data.memview)) { __Pyx_RaiseUnboundLocalError("data"); __PYX_ERR(0, 367, __pyx_L1_error) }
-  if (unlikely(!__pyx_v_x_norm.memview)) { __Pyx_RaiseUnboundLocalError("x_norm"); __PYX_ERR(0, 367, __pyx_L1_error) }
-  __pyx_t_1 = __pyx_f_7libreco_5utils_13_similarities_forward_cosine(__pyx_v_indices, __pyx_v_indptr, __pyx_v_data, __pyx_v_x_norm, __pyx_v_min_common, __pyx_v_n_x, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 367, __pyx_L1_error)
+  if (unlikely(!__pyx_v_indices.memview)) { __Pyx_RaiseUnboundLocalError("indices"); __PYX_ERR(0, 375, __pyx_L1_error) }
+  if (unlikely(!__pyx_v_indptr.memview)) { __Pyx_RaiseUnboundLocalError("indptr"); __PYX_ERR(0, 375, __pyx_L1_error) }
+  if (unlikely(!__pyx_v_data.memview)) { __Pyx_RaiseUnboundLocalError("data"); __PYX_ERR(0, 375, __pyx_L1_error) }
+  if (unlikely(!__pyx_v_x_norm.memview)) { __Pyx_RaiseUnboundLocalError("x_norm"); __PYX_ERR(0, 375, __pyx_L1_error) }
+  __pyx_t_1 = __pyx_f_7libreco_5utils_13_similarities_forward_cosine(__pyx_v_indices, __pyx_v_indptr, __pyx_v_data, __pyx_v_x_norm, __pyx_v_min_common, __pyx_v_n_x, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 375, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6778,20 +6775,20 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_data, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_x_norm, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "libreco/utils/_similarities.pyx":419
+/* "libreco/utils/_similarities.pyx":431
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cpdef forward_pearson(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *                       const float[:] data, const float[:] x_mean,
- *                       const float[:] x_mean_centered_norm,
+ * cpdef forward_pearson(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
 static PyObject *__pyx_pw_7libreco_5utils_13_similarities_9forward_pearson(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static PyObject *__pyx_f_7libreco_5utils_13_similarities_forward_pearson(__Pyx_memviewslice __pyx_v_indices, __Pyx_memviewslice __pyx_v_indptr, __Pyx_memviewslice __pyx_v_data, __Pyx_memviewslice __pyx_v_x_mean, __Pyx_memviewslice __pyx_v_x_mean_centered_norm, int __pyx_v_min_common, int __pyx_v_n_x, CYTHON_UNUSED int __pyx_skip_dispatch) {
   Py_ssize_t __pyx_v_x1;
   Py_ssize_t __pyx_v_x2;
   Py_ssize_t __pyx_v_y1;
@@ -6827,135 +6824,135 @@
   PyObject *__pyx_t_13 = NULL;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("forward_pearson", 0);
 
-  /* "libreco/utils/_similarities.pyx":428
+  /* "libreco/utils/_similarities.pyx":444
  *     cdef vector[uint] res_indices, res_indptr
  *     cdef vector[float] res_data
  *     res_indptr.reserve(n_x + 1)             # <<<<<<<<<<<<<<
  *     res_indptr.push_back(0)
  * 
  */
   __pyx_v_res_indptr.reserve((__pyx_v_n_x + 1));
 
-  /* "libreco/utils/_similarities.pyx":429
+  /* "libreco/utils/_similarities.pyx":445
  *     cdef vector[float] res_data
  *     res_indptr.reserve(n_x + 1)
  *     res_indptr.push_back(0)             # <<<<<<<<<<<<<<
  * 
  *     with nogil:
  */
   try {
     __pyx_v_res_indptr.push_back(0);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 429, __pyx_L1_error)
+    __PYX_ERR(0, 445, __pyx_L1_error)
   }
 
-  /* "libreco/utils/_similarities.pyx":431
+  /* "libreco/utils/_similarities.pyx":447
  *     res_indptr.push_back(0)
  * 
  *     with nogil:             # <<<<<<<<<<<<<<
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):
  */
   {
       #ifdef WITH_THREAD
       PyThreadState *_save;
       Py_UNBLOCK_THREADS
       __Pyx_FastGIL_Remember();
       #endif
       /*try:*/ {
 
-        /* "libreco/utils/_similarities.pyx":432
+        /* "libreco/utils/_similarities.pyx":448
  * 
  *     with nogil:
  *         for x1 in range(n_x):             # <<<<<<<<<<<<<<
  *             for x2 in range(x1 + 1, n_x):
  *                 i = indptr[x1]
  */
         __pyx_t_1 = __pyx_v_n_x;
         __pyx_t_2 = __pyx_t_1;
         for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
           __pyx_v_x1 = __pyx_t_3;
 
-          /* "libreco/utils/_similarities.pyx":433
+          /* "libreco/utils/_similarities.pyx":449
  *     with nogil:
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):             # <<<<<<<<<<<<<<
  *                 i = indptr[x1]
  *                 j = indptr[x2]
  */
           __pyx_t_4 = __pyx_v_n_x;
           __pyx_t_5 = __pyx_t_4;
           for (__pyx_t_6 = (__pyx_v_x1 + 1); __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
             __pyx_v_x2 = __pyx_t_6;
 
-            /* "libreco/utils/_similarities.pyx":434
+            /* "libreco/utils/_similarities.pyx":450
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):
  *                 i = indptr[x1]             # <<<<<<<<<<<<<<
  *                 j = indptr[x2]
  *                 end1 = indptr[x1 + 1]
  */
             __pyx_t_7 = __pyx_v_x1;
             __pyx_v_i = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":435
+            /* "libreco/utils/_similarities.pyx":451
  *             for x2 in range(x1 + 1, n_x):
  *                 i = indptr[x1]
  *                 j = indptr[x2]             # <<<<<<<<<<<<<<
  *                 end1 = indptr[x1 + 1]
  *                 end2 = indptr[x2 + 1]
  */
             __pyx_t_7 = __pyx_v_x2;
             __pyx_v_j = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":436
+            /* "libreco/utils/_similarities.pyx":452
  *                 i = indptr[x1]
  *                 j = indptr[x2]
  *                 end1 = indptr[x1 + 1]             # <<<<<<<<<<<<<<
  *                 end2 = indptr[x2 + 1]
  * 
  */
             __pyx_t_7 = (__pyx_v_x1 + 1);
             __pyx_v_end1 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":437
+            /* "libreco/utils/_similarities.pyx":453
  *                 j = indptr[x2]
  *                 end1 = indptr[x1 + 1]
  *                 end2 = indptr[x2 + 1]             # <<<<<<<<<<<<<<
  * 
  *                 prods = 0.0
  */
             __pyx_t_7 = (__pyx_v_x2 + 1);
             __pyx_v_end2 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":439
+            /* "libreco/utils/_similarities.pyx":455
  *                 end2 = indptr[x2 + 1]
  * 
  *                 prods = 0.0             # <<<<<<<<<<<<<<
  *                 count = 0
  *                 # compute common items
  */
             __pyx_v_prods = 0.0;
 
-            /* "libreco/utils/_similarities.pyx":440
+            /* "libreco/utils/_similarities.pyx":456
  * 
  *                 prods = 0.0
  *                 count = 0             # <<<<<<<<<<<<<<
  *                 # compute common items
  *                 while (i < end1 and j < end2):
  */
             __pyx_v_count = 0;
 
-            /* "libreco/utils/_similarities.pyx":442
+            /* "libreco/utils/_similarities.pyx":458
  *                 count = 0
  *                 # compute common items
  *                 while (i < end1 and j < end2):             # <<<<<<<<<<<<<<
  *                     y1 = indices[i]
  *                     y2 = indices[j]
  */
             while (1) {
@@ -6966,165 +6963,165 @@
                 goto __pyx_L12_bool_binop_done;
               }
               __pyx_t_9 = ((__pyx_v_j < __pyx_v_end2) != 0);
               __pyx_t_8 = __pyx_t_9;
               __pyx_L12_bool_binop_done:;
               if (!__pyx_t_8) break;
 
-              /* "libreco/utils/_similarities.pyx":443
+              /* "libreco/utils/_similarities.pyx":459
  *                 # compute common items
  *                 while (i < end1 and j < end2):
  *                     y1 = indices[i]             # <<<<<<<<<<<<<<
  *                     y2 = indices[j]
  *                     if y1 < y2:
  */
               __pyx_t_7 = __pyx_v_i;
               __pyx_v_y1 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_7 * __pyx_v_indices.strides[0]) )));
 
-              /* "libreco/utils/_similarities.pyx":444
+              /* "libreco/utils/_similarities.pyx":460
  *                 while (i < end1 and j < end2):
  *                     y1 = indices[i]
  *                     y2 = indices[j]             # <<<<<<<<<<<<<<
  *                     if y1 < y2:
  *                         i += 1
  */
               __pyx_t_7 = __pyx_v_j;
               __pyx_v_y2 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_7 * __pyx_v_indices.strides[0]) )));
 
-              /* "libreco/utils/_similarities.pyx":445
+              /* "libreco/utils/_similarities.pyx":461
  *                     y1 = indices[i]
  *                     y2 = indices[j]
  *                     if y1 < y2:             # <<<<<<<<<<<<<<
  *                         i += 1
  *                     elif y1 > y2:
  */
               __pyx_t_8 = ((__pyx_v_y1 < __pyx_v_y2) != 0);
               if (__pyx_t_8) {
 
-                /* "libreco/utils/_similarities.pyx":446
+                /* "libreco/utils/_similarities.pyx":462
  *                     y2 = indices[j]
  *                     if y1 < y2:
  *                         i += 1             # <<<<<<<<<<<<<<
  *                     elif y1 > y2:
  *                         j += 1
  */
                 __pyx_v_i = (__pyx_v_i + 1);
 
-                /* "libreco/utils/_similarities.pyx":445
+                /* "libreco/utils/_similarities.pyx":461
  *                     y1 = indices[i]
  *                     y2 = indices[j]
  *                     if y1 < y2:             # <<<<<<<<<<<<<<
  *                         i += 1
  *                     elif y1 > y2:
  */
                 goto __pyx_L14;
               }
 
-              /* "libreco/utils/_similarities.pyx":447
+              /* "libreco/utils/_similarities.pyx":463
  *                     if y1 < y2:
  *                         i += 1
  *                     elif y1 > y2:             # <<<<<<<<<<<<<<
  *                         j += 1
  *                     else:
  */
               __pyx_t_8 = ((__pyx_v_y1 > __pyx_v_y2) != 0);
               if (__pyx_t_8) {
 
-                /* "libreco/utils/_similarities.pyx":448
+                /* "libreco/utils/_similarities.pyx":464
  *                         i += 1
  *                     elif y1 > y2:
  *                         j += 1             # <<<<<<<<<<<<<<
  *                     else:
  *                         count += 1
  */
                 __pyx_v_j = (__pyx_v_j + 1);
 
-                /* "libreco/utils/_similarities.pyx":447
+                /* "libreco/utils/_similarities.pyx":463
  *                     if y1 < y2:
  *                         i += 1
  *                     elif y1 > y2:             # <<<<<<<<<<<<<<
  *                         j += 1
  *                     else:
  */
                 goto __pyx_L14;
               }
 
-              /* "libreco/utils/_similarities.pyx":450
+              /* "libreco/utils/_similarities.pyx":466
  *                         j += 1
  *                     else:
  *                         count += 1             # <<<<<<<<<<<<<<
  *                         smean1 = data[i] - x_mean[x1]
  *                         smean2 = data[j] - x_mean[x2]
  */
               /*else*/ {
                 __pyx_v_count = (__pyx_v_count + 1);
 
-                /* "libreco/utils/_similarities.pyx":451
+                /* "libreco/utils/_similarities.pyx":467
  *                     else:
  *                         count += 1
  *                         smean1 = data[i] - x_mean[x1]             # <<<<<<<<<<<<<<
  *                         smean2 = data[j] - x_mean[x2]
  *                         prods += (smean1 * smean2)
  */
                 __pyx_t_7 = __pyx_v_i;
                 __pyx_t_10 = __pyx_v_x1;
                 __pyx_v_smean1 = ((*((float const  *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_7 * __pyx_v_data.strides[0]) ))) - (*((float const  *) ( /* dim=0 */ (__pyx_v_x_mean.data + __pyx_t_10 * __pyx_v_x_mean.strides[0]) ))));
 
-                /* "libreco/utils/_similarities.pyx":452
+                /* "libreco/utils/_similarities.pyx":468
  *                         count += 1
  *                         smean1 = data[i] - x_mean[x1]
  *                         smean2 = data[j] - x_mean[x2]             # <<<<<<<<<<<<<<
  *                         prods += (smean1 * smean2)
  *                         i += 1
  */
                 __pyx_t_10 = __pyx_v_j;
                 __pyx_t_7 = __pyx_v_x2;
                 __pyx_v_smean2 = ((*((float const  *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_10 * __pyx_v_data.strides[0]) ))) - (*((float const  *) ( /* dim=0 */ (__pyx_v_x_mean.data + __pyx_t_7 * __pyx_v_x_mean.strides[0]) ))));
 
-                /* "libreco/utils/_similarities.pyx":453
+                /* "libreco/utils/_similarities.pyx":469
  *                         smean1 = data[i] - x_mean[x1]
  *                         smean2 = data[j] - x_mean[x2]
  *                         prods += (smean1 * smean2)             # <<<<<<<<<<<<<<
  *                         i += 1
  *                         j += 1
  */
                 __pyx_v_prods = (__pyx_v_prods + (__pyx_v_smean1 * __pyx_v_smean2));
 
-                /* "libreco/utils/_similarities.pyx":454
+                /* "libreco/utils/_similarities.pyx":470
  *                         smean2 = data[j] - x_mean[x2]
  *                         prods += (smean1 * smean2)
  *                         i += 1             # <<<<<<<<<<<<<<
  *                         j += 1
  * 
  */
                 __pyx_v_i = (__pyx_v_i + 1);
 
-                /* "libreco/utils/_similarities.pyx":455
+                /* "libreco/utils/_similarities.pyx":471
  *                         prods += (smean1 * smean2)
  *                         i += 1
  *                         j += 1             # <<<<<<<<<<<<<<
  * 
  *                 if count >= min_common:
  */
                 __pyx_v_j = (__pyx_v_j + 1);
               }
               __pyx_L14:;
             }
 
-            /* "libreco/utils/_similarities.pyx":457
+            /* "libreco/utils/_similarities.pyx":473
  *                         j += 1
  * 
  *                 if count >= min_common:             # <<<<<<<<<<<<<<
  *                     res_indices.push_back(x2)
  *                     sqi = x_mean_centered_norm[x1]
  */
             __pyx_t_8 = ((__pyx_v_count >= __pyx_v_min_common) != 0);
             if (__pyx_t_8) {
 
-              /* "libreco/utils/_similarities.pyx":458
+              /* "libreco/utils/_similarities.pyx":474
  * 
  *                 if count >= min_common:
  *                     res_indices.push_back(x2)             # <<<<<<<<<<<<<<
  *                     sqi = x_mean_centered_norm[x1]
  *                     sqj = x_mean_centered_norm[x2]
  */
               try {
@@ -7133,38 +7130,38 @@
                 #ifdef WITH_THREAD
                 PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
                 #endif
                 __Pyx_CppExn2PyErr();
                 #ifdef WITH_THREAD
                 __Pyx_PyGILState_Release(__pyx_gilstate_save);
                 #endif
-                __PYX_ERR(0, 458, __pyx_L4_error)
+                __PYX_ERR(0, 474, __pyx_L4_error)
               }
 
-              /* "libreco/utils/_similarities.pyx":459
+              /* "libreco/utils/_similarities.pyx":475
  *                 if count >= min_common:
  *                     res_indices.push_back(x2)
  *                     sqi = x_mean_centered_norm[x1]             # <<<<<<<<<<<<<<
  *                     sqj = x_mean_centered_norm[x2]
  *                     if prods == 0.0 or sqi == 0.0 or sqj == 0.0:
  */
               __pyx_t_7 = __pyx_v_x1;
               __pyx_v_sqi = (*((float const  *) ( /* dim=0 */ (__pyx_v_x_mean_centered_norm.data + __pyx_t_7 * __pyx_v_x_mean_centered_norm.strides[0]) )));
 
-              /* "libreco/utils/_similarities.pyx":460
+              /* "libreco/utils/_similarities.pyx":476
  *                     res_indices.push_back(x2)
  *                     sqi = x_mean_centered_norm[x1]
  *                     sqj = x_mean_centered_norm[x2]             # <<<<<<<<<<<<<<
  *                     if prods == 0.0 or sqi == 0.0 or sqj == 0.0:
  *                         pearson = 0.0
  */
               __pyx_t_7 = __pyx_v_x2;
               __pyx_v_sqj = (*((float const  *) ( /* dim=0 */ (__pyx_v_x_mean_centered_norm.data + __pyx_t_7 * __pyx_v_x_mean_centered_norm.strides[0]) )));
 
-              /* "libreco/utils/_similarities.pyx":461
+              /* "libreco/utils/_similarities.pyx":477
  *                     sqi = x_mean_centered_norm[x1]
  *                     sqj = x_mean_centered_norm[x2]
  *                     if prods == 0.0 or sqi == 0.0 or sqj == 0.0:             # <<<<<<<<<<<<<<
  *                         pearson = 0.0
  *                     else:
  */
               __pyx_t_9 = ((__pyx_v_prods == 0.0) != 0);
@@ -7180,46 +7177,46 @@
                 goto __pyx_L17_bool_binop_done;
               }
               __pyx_t_9 = ((__pyx_v_sqj == 0.0) != 0);
               __pyx_t_8 = __pyx_t_9;
               __pyx_L17_bool_binop_done:;
               if (__pyx_t_8) {
 
-                /* "libreco/utils/_similarities.pyx":462
+                /* "libreco/utils/_similarities.pyx":478
  *                     sqj = x_mean_centered_norm[x2]
  *                     if prods == 0.0 or sqi == 0.0 or sqj == 0.0:
  *                         pearson = 0.0             # <<<<<<<<<<<<<<
  *                     else:
  *                         pearson = prods / (sqi * sqj)
  */
                 __pyx_v_pearson = 0.0;
 
-                /* "libreco/utils/_similarities.pyx":461
+                /* "libreco/utils/_similarities.pyx":477
  *                     sqi = x_mean_centered_norm[x1]
  *                     sqj = x_mean_centered_norm[x2]
  *                     if prods == 0.0 or sqi == 0.0 or sqj == 0.0:             # <<<<<<<<<<<<<<
  *                         pearson = 0.0
  *                     else:
  */
                 goto __pyx_L16;
               }
 
-              /* "libreco/utils/_similarities.pyx":464
+              /* "libreco/utils/_similarities.pyx":480
  *                         pearson = 0.0
  *                     else:
  *                         pearson = prods / (sqi * sqj)             # <<<<<<<<<<<<<<
  *                     res_data.push_back(pearson)
  *             res_indptr.push_back(res_indices.size())
  */
               /*else*/ {
                 __pyx_v_pearson = (__pyx_v_prods / (__pyx_v_sqi * __pyx_v_sqj));
               }
               __pyx_L16:;
 
-              /* "libreco/utils/_similarities.pyx":465
+              /* "libreco/utils/_similarities.pyx":481
  *                     else:
  *                         pearson = prods / (sqi * sqj)
  *                     res_data.push_back(pearson)             # <<<<<<<<<<<<<<
  *             res_indptr.push_back(res_indices.size())
  * 
  */
               try {
@@ -7228,28 +7225,28 @@
                 #ifdef WITH_THREAD
                 PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
                 #endif
                 __Pyx_CppExn2PyErr();
                 #ifdef WITH_THREAD
                 __Pyx_PyGILState_Release(__pyx_gilstate_save);
                 #endif
-                __PYX_ERR(0, 465, __pyx_L4_error)
+                __PYX_ERR(0, 481, __pyx_L4_error)
               }
 
-              /* "libreco/utils/_similarities.pyx":457
+              /* "libreco/utils/_similarities.pyx":473
  *                         j += 1
  * 
  *                 if count >= min_common:             # <<<<<<<<<<<<<<
  *                     res_indices.push_back(x2)
  *                     sqi = x_mean_centered_norm[x1]
  */
             }
           }
 
-          /* "libreco/utils/_similarities.pyx":466
+          /* "libreco/utils/_similarities.pyx":482
  *                         pearson = prods / (sqi * sqj)
  *                     res_data.push_back(pearson)
  *             res_indptr.push_back(res_indices.size())             # <<<<<<<<<<<<<<
  * 
  *     return res_indices, res_indptr, res_data
  */
           try {
@@ -7258,20 +7255,20 @@
             #ifdef WITH_THREAD
             PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
             #endif
             __Pyx_CppExn2PyErr();
             #ifdef WITH_THREAD
             __Pyx_PyGILState_Release(__pyx_gilstate_save);
             #endif
-            __PYX_ERR(0, 466, __pyx_L4_error)
+            __PYX_ERR(0, 482, __pyx_L4_error)
           }
         }
       }
 
-      /* "libreco/utils/_similarities.pyx":431
+      /* "libreco/utils/_similarities.pyx":447
  *     res_indptr.push_back(0)
  * 
  *     with nogil:             # <<<<<<<<<<<<<<
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):
  */
       /*finally:*/ {
@@ -7289,49 +7286,49 @@
           #endif
           goto __pyx_L1_error;
         }
         __pyx_L5:;
       }
   }
 
-  /* "libreco/utils/_similarities.pyx":468
+  /* "libreco/utils/_similarities.pyx":484
  *             res_indptr.push_back(res_indices.size())
  * 
  *     return res_indices, res_indptr, res_data             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_11 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indices); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 468, __pyx_L1_error)
+  __pyx_t_11 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indices); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
-  __pyx_t_12 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indptr); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 468, __pyx_L1_error)
+  __pyx_t_12 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indptr); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_12);
-  __pyx_t_13 = __pyx_convert_vector_to_py_float(__pyx_v_res_data); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 468, __pyx_L1_error)
+  __pyx_t_13 = __pyx_convert_vector_to_py_float(__pyx_v_res_data); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 468, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_GIVEREF(__pyx_t_11);
   PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_11);
   __Pyx_GIVEREF(__pyx_t_12);
   PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_12);
   __Pyx_GIVEREF(__pyx_t_13);
   PyTuple_SET_ITEM(__pyx_t_14, 2, __pyx_t_13);
   __pyx_t_11 = 0;
   __pyx_t_12 = 0;
   __pyx_t_13 = 0;
   __pyx_r = __pyx_t_14;
   __pyx_t_14 = 0;
   goto __pyx_L0;
 
-  /* "libreco/utils/_similarities.pyx":419
+  /* "libreco/utils/_similarities.pyx":431
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cpdef forward_pearson(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *                       const float[:] data, const float[:] x_mean,
- *                       const float[:] x_mean_centered_norm,
+ * cpdef forward_pearson(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_11);
   __Pyx_XDECREF(__pyx_t_12);
   __Pyx_XDECREF(__pyx_t_13);
@@ -7389,72 +7386,72 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indptr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 1); __PYX_ERR(0, 419, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 1); __PYX_ERR(0, 431, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 2); __PYX_ERR(0, 419, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 2); __PYX_ERR(0, 431, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_x_mean)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 3); __PYX_ERR(0, 419, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 3); __PYX_ERR(0, 431, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_x_mean_centered_norm)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 4); __PYX_ERR(0, 419, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 4); __PYX_ERR(0, 431, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_min_common)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 5); __PYX_ERR(0, 419, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 5); __PYX_ERR(0, 431, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n_x)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 6); __PYX_ERR(0, 419, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, 6); __PYX_ERR(0, 431, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "forward_pearson") < 0)) __PYX_ERR(0, 419, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "forward_pearson") < 0)) __PYX_ERR(0, 431, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 7) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
       values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
     }
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[0], 0); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 419, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[1], 0); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 419, __pyx_L3_error)
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[2], 0); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 420, __pyx_L3_error)
-    __pyx_v_x_mean = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[3], 0); if (unlikely(!__pyx_v_x_mean.memview)) __PYX_ERR(0, 420, __pyx_L3_error)
-    __pyx_v_x_mean_centered_norm = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[4], 0); if (unlikely(!__pyx_v_x_mean_centered_norm.memview)) __PYX_ERR(0, 421, __pyx_L3_error)
-    __pyx_v_min_common = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_min_common == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 422, __pyx_L3_error)
-    __pyx_v_n_x = __Pyx_PyInt_As_int(values[6]); if (unlikely((__pyx_v_n_x == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 422, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[0], 0); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 432, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[1], 0); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 433, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[2], 0); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 434, __pyx_L3_error)
+    __pyx_v_x_mean = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[3], 0); if (unlikely(!__pyx_v_x_mean.memview)) __PYX_ERR(0, 435, __pyx_L3_error)
+    __pyx_v_x_mean_centered_norm = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[4], 0); if (unlikely(!__pyx_v_x_mean_centered_norm.memview)) __PYX_ERR(0, 436, __pyx_L3_error)
+    __pyx_v_min_common = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_min_common == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 437, __pyx_L3_error)
+    __pyx_v_n_x = __Pyx_PyInt_As_int(values[6]); if (unlikely((__pyx_v_n_x == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 438, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 419, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("forward_pearson", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 431, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("libreco.utils._similarities.forward_pearson", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_7libreco_5utils_13_similarities_8forward_pearson(__pyx_self, __pyx_v_indices, __pyx_v_indptr, __pyx_v_data, __pyx_v_x_mean, __pyx_v_x_mean_centered_norm, __pyx_v_min_common, __pyx_v_n_x);
 
@@ -7468,20 +7465,20 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("forward_pearson", 0);
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_v_indices.memview)) { __Pyx_RaiseUnboundLocalError("indices"); __PYX_ERR(0, 419, __pyx_L1_error) }
-  if (unlikely(!__pyx_v_indptr.memview)) { __Pyx_RaiseUnboundLocalError("indptr"); __PYX_ERR(0, 419, __pyx_L1_error) }
-  if (unlikely(!__pyx_v_data.memview)) { __Pyx_RaiseUnboundLocalError("data"); __PYX_ERR(0, 419, __pyx_L1_error) }
-  if (unlikely(!__pyx_v_x_mean.memview)) { __Pyx_RaiseUnboundLocalError("x_mean"); __PYX_ERR(0, 419, __pyx_L1_error) }
-  if (unlikely(!__pyx_v_x_mean_centered_norm.memview)) { __Pyx_RaiseUnboundLocalError("x_mean_centered_norm"); __PYX_ERR(0, 419, __pyx_L1_error) }
-  __pyx_t_1 = __pyx_f_7libreco_5utils_13_similarities_forward_pearson(__pyx_v_indices, __pyx_v_indptr, __pyx_v_data, __pyx_v_x_mean, __pyx_v_x_mean_centered_norm, __pyx_v_min_common, __pyx_v_n_x, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 419, __pyx_L1_error)
+  if (unlikely(!__pyx_v_indices.memview)) { __Pyx_RaiseUnboundLocalError("indices"); __PYX_ERR(0, 431, __pyx_L1_error) }
+  if (unlikely(!__pyx_v_indptr.memview)) { __Pyx_RaiseUnboundLocalError("indptr"); __PYX_ERR(0, 431, __pyx_L1_error) }
+  if (unlikely(!__pyx_v_data.memview)) { __Pyx_RaiseUnboundLocalError("data"); __PYX_ERR(0, 431, __pyx_L1_error) }
+  if (unlikely(!__pyx_v_x_mean.memview)) { __Pyx_RaiseUnboundLocalError("x_mean"); __PYX_ERR(0, 431, __pyx_L1_error) }
+  if (unlikely(!__pyx_v_x_mean_centered_norm.memview)) { __Pyx_RaiseUnboundLocalError("x_mean_centered_norm"); __PYX_ERR(0, 431, __pyx_L1_error) }
+  __pyx_t_1 = __pyx_f_7libreco_5utils_13_similarities_forward_pearson(__pyx_v_indices, __pyx_v_indptr, __pyx_v_data, __pyx_v_x_mean, __pyx_v_x_mean_centered_norm, __pyx_v_min_common, __pyx_v_n_x, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 431, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -7495,20 +7492,20 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_x_mean, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_x_mean_centered_norm, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "libreco/utils/_similarities.pyx":474
+/* "libreco/utils/_similarities.pyx":490
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cpdef forward_jaccard(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *                       const float[:] data, const int[:] x_count,
- *                       int min_common, int n_x):
+ * cpdef forward_jaccard(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
 static PyObject *__pyx_pw_7libreco_5utils_13_similarities_11forward_jaccard(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static PyObject *__pyx_f_7libreco_5utils_13_similarities_forward_jaccard(__Pyx_memviewslice __pyx_v_indices, __Pyx_memviewslice __pyx_v_indptr, CYTHON_UNUSED __Pyx_memviewslice __pyx_v_data, __Pyx_memviewslice __pyx_v_x_count, int __pyx_v_min_common, int __pyx_v_n_x, CYTHON_UNUSED int __pyx_skip_dispatch) {
   Py_ssize_t __pyx_v_x1;
   Py_ssize_t __pyx_v_x2;
   Py_ssize_t __pyx_v_y1;
@@ -7540,126 +7537,126 @@
   PyObject *__pyx_t_13 = NULL;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("forward_jaccard", 0);
 
-  /* "libreco/utils/_similarities.pyx":482
+  /* "libreco/utils/_similarities.pyx":502
  *     cdef vector[uint] res_indices, res_indptr
  *     cdef vector[float] res_data
  *     res_indptr.reserve(n_x + 1)             # <<<<<<<<<<<<<<
  *     res_indptr.push_back(0)
  * 
  */
   __pyx_v_res_indptr.reserve((__pyx_v_n_x + 1));
 
-  /* "libreco/utils/_similarities.pyx":483
+  /* "libreco/utils/_similarities.pyx":503
  *     cdef vector[float] res_data
  *     res_indptr.reserve(n_x + 1)
  *     res_indptr.push_back(0)             # <<<<<<<<<<<<<<
  * 
  *     with nogil:
  */
   try {
     __pyx_v_res_indptr.push_back(0);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 483, __pyx_L1_error)
+    __PYX_ERR(0, 503, __pyx_L1_error)
   }
 
-  /* "libreco/utils/_similarities.pyx":485
+  /* "libreco/utils/_similarities.pyx":505
  *     res_indptr.push_back(0)
  * 
  *     with nogil:             # <<<<<<<<<<<<<<
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):
  */
   {
       #ifdef WITH_THREAD
       PyThreadState *_save;
       Py_UNBLOCK_THREADS
       __Pyx_FastGIL_Remember();
       #endif
       /*try:*/ {
 
-        /* "libreco/utils/_similarities.pyx":486
+        /* "libreco/utils/_similarities.pyx":506
  * 
  *     with nogil:
  *         for x1 in range(n_x):             # <<<<<<<<<<<<<<
  *             for x2 in range(x1 + 1, n_x):
  *                 i = indptr[x1]
  */
         __pyx_t_1 = __pyx_v_n_x;
         __pyx_t_2 = __pyx_t_1;
         for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
           __pyx_v_x1 = __pyx_t_3;
 
-          /* "libreco/utils/_similarities.pyx":487
+          /* "libreco/utils/_similarities.pyx":507
  *     with nogil:
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):             # <<<<<<<<<<<<<<
  *                 i = indptr[x1]
  *                 j = indptr[x2]
  */
           __pyx_t_4 = __pyx_v_n_x;
           __pyx_t_5 = __pyx_t_4;
           for (__pyx_t_6 = (__pyx_v_x1 + 1); __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
             __pyx_v_x2 = __pyx_t_6;
 
-            /* "libreco/utils/_similarities.pyx":488
+            /* "libreco/utils/_similarities.pyx":508
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):
  *                 i = indptr[x1]             # <<<<<<<<<<<<<<
  *                 j = indptr[x2]
  *                 end1 = indptr[x1 + 1]
  */
             __pyx_t_7 = __pyx_v_x1;
             __pyx_v_i = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":489
+            /* "libreco/utils/_similarities.pyx":509
  *             for x2 in range(x1 + 1, n_x):
  *                 i = indptr[x1]
  *                 j = indptr[x2]             # <<<<<<<<<<<<<<
  *                 end1 = indptr[x1 + 1]
  *                 end2 = indptr[x2 + 1]
  */
             __pyx_t_7 = __pyx_v_x2;
             __pyx_v_j = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":490
+            /* "libreco/utils/_similarities.pyx":510
  *                 i = indptr[x1]
  *                 j = indptr[x2]
  *                 end1 = indptr[x1 + 1]             # <<<<<<<<<<<<<<
  *                 end2 = indptr[x2 + 1]
  * 
  */
             __pyx_t_7 = (__pyx_v_x1 + 1);
             __pyx_v_end1 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":491
+            /* "libreco/utils/_similarities.pyx":511
  *                 j = indptr[x2]
  *                 end1 = indptr[x1 + 1]
  *                 end2 = indptr[x2 + 1]             # <<<<<<<<<<<<<<
  * 
  *                 intersection = 0.0
  */
             __pyx_t_7 = (__pyx_v_x2 + 1);
             __pyx_v_end2 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_7 * __pyx_v_indptr.strides[0]) )));
 
-            /* "libreco/utils/_similarities.pyx":493
+            /* "libreco/utils/_similarities.pyx":513
  *                 end2 = indptr[x2 + 1]
  * 
  *                 intersection = 0.0             # <<<<<<<<<<<<<<
  *                 while (i < end1 and j < end2):
  *                     y1 = indices[i]
  */
             __pyx_v_intersection = 0.0;
 
-            /* "libreco/utils/_similarities.pyx":494
+            /* "libreco/utils/_similarities.pyx":514
  * 
  *                 intersection = 0.0
  *                 while (i < end1 and j < end2):             # <<<<<<<<<<<<<<
  *                     y1 = indices[i]
  *                     y2 = indices[j]
  */
             while (1) {
@@ -7670,134 +7667,134 @@
                 goto __pyx_L12_bool_binop_done;
               }
               __pyx_t_9 = ((__pyx_v_j < __pyx_v_end2) != 0);
               __pyx_t_8 = __pyx_t_9;
               __pyx_L12_bool_binop_done:;
               if (!__pyx_t_8) break;
 
-              /* "libreco/utils/_similarities.pyx":495
+              /* "libreco/utils/_similarities.pyx":515
  *                 intersection = 0.0
  *                 while (i < end1 and j < end2):
  *                     y1 = indices[i]             # <<<<<<<<<<<<<<
  *                     y2 = indices[j]
  *                     if y1 < y2:
  */
               __pyx_t_7 = __pyx_v_i;
               __pyx_v_y1 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_7 * __pyx_v_indices.strides[0]) )));
 
-              /* "libreco/utils/_similarities.pyx":496
+              /* "libreco/utils/_similarities.pyx":516
  *                 while (i < end1 and j < end2):
  *                     y1 = indices[i]
  *                     y2 = indices[j]             # <<<<<<<<<<<<<<
  *                     if y1 < y2:
  *                         i += 1
  */
               __pyx_t_7 = __pyx_v_j;
               __pyx_v_y2 = (*((int const  *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_7 * __pyx_v_indices.strides[0]) )));
 
-              /* "libreco/utils/_similarities.pyx":497
+              /* "libreco/utils/_similarities.pyx":517
  *                     y1 = indices[i]
  *                     y2 = indices[j]
  *                     if y1 < y2:             # <<<<<<<<<<<<<<
  *                         i += 1
  *                     elif y1 > y2:
  */
               __pyx_t_8 = ((__pyx_v_y1 < __pyx_v_y2) != 0);
               if (__pyx_t_8) {
 
-                /* "libreco/utils/_similarities.pyx":498
+                /* "libreco/utils/_similarities.pyx":518
  *                     y2 = indices[j]
  *                     if y1 < y2:
  *                         i += 1             # <<<<<<<<<<<<<<
  *                     elif y1 > y2:
  *                         j += 1
  */
                 __pyx_v_i = (__pyx_v_i + 1);
 
-                /* "libreco/utils/_similarities.pyx":497
+                /* "libreco/utils/_similarities.pyx":517
  *                     y1 = indices[i]
  *                     y2 = indices[j]
  *                     if y1 < y2:             # <<<<<<<<<<<<<<
  *                         i += 1
  *                     elif y1 > y2:
  */
                 goto __pyx_L14;
               }
 
-              /* "libreco/utils/_similarities.pyx":499
+              /* "libreco/utils/_similarities.pyx":519
  *                     if y1 < y2:
  *                         i += 1
  *                     elif y1 > y2:             # <<<<<<<<<<<<<<
  *                         j += 1
  *                     else:
  */
               __pyx_t_8 = ((__pyx_v_y1 > __pyx_v_y2) != 0);
               if (__pyx_t_8) {
 
-                /* "libreco/utils/_similarities.pyx":500
+                /* "libreco/utils/_similarities.pyx":520
  *                         i += 1
  *                     elif y1 > y2:
  *                         j += 1             # <<<<<<<<<<<<<<
  *                     else:
  *                         intersection += 1
  */
                 __pyx_v_j = (__pyx_v_j + 1);
 
-                /* "libreco/utils/_similarities.pyx":499
+                /* "libreco/utils/_similarities.pyx":519
  *                     if y1 < y2:
  *                         i += 1
  *                     elif y1 > y2:             # <<<<<<<<<<<<<<
  *                         j += 1
  *                     else:
  */
                 goto __pyx_L14;
               }
 
-              /* "libreco/utils/_similarities.pyx":502
+              /* "libreco/utils/_similarities.pyx":522
  *                         j += 1
  *                     else:
  *                         intersection += 1             # <<<<<<<<<<<<<<
  *                         i += 1
  *                         j += 1
  */
               /*else*/ {
                 __pyx_v_intersection = (__pyx_v_intersection + 1.0);
 
-                /* "libreco/utils/_similarities.pyx":503
+                /* "libreco/utils/_similarities.pyx":523
  *                     else:
  *                         intersection += 1
  *                         i += 1             # <<<<<<<<<<<<<<
  *                         j += 1
  * 
  */
                 __pyx_v_i = (__pyx_v_i + 1);
 
-                /* "libreco/utils/_similarities.pyx":504
+                /* "libreco/utils/_similarities.pyx":524
  *                         intersection += 1
  *                         i += 1
  *                         j += 1             # <<<<<<<<<<<<<<
  * 
  *                 if intersection >= min_common:
  */
                 __pyx_v_j = (__pyx_v_j + 1);
               }
               __pyx_L14:;
             }
 
-            /* "libreco/utils/_similarities.pyx":506
+            /* "libreco/utils/_similarities.pyx":526
  *                         j += 1
  * 
  *                 if intersection >= min_common:             # <<<<<<<<<<<<<<
  *                     res_indices.push_back(x2)
  *                     union = x_count[x1] + x_count[x2] - intersection
  */
             __pyx_t_8 = ((__pyx_v_intersection >= __pyx_v_min_common) != 0);
             if (__pyx_t_8) {
 
-              /* "libreco/utils/_similarities.pyx":507
+              /* "libreco/utils/_similarities.pyx":527
  * 
  *                 if intersection >= min_common:
  *                     res_indices.push_back(x2)             # <<<<<<<<<<<<<<
  *                     union = x_count[x1] + x_count[x2] - intersection
  *                     jaccard = intersection / union
  */
               try {
@@ -7806,38 +7803,38 @@
                 #ifdef WITH_THREAD
                 PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
                 #endif
                 __Pyx_CppExn2PyErr();
                 #ifdef WITH_THREAD
                 __Pyx_PyGILState_Release(__pyx_gilstate_save);
                 #endif
-                __PYX_ERR(0, 507, __pyx_L4_error)
+                __PYX_ERR(0, 527, __pyx_L4_error)
               }
 
-              /* "libreco/utils/_similarities.pyx":508
+              /* "libreco/utils/_similarities.pyx":528
  *                 if intersection >= min_common:
  *                     res_indices.push_back(x2)
  *                     union = x_count[x1] + x_count[x2] - intersection             # <<<<<<<<<<<<<<
  *                     jaccard = intersection / union
  *                     res_data.push_back(jaccard)
  */
               __pyx_t_7 = __pyx_v_x1;
               __pyx_t_10 = __pyx_v_x2;
               __pyx_v_union = (((*((int const  *) ( /* dim=0 */ (__pyx_v_x_count.data + __pyx_t_7 * __pyx_v_x_count.strides[0]) ))) + (*((int const  *) ( /* dim=0 */ (__pyx_v_x_count.data + __pyx_t_10 * __pyx_v_x_count.strides[0]) )))) - __pyx_v_intersection);
 
-              /* "libreco/utils/_similarities.pyx":509
+              /* "libreco/utils/_similarities.pyx":529
  *                     res_indices.push_back(x2)
  *                     union = x_count[x1] + x_count[x2] - intersection
  *                     jaccard = intersection / union             # <<<<<<<<<<<<<<
  *                     res_data.push_back(jaccard)
  *             res_indptr.push_back(res_indices.size())
  */
               __pyx_v_jaccard = (__pyx_v_intersection / __pyx_v_union);
 
-              /* "libreco/utils/_similarities.pyx":510
+              /* "libreco/utils/_similarities.pyx":530
  *                     union = x_count[x1] + x_count[x2] - intersection
  *                     jaccard = intersection / union
  *                     res_data.push_back(jaccard)             # <<<<<<<<<<<<<<
  *             res_indptr.push_back(res_indices.size())
  * 
  */
               try {
@@ -7846,28 +7843,28 @@
                 #ifdef WITH_THREAD
                 PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
                 #endif
                 __Pyx_CppExn2PyErr();
                 #ifdef WITH_THREAD
                 __Pyx_PyGILState_Release(__pyx_gilstate_save);
                 #endif
-                __PYX_ERR(0, 510, __pyx_L4_error)
+                __PYX_ERR(0, 530, __pyx_L4_error)
               }
 
-              /* "libreco/utils/_similarities.pyx":506
+              /* "libreco/utils/_similarities.pyx":526
  *                         j += 1
  * 
  *                 if intersection >= min_common:             # <<<<<<<<<<<<<<
  *                     res_indices.push_back(x2)
  *                     union = x_count[x1] + x_count[x2] - intersection
  */
             }
           }
 
-          /* "libreco/utils/_similarities.pyx":511
+          /* "libreco/utils/_similarities.pyx":531
  *                     jaccard = intersection / union
  *                     res_data.push_back(jaccard)
  *             res_indptr.push_back(res_indices.size())             # <<<<<<<<<<<<<<
  * 
  *     return res_indices, res_indptr, res_data
  */
           try {
@@ -7876,20 +7873,20 @@
             #ifdef WITH_THREAD
             PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
             #endif
             __Pyx_CppExn2PyErr();
             #ifdef WITH_THREAD
             __Pyx_PyGILState_Release(__pyx_gilstate_save);
             #endif
-            __PYX_ERR(0, 511, __pyx_L4_error)
+            __PYX_ERR(0, 531, __pyx_L4_error)
           }
         }
       }
 
-      /* "libreco/utils/_similarities.pyx":485
+      /* "libreco/utils/_similarities.pyx":505
  *     res_indptr.push_back(0)
  * 
  *     with nogil:             # <<<<<<<<<<<<<<
  *         for x1 in range(n_x):
  *             for x2 in range(x1 + 1, n_x):
  */
       /*finally:*/ {
@@ -7907,48 +7904,47 @@
           #endif
           goto __pyx_L1_error;
         }
         __pyx_L5:;
       }
   }
 
-  /* "libreco/utils/_similarities.pyx":513
+  /* "libreco/utils/_similarities.pyx":533
  *             res_indptr.push_back(res_indices.size())
  * 
  *     return res_indices, res_indptr, res_data             # <<<<<<<<<<<<<<
- * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_11 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indices); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 513, __pyx_L1_error)
+  __pyx_t_11 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indices); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 533, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
-  __pyx_t_12 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indptr); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 513, __pyx_L1_error)
+  __pyx_t_12 = __pyx_convert_vector_to_py_unsigned_int(__pyx_v_res_indptr); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 533, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_12);
-  __pyx_t_13 = __pyx_convert_vector_to_py_float(__pyx_v_res_data); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 513, __pyx_L1_error)
+  __pyx_t_13 = __pyx_convert_vector_to_py_float(__pyx_v_res_data); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 533, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 513, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 533, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_GIVEREF(__pyx_t_11);
   PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_11);
   __Pyx_GIVEREF(__pyx_t_12);
   PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_12);
   __Pyx_GIVEREF(__pyx_t_13);
   PyTuple_SET_ITEM(__pyx_t_14, 2, __pyx_t_13);
   __pyx_t_11 = 0;
   __pyx_t_12 = 0;
   __pyx_t_13 = 0;
   __pyx_r = __pyx_t_14;
   __pyx_t_14 = 0;
   goto __pyx_L0;
 
-  /* "libreco/utils/_similarities.pyx":474
+  /* "libreco/utils/_similarities.pyx":490
  * @cython.wraparound(False)
  * @cython.cdivision(True)
- * cpdef forward_jaccard(const int[:] indices, const int[:] indptr,             # <<<<<<<<<<<<<<
- *                       const float[:] data, const int[:] x_count,
- *                       int min_common, int n_x):
+ * cpdef forward_jaccard(             # <<<<<<<<<<<<<<
+ *     const int[:] indices,
+ *     const int[:] indptr,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_11);
   __Pyx_XDECREF(__pyx_t_12);
   __Pyx_XDECREF(__pyx_t_13);
@@ -8003,64 +7999,64 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indptr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, 1); __PYX_ERR(0, 474, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, 1); __PYX_ERR(0, 490, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, 2); __PYX_ERR(0, 474, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, 2); __PYX_ERR(0, 490, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_x_count)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, 3); __PYX_ERR(0, 474, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, 3); __PYX_ERR(0, 490, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_min_common)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, 4); __PYX_ERR(0, 474, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, 4); __PYX_ERR(0, 490, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n_x)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, 5); __PYX_ERR(0, 474, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, 5); __PYX_ERR(0, 490, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "forward_jaccard") < 0)) __PYX_ERR(0, 474, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "forward_jaccard") < 0)) __PYX_ERR(0, 490, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
     }
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[0], 0); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 474, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[1], 0); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 474, __pyx_L3_error)
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[2], 0); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 475, __pyx_L3_error)
-    __pyx_v_x_count = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[3], 0); if (unlikely(!__pyx_v_x_count.memview)) __PYX_ERR(0, 475, __pyx_L3_error)
-    __pyx_v_min_common = __Pyx_PyInt_As_int(values[4]); if (unlikely((__pyx_v_min_common == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 476, __pyx_L3_error)
-    __pyx_v_n_x = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_n_x == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 476, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[0], 0); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 491, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[1], 0); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 492, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float__const__(values[2], 0); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 493, __pyx_L3_error)
+    __pyx_v_x_count = __Pyx_PyObject_to_MemoryviewSlice_ds_int__const__(values[3], 0); if (unlikely(!__pyx_v_x_count.memview)) __PYX_ERR(0, 494, __pyx_L3_error)
+    __pyx_v_min_common = __Pyx_PyInt_As_int(values[4]); if (unlikely((__pyx_v_min_common == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 495, __pyx_L3_error)
+    __pyx_v_n_x = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_n_x == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 496, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 474, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("forward_jaccard", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 490, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("libreco.utils._similarities.forward_jaccard", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_7libreco_5utils_13_similarities_10forward_jaccard(__pyx_self, __pyx_v_indices, __pyx_v_indptr, __pyx_v_data, __pyx_v_x_count, __pyx_v_min_common, __pyx_v_n_x);
 
@@ -8074,19 +8070,19 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("forward_jaccard", 0);
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_v_indices.memview)) { __Pyx_RaiseUnboundLocalError("indices"); __PYX_ERR(0, 474, __pyx_L1_error) }
-  if (unlikely(!__pyx_v_indptr.memview)) { __Pyx_RaiseUnboundLocalError("indptr"); __PYX_ERR(0, 474, __pyx_L1_error) }
-  if (unlikely(!__pyx_v_data.memview)) { __Pyx_RaiseUnboundLocalError("data"); __PYX_ERR(0, 474, __pyx_L1_error) }
-  if (unlikely(!__pyx_v_x_count.memview)) { __Pyx_RaiseUnboundLocalError("x_count"); __PYX_ERR(0, 474, __pyx_L1_error) }
-  __pyx_t_1 = __pyx_f_7libreco_5utils_13_similarities_forward_jaccard(__pyx_v_indices, __pyx_v_indptr, __pyx_v_data, __pyx_v_x_count, __pyx_v_min_common, __pyx_v_n_x, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 474, __pyx_L1_error)
+  if (unlikely(!__pyx_v_indices.memview)) { __Pyx_RaiseUnboundLocalError("indices"); __PYX_ERR(0, 490, __pyx_L1_error) }
+  if (unlikely(!__pyx_v_indptr.memview)) { __Pyx_RaiseUnboundLocalError("indptr"); __PYX_ERR(0, 490, __pyx_L1_error) }
+  if (unlikely(!__pyx_v_data.memview)) { __Pyx_RaiseUnboundLocalError("data"); __PYX_ERR(0, 490, __pyx_L1_error) }
+  if (unlikely(!__pyx_v_x_count.memview)) { __Pyx_RaiseUnboundLocalError("x_count"); __PYX_ERR(0, 490, __pyx_L1_error) }
+  __pyx_t_1 = __pyx_f_7libreco_5utils_13_similarities_forward_jaccard(__pyx_v_indices, __pyx_v_indptr, __pyx_v_data, __pyx_v_x_count, __pyx_v_min_common, __pyx_v_n_x, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 490, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -8099,15 +8095,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_data, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_x_count, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":734
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":734
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -8116,29 +8112,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew1", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":735
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":735
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(1, ((void *)__pyx_v_a)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 735, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":734
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":734
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -8149,15 +8145,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":737
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":737
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -8166,29 +8162,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew2", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":738
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":738
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(2, ((void *)__pyx_v_a), ((void *)__pyx_v_b)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 738, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":737
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":737
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -8199,15 +8195,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":740
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":740
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -8216,29 +8212,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew3", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":741
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":741
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(3, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 741, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":740
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":740
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -8249,15 +8245,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":743
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":743
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -8266,29 +8262,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew4", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":744
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":744
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(4, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":743
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":743
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -8299,15 +8295,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":746
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":746
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -8316,29 +8312,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew5", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":747
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":747
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(5, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d), ((void *)__pyx_v_e)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 747, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":746
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":746
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -8349,212 +8345,212 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":749
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":749
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyDataType_SHAPE(PyArray_Descr *__pyx_v_d) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("PyDataType_SHAPE", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":750
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":750
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   __pyx_t_1 = (PyDataType_HASSUBARRAY(__pyx_v_d) != 0);
   if (__pyx_t_1) {
 
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":751
+    /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":751
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape             # <<<<<<<<<<<<<<
  *     else:
  *         return ()
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(((PyObject*)__pyx_v_d->subarray->shape));
     __pyx_r = ((PyObject*)__pyx_v_d->subarray->shape);
     goto __pyx_L0;
 
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":750
+    /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":750
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   }
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":753
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":753
  *         return <tuple>d.subarray.shape
  *     else:
  *         return ()             # <<<<<<<<<<<<<<
  * 
  * 
  */
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_empty_tuple);
     __pyx_r = __pyx_empty_tuple;
     goto __pyx_L0;
   }
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":749
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":749
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":928
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":928
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
 static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_array_base", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":929
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":929
  * 
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!             # <<<<<<<<<<<<<<
  *     PyArray_SetBaseObject(arr, base)
  * 
  */
   Py_INCREF(__pyx_v_base);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":930
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":930
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object get_array_base(ndarray arr):
  */
   (void)(PyArray_SetBaseObject(__pyx_v_arr, __pyx_v_base));
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":928
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":928
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":932
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":932
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__pyx_v_arr) {
   PyObject *__pyx_v_base;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("get_array_base", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":933
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":933
  * 
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)             # <<<<<<<<<<<<<<
  *     if base is NULL:
  *         return None
  */
   __pyx_v_base = PyArray_BASE(__pyx_v_arr);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":934
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":934
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   __pyx_t_1 = ((__pyx_v_base == NULL) != 0);
   if (__pyx_t_1) {
 
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":935
+    /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":935
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  *         return None             # <<<<<<<<<<<<<<
  *     return <object>base
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":934
+    /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":934
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   }
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":936
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":936
  *     if base is NULL:
  *         return None
  *     return <object>base             # <<<<<<<<<<<<<<
  * 
  * # Versions of the import_* functions which are more suitable for
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_base));
   __pyx_r = ((PyObject *)__pyx_v_base);
   goto __pyx_L0;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":932
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":932
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":940
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":940
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -8570,15 +8566,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_array", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":941
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
   {
@@ -8586,53 +8582,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":942
+      /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":942
  * cdef inline int import_array() except -1:
  *     try:
  *         __pyx_import_array()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")
  */
       __pyx_t_4 = _import_array(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 942, __pyx_L3_error)
 
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":941
+      /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":943
+    /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":943
  *     try:
  *         __pyx_import_array()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 943, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":944
+      /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":944
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 944, __pyx_L5_except_error)
@@ -8640,30 +8636,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 944, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":941
+    /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":940
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":940
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -8678,15 +8674,15 @@
   __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":946
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":946
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -8702,15 +8698,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_umath", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":947
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -8718,53 +8714,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":948
+      /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":948
  * cdef inline int import_umath() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 948, __pyx_L3_error)
 
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":947
+      /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":949
+    /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":949
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 949, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":950
+      /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":950
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 950, __pyx_L5_except_error)
@@ -8772,30 +8768,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 950, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":947
+    /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":946
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":946
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -8810,15 +8806,15 @@
   __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":952
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":952
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -8834,15 +8830,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_ufunc", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":953
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -8850,53 +8846,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":954
+      /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":954
  * cdef inline int import_ufunc() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 954, __pyx_L3_error)
 
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":953
+      /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":955
+    /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":955
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 955, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":956
+      /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":956
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef extern from *:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 956, __pyx_L5_except_error)
@@ -8904,30 +8900,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 956, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":953
+    /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":952
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":952
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -8942,176 +8938,176 @@
   __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":966
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":966
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_timedelta64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_timedelta64_object", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":978
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":978
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyTimedeltaArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyTimedeltaArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":966
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":966
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":981
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":981
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_datetime64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_datetime64_object", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":993
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":993
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyDatetimeArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyDatetimeArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":981
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":981
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":996
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":996
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
 static CYTHON_INLINE npy_datetime __pyx_f_5numpy_get_datetime64_value(PyObject *__pyx_v_obj) {
   npy_datetime __pyx_r;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1003
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":1003
  *     also needed.  That can be found using `get_datetime64_unit`.
  *     """
  *     return (<PyDatetimeScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyDatetimeScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":996
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":996
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1006
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":1006
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
 static CYTHON_INLINE npy_timedelta __pyx_f_5numpy_get_timedelta64_value(PyObject *__pyx_v_obj) {
   npy_timedelta __pyx_r;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1010
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":1010
  *     returns the int64 value underlying scalar numpy timedelta64 object
  *     """
  *     return (<PyTimedeltaScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyTimedeltaScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1006
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":1006
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1013
+/* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":1013
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
 static CYTHON_INLINE NPY_DATETIMEUNIT __pyx_f_5numpy_get_datetime64_unit(PyObject *__pyx_v_obj) {
   NPY_DATETIMEUNIT __pyx_r;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1017
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":1017
  *     returns the unit part of the dtype for a numpy datetime64 object.
  *     """
  *     return <NPY_DATETIMEUNIT>(<PyDatetimeScalarObject*>obj).obmeta.base             # <<<<<<<<<<<<<<
  */
   __pyx_r = ((NPY_DATETIMEUNIT)((PyDatetimeScalarObject *)__pyx_v_obj)->obmeta.base);
   goto __pyx_L0;
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":1013
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":1013
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
@@ -23188,26 +23184,26 @@
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":944
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":944
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
   __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple_)) __PYX_ERR(1, 944, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple_);
   __Pyx_GIVEREF(__pyx_tuple_);
 
-  /* "../../../../../tmp/build-env-y58uqb76/lib/python3.8/site-packages/numpy/__init__.pxd":950
+  /* "../../../../../tmp/build-env-_4km4d84/lib/python3.8/site-packages/numpy/__init__.pxd":950
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
   __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(1, 950, __pyx_L1_error)
@@ -23890,30 +23886,29 @@
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
-  /* "libreco/utils/_similarities.pyx":3
+  /* "libreco/utils/_similarities.pyx":2
  * #cython: language_level=3
- * from cython.parallel import prange, parallel
  * import numpy as np             # <<<<<<<<<<<<<<
  * cimport numpy as np
  * cimport cython
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 3, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "libreco/utils/_similarities.pyx":1
  * #cython: language_level=3             # <<<<<<<<<<<<<<
- * from cython.parallel import prange, parallel
  * import numpy as np
+ * cimport numpy as np
  */
   __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "View.MemoryView":210
```

### Comparing `LibRecommender-1.1.0/libreco/utils/_similarities.pyx` & `LibRecommender-1.1.1/libreco/utils/_similarities.pyx`

 * *Files 8% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 #cython: language_level=3
-from cython.parallel import prange, parallel
 import numpy as np
 cimport numpy as np
 cimport cython
-from libc.math cimport sqrt as csqrt, pow as cpow
+
+from cython.parallel import prange, parallel
 from libcpp.vector cimport vector
 from libc.stdlib cimport malloc, calloc, free
 from libc.string cimport memset
 
 ctypedef unsigned int uint
 
 
@@ -339,18 +339,26 @@
 
         free(freq)
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
 @cython.cdivision(True)
-cpdef invert_jaccard(const int[:] indices, const int[:] indptr, const float[:] data, 
-                    const int[:] x_count, int min_common, int n_x, int n_y, 
-                    int block_size, int block_num, int num_threads=1):
-
+cpdef invert_jaccard(
+    const int[:] indices,
+    const int[:] indptr,
+    const float[:] data,
+    const int[:] x_count,
+    int min_common,
+    int n_x,
+    int n_y,
+    int block_size,
+    int block_num,
+    int num_threads=1,
+):
     cdef Py_ssize_t res_count = count_freq(
         indices, indptr, min_common, n_x, n_y, block_size, block_num, num_threads)
 
     cdef float[:] res_data = np.zeros(res_count, dtype=np.single)
     cdef uint[:] res_indices = np.zeros(res_count, dtype=np.uintc)
     cdef uint[:] res_indptr = np.zeros(n_x + 1, dtype=np.uintc)
 #    res_indptr[0] = 0
@@ -360,18 +368,22 @@
 
     return np.asarray(res_indices), np.asarray(res_indptr), np.asarray(res_data)
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
 @cython.cdivision(True)
-cpdef forward_cosine(const int[:] indices, const int[:] indptr, 
-                     const float[:] data, const float[:] x_norm, 
-                     int min_common, int n_x):
-
+cpdef forward_cosine(
+    const int[:] indices,
+    const int[:] indptr,
+    const float[:] data,
+    const float[:] x_norm,
+    int min_common,
+    int n_x,
+):
     cdef Py_ssize_t x1, x2, y1, y2, i, j, end1, end2, count
     cdef float cos, prods, sqi, sqj
     cdef vector[uint] res_indices, res_indptr
     cdef vector[float] res_data
     res_indptr.reserve(n_x + 1)
     res_indptr.push_back(0)
 
@@ -412,19 +424,23 @@
 
     return res_indices, res_indptr, res_data
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
 @cython.cdivision(True)
-cpdef forward_pearson(const int[:] indices, const int[:] indptr, 
-                      const float[:] data, const float[:] x_mean, 
-                      const float[:] x_mean_centered_norm, 
-                      int min_common, int n_x):
-
+cpdef forward_pearson(
+    const int[:] indices,
+    const int[:] indptr,
+    const float[:] data,
+    const float[:] x_mean,
+    const float[:] x_mean_centered_norm,
+    int min_common,
+    int n_x,
+):
     cdef Py_ssize_t x1, x2, y1, y2, i, j, end1, end2, count
     cdef float pearson, prods, sqi, sqj, smean1, smean2
     cdef vector[uint] res_indices, res_indptr
     cdef vector[float] res_data
     res_indptr.reserve(n_x + 1)
     res_indptr.push_back(0)
 
@@ -467,18 +483,22 @@
 
     return res_indices, res_indptr, res_data
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
 @cython.cdivision(True)
-cpdef forward_jaccard(const int[:] indices, const int[:] indptr, 
-                      const float[:] data, const int[:] x_count, 
-                      int min_common, int n_x):
-
+cpdef forward_jaccard(
+    const int[:] indices,
+    const int[:] indptr,
+    const float[:] data,
+    const int[:] x_count,
+    int min_common,
+    int n_x,
+):
     cdef Py_ssize_t x1, x2, y1, y2, i, j, end1, end2
     cdef float jaccard, intersection, union
     cdef vector[uint] res_indices, res_indptr
     cdef vector[float] res_data
     res_indptr.reserve(n_x + 1)
     res_indptr.push_back(0)
 
@@ -507,8 +527,7 @@
                     res_indices.push_back(x2)
                     union = x_count[x1] + x_count[x2] - intersection
                     jaccard = intersection / union
                     res_data.push_back(jaccard)
             res_indptr.push_back(res_indices.size())
 
     return res_indices, res_indptr, res_data
-
```

### Comparing `LibRecommender-1.1.0/libreco/utils/constants.py` & `LibRecommender-1.1.1/libreco/utils/constants.py`

 * *Files 4% similar despite different names*

```diff
@@ -98,13 +98,14 @@
     "GraphSage",
     "GraphSageDGL",
     "PinSage",
     "PinSageDGL",
 )
 
 SEQUENCE_RECOMMEND_MODELS = (
+    "YouTubeRetrieval",
     "YouTubeRanking",
     "DIN",
     "RNN4Rec",
     "Caser",
     "WaveNet",
 )
```

### Comparing `LibRecommender-1.1.0/libreco/utils/initializers.py` & `LibRecommender-1.1.1/libreco/utils/initializers.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,42 +1,49 @@
 import numpy as np
 
 
-def truncated_normal(shape, mean=0.0, scale=0.05):
+def truncated_normal(
+    np_rng: np.random.Generator,
+    shape,
+    mean=0.0,
+    scale=0.05,
+    tolerance=5,
+):
     # total_num = np.multiply(*shape)
     total_num = shape if len(shape) == 1 else np.multiply(*shape)
-    array = np.random.normal(mean, scale, total_num).astype(np.float32)
-    while True:
-        index = np.logical_or((array > mean + 2 * scale), (array < mean - 2 * scale))
+    array = np_rng.normal(mean, scale, total_num).astype(np.float32)
+    upper_limit, lower_limit = mean + 2 * scale, mean - 2 * scale
+    for _ in range(tolerance):
+        index = np.logical_or((array > upper_limit), (array < lower_limit))
         num = len(np.where(index)[0])
         if num == 0:
             break
-        array[index] = np.random.normal(mean, scale, num)
+        array[index] = np_rng.normal(mean, scale, num)
     return array.reshape(*shape)
 
 
-def xavier_init(fan_in, fan_out):
+def xavier_init(np_rng, fan_in, fan_out):
     std = np.sqrt(2.0 / (fan_in + fan_out))
-    return truncated_normal(mean=0.0, scale=std, shape=[fan_in, fan_out])
+    return truncated_normal(np_rng, mean=0.0, scale=std, shape=[fan_in, fan_out])
 
 
-def he_init(fan_in, fan_out):
+def he_init(np_rng, fan_in, fan_out):
     std = 2.0 / np.sqrt(fan_in + fan_out)
     # std = np.sqrt(2.0 / fan_in)
-    return truncated_normal(mean=0.0, scale=std, shape=[fan_in, fan_out])
+    return truncated_normal(np_rng, mean=0.0, scale=std, shape=[fan_in, fan_out])
 
 
-def variance_scaling(scale, fan_in=None, fan_out=None, mode="fan_in"):
+def variance_scaling(np_rng, scale, fan_in=None, fan_out=None, mode="fan_in"):
     """
     xavier:  mode = "fan_average", scale = 1.0
     he: mode = "fan_in", scale = 2.0
     he2: mode = "fan_average", scale = 2.0
     """
     if mode == "fan_in":
         std = np.sqrt(scale / fan_in)
     elif mode == "fan_out":
         std = np.sqrt(scale / fan_out)
     elif mode == "fan_average":
         std = np.sqrt(2.0 * scale / (fan_in + fan_out))
     else:
         raise ValueError("mode must be one of these: fan_in, fan_out, fan_average")
-    return truncated_normal(mean=0.0, scale=std, shape=[fan_in, fan_out])
+    return truncated_normal(np_rng, mean=0.0, scale=std, shape=[fan_in, fan_out])
```

### Comparing `LibRecommender-1.1.0/libreco/utils/misc.py` & `LibRecommender-1.1.1/libreco/utils/misc.py`

 * *Files 2% similar despite different names*

```diff
@@ -3,16 +3,16 @@
 from contextlib import contextmanager
 
 import numpy as np
 
 from ..tfops import tf
 
 
-def shuffle_data(length, *args):
-    mask = np.random.permutation(range(length))
+def shuffle_data(np_rng, length, *args):
+    mask = np_rng.permutation(range(length))
     return tuple(map(lambda x: x[mask], [*args]))
 
 
 def count_params():
     total_params = np.sum(
         [np.prod(v.get_shape().as_list()) for v in tf.trainable_variables()]
     )
```

### Comparing `LibRecommender-1.1.0/libreco/utils/sampling.py` & `LibRecommender-1.1.1/libreco/utils/sampling.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/utils/save_load.py` & `LibRecommender-1.1.1/libreco/utils/save_load.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/utils/similarities.py` & `LibRecommender-1.1.1/libreco/utils/similarities.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libreco/utils/validate.py` & `LibRecommender-1.1.1/libreco/utils/validate.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libserving/request.py` & `LibRecommender-1.1.1/libserving/request.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libserving/sanic_serving/benchmark.py` & `LibRecommender-1.1.1/libserving/sanic_serving/benchmark.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libserving/sanic_serving/common.py` & `LibRecommender-1.1.1/libserving/sanic_serving/common.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libserving/sanic_serving/embed_deploy.py` & `LibRecommender-1.1.1/libserving/sanic_serving/embed_deploy.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libserving/sanic_serving/knn_deploy.py` & `LibRecommender-1.1.1/libserving/sanic_serving/knn_deploy.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libserving/sanic_serving/tf_deploy.py` & `LibRecommender-1.1.1/libserving/sanic_serving/tf_deploy.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libserving/serialization/common.py` & `LibRecommender-1.1.1/libserving/serialization/common.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libserving/serialization/embed.py` & `LibRecommender-1.1.1/libserving/serialization/embed.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libserving/serialization/knn.py` & `LibRecommender-1.1.1/libserving/serialization/knn.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libserving/serialization/redis.py` & `LibRecommender-1.1.1/libserving/serialization/redis.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/libserving/serialization/tfmodel.py` & `LibRecommender-1.1.1/libserving/serialization/tfmodel.py`

 * *Files identical despite different names*

### Comparing `LibRecommender-1.1.0/pyproject.toml` & `LibRecommender-1.1.1/pyproject.toml`

 * *Files 6% similar despite different names*

```diff
@@ -7,15 +7,15 @@
     "scipy>=1.2.1",
     "tomli",
 ]
 build-backend = "setuptools.build_meta"
 
 [project]
 name = "LibRecommender"
-version = "1.1.0"
+version = "1.1.1"
 description = "Versatile end-to-end recommender system."
 authors = [
     { name = "massquantity", email = "jinxin_madie@163.com" },
 ]
 readme = "README.md"
 license = { text = "MIT" }
 requires-python = ">=3.6"
@@ -27,14 +27,15 @@
     "Intended Audience :: Science/Research",
     "License :: OSI Approved :: MIT License",
     "Programming Language :: Python :: 3.6",
     "Programming Language :: Python :: 3.7",
     "Programming Language :: Python :: 3.8",
     "Programming Language :: Python :: 3.9",
     "Programming Language :: Python :: 3.10",
+    "Programming Language :: Python :: 3.11",
     "Programming Language :: Cython",
     "Programming Language :: Rust",
 ]
 dependencies = [
     "gensim >= 4.0.0",
     "tqdm",
 ]
@@ -85,25 +86,26 @@
     "ignore:`build_negative_samples` is deprecated",
 ]
 
 [tool.ruff]
 line-length = 88
 target-version = "py38"
 show-source = true
-ignore = ["E501", "F401", "B008", "B010", "NPY002"]
+ignore = ["E501"]
 select = [
     # pyflakes
     "F",
-    # pycodestyle
+    # pycodestyle(Error, Warning)
     "E",
     "W",
     # flake8-2020
     "YTT",
     # flake8-bugbear
     "B",
     # pandas-vet
     "PD",
     # NumPy-specific rules
     "NPY",
     # Ruff-specific rules
     "RUF",
 ]
+exclude = ["sampling.py"]  # deprecated module
```

### Comparing `LibRecommender-1.1.0/setup.py` & `LibRecommender-1.1.1/setup.py`

 * *Files identical despite different names*

