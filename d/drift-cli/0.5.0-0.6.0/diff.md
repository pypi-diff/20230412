# Comparing `tmp/drift_cli-0.5.0-py3-none-any.whl.zip` & `tmp/drift_cli-0.6.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,20 +1,20 @@
-Zip file size: 22846 bytes, number of entries: 18
--rw-r--r--  2.0 unx      192 b- defN 23-Apr-06 13:59 drift_cli/__init__.py
--rw-r--r--  2.0 unx       84 b- defN 23-Apr-06 13:59 drift_cli/__main__.py
--rw-r--r--  2.0 unx     2344 b- defN 23-Apr-06 13:59 drift_cli/alias.py
--rw-r--r--  2.0 unx     1216 b- defN 23-Apr-06 13:59 drift_cli/cli.py
--rw-r--r--  2.0 unx      829 b- defN 23-Apr-06 13:59 drift_cli/config.py
--rw-r--r--  2.0 unx     2715 b- defN 23-Apr-06 13:59 drift_cli/export.py
--rw-r--r--  2.0 unx     5650 b- defN 23-Apr-06 13:59 drift_cli/export_impl/raw.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-06 13:59 drift_cli/utils/__init__.py
--rw-r--r--  2.0 unx      129 b- defN 23-Apr-06 13:59 drift_cli/utils/consoles.py
--rw-r--r--  2.0 unx      513 b- defN 23-Apr-06 13:59 drift_cli/utils/error.py
--rw-r--r--  2.0 unx     5060 b- defN 23-Apr-06 13:59 drift_cli/utils/helpers.py
--rw-r--r--  2.0 unx     2280 b- defN 23-Apr-06 13:59 drift_cli/utils/humanize.py
--rw-r--r--  2.0 unx    16725 b- defN 23-Apr-06 13:59 drift_cli-0.5.0.dist-info/LICENSE
--rw-r--r--  2.0 unx    22526 b- defN 23-Apr-06 13:59 drift_cli-0.5.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-06 13:59 drift_cli-0.5.0.dist-info/WHEEL
--rw-r--r--  2.0 unx       45 b- defN 23-Apr-06 13:59 drift_cli-0.5.0.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       10 b- defN 23-Apr-06 13:59 drift_cli-0.5.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1443 b- defN 23-Apr-06 13:59 drift_cli-0.5.0.dist-info/RECORD
-18 files, 61853 bytes uncompressed, 20488 bytes compressed:  66.9%
+Zip file size: 23417 bytes, number of entries: 18
+-rw-r--r--  2.0 unx      192 b- defN 23-Apr-12 10:47 drift_cli/__init__.py
+-rw-r--r--  2.0 unx       84 b- defN 23-Apr-12 10:47 drift_cli/__main__.py
+-rw-r--r--  2.0 unx     2344 b- defN 23-Apr-12 10:47 drift_cli/alias.py
+-rw-r--r--  2.0 unx     1216 b- defN 23-Apr-12 10:47 drift_cli/cli.py
+-rw-r--r--  2.0 unx      829 b- defN 23-Apr-12 10:47 drift_cli/config.py
+-rw-r--r--  2.0 unx     2715 b- defN 23-Apr-12 10:47 drift_cli/export.py
+-rw-r--r--  2.0 unx     7325 b- defN 23-Apr-12 10:47 drift_cli/export_impl/raw.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-12 10:47 drift_cli/utils/__init__.py
+-rw-r--r--  2.0 unx      129 b- defN 23-Apr-12 10:47 drift_cli/utils/consoles.py
+-rw-r--r--  2.0 unx      513 b- defN 23-Apr-12 10:47 drift_cli/utils/error.py
+-rw-r--r--  2.0 unx     5060 b- defN 23-Apr-12 10:47 drift_cli/utils/helpers.py
+-rw-r--r--  2.0 unx     2280 b- defN 23-Apr-12 10:47 drift_cli/utils/humanize.py
+-rw-r--r--  2.0 unx    16725 b- defN 23-Apr-12 10:47 drift_cli-0.6.0.dist-info/LICENSE
+-rw-r--r--  2.0 unx    22526 b- defN 23-Apr-12 10:47 drift_cli-0.6.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-12 10:47 drift_cli-0.6.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx       45 b- defN 23-Apr-12 10:47 drift_cli-0.6.0.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       10 b- defN 23-Apr-12 10:47 drift_cli-0.6.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1443 b- defN 23-Apr-12 10:47 drift_cli-0.6.0.dist-info/RECORD
+18 files, 63528 bytes uncompressed, 21059 bytes compressed:  66.9%
```

## zipnote {}

```diff
@@ -30,26 +30,26 @@
 
 Filename: drift_cli/utils/helpers.py
 Comment: 
 
 Filename: drift_cli/utils/humanize.py
 Comment: 
 
-Filename: drift_cli-0.5.0.dist-info/LICENSE
+Filename: drift_cli-0.6.0.dist-info/LICENSE
 Comment: 
 
-Filename: drift_cli-0.5.0.dist-info/METADATA
+Filename: drift_cli-0.6.0.dist-info/METADATA
 Comment: 
 
-Filename: drift_cli-0.5.0.dist-info/WHEEL
+Filename: drift_cli-0.6.0.dist-info/WHEEL
 Comment: 
 
-Filename: drift_cli-0.5.0.dist-info/entry_points.txt
+Filename: drift_cli-0.6.0.dist-info/entry_points.txt
 Comment: 
 
-Filename: drift_cli-0.5.0.dist-info/top_level.txt
+Filename: drift_cli-0.6.0.dist-info/top_level.txt
 Comment: 
 
-Filename: drift_cli-0.5.0.dist-info/RECORD
+Filename: drift_cli-0.6.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## drift_cli/export_impl/raw.py

```diff
@@ -1,22 +1,75 @@
 """Export data"""
 import asyncio
 from concurrent.futures import ThreadPoolExecutor, Executor
 from pathlib import Path
+from typing import Optional, List, Tuple
 
 import numpy as np
 from drift_client import DriftClient
 from drift_protocol.common import StatusCode
 from drift_protocol.meta import MetaInfo
 from rich.progress import Progress
-from wavelet_buffer.img import codecs
+from wavelet_buffer import WaveletBuffer
+from wavelet_buffer.img import codecs, RgbJpeg, HslJpeg, GrayJpeg
 
 from drift_cli.utils.helpers import read_topic, filter_topics
 
 
+def _tokenize(mask: str) -> List[Tuple[str, int]]:
+    """turn a channel mask into a list of tokens,
+    each with the type as a string, and the absolute channel offset into the buffer
+    """
+    types = ["RGB", "HSL", "G"]
+    tokens = []
+    count = 0
+    while mask:
+        for img_type in types:
+            if mask.startswith(img_type):
+                tokens.append((img_type, count))
+                count += len(img_type)
+                mask = mask[len(img_type) :]
+                break
+    return tokens
+
+
+def extract_jpeg_images_from_buffer(
+    buffer: WaveletBuffer, layout: str, scale_factor: int
+) -> List[bytes]:
+    """takes a wavelet buffer and returns possibly multiple jpegs"""
+    if buffer.parameters.signal_number < len(layout):
+        raise RuntimeError(
+            f'Wrong channel number in layout "{layout} '
+            f"should >= {buffer.parameters.signal_number}"
+        )
+
+    scale_factor = min(scale_factor, buffer.parameters.decomposition_steps)
+
+    images = []
+    for img_mask, offset in _tokenize(layout):
+        ch_slice = buffer[offset : offset + len(img_mask)].compose(
+            scale_factor=scale_factor
+        )
+
+        if img_mask == "HSL":
+            img = HslJpeg().encode(ch_slice)
+
+        elif img_mask == "RGB":
+            img = RgbJpeg().encode(ch_slice)
+
+        elif img_mask == "G":
+            img = GrayJpeg().encode(ch_slice)
+
+        else:
+            raise RuntimeError(f"Wrong channel layout {img_mask} in mask {layout}")
+
+        images.append(img)
+    return images
+
+
 async def _export_topic(
     pool: Executor,
     client: DriftClient,
     topic: str,
     dest: str,
     progress: Progress,
     sem,
@@ -43,34 +96,35 @@
                 f"Can't extract picture from  {topic}/{package.package_id}.dp: {StatusCode.Name(package.status_code)}"
             )
             continue
 
         meta = package.meta
 
         if meta.type != MetaInfo.IMAGE:
-
             progress.update(
                 task,
                 description=f"[SKIPPED] Topic {topic} is not an image",
                 completed=True,
             )
             break
 
         Path.mkdir(Path(dest) / topic, exist_ok=True, parents=True)
         if package.meta.HasField("image_info"):
             layout = package.meta.image_info.channel_layout
-            if layout not in ["RGB", "G"]:
-                raise RuntimeError(f"Unsupported layout {layout}")
-            codec = codecs.RgbJpeg() if layout == "RGB" else codecs.GrayJpeg()
         else:
-            codec = codecs.RgbJpeg()
-
-        with open(Path(dest) / topic / f"{package.package_id}.jpeg", "wb") as file:
-            blob = codec.encode(package.as_np(), 0)
-            file.write(blob)
+            layout = "RGB"
+        images = extract_jpeg_images_from_buffer(package.as_buffer(), layout, 0)
+        for i, img in enumerate(images):
+            name = (
+                f"{package.package_id}_{i}.jpeg"
+                if len(images) > 1
+                else f"{package.package_id}.jpeg"
+            )
+            with open(Path(dest) / topic / name, "wb") as file:
+                file.write(img)
 
 
 async def _export_csv(
     pool: Executor,
     client: DriftClient,
     curren_topic: str,
     dest: str,
```

## Comparing `drift_cli-0.5.0.dist-info/LICENSE` & `drift_cli-0.6.0.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `drift_cli-0.5.0.dist-info/METADATA` & `drift_cli-0.6.0.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: drift-cli
-Version: 0.5.0
+Version: 0.6.0
 Summary: CLI client for PANDA | Drift Platform
 Author-email: Alexey Timin <atimin@gmail.com>
 Maintainer-email: Alexey Timin <atimin@gmail.com>
 License: Mozilla Public License Version 2.0
         ==================================
         
         1. Definitions
```

