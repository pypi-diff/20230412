# Comparing `tmp/azure-cosmos-4.3.1b1.zip` & `tmp/azure-cosmos-4.4.0b1.zip`

## zipinfo {}

```diff
@@ -1,173 +1,176 @@
-Zip file size: 436927 bytes, number of entries: 171
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/samples/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure_cosmos.egg-info/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/test/
--rw-rw-r--  2.0 unx      147 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/Contributing.md
--rw-rw-r--  2.0 unx       38 b- defN 22-Sep-19 23:06 azure-cosmos-4.3.1b1/setup.cfg
--rw-rw-r--  2.0 unx    17308 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/CHANGELOG.md
--rw-rw-r--  2.0 unx    51400 b- defN 22-Sep-19 23:06 azure-cosmos-4.3.1b1/PKG-INFO
--rw-rw-r--  2.0 unx     2429 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/setup.py
--rw-rw-r--  2.0 unx      149 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/MANIFEST.in
--rw-rw-r--  2.0 unx     1073 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/LICENSE
--rw-rw-r--  2.0 unx    33095 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/README.md
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/samples/MultiMasterOperations/
--rw-rw-r--  2.0 unx     6442 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/database_management_async.py
--rw-rw-r--  2.0 unx     4484 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/access_cosmos_with_aad.py
--rw-rw-r--  2.0 unx    30131 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/index_management.py
--rw-rw-r--  2.0 unx    13466 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/container_management_async.py
--rw-rw-r--  2.0 unx     5811 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/examples.py
--rw-rw-r--  2.0 unx     7407 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/document_management.py
--rw-rw-r--  2.0 unx     7593 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/examples_async.py
--rw-rw-r--  2.0 unx     5282 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/access_cosmos_with_aad_async.py
--rw-rw-r--  2.0 unx    11031 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/container_management.py
--rw-rw-r--  2.0 unx    10759 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/access_cosmos_with_resource_token_async.py
--rw-rw-r--  2.0 unx     2538 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/client_user_configs.py
--rw-rw-r--  2.0 unx     3794 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/change_feed_management.py
--rw-rw-r--  2.0 unx      820 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/config.py
--rw-rw-r--  2.0 unx    30503 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/index_management_async.py
--rw-rw-r--  2.0 unx     8830 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/document_management_async.py
--rw-rw-r--  2.0 unx     4246 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/database_management.py
--rw-rw-r--  2.0 unx     4333 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/change_feed_management_async.py
--rw-rw-r--  2.0 unx     3367 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/README.md
--rw-rw-r--  2.0 unx     2646 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/client_user_configs_async.py
--rw-rw-r--  2.0 unx     9407 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/access_cosmos_with_resource_token.py
--rw-rw-r--  2.0 unx     2554 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/MultiMasterOperations/Worker.py
--rw-rw-r--  2.0 unx      402 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/MultiMasterOperations/Configurations.py
--rw-rw-r--  2.0 unx    34973 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/MultiMasterOperations/ConflictWorker.py
--rw-rw-r--  2.0 unx     4131 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/MultiMasterOperations/MultiMasterScenario.py
--rw-rw-r--  2.0 unx      318 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/samples/MultiMasterOperations/Program.py
--rw-rw-r--  2.0 unx        1 b- defN 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure_cosmos.egg-info/not-zip-safe
--rw-rw-r--  2.0 unx        6 b- defN 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure_cosmos.egg-info/top_level.txt
--rw-rw-r--  2.0 unx       26 b- defN 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure_cosmos.egg-info/requires.txt
--rw-rw-r--  2.0 unx        1 b- defN 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure_cosmos.egg-info/dependency_links.txt
--rw-rw-r--  2.0 unx     5131 b- defN 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure_cosmos.egg-info/SOURCES.txt
--rw-rw-r--  2.0 unx    51400 b- defN 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure_cosmos.egg-info/PKG-INFO
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure/cosmos/
--rw-rw-r--  2.0 unx       81 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/__init__.py
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure/cosmos/aio/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure/cosmos/_routing/
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/
--rw-rw-r--  2.0 unx     2625 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_partition.py
--rw-rw-r--  2.0 unx     1696 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_runtime_constants.py
--rw-rw-r--  2.0 unx     2430 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_retry_options.py
--rw-rw-r--  2.0 unx     2992 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_resource_throttle_retry_policy.py
--rw-rw-r--  2.0 unx     2200 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/__init__.py
--rw-rw-r--  2.0 unx    23841 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/cosmos_client.py
--rw-rw-r--  2.0 unx    12763 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/user.py
--rw-rw-r--  2.0 unx     7818 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_global_endpoint_manager.py
--rw-rw-r--  2.0 unx    29392 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_base.py
--rw-rw-r--  2.0 unx     2258 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_request_object.py
--rw-rw-r--  2.0 unx     5771 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_session_retry_policy.py
--rw-rw-r--  2.0 unx     6575 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_vector_session_token.py
--rw-rw-r--  2.0 unx     9656 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_session.py
--rw-rw-r--  2.0 unx    39708 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/database.py
--rw-rw-r--  2.0 unx     1142 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_version.py
--rw-rw-r--  2.0 unx     8220 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_cosmos_http_logging_policy.py
--rw-rw-r--  2.0 unx     6007 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/auth.py
--rw-rw-r--  2.0 unx     1753 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_constants.py
--rw-rw-r--  2.0 unx     1990 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_utils.py
--rw-rw-r--  2.0 unx     7198 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_auth_policy.py
--rw-rw-r--  2.0 unx    10137 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_retry_utility.py
--rw-rw-r--  2.0 unx        0 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/py.typed
--rw-rw-r--  2.0 unx    14934 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_location_cache.py
--rw-rw-r--  2.0 unx     4798 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_range_partition_resolver.py
--rw-rw-r--  2.0 unx     3427 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/exceptions.py
--rw-rw-r--  2.0 unx     2302 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_gone_retry_policy.py
--rw-rw-r--  2.0 unx     4685 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_endpoint_discovery_retry_policy.py
--rw-rw-r--  2.0 unx    40651 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/container.py
--rw-rw-r--  2.0 unx    19609 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/scripts.py
--rw-rw-r--  2.0 unx    13630 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/http_constants.py
--rw-rw-r--  2.0 unx     3996 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_query_iterable.py
--rw-rw-r--  2.0 unx    93533 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_cosmos_client_connection.py
--rw-rw-r--  2.0 unx    15257 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/documents.py
--rw-rw-r--  2.0 unx     1509 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/errors.py
--rw-rw-r--  2.0 unx     2720 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/diagnostics.py
--rw-rw-r--  2.0 unx     2861 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/partition_key.py
--rw-rw-r--  2.0 unx     2603 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/offer.py
--rw-rw-r--  2.0 unx     2806 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_range.py
--rw-rw-r--  2.0 unx     7918 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_synchronized_request.py
--rw-rw-r--  2.0 unx     1848 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/permission.py
--rw-rw-r--  2.0 unx     3274 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_default_retry_policy.py
--rw-rw-r--  2.0 unx    39330 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/_container.py
--rw-rw-r--  2.0 unx    22102 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/_scripts.py
--rw-rw-r--  2.0 unx    18805 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/_cosmos_client.py
--rw-rw-r--  2.0 unx     1417 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/__init__.py
--rw-rw-r--  2.0 unx     4215 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/_query_iterable_async.py
--rw-rw-r--  2.0 unx    14320 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/_user.py
--rw-rw-r--  2.0 unx     9573 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/_retry_utility_async.py
--rw-rw-r--  2.0 unx     8185 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/_auth_policy_async.py
--rw-rw-r--  2.0 unx     7768 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/_global_endpoint_manager_async.py
--rw-rw-r--  2.0 unx    39502 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/_database.py
--rw-rw-r--  2.0 unx     7239 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/_asynchronous_request.py
--rw-rw-r--  2.0 unx    92109 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/aio/_cosmos_client_connection_async.py
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure/cosmos/_routing/aio/
--rw-rw-r--  2.0 unx     1121 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_routing/__init__.py
--rw-rw-r--  2.0 unx     7964 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_routing/routing_map_provider.py
--rw-rw-r--  2.0 unx     7560 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_routing/collection_routing_map.py
--rw-rw-r--  2.0 unx     4520 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_routing/routing_range.py
--rw-rw-r--  2.0 unx     1121 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_routing/aio/__init__.py
--rw-rw-r--  2.0 unx     8085 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_routing/aio/routing_map_provider.py
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/
--rw-rw-r--  2.0 unx     1121 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/__init__.py
--rw-rw-r--  2.0 unx     7520 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/endpoint_component.py
--rw-rw-r--  2.0 unx     9126 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/execution_dispatcher.py
--rw-rw-r--  2.0 unx     4697 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/query_execution_info.py
--rw-rw-r--  2.0 unx     8091 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/multi_execution_aggregator.py
--rw-rw-r--  2.0 unx     9259 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/document_producer.py
--rw-rw-r--  2.0 unx     3295 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aggregators.py
--rw-rw-r--  2.0 unx     6113 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/base_execution_context.py
--rw-rw-r--  2.0 unx     1121 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/__init__.py
--rw-rw-r--  2.0 unx     7365 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/endpoint_component.py
--rw-rw-r--  2.0 unx     8955 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/execution_dispatcher.py
--rw-rw-r--  2.0 unx     3220 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/_queue_async_helper.py
--rw-rw-r--  2.0 unx     8507 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/multi_execution_aggregator.py
--rw-rw-r--  2.0 unx     9210 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/document_producer.py
--rw-rw-r--  2.0 unx     6197 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/base_execution_context.py
-drwxrwxr-x  2.0 unx        0 b- stor 22-Sep-19 23:06 azure-cosmos-4.3.1b1/test/routing/
--rw-rw-r--  2.0 unx     8567 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_streaming_failover.py
--rw-rw-r--  2.0 unx     7564 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_auto_scale_async.py
--rw-rw-r--  2.0 unx     3985 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_session_token_unit.py
--rw-rw-r--  2.0 unx     4541 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_backwards_compatibility.py
--rw-rw-r--  2.0 unx    14793 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_ttl.py
--rw-rw-r--  2.0 unx     7087 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_aad.py
--rw-rw-r--  2.0 unx    13679 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_analytical_ttl.py
--rw-rw-r--  2.0 unx     8441 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_config.py
--rw-rw-r--  2.0 unx   120989 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_crud_async.py
--rw-rw-r--  2.0 unx    13949 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_analytical_ttl_async.py
--rw-rw-r--  2.0 unx    22693 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_orderby.py
--rw-rw-r--  2.0 unx     2120 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_utils.py
--rw-rw-r--  2.0 unx   115915 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_crud.py
--rw-rw-r--  2.0 unx    26150 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_globaldb.py
--rw-rw-r--  2.0 unx     5354 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_session.py
--rw-rw-r--  2.0 unx     4003 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_routing_map.py
--rw-rw-r--  2.0 unx     4204 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_proxy.py
--rw-rw-r--  2.0 unx     1357 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_diagnostics.py
--rw-rw-r--  2.0 unx     1508 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/conftest.py
--rw-rw-r--  2.0 unx    29789 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_query.py
--rw-rw-r--  2.0 unx     4317 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_partition_key.py
--rw-rw-r--  2.0 unx    24366 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_location_cache.py
--rw-rw-r--  2.0 unx    12416 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_multi_orderby.py
--rw-rw-r--  2.0 unx    13640 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_retry_policy.py
--rw-rw-r--  2.0 unx     6685 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_user_configs.py
--rw-rw-r--  2.0 unx     6495 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_cosmos_http_logging_policy.py
--rw-rw-r--  2.0 unx     3906 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_headers.py
--rw-rw-r--  2.0 unx     9927 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_aggregate.py
--rw-rw-r--  2.0 unx     6904 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_auto_scale.py
--rw-rw-r--  2.0 unx     4494 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_partition_split_query.py
--rw-rw-r--  2.0 unx     4358 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_env.py
--rw-rw-r--  2.0 unx     9482 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_globaldb_mock.py
--rw-rw-r--  2.0 unx     2382 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_media.py
--rw-rw-r--  2.0 unx     4762 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_integrated_cache.py
--rw-rw-r--  2.0 unx     1338 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/cleanup.py
--rw-rw-r--  2.0 unx      465 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_base_unit.py
--rw-rw-r--  2.0 unx     3861 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_session_container.py
--rw-rw-r--  2.0 unx     2960 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_encoding.py
--rw-rw-r--  2.0 unx     9255 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_query_execution_context.py
--rw-rw-r--  2.0 unx     2335 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_client_user_agent.py
--rw-rw-r--  2.0 unx     5014 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/test_multimaster.py
--rw-rw-r--  2.0 unx     1103 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/routing/__init__.py
--rw-rw-r--  2.0 unx    10381 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/routing/test_routing_map_provider.py
--rw-rw-r--  2.0 unx    10369 b- defN 22-Sep-19 23:04 azure-cosmos-4.3.1b1/test/routing/test_collection_routing_map.py
-171 files, 1772722 bytes uncompressed, 406281 bytes compressed:  77.1%
+Zip file size: 448571 bytes, number of entries: 174
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/samples/
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure/
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/test/
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure_cosmos.egg-info/
+-rw-rw-r--  2.0 unx      149 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/MANIFEST.in
+-rw-rw-r--  2.0 unx       99 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/pyproject.toml
+-rw-rw-r--  2.0 unx     1073 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/LICENSE
+-rw-rw-r--  2.0 unx     2429 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/setup.py
+-rw-rw-r--  2.0 unx    53931 b- defN 23-Apr-11 18:16 azure-cosmos-4.4.0b1/PKG-INFO
+-rw-rw-r--  2.0 unx    33721 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/README.md
+-rw-rw-r--  2.0 unx      147 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/Contributing.md
+-rw-rw-r--  2.0 unx       38 b- defN 23-Apr-11 18:16 azure-cosmos-4.4.0b1/setup.cfg
+-rw-rw-r--  2.0 unx    19213 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/CHANGELOG.md
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/samples/MultiMasterOperations/
+-rw-rw-r--  2.0 unx    11921 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/document_management_async.py
+-rw-rw-r--  2.0 unx     3794 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/change_feed_management.py
+-rw-rw-r--  2.0 unx    11297 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/container_management.py
+-rw-rw-r--  2.0 unx     4292 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/database_management.py
+-rw-rw-r--  2.0 unx     6438 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/examples.py
+-rw-rw-r--  2.0 unx     6419 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/database_management_async.py
+-rw-rw-r--  2.0 unx    30428 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/index_management_async.py
+-rw-rw-r--  2.0 unx     4484 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/access_cosmos_with_aad.py
+-rw-rw-r--  2.0 unx     8388 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/examples_async.py
+-rw-rw-r--  2.0 unx    10642 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/access_cosmos_with_resource_token_async.py
+-rw-rw-r--  2.0 unx    10519 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/document_management.py
+-rw-rw-r--  2.0 unx      820 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/config.py
+-rw-rw-r--  2.0 unx     9407 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/access_cosmos_with_resource_token.py
+-rw-rw-r--  2.0 unx     3367 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/README.md
+-rw-rw-r--  2.0 unx     2571 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/client_user_configs_async.py
+-rw-rw-r--  2.0 unx    30131 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/index_management.py
+-rw-rw-r--  2.0 unx     4258 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/change_feed_management_async.py
+-rw-rw-r--  2.0 unx    13997 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/container_management_async.py
+-rw-rw-r--  2.0 unx     5234 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/access_cosmos_with_aad_async.py
+-rw-rw-r--  2.0 unx     2538 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/client_user_configs.py
+-rw-rw-r--  2.0 unx      402 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/MultiMasterOperations/Configurations.py
+-rw-rw-r--  2.0 unx      318 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/MultiMasterOperations/Program.py
+-rw-rw-r--  2.0 unx     2843 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/MultiMasterOperations/Worker.py
+-rw-rw-r--  2.0 unx    35093 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/MultiMasterOperations/ConflictWorker.py
+-rw-rw-r--  2.0 unx     4083 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/samples/MultiMasterOperations/MultiMasterScenario.py
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure/cosmos/
+-rw-rw-r--  2.0 unx       81 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/__init__.py
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure/cosmos/_routing/
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure/cosmos/aio/
+-rw-rw-r--  2.0 unx    97103 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_cosmos_client_connection.py
+-rw-rw-r--  2.0 unx     7198 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_auth_policy.py
+-rw-rw-r--  2.0 unx     2430 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_retry_options.py
+-rw-rw-r--  2.0 unx    29333 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_base.py
+-rw-rw-r--  2.0 unx    12763 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/user.py
+-rw-rw-r--  2.0 unx     5771 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_session_retry_policy.py
+-rw-rw-r--  2.0 unx     2603 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/offer.py
+-rw-rw-r--  2.0 unx     2992 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_resource_throttle_retry_policy.py
+-rw-rw-r--  2.0 unx     2861 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/partition_key.py
+-rw-rw-r--  2.0 unx    14926 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/http_constants.py
+-rw-rw-r--  2.0 unx     3274 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_default_retry_policy.py
+-rw-rw-r--  2.0 unx     1990 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_utils.py
+-rw-rw-r--  2.0 unx     7918 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_synchronized_request.py
+-rw-rw-r--  2.0 unx     1142 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_version.py
+-rw-rw-r--  2.0 unx    39514 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/database.py
+-rw-rw-r--  2.0 unx     1753 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_constants.py
+-rw-rw-r--  2.0 unx     2200 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/__init__.py
+-rw-rw-r--  2.0 unx    19609 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/scripts.py
+-rw-rw-r--  2.0 unx     4798 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_range_partition_resolver.py
+-rw-rw-r--  2.0 unx    14934 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_location_cache.py
+-rw-rw-r--  2.0 unx    44338 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/container.py
+-rw-rw-r--  2.0 unx     9656 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_session.py
+-rw-rw-r--  2.0 unx    24294 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/cosmos_client.py
+-rw-rw-r--  2.0 unx     3427 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/exceptions.py
+-rw-rw-r--  2.0 unx     4685 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_endpoint_discovery_retry_policy.py
+-rw-rw-r--  2.0 unx     2593 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_partition.py
+-rw-rw-r--  2.0 unx    15277 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/documents.py
+-rw-rw-r--  2.0 unx     3478 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_cosmos_http_logging_policy.py
+-rw-rw-r--  2.0 unx     6575 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_vector_session_token.py
+-rw-rw-r--  2.0 unx     2302 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_gone_retry_policy.py
+-rw-rw-r--  2.0 unx     1696 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_runtime_constants.py
+-rw-rw-r--  2.0 unx     1509 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/errors.py
+-rw-rw-r--  2.0 unx     2258 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_request_object.py
+-rw-rw-r--  2.0 unx     2806 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_range.py
+-rw-rw-r--  2.0 unx     3996 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_query_iterable.py
+-rw-rw-r--  2.0 unx     1848 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/permission.py
+-rw-rw-r--  2.0 unx        0 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/py.typed
+-rw-rw-r--  2.0 unx     2720 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/diagnostics.py
+-rw-rw-r--  2.0 unx     6007 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/auth.py
+-rw-rw-r--  2.0 unx    10529 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_retry_utility.py
+-rw-rw-r--  2.0 unx     7801 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_global_endpoint_manager.py
+-rw-rw-r--  2.0 unx     4548 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_timeout_failover_retry_policy.py
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/
+-rw-rw-r--  2.0 unx     9096 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/execution_dispatcher.py
+-rw-rw-r--  2.0 unx     6113 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/base_execution_context.py
+-rw-rw-r--  2.0 unx     1121 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/__init__.py
+-rw-rw-r--  2.0 unx     9259 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/document_producer.py
+-rw-rw-r--  2.0 unx     8091 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/multi_execution_aggregator.py
+-rw-rw-r--  2.0 unx     7627 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/endpoint_component.py
+-rw-rw-r--  2.0 unx     3295 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aggregators.py
+-rw-rw-r--  2.0 unx     4697 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/query_execution_info.py
+-rw-rw-r--  2.0 unx     8955 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/execution_dispatcher.py
+-rw-rw-r--  2.0 unx     6197 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/base_execution_context.py
+-rw-rw-r--  2.0 unx     1121 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/__init__.py
+-rw-rw-r--  2.0 unx     3220 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/_queue_async_helper.py
+-rw-rw-r--  2.0 unx     9210 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/document_producer.py
+-rw-rw-r--  2.0 unx     8507 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/multi_execution_aggregator.py
+-rw-rw-r--  2.0 unx     7472 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/endpoint_component.py
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure/cosmos/_routing/aio/
+-rw-rw-r--  2.0 unx     7528 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_routing/collection_routing_map.py
+-rw-rw-r--  2.0 unx     1121 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_routing/__init__.py
+-rw-rw-r--  2.0 unx     7964 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_routing/routing_map_provider.py
+-rw-rw-r--  2.0 unx     4520 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_routing/routing_range.py
+-rw-rw-r--  2.0 unx     1121 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_routing/aio/__init__.py
+-rw-rw-r--  2.0 unx     8085 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/_routing/aio/routing_map_provider.py
+-rw-rw-r--  2.0 unx     7761 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/_global_endpoint_manager_async.py
+-rw-rw-r--  2.0 unx    22102 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/_scripts.py
+-rw-rw-r--  2.0 unx     9962 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/_retry_utility_async.py
+-rw-rw-r--  2.0 unx    20787 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/_cosmos_client.py
+-rw-rw-r--  2.0 unx     1417 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/__init__.py
+-rw-rw-r--  2.0 unx    43104 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/_container.py
+-rw-rw-r--  2.0 unx     8185 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/_auth_policy_async.py
+-rw-rw-r--  2.0 unx     7239 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/_asynchronous_request.py
+-rw-rw-r--  2.0 unx    95722 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/_cosmos_client_connection_async.py
+-rw-rw-r--  2.0 unx    39434 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/_database.py
+-rw-rw-r--  2.0 unx    14320 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/_user.py
+-rw-rw-r--  2.0 unx     4215 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/azure/cosmos/aio/_query_iterable_async.py
+drwxrwxr-x  2.0 unx        0 b- stor 23-Apr-11 18:16 azure-cosmos-4.4.0b1/test/routing/
+-rw-rw-r--  2.0 unx     3985 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_session_token_unit.py
+-rw-rw-r--  2.0 unx     4494 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_partition_split_query.py
+-rw-rw-r--  2.0 unx     7167 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_auto_scale.py
+-rw-rw-r--  2.0 unx     2673 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_correlated_activity_id.py
+-rw-rw-r--  2.0 unx     7087 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_aad.py
+-rw-rw-r--  2.0 unx    22619 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_orderby.py
+-rw-rw-r--  2.0 unx     6967 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_user_configs.py
+-rw-rw-r--  2.0 unx    13679 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_analytical_ttl.py
+-rw-rw-r--  2.0 unx     5354 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_session.py
+-rw-rw-r--  2.0 unx     3879 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_headers.py
+-rw-rw-r--  2.0 unx     8567 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_streaming_failover.py
+-rw-rw-r--  2.0 unx     2382 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_media.py
+-rw-rw-r--  2.0 unx    41041 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_query.py
+-rw-rw-r--  2.0 unx     4317 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_partition_key.py
+-rw-rw-r--  2.0 unx     4003 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_routing_map.py
+-rw-rw-r--  2.0 unx    14793 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_ttl.py
+-rw-rw-r--  2.0 unx    12416 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_multi_orderby.py
+-rw-rw-r--  2.0 unx     2960 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_encoding.py
+-rw-rw-r--  2.0 unx     7579 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_auto_scale_async.py
+-rw-rw-r--  2.0 unx   126060 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_crud_async.py
+-rw-rw-r--  2.0 unx     5014 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_multimaster.py
+-rw-rw-r--  2.0 unx     1338 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/cleanup.py
+-rw-rw-r--  2.0 unx     2335 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_client_user_agent.py
+-rw-rw-r--  2.0 unx     9864 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_aggregate.py
+-rw-rw-r--  2.0 unx     6491 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_cosmos_http_logging_policy.py
+-rw-rw-r--  2.0 unx     3861 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_session_container.py
+-rw-rw-r--  2.0 unx    15048 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_retry_policy.py
+-rw-rw-r--  2.0 unx    13949 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_analytical_ttl_async.py
+-rw-rw-r--  2.0 unx     4541 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_backwards_compatibility.py
+-rw-rw-r--  2.0 unx     4384 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_env.py
+-rw-rw-r--  2.0 unx     2120 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_utils.py
+-rw-rw-r--  2.0 unx    24366 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_location_cache.py
+-rw-rw-r--  2.0 unx     9224 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_query_execution_context.py
+-rw-rw-r--  2.0 unx     8455 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_config.py
+-rw-rw-r--  2.0 unx     1508 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/conftest.py
+-rw-rw-r--  2.0 unx     9482 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_globaldb_mock.py
+-rw-rw-r--  2.0 unx      465 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_base_unit.py
+-rw-rw-r--  2.0 unx     1357 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_diagnostics.py
+-rw-rw-r--  2.0 unx     4204 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_proxy.py
+-rw-rw-r--  2.0 unx     4762 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_integrated_cache.py
+-rw-rw-r--  2.0 unx   120857 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_crud.py
+-rw-rw-r--  2.0 unx    26150 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/test_globaldb.py
+-rw-rw-r--  2.0 unx    10381 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/routing/test_routing_map_provider.py
+-rw-rw-r--  2.0 unx    10369 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/routing/test_collection_routing_map.py
+-rw-rw-r--  2.0 unx     1103 b- defN 23-Apr-11 18:14 azure-cosmos-4.4.0b1/test/routing/__init__.py
+-rw-rw-r--  2.0 unx        1 b- defN 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure_cosmos.egg-info/dependency_links.txt
+-rw-rw-r--  2.0 unx       26 b- defN 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure_cosmos.egg-info/requires.txt
+-rw-rw-r--  2.0 unx    53931 b- defN 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure_cosmos.egg-info/PKG-INFO
+-rw-rw-r--  2.0 unx     5229 b- defN 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure_cosmos.egg-info/SOURCES.txt
+-rw-rw-r--  2.0 unx        1 b- defN 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure_cosmos.egg-info/not-zip-safe
+-rw-rw-r--  2.0 unx        6 b- defN 23-Apr-11 18:16 azure-cosmos-4.4.0b1/azure_cosmos.egg-info/top_level.txt
+174 files, 1833432 bytes uncompressed, 417381 bytes compressed:  77.2%
```

## zipnote {}

```diff
@@ -1,514 +1,523 @@
-Filename: azure-cosmos-4.3.1b1/
+Filename: azure-cosmos-4.4.0b1/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/
+Filename: azure-cosmos-4.4.0b1/samples/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure_cosmos.egg-info/
+Filename: azure-cosmos-4.4.0b1/azure/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/
+Filename: azure-cosmos-4.4.0b1/test/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/
+Filename: azure-cosmos-4.4.0b1/azure_cosmos.egg-info/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/Contributing.md
+Filename: azure-cosmos-4.4.0b1/MANIFEST.in
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/setup.cfg
+Filename: azure-cosmos-4.4.0b1/pyproject.toml
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/CHANGELOG.md
+Filename: azure-cosmos-4.4.0b1/LICENSE
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/PKG-INFO
+Filename: azure-cosmos-4.4.0b1/setup.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/setup.py
+Filename: azure-cosmos-4.4.0b1/PKG-INFO
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/MANIFEST.in
+Filename: azure-cosmos-4.4.0b1/README.md
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/LICENSE
+Filename: azure-cosmos-4.4.0b1/Contributing.md
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/README.md
+Filename: azure-cosmos-4.4.0b1/setup.cfg
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/MultiMasterOperations/
+Filename: azure-cosmos-4.4.0b1/CHANGELOG.md
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/database_management_async.py
+Filename: azure-cosmos-4.4.0b1/samples/MultiMasterOperations/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/access_cosmos_with_aad.py
+Filename: azure-cosmos-4.4.0b1/samples/document_management_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/index_management.py
+Filename: azure-cosmos-4.4.0b1/samples/change_feed_management.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/container_management_async.py
+Filename: azure-cosmos-4.4.0b1/samples/container_management.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/examples.py
+Filename: azure-cosmos-4.4.0b1/samples/database_management.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/document_management.py
+Filename: azure-cosmos-4.4.0b1/samples/examples.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/examples_async.py
+Filename: azure-cosmos-4.4.0b1/samples/database_management_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/access_cosmos_with_aad_async.py
+Filename: azure-cosmos-4.4.0b1/samples/index_management_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/container_management.py
+Filename: azure-cosmos-4.4.0b1/samples/access_cosmos_with_aad.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/access_cosmos_with_resource_token_async.py
+Filename: azure-cosmos-4.4.0b1/samples/examples_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/client_user_configs.py
+Filename: azure-cosmos-4.4.0b1/samples/access_cosmos_with_resource_token_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/change_feed_management.py
+Filename: azure-cosmos-4.4.0b1/samples/document_management.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/config.py
+Filename: azure-cosmos-4.4.0b1/samples/config.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/index_management_async.py
+Filename: azure-cosmos-4.4.0b1/samples/access_cosmos_with_resource_token.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/document_management_async.py
+Filename: azure-cosmos-4.4.0b1/samples/README.md
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/database_management.py
+Filename: azure-cosmos-4.4.0b1/samples/client_user_configs_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/change_feed_management_async.py
+Filename: azure-cosmos-4.4.0b1/samples/index_management.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/README.md
+Filename: azure-cosmos-4.4.0b1/samples/change_feed_management_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/client_user_configs_async.py
+Filename: azure-cosmos-4.4.0b1/samples/container_management_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/access_cosmos_with_resource_token.py
+Filename: azure-cosmos-4.4.0b1/samples/access_cosmos_with_aad_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/MultiMasterOperations/Worker.py
+Filename: azure-cosmos-4.4.0b1/samples/client_user_configs.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/MultiMasterOperations/Configurations.py
+Filename: azure-cosmos-4.4.0b1/samples/MultiMasterOperations/Configurations.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/MultiMasterOperations/ConflictWorker.py
+Filename: azure-cosmos-4.4.0b1/samples/MultiMasterOperations/Program.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/MultiMasterOperations/MultiMasterScenario.py
+Filename: azure-cosmos-4.4.0b1/samples/MultiMasterOperations/Worker.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/samples/MultiMasterOperations/Program.py
+Filename: azure-cosmos-4.4.0b1/samples/MultiMasterOperations/ConflictWorker.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure_cosmos.egg-info/not-zip-safe
+Filename: azure-cosmos-4.4.0b1/samples/MultiMasterOperations/MultiMasterScenario.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure_cosmos.egg-info/top_level.txt
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure_cosmos.egg-info/requires.txt
+Filename: azure-cosmos-4.4.0b1/azure/__init__.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure_cosmos.egg-info/dependency_links.txt
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure_cosmos.egg-info/SOURCES.txt
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_routing/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure_cosmos.egg-info/PKG-INFO
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_cosmos_client_connection.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/__init__.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_auth_policy.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_retry_options.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_routing/
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_base.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/user.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_partition.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_session_retry_policy.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_runtime_constants.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/offer.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_retry_options.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_resource_throttle_retry_policy.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_resource_throttle_retry_policy.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/partition_key.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/__init__.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/http_constants.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/cosmos_client.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_default_retry_policy.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/user.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_utils.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_global_endpoint_manager.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_synchronized_request.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_base.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_version.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_request_object.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/database.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_session_retry_policy.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_constants.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_vector_session_token.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/__init__.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_session.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/scripts.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/database.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_range_partition_resolver.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_version.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_location_cache.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_cosmos_http_logging_policy.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/container.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/auth.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_session.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_constants.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/cosmos_client.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_utils.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/exceptions.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_auth_policy.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_endpoint_discovery_retry_policy.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_retry_utility.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_partition.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/py.typed
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/documents.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_location_cache.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_cosmos_http_logging_policy.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_range_partition_resolver.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_vector_session_token.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/exceptions.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_gone_retry_policy.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_gone_retry_policy.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_runtime_constants.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_endpoint_discovery_retry_policy.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/errors.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/container.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_request_object.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/scripts.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_range.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/http_constants.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_query_iterable.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_query_iterable.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/permission.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_cosmos_client_connection.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/py.typed
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/documents.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/diagnostics.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/errors.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/auth.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/diagnostics.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_retry_utility.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/partition_key.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_global_endpoint_manager.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/offer.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_timeout_failover_retry_policy.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_range.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_synchronized_request.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/execution_dispatcher.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/permission.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/base_execution_context.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_default_retry_policy.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/__init__.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/_container.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/document_producer.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/_scripts.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/multi_execution_aggregator.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/_cosmos_client.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/endpoint_component.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/__init__.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aggregators.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/_query_iterable_async.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/query_execution_info.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/_user.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/execution_dispatcher.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/_retry_utility_async.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/base_execution_context.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/_auth_policy_async.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/__init__.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/_global_endpoint_manager_async.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/_queue_async_helper.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/_database.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/document_producer.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/_asynchronous_request.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/multi_execution_aggregator.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/aio/_cosmos_client_connection_async.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/endpoint_component.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_routing/aio/
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_routing/aio/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_routing/__init__.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_routing/collection_routing_map.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_routing/routing_map_provider.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_routing/__init__.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_routing/collection_routing_map.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_routing/routing_map_provider.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_routing/routing_range.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_routing/routing_range.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_routing/aio/__init__.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_routing/aio/__init__.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_routing/aio/routing_map_provider.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/_routing/aio/routing_map_provider.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/_global_endpoint_manager_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/__init__.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/_scripts.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/endpoint_component.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/_retry_utility_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/execution_dispatcher.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/_cosmos_client.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/query_execution_info.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/__init__.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/multi_execution_aggregator.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/_container.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/document_producer.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/_auth_policy_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aggregators.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/_asynchronous_request.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/base_execution_context.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/_cosmos_client_connection_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/__init__.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/_database.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/endpoint_component.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/_user.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/execution_dispatcher.py
+Filename: azure-cosmos-4.4.0b1/azure/cosmos/aio/_query_iterable_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/_queue_async_helper.py
+Filename: azure-cosmos-4.4.0b1/test/routing/
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/multi_execution_aggregator.py
+Filename: azure-cosmos-4.4.0b1/test/test_session_token_unit.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/document_producer.py
+Filename: azure-cosmos-4.4.0b1/test/test_partition_split_query.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/base_execution_context.py
+Filename: azure-cosmos-4.4.0b1/test/test_auto_scale.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/routing/
+Filename: azure-cosmos-4.4.0b1/test/test_correlated_activity_id.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_streaming_failover.py
+Filename: azure-cosmos-4.4.0b1/test/test_aad.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_auto_scale_async.py
+Filename: azure-cosmos-4.4.0b1/test/test_orderby.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_session_token_unit.py
+Filename: azure-cosmos-4.4.0b1/test/test_user_configs.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_backwards_compatibility.py
+Filename: azure-cosmos-4.4.0b1/test/test_analytical_ttl.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_ttl.py
+Filename: azure-cosmos-4.4.0b1/test/test_session.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_aad.py
+Filename: azure-cosmos-4.4.0b1/test/test_headers.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_analytical_ttl.py
+Filename: azure-cosmos-4.4.0b1/test/test_streaming_failover.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_config.py
+Filename: azure-cosmos-4.4.0b1/test/test_media.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_crud_async.py
+Filename: azure-cosmos-4.4.0b1/test/test_query.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_analytical_ttl_async.py
+Filename: azure-cosmos-4.4.0b1/test/test_partition_key.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_orderby.py
+Filename: azure-cosmos-4.4.0b1/test/test_routing_map.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_utils.py
+Filename: azure-cosmos-4.4.0b1/test/test_ttl.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_crud.py
+Filename: azure-cosmos-4.4.0b1/test/test_multi_orderby.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_globaldb.py
+Filename: azure-cosmos-4.4.0b1/test/test_encoding.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_session.py
+Filename: azure-cosmos-4.4.0b1/test/test_auto_scale_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_routing_map.py
+Filename: azure-cosmos-4.4.0b1/test/test_crud_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_proxy.py
+Filename: azure-cosmos-4.4.0b1/test/test_multimaster.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_diagnostics.py
+Filename: azure-cosmos-4.4.0b1/test/cleanup.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/conftest.py
+Filename: azure-cosmos-4.4.0b1/test/test_client_user_agent.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_query.py
+Filename: azure-cosmos-4.4.0b1/test/test_aggregate.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_partition_key.py
+Filename: azure-cosmos-4.4.0b1/test/test_cosmos_http_logging_policy.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_location_cache.py
+Filename: azure-cosmos-4.4.0b1/test/test_session_container.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_multi_orderby.py
+Filename: azure-cosmos-4.4.0b1/test/test_retry_policy.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_retry_policy.py
+Filename: azure-cosmos-4.4.0b1/test/test_analytical_ttl_async.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_user_configs.py
+Filename: azure-cosmos-4.4.0b1/test/test_backwards_compatibility.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_cosmos_http_logging_policy.py
+Filename: azure-cosmos-4.4.0b1/test/test_env.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_headers.py
+Filename: azure-cosmos-4.4.0b1/test/test_utils.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_aggregate.py
+Filename: azure-cosmos-4.4.0b1/test/test_location_cache.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_auto_scale.py
+Filename: azure-cosmos-4.4.0b1/test/test_query_execution_context.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_partition_split_query.py
+Filename: azure-cosmos-4.4.0b1/test/test_config.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_env.py
+Filename: azure-cosmos-4.4.0b1/test/conftest.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_globaldb_mock.py
+Filename: azure-cosmos-4.4.0b1/test/test_globaldb_mock.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_media.py
+Filename: azure-cosmos-4.4.0b1/test/test_base_unit.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_integrated_cache.py
+Filename: azure-cosmos-4.4.0b1/test/test_diagnostics.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/cleanup.py
+Filename: azure-cosmos-4.4.0b1/test/test_proxy.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_base_unit.py
+Filename: azure-cosmos-4.4.0b1/test/test_integrated_cache.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_session_container.py
+Filename: azure-cosmos-4.4.0b1/test/test_crud.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_encoding.py
+Filename: azure-cosmos-4.4.0b1/test/test_globaldb.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_query_execution_context.py
+Filename: azure-cosmos-4.4.0b1/test/routing/test_routing_map_provider.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_client_user_agent.py
+Filename: azure-cosmos-4.4.0b1/test/routing/test_collection_routing_map.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/test_multimaster.py
+Filename: azure-cosmos-4.4.0b1/test/routing/__init__.py
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/routing/__init__.py
+Filename: azure-cosmos-4.4.0b1/azure_cosmos.egg-info/dependency_links.txt
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/routing/test_routing_map_provider.py
+Filename: azure-cosmos-4.4.0b1/azure_cosmos.egg-info/requires.txt
 Comment: 
 
-Filename: azure-cosmos-4.3.1b1/test/routing/test_collection_routing_map.py
+Filename: azure-cosmos-4.4.0b1/azure_cosmos.egg-info/PKG-INFO
+Comment: 
+
+Filename: azure-cosmos-4.4.0b1/azure_cosmos.egg-info/SOURCES.txt
+Comment: 
+
+Filename: azure-cosmos-4.4.0b1/azure_cosmos.egg-info/not-zip-safe
+Comment: 
+
+Filename: azure-cosmos-4.4.0b1/azure_cosmos.egg-info/top_level.txt
 Comment: 
 
 Zip file comment:
```

## Comparing `azure-cosmos-4.3.1b1/CHANGELOG.md` & `azure-cosmos-4.4.0b1/CHANGELOG.md`

 * *Files 6% similar despite different names*

```diff
@@ -1,9 +1,34 @@
 ## Release History
 
+### 4.4.0b1 (2023-04-11)
+
+#### Features Added
+ - Added **preview** delete all items by partition key functionality. See [PR 29186](https://github.com/Azure/azure-sdk-for-python/pull/29186).
+ - Added **preview** partial document update (Patch API) functionality and container methods for patching items with operations. See [PR 29497](https://github.com/Azure/azure-sdk-for-python/pull/29497). For more information on Patch, please see [Azure Cosmos DB Partial Document Update](https://learn.microsoft.com/azure/cosmos-db/partial-document-update).
+
+
+#### Bugs Fixed
+* Fixed bug in method `create_container_if_not_exists()` of async database client for unexpected kwargs being passed into `read()` method used internally. See [PR 29136](https://github.com/Azure/azure-sdk-for-python/pull/29136).
+* Fixed bug with method `query_items()` of our async container class, where partition key and cross partition headers would both be set when using partition keys. See [PR 29366](https://github.com/Azure/azure-sdk-for-python/pull/29366/).
+* Fixed bug with client not properly surfacing errors for invalid credentials and identities with insufficient permissions. Users running into 'NoneType has no attribute ConsistencyPolicy' errors when initializing their clients will now see proper authentication exceptions. See [PR 29256](https://github.com/Azure/azure-sdk-for-python/pull/29256).
+
+#### Other Changes
+* Removed use of `six` package within the SDK.
+
+### 4.3.1 (2023-02-23)
+
+#### Features Added
+ - Added `correlated_activity_id` for query operations.
+ - Added cross regional retries for Service Unavailable/Request Timeouts for read/Query Plan operations.
+ - GA release of CosmosHttpLoggingPolicy and autoscale feature.
+
+#### Bugs Fixed
+- Bug fix to address queries with VALUE MAX (or any other aggregate) that run into an issue if the query is executed on a container with at least one "empty" partition.
+
 ### 4.3.1b1 (2022-09-19)
 
 #### Features Added
 - GA release of integrated cache functionality. For more information on integrated cache please see [Azure Cosmos DB integrated cache](https://docs.microsoft.com/azure/cosmos-db/integrated-cache).
 - Added ability to replace analytical ttl on containers. For more information on analytical ttl please see [Azure Cosmos DB analytical store](https://docs.microsoft.com/azure/cosmos-db/analytical-store-introduction).
 - Added `CosmosHttpLoggingPolicy` to replace `HttpLoggingPolicy` for logging HTTP sessions.
 - Added the ability to create containers and databases with autoscale properties for the sync and async clients.
```

## Comparing `azure-cosmos-4.3.1b1/PKG-INFO` & `azure-cosmos-4.4.0b1/PKG-INFO`

 * *Files 5% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: azure-cosmos
-Version: 4.3.1b1
+Version: 4.4.0b1
 Summary: Microsoft Azure Cosmos Client Library for Python
 Home-page: https://github.com/Azure/azure-sdk-for-python
 Author: Microsoft Corporation
 Author-email: askdocdb@microsoft.com
 Maintainer: Microsoft
 Maintainer-email: askdocdb@microsoft.com
 License: MIT License
@@ -34,15 +34,20 @@
 Use the Azure Cosmos DB SQL API SDK for Python to manage databases and the JSON documents they contain in this NoSQL database service. High level capabilities are:
 
 * Create Cosmos DB **databases** and modify their settings
 * Create and modify **containers** to store collections of JSON documents
 * Create, read, update, and delete the **items** (JSON documents) in your containers
 * Query the documents in your database using **SQL-like syntax**
 
-[SDK source code][source_code] | [Package (PyPI)][cosmos_pypi] | [API reference documentation][ref_cosmos_sdk] | [Product documentation][cosmos_docs] | [Samples][cosmos_samples]
+[SDK source code][source_code]
+| [Package (PyPI)][cosmos_pypi]
+| [Package (Conda)](https://anaconda.org/microsoft/azure-cosmos/)
+| [API reference documentation][ref_cosmos_sdk]
+| [Product documentation][cosmos_docs]
+| [Samples][cosmos_samples]
 
 > This SDK is used for the [SQL API](https://docs.microsoft.com/azure/cosmos-db/sql-query-getting-started). For all other APIs, please check the [Azure Cosmos DB documentation](https://docs.microsoft.com/azure/cosmos-db/introduction) to evaluate the best SDK for your project.
 
 ## Getting started
 
 ### Important update on Python 2.x Support
 
@@ -89,28 +94,28 @@
 export ACCOUNT_KEY=$(az cosmosdb list-keys --resource-group $RES_GROUP --name $ACCT_NAME --query primaryMasterKey --output tsv)
 ```
 
 ### Create the client
 
 Once you've populated the `ACCOUNT_URI` and `ACCOUNT_KEY` environment variables, you can create the [CosmosClient][ref_cosmosclient].
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 
 import os
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 ```
 
 ### AAD Authentication
 
 You can also authenticate a client utilizing your service principal's AAD credentials and the azure identity package. 
 You can directly pass in the credentials information to ClientSecretCredential, or use the DefaultAzureCredential:
-```Python
+```python
 from azure.cosmos import CosmosClient
 from azure.identity import ClientSecretCredential, DefaultAzureCredential
 
 import os
 url = os.environ['ACCOUNT_URI']
 tenant_id = os.environ['TENANT_ID']
 client_id = os.environ['CLIENT_ID']
@@ -153,15 +158,15 @@
 When using queries that try to find items based on an **id** value, always make sure you are passing in a string type variable. Azure Cosmos DB only allows string id values and if you use any other datatype, this SDK will return no results and no error messages.
 
 ## Note on client consistency levels
 
 As of release version 4.3.0b3, if a user does not pass in an explicit consistency level to their client initialization,
 their client will use their database account's default level. Previously, the default was being set to `Session` consistency.
 If for some reason you'd like to keep doing this, you can change your client initialization to include the explicit parameter for this like shown:
-```Python
+```python
 from azure.cosmos import CosmosClient
 
 import os
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY, consistency_level='Session')
 ```
@@ -179,14 +184,15 @@
 * Continuation token for cross partitions queries
 * Change Feed: Processor
 * Change Feed: Read multiple partitions key values
 * Change Feed: Read specific time
 * Change Feed: Read from the beginning
 * Change Feed: Pull model
 * Cross-partition ORDER BY for mixed types
+* Enabling diagnostics for async query-type methods
 
 ### Control Plane Limitations:
 
 * Get CollectionSizeUsage, DatabaseUsage, and DocumentUsage metrics
 * Create Geospatial Index
 * Get the connection string
 * Get the minimum RU/s of a container
@@ -238,15 +244,15 @@
 * [Modify container properties](#modify-container-properties "Modify container properties")
 * [Using the asynchronous client](#using-the-asynchronous-client "Using the asynchronous client")
 
 ### Create a database
 
 After authenticating your [CosmosClient][ref_cosmosclient], you can work with any resource in the account. The code snippet below creates a SQL API database, which is the default when no API is specified when [create_database][ref_cosmosclient_create_database] is invoked.
 
-```Python
+```python
 from azure.cosmos import CosmosClient, exceptions
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -256,15 +262,15 @@
     database = client.get_database_client(DATABASE_NAME)
 ```
 
 ### Create a container
 
 This example creates a container with default settings. If a container with the same name already exists in the database (generating a `409 Conflict` error), the existing container is obtained instead.
 
-```Python
+```python
 from azure.cosmos import CosmosClient, PartitionKey, exceptions
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -286,15 +292,15 @@
 The options for analytical_storage_ttl are:
 
 + 0 or Null or not informed: Not enabled.
 + -1: The data will be stored infinitely.
 + Any other number: the actual ttl, in seconds.
 
 
-```Python
+```python
 CONTAINER_NAME = 'products'
 try:
     container = database.create_container(id=CONTAINER_NAME, partition_key=PartitionKey(path="/productName"),analytical_storage_ttl=-1)
 except exceptions.CosmosResourceExistsError:
     container = database.get_container_client(CONTAINER_NAME)
 except exceptions.CosmosHttpResponseError:
     raise
@@ -302,15 +308,15 @@
 
 The preceding snippets also handle the [CosmosHttpResponseError][ref_httpfailure] exception if the container creation failed. For more information on error handling and troubleshooting, see the [Troubleshooting](#troubleshooting "Troubleshooting") section.
 
 ### Get an existing container
 
 Retrieve an existing container from the database:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -321,15 +327,15 @@
 
 ### Insert data
 
 To insert items into a container, pass a dictionary containing your data to [ContainerProxy.upsert_item][ref_container_upsert_item]. Each item you add to a container must include an `id` key with a value that uniquely identifies the item within the container.
 
 This example inserts several items into the container, each with a unique `id`:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -346,15 +352,15 @@
     )
 ```
 
 ### Delete data
 
 To delete items from a container, use [ContainerProxy.delete_item][ref_container_delete_item]. The SQL API in Cosmos DB does not support the SQL `DELETE` statement.
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -372,15 +378,15 @@
 
 ### Query the database
 
 A Cosmos DB SQL API database supports querying the items in a container with [ContainerProxy.query_items][ref_container_query_items] using SQL-like syntax.
 
 This example queries a container for items with a specific `id`:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -396,15 +402,15 @@
     print(json.dumps(item, indent=True))
 ```
 
 > NOTE: Although you can specify any value for the container name in the `FROM` clause, we recommend you use the container name for consistency.
 
 Perform parameterized queries by passing a dictionary containing the parameters and their values to [ContainerProxy.query_items][ref_container_query_items]:
 
-```Python
+```python
 discontinued_items = container.query_items(
     query='SELECT * FROM products p WHERE p.productModel = @model',
     parameters=[
         dict(name='@model', value='Model 7')
     ],
     enable_cross_partition_query=True
 )
@@ -414,15 +420,15 @@
 
 For more information on querying Cosmos DB databases using the SQL API, see [Query Azure Cosmos DB data with SQL queries][cosmos_sql_queries].
 
 ### Get database properties
 
 Get and display the properties of a database:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 import json
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
@@ -432,15 +438,15 @@
 print(json.dumps(properties))
 ```
 
 ### Get database and container throughputs
 
 Get and display the throughput values of a database and of a container with dedicated throughput:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 import json
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
@@ -459,15 +465,15 @@
 ```
 
 
 ### Modify container properties
 
 Certain properties of an existing container can be modified. This example sets the default time to live (TTL) for items in the container to 10 seconds:
 
-```Python
+```python
 from azure.cosmos import CosmosClient, PartitionKey
 import os
 import json
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
@@ -489,15 +495,15 @@
 For more information on TTL, see [Time to Live for Azure Cosmos DB data][cosmos_ttl].
 
 ### Using the asynchronous client
 
 The asynchronous cosmos client is a separate client that looks and works in a similar fashion to the existing synchronous client. However, the async client needs to be imported separately and its methods need to be used with the async/await keywords.
 The Async client needs to be initialized and closed after usage, which can be done manually or with the use of a context manager. The example below shows how to do so manually.
 
-```Python
+```python
 from azure.cosmos.aio import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 DATABASE_NAME = 'testDatabase'
 CONTAINER_NAME = 'products'    
@@ -514,15 +520,15 @@
             }
         )
     await client.close() # the async client must be closed manually if it's not initialized in a with statement
 ```
 
 Instead of manually opening and closing the client, it is highly recommended to use the `async with` keywords. This creates a context manager that will initialize and later close the client once you're out of the statement. The example below shows how to do so.
 
-```Python
+```python
 from azure.cosmos.aio import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 DATABASE_NAME = 'testDatabase'
 CONTAINER_NAME = 'products'
@@ -544,15 +550,15 @@
 
 Unlike the synchronous client, the async client does not have an `enable_cross_partition` flag in the request. Queries without a specified partition key value will attempt to do a cross partition query by default. 
 
 Query results can be iterated, but the query's raw output returns an asynchronous iterator. This means that each object from the iterator is an awaitable object, and does not yet contain the true query result. In order to obtain the query results you can use an async for loop, which awaits each result as you iterate on the object, or manually await each query result as you iterate over the asynchronous iterator.
 
 Since the query results are an asynchronous iterator, they can't be cast into lists directly; instead, if you need to create lists from your results, use an async for loop or Python's list comprehension to populate a list:
 
-```Python
+```python
 from azure.cosmos.aio import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -578,15 +584,15 @@
 ### Using Integrated Cache
 An integrated cache is an in-memory cache that helps you ensure manageable costs and low latency as your request volume grows. The integrated cache has two parts: an item cache for point reads and a query cache for queries. The code snippet below shows you how to use this feature with the point read and query cache methods.
 
 The benefit of using this is that the point reads and queries that hit the integrated cache won't use any RUs. This means you will have a much lower per-operation cost than reads from the backend.
 
 [How to configure the Azure Cosmos DB integrated cache (Preview)][cosmos_configure_integrated_cache]
 
-```Python
+```python
 import azure.cosmos.cosmos_client as cosmos_client
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = cosmos_client.CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -613,15 +619,15 @@
 
 When you interact with Cosmos DB using the Python SDK, exceptions returned by the service correspond to the same HTTP status codes returned for REST API requests:
 
 [HTTP Status Codes for Azure Cosmos DB][cosmos_http_status_codes]
 
 For example, if you try to create a container using an ID (name) that's already in use in your Cosmos DB database, a `409` error is returned, indicating the conflict. In the following snippet, the error is handled gracefully by catching the exception and displaying additional information about the error.
 
-```Python
+```python
 try:
     database.create_container(id=CONTAINER_NAME, partition_key=PartitionKey(path="/productName"))
 except exceptions.CosmosResourceExistsError:
     print("""Error creating container
 HTTP status code 409: The ID (name) provided for the container is already in use.
 The container name must be unique within the database.""")
 
@@ -650,38 +656,42 @@
 
 # This client will log detailed information about its HTTP sessions, at DEBUG level
 client = CosmosClient(URL, credential=KEY, logging_enable=True)
 ```
 
 Similarly, `logging_enable` can enable detailed logging for a single operation,
 even when it isn't enabled for the client:
-```py
+```python
 database = client.create_database(DATABASE_NAME, logging_enable=True)
 ```
 Alternatively, you can log using the CosmosHttpLoggingPolicy, which extends from the azure core HttpLoggingPolicy, by passing in your logger to the `logger` argument.
-By default, it will use the behaviour from HttpLoggingPolicy. The `enable_diagnostics_logging` argument will add additional diagnostic information to the logger.
+By default, it will use the behaviour from HttpLoggingPolicy. Passing in the `enable_diagnostics_logging` argument will enable the
+CosmosHttpLoggingPolicy, and will have additional information in the response relevant to debugging Cosmos issues.
 ```python
 import logging
 from azure.cosmos import CosmosClient
 
 #Create a logger for the 'azure' SDK
 logger = logging.getLogger('azure')
 logger.setLevel(logging.DEBUG)
 
 # Configure a file output
 handler = logging.FileHandler(filename="azure")
 logger.addHandler(handler)
 
-# This client will log diagnostic information from the HTTP session by using the CosmosHttpLoggingPolicy
+# This client will log diagnostic information from the HTTP session by using the CosmosHttpLoggingPolicy.
+# Since we passed in the logger to the client, it will log information on every request.
 client = CosmosClient(URL, credential=KEY, logger=logger, enable_diagnostics_logging=True)
 ```
-Similarly, CosmosHttpLoggingPolicy can enable detailed logging for a single operation,
-even when it isn't enabled for the client:
-```py
-database = client.create_database(DATABASE_NAME, logger=logger, enable_diagnostics_logging=True)
+Similarly, logging can be enabled for a single operation by passing in a logger to the singular request.
+However, if you desire to use the CosmosHttpLoggingPolicy to obtain additional information, the `enable_diagnostics_logging` argument needs to be passed in at the client constructor.
+```python
+# This example enables the CosmosHttpLoggingPolicy and uses it with the `logger` passed in to the `create_database` request.
+client = CosmosClient(URL, credential=KEY, enable_diagnostics_logging=True)
+database = client.create_database(DATABASE_NAME, logger=logger)
 ```
 
 ## Next steps
 
 For more extensive documentation on the Cosmos DB service, see the [Azure Cosmos DB documentation][cosmos_docs] on docs.microsoft.com.
 
 <!-- LINKS -->
@@ -734,14 +744,39 @@
 This project has adopted the [Microsoft Open Source Code of Conduct](https://opensource.microsoft.com/codeofconduct/).
 For more information see the [Code of Conduct FAQ](https://opensource.microsoft.com/codeofconduct/faq/) or
 contact [opencode@microsoft.com](mailto:opencode@microsoft.com) with any additional questions or comments.
 
 
 ## Release History
 
+### 4.4.0b1 (2023-04-11)
+
+#### Features Added
+ - Added **preview** delete all items by partition key functionality. See [PR 29186](https://github.com/Azure/azure-sdk-for-python/pull/29186).
+ - Added **preview** partial document update (Patch API) functionality and container methods for patching items with operations. See [PR 29497](https://github.com/Azure/azure-sdk-for-python/pull/29497). For more information on Patch, please see [Azure Cosmos DB Partial Document Update](https://learn.microsoft.com/azure/cosmos-db/partial-document-update).
+
+
+#### Bugs Fixed
+* Fixed bug in method `create_container_if_not_exists()` of async database client for unexpected kwargs being passed into `read()` method used internally. See [PR 29136](https://github.com/Azure/azure-sdk-for-python/pull/29136).
+* Fixed bug with method `query_items()` of our async container class, where partition key and cross partition headers would both be set when using partition keys. See [PR 29366](https://github.com/Azure/azure-sdk-for-python/pull/29366/).
+* Fixed bug with client not properly surfacing errors for invalid credentials and identities with insufficient permissions. Users running into 'NoneType has no attribute ConsistencyPolicy' errors when initializing their clients will now see proper authentication exceptions. See [PR 29256](https://github.com/Azure/azure-sdk-for-python/pull/29256).
+
+#### Other Changes
+* Removed use of `six` package within the SDK.
+
+### 4.3.1 (2023-02-23)
+
+#### Features Added
+ - Added `correlated_activity_id` for query operations.
+ - Added cross regional retries for Service Unavailable/Request Timeouts for read/Query Plan operations.
+ - GA release of CosmosHttpLoggingPolicy and autoscale feature.
+
+#### Bugs Fixed
+- Bug fix to address queries with VALUE MAX (or any other aggregate) that run into an issue if the query is executed on a container with at least one "empty" partition.
+
 ### 4.3.1b1 (2022-09-19)
 
 #### Features Added
 - GA release of integrated cache functionality. For more information on integrated cache please see [Azure Cosmos DB integrated cache](https://docs.microsoft.com/azure/cosmos-db/integrated-cache).
 - Added ability to replace analytical ttl on containers. For more information on analytical ttl please see [Azure Cosmos DB analytical store](https://docs.microsoft.com/azure/cosmos-db/analytical-store-introduction).
 - Added `CosmosHttpLoggingPolicy` to replace `HttpLoggingPolicy` for logging HTTP sessions.
 - Added the ability to create containers and databases with autoscale properties for the sync and async clients.
```

## Comparing `azure-cosmos-4.3.1b1/setup.py` & `azure-cosmos-4.4.0b1/setup.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/LICENSE` & `azure-cosmos-4.4.0b1/LICENSE`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/README.md` & `azure-cosmos-4.4.0b1/README.md`

 * *Files 2% similar despite different names*

```diff
@@ -8,15 +8,20 @@
 Use the Azure Cosmos DB SQL API SDK for Python to manage databases and the JSON documents they contain in this NoSQL database service. High level capabilities are:
 
 * Create Cosmos DB **databases** and modify their settings
 * Create and modify **containers** to store collections of JSON documents
 * Create, read, update, and delete the **items** (JSON documents) in your containers
 * Query the documents in your database using **SQL-like syntax**
 
-[SDK source code][source_code] | [Package (PyPI)][cosmos_pypi] | [API reference documentation][ref_cosmos_sdk] | [Product documentation][cosmos_docs] | [Samples][cosmos_samples]
+[SDK source code][source_code]
+| [Package (PyPI)][cosmos_pypi]
+| [Package (Conda)](https://anaconda.org/microsoft/azure-cosmos/)
+| [API reference documentation][ref_cosmos_sdk]
+| [Product documentation][cosmos_docs]
+| [Samples][cosmos_samples]
 
 > This SDK is used for the [SQL API](https://docs.microsoft.com/azure/cosmos-db/sql-query-getting-started). For all other APIs, please check the [Azure Cosmos DB documentation](https://docs.microsoft.com/azure/cosmos-db/introduction) to evaluate the best SDK for your project.
 
 ## Getting started
 
 ### Important update on Python 2.x Support
 
@@ -63,28 +68,28 @@
 export ACCOUNT_KEY=$(az cosmosdb list-keys --resource-group $RES_GROUP --name $ACCT_NAME --query primaryMasterKey --output tsv)
 ```
 
 ### Create the client
 
 Once you've populated the `ACCOUNT_URI` and `ACCOUNT_KEY` environment variables, you can create the [CosmosClient][ref_cosmosclient].
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 
 import os
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 ```
 
 ### AAD Authentication
 
 You can also authenticate a client utilizing your service principal's AAD credentials and the azure identity package. 
 You can directly pass in the credentials information to ClientSecretCredential, or use the DefaultAzureCredential:
-```Python
+```python
 from azure.cosmos import CosmosClient
 from azure.identity import ClientSecretCredential, DefaultAzureCredential
 
 import os
 url = os.environ['ACCOUNT_URI']
 tenant_id = os.environ['TENANT_ID']
 client_id = os.environ['CLIENT_ID']
@@ -127,15 +132,15 @@
 When using queries that try to find items based on an **id** value, always make sure you are passing in a string type variable. Azure Cosmos DB only allows string id values and if you use any other datatype, this SDK will return no results and no error messages.
 
 ## Note on client consistency levels
 
 As of release version 4.3.0b3, if a user does not pass in an explicit consistency level to their client initialization,
 their client will use their database account's default level. Previously, the default was being set to `Session` consistency.
 If for some reason you'd like to keep doing this, you can change your client initialization to include the explicit parameter for this like shown:
-```Python
+```python
 from azure.cosmos import CosmosClient
 
 import os
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY, consistency_level='Session')
 ```
@@ -153,14 +158,15 @@
 * Continuation token for cross partitions queries
 * Change Feed: Processor
 * Change Feed: Read multiple partitions key values
 * Change Feed: Read specific time
 * Change Feed: Read from the beginning
 * Change Feed: Pull model
 * Cross-partition ORDER BY for mixed types
+* Enabling diagnostics for async query-type methods
 
 ### Control Plane Limitations:
 
 * Get CollectionSizeUsage, DatabaseUsage, and DocumentUsage metrics
 * Create Geospatial Index
 * Get the connection string
 * Get the minimum RU/s of a container
@@ -212,15 +218,15 @@
 * [Modify container properties](#modify-container-properties "Modify container properties")
 * [Using the asynchronous client](#using-the-asynchronous-client "Using the asynchronous client")
 
 ### Create a database
 
 After authenticating your [CosmosClient][ref_cosmosclient], you can work with any resource in the account. The code snippet below creates a SQL API database, which is the default when no API is specified when [create_database][ref_cosmosclient_create_database] is invoked.
 
-```Python
+```python
 from azure.cosmos import CosmosClient, exceptions
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -230,15 +236,15 @@
     database = client.get_database_client(DATABASE_NAME)
 ```
 
 ### Create a container
 
 This example creates a container with default settings. If a container with the same name already exists in the database (generating a `409 Conflict` error), the existing container is obtained instead.
 
-```Python
+```python
 from azure.cosmos import CosmosClient, PartitionKey, exceptions
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -260,15 +266,15 @@
 The options for analytical_storage_ttl are:
 
 + 0 or Null or not informed: Not enabled.
 + -1: The data will be stored infinitely.
 + Any other number: the actual ttl, in seconds.
 
 
-```Python
+```python
 CONTAINER_NAME = 'products'
 try:
     container = database.create_container(id=CONTAINER_NAME, partition_key=PartitionKey(path="/productName"),analytical_storage_ttl=-1)
 except exceptions.CosmosResourceExistsError:
     container = database.get_container_client(CONTAINER_NAME)
 except exceptions.CosmosHttpResponseError:
     raise
@@ -276,15 +282,15 @@
 
 The preceding snippets also handle the [CosmosHttpResponseError][ref_httpfailure] exception if the container creation failed. For more information on error handling and troubleshooting, see the [Troubleshooting](#troubleshooting "Troubleshooting") section.
 
 ### Get an existing container
 
 Retrieve an existing container from the database:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -295,15 +301,15 @@
 
 ### Insert data
 
 To insert items into a container, pass a dictionary containing your data to [ContainerProxy.upsert_item][ref_container_upsert_item]. Each item you add to a container must include an `id` key with a value that uniquely identifies the item within the container.
 
 This example inserts several items into the container, each with a unique `id`:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -320,15 +326,15 @@
     )
 ```
 
 ### Delete data
 
 To delete items from a container, use [ContainerProxy.delete_item][ref_container_delete_item]. The SQL API in Cosmos DB does not support the SQL `DELETE` statement.
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -346,15 +352,15 @@
 
 ### Query the database
 
 A Cosmos DB SQL API database supports querying the items in a container with [ContainerProxy.query_items][ref_container_query_items] using SQL-like syntax.
 
 This example queries a container for items with a specific `id`:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -370,15 +376,15 @@
     print(json.dumps(item, indent=True))
 ```
 
 > NOTE: Although you can specify any value for the container name in the `FROM` clause, we recommend you use the container name for consistency.
 
 Perform parameterized queries by passing a dictionary containing the parameters and their values to [ContainerProxy.query_items][ref_container_query_items]:
 
-```Python
+```python
 discontinued_items = container.query_items(
     query='SELECT * FROM products p WHERE p.productModel = @model',
     parameters=[
         dict(name='@model', value='Model 7')
     ],
     enable_cross_partition_query=True
 )
@@ -388,15 +394,15 @@
 
 For more information on querying Cosmos DB databases using the SQL API, see [Query Azure Cosmos DB data with SQL queries][cosmos_sql_queries].
 
 ### Get database properties
 
 Get and display the properties of a database:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 import json
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
@@ -406,15 +412,15 @@
 print(json.dumps(properties))
 ```
 
 ### Get database and container throughputs
 
 Get and display the throughput values of a database and of a container with dedicated throughput:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 import json
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
@@ -433,15 +439,15 @@
 ```
 
 
 ### Modify container properties
 
 Certain properties of an existing container can be modified. This example sets the default time to live (TTL) for items in the container to 10 seconds:
 
-```Python
+```python
 from azure.cosmos import CosmosClient, PartitionKey
 import os
 import json
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
@@ -463,15 +469,15 @@
 For more information on TTL, see [Time to Live for Azure Cosmos DB data][cosmos_ttl].
 
 ### Using the asynchronous client
 
 The asynchronous cosmos client is a separate client that looks and works in a similar fashion to the existing synchronous client. However, the async client needs to be imported separately and its methods need to be used with the async/await keywords.
 The Async client needs to be initialized and closed after usage, which can be done manually or with the use of a context manager. The example below shows how to do so manually.
 
-```Python
+```python
 from azure.cosmos.aio import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 DATABASE_NAME = 'testDatabase'
 CONTAINER_NAME = 'products'    
@@ -488,15 +494,15 @@
             }
         )
     await client.close() # the async client must be closed manually if it's not initialized in a with statement
 ```
 
 Instead of manually opening and closing the client, it is highly recommended to use the `async with` keywords. This creates a context manager that will initialize and later close the client once you're out of the statement. The example below shows how to do so.
 
-```Python
+```python
 from azure.cosmos.aio import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 DATABASE_NAME = 'testDatabase'
 CONTAINER_NAME = 'products'
@@ -518,15 +524,15 @@
 
 Unlike the synchronous client, the async client does not have an `enable_cross_partition` flag in the request. Queries without a specified partition key value will attempt to do a cross partition query by default. 
 
 Query results can be iterated, but the query's raw output returns an asynchronous iterator. This means that each object from the iterator is an awaitable object, and does not yet contain the true query result. In order to obtain the query results you can use an async for loop, which awaits each result as you iterate on the object, or manually await each query result as you iterate over the asynchronous iterator.
 
 Since the query results are an asynchronous iterator, they can't be cast into lists directly; instead, if you need to create lists from your results, use an async for loop or Python's list comprehension to populate a list:
 
-```Python
+```python
 from azure.cosmos.aio import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -552,15 +558,15 @@
 ### Using Integrated Cache
 An integrated cache is an in-memory cache that helps you ensure manageable costs and low latency as your request volume grows. The integrated cache has two parts: an item cache for point reads and a query cache for queries. The code snippet below shows you how to use this feature with the point read and query cache methods.
 
 The benefit of using this is that the point reads and queries that hit the integrated cache won't use any RUs. This means you will have a much lower per-operation cost than reads from the backend.
 
 [How to configure the Azure Cosmos DB integrated cache (Preview)][cosmos_configure_integrated_cache]
 
-```Python
+```python
 import azure.cosmos.cosmos_client as cosmos_client
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = cosmos_client.CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -587,15 +593,15 @@
 
 When you interact with Cosmos DB using the Python SDK, exceptions returned by the service correspond to the same HTTP status codes returned for REST API requests:
 
 [HTTP Status Codes for Azure Cosmos DB][cosmos_http_status_codes]
 
 For example, if you try to create a container using an ID (name) that's already in use in your Cosmos DB database, a `409` error is returned, indicating the conflict. In the following snippet, the error is handled gracefully by catching the exception and displaying additional information about the error.
 
-```Python
+```python
 try:
     database.create_container(id=CONTAINER_NAME, partition_key=PartitionKey(path="/productName"))
 except exceptions.CosmosResourceExistsError:
     print("""Error creating container
 HTTP status code 409: The ID (name) provided for the container is already in use.
 The container name must be unique within the database.""")
 
@@ -624,38 +630,42 @@
 
 # This client will log detailed information about its HTTP sessions, at DEBUG level
 client = CosmosClient(URL, credential=KEY, logging_enable=True)
 ```
 
 Similarly, `logging_enable` can enable detailed logging for a single operation,
 even when it isn't enabled for the client:
-```py
+```python
 database = client.create_database(DATABASE_NAME, logging_enable=True)
 ```
 Alternatively, you can log using the CosmosHttpLoggingPolicy, which extends from the azure core HttpLoggingPolicy, by passing in your logger to the `logger` argument.
-By default, it will use the behaviour from HttpLoggingPolicy. The `enable_diagnostics_logging` argument will add additional diagnostic information to the logger.
+By default, it will use the behaviour from HttpLoggingPolicy. Passing in the `enable_diagnostics_logging` argument will enable the
+CosmosHttpLoggingPolicy, and will have additional information in the response relevant to debugging Cosmos issues.
 ```python
 import logging
 from azure.cosmos import CosmosClient
 
 #Create a logger for the 'azure' SDK
 logger = logging.getLogger('azure')
 logger.setLevel(logging.DEBUG)
 
 # Configure a file output
 handler = logging.FileHandler(filename="azure")
 logger.addHandler(handler)
 
-# This client will log diagnostic information from the HTTP session by using the CosmosHttpLoggingPolicy
+# This client will log diagnostic information from the HTTP session by using the CosmosHttpLoggingPolicy.
+# Since we passed in the logger to the client, it will log information on every request.
 client = CosmosClient(URL, credential=KEY, logger=logger, enable_diagnostics_logging=True)
 ```
-Similarly, CosmosHttpLoggingPolicy can enable detailed logging for a single operation,
-even when it isn't enabled for the client:
-```py
-database = client.create_database(DATABASE_NAME, logger=logger, enable_diagnostics_logging=True)
+Similarly, logging can be enabled for a single operation by passing in a logger to the singular request.
+However, if you desire to use the CosmosHttpLoggingPolicy to obtain additional information, the `enable_diagnostics_logging` argument needs to be passed in at the client constructor.
+```python
+# This example enables the CosmosHttpLoggingPolicy and uses it with the `logger` passed in to the `create_database` request.
+client = CosmosClient(URL, credential=KEY, enable_diagnostics_logging=True)
+database = client.create_database(DATABASE_NAME, logger=logger)
 ```
 
 ## Next steps
 
 For more extensive documentation on the Cosmos DB service, see the [Azure Cosmos DB documentation][cosmos_docs] on docs.microsoft.com.
 
 <!-- LINKS -->
```

## Comparing `azure-cosmos-4.3.1b1/samples/database_management_async.py` & `azure-cosmos-4.4.0b1/samples/database_management_async.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,14 +1,15 @@
 # -------------------------------------------------------------------------
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See LICENSE.txt in the project root for
 # license information.
 # -------------------------------------------------------------------------
-import azure.cosmos.aio.cosmos_client as cosmos_client
+from azure.cosmos.aio import CosmosClient
 import azure.cosmos.exceptions as exceptions
+from azure.cosmos import ThroughputProperties
 
 import asyncio
 import config
 
 # ----------------------------------------------------------------------------------------------------------
 # Prerequisites -
 #
@@ -38,15 +39,15 @@
 async def find_database(client, id):
     print('1. Query for Database')
 
     # Because the asynchronous client returns an asynchronous iterator object for methods that use
     # return several databases using queries, we do not need to await the function. However, attempting
     # to cast this object into a list directly will throw an error; instead, iterate over the databases
     # to populate your list using an async for loop like shown here or in the list_databases() method
-    query_databases_response = client.query_databases({
+    query_databases_response = client.query_databases(query={
         "query": "SELECT * FROM r WHERE r.id=@id",
         "parameters": [
             { "name":"@id", "value": id }
         ]
     })
 
     databases = [database async for database in query_databases_response]
@@ -134,15 +135,15 @@
         print('Database with id \'{0}\' was deleted'.format(id))
 
     except exceptions.CosmosResourceNotFoundError:
         print('A database with id \'{0}\' does not exist'.format(id))
 
 
 async def run_sample():
-    async with cosmos_client.CosmosClient(HOST, {'masterKey': MASTER_KEY}) as client:
+    async with CosmosClient(HOST, {'masterKey': MASTER_KEY}) as client:
         try:
             # query for a database
             await find_database(client, DATABASE_ID)
 
             # create a database
             await create_database(client, DATABASE_ID)
 
@@ -158,9 +159,8 @@
         except exceptions.CosmosHttpResponseError as e:
             print('\nrun_sample has caught an error. {0}'.format(e.message))
 
         finally:
             print("\nrun_sample done")
 
 if __name__ == '__main__':
-    loop = asyncio.get_event_loop()
-    loop.run_until_complete(run_sample())
+    asyncio.run(run_sample())
```

## Comparing `azure-cosmos-4.3.1b1/samples/access_cosmos_with_aad.py` & `azure-cosmos-4.4.0b1/samples/access_cosmos_with_aad.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/samples/index_management.py` & `azure-cosmos-4.4.0b1/samples/index_management.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/samples/container_management_async.py` & `azure-cosmos-4.4.0b1/samples/container_management_async.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,15 +1,16 @@
 # -------------------------------------------------------------------------
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See LICENSE.txt in the project root for
 # license information.
 # -------------------------------------------------------------------------
-import azure.cosmos.aio.cosmos_client as cosmos_client
+from azure.cosmos.aio import CosmosClient
 import azure.cosmos.exceptions as exceptions
 from azure.cosmos.partition_key import PartitionKey
+from azure.cosmos import ThroughputProperties
 
 import asyncio
 import config
 
 # ----------------------------------------------------------------------------------------------------------
 # Prerequisites -
 #
@@ -50,35 +51,34 @@
 # ----------------------------------------------------------------------------------------------------------
 
 HOST = config.settings['host']
 MASTER_KEY = config.settings['master_key']
 DATABASE_ID = config.settings['database_id']
 CONTAINER_ID = config.settings['container_id']
 
+
 async def find_container(db, id):
     print('1. Query for Container')
 
     # Because the asynchronous client returns an asynchronous iterator object for methods that use
     # return several containers using queries, we do not need to await the function. However, attempting
     # to cast this object into a list directly will throw an error; instead, iterate over the containers
     # to populate your list using an async for loop like shown here or in the list_containers() method
     query_containers_response = db.query_containers(
-        {
-            "query": "SELECT * FROM r WHERE r.id=@id",
-            "parameters": [
-                { "name":"@id", "value": id }
-            ]
-        }
+        query="SELECT * FROM r WHERE r.id=@id",
+        parameters=[
+            {"name": "@id", "value": id}
+        ]
     )
     containers = [container async for container in query_containers_response]
 
     if len(containers) > 0:
         print('Container with id \'{0}\' was found'.format(id))
     else:
-        print('No container with id \'{0}\' was found'. format(id))
+        print('No container with id \'{0}\' was found'.format(id))
 
     # Alternatively, you can directly iterate over the asynchronous iterator without building a separate
     # list if you don't need the ordering or indexing capabilities
     async for container in query_containers_response:
         print(container['id'])
 
 
@@ -100,49 +100,54 @@
     # This method attempts to read the container first, and based on the result either creates or returns
     # the existing container. Due to the additional overhead from attempting a read, it is recommended
     # to use the create_container() method if you know the container doesn't already exist.
     await db.create_container_if_not_exists(id=id, partition_key=partition_key)
 
     print("\n2.2 Create Container - With custom index policy")
 
-    coll = {
-        "id": id+"_container_custom_index_policy",
-        "indexingPolicy": {
-            "automatic": False
+    try:
+        coll = {
+            "id": id+"_container_custom_index_policy",
+            "indexingPolicy": {
+                "automatic": False
+            }
         }
-    }
 
-    container = await db.create_container_if_not_exists(
-        id=coll['id'],
-        partition_key=partition_key,
-        indexing_policy=coll['indexingPolicy']
-    )
-    properties = await container.read()
-    print('Container with id \'{0}\' created'.format(container.id))
-    print('IndexPolicy Mode - \'{0}\''.format(properties['indexingPolicy']['indexingMode']))
-    print('IndexPolicy Automatic - \'{0}\''.format(properties['indexingPolicy']['automatic']))
+        container = await db.create_container(
+            id=coll['id'],
+            partition_key=partition_key,
+            indexing_policy=coll['indexingPolicy']
+        )
+
+        properties = await container.read()
+        print('Container with id \'{0}\' created'.format(container.id))
+        print('IndexPolicy Mode - \'{0}\''.format(properties['indexingPolicy']['indexingMode']))
+        print('IndexPolicy Automatic - \'{0}\''.format(properties['indexingPolicy']['automatic']))
+
+    except exceptions.CosmosResourceExistsError:
+        print('A container with id \'{0}\' already exists'.format(coll['id']))
 
     print("\n2.3 Create Container - With custom provisioned throughput")
 
     try:
         container = await db.create_container(
-            id=id+"_container_custom_throughput",
+            id=id + "_container_custom_throughput",
             partition_key=partition_key,
             offer_throughput=400
         )
         print('Container with id \'{0}\' created'.format(container.id))
 
     except exceptions.CosmosResourceExistsError:
         print('A container with id \'{0}\' already exists'.format(coll['id']))
 
     print("\n2.4 Create Container - With Unique keys")
 
     try:
         container = await db.create_container(
-            id= id+"_container_unique_keys",
+            id=id + "_container_unique_keys",
             partition_key=partition_key,
             unique_key_policy={'uniqueKeys': [{'paths': ['/field1/field2', '/field3']}]}
         )
         properties = await container.read()
         unique_key_paths = properties['uniqueKeyPolicy']['uniqueKeys'][0]['paths']
         print('Container with id \'{0}\' created'.format(container.id))
         print('Unique Key Paths - \'{0}\', \'{1}\''.format(unique_key_paths[0], unique_key_paths[1]))
@@ -150,75 +155,75 @@
     except exceptions.CosmosResourceExistsError:
         print('A container with id \'container_unique_keys\' already exists')
 
     print("\n2.5 Create Container - With Partition key V2 (Default)")
 
     try:
         container = await db.create_container(
-            id=id+"_container_partition_key_v2",
+            id=id + "_container_partition_key_v2",
             partition_key=PartitionKey(path='/id', kind='Hash')
         )
         properties = await container.read()
         print('Container with id \'{0}\' created'.format(container.id))
         print('Partition Key - \'{0}\''.format(properties['partitionKey']))
 
     except exceptions.CosmosResourceExistsError:
         print('A container with id \'container_partition_key_v2\' already exists')
 
     print("\n2.6 Create Container - With Partition key V1")
 
     try:
         container = await db.create_container(
-            id=id+"_container_partition_key_v1",
+            id=id + "_container_partition_key_v1",
             partition_key=PartitionKey(path='/id', kind='Hash', version=1)
         )
         properties = await container.read()
         print('Container with id \'{0}\' created'.format(container.id))
         print('Partition Key - \'{0}\''.format(properties['partitionKey']))
 
     except exceptions.CosmosResourceExistsError:
         print('A container with id \'container_partition_key_v1\' already exists')
     except Exception:
         print("Skipping this step, account does not have Synapse Link activated")
 
-    print("\n2.7 Create Container - With analytical store enabled") 
-    
+    print("\n2.7 Create Container - With analytical store enabled")
+
     if 'localhost:8081' in HOST:
         print("Skipping step since emulator does not support this yet")
     else:
         try:
             container = await db.create_container(
-                id=id+"_container_analytical_store",
-                partition_key=PartitionKey(path='/id', kind='Hash'),analytical_storage_ttl=-1
+                id=id + "_container_analytical_store",
+                partition_key=PartitionKey(path='/id', kind='Hash'), analytical_storage_ttl=-1
 
             )
             properties = await container.read()
             print('Container with id \'{0}\' created'.format(container.id))
             print('Partition Key - \'{0}\''.format(properties['partitionKey']))
 
         except exceptions.CosmosResourceExistsError:
             print('A container with id \'_container_analytical_store\' already exists')
         except Exception:
-            print('Creating container with analytical storage can only happen in synapse link activated accounts, skipping step')
+            print(
+                'Creating container with analytical storage can only happen in synapse link activated accounts, skipping step')
 
     print("\n2.8 Create Container - With auto scale settings")
 
     try:
         container = await db.create_container(
-            id=id+"_container_auto_scale_settings",
+            id=id + "_container_auto_scale_settings",
             partition_key=partition_key,
             offer_throughput=ThroughputProperties(auto_scale_max_throughput=5000, auto_scale_increment_percent=0)
         )
         print('Container with id \'{0}\' created'.format(container.id))
 
     except exceptions.CosmosResourceExistsError:
         print('A container with id \'{0}\' already exists'.format(coll['id']))
 
 
-
 async def manage_provisioned_throughput(db, id):
     print("\n3.1 Get Container provisioned throughput (RU/s)")
 
     # A Container's Provisioned Throughput determines the performance throughput of a container.
     # A Container is loosely coupled to Offer through the Offer's offerResourceId
     # Offer.offerResourceId == Container._rid
     # Offer.resource == Container._self
@@ -226,26 +231,31 @@
     try:
         # read the container, so we can get its _self
         container = db.get_container_client(id)
 
         # now use its _self to query for throughput offers
         offer = await container.get_throughput()
 
-        print('Found Offer \'{0}\' for Container \'{1}\' and its throughput is \'{2}\''.format(offer.properties['id'], container.id, offer.properties['content']['offerThroughput']))
+        print('Found Offer \'{0}\' for Container \'{1}\' and its throughput is \'{2}\''.format(offer.properties['id'],
+                                                                                               container.id,
+                                                                                               offer.properties[
+                                                                                                   'content'][
+                                                                                                   'offerThroughput']))
 
     except exceptions.CosmosResourceExistsError:
         print('A container with id \'{0}\' does not exist'.format(id))
 
     print("\n3.2 Change Provisioned Throughput of Container")
 
-    #The Provisioned Throughput of a container controls the throughput allocated to the Container
+    # The Provisioned Throughput of a container controls the throughput allocated to the Container
 
-    #The following code shows how you can change Container's throughput
+    # The following code shows how you can change Container's throughput
     offer = await container.replace_throughput(offer.offer_throughput + 100)
-    print('Replaced Offer. Provisioned Throughput is now \'{0}\''.format(offer.properties['content']['offerThroughput']))
+    print(
+        'Replaced Offer. Provisioned Throughput is now \'{0}\''.format(offer.properties['content']['offerThroughput']))
 
 
 async def read_container(db, id):
     print("\n4. Get a Container by id")
 
     try:
         container = db.get_container_client(id)
@@ -288,16 +298,15 @@
         print('Container with id \'{0}\' was deleted'.format(id))
 
     except exceptions.CosmosResourceNotFoundError:
         print('A container with id \'{0}\' does not exist'.format(id))
 
 
 async def run_sample():
-
-    async with cosmos_client.CosmosClient(HOST, {'masterKey': MASTER_KEY}) as client:
+    async with CosmosClient(HOST, {'masterKey': MASTER_KEY}) as client:
         try:
             db = await client.create_database_if_not_exists(id=DATABASE_ID)
 
             # query for a container
             await find_container(db, CONTAINER_ID)
 
             # create a container
@@ -322,14 +331,12 @@
             except exceptions.CosmosResourceNotFoundError:
                 pass
 
         except exceptions.CosmosHttpResponseError as e:
             print('\nrun_sample has caught an error. {0}'.format(e.message))
 
         finally:
-                print("\nrun_sample done")
+            print("\nrun_sample done")
 
 
 if __name__ == '__main__':
-    loop = asyncio.get_event_loop()
-    loop.run_until_complete(run_sample())
-
+    asyncio.run(run_sample())
```

## Comparing `azure-cosmos-4.3.1b1/samples/examples.py` & `azure-cosmos-4.4.0b1/samples/examples.py`

 * *Files 6% similar despite different names*

```diff
@@ -144,7 +144,24 @@
 try:
     database.create_user(dict(id="Walter Harp"))
 except exceptions.CosmosResourceExistsError:
     print("A user with that ID already exists.")
 except exceptions.CosmosHttpResponseError as failure:
     print("Failed to create user. Status code:{}".format(failure.status_code))
 # [END create_user]
+
+# [START delete_all_items_by_partition_key]
+container_name = "products"
+container = database.get_container_client(container_name)
+for i in range(1, 10):
+    container.upsert_item(
+        dict(id="item{}".format(i), productName="Gadget", productModel="Model {}".format(i))
+    )
+items = container.read_all_items()
+for item in items:
+    print(json.dumps(item, indent=True))
+container.delete_all_items_by_partition_key("Gadget")
+print("All items in partition {} deleted.".format("Gadget"))
+items = container.read_all_items()
+for item in items:
+    print(json.dumps(item, indent=True))
+# [END delete_all_items_by_partition_key]
```

## Comparing `azure-cosmos-4.3.1b1/samples/document_management.py` & `azure-cosmos-4.4.0b1/samples/document_management.py`

 * *Files 23% similar despite different names*

```diff
@@ -98,23 +98,82 @@
 
     read_item = container.read_item(item=doc_id, partition_key=doc_id)
     read_item['subtotal'] = read_item['subtotal'] + 1
     response = container.upsert_item(body=read_item)
 
     print('Upserted Item\'s Id is {0}, new subtotal={1}'.format(response['id'], response['subtotal']))
 
+def patch_item(container, doc_id):
+    print('\n1.7 Patching Item by Id\n')
+
+    operations = [
+        {"op": "add", "path": "/favorite_color", "value": "red"},
+        {"op": "remove", "path": "/ttl"},
+        {"op": "replace", "path": "/tax_amount", "value": 14},
+        {"op": "set", "path": "/items/0/discount", "value": 20.0512},
+        {"op": "incr", "path": "/total_due", "value": 5},
+        {"op": "move", "from": "/freight", "path": "/service_addition"}
+    ]
+
+    response = container.patch_item(item=doc_id, partition_key=doc_id, patch_operations=operations)
+    print('Patched Item\'s Id is {0}, new path favorite color={1}, removed path ttl={2}, replaced path tax_amount={3},'
+          ' set path for item at index 0 of discount={4}, increase in path total_due, new total_due={5}, move from path freight={6}'
+          ' to path service_addition={7}'.format(response["id"], response["favorite_color"], response.get("ttl"),
+                                                 response["tax_amount"], response["items"].get(0).get("discount"),
+                                                 response["total_due"], response.get("freight"), response["service_addition"]))
 
 def delete_item(container, doc_id):
-    print('\n1.7 Deleting Item by Id\n')
+    print('\n1.8 Deleting Item by Id\n')
 
     response = container.delete_item(item=doc_id, partition_key=doc_id)
 
     print('Deleted item\'s Id is {0}'.format(doc_id))
 
 
+def delete_all_items_by_partition_key(db, partitionkey):
+    print('\n1.8 Deleting all Items by Partition Key\n')
+
+    # A container with a partition key that is different from id is needed
+    container = db.create_container_if_not_exists(id="Partition Key Delete Container",
+                                                  partition_key=PartitionKey(path='/company'))
+    sales_order_company_A1 = get_sales_order("SalesOrderCompanyA1")
+    sales_order_company_A1["company"] = partitionkey
+    container.upsert_item(sales_order_company_A1)
+
+    print("\nUpserted Item is {} with Partition Key: {}".format(sales_order_company_A1["id"], partitionkey))
+
+    sales_order_company_A2 = get_sales_order("SalesOrderCompanyA2")
+    sales_order_company_A2["company"] = partitionkey
+    container.upsert_item(sales_order_company_A2)
+
+    print("\nUpserted Item is {} with Partition Key: {}".format(sales_order_company_A2["id"], partitionkey))
+
+    sales_order_company_B1 = get_sales_order("SalesOrderCompanyB1")
+    sales_order_company_B1["company"] = "companyB"
+    container.upsert_item(sales_order_company_B1)
+
+    print("\nUpserted Item is {} with Partition Key: {}".format(sales_order_company_B1["id"], "companyB"))
+
+    item_list = list(container.read_all_items(max_item_count=10))
+
+    print('Found {0} items'.format(item_list.__len__()))
+
+    for doc in item_list:
+        print('Item Id: {0}; Partition Key: {1}'.format(doc.get('id'), doc.get("company")))
+
+    print("\nDelete all items for Partition Key: {}\n".format(partitionkey))
+
+    container.delete_all_items_by_partition_key(partitionkey)
+    item_list = list(container.read_all_items())
+
+    print('Found {0} items'.format(item_list.__len__()))
+
+    for doc in item_list:
+        print('Item Id: {0}; Partition Key: {1}'.format(doc.get('id'), doc.get("company")))
+
 def get_sales_order(item_id):
     order1 = {'id' : item_id,
             'account_number' : 'Account1',
             'purchase_order_number' : 'PO18009186470',
             'order_date' : datetime.date(2005,1,10).strftime('%c'),
             'subtotal' : 419.4589,
             'tax_amount' : 12.5838,
@@ -171,15 +230,17 @@
 
         create_items(container)
         read_item(container, 'SalesOrder1')
         read_items(container)
         query_items(container, 'SalesOrder1')
         replace_item(container, 'SalesOrder1')
         upsert_item(container, 'SalesOrder1')
+        patch_item(container, 'SalesOrder1')
         delete_item(container, 'SalesOrder1')
+        delete_all_items_by_partition_key(db, "CompanyA")
 
         # cleanup database after sample
         try:
             client.delete_database(db)
 
         except exceptions.CosmosResourceNotFoundError:
             pass
```

## Comparing `azure-cosmos-4.3.1b1/samples/examples_async.py` & `azure-cosmos-4.4.0b1/samples/examples_async.py`

 * *Files 8% similar despite different names*

```diff
@@ -155,13 +155,30 @@
             print("Created user Walter Harp.")
         except exceptions.CosmosResourceExistsError:
             print("A user with that ID already exists.")
         except exceptions.CosmosHttpResponseError as failure:
             print("Failed to create user. Status code:{}".format(failure.status_code))
         # [END create_user]
 
+        # delete all items in a given partition key
+        # [START delete_all_items_by_partition_key]
+        container_name = "products"
+        container = database.get_container_client(container_name)
+        for i in range(1, 10):
+            await container.upsert_item(
+                dict(id="item{}".format(i), productName="Gadget", productModel="Model {}".format(i))
+            )
+        items = await container.read_all_items()
+        async for item in items:
+            print(json.dumps(item, indent=True))
+        await container.delete_all_items_by_partition_key("Gadget")
+        print("All items in partition {} deleted.".format("Gadget"))
+        items = await container.read_all_items()
+        async for item in items:
+            print(json.dumps(item, indent=True))
+        # [END delete_all_items_by_partition_key]
+
         await client.delete_database(database_name)
         print("Sample done running!")
 
 if __name__ == "__main__":
-    loop = asyncio.get_event_loop()
-    loop.run_until_complete(examples_async())
+    asyncio.run(examples_async())
```

## Comparing `azure-cosmos-4.3.1b1/samples/access_cosmos_with_aad_async.py` & `azure-cosmos-4.4.0b1/samples/access_cosmos_with_aad_async.py`

 * *Files 1% similar despite different names*

```diff
@@ -108,9 +108,8 @@
 
     # To clean up the sample, we use a master key client again to get access to deleting containers/ databases.
     await delete_sample_resources()
     print("end of sample")
 
 
 if __name__ == "__main__":
-    loop = asyncio.get_event_loop()
-    loop.run_until_complete(run_sample())
+    asyncio.run(run_sample())
```

## Comparing `azure-cosmos-4.3.1b1/samples/container_management.py` & `azure-cosmos-4.4.0b1/samples/container_management.py`

 * *Files 2% similar despite different names*

```diff
@@ -2,14 +2,15 @@
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See LICENSE.txt in the project root for
 # license information.
 # -------------------------------------------------------------------------
 import azure.cosmos.cosmos_client as cosmos_client
 import azure.cosmos.exceptions as exceptions
 from azure.cosmos.partition_key import PartitionKey
+from azure.cosmos import ThroughputProperties
 
 import config
 
 # ----------------------------------------------------------------------------------------------------------
 # Prerequisites -
 #
 # 1. An Azure Cosmos account -
@@ -167,17 +168,19 @@
         print('A container with id \'container_partition_key_v1\' already exists')
 
     print("\n2.7 Create Container - With analytical store enabled")
 
     try:
         container = db.create_container(
             id=id+"_container_analytical_store",
-            partition_key=PartitionKey(path='/id', kind='Hash'),analytical_storage_ttl=-1
-
+            partition_key=PartitionKey(path='/id', kind='Hash'), analytical_storage_ttl=None
         )
+        """A value of None leaves analytical storage off and a value of -1 turns analytical storage on with no TTL.
+        Please note that analytical storage can only be enabled on Synapse Link enabled accounts."""
+
         properties = container.read()
         print('Container with id \'{0}\' created'.format(container.id))
         print('Partition Key - \'{0}\''.format(properties['partitionKey']))
 
     except exceptions.CosmosResourceExistsError:
         print('A container with id \'_container_analytical_store\' already exists')
```

## Comparing `azure-cosmos-4.3.1b1/samples/access_cosmos_with_resource_token_async.py` & `azure-cosmos-4.4.0b1/samples/access_cosmos_with_resource_token_async.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 # -------------------------------------------------------------------------
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See LICENSE.txt in the project root for
 # license information.
 # -------------------------------------------------------------------------
-import azure.cosmos.aio.cosmos_client as cosmos_client
+from azure.cosmos.aio import CosmosClient
 import azure.cosmos.exceptions as exceptions
 from azure.cosmos.partition_key import PartitionKey
 import azure.cosmos.documents as documents
 
 import asyncio
 import config
 import json
@@ -114,15 +114,15 @@
         ):
             print(json.dumps(item, indent=True))
     except exceptions.CosmosHttpResponseError:
         print("Error in querying item(s)")
 
 
 async def run_sample():
-    async with cosmos_client.CosmosClient(HOST, MASTER_KEY) as client:
+    async with CosmosClient(HOST, MASTER_KEY) as client:
 
         try:
             try:
                 db = await client.create_database(DATABASE_ID)
             except exceptions.CosmosResourceExistsError:
                 db = client.get_database_client(DATABASE_ID)
 
@@ -145,15 +145,15 @@
             permission = await create_permission_if_not_exists(user, permission_definition)
             token = {}
             token[container.container_link] = permission.properties["_token"]
 
             # Use token to connect to database
             # If you initialize the asynchronous client without using 'async with' in your context,
             # make sure to close the client once you're done using it
-            token_client = cosmos_client.CosmosClient(HOST, token)
+            token_client = CosmosClient(HOST, token)
             token_db = token_client.get_database_client(DATABASE_ID)
             token_container = token_db.get_container_client(CONTAINER_ID)
 
             ITEM_1_ID, ITEM_2_ID, ITEM_3_ID = "1", "2", "3"
 
             # Update or insert item if not exists
             await token_client_upsert(token_container, USERNAME, ITEM_1_ID)
@@ -185,15 +185,15 @@
             read_token[container.container_link] = permission.properties["_token"]
 
             # Closing current token client in order to re-initialize with read_token below:
             await token_client.close()
 
             # Use token to connect to database
             # If you initialize the asynchronous client without using 'async with' make sure to close it once you're done
-            token_client = cosmos_client.CosmosClient(HOST, read_token)
+            token_client = CosmosClient(HOST, read_token)
             token_db = token_client.get_database_client(DATABASE_ID)
             token_container = token_db.get_container_client(CONTAINER_ID)
 
             # Fails since this client has access to only items with partition key USERNAME_2 (ie. "user2")
             await token_client_read_all(token_container)
 
             # Ok to read item(s) with partition key "user2"
@@ -221,15 +221,15 @@
             item_token = {}
             item_token[container.container_link] = permission.properties["_token"]
 
             # Closing current token client in order to re-initialize with item_token below:
             await token_client.close()
 
             # Use token to connect to database
-            token_client = cosmos_client.CosmosClient(HOST, item_token)
+            token_client = CosmosClient(HOST, item_token)
             token_db = token_client.get_database_client(DATABASE_ID)
             token_container = token_db.get_container_client(CONTAINER_ID)
 
             # Fails since this client only has access to a specific item
             await token_client_read_all(token_container)
 
             # Fails too, for same reason
@@ -247,9 +247,8 @@
             print("\nrun_sample has caught an error. {0}".format(e.message))
 
         finally:
             print("\nrun_sample done")
 
 
 if __name__ == "__main__":
-    loop = asyncio.get_event_loop()
-    loop.run_until_complete(run_sample())
+    asyncio.run(run_sample())
```

## Comparing `azure-cosmos-4.3.1b1/samples/client_user_configs.py` & `azure-cosmos-4.4.0b1/samples/client_user_configs.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/samples/change_feed_management.py` & `azure-cosmos-4.4.0b1/samples/change_feed_management.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/samples/config.py` & `azure-cosmos-4.4.0b1/samples/config.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/samples/index_management_async.py` & `azure-cosmos-4.4.0b1/samples/index_management_async.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 # -------------------------------------------------------------------------
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See LICENSE.txt in the project root for
 # license information.
 # -------------------------------------------------------------------------
 import azure.cosmos.documents as documents
-import azure.cosmos.aio.cosmos_client as cosmos_client
+from azure.cosmos.aio import CosmosClient
 import azure.cosmos.exceptions as exceptions
 from azure.cosmos.partition_key import PartitionKey
 import urllib3
 from requests.utils import DEFAULT_CA_BUNDLE_PATH as CaCertPath
 
 import asyncio
 import config
@@ -45,15 +45,15 @@
     }
 
 def obtain_client():
     # Try to setup the cacert.pem
     # connection_policy.SSLConfiguration.SSLCaCerts = CaCertPath
     # Else, disable verification
     urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
-    return cosmos_client.CosmosClient(HOST, MASTER_KEY)
+    return CosmosClient(HOST, MASTER_KEY)
 
 
 # Query for Entity / Entities
 async def query_entities(parent, entity_type, id = None):
     find_entity_by_id_query = {
             "query": "SELECT * FROM r WHERE r.id=@id",
             "parameters": [
@@ -662,9 +662,8 @@
             print('Sample done, cleaning up sample-generated data')
             await client.delete_database(DATABASE_ID)
 
     except exceptions.AzureError as e:
         raise e
 
 if __name__ == '__main__':
-    loop = asyncio.get_event_loop()
-    loop.run_until_complete(run_sample())
+    asyncio.run(run_sample())
```

## Comparing `azure-cosmos-4.3.1b1/samples/document_management_async.py` & `azure-cosmos-4.4.0b1/samples/document_management_async.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 # -------------------------------------------------------------------------
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See LICENSE.txt in the project root for
 # license information.
 # -------------------------------------------------------------------------
-import azure.cosmos.aio.cosmos_client as cosmos_client
+from azure.cosmos.aio import CosmosClient
 import azure.cosmos.exceptions as exceptions
 from azure.cosmos.partition_key import PartitionKey
 import datetime
 
 import asyncio
 import config
 
@@ -116,23 +116,82 @@
 
     read_item = await container.read_item(item=doc_id, partition_key=doc_id)
     read_item['subtotal'] = read_item['subtotal'] + 1
     response = await container.upsert_item(body=read_item)
 
     print('Upserted Item\'s Id is {0}, new subtotal={1}'.format(response['id'], response['subtotal']))
 
+async def patch_item(container, doc_id):
+    print('\n1.7 Patching Item by Id\n')
+
+    operations = [
+        {"op": "add", "path": "/favorite_color", "value": "red"},
+        {"op": "remove", "path": "/ttl"},
+        {"op": "replace", "path": "/tax_amount", "value": 14},
+        {"op": "set", "path": "/items/0/discount", "value": 20.0512},
+        {"op": "incr", "path": "/total_due", "value": 5},
+        {"op": "move", "from": "/freight", "path": "/service_addition"}
+    ]
+
+    response = await container.patch_item(item=doc_id, partition_key=doc_id, patch_operations=operations)
+    print('Patched Item\'s Id is {0}, new path favorite color={1}, removed path ttl={2}, replaced path tax_amount={3},'
+          ' set path for item at index 0 of discount={4}, increase in path total_due, new total_due={5}, '
+          'move from path freight={6} to path service_addition={7}'.format(response["id"], response["favorite_color"],
+                                response.get("ttl"), response["tax_amount"], response["items"].get(0).get("discount"),
+                                response["total_due"], response.get("freight"), response["service_addition"]))
 
 async def delete_item(container, doc_id):
-    print('\n1.7 Deleting Item by Id\n')
+    print('\n1.8 Deleting Item by Id\n')
 
     await container.delete_item(item=doc_id, partition_key=doc_id)
 
     print('Deleted item\'s Id is {0}'.format(doc_id))
 
 
+async def delete_all_items_by_partition_key(db, partitionkey):
+    print('\n1.8 Deleting all Items by Partition Key\n')
+
+    # A container with a partition key that is different from id is needed
+    container = await db.create_container_if_not_exists(id="Partition Key Delete Container",
+                                                  partition_key=PartitionKey(path='/company'))
+    sales_order_company_A1 = get_sales_order("SalesOrderCompanyA1")
+    sales_order_company_A1["company"] = partitionkey
+    await container.upsert_item(sales_order_company_A1)
+
+    print("\nUpserted Item is {} with Partition Key: {}".format(sales_order_company_A1["id"], partitionkey))
+
+    sales_order_company_A2 = get_sales_order("SalesOrderCompanyA2")
+    sales_order_company_A2["company"] = partitionkey
+    await container.upsert_item(sales_order_company_A2)
+
+    print("\nUpserted Item is {} with Partition Key: {}".format(sales_order_company_A2["id"], partitionkey))
+
+    sales_order_company_B1 = get_sales_order("SalesOrderCompanyB1")
+    sales_order_company_B1["company"] = "companyB"
+    await container.upsert_item(sales_order_company_B1)
+
+    print("\nUpserted Item is {} with Partition Key: {}".format(sales_order_company_B1["id"], "companyB"))
+
+    item_list = [item async for item in container.read_all_items()]
+
+    print('Found {0} items'.format(item_list.__len__()))
+
+    for doc in item_list:
+        print('Item Id: {0}; Partition Key: {1}'.format(doc.get('id'), doc.get("company")))
+
+    print("\nDelete all items for Partition Key: {}\n".format(partitionkey))
+
+    await container.delete_all_items_by_partition_key(partitionkey)
+    item_list = [item async for item in container.read_all_items()]
+
+    print('Found {0} items'.format(item_list.__len__()))
+
+    for doc in item_list:
+        print('Item Id: {0}; Partition Key: {1}'.format(doc.get('id'), doc.get("company")))
+
 def get_sales_order(item_id):
     order1 = {'id' : item_id,
             'account_number' : 'Account1',
             'purchase_order_number' : 'PO18009186470',
             'order_date' : datetime.date(2005,1,10).strftime('%c'),
             'subtotal' : 419.4589,
             'tax_amount' : 12.5838,
@@ -176,30 +235,32 @@
                 ],
             'ttl' : 60 * 60 * 24 * 30
             }
 
     return order2
 
 async def run_sample():
-    async with cosmos_client.CosmosClient(HOST, {'masterKey': MASTER_KEY}) as client:
+    async with CosmosClient(HOST, {'masterKey': MASTER_KEY}) as client:
         try:
             # setup database for this sample
             db = await client.create_database_if_not_exists(id=DATABASE_ID)
 
             # setup container for this sample
             container = await db.create_container_if_not_exists(id=CONTAINER_ID, partition_key=PartitionKey(path='/id', kind='Hash'))
             print('Container with id \'{0}\' created'.format(CONTAINER_ID))
 
             await create_items(container)
             await read_item(container, 'SalesOrder1')
             await read_items(container)
             await query_items(container, 'SalesOrder1')
             await replace_item(container, 'SalesOrder1')
             await upsert_item(container, 'SalesOrder1')
+            await patch_item(container, 'SalesOrder1')
             await delete_item(container, 'SalesOrder1')
+            await delete_all_items_by_partition_key(db, "CompanyA")
 
             # cleanup database after sample
             try:
                 await client.delete_database(db)
 
             except exceptions.CosmosResourceNotFoundError:
                 pass
@@ -208,10 +269,8 @@
             print('\nrun_sample has caught an error. {0}'.format(e.message))
 
         finally:
                 print("\nrun_sample done")
 
 
 if __name__ == '__main__':
-    loop = asyncio.get_event_loop()
-    loop.run_until_complete(run_sample())
-
+    asyncio.run(run_sample())
```

## Comparing `azure-cosmos-4.3.1b1/samples/database_management.py` & `azure-cosmos-4.4.0b1/samples/database_management.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,14 +1,15 @@
 # -------------------------------------------------------------------------
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See LICENSE.txt in the project root for
 # license information.
 # -------------------------------------------------------------------------
 import azure.cosmos.cosmos_client as cosmos_client
 import azure.cosmos.exceptions as exceptions
+from azure.cosmos import ThroughputProperties
 
 import config
 
 # ----------------------------------------------------------------------------------------------------------
 # Prerequisites -
 #
 # 1. An Azure Cosmos account -
```

## Comparing `azure-cosmos-4.3.1b1/samples/change_feed_management_async.py` & `azure-cosmos-4.4.0b1/samples/change_feed_management_async.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 # -------------------------------------------------------------------------
 # Copyright (c) Microsoft Corporation. All rights reserved.
 # Licensed under the MIT License. See LICENSE.txt in the project root for
 # license information.
 # -------------------------------------------------------------------------
-import azure.cosmos.aio.cosmos_client as cosmos_client
+from azure.cosmos.aio import CosmosClient
 import azure.cosmos.exceptions as exceptions
 import azure.cosmos.documents as documents
 import azure.cosmos.partition_key as partition_key
 import uuid
 
 import asyncio
 import config
@@ -60,15 +60,15 @@
     async for doc in response:
         print(doc)
 
     print('\nFinished reading all the change feed\n')
 
 
 async def run_sample():
-    async with cosmos_client.CosmosClient(HOST, MASTER_KEY) as client:
+    async with CosmosClient(HOST, MASTER_KEY) as client:
         try:
             # setup database for this sample
             try:
                 db = await client.create_database(id=DATABASE_ID)
             except exceptions.CosmosResourceExistsError:
                 raise RuntimeError("Database with id '{}' already exists".format(DATABASE_ID))
 
@@ -96,9 +96,8 @@
             print('\nrun_sample has caught an error. {0}'.format(e.message))
 
         finally:
             print("\nrun_sample done")
 
 
 if __name__ == '__main__':
-    loop = asyncio.get_event_loop()
-    loop.run_until_complete(run_sample())
+    asyncio.run(run_sample())
```

## Comparing `azure-cosmos-4.3.1b1/samples/README.md` & `azure-cosmos-4.4.0b1/samples/README.md`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/samples/client_user_configs_async.py` & `azure-cosmos-4.4.0b1/samples/client_user_configs_async.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-import azure.cosmos.aio.cosmos_client as cosmos_client
+from azure.cosmos.aio import CosmosClient
 import config
 import asyncio
 
 HOST = config.settings['host']
 MASTER_KEY = config.settings['master_key']
 
 # ----------------------------------------------------------------------------------------------------------
@@ -36,17 +36,16 @@
 #    The default value is None as the SDK has its own retry logic configured where this option is taken care of.
 #
 # Note:
 # While these options can be configured, the SDK by default already has retry mechanisms and we recommend to use those.
 # ----------------------------------------------------------------------------------------------------------
 
 async def change_connection_retry_policy_configs():
-    async with cosmos_client.CosmosClient(url=HOST, credential=MASTER_KEY, retry_total=10, retry_connect=3,
+    async with CosmosClient(url=HOST, credential=MASTER_KEY, retry_total=10, retry_connect=3,
                                retry_read=3, retry_status=3,
                                retry_on_status_codes=([]),
                                retry_backoff_factor=.08, retry_backoff_max=120, retry_fixed_interval=None) as client:
         print('Client initialized with custom retry options')
 
 
 if __name__ == "__main__":
-    loop = asyncio.get_event_loop()
-    loop.run_until_complete(change_connection_retry_policy_configs())
+    asyncio.run(change_connection_retry_policy_configs())
```

## Comparing `azure-cosmos-4.3.1b1/samples/access_cosmos_with_resource_token.py` & `azure-cosmos-4.4.0b1/samples/access_cosmos_with_resource_token.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/samples/MultiMasterOperations/Worker.py` & `azure-cosmos-4.4.0b1/samples/MultiMasterOperations/Worker.py`

 * *Files 12% similar despite different names*

```diff
@@ -2,70 +2,72 @@
 import time
 import azure.cosmos.exceptions as exceptions
 from azure.cosmos.http_constants import StatusCodes
 
 class Worker(object):
     def __init__(self, client, database_name, collection_name):
         self.client = client
+        self.database = client.get_database_client(database_name)
+        self.document_collection = self.database.get_container_client(collection_name)
         self.document_collection_link = "dbs/" + database_name + "/colls/" + collection_name
 
     def run_loop_async(self, documents_to_insert):
         iteration_count = 0
 
         latency = []
         while iteration_count < documents_to_insert:
             document = {'id':  str(uuid.uuid4())}
             iteration_count += 1
 
             start = int(round(time.time() * 1000))
-            self.client.CreateItem(self.document_collection_link, document)
+            self.document_collection.create_item(document)
             end = int(round(time.time() * 1000))
 
             latency.append(end - start)
 
         latency = sorted(latency)
         p50_index = int(len(latency) / 2)
 
         print("Inserted %d documents at %s with p50 %d ms" %
             (documents_to_insert,
-            self.client.WriteEndpoint,
+            self.client.client_connection.WriteEndpoint,
             latency[p50_index]))
-        return document
 
     def read_all_async(self, expected_number_of_documents):
         while True:
             total_item_read = 0
-            query_iterable = self.client.ReadItems(self.document_collection_link)
+            # query_iterable = self.document_collection.ReadItems(self.document_collection_link)
+            query_iterable = self.document_collection.read_all_items()
             it = iter(query_iterable)
 
             doc = next(it, None)
             while doc:
                 total_item_read += 1
                 doc = next(it, None)
 
             if total_item_read < expected_number_of_documents:
                 print("Total item read %d from %s is less than %d, retrying reads" %
                         (total_item_read,
-                        self.client.WriteEndpoint,
+                        self.client.client_connection.WriteEndpoint,
                         expected_number_of_documents))
                 time.sleep(1)
                 continue
             else:
-                print("Read %d items from %s" % (total_item_read, self.client.ReadEndpoint))
+                print("Read %d items from %s" % (total_item_read, self.client.client_connection.ReadEndpoint))
                 break
 
 
     def delete_all_async(self):
-        query_iterable = self.client.ReadItems(self.document_collection_link)
+        query_iterable = self.document_collection.read_all_items()
         it = iter(query_iterable)
 
         doc = next(it, None)
         while doc:
             try:
-                self.client.DeleteItem(doc['_self'], {'partitionKey': doc['id']})
+                self.document_collection.delete_item(item=doc['id'], partition_key=doc['id'])
             except exceptions.CosmosResourceNotFoundError:
                 raise
             except exceptions.CosmosHttpResponseError as e:
-                print("Error occurred while deleting document from %s" % self.client.WriteEndpoint)
+                print("Error occurred while deleting document from %s" % self.client.client_connection.WriteEndpoint)
 
             doc = next(it, None)
-        print("Deleted all documents from region %s" % self.client.WriteEndpoint)
+        print("Deleted all documents from region %s" % self.client.client_connection.WriteEndpoint)
```

## Comparing `azure-cosmos-4.3.1b1/samples/MultiMasterOperations/ConflictWorker.py` & `azure-cosmos-4.4.0b1/samples/MultiMasterOperations/ConflictWorker.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 import uuid
 import time
 from multiprocessing.pool import ThreadPool
 import json
-import azure.cosmos.exceptions as exceptions
-from azure.cosmos.http_constants import StatusCodes
+from azure.cosmos import exceptions, PartitionKey
 
 class ConflictWorker(object):
     def __init__(self, database_name, basic_collection_name, manual_collection_name, lww_collection_name, udp_collection_name):
         self.clients = []
         self.basic_collection_link = "dbs/" + database_name + "/colls/" + basic_collection_name
         self.manual_collection_link = "dbs/" + database_name + "/colls/" + manual_collection_name
         self.lww_collection_link = "dbs/" + database_name + "/colls/" + lww_collection_name
@@ -20,52 +19,27 @@
         self.udp_collection_name = udp_collection_name
 
     def add_client(self, client):
         self.clients.append(client)
 
     def initialize_async(self):
         create_client = self.clients[0]
-        database = None
-        try:
-            database = create_client.ReadDatabase("dbs/" + self.database_name)
-        except exceptions.CosmosResourceNotFoundError:
-            print("database not found, needs to be created.")
-
-        if not database:
-            database = {'id': self.database_name}
-            database = create_client.CreateDatabase(database)
-
-        basic_collection = {'id': self.basic_collection_name}
-        basic = self.try_create_document_collection(create_client, database, basic_collection)
-
-        manual_collection = {
-                            'id': self.manual_collection_name,
-                            'conflictResolutionPolicy': {
-                                 'mode': 'Custom'
-                                }
-                            }
-        manual_collection = self.try_create_document_collection(create_client, database, manual_collection)
-
-        lww_collection = {
-                        'id': self.lww_collection_name,
-                        'conflictResolutionPolicy': {
-                            'mode': 'LastWriterWins',
-                            'conflictResolutionPath': '/regionId'
-                            }
-                        }
-        lww_collection = self.try_create_document_collection(create_client, database, lww_collection)
-
-        udp_collection = {
-                        'id': self.udp_collection_name,
-                        'conflictResolutionPolicy': {
-                            'mode': 'Custom',
-                            'conflictResolutionProcedure': 'dbs/' + self.database_name + "/colls/" + self.udp_collection_name + '/sprocs/resolver'
-                            }
-                        }
-        udp_collection = self.try_create_document_collection(create_client, database, udp_collection)
+        database = create_client.create_database_if_not_exists(self.database_name)
+
+        basic_collection = self.create_document_collection(database, self.basic_collection_name, None)
+
+        manual_resolution_policy = {'mode': 'Custom'}
+        manual_collection = self.create_document_collection(database, self.manual_collection_name, manual_resolution_policy)
+
+        lww_conflict_resolution_policy = {'mode': 'LastWriterWins', 'conflictResolutionPath': '/regionId'}
+
+        lww_collection = self.create_document_collection(database, self.lww_collection_name, lww_conflict_resolution_policy)
+
+        udp_custom_resolution_policy = {'mode': 'Custom' }
+        udp_collection = self.create_document_collection(database,self.udp_collection_name, udp_custom_resolution_policy)
 
         lww_sproc = {'id':'resolver',
                     'body': "function resolver(incomingRecord, existingRecord, isTombstone, conflictingRecords) {\r\n" +
                 "    var collection = getContext().getCollection();\r\n" +
                 "\r\n" +
                 "    if (!incomingRecord) {\r\n" +
                 "        if (existingRecord) {\r\n" +
@@ -114,30 +88,21 @@
                 "                    if (err) throw err;\r\n" +
                 "                });\r\n" +
                 "        }\r\n" +
                 "    }\r\n" +
                 "}"
                 }
         try:
-            lww_sproc = create_client.CreateStoredProcedure("dbs/" + self.database_name+ "/colls/" + self.udp_collection_name, lww_sproc)
+            udp_collection.scripts.create_stored_procedure(lww_sproc)
         except exceptions.CosmosResourceExistsError:
             return
 
-    def try_create_document_collection (self, client, database, collection):
-        read_collection = None
-        try:
-            read_collection = client.ReadContainer("dbs/" + database['id'] + "/colls/" + collection['id'])
-        except exceptions.CosmosResourceNotFoundError:
-            print("collection not found, needs to be created.")
-
-        if read_collection == None:
-            collection['partitionKey'] = {'paths': ['/id'],'kind': 'Hash'}
-            read_collection = client.CreateContainer(database['_self'], collection)
-            print("sleeping for 5 seconds to allow collection create to propagate.")
-            time.sleep(5)
+    def create_document_collection (self, database, collection_id, conflict_resolution_policy):
+        read_collection = database.create_container_if_not_exists(id=collection_id, partition_key=PartitionKey(path="/id"),
+                                                                  conflict_resolution_policy=conflict_resolution_policy)
         return read_collection
 
     def run_manual_conflict_async(self):
         print("\r\nInsert Conflict\r\n")
         self.run_insert_conflict_on_manual_async()
 
         print("\r\nUpdate Conflict\r\n")
@@ -171,16 +136,16 @@
             print("1) Performing conflicting insert across %d regions on %s" % (len(self.clients), self.manual_collection_link))
 
             id = str(uuid.uuid4())
             i = 0
             pool = ThreadPool(processes = len(self.clients))
             insert_document_futures = []
             for client in self.clients:
-                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.ReadEndpoint}
-                insert_document_future = pool.apply_async(self.try_insert_document, (client, self.manual_collection_link, conflict_document))
+                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.client_connection.ReadEndpoint}
+                insert_document_future = pool.apply_async(self.try_insert_document, (client, self.manual_collection_name, conflict_document))
                 insert_document_futures.append(insert_document_future)
                 i += 1
 
             number_of_conflicts = -1
             inserted_documents = []
             for insert_document_future in insert_document_futures:
                 inserted_document = insert_document_future.get()
@@ -198,27 +163,29 @@
                 break
             else:
                 print("Retrying insert to induce conflicts")
 
     def run_update_conflict_on_manual_async(self):
         while True:
             id = str(uuid.uuid4())
-            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].ReadEndpoint}
-            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.manual_collection_link, conflict_document_for_insertion)
+            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].client_connection.ReadEndpoint}
+            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.manual_collection_name, conflict_document_for_insertion)
             time.sleep(1) #1 Second for write to sync.
 
             print("1) Performing conflicting update across %d regions on %s" % (len(self.clients), self.manual_collection_link))
 
             i = 0
-            options = {'accessCondition': {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}}
+            access_condition = {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}
             pool = ThreadPool(processes = len(self.clients))
             update_document_futures = []
             for client in self.clients:
-                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.ReadEndpoint}
-                update_document_future = pool.apply_async(self.try_update_document, (client, self.manual_collection_link, conflict_document, options))
+                database = client.get_database_client(self.database_name)
+                container = database.get_container_client(self.manual_collection_name)
+                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.client_connection.ReadEndpoint}
+                update_document_future = pool.apply_async(self.try_update_document, (container, conflict_document, access_condition))
                 update_document_futures.append(update_document_future)
                 i += 1
 
             number_of_conflicts = -1
             update_documents = []
             for update_document_future in update_document_futures:
                 update_document = update_document_future.get()
@@ -236,29 +203,31 @@
                 break
             else:
                 print("Retrying update to induce conflicts")
 
     def run_delete_conflict_on_manual_async(self):
         while True:
             id = str(uuid.uuid4())
-            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].ReadEndpoint}
-            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.manual_collection_link, conflict_document_for_insertion)
+            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].client_connection.ReadEndpoint}
+            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.manual_collection_name, conflict_document_for_insertion)
             time.sleep(1) #1 Second for write to sync.
 
             print("1) Performing conflicting delete across %d regions on %s" % (len(self.clients), self.manual_collection_link))
 
             i = 0
-            options = {'accessCondition': {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}}
+            access_condition = {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}
             pool = ThreadPool(processes = len(self.clients))
             delete_document_futures = []
             for client in self.clients:
+                database = client.get_database_client(self.database_name)
+                container = database.get_container_client(self.manual_collection_name)
                 conflict_document = conflict_document_for_insertion.copy()
                 conflict_document['regionId'] = i
-                conflict_document['regionEndpoint'] = client.ReadEndpoint
-                delete_document_future = pool.apply_async(self.try_delete_document, (client, self.manual_collection_link, conflict_document, options))
+                conflict_document['regionEndpoint'] = client.client_connection.ReadEndpoint
+                delete_document_future = pool.apply_async(self.try_delete_document, (container, conflict_document, access_condition))
                 delete_document_futures.append(delete_document_future)
                 i += 1
 
             number_of_conflicts = -1
             delete_documents = []
             for delete_document_future in delete_document_futures:
                 delete_document = delete_document_future.get()
@@ -282,16 +251,16 @@
             print("1) Performing conflicting insert across %d regions on %s" % (len(self.clients), self.lww_collection_link))
 
             id = str(uuid.uuid4())
             i = 0
             pool = ThreadPool(processes = len(self.clients))
             insert_document_futures = []
             for client in self.clients:
-                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.ReadEndpoint}
-                insert_document_future = pool.apply_async(self.try_insert_document, (client, self.lww_collection_link, conflict_document))
+                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.client_connection.ReadEndpoint}
+                insert_document_future = pool.apply_async(self.try_insert_document, (client, self.lww_collection_name, conflict_document))
                 insert_document_futures.append(insert_document_future)
                 i += 1
 
             inserted_documents = []
             for insert_document_future in insert_document_futures:
                 inserted_document = insert_document_future.get()
                 if inserted_document:
@@ -304,27 +273,29 @@
                 break
             else:
                 print("Retrying insert to induce conflicts")
 
     def run_update_conflict_on_LWW_async(self):
         while True:
             id = str(uuid.uuid4())
-            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].ReadEndpoint}
-            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.lww_collection_link, conflict_document_for_insertion)
+            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].client_connection.ReadEndpoint}
+            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.lww_collection_name, conflict_document_for_insertion)
             time.sleep(1) #1 Second for write to sync.
 
             print("1) Performing conflicting update across %d regions on %s" % (len(self.clients), self.lww_collection_link))
 
             i = 0
-            options = {'accessCondition': {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}}
+            access_condition = {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}
             pool = ThreadPool(processes = len(self.clients))
             update_document_futures = []
             for client in self.clients:
-                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.ReadEndpoint}
-                update_document_future = pool.apply_async(self.try_update_document, (client, self.lww_collection_link, conflict_document, options))
+                database = client.get_database_client(self.database_name)
+                container = database.get_container_client(self.lww_collection_name)
+                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.client_connection.ReadEndpoint}
+                update_document_future = pool.apply_async(self.try_update_document, (container, conflict_document, access_condition))
                 update_document_futures.append(update_document_future)
                 i += 1
 
             update_documents = []
             for update_document_future in update_document_futures:
                 update_document = update_document_future.get()
                 if update_document:
@@ -337,27 +308,29 @@
                 break
             else:
                 print("Retrying update to induce conflicts")
 
     def run_delete_conflict_on_LWW_async(self):
         while True:
             id = str(uuid.uuid4())
-            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].ReadEndpoint}
-            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.lww_collection_link, conflict_document_for_insertion)
+            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].client_connection.ReadEndpoint}
+            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.lww_collection_name, conflict_document_for_insertion)
             time.sleep(1) #1 Second for write to sync.
 
             print("1) Performing conflicting update/delete across 3 regions on %s" % self.lww_collection_link)
 
             i = 0
-            options = {'accessCondition': {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}}
+            access_condition = {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}
             pool = ThreadPool(processes = len(self.clients))
             delete_document_futures = []
             for client in self.clients:
-                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.ReadEndpoint}
-                delete_document_future = pool.apply_async(self.try_update_or_delete_document, (client, self.lww_collection_link, conflict_document, options))
+                database = client.get_database_client(self.database_name)
+                container = database.get_container_client(self.lww_collection_name)
+                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.client_connection.ReadEndpoint}
+                delete_document_future = pool.apply_async(self.try_update_or_delete_document, (container, conflict_document, access_condition))
                 delete_document_futures.append(delete_document_future)
                 i += 1
 
             delete_documents = []
             for delete_document_future in delete_document_futures:
                 delete_document = delete_document_future.get()
                 if delete_document:
@@ -377,16 +350,16 @@
             print("1) Performing conflicting insert across 3 regions on %s" % self.udp_collection_link)
 
             id = str(uuid.uuid4())
             i = 0
             pool = ThreadPool(processes = len(self.clients))
             insert_document_futures = []
             for client in self.clients:
-                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.ReadEndpoint}
-                insert_document_future = pool.apply_async(self.try_insert_document, (client, self.udp_collection_link, conflict_document))
+                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.client_connection.ReadEndpoint}
+                insert_document_future = pool.apply_async(self.try_insert_document, (client, self.udp_collection_name, conflict_document))
                 insert_document_futures.append(insert_document_future)
                 i += 1
 
             inserted_documents = []
             for insert_document_future in insert_document_futures:
                 inserted_document = insert_document_future.get()
                 if inserted_document:
@@ -400,27 +373,29 @@
                 break
             else:
                 print("Retrying insert to induce conflicts")
 
     def run_update_conflict_on_UDP_async(self):
         while True:
             id = str(uuid.uuid4())
-            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].ReadEndpoint}
-            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.udp_collection_link, conflict_document_for_insertion)
+            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].client_connection.ReadEndpoint}
+            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.udp_collection_name, conflict_document_for_insertion)
             time.sleep(1) #1 Second for write to sync.
 
             print("1) Performing conflicting update across %d regions on %s" % (len(self.clients), self.udp_collection_link))
 
             i = 0
-            options = {'accessCondition': {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}}
+            access_condition = {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}
             pool = ThreadPool(processes = len(self.clients))
             update_document_futures = []
             for client in self.clients:
-                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.ReadEndpoint}
-                update_document_future = pool.apply_async(self.try_update_document, (client, self.udp_collection_link, conflict_document, options))
+                database = client.get_database_client(self.database_name)
+                container = database.get_container_client(self.udp_collection_name)
+                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.client_connection.ReadEndpoint}
+                update_document_future = pool.apply_async(self.try_update_document, (container, conflict_document, access_condition))
                 update_document_futures.append(update_document_future)
                 i += 1
 
             update_documents = []
             for update_document_future in update_document_futures:
                 update_document = update_document_future.get()
                 if update_document:
@@ -434,27 +409,29 @@
                 break
             else:
                 print("Retrying update to induce conflicts")
 
     def run_delete_conflict_on_UDP_async(self):
         while True:
             id = str(uuid.uuid4())
-            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].ReadEndpoint}
-            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.udp_collection_link, conflict_document_for_insertion)
+            conflict_document_for_insertion = {'id': id, 'regionId': 0, 'regionEndpoint': self.clients[0].client_connection.ReadEndpoint}
+            conflict_document_for_insertion = self.try_insert_document(self.clients[0], self.udp_collection_name, conflict_document_for_insertion)
             time.sleep(1) #1 Second for write to sync.
 
             print("1) Performing conflicting update/delete across 3 regions on %s" % self.udp_collection_link)
 
             i = 0
-            options = {'accessCondition': {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}}
+            access_condition = {'condition': 'IfMatch', 'type': conflict_document_for_insertion['_etag']}
             pool = ThreadPool(processes = len(self.clients))
             delete_document_futures = []
             for client in self.clients:
-                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.ReadEndpoint}
-                delete_document_future = pool.apply_async(self.try_update_or_delete_document, (client, self.udp_collection_link, conflict_document, options))
+                database = client.get_database_client(self.database_name)
+                container = database.get_container_client(self.udp_collection_name)
+                conflict_document = {'id': id, 'regionId': i, 'regionEndpoint': client.client_connection.ReadEndpoint}
+                delete_document_future = pool.apply_async(self.try_update_or_delete_document, (container, conflict_document, access_condition))
                 delete_document_futures.append(delete_document_future)
                 i += 1
 
             delete_documents = []
             for delete_document_future in delete_document_futures:
                 delete_document = delete_document_future.get()
                 if delete_document:
@@ -466,229 +443,231 @@
                 time.sleep(2) #allow conflicts resolution to propagate
                 # Delete should always win. irrespective of UDP.
                 self.validate_UDP_async(self.clients, delete_documents, True)
                 break
             else:
                 print("Retrying update/delete to induce conflicts")
 
-    def try_insert_document(self, client, collection_uri, document):
+    def try_insert_document(self, client, collection_name, document):
         try:
-            return client.CreateItem(collection_uri, document)
+            database = client.get_database_client(self.database_name)
+            container = database.get_container_client(collection_name)
+            return container.create_item(document)
         except exceptions.CosmosResourceExistsError:
+            print("Error found trying to insert document.")
             return None
 
-    def try_update_document(self, client, collection_uri, document, options):
+    def try_update_document(self, container, document, access_condition):
         try:
-            options['partitionKey'] = document['id']
-            return client.ReplaceItem(collection_uri + "/docs/" + document['id'], document, options)
+            return container.replace_item(document['id'], document, access_condition=access_condition)
         except (exceptions.CosmosResourceNotFoundError, exceptions.CosmosAccessConditionFailedError):
             # Lost synchronously or no document yet. No conflict is induced.
             return None
 
-    def try_delete_document(self, client, collection_uri, document, options):
+    def try_delete_document(self, container, document, access_condition):
         try:
-            options['partitionKey'] = document['id']
-            client.DeleteItem(collection_uri + "/docs/" + document['id'], options)
+            container.delete_item(document['id'], document['id'], access_condition=access_condition)
             return document
         except (exceptions.CosmosResourceNotFoundError, exceptions.CosmosAccessConditionFailedError):
             #Lost synchronously. No conflict is induced.
             return None
 
-    def try_update_or_delete_document(self, client, collection_uri, conflict_document, options):
+    def try_update_or_delete_document(self, container, conflict_document, access_condition):
         if int(conflict_document['regionId']) % 2 == 1:
             #We delete from region 1, even though region 2 always win.
-            return self.try_delete_document(client, collection_uri, conflict_document, options)
+            return self.try_delete_document(container, conflict_document, access_condition)
         else:
-            return self.try_update_document(client, collection_uri, conflict_document, options)
+            return self.try_update_document(container, conflict_document, access_condition)
 
     def validate_manual_conflict_async(self, clients, conflict_document):
 
         conflict_exists = False
         for client in clients:
             conflict_exists = self.validate_manual_conflict_async_internal(client, conflict_document)
 
         if conflict_exists:
             self.delete_conflict_async(conflict_document)
 
     def validate_manual_conflict_async_internal(self, client, conflict_document):
+        database = client.get_database_client(self.database_name)
+        container = database.get_container_client(self.manual_collection_name)
         while True:
-            conflicts_iterator = iter(client.ReadConflicts(self.manual_collection_link))
+            conflicts_iterator = iter(container.list_conflicts())
             conflict = next(conflicts_iterator, None)
             while conflict:
                 if conflict['operationType'] != 'delete':
                     conflict_document_content = json.loads(conflict['content'])
 
                     if conflict_document['id'] == conflict_document_content['id']:
                         if ((conflict_document['_rid'] == conflict_document_content['_rid']) and
                             (conflict_document['_etag'] == conflict_document_content['_etag'])):
                             print("Document from Region %d lost conflict @ %s" %
-                                  (int(conflict_document['regionId']), client.ReadEndpoint))
+                                  (int(conflict_document['regionId']), client.client_connection.ReadEndpoint))
                             return True
                         else:
                             #Checking whether this is the winner.
-                            options = {'partitionKey': conflict_document['id']}
-                            winner_document = client.ReadItem(conflict_document['_self'], options)
+                            winner_document = container.read_item(conflict_document['id'], conflict_document['id'])
                             print("Document from Region %d won the conflict @ %s" %
-                                  (int(winner_document['regionId']), client.ReadEndpoint))
+                                  (int(winner_document['regionId']), client.client_connection.ReadEndpoint))
                             return False
                 else:
                     if conflict['resourceId'] == conflict_document['_rid']:
-                        print("Delete conflict found @ %s" % client.ReadEndpoint)
+                        print("Delete conflict found @ %s" % client.client_connection.ReadEndpoint)
                         return False
                 conflict = next(conflicts_iterator, None)
 
             self.trace_error("Document %s is not found in conflict feed @ %s, retrying" %
-                             (conflict_document['id'], client.ReadEndpoint))
+                             (conflict_document['id'], client.client_connection.ReadEndpoint))
 
             time.sleep(0.5)
 
     def delete_conflict_async(self, conflict_document):
         del_client = self.clients[0]
-        conflicts_iterator = iter(del_client.ReadConflicts(self.manual_collection_link))
+        database = del_client.get_database_client(self.database_name)
+        container = database.get_container_client(self.manual_collection_name)
+        conflicts_iterator = iter(container.list_conflicts())
         conflict = next(conflicts_iterator, None)
 
         while conflict:
             conflict_content = json.loads(conflict['content'])
-            options = {'partitionKey': conflict_content['id']}
 
             if conflict['operationType'] != 'delete':
                 if ((conflict_content['_rid'] == conflict_document['_rid']) and
                     (conflict_content['_etag'] == conflict_document['_etag'])):
                     print("Deleting manual conflict %s from region %d" %
                           (conflict['resourceId'],
                            int(conflict_content['regionId'])))
-                    del_client.DeleteConflict(conflict['_self'], options)
+                    container.delete_conflict(conflict['id'], conflict_content['id'])
             elif conflict['resourceId'] == conflict_document['_rid']:
                 print("Deleting manual conflict %s from region %d" %
                       (conflict['resourceId'],
                        int(conflict_document['regionId'])))
-                del_client.DeleteConflict(conflict['_self'], options)
+                container.delete_conflict(conflict['id'], conflict_content['id'])
             conflict = next(conflicts_iterator, None)
 
     def validate_LWW_async(self, clients, conflict_document, has_delete_conflict):
         for client in clients:
             self.validate_LWW_async_internal(client, conflict_document, has_delete_conflict)
 
     def validate_LWW_async_internal(self, client, conflict_document, has_delete_conflict):
-        conflicts_iterator =iter(client.ReadConflicts(self.lww_collection_link))
+        database = client.get_database_client(self.database_name)
+        container = database.get_container_client(self.lww_collection_name)
+        conflicts_iterator = iter(container.list_conflicts())
 
         conflict = next(conflicts_iterator, None)
         conflict_count = 0
         while conflict:
             conflict_count += 1
             conflict = next(conflicts_iterator, None)
 
         if conflict_count > 0:
             self.trace_error("Found %d conflicts in the lww collection" % conflict_count)
             return
 
         if has_delete_conflict:
             while True:
                 try:
-                    options = {'partitionKey': conflict_document[0]['id']}
-                    client.ReadItem(conflict_document[0]['_self'], options)
-
+                    container.read_item(conflict_document[0]['id'], conflict_document[0]['id'])
                     self.trace_error("Delete conflict for document %s didn't win @ %s" %
-                                     (conflict_document[0]['id'], client.ReadEndpoint))
+                                     (conflict_document[0]['id'], client.client_connection.ReadEndpoint))
 
                     time.sleep(0.5)
                 except exceptions.CosmosResourceNotFoundError:
-                    print("Delete conflict won @ %s" % client.ReadEndpoint)
+                    print("Delete conflict won @ %s" % client.client_connection.ReadEndpoint)
                     return
                 except exceptions.CosmosHttpResponseError:
                     self.trace_error("Delete conflict for document %s didn't win @ %s" %
-                                    (conflict_document[0]['id'], client.ReadEndpoint))
+                                    (conflict_document[0]['id'], client.client_connection.ReadEndpoint))
 
                     time.sleep(0.5)
 
         winner_document = None
 
         for document in conflict_document:
             if winner_document is None or int(winner_document['regionId']) <= int(document['regionId']):
                 winner_document = document
 
         print("Document from region %d should be the winner" % int(winner_document['regionId']))
 
         while True:
             try:
-                options = {'partitionKey': winner_document['id']}
-                existing_document = client.ReadItem(winner_document['_self'], options)
+                existing_document = container.read_item(winner_document['id'], winner_document['id'])
 
                 if int(existing_document['regionId']) == int(winner_document['regionId']):
                     print("Winner document from region %d found at %s" %
-                          (int(existing_document['regionId']), client.ReadEndpoint))
+                          (int(existing_document['regionId']), client.client_connection.ReadEndpoint))
                     break
                 else:
                     self.trace_error("Winning document version from region %d is not found @ %s, retrying..." %
-                                     (int(winner_document["regionId"]), client.WriteEndpoint))
+                                     (int(winner_document["regionId"]), client.client_connection.WriteEndpoint))
 
                     time.sleep(0.5)
             except exceptions.AzureError as e:
                 self.trace_error("Winner document from region %d is not found @ %s, retrying..." %
-                                (int(winner_document["regionId"]), client.WriteEndpoint))
+                                (int(winner_document["regionId"]), client.client_connection.WriteEndpoint))
 
                 time.sleep(0.5)
 
     def validate_UDP_async(self, clients, conflict_document, has_delete_conflict):
         for client in clients:
             self.validate_UDP_async_internal(client, conflict_document, has_delete_conflict)
 
     def validate_UDP_async_internal(self, client, conflict_document, has_delete_conflict):
-        conflicts_iterator = iter(client.ReadConflicts(self.udp_collection_link))
+        database = client.get_database_client(self.database_name)
+        container = database.get_container_client(self.udp_collection_name)
+        conflicts_iterator = iter(container.list_conflicts())
 
         conflict = next(conflicts_iterator, None)
         conflict_count = 0
         while conflict:
             conflict_count += 1
             conflict = next(conflicts_iterator, None)
 
         if conflict_count > 0:
             self.trace_error("Found %d conflicts in the udp collection" % conflict_count)
             return
 
         if has_delete_conflict:
             while True:
                 try:
-                    options = {'partitionKey': conflict_document[0]['id']}
-                    client.ReadItem(conflict_document[0]['_self'], options)
+                    container.read_item(conflict_document[0]['id'], conflict_document[0]['id'])
 
                     self.trace_error("Delete conflict for document %s didn't win @ %s" %
-                                     (conflict_document[0]['id'], client.ReadEndpoint))
+                                     (conflict_document[0]['id'], client.client_connection.ReadEndpoint))
 
                     time.sleep(0.5)
                 except exceptions.CosmosResourceNotFoundError:
-                    print("Delete conflict won @ %s" % client.ReadEndpoint)
+                    print("Delete conflict won @ %s" % client.client_connection.ReadEndpoint)
                     return
                 except exceptions.CosmosHttpResponseError:
                     self.trace_error("Delete conflict for document %s didn't win @ %s" %
-                                    (conflict_document[0]['id'], client.ReadEndpoint))
+                                    (conflict_document[0]['id'], client.client_connection.ReadEndpoint))
                     time.sleep(0.5)
 
         winner_document = None
 
         for document in conflict_document:
             if winner_document is None or int(winner_document['regionId']) <= int(document['regionId']):
                 winner_document = document
 
         print("Document from region %d should be the winner" % int(winner_document['regionId']))
 
         while True:
             try:
-                options = {'partitionKey': winner_document['id']}
-                existing_document = client.ReadItem(self.udp_collection_link + "/docs/" + winner_document['id'], options)
+                existing_document = container.read_item(winner_document['id'], winner_document['id'])
 
                 if int(existing_document['regionId']) == int(winner_document['regionId']):
                     print("Winner document from region %d found at %s" %
-                          (int(existing_document["regionId"]), client.ReadEndpoint))
+                          (int(existing_document["regionId"]), client.client_connection.ReadEndpoint))
                     break
                 else:
                     self.trace_error("Winning document version from region %d is not found @ %s, retrying..." %
-                                     (int(winner_document['regionId']), client.WriteEndpoint))
+                                     (int(winner_document['regionId']), client.client_connection.WriteEndpoint))
 
                     time.sleep(0.5)
             except exceptions.AzureError:
                 self.trace_error("Winner document from region %d is not found @ %s, retrying..." %
-                                 (int(winner_document['regionId']), client.WriteEndpoint))
+                                 (int(winner_document['regionId']), client.client_connection.WriteEndpoint))
                 time.sleep(0.5)
 
     def trace_error(self, message):
         print('\n' + message + '\n')
```

## Comparing `azure-cosmos-4.3.1b1/samples/MultiMasterOperations/MultiMasterScenario.py` & `azure-cosmos-4.4.0b1/samples/MultiMasterOperations/MultiMasterScenario.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 from Configurations import Configurations
 from ConflictWorker import ConflictWorker
 from Worker import Worker
 from multiprocessing.pool import ThreadPool
 import azure.cosmos.documents as documents
-import azure.cosmos._cosmos_client_connection as cosmos_client_connection
+from azure.cosmos import CosmosClient
 
 class MultiMasterScenario(object):
     def __init__(self):
         self.account_endpoint = Configurations.ENDPOINT
         self.account_key = Configurations.ACCOUNT_KEY
 
         self.regions = Configurations.REGIONS.split(';')
@@ -23,20 +23,19 @@
         self.pool = ThreadPool(processes = len(self.regions))
 
         for region in self.regions:
             connection_policy = documents.ConnectionPolicy()
             connection_policy.UseMultipleWriteLocations = True
             connection_policy.PreferredLocations = [region]
 
-            client = cosmos_client_connection.CosmosClientConnection(
-                self.account_endpoint,
-                {'masterKey': self.account_key},
-                connection_policy,
-                documents.ConsistencyLevel.Session
-            )
+            client = CosmosClient(
+                url=self.account_endpoint,
+                credential=self.account_key,
+                consistency_level=documents.ConsistencyLevel.Session,
+                connection_policy=connection_policy)
 
             self.workers.append(Worker(client, self.database_name, self.basic_collection_name))
 
             self.conflict_worker.add_client(client)
 
     def initialize_async(self):
         self.conflict_worker.initialize_async()
```

## Comparing `azure-cosmos-4.3.1b1/azure_cosmos.egg-info/SOURCES.txt` & `azure-cosmos-4.4.0b1/azure_cosmos.egg-info/SOURCES.txt`

 * *Files 1% similar despite different names*

```diff
@@ -1,12 +1,13 @@
 CHANGELOG.md
 Contributing.md
 LICENSE
 MANIFEST.in
 README.md
+pyproject.toml
 setup.py
 azure/__init__.py
 azure/cosmos/__init__.py
 azure/cosmos/_auth_policy.py
 azure/cosmos/_base.py
 azure/cosmos/_constants.py
 azure/cosmos/_cosmos_client_connection.py
@@ -24,14 +25,15 @@
 azure/cosmos/_resource_throttle_retry_policy.py
 azure/cosmos/_retry_options.py
 azure/cosmos/_retry_utility.py
 azure/cosmos/_runtime_constants.py
 azure/cosmos/_session.py
 azure/cosmos/_session_retry_policy.py
 azure/cosmos/_synchronized_request.py
+azure/cosmos/_timeout_failover_retry_policy.py
 azure/cosmos/_utils.py
 azure/cosmos/_vector_session_token.py
 azure/cosmos/_version.py
 azure/cosmos/auth.py
 azure/cosmos/container.py
 azure/cosmos/cosmos_client.py
 azure/cosmos/database.py
@@ -118,14 +120,15 @@
 test/test_analytical_ttl_async.py
 test/test_auto_scale.py
 test/test_auto_scale_async.py
 test/test_backwards_compatibility.py
 test/test_base_unit.py
 test/test_client_user_agent.py
 test/test_config.py
+test/test_correlated_activity_id.py
 test/test_cosmos_http_logging_policy.py
 test/test_crud.py
 test/test_crud_async.py
 test/test_diagnostics.py
 test/test_encoding.py
 test/test_env.py
 test/test_globaldb.py
```

## Comparing `azure-cosmos-4.3.1b1/azure_cosmos.egg-info/PKG-INFO` & `azure-cosmos-4.4.0b1/azure_cosmos.egg-info/PKG-INFO`

 * *Files 5% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: azure-cosmos
-Version: 4.3.1b1
+Version: 4.4.0b1
 Summary: Microsoft Azure Cosmos Client Library for Python
 Home-page: https://github.com/Azure/azure-sdk-for-python
 Author: Microsoft Corporation
 Author-email: askdocdb@microsoft.com
 Maintainer: Microsoft
 Maintainer-email: askdocdb@microsoft.com
 License: MIT License
@@ -34,15 +34,20 @@
 Use the Azure Cosmos DB SQL API SDK for Python to manage databases and the JSON documents they contain in this NoSQL database service. High level capabilities are:
 
 * Create Cosmos DB **databases** and modify their settings
 * Create and modify **containers** to store collections of JSON documents
 * Create, read, update, and delete the **items** (JSON documents) in your containers
 * Query the documents in your database using **SQL-like syntax**
 
-[SDK source code][source_code] | [Package (PyPI)][cosmos_pypi] | [API reference documentation][ref_cosmos_sdk] | [Product documentation][cosmos_docs] | [Samples][cosmos_samples]
+[SDK source code][source_code]
+| [Package (PyPI)][cosmos_pypi]
+| [Package (Conda)](https://anaconda.org/microsoft/azure-cosmos/)
+| [API reference documentation][ref_cosmos_sdk]
+| [Product documentation][cosmos_docs]
+| [Samples][cosmos_samples]
 
 > This SDK is used for the [SQL API](https://docs.microsoft.com/azure/cosmos-db/sql-query-getting-started). For all other APIs, please check the [Azure Cosmos DB documentation](https://docs.microsoft.com/azure/cosmos-db/introduction) to evaluate the best SDK for your project.
 
 ## Getting started
 
 ### Important update on Python 2.x Support
 
@@ -89,28 +94,28 @@
 export ACCOUNT_KEY=$(az cosmosdb list-keys --resource-group $RES_GROUP --name $ACCT_NAME --query primaryMasterKey --output tsv)
 ```
 
 ### Create the client
 
 Once you've populated the `ACCOUNT_URI` and `ACCOUNT_KEY` environment variables, you can create the [CosmosClient][ref_cosmosclient].
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 
 import os
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 ```
 
 ### AAD Authentication
 
 You can also authenticate a client utilizing your service principal's AAD credentials and the azure identity package. 
 You can directly pass in the credentials information to ClientSecretCredential, or use the DefaultAzureCredential:
-```Python
+```python
 from azure.cosmos import CosmosClient
 from azure.identity import ClientSecretCredential, DefaultAzureCredential
 
 import os
 url = os.environ['ACCOUNT_URI']
 tenant_id = os.environ['TENANT_ID']
 client_id = os.environ['CLIENT_ID']
@@ -153,15 +158,15 @@
 When using queries that try to find items based on an **id** value, always make sure you are passing in a string type variable. Azure Cosmos DB only allows string id values and if you use any other datatype, this SDK will return no results and no error messages.
 
 ## Note on client consistency levels
 
 As of release version 4.3.0b3, if a user does not pass in an explicit consistency level to their client initialization,
 their client will use their database account's default level. Previously, the default was being set to `Session` consistency.
 If for some reason you'd like to keep doing this, you can change your client initialization to include the explicit parameter for this like shown:
-```Python
+```python
 from azure.cosmos import CosmosClient
 
 import os
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY, consistency_level='Session')
 ```
@@ -179,14 +184,15 @@
 * Continuation token for cross partitions queries
 * Change Feed: Processor
 * Change Feed: Read multiple partitions key values
 * Change Feed: Read specific time
 * Change Feed: Read from the beginning
 * Change Feed: Pull model
 * Cross-partition ORDER BY for mixed types
+* Enabling diagnostics for async query-type methods
 
 ### Control Plane Limitations:
 
 * Get CollectionSizeUsage, DatabaseUsage, and DocumentUsage metrics
 * Create Geospatial Index
 * Get the connection string
 * Get the minimum RU/s of a container
@@ -238,15 +244,15 @@
 * [Modify container properties](#modify-container-properties "Modify container properties")
 * [Using the asynchronous client](#using-the-asynchronous-client "Using the asynchronous client")
 
 ### Create a database
 
 After authenticating your [CosmosClient][ref_cosmosclient], you can work with any resource in the account. The code snippet below creates a SQL API database, which is the default when no API is specified when [create_database][ref_cosmosclient_create_database] is invoked.
 
-```Python
+```python
 from azure.cosmos import CosmosClient, exceptions
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -256,15 +262,15 @@
     database = client.get_database_client(DATABASE_NAME)
 ```
 
 ### Create a container
 
 This example creates a container with default settings. If a container with the same name already exists in the database (generating a `409 Conflict` error), the existing container is obtained instead.
 
-```Python
+```python
 from azure.cosmos import CosmosClient, PartitionKey, exceptions
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -286,15 +292,15 @@
 The options for analytical_storage_ttl are:
 
 + 0 or Null or not informed: Not enabled.
 + -1: The data will be stored infinitely.
 + Any other number: the actual ttl, in seconds.
 
 
-```Python
+```python
 CONTAINER_NAME = 'products'
 try:
     container = database.create_container(id=CONTAINER_NAME, partition_key=PartitionKey(path="/productName"),analytical_storage_ttl=-1)
 except exceptions.CosmosResourceExistsError:
     container = database.get_container_client(CONTAINER_NAME)
 except exceptions.CosmosHttpResponseError:
     raise
@@ -302,15 +308,15 @@
 
 The preceding snippets also handle the [CosmosHttpResponseError][ref_httpfailure] exception if the container creation failed. For more information on error handling and troubleshooting, see the [Troubleshooting](#troubleshooting "Troubleshooting") section.
 
 ### Get an existing container
 
 Retrieve an existing container from the database:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -321,15 +327,15 @@
 
 ### Insert data
 
 To insert items into a container, pass a dictionary containing your data to [ContainerProxy.upsert_item][ref_container_upsert_item]. Each item you add to a container must include an `id` key with a value that uniquely identifies the item within the container.
 
 This example inserts several items into the container, each with a unique `id`:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -346,15 +352,15 @@
     )
 ```
 
 ### Delete data
 
 To delete items from a container, use [ContainerProxy.delete_item][ref_container_delete_item]. The SQL API in Cosmos DB does not support the SQL `DELETE` statement.
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -372,15 +378,15 @@
 
 ### Query the database
 
 A Cosmos DB SQL API database supports querying the items in a container with [ContainerProxy.query_items][ref_container_query_items] using SQL-like syntax.
 
 This example queries a container for items with a specific `id`:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -396,15 +402,15 @@
     print(json.dumps(item, indent=True))
 ```
 
 > NOTE: Although you can specify any value for the container name in the `FROM` clause, we recommend you use the container name for consistency.
 
 Perform parameterized queries by passing a dictionary containing the parameters and their values to [ContainerProxy.query_items][ref_container_query_items]:
 
-```Python
+```python
 discontinued_items = container.query_items(
     query='SELECT * FROM products p WHERE p.productModel = @model',
     parameters=[
         dict(name='@model', value='Model 7')
     ],
     enable_cross_partition_query=True
 )
@@ -414,15 +420,15 @@
 
 For more information on querying Cosmos DB databases using the SQL API, see [Query Azure Cosmos DB data with SQL queries][cosmos_sql_queries].
 
 ### Get database properties
 
 Get and display the properties of a database:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 import json
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
@@ -432,15 +438,15 @@
 print(json.dumps(properties))
 ```
 
 ### Get database and container throughputs
 
 Get and display the throughput values of a database and of a container with dedicated throughput:
 
-```Python
+```python
 from azure.cosmos import CosmosClient
 import os
 import json
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
@@ -459,15 +465,15 @@
 ```
 
 
 ### Modify container properties
 
 Certain properties of an existing container can be modified. This example sets the default time to live (TTL) for items in the container to 10 seconds:
 
-```Python
+```python
 from azure.cosmos import CosmosClient, PartitionKey
 import os
 import json
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
@@ -489,15 +495,15 @@
 For more information on TTL, see [Time to Live for Azure Cosmos DB data][cosmos_ttl].
 
 ### Using the asynchronous client
 
 The asynchronous cosmos client is a separate client that looks and works in a similar fashion to the existing synchronous client. However, the async client needs to be imported separately and its methods need to be used with the async/await keywords.
 The Async client needs to be initialized and closed after usage, which can be done manually or with the use of a context manager. The example below shows how to do so manually.
 
-```Python
+```python
 from azure.cosmos.aio import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 DATABASE_NAME = 'testDatabase'
 CONTAINER_NAME = 'products'    
@@ -514,15 +520,15 @@
             }
         )
     await client.close() # the async client must be closed manually if it's not initialized in a with statement
 ```
 
 Instead of manually opening and closing the client, it is highly recommended to use the `async with` keywords. This creates a context manager that will initialize and later close the client once you're out of the statement. The example below shows how to do so.
 
-```Python
+```python
 from azure.cosmos.aio import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 DATABASE_NAME = 'testDatabase'
 CONTAINER_NAME = 'products'
@@ -544,15 +550,15 @@
 
 Unlike the synchronous client, the async client does not have an `enable_cross_partition` flag in the request. Queries without a specified partition key value will attempt to do a cross partition query by default. 
 
 Query results can be iterated, but the query's raw output returns an asynchronous iterator. This means that each object from the iterator is an awaitable object, and does not yet contain the true query result. In order to obtain the query results you can use an async for loop, which awaits each result as you iterate on the object, or manually await each query result as you iterate over the asynchronous iterator.
 
 Since the query results are an asynchronous iterator, they can't be cast into lists directly; instead, if you need to create lists from your results, use an async for loop or Python's list comprehension to populate a list:
 
-```Python
+```python
 from azure.cosmos.aio import CosmosClient
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -578,15 +584,15 @@
 ### Using Integrated Cache
 An integrated cache is an in-memory cache that helps you ensure manageable costs and low latency as your request volume grows. The integrated cache has two parts: an item cache for point reads and a query cache for queries. The code snippet below shows you how to use this feature with the point read and query cache methods.
 
 The benefit of using this is that the point reads and queries that hit the integrated cache won't use any RUs. This means you will have a much lower per-operation cost than reads from the backend.
 
 [How to configure the Azure Cosmos DB integrated cache (Preview)][cosmos_configure_integrated_cache]
 
-```Python
+```python
 import azure.cosmos.cosmos_client as cosmos_client
 import os
 
 URL = os.environ['ACCOUNT_URI']
 KEY = os.environ['ACCOUNT_KEY']
 client = cosmos_client.CosmosClient(URL, credential=KEY)
 DATABASE_NAME = 'testDatabase'
@@ -613,15 +619,15 @@
 
 When you interact with Cosmos DB using the Python SDK, exceptions returned by the service correspond to the same HTTP status codes returned for REST API requests:
 
 [HTTP Status Codes for Azure Cosmos DB][cosmos_http_status_codes]
 
 For example, if you try to create a container using an ID (name) that's already in use in your Cosmos DB database, a `409` error is returned, indicating the conflict. In the following snippet, the error is handled gracefully by catching the exception and displaying additional information about the error.
 
-```Python
+```python
 try:
     database.create_container(id=CONTAINER_NAME, partition_key=PartitionKey(path="/productName"))
 except exceptions.CosmosResourceExistsError:
     print("""Error creating container
 HTTP status code 409: The ID (name) provided for the container is already in use.
 The container name must be unique within the database.""")
 
@@ -650,38 +656,42 @@
 
 # This client will log detailed information about its HTTP sessions, at DEBUG level
 client = CosmosClient(URL, credential=KEY, logging_enable=True)
 ```
 
 Similarly, `logging_enable` can enable detailed logging for a single operation,
 even when it isn't enabled for the client:
-```py
+```python
 database = client.create_database(DATABASE_NAME, logging_enable=True)
 ```
 Alternatively, you can log using the CosmosHttpLoggingPolicy, which extends from the azure core HttpLoggingPolicy, by passing in your logger to the `logger` argument.
-By default, it will use the behaviour from HttpLoggingPolicy. The `enable_diagnostics_logging` argument will add additional diagnostic information to the logger.
+By default, it will use the behaviour from HttpLoggingPolicy. Passing in the `enable_diagnostics_logging` argument will enable the
+CosmosHttpLoggingPolicy, and will have additional information in the response relevant to debugging Cosmos issues.
 ```python
 import logging
 from azure.cosmos import CosmosClient
 
 #Create a logger for the 'azure' SDK
 logger = logging.getLogger('azure')
 logger.setLevel(logging.DEBUG)
 
 # Configure a file output
 handler = logging.FileHandler(filename="azure")
 logger.addHandler(handler)
 
-# This client will log diagnostic information from the HTTP session by using the CosmosHttpLoggingPolicy
+# This client will log diagnostic information from the HTTP session by using the CosmosHttpLoggingPolicy.
+# Since we passed in the logger to the client, it will log information on every request.
 client = CosmosClient(URL, credential=KEY, logger=logger, enable_diagnostics_logging=True)
 ```
-Similarly, CosmosHttpLoggingPolicy can enable detailed logging for a single operation,
-even when it isn't enabled for the client:
-```py
-database = client.create_database(DATABASE_NAME, logger=logger, enable_diagnostics_logging=True)
+Similarly, logging can be enabled for a single operation by passing in a logger to the singular request.
+However, if you desire to use the CosmosHttpLoggingPolicy to obtain additional information, the `enable_diagnostics_logging` argument needs to be passed in at the client constructor.
+```python
+# This example enables the CosmosHttpLoggingPolicy and uses it with the `logger` passed in to the `create_database` request.
+client = CosmosClient(URL, credential=KEY, enable_diagnostics_logging=True)
+database = client.create_database(DATABASE_NAME, logger=logger)
 ```
 
 ## Next steps
 
 For more extensive documentation on the Cosmos DB service, see the [Azure Cosmos DB documentation][cosmos_docs] on docs.microsoft.com.
 
 <!-- LINKS -->
@@ -734,14 +744,39 @@
 This project has adopted the [Microsoft Open Source Code of Conduct](https://opensource.microsoft.com/codeofconduct/).
 For more information see the [Code of Conduct FAQ](https://opensource.microsoft.com/codeofconduct/faq/) or
 contact [opencode@microsoft.com](mailto:opencode@microsoft.com) with any additional questions or comments.
 
 
 ## Release History
 
+### 4.4.0b1 (2023-04-11)
+
+#### Features Added
+ - Added **preview** delete all items by partition key functionality. See [PR 29186](https://github.com/Azure/azure-sdk-for-python/pull/29186).
+ - Added **preview** partial document update (Patch API) functionality and container methods for patching items with operations. See [PR 29497](https://github.com/Azure/azure-sdk-for-python/pull/29497). For more information on Patch, please see [Azure Cosmos DB Partial Document Update](https://learn.microsoft.com/azure/cosmos-db/partial-document-update).
+
+
+#### Bugs Fixed
+* Fixed bug in method `create_container_if_not_exists()` of async database client for unexpected kwargs being passed into `read()` method used internally. See [PR 29136](https://github.com/Azure/azure-sdk-for-python/pull/29136).
+* Fixed bug with method `query_items()` of our async container class, where partition key and cross partition headers would both be set when using partition keys. See [PR 29366](https://github.com/Azure/azure-sdk-for-python/pull/29366/).
+* Fixed bug with client not properly surfacing errors for invalid credentials and identities with insufficient permissions. Users running into 'NoneType has no attribute ConsistencyPolicy' errors when initializing their clients will now see proper authentication exceptions. See [PR 29256](https://github.com/Azure/azure-sdk-for-python/pull/29256).
+
+#### Other Changes
+* Removed use of `six` package within the SDK.
+
+### 4.3.1 (2023-02-23)
+
+#### Features Added
+ - Added `correlated_activity_id` for query operations.
+ - Added cross regional retries for Service Unavailable/Request Timeouts for read/Query Plan operations.
+ - GA release of CosmosHttpLoggingPolicy and autoscale feature.
+
+#### Bugs Fixed
+- Bug fix to address queries with VALUE MAX (or any other aggregate) that run into an issue if the query is executed on a container with at least one "empty" partition.
+
 ### 4.3.1b1 (2022-09-19)
 
 #### Features Added
 - GA release of integrated cache functionality. For more information on integrated cache please see [Azure Cosmos DB integrated cache](https://docs.microsoft.com/azure/cosmos-db/integrated-cache).
 - Added ability to replace analytical ttl on containers. For more information on analytical ttl please see [Azure Cosmos DB analytical store](https://docs.microsoft.com/azure/cosmos-db/analytical-store-introduction).
 - Added `CosmosHttpLoggingPolicy` to replace `HttpLoggingPolicy` for logging HTTP sessions.
 - Added the ability to create containers and databases with autoscale properties for the sync and async clients.
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_partition.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_partition.py`

 * *Files 2% similar despite different names*

```diff
@@ -19,17 +19,14 @@
 # OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 # SOFTWARE.
 
 """Internal class for client side partition implementation in the Azure Cosmos
 database service.
 """
 
-from six.moves import xrange
-
-
 class Partition(object):
     """A class that holds the hash value and node name for a partition.
     """
 
     def __init__(self, hash_value=None, node=None):
         self.hash_value = hash_value
         self.node = node
@@ -52,13 +49,13 @@
         """Compare the passed hash value with the hash value of this object.
         """
         if len(self.hash_value) != len(other_hash_value):
             raise ValueError("Length of hashes doesn't match.")
 
         # The hash byte array that is returned from ComputeHash method has the MSB at the end of the array
         # so comparing the bytes from the end for compare operations.
-        for i in xrange(0, len(self.hash_value)):
+        for i in range(0, len(self.hash_value)):
             if self.hash_value[len(self.hash_value) - i - 1] < other_hash_value[len(self.hash_value) - i - 1]:
                 return -1
             if self.hash_value[len(self.hash_value) - i - 1] > other_hash_value[len(self.hash_value) - i - 1]:
                 return 1
         return 0
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_runtime_constants.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_runtime_constants.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_retry_options.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_retry_options.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_resource_throttle_retry_policy.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_resource_throttle_retry_policy.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/__init__.py` & `azure-cosmos-4.4.0b1/azure/cosmos/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/cosmos_client.py` & `azure-cosmos-4.4.0b1/azure/cosmos/cosmos_client.py`

 * *Files 2% similar despite different names*

```diff
@@ -135,14 +135,15 @@
 
     Use this client to configure and execute requests to the Azure Cosmos DB service.
 
     :param str url: The URL of the Cosmos DB account.
     :param credential: Can be the account key, or a dictionary of resource tokens.
     :type credential: Union[str, Dict[str, str], ~azure.core.credentials.TokenCredential]
     :param str consistency_level: Consistency level to use for the session. The default value is None (Account level).
+        More on consistency levels and possible values: https://aka.ms/cosmos-consistency-levels
     :keyword int timeout: An absolute timeout in seconds, for the combined HTTP request and response processing.
     :keyword int request_timeout: The HTTP request timeout in milliseconds.
     :keyword str connection_mode: The connection mode for the client - currently only supports 'Gateway'.
     :keyword proxy_config: Connection proxy configuration.
     :paramtype proxy_config: ~azure.cosmos.ProxyConfiguration
     :keyword ssl_config: Connection SSL configuration.
     :paramtype ssl_config: ~azure.cosmos.SSLConfiguration
@@ -155,14 +156,18 @@
     :keyword int retry_connect: Maximum number of connection error retry attempts.
     :keyword int retry_status: Maximum number of retry attempts on error status codes.
     :keyword list[int] retry_on_status_codes: A list of specific status codes to retry on.
     :keyword float retry_backoff_factor: Factor to calculate wait time between retry attempts.
     :keyword bool enable_endpoint_discovery: Enable endpoint discovery for
         geo-replicated database accounts. (Default: True)
     :keyword list[str] preferred_locations: The preferred locations for geo-replicated database accounts.
+    :keyword bool enable_diagnostics_logging: Enable the CosmosHttpLogging policy.
+        Must be used along with a logger to work.
+    :keyword ~logging.Logger logger: Logger to be used for collecting request diagnostics. Can be passed in at client
+        level (to log all requests) or at a single request level. Requests will be logged at INFO level.
 
     .. admonition:: Example:
 
         .. literalinclude:: ../samples/examples.py
             :start-after: [START create_client]
             :end-before: [END create_client]
             :language: python
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/user.py` & `azure-cosmos-4.4.0b1/azure/cosmos/user.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_global_endpoint_manager.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_global_endpoint_manager.py`

 * *Files 1% similar despite different names*

```diff
@@ -21,15 +21,15 @@
 
 """Internal class for global endpoint manager implementation in the Azure Cosmos
 database service.
 """
 
 import threading
 
-from six.moves.urllib.parse import urlparse
+from urllib.parse import urlparse
 
 from . import _constants as constants
 from . import exceptions
 from ._location_cache import LocationCache
 
 # pylint: disable=protected-access
 
@@ -133,16 +133,15 @@
             for location_name in self.PreferredLocations:
                 locational_endpoint = _GlobalEndpointManager.GetLocationalEndpoint(self.DefaultEndpoint, location_name)
                 try:
                     database_account = self._GetDatabaseAccountStub(locational_endpoint, **kwargs)
                     return database_account
                 except exceptions.CosmosHttpResponseError:
                     pass
-
-            return None
+            raise
 
     def _GetDatabaseAccountStub(self, endpoint, **kwargs):
         """Stub for getting database account from the client.
 
         This can be used for mocking purposes as well.
         """
         return self.Client.GetDatabaseAccount(endpoint, **kwargs)
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_base.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_base.py`

 * *Files 2% similar despite different names*

```diff
@@ -41,34 +41,20 @@
 
 # pylint: disable=protected-access
 
 _COMMON_OPTIONS = {
     'initial_headers': 'initialHeaders',
     'pre_trigger_include': 'preTriggerInclude',
     'post_trigger_include': 'postTriggerInclude',
-    'max_item_count': 'maxItemCount',
     'access_condition': 'accessCondition',
-    'indexing_directive': 'indexingDirective',
-    'consistency_level': 'consistencyLevel',
     'session_token': 'sessionToken',
-    'enable_scan_in_query': 'enableScanInQuery',
     'resource_token_expiry_seconds': 'resourceTokenExpirySeconds',
-    'offer_type': 'offerType',
-    'offer_throughput': 'offerThroughput',
-    'partition_key': 'partitionKey',
-    'enable_cross_partition_query': 'enableCrossPartitionQuery',
-    'populate_query_metrics': 'populateQueryMetrics',
-    'enable_script_logging': 'enableScriptLogging',
     'offer_enable_ru_per_minute_throughput': 'offerEnableRUPerMinuteThroughput',
     'disable_ru_per_minute_usage': 'disableRUPerMinuteUsage',
-    'change_feed': 'changeFeed',
     'continuation': 'continuation',
-    'is_start_from_beginning': 'isStartFromBeginning',
-    'populate_partition_key_range_statistics': 'populatePartitionKeyRangeStatistics',
-    'populate_quota_info': 'populateQuotaInfo',
     'content_type': 'contentType',
     'is_query_plan_request': 'isQueryPlanRequest',
     'supported_query_features': 'supportedQueryFeatures',
     'query_version': 'queryVersion'
 }
 
 
@@ -237,14 +223,15 @@
     if options.get("populateQueryMetrics"):
         headers[http_constants.HttpHeaders.PopulateQueryMetrics] = options["populateQueryMetrics"]
 
     if cosmos_client_connection.master_key:
         headers[http_constants.HttpHeaders.XDate] = datetime.datetime.utcnow().strftime("%a, %d %b %Y %H:%M:%S GMT")
 
     if cosmos_client_connection.master_key or cosmos_client_connection.resource_tokens:
+        resource_type = _internal_resourcetype(resource_type)
         authorization = auth._get_authorization_header(
             cosmos_client_connection, verb, path, resource_id, IsNameBased(resource_id), resource_type, headers
         )
         # urllib.quote throws when the input parameter is None
         if authorization:
             # -_.!~*'() are valid characters in url, and shouldn't be quoted.
             authorization = urllib_quote(authorization, "-_.!~*'()")
@@ -295,14 +282,17 @@
 
     if options.get("maxIntegratedCacheStaleness"):
         headers[http_constants.HttpHeaders.DedicatedGatewayCacheStaleness] = options["maxIntegratedCacheStaleness"]
 
     if options.get("autoUpgradePolicy"):
         headers[http_constants.HttpHeaders.AutoscaleSettings] = options["autoUpgradePolicy"]
 
+    if options.get("correlatedActivityId"):
+        headers[http_constants.HttpHeaders.CorrelatedActivityId] = options["correlatedActivityId"]
+
     return headers
 
 
 def GetResourceIdOrFullNameFromLink(resource_link):
     """Gets resource id or full name from resource link.
 
     :param str resource_link:
@@ -727,25 +717,34 @@
                                         'offerAutopilotSettings']['maxThroughput'])
 
     return ThroughputProperties(offer_throughput=throughput_properties[0]["content"]["offerThroughput"],
                                 properties=throughput_properties[0])
 
 
 def _replace_throughput(throughput: Union[int, ThroughputProperties], new_throughput_properties: list):
-    max_throughput = throughput.auto_scale_max_throughput
-    increment_percent = throughput.auto_scale_increment_percent
-
     try:
+        max_throughput = throughput.auto_scale_max_throughput
+        increment_percent = throughput.auto_scale_increment_percent
         if max_throughput is not None:
             new_throughput_properties['content']['offerAutopilotSettings'][
                 'maxThroughput'] = max_throughput
             if increment_percent:
                 new_throughput_properties['content']['offerAutopilotSettings']['autoUpgradePolicy']['throughputPolicy'][
                     'incrementPercent'] = increment_percent
             if throughput.offer_throughput:
                 new_throughput_properties["content"]["offerThroughput"] = throughput.offer_throughput
 
     except AttributeError:
         if isinstance(throughput, int):
             new_throughput_properties["content"]["offerThroughput"] = throughput
         else:
             raise TypeError("offer_throughput must be int or an instance of ThroughputProperties")
+
+
+def _internal_resourcetype(resource_type: str) -> str:
+    """Partitionkey is used as the resource type for deleting all items by partition key in
+    other SDKs, but the colls resource type needs to be sent for the feature to work. In order to keep it consistent
+    with other SDKs, we switch it here.
+    """
+    if resource_type.lower() ==  "partitionkey":
+        return "colls"
+    return resource_type
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_request_object.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_request_object.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_session_retry_policy.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_session_retry_policy.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_vector_session_token.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_vector_session_token.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_session.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_session.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/database.py` & `azure-cosmos-4.4.0b1/azure/cosmos/database.py`

 * *Files 0% similar despite different names*

```diff
@@ -738,15 +738,15 @@
         :keyword Callable response_hook: A callable invoked with the response metadata.
         :returns: ThroughputProperties for the database.
         :raises ~azure.cosmos.exceptions.CosmosHttpResponseError: No throughput properties exists for the container or
             the throughput properties could not be retrieved.
         :rtype: ~azure.cosmos.ThroughputProperties
         """
         warnings.warn(
-            "read_offer is a deprecated method name, use read_throughput instead",
+            "read_offer is a deprecated method name, use get_throughput instead",
             DeprecationWarning
         )
         return self.get_throughput(**kwargs)
 
     @distributed_trace
     def get_throughput(self, **kwargs):
         # type: (Any) -> ThroughputProperties
@@ -779,19 +779,16 @@
     @distributed_trace
     def replace_throughput(self, throughput, **kwargs):
         # type: (Optional[Union[int, ThroughputProperties]], Any) -> ThroughputProperties
         """Replace the database-level throughput.
 
         :param throughput: The throughput to be set (an integer).
         :keyword Callable response_hook: A callable invoked with the response metadata.
-        :returns: Offer for the database, updated with new throughput.
         :returns: ThroughputProperties for the database, updated with new throughput.
         :raises ~azure.cosmos.exceptions.CosmosHttpResponseError:
-            If no offer exists for the database or if the offer could not be updated.
-        :rtype: ~azure.cosmos.Offer
             If no throughput properties exists for the database or if the throughput properties could not be updated.
         :rtype: ~azure.cosmos.ThroughputProperties
         """
         response_hook = kwargs.pop('response_hook', None)
         properties = self._get_properties()
         link = properties["_self"]
         query_spec = {
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_version.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_version.py`

 * *Files 1% similar despite different names*

```diff
@@ -15,8 +15,8 @@
 # IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 # FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 # AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 # LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 # OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 # SOFTWARE.
 
-VERSION = "4.3.1b1"
+VERSION = "4.4.0b1"
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/auth.py` & `azure-cosmos-4.4.0b1/azure/cosmos/auth.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_constants.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_constants.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_utils.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_utils.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_auth_policy.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_auth_policy.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_retry_utility.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_retry_utility.py`

 * *Files 5% similar despite different names*

```diff
@@ -29,14 +29,15 @@
 
 from . import exceptions
 from . import _endpoint_discovery_retry_policy
 from . import _resource_throttle_retry_policy
 from . import _default_retry_policy
 from . import _session_retry_policy
 from . import _gone_retry_policy
+from . import _timeout_failover_retry_policy
 from .http_constants import HttpHeaders, StatusCodes, SubStatusCodes
 
 
 # pylint: disable=protected-access
 
 
 def Execute(client, global_endpoint_manager, function, *args, **kwargs):
@@ -63,16 +64,21 @@
         client.connection_policy.RetryOptions.MaxWaitTimeInSeconds,
     )
     defaultRetry_policy = _default_retry_policy.DefaultRetryPolicy(*args)
 
     sessionRetry_policy = _session_retry_policy._SessionRetryPolicy(
         client.connection_policy.EnableEndpointDiscovery, global_endpoint_manager, *args
     )
+
     partition_key_range_gone_retry_policy = _gone_retry_policy.PartitionKeyRangeGoneRetryPolicy(client, *args)
 
+    timeout_failover_retry_policy = _timeout_failover_retry_policy._TimeoutFailoverRetryPolicy(
+        client.connection_policy, global_endpoint_manager, *args
+    )
+
     while True:
         try:
             client_timeout = kwargs.get('timeout')
             start_time = time.time()
             if args:
                 result = ExecuteFunction(function, global_endpoint_manager, *args, **kwargs)
             else:
@@ -86,29 +92,30 @@
             ] = resourceThrottle_retry_policy.current_retry_attempt_count
             client.last_response_headers[
                 HttpHeaders.ThrottleRetryWaitTimeInMs
             ] = resourceThrottle_retry_policy.cumulative_wait_time_in_milliseconds
 
             return result
         except exceptions.CosmosHttpResponseError as e:
-            retry_policy = None
+            retry_policy = defaultRetry_policy
+            # Re-assign retry policy based on error code
             if e.status_code == StatusCodes.FORBIDDEN and e.sub_status == SubStatusCodes.WRITE_FORBIDDEN:
                 retry_policy = endpointDiscovery_retry_policy
             elif e.status_code == StatusCodes.TOO_MANY_REQUESTS:
                 retry_policy = resourceThrottle_retry_policy
             elif (
                 e.status_code == StatusCodes.NOT_FOUND
                 and e.sub_status
                 and e.sub_status == SubStatusCodes.READ_SESSION_NOTAVAILABLE
             ):
                 retry_policy = sessionRetry_policy
             elif exceptions._partition_range_is_gone(e):
                 retry_policy = partition_key_range_gone_retry_policy
-            else:
-                retry_policy = defaultRetry_policy
+            elif e.status_code == StatusCodes.REQUEST_TIMEOUT or e.status_code == StatusCodes.SERVICE_UNAVAILABLE:
+                retry_policy = timeout_failover_retry_policy
 
             # If none of the retry policies applies or there is no retry needed, set the
             # throttle related response headers and re-throw the exception back arg[0]
             # is the request. It needs to be modified for write forbidden exception
             if not retry_policy.ShouldRetry(e):
                 if not client.last_response_headers:
                     client.last_response_headers = {}
@@ -131,15 +138,14 @@
 
 
 def ExecuteFunction(function, *args, **kwargs):
     """Stub method so that it can be used for mocking purposes as well.
     """
     return function(*args, **kwargs)
 
-
 def _configure_timeout(request, absolute, per_request):
     # type: (azure.core.pipeline.PipelineRequest, Optional[int], int) -> Optional[AzureError]
     if absolute is not None:
         if absolute <= 0:
             raise exceptions.CosmosClientTimeoutError()
         if per_request:
             # Both socket timeout and client timeout have been provided - use the shortest value.
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_location_cache.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_location_cache.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_range_partition_resolver.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_range_partition_resolver.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/exceptions.py` & `azure-cosmos-4.4.0b1/azure/cosmos/exceptions.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_gone_retry_policy.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_gone_retry_policy.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_endpoint_discovery_retry_policy.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_endpoint_discovery_retry_policy.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/container.py` & `azure-cosmos-4.4.0b1/azure/cosmos/container.py`

 * *Files 3% similar despite different names*

```diff
@@ -25,15 +25,16 @@
 
 from typing import Any, Dict, List, Optional, Union, Iterable, cast, overload  # pylint: disable=unused-import
 
 import warnings
 from azure.core.tracing.decorator import distributed_trace  # type: ignore
 
 from ._cosmos_client_connection import CosmosClientConnection
-from ._base import build_options, validate_cache_staleness_value, _deserialize_throughput, _replace_throughput
+from ._base import build_options, validate_cache_staleness_value, _deserialize_throughput, _replace_throughput, \
+    GenerateGuidId
 from .exceptions import CosmosResourceNotFoundError
 from .http_constants import StatusCodes
 from .offer import ThroughputProperties
 from .scripts import ScriptsProxy
 from .partition_key import NonePartitionKeyValue
 
 __all__ = ("ContainerProxy",)
@@ -181,17 +182,16 @@
 
         :param item: The ID (name) or dict representing item to retrieve.
         :param partition_key: Partition key for the item to retrieve.
         :param post_trigger_include: trigger id to be used as post operation trigger.
         :keyword str session_token: Token for use with Session consistency.
         :keyword dict[str,str] initial_headers: Initial headers to be sent as part of the request.
         :keyword Callable response_hook: A callable invoked with the response metadata.
-        :keyword int max_integrated_cache_staleness_in_ms:
-        The max cache staleness for the integrated cache in milliseconds.
-            For accounts configured to use the integrated cache, using Session or Eventual consistency,
+        :keyword int max_integrated_cache_staleness_in_ms: The max cache staleness for the integrated cache in
+            milliseconds. For accounts configured to use the integrated cache, using Session or Eventual consistency,
             responses are guaranteed to be no staler than this value.
         :returns: Dict representing the item to be retrieved.
         :raises ~azure.cosmos.exceptions.CosmosHttpResponseError: The given item couldn't be retrieved.
         :rtype: dict[str, Any]
 
         .. admonition:: Example:
 
@@ -237,17 +237,16 @@
         # type: (...) -> Iterable[Dict[str, Any]]
         """List all the items in the container.
 
         :param max_item_count: Max number of items to be returned in the enumeration operation.
         :keyword str session_token: Token for use with Session consistency.
         :keyword dict[str,str] initial_headers: Initial headers to be sent as part of the request.
         :keyword Callable response_hook: A callable invoked with the response metadata.
-        :keyword int max_integrated_cache_staleness_in_ms:
-        The max cache staleness for the integrated cache in milliseconds.
-            For accounts configured to use the integrated cache, using Session or Eventual consistency,
+        :keyword int max_integrated_cache_staleness_in_ms: The max cache staleness for the integrated cache in
+            milliseconds. For accounts configured to use the integrated cache, using Session or Eventual consistency,
             responses are guaranteed to be no staler than this value.
         :returns: An Iterable of items (dicts).
         :rtype: Iterable[dict[str, Any]]
         """
         feed_options = build_options(kwargs)
         response_hook = kwargs.pop('response_hook', None)
         if max_item_count is not None:
@@ -285,26 +284,26 @@
         # type: (...) -> Iterable[Dict[str, Any]]
         """Get a sorted list of items that were changed, in the order in which they were modified.
 
         :param partition_key_range_id: ChangeFeed requests can be executed against specific partition key ranges.
             This is used to process the change feed in parallel across multiple consumers.
         :param partition_key: partition key at which ChangeFeed requests are targetted.
         :param is_start_from_beginning: Get whether change feed should start from
-            beginning (true) or from current (false). By default it's start from current (false).
+            beginning (true) or from current (false). By default, it's start from current (false).
         :param continuation: e_tag value to be used as continuation for reading change feed.
         :param max_item_count: Max number of items to be returned in the enumeration operation.
         :keyword Callable response_hook: A callable invoked with the response metadata.
         :returns: An Iterable of items (dicts).
         :rtype: Iterable[dict[str, Any]]
         """
         feed_options = build_options(kwargs)
         response_hook = kwargs.pop('response_hook', None)
         if partition_key_range_id is not None:
             feed_options["partitionKeyRangeId"] = partition_key_range_id
-        partition_key = kwargs.pop("partitionKey", None)
+        partition_key = kwargs.pop("partitionKey", kwargs.pop("partition_key", None))
         if partition_key is not None:
             feed_options["partitionKey"] = partition_key
         if is_start_from_beginning is not None:
             feed_options["isStartFromBeginning"] = is_start_from_beginning
         if max_item_count is not None:
             feed_options["maxItemCount"] = max_item_count
         if continuation is not None:
@@ -351,17 +350,16 @@
         :param max_item_count: Max number of items to be returned in the enumeration operation.
         :param enable_scan_in_query: Allow scan on the queries which couldn't be served as
             indexing was opted out on the requested paths.
         :param populate_query_metrics: Enable returning query metrics in response headers.
         :keyword str session_token: Token for use with Session consistency.
         :keyword dict[str,str] initial_headers: Initial headers to be sent as part of the request.
         :keyword Callable response_hook: A callable invoked with the response metadata.
-        :keyword int max_integrated_cache_staleness_in_ms:
-        The max cache staleness for the integrated cache in milliseconds.
-            For accounts configured to use the integrated cache, using Session or Eventual consistency,
+        :keyword int max_integrated_cache_staleness_in_ms: The max cache staleness for the integrated cache in
+            milliseconds. For accounts configured to use the integrated cache, using Session or Eventual consistency,
             responses are guaranteed to be no staler than this value.
         :returns: An Iterable of items (dicts).
         :rtype: ItemPaged[Dict[str, Any]]
 
         .. admonition:: Example:
 
             .. literalinclude:: ../samples/examples.py
@@ -392,15 +390,16 @@
             feed_options["partitionKey"] = self._set_partition_key(partition_key)
         if enable_scan_in_query is not None:
             feed_options["enableScanInQuery"] = enable_scan_in_query
         max_integrated_cache_staleness_in_ms = kwargs.pop('max_integrated_cache_staleness_in_ms', None)
         if max_integrated_cache_staleness_in_ms:
             validate_cache_staleness_value(max_integrated_cache_staleness_in_ms)
             feed_options["maxIntegratedCacheStaleness"] = max_integrated_cache_staleness_in_ms
-
+        correlated_activity_id = GenerateGuidId()
+        feed_options["correlatedActivityId"] = correlated_activity_id
         if hasattr(response_hook, "clear"):
             response_hook.clear()
 
         items = self.client_connection.QueryItems(
             database_or_container_link=self.container_link,
             query=query if parameters is None else dict(query=query, parameters=parameters),
             options=feed_options,
@@ -568,14 +567,58 @@
             database_or_container_link=self.container_link, document=body, options=request_options, **kwargs
         )
         if response_hook:
             response_hook(self.client_connection.last_response_headers, result)
         return result
 
     @distributed_trace
+    def patch_item(
+        self,
+        item: Union[str, Dict[str, Any]],
+        partition_key: Union[str, int, float, bool],
+        patch_operations: List[Dict[str, Any]],
+        **kwargs:Any
+    ) -> Dict[str, Any]:
+        """ **Provisional method** Patches the specified item with the provided operations if it
+         exists in the container.
+
+        If the item does not already exist in the container, an exception is raised.
+
+        :param item: The ID (name) or dict representing item to be patched.
+        :type item: Union[str, Dict[str, Any]]
+        :param partition_key: The partition key of the object to patch.
+        :type partition_key: Union[str, int, float, bool]
+        :param patch_operations: The list of patch operations to apply to the item.
+        :type patch_operations: List[Dict[str, Any]]
+        :keyword str pre_trigger_include: trigger id to be used as pre operation trigger.
+        :keyword str post_trigger_include: trigger id to be used as post operation trigger.
+        :keyword str session_token: Token for use with Session consistency.
+        :keyword dict[str,str] initial_headers: Initial headers to be sent as part of the request.
+        :keyword str etag: An ETag value, or the wildcard character (*). Used to check if the resource
+            has changed, and act according to the condition specified by the `match_condition` parameter.
+        :keyword ~azure.core.MatchConditions match_condition: The match condition to use upon the etag.
+        :keyword Callable response_hook: A callable invoked with the response metadata.
+        :returns: A dict representing the item after the patch operations went through.
+        :raises ~azure.cosmos.exceptions.CosmosHttpResponseError: The patch operations failed or the item with
+            given id does not exist.
+        :rtype: dict[str, Any]
+        """
+        request_options = build_options(kwargs)
+        response_hook = kwargs.pop('response_hook', None)
+        request_options["disableAutomaticIdGeneration"] = True
+        request_options["partitionKey"] = partition_key
+
+        item_link = self._get_document_link(item)
+        result = self.client_connection.PatchItem(
+            document_link=item_link, operations=patch_operations, options=request_options, **kwargs)
+        if response_hook:
+            response_hook(self.client_connection.last_response_headers, result)
+        return result
+
+    @distributed_trace
     def delete_item(
         self,
         item,  # type: Union[Dict[str, Any], str]
         partition_key,  # type: Any
         populate_query_metrics=None,  # type: Optional[bool]
         pre_trigger_include=None,  # type: Optional[str]
         post_trigger_include=None,  # type: Optional[str]
@@ -812,7 +855,30 @@
             request_options["partitionKey"] = self._set_partition_key(partition_key)
 
         result = self.client_connection.DeleteConflict(
             conflict_link=self._get_conflict_link(conflict), options=request_options, **kwargs
         )
         if response_hook:
             response_hook(self.client_connection.last_response_headers, result)
+
+    @distributed_trace
+    def delete_all_items_by_partition_key(
+        self,
+        partition_key: Union[str, int, float, bool],
+        **kwargs: Any
+    ) -> None:
+        """Exposes an API to delete all items with a single partition key without the user having
+         to explicitly call delete on each record in the partition key.
+
+        :param partition_key: Partition key for the items to be deleted.
+        :type partition_key: Any
+        :rtype: None
+        """
+        request_options = build_options(kwargs)
+        response_hook = kwargs.pop('response_hook', None)
+        # regardless if partition key is valid we set it as invalid partition keys are set to a default empty value
+        request_options["partitionKey"] = self._set_partition_key(partition_key)
+
+        result = self.client_connection.DeleteAllItemsByPartitionKey(collection_link=self.container_link,
+                                                            options=request_options, **kwargs)
+        if response_hook:
+            response_hook(self.client_connection.last_response_headers, result)
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/scripts.py` & `azure-cosmos-4.4.0b1/azure/cosmos/scripts.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/http_constants.py` & `azure-cosmos-4.4.0b1/azure/cosmos/http_constants.py`

 * *Files 8% similar despite different names*

```diff
@@ -81,28 +81,32 @@
     WrapAssertion = "wrap_assertion"
     WrapScope = "wrap_scope"
     SimpleToken = "SWT"
     HttpDate = "date"
     Prefer = "Prefer"
     Location = "Location"
     Referer = "referer"
+    Pragma = "Pragma"
 
     # Query
     Query = "x-ms-documentdb-query"
     IsQuery = "x-ms-documentdb-isquery"
     IsQueryPlanRequest = "x-ms-cosmos-is-query-plan-request"
     SupportedQueryFeatures = "x-ms-cosmos-supported-query-features"
     QueryVersion = "x-ms-cosmos-query-version"
+    QueryMetrics = "x-ms-documentdb-query-metrics"
+    QueryExecutionInfo = "x-ms-cosmos-query-execution-info"
 
     # Our custom DocDB headers
     Continuation = "x-ms-continuation"
     PageSize = "x-ms-max-item-count"
 
     # Request sender generated. Simply echoed by backend.
     ActivityId = "x-ms-activity-id"
+    CorrelatedActivityId = "x-ms-cosmos-correlated-activityid"  # cspell:disable-line
     PreTriggerInclude = "x-ms-documentdb-pre-trigger-include"
     PreTriggerExclude = "x-ms-documentdb-pre-trigger-exclude"
     PostTriggerInclude = "x-ms-documentdb-post-trigger-include"
     PostTriggerExclude = "x-ms-documentdb-post-trigger-exclude"
     IndexingDirective = "x-ms-indexing-directive"
     SessionToken = "x-ms-session-token"
     ConsistencyLevel = "x-ms-consistency-level"
@@ -112,16 +116,19 @@
     RetryAfterInMilliseconds = "x-ms-retry-after-ms"
     IsFeedUnfiltered = "x-ms-is-feed-unfiltered"
     ResourceTokenExpiry = "x-ms-documentdb-expiry-seconds"
     EnableScanInQuery = "x-ms-documentdb-query-enable-scan"
     EmitVerboseTracesInQuery = "x-ms-documentdb-query-emit-traces"
     SubStatus = "x-ms-substatus"
     AlternateContentPath = "x-ms-alt-content-path"
+    ContentPath = "x-ms-content-path"
     IsContinuationExpected = "x-ms-documentdb-query-iscontinuationexpected"
     PopulateQueryMetrics = "x-ms-documentdb-populatequerymetrics"
+    ResourceQuota = "x-ms-resource-quota"
+    ResourceUsage = "x-ms-resource-usage"
 
     # Quota Info
     MaxEntityCount = "x-ms-root-entity-max-count"
     CurrentEntityCount = "x-ms-root-entity-current-count"
     CollectionQuotaInMb = "x-ms-collection-quota-mb"
     CollectionCurrentUsageInMb = "x-ms-collection-usage-mb"
     MaxMediaStorageUsageInMB = "x-ms-max-media-storage-usage-mb"
@@ -152,15 +159,15 @@
     # Version headers and values
     Version = "x-ms-version"
 
     # RDFE Resource Provider headers
     OcpResourceProviderRegisteredUri = "ocp-resourceprovider-registered-uri"
 
     # For Document service management operations only. This is in
-    # essence a 'handle' to (long running) operations.
+    # essence a 'handle' to (long-running) operations.
     RequestId = "x-ms-request-id"
 
     # Object returning this determines what constitutes state and what
     # last state change means. For replica, it is the last role change.
     LastStateChangeUtc = "x-ms-last-state-change-utc"
 
     # Offer type.
@@ -173,14 +180,15 @@
     IsRUPerMinuteUsed = "x-ms-documentdb-is-ru-per-minute-used"
     OfferIsRUPerMinuteThroughputEnabled = "x-ms-offer-is-ru-per-minute-throughput-enabled"
 
     # Partitioned collection headers
     PartitionKey = "x-ms-documentdb-partitionkey"
     EnableCrossPartitionQuery = "x-ms-documentdb-query-enablecrosspartition"
     PartitionKeyRangeID = "x-ms-documentdb-partitionkeyrangeid"
+    PartitionKeyDeletePending = "x-ms-cosmos-is-partition-key-delete-pending"
 
     # Upsert header
     IsUpsert = "x-ms-documentdb-is-upsert"
 
     # Index progress headers.
     IndexTransformationProgress = "x-ms-documentdb-collection-index-transformation-progress"
     LazyIndexingProgress = "x-ms-documentdb-collection-lazy-indexing-progress"
@@ -200,14 +208,31 @@
     # For Using Multiple Write Locations
     AllowTentativeWrites = "x-ms-cosmos-allow-tentative-writes"
 
     # Dedicated Gateway headers
     DedicatedGatewayCacheStaleness = "x-ms-dedicatedgateway-max-age"
     IntegratedCacheHit = "x-ms-cosmos-cachehit"
 
+    # Backend headers
+    Server = "Server"
+    StrictTransportSecurity = "Strict-Transport-Security"
+    LSN = "lsn"
+    GatewayVersion = "x-ms-gatewayversion"
+    ServiceVersion = "x-ms-serviceversion"
+    SchemaVersion = "x-ms-schemaversion"
+    QuorumAckedLsn = "x-ms-quorum-acked-lsn" # cspell:disable-line
+    CurrentWriteQuorum = "x-ms-current-write-quorum"
+    CurrentReplicaSetSize = "x-ms-current-replica-set-size"
+    XpRole = "x-ms-xp-role"
+    GlobalCommittedLsn = "x-ms-global-committed-lsn"
+    NumberOfReadRegions = "x-ms-number-of-read-regions"
+    TransportRequestId = "x-ms-transport-request-id"
+    CosmosLsn = "x-ms-cosmos-llsn" # cspell:disable-line
+    CosmosQuorumAckedLsn = "x-ms-cosmos-quorum-acked-llsn" # cspell:disable-line
+    RequestDurationMs = "x-ms-request-duration-ms"
 
 class HttpHeaderPreferenceTokens(object):
     """Constants of http header preference tokens.
     """
 
     PreferUnfilteredQueryResponse = "PreferUnfilteredQueryResponse"
 
@@ -408,19 +433,21 @@
     Conflict = "conflicts"
     Attachment = "attachments"
     PartitionKeyRange = "pkranges"
     Schema = "schemas"
     Offer = "offers"
     Topology = "topology"
     DatabaseAccount = "databaseaccount"
+    PartitionKey = "partitionkey"
 
     @staticmethod
     def IsCollectionChild(resourceType):
         return resourceType in (
             ResourceType.Document,
             ResourceType.Attachment,
             ResourceType.Conflict,
             ResourceType.Schema,
             ResourceType.UserDefinedFunction,
             ResourceType.Trigger,
             ResourceType.StoredProcedure,
+            ResourceType.PartitionKey,
         )
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_query_iterable.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_query_iterable.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_cosmos_client_connection.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_cosmos_client_connection.py`

 * *Files 1% similar despite different names*

```diff
@@ -188,15 +188,16 @@
             UserAgentPolicy(base_user_agent=self._user_agent, **kwargs),
             ContentDecodePolicy(),
             retry_policy,
             credentials_policy,
             CustomHookPolicy(**kwargs),
             NetworkTraceLoggingPolicy(**kwargs),
             DistributedTracingPolicy(**kwargs),
-            CosmosHttpLoggingPolicy(**kwargs),
+            CosmosHttpLoggingPolicy(enable_diagnostics_logging=kwargs.pop("enable_diagnostics_logging", False),
+                                    **kwargs),
         ]
 
         transport = kwargs.pop("transport", None)
         self.pipeline_client = PipelineClient(base_url=url_connection, transport=transport, policies=policies)
 
         # Query compatibility mode.
         # Allows to specify compatibility mode used by client when making query requests. Should be removed when
@@ -1726,14 +1727,44 @@
 
         # Extract the document collection link and add the partition key to options
         collection_link = base.GetItemContainerLink(document_link)
         options = self._AddPartitionKey(collection_link, new_document, options)
 
         return self.Replace(new_document, path, "docs", document_id, None, options, **kwargs)
 
+    def PatchItem(self, document_link, operations, options=None, **kwargs):
+        """Patches a document and returns it.
+
+        :param str document_link: The link to the document.
+        :param list operations: The operations for the patch request.
+        :param dict options: The request options for the request.
+
+        :return:
+            The new Document.
+        :rtype:
+            dict
+
+        """
+        path = base.GetPathFromLink(document_link)
+        document_id = base.GetResourceIdOrFullNameFromLink(document_link)
+        typ = "docs"
+
+        if options is None:
+            options = {}
+
+        initial_headers = self.default_headers
+        headers = base.GetHeaders(self, initial_headers, "patch", path, document_id, typ, options)
+        # Patch will use WriteEndpoint since it uses PUT operation
+        request_params = _request_object.RequestObject(typ, documents._OperationType.Patch)
+        result, self.last_response_headers = self.__Patch(path, request_params, operations, headers, **kwargs)
+
+        # update session for request mutates data on server side
+        self._UpdateSessionIfRequired(headers, result, self.last_response_headers)
+        return result
+
     def DeleteItem(self, document_link, options=None, **kwargs):
         """Deletes a document.
 
         :param str document_link:
             The link to the document.
         :param dict options:
             The request options for the request.
@@ -1747,14 +1778,47 @@
         if options is None:
             options = {}
 
         path = base.GetPathFromLink(document_link)
         document_id = base.GetResourceIdOrFullNameFromLink(document_link)
         return self.DeleteResource(path, "docs", document_id, None, options, **kwargs)
 
+    def DeleteAllItemsByPartitionKey(
+        self,
+        collection_link,
+        options=None,
+        **kwargs
+    ) -> None:
+        """Exposes an API to delete all items with a single partition key without the user having
+         to explicitly call delete on each record in the partition key.
+
+        :param str collection_link:
+            The link to the document collection.
+        :param dict options:
+            The request options for the request.
+
+        :return:
+            None
+        :rtype:
+            None
+        """
+        if options is None:
+            options = {}
+
+        path = base.GetPathFromLink(collection_link)
+        #Specified url to perform background operation to delete all items by partition key
+        path = '{}{}/{}'.format(path, "operations", "partitionkeydelete")
+        collection_id = base.GetResourceIdOrFullNameFromLink(collection_link)
+        initial_headers = dict(self.default_headers)
+        headers = base.GetHeaders(self, initial_headers, "post", path, collection_id, "partitionkey", options)
+        request_params = _request_object.RequestObject("partitionkey", documents._OperationType.Delete)
+        result, self.last_response_headers = self.__Post(path=path, request_params=request_params,
+                                                         req_headers=headers, body=None, **kwargs)
+        return result
+
     def ReplaceTrigger(self, trigger_link, trigger, options=None, **kwargs):
         """Replaces a trigger and returns it.
 
         :param str trigger_link:
             The link to the trigger.
         :param dict trigger:
         :param dict options:
@@ -2304,14 +2368,40 @@
             connection_policy=self.connection_policy,
             pipeline_client=self.pipeline_client,
             request=request,
             request_data=body,
             **kwargs
         )
 
+    def __Patch(self, path, request_params, operations, req_headers, **kwargs):
+        """Azure Cosmos 'PATCH' http request.
+
+        :params str path:
+        :params ~azure.cosmos.RequestObject request_params:
+        :params list operations:
+        :params dict req_headers:
+
+        :return:
+            Tuple of (result, headers).
+        :rtype:
+            tuple of (dict, dict)
+
+        """
+        request = self.pipeline_client.patch(url=path, headers=req_headers)
+        return synchronized_request.SynchronizedRequest(
+            client=self,
+            request_params=request_params,
+            global_endpoint_manager=self._global_endpoint_manager,
+            connection_policy=self.connection_policy,
+            pipeline_client=self.pipeline_client,
+            request=request,
+            request_data=operations,
+            **kwargs
+        )
+
     def __Delete(self, path, request_params, req_headers, **kwargs):
         """Azure Cosmos 'DELETE' http request.
 
         :params str url:
         :params str path:
         :params dict req_headers:
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/documents.py` & `azure-cosmos-4.4.0b1/azure/cosmos/documents.py`

 * *Files 1% similar despite different names*

```diff
@@ -377,21 +377,22 @@
     """Represents the type of the operation
     """
     Create = "Create"
     Delete = "Delete"
     ExecuteJavaScript = "ExecuteJavaScript"
     Head = "Head"
     HeadFeed = "HeadFeed"
+    Patch = "Patch"
     Query = "Query"
+    QueryPlan = "QueryPlan"
     Read = "Read"
     ReadFeed = "ReadFeed"
     Recreate = "Recreate"
     Replace = "Replace"
     SqlQuery = "SqlQuery"
-    QueryPlan = "QueryPlan"
     Update = "Update"
     Upsert = "Upsert"
 
     @staticmethod
     def IsWriteOperation(operationType):
         return operationType in (
             _OperationType.Create,
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/errors.py` & `azure-cosmos-4.4.0b1/azure/cosmos/errors.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/diagnostics.py` & `azure-cosmos-4.4.0b1/azure/cosmos/diagnostics.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/partition_key.py` & `azure-cosmos-4.4.0b1/azure/cosmos/partition_key.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/offer.py` & `azure-cosmos-4.4.0b1/azure/cosmos/offer.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_range.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_range.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_synchronized_request.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_synchronized_request.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/permission.py` & `azure-cosmos-4.4.0b1/azure/cosmos/permission.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_default_retry_policy.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_default_retry_policy.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/_container.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/_container.py`

 * *Files 3% similar despite different names*

```diff
@@ -18,23 +18,23 @@
 # LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 # OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 # SOFTWARE.
 
 """Create, read, update and delete items in the Azure Cosmos DB SQL API service.
 """
 
-from typing import Any, Dict, Optional, Union, cast, Awaitable
+from typing import Any, Dict, Optional, Union, cast, Awaitable, List
 from azure.core.async_paging import AsyncItemPaged
 
 from azure.core.tracing.decorator import distributed_trace
 from azure.core.tracing.decorator_async import distributed_trace_async  # type: ignore
 
 from ._cosmos_client_connection_async import CosmosClientConnection
 from .._base import build_options as _build_options, validate_cache_staleness_value, _deserialize_throughput, \
-    _replace_throughput
+    _replace_throughput, GenerateGuidId
 from ..exceptions import CosmosResourceNotFoundError
 from ..http_constants import StatusCodes
 from ..offer import ThroughputProperties
 from ._scripts import ScriptsProxy
 from ..partition_key import NonePartitionKeyValue
 
 __all__ = ("ContainerProxy",)
@@ -360,15 +360,16 @@
             feed_options["partitionKey"] = self._set_partition_key(partition_key)
         else:
             feed_options["enableCrossPartitionQuery"] = True
         max_integrated_cache_staleness_in_ms = kwargs.pop('max_integrated_cache_staleness_in_ms', None)
         if max_integrated_cache_staleness_in_ms:
             validate_cache_staleness_value(max_integrated_cache_staleness_in_ms)
             feed_options["maxIntegratedCacheStaleness"] = max_integrated_cache_staleness_in_ms
-
+        correlated_activity_id = GenerateGuidId()
+        feed_options["correlatedActivityId"] = correlated_activity_id
         if hasattr(response_hook, "clear"):
             response_hook.clear()
 
         parameters = kwargs.pop('parameters', None)
         items = self.client_connection.QueryItems(
             database_or_container_link=self.container_link,
             query=query if parameters is None else dict(query=query, parameters=parameters),
@@ -385,15 +386,15 @@
     def query_items_change_feed(
         self,
         **kwargs: Any
     ) -> AsyncItemPaged[Dict[str, Any]]:
         """Get a sorted list of items that were changed, in the order in which they were modified.
 
         :keyword bool is_start_from_beginning: Get whether change feed should start from
-            beginning (true) or from current (false). By default it's start from current (false).
+            beginning (true) or from current (false). By default, it's start from current (false).
         :keyword str partition_key_range_id: ChangeFeed requests can be executed against specific partition key
             ranges. This is used to process the change feed in parallel across multiple consumers.
         :keyword str continuation: e_tag value to be used as continuation for reading change feed.
         :keyword int max_item_count: Max number of items to be returned in the enumeration operation.
         :keyword partition_key: partition key at which ChangeFeed requests are targeted.
         :paramtype partition_key: Union[str, int, float, bool]
         :keyword response_hook: A callable invoked with the response metadata.
@@ -518,14 +519,58 @@
             document_link=item_link, new_document=body, options=request_options, **kwargs
         )
         if response_hook:
             response_hook(self.client_connection.last_response_headers, result)
         return result
 
     @distributed_trace_async
+    async def patch_item(
+        self,
+        item: Union[str, Dict[str, Any]],
+        partition_key: Union[str, int, float, bool],
+        patch_operations: List[Dict[str, Any]],
+        **kwargs: Any
+    ) -> Dict[str, Any]:
+        """ **Provisional method** Patches the specified item with the provided operations if it
+         exists in the container.
+
+        If the item does not already exist in the container, an exception is raised.
+
+        :param item: The ID (name) or dict representing item to be patched.
+        :type item: Union[str, Dict[str, Any]]
+        :param partition_key: The partition key of the object to patch.
+        :type partition_key: Union[str, int, float, bool]
+        :param patch_operations: The list of patch operations to apply to the item.
+        :type patch_operations: List[Dict[str, Any]]
+        :keyword str pre_trigger_include: trigger id to be used as pre operation trigger.
+        :keyword str post_trigger_include: trigger id to be used as post operation trigger.
+        :keyword str session_token: Token for use with Session consistency.
+        :keyword dict[str,str] initial_headers: Initial headers to be sent as part of the request.
+        :keyword str etag: An ETag value, or the wildcard character (*). Used to check if the resource
+            has changed, and act according to the condition specified by the `match_condition` parameter.
+        :keyword ~azure.core.MatchConditions match_condition: The match condition to use upon the etag.
+        :keyword Callable response_hook: A callable invoked with the response metadata.
+        :returns: A dict representing the item after the patch operations went through.
+        :raises ~azure.cosmos.exceptions.CosmosHttpResponseError: The patch operations failed or the item with
+            given id does not exist.
+        :rtype: dict[str, Any]
+        """
+        request_options = _build_options(kwargs)
+        response_hook = kwargs.pop('response_hook', None)
+        request_options["disableAutomaticIdGeneration"] = True
+        request_options["partitionKey"] = partition_key
+
+        item_link = self._get_document_link(item)
+        result = await self.client_connection.PatchItem(
+            document_link=item_link, operations=patch_operations, options=request_options, **kwargs)
+        if response_hook:
+            response_hook(self.client_connection.last_response_headers, result)
+        return result
+
+    @distributed_trace_async
     async def delete_item(
         self,
         item: Union[str, Dict[str, Any]],
         partition_key: Union[str, int, float, bool],
         **kwargs: Any
     ) -> None:
         """Delete the specified item from the container.
@@ -600,15 +645,16 @@
     @distributed_trace_async
     async def replace_throughput(self, throughput: Union[int, ThroughputProperties], **kwargs: Any) -> \
             ThroughputProperties:
         """Replace the container's throughput.
 
         If no ThroughputProperties already exist for the container, an exception is raised.
 
-        :param int throughput: The throughput to be set (an integer).
+        :param throughput: The throughput to be set.
+        :type throughput: Union[int, ~azure.cosmos.ThroughputProperties]
         :keyword response_hook: A callable invoked with the response metadata.
         :paramtype response_hook: Callable[[Dict[str, str], Dict[str, Any]], None]
         :raises ~azure.cosmos.exceptions.CosmosHttpResponseError: No throughput properties exist for the container
             or the throughput properties could not be updated.
         :returns: ThroughputProperties for the container, updated with new throughput.
         :rtype: ~azure.cosmos.offer.ThroughputProperties
         """
@@ -754,7 +800,30 @@
         response_hook = kwargs.pop('response_hook', None)
         request_options["partitionKey"] = self._set_partition_key(partition_key)
         result = await self.client_connection.DeleteConflict(
             conflict_link=self._get_conflict_link(conflict), options=request_options, **kwargs
         )
         if response_hook:
             response_hook(self.client_connection.last_response_headers, result)
+
+    @distributed_trace
+    async def delete_all_items_by_partition_key(
+        self,
+        partition_key: Union[str, int, float, bool],
+        **kwargs: Any
+    ) -> None:
+        """Exposes an API to delete all items with a single partition key without the user having
+                 to explicitly call delete on each record in the partition key.
+
+        :param partition_key: Partition key for the items to be deleted.
+        :type partition_key: Any
+        :rtype: None
+        """
+        request_options = _build_options(kwargs)
+        response_hook = kwargs.pop('response_hook', None)
+        # regardless if partition key is valid we set it as invalid partition keys are set to a default empty value
+        request_options["partitionKey"] = self._set_partition_key(partition_key)
+
+        await self.client_connection.DeleteAllItemsByPartitionKey(collection_link=self.container_link,
+                                                                  options=request_options, **kwargs)
+        if response_hook:
+            response_hook(self.client_connection.last_response_headers, None)
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/_scripts.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/_scripts.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/_cosmos_client.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/_cosmos_client.py`

 * *Files 4% similar despite different names*

```diff
@@ -28,15 +28,14 @@
 
 from azure.core.tracing.decorator_async import distributed_trace_async
 from azure.core.tracing.decorator import distributed_trace
 
 from ..cosmos_client import _parse_connection_str, _build_auth
 from ._cosmos_client_connection_async import CosmosClientConnection
 from .._base import build_options as _build_options, _set_throughput_options
-from ..offer import ThroughputProperties
 from ._retry_utility_async import _ConnectionRetryPolicy
 from ._database import DatabaseProxy
 from ..documents import ConnectionPolicy, DatabaseAccount
 from ..exceptions import CosmosResourceNotFoundError
 
 __all__ = ("CosmosClient",)
 
@@ -96,14 +95,38 @@
     Use this client to configure and execute requests to the Azure Cosmos DB service.
 
     :param str url: The URL of the Cosmos DB account.
     :param credential: Can be the account key, or a dictionary of resource tokens.
     :type credential: Union[str, Dict[str, str], ~azure.core.credentials_async.AsyncTokenCredential]
     :keyword str consistency_level: Consistency level to use for the session. Default value is None (account-level).
         More on consistency levels and possible values: https://aka.ms/cosmos-consistency-levels
+    :keyword int timeout: An absolute timeout in seconds, for the combined HTTP request and response processing.
+    :keyword int request_timeout: The HTTP request timeout in milliseconds.
+    :keyword str connection_mode: The connection mode for the client - currently only supports 'Gateway'.
+    :keyword proxy_config: Connection proxy configuration.
+    :paramtype proxy_config: ~azure.cosmos.ProxyConfiguration
+    :keyword ssl_config: Connection SSL configuration.
+    :paramtype ssl_config: ~azure.cosmos.SSLConfiguration
+    :keyword bool connection_verify: Whether to verify the connection, default value is True.
+    :keyword str connection_cert: An alternative certificate to verify the connection.
+    :keyword int retry_total: Maximum retry attempts.
+    :keyword int retry_backoff_max: Maximum retry wait time in seconds.
+    :keyword int retry_fixed_interval: Fixed retry interval in milliseconds.
+    :keyword int retry_read: Maximum number of socket read retry attempts.
+    :keyword int retry_connect: Maximum number of connection error retry attempts.
+    :keyword int retry_status: Maximum number of retry attempts on error status codes.
+    :keyword list[int] retry_on_status_codes: A list of specific status codes to retry on.
+    :keyword float retry_backoff_factor: Factor to calculate wait time between retry attempts.
+    :keyword bool enable_endpoint_discovery: Enable endpoint discovery for
+        geo-replicated database accounts. (Default: True)
+    :keyword list[str] preferred_locations: The preferred locations for geo-replicated database accounts.
+    :keyword bool enable_diagnostics_logging: Enable the CosmosHttpLogging policy.
+        Must be used along with a logger to work.
+    :keyword ~logging.Logger logger: Logger to be used for collecting request diagnostics. Can be passed in at client
+        level (to log all requests) or at a single request level. Requests will be logged at INFO level.
 
     .. admonition:: Example:
 
         .. literalinclude:: ../samples/examples_async.py
             :start-after: [START create_client]
             :end-before: [END create_client]
             :language: python
@@ -194,15 +217,15 @@
             **kwargs: Any
     ) -> DatabaseProxy:
         """
         Create a new database with the given ID (name).
 
         :param str id: ID (name) of the database to create.
         :keyword offer_throughput: The provisioned throughput for this offer.
-        :paramtype offer_throughput: int or ~azure.cosmos.ThroughputProperties.
+        :paramtype offer_throughput: Union[int, ~azure.cosmos.ThroughputProperties]
         :keyword str session_token: Token for use with Session consistency.
         :keyword dict[str, str] initial_headers: Initial headers to be sent as part of the request.
         :keyword str etag: An ETag value, or the wildcard character (*). Used to check if the resource
             has changed, and act according to the condition specified by the `match_condition` parameter.
         :keyword match_condition: The match condition to use upon the etag.
         :paramtype match_condition: ~azure.core.MatchConditions
         :keyword response_hook: A callable invoked with the response metadata.
@@ -244,15 +267,16 @@
         If the database already exists, the existing settings are returned.
 
         ..note::
             This function does not check or update existing database settings or
             offer throughput if they differ from what is passed in.
 
         :param str id: ID (name) of the database to read or create.
-        :keyword int offer_throughput: The provisioned throughput for this offer.
+        :keyword offer_throughput: The provisioned throughput for this offer.
+        :paramtype offer_throughput: Union[int, ~azure.cosmos.ThroughputProperties]
         :keyword str session_token: Token for use with Session consistency.
         :keyword dict[str, str] initial_headers: Initial headers to be sent as part of the request.
         :keyword str etag: An ETag value, or the wildcard character (*). Used to check if the resource
             has changed, and act according to the condition specified by the `match_condition` parameter.
         :keyword match_condition: The match condition to use upon the etag.
         :paramtype match_condition: ~azure.core.MatchConditions
         :keyword response_hook: A callable invoked with the response metadata.
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/__init__.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/_query_iterable_async.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/_query_iterable_async.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/_user.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/_user.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/_retry_utility_async.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/_retry_utility_async.py`

 * *Files 3% similar despite different names*

```diff
@@ -32,14 +32,15 @@
 from ..http_constants import HttpHeaders, StatusCodes, SubStatusCodes
 from .._retry_utility import _configure_timeout
 from .. import _endpoint_discovery_retry_policy
 from .. import _resource_throttle_retry_policy
 from .. import _default_retry_policy
 from .. import _session_retry_policy
 from .. import _gone_retry_policy
+from .. import _timeout_failover_retry_policy
 
 
 # pylint: disable=protected-access
 
 
 async def ExecuteAsync(client, global_endpoint_manager, function, *args, **kwargs):
     """Executes the function with passed parameters applying all retry policies
@@ -66,14 +67,17 @@
     )
     defaultRetry_policy = _default_retry_policy.DefaultRetryPolicy(*args)
 
     sessionRetry_policy = _session_retry_policy._SessionRetryPolicy(
         client.connection_policy.EnableEndpointDiscovery, global_endpoint_manager, *args
     )
     partition_key_range_gone_retry_policy = _gone_retry_policy.PartitionKeyRangeGoneRetryPolicy(client, *args)
+    timeout_failover_retry_policy = _timeout_failover_retry_policy._TimeoutFailoverRetryPolicy(
+        client.connection_policy, global_endpoint_manager, *args
+    )
 
     while True:
         try:
             client_timeout = kwargs.get('timeout')
             start_time = time.time()
             if args:
                 result = await ExecuteFunctionAsync(function, global_endpoint_manager, *args, **kwargs)
@@ -101,14 +105,16 @@
                 e.status_code == StatusCodes.NOT_FOUND
                 and e.sub_status
                 and e.sub_status == SubStatusCodes.READ_SESSION_NOTAVAILABLE
             ):
                 retry_policy = sessionRetry_policy
             elif exceptions._partition_range_is_gone(e):
                 retry_policy = partition_key_range_gone_retry_policy
+            elif e.status_code == StatusCodes.REQUEST_TIMEOUT or e.status_code == StatusCodes.SERVICE_UNAVAILABLE:
+                retry_policy = timeout_failover_retry_policy
             else:
                 retry_policy = defaultRetry_policy
 
             # If none of the retry policies applies or there is no retry needed, set the
             # throttle related response headers and re-throw the exception back arg[0]
             # is the request. It needs to be modified for write forbidden exception
             if not retry_policy.ShouldRetry(e):
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/_auth_policy_async.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/_auth_policy_async.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/_global_endpoint_manager_async.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/_global_endpoint_manager_async.py`

 * *Files 2% similar despite different names*

```diff
@@ -127,16 +127,15 @@
             for location_name in self.PreferredLocations:
                 locational_endpoint = _GlobalEndpointManager.GetLocationalEndpoint(self.DefaultEndpoint, location_name)
                 try:
                     database_account = await self._GetDatabaseAccountStub(locational_endpoint, **kwargs)
                     return database_account
                 except exceptions.CosmosHttpResponseError:
                     pass
-
-            return None
+            raise
 
     async def _GetDatabaseAccountStub(self, endpoint, **kwargs):
         """Stub for getting database account from the client.
 
         This can be used for mocking purposes as well.
         """
         return await self.client.GetDatabaseAccount(endpoint, **kwargs)
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/_database.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/_database.py`

 * *Files 1% similar despite different names*

```diff
@@ -162,15 +162,15 @@
         :param str id: ID (name) of container to create.
         :param partition_key: The partition key to use for the container.
         :type partition_key: ~azure.cosmos.partition_key.PartitionKey
         :keyword dict[str, str] indexing_policy: The indexing policy to apply to the container.
         :keyword int default_ttl: Default time to live (TTL) for items in the container.
             If unspecified, items do not expire.
         :keyword offer_throughput: The provisioned throughput for this offer.
-        :paramtype offer_throughput: int or ~azure.cosmos.ThroughputProperties.
+        :paramtype offer_throughput: Union[int, ~azure.cosmos.ThroughputProperties]
         :keyword dict[str, str] unique_key_policy: The unique key policy to apply to the container.
         :keyword dict[str, str] conflict_resolution_policy: The conflict resolution policy to apply to the container.
         :keyword str session_token: Token for use with Session consistency.
         :keyword dict[str, str] initial_headers: Initial headers to be sent as part of the request.
         :keyword str etag: An ETag value, or the wildcard character (*). Used to check if the resource
             has changed, and act according to the condition specified by the `match_condition` parameter.
         :keyword match_condition: The match condition to use upon the etag.
@@ -256,15 +256,15 @@
         :param str id: ID (name) of container to create.
         :param partition_key: The partition key to use for the container.
         :type partition_key: ~azure.cosmos.partition_key.PartitionKey
         :keyword dict[str, str] indexing_policy: The indexing policy to apply to the container.
         :keyword int default_ttl: Default time to live (TTL) for items in the container.
             If unspecified, items do not expire.
         :keyword offer_throughput: The provisioned throughput for this offer.
-        :paramtype offer_throughput: int or ~azure.cosmos.ThroughputProperties.
+        :paramtype offer_throughput: Union[int, ~azure.cosmos.ThroughputProperties]
         :keyword dict[str, str] unique_key_policy: The unique key policy to apply to the container.
         :keyword dict[str, str] conflict_resolution_policy: The conflict resolution policy to apply to the container.
         :keyword str session_token: Token for use with Session consistency.
         :keyword dict[str, str] initial_headers: Initial headers to be sent as part of the request.
         :keyword str etag: An ETag value, or the wildcard character (*). Used to check if the resource
             has changed, and act according to the condition specified by the `match_condition` parameter.
         :keyword match_condition: The match condition to use upon the etag.
@@ -274,37 +274,34 @@
         :keyword int analytical_storage_ttl: Analytical store time to live (TTL) for items in the container.  A value of
             None leaves analytical storage off and a value of -1 turns analytical storage on with no TTL. Please
             note that analytical storage can only be enabled on Synapse Link enabled accounts.
         :raises ~azure.cosmos.exceptions.CosmosHttpResponseError: The container creation failed.
         :returns: A `ContainerProxy` instance representing the new container.
         :rtype: ~azure.cosmos.aio.ContainerProxy
         """
-
+        indexing_policy = kwargs.pop('indexing_policy', None)
+        default_ttl = kwargs.pop('default_ttl', None)
+        unique_key_policy = kwargs.pop('unique_key_policy', None)
+        conflict_resolution_policy = kwargs.pop('conflict_resolution_policy', None)
+        analytical_storage_ttl = kwargs.pop("analytical_storage_ttl", None)
+        offer_throughput = kwargs.pop('offer_throughput', None)
         try:
             container_proxy = self.get_container_client(id)
             await container_proxy.read(**kwargs)
             return container_proxy
         except CosmosResourceNotFoundError:
-            indexing_policy = kwargs.pop('indexing_policy', None)
-            default_ttl = kwargs.pop('default_ttl', None)
-            unique_key_policy = kwargs.pop('unique_key_policy', None)
-            conflict_resolution_policy = kwargs.pop('conflict_resolution_policy', None)
-            analytical_storage_ttl = kwargs.pop("analytical_storage_ttl", None)
-            offer_throughput = kwargs.pop('offer_throughput', None)
-            response_hook = kwargs.pop('response_hook', None)
             return await self.create_container(
                 id=id,
                 partition_key=partition_key,
                 indexing_policy=indexing_policy,
                 default_ttl=default_ttl,
                 offer_throughput=offer_throughput,
                 unique_key_policy=unique_key_policy,
                 conflict_resolution_policy=conflict_resolution_policy,
-                analytical_storage_ttl=analytical_storage_ttl,
-                response_hook=response_hook
+                analytical_storage_ttl=analytical_storage_ttl
             )
 
     def get_container_client(self, container: Union[str, ContainerProxy, Dict[str, Any]]) -> ContainerProxy:
         """Get a `ContainerProxy` for a container with specified ID (name).
 
         :param container: The ID (name), dict representing the properties, or :class:`ContainerProxy`
             instance of the container to get.
@@ -756,15 +753,16 @@
     @distributed_trace_async
     async def replace_throughput(self, throughput: Union[int, ThroughputProperties], **kwargs: Any) -> \
             ThroughputProperties:
         """Replace the database-level throughput.
 
         If no ThroughputProperties already exist for the database, an exception is raised.
 
-        :param int throughput: The throughput to be set (an integer).
+        :param throughput: The throughput to be set.
+        :type throughput: Union[int, ~azure.cosmos.ThroughputProperties]
         :keyword response_hook: A callable invoked with the response metadata.
         :paramtype response_hook: Callable[[Dict[str, str], Dict[str, Any]], None]
         :raises ~azure.cosmos.exceptions.CosmosHttpResponseError: No throughput properties exist for the database
             or the throughput properties could not be updated.
         :returns: ThroughputProperties for the database, updated with new throughput.
         :rtype: ~azure.cosmos.offer.ThroughputProperties
         """
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/_asynchronous_request.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/_asynchronous_request.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/aio/_cosmos_client_connection_async.py` & `azure-cosmos-4.4.0b1/azure/cosmos/aio/_cosmos_client_connection_async.py`

 * *Files 0% similar despite different names*

```diff
@@ -191,15 +191,16 @@
             UserAgentPolicy(base_user_agent=self._user_agent, **kwargs),
             ContentDecodePolicy(),
             retry_policy,
             credentials_policy,
             CustomHookPolicy(**kwargs),
             NetworkTraceLoggingPolicy(**kwargs),
             DistributedTracingPolicy(**kwargs),
-            CosmosHttpLoggingPolicy(**kwargs),
+            CosmosHttpLoggingPolicy(enable_diagnostics_logging=kwargs.pop("enable_diagnostics_logging", False),
+                                    **kwargs),
             ]
 
         transport = kwargs.pop("transport", None)
         self.pipeline_client = AsyncPipelineClient(base_url=url_connection, transport=transport, policies=policies)
         self._setup_kwargs = kwargs
 
         # Query compatibility mode.
@@ -1155,14 +1156,44 @@
 
         # Extract the document collection link and add the partition key to options
         collection_link = base.GetItemContainerLink(document_link)
         options = await self._AddPartitionKey(collection_link, new_document, options)
 
         return await self.Replace(new_document, path, "docs", document_id, None, options, **kwargs)
 
+    async def PatchItem(self, document_link, operations, options=None, **kwargs):
+        """Patches a document and returns it.
+
+        :param str document_link: The link to the document.
+        :param list operations: The operations for the patch request.
+        :param dict options: The request options for the request.
+
+        :return:
+            The new Document.
+        :rtype:
+            dict
+
+        """
+        path = base.GetPathFromLink(document_link)
+        document_id = base.GetResourceIdOrFullNameFromLink(document_link)
+        typ = "docs"
+
+        if options is None:
+            options = {}
+
+        initial_headers = self.default_headers
+        headers = base.GetHeaders(self, initial_headers, "patch", path, document_id, typ, options)
+        # Patch will use WriteEndpoint since it uses PUT operation
+        request_params = _request_object.RequestObject(typ, documents._OperationType.Patch)
+        result, self.last_response_headers = await self.__Patch(path, request_params, operations, headers, **kwargs)
+
+        # update session for request mutates data on server side
+        self._UpdateSessionIfRequired(headers, result, self.last_response_headers)
+        return result
+
     async def ReplaceOffer(self, offer_link, offer, **kwargs):
         """Replaces an offer and returns it.
 
         :param str offer_link:
             The link to the offer.
         :param dict offer:
 
@@ -1258,14 +1289,40 @@
             connection_policy=self.connection_policy,
             pipeline_client=self.pipeline_client,
             request=request,
             request_data=body,
             **kwargs
         )
 
+    async def __Patch(self, path, request_params, operations, req_headers, **kwargs):
+        """Azure Cosmos 'PATCH' http request.
+
+        :params str path:
+        :params ~azure.cosmos.RequestObject request_params:
+        :params list operations:
+        :params dict req_headers:
+
+        :return:
+            Tuple of (result, headers).
+        :rtype:
+            tuple of (dict, dict)
+
+        """
+        request = self.pipeline_client.patch(url=path, headers=req_headers)
+        return await asynchronous_request.AsynchronousRequest(
+            client=self,
+            request_params=request_params,
+            global_endpoint_manager=self._global_endpoint_manager,
+            connection_policy=self.connection_policy,
+            pipeline_client=self.pipeline_client,
+            request=request,
+            request_data=operations,
+            **kwargs
+        )
+
     async def DeleteDatabase(self, database_link, options=None, **kwargs):
         """Deletes a database.
 
         :param str database_link:
             The link to the database.
         :param dict options:
             The request options for the request.
@@ -2536,7 +2593,41 @@
                 if id_.find("/") != -1 or id_.find("\\") != -1 or id_.find("?") != -1 or id_.find("#") != -1:
                     raise ValueError("Id contains illegal chars.")
 
                 if id_[-1] == " ":
                     raise ValueError("Id ends with a space.")
             except AttributeError:
                 raise_with_traceback(TypeError, message="Id type must be a string.")
+
+    async def DeleteAllItemsByPartitionKey(
+        self,
+        collection_link,
+        options=None,
+        **kwargs
+    ) -> None:
+        """Exposes an API to delete all items with a single partition key without the user having
+         to explicitly call delete on each record in the partition key.
+
+        :param str collection_link:
+            The link to the document collection.
+        :param dict options:
+            The request options for the request.
+
+        :return:
+            None
+        :rtype:
+            None
+
+        """
+        if options is None:
+            options = {}
+
+        path = base.GetPathFromLink(collection_link)
+        #Specified url to perform background operation to delete all items by partition key
+        path = '{}{}/{}'.format(path, "operations", "partitionkeydelete")
+        collection_id = base.GetResourceIdOrFullNameFromLink(collection_link)
+        initial_headers = dict(self.default_headers)
+        headers = base.GetHeaders(self, initial_headers, "post", path, collection_id, "partitionkey", options)
+        request_params = _request_object.RequestObject("partitionkey", documents._OperationType.Delete)
+        result, self.last_response_headers = await self.__Post(path=path, request_params=request_params,
+                                                               req_headers=headers, body=None, **kwargs)
+        return result
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_routing/__init__.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_routing/routing_map_provider.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_routing/routing_map_provider.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_routing/collection_routing_map.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_routing/collection_routing_map.py`

 * *Files 1% similar despite different names*

```diff
@@ -20,17 +20,14 @@
 # SOFTWARE.
 
 """Internal class for collection routing map implementation in the Azure Cosmos
 database service.
 """
 
 import bisect
-
-from six.moves import xrange
-
 from azure.cosmos._routing import routing_range
 from azure.cosmos._routing.routing_range import PartitionKeyRange
 
 
 class CollectionRoutingMap(object):
     """Stores partition key ranges in an efficient way with some additional
     information and provides convenience methods for working with set of ranges.
@@ -134,15 +131,15 @@
             if minIndex > 0:
                 minIndex = minIndex - 1
 
             maxIndex = bisect.bisect_left(sortedHigh, (providedRange.max, providedRange.isMaxInclusive))
             if maxIndex >= len(sortedHigh):
                 maxIndex = maxIndex - 1
 
-            for i in xrange(minIndex, maxIndex + 1):
+            for i in range(minIndex, maxIndex + 1):
                 if routing_range.Range.overlaps(self._orderedRanges[i], providedRange):
                     minToPartitionRange[
                         self._orderedPartitionKeyRanges[i][PartitionKeyRange.MinInclusive]
                     ] = self._orderedPartitionKeyRanges[i]
 
         overlapping_partition_key_ranges = list(minToPartitionRange.values())
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_routing/routing_range.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_routing/routing_range.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_routing/aio/__init__.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_routing/aio/routing_map_provider.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_routing/aio/routing_map_provider.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/__init__.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_routing/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/endpoint_component.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/endpoint_component.py`

 * *Files 2% similar despite different names*

```diff
@@ -189,15 +189,18 @@
                 self._local_aggregators.append(_SumAggregator())
 
     def __next__(self):
         for res in self._execution_context:
             for item in res:
                 for operator in self._local_aggregators:
                     if isinstance(item, dict) and item:
-                        operator.aggregate(item["item"])
+                        try:
+                            operator.aggregate(item["item"])
+                        except KeyError:
+                            pass
                     elif isinstance(item, numbers.Number):
                         operator.aggregate(item)
         if self._results is None:
             self._results = []
             for operator in self._local_aggregators:
                 self._results.append(operator.get_result())
         if self._result_index < len(self._results):
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/execution_dispatcher.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/execution_dispatcher.py`

 * *Files 1% similar despite different names*

```diff
@@ -20,15 +20,14 @@
 # SOFTWARE.
 
 """Internal class for proxy query execution context implementation in the Azure
 Cosmos database service.
 """
 
 import json
-from six.moves import xrange
 from azure.cosmos.exceptions import CosmosHttpResponseError
 from azure.cosmos._execution_context import multi_execution_aggregator
 from azure.cosmos._execution_context.base_execution_context import _QueryExecutionContextBase
 from azure.cosmos._execution_context.base_execution_context import _DefaultQueryExecutionContext
 from azure.cosmos._execution_context.query_execution_info import _PartitionedQueryExecutionInfo
 from azure.cosmos._execution_context import endpoint_component
 from azure.cosmos.documents import _DistinctType
@@ -193,15 +192,15 @@
         the requested fetch size.
 
         :return: List of results.
         :rtype: list
         """
 
         results = []
-        for _ in xrange(self._page_size):
+        for _ in range(self._page_size):
             try:
                 results.append(next(self))
             except StopIteration:
                 # no more results
                 break
         return results
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/query_execution_info.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/query_execution_info.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/multi_execution_aggregator.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/multi_execution_aggregator.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/document_producer.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/document_producer.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aggregators.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aggregators.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/base_execution_context.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/base_execution_context.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/__init__.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_routing/aio/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/endpoint_component.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/endpoint_component.py`

 * *Files 1% similar despite different names*

```diff
@@ -176,15 +176,18 @@
                 self._local_aggregators.append(_SumAggregator())
 
     async def __anext__(self):
         async for res in self._execution_context:
             for item in res: #TODO check on this being an async loop
                 for operator in self._local_aggregators:
                     if isinstance(item, dict) and item:
-                        operator.aggregate(item["item"])
+                        try:
+                            operator.aggregate(item["item"])
+                        except KeyError:
+                            pass
                     elif isinstance(item, numbers.Number):
                         operator.aggregate(item)
         if self._results is None:
             self._results = []
             for operator in self._local_aggregators:
                 self._results.append(operator.get_result())
         if self._result_index < len(self._results):
```

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/execution_dispatcher.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/execution_dispatcher.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/_queue_async_helper.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/_queue_async_helper.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/multi_execution_aggregator.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/multi_execution_aggregator.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/document_producer.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/document_producer.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/azure/cosmos/_execution_context/aio/base_execution_context.py` & `azure-cosmos-4.4.0b1/azure/cosmos/_execution_context/aio/base_execution_context.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_streaming_failover.py` & `azure-cosmos-4.4.0b1/test/test_streaming_failover.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_auto_scale_async.py` & `azure-cosmos-4.4.0b1/test/test_auto_scale_async.py`

 * *Files 1% similar despite different names*

```diff
@@ -41,15 +41,15 @@
             raise Exception(
                 "You must specify your Azure Cosmos account values for "
                 "'masterKey' and 'host' at the top of this class to run the "
                 "tests.")
 
         cls.client = CosmosClient(cls.host, cls.masterKey, consistency_level="Session",
                                   connection_policy=cls.connectionPolicy)
-        cls.created_database = await cls.client.create_database(test_config._test_config.TEST_DATABASE_ID)
+        cls.created_database = await cls.client.create_database_if_not_exists(test_config._test_config.TEST_DATABASE_ID)
 
     async def test_auto_scale(self):
         created_container = await self.created_database.create_container(
             id='container_with_auto_scale_settings',
             partition_key=PartitionKey(path="/id"),
             offer_throughput=ThroughputProperties(auto_scale_max_throughput=5000, auto_scale_increment_percent=0)
 
@@ -93,15 +93,14 @@
         )
         created_container_properties = await created_container.get_throughput()
         # Testing the incorrect input value of the max_increment_percentage
         self.assertNotEqual(
             created_container_properties.auto_scale_increment_percent, 3)
 
         await self.created_database.delete_container(created_container)
-        await self.client.delete_database(test_config._test_config.TEST_DATABASE_ID)
 
     async def test_create_database(self):
         # Testing auto_scale_settings for the create_database method
         created_database = await self.client.create_database("db1", offer_throughput=ThroughputProperties(
             auto_scale_max_throughput=5000,
             auto_scale_increment_percent=0))
         created_db_properties = await created_database.get_throughput()
@@ -140,7 +139,9 @@
             throughput=ThroughputProperties(auto_scale_max_throughput=7000, auto_scale_increment_percent=20))
         created_container_properties = await created_container.get_throughput()
         # Testing the input value of the replaced auto_scale settings
         self.assertEqual(
             created_container_properties.auto_scale_max_throughput, 7000)
         self.assertEqual(
             created_container_properties.auto_scale_increment_percent, 20)
+
+        await self.client.delete_database(test_config._test_config.TEST_DATABASE_ID)
```

## Comparing `azure-cosmos-4.3.1b1/test/test_session_token_unit.py` & `azure-cosmos-4.4.0b1/test/test_session_token_unit.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_backwards_compatibility.py` & `azure-cosmos-4.4.0b1/test/test_backwards_compatibility.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_ttl.py` & `azure-cosmos-4.4.0b1/test/test_ttl.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_aad.py` & `azure-cosmos-4.4.0b1/test/test_aad.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_analytical_ttl.py` & `azure-cosmos-4.4.0b1/test/test_analytical_ttl.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_config.py` & `azure-cosmos-4.4.0b1/test/test_config.py`

 * *Files 0% similar despite different names*

```diff
@@ -133,15 +133,15 @@
             if use_custom_partition_key:
                 collection_id = cls.TEST_COLLECTION_MULTI_PARTITION_WITH_CUSTOM_PK_ID
                 partition_key = cls.TEST_COLLECTION_MULTI_PARTITION_WITH_CUSTOM_PK_PARTITION_KEY
             else:
                 collection_id = cls.TEST_COLLECTION_MULTI_PARTITION_ID
                 partition_key = cls.TEST_COLLECTION_MULTI_PARTITION_PARTITION_KEY
 
-        document_collection = database.create_container(
+        document_collection = database.create_container_if_not_exists(
             id=collection_id,
             partition_key=PartitionKey(path='/' + partition_key, kind='Hash'),
             offer_throughput=throughput)
         return document_collection
 
     @classmethod
     def remove_all_documents(cls, document_collection, use_custom_partition_key):
```

## Comparing `azure-cosmos-4.3.1b1/test/test_crud_async.py` & `azure-cosmos-4.4.0b1/test/test_crud_async.py`

 * *Files 2% similar despite different names*

```diff
@@ -3712,3851 +3712,4168 @@
 0000e7f0: 6f6e 7369 7374 656e 6379 5f6c 6576 656c  onsistency_level
 0000e800: 3d22 5365 7373 696f 6e22 2c20 636f 6e6e  ="Session", conn
 0000e810: 6563 7469 6f6e 5f70 6f6c 6963 793d 4352  ection_policy=CR
 0000e820: 5544 5465 7374 732e 636f 6e6e 6563 7469  UDTests.connecti
 0000e830: 6f6e 506f 6c69 6379 2920 6173 2063 6c69  onPolicy) as cli
 0000e840: 656e 743a 0a20 2020 2020 2020 2020 2020  ent:.           
 0000e850: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000e860: 2020 2020 2020 6462 5f6c 6973 7420 3d20        db_list = 
-0000e870: 5b64 6220 6173 796e 6320 666f 7220 6462  [db async for db
-0000e880: 2069 6e20 636c 6965 6e74 2e6c 6973 745f   in client.list_
-0000e890: 6461 7461 6261 7365 7328 295d 0a20 2020  databases()].   
-0000e8a0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0000e8b0: 6578 6365 7074 696f 6e73 2e43 6f73 6d6f  exceptions.Cosmo
-0000e8c0: 7348 7474 7052 6573 706f 6e73 6545 7272  sHttpResponseErr
-0000e8d0: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
-0000e8e0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-0000e8f0: 652e 7374 6174 7573 5f63 6f64 6520 3d3d  e.status_code ==
-0000e900: 2034 3031 0a0a 2020 2020 2020 2020 2320   401..        # 
-0000e910: 436c 6965 6e74 2077 6974 6820 6d61 7374  Client with mast
-0000e920: 6572 206b 6579 2e0a 2020 2020 2020 2020  er key..        
-0000e930: 6173 796e 6320 7769 7468 2043 6f73 6d6f  async with Cosmo
-0000e940: 7343 6c69 656e 7428 4352 5544 5465 7374  sClient(CRUDTest
-0000e950: 732e 686f 7374 2c0a 2020 2020 2020 2020  s.host,.        
-0000e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e860: 2020 2020 2020 5b64 6220 6173 796e 6320        [db async 
+0000e870: 666f 7220 6462 2069 6e20 636c 6965 6e74  for db in client
+0000e880: 2e6c 6973 745f 6461 7461 6261 7365 7328  .list_databases(
+0000e890: 295d 0a20 2020 2020 2020 2020 2020 2065  )].            e
+0000e8a0: 7863 6570 7420 6578 6365 7074 696f 6e73  xcept exceptions
+0000e8b0: 2e43 6f73 6d6f 7348 7474 7052 6573 706f  .CosmosHttpRespo
+0000e8c0: 6e73 6545 7272 6f72 2061 7320 653a 0a20  nseError as e:. 
+0000e8d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000e8e0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000e8f0: 652e 7374 6174 7573 5f63 6f64 652c 2053  e.status_code, S
+0000e900: 7461 7475 7343 6f64 6573 2e55 4e41 5554  tatusCodes.UNAUT
+0000e910: 484f 5249 5a45 4429 0a0a 2020 2020 2020  HORIZED)..      
+0000e920: 2020 2320 436c 6965 6e74 2077 6974 6820    # Client with 
+0000e930: 6d61 7374 6572 206b 6579 2e0a 2020 2020  master key..    
+0000e940: 2020 2020 6173 796e 6320 7769 7468 2043      async with C
+0000e950: 6f73 6d6f 7343 6c69 656e 7428 4352 5544  osmosClient(CRUD
+0000e960: 5465 7374 732e 686f 7374 2c0a 2020 2020  Tests.host,.    
 0000e970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e980: 2020 2020 4352 5544 5465 7374 732e 6d61      CRUDTests.ma
-0000e990: 7374 6572 4b65 792c 0a20 2020 2020 2020  sterKey,.       
-0000e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e990: 2020 2020 2020 2020 4352 5544 5465 7374          CRUDTest
+0000e9a0: 732e 6d61 7374 6572 4b65 792c 0a20 2020  s.masterKey,.   
 0000e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9c0: 2020 2020 2063 6f6e 7369 7374 656e 6379       consistency
-0000e9d0: 5f6c 6576 656c 3d22 5365 7373 696f 6e22  _level="Session"
-0000e9e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea00: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000ea10: 6e6e 6563 7469 6f6e 5f70 6f6c 6963 793d  nnection_policy=
-0000ea20: 4352 5544 5465 7374 732e 636f 6e6e 6563  CRUDTests.connec
-0000ea30: 7469 6f6e 506f 6c69 6379 2920 6173 2063  tionPolicy) as c
-0000ea40: 6c69 656e 743a 0a20 2020 2020 2020 2020  lient:.         
-0000ea50: 2020 2023 2073 6574 7570 2065 6e74 6974     # setup entit
-0000ea60: 6965 730a 2020 2020 2020 2020 2020 2020  ies.            
-0000ea70: 656e 7469 7469 6573 203d 2061 7761 6974  entities = await
-0000ea80: 205f 5f53 6574 7570 456e 7469 7469 6573   __SetupEntities
-0000ea90: 2863 6c69 656e 7429 0a20 2020 2020 2020  (client).       
-0000eaa0: 2020 2020 2072 6573 6f75 7263 655f 746f       resource_to
-0000eab0: 6b65 6e73 203d 207b 2264 6273 2f22 202b  kens = {"dbs/" +
-0000eac0: 2065 6e74 6974 6965 735b 2764 6227 5d2e   entities['db'].
-0000ead0: 6964 202b 2022 2f63 6f6c 6c73 2f22 202b  id + "/colls/" +
-0000eae0: 2065 6e74 6974 6965 735b 2763 6f6c 6c27   entities['coll'
-0000eaf0: 5d2e 6964 3a0a 2020 2020 2020 2020 2020  ].id:.          
-0000eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb10: 2020 2020 2020 2020 2065 6e74 6974 6965           entitie
-0000eb20: 735b 2770 6572 6d69 7373 696f 6e4f 6e43  s['permissionOnC
-0000eb30: 6f6c 6c27 5d2e 7072 6f70 6572 7469 6573  oll'].properties
-0000eb40: 5b27 5f74 6f6b 656e 275d 7d0a 0a20 2020  ['_token']}..   
-0000eb50: 2020 2020 2061 7379 6e63 2077 6974 6820       async with 
-0000eb60: 436f 736d 6f73 436c 6965 6e74 280a 2020  CosmosClient(.  
-0000eb70: 2020 2020 2020 2020 2020 2020 2020 4352                CR
-0000eb80: 5544 5465 7374 732e 686f 7374 2c20 7265  UDTests.host, re
-0000eb90: 736f 7572 6365 5f74 6f6b 656e 732c 2063  source_tokens, c
-0000eba0: 6f6e 7369 7374 656e 6379 5f6c 6576 656c  onsistency_level
-0000ebb0: 3d22 5365 7373 696f 6e22 2c20 636f 6e6e  ="Session", conn
-0000ebc0: 6563 7469 6f6e 5f70 6f6c 6963 793d 4352  ection_policy=CR
-0000ebd0: 5544 5465 7374 732e 636f 6e6e 6563 7469  UDTests.connecti
-0000ebe0: 6f6e 506f 6c69 6379 2920 6173 2063 6f6c  onPolicy) as col
-0000ebf0: 5f63 6c69 656e 743a 0a20 2020 2020 2020  _client:.       
-0000ec00: 2020 2020 2064 6220 3d20 656e 7469 7469       db = entiti
-0000ec10: 6573 5b27 6462 275d 0a0a 2020 2020 2020  es['db']..      
-0000ec20: 2020 2020 2020 6f6c 645f 636c 6965 6e74        old_client
-0000ec30: 5f63 6f6e 6e65 6374 696f 6e20 3d20 6462  _connection = db
-0000ec40: 2e63 6c69 656e 745f 636f 6e6e 6563 7469  .client_connecti
-0000ec50: 6f6e 0a20 2020 2020 2020 2020 2020 2064  on.            d
-0000ec60: 622e 636c 6965 6e74 5f63 6f6e 6e65 6374  b.client_connect
-0000ec70: 696f 6e20 3d20 636f 6c5f 636c 6965 6e74  ion = col_client
-0000ec80: 2e63 6c69 656e 745f 636f 6e6e 6563 7469  .client_connecti
-0000ec90: 6f6e 0a20 2020 2020 2020 2020 2020 2023  on.            #
-0000eca0: 2031 2e20 5375 6363 6573 732d 2d20 5573   1. Success-- Us
-0000ecb0: 6520 436f 6c20 5065 726d 6973 7369 6f6e  e Col Permission
-0000ecc0: 2074 6f20 5265 6164 0a20 2020 2020 2020   to Read.       
-0000ecd0: 2020 2020 2073 7563 6365 7373 5f63 6f6c       success_col
-0000ece0: 6c20 3d20 6462 2e67 6574 5f63 6f6e 7461  l = db.get_conta
-0000ecf0: 696e 6572 5f63 6c69 656e 7428 636f 6e74  iner_client(cont
-0000ed00: 6169 6e65 723d 656e 7469 7469 6573 5b27  ainer=entities['
-0000ed10: 636f 6c6c 275d 290a 2020 2020 2020 2020  coll']).        
-0000ed20: 2020 2020 2320 322e 2046 6169 6c75 7265      # 2. Failure
-0000ed30: 2d2d 2055 7365 2043 6f6c 2050 6572 6d69  -- Use Col Permi
-0000ed40: 7373 696f 6e20 746f 2064 656c 6574 650a  ssion to delete.
-0000ed50: 2020 2020 2020 2020 2020 2020 6177 6169              awai
-0000ed60: 7420 7365 6c66 2e5f 5f41 7373 6572 7448  t self.__AssertH
-0000ed70: 5454 5046 6169 6c75 7265 5769 7468 5374  TTPFailureWithSt
-0000ed80: 6174 7573 2853 7461 7475 7343 6f64 6573  atus(StatusCodes
-0000ed90: 2e46 4f52 4249 4444 454e 2c0a 2020 2020  .FORBIDDEN,.    
-0000eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9d0: 2020 2020 2020 2020 2063 6f6e 7369 7374           consist
+0000e9e0: 656e 6379 5f6c 6576 656c 3d22 5365 7373  ency_level="Sess
+0000e9f0: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
+0000ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea20: 2020 636f 6e6e 6563 7469 6f6e 5f70 6f6c    connection_pol
+0000ea30: 6963 793d 4352 5544 5465 7374 732e 636f  icy=CRUDTests.co
+0000ea40: 6e6e 6563 7469 6f6e 506f 6c69 6379 2920  nnectionPolicy) 
+0000ea50: 6173 2063 6c69 656e 743a 0a20 2020 2020  as client:.     
+0000ea60: 2020 2020 2020 2023 2073 6574 7570 2065         # setup e
+0000ea70: 6e74 6974 6965 730a 2020 2020 2020 2020  ntities.        
+0000ea80: 2020 2020 656e 7469 7469 6573 203d 2061      entities = a
+0000ea90: 7761 6974 205f 5f53 6574 7570 456e 7469  wait __SetupEnti
+0000eaa0: 7469 6573 2863 6c69 656e 7429 0a20 2020  ties(client).   
+0000eab0: 2020 2020 2020 2020 2072 6573 6f75 7263           resourc
+0000eac0: 655f 746f 6b65 6e73 203d 207b 2264 6273  e_tokens = {"dbs
+0000ead0: 2f22 202b 2065 6e74 6974 6965 735b 2764  /" + entities['d
+0000eae0: 6227 5d2e 6964 202b 2022 2f63 6f6c 6c73  b'].id + "/colls
+0000eaf0: 2f22 202b 2065 6e74 6974 6965 735b 2763  /" + entities['c
+0000eb00: 6f6c 6c27 5d2e 6964 3a0a 2020 2020 2020  oll'].id:.      
+0000eb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb20: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
+0000eb30: 6974 6965 735b 2770 6572 6d69 7373 696f  ities['permissio
+0000eb40: 6e4f 6e43 6f6c 6c27 5d2e 7072 6f70 6572  nOnColl'].proper
+0000eb50: 7469 6573 5b27 5f74 6f6b 656e 275d 7d0a  ties['_token']}.
+0000eb60: 0a20 2020 2020 2020 2061 7379 6e63 2077  .        async w
+0000eb70: 6974 6820 436f 736d 6f73 436c 6965 6e74  ith CosmosClient
+0000eb80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000eb90: 2020 4352 5544 5465 7374 732e 686f 7374    CRUDTests.host
+0000eba0: 2c20 7265 736f 7572 6365 5f74 6f6b 656e  , resource_token
+0000ebb0: 732c 2063 6f6e 7369 7374 656e 6379 5f6c  s, consistency_l
+0000ebc0: 6576 656c 3d22 5365 7373 696f 6e22 2c20  evel="Session", 
+0000ebd0: 636f 6e6e 6563 7469 6f6e 5f70 6f6c 6963  connection_polic
+0000ebe0: 793d 4352 5544 5465 7374 732e 636f 6e6e  y=CRUDTests.conn
+0000ebf0: 6563 7469 6f6e 506f 6c69 6379 2920 6173  ectionPolicy) as
+0000ec00: 2063 6f6c 5f63 6c69 656e 743a 0a20 2020   col_client:.   
+0000ec10: 2020 2020 2020 2020 2064 6220 3d20 656e           db = en
+0000ec20: 7469 7469 6573 5b27 6462 275d 0a0a 2020  tities['db']..  
+0000ec30: 2020 2020 2020 2020 2020 6f6c 645f 636c            old_cl
+0000ec40: 6965 6e74 5f63 6f6e 6e65 6374 696f 6e20  ient_connection 
+0000ec50: 3d20 6462 2e63 6c69 656e 745f 636f 6e6e  = db.client_conn
+0000ec60: 6563 7469 6f6e 0a20 2020 2020 2020 2020  ection.         
+0000ec70: 2020 2064 622e 636c 6965 6e74 5f63 6f6e     db.client_con
+0000ec80: 6e65 6374 696f 6e20 3d20 636f 6c5f 636c  nection = col_cl
+0000ec90: 6965 6e74 2e63 6c69 656e 745f 636f 6e6e  ient.client_conn
+0000eca0: 6563 7469 6f6e 0a20 2020 2020 2020 2020  ection.         
+0000ecb0: 2020 2023 2031 2e20 5375 6363 6573 732d     # 1. Success-
+0000ecc0: 2d20 5573 6520 436f 6c20 5065 726d 6973  - Use Col Permis
+0000ecd0: 7369 6f6e 2074 6f20 5265 6164 0a20 2020  sion to Read.   
+0000ece0: 2020 2020 2020 2020 2073 7563 6365 7373           success
+0000ecf0: 5f63 6f6c 6c20 3d20 6462 2e67 6574 5f63  _coll = db.get_c
+0000ed00: 6f6e 7461 696e 6572 5f63 6c69 656e 7428  ontainer_client(
+0000ed10: 636f 6e74 6169 6e65 723d 656e 7469 7469  container=entiti
+0000ed20: 6573 5b27 636f 6c6c 275d 290a 2020 2020  es['coll']).    
+0000ed30: 2020 2020 2020 2020 2320 322e 2046 6169          # 2. Fai
+0000ed40: 6c75 7265 2d2d 2055 7365 2043 6f6c 2050  lure-- Use Col P
+0000ed50: 6572 6d69 7373 696f 6e20 746f 2064 656c  ermission to del
+0000ed60: 6574 650a 2020 2020 2020 2020 2020 2020  ete.            
+0000ed70: 6177 6169 7420 7365 6c66 2e5f 5f41 7373  await self.__Ass
+0000ed80: 6572 7448 5454 5046 6169 6c75 7265 5769  ertHTTPFailureWi
+0000ed90: 7468 5374 6174 7573 2853 7461 7475 7343  thStatus(StatusC
+0000eda0: 6f64 6573 2e46 4f52 4249 4444 454e 2c0a  odes.FORBIDDEN,.
 0000edb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000edd0: 2064 622e 6465 6c65 7465 5f63 6f6e 7461   db.delete_conta
-0000ede0: 696e 6572 2c0a 2020 2020 2020 2020 2020  iner,.          
-0000edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ede0: 2020 2020 2064 622e 6465 6c65 7465 5f63       db.delete_c
+0000edf0: 6f6e 7461 696e 6572 2c0a 2020 2020 2020  ontainer,.      
 0000ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee10: 2020 2020 2020 2020 2020 2073 7563 6365             succe
-0000ee20: 7373 5f63 6f6c 6c29 0a20 2020 2020 2020  ss_coll).       
-0000ee30: 2020 2020 2023 2033 2e20 5375 6363 6573       # 3. Succes
-0000ee40: 732d 2d20 5573 6520 436f 6c20 5065 726d  s-- Use Col Perm
-0000ee50: 6973 7369 6f6e 2074 6f20 5265 6164 2041  ission to Read A
-0000ee60: 6c6c 2044 6f63 730a 2020 2020 2020 2020  ll Docs.        
-0000ee70: 2020 2020 7375 6363 6573 735f 646f 6375      success_docu
-0000ee80: 6d65 6e74 7320 3d20 5b64 6f63 756d 656e  ments = [documen
-0000ee90: 7420 6173 796e 6320 666f 7220 646f 6375  t async for docu
-0000eea0: 6d65 6e74 2069 6e20 7375 6363 6573 735f  ment in success_
-0000eeb0: 636f 6c6c 2e72 6561 645f 616c 6c5f 6974  coll.read_all_it
-0000eec0: 656d 7328 295d 0a20 2020 2020 2020 2020  ems()].         
-0000eed0: 2020 2073 656c 662e 6173 7365 7274 5472     self.assertTr
-0000eee0: 7565 2873 7563 6365 7373 5f64 6f63 756d  ue(success_docum
-0000eef0: 656e 7473 2021 3d20 4e6f 6e65 2c0a 2020  ents != None,.  
-0000ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef10: 2020 2020 2020 2020 2020 2765 7272 6f72            'error
-0000ef20: 2072 6561 6469 6e67 2064 6f63 756d 656e   reading documen
-0000ef30: 7473 2729 0a20 2020 2020 2020 2020 2020  ts').           
-0000ef40: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000ef50: 6c28 6c65 6e28 7375 6363 6573 735f 646f  l(len(success_do
-0000ef60: 6375 6d65 6e74 7329 2c0a 2020 2020 2020  cuments),.      
-0000ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef80: 2020 2020 2020 2031 2c0a 2020 2020 2020         1,.      
-0000ef90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efa0: 2020 2020 2020 2027 4578 7065 6374 6564         'Expected
-0000efb0: 2031 2044 6f63 756d 656e 7420 746f 2062   1 Document to b
-0000efc0: 6520 7375 6363 6573 7366 756c 6c79 2072  e successfully r
-0000efd0: 6561 6427 290a 2020 2020 2020 2020 2020  ead').          
-0000efe0: 2020 2320 342e 2053 7563 6365 7373 2d2d    # 4. Success--
-0000eff0: 2055 7365 2043 6f6c 2050 6572 6d69 7373   Use Col Permiss
-0000f000: 696f 6e20 746f 2052 6561 6420 446f 630a  ion to Read Doc.
-0000f010: 0a20 2020 2020 2020 2020 2020 2064 6f63  .            doc
-0000f020: 4964 203d 2065 6e74 6974 6965 735b 2764  Id = entities['d
-0000f030: 6f63 275d 5b27 6964 275d 0a20 2020 2020  oc']['id'].     
-0000f040: 2020 2020 2020 2073 7563 6365 7373 5f64         success_d
-0000f050: 6f63 203d 2061 7761 6974 2073 7563 6365  oc = await succe
-0000f060: 7373 5f63 6f6c 6c2e 7265 6164 5f69 7465  ss_coll.read_ite
-0000f070: 6d28 0a20 2020 2020 2020 2020 2020 2020  m(.             
-0000f080: 2020 2069 7465 6d3d 646f 6349 642c 0a20     item=docId,. 
-0000f090: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000f0a0: 6172 7469 7469 6f6e 5f6b 6579 3d64 6f63  artition_key=doc
-0000f0b0: 4964 0a20 2020 2020 2020 2020 2020 2029  Id.            )
-0000f0c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000f0d0: 662e 6173 7365 7274 5472 7565 2873 7563  f.assertTrue(suc
-0000f0e0: 6365 7373 5f64 6f63 2021 3d20 4e6f 6e65  cess_doc != None
-0000f0f0: 2c20 2765 7272 6f72 2072 6561 6469 6e67  , 'error reading
-0000f100: 2064 6f63 756d 656e 7427 290a 2020 2020   document').    
-0000f110: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000f120: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-0000f130: 2020 2020 2020 2020 2020 7375 6363 6573            succes
-0000f140: 735f 646f 635b 2769 6427 5d2c 0a20 2020  s_doc['id'],.   
-0000f150: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
-0000f160: 6974 6965 735b 2764 6f63 275d 5b27 6964  ities['doc']['id
-0000f170: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-0000f180: 2020 2020 2745 7870 6563 7465 6420 746f      'Expected to
-0000f190: 2072 6561 6420 6368 696c 6472 656e 2075   read children u
-0000f1a0: 7369 6e67 2070 6172 656e 7420 7065 726d  sing parent perm
-0000f1b0: 6973 7369 6f6e 7327 290a 0a20 2020 2020  issions')..     
-0000f1c0: 2020 2020 2020 2023 2035 2e20 4661 696c         # 5. Fail
-0000f1d0: 7572 652d 2d20 5573 6520 436f 6c20 5065  ure-- Use Col Pe
-0000f1e0: 726d 6973 7369 6f6e 2074 6f20 4465 6c65  rmission to Dele
-0000f1f0: 7465 2044 6f63 0a20 2020 2020 2020 2020  te Doc.         
-0000f200: 2020 2061 7761 6974 2073 656c 662e 5f5f     await self.__
-0000f210: 4173 7365 7274 4854 5450 4661 696c 7572  AssertHTTPFailur
-0000f220: 6557 6974 6853 7461 7475 7328 5374 6174  eWithStatus(Stat
-0000f230: 7573 436f 6465 732e 464f 5242 4944 4445  usCodes.FORBIDDE
-0000f240: 4e2c 0a20 2020 2020 2020 2020 2020 2020  N,.             
-0000f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ee30: 7563 6365 7373 5f63 6f6c 6c29 0a20 2020  uccess_coll).   
+0000ee40: 2020 2020 2020 2020 2023 2033 2e20 5375           # 3. Su
+0000ee50: 6363 6573 732d 2d20 5573 6520 436f 6c20  ccess-- Use Col 
+0000ee60: 5065 726d 6973 7369 6f6e 2074 6f20 5265  Permission to Re
+0000ee70: 6164 2041 6c6c 2044 6f63 730a 2020 2020  ad All Docs.    
+0000ee80: 2020 2020 2020 2020 7375 6363 6573 735f          success_
+0000ee90: 646f 6375 6d65 6e74 7320 3d20 5b64 6f63  documents = [doc
+0000eea0: 756d 656e 7420 6173 796e 6320 666f 7220  ument async for 
+0000eeb0: 646f 6375 6d65 6e74 2069 6e20 7375 6363  document in succ
+0000eec0: 6573 735f 636f 6c6c 2e72 6561 645f 616c  ess_coll.read_al
+0000eed0: 6c5f 6974 656d 7328 295d 0a20 2020 2020  l_items()].     
+0000eee0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000eef0: 7274 5472 7565 2873 7563 6365 7373 5f64  rtTrue(success_d
+0000ef00: 6f63 756d 656e 7473 2021 3d20 4e6f 6e65  ocuments != None
+0000ef10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ef20: 2020 2020 2020 2020 2020 2020 2020 2765                'e
+0000ef30: 7272 6f72 2072 6561 6469 6e67 2064 6f63  rror reading doc
+0000ef40: 756d 656e 7473 2729 0a20 2020 2020 2020  uments').       
+0000ef50: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000ef60: 4571 7561 6c28 6c65 6e28 7375 6363 6573  Equal(len(succes
+0000ef70: 735f 646f 6375 6d65 6e74 7329 2c0a 2020  s_documents),.  
+0000ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef90: 2020 2020 2020 2020 2020 2031 2c0a 2020             1,.  
+0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efb0: 2020 2020 2020 2020 2020 2027 4578 7065             'Expe
+0000efc0: 6374 6564 2031 2044 6f63 756d 656e 7420  cted 1 Document 
+0000efd0: 746f 2062 6520 7375 6363 6573 7366 756c  to be successful
+0000efe0: 6c79 2072 6561 6427 290a 2020 2020 2020  ly read').      
+0000eff0: 2020 2020 2020 2320 342e 2053 7563 6365        # 4. Succe
+0000f000: 7373 2d2d 2055 7365 2043 6f6c 2050 6572  ss-- Use Col Per
+0000f010: 6d69 7373 696f 6e20 746f 2052 6561 6420  mission to Read 
+0000f020: 446f 630a 0a20 2020 2020 2020 2020 2020  Doc..           
+0000f030: 2064 6f63 4964 203d 2065 6e74 6974 6965   docId = entitie
+0000f040: 735b 2764 6f63 275d 5b27 6964 275d 0a20  s['doc']['id']. 
+0000f050: 2020 2020 2020 2020 2020 2073 7563 6365             succe
+0000f060: 7373 5f64 6f63 203d 2061 7761 6974 2073  ss_doc = await s
+0000f070: 7563 6365 7373 5f63 6f6c 6c2e 7265 6164  uccess_coll.read
+0000f080: 5f69 7465 6d28 0a20 2020 2020 2020 2020  _item(.         
+0000f090: 2020 2020 2020 2069 7465 6d3d 646f 6349         item=docI
+0000f0a0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+0000f0b0: 2020 2070 6172 7469 7469 6f6e 5f6b 6579     partition_key
+0000f0c0: 3d64 6f63 4964 0a20 2020 2020 2020 2020  =docId.         
+0000f0d0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000f0e0: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
+0000f0f0: 2873 7563 6365 7373 5f64 6f63 2021 3d20  (success_doc != 
+0000f100: 4e6f 6e65 2c20 2765 7272 6f72 2072 6561  None, 'error rea
+0000f110: 6469 6e67 2064 6f63 756d 656e 7427 290a  ding document').
+0000f120: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f130: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+0000f140: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0000f150: 6363 6573 735f 646f 635b 2769 6427 5d2c  ccess_doc['id'],
+0000f160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f170: 2065 6e74 6974 6965 735b 2764 6f63 275d   entities['doc']
+0000f180: 5b27 6964 275d 2c0a 2020 2020 2020 2020  ['id'],.        
+0000f190: 2020 2020 2020 2020 2745 7870 6563 7465          'Expecte
+0000f1a0: 6420 746f 2072 6561 6420 6368 696c 6472  d to read childr
+0000f1b0: 656e 2075 7369 6e67 2070 6172 656e 7420  en using parent 
+0000f1c0: 7065 726d 6973 7369 6f6e 7327 290a 0a20  permissions').. 
+0000f1d0: 2020 2020 2020 2020 2020 2023 2035 2e20             # 5. 
+0000f1e0: 4661 696c 7572 652d 2d20 5573 6520 436f  Failure-- Use Co
+0000f1f0: 6c20 5065 726d 6973 7369 6f6e 2074 6f20  l Permission to 
+0000f200: 4465 6c65 7465 2044 6f63 0a20 2020 2020  Delete Doc.     
+0000f210: 2020 2020 2020 2061 7761 6974 2073 656c         await sel
+0000f220: 662e 5f5f 4173 7365 7274 4854 5450 4661  f.__AssertHTTPFa
+0000f230: 696c 7572 6557 6974 6853 7461 7475 7328  ilureWithStatus(
+0000f240: 5374 6174 7573 436f 6465 732e 464f 5242  StatusCodes.FORB
+0000f250: 4944 4445 4e2c 0a20 2020 2020 2020 2020  IDDEN,.         
 0000f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f270: 2020 2020 2020 2020 7375 6363 6573 735f          success_
-0000f280: 636f 6c6c 2e64 656c 6574 655f 6974 656d  coll.delete_item
-0000f290: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f280: 2020 2020 2020 2020 2020 2020 7375 6363              succ
+0000f290: 6573 735f 636f 6c6c 2e64 656c 6574 655f  ess_coll.delete_
+0000f2a0: 6974 656d 2c0a 2020 2020 2020 2020 2020  item,.          
 0000f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2c0: 2020 2020 2020 2064 6f63 4964 2c20 646f         docId, do
-0000f2d0: 6349 6429 0a0a 2020 2020 2020 2020 2020  cId)..          
-0000f2e0: 2020 7265 736f 7572 6365 5f74 6f6b 656e    resource_token
-0000f2f0: 7320 3d20 7b22 6462 732f 2220 2b20 656e  s = {"dbs/" + en
-0000f300: 7469 7469 6573 5b27 6462 275d 2e69 6420  tities['db'].id 
-0000f310: 2b20 222f 636f 6c6c 732f 2220 2b20 656e  + "/colls/" + en
-0000f320: 7469 7469 6573 5b27 636f 6c6c 275d 2e69  tities['coll'].i
-0000f330: 6420 2b20 222f 646f 6373 2f22 202b 2064  d + "/docs/" + d
-0000f340: 6f63 4964 3a0a 2020 2020 2020 2020 2020  ocId:.          
-0000f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f360: 2020 2020 2020 2020 2065 6e74 6974 6965           entitie
-0000f370: 735b 2770 6572 6d69 7373 696f 6e4f 6e44  s['permissionOnD
-0000f380: 6f63 275d 2e70 726f 7065 7274 6965 735b  oc'].properties[
-0000f390: 275f 746f 6b65 6e27 5d7d 0a0a 2020 2020  '_token']}..    
-0000f3a0: 2020 2020 6173 796e 6320 7769 7468 2043      async with C
-0000f3b0: 6f73 6d6f 7343 6c69 656e 7428 0a20 2020  osmosClient(.   
-0000f3c0: 2020 2020 2020 2020 2020 2020 2043 5255               CRU
-0000f3d0: 4454 6573 7473 2e68 6f73 742c 2072 6573  DTests.host, res
-0000f3e0: 6f75 7263 655f 746f 6b65 6e73 2c20 636f  ource_tokens, co
-0000f3f0: 6e73 6973 7465 6e63 795f 6c65 7665 6c3d  nsistency_level=
-0000f400: 2253 6573 7369 6f6e 222c 2063 6f6e 6e65  "Session", conne
-0000f410: 6374 696f 6e5f 706f 6c69 6379 3d43 5255  ction_policy=CRU
-0000f420: 4454 6573 7473 2e63 6f6e 6e65 6374 696f  DTests.connectio
-0000f430: 6e50 6f6c 6963 7929 2061 7320 646f 635f  nPolicy) as doc_
-0000f440: 636c 6965 6e74 3a0a 0a20 2020 2020 2020  client:..       
-0000f450: 2020 2020 2023 2036 2e20 5375 6363 6573       # 6. Succes
-0000f460: 732d 2d20 5573 6520 446f 6320 7065 726d  s-- Use Doc perm
-0000f470: 6973 7369 6f6e 2074 6f20 7265 6164 2064  ission to read d
-0000f480: 6f63 0a20 2020 2020 2020 2020 2020 2072  oc.            r
-0000f490: 6561 645f 646f 6320 3d20 6177 6169 7420  ead_doc = await 
-0000f4a0: 646f 635f 636c 6965 6e74 2e67 6574 5f64  doc_client.get_d
-0000f4b0: 6174 6162 6173 655f 636c 6965 6e74 2864  atabase_client(d
-0000f4c0: 622e 6964 292e 6765 745f 636f 6e74 6169  b.id).get_contai
-0000f4d0: 6e65 725f 636c 6965 6e74 2873 7563 6365  ner_client(succe
-0000f4e0: 7373 5f63 6f6c 6c2e 6964 292e 7265 6164  ss_coll.id).read
-0000f4f0: 5f69 7465 6d28 646f 6349 642c 2064 6f63  _item(docId, doc
-0000f500: 4964 290a 2020 2020 2020 2020 2020 2020  Id).            
-0000f510: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000f520: 2872 6561 645f 646f 635b 2269 6422 5d2c  (read_doc["id"],
-0000f530: 2064 6f63 4964 290a 0a20 2020 2020 2020   docId)..       
-0000f540: 2020 2020 2023 2036 2e20 5375 6363 6573       # 6. Succes
-0000f550: 732d 2d20 5573 6520 446f 6320 7065 726d  s-- Use Doc perm
-0000f560: 6973 7369 6f6e 2074 6f20 6465 6c65 7465  ission to delete
-0000f570: 2064 6f63 0a20 2020 2020 2020 2020 2020   doc.           
-0000f580: 2061 7761 6974 2064 6f63 5f63 6c69 656e   await doc_clien
-0000f590: 742e 6765 745f 6461 7461 6261 7365 5f63  t.get_database_c
-0000f5a0: 6c69 656e 7428 6462 2e69 6429 2e67 6574  lient(db.id).get
-0000f5b0: 5f63 6f6e 7461 696e 6572 5f63 6c69 656e  _container_clien
-0000f5c0: 7428 7375 6363 6573 735f 636f 6c6c 2e69  t(success_coll.i
-0000f5d0: 6429 2e64 656c 6574 655f 6974 656d 2864  d).delete_item(d
-0000f5e0: 6f63 4964 2c20 646f 6349 6429 0a20 2020  ocId, docId).   
-0000f5f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-0000f600: 7365 7274 4571 7561 6c28 7265 6164 5f64  sertEqual(read_d
-0000f610: 6f63 5b22 6964 225d 2c20 646f 6349 6429  oc["id"], docId)
-0000f620: 0a0a 2020 2020 2020 2020 2020 2020 6462  ..            db
-0000f630: 2e63 6c69 656e 745f 636f 6e6e 6563 7469  .client_connecti
-0000f640: 6f6e 203d 206f 6c64 5f63 6c69 656e 745f  on = old_client_
-0000f650: 636f 6e6e 6563 7469 6f6e 0a20 2020 2020  connection.     
-0000f660: 2020 2020 2020 2061 7761 6974 2064 622e         await db.
-0000f670: 6465 6c65 7465 5f63 6f6e 7461 696e 6572  delete_container
-0000f680: 2865 6e74 6974 6965 735b 2763 6f6c 6c27  (entities['coll'
-0000f690: 5d29 0a0a 2020 2020 6173 796e 6320 6465  ])..    async de
-0000f6a0: 6620 7465 7374 5f74 7269 6767 6572 5f63  f test_trigger_c
-0000f6b0: 7275 6428 7365 6c66 293a 0a20 2020 2020  rud(self):.     
-0000f6c0: 2020 2023 2063 7265 6174 6520 6461 7461     # create data
-0000f6d0: 6261 7365 0a20 2020 2020 2020 2064 6220  base.        db 
-0000f6e0: 3d20 7365 6c66 2e64 6174 6162 6173 6546  = self.databaseF
-0000f6f0: 6f72 5465 7374 0a20 2020 2020 2020 2023  orTest.        #
-0000f700: 2063 7265 6174 6520 636f 6c6c 6563 7469   create collecti
-0000f710: 6f6e 0a20 2020 2020 2020 2063 6f6c 6c65  on.        colle
-0000f720: 6374 696f 6e20 3d20 6177 6169 7420 7365  ction = await se
-0000f730: 6c66 2e64 6174 6162 6173 6546 6f72 5465  lf.databaseForTe
-0000f740: 7374 2e63 7265 6174 655f 636f 6e74 6169  st.create_contai
-0000f750: 6e65 7228 7465 7374 5f63 6f6e 6669 672e  ner(test_config.
-0000f760: 5f74 6573 745f 636f 6e66 6967 2e54 4553  _test_config.TES
-0000f770: 545f 434f 4c4c 4543 5449 4f4e 5f4d 554c  T_COLLECTION_MUL
-0000f780: 5449 5f50 4152 5449 5449 4f4e 290a 2020  TI_PARTITION).  
-0000f790: 2020 2020 2020 2320 7265 6164 2074 7269        # read tri
-0000f7a0: 6767 6572 730a 2020 2020 2020 2020 7472  ggers.        tr
-0000f7b0: 6967 6765 7273 203d 205b 7472 6967 6765  iggers = [trigge
-0000f7c0: 7220 6173 796e 6320 666f 7220 7472 6967  r async for trig
-0000f7d0: 6765 7220 696e 2063 6f6c 6c65 6374 696f  ger in collectio
-0000f7e0: 6e2e 7363 7269 7074 732e 6c69 7374 5f74  n.scripts.list_t
-0000f7f0: 7269 6767 6572 7328 295d 0a20 2020 2020  riggers()].     
-0000f800: 2020 2023 2063 7265 6174 6520 6120 7472     # create a tr
-0000f810: 6967 6765 720a 2020 2020 2020 2020 6265  igger.        be
-0000f820: 666f 7265 5f63 7265 6174 655f 7472 6967  fore_create_trig
-0000f830: 6765 7273 5f63 6f75 6e74 203d 206c 656e  gers_count = len
-0000f840: 2874 7269 6767 6572 7329 0a20 2020 2020  (triggers).     
-0000f850: 2020 2074 7269 6767 6572 5f64 6566 696e     trigger_defin
-0000f860: 6974 696f 6e20 3d20 7b0a 2020 2020 2020  ition = {.      
-0000f870: 2020 2020 2020 2769 6427 3a20 2773 616d        'id': 'sam
-0000f880: 706c 6520 7472 6967 6765 7227 2c0a 2020  ple trigger',.  
-0000f890: 2020 2020 2020 2020 2020 2773 6572 7665            'serve
-0000f8a0: 7253 6372 6970 7427 3a20 2766 756e 6374  rScript': 'funct
-0000f8b0: 696f 6e28 2920 7b76 6172 2078 203d 2031  ion() {var x = 1
-0000f8c0: 303b 7d27 2c0a 2020 2020 2020 2020 2020  0;}',.          
-0000f8d0: 2020 2774 7269 6767 6572 5479 7065 273a    'triggerType':
-0000f8e0: 2064 6f63 756d 656e 7473 2e54 7269 6767   documents.Trigg
-0000f8f0: 6572 5479 7065 2e50 7265 2c0a 2020 2020  erType.Pre,.    
-0000f900: 2020 2020 2020 2020 2774 7269 6767 6572          'trigger
-0000f910: 4f70 6572 6174 696f 6e27 3a20 646f 6375  Operation': docu
-0000f920: 6d65 6e74 732e 5472 6967 6765 724f 7065  ments.TriggerOpe
-0000f930: 7261 7469 6f6e 2e41 6c6c 0a20 2020 2020  ration.All.     
-0000f940: 2020 207d 0a20 2020 2020 2020 2074 7269     }.        tri
-0000f950: 6767 6572 203d 2061 7761 6974 2063 6f6c  gger = await col
-0000f960: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
-0000f970: 6372 6561 7465 5f74 7269 6767 6572 2862  create_trigger(b
-0000f980: 6f64 793d 7472 6967 6765 725f 6465 6669  ody=trigger_defi
-0000f990: 6e69 7469 6f6e 290a 2020 2020 2020 2020  nition).        
-0000f9a0: 666f 7220 7072 6f70 6572 7479 2069 6e20  for property in 
-0000f9b0: 7472 6967 6765 725f 6465 6669 6e69 7469  trigger_definiti
-0000f9c0: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-0000f9d0: 6966 2070 726f 7065 7274 7920 213d 2022  if property != "
-0000f9e0: 7365 7276 6572 5363 7269 7074 223a 0a20  serverScript":. 
-0000f9f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000fa00: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000fa10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fa20: 2020 2020 2074 7269 6767 6572 5b70 726f       trigger[pro
-0000fa30: 7065 7274 795d 2c0a 2020 2020 2020 2020  perty],.        
-0000fa40: 2020 2020 2020 2020 2020 2020 7472 6967              trig
-0000fa50: 6765 725f 6465 6669 6e69 7469 6f6e 5b70  ger_definition[p
-0000fa60: 726f 7065 7274 795d 2c0a 2020 2020 2020  roperty],.      
-0000fa70: 2020 2020 2020 2020 2020 2020 2020 2770                'p
-0000fa80: 726f 7065 7274 7920 7b70 726f 7065 7274  roperty {propert
-0000fa90: 797d 2073 686f 756c 6420 6d61 7463 6827  y} should match'
-0000faa0: 2e66 6f72 6d61 7428 7072 6f70 6572 7479  .format(property
-0000fab0: 3d70 726f 7065 7274 7929 290a 2020 2020  =property)).    
-0000fac0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000fad0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000fae0: 6c66 2e61 7373 6572 7445 7175 616c 2874  lf.assertEqual(t
-0000faf0: 7269 6767 6572 5b27 626f 6479 275d 2c0a  rigger['body'],.
-0000fb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb20: 2027 6675 6e63 7469 6f6e 2829 207b 7661   'function() {va
-0000fb30: 7220 7820 3d20 3130 3b7d 2729 0a0a 2020  r x = 10;}')..  
-0000fb40: 2020 2020 2020 2320 7265 6164 2074 7269        # read tri
-0000fb50: 6767 6572 7320 6166 7465 7220 6372 6561  ggers after crea
-0000fb60: 7469 6f6e 0a20 2020 2020 2020 2074 7269  tion.        tri
-0000fb70: 6767 6572 7320 3d20 5b74 7269 6767 6572  ggers = [trigger
-0000fb80: 2061 7379 6e63 2066 6f72 2074 7269 6767   async for trigg
-0000fb90: 6572 2069 6e20 636f 6c6c 6563 7469 6f6e  er in collection
-0000fba0: 2e73 6372 6970 7473 2e6c 6973 745f 7472  .scripts.list_tr
-0000fbb0: 6967 6765 7273 2829 5d0a 2020 2020 2020  iggers()].      
-0000fbc0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000fbd0: 616c 286c 656e 2874 7269 6767 6572 7329  al(len(triggers)
-0000fbe0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000fbf0: 2020 2020 2020 2020 2020 2062 6566 6f72             befor
-0000fc00: 655f 6372 6561 7465 5f74 7269 6767 6572  e_create_trigger
-0000fc10: 735f 636f 756e 7420 2b20 312c 0a20 2020  s_count + 1,.   
-0000fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc30: 2020 2020 2020 2763 7265 6174 6520 7368        'create sh
-0000fc40: 6f75 6c64 2069 6e63 7265 6173 6520 7468  ould increase th
-0000fc50: 6520 6e75 6d62 6572 206f 6620 7472 6967  e number of trig
-0000fc60: 6765 7273 2729 0a20 2020 2020 2020 2023  gers').        #
-0000fc70: 2071 7565 7279 2074 7269 6767 6572 730a   query triggers.
-0000fc80: 2020 2020 2020 2020 7472 6967 6765 7273          triggers
-0000fc90: 203d 205b 7472 6967 6765 7220 6173 796e   = [trigger asyn
-0000fca0: 6320 666f 7220 7472 6967 6765 7220 696e  c for trigger in
-0000fcb0: 2063 6f6c 6c65 6374 696f 6e2e 7363 7269   collection.scri
-0000fcc0: 7074 732e 7175 6572 795f 7472 6967 6765  pts.query_trigge
-0000fcd0: 7273 280a 2020 2020 2020 2020 2020 2020  rs(.            
-0000fce0: 7175 6572 793d 2753 454c 4543 5420 2a20  query='SELECT * 
-0000fcf0: 4652 4f4d 2072 6f6f 7420 7220 5748 4552  FROM root r WHER
-0000fd00: 4520 722e 6964 3d40 6964 272c 0a20 2020  E r.id=@id',.   
-0000fd10: 2020 2020 2020 2020 2070 6172 616d 6574           paramet
-0000fd20: 6572 733d 5b0a 2020 2020 2020 2020 2020  ers=[.          
-0000fd30: 2020 2020 2020 7b27 6e61 6d65 273a 2027        {'name': '
-0000fd40: 4069 6427 2c20 2776 616c 7565 273a 2074  @id', 'value': t
-0000fd50: 7269 6767 6572 5f64 6566 696e 6974 696f  rigger_definitio
-0000fd60: 6e5b 2769 6427 5d7d 0a20 2020 2020 2020  n['id']}.       
-0000fd70: 2020 2020 205d 0a20 2020 2020 2020 2029       ].        )
-0000fd80: 5d0a 2020 2020 2020 2020 7365 6c66 2e61  ].        self.a
-0000fd90: 7373 6572 7454 7275 6528 7472 6967 6765  ssertTrue(trigge
-0000fda0: 7273 290a 0a20 2020 2020 2020 2023 2072  rs)..        # r
-0000fdb0: 6570 6c61 6365 2074 7269 6767 6572 0a20  eplace trigger. 
-0000fdc0: 2020 2020 2020 2063 6861 6e67 655f 7472         change_tr
-0000fdd0: 6967 6765 7220 3d20 7472 6967 6765 722e  igger = trigger.
-0000fde0: 636f 7079 2829 0a20 2020 2020 2020 2074  copy().        t
-0000fdf0: 7269 6767 6572 5b27 626f 6479 275d 203d  rigger['body'] =
-0000fe00: 2027 6675 6e63 7469 6f6e 2829 207b 7661   'function() {va
-0000fe10: 7220 7820 3d20 3230 3b7d 270a 2020 2020  r x = 20;}'.    
-0000fe20: 2020 2020 7265 706c 6163 6564 5f74 7269      replaced_tri
-0000fe30: 6767 6572 203d 2061 7761 6974 2063 6f6c  gger = await col
-0000fe40: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
-0000fe50: 7265 706c 6163 655f 7472 6967 6765 7228  replace_trigger(
-0000fe60: 6368 616e 6765 5f74 7269 6767 6572 5b27  change_trigger['
-0000fe70: 6964 275d 2c20 7472 6967 6765 7229 0a20  id'], trigger). 
-0000fe80: 2020 2020 2020 2066 6f72 2070 726f 7065         for prope
-0000fe90: 7274 7920 696e 2074 7269 6767 6572 5f64  rty in trigger_d
-0000fea0: 6566 696e 6974 696f 6e3a 0a20 2020 2020  efinition:.     
-0000feb0: 2020 2020 2020 2069 6620 7072 6f70 6572         if proper
-0000fec0: 7479 2021 3d20 2273 6572 7665 7253 6372  ty != "serverScr
-0000fed0: 6970 7422 3a0a 2020 2020 2020 2020 2020  ipt":.          
-0000fee0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000fef0: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-0000ff00: 2020 2020 2020 2020 2020 2020 7265 706c              repl
-0000ff10: 6163 6564 5f74 7269 6767 6572 5b70 726f  aced_trigger[pro
-0000ff20: 7065 7274 795d 2c0a 2020 2020 2020 2020  perty],.        
-0000ff30: 2020 2020 2020 2020 2020 2020 7472 6967              trig
-0000ff40: 6765 725b 7072 6f70 6572 7479 5d2c 0a20  ger[property],. 
-0000ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff60: 2020 2027 7072 6f70 6572 7479 207b 7072     'property {pr
-0000ff70: 6f70 6572 7479 7d20 7368 6f75 6c64 206d  operty} should m
-0000ff80: 6174 6368 272e 666f 726d 6174 2870 726f  atch'.format(pro
-0000ff90: 7065 7274 793d 7072 6f70 6572 7479 2929  perty=property))
-0000ffa0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000ffb0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000ffc0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000ffd0: 7561 6c28 7265 706c 6163 6564 5f74 7269  ual(replaced_tri
-0000ffe0: 6767 6572 5b27 626f 6479 275d 2c0a 2020  gger['body'],.  
-0000fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010000: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00010010: 6675 6e63 7469 6f6e 2829 207b 7661 7220  function() {var 
-00010020: 7820 3d20 3230 3b7d 2729 0a0a 2020 2020  x = 20;}')..    
-00010030: 2020 2020 2320 7265 6164 2074 7269 6767      # read trigg
-00010040: 6572 0a20 2020 2020 2020 2074 7269 6767  er.        trigg
-00010050: 6572 203d 2061 7761 6974 2063 6f6c 6c65  er = await colle
-00010060: 6374 696f 6e2e 7363 7269 7074 732e 6765  ction.scripts.ge
-00010070: 745f 7472 6967 6765 7228 7265 706c 6163  t_trigger(replac
-00010080: 6564 5f74 7269 6767 6572 5b27 6964 275d  ed_trigger['id']
-00010090: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000100a0: 7373 6572 7445 7175 616c 2872 6570 6c61  ssertEqual(repla
-000100b0: 6365 645f 7472 6967 6765 725b 2769 6427  ced_trigger['id'
-000100c0: 5d2c 2074 7269 6767 6572 5b27 6964 275d  ], trigger['id']
-000100d0: 290a 2020 2020 2020 2020 2320 6465 6c65  ).        # dele
-000100e0: 7465 2074 7269 6767 6572 0a20 2020 2020  te trigger.     
-000100f0: 2020 2061 7761 6974 2063 6f6c 6c65 6374     await collect
-00010100: 696f 6e2e 7363 7269 7074 732e 6465 6c65  ion.scripts.dele
-00010110: 7465 5f74 7269 6767 6572 2872 6570 6c61  te_trigger(repla
-00010120: 6365 645f 7472 6967 6765 725b 2769 6427  ced_trigger['id'
-00010130: 5d29 0a20 2020 2020 2020 2023 2072 6561  ]).        # rea
-00010140: 6420 7472 6967 6765 7273 2061 6674 6572  d triggers after
-00010150: 2064 656c 6574 696f 6e0a 2020 2020 2020   deletion.      
-00010160: 2020 6177 6169 7420 7365 6c66 2e5f 5f41    await self.__A
-00010170: 7373 6572 7448 5454 5046 6169 6c75 7265  ssertHTTPFailure
-00010180: 5769 7468 5374 6174 7573 2853 7461 7475  WithStatus(Statu
-00010190: 7343 6f64 6573 2e4e 4f54 5f46 4f55 4e44  sCodes.NOT_FOUND
-000101a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000101b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2d0: 2020 2020 2020 2020 2020 2064 6f63 4964             docId
+0000f2e0: 2c20 646f 6349 6429 0a0a 2020 2020 2020  , docId)..      
+0000f2f0: 2020 2020 2020 7265 736f 7572 6365 5f74        resource_t
+0000f300: 6f6b 656e 7320 3d20 7b22 6462 732f 2220  okens = {"dbs/" 
+0000f310: 2b20 656e 7469 7469 6573 5b27 6462 275d  + entities['db']
+0000f320: 2e69 6420 2b20 222f 636f 6c6c 732f 2220  .id + "/colls/" 
+0000f330: 2b20 656e 7469 7469 6573 5b27 636f 6c6c  + entities['coll
+0000f340: 275d 2e69 6420 2b20 222f 646f 6373 2f22  '].id + "/docs/"
+0000f350: 202b 2064 6f63 4964 3a0a 2020 2020 2020   + docId:.      
+0000f360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f370: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
+0000f380: 6974 6965 735b 2770 6572 6d69 7373 696f  ities['permissio
+0000f390: 6e4f 6e44 6f63 275d 2e70 726f 7065 7274  nOnDoc'].propert
+0000f3a0: 6965 735b 275f 746f 6b65 6e27 5d7d 0a0a  ies['_token']}..
+0000f3b0: 2020 2020 2020 2020 6173 796e 6320 7769          async wi
+0000f3c0: 7468 2043 6f73 6d6f 7343 6c69 656e 7428  th CosmosClient(
+0000f3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f3e0: 2043 5255 4454 6573 7473 2e68 6f73 742c   CRUDTests.host,
+0000f3f0: 2072 6573 6f75 7263 655f 746f 6b65 6e73   resource_tokens
+0000f400: 2c20 636f 6e73 6973 7465 6e63 795f 6c65  , consistency_le
+0000f410: 7665 6c3d 2253 6573 7369 6f6e 222c 2063  vel="Session", c
+0000f420: 6f6e 6e65 6374 696f 6e5f 706f 6c69 6379  onnection_policy
+0000f430: 3d43 5255 4454 6573 7473 2e63 6f6e 6e65  =CRUDTests.conne
+0000f440: 6374 696f 6e50 6f6c 6963 7929 2061 7320  ctionPolicy) as 
+0000f450: 646f 635f 636c 6965 6e74 3a0a 0a20 2020  doc_client:..   
+0000f460: 2020 2020 2020 2020 2023 2036 2e20 5375           # 6. Su
+0000f470: 6363 6573 732d 2d20 5573 6520 446f 6320  ccess-- Use Doc 
+0000f480: 7065 726d 6973 7369 6f6e 2074 6f20 7265  permission to re
+0000f490: 6164 2064 6f63 0a20 2020 2020 2020 2020  ad doc.         
+0000f4a0: 2020 2072 6561 645f 646f 6320 3d20 6177     read_doc = aw
+0000f4b0: 6169 7420 646f 635f 636c 6965 6e74 2e67  ait doc_client.g
+0000f4c0: 6574 5f64 6174 6162 6173 655f 636c 6965  et_database_clie
+0000f4d0: 6e74 2864 622e 6964 292e 6765 745f 636f  nt(db.id).get_co
+0000f4e0: 6e74 6169 6e65 725f 636c 6965 6e74 2873  ntainer_client(s
+0000f4f0: 7563 6365 7373 5f63 6f6c 6c2e 6964 292e  uccess_coll.id).
+0000f500: 7265 6164 5f69 7465 6d28 646f 6349 642c  read_item(docId,
+0000f510: 2064 6f63 4964 290a 2020 2020 2020 2020   docId).        
+0000f520: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000f530: 7175 616c 2872 6561 645f 646f 635b 2269  qual(read_doc["i
+0000f540: 6422 5d2c 2064 6f63 4964 290a 0a20 2020  d"], docId)..   
+0000f550: 2020 2020 2020 2020 2023 2036 2e20 5375           # 6. Su
+0000f560: 6363 6573 732d 2d20 5573 6520 446f 6320  ccess-- Use Doc 
+0000f570: 7065 726d 6973 7369 6f6e 2074 6f20 6465  permission to de
+0000f580: 6c65 7465 2064 6f63 0a20 2020 2020 2020  lete doc.       
+0000f590: 2020 2020 2061 7761 6974 2064 6f63 5f63       await doc_c
+0000f5a0: 6c69 656e 742e 6765 745f 6461 7461 6261  lient.get_databa
+0000f5b0: 7365 5f63 6c69 656e 7428 6462 2e69 6429  se_client(db.id)
+0000f5c0: 2e67 6574 5f63 6f6e 7461 696e 6572 5f63  .get_container_c
+0000f5d0: 6c69 656e 7428 7375 6363 6573 735f 636f  lient(success_co
+0000f5e0: 6c6c 2e69 6429 2e64 656c 6574 655f 6974  ll.id).delete_it
+0000f5f0: 656d 2864 6f63 4964 2c20 646f 6349 6429  em(docId, docId)
+0000f600: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f610: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+0000f620: 6164 5f64 6f63 5b22 6964 225d 2c20 646f  ad_doc["id"], do
+0000f630: 6349 6429 0a0a 2020 2020 2020 2020 2020  cId)..          
+0000f640: 2020 6462 2e63 6c69 656e 745f 636f 6e6e    db.client_conn
+0000f650: 6563 7469 6f6e 203d 206f 6c64 5f63 6c69  ection = old_cli
+0000f660: 656e 745f 636f 6e6e 6563 7469 6f6e 0a20  ent_connection. 
+0000f670: 2020 2020 2020 2020 2020 2061 7761 6974             await
+0000f680: 2064 622e 6465 6c65 7465 5f63 6f6e 7461   db.delete_conta
+0000f690: 696e 6572 2865 6e74 6974 6965 735b 2763  iner(entities['c
+0000f6a0: 6f6c 6c27 5d29 0a0a 2020 2020 6173 796e  oll'])..    asyn
+0000f6b0: 6320 6465 6620 7465 7374 5f74 7269 6767  c def test_trigg
+0000f6c0: 6572 5f63 7275 6428 7365 6c66 293a 0a20  er_crud(self):. 
+0000f6d0: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+0000f6e0: 6461 7461 6261 7365 0a20 2020 2020 2020  database.       
+0000f6f0: 2064 6220 3d20 7365 6c66 2e64 6174 6162   db = self.datab
+0000f700: 6173 6546 6f72 5465 7374 0a20 2020 2020  aseForTest.     
+0000f710: 2020 2023 2063 7265 6174 6520 636f 6c6c     # create coll
+0000f720: 6563 7469 6f6e 0a20 2020 2020 2020 2063  ection.        c
+0000f730: 6f6c 6c65 6374 696f 6e20 3d20 6177 6169  ollection = awai
+0000f740: 7420 7365 6c66 2e64 6174 6162 6173 6546  t self.databaseF
+0000f750: 6f72 5465 7374 2e63 7265 6174 655f 636f  orTest.create_co
+0000f760: 6e74 6169 6e65 7228 7465 7374 5f63 6f6e  ntainer(test_con
+0000f770: 6669 672e 5f74 6573 745f 636f 6e66 6967  fig._test_config
+0000f780: 2e54 4553 545f 434f 4c4c 4543 5449 4f4e  .TEST_COLLECTION
+0000f790: 5f4d 554c 5449 5f50 4152 5449 5449 4f4e  _MULTI_PARTITION
+0000f7a0: 290a 2020 2020 2020 2020 2320 7265 6164  ).        # read
+0000f7b0: 2074 7269 6767 6572 730a 2020 2020 2020   triggers.      
+0000f7c0: 2020 7472 6967 6765 7273 203d 205b 7472    triggers = [tr
+0000f7d0: 6967 6765 7220 6173 796e 6320 666f 7220  igger async for 
+0000f7e0: 7472 6967 6765 7220 696e 2063 6f6c 6c65  trigger in colle
+0000f7f0: 6374 696f 6e2e 7363 7269 7074 732e 6c69  ction.scripts.li
+0000f800: 7374 5f74 7269 6767 6572 7328 295d 0a20  st_triggers()]. 
+0000f810: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+0000f820: 6120 7472 6967 6765 720a 2020 2020 2020  a trigger.      
+0000f830: 2020 6265 666f 7265 5f63 7265 6174 655f    before_create_
+0000f840: 7472 6967 6765 7273 5f63 6f75 6e74 203d  triggers_count =
+0000f850: 206c 656e 2874 7269 6767 6572 7329 0a20   len(triggers). 
+0000f860: 2020 2020 2020 2074 7269 6767 6572 5f64         trigger_d
+0000f870: 6566 696e 6974 696f 6e20 3d20 7b0a 2020  efinition = {.  
+0000f880: 2020 2020 2020 2020 2020 2769 6427 3a20            'id': 
+0000f890: 2773 616d 706c 6520 7472 6967 6765 7227  'sample trigger'
+0000f8a0: 2c0a 2020 2020 2020 2020 2020 2020 2773  ,.            's
+0000f8b0: 6572 7665 7253 6372 6970 7427 3a20 2766  erverScript': 'f
+0000f8c0: 756e 6374 696f 6e28 2920 7b76 6172 2078  unction() {var x
+0000f8d0: 203d 2031 303b 7d27 2c0a 2020 2020 2020   = 10;}',.      
+0000f8e0: 2020 2020 2020 2774 7269 6767 6572 5479        'triggerTy
+0000f8f0: 7065 273a 2064 6f63 756d 656e 7473 2e54  pe': documents.T
+0000f900: 7269 6767 6572 5479 7065 2e50 7265 2c0a  riggerType.Pre,.
+0000f910: 2020 2020 2020 2020 2020 2020 2774 7269              'tri
+0000f920: 6767 6572 4f70 6572 6174 696f 6e27 3a20  ggerOperation': 
+0000f930: 646f 6375 6d65 6e74 732e 5472 6967 6765  documents.Trigge
+0000f940: 724f 7065 7261 7469 6f6e 2e41 6c6c 0a20  rOperation.All. 
+0000f950: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0000f960: 2074 7269 6767 6572 203d 2061 7761 6974   trigger = await
+0000f970: 2063 6f6c 6c65 6374 696f 6e2e 7363 7269   collection.scri
+0000f980: 7074 732e 6372 6561 7465 5f74 7269 6767  pts.create_trigg
+0000f990: 6572 2862 6f64 793d 7472 6967 6765 725f  er(body=trigger_
+0000f9a0: 6465 6669 6e69 7469 6f6e 290a 2020 2020  definition).    
+0000f9b0: 2020 2020 666f 7220 7072 6f70 6572 7479      for property
+0000f9c0: 2069 6e20 7472 6967 6765 725f 6465 6669   in trigger_defi
+0000f9d0: 6e69 7469 6f6e 3a0a 2020 2020 2020 2020  nition:.        
+0000f9e0: 2020 2020 6966 2070 726f 7065 7274 7920      if property 
+0000f9f0: 213d 2022 7365 7276 6572 5363 7269 7074  != "serverScript
+0000fa00: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000fa10: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000fa20: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+0000fa30: 2020 2020 2020 2020 2074 7269 6767 6572           trigger
+0000fa40: 5b70 726f 7065 7274 795d 2c0a 2020 2020  [property],.    
+0000fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa60: 7472 6967 6765 725f 6465 6669 6e69 7469  trigger_definiti
+0000fa70: 6f6e 5b70 726f 7065 7274 795d 2c0a 2020  on[property],.  
+0000fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa90: 2020 2770 726f 7065 7274 7920 7b70 726f    'property {pro
+0000faa0: 7065 7274 797d 2073 686f 756c 6420 6d61  perty} should ma
+0000fab0: 7463 6827 2e66 6f72 6d61 7428 7072 6f70  tch'.format(prop
+0000fac0: 6572 7479 3d70 726f 7065 7274 7929 290a  erty=property)).
+0000fad0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000fae0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000faf0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000fb00: 616c 2874 7269 6767 6572 5b27 626f 6479  al(trigger['body
+0000fb10: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+0000fb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb30: 2020 2020 2027 6675 6e63 7469 6f6e 2829       'function()
+0000fb40: 207b 7661 7220 7820 3d20 3130 3b7d 2729   {var x = 10;}')
+0000fb50: 0a0a 2020 2020 2020 2020 2320 7265 6164  ..        # read
+0000fb60: 2074 7269 6767 6572 7320 6166 7465 7220   triggers after 
+0000fb70: 6372 6561 7469 6f6e 0a20 2020 2020 2020  creation.       
+0000fb80: 2074 7269 6767 6572 7320 3d20 5b74 7269   triggers = [tri
+0000fb90: 6767 6572 2061 7379 6e63 2066 6f72 2074  gger async for t
+0000fba0: 7269 6767 6572 2069 6e20 636f 6c6c 6563  rigger in collec
+0000fbb0: 7469 6f6e 2e73 6372 6970 7473 2e6c 6973  tion.scripts.lis
+0000fbc0: 745f 7472 6967 6765 7273 2829 5d0a 2020  t_triggers()].  
+0000fbd0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000fbe0: 7445 7175 616c 286c 656e 2874 7269 6767  tEqual(len(trigg
+0000fbf0: 6572 7329 2c0a 2020 2020 2020 2020 2020  ers),.          
+0000fc00: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000fc10: 6566 6f72 655f 6372 6561 7465 5f74 7269  efore_create_tri
+0000fc20: 6767 6572 735f 636f 756e 7420 2b20 312c  ggers_count + 1,
+0000fc30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fc40: 2020 2020 2020 2020 2020 2763 7265 6174            'creat
+0000fc50: 6520 7368 6f75 6c64 2069 6e63 7265 6173  e should increas
+0000fc60: 6520 7468 6520 6e75 6d62 6572 206f 6620  e the number of 
+0000fc70: 7472 6967 6765 7273 2729 0a20 2020 2020  triggers').     
+0000fc80: 2020 2023 2071 7565 7279 2074 7269 6767     # query trigg
+0000fc90: 6572 730a 2020 2020 2020 2020 7472 6967  ers.        trig
+0000fca0: 6765 7273 203d 205b 7472 6967 6765 7220  gers = [trigger 
+0000fcb0: 6173 796e 6320 666f 7220 7472 6967 6765  async for trigge
+0000fcc0: 7220 696e 2063 6f6c 6c65 6374 696f 6e2e  r in collection.
+0000fcd0: 7363 7269 7074 732e 7175 6572 795f 7472  scripts.query_tr
+0000fce0: 6967 6765 7273 280a 2020 2020 2020 2020  iggers(.        
+0000fcf0: 2020 2020 7175 6572 793d 2753 454c 4543      query='SELEC
+0000fd00: 5420 2a20 4652 4f4d 2072 6f6f 7420 7220  T * FROM root r 
+0000fd10: 5748 4552 4520 722e 6964 3d40 6964 272c  WHERE r.id=@id',
+0000fd20: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+0000fd30: 616d 6574 6572 733d 5b0a 2020 2020 2020  ameters=[.      
+0000fd40: 2020 2020 2020 2020 2020 7b27 6e61 6d65            {'name
+0000fd50: 273a 2027 4069 6427 2c20 2776 616c 7565  ': '@id', 'value
+0000fd60: 273a 2074 7269 6767 6572 5f64 6566 696e  ': trigger_defin
+0000fd70: 6974 696f 6e5b 2769 6427 5d7d 0a20 2020  ition['id']}.   
+0000fd80: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+0000fd90: 2020 2029 5d0a 2020 2020 2020 2020 7365     )].        se
+0000fda0: 6c66 2e61 7373 6572 7454 7275 6528 7472  lf.assertTrue(tr
+0000fdb0: 6967 6765 7273 290a 0a20 2020 2020 2020  iggers)..       
+0000fdc0: 2023 2072 6570 6c61 6365 2074 7269 6767   # replace trigg
+0000fdd0: 6572 0a20 2020 2020 2020 2063 6861 6e67  er.        chang
+0000fde0: 655f 7472 6967 6765 7220 3d20 7472 6967  e_trigger = trig
+0000fdf0: 6765 722e 636f 7079 2829 0a20 2020 2020  ger.copy().     
+0000fe00: 2020 2074 7269 6767 6572 5b27 626f 6479     trigger['body
+0000fe10: 275d 203d 2027 6675 6e63 7469 6f6e 2829  '] = 'function()
+0000fe20: 207b 7661 7220 7820 3d20 3230 3b7d 270a   {var x = 20;}'.
+0000fe30: 2020 2020 2020 2020 7265 706c 6163 6564          replaced
+0000fe40: 5f74 7269 6767 6572 203d 2061 7761 6974  _trigger = await
+0000fe50: 2063 6f6c 6c65 6374 696f 6e2e 7363 7269   collection.scri
+0000fe60: 7074 732e 7265 706c 6163 655f 7472 6967  pts.replace_trig
+0000fe70: 6765 7228 6368 616e 6765 5f74 7269 6767  ger(change_trigg
+0000fe80: 6572 5b27 6964 275d 2c20 7472 6967 6765  er['id'], trigge
+0000fe90: 7229 0a20 2020 2020 2020 2066 6f72 2070  r).        for p
+0000fea0: 726f 7065 7274 7920 696e 2074 7269 6767  roperty in trigg
+0000feb0: 6572 5f64 6566 696e 6974 696f 6e3a 0a20  er_definition:. 
+0000fec0: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
+0000fed0: 6f70 6572 7479 2021 3d20 2273 6572 7665  operty != "serve
+0000fee0: 7253 6372 6970 7422 3a0a 2020 2020 2020  rScript":.      
+0000fef0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000ff00: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+0000ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff20: 7265 706c 6163 6564 5f74 7269 6767 6572  replaced_trigger
+0000ff30: 5b70 726f 7065 7274 795d 2c0a 2020 2020  [property],.    
+0000ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff50: 7472 6967 6765 725b 7072 6f70 6572 7479  trigger[property
+0000ff60: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0000ff70: 2020 2020 2020 2027 7072 6f70 6572 7479         'property
+0000ff80: 207b 7072 6f70 6572 7479 7d20 7368 6f75   {property} shou
+0000ff90: 6c64 206d 6174 6368 272e 666f 726d 6174  ld match'.format
+0000ffa0: 2870 726f 7065 7274 793d 7072 6f70 6572  (property=proper
+0000ffb0: 7479 2929 0a20 2020 2020 2020 2020 2020  ty)).           
+0000ffc0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000ffd0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000ffe0: 7274 4571 7561 6c28 7265 706c 6163 6564  rtEqual(replaced
+0000fff0: 5f74 7269 6767 6572 5b27 626f 6479 275d  _trigger['body']
+00010000: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010020: 2020 2027 6675 6e63 7469 6f6e 2829 207b     'function() {
+00010030: 7661 7220 7820 3d20 3230 3b7d 2729 0a0a  var x = 20;}')..
+00010040: 2020 2020 2020 2020 2320 7265 6164 2074          # read t
+00010050: 7269 6767 6572 0a20 2020 2020 2020 2074  rigger.        t
+00010060: 7269 6767 6572 203d 2061 7761 6974 2063  rigger = await c
+00010070: 6f6c 6c65 6374 696f 6e2e 7363 7269 7074  ollection.script
+00010080: 732e 6765 745f 7472 6967 6765 7228 7265  s.get_trigger(re
+00010090: 706c 6163 6564 5f74 7269 6767 6572 5b27  placed_trigger['
+000100a0: 6964 275d 290a 2020 2020 2020 2020 7365  id']).        se
+000100b0: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+000100c0: 6570 6c61 6365 645f 7472 6967 6765 725b  eplaced_trigger[
+000100d0: 2769 6427 5d2c 2074 7269 6767 6572 5b27  'id'], trigger['
+000100e0: 6964 275d 290a 2020 2020 2020 2020 2320  id']).        # 
+000100f0: 6465 6c65 7465 2074 7269 6767 6572 0a20  delete trigger. 
+00010100: 2020 2020 2020 2061 7761 6974 2063 6f6c         await col
+00010110: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
+00010120: 6465 6c65 7465 5f74 7269 6767 6572 2872  delete_trigger(r
+00010130: 6570 6c61 6365 645f 7472 6967 6765 725b  eplaced_trigger[
+00010140: 2769 6427 5d29 0a20 2020 2020 2020 2023  'id']).        #
+00010150: 2072 6561 6420 7472 6967 6765 7273 2061   read triggers a
+00010160: 6674 6572 2064 656c 6574 696f 6e0a 2020  fter deletion.  
+00010170: 2020 2020 2020 6177 6169 7420 7365 6c66        await self
+00010180: 2e5f 5f41 7373 6572 7448 5454 5046 6169  .__AssertHTTPFai
+00010190: 6c75 7265 5769 7468 5374 6174 7573 2853  lureWithStatus(S
+000101a0: 7461 7475 7343 6f64 6573 2e4e 4f54 5f46  tatusCodes.NOT_F
+000101b0: 4f55 4e44 2c0a 2020 2020 2020 2020 2020  OUND,.          
 000101c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101d0: 2020 2063 6f6c 6c65 6374 696f 6e2e 7363     collection.sc
-000101e0: 7269 7074 732e 6465 6c65 7465 5f74 7269  ripts.delete_tri
-000101f0: 6767 6572 2c0a 2020 2020 2020 2020 2020  gger,.          
-00010200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101e0: 2020 2020 2020 2063 6f6c 6c65 6374 696f         collectio
+000101f0: 6e2e 7363 7269 7074 732e 6465 6c65 7465  n.scripts.delete
+00010200: 5f74 7269 6767 6572 2c0a 2020 2020 2020  _trigger,.      
 00010210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010220: 2020 2020 2020 2072 6570 6c61 6365 645f         replaced_
-00010230: 7472 6967 6765 725b 2769 6427 5d29 0a0a  trigger['id'])..
-00010240: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-00010250: 7374 5f75 6466 5f63 7275 6428 7365 6c66  st_udf_crud(self
-00010260: 293a 0a20 2020 2020 2020 2023 2063 7265  ):.        # cre
-00010270: 6174 6520 6461 7461 6261 7365 0a20 2020  ate database.   
-00010280: 2020 2020 2064 6220 3d20 7365 6c66 2e64       db = self.d
-00010290: 6174 6162 6173 6546 6f72 5465 7374 0a20  atabaseForTest. 
-000102a0: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
-000102b0: 636f 6c6c 6563 7469 6f6e 0a20 2020 2020  collection.     
-000102c0: 2020 2063 6f6c 6c65 6374 696f 6e20 3d20     collection = 
-000102d0: 6177 6169 7420 7365 6c66 2e64 6174 6162  await self.datab
-000102e0: 6173 6546 6f72 5465 7374 2e63 7265 6174  aseForTest.creat
-000102f0: 655f 636f 6e74 6169 6e65 7228 7465 7374  e_container(test
-00010300: 5f63 6f6e 6669 672e 5f74 6573 745f 636f  _config._test_co
-00010310: 6e66 6967 2e54 4553 545f 434f 4c4c 4543  nfig.TEST_COLLEC
-00010320: 5449 4f4e 5f4d 554c 5449 5f50 4152 5449  TION_MULTI_PARTI
-00010330: 5449 4f4e 290a 2020 2020 2020 2020 2320  TION).        # 
-00010340: 7265 6164 2075 6466 730a 2020 2020 2020  read udfs.      
-00010350: 2020 7564 6673 203d 205b 7564 6620 6173    udfs = [udf as
-00010360: 796e 6320 666f 7220 7564 6620 696e 2063  ync for udf in c
-00010370: 6f6c 6c65 6374 696f 6e2e 7363 7269 7074  ollection.script
-00010380: 732e 6c69 7374 5f75 7365 725f 6465 6669  s.list_user_defi
-00010390: 6e65 645f 6675 6e63 7469 6f6e 7328 295d  ned_functions()]
-000103a0: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
-000103b0: 6520 6120 7564 660a 2020 2020 2020 2020  e a udf.        
-000103c0: 6265 666f 7265 5f63 7265 6174 655f 7564  before_create_ud
-000103d0: 6673 5f63 6f75 6e74 203d 206c 656e 2875  fs_count = len(u
-000103e0: 6466 7329 0a20 2020 2020 2020 2075 6466  dfs).        udf
-000103f0: 5f64 6566 696e 6974 696f 6e20 3d20 7b0a  _definition = {.
-00010400: 2020 2020 2020 2020 2020 2020 2769 6427              'id'
-00010410: 3a20 2773 616d 706c 6520 7564 6627 2c0a  : 'sample udf',.
-00010420: 2020 2020 2020 2020 2020 2020 2762 6f64              'bod
-00010430: 7927 3a20 2766 756e 6374 696f 6e28 2920  y': 'function() 
-00010440: 7b76 6172 2078 203d 2031 303b 7d27 0a20  {var x = 10;}'. 
-00010450: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00010460: 2075 6466 203d 2061 7761 6974 2063 6f6c   udf = await col
-00010470: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
-00010480: 6372 6561 7465 5f75 7365 725f 6465 6669  create_user_defi
-00010490: 6e65 645f 6675 6e63 7469 6f6e 2862 6f64  ned_function(bod
-000104a0: 793d 7564 665f 6465 6669 6e69 7469 6f6e  y=udf_definition
-000104b0: 290a 2020 2020 2020 2020 666f 7220 7072  ).        for pr
-000104c0: 6f70 6572 7479 2069 6e20 7564 665f 6465  operty in udf_de
-000104d0: 6669 6e69 7469 6f6e 3a0a 2020 2020 2020  finition:.      
-000104e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000104f0: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-00010500: 2020 2020 2020 2020 7564 665b 7072 6f70          udf[prop
-00010510: 6572 7479 5d2c 0a20 2020 2020 2020 2020  erty],.         
-00010520: 2020 2020 2020 2075 6466 5f64 6566 696e         udf_defin
-00010530: 6974 696f 6e5b 7072 6f70 6572 7479 5d2c  ition[property],
-00010540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010550: 2027 7072 6f70 6572 7479 207b 7072 6f70   'property {prop
-00010560: 6572 7479 7d20 7368 6f75 6c64 206d 6174  erty} should mat
-00010570: 6368 272e 666f 726d 6174 2870 726f 7065  ch'.format(prope
-00010580: 7274 793d 7072 6f70 6572 7479 2929 0a0a  rty=property))..
-00010590: 2020 2020 2020 2020 2320 7265 6164 2075          # read u
-000105a0: 6466 7320 6166 7465 7220 6372 6561 7469  dfs after creati
-000105b0: 6f6e 0a20 2020 2020 2020 2075 6466 7320  on.        udfs 
-000105c0: 3d20 5b75 6466 2061 7379 6e63 2066 6f72  = [udf async for
-000105d0: 2075 6466 2069 6e20 636f 6c6c 6563 7469   udf in collecti
-000105e0: 6f6e 2e73 6372 6970 7473 2e6c 6973 745f  on.scripts.list_
-000105f0: 7573 6572 5f64 6566 696e 6564 5f66 756e  user_defined_fun
-00010600: 6374 696f 6e73 2829 5d0a 2020 2020 2020  ctions()].      
-00010610: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00010620: 616c 286c 656e 2875 6466 7329 2c0a 2020  al(len(udfs),.  
-00010630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010640: 2020 2020 2020 2062 6566 6f72 655f 6372         before_cr
-00010650: 6561 7465 5f75 6466 735f 636f 756e 7420  eate_udfs_count 
-00010660: 2b20 312c 0a20 2020 2020 2020 2020 2020  + 1,.           
-00010670: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-00010680: 7265 6174 6520 7368 6f75 6c64 2069 6e63  reate should inc
-00010690: 7265 6173 6520 7468 6520 6e75 6d62 6572  rease the number
-000106a0: 206f 6620 7564 6673 2729 0a20 2020 2020   of udfs').     
-000106b0: 2020 2023 2071 7565 7279 2075 6466 730a     # query udfs.
-000106c0: 2020 2020 2020 2020 7265 7375 6c74 7320          results 
-000106d0: 3d20 5b75 6466 2061 7379 6e63 2066 6f72  = [udf async for
-000106e0: 2075 6466 2069 6e20 636f 6c6c 6563 7469   udf in collecti
-000106f0: 6f6e 2e73 6372 6970 7473 2e71 7565 7279  on.scripts.query
-00010700: 5f75 7365 725f 6465 6669 6e65 645f 6675  _user_defined_fu
-00010710: 6e63 7469 6f6e 7328 0a20 2020 2020 2020  nctions(.       
-00010720: 2020 2020 2071 7565 7279 3d27 5345 4c45       query='SELE
-00010730: 4354 202a 2046 524f 4d20 726f 6f74 2072  CT * FROM root r
-00010740: 2057 4845 5245 2072 2e69 643d 4069 6427   WHERE r.id=@id'
-00010750: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-00010760: 7261 6d65 7465 7273 3d5b 0a20 2020 2020  rameters=[.     
-00010770: 2020 2020 2020 2020 2020 207b 276e 616d             {'nam
-00010780: 6527 3a20 2740 6964 272c 2027 7661 6c75  e': '@id', 'valu
-00010790: 6527 3a20 7564 665f 6465 6669 6e69 7469  e': udf_definiti
-000107a0: 6f6e 5b27 6964 275d 7d0a 2020 2020 2020  on['id']}.      
-000107b0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-000107c0: 295d 0a20 2020 2020 2020 2073 656c 662e  )].        self.
-000107d0: 6173 7365 7274 5472 7565 2872 6573 756c  assertTrue(resul
-000107e0: 7473 290a 2020 2020 2020 2020 2320 7265  ts).        # re
-000107f0: 706c 6163 6520 7564 660a 2020 2020 2020  place udf.      
-00010800: 2020 6368 616e 6765 5f75 6466 203d 2075    change_udf = u
-00010810: 6466 2e63 6f70 7928 290a 2020 2020 2020  df.copy().      
-00010820: 2020 7564 665b 2762 6f64 7927 5d20 3d20    udf['body'] = 
-00010830: 2766 756e 6374 696f 6e28 2920 7b76 6172  'function() {var
-00010840: 2078 203d 2032 303b 7d27 0a20 2020 2020   x = 20;}'.     
-00010850: 2020 2072 6570 6c61 6365 645f 7564 6620     replaced_udf 
-00010860: 3d20 6177 6169 7420 636f 6c6c 6563 7469  = await collecti
-00010870: 6f6e 2e73 6372 6970 7473 2e72 6570 6c61  on.scripts.repla
-00010880: 6365 5f75 7365 725f 6465 6669 6e65 645f  ce_user_defined_
-00010890: 6675 6e63 7469 6f6e 2875 6466 3d75 6466  function(udf=udf
-000108a0: 5b27 6964 275d 2c20 626f 6479 3d75 6466  ['id'], body=udf
-000108b0: 290a 2020 2020 2020 2020 666f 7220 7072  ).        for pr
-000108c0: 6f70 6572 7479 2069 6e20 7564 665f 6465  operty in udf_de
-000108d0: 6669 6e69 7469 6f6e 3a0a 2020 2020 2020  finition:.      
-000108e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000108f0: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-00010900: 2020 2020 2020 2020 7265 706c 6163 6564          replaced
-00010910: 5f75 6466 5b70 726f 7065 7274 795d 2c0a  _udf[property],.
-00010920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010930: 7564 665b 7072 6f70 6572 7479 5d2c 0a20  udf[property],. 
-00010940: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00010950: 7072 6f70 6572 7479 207b 7072 6f70 6572  property {proper
-00010960: 7479 7d20 7368 6f75 6c64 206d 6174 6368  ty} should match
-00010970: 272e 666f 726d 6174 2870 726f 7065 7274  '.format(propert
-00010980: 793d 7072 6f70 6572 7479 2929 0a20 2020  y=property)).   
-00010990: 2020 2020 2023 2072 6561 6420 7564 660a       # read udf.
-000109a0: 2020 2020 2020 2020 7564 6620 3d20 6177          udf = aw
-000109b0: 6169 7420 636f 6c6c 6563 7469 6f6e 2e73  ait collection.s
-000109c0: 6372 6970 7473 2e67 6574 5f75 7365 725f  cripts.get_user_
-000109d0: 6465 6669 6e65 645f 6675 6e63 7469 6f6e  defined_function
-000109e0: 2872 6570 6c61 6365 645f 7564 665b 2769  (replaced_udf['i
-000109f0: 6427 5d29 0a20 2020 2020 2020 2073 656c  d']).        sel
-00010a00: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-00010a10: 706c 6163 6564 5f75 6466 5b27 6964 275d  placed_udf['id']
-00010a20: 2c20 7564 665b 2769 6427 5d29 0a20 2020  , udf['id']).   
-00010a30: 2020 2020 2023 2064 656c 6574 6520 7564       # delete ud
-00010a40: 660a 2020 2020 2020 2020 6177 6169 7420  f.        await 
-00010a50: 636f 6c6c 6563 7469 6f6e 2e73 6372 6970  collection.scrip
-00010a60: 7473 2e64 656c 6574 655f 7573 6572 5f64  ts.delete_user_d
-00010a70: 6566 696e 6564 5f66 756e 6374 696f 6e28  efined_function(
-00010a80: 7265 706c 6163 6564 5f75 6466 5b27 6964  replaced_udf['id
-00010a90: 275d 290a 2020 2020 2020 2020 2320 7265  ']).        # re
-00010aa0: 6164 2075 6466 7320 6166 7465 7220 6465  ad udfs after de
-00010ab0: 6c65 7469 6f6e 0a20 2020 2020 2020 2061  letion.        a
-00010ac0: 7761 6974 2073 656c 662e 5f5f 4173 7365  wait self.__Asse
-00010ad0: 7274 4854 5450 4661 696c 7572 6557 6974  rtHTTPFailureWit
-00010ae0: 6853 7461 7475 7328 5374 6174 7573 436f  hStatus(StatusCo
-00010af0: 6465 732e 4e4f 545f 464f 554e 442c 0a20  des.NOT_FOUND,. 
-00010b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010230: 2020 2020 2020 2020 2020 2072 6570 6c61             repla
+00010240: 6365 645f 7472 6967 6765 725b 2769 6427  ced_trigger['id'
+00010250: 5d29 0a0a 2020 2020 6173 796e 6320 6465  ])..    async de
+00010260: 6620 7465 7374 5f75 6466 5f63 7275 6428  f test_udf_crud(
+00010270: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
+00010280: 2063 7265 6174 6520 6461 7461 6261 7365   create database
+00010290: 0a20 2020 2020 2020 2064 6220 3d20 7365  .        db = se
+000102a0: 6c66 2e64 6174 6162 6173 6546 6f72 5465  lf.databaseForTe
+000102b0: 7374 0a20 2020 2020 2020 2023 2063 7265  st.        # cre
+000102c0: 6174 6520 636f 6c6c 6563 7469 6f6e 0a20  ate collection. 
+000102d0: 2020 2020 2020 2063 6f6c 6c65 6374 696f         collectio
+000102e0: 6e20 3d20 6177 6169 7420 7365 6c66 2e64  n = await self.d
+000102f0: 6174 6162 6173 6546 6f72 5465 7374 2e63  atabaseForTest.c
+00010300: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
+00010310: 7465 7374 5f63 6f6e 6669 672e 5f74 6573  test_config._tes
+00010320: 745f 636f 6e66 6967 2e54 4553 545f 434f  t_config.TEST_CO
+00010330: 4c4c 4543 5449 4f4e 5f4d 554c 5449 5f50  LLECTION_MULTI_P
+00010340: 4152 5449 5449 4f4e 290a 2020 2020 2020  ARTITION).      
+00010350: 2020 2320 7265 6164 2075 6466 730a 2020    # read udfs.  
+00010360: 2020 2020 2020 7564 6673 203d 205b 7564        udfs = [ud
+00010370: 6620 6173 796e 6320 666f 7220 7564 6620  f async for udf 
+00010380: 696e 2063 6f6c 6c65 6374 696f 6e2e 7363  in collection.sc
+00010390: 7269 7074 732e 6c69 7374 5f75 7365 725f  ripts.list_user_
+000103a0: 6465 6669 6e65 645f 6675 6e63 7469 6f6e  defined_function
+000103b0: 7328 295d 0a20 2020 2020 2020 2023 2063  s()].        # c
+000103c0: 7265 6174 6520 6120 7564 660a 2020 2020  reate a udf.    
+000103d0: 2020 2020 6265 666f 7265 5f63 7265 6174      before_creat
+000103e0: 655f 7564 6673 5f63 6f75 6e74 203d 206c  e_udfs_count = l
+000103f0: 656e 2875 6466 7329 0a20 2020 2020 2020  en(udfs).       
+00010400: 2075 6466 5f64 6566 696e 6974 696f 6e20   udf_definition 
+00010410: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00010420: 2769 6427 3a20 2773 616d 706c 6520 7564  'id': 'sample ud
+00010430: 6627 2c0a 2020 2020 2020 2020 2020 2020  f',.            
+00010440: 2762 6f64 7927 3a20 2766 756e 6374 696f  'body': 'functio
+00010450: 6e28 2920 7b76 6172 2078 203d 2031 303b  n() {var x = 10;
+00010460: 7d27 0a20 2020 2020 2020 207d 0a20 2020  }'.        }.   
+00010470: 2020 2020 2075 6466 203d 2061 7761 6974       udf = await
+00010480: 2063 6f6c 6c65 6374 696f 6e2e 7363 7269   collection.scri
+00010490: 7074 732e 6372 6561 7465 5f75 7365 725f  pts.create_user_
+000104a0: 6465 6669 6e65 645f 6675 6e63 7469 6f6e  defined_function
+000104b0: 2862 6f64 793d 7564 665f 6465 6669 6e69  (body=udf_defini
+000104c0: 7469 6f6e 290a 2020 2020 2020 2020 666f  tion).        fo
+000104d0: 7220 7072 6f70 6572 7479 2069 6e20 7564  r property in ud
+000104e0: 665f 6465 6669 6e69 7469 6f6e 3a0a 2020  f_definition:.  
+000104f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00010500: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00010510: 2020 2020 2020 2020 2020 2020 7564 665b              udf[
+00010520: 7072 6f70 6572 7479 5d2c 0a20 2020 2020  property],.     
+00010530: 2020 2020 2020 2020 2020 2075 6466 5f64             udf_d
+00010540: 6566 696e 6974 696f 6e5b 7072 6f70 6572  efinition[proper
+00010550: 7479 5d2c 0a20 2020 2020 2020 2020 2020  ty],.           
+00010560: 2020 2020 2027 7072 6f70 6572 7479 207b       'property {
+00010570: 7072 6f70 6572 7479 7d20 7368 6f75 6c64  property} should
+00010580: 206d 6174 6368 272e 666f 726d 6174 2870   match'.format(p
+00010590: 726f 7065 7274 793d 7072 6f70 6572 7479  roperty=property
+000105a0: 2929 0a0a 2020 2020 2020 2020 2320 7265  ))..        # re
+000105b0: 6164 2075 6466 7320 6166 7465 7220 6372  ad udfs after cr
+000105c0: 6561 7469 6f6e 0a20 2020 2020 2020 2075  eation.        u
+000105d0: 6466 7320 3d20 5b75 6466 2061 7379 6e63  dfs = [udf async
+000105e0: 2066 6f72 2075 6466 2069 6e20 636f 6c6c   for udf in coll
+000105f0: 6563 7469 6f6e 2e73 6372 6970 7473 2e6c  ection.scripts.l
+00010600: 6973 745f 7573 6572 5f64 6566 696e 6564  ist_user_defined
+00010610: 5f66 756e 6374 696f 6e73 2829 5d0a 2020  _functions()].  
+00010620: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00010630: 7445 7175 616c 286c 656e 2875 6466 7329  tEqual(len(udfs)
+00010640: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010650: 2020 2020 2020 2020 2020 2062 6566 6f72             befor
+00010660: 655f 6372 6561 7465 5f75 6466 735f 636f  e_create_udfs_co
+00010670: 756e 7420 2b20 312c 0a20 2020 2020 2020  unt + 1,.       
+00010680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010690: 2020 2763 7265 6174 6520 7368 6f75 6c64    'create should
+000106a0: 2069 6e63 7265 6173 6520 7468 6520 6e75   increase the nu
+000106b0: 6d62 6572 206f 6620 7564 6673 2729 0a20  mber of udfs'). 
+000106c0: 2020 2020 2020 2023 2071 7565 7279 2075         # query u
+000106d0: 6466 730a 2020 2020 2020 2020 7265 7375  dfs.        resu
+000106e0: 6c74 7320 3d20 5b75 6466 2061 7379 6e63  lts = [udf async
+000106f0: 2066 6f72 2075 6466 2069 6e20 636f 6c6c   for udf in coll
+00010700: 6563 7469 6f6e 2e73 6372 6970 7473 2e71  ection.scripts.q
+00010710: 7565 7279 5f75 7365 725f 6465 6669 6e65  uery_user_define
+00010720: 645f 6675 6e63 7469 6f6e 7328 0a20 2020  d_functions(.   
+00010730: 2020 2020 2020 2020 2071 7565 7279 3d27           query='
+00010740: 5345 4c45 4354 202a 2046 524f 4d20 726f  SELECT * FROM ro
+00010750: 6f74 2072 2057 4845 5245 2072 2e69 643d  ot r WHERE r.id=
+00010760: 4069 6427 2c0a 2020 2020 2020 2020 2020  @id',.          
+00010770: 2020 7061 7261 6d65 7465 7273 3d5b 0a20    parameters=[. 
+00010780: 2020 2020 2020 2020 2020 2020 2020 207b                 {
+00010790: 276e 616d 6527 3a20 2740 6964 272c 2027  'name': '@id', '
+000107a0: 7661 6c75 6527 3a20 7564 665f 6465 6669  value': udf_defi
+000107b0: 6e69 7469 6f6e 5b27 6964 275d 7d0a 2020  nition['id']}.  
+000107c0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+000107d0: 2020 2020 295d 0a20 2020 2020 2020 2073      )].        s
+000107e0: 656c 662e 6173 7365 7274 5472 7565 2872  elf.assertTrue(r
+000107f0: 6573 756c 7473 290a 2020 2020 2020 2020  esults).        
+00010800: 2320 7265 706c 6163 6520 7564 660a 2020  # replace udf.  
+00010810: 2020 2020 2020 6368 616e 6765 5f75 6466        change_udf
+00010820: 203d 2075 6466 2e63 6f70 7928 290a 2020   = udf.copy().  
+00010830: 2020 2020 2020 7564 665b 2762 6f64 7927        udf['body'
+00010840: 5d20 3d20 2766 756e 6374 696f 6e28 2920  ] = 'function() 
+00010850: 7b76 6172 2078 203d 2032 303b 7d27 0a20  {var x = 20;}'. 
+00010860: 2020 2020 2020 2072 6570 6c61 6365 645f         replaced_
+00010870: 7564 6620 3d20 6177 6169 7420 636f 6c6c  udf = await coll
+00010880: 6563 7469 6f6e 2e73 6372 6970 7473 2e72  ection.scripts.r
+00010890: 6570 6c61 6365 5f75 7365 725f 6465 6669  eplace_user_defi
+000108a0: 6e65 645f 6675 6e63 7469 6f6e 2875 6466  ned_function(udf
+000108b0: 3d75 6466 5b27 6964 275d 2c20 626f 6479  =udf['id'], body
+000108c0: 3d75 6466 290a 2020 2020 2020 2020 666f  =udf).        fo
+000108d0: 7220 7072 6f70 6572 7479 2069 6e20 7564  r property in ud
+000108e0: 665f 6465 6669 6e69 7469 6f6e 3a0a 2020  f_definition:.  
+000108f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00010900: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00010910: 2020 2020 2020 2020 2020 2020 7265 706c              repl
+00010920: 6163 6564 5f75 6466 5b70 726f 7065 7274  aced_udf[propert
+00010930: 795d 2c0a 2020 2020 2020 2020 2020 2020  y],.            
+00010940: 2020 2020 7564 665b 7072 6f70 6572 7479      udf[property
+00010950: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00010960: 2020 2027 7072 6f70 6572 7479 207b 7072     'property {pr
+00010970: 6f70 6572 7479 7d20 7368 6f75 6c64 206d  operty} should m
+00010980: 6174 6368 272e 666f 726d 6174 2870 726f  atch'.format(pro
+00010990: 7065 7274 793d 7072 6f70 6572 7479 2929  perty=property))
+000109a0: 0a20 2020 2020 2020 2023 2072 6561 6420  .        # read 
+000109b0: 7564 660a 2020 2020 2020 2020 7564 6620  udf.        udf 
+000109c0: 3d20 6177 6169 7420 636f 6c6c 6563 7469  = await collecti
+000109d0: 6f6e 2e73 6372 6970 7473 2e67 6574 5f75  on.scripts.get_u
+000109e0: 7365 725f 6465 6669 6e65 645f 6675 6e63  ser_defined_func
+000109f0: 7469 6f6e 2872 6570 6c61 6365 645f 7564  tion(replaced_ud
+00010a00: 665b 2769 6427 5d29 0a20 2020 2020 2020  f['id']).       
+00010a10: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00010a20: 6c28 7265 706c 6163 6564 5f75 6466 5b27  l(replaced_udf['
+00010a30: 6964 275d 2c20 7564 665b 2769 6427 5d29  id'], udf['id'])
+00010a40: 0a20 2020 2020 2020 2023 2064 656c 6574  .        # delet
+00010a50: 6520 7564 660a 2020 2020 2020 2020 6177  e udf.        aw
+00010a60: 6169 7420 636f 6c6c 6563 7469 6f6e 2e73  ait collection.s
+00010a70: 6372 6970 7473 2e64 656c 6574 655f 7573  cripts.delete_us
+00010a80: 6572 5f64 6566 696e 6564 5f66 756e 6374  er_defined_funct
+00010a90: 696f 6e28 7265 706c 6163 6564 5f75 6466  ion(replaced_udf
+00010aa0: 5b27 6964 275d 290a 2020 2020 2020 2020  ['id']).        
+00010ab0: 2320 7265 6164 2075 6466 7320 6166 7465  # read udfs afte
+00010ac0: 7220 6465 6c65 7469 6f6e 0a20 2020 2020  r deletion.     
+00010ad0: 2020 2061 7761 6974 2073 656c 662e 5f5f     await self.__
+00010ae0: 4173 7365 7274 4854 5450 4661 696c 7572  AssertHTTPFailur
+00010af0: 6557 6974 6853 7461 7475 7328 5374 6174  eWithStatus(Stat
+00010b00: 7573 436f 6465 732e 4e4f 545f 464f 554e  usCodes.NOT_FOUN
+00010b10: 442c 0a20 2020 2020 2020 2020 2020 2020  D,.             
 00010b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b30: 636f 6c6c 6563 7469 6f6e 2e73 6372 6970  collection.scrip
-00010b40: 7473 2e67 6574 5f75 7365 725f 6465 6669  ts.get_user_defi
-00010b50: 6e65 645f 6675 6e63 7469 6f6e 2c0a 2020  ned_function,.  
-00010b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00010b90: 6570 6c61 6365 645f 7564 665b 2769 6427  eplaced_udf['id'
-00010ba0: 5d29 0a0a 2020 2020 6173 796e 6320 6465  ])..    async de
-00010bb0: 6620 7465 7374 5f73 7072 6f63 5f63 7275  f test_sproc_cru
-00010bc0: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
-00010bd0: 2023 2063 7265 6174 6520 6461 7461 6261   # create databa
-00010be0: 7365 0a20 2020 2020 2020 2064 6220 3d20  se.        db = 
-00010bf0: 7365 6c66 2e64 6174 6162 6173 6546 6f72  self.databaseFor
-00010c00: 5465 7374 0a20 2020 2020 2020 2023 2063  Test.        # c
-00010c10: 7265 6174 6520 636f 6c6c 6563 7469 6f6e  reate collection
-00010c20: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
-00010c30: 696f 6e20 3d20 6177 6169 7420 7365 6c66  ion = await self
-00010c40: 2e64 6174 6162 6173 6546 6f72 5465 7374  .databaseForTest
-00010c50: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
-00010c60: 7228 7465 7374 5f63 6f6e 6669 672e 5f74  r(test_config._t
-00010c70: 6573 745f 636f 6e66 6967 2e54 4553 545f  est_config.TEST_
-00010c80: 434f 4c4c 4543 5449 4f4e 5f4d 554c 5449  COLLECTION_MULTI
-00010c90: 5f50 4152 5449 5449 4f4e 290a 2020 2020  _PARTITION).    
-00010ca0: 2020 2020 2320 7265 6164 2073 7072 6f63      # read sproc
-00010cb0: 730a 2020 2020 2020 2020 7370 726f 6373  s.        sprocs
-00010cc0: 203d 205b 7370 726f 6320 6173 796e 6320   = [sproc async 
-00010cd0: 666f 7220 7370 726f 6320 696e 2063 6f6c  for sproc in col
-00010ce0: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
-00010cf0: 6c69 7374 5f73 746f 7265 645f 7072 6f63  list_stored_proc
-00010d00: 6564 7572 6573 2829 5d0a 2020 2020 2020  edures()].      
-00010d10: 2020 2320 6372 6561 7465 2061 2073 7072    # create a spr
-00010d20: 6f63 0a20 2020 2020 2020 2062 6566 6f72  oc.        befor
-00010d30: 655f 6372 6561 7465 5f73 7072 6f63 735f  e_create_sprocs_
-00010d40: 636f 756e 7420 3d20 6c65 6e28 7370 726f  count = len(spro
-00010d50: 6373 290a 2020 2020 2020 2020 7370 726f  cs).        spro
-00010d60: 635f 6465 6669 6e69 7469 6f6e 203d 207b  c_definition = {
-00010d70: 0a20 2020 2020 2020 2020 2020 2027 6964  .            'id
-00010d80: 273a 2027 7361 6d70 6c65 2073 7072 6f63  ': 'sample sproc
-00010d90: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-00010da0: 7365 7276 6572 5363 7269 7074 273a 2027  serverScript': '
-00010db0: 6675 6e63 7469 6f6e 2829 207b 7661 7220  function() {var 
-00010dc0: 7820 3d20 3130 3b7d 270a 2020 2020 2020  x = 10;}'.      
-00010dd0: 2020 7d0a 2020 2020 2020 2020 7370 726f    }.        spro
-00010de0: 6320 3d20 6177 6169 7420 636f 6c6c 6563  c = await collec
-00010df0: 7469 6f6e 2e73 6372 6970 7473 2e63 7265  tion.scripts.cre
-00010e00: 6174 655f 7374 6f72 6564 5f70 726f 6365  ate_stored_proce
-00010e10: 6475 7265 2862 6f64 793d 7370 726f 635f  dure(body=sproc_
-00010e20: 6465 6669 6e69 7469 6f6e 290a 2020 2020  definition).    
-00010e30: 2020 2020 666f 7220 7072 6f70 6572 7479      for property
-00010e40: 2069 6e20 7370 726f 635f 6465 6669 6e69   in sproc_defini
-00010e50: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00010e60: 2020 6966 2070 726f 7065 7274 7920 213d    if property !=
-00010e70: 2022 7365 7276 6572 5363 7269 7074 223a   "serverScript":
-00010e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010e90: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00010ea0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00010eb0: 2020 2020 2020 2073 7072 6f63 5b70 726f         sproc[pro
-00010ec0: 7065 7274 795d 2c0a 2020 2020 2020 2020  perty],.        
-00010ed0: 2020 2020 2020 2020 2020 2020 7370 726f              spro
-00010ee0: 635f 6465 6669 6e69 7469 6f6e 5b70 726f  c_definition[pro
-00010ef0: 7065 7274 795d 2c0a 2020 2020 2020 2020  perty],.        
-00010f00: 2020 2020 2020 2020 2020 2020 2770 726f              'pro
-00010f10: 7065 7274 7920 7b70 726f 7065 7274 797d  perty {property}
-00010f20: 2073 686f 756c 6420 6d61 7463 6827 2e66   should match'.f
-00010f30: 6f72 6d61 7428 7072 6f70 6572 7479 3d70  ormat(property=p
-00010f40: 726f 7065 7274 7929 290a 2020 2020 2020  roperty)).      
-00010f50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00010f60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00010f70: 2e61 7373 6572 7445 7175 616c 2873 7072  .assertEqual(spr
-00010f80: 6f63 5b27 626f 6479 275d 2c20 2766 756e  oc['body'], 'fun
-00010f90: 6374 696f 6e28 2920 7b76 6172 2078 203d  ction() {var x =
-00010fa0: 2031 303b 7d27 290a 0a20 2020 2020 2020   10;}')..       
-00010fb0: 2023 2072 6561 6420 7370 726f 6373 2061   # read sprocs a
-00010fc0: 6674 6572 2063 7265 6174 696f 6e0a 2020  fter creation.  
-00010fd0: 2020 2020 2020 7370 726f 6373 203d 205b        sprocs = [
-00010fe0: 7370 726f 6320 6173 796e 6320 666f 7220  sproc async for 
-00010ff0: 7370 726f 6320 696e 2063 6f6c 6c65 6374  sproc in collect
-00011000: 696f 6e2e 7363 7269 7074 732e 6c69 7374  ion.scripts.list
-00011010: 5f73 746f 7265 645f 7072 6f63 6564 7572  _stored_procedur
-00011020: 6573 2829 5d0a 2020 2020 2020 2020 7365  es()].        se
-00011030: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00011040: 656e 2873 7072 6f63 7329 2c0a 2020 2020  en(sprocs),.    
-00011050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011060: 2020 2020 2062 6566 6f72 655f 6372 6561       before_crea
-00011070: 7465 5f73 7072 6f63 735f 636f 756e 7420  te_sprocs_count 
-00011080: 2b20 312c 0a20 2020 2020 2020 2020 2020  + 1,.           
-00011090: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-000110a0: 7265 6174 6520 7368 6f75 6c64 2069 6e63  reate should inc
-000110b0: 7265 6173 6520 7468 6520 6e75 6d62 6572  rease the number
-000110c0: 206f 6620 7370 726f 6373 2729 0a20 2020   of sprocs').   
-000110d0: 2020 2020 2023 2071 7565 7279 2073 7072       # query spr
-000110e0: 6f63 730a 2020 2020 2020 2020 7370 726f  ocs.        spro
-000110f0: 6373 203d 205b 7370 726f 6320 6173 796e  cs = [sproc asyn
-00011100: 6320 666f 7220 7370 726f 6320 696e 2063  c for sproc in c
-00011110: 6f6c 6c65 6374 696f 6e2e 7363 7269 7074  ollection.script
-00011120: 732e 7175 6572 795f 7374 6f72 6564 5f70  s.query_stored_p
-00011130: 726f 6365 6475 7265 7328 0a20 2020 2020  rocedures(.     
-00011140: 2020 2020 2020 2071 7565 7279 3d27 5345         query='SE
-00011150: 4c45 4354 202a 2046 524f 4d20 726f 6f74  LECT * FROM root
-00011160: 2072 2057 4845 5245 2072 2e69 643d 4069   r WHERE r.id=@i
-00011170: 6427 2c0a 2020 2020 2020 2020 2020 2020  d',.            
-00011180: 7061 7261 6d65 7465 7273 3d5b 0a20 2020  parameters=[.   
-00011190: 2020 2020 2020 2020 2020 2020 207b 276e               {'n
-000111a0: 616d 6527 3a20 2740 6964 272c 2027 7661  ame': '@id', 'va
-000111b0: 6c75 6527 3a20 7370 726f 635f 6465 6669  lue': sproc_defi
-000111c0: 6e69 7469 6f6e 5b27 6964 275d 7d0a 2020  nition['id']}.  
-000111d0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-000111e0: 2020 2020 295d 0a20 2020 2020 2020 2073      )].        s
-000111f0: 656c 662e 6173 7365 7274 4973 4e6f 744e  elf.assertIsNotN
-00011200: 6f6e 6528 7370 726f 6373 290a 2020 2020  one(sprocs).    
-00011210: 2020 2020 2320 7265 706c 6163 6520 7370      # replace sp
-00011220: 726f 630a 2020 2020 2020 2020 6368 616e  roc.        chan
-00011230: 6765 5f73 7072 6f63 203d 2073 7072 6f63  ge_sproc = sproc
-00011240: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-00011250: 7370 726f 635b 2762 6f64 7927 5d20 3d20  sproc['body'] = 
-00011260: 2766 756e 6374 696f 6e28 2920 7b76 6172  'function() {var
-00011270: 2078 203d 2032 303b 7d27 0a20 2020 2020   x = 20;}'.     
-00011280: 2020 2072 6570 6c61 6365 645f 7370 726f     replaced_spro
-00011290: 6320 3d20 6177 6169 7420 636f 6c6c 6563  c = await collec
-000112a0: 7469 6f6e 2e73 6372 6970 7473 2e72 6570  tion.scripts.rep
-000112b0: 6c61 6365 5f73 746f 7265 645f 7072 6f63  lace_stored_proc
-000112c0: 6564 7572 6528 7370 726f 633d 6368 616e  edure(sproc=chan
-000112d0: 6765 5f73 7072 6f63 5b27 6964 275d 2c20  ge_sproc['id'], 
-000112e0: 626f 6479 3d73 7072 6f63 290a 2020 2020  body=sproc).    
-000112f0: 2020 2020 666f 7220 7072 6f70 6572 7479      for property
-00011300: 2069 6e20 7370 726f 635f 6465 6669 6e69   in sproc_defini
-00011310: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00011320: 2020 6966 2070 726f 7065 7274 7920 213d    if property !=
-00011330: 2027 7365 7276 6572 5363 7269 7074 273a   'serverScript':
-00011340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011350: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00011360: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00011370: 2020 2020 2020 2072 6570 6c61 6365 645f         replaced_
-00011380: 7370 726f 635b 7072 6f70 6572 7479 5d2c  sproc[property],
-00011390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000113a0: 2020 2020 2073 7072 6f63 5b70 726f 7065       sproc[prope
-000113b0: 7274 795d 2c0a 2020 2020 2020 2020 2020  rty],.          
-000113c0: 2020 2020 2020 2020 2020 2770 726f 7065            'prope
-000113d0: 7274 7920 7b70 726f 7065 7274 797d 2073  rty {property} s
-000113e0: 686f 756c 6420 6d61 7463 6827 2e66 6f72  hould match'.for
-000113f0: 6d61 7428 7072 6f70 6572 7479 3d70 726f  mat(property=pro
-00011400: 7065 7274 7929 290a 2020 2020 2020 2020  perty)).        
-00011410: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00011420: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00011430: 7373 6572 7445 7175 616c 2872 6570 6c61  ssertEqual(repla
-00011440: 6365 645f 7370 726f 635b 2762 6f64 7927  ced_sproc['body'
-00011450: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00011460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011470: 2020 2020 2266 756e 6374 696f 6e28 2920      "function() 
-00011480: 7b76 6172 2078 203d 2032 303b 7d22 290a  {var x = 20;}").
-00011490: 2020 2020 2020 2020 2320 7265 6164 2073          # read s
-000114a0: 7072 6f63 0a20 2020 2020 2020 2073 7072  proc.        spr
-000114b0: 6f63 203d 2061 7761 6974 2063 6f6c 6c65  oc = await colle
-000114c0: 6374 696f 6e2e 7363 7269 7074 732e 6765  ction.scripts.ge
-000114d0: 745f 7374 6f72 6564 5f70 726f 6365 6475  t_stored_procedu
-000114e0: 7265 2872 6570 6c61 6365 645f 7370 726f  re(replaced_spro
-000114f0: 635b 2769 6427 5d29 0a20 2020 2020 2020  c['id']).       
-00011500: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00011510: 6c28 7265 706c 6163 6564 5f73 7072 6f63  l(replaced_sproc
-00011520: 5b27 6964 275d 2c20 7370 726f 635b 2769  ['id'], sproc['i
-00011530: 6427 5d29 0a20 2020 2020 2020 2023 2064  d']).        # d
-00011540: 656c 6574 6520 7370 726f 630a 2020 2020  elete sproc.    
-00011550: 2020 2020 6177 6169 7420 636f 6c6c 6563      await collec
-00011560: 7469 6f6e 2e73 6372 6970 7473 2e64 656c  tion.scripts.del
-00011570: 6574 655f 7374 6f72 6564 5f70 726f 6365  ete_stored_proce
-00011580: 6475 7265 2872 6570 6c61 6365 645f 7370  dure(replaced_sp
-00011590: 726f 635b 2769 6427 5d29 0a20 2020 2020  roc['id']).     
-000115a0: 2020 2023 2072 6561 6420 7370 726f 6373     # read sprocs
-000115b0: 2061 6674 6572 2064 656c 6574 696f 6e0a   after deletion.
-000115c0: 2020 2020 2020 2020 6177 6169 7420 7365          await se
-000115d0: 6c66 2e5f 5f41 7373 6572 7448 5454 5046  lf.__AssertHTTPF
-000115e0: 6169 6c75 7265 5769 7468 5374 6174 7573  ailureWithStatus
-000115f0: 2853 7461 7475 7343 6f64 6573 2e4e 4f54  (StatusCodes.NOT
-00011600: 5f46 4f55 4e44 2c0a 2020 2020 2020 2020  _FOUND,.        
-00011610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b40: 2020 2020 636f 6c6c 6563 7469 6f6e 2e73      collection.s
+00010b50: 6372 6970 7473 2e67 6574 5f75 7365 725f  cripts.get_user_
+00010b60: 6465 6669 6e65 645f 6675 6e63 7469 6f6e  defined_function
+00010b70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ba0: 2020 2072 6570 6c61 6365 645f 7564 665b     replaced_udf[
+00010bb0: 2769 6427 5d29 0a0a 2020 2020 6173 796e  'id'])..    asyn
+00010bc0: 6320 6465 6620 7465 7374 5f73 7072 6f63  c def test_sproc
+00010bd0: 5f63 7275 6428 7365 6c66 293a 0a20 2020  _crud(self):.   
+00010be0: 2020 2020 2023 2063 7265 6174 6520 6461       # create da
+00010bf0: 7461 6261 7365 0a20 2020 2020 2020 2064  tabase.        d
+00010c00: 6220 3d20 7365 6c66 2e64 6174 6162 6173  b = self.databas
+00010c10: 6546 6f72 5465 7374 0a20 2020 2020 2020  eForTest.       
+00010c20: 2023 2063 7265 6174 6520 636f 6c6c 6563   # create collec
+00010c30: 7469 6f6e 0a20 2020 2020 2020 2063 6f6c  tion.        col
+00010c40: 6c65 6374 696f 6e20 3d20 6177 6169 7420  lection = await 
+00010c50: 7365 6c66 2e64 6174 6162 6173 6546 6f72  self.databaseFor
+00010c60: 5465 7374 2e63 7265 6174 655f 636f 6e74  Test.create_cont
+00010c70: 6169 6e65 7228 7465 7374 5f63 6f6e 6669  ainer(test_confi
+00010c80: 672e 5f74 6573 745f 636f 6e66 6967 2e54  g._test_config.T
+00010c90: 4553 545f 434f 4c4c 4543 5449 4f4e 5f4d  EST_COLLECTION_M
+00010ca0: 554c 5449 5f50 4152 5449 5449 4f4e 290a  ULTI_PARTITION).
+00010cb0: 2020 2020 2020 2020 2320 7265 6164 2073          # read s
+00010cc0: 7072 6f63 730a 2020 2020 2020 2020 7370  procs.        sp
+00010cd0: 726f 6373 203d 205b 7370 726f 6320 6173  rocs = [sproc as
+00010ce0: 796e 6320 666f 7220 7370 726f 6320 696e  ync for sproc in
+00010cf0: 2063 6f6c 6c65 6374 696f 6e2e 7363 7269   collection.scri
+00010d00: 7074 732e 6c69 7374 5f73 746f 7265 645f  pts.list_stored_
+00010d10: 7072 6f63 6564 7572 6573 2829 5d0a 2020  procedures()].  
+00010d20: 2020 2020 2020 2320 6372 6561 7465 2061        # create a
+00010d30: 2073 7072 6f63 0a20 2020 2020 2020 2062   sproc.        b
+00010d40: 6566 6f72 655f 6372 6561 7465 5f73 7072  efore_create_spr
+00010d50: 6f63 735f 636f 756e 7420 3d20 6c65 6e28  ocs_count = len(
+00010d60: 7370 726f 6373 290a 2020 2020 2020 2020  sprocs).        
+00010d70: 7370 726f 635f 6465 6669 6e69 7469 6f6e  sproc_definition
+00010d80: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00010d90: 2027 6964 273a 2027 7361 6d70 6c65 2073   'id': 'sample s
+00010da0: 7072 6f63 272c 0a20 2020 2020 2020 2020  proc',.         
+00010db0: 2020 2027 7365 7276 6572 5363 7269 7074     'serverScript
+00010dc0: 273a 2027 6675 6e63 7469 6f6e 2829 207b  ': 'function() {
+00010dd0: 7661 7220 7820 3d20 3130 3b7d 270a 2020  var x = 10;}'.  
+00010de0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00010df0: 7370 726f 6320 3d20 6177 6169 7420 636f  sproc = await co
+00010e00: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
+00010e10: 2e63 7265 6174 655f 7374 6f72 6564 5f70  .create_stored_p
+00010e20: 726f 6365 6475 7265 2862 6f64 793d 7370  rocedure(body=sp
+00010e30: 726f 635f 6465 6669 6e69 7469 6f6e 290a  roc_definition).
+00010e40: 2020 2020 2020 2020 666f 7220 7072 6f70          for prop
+00010e50: 6572 7479 2069 6e20 7370 726f 635f 6465  erty in sproc_de
+00010e60: 6669 6e69 7469 6f6e 3a0a 2020 2020 2020  finition:.      
+00010e70: 2020 2020 2020 6966 2070 726f 7065 7274        if propert
+00010e80: 7920 213d 2022 7365 7276 6572 5363 7269  y != "serverScri
+00010e90: 7074 223a 0a20 2020 2020 2020 2020 2020  pt":.           
+00010ea0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00010eb0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
+00010ec0: 2020 2020 2020 2020 2020 2073 7072 6f63             sproc
+00010ed0: 5b70 726f 7065 7274 795d 2c0a 2020 2020  [property],.    
+00010ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ef0: 7370 726f 635f 6465 6669 6e69 7469 6f6e  sproc_definition
+00010f00: 5b70 726f 7065 7274 795d 2c0a 2020 2020  [property],.    
+00010f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f20: 2770 726f 7065 7274 7920 7b70 726f 7065  'property {prope
+00010f30: 7274 797d 2073 686f 756c 6420 6d61 7463  rty} should matc
+00010f40: 6827 2e66 6f72 6d61 7428 7072 6f70 6572  h'.format(proper
+00010f50: 7479 3d70 726f 7065 7274 7929 290a 2020  ty=property)).  
+00010f60: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00010f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f80: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00010f90: 2873 7072 6f63 5b27 626f 6479 275d 2c20  (sproc['body'], 
+00010fa0: 2766 756e 6374 696f 6e28 2920 7b76 6172  'function() {var
+00010fb0: 2078 203d 2031 303b 7d27 290a 0a20 2020   x = 10;}')..   
+00010fc0: 2020 2020 2023 2072 6561 6420 7370 726f       # read spro
+00010fd0: 6373 2061 6674 6572 2063 7265 6174 696f  cs after creatio
+00010fe0: 6e0a 2020 2020 2020 2020 7370 726f 6373  n.        sprocs
+00010ff0: 203d 205b 7370 726f 6320 6173 796e 6320   = [sproc async 
+00011000: 666f 7220 7370 726f 6320 696e 2063 6f6c  for sproc in col
+00011010: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
+00011020: 6c69 7374 5f73 746f 7265 645f 7072 6f63  list_stored_proc
+00011030: 6564 7572 6573 2829 5d0a 2020 2020 2020  edures()].      
+00011040: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00011050: 616c 286c 656e 2873 7072 6f63 7329 2c0a  al(len(sprocs),.
+00011060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011070: 2020 2020 2020 2020 2062 6566 6f72 655f           before_
+00011080: 6372 6561 7465 5f73 7072 6f63 735f 636f  create_sprocs_co
+00011090: 756e 7420 2b20 312c 0a20 2020 2020 2020  unt + 1,.       
+000110a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110b0: 2020 2763 7265 6174 6520 7368 6f75 6c64    'create should
+000110c0: 2069 6e63 7265 6173 6520 7468 6520 6e75   increase the nu
+000110d0: 6d62 6572 206f 6620 7370 726f 6373 2729  mber of sprocs')
+000110e0: 0a20 2020 2020 2020 2023 2071 7565 7279  .        # query
+000110f0: 2073 7072 6f63 730a 2020 2020 2020 2020   sprocs.        
+00011100: 7370 726f 6373 203d 205b 7370 726f 6320  sprocs = [sproc 
+00011110: 6173 796e 6320 666f 7220 7370 726f 6320  async for sproc 
+00011120: 696e 2063 6f6c 6c65 6374 696f 6e2e 7363  in collection.sc
+00011130: 7269 7074 732e 7175 6572 795f 7374 6f72  ripts.query_stor
+00011140: 6564 5f70 726f 6365 6475 7265 7328 0a20  ed_procedures(. 
+00011150: 2020 2020 2020 2020 2020 2071 7565 7279             query
+00011160: 3d27 5345 4c45 4354 202a 2046 524f 4d20  ='SELECT * FROM 
+00011170: 726f 6f74 2072 2057 4845 5245 2072 2e69  root r WHERE r.i
+00011180: 643d 4069 6427 2c0a 2020 2020 2020 2020  d=@id',.        
+00011190: 2020 2020 7061 7261 6d65 7465 7273 3d5b      parameters=[
+000111a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000111b0: 207b 276e 616d 6527 3a20 2740 6964 272c   {'name': '@id',
+000111c0: 2027 7661 6c75 6527 3a20 7370 726f 635f   'value': sproc_
+000111d0: 6465 6669 6e69 7469 6f6e 5b27 6964 275d  definition['id']
+000111e0: 7d0a 2020 2020 2020 2020 2020 2020 5d0a  }.            ].
+000111f0: 2020 2020 2020 2020 295d 0a20 2020 2020          )].     
+00011200: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
+00011210: 4e6f 744e 6f6e 6528 7370 726f 6373 290a  NotNone(sprocs).
+00011220: 2020 2020 2020 2020 2320 7265 706c 6163          # replac
+00011230: 6520 7370 726f 630a 2020 2020 2020 2020  e sproc.        
+00011240: 6368 616e 6765 5f73 7072 6f63 203d 2073  change_sproc = s
+00011250: 7072 6f63 2e63 6f70 7928 290a 2020 2020  proc.copy().    
+00011260: 2020 2020 7370 726f 635b 2762 6f64 7927      sproc['body'
+00011270: 5d20 3d20 2766 756e 6374 696f 6e28 2920  ] = 'function() 
+00011280: 7b76 6172 2078 203d 2032 303b 7d27 0a20  {var x = 20;}'. 
+00011290: 2020 2020 2020 2072 6570 6c61 6365 645f         replaced_
+000112a0: 7370 726f 6320 3d20 6177 6169 7420 636f  sproc = await co
+000112b0: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
+000112c0: 2e72 6570 6c61 6365 5f73 746f 7265 645f  .replace_stored_
+000112d0: 7072 6f63 6564 7572 6528 7370 726f 633d  procedure(sproc=
+000112e0: 6368 616e 6765 5f73 7072 6f63 5b27 6964  change_sproc['id
+000112f0: 275d 2c20 626f 6479 3d73 7072 6f63 290a  '], body=sproc).
+00011300: 2020 2020 2020 2020 666f 7220 7072 6f70          for prop
+00011310: 6572 7479 2069 6e20 7370 726f 635f 6465  erty in sproc_de
+00011320: 6669 6e69 7469 6f6e 3a0a 2020 2020 2020  finition:.      
+00011330: 2020 2020 2020 6966 2070 726f 7065 7274        if propert
+00011340: 7920 213d 2027 7365 7276 6572 5363 7269  y != 'serverScri
+00011350: 7074 273a 0a20 2020 2020 2020 2020 2020  pt':.           
+00011360: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00011370: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
+00011380: 2020 2020 2020 2020 2020 2072 6570 6c61             repla
+00011390: 6365 645f 7370 726f 635b 7072 6f70 6572  ced_sproc[proper
+000113a0: 7479 5d2c 0a20 2020 2020 2020 2020 2020  ty],.           
+000113b0: 2020 2020 2020 2020 2073 7072 6f63 5b70           sproc[p
+000113c0: 726f 7065 7274 795d 2c0a 2020 2020 2020  roperty],.      
+000113d0: 2020 2020 2020 2020 2020 2020 2020 2770                'p
+000113e0: 726f 7065 7274 7920 7b70 726f 7065 7274  roperty {propert
+000113f0: 797d 2073 686f 756c 6420 6d61 7463 6827  y} should match'
+00011400: 2e66 6f72 6d61 7428 7072 6f70 6572 7479  .format(property
+00011410: 3d70 726f 7065 7274 7929 290a 2020 2020  =property)).    
+00011420: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00011430: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00011440: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00011450: 6570 6c61 6365 645f 7370 726f 635b 2762  eplaced_sproc['b
+00011460: 6f64 7927 5d2c 0a20 2020 2020 2020 2020  ody'],.         
+00011470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011480: 2020 2020 2020 2020 2266 756e 6374 696f          "functio
+00011490: 6e28 2920 7b76 6172 2078 203d 2032 303b  n() {var x = 20;
+000114a0: 7d22 290a 2020 2020 2020 2020 2320 7265  }").        # re
+000114b0: 6164 2073 7072 6f63 0a20 2020 2020 2020  ad sproc.       
+000114c0: 2073 7072 6f63 203d 2061 7761 6974 2063   sproc = await c
+000114d0: 6f6c 6c65 6374 696f 6e2e 7363 7269 7074  ollection.script
+000114e0: 732e 6765 745f 7374 6f72 6564 5f70 726f  s.get_stored_pro
+000114f0: 6365 6475 7265 2872 6570 6c61 6365 645f  cedure(replaced_
+00011500: 7370 726f 635b 2769 6427 5d29 0a20 2020  sproc['id']).   
+00011510: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00011520: 4571 7561 6c28 7265 706c 6163 6564 5f73  Equal(replaced_s
+00011530: 7072 6f63 5b27 6964 275d 2c20 7370 726f  proc['id'], spro
+00011540: 635b 2769 6427 5d29 0a20 2020 2020 2020  c['id']).       
+00011550: 2023 2064 656c 6574 6520 7370 726f 630a   # delete sproc.
+00011560: 2020 2020 2020 2020 6177 6169 7420 636f          await co
+00011570: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
+00011580: 2e64 656c 6574 655f 7374 6f72 6564 5f70  .delete_stored_p
+00011590: 726f 6365 6475 7265 2872 6570 6c61 6365  rocedure(replace
+000115a0: 645f 7370 726f 635b 2769 6427 5d29 0a20  d_sproc['id']). 
+000115b0: 2020 2020 2020 2023 2072 6561 6420 7370         # read sp
+000115c0: 726f 6373 2061 6674 6572 2064 656c 6574  rocs after delet
+000115d0: 696f 6e0a 2020 2020 2020 2020 6177 6169  ion.        awai
+000115e0: 7420 7365 6c66 2e5f 5f41 7373 6572 7448  t self.__AssertH
+000115f0: 5454 5046 6169 6c75 7265 5769 7468 5374  TTPFailureWithSt
+00011600: 6174 7573 2853 7461 7475 7343 6f64 6573  atus(StatusCodes
+00011610: 2e4e 4f54 5f46 4f55 4e44 2c0a 2020 2020  .NOT_FOUND,.    
 00011620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011630: 2020 2020 2020 2020 2063 6f6c 6c65 6374           collect
-00011640: 696f 6e2e 7363 7269 7074 732e 6765 745f  ion.scripts.get_
-00011650: 7374 6f72 6564 5f70 726f 6365 6475 7265  stored_procedure
-00011660: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00011670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011640: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+00011650: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
+00011660: 6765 745f 7374 6f72 6564 5f70 726f 6365  get_stored_proce
+00011670: 6475 7265 2c0a 2020 2020 2020 2020 2020  dure,.          
 00011680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011690: 2020 2072 6570 6c61 6365 645f 7370 726f     replaced_spro
-000116a0: 635b 2769 6427 5d29 0a0a 2020 2020 6173  c['id'])..    as
-000116b0: 796e 6320 6465 6620 7465 7374 5f73 6372  ync def test_scr
-000116c0: 6970 745f 6c6f 6767 696e 675f 6578 6563  ipt_logging_exec
-000116d0: 7574 655f 7374 6f72 6564 5f70 726f 6365  ute_stored_proce
-000116e0: 6475 7265 2873 656c 6629 3a0a 2020 2020  dure(self):.    
-000116f0: 2020 2020 6372 6561 7465 645f 6462 203d      created_db =
-00011700: 2073 656c 662e 6461 7461 6261 7365 466f   self.databaseFo
-00011710: 7254 6573 740a 0a20 2020 2020 2020 2063  rTest..        c
-00011720: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
-00011730: 6e20 3d20 6177 6169 7420 7365 6c66 2e64  n = await self.d
-00011740: 6174 6162 6173 6546 6f72 5465 7374 2e63  atabaseForTest.c
-00011750: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
-00011760: 7465 7374 5f63 6f6e 6669 672e 5f74 6573  test_config._tes
-00011770: 745f 636f 6e66 6967 2e54 4553 545f 434f  t_config.TEST_CO
-00011780: 4c4c 4543 5449 4f4e 5f4d 554c 5449 5f50  LLECTION_MULTI_P
-00011790: 4152 5449 5449 4f4e 290a 0a20 2020 2020  ARTITION)..     
-000117a0: 2020 2073 7072 6f63 203d 207b 0a20 2020     sproc = {.   
-000117b0: 2020 2020 2020 2020 2027 6964 273a 2027           'id': '
-000117c0: 7374 6f72 6564 5072 6f63 6564 7572 6527  storedProcedure'
-000117d0: 202b 2073 7472 2875 7569 642e 7575 6964   + str(uuid.uuid
-000117e0: 3428 2929 2c0a 2020 2020 2020 2020 2020  4()),.          
-000117f0: 2020 2762 6f64 7927 3a20 280a 2020 2020    'body': (.    
-00011800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011810: 2766 756e 6374 696f 6e20 2829 207b 2720  'function () {' 
-00011820: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-00011830: 2020 2020 2020 2720 2020 7661 7220 6d79        '   var my
-00011840: 7465 7874 203d 205c 2778 5c27 3b27 202b  text = \'x\';' +
-00011850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011860: 2020 2020 2027 2020 2076 6172 206d 7976       '   var myv
-00011870: 616c 203d 2031 3b27 202b 0a20 2020 2020  al = 1;' +.     
-00011880: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00011890: 2020 2074 7279 207b 2720 2b0a 2020 2020     try {' +.    
-000118a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118b0: 2720 2020 2020 2020 636f 6e73 6f6c 652e  '       console.
-000118c0: 6c6f 6728 5c27 5468 6520 7661 6c75 6520  log(\'The value 
-000118d0: 6f66 2025 7320 6973 2025 732e 5c27 2c20  of %s is %s.\', 
-000118e0: 6d79 7465 7874 2c20 6d79 7661 6c29 3b27  mytext, myval);'
-000118f0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00011900: 2020 2020 2020 2027 2020 2020 2020 2067         '       g
-00011910: 6574 436f 6e74 6578 7428 292e 6765 7452  etContext().getR
-00011920: 6573 706f 6e73 6528 292e 7365 7442 6f64  esponse().setBod
-00011930: 7928 5c27 5375 6363 6573 7321 5c27 293b  y(\'Success!\');
-00011940: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
-00011950: 2020 2020 2020 2020 2720 2020 7d27 202b          '   }' +
-00011960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011970: 2020 2020 2027 2020 2063 6174 6368 2028       '   catch (
-00011980: 6572 7229 207b 2720 2b0a 2020 2020 2020  err) {' +.      
-00011990: 2020 2020 2020 2020 2020 2020 2020 2720                ' 
-000119a0: 2020 2020 2020 6765 7443 6f6e 7465 7874        getContext
-000119b0: 2829 2e67 6574 5265 7370 6f6e 7365 2829  ().getResponse()
-000119c0: 2e73 6574 426f 6479 285c 2769 6e6c 696e  .setBody(\'inlin
-000119d0: 6520 6572 723a 205b 5c27 202b 2065 7272  e err: [\' + err
-000119e0: 2e6e 756d 6265 7220 2b20 5c27 5d20 5c27  .number + \'] \'
-000119f0: 202b 2065 7272 293b 2720 2b0a 2020 2020   + err);' +.    
-00011a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a10: 2720 2020 7d27 0a20 2020 2020 2020 2020  '   }'.         
-00011a20: 2020 2020 2020 2020 2020 2027 7d27 290a             '}').
-00011a30: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-00011a40: 2020 2063 7265 6174 6564 5f73 7072 6f63     created_sproc
-00011a50: 203d 2061 7761 6974 2063 7265 6174 6564   = await created
-00011a60: 5f63 6f6c 6c65 6374 696f 6e2e 7363 7269  _collection.scri
-00011a70: 7074 732e 6372 6561 7465 5f73 746f 7265  pts.create_store
-00011a80: 645f 7072 6f63 6564 7572 6528 626f 6479  d_procedure(body
-00011a90: 3d73 7072 6f63 290a 0a20 2020 2020 2020  =sproc)..       
-00011aa0: 2072 6573 756c 7420 3d20 6177 6169 7420   result = await 
-00011ab0: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
-00011ac0: 6f6e 2e73 6372 6970 7473 2e65 7865 6375  on.scripts.execu
-00011ad0: 7465 5f73 746f 7265 645f 7072 6f63 6564  te_stored_proced
-00011ae0: 7572 6528 0a20 2020 2020 2020 2020 2020  ure(.           
-00011af0: 2073 7072 6f63 3d63 7265 6174 6564 5f73   sproc=created_s
-00011b00: 7072 6f63 5b27 6964 275d 2c0a 2020 2020  proc['id'],.    
-00011b10: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
-00011b20: 6e5f 6b65 793d 310a 2020 2020 2020 2020  n_key=1.        
-00011b30: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00011b40: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
-00011b50: 6c74 2c20 2753 7563 6365 7373 2127 290a  lt, 'Success!').
-00011b60: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00011b70: 6572 7446 616c 7365 280a 2020 2020 2020  ertFalse(.      
-00011b80: 2020 2020 2020 4874 7470 4865 6164 6572        HttpHeader
-00011b90: 732e 5363 7269 7074 4c6f 6752 6573 756c  s.ScriptLogResul
-00011ba0: 7473 2069 6e20 6372 6561 7465 645f 636f  ts in created_co
-00011bb0: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
-00011bc0: 2e63 6c69 656e 745f 636f 6e6e 6563 7469  .client_connecti
-00011bd0: 6f6e 2e6c 6173 745f 7265 7370 6f6e 7365  on.last_response
-00011be0: 5f68 6561 6465 7273 290a 0a20 2020 2020  _headers)..     
-00011bf0: 2020 2072 6573 756c 7420 3d20 6177 6169     result = awai
-00011c00: 7420 6372 6561 7465 645f 636f 6c6c 6563  t created_collec
-00011c10: 7469 6f6e 2e73 6372 6970 7473 2e65 7865  tion.scripts.exe
-00011c20: 6375 7465 5f73 746f 7265 645f 7072 6f63  cute_stored_proc
-00011c30: 6564 7572 6528 0a20 2020 2020 2020 2020  edure(.         
-00011c40: 2020 2073 7072 6f63 3d63 7265 6174 6564     sproc=created
-00011c50: 5f73 7072 6f63 5b27 6964 275d 2c0a 2020  _sproc['id'],.  
-00011c60: 2020 2020 2020 2020 2020 656e 6162 6c65            enable
-00011c70: 5f73 6372 6970 745f 6c6f 6767 696e 673d  _script_logging=
-00011c80: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00011c90: 2020 7061 7274 6974 696f 6e5f 6b65 793d    partition_key=
-00011ca0: 310a 2020 2020 2020 2020 290a 0a20 2020  1.        )..   
-00011cb0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00011cc0: 4571 7561 6c28 7265 7375 6c74 2c20 2753  Equal(result, 'S
-00011cd0: 7563 6365 7373 2127 290a 2020 2020 2020  uccess!').      
-00011ce0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00011cf0: 616c 2875 726c 6c69 622e 7175 6f74 6528  al(urllib.quote(
-00011d00: 2754 6865 2076 616c 7565 206f 6620 7820  'The value of x 
-00011d10: 6973 2031 2e27 292c 0a20 2020 2020 2020  is 1.'),.       
-00011d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d30: 2020 6372 6561 7465 645f 636f 6c6c 6563    created_collec
-00011d40: 7469 6f6e 2e73 6372 6970 7473 2e63 6c69  tion.scripts.cli
-00011d50: 656e 745f 636f 6e6e 6563 7469 6f6e 2e6c  ent_connection.l
-00011d60: 6173 745f 7265 7370 6f6e 7365 5f68 6561  ast_response_hea
-00011d70: 6465 7273 2e67 6574 280a 2020 2020 2020  ders.get(.      
-00011d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d90: 2020 2020 2020 2048 7474 7048 6561 6465         HttpHeade
-00011da0: 7273 2e53 6372 6970 744c 6f67 5265 7375  rs.ScriptLogResu
-00011db0: 6c74 7329 290a 0a20 2020 2020 2020 2072  lts))..        r
-00011dc0: 6573 756c 7420 3d20 6177 6169 7420 6372  esult = await cr
-00011dd0: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
-00011de0: 2e73 6372 6970 7473 2e65 7865 6375 7465  .scripts.execute
-00011df0: 5f73 746f 7265 645f 7072 6f63 6564 7572  _stored_procedur
-00011e00: 6528 0a20 2020 2020 2020 2020 2020 2073  e(.            s
-00011e10: 7072 6f63 3d63 7265 6174 6564 5f73 7072  proc=created_spr
-00011e20: 6f63 5b27 6964 275d 2c0a 2020 2020 2020  oc['id'],.      
-00011e30: 2020 2020 2020 656e 6162 6c65 5f73 6372        enable_scr
-00011e40: 6970 745f 6c6f 6767 696e 673d 4661 6c73  ipt_logging=Fals
-00011e50: 652c 0a20 2020 2020 2020 2020 2020 2070  e,.            p
-00011e60: 6172 7469 7469 6f6e 5f6b 6579 3d31 0a20  artition_key=1. 
-00011e70: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00011e80: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00011e90: 616c 2872 6573 756c 742c 2027 5375 6363  al(result, 'Succ
-00011ea0: 6573 7321 2729 0a20 2020 2020 2020 2073  ess!').        s
-00011eb0: 656c 662e 6173 7365 7274 4661 6c73 6528  elf.assertFalse(
-00011ec0: 0a20 2020 2020 2020 2020 2020 2048 7474  .            Htt
-00011ed0: 7048 6561 6465 7273 2e53 6372 6970 744c  pHeaders.ScriptL
-00011ee0: 6f67 5265 7375 6c74 7320 696e 2063 7265  ogResults in cre
-00011ef0: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
-00011f00: 7363 7269 7074 732e 636c 6965 6e74 5f63  scripts.client_c
-00011f10: 6f6e 6e65 6374 696f 6e2e 6c61 7374 5f72  onnection.last_r
-00011f20: 6573 706f 6e73 655f 6865 6164 6572 7329  esponse_headers)
-00011f30: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
-00011f40: 7465 7374 5f63 6f6c 6c65 6374 696f 6e5f  test_collection_
-00011f50: 696e 6465 7869 6e67 5f70 6f6c 6963 7928  indexing_policy(
-00011f60: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
-00011f70: 2063 7265 6174 6520 6461 7461 6261 7365   create database
-00011f80: 0a20 2020 2020 2020 2064 6220 3d20 7365  .        db = se
-00011f90: 6c66 2e64 6174 6162 6173 6546 6f72 5465  lf.databaseForTe
-00011fa0: 7374 0a20 2020 2020 2020 2023 2063 7265  st.        # cre
-00011fb0: 6174 6520 636f 6c6c 6563 7469 6f6e 0a20  ate collection. 
-00011fc0: 2020 2020 2020 2063 6f6c 6c65 6374 696f         collectio
-00011fd0: 6e20 3d20 6177 6169 7420 6462 2e63 7265  n = await db.cre
-00011fe0: 6174 655f 636f 6e74 6169 6e65 7228 0a20  ate_container(. 
-00011ff0: 2020 2020 2020 2020 2020 2069 643d 2774             id='t
-00012000: 6573 745f 636f 6c6c 6563 7469 6f6e 5f69  est_collection_i
-00012010: 6e64 6578 696e 675f 706f 6c69 6379 2064  ndexing_policy d
-00012020: 6566 6175 6c74 2070 6f6c 6963 7927 202b  efault policy' +
-00012030: 2073 7472 2875 7569 642e 7575 6964 3428   str(uuid.uuid4(
-00012040: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-00012050: 7061 7274 6974 696f 6e5f 6b65 793d 5061  partition_key=Pa
-00012060: 7274 6974 696f 6e4b 6579 2870 6174 683d  rtitionKey(path=
-00012070: 272f 6964 272c 206b 696e 643d 2748 6173  '/id', kind='Has
-00012080: 6827 290a 2020 2020 2020 2020 290a 0a20  h').        ).. 
-00012090: 2020 2020 2020 2063 6f6c 6c65 6374 696f         collectio
-000120a0: 6e5f 7072 6f70 6572 7469 6573 203d 2061  n_properties = a
-000120b0: 7761 6974 2063 6f6c 6c65 6374 696f 6e2e  wait collection.
-000120c0: 7265 6164 2829 0a20 2020 2020 2020 2073  read().        s
-000120d0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000120e0: 636f 6c6c 6563 7469 6f6e 5f70 726f 7065  collection_prope
-000120f0: 7274 6965 735b 2769 6e64 6578 696e 6750  rties['indexingP
-00012100: 6f6c 6963 7927 5d5b 2769 6e64 6578 696e  olicy']['indexin
-00012110: 674d 6f64 6527 5d2c 0a20 2020 2020 2020  gMode'],.       
-00012120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012130: 2020 646f 6375 6d65 6e74 732e 496e 6465    documents.Inde
-00012140: 7869 6e67 4d6f 6465 2e43 6f6e 7369 7374  xingMode.Consist
-00012150: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
-00012160: 2020 2020 2020 2020 2020 2020 2020 2764                'd
-00012170: 6566 6175 6c74 2069 6e64 6578 696e 6720  efault indexing 
-00012180: 6d6f 6465 2073 686f 756c 6420 6265 2063  mode should be c
-00012190: 6f6e 7369 7374 656e 7427 290a 0a20 2020  onsistent')..   
-000121a0: 2020 2020 2061 7761 6974 2064 622e 6465       await db.de
-000121b0: 6c65 7465 5f63 6f6e 7461 696e 6572 2863  lete_container(c
-000121c0: 6f6e 7461 696e 6572 3d63 6f6c 6c65 6374  ontainer=collect
-000121d0: 696f 6e29 0a0a 2020 2020 2020 2020 636f  ion)..        co
-000121e0: 6e73 6973 7465 6e74 5f63 6f6c 6c65 6374  nsistent_collect
-000121f0: 696f 6e20 3d20 6177 6169 7420 6462 2e63  ion = await db.c
-00012200: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
-00012210: 0a20 2020 2020 2020 2020 2020 2069 643d  .            id=
-00012220: 2774 6573 745f 636f 6c6c 6563 7469 6f6e  'test_collection
-00012230: 5f69 6e64 6578 696e 675f 706f 6c69 6379  _indexing_policy
-00012240: 2063 6f6e 7369 7374 656e 7420 636f 6c6c   consistent coll
-00012250: 6563 7469 6f6e 2027 202b 2073 7472 2875  ection ' + str(u
-00012260: 7569 642e 7575 6964 3428 2929 2c0a 2020  uid.uuid4()),.  
-00012270: 2020 2020 2020 2020 2020 696e 6465 7869            indexi
-00012280: 6e67 5f70 6f6c 6963 793d 7b0a 2020 2020  ng_policy={.    
-00012290: 2020 2020 2020 2020 2020 2020 2769 6e64              'ind
-000122a0: 6578 696e 674d 6f64 6527 3a20 646f 6375  exingMode': docu
-000122b0: 6d65 6e74 732e 496e 6465 7869 6e67 4d6f  ments.IndexingMo
-000122c0: 6465 2e43 6f6e 7369 7374 656e 740a 2020  de.Consistent.  
-000122d0: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
-000122e0: 2020 2020 2020 2020 2070 6172 7469 7469           partiti
-000122f0: 6f6e 5f6b 6579 3d50 6172 7469 7469 6f6e  on_key=Partition
-00012300: 4b65 7928 7061 7468 3d27 2f69 6427 2c20  Key(path='/id', 
-00012310: 6b69 6e64 3d27 4861 7368 2729 0a20 2020  kind='Hash').   
-00012320: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00012330: 636f 6e73 6973 7465 6e74 5f63 6f6c 6c65  consistent_colle
-00012340: 6374 696f 6e5f 7072 6f70 6572 7469 6573  ction_properties
-00012350: 203d 2061 7761 6974 2063 6f6e 7369 7374   = await consist
-00012360: 656e 745f 636f 6c6c 6563 7469 6f6e 2e72  ent_collection.r
-00012370: 6561 6428 290a 2020 2020 2020 2020 7365  ead().        se
-00012380: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-00012390: 6f6e 7369 7374 656e 745f 636f 6c6c 6563  onsistent_collec
-000123a0: 7469 6f6e 5f70 726f 7065 7274 6965 735b  tion_properties[
-000123b0: 2769 6e64 6578 696e 6750 6f6c 6963 7927  'indexingPolicy'
-000123c0: 5d5b 2769 6e64 6578 696e 674d 6f64 6527  ]['indexingMode'
-000123d0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-000123e0: 2020 2020 2020 2020 2020 2020 646f 6375              docu
-000123f0: 6d65 6e74 732e 496e 6465 7869 6e67 4d6f  ments.IndexingMo
-00012400: 6465 2e43 6f6e 7369 7374 656e 742c 0a20  de.Consistent,. 
-00012410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012420: 2020 2020 2020 2020 2769 6e64 6578 696e          'indexin
-00012430: 6720 6d6f 6465 2073 686f 756c 6420 6265  g mode should be
-00012440: 2063 6f6e 7369 7374 656e 7427 290a 0a20   consistent').. 
-00012450: 2020 2020 2020 2061 7761 6974 2064 622e         await db.
-00012460: 6465 6c65 7465 5f63 6f6e 7461 696e 6572  delete_container
-00012470: 2863 6f6e 7461 696e 6572 3d63 6f6e 7369  (container=consi
-00012480: 7374 656e 745f 636f 6c6c 6563 7469 6f6e  stent_collection
-00012490: 290a 0a20 2020 2020 2020 2063 6f6c 6c65  )..        colle
-000124a0: 6374 696f 6e5f 7769 7468 5f69 6e64 6578  ction_with_index
-000124b0: 696e 675f 706f 6c69 6379 203d 2061 7761  ing_policy = awa
-000124c0: 6974 2064 622e 6372 6561 7465 5f63 6f6e  it db.create_con
-000124d0: 7461 696e 6572 280a 2020 2020 2020 2020  tainer(.        
-000124e0: 2020 2020 6964 3d27 436f 6c6c 6563 7469      id='Collecti
-000124f0: 6f6e 5769 7468 496e 6465 7869 6e67 506f  onWithIndexingPo
-00012500: 6c69 6379 2027 202b 2073 7472 2875 7569  licy ' + str(uui
-00012510: 642e 7575 6964 3428 2929 2c0a 2020 2020  d.uuid4()),.    
-00012520: 2020 2020 2020 2020 696e 6465 7869 6e67          indexing
-00012530: 5f70 6f6c 6963 793d 7b0a 2020 2020 2020  _policy={.      
-00012540: 2020 2020 2020 2020 2020 2761 7574 6f6d            'autom
-00012550: 6174 6963 273a 2054 7275 652c 0a20 2020  atic': True,.   
-00012560: 2020 2020 2020 2020 2020 2020 2027 696e               'in
-00012570: 6465 7869 6e67 4d6f 6465 273a 2064 6f63  dexingMode': doc
-00012580: 756d 656e 7473 2e49 6e64 6578 696e 674d  uments.IndexingM
-00012590: 6f64 652e 436f 6e73 6973 7465 6e74 2c0a  ode.Consistent,.
-000125a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000125b0: 2769 6e63 6c75 6465 6450 6174 6873 273a  'includedPaths':
-000125c0: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
-000125d0: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-000125e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000125f0: 2027 7061 7468 273a 2027 2f27 2c0a 2020   'path': '/',.  
-00012600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012610: 2020 2020 2020 2769 6e64 6578 6573 273a        'indexes':
-00012620: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
-00012630: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-00012640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012660: 2027 6b69 6e64 273a 2064 6f63 756d 656e   'kind': documen
-00012670: 7473 2e49 6e64 6578 4b69 6e64 2e48 6173  ts.IndexKind.Has
-00012680: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
-00012690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126a0: 2020 2027 6461 7461 5479 7065 273a 2064     'dataType': d
-000126b0: 6f63 756d 656e 7473 2e44 6174 6154 7970  ocuments.DataTyp
-000126c0: 652e 4e75 6d62 6572 2c0a 2020 2020 2020  e.Number,.      
-000126d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126e0: 2020 2020 2020 2020 2020 2770 7265 6369            'preci
-000126f0: 7369 6f6e 273a 2032 0a20 2020 2020 2020  sion': 2.       
-00012700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012710: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00012720: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-00012730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012740: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00012750: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
-00012760: 2020 2020 2020 2020 2020 2765 7863 6c75            'exclu
-00012770: 6465 6450 6174 6873 273a 205b 0a20 2020  dedPaths': [.   
-00012780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012790: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-000127a0: 2020 2020 2020 2020 2020 2027 7061 7468             'path
-000127b0: 273a 2027 2f22 7379 7374 656d 4d65 7461  ': '/"systemMeta
-000127c0: 6461 7461 222f 2a27 0a20 2020 2020 2020  data"/*'.       
-000127d0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-000127e0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-000127f0: 0a20 2020 2020 2020 2020 2020 207d 2c0a  .            },.
-00012800: 2020 2020 2020 2020 2020 2020 7061 7274              part
-00012810: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
-00012820: 696f 6e4b 6579 2870 6174 683d 272f 6964  ionKey(path='/id
-00012830: 272c 206b 696e 643d 2748 6173 6827 290a  ', kind='Hash').
-00012840: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00012850: 2020 2063 6f6c 6c65 6374 696f 6e5f 7769     collection_wi
-00012860: 7468 5f69 6e64 6578 696e 675f 706f 6c69  th_indexing_poli
-00012870: 6379 5f70 726f 7065 7274 6965 7320 3d20  cy_properties = 
-00012880: 6177 6169 7420 636f 6c6c 6563 7469 6f6e  await collection
-00012890: 5f77 6974 685f 696e 6465 7869 6e67 5f70  _with_indexing_p
-000128a0: 6f6c 6963 792e 7265 6164 2829 0a20 2020  olicy.read().   
-000128b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000128c0: 4571 7561 6c28 312c 0a20 2020 2020 2020  Equal(1,.       
-000128d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128e0: 2020 6c65 6e28 636f 6c6c 6563 7469 6f6e    len(collection
-000128f0: 5f77 6974 685f 696e 6465 7869 6e67 5f70  _with_indexing_p
-00012900: 6f6c 6963 795f 7072 6f70 6572 7469 6573  olicy_properties
-00012910: 5b27 696e 6465 7869 6e67 506f 6c69 6379  ['indexingPolicy
-00012920: 275d 5b27 696e 636c 7564 6564 5061 7468  ']['includedPath
-00012930: 7327 5d29 2c0a 2020 2020 2020 2020 2020  s']),.          
-00012940: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00012950: 556e 6578 7065 6374 6564 2069 6e63 6c75  Unexpected inclu
-00012960: 6465 6450 6174 6873 206c 656e 6774 6827  dedPaths length'
-00012970: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00012980: 7373 6572 7445 7175 616c 2832 2c0a 2020  ssertEqual(2,.  
-00012990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129a0: 2020 2020 2020 206c 656e 2863 6f6c 6c65         len(colle
-000129b0: 6374 696f 6e5f 7769 7468 5f69 6e64 6578  ction_with_index
-000129c0: 696e 675f 706f 6c69 6379 5f70 726f 7065  ing_policy_prope
-000129d0: 7274 6965 735b 2769 6e64 6578 696e 6750  rties['indexingP
-000129e0: 6f6c 6963 7927 5d5b 2765 7863 6c75 6465  olicy']['exclude
-000129f0: 6450 6174 6873 275d 292c 0a20 2020 2020  dPaths']),.     
-00012a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a10: 2020 2020 2755 6e65 7870 6563 7465 6420      'Unexpected 
-00012a20: 6578 636c 7564 6564 2070 6174 6820 636f  excluded path co
-00012a30: 756e 7427 290a 2020 2020 2020 2020 6177  unt').        aw
-00012a40: 6169 7420 6462 2e64 656c 6574 655f 636f  ait db.delete_co
-00012a50: 6e74 6169 6e65 7228 636f 6e74 6169 6e65  ntainer(containe
-00012a60: 723d 636f 6c6c 6563 7469 6f6e 5f77 6974  r=collection_wit
-00012a70: 685f 696e 6465 7869 6e67 5f70 6f6c 6963  h_indexing_polic
-00012a80: 7929 0a0a 2020 2020 6173 796e 6320 6465  y)..    async de
-00012a90: 6620 7465 7374 5f63 7265 6174 655f 6465  f test_create_de
-00012aa0: 6661 756c 745f 696e 6465 7869 6e67 5f70  fault_indexing_p
-00012ab0: 6f6c 6963 7928 7365 6c66 293a 0a20 2020  olicy(self):.   
-00012ac0: 2020 2020 2023 2063 7265 6174 6520 6461       # create da
-00012ad0: 7461 6261 7365 0a20 2020 2020 2020 2064  tabase.        d
-00012ae0: 6220 3d20 7365 6c66 2e64 6174 6162 6173  b = self.databas
-00012af0: 6546 6f72 5465 7374 0a0a 2020 2020 2020  eForTest..      
-00012b00: 2020 2320 6e6f 2069 6e64 6578 696e 6720    # no indexing 
-00012b10: 706f 6c69 6379 2073 7065 6369 6669 6564  policy specified
-00012b20: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
-00012b30: 696f 6e20 3d20 6177 6169 7420 6462 2e63  ion = await db.c
-00012b40: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
-00012b50: 0a20 2020 2020 2020 2020 2020 2069 643d  .            id=
-00012b60: 2774 6573 745f 6372 6561 7465 5f64 6566  'test_create_def
-00012b70: 6175 6c74 5f69 6e64 6578 696e 675f 706f  ault_indexing_po
-00012b80: 6c69 6379 2054 6573 7443 7265 6174 6544  licy TestCreateD
-00012b90: 6566 6175 6c74 506f 6c69 6379 3031 2720  efaultPolicy01' 
-00012ba0: 2b20 7374 7228 7575 6964 2e75 7569 6434  + str(uuid.uuid4
-00012bb0: 2829 292c 0a20 2020 2020 2020 2020 2020  ()),.           
-00012bc0: 2070 6172 7469 7469 6f6e 5f6b 6579 3d50   partition_key=P
-00012bd0: 6172 7469 7469 6f6e 4b65 7928 7061 7468  artitionKey(path
-00012be0: 3d27 2f69 6427 2c20 6b69 6e64 3d27 4861  ='/id', kind='Ha
-00012bf0: 7368 2729 0a20 2020 2020 2020 2029 0a20  sh').        ). 
-00012c00: 2020 2020 2020 2063 6f6c 6c65 6374 696f         collectio
-00012c10: 6e5f 7072 6f70 6572 7469 6573 203d 2061  n_properties = a
-00012c20: 7761 6974 2063 6f6c 6c65 6374 696f 6e2e  wait collection.
-00012c30: 7265 6164 2829 0a20 2020 2020 2020 2061  read().        a
-00012c40: 7761 6974 2073 656c 662e 5f63 6865 636b  wait self._check
-00012c50: 5f64 6566 6175 6c74 5f69 6e64 6578 696e  _default_indexin
-00012c60: 675f 706f 6c69 6379 5f70 6174 6873 2863  g_policy_paths(c
-00012c70: 6f6c 6c65 6374 696f 6e5f 7072 6f70 6572  ollection_proper
-00012c80: 7469 6573 5b27 696e 6465 7869 6e67 506f  ties['indexingPo
-00012c90: 6c69 6379 275d 290a 2020 2020 2020 2020  licy']).        
-00012ca0: 6177 6169 7420 6462 2e64 656c 6574 655f  await db.delete_
-00012cb0: 636f 6e74 6169 6e65 7228 636f 6e74 6169  container(contai
-00012cc0: 6e65 723d 636f 6c6c 6563 7469 6f6e 290a  ner=collection).
-00012cd0: 0a20 2020 2020 2020 2023 2070 6172 7469  .        # parti
-00012ce0: 616c 2070 6f6c 6963 7920 7370 6563 6966  al policy specif
-00012cf0: 6965 640a 2020 2020 2020 2020 636f 6c6c  ied.        coll
-00012d00: 6563 7469 6f6e 203d 2061 7761 6974 2064  ection = await d
-00012d10: 622e 6372 6561 7465 5f63 6f6e 7461 696e  b.create_contain
-00012d20: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
-00012d30: 6964 3d27 7465 7374 5f63 7265 6174 655f  id='test_create_
-00012d40: 6465 6661 756c 745f 696e 6465 7869 6e67  default_indexing
-00012d50: 5f70 6f6c 6963 7920 5465 7374 4372 6561  _policy TestCrea
-00012d60: 7465 4465 6661 756c 7450 6f6c 6963 7930  teDefaultPolicy0
-00012d70: 3127 202b 2073 7472 2875 7569 642e 7575  1' + str(uuid.uu
-00012d80: 6964 3428 2929 2c0a 2020 2020 2020 2020  id4()),.        
-00012d90: 2020 2020 696e 6465 7869 6e67 5f70 6f6c      indexing_pol
-00012da0: 6963 793d 7b0a 2020 2020 2020 2020 2020  icy={.          
-00012db0: 2020 2020 2020 2769 6e64 6578 696e 674d        'indexingM
-00012dc0: 6f64 6527 3a20 646f 6375 6d65 6e74 732e  ode': documents.
-00012dd0: 496e 6465 7869 6e67 4d6f 6465 2e43 6f6e  IndexingMode.Con
-00012de0: 7369 7374 656e 742c 2027 6175 746f 6d61  sistent, 'automa
-00012df0: 7469 6327 3a20 5472 7565 0a20 2020 2020  tic': True.     
-00012e00: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
-00012e10: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
-00012e20: 6b65 793d 5061 7274 6974 696f 6e4b 6579  key=PartitionKey
-00012e30: 2870 6174 683d 272f 6964 272c 206b 696e  (path='/id', kin
-00012e40: 643d 2748 6173 6827 290a 2020 2020 2020  d='Hash').      
-00012e50: 2020 290a 2020 2020 2020 2020 636f 6c6c    ).        coll
-00012e60: 6563 7469 6f6e 5f70 726f 7065 7274 6965  ection_propertie
-00012e70: 7320 3d20 6177 6169 7420 636f 6c6c 6563  s = await collec
-00012e80: 7469 6f6e 2e72 6561 6428 290a 2020 2020  tion.read().    
-00012e90: 2020 2020 6177 6169 7420 7365 6c66 2e5f      await self._
-00012ea0: 6368 6563 6b5f 6465 6661 756c 745f 696e  check_default_in
-00012eb0: 6465 7869 6e67 5f70 6f6c 6963 795f 7061  dexing_policy_pa
-00012ec0: 7468 7328 636f 6c6c 6563 7469 6f6e 5f70  ths(collection_p
-00012ed0: 726f 7065 7274 6965 735b 2769 6e64 6578  roperties['index
-00012ee0: 696e 6750 6f6c 6963 7927 5d29 0a20 2020  ingPolicy']).   
-00012ef0: 2020 2020 2061 7761 6974 2064 622e 6465       await db.de
-00012f00: 6c65 7465 5f63 6f6e 7461 696e 6572 2863  lete_container(c
-00012f10: 6f6e 7461 696e 6572 3d63 6f6c 6c65 6374  ontainer=collect
-00012f20: 696f 6e29 0a0a 2020 2020 2020 2020 2320  ion)..        # 
-00012f30: 6465 6661 756c 7420 706f 6c69 6379 0a20  default policy. 
-00012f40: 2020 2020 2020 2063 6f6c 6c65 6374 696f         collectio
-00012f50: 6e20 3d20 6177 6169 7420 6462 2e63 7265  n = await db.cre
-00012f60: 6174 655f 636f 6e74 6169 6e65 7228 0a20  ate_container(. 
-00012f70: 2020 2020 2020 2020 2020 2069 643d 2774             id='t
-00012f80: 6573 745f 6372 6561 7465 5f64 6566 6175  est_create_defau
-00012f90: 6c74 5f69 6e64 6578 696e 675f 706f 6c69  lt_indexing_poli
-00012fa0: 6379 2054 6573 7443 7265 6174 6544 6566  cy TestCreateDef
-00012fb0: 6175 6c74 506f 6c69 6379 3033 2720 2b20  aultPolicy03' + 
-00012fc0: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
-00012fd0: 292c 0a20 2020 2020 2020 2020 2020 2069  ),.            i
-00012fe0: 6e64 6578 696e 675f 706f 6c69 6379 3d7b  ndexing_policy={
-00012ff0: 7d2c 0a20 2020 2020 2020 2020 2020 2070  },.            p
-00013000: 6172 7469 7469 6f6e 5f6b 6579 3d50 6172  artition_key=Par
-00013010: 7469 7469 6f6e 4b65 7928 7061 7468 3d27  titionKey(path='
-00013020: 2f69 6427 2c20 6b69 6e64 3d27 4861 7368  /id', kind='Hash
-00013030: 2729 0a20 2020 2020 2020 2029 0a20 2020  ').        ).   
-00013040: 2020 2020 2063 6f6c 6c65 6374 696f 6e5f       collection_
-00013050: 7072 6f70 6572 7469 6573 203d 2061 7761  properties = awa
-00013060: 6974 2063 6f6c 6c65 6374 696f 6e2e 7265  it collection.re
-00013070: 6164 2829 0a20 2020 2020 2020 2061 7761  ad().        awa
-00013080: 6974 2073 656c 662e 5f63 6865 636b 5f64  it self._check_d
-00013090: 6566 6175 6c74 5f69 6e64 6578 696e 675f  efault_indexing_
-000130a0: 706f 6c69 6379 5f70 6174 6873 2863 6f6c  policy_paths(col
-000130b0: 6c65 6374 696f 6e5f 7072 6f70 6572 7469  lection_properti
-000130c0: 6573 5b27 696e 6465 7869 6e67 506f 6c69  es['indexingPoli
-000130d0: 6379 275d 290a 2020 2020 2020 2020 6177  cy']).        aw
-000130e0: 6169 7420 6462 2e64 656c 6574 655f 636f  ait db.delete_co
-000130f0: 6e74 6169 6e65 7228 636f 6e74 6169 6e65  ntainer(containe
-00013100: 723d 636f 6c6c 6563 7469 6f6e 290a 0a20  r=collection).. 
-00013110: 2020 2020 2020 2023 206d 6973 7369 6e67         # missing
-00013120: 2069 6e64 6578 6573 0a20 2020 2020 2020   indexes.       
-00013130: 2063 6f6c 6c65 6374 696f 6e20 3d20 6177   collection = aw
-00013140: 6169 7420 6462 2e63 7265 6174 655f 636f  ait db.create_co
-00013150: 6e74 6169 6e65 7228 0a20 2020 2020 2020  ntainer(.       
-00013160: 2020 2020 2069 643d 2774 6573 745f 6372       id='test_cr
-00013170: 6561 7465 5f64 6566 6175 6c74 5f69 6e64  eate_default_ind
-00013180: 6578 696e 675f 706f 6c69 6379 2054 6573  exing_policy Tes
-00013190: 7443 7265 6174 6544 6566 6175 6c74 506f  tCreateDefaultPo
-000131a0: 6c69 6379 3034 2720 2b20 7374 7228 7575  licy04' + str(uu
-000131b0: 6964 2e75 7569 6434 2829 292c 0a20 2020  id.uuid4()),.   
-000131c0: 2020 2020 2020 2020 2069 6e64 6578 696e           indexin
-000131d0: 675f 706f 6c69 6379 3d7b 0a20 2020 2020  g_policy={.     
-000131e0: 2020 2020 2020 2020 2020 2027 696e 636c             'incl
-000131f0: 7564 6564 5061 7468 7327 3a20 5b0a 2020  udedPaths': [.  
-00013200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013210: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
-00013220: 2020 2020 2020 2020 2020 2020 2770 6174              'pat
-00013230: 6827 3a20 272f 2a27 0a20 2020 2020 2020  h': '/*'.       
-00013240: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-00013250: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-00013260: 0a20 2020 2020 2020 2020 2020 207d 2c0a  .            },.
-00013270: 2020 2020 2020 2020 2020 2020 7061 7274              part
-00013280: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
-00013290: 696f 6e4b 6579 2870 6174 683d 272f 6964  ionKey(path='/id
-000132a0: 272c 206b 696e 643d 2748 6173 6827 290a  ', kind='Hash').
-000132b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000132c0: 2020 636f 6c6c 6563 7469 6f6e 5f70 726f    collection_pro
-000132d0: 7065 7274 6965 7320 3d20 6177 6169 7420  perties = await 
-000132e0: 636f 6c6c 6563 7469 6f6e 2e72 6561 6428  collection.read(
-000132f0: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
-00013300: 7365 6c66 2e5f 6368 6563 6b5f 6465 6661  self._check_defa
-00013310: 756c 745f 696e 6465 7869 6e67 5f70 6f6c  ult_indexing_pol
-00013320: 6963 795f 7061 7468 7328 636f 6c6c 6563  icy_paths(collec
-00013330: 7469 6f6e 5f70 726f 7065 7274 6965 735b  tion_properties[
-00013340: 2769 6e64 6578 696e 6750 6f6c 6963 7927  'indexingPolicy'
-00013350: 5d29 0a20 2020 2020 2020 2061 7761 6974  ]).        await
-00013360: 2064 622e 6465 6c65 7465 5f63 6f6e 7461   db.delete_conta
-00013370: 696e 6572 2863 6f6e 7461 696e 6572 3d63  iner(container=c
-00013380: 6f6c 6c65 6374 696f 6e29 0a0a 2020 2020  ollection)..    
-00013390: 2020 2020 2320 6d69 7373 696e 6720 7072      # missing pr
-000133a0: 6563 6973 696f 6e0a 2020 2020 2020 2020  ecision.        
-000133b0: 636f 6c6c 6563 7469 6f6e 203d 2061 7761  collection = awa
-000133c0: 6974 2064 622e 6372 6561 7465 5f63 6f6e  it db.create_con
-000133d0: 7461 696e 6572 280a 2020 2020 2020 2020  tainer(.        
-000133e0: 2020 2020 6964 3d27 7465 7374 5f63 7265      id='test_cre
-000133f0: 6174 655f 6465 6661 756c 745f 696e 6465  ate_default_inde
-00013400: 7869 6e67 5f70 6f6c 6963 7920 5465 7374  xing_policy Test
-00013410: 4372 6561 7465 4465 6661 756c 7450 6f6c  CreateDefaultPol
-00013420: 6963 7930 3527 202b 2073 7472 2875 7569  icy05' + str(uui
-00013430: 642e 7575 6964 3428 2929 2c0a 2020 2020  d.uuid4()),.    
-00013440: 2020 2020 2020 2020 696e 6465 7869 6e67          indexing
-00013450: 5f70 6f6c 6963 793d 7b0a 2020 2020 2020  _policy={.      
-00013460: 2020 2020 2020 2020 2020 2769 6e63 6c75            'inclu
-00013470: 6465 6450 6174 6873 273a 205b 0a20 2020  dedPaths': [.   
-00013480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013490: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-000134a0: 2020 2020 2020 2020 2020 2027 7061 7468             'path
-000134b0: 273a 2027 2f2a 272c 0a20 2020 2020 2020  ': '/*',.       
-000134c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134d0: 2027 696e 6465 7865 7327 3a20 5b0a 2020   'indexes': [.  
-000134e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134f0: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
-00013500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013510: 2020 2020 2020 2020 2020 2020 276b 696e              'kin
-00013520: 6427 3a20 646f 6375 6d65 6e74 732e 496e  d': documents.In
-00013530: 6465 784b 696e 642e 4861 7368 2c0a 2020  dexKind.Hash,.  
-00013540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013550: 2020 2020 2020 2020 2020 2020 2020 2764                'd
-00013560: 6174 6154 7970 6527 3a20 646f 6375 6d65  ataType': docume
-00013570: 6e74 732e 4461 7461 5479 7065 2e53 7472  nts.DataType.Str
-00013580: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00013590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135a0: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-000135b0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-000135c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000135d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135e0: 2027 6b69 6e64 273a 2064 6f63 756d 656e   'kind': documen
-000135f0: 7473 2e49 6e64 6578 4b69 6e64 2e52 616e  ts.IndexKind.Ran
-00013600: 6765 2c0a 2020 2020 2020 2020 2020 2020  ge,.            
-00013610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013620: 2020 2020 2764 6174 6154 7970 6527 3a20      'dataType': 
-00013630: 646f 6375 6d65 6e74 732e 4461 7461 5479  documents.DataTy
-00013640: 7065 2e4e 756d 6265 720a 2020 2020 2020  pe.Number.      
-00013650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013660: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00013670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013680: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00013690: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-000136a0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-000136b0: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
-000136c0: 2020 2020 2070 6172 7469 7469 6f6e 5f6b       partition_k
-000136d0: 6579 3d50 6172 7469 7469 6f6e 4b65 7928  ey=PartitionKey(
-000136e0: 7061 7468 3d27 2f69 6427 2c20 6b69 6e64  path='/id', kind
-000136f0: 3d27 4861 7368 2729 0a20 2020 2020 2020  ='Hash').       
-00013700: 2029 0a20 2020 2020 2020 2063 6f6c 6c65   ).        colle
-00013710: 6374 696f 6e5f 7072 6f70 6572 7469 6573  ction_properties
-00013720: 203d 2061 7761 6974 2063 6f6c 6c65 6374   = await collect
-00013730: 696f 6e2e 7265 6164 2829 0a20 2020 2020  ion.read().     
-00013740: 2020 2061 7761 6974 2073 656c 662e 5f63     await self._c
-00013750: 6865 636b 5f64 6566 6175 6c74 5f69 6e64  heck_default_ind
-00013760: 6578 696e 675f 706f 6c69 6379 5f70 6174  exing_policy_pat
-00013770: 6873 2863 6f6c 6c65 6374 696f 6e5f 7072  hs(collection_pr
-00013780: 6f70 6572 7469 6573 5b27 696e 6465 7869  operties['indexi
-00013790: 6e67 506f 6c69 6379 275d 290a 2020 2020  ngPolicy']).    
-000137a0: 2020 2020 6177 6169 7420 6462 2e64 656c      await db.del
-000137b0: 6574 655f 636f 6e74 6169 6e65 7228 636f  ete_container(co
-000137c0: 6e74 6169 6e65 723d 636f 6c6c 6563 7469  ntainer=collecti
-000137d0: 6f6e 290a 0a20 2020 2061 7379 6e63 2064  on)..    async d
-000137e0: 6566 2074 6573 745f 6372 6561 7465 5f69  ef test_create_i
-000137f0: 6e64 6578 696e 675f 706f 6c69 6379 5f77  ndexing_policy_w
-00013800: 6974 685f 636f 6d70 6f73 6974 655f 616e  ith_composite_an
-00013810: 645f 7370 6174 6961 6c5f 696e 6465 7865  d_spatial_indexe
-00013820: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-00013830: 2023 2063 7265 6174 6520 6461 7461 6261   # create databa
-00013840: 7365 0a20 2020 2020 2020 2064 6220 3d20  se.        db = 
-00013850: 7365 6c66 2e64 6174 6162 6173 6546 6f72  self.databaseFor
-00013860: 5465 7374 0a0a 2020 2020 2020 2020 696e  Test..        in
-00013870: 6465 7869 6e67 5f70 6f6c 6963 7920 3d20  dexing_policy = 
-00013880: 7b0a 2020 2020 2020 2020 2020 2020 2273  {.            "s
-00013890: 7061 7469 616c 496e 6465 7865 7322 3a20  patialIndexes": 
-000138a0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-000138b0: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
-000138c0: 2020 2020 2020 2020 2270 6174 6822 3a20          "path": 
-000138d0: 222f 7061 7468 302f 2a22 2c0a 2020 2020  "/path0/*",.    
-000138e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138f0: 2274 7970 6573 223a 205b 0a20 2020 2020  "types": [.     
-00013900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013910: 2020 2022 506f 696e 7422 2c0a 2020 2020     "Point",.    
-00013920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013930: 2020 2020 224c 696e 6553 7472 696e 6722      "LineString"
-00013940: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013950: 2020 2020 2020 2020 2020 2250 6f6c 7967            "Polyg
-00013960: 6f6e 222c 0a20 2020 2020 2020 2020 2020  on",.           
-00013970: 2020 2020 2020 2020 2020 2020 2022 4d75               "Mu
-00013980: 6c74 6950 6f6c 7967 6f6e 220a 2020 2020  ltiPolygon".    
-00013990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000139b0: 2020 7d2c 0a20 2020 2020 2020 2020 2020    },.           
-000139c0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-000139d0: 2020 2020 2020 2020 2020 2022 7061 7468             "path
-000139e0: 223a 2022 2f70 6174 6831 2f2a 222c 0a20  ": "/path1/*",. 
-000139f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a00: 2020 2022 7479 7065 7322 3a20 5b0a 2020     "types": [.  
-00013a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a20: 2020 2020 2020 2250 6f69 6e74 222c 0a20        "Point",. 
-00013a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a40: 2020 2020 2020 2022 4c69 6e65 5374 7269         "LineStri
-00013a50: 6e67 222c 0a20 2020 2020 2020 2020 2020  ng",.           
-00013a60: 2020 2020 2020 2020 2020 2020 2022 506f               "Po
-00013a70: 6c79 676f 6e22 2c0a 2020 2020 2020 2020  lygon",.        
-00013a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a90: 224d 756c 7469 506f 6c79 676f 6e22 0a20  "MultiPolygon". 
-00013aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ab0: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
-00013ac0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00013ad0: 2020 205d 2c0a 2020 2020 2020 2020 2020     ],.          
-00013ae0: 2020 2263 6f6d 706f 7369 7465 496e 6465    "compositeInde
-00013af0: 7865 7322 3a20 5b0a 2020 2020 2020 2020  xes": [.        
-00013b00: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
-00013b10: 2020 2020 2020 2020 2020 2020 2020 7b0a                {.
+00011690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116a0: 2020 2020 2020 2072 6570 6c61 6365 645f         replaced_
+000116b0: 7370 726f 635b 2769 6427 5d29 0a0a 2020  sproc['id'])..  
+000116c0: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
+000116d0: 5f73 6372 6970 745f 6c6f 6767 696e 675f  _script_logging_
+000116e0: 6578 6563 7574 655f 7374 6f72 6564 5f70  execute_stored_p
+000116f0: 726f 6365 6475 7265 2873 656c 6629 3a0a  rocedure(self):.
+00011700: 2020 2020 2020 2020 6372 6561 7465 645f          created_
+00011710: 6462 203d 2073 656c 662e 6461 7461 6261  db = self.databa
+00011720: 7365 466f 7254 6573 740a 0a20 2020 2020  seForTest..     
+00011730: 2020 2063 7265 6174 6564 5f63 6f6c 6c65     created_colle
+00011740: 6374 696f 6e20 3d20 6177 6169 7420 7365  ction = await se
+00011750: 6c66 2e64 6174 6162 6173 6546 6f72 5465  lf.databaseForTe
+00011760: 7374 2e63 7265 6174 655f 636f 6e74 6169  st.create_contai
+00011770: 6e65 7228 7465 7374 5f63 6f6e 6669 672e  ner(test_config.
+00011780: 5f74 6573 745f 636f 6e66 6967 2e54 4553  _test_config.TES
+00011790: 545f 434f 4c4c 4543 5449 4f4e 5f4d 554c  T_COLLECTION_MUL
+000117a0: 5449 5f50 4152 5449 5449 4f4e 290a 0a20  TI_PARTITION).. 
+000117b0: 2020 2020 2020 2073 7072 6f63 203d 207b         sproc = {
+000117c0: 0a20 2020 2020 2020 2020 2020 2027 6964  .            'id
+000117d0: 273a 2027 7374 6f72 6564 5072 6f63 6564  ': 'storedProced
+000117e0: 7572 6527 202b 2073 7472 2875 7569 642e  ure' + str(uuid.
+000117f0: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
+00011800: 2020 2020 2020 2762 6f64 7927 3a20 280a        'body': (.
+00011810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011820: 2020 2020 2766 756e 6374 696f 6e20 2829      'function ()
+00011830: 207b 2720 2b0a 2020 2020 2020 2020 2020   {' +.          
+00011840: 2020 2020 2020 2020 2020 2720 2020 7661            '   va
+00011850: 7220 6d79 7465 7874 203d 205c 2778 5c27  r mytext = \'x\'
+00011860: 3b27 202b 0a20 2020 2020 2020 2020 2020  ;' +.           
+00011870: 2020 2020 2020 2020 2027 2020 2076 6172           '   var
+00011880: 206d 7976 616c 203d 2031 3b27 202b 0a20   myval = 1;' +. 
+00011890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118a0: 2020 2027 2020 2074 7279 207b 2720 2b0a     '   try {' +.
+000118b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118c0: 2020 2020 2720 2020 2020 2020 636f 6e73      '       cons
+000118d0: 6f6c 652e 6c6f 6728 5c27 5468 6520 7661  ole.log(\'The va
+000118e0: 6c75 6520 6f66 2025 7320 6973 2025 732e  lue of %s is %s.
+000118f0: 5c27 2c20 6d79 7465 7874 2c20 6d79 7661  \', mytext, myva
+00011900: 6c29 3b27 202b 0a20 2020 2020 2020 2020  l);' +.         
+00011910: 2020 2020 2020 2020 2020 2027 2020 2020             '    
+00011920: 2020 2067 6574 436f 6e74 6578 7428 292e     getContext().
+00011930: 6765 7452 6573 706f 6e73 6528 292e 7365  getResponse().se
+00011940: 7442 6f64 7928 5c27 5375 6363 6573 7321  tBody(\'Success!
+00011950: 5c27 293b 2720 2b0a 2020 2020 2020 2020  \');' +.        
+00011960: 2020 2020 2020 2020 2020 2020 2720 2020              '   
+00011970: 7d27 202b 0a20 2020 2020 2020 2020 2020  }' +.           
+00011980: 2020 2020 2020 2020 2027 2020 2063 6174           '   cat
+00011990: 6368 2028 6572 7229 207b 2720 2b0a 2020  ch (err) {' +.  
+000119a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119b0: 2020 2720 2020 2020 2020 6765 7443 6f6e    '       getCon
+000119c0: 7465 7874 2829 2e67 6574 5265 7370 6f6e  text().getRespon
+000119d0: 7365 2829 2e73 6574 426f 6479 285c 2769  se().setBody(\'i
+000119e0: 6e6c 696e 6520 6572 723a 205b 5c27 202b  nline err: [\' +
+000119f0: 2065 7272 2e6e 756d 6265 7220 2b20 5c27   err.number + \'
+00011a00: 5d20 5c27 202b 2065 7272 293b 2720 2b0a  ] \' + err);' +.
+00011a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a20: 2020 2020 2720 2020 7d27 0a20 2020 2020      '   }'.     
+00011a30: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00011a40: 7d27 290a 2020 2020 2020 2020 7d0a 0a20  }').        }.. 
+00011a50: 2020 2020 2020 2063 7265 6174 6564 5f73         created_s
+00011a60: 7072 6f63 203d 2061 7761 6974 2063 7265  proc = await cre
+00011a70: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
+00011a80: 7363 7269 7074 732e 6372 6561 7465 5f73  scripts.create_s
+00011a90: 746f 7265 645f 7072 6f63 6564 7572 6528  tored_procedure(
+00011aa0: 626f 6479 3d73 7072 6f63 290a 0a20 2020  body=sproc)..   
+00011ab0: 2020 2020 2072 6573 756c 7420 3d20 6177       result = aw
+00011ac0: 6169 7420 6372 6561 7465 645f 636f 6c6c  ait created_coll
+00011ad0: 6563 7469 6f6e 2e73 6372 6970 7473 2e65  ection.scripts.e
+00011ae0: 7865 6375 7465 5f73 746f 7265 645f 7072  xecute_stored_pr
+00011af0: 6f63 6564 7572 6528 0a20 2020 2020 2020  ocedure(.       
+00011b00: 2020 2020 2073 7072 6f63 3d63 7265 6174       sproc=creat
+00011b10: 6564 5f73 7072 6f63 5b27 6964 275d 2c0a  ed_sproc['id'],.
+00011b20: 2020 2020 2020 2020 2020 2020 7061 7274              part
+00011b30: 6974 696f 6e5f 6b65 793d 310a 2020 2020  ition_key=1.    
+00011b40: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
+00011b50: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00011b60: 7265 7375 6c74 2c20 2753 7563 6365 7373  result, 'Success
+00011b70: 2127 290a 2020 2020 2020 2020 7365 6c66  !').        self
+00011b80: 2e61 7373 6572 7446 616c 7365 280a 2020  .assertFalse(.  
+00011b90: 2020 2020 2020 2020 2020 4874 7470 4865            HttpHe
+00011ba0: 6164 6572 732e 5363 7269 7074 4c6f 6752  aders.ScriptLogR
+00011bb0: 6573 756c 7473 2069 6e20 6372 6561 7465  esults in create
+00011bc0: 645f 636f 6c6c 6563 7469 6f6e 2e73 6372  d_collection.scr
+00011bd0: 6970 7473 2e63 6c69 656e 745f 636f 6e6e  ipts.client_conn
+00011be0: 6563 7469 6f6e 2e6c 6173 745f 7265 7370  ection.last_resp
+00011bf0: 6f6e 7365 5f68 6561 6465 7273 290a 0a20  onse_headers).. 
+00011c00: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00011c10: 6177 6169 7420 6372 6561 7465 645f 636f  await created_co
+00011c20: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
+00011c30: 2e65 7865 6375 7465 5f73 746f 7265 645f  .execute_stored_
+00011c40: 7072 6f63 6564 7572 6528 0a20 2020 2020  procedure(.     
+00011c50: 2020 2020 2020 2073 7072 6f63 3d63 7265         sproc=cre
+00011c60: 6174 6564 5f73 7072 6f63 5b27 6964 275d  ated_sproc['id']
+00011c70: 2c0a 2020 2020 2020 2020 2020 2020 656e  ,.            en
+00011c80: 6162 6c65 5f73 6372 6970 745f 6c6f 6767  able_script_logg
+00011c90: 696e 673d 5472 7565 2c0a 2020 2020 2020  ing=True,.      
+00011ca0: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+00011cb0: 6b65 793d 310a 2020 2020 2020 2020 290a  key=1.        ).
+00011cc0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00011cd0: 7365 7274 4571 7561 6c28 7265 7375 6c74  sertEqual(result
+00011ce0: 2c20 2753 7563 6365 7373 2127 290a 2020  , 'Success!').  
+00011cf0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00011d00: 7445 7175 616c 2875 726c 6c69 622e 7175  tEqual(urllib.qu
+00011d10: 6f74 6528 2754 6865 2076 616c 7565 206f  ote('The value o
+00011d20: 6620 7820 6973 2031 2e27 292c 0a20 2020  f x is 1.'),.   
+00011d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d40: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
+00011d50: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
+00011d60: 2e63 6c69 656e 745f 636f 6e6e 6563 7469  .client_connecti
+00011d70: 6f6e 2e6c 6173 745f 7265 7370 6f6e 7365  on.last_response
+00011d80: 5f68 6561 6465 7273 2e67 6574 280a 2020  _headers.get(.  
+00011d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011da0: 2020 2020 2020 2020 2020 2048 7474 7048             HttpH
+00011db0: 6561 6465 7273 2e53 6372 6970 744c 6f67  eaders.ScriptLog
+00011dc0: 5265 7375 6c74 7329 290a 0a20 2020 2020  Results))..     
+00011dd0: 2020 2072 6573 756c 7420 3d20 6177 6169     result = awai
+00011de0: 7420 6372 6561 7465 645f 636f 6c6c 6563  t created_collec
+00011df0: 7469 6f6e 2e73 6372 6970 7473 2e65 7865  tion.scripts.exe
+00011e00: 6375 7465 5f73 746f 7265 645f 7072 6f63  cute_stored_proc
+00011e10: 6564 7572 6528 0a20 2020 2020 2020 2020  edure(.         
+00011e20: 2020 2073 7072 6f63 3d63 7265 6174 6564     sproc=created
+00011e30: 5f73 7072 6f63 5b27 6964 275d 2c0a 2020  _sproc['id'],.  
+00011e40: 2020 2020 2020 2020 2020 656e 6162 6c65            enable
+00011e50: 5f73 6372 6970 745f 6c6f 6767 696e 673d  _script_logging=
+00011e60: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+00011e70: 2020 2070 6172 7469 7469 6f6e 5f6b 6579     partition_key
+00011e80: 3d31 0a20 2020 2020 2020 2029 0a0a 2020  =1.        )..  
+00011e90: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00011ea0: 7445 7175 616c 2872 6573 756c 742c 2027  tEqual(result, '
+00011eb0: 5375 6363 6573 7321 2729 0a20 2020 2020  Success!').     
+00011ec0: 2020 2073 656c 662e 6173 7365 7274 4661     self.assertFa
+00011ed0: 6c73 6528 0a20 2020 2020 2020 2020 2020  lse(.           
+00011ee0: 2048 7474 7048 6561 6465 7273 2e53 6372   HttpHeaders.Scr
+00011ef0: 6970 744c 6f67 5265 7375 6c74 7320 696e  iptLogResults in
+00011f00: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
+00011f10: 696f 6e2e 7363 7269 7074 732e 636c 6965  ion.scripts.clie
+00011f20: 6e74 5f63 6f6e 6e65 6374 696f 6e2e 6c61  nt_connection.la
+00011f30: 7374 5f72 6573 706f 6e73 655f 6865 6164  st_response_head
+00011f40: 6572 7329 0a0a 2020 2020 6173 796e 6320  ers)..    async 
+00011f50: 6465 6620 7465 7374 5f63 6f6c 6c65 6374  def test_collect
+00011f60: 696f 6e5f 696e 6465 7869 6e67 5f70 6f6c  ion_indexing_pol
+00011f70: 6963 7928 7365 6c66 293a 0a20 2020 2020  icy(self):.     
+00011f80: 2020 2023 2063 7265 6174 6520 6461 7461     # create data
+00011f90: 6261 7365 0a20 2020 2020 2020 2064 6220  base.        db 
+00011fa0: 3d20 7365 6c66 2e64 6174 6162 6173 6546  = self.databaseF
+00011fb0: 6f72 5465 7374 0a20 2020 2020 2020 2023  orTest.        #
+00011fc0: 2063 7265 6174 6520 636f 6c6c 6563 7469   create collecti
+00011fd0: 6f6e 0a20 2020 2020 2020 2063 6f6c 6c65  on.        colle
+00011fe0: 6374 696f 6e20 3d20 6177 6169 7420 6462  ction = await db
+00011ff0: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
+00012000: 7228 0a20 2020 2020 2020 2020 2020 2069  r(.            i
+00012010: 643d 2774 6573 745f 636f 6c6c 6563 7469  d='test_collecti
+00012020: 6f6e 5f69 6e64 6578 696e 675f 706f 6c69  on_indexing_poli
+00012030: 6379 2064 6566 6175 6c74 2070 6f6c 6963  cy default polic
+00012040: 7927 202b 2073 7472 2875 7569 642e 7575  y' + str(uuid.uu
+00012050: 6964 3428 2929 2c0a 2020 2020 2020 2020  id4()),.        
+00012060: 2020 2020 7061 7274 6974 696f 6e5f 6b65      partition_ke
+00012070: 793d 5061 7274 6974 696f 6e4b 6579 2870  y=PartitionKey(p
+00012080: 6174 683d 272f 6964 272c 206b 696e 643d  ath='/id', kind=
+00012090: 2748 6173 6827 290a 2020 2020 2020 2020  'Hash').        
+000120a0: 290a 0a20 2020 2020 2020 2063 6f6c 6c65  )..        colle
+000120b0: 6374 696f 6e5f 7072 6f70 6572 7469 6573  ction_properties
+000120c0: 203d 2061 7761 6974 2063 6f6c 6c65 6374   = await collect
+000120d0: 696f 6e2e 7265 6164 2829 0a20 2020 2020  ion.read().     
+000120e0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000120f0: 7561 6c28 636f 6c6c 6563 7469 6f6e 5f70  ual(collection_p
+00012100: 726f 7065 7274 6965 735b 2769 6e64 6578  roperties['index
+00012110: 696e 6750 6f6c 6963 7927 5d5b 2769 6e64  ingPolicy']['ind
+00012120: 6578 696e 674d 6f64 6527 5d2c 0a20 2020  exingMode'],.   
+00012130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012140: 2020 2020 2020 646f 6375 6d65 6e74 732e        documents.
+00012150: 496e 6465 7869 6e67 4d6f 6465 2e43 6f6e  IndexingMode.Con
+00012160: 7369 7374 656e 742c 0a20 2020 2020 2020  sistent,.       
+00012170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012180: 2020 2764 6566 6175 6c74 2069 6e64 6578    'default index
+00012190: 696e 6720 6d6f 6465 2073 686f 756c 6420  ing mode should 
+000121a0: 6265 2063 6f6e 7369 7374 656e 7427 290a  be consistent').
+000121b0: 0a20 2020 2020 2020 2061 7761 6974 2064  .        await d
+000121c0: 622e 6465 6c65 7465 5f63 6f6e 7461 696e  b.delete_contain
+000121d0: 6572 2863 6f6e 7461 696e 6572 3d63 6f6c  er(container=col
+000121e0: 6c65 6374 696f 6e29 0a0a 2020 2020 2020  lection)..      
+000121f0: 2020 636f 6e73 6973 7465 6e74 5f63 6f6c    consistent_col
+00012200: 6c65 6374 696f 6e20 3d20 6177 6169 7420  lection = await 
+00012210: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
+00012220: 6e65 7228 0a20 2020 2020 2020 2020 2020  ner(.           
+00012230: 2069 643d 2774 6573 745f 636f 6c6c 6563   id='test_collec
+00012240: 7469 6f6e 5f69 6e64 6578 696e 675f 706f  tion_indexing_po
+00012250: 6c69 6379 2063 6f6e 7369 7374 656e 7420  licy consistent 
+00012260: 636f 6c6c 6563 7469 6f6e 2027 202b 2073  collection ' + s
+00012270: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
+00012280: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
+00012290: 6465 7869 6e67 5f70 6f6c 6963 793d 7b0a  dexing_policy={.
+000122a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122b0: 2769 6e64 6578 696e 674d 6f64 6527 3a20  'indexingMode': 
+000122c0: 646f 6375 6d65 6e74 732e 496e 6465 7869  documents.Indexi
+000122d0: 6e67 4d6f 6465 2e43 6f6e 7369 7374 656e  ngMode.Consisten
+000122e0: 740a 2020 2020 2020 2020 2020 2020 7d2c  t.            },
+000122f0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00012300: 7469 7469 6f6e 5f6b 6579 3d50 6172 7469  tition_key=Parti
+00012310: 7469 6f6e 4b65 7928 7061 7468 3d27 2f69  tionKey(path='/i
+00012320: 6427 2c20 6b69 6e64 3d27 4861 7368 2729  d', kind='Hash')
+00012330: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00012340: 2020 2020 636f 6e73 6973 7465 6e74 5f63      consistent_c
+00012350: 6f6c 6c65 6374 696f 6e5f 7072 6f70 6572  ollection_proper
+00012360: 7469 6573 203d 2061 7761 6974 2063 6f6e  ties = await con
+00012370: 7369 7374 656e 745f 636f 6c6c 6563 7469  sistent_collecti
+00012380: 6f6e 2e72 6561 6428 290a 2020 2020 2020  on.read().      
+00012390: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000123a0: 616c 2863 6f6e 7369 7374 656e 745f 636f  al(consistent_co
+000123b0: 6c6c 6563 7469 6f6e 5f70 726f 7065 7274  llection_propert
+000123c0: 6965 735b 2769 6e64 6578 696e 6750 6f6c  ies['indexingPol
+000123d0: 6963 7927 5d5b 2769 6e64 6578 696e 674d  icy']['indexingM
+000123e0: 6f64 6527 5d2c 0a20 2020 2020 2020 2020  ode'],.         
+000123f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012400: 646f 6375 6d65 6e74 732e 496e 6465 7869  documents.Indexi
+00012410: 6e67 4d6f 6465 2e43 6f6e 7369 7374 656e  ngMode.Consisten
+00012420: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00012430: 2020 2020 2020 2020 2020 2020 2769 6e64              'ind
+00012440: 6578 696e 6720 6d6f 6465 2073 686f 756c  exing mode shoul
+00012450: 6420 6265 2063 6f6e 7369 7374 656e 7427  d be consistent'
+00012460: 290a 0a20 2020 2020 2020 2061 7761 6974  )..        await
+00012470: 2064 622e 6465 6c65 7465 5f63 6f6e 7461   db.delete_conta
+00012480: 696e 6572 2863 6f6e 7461 696e 6572 3d63  iner(container=c
+00012490: 6f6e 7369 7374 656e 745f 636f 6c6c 6563  onsistent_collec
+000124a0: 7469 6f6e 290a 0a20 2020 2020 2020 2063  tion)..        c
+000124b0: 6f6c 6c65 6374 696f 6e5f 7769 7468 5f69  ollection_with_i
+000124c0: 6e64 6578 696e 675f 706f 6c69 6379 203d  ndexing_policy =
+000124d0: 2061 7761 6974 2064 622e 6372 6561 7465   await db.create
+000124e0: 5f63 6f6e 7461 696e 6572 280a 2020 2020  _container(.    
+000124f0: 2020 2020 2020 2020 6964 3d27 436f 6c6c          id='Coll
+00012500: 6563 7469 6f6e 5769 7468 496e 6465 7869  ectionWithIndexi
+00012510: 6e67 506f 6c69 6379 2027 202b 2073 7472  ngPolicy ' + str
+00012520: 2875 7569 642e 7575 6964 3428 2929 2c0a  (uuid.uuid4()),.
+00012530: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00012540: 7869 6e67 5f70 6f6c 6963 793d 7b0a 2020  xing_policy={.  
+00012550: 2020 2020 2020 2020 2020 2020 2020 2761                'a
+00012560: 7574 6f6d 6174 6963 273a 2054 7275 652c  utomatic': True,
+00012570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012580: 2027 696e 6465 7869 6e67 4d6f 6465 273a   'indexingMode':
+00012590: 2064 6f63 756d 656e 7473 2e49 6e64 6578   documents.Index
+000125a0: 696e 674d 6f64 652e 436f 6e73 6973 7465  ingMode.Consiste
+000125b0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+000125c0: 2020 2020 2769 6e63 6c75 6465 6450 6174      'includedPat
+000125d0: 6873 273a 205b 0a20 2020 2020 2020 2020  hs': [.         
+000125e0: 2020 2020 2020 2020 2020 207b 0a20 2020             {.   
+000125f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012600: 2020 2020 2027 7061 7468 273a 2027 2f27       'path': '/'
+00012610: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00012620: 2020 2020 2020 2020 2020 2769 6e64 6578            'index
+00012630: 6573 273a 205b 0a20 2020 2020 2020 2020  es': [.         
+00012640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012650: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+00012660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012670: 2020 2020 2027 6b69 6e64 273a 2064 6f63       'kind': doc
+00012680: 756d 656e 7473 2e49 6e64 6578 4b69 6e64  uments.IndexKind
+00012690: 2e48 6173 682c 0a20 2020 2020 2020 2020  .Hash,.         
+000126a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126b0: 2020 2020 2020 2027 6461 7461 5479 7065         'dataType
+000126c0: 273a 2064 6f63 756d 656e 7473 2e44 6174  ': documents.Dat
+000126d0: 6154 7970 652e 4e75 6d62 6572 2c0a 2020  aType.Number,.  
+000126e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126f0: 2020 2020 2020 2020 2020 2020 2020 2770                'p
+00012700: 7265 6369 7369 6f6e 273a 2032 0a20 2020  recision': 2.   
+00012710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012720: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00012730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012740: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+00012750: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00012760: 2020 2020 2020 2020 2020 205d 2c0a 2020             ],.  
+00012770: 2020 2020 2020 2020 2020 2020 2020 2765                'e
+00012780: 7863 6c75 6465 6450 6174 6873 273a 205b  xcludedPaths': [
+00012790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000127a0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+000127b0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000127c0: 7061 7468 273a 2027 2f22 7379 7374 656d  path': '/"system
+000127d0: 4d65 7461 6461 7461 222f 2a27 0a20 2020  Metadata"/*'.   
+000127e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127f0: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
+00012800: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+00012810: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
+00012820: 7061 7274 6974 696f 6e5f 6b65 793d 5061  partition_key=Pa
+00012830: 7274 6974 696f 6e4b 6579 2870 6174 683d  rtitionKey(path=
+00012840: 272f 6964 272c 206b 696e 643d 2748 6173  '/id', kind='Has
+00012850: 6827 290a 2020 2020 2020 2020 290a 0a20  h').        ).. 
+00012860: 2020 2020 2020 2063 6f6c 6c65 6374 696f         collectio
+00012870: 6e5f 7769 7468 5f69 6e64 6578 696e 675f  n_with_indexing_
+00012880: 706f 6c69 6379 5f70 726f 7065 7274 6965  policy_propertie
+00012890: 7320 3d20 6177 6169 7420 636f 6c6c 6563  s = await collec
+000128a0: 7469 6f6e 5f77 6974 685f 696e 6465 7869  tion_with_indexi
+000128b0: 6e67 5f70 6f6c 6963 792e 7265 6164 2829  ng_policy.read()
+000128c0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000128d0: 7365 7274 4571 7561 6c28 312c 0a20 2020  sertEqual(1,.   
+000128e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128f0: 2020 2020 2020 6c65 6e28 636f 6c6c 6563        len(collec
+00012900: 7469 6f6e 5f77 6974 685f 696e 6465 7869  tion_with_indexi
+00012910: 6e67 5f70 6f6c 6963 795f 7072 6f70 6572  ng_policy_proper
+00012920: 7469 6573 5b27 696e 6465 7869 6e67 506f  ties['indexingPo
+00012930: 6c69 6379 275d 5b27 696e 636c 7564 6564  licy']['included
+00012940: 5061 7468 7327 5d29 2c0a 2020 2020 2020  Paths']),.      
+00012950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012960: 2020 2027 556e 6578 7065 6374 6564 2069     'Unexpected i
+00012970: 6e63 6c75 6465 6450 6174 6873 206c 656e  ncludedPaths len
+00012980: 6774 6827 290a 2020 2020 2020 2020 7365  gth').        se
+00012990: 6c66 2e61 7373 6572 7445 7175 616c 2832  lf.assertEqual(2
+000129a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000129b0: 2020 2020 2020 2020 2020 206c 656e 2863             len(c
+000129c0: 6f6c 6c65 6374 696f 6e5f 7769 7468 5f69  ollection_with_i
+000129d0: 6e64 6578 696e 675f 706f 6c69 6379 5f70  ndexing_policy_p
+000129e0: 726f 7065 7274 6965 735b 2769 6e64 6578  roperties['index
+000129f0: 696e 6750 6f6c 6963 7927 5d5b 2765 7863  ingPolicy']['exc
+00012a00: 6c75 6465 6450 6174 6873 275d 292c 0a20  ludedPaths']),. 
+00012a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a20: 2020 2020 2020 2020 2755 6e65 7870 6563          'Unexpec
+00012a30: 7465 6420 6578 636c 7564 6564 2070 6174  ted excluded pat
+00012a40: 6820 636f 756e 7427 290a 2020 2020 2020  h count').      
+00012a50: 2020 6177 6169 7420 6462 2e64 656c 6574    await db.delet
+00012a60: 655f 636f 6e74 6169 6e65 7228 636f 6e74  e_container(cont
+00012a70: 6169 6e65 723d 636f 6c6c 6563 7469 6f6e  ainer=collection
+00012a80: 5f77 6974 685f 696e 6465 7869 6e67 5f70  _with_indexing_p
+00012a90: 6f6c 6963 7929 0a0a 2020 2020 6173 796e  olicy)..    asyn
+00012aa0: 6320 6465 6620 7465 7374 5f63 7265 6174  c def test_creat
+00012ab0: 655f 6465 6661 756c 745f 696e 6465 7869  e_default_indexi
+00012ac0: 6e67 5f70 6f6c 6963 7928 7365 6c66 293a  ng_policy(self):
+00012ad0: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
+00012ae0: 6520 6461 7461 6261 7365 0a20 2020 2020  e database.     
+00012af0: 2020 2064 6220 3d20 7365 6c66 2e64 6174     db = self.dat
+00012b00: 6162 6173 6546 6f72 5465 7374 0a0a 2020  abaseForTest..  
+00012b10: 2020 2020 2020 2320 6e6f 2069 6e64 6578        # no index
+00012b20: 696e 6720 706f 6c69 6379 2073 7065 6369  ing policy speci
+00012b30: 6669 6564 0a20 2020 2020 2020 2063 6f6c  fied.        col
+00012b40: 6c65 6374 696f 6e20 3d20 6177 6169 7420  lection = await 
+00012b50: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
+00012b60: 6e65 7228 0a20 2020 2020 2020 2020 2020  ner(.           
+00012b70: 2069 643d 2774 6573 745f 6372 6561 7465   id='test_create
+00012b80: 5f64 6566 6175 6c74 5f69 6e64 6578 696e  _default_indexin
+00012b90: 675f 706f 6c69 6379 2054 6573 7443 7265  g_policy TestCre
+00012ba0: 6174 6544 6566 6175 6c74 506f 6c69 6379  ateDefaultPolicy
+00012bb0: 3031 2720 2b20 7374 7228 7575 6964 2e75  01' + str(uuid.u
+00012bc0: 7569 6434 2829 292c 0a20 2020 2020 2020  uid4()),.       
+00012bd0: 2020 2020 2070 6172 7469 7469 6f6e 5f6b       partition_k
+00012be0: 6579 3d50 6172 7469 7469 6f6e 4b65 7928  ey=PartitionKey(
+00012bf0: 7061 7468 3d27 2f69 6427 2c20 6b69 6e64  path='/id', kind
+00012c00: 3d27 4861 7368 2729 0a20 2020 2020 2020  ='Hash').       
+00012c10: 2029 0a20 2020 2020 2020 2063 6f6c 6c65   ).        colle
+00012c20: 6374 696f 6e5f 7072 6f70 6572 7469 6573  ction_properties
+00012c30: 203d 2061 7761 6974 2063 6f6c 6c65 6374   = await collect
+00012c40: 696f 6e2e 7265 6164 2829 0a20 2020 2020  ion.read().     
+00012c50: 2020 2061 7761 6974 2073 656c 662e 5f63     await self._c
+00012c60: 6865 636b 5f64 6566 6175 6c74 5f69 6e64  heck_default_ind
+00012c70: 6578 696e 675f 706f 6c69 6379 5f70 6174  exing_policy_pat
+00012c80: 6873 2863 6f6c 6c65 6374 696f 6e5f 7072  hs(collection_pr
+00012c90: 6f70 6572 7469 6573 5b27 696e 6465 7869  operties['indexi
+00012ca0: 6e67 506f 6c69 6379 275d 290a 2020 2020  ngPolicy']).    
+00012cb0: 2020 2020 6177 6169 7420 6462 2e64 656c      await db.del
+00012cc0: 6574 655f 636f 6e74 6169 6e65 7228 636f  ete_container(co
+00012cd0: 6e74 6169 6e65 723d 636f 6c6c 6563 7469  ntainer=collecti
+00012ce0: 6f6e 290a 0a20 2020 2020 2020 2023 2070  on)..        # p
+00012cf0: 6172 7469 616c 2070 6f6c 6963 7920 7370  artial policy sp
+00012d00: 6563 6966 6965 640a 2020 2020 2020 2020  ecified.        
+00012d10: 636f 6c6c 6563 7469 6f6e 203d 2061 7761  collection = awa
+00012d20: 6974 2064 622e 6372 6561 7465 5f63 6f6e  it db.create_con
+00012d30: 7461 696e 6572 280a 2020 2020 2020 2020  tainer(.        
+00012d40: 2020 2020 6964 3d27 7465 7374 5f63 7265      id='test_cre
+00012d50: 6174 655f 6465 6661 756c 745f 696e 6465  ate_default_inde
+00012d60: 7869 6e67 5f70 6f6c 6963 7920 5465 7374  xing_policy Test
+00012d70: 4372 6561 7465 4465 6661 756c 7450 6f6c  CreateDefaultPol
+00012d80: 6963 7930 3127 202b 2073 7472 2875 7569  icy01' + str(uui
+00012d90: 642e 7575 6964 3428 2929 2c0a 2020 2020  d.uuid4()),.    
+00012da0: 2020 2020 2020 2020 696e 6465 7869 6e67          indexing
+00012db0: 5f70 6f6c 6963 793d 7b0a 2020 2020 2020  _policy={.      
+00012dc0: 2020 2020 2020 2020 2020 2769 6e64 6578            'index
+00012dd0: 696e 674d 6f64 6527 3a20 646f 6375 6d65  ingMode': docume
+00012de0: 6e74 732e 496e 6465 7869 6e67 4d6f 6465  nts.IndexingMode
+00012df0: 2e43 6f6e 7369 7374 656e 742c 2027 6175  .Consistent, 'au
+00012e00: 746f 6d61 7469 6327 3a20 5472 7565 0a20  tomatic': True. 
+00012e10: 2020 2020 2020 2020 2020 207d 2c0a 2020             },.  
+00012e20: 2020 2020 2020 2020 2020 7061 7274 6974            partit
+00012e30: 696f 6e5f 6b65 793d 5061 7274 6974 696f  ion_key=Partitio
+00012e40: 6e4b 6579 2870 6174 683d 272f 6964 272c  nKey(path='/id',
+00012e50: 206b 696e 643d 2748 6173 6827 290a 2020   kind='Hash').  
+00012e60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00012e70: 636f 6c6c 6563 7469 6f6e 5f70 726f 7065  collection_prope
+00012e80: 7274 6965 7320 3d20 6177 6169 7420 636f  rties = await co
+00012e90: 6c6c 6563 7469 6f6e 2e72 6561 6428 290a  llection.read().
+00012ea0: 2020 2020 2020 2020 6177 6169 7420 7365          await se
+00012eb0: 6c66 2e5f 6368 6563 6b5f 6465 6661 756c  lf._check_defaul
+00012ec0: 745f 696e 6465 7869 6e67 5f70 6f6c 6963  t_indexing_polic
+00012ed0: 795f 7061 7468 7328 636f 6c6c 6563 7469  y_paths(collecti
+00012ee0: 6f6e 5f70 726f 7065 7274 6965 735b 2769  on_properties['i
+00012ef0: 6e64 6578 696e 6750 6f6c 6963 7927 5d29  ndexingPolicy'])
+00012f00: 0a20 2020 2020 2020 2061 7761 6974 2064  .        await d
+00012f10: 622e 6465 6c65 7465 5f63 6f6e 7461 696e  b.delete_contain
+00012f20: 6572 2863 6f6e 7461 696e 6572 3d63 6f6c  er(container=col
+00012f30: 6c65 6374 696f 6e29 0a0a 2020 2020 2020  lection)..      
+00012f40: 2020 2320 6465 6661 756c 7420 706f 6c69    # default poli
+00012f50: 6379 0a20 2020 2020 2020 2063 6f6c 6c65  cy.        colle
+00012f60: 6374 696f 6e20 3d20 6177 6169 7420 6462  ction = await db
+00012f70: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
+00012f80: 7228 0a20 2020 2020 2020 2020 2020 2069  r(.            i
+00012f90: 643d 2774 6573 745f 6372 6561 7465 5f64  d='test_create_d
+00012fa0: 6566 6175 6c74 5f69 6e64 6578 696e 675f  efault_indexing_
+00012fb0: 706f 6c69 6379 2054 6573 7443 7265 6174  policy TestCreat
+00012fc0: 6544 6566 6175 6c74 506f 6c69 6379 3033  eDefaultPolicy03
+00012fd0: 2720 2b20 7374 7228 7575 6964 2e75 7569  ' + str(uuid.uui
+00012fe0: 6434 2829 292c 0a20 2020 2020 2020 2020  d4()),.         
+00012ff0: 2020 2069 6e64 6578 696e 675f 706f 6c69     indexing_poli
+00013000: 6379 3d7b 7d2c 0a20 2020 2020 2020 2020  cy={},.         
+00013010: 2020 2070 6172 7469 7469 6f6e 5f6b 6579     partition_key
+00013020: 3d50 6172 7469 7469 6f6e 4b65 7928 7061  =PartitionKey(pa
+00013030: 7468 3d27 2f69 6427 2c20 6b69 6e64 3d27  th='/id', kind='
+00013040: 4861 7368 2729 0a20 2020 2020 2020 2029  Hash').        )
+00013050: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
+00013060: 696f 6e5f 7072 6f70 6572 7469 6573 203d  ion_properties =
+00013070: 2061 7761 6974 2063 6f6c 6c65 6374 696f   await collectio
+00013080: 6e2e 7265 6164 2829 0a20 2020 2020 2020  n.read().       
+00013090: 2061 7761 6974 2073 656c 662e 5f63 6865   await self._che
+000130a0: 636b 5f64 6566 6175 6c74 5f69 6e64 6578  ck_default_index
+000130b0: 696e 675f 706f 6c69 6379 5f70 6174 6873  ing_policy_paths
+000130c0: 2863 6f6c 6c65 6374 696f 6e5f 7072 6f70  (collection_prop
+000130d0: 6572 7469 6573 5b27 696e 6465 7869 6e67  erties['indexing
+000130e0: 506f 6c69 6379 275d 290a 2020 2020 2020  Policy']).      
+000130f0: 2020 6177 6169 7420 6462 2e64 656c 6574    await db.delet
+00013100: 655f 636f 6e74 6169 6e65 7228 636f 6e74  e_container(cont
+00013110: 6169 6e65 723d 636f 6c6c 6563 7469 6f6e  ainer=collection
+00013120: 290a 0a20 2020 2020 2020 2023 206d 6973  )..        # mis
+00013130: 7369 6e67 2069 6e64 6578 6573 0a20 2020  sing indexes.   
+00013140: 2020 2020 2063 6f6c 6c65 6374 696f 6e20       collection 
+00013150: 3d20 6177 6169 7420 6462 2e63 7265 6174  = await db.creat
+00013160: 655f 636f 6e74 6169 6e65 7228 0a20 2020  e_container(.   
+00013170: 2020 2020 2020 2020 2069 643d 2774 6573           id='tes
+00013180: 745f 6372 6561 7465 5f64 6566 6175 6c74  t_create_default
+00013190: 5f69 6e64 6578 696e 675f 706f 6c69 6379  _indexing_policy
+000131a0: 2054 6573 7443 7265 6174 6544 6566 6175   TestCreateDefau
+000131b0: 6c74 506f 6c69 6379 3034 2720 2b20 7374  ltPolicy04' + st
+000131c0: 7228 7575 6964 2e75 7569 6434 2829 292c  r(uuid.uuid4()),
+000131d0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+000131e0: 6578 696e 675f 706f 6c69 6379 3d7b 0a20  exing_policy={. 
+000131f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00013200: 696e 636c 7564 6564 5061 7468 7327 3a20  includedPaths': 
+00013210: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+00013220: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
+00013230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013240: 2770 6174 6827 3a20 272f 2a27 0a20 2020  'path': '/*'.   
+00013250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013260: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
+00013270: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+00013280: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
+00013290: 7061 7274 6974 696f 6e5f 6b65 793d 5061  partition_key=Pa
+000132a0: 7274 6974 696f 6e4b 6579 2870 6174 683d  rtitionKey(path=
+000132b0: 272f 6964 272c 206b 696e 643d 2748 6173  '/id', kind='Has
+000132c0: 6827 290a 2020 2020 2020 2020 290a 2020  h').        ).  
+000132d0: 2020 2020 2020 636f 6c6c 6563 7469 6f6e        collection
+000132e0: 5f70 726f 7065 7274 6965 7320 3d20 6177  _properties = aw
+000132f0: 6169 7420 636f 6c6c 6563 7469 6f6e 2e72  ait collection.r
+00013300: 6561 6428 290a 2020 2020 2020 2020 6177  ead().        aw
+00013310: 6169 7420 7365 6c66 2e5f 6368 6563 6b5f  ait self._check_
+00013320: 6465 6661 756c 745f 696e 6465 7869 6e67  default_indexing
+00013330: 5f70 6f6c 6963 795f 7061 7468 7328 636f  _policy_paths(co
+00013340: 6c6c 6563 7469 6f6e 5f70 726f 7065 7274  llection_propert
+00013350: 6965 735b 2769 6e64 6578 696e 6750 6f6c  ies['indexingPol
+00013360: 6963 7927 5d29 0a20 2020 2020 2020 2061  icy']).        a
+00013370: 7761 6974 2064 622e 6465 6c65 7465 5f63  wait db.delete_c
+00013380: 6f6e 7461 696e 6572 2863 6f6e 7461 696e  ontainer(contain
+00013390: 6572 3d63 6f6c 6c65 6374 696f 6e29 0a0a  er=collection)..
+000133a0: 2020 2020 2020 2020 2320 6d69 7373 696e          # missin
+000133b0: 6720 7072 6563 6973 696f 6e0a 2020 2020  g precision.    
+000133c0: 2020 2020 636f 6c6c 6563 7469 6f6e 203d      collection =
+000133d0: 2061 7761 6974 2064 622e 6372 6561 7465   await db.create
+000133e0: 5f63 6f6e 7461 696e 6572 280a 2020 2020  _container(.    
+000133f0: 2020 2020 2020 2020 6964 3d27 7465 7374          id='test
+00013400: 5f63 7265 6174 655f 6465 6661 756c 745f  _create_default_
+00013410: 696e 6465 7869 6e67 5f70 6f6c 6963 7920  indexing_policy 
+00013420: 5465 7374 4372 6561 7465 4465 6661 756c  TestCreateDefaul
+00013430: 7450 6f6c 6963 7930 3527 202b 2073 7472  tPolicy05' + str
+00013440: 2875 7569 642e 7575 6964 3428 2929 2c0a  (uuid.uuid4()),.
+00013450: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00013460: 7869 6e67 5f70 6f6c 6963 793d 7b0a 2020  xing_policy={.  
+00013470: 2020 2020 2020 2020 2020 2020 2020 2769                'i
+00013480: 6e63 6c75 6465 6450 6174 6873 273a 205b  ncludedPaths': [
+00013490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000134a0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+000134b0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000134c0: 7061 7468 273a 2027 2f2a 272c 0a20 2020  path': '/*',.   
+000134d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134e0: 2020 2020 2027 696e 6465 7865 7327 3a20       'indexes': 
+000134f0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+00013500: 2020 2020 2020 2020 2020 2020 2020 7b0a                {.
+00013510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013530: 276b 696e 6427 3a20 646f 6375 6d65 6e74  'kind': document
+00013540: 732e 496e 6465 784b 696e 642e 4861 7368  s.IndexKind.Hash
+00013550: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013570: 2020 2764 6174 6154 7970 6527 3a20 646f    'dataType': do
+00013580: 6375 6d65 6e74 732e 4461 7461 5479 7065  cuments.DataType
+00013590: 2e53 7472 696e 670a 2020 2020 2020 2020  .String.        
+000135a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135b0: 2020 2020 7d2c 0a20 2020 2020 2020 2020      },.         
+000135c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135d0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+000135e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135f0: 2020 2020 2027 6b69 6e64 273a 2064 6f63       'kind': doc
+00013600: 756d 656e 7473 2e49 6e64 6578 4b69 6e64  uments.IndexKind
+00013610: 2e52 616e 6765 2c0a 2020 2020 2020 2020  .Range,.        
+00013620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013630: 2020 2020 2020 2020 2764 6174 6154 7970          'dataTyp
+00013640: 6527 3a20 646f 6375 6d65 6e74 732e 4461  e': documents.Da
+00013650: 7461 5479 7065 2e4e 756d 6265 720a 2020  taType.Number.  
+00013660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013670: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00013680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013690: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
+000136a0: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+000136b0: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
+000136c0: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
+000136d0: 2020 2020 2020 2020 2070 6172 7469 7469           partiti
+000136e0: 6f6e 5f6b 6579 3d50 6172 7469 7469 6f6e  on_key=Partition
+000136f0: 4b65 7928 7061 7468 3d27 2f69 6427 2c20  Key(path='/id', 
+00013700: 6b69 6e64 3d27 4861 7368 2729 0a20 2020  kind='Hash').   
+00013710: 2020 2020 2029 0a20 2020 2020 2020 2063       ).        c
+00013720: 6f6c 6c65 6374 696f 6e5f 7072 6f70 6572  ollection_proper
+00013730: 7469 6573 203d 2061 7761 6974 2063 6f6c  ties = await col
+00013740: 6c65 6374 696f 6e2e 7265 6164 2829 0a20  lection.read(). 
+00013750: 2020 2020 2020 2061 7761 6974 2073 656c         await sel
+00013760: 662e 5f63 6865 636b 5f64 6566 6175 6c74  f._check_default
+00013770: 5f69 6e64 6578 696e 675f 706f 6c69 6379  _indexing_policy
+00013780: 5f70 6174 6873 2863 6f6c 6c65 6374 696f  _paths(collectio
+00013790: 6e5f 7072 6f70 6572 7469 6573 5b27 696e  n_properties['in
+000137a0: 6465 7869 6e67 506f 6c69 6379 275d 290a  dexingPolicy']).
+000137b0: 2020 2020 2020 2020 6177 6169 7420 6462          await db
+000137c0: 2e64 656c 6574 655f 636f 6e74 6169 6e65  .delete_containe
+000137d0: 7228 636f 6e74 6169 6e65 723d 636f 6c6c  r(container=coll
+000137e0: 6563 7469 6f6e 290a 0a20 2020 2061 7379  ection)..    asy
+000137f0: 6e63 2064 6566 2074 6573 745f 6372 6561  nc def test_crea
+00013800: 7465 5f69 6e64 6578 696e 675f 706f 6c69  te_indexing_poli
+00013810: 6379 5f77 6974 685f 636f 6d70 6f73 6974  cy_with_composit
+00013820: 655f 616e 645f 7370 6174 6961 6c5f 696e  e_and_spatial_in
+00013830: 6465 7865 7328 7365 6c66 293a 0a20 2020  dexes(self):.   
+00013840: 2020 2020 2023 2063 7265 6174 6520 6461       # create da
+00013850: 7461 6261 7365 0a20 2020 2020 2020 2064  tabase.        d
+00013860: 6220 3d20 7365 6c66 2e64 6174 6162 6173  b = self.databas
+00013870: 6546 6f72 5465 7374 0a0a 2020 2020 2020  eForTest..      
+00013880: 2020 696e 6465 7869 6e67 5f70 6f6c 6963    indexing_polic
+00013890: 7920 3d20 7b0a 2020 2020 2020 2020 2020  y = {.          
+000138a0: 2020 2273 7061 7469 616c 496e 6465 7865    "spatialIndexe
+000138b0: 7322 3a20 5b0a 2020 2020 2020 2020 2020  s": [.          
+000138c0: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
+000138d0: 2020 2020 2020 2020 2020 2020 2270 6174              "pat
+000138e0: 6822 3a20 222f 7061 7468 302f 2a22 2c0a  h": "/path0/*",.
+000138f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013900: 2020 2020 2274 7970 6573 223a 205b 0a20      "types": [. 
+00013910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013920: 2020 2020 2020 2022 506f 696e 7422 2c0a         "Point",.
+00013930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013940: 2020 2020 2020 2020 224c 696e 6553 7472          "LineStr
+00013950: 696e 6722 2c0a 2020 2020 2020 2020 2020  ing",.          
+00013960: 2020 2020 2020 2020 2020 2020 2020 2250                "P
+00013970: 6f6c 7967 6f6e 222c 0a20 2020 2020 2020  olygon",.       
+00013980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013990: 2022 4d75 6c74 6950 6f6c 7967 6f6e 220a   "MultiPolygon".
+000139a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139b0: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
+000139c0: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
+000139d0: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
+000139e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000139f0: 7061 7468 223a 2022 2f70 6174 6831 2f2a  path": "/path1/*
+00013a00: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00013a10: 2020 2020 2020 2022 7479 7065 7322 3a20         "types": 
+00013a20: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+00013a30: 2020 2020 2020 2020 2020 2250 6f69 6e74            "Point
+00013a40: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00013a50: 2020 2020 2020 2020 2020 2022 4c69 6e65             "Line
+00013a60: 5374 7269 6e67 222c 0a20 2020 2020 2020  String",.       
+00013a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a80: 2022 506f 6c79 676f 6e22 2c0a 2020 2020   "Polygon",.    
+00013a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013aa0: 2020 2020 224d 756c 7469 506f 6c79 676f      "MultiPolygo
+00013ab0: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
+00013ac0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00013ad0: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00013ae0: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
+00013af0: 2020 2020 2020 2263 6f6d 706f 7369 7465        "composite
+00013b00: 496e 6465 7865 7322 3a20 5b0a 2020 2020  Indexes": [.    
+00013b10: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
 00013b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b30: 2020 2020 2020 2020 2270 6174 6822 3a20          "path": 
-00013b40: 222f 7061 7468 3122 2c0a 2020 2020 2020  "/path1",.      
-00013b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b60: 2020 226f 7264 6572 223a 2022 6173 6365    "order": "asce
-00013b70: 6e64 696e 6722 0a20 2020 2020 2020 2020  nding".         
-00013b80: 2020 2020 2020 2020 2020 207d 2c0a 2020             },.  
-00013b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ba0: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
-00013bb0: 2020 2020 2020 2020 2020 2020 2270 6174              "pat
-00013bc0: 6822 3a20 222f 7061 7468 3222 2c0a 2020  h": "/path2",.  
-00013bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013be0: 2020 2020 2020 226f 7264 6572 223a 2022        "order": "
-00013bf0: 6465 7363 656e 6469 6e67 220a 2020 2020  descending".    
-00013c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c10: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-00013c20: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-00013c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c40: 2022 7061 7468 223a 2022 2f70 6174 6833   "path": "/path3
-00013c50: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00013c60: 2020 2020 2020 2020 2020 2022 6f72 6465             "orde
-00013c70: 7222 3a20 2261 7363 656e 6469 6e67 220a  r": "ascending".
-00013c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c90: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-00013ca0: 2020 2020 2020 5d2c 0a20 2020 2020 2020        ],.       
-00013cb0: 2020 2020 2020 2020 205b 0a20 2020 2020           [.     
-00013cc0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-00013cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013ce0: 2020 2020 2020 2020 2022 7061 7468 223a           "path":
-00013cf0: 2022 2f70 6174 6834 222c 0a20 2020 2020   "/path4",.     
-00013d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d10: 2020 2022 6f72 6465 7222 3a20 2261 7363     "order": "asc
-00013d20: 656e 6469 6e67 220a 2020 2020 2020 2020  ending".        
-00013d30: 2020 2020 2020 2020 2020 2020 7d2c 0a20              },. 
+00013b30: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
+00013b40: 2020 2020 2020 2020 2020 2020 2270 6174              "pat
+00013b50: 6822 3a20 222f 7061 7468 3122 2c0a 2020  h": "/path1",.  
+00013b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b70: 2020 2020 2020 226f 7264 6572 223a 2022        "order": "
+00013b80: 6173 6365 6e64 696e 6722 0a20 2020 2020  ascending".     
+00013b90: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00013ba0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013bb0: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
+00013bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013bd0: 2270 6174 6822 3a20 222f 7061 7468 3222  "path": "/path2"
+00013be0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013bf0: 2020 2020 2020 2020 2020 226f 7264 6572            "order
+00013c00: 223a 2022 6465 7363 656e 6469 6e67 220a  ": "descending".
+00013c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c20: 2020 2020 7d2c 0a20 2020 2020 2020 2020      },.         
+00013c30: 2020 2020 2020 2020 2020 207b 0a20 2020             {.   
+00013c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c50: 2020 2020 2022 7061 7468 223a 2022 2f70       "path": "/p
+00013c60: 6174 6833 222c 0a20 2020 2020 2020 2020  ath3",.         
+00013c70: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00013c80: 6f72 6465 7222 3a20 2261 7363 656e 6469  order": "ascendi
+00013c90: 6e67 220a 2020 2020 2020 2020 2020 2020  ng".            
+00013ca0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00013cb0: 2020 2020 2020 2020 2020 5d2c 0a20 2020            ],.   
+00013cc0: 2020 2020 2020 2020 2020 2020 205b 0a20               [. 
+00013cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ce0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+00013cf0: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
+00013d00: 7468 223a 2022 2f70 6174 6834 222c 0a20  th": "/path4",. 
+00013d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d20: 2020 2020 2020 2022 6f72 6465 7222 3a20         "order": 
+00013d30: 2261 7363 656e 6469 6e67 220a 2020 2020  "ascending".    
 00013d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d50: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
-00013d60: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
-00013d70: 7468 223a 2022 2f70 6174 6835 222c 0a20  th": "/path5",. 
-00013d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d90: 2020 2020 2020 2022 6f72 6465 7222 3a20         "order": 
-00013da0: 2264 6573 6365 6e64 696e 6722 0a20 2020  "descending".   
-00013db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013dc0: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
-00013dd0: 2020 2020 2020 2020 7b0a 2020 2020 2020          {.      
-00013de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013df0: 2020 2270 6174 6822 3a20 222f 7061 7468    "path": "/path
-00013e00: 3622 2c0a 2020 2020 2020 2020 2020 2020  6",.            
-00013e10: 2020 2020 2020 2020 2020 2020 226f 7264              "ord
-00013e20: 6572 223a 2022 6173 6365 6e64 696e 6722  er": "ascending"
-00013e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013e40: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00013e50: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00013e60: 2020 2020 205d 0a20 2020 2020 2020 207d       ].        }
-00013e70: 0a0a 2020 2020 2020 2020 6375 7374 6f6d  ..        custom
-00013e80: 5f6c 6f67 6765 7220 3d20 6c6f 6767 696e  _logger = loggin
-00013e90: 672e 6765 744c 6f67 6765 7228 2243 7573  g.getLogger("Cus
-00013ea0: 746f 6d4c 6f67 6765 7222 290a 2020 2020  tomLogger").    
-00013eb0: 2020 2020 6372 6561 7465 645f 636f 6e74      created_cont
-00013ec0: 6169 6e65 7220 3d20 6177 6169 7420 6462  ainer = await db
-00013ed0: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
-00013ee0: 7228 0a20 2020 2020 2020 2020 2020 2069  r(.            i
-00013ef0: 643d 2763 6f6d 706f 7369 7465 5f69 6e64  d='composite_ind
-00013f00: 6578 5f73 7061 7469 616c 5f69 6e64 6578  ex_spatial_index
-00013f10: 2720 2b20 7374 7228 7575 6964 2e75 7569  ' + str(uuid.uui
-00013f20: 6434 2829 292c 0a20 2020 2020 2020 2020  d4()),.         
-00013f30: 2020 2069 6e64 6578 696e 675f 706f 6c69     indexing_poli
-00013f40: 6379 3d69 6e64 6578 696e 675f 706f 6c69  cy=indexing_poli
-00013f50: 6379 2c0a 2020 2020 2020 2020 2020 2020  cy,.            
-00013f60: 7061 7274 6974 696f 6e5f 6b65 793d 5061  partition_key=Pa
-00013f70: 7274 6974 696f 6e4b 6579 2870 6174 683d  rtitionKey(path=
-00013f80: 272f 6964 272c 206b 696e 643d 2748 6173  '/id', kind='Has
-00013f90: 6827 292c 0a20 2020 2020 2020 2020 2020  h'),.           
-00013fa0: 2068 6561 6465 7273 3d7b 2246 6f6f 223a   headers={"Foo":
-00013fb0: 2022 6261 7222 7d2c 0a20 2020 2020 2020   "bar"},.       
-00013fc0: 2020 2020 2075 7365 725f 6167 656e 743d       user_agent=
-00013fd0: 2262 6c61 6822 2c0a 2020 2020 2020 2020  "blah",.        
-00013fe0: 2020 2020 7573 6572 5f61 6765 6e74 5f6f      user_agent_o
-00013ff0: 7665 7277 7269 7465 3d54 7275 652c 0a20  verwrite=True,. 
-00014000: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
-00014010: 6e67 5f65 6e61 626c 653d 5472 7565 2c0a  ng_enable=True,.
-00014020: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00014030: 6572 3d63 7573 746f 6d5f 6c6f 6767 6572  er=custom_logger
-00014040: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-00014050: 2020 2020 6372 6561 7465 645f 7072 6f70      created_prop
-00014060: 6572 7469 6573 203d 2061 7761 6974 2063  erties = await c
-00014070: 7265 6174 6564 5f63 6f6e 7461 696e 6572  reated_container
-00014080: 2e72 6561 6428 6c6f 6767 6572 3d63 7573  .read(logger=cus
-00014090: 746f 6d5f 6c6f 6767 6572 290a 2020 2020  tom_logger).    
-000140a0: 2020 2020 7265 6164 5f69 6e64 6578 696e      read_indexin
-000140b0: 675f 706f 6c69 6379 203d 2063 7265 6174  g_policy = creat
-000140c0: 6564 5f70 726f 7065 7274 6965 735b 2769  ed_properties['i
-000140d0: 6e64 6578 696e 6750 6f6c 6963 7927 5d0a  ndexingPolicy'].
-000140e0: 0a20 2020 2020 2020 2069 6620 276c 6f63  .        if 'loc
-000140f0: 616c 686f 7374 2720 696e 2073 656c 662e  alhost' in self.
-00014100: 686f 7374 206f 7220 2731 3237 2e30 2e30  host or '127.0.0
-00014110: 2e31 2720 696e 2073 656c 662e 686f 7374  .1' in self.host
-00014120: 3a20 2023 2054 4f44 4f3a 2044 6966 6665  :  # TODO: Diffe
-00014130: 7269 6e67 2072 6573 756c 7420 6265 7477  ring result betw
-00014140: 6565 6e20 6c69 7665 2061 6e64 2065 6d75  een live and emu
-00014150: 6c61 746f 720a 2020 2020 2020 2020 2020  lator.          
-00014160: 2020 7365 6c66 2e61 7373 6572 744c 6973    self.assertLis
-00014170: 7445 7175 616c 2869 6e64 6578 696e 675f  tEqual(indexing_
-00014180: 706f 6c69 6379 5b27 7370 6174 6961 6c49  policy['spatialI
-00014190: 6e64 6578 6573 275d 2c20 7265 6164 5f69  ndexes'], read_i
-000141a0: 6e64 6578 696e 675f 706f 6c69 6379 5b27  ndexing_policy['
-000141b0: 7370 6174 6961 6c49 6e64 6578 6573 275d  spatialIndexes']
-000141c0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-000141d0: 2020 2020 2020 2020 2020 2020 2320 416c              # Al
-000141e0: 6c20 7479 7065 7320 6172 6520 7265 7475  l types are retu
-000141f0: 726e 6564 2066 6f72 2073 7061 7469 616c  rned for spatial
-00014200: 2049 6e64 6578 6573 0a20 2020 2020 2020   Indexes.       
-00014210: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00014220: 4c69 7374 4571 7561 6c28 696e 6465 7869  ListEqual(indexi
-00014230: 6e67 5f70 6f6c 6963 795b 2773 7061 7469  ng_policy['spati
-00014240: 616c 496e 6465 7865 7327 5d2c 2072 6561  alIndexes'], rea
-00014250: 645f 696e 6465 7869 6e67 5f70 6f6c 6963  d_indexing_polic
-00014260: 795b 2773 7061 7469 616c 496e 6465 7865  y['spatialIndexe
-00014270: 7327 5d29 0a0a 2020 2020 2020 2020 7365  s'])..        se
-00014280: 6c66 2e61 7373 6572 744c 6973 7445 7175  lf.assertListEqu
-00014290: 616c 2869 6e64 6578 696e 675f 706f 6c69  al(indexing_poli
-000142a0: 6379 5b27 636f 6d70 6f73 6974 6549 6e64  cy['compositeInd
-000142b0: 6578 6573 275d 2c20 7265 6164 5f69 6e64  exes'], read_ind
-000142c0: 6578 696e 675f 706f 6c69 6379 5b27 636f  exing_policy['co
-000142d0: 6d70 6f73 6974 6549 6e64 6578 6573 275d  mpositeIndexes']
-000142e0: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
-000142f0: 6462 2e64 656c 6574 655f 636f 6e74 6169  db.delete_contai
-00014300: 6e65 7228 636f 6e74 6169 6e65 723d 6372  ner(container=cr
-00014310: 6561 7465 645f 636f 6e74 6169 6e65 7229  eated_container)
-00014320: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
-00014330: 5f63 6865 636b 5f64 6566 6175 6c74 5f69  _check_default_i
-00014340: 6e64 6578 696e 675f 706f 6c69 6379 5f70  ndexing_policy_p
-00014350: 6174 6873 2873 656c 662c 2069 6e64 6578  aths(self, index
-00014360: 696e 675f 706f 6c69 6379 293a 0a20 2020  ing_policy):.   
-00014370: 2020 2020 2064 6566 205f 5f67 6574 5f66       def __get_f
-00014380: 6972 7374 2861 7272 6179 293a 0a20 2020  irst(array):.   
-00014390: 2020 2020 2020 2020 2069 6620 6172 7261           if arra
-000143a0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-000143b0: 2020 2072 6574 7572 6e20 6172 7261 795b     return array[
-000143c0: 305d 0a20 2020 2020 2020 2020 2020 2065  0].            e
-000143d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000143e0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-000143f0: 0a0a 2020 2020 2020 2020 2320 272f 5f65  ..        # '/_e
-00014400: 7461 6727 2069 7320 7072 6573 656e 7420  tag' is present 
-00014410: 696e 2065 7863 6c75 6465 6420 7061 7468  in excluded path
-00014420: 7320 6279 2064 6566 6175 6c74 0a20 2020  s by default.   
-00014430: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00014440: 4571 7561 6c28 312c 206c 656e 2869 6e64  Equal(1, len(ind
-00014450: 6578 696e 675f 706f 6c69 6379 5b27 6578  exing_policy['ex
-00014460: 636c 7564 6564 5061 7468 7327 5d29 290a  cludedPaths'])).
-00014470: 2020 2020 2020 2020 2320 696e 636c 7564          # includ
-00014480: 6564 2070 6174 6873 2073 686f 756c 6420  ed paths should 
-00014490: 6265 2031 3a20 272f 272e 0a20 2020 2020  be 1: '/'..     
-000144a0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000144b0: 7561 6c28 312c 206c 656e 2869 6e64 6578  ual(1, len(index
-000144c0: 696e 675f 706f 6c69 6379 5b27 696e 636c  ing_policy['incl
-000144d0: 7564 6564 5061 7468 7327 5d29 290a 0a20  udedPaths'])).. 
-000144e0: 2020 2020 2020 2072 6f6f 745f 696e 636c         root_incl
-000144f0: 7564 6564 5f70 6174 6820 3d20 5f5f 6765  uded_path = __ge
-00014500: 745f 6669 7273 7428 5b69 6e63 6c75 6465  t_first([include
-00014510: 645f 7061 7468 2066 6f72 2069 6e63 6c75  d_path for inclu
-00014520: 6465 645f 7061 7468 2069 6e20 696e 6465  ded_path in inde
-00014530: 7869 6e67 5f70 6f6c 6963 795b 2769 6e63  xing_policy['inc
-00014540: 6c75 6465 6450 6174 6873 275d 0a20 2020  ludedPaths'].   
-00014550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014570: 2020 2020 2020 2069 6620 696e 636c 7564         if includ
-00014580: 6564 5f70 6174 685b 2770 6174 6827 5d20  ed_path['path'] 
-00014590: 3d3d 2027 2f2a 275d 290a 2020 2020 2020  == '/*']).      
-000145a0: 2020 7365 6c66 2e61 7373 6572 7446 616c    self.assertFal
-000145b0: 7365 2872 6f6f 745f 696e 636c 7564 6564  se(root_included
-000145c0: 5f70 6174 682e 6765 7428 2769 6e64 6578  _path.get('index
-000145d0: 6573 2729 290a 0a20 2020 2061 7379 6e63  es'))..    async
-000145e0: 2064 6566 2074 6573 745f 636c 6965 6e74   def test_client
-000145f0: 5f72 6571 7565 7374 5f74 696d 656f 7574  _request_timeout
-00014600: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00014610: 2320 5465 7374 2069 7320 666c 616b 7920  # Test is flaky 
-00014620: 6f6e 2045 6d75 6c61 746f 720a 2020 2020  on Emulator.    
-00014630: 2020 2020 6966 206e 6f74 2028 276c 6f63      if not ('loc
-00014640: 616c 686f 7374 2720 696e 2073 656c 662e  alhost' in self.
-00014650: 686f 7374 206f 7220 2731 3237 2e30 2e30  host or '127.0.0
-00014660: 2e31 2720 696e 2073 656c 662e 686f 7374  .1' in self.host
-00014670: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
-00014680: 6f6e 6e65 6374 696f 6e5f 706f 6c69 6379  onnection_policy
-00014690: 203d 2064 6f63 756d 656e 7473 2e43 6f6e   = documents.Con
-000146a0: 6e65 6374 696f 6e50 6f6c 6963 7928 290a  nectionPolicy().
-000146b0: 2020 2020 2020 2020 2020 2020 2320 6d61              # ma
-000146c0: 6b69 6e67 2074 696d 656f 7574 2030 206d  king timeout 0 m
-000146d0: 7320 746f 206d 616b 6520 7375 7265 2069  s to make sure i
-000146e0: 7420 7769 6c6c 2074 6872 6f77 0a20 2020  t will throw.   
-000146f0: 2020 2020 2020 2020 2063 6f6e 6e65 6374           connect
-00014700: 696f 6e5f 706f 6c69 6379 2e52 6571 7565  ion_policy.Reque
-00014710: 7374 5469 6d65 6f75 7420 3d20 302e 3030  stTimeout = 0.00
-00014720: 3030 3030 3030 3030 3031 0a0a 2020 2020  0000000001..    
-00014730: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-00014740: 662e 6173 7365 7274 5261 6973 6573 2845  f.assertRaises(E
-00014750: 7863 6570 7469 6f6e 293a 0a20 2020 2020  xception):.     
-00014760: 2020 2020 2020 2020 2020 2023 2063 6c69             # cli
-00014770: 656e 7420 646f 6573 2061 2067 6574 4461  ent does a getDa
-00014780: 7461 6261 7365 4163 636f 756e 7420 6f6e  tabaseAccount on
-00014790: 2069 6e69 7469 616c 697a 6174 696f 6e2c   initialization,
-000147a0: 2077 6869 6368 2077 696c 6c20 7469 6d65   which will time
-000147b0: 206f 7574 0a20 2020 2020 2020 2020 2020   out.           
-000147c0: 2020 2020 2061 7379 6e63 2077 6974 6820       async with 
-000147d0: 436f 736d 6f73 436c 6965 6e74 2843 5255  CosmosClient(CRU
-000147e0: 4454 6573 7473 2e68 6f73 742c 2043 5255  DTests.host, CRU
-000147f0: 4454 6573 7473 2e6d 6173 7465 724b 6579  DTests.masterKey
-00014800: 2c20 636f 6e73 6973 7465 6e63 795f 6c65  , consistency_le
-00014810: 7665 6c3d 2253 6573 7369 6f6e 222c 0a20  vel="Session",. 
-00014820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014840: 2020 2020 2020 2020 2020 636f 6e6e 6563            connec
-00014850: 7469 6f6e 5f70 6f6c 6963 793d 636f 6e6e  tion_policy=conn
-00014860: 6563 7469 6f6e 5f70 6f6c 6963 7929 2061  ection_policy) a
-00014870: 7320 636c 6965 6e74 3a0a 2020 2020 2020  s client:.      
-00014880: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00014890: 696e 7428 2741 7379 6e63 2069 6e69 7469  int('Async initi
-000148a0: 616c 697a 6174 696f 6e27 290a 0a20 2020  alization')..   
-000148b0: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
-000148c0: 636c 6965 6e74 5f72 6571 7565 7374 5f74  client_request_t
-000148d0: 696d 656f 7574 5f77 6865 6e5f 636f 6e6e  imeout_when_conn
-000148e0: 6563 7469 6f6e 5f72 6574 7279 5f63 6f6e  ection_retry_con
-000148f0: 6669 6775 7261 7469 6f6e 5f73 7065 6369  figuration_speci
-00014900: 6669 6564 2873 656c 6629 3a0a 2020 2020  fied(self):.    
-00014910: 2020 2020 636f 6e6e 6563 7469 6f6e 5f70      connection_p
-00014920: 6f6c 6963 7920 3d20 646f 6375 6d65 6e74  olicy = document
-00014930: 732e 436f 6e6e 6563 7469 6f6e 506f 6c69  s.ConnectionPoli
-00014940: 6379 2829 0a20 2020 2020 2020 2023 206d  cy().        # m
-00014950: 616b 696e 6720 7469 6d65 6f75 7420 3020  aking timeout 0 
-00014960: 6d73 2074 6f20 6d61 6b65 2073 7572 6520  ms to make sure 
-00014970: 6974 2077 696c 6c20 7468 726f 770a 2020  it will throw.  
-00014980: 2020 2020 2020 636f 6e6e 6563 7469 6f6e        connection
-00014990: 5f70 6f6c 6963 792e 5265 7175 6573 7454  _policy.RequestT
-000149a0: 696d 656f 7574 203d 2030 2e30 3030 3030  imeout = 0.00000
-000149b0: 3030 3030 3030 310a 2020 2020 2020 2020  0000001.        
-000149c0: 636f 6e6e 6563 7469 6f6e 5f70 6f6c 6963  connection_polic
-000149d0: 792e 436f 6e6e 6563 7469 6f6e 5265 7472  y.ConnectionRetr
-000149e0: 7943 6f6e 6669 6775 7261 7469 6f6e 203d  yConfiguration =
-000149f0: 2052 6574 7279 280a 2020 2020 2020 2020   Retry(.        
-00014a00: 2020 2020 746f 7461 6c3d 332c 0a20 2020      total=3,.   
-00014a10: 2020 2020 2020 2020 2072 6561 643d 332c           read=3,
-00014a20: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00014a30: 6e65 6374 3d33 2c0a 2020 2020 2020 2020  nect=3,.        
-00014a40: 2020 2020 6261 636b 6f66 665f 6661 6374      backoff_fact
-00014a50: 6f72 3d30 2e33 2c0a 2020 2020 2020 2020  or=0.3,.        
-00014a60: 2020 2020 7374 6174 7573 5f66 6f72 6365      status_force
-00014a70: 6c69 7374 3d28 3530 302c 2035 3032 2c20  list=(500, 502, 
-00014a80: 3530 3429 0a20 2020 2020 2020 2029 0a20  504).        ). 
-00014a90: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00014aa0: 2e61 7373 6572 7452 6169 7365 7328 417a  .assertRaises(Az
-00014ab0: 7572 6545 7272 6f72 293a 0a20 2020 2020  ureError):.     
-00014ac0: 2020 2020 2020 2023 2063 6c69 656e 7420         # client 
-00014ad0: 646f 6573 2061 2067 6574 4461 7461 6261  does a getDataba
-00014ae0: 7365 4163 636f 756e 7420 6f6e 2069 6e69  seAccount on ini
-00014af0: 7469 616c 697a 6174 696f 6e2c 2077 6869  tialization, whi
-00014b00: 6368 2077 696c 6c20 7469 6d65 206f 7574  ch will time out
-00014b10: 0a20 2020 2020 2020 2020 2020 2061 7379  .            asy
-00014b20: 6e63 2077 6974 6820 436f 736d 6f73 436c  nc with CosmosCl
-00014b30: 6965 6e74 2843 5255 4454 6573 7473 2e68  ient(CRUDTests.h
-00014b40: 6f73 742c 2043 5255 4454 6573 7473 2e6d  ost, CRUDTests.m
-00014b50: 6173 7465 724b 6579 2c20 636f 6e73 6973  asterKey, consis
-00014b60: 7465 6e63 795f 6c65 7665 6c3d 2253 6573  tency_level="Ses
-00014b70: 7369 6f6e 222c 0a20 2020 2020 2020 2020  sion",.         
-00014b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b90: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00014ba0: 6e6e 6563 7469 6f6e 5f70 6f6c 6963 793d  nnection_policy=
-00014bb0: 636f 6e6e 6563 7469 6f6e 5f70 6f6c 6963  connection_polic
-00014bc0: 7929 2061 7320 636c 6965 6e74 3a0a 2020  y) as client:.  
-00014bd0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00014be0: 696e 7428 2741 7379 6e63 2049 6e69 7469  int('Async Initi
-00014bf0: 616c 697a 6174 696f 6e27 290a 0a20 2020  alization')..   
-00014c00: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
-00014c10: 636c 6965 6e74 5f63 6f6e 6e65 6374 696f  client_connectio
-00014c20: 6e5f 7265 7472 795f 636f 6e66 6967 7572  n_retry_configur
-00014c30: 6174 696f 6e28 7365 6c66 293a 0a20 2020  ation(self):.   
-00014c40: 2020 2020 2074 6f74 616c 5f74 696d 655f       total_time_
-00014c50: 666f 725f 7477 6f5f 7265 7472 6965 7320  for_two_retries 
-00014c60: 3d20 6177 6169 7420 7365 6c66 2e69 6e69  = await self.ini
-00014c70: 7469 616c 697a 655f 636c 6965 6e74 5f77  tialize_client_w
-00014c80: 6974 685f 636f 6e6e 6563 7469 6f6e 5f75  ith_connection_u
-00014c90: 726c 6c69 625f 7265 7472 795f 636f 6e66  rllib_retry_conf
-00014ca0: 6967 2832 290a 2020 2020 2020 2020 746f  ig(2).        to
-00014cb0: 7461 6c5f 7469 6d65 5f66 6f72 5f74 6872  tal_time_for_thr
-00014cc0: 6565 5f72 6574 7269 6573 203d 2061 7761  ee_retries = awa
-00014cd0: 6974 2073 656c 662e 696e 6974 6961 6c69  it self.initiali
-00014ce0: 7a65 5f63 6c69 656e 745f 7769 7468 5f63  ze_client_with_c
-00014cf0: 6f6e 6e65 6374 696f 6e5f 7572 6c6c 6962  onnection_urllib
-00014d00: 5f72 6574 7279 5f63 6f6e 6669 6728 3329  _retry_config(3)
-00014d10: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00014d20: 7365 7274 4772 6561 7465 7228 746f 7461  sertGreater(tota
-00014d30: 6c5f 7469 6d65 5f66 6f72 5f74 6872 6565  l_time_for_three
-00014d40: 5f72 6574 7269 6573 2c20 746f 7461 6c5f  _retries, total_
-00014d50: 7469 6d65 5f66 6f72 5f74 776f 5f72 6574  time_for_two_ret
-00014d60: 7269 6573 290a 0a20 2020 2020 2020 2074  ries)..        t
-00014d70: 6f74 616c 5f74 696d 655f 666f 725f 7477  otal_time_for_tw
-00014d80: 6f5f 7265 7472 6965 7320 3d20 6177 6169  o_retries = awai
-00014d90: 7420 7365 6c66 2e69 6e69 7469 616c 697a  t self.initializ
-00014da0: 655f 636c 6965 6e74 5f77 6974 685f 636f  e_client_with_co
-00014db0: 6e6e 6563 7469 6f6e 5f63 6f72 655f 7265  nnection_core_re
-00014dc0: 7472 795f 636f 6e66 6967 2832 290a 2020  try_config(2).  
-00014dd0: 2020 2020 2020 746f 7461 6c5f 7469 6d65        total_time
-00014de0: 5f66 6f72 5f74 6872 6565 5f72 6574 7269  _for_three_retri
-00014df0: 6573 203d 2061 7761 6974 2073 656c 662e  es = await self.
-00014e00: 696e 6974 6961 6c69 7a65 5f63 6c69 656e  initialize_clien
-00014e10: 745f 7769 7468 5f63 6f6e 6e65 6374 696f  t_with_connectio
-00014e20: 6e5f 636f 7265 5f72 6574 7279 5f63 6f6e  n_core_retry_con
-00014e30: 6669 6728 3329 0a20 2020 2020 2020 2073  fig(3).        s
-00014e40: 656c 662e 6173 7365 7274 4772 6561 7465  elf.assertGreate
-00014e50: 7228 746f 7461 6c5f 7469 6d65 5f66 6f72  r(total_time_for
-00014e60: 5f74 6872 6565 5f72 6574 7269 6573 2c20  _three_retries, 
-00014e70: 746f 7461 6c5f 7469 6d65 5f66 6f72 5f74  total_time_for_t
-00014e80: 776f 5f72 6574 7269 6573 290a 0a20 2020  wo_retries)..   
-00014e90: 2061 7379 6e63 2064 6566 2069 6e69 7469   async def initi
-00014ea0: 616c 697a 655f 636c 6965 6e74 5f77 6974  alize_client_wit
-00014eb0: 685f 636f 6e6e 6563 7469 6f6e 5f75 726c  h_connection_url
-00014ec0: 6c69 625f 7265 7472 795f 636f 6e66 6967  lib_retry_config
-00014ed0: 2873 656c 662c 2072 6574 7269 6573 293a  (self, retries):
-00014ee0: 0a20 2020 2020 2020 2072 6574 7279 5f70  .        retry_p
-00014ef0: 6f6c 6963 7920 3d20 5265 7472 7928 0a20  olicy = Retry(. 
-00014f00: 2020 2020 2020 2020 2020 2074 6f74 616c             total
-00014f10: 3d72 6574 7269 6573 2c0a 2020 2020 2020  =retries,.      
-00014f20: 2020 2020 2020 7265 6164 3d72 6574 7269        read=retri
-00014f30: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-00014f40: 636f 6e6e 6563 743d 7265 7472 6965 732c  connect=retries,
-00014f50: 0a20 2020 2020 2020 2020 2020 2062 6163  .            bac
-00014f60: 6b6f 6666 5f66 6163 746f 723d 302e 332c  koff_factor=0.3,
-00014f70: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-00014f80: 7475 735f 666f 7263 656c 6973 743d 2835  tus_forcelist=(5
-00014f90: 3030 2c20 3530 322c 2035 3034 290a 2020  00, 502, 504).  
-00014fa0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00014fb0: 7374 6172 745f 7469 6d65 203d 2074 696d  start_time = tim
-00014fc0: 652e 7469 6d65 2829 0a20 2020 2020 2020  e.time().       
-00014fd0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00014fe0: 2020 6173 796e 6320 7769 7468 2043 6f73    async with Cos
-00014ff0: 6d6f 7343 6c69 656e 7428 0a20 2020 2020  mosClient(.     
-00015000: 2020 2020 2020 2020 2020 2022 6874 7470             "http
-00015010: 733a 2f2f 6c6f 6361 6c68 6f73 743a 3939  s://localhost:99
-00015020: 3939 222c 0a20 2020 2020 2020 2020 2020  99",.           
-00015030: 2020 2020 2043 5255 4454 6573 7473 2e6d       CRUDTests.m
-00015040: 6173 7465 724b 6579 2c0a 2020 2020 2020  asterKey,.      
-00015050: 2020 2020 2020 2020 2020 636f 6e73 6973            consis
-00015060: 7465 6e63 795f 6c65 7665 6c3d 2253 6573  tency_level="Ses
-00015070: 7369 6f6e 222c 0a20 2020 2020 2020 2020  sion",.         
-00015080: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
-00015090: 6e5f 7265 7472 795f 706f 6c69 6379 3d72  n_retry_policy=r
-000150a0: 6574 7279 5f70 6f6c 6963 7929 2061 7320  etry_policy) as 
-000150b0: 636c 6965 6e74 3a20 7072 696e 7428 2741  client: print('A
-000150c0: 7379 6e63 2069 6e69 7469 616c 697a 6174  sync initializat
-000150d0: 696f 6e27 290a 2020 2020 2020 2020 2020  ion').          
-000150e0: 2020 7365 6c66 2e66 6169 6c28 290a 2020    self.fail().  
-000150f0: 2020 2020 2020 6578 6365 7074 2041 7a75        except Azu
-00015100: 7265 4572 726f 7220 6173 2065 3a0a 2020  reError as e:.  
-00015110: 2020 2020 2020 2020 2020 656e 645f 7469            end_ti
-00015120: 6d65 203d 2074 696d 652e 7469 6d65 2829  me = time.time()
-00015130: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00015140: 7572 6e20 656e 645f 7469 6d65 202d 2073  urn end_time - s
-00015150: 7461 7274 5f74 696d 650a 0a20 2020 2061  tart_time..    a
-00015160: 7379 6e63 2064 6566 2069 6e69 7469 616c  sync def initial
-00015170: 697a 655f 636c 6965 6e74 5f77 6974 685f  ize_client_with_
-00015180: 636f 6e6e 6563 7469 6f6e 5f63 6f72 655f  connection_core_
-00015190: 7265 7472 795f 636f 6e66 6967 2873 656c  retry_config(sel
-000151a0: 662c 2072 6574 7269 6573 293a 0a20 2020  f, retries):.   
-000151b0: 2020 2020 2073 7461 7274 5f74 696d 6520       start_time 
-000151c0: 3d20 7469 6d65 2e74 696d 6528 290a 2020  = time.time().  
-000151d0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000151e0: 2020 2020 2020 2061 7379 6e63 2077 6974         async wit
-000151f0: 6820 436f 736d 6f73 436c 6965 6e74 280a  h CosmosClient(.
-00015200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015210: 2268 7474 7073 3a2f 2f6c 6f63 616c 686f  "https://localho
-00015220: 7374 3a39 3939 3922 2c0a 2020 2020 2020  st:9999",.      
-00015230: 2020 2020 2020 2020 2020 4352 5544 5465            CRUDTe
-00015240: 7374 732e 6d61 7374 6572 4b65 792c 0a20  sts.masterKey,. 
-00015250: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00015260: 6f6e 7369 7374 656e 6379 5f6c 6576 656c  onsistency_level
-00015270: 3d22 5365 7373 696f 6e22 2c0a 2020 2020  ="Session",.    
-00015280: 2020 2020 2020 2020 2020 2020 7265 7472              retr
-00015290: 795f 746f 7461 6c3d 7265 7472 6965 732c  y_total=retries,
-000152a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000152b0: 2072 6574 7279 5f72 6561 643d 7265 7472   retry_read=retr
-000152c0: 6965 732c 0a20 2020 2020 2020 2020 2020  ies,.           
-000152d0: 2020 2020 2072 6574 7279 5f63 6f6e 6e65       retry_conne
-000152e0: 6374 3d72 6574 7269 6573 2c0a 2020 2020  ct=retries,.    
-000152f0: 2020 2020 2020 2020 2020 2020 7265 7472              retr
-00015300: 795f 7374 6174 7573 3d72 6574 7269 6573  y_status=retries
-00015310: 2920 6173 2063 6c69 656e 743a 2070 7269  ) as client: pri
-00015320: 6e74 2827 4173 796e 6320 696e 6974 6961  nt('Async initia
-00015330: 6c69 7a61 7469 6f6e 2729 0a20 2020 2020  lization').     
-00015340: 2020 2020 2020 2073 656c 662e 6661 696c         self.fail
-00015350: 2829 0a20 2020 2020 2020 2065 7863 6570  ().        excep
-00015360: 7420 417a 7572 6545 7272 6f72 2061 7320  t AzureError as 
-00015370: 653a 0a20 2020 2020 2020 2020 2020 2065  e:.            e
-00015380: 6e64 5f74 696d 6520 3d20 7469 6d65 2e74  nd_time = time.t
-00015390: 696d 6528 290a 2020 2020 2020 2020 2020  ime().          
-000153a0: 2020 7265 7475 726e 2065 6e64 5f74 696d    return end_tim
-000153b0: 6520 2d20 7374 6172 745f 7469 6d65 0a0a  e - start_time..
-000153c0: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-000153d0: 7374 5f61 6273 6f6c 7574 655f 636c 6965  st_absolute_clie
-000153e0: 6e74 5f74 696d 656f 7574 2873 656c 6629  nt_timeout(self)
-000153f0: 3a0a 2020 2020 2020 2020 7769 7468 2073  :.        with s
-00015400: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-00015410: 2865 7863 6570 7469 6f6e 732e 436f 736d  (exceptions.Cosm
-00015420: 6f73 436c 6965 6e74 5469 6d65 6f75 7445  osClientTimeoutE
-00015430: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-00015440: 2020 2061 7379 6e63 2077 6974 6820 436f     async with Co
-00015450: 736d 6f73 436c 6965 6e74 280a 2020 2020  smosClient(.    
-00015460: 2020 2020 2020 2020 2020 2020 2268 7474              "htt
-00015470: 7073 3a2f 2f6c 6f63 616c 686f 7374 3a39  ps://localhost:9
-00015480: 3939 3922 2c0a 2020 2020 2020 2020 2020  999",.          
-00015490: 2020 2020 2020 4352 5544 5465 7374 732e        CRUDTests.
-000154a0: 6d61 7374 6572 4b65 792c 0a20 2020 2020  masterKey,.     
-000154b0: 2020 2020 2020 2020 2020 2063 6f6e 7369             consi
-000154c0: 7374 656e 6379 5f6c 6576 656c 3d22 5365  stency_level="Se
-000154d0: 7373 696f 6e22 2c0a 2020 2020 2020 2020  ssion",.        
-000154e0: 2020 2020 2020 2020 7265 7472 795f 746f          retry_to
-000154f0: 7461 6c3d 332c 0a20 2020 2020 2020 2020  tal=3,.         
-00015500: 2020 2020 2020 2074 696d 656f 7574 3d31         timeout=1
-00015510: 2961 7320 636c 6965 6e74 3a20 7072 696e  )as client: prin
-00015520: 7428 2741 7379 6e63 2069 6e69 7469 616c  t('Async initial
-00015530: 697a 6174 696f 6e27 290a 0a20 2020 2020  ization')..     
-00015540: 2020 2065 7272 6f72 5f72 6573 706f 6e73     error_respons
-00015550: 6520 3d20 5365 7276 6963 6552 6573 706f  e = ServiceRespo
-00015560: 6e73 6545 7272 6f72 2822 5265 6164 2074  nseError("Read t
-00015570: 696d 656f 7574 2229 0a20 2020 2020 2020  imeout").       
-00015580: 2074 696d 656f 7574 5f74 7261 6e73 706f   timeout_transpo
-00015590: 7274 203d 2054 696d 656f 7574 5472 616e  rt = TimeoutTran
-000155a0: 7370 6f72 7428 6572 726f 725f 7265 7370  sport(error_resp
-000155b0: 6f6e 7365 290a 2020 2020 2020 2020 6173  onse).        as
-000155c0: 796e 6320 7769 7468 2043 6f73 6d6f 7343  ync with CosmosC
-000155d0: 6c69 656e 7428 0a20 2020 2020 2020 2020  lient(.         
-000155e0: 2020 2073 656c 662e 686f 7374 2c20 7365     self.host, se
-000155f0: 6c66 2e6d 6173 7465 724b 6579 2c20 636f  lf.masterKey, co
-00015600: 6e73 6973 7465 6e63 795f 6c65 7665 6c3d  nsistency_level=
-00015610: 2253 6573 7369 6f6e 222c 2074 7261 6e73  "Session", trans
-00015620: 706f 7274 3d74 696d 656f 7574 5f74 7261  port=timeout_tra
-00015630: 6e73 706f 7274 2c20 7061 7373 7468 726f  nsport, passthro
-00015640: 7567 683d 5472 7565 2920 6173 2063 6c69  ugh=True) as cli
-00015650: 656e 743a 2070 7269 6e74 2827 4173 796e  ent: print('Asyn
-00015660: 6320 696e 6974 6961 6c69 7a61 7469 6f6e  c initialization
-00015670: 2729 0a0a 2020 2020 2020 2020 7769 7468  ')..        with
-00015680: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-00015690: 6573 2865 7863 6570 7469 6f6e 732e 436f  es(exceptions.Co
-000156a0: 736d 6f73 436c 6965 6e74 5469 6d65 6f75  smosClientTimeou
-000156b0: 7445 7272 6f72 293a 0a20 2020 2020 2020  tError):.       
-000156c0: 2020 2020 2061 7761 6974 2063 6c69 656e       await clien
-000156d0: 742e 6372 6561 7465 5f64 6174 6162 6173  t.create_databas
-000156e0: 655f 6966 5f6e 6f74 5f65 7869 7374 7328  e_if_not_exists(
-000156f0: 2274 6573 7422 2c20 7469 6d65 6f75 743d  "test", timeout=
-00015700: 3229 0a0a 2020 2020 2020 2020 7374 6174  2)..        stat
-00015710: 7573 5f72 6573 706f 6e73 6520 3d20 3530  us_response = 50
-00015720: 3020 2023 2055 7365 7273 2063 6f6e 6e65  0  # Users conne
-00015730: 6374 696f 6e20 6c65 7665 6c20 7265 7472  ction level retr
-00015740: 790a 2020 2020 2020 2020 7469 6d65 6f75  y.        timeou
-00015750: 745f 7472 616e 7370 6f72 7420 3d20 5469  t_transport = Ti
-00015760: 6d65 6f75 7454 7261 6e73 706f 7274 2873  meoutTransport(s
-00015770: 7461 7475 735f 7265 7370 6f6e 7365 290a  tatus_response).
-00015780: 2020 2020 2020 2020 6173 796e 6320 7769          async wi
-00015790: 7468 2043 6f73 6d6f 7343 6c69 656e 7428  th CosmosClient(
-000157a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000157b0: 2073 656c 662e 686f 7374 2c20 7365 6c66   self.host, self
-000157c0: 2e6d 6173 7465 724b 6579 2c20 636f 6e73  .masterKey, cons
-000157d0: 6973 7465 6e63 795f 6c65 7665 6c3d 2253  istency_level="S
-000157e0: 6573 7369 6f6e 222c 2074 7261 6e73 706f  ession", transpo
-000157f0: 7274 3d74 696d 656f 7574 5f74 7261 6e73  rt=timeout_trans
-00015800: 706f 7274 2c20 7061 7373 7468 726f 7567  port, passthroug
-00015810: 683d 5472 7565 2920 6173 2063 6c69 656e  h=True) as clien
-00015820: 743a 2070 7269 6e74 280a 2020 2020 2020  t: print(.      
-00015830: 2020 2020 2020 2741 7379 6e63 2069 6e69        'Async ini
-00015840: 7469 616c 697a 6174 696f 6e27 290a 2020  tialization').  
-00015850: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-00015860: 6173 7365 7274 5261 6973 6573 2865 7863  assertRaises(exc
-00015870: 6570 7469 6f6e 732e 436f 736d 6f73 436c  eptions.CosmosCl
-00015880: 6965 6e74 5469 6d65 6f75 7445 7272 6f72  ientTimeoutError
-00015890: 293a 0a20 2020 2020 2020 2020 2020 2061  ):.            a
-000158a0: 7761 6974 2063 6c69 656e 742e 6372 6561  wait client.crea
-000158b0: 7465 5f64 6174 6162 6173 6528 2274 6573  te_database("tes
-000158c0: 7422 2c20 7469 6d65 6f75 743d 3229 0a0a  t", timeout=2)..
-000158d0: 2020 2020 2020 2020 6461 7461 6261 7365          database
-000158e0: 7320 3d20 636c 6965 6e74 2e6c 6973 745f  s = client.list_
-000158f0: 6461 7461 6261 7365 7328 7469 6d65 6f75  databases(timeou
-00015900: 743d 3229 0a20 2020 2020 2020 2077 6974  t=2).        wit
-00015910: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-00015920: 7365 7328 6578 6365 7074 696f 6e73 2e43  ses(exceptions.C
-00015930: 6f73 6d6f 7343 6c69 656e 7454 696d 656f  osmosClientTimeo
-00015940: 7574 4572 726f 7229 3a0a 2020 2020 2020  utError):.      
-00015950: 2020 2020 2020 6461 7461 6261 7365 7320        databases 
-00015960: 3d20 5b64 6174 6162 6173 6520 6173 796e  = [database asyn
-00015970: 6320 666f 7220 6461 7461 6261 7365 2069  c for database i
-00015980: 6e20 6461 7461 6261 7365 735d 0a0a 2020  n databases]..  
-00015990: 2020 2020 2020 7374 6174 7573 5f72 6573        status_res
-000159a0: 706f 6e73 6520 3d20 3432 3920 2023 2055  ponse = 429  # U
-000159b0: 7365 7320 436f 736d 6f73 2063 7573 746f  ses Cosmos custo
-000159c0: 6d20 7265 7472 790a 2020 2020 2020 2020  m retry.        
-000159d0: 7469 6d65 6f75 745f 7472 616e 7370 6f72  timeout_transpor
-000159e0: 7420 3d20 5469 6d65 6f75 7454 7261 6e73  t = TimeoutTrans
-000159f0: 706f 7274 2873 7461 7475 735f 7265 7370  port(status_resp
-00015a00: 6f6e 7365 290a 2020 2020 2020 2020 6173  onse).        as
-00015a10: 796e 6320 7769 7468 2043 6f73 6d6f 7343  ync with CosmosC
-00015a20: 6c69 656e 7428 0a20 2020 2020 2020 2020  lient(.         
-00015a30: 2020 2020 2020 2073 656c 662e 686f 7374         self.host
-00015a40: 2c20 7365 6c66 2e6d 6173 7465 724b 6579  , self.masterKey
-00015a50: 2c20 636f 6e73 6973 7465 6e63 795f 6c65  , consistency_le
-00015a60: 7665 6c3d 2253 6573 7369 6f6e 222c 2074  vel="Session", t
-00015a70: 7261 6e73 706f 7274 3d74 696d 656f 7574  ransport=timeout
-00015a80: 5f74 7261 6e73 706f 7274 2c20 7061 7373  _transport, pass
-00015a90: 7468 726f 7567 683d 5472 7565 2920 6173  through=True) as
-00015aa0: 2063 6c69 656e 743a 2070 7269 6e74 280a   client: print(.
-00015ab0: 2020 2020 2020 2020 2020 2020 2741 7379              'Asy
-00015ac0: 6e63 2069 6e69 7469 616c 697a 6174 696f  nc initializatio
-00015ad0: 6e27 290a 2020 2020 2020 2020 7769 7468  n').        with
-00015ae0: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-00015af0: 6573 2865 7863 6570 7469 6f6e 732e 436f  es(exceptions.Co
-00015b00: 736d 6f73 436c 6965 6e74 5469 6d65 6f75  smosClientTimeou
-00015b10: 7445 7272 6f72 293a 0a20 2020 2020 2020  tError):.       
-00015b20: 2020 2020 2061 7761 6974 2063 6c69 656e       await clien
-00015b30: 742e 6372 6561 7465 5f64 6174 6162 6173  t.create_databas
-00015b40: 655f 6966 5f6e 6f74 5f65 7869 7374 7328  e_if_not_exists(
-00015b50: 2274 6573 7422 2c20 7469 6d65 6f75 743d  "test", timeout=
-00015b60: 3229 0a0a 2020 2020 2020 2020 6461 7461  2)..        data
-00015b70: 6261 7365 7320 3d20 636c 6965 6e74 2e6c  bases = client.l
-00015b80: 6973 745f 6461 7461 6261 7365 7328 7469  ist_databases(ti
-00015b90: 6d65 6f75 743d 3229 0a20 2020 2020 2020  meout=2).       
-00015ba0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-00015bb0: 7452 6169 7365 7328 6578 6365 7074 696f  tRaises(exceptio
-00015bc0: 6e73 2e43 6f73 6d6f 7343 6c69 656e 7454  ns.CosmosClientT
-00015bd0: 696d 656f 7574 4572 726f 7229 3a0a 2020  imeoutError):.  
-00015be0: 2020 2020 2020 2020 2020 6461 7461 6261            databa
-00015bf0: 7365 7320 3d20 5b64 6174 6162 6173 6520  ses = [database 
-00015c00: 6173 796e 6320 666f 7220 6461 7461 6261  async for databa
-00015c10: 7365 2069 6e20 6461 7461 6261 7365 735d  se in databases]
-00015c20: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
-00015c30: 7465 7374 5f71 7565 7279 5f69 7465 7261  test_query_itera
-00015c40: 626c 655f 6675 6e63 7469 6f6e 616c 6974  ble_functionalit
-00015c50: 7928 7365 6c66 293a 0a20 2020 2020 2020  y(self):.       
-00015c60: 2061 7379 6e63 2064 6566 205f 5f63 7265   async def __cre
-00015c70: 6174 655f 7265 736f 7572 6365 7328 636c  ate_resources(cl
-00015c80: 6965 6e74 293a 0a20 2020 2020 2020 2020  ient):.         
-00015c90: 2020 2022 2222 4372 6561 7465 7320 7265     """Creates re
-00015ca0: 736f 7572 6365 7320 666f 7220 7468 6973  sources for this
-00015cb0: 2074 6573 742e 0a0a 2020 2020 2020 2020   test...        
-00015cc0: 2020 2020 3a50 6172 616d 6574 6572 733a      :Parameters:
-00015cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015ce0: 202d 2060 636c 6965 6e74 603a 2063 6f73   - `client`: cos
-00015cf0: 6d6f 735f 636c 6965 6e74 5f63 6f6e 6e65  mos_client_conne
-00015d00: 6374 696f 6e2e 436f 736d 6f73 436c 6965  ction.CosmosClie
-00015d10: 6e74 436f 6e6e 6563 7469 6f6e 0a0a 2020  ntConnection..  
-00015d20: 2020 2020 2020 2020 2020 3a52 6574 7572            :Retur
-00015d30: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-00015d40: 2020 2020 6469 6374 0a0a 2020 2020 2020      dict..      
-00015d50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00015d60: 2020 2020 2020 636f 6c6c 6563 7469 6f6e        collection
-00015d70: 203d 2061 7761 6974 2073 656c 662e 6461   = await self.da
-00015d80: 7461 6261 7365 466f 7254 6573 742e 6372  tabaseForTest.cr
-00015d90: 6561 7465 5f63 6f6e 7461 696e 6572 2874  eate_container(t
-00015da0: 6573 745f 636f 6e66 6967 2e5f 7465 7374  est_config._test
-00015db0: 5f63 6f6e 6669 672e 5445 5354 5f43 4f4c  _config.TEST_COL
-00015dc0: 4c45 4354 494f 4e5f 4d55 4c54 495f 5041  LECTION_MULTI_PA
-00015dd0: 5254 4954 494f 4e5f 5749 5448 5f43 5553  RTITION_WITH_CUS
-00015de0: 544f 4d5f 504b 5f50 4152 5449 5449 4f4e  TOM_PK_PARTITION
-00015df0: 5f4b 4559 2c20 5061 7274 6974 696f 6e4b  _KEY, PartitionK
-00015e00: 6579 2870 6174 683d 222f 706b 2229 290a  ey(path="/pk")).
-00015e10: 2020 2020 2020 2020 2020 2020 646f 6331              doc1
-00015e20: 203d 2061 7761 6974 2063 6f6c 6c65 6374   = await collect
-00015e30: 696f 6e2e 6372 6561 7465 5f69 7465 6d28  ion.create_item(
-00015e40: 626f 6479 3d7b 2769 6427 3a20 2764 6f63  body={'id': 'doc
-00015e50: 3127 2c20 2770 726f 7031 273a 2027 7661  1', 'prop1': 'va
-00015e60: 6c75 6531 277d 290a 2020 2020 2020 2020  lue1'}).        
-00015e70: 2020 2020 646f 6332 203d 2061 7761 6974      doc2 = await
-00015e80: 2063 6f6c 6c65 6374 696f 6e2e 6372 6561   collection.crea
-00015e90: 7465 5f69 7465 6d28 626f 6479 3d7b 2769  te_item(body={'i
-00015ea0: 6427 3a20 2764 6f63 3227 2c20 2770 726f  d': 'doc2', 'pro
-00015eb0: 7031 273a 2027 7661 6c75 6532 277d 290a  p1': 'value2'}).
-00015ec0: 2020 2020 2020 2020 2020 2020 646f 6333              doc3
-00015ed0: 203d 2061 7761 6974 2063 6f6c 6c65 6374   = await collect
-00015ee0: 696f 6e2e 6372 6561 7465 5f69 7465 6d28  ion.create_item(
-00015ef0: 626f 6479 3d7b 2769 6427 3a20 2764 6f63  body={'id': 'doc
-00015f00: 3327 2c20 2770 726f 7031 273a 2027 7661  3', 'prop1': 'va
-00015f10: 6c75 6533 277d 290a 2020 2020 2020 2020  lue3'}).        
-00015f20: 2020 2020 7265 736f 7572 6365 7320 3d20      resources = 
-00015f30: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00015f40: 2020 2763 6f6c 6c27 3a20 636f 6c6c 6563    'coll': collec
-00015f50: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-00015f60: 2020 2020 2020 2764 6f63 3127 3a20 646f        'doc1': do
-00015f70: 6331 2c0a 2020 2020 2020 2020 2020 2020  c1,.            
-00015f80: 2020 2020 2764 6f63 3227 3a20 646f 6332      'doc2': doc2
-00015f90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015fa0: 2020 2764 6f63 3327 3a20 646f 6333 0a20    'doc3': doc3. 
-00015fb0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-00015fc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00015fd0: 7265 736f 7572 6365 730a 0a20 2020 2020  resources..     
-00015fe0: 2020 2023 2056 616c 6964 6174 6520 5175     # Validate Qu
-00015ff0: 6572 7949 7465 7261 626c 6520 6279 2063  eryIterable by c
-00016000: 6f6e 7665 7274 696e 6720 6974 2074 6f20  onverting it to 
-00016010: 6120 6c69 7374 2e0a 2020 2020 2020 2020  a list..        
-00016020: 7265 736f 7572 6365 7320 3d20 6177 6169  resources = awai
-00016030: 7420 5f5f 6372 6561 7465 5f72 6573 6f75  t __create_resou
-00016040: 7263 6573 2873 656c 662e 636c 6965 6e74  rces(self.client
-00016050: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-00016060: 7320 3d20 7265 736f 7572 6365 735b 2763  s = resources['c
-00016070: 6f6c 6c27 5d2e 7265 6164 5f61 6c6c 5f69  oll'].read_all_i
-00016080: 7465 6d73 286d 6178 5f69 7465 6d5f 636f  tems(max_item_co
-00016090: 756e 743d 3229 0a20 2020 2020 2020 2064  unt=2).        d
-000160a0: 6f63 7320 3d20 5b64 6f63 2061 7379 6e63  ocs = [doc async
-000160b0: 2066 6f72 2064 6f63 2069 6e20 7265 7375   for doc in resu
-000160c0: 6c74 735d 0a20 2020 2020 2020 2073 656c  lts].        sel
-000160d0: 662e 6173 7365 7274 4571 7561 6c28 332c  f.assertEqual(3,
-000160e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000160f0: 2020 2020 2020 2020 2020 6c65 6e28 646f            len(do
-00016100: 6373 292c 0a20 2020 2020 2020 2020 2020  cs),.           
-00016110: 2020 2020 2020 2020 2020 2020 2020 2751                'Q
-00016120: 7565 7279 4974 6572 6162 6c65 2073 686f  ueryIterable sho
-00016130: 756c 6420 7265 7475 726e 2061 6c6c 2064  uld return all d
-00016140: 6f63 756d 656e 7473 2720 2b0a 2020 2020  ocuments' +.    
-00016150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016160: 2020 2020 2027 2075 7369 6e67 2063 6f6e       ' using con
-00016170: 7469 6e75 6174 696f 6e27 290a 2020 2020  tinuation').    
-00016180: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00016190: 7175 616c 2872 6573 6f75 7263 6573 5b27  qual(resources['
-000161a0: 646f 6331 275d 5b27 6964 275d 2c20 646f  doc1']['id'], do
-000161b0: 6373 5b30 5d5b 2769 6427 5d29 0a20 2020  cs[0]['id']).   
-000161c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000161d0: 4571 7561 6c28 7265 736f 7572 6365 735b  Equal(resources[
-000161e0: 2764 6f63 3227 5d5b 2769 6427 5d2c 2064  'doc2']['id'], d
-000161f0: 6f63 735b 315d 5b27 6964 275d 290a 2020  ocs[1]['id']).  
-00016200: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00016210: 7445 7175 616c 2872 6573 6f75 7263 6573  tEqual(resources
-00016220: 5b27 646f 6333 275d 5b27 6964 275d 2c20  ['doc3']['id'], 
-00016230: 646f 6373 5b32 5d5b 2769 6427 5d29 0a0a  docs[2]['id'])..
-00016240: 2020 2020 2020 2020 2320 5661 6c69 6461          # Valida
-00016250: 7465 2051 7565 7279 4974 6572 6162 6c65  te QueryIterable
-00016260: 2069 7465 7261 746f 7220 7769 7468 2027   iterator with '
-00016270: 666f 7227 2e0a 2020 2020 2020 2020 7265  for'..        re
-00016280: 7375 6c74 7320 3d20 7265 736f 7572 6365  sults = resource
-00016290: 735b 2763 6f6c 6c27 5d2e 7265 6164 5f61  s['coll'].read_a
-000162a0: 6c6c 5f69 7465 6d73 286d 6178 5f69 7465  ll_items(max_ite
-000162b0: 6d5f 636f 756e 743d 3229 0a20 2020 2020  m_count=2).     
-000162c0: 2020 2063 6f75 6e74 6572 203d 2030 0a20     counter = 0. 
-000162d0: 2020 2020 2020 2023 2074 6573 7420 5175         # test Qu
-000162e0: 6572 7949 7465 7261 626c 6520 7769 7468  eryIterable with
-000162f0: 2027 666f 7227 2e0a 2020 2020 2020 2020   'for'..        
-00016300: 6173 796e 6320 666f 7220 646f 6320 696e  async for doc in
-00016310: 2072 6573 756c 7473 3a0a 2020 2020 2020   results:.      
-00016320: 2020 2020 2020 636f 756e 7465 7220 2b3d        counter +=
-00016330: 2031 0a20 2020 2020 2020 2020 2020 2069   1.            i
-00016340: 6620 636f 756e 7465 7220 3d3d 2031 3a0a  f counter == 1:.
-00016350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016360: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00016370: 2872 6573 6f75 7263 6573 5b27 646f 6331  (resources['doc1
-00016380: 275d 5b27 6964 275d 2c0a 2020 2020 2020  ']['id'],.      
-00016390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000163a0: 2020 2020 2020 2020 2020 2064 6f63 5b27             doc['
-000163b0: 6964 275d 2c0a 2020 2020 2020 2020 2020  id'],.          
-000163c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000163d0: 2020 2020 2020 2027 6669 7273 7420 646f         'first do
-000163e0: 6375 6d65 6e74 2073 686f 756c 6420 6265  cument should be
-000163f0: 2064 6f63 3127 290a 2020 2020 2020 2020   doc1').        
-00016400: 2020 2020 656c 6966 2063 6f75 6e74 6572      elif counter
-00016410: 203d 3d20 323a 0a20 2020 2020 2020 2020   == 2:.         
-00016420: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00016430: 7274 4571 7561 6c28 7265 736f 7572 6365  rtEqual(resource
-00016440: 735b 2764 6f63 3227 5d5b 2769 6427 5d2c  s['doc2']['id'],
-00016450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016470: 2020 646f 635b 2769 6427 5d2c 0a20 2020    doc['id'],.   
-00016480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016490: 2020 2020 2020 2020 2020 2020 2020 2773                's
-000164a0: 6563 6f6e 6420 646f 6375 6d65 6e74 2073  econd document s
-000164b0: 686f 756c 6420 6265 2064 6f63 3227 290a  hould be doc2').
-000164c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000164d0: 2063 6f75 6e74 6572 203d 3d20 333a 0a20   counter == 3:. 
-000164e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000164f0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00016500: 7265 736f 7572 6365 735b 2764 6f63 3327  resources['doc3'
-00016510: 5d5b 2769 6427 5d2c 0a20 2020 2020 2020  ]['id'],.       
-00016520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016530: 2020 2020 2020 2020 2020 646f 635b 2769            doc['i
-00016540: 6427 5d2c 0a20 2020 2020 2020 2020 2020  d'],.           
-00016550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016560: 2020 2020 2020 2774 6869 7264 2064 6f63        'third doc
-00016570: 756d 656e 7420 7368 6f75 6c64 2062 6520  ument should be 
-00016580: 646f 6333 2729 0a20 2020 2020 2020 2073  doc3').        s
-00016590: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000165a0: 636f 756e 7465 722c 2033 290a 0a20 2020  counter, 3)..   
-000165b0: 2020 2020 2023 2047 6574 2071 7565 7279       # Get query
-000165c0: 2072 6573 756c 7473 2070 6167 6520 6279   results page by
-000165d0: 2070 6167 652e 0a20 2020 2020 2020 2072   page..        r
-000165e0: 6573 756c 7473 203d 2072 6573 6f75 7263  esults = resourc
-000165f0: 6573 5b27 636f 6c6c 275d 2e72 6561 645f  es['coll'].read_
-00016600: 616c 6c5f 6974 656d 7328 6d61 785f 6974  all_items(max_it
-00016610: 656d 5f63 6f75 6e74 3d32 290a 0a20 2020  em_count=2)..   
-00016620: 2020 2020 2070 6167 655f 6974 6572 203d       page_iter =
-00016630: 2072 6573 756c 7473 2e62 795f 7061 6765   results.by_page
-00016640: 2829 0a20 2020 2020 2020 2066 6972 7374  ().        first
-00016650: 5f62 6c6f 636b 203d 205b 7061 6765 2061  _block = [page a
-00016660: 7379 6e63 2066 6f72 2070 6167 6520 696e  sync for page in
-00016670: 206e 6578 7428 7061 6765 5f69 7465 7229   next(page_iter)
-00016680: 5d0a 2020 2020 2020 2020 7365 6c66 2e61  ].        self.a
-00016690: 7373 6572 7445 7175 616c 2832 2c20 6c65  ssertEqual(2, le
-000166a0: 6e28 6669 7273 745f 626c 6f63 6b29 2c20  n(first_block), 
-000166b0: 2746 6972 7374 2062 6c6f 636b 2073 686f  'First block sho
-000166c0: 756c 6420 6861 7665 2032 2065 6e74 7269  uld have 2 entri
-000166d0: 6573 2e27 290a 2020 2020 2020 2020 7365  es.').        se
-000166e0: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-000166f0: 6573 6f75 7263 6573 5b27 646f 6331 275d  esources['doc1']
-00016700: 5b27 6964 275d 2c20 6669 7273 745f 626c  ['id'], first_bl
-00016710: 6f63 6b5b 305d 5b27 6964 275d 290a 2020  ock[0]['id']).  
-00016720: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00016730: 7445 7175 616c 2872 6573 6f75 7263 6573  tEqual(resources
-00016740: 5b27 646f 6332 275d 5b27 6964 275d 2c20  ['doc2']['id'], 
-00016750: 6669 7273 745f 626c 6f63 6b5b 315d 5b27  first_block[1]['
-00016760: 6964 275d 290a 2020 2020 2020 2020 7365  id']).        se
-00016770: 6c66 2e61 7373 6572 7445 7175 616c 2831  lf.assertEqual(1
-00016780: 2c20 6c65 6e28 5b70 6167 6520 6173 796e  , len([page asyn
-00016790: 6320 666f 7220 7061 6765 2069 6e20 6e65  c for page in ne
-000167a0: 7874 2870 6167 655f 6974 6572 295d 292c  xt(page_iter)]),
-000167b0: 2027 5365 636f 6e64 2062 6c6f 636b 2073   'Second block s
-000167c0: 686f 756c 6420 6861 7665 2031 2065 6e74  hould have 1 ent
-000167d0: 7279 2e27 290a 2020 2020 2020 2020 7769  ry.').        wi
-000167e0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-000167f0: 6973 6573 2853 746f 7049 7465 7261 7469  ises(StopIterati
-00016800: 6f6e 293a 0a20 2020 2020 2020 2020 2020  on):.           
-00016810: 206e 6578 7428 7061 6765 5f69 7465 7229   next(page_iter)
-00016820: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
-00016830: 7465 7374 5f74 7269 6767 6572 5f66 756e  test_trigger_fun
-00016840: 6374 696f 6e61 6c69 7479 2873 656c 6629  ctionality(self)
-00016850: 3a0a 2020 2020 2020 2020 7472 6967 6765  :.        trigge
-00016860: 7273 5f69 6e5f 636f 6c6c 6563 7469 6f6e  rs_in_collection
-00016870: 3120 3d20 5b0a 2020 2020 2020 2020 2020  1 = [.          
-00016880: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
-00016890: 2020 2020 2769 6427 3a20 2774 3127 2c0a      'id': 't1',.
-000168a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168b0: 2762 6f64 7927 3a20 280a 2020 2020 2020  'body': (.      
-000168c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168d0: 2020 2766 756e 6374 696f 6e28 2920 7b27    'function() {'
-000168e0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-000168f0: 2020 2020 2020 2020 2020 2027 2020 2020             '    
-00016900: 7661 7220 6974 656d 203d 2067 6574 436f  var item = getCo
-00016910: 6e74 6578 7428 292e 6765 7452 6571 7565  ntext().getReque
-00016920: 7374 2829 2e67 6574 426f 6479 2829 3b27  st().getBody();'
-00016930: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00016940: 2020 2020 2020 2020 2020 2027 2020 2020             '    
-00016950: 6974 656d 2e69 6420 3d20 6974 656d 2e69  item.id = item.i
-00016960: 642e 746f 5570 7065 7243 6173 6528 2920  d.toUpperCase() 
-00016970: 2b20 5c27 7431 5c27 3b27 202b 0a20 2020  + \'t1\';' +.   
-00016980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016990: 2020 2020 2027 2020 2020 6765 7443 6f6e       '    getCon
-000169a0: 7465 7874 2829 2e67 6574 5265 7175 6573  text().getReques
-000169b0: 7428 292e 7365 7442 6f64 7928 6974 656d  t().setBody(item
-000169c0: 293b 2720 2b0a 2020 2020 2020 2020 2020  );' +.          
-000169d0: 2020 2020 2020 2020 2020 2020 2020 277d                '}
-000169e0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-000169f0: 2020 2020 2774 7269 6767 6572 5479 7065      'triggerType
-00016a00: 273a 2064 6f63 756d 656e 7473 2e54 7269  ': documents.Tri
-00016a10: 6767 6572 5479 7065 2e50 7265 2c0a 2020  ggerType.Pre,.  
-00016a20: 2020 2020 2020 2020 2020 2020 2020 2774                't
-00016a30: 7269 6767 6572 4f70 6572 6174 696f 6e27  riggerOperation'
-00016a40: 3a20 646f 6375 6d65 6e74 732e 5472 6967  : documents.Trig
-00016a50: 6765 724f 7065 7261 7469 6f6e 2e41 6c6c  gerOperation.All
-00016a60: 0a20 2020 2020 2020 2020 2020 207d 2c0a  .            },.
-00016a70: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
-00016a80: 2020 2020 2020 2020 2020 2020 2020 2769                'i
-00016a90: 6427 3a20 2772 6573 706f 6e73 6531 272c  d': 'response1',
-00016aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ab0: 2027 626f 6479 273a 2028 0a20 2020 2020   'body': (.     
-00016ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ad0: 2020 2027 6675 6e63 7469 6f6e 2829 207b     'function() {
-00016ae0: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
-00016af0: 2020 2020 2020 2020 2020 2020 2720 2020              '   
-00016b00: 2076 6172 2070 7265 626f 6479 203d 2067   var prebody = g
-00016b10: 6574 436f 6e74 6578 7428 292e 6765 7452  etContext().getR
-00016b20: 6571 7565 7374 2829 2e67 6574 426f 6479  equest().getBody
-00016b30: 2829 3b27 202b 0a20 2020 2020 2020 2020  ();' +.         
-00016b40: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00016b50: 2020 2020 6966 2028 7072 6562 6f64 792e      if (prebody.
-00016b60: 6964 2021 3d20 5c27 5445 5354 494e 4720  id != \'TESTING 
-00016b70: 504f 5354 2054 5249 4747 4552 7431 5c27  POST TRIGGERt1\'
-00016b80: 2927 0a20 2020 2020 2020 2020 2020 2020  )'.             
-00016b90: 2020 2020 2020 2020 2020 2027 2020 2020             '    
-00016ba0: 2020 2020 7468 726f 7720 5c27 6964 206d      throw \'id m
-00016bb0: 6973 6d61 7463 685c 273b 2720 2b0a 2020  ismatch\';' +.  
-00016bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016bd0: 2020 2020 2020 2720 2020 2076 6172 2070        '    var p
-00016be0: 6f73 7462 6f64 7920 3d20 6765 7443 6f6e  ostbody = getCon
-00016bf0: 7465 7874 2829 2e67 6574 5265 7370 6f6e  text().getRespon
-00016c00: 7365 2829 2e67 6574 426f 6479 2829 3b27  se().getBody();'
-00016c10: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00016c20: 2020 2020 2020 2020 2020 2027 2020 2020             '    
-00016c30: 6966 2028 706f 7374 626f 6479 2e69 6420  if (postbody.id 
-00016c40: 213d 205c 2754 4553 5449 4e47 2050 4f53  != \'TESTING POS
-00016c50: 5420 5452 4947 4745 5274 315c 2729 270a  T TRIGGERt1\')'.
-00016c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c70: 2020 2020 2020 2020 2720 2020 2020 2020          '       
-00016c80: 2074 6872 6f77 205c 2769 6420 6d69 736d   throw \'id mism
-00016c90: 6174 6368 5c27 3b27 0a20 2020 2020 2020  atch\';'.       
-00016ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cb0: 2027 7d27 292c 0a20 2020 2020 2020 2020   '}'),.         
-00016cc0: 2020 2020 2020 2027 7472 6967 6765 7254         'triggerT
-00016cd0: 7970 6527 3a20 646f 6375 6d65 6e74 732e  ype': documents.
-00016ce0: 5472 6967 6765 7254 7970 652e 506f 7374  TriggerType.Post
-00016cf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00016d00: 2020 2774 7269 6767 6572 4f70 6572 6174    'triggerOperat
-00016d10: 696f 6e27 3a20 646f 6375 6d65 6e74 732e  ion': documents.
-00016d20: 5472 6967 6765 724f 7065 7261 7469 6f6e  TriggerOperation
-00016d30: 2e41 6c6c 0a20 2020 2020 2020 2020 2020  .All.           
-00016d40: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
-00016d50: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00016d60: 2020 2769 6427 3a20 2772 6573 706f 6e73    'id': 'respons
-00016d70: 6532 272c 0a20 2020 2020 2020 2020 2020  e2',.           
-00016d80: 2020 2020 2023 2063 616e 2774 2062 6520       # can't be 
-00016d90: 7573 6564 2062 6563 6175 7365 2073 6574  used because set
-00016da0: 5661 6c75 6520 6973 2063 7572 7265 6e74  Value is current
-00016db0: 6c79 2064 6973 6162 6c65 640a 2020 2020  ly disabled.    
-00016dc0: 2020 2020 2020 2020 2020 2020 2762 6f64              'bod
-00016dd0: 7927 3a20 280a 2020 2020 2020 2020 2020  y': (.          
-00016de0: 2020 2020 2020 2020 2020 2020 2020 2766                'f
-00016df0: 756e 6374 696f 6e28 2920 7b27 202b 0a20  unction() {' +. 
-00016e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e10: 2020 2020 2020 2027 2020 2020 7661 7220         '    var 
-00016e20: 7072 6564 6f63 203d 2067 6574 436f 6e74  predoc = getCont
-00016e30: 6578 7428 292e 6765 7452 6571 7565 7374  ext().getRequest
-00016e40: 2829 2e67 6574 426f 6479 2829 3b27 202b  ().getBody();' +
-00016e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016e60: 2020 2020 2020 2020 2027 2020 2020 7661           '    va
-00016e70: 7220 706f 7374 646f 6320 3d20 6765 7443  r postdoc = getC
-00016e80: 6f6e 7465 7874 2829 2e67 6574 5265 7370  ontext().getResp
-00016e90: 6f6e 7365 2829 2e67 6574 426f 6479 2829  onse().getBody()
-00016ea0: 3b27 202b 0a20 2020 2020 2020 2020 2020  ;' +.           
-00016eb0: 2020 2020 2020 2020 2020 2020 2027 2020               '  
-00016ec0: 2020 6765 7443 6f6e 7465 7874 2829 2e67    getContext().g
-00016ed0: 6574 5265 7370 6f6e 7365 2829 2e73 6574  etResponse().set
-00016ee0: 5661 6c75 6528 2720 2b0a 2020 2020 2020  Value(' +.      
-00016ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f00: 2020 2720 2020 2020 2020 205c 2770 7265    '        \'pre
-00016f10: 646f 636e 616d 655c 272c 2070 7265 646f  docname\', predo
-00016f20: 632e 6964 202b 205c 2772 6573 706f 6e73  c.id + \'respons
-00016f30: 6532 5c27 293b 2720 2b0a 2020 2020 2020  e2\');' +.      
-00016f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f50: 2020 2720 2020 2067 6574 436f 6e74 6578    '    getContex
-00016f60: 7428 292e 6765 7452 6573 706f 6e73 6528  t().getResponse(
-00016f70: 292e 7365 7456 616c 7565 2827 202b 0a20  ).setValue(' +. 
-00016f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f90: 2020 2020 2020 2027 2020 2020 2020 2020         '        
-00016fa0: 5c27 706f 7374 646f 636e 616d 655c 272c  \'postdocname\',
-00016fb0: 2070 6f73 7464 6f63 2e69 6420 2b20 5c27   postdoc.id + \'
-00016fc0: 7265 7370 6f6e 7365 325c 2729 3b27 202b  response2\');' +
-00016fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016fe0: 2020 2020 2020 2020 2027 7d27 292c 0a20           '}'),. 
-00016ff0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00017000: 7472 6967 6765 7254 7970 6527 3a20 646f  triggerType': do
-00017010: 6375 6d65 6e74 732e 5472 6967 6765 7254  cuments.TriggerT
-00017020: 7970 652e 506f 7374 2c0a 2020 2020 2020  ype.Post,.      
-00017030: 2020 2020 2020 2020 2020 2774 7269 6767            'trigg
-00017040: 6572 4f70 6572 6174 696f 6e27 3a20 646f  erOperation': do
-00017050: 6375 6d65 6e74 732e 5472 6967 6765 724f  cuments.TriggerO
-00017060: 7065 7261 7469 6f6e 2e41 6c6c 2c0a 2020  peration.All,.  
-00017070: 2020 2020 2020 2020 2020 7d5d 0a20 2020            }].   
-00017080: 2020 2020 2074 7269 6767 6572 735f 696e       triggers_in
-00017090: 5f63 6f6c 6c65 6374 696f 6e32 203d 205b  _collection2 = [
-000170a0: 0a20 2020 2020 2020 2020 2020 207b 0a20  .            {. 
-000170b0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000170c0: 6964 273a 2022 7432 222c 0a20 2020 2020  id': "t2",.     
-000170d0: 2020 2020 2020 2020 2020 2027 626f 6479             'body
-000170e0: 273a 2022 6675 6e63 7469 6f6e 2829 207b  ': "function() {
-000170f0: 207d 222c 2020 2320 7472 6967 6765 7220   }",  # trigger 
-00017100: 616c 7265 6164 7920 7374 7269 6e67 6966  already stringif
-00017110: 6965 640a 2020 2020 2020 2020 2020 2020  ied.            
-00017120: 2020 2020 2774 7269 6767 6572 5479 7065      'triggerType
-00017130: 273a 2064 6f63 756d 656e 7473 2e54 7269  ': documents.Tri
-00017140: 6767 6572 5479 7065 2e50 7265 2c0a 2020  ggerType.Pre,.  
-00017150: 2020 2020 2020 2020 2020 2020 2020 2774                't
-00017160: 7269 6767 6572 4f70 6572 6174 696f 6e27  riggerOperation'
-00017170: 3a20 646f 6375 6d65 6e74 732e 5472 6967  : documents.Trig
-00017180: 6765 724f 7065 7261 7469 6f6e 2e41 6c6c  gerOperation.All
-00017190: 0a20 2020 2020 2020 2020 2020 207d 2c0a  .            },.
-000171a0: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
-000171b0: 2020 2020 2020 2020 2020 2020 2020 2769                'i
-000171c0: 6427 3a20 2274 3322 2c0a 2020 2020 2020  d': "t3",.      
-000171d0: 2020 2020 2020 2020 2020 2762 6f64 7927            'body'
-000171e0: 3a20 280a 2020 2020 2020 2020 2020 2020  : (.            
-000171f0: 2020 2020 2020 2020 2020 2020 2766 756e              'fun
-00017200: 6374 696f 6e28 2920 7b27 202b 0a20 2020  ction() {' +.   
-00017210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017220: 2020 2020 2027 2020 2020 7661 7220 6974       '    var it
-00017230: 656d 203d 2067 6574 436f 6e74 6578 7428  em = getContext(
-00017240: 292e 6765 7452 6571 7565 7374 2829 2e67  ).getRequest().g
-00017250: 6574 426f 6479 2829 3b27 202b 0a20 2020  etBody();' +.   
-00017260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017270: 2020 2020 2027 2020 2020 6974 656d 2e69       '    item.i
-00017280: 6420 3d20 6974 656d 2e69 642e 746f 4c6f  d = item.id.toLo
-00017290: 7765 7243 6173 6528 2920 2b20 5c27 7433  werCase() + \'t3
-000172a0: 5c27 3b27 202b 0a20 2020 2020 2020 2020  \';' +.         
-000172b0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000172c0: 2020 2020 6765 7443 6f6e 7465 7874 2829      getContext()
-000172d0: 2e67 6574 5265 7175 6573 7428 292e 7365  .getRequest().se
-000172e0: 7442 6f64 7928 6974 656d 293b 2720 2b0a  tBody(item);' +.
-000172f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017300: 2020 2020 2020 2020 277d 2729 2c0a 2020          '}'),.  
-00017310: 2020 2020 2020 2020 2020 2020 2020 2774                't
-00017320: 7269 6767 6572 5479 7065 273a 2064 6f63  riggerType': doc
-00017330: 756d 656e 7473 2e54 7269 6767 6572 5479  uments.TriggerTy
-00017340: 7065 2e50 7265 2c0a 2020 2020 2020 2020  pe.Pre,.        
-00017350: 2020 2020 2020 2020 2774 7269 6767 6572          'trigger
-00017360: 4f70 6572 6174 696f 6e27 3a20 646f 6375  Operation': docu
-00017370: 6d65 6e74 732e 5472 6967 6765 724f 7065  ments.TriggerOpe
-00017380: 7261 7469 6f6e 2e41 6c6c 0a20 2020 2020  ration.All.     
-00017390: 2020 2020 2020 207d 5d0a 2020 2020 2020         }].      
-000173a0: 2020 7472 6967 6765 7273 5f69 6e5f 636f    triggers_in_co
-000173b0: 6c6c 6563 7469 6f6e 3320 3d20 5b0a 2020  llection3 = [.  
-000173c0: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
-000173d0: 2020 2020 2020 2020 2020 2020 2769 6427              'id'
-000173e0: 3a20 2774 7269 6767 6572 4f70 5479 7065  : 'triggerOpType
-000173f0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00017400: 2020 2027 626f 6479 273a 2027 6675 6e63     'body': 'func
-00017410: 7469 6f6e 2829 207b 207d 272c 0a20 2020  tion() { }',.   
-00017420: 2020 2020 2020 2020 2020 2020 2027 7472               'tr
-00017430: 6967 6765 7254 7970 6527 3a20 646f 6375  iggerType': docu
-00017440: 6d65 6e74 732e 5472 6967 6765 7254 7970  ments.TriggerTyp
-00017450: 652e 506f 7374 2c0a 2020 2020 2020 2020  e.Post,.        
-00017460: 2020 2020 2020 2020 2774 7269 6767 6572          'trigger
-00017470: 4f70 6572 6174 696f 6e27 3a20 646f 6375  Operation': docu
-00017480: 6d65 6e74 732e 5472 6967 6765 724f 7065  ments.TriggerOpe
-00017490: 7261 7469 6f6e 2e44 656c 6574 652c 0a20  ration.Delete,. 
-000174a0: 2020 2020 2020 2020 2020 207d 5d0a 0a20             }].. 
-000174b0: 2020 2020 2020 2061 7379 6e63 2064 6566         async def
-000174c0: 205f 5f43 7265 6174 6554 7269 6767 6572   __CreateTrigger
-000174d0: 7328 636f 6c6c 6563 7469 6f6e 2c20 7472  s(collection, tr
-000174e0: 6967 6765 7273 293a 0a20 2020 2020 2020  iggers):.       
-000174f0: 2020 2020 2022 2222 4372 6561 7465 7320       """Creates 
-00017500: 7472 6967 6765 7273 2e0a 0a20 2020 2020  triggers...     
-00017510: 2020 2020 2020 203a 5061 7261 6d65 7465         :Paramete
-00017520: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-00017530: 2020 2020 2d20 6063 6c69 656e 7460 3a20      - `client`: 
-00017540: 636f 736d 6f73 5f63 6c69 656e 745f 636f  cosmos_client_co
-00017550: 6e6e 6563 7469 6f6e 2e43 6f73 6d6f 7343  nnection.CosmosC
-00017560: 6c69 656e 7443 6f6e 6e65 6374 696f 6e0a  lientConnection.
-00017570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017580: 2d20 6063 6f6c 6c65 6374 696f 6e60 3a20  - `collection`: 
-00017590: 6469 6374 0a0a 2020 2020 2020 2020 2020  dict..          
-000175a0: 2020 2222 220a 2020 2020 2020 2020 2020    """.          
-000175b0: 2020 6173 796e 6320 666f 7220 7472 6967    async for trig
-000175c0: 6765 725f 6920 696e 2074 7269 6767 6572  ger_i in trigger
-000175d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000175e0: 2020 2074 7269 6767 6572 203d 2061 7761     trigger = awa
-000175f0: 6974 2063 6f6c 6c65 6374 696f 6e2e 7363  it collection.sc
-00017600: 7269 7074 732e 6372 6561 7465 5f74 7269  ripts.create_tri
-00017610: 6767 6572 2862 6f64 793d 7472 6967 6765  gger(body=trigge
-00017620: 725f 6929 0a20 2020 2020 2020 2020 2020  r_i).           
-00017630: 2020 2020 2061 7379 6e63 2066 6f72 2070       async for p
-00017640: 726f 7065 7274 7920 696e 2074 7269 6767  roperty in trigg
-00017650: 6572 5f69 3a0a 2020 2020 2020 2020 2020  er_i:.          
-00017660: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00017670: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00017680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017690: 2020 2020 7472 6967 6765 725b 7072 6f70      trigger[prop
-000176a0: 6572 7479 5d2c 0a20 2020 2020 2020 2020  erty],.         
-000176b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000176c0: 7269 6767 6572 5f69 5b70 726f 7065 7274  rigger_i[propert
-000176d0: 795d 2c0a 2020 2020 2020 2020 2020 2020  y],.            
-000176e0: 2020 2020 2020 2020 2020 2020 2770 726f              'pro
-000176f0: 7065 7274 7920 7b70 726f 7065 7274 797d  perty {property}
-00017700: 2073 686f 756c 6420 6d61 7463 6827 2e66   should match'.f
-00017710: 6f72 6d61 7428 7072 6f70 6572 7479 3d70  ormat(property=p
-00017720: 726f 7065 7274 7929 290a 0a20 2020 2020  roperty))..     
-00017730: 2020 2023 2063 7265 6174 6520 6461 7461     # create data
-00017740: 6261 7365 0a20 2020 2020 2020 2064 6220  base.        db 
-00017750: 3d20 7365 6c66 2e64 6174 6162 6173 6546  = self.databaseF
-00017760: 6f72 5465 7374 0a20 2020 2020 2020 2023  orTest.        #
-00017770: 2063 7265 6174 6520 636f 6c6c 6563 7469   create collecti
-00017780: 6f6e 730a 2020 2020 2020 2020 706b 6420  ons.        pkd 
-00017790: 3d20 5061 7274 6974 696f 6e4b 6579 2870  = PartitionKey(p
-000177a0: 6174 683d 272f 6964 272c 206b 696e 643d  ath='/id', kind=
-000177b0: 2748 6173 6827 290a 2020 2020 2020 2020  'Hash').        
-000177c0: 636f 6c6c 6563 7469 6f6e 3120 3d20 6177  collection1 = aw
-000177d0: 6169 7420 6462 2e63 7265 6174 655f 636f  ait db.create_co
-000177e0: 6e74 6169 6e65 7228 6964 3d27 7465 7374  ntainer(id='test
-000177f0: 5f74 7269 6767 6572 5f66 756e 6374 696f  _trigger_functio
-00017800: 6e61 6c69 7479 2031 2027 202b 2073 7472  nality 1 ' + str
-00017810: 2875 7569 642e 7575 6964 3428 2929 2c0a  (uuid.uuid4()),.
-00017820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017840: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-00017850: 696f 6e5f 6b65 793d 5061 7274 6974 696f  ion_key=Partitio
-00017860: 6e4b 6579 2870 6174 683d 272f 6b65 7927  nKey(path='/key'
-00017870: 2c20 6b69 6e64 3d27 4861 7368 2729 290a  , kind='Hash')).
-00017880: 2020 2020 2020 2020 636f 6c6c 6563 7469          collecti
-00017890: 6f6e 3220 3d20 6177 6169 7420 6462 2e63  on2 = await db.c
-000178a0: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
-000178b0: 6964 3d27 7465 7374 5f74 7269 6767 6572  id='test_trigger
-000178c0: 5f66 756e 6374 696f 6e61 6c69 7479 2032  _functionality 2
-000178d0: 2027 202b 2073 7472 2875 7569 642e 7575   ' + str(uuid.uu
-000178e0: 6964 3428 2929 2c0a 2020 2020 2020 2020  id4()),.        
-000178f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d50: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+00013d60: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
+00013d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d80: 2022 7061 7468 223a 2022 2f70 6174 6835   "path": "/path5
+00013d90: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00013da0: 2020 2020 2020 2020 2020 2022 6f72 6465             "orde
+00013db0: 7222 3a20 2264 6573 6365 6e64 696e 6722  r": "descending"
+00013dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013dd0: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+00013de0: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
+00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e00: 2020 2020 2020 2270 6174 6822 3a20 222f        "path": "/
+00013e10: 7061 7468 3622 2c0a 2020 2020 2020 2020  path6",.        
+00013e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e30: 226f 7264 6572 223a 2022 6173 6365 6e64  "order": "ascend
+00013e40: 696e 6722 0a20 2020 2020 2020 2020 2020  ing".           
+00013e50: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00013e60: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
+00013e70: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+00013e80: 2020 207d 0a0a 2020 2020 2020 2020 6375     }..        cu
+00013e90: 7374 6f6d 5f6c 6f67 6765 7220 3d20 6c6f  stom_logger = lo
+00013ea0: 6767 696e 672e 6765 744c 6f67 6765 7228  gging.getLogger(
+00013eb0: 2243 7573 746f 6d4c 6f67 6765 7222 290a  "CustomLogger").
+00013ec0: 2020 2020 2020 2020 6372 6561 7465 645f          created_
+00013ed0: 636f 6e74 6169 6e65 7220 3d20 6177 6169  container = awai
+00013ee0: 7420 6462 2e63 7265 6174 655f 636f 6e74  t db.create_cont
+00013ef0: 6169 6e65 7228 0a20 2020 2020 2020 2020  ainer(.         
+00013f00: 2020 2069 643d 2763 6f6d 706f 7369 7465     id='composite
+00013f10: 5f69 6e64 6578 5f73 7061 7469 616c 5f69  _index_spatial_i
+00013f20: 6e64 6578 2720 2b20 7374 7228 7575 6964  ndex' + str(uuid
+00013f30: 2e75 7569 6434 2829 292c 0a20 2020 2020  .uuid4()),.     
+00013f40: 2020 2020 2020 2069 6e64 6578 696e 675f         indexing_
+00013f50: 706f 6c69 6379 3d69 6e64 6578 696e 675f  policy=indexing_
+00013f60: 706f 6c69 6379 2c0a 2020 2020 2020 2020  policy,.        
+00013f70: 2020 2020 7061 7274 6974 696f 6e5f 6b65      partition_ke
+00013f80: 793d 5061 7274 6974 696f 6e4b 6579 2870  y=PartitionKey(p
+00013f90: 6174 683d 272f 6964 272c 206b 696e 643d  ath='/id', kind=
+00013fa0: 2748 6173 6827 292c 0a20 2020 2020 2020  'Hash'),.       
+00013fb0: 2020 2020 2068 6561 6465 7273 3d7b 2246       headers={"F
+00013fc0: 6f6f 223a 2022 6261 7222 7d2c 0a20 2020  oo": "bar"},.   
+00013fd0: 2020 2020 2020 2020 2075 7365 725f 6167           user_ag
+00013fe0: 656e 743d 2262 6c61 6822 2c0a 2020 2020  ent="blah",.    
+00013ff0: 2020 2020 2020 2020 7573 6572 5f61 6765          user_age
+00014000: 6e74 5f6f 7665 7277 7269 7465 3d54 7275  nt_overwrite=Tru
+00014010: 652c 0a20 2020 2020 2020 2020 2020 206c  e,.            l
+00014020: 6f67 6769 6e67 5f65 6e61 626c 653d 5472  ogging_enable=Tr
+00014030: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00014040: 6c6f 6767 6572 3d63 7573 746f 6d5f 6c6f  logger=custom_lo
+00014050: 6767 6572 2c0a 2020 2020 2020 2020 290a  gger,.        ).
+00014060: 2020 2020 2020 2020 6372 6561 7465 645f          created_
+00014070: 7072 6f70 6572 7469 6573 203d 2061 7761  properties = awa
+00014080: 6974 2063 7265 6174 6564 5f63 6f6e 7461  it created_conta
+00014090: 696e 6572 2e72 6561 6428 6c6f 6767 6572  iner.read(logger
+000140a0: 3d63 7573 746f 6d5f 6c6f 6767 6572 290a  =custom_logger).
+000140b0: 2020 2020 2020 2020 7265 6164 5f69 6e64          read_ind
+000140c0: 6578 696e 675f 706f 6c69 6379 203d 2063  exing_policy = c
+000140d0: 7265 6174 6564 5f70 726f 7065 7274 6965  reated_propertie
+000140e0: 735b 2769 6e64 6578 696e 6750 6f6c 6963  s['indexingPolic
+000140f0: 7927 5d0a 0a20 2020 2020 2020 2069 6620  y']..        if 
+00014100: 276c 6f63 616c 686f 7374 2720 696e 2073  'localhost' in s
+00014110: 656c 662e 686f 7374 206f 7220 2731 3237  elf.host or '127
+00014120: 2e30 2e30 2e31 2720 696e 2073 656c 662e  .0.0.1' in self.
+00014130: 686f 7374 3a20 2023 2054 4f44 4f3a 2044  host:  # TODO: D
+00014140: 6966 6665 7269 6e67 2072 6573 756c 7420  iffering result 
+00014150: 6265 7477 6565 6e20 6c69 7665 2061 6e64  between live and
+00014160: 2065 6d75 6c61 746f 720a 2020 2020 2020   emulator.      
+00014170: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00014180: 744c 6973 7445 7175 616c 2869 6e64 6578  tListEqual(index
+00014190: 696e 675f 706f 6c69 6379 5b27 7370 6174  ing_policy['spat
+000141a0: 6961 6c49 6e64 6578 6573 275d 2c20 7265  ialIndexes'], re
+000141b0: 6164 5f69 6e64 6578 696e 675f 706f 6c69  ad_indexing_poli
+000141c0: 6379 5b27 7370 6174 6961 6c49 6e64 6578  cy['spatialIndex
+000141d0: 6573 275d 290a 2020 2020 2020 2020 656c  es']).        el
+000141e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000141f0: 2320 416c 6c20 7479 7065 7320 6172 6520  # All types are 
+00014200: 7265 7475 726e 6564 2066 6f72 2073 7061  returned for spa
+00014210: 7469 616c 2049 6e64 6578 6573 0a20 2020  tial Indexes.   
+00014220: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00014230: 7365 7274 4c69 7374 4571 7561 6c28 696e  sertListEqual(in
+00014240: 6465 7869 6e67 5f70 6f6c 6963 795b 2773  dexing_policy['s
+00014250: 7061 7469 616c 496e 6465 7865 7327 5d2c  patialIndexes'],
+00014260: 2072 6561 645f 696e 6465 7869 6e67 5f70   read_indexing_p
+00014270: 6f6c 6963 795b 2773 7061 7469 616c 496e  olicy['spatialIn
+00014280: 6465 7865 7327 5d29 0a0a 2020 2020 2020  dexes'])..      
+00014290: 2020 7365 6c66 2e61 7373 6572 744c 6973    self.assertLis
+000142a0: 7445 7175 616c 2869 6e64 6578 696e 675f  tEqual(indexing_
+000142b0: 706f 6c69 6379 5b27 636f 6d70 6f73 6974  policy['composit
+000142c0: 6549 6e64 6578 6573 275d 2c20 7265 6164  eIndexes'], read
+000142d0: 5f69 6e64 6578 696e 675f 706f 6c69 6379  _indexing_policy
+000142e0: 5b27 636f 6d70 6f73 6974 6549 6e64 6578  ['compositeIndex
+000142f0: 6573 275d 290a 2020 2020 2020 2020 6177  es']).        aw
+00014300: 6169 7420 6462 2e64 656c 6574 655f 636f  ait db.delete_co
+00014310: 6e74 6169 6e65 7228 636f 6e74 6169 6e65  ntainer(containe
+00014320: 723d 6372 6561 7465 645f 636f 6e74 6169  r=created_contai
+00014330: 6e65 7229 0a0a 2020 2020 6173 796e 6320  ner)..    async 
+00014340: 6465 6620 5f63 6865 636b 5f64 6566 6175  def _check_defau
+00014350: 6c74 5f69 6e64 6578 696e 675f 706f 6c69  lt_indexing_poli
+00014360: 6379 5f70 6174 6873 2873 656c 662c 2069  cy_paths(self, i
+00014370: 6e64 6578 696e 675f 706f 6c69 6379 293a  ndexing_policy):
+00014380: 0a20 2020 2020 2020 2064 6566 205f 5f67  .        def __g
+00014390: 6574 5f66 6972 7374 2861 7272 6179 293a  et_first(array):
+000143a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000143b0: 6172 7261 793a 0a20 2020 2020 2020 2020  array:.         
+000143c0: 2020 2020 2020 2072 6574 7572 6e20 6172         return ar
+000143d0: 7261 795b 305d 0a20 2020 2020 2020 2020  ray[0].         
+000143e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000143f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00014400: 4e6f 6e65 0a0a 2020 2020 2020 2020 2320  None..        # 
+00014410: 272f 5f65 7461 6727 2069 7320 7072 6573  '/_etag' is pres
+00014420: 656e 7420 696e 2065 7863 6c75 6465 6420  ent in excluded 
+00014430: 7061 7468 7320 6279 2064 6566 6175 6c74  paths by default
+00014440: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00014450: 7365 7274 4571 7561 6c28 312c 206c 656e  sertEqual(1, len
+00014460: 2869 6e64 6578 696e 675f 706f 6c69 6379  (indexing_policy
+00014470: 5b27 6578 636c 7564 6564 5061 7468 7327  ['excludedPaths'
+00014480: 5d29 290a 2020 2020 2020 2020 2320 696e  ])).        # in
+00014490: 636c 7564 6564 2070 6174 6873 2073 686f  cluded paths sho
+000144a0: 756c 6420 6265 2031 3a20 272f 272e 0a20  uld be 1: '/'.. 
+000144b0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000144c0: 7274 4571 7561 6c28 312c 206c 656e 2869  rtEqual(1, len(i
+000144d0: 6e64 6578 696e 675f 706f 6c69 6379 5b27  ndexing_policy['
+000144e0: 696e 636c 7564 6564 5061 7468 7327 5d29  includedPaths'])
+000144f0: 290a 0a20 2020 2020 2020 2072 6f6f 745f  )..        root_
+00014500: 696e 636c 7564 6564 5f70 6174 6820 3d20  included_path = 
+00014510: 5f5f 6765 745f 6669 7273 7428 5b69 6e63  __get_first([inc
+00014520: 6c75 6465 645f 7061 7468 2066 6f72 2069  luded_path for i
+00014530: 6e63 6c75 6465 645f 7061 7468 2069 6e20  ncluded_path in 
+00014540: 696e 6465 7869 6e67 5f70 6f6c 6963 795b  indexing_policy[
+00014550: 2769 6e63 6c75 6465 6450 6174 6873 275d  'includedPaths']
+00014560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014580: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+00014590: 636c 7564 6564 5f70 6174 685b 2770 6174  cluded_path['pat
+000145a0: 6827 5d20 3d3d 2027 2f2a 275d 290a 2020  h'] == '/*']).  
+000145b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000145c0: 7446 616c 7365 2872 6f6f 745f 696e 636c  tFalse(root_incl
+000145d0: 7564 6564 5f70 6174 682e 6765 7428 2769  uded_path.get('i
+000145e0: 6e64 6578 6573 2729 290a 0a20 2020 2061  ndexes'))..    a
+000145f0: 7379 6e63 2064 6566 2074 6573 745f 636c  sync def test_cl
+00014600: 6965 6e74 5f72 6571 7565 7374 5f74 696d  ient_request_tim
+00014610: 656f 7574 2873 656c 6629 3a0a 2020 2020  eout(self):.    
+00014620: 2020 2020 2320 5465 7374 2069 7320 666c      # Test is fl
+00014630: 616b 7920 6f6e 2045 6d75 6c61 746f 720a  aky on Emulator.
+00014640: 2020 2020 2020 2020 6966 206e 6f74 2028          if not (
+00014650: 276c 6f63 616c 686f 7374 2720 696e 2073  'localhost' in s
+00014660: 656c 662e 686f 7374 206f 7220 2731 3237  elf.host or '127
+00014670: 2e30 2e30 2e31 2720 696e 2073 656c 662e  .0.0.1' in self.
+00014680: 686f 7374 293a 0a20 2020 2020 2020 2020  host):.         
+00014690: 2020 2063 6f6e 6e65 6374 696f 6e5f 706f     connection_po
+000146a0: 6c69 6379 203d 2064 6f63 756d 656e 7473  licy = documents
+000146b0: 2e43 6f6e 6e65 6374 696f 6e50 6f6c 6963  .ConnectionPolic
+000146c0: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+000146d0: 2320 6d61 6b69 6e67 2074 696d 656f 7574  # making timeout
+000146e0: 2030 206d 7320 746f 206d 616b 6520 7375   0 ms to make su
+000146f0: 7265 2069 7420 7769 6c6c 2074 6872 6f77  re it will throw
+00014700: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00014710: 6e65 6374 696f 6e5f 706f 6c69 6379 2e52  nection_policy.R
+00014720: 6571 7565 7374 5469 6d65 6f75 7420 3d20  equestTimeout = 
+00014730: 302e 3030 3030 3030 3030 3030 3031 0a0a  0.000000000001..
+00014740: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00014750: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+00014760: 6573 2845 7863 6570 7469 6f6e 293a 0a20  es(Exception):. 
+00014770: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00014780: 2063 6c69 656e 7420 646f 6573 2061 2067   client does a g
+00014790: 6574 4461 7461 6261 7365 4163 636f 756e  etDatabaseAccoun
+000147a0: 7420 6f6e 2069 6e69 7469 616c 697a 6174  t on initializat
+000147b0: 696f 6e2c 2077 6869 6368 2077 696c 6c20  ion, which will 
+000147c0: 7469 6d65 206f 7574 0a20 2020 2020 2020  time out.       
+000147d0: 2020 2020 2020 2020 2061 7379 6e63 2077           async w
+000147e0: 6974 6820 436f 736d 6f73 436c 6965 6e74  ith CosmosClient
+000147f0: 2843 5255 4454 6573 7473 2e68 6f73 742c  (CRUDTests.host,
+00014800: 2043 5255 4454 6573 7473 2e6d 6173 7465   CRUDTests.maste
+00014810: 724b 6579 2c20 636f 6e73 6973 7465 6e63  rKey, consistenc
+00014820: 795f 6c65 7665 6c3d 2253 6573 7369 6f6e  y_level="Session
+00014830: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00014840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014850: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00014860: 6e6e 6563 7469 6f6e 5f70 6f6c 6963 793d  nnection_policy=
+00014870: 636f 6e6e 6563 7469 6f6e 5f70 6f6c 6963  connection_polic
+00014880: 7929 2061 7320 636c 6965 6e74 3a0a 2020  y) as client:.  
+00014890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148a0: 2020 7072 696e 7428 2741 7379 6e63 2069    print('Async i
+000148b0: 6e69 7469 616c 697a 6174 696f 6e27 290a  nitialization').
+000148c0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+000148d0: 6573 745f 636c 6965 6e74 5f72 6571 7565  est_client_reque
+000148e0: 7374 5f74 696d 656f 7574 5f77 6865 6e5f  st_timeout_when_
+000148f0: 636f 6e6e 6563 7469 6f6e 5f72 6574 7279  connection_retry
+00014900: 5f63 6f6e 6669 6775 7261 7469 6f6e 5f73  _configuration_s
+00014910: 7065 6369 6669 6564 2873 656c 6629 3a0a  pecified(self):.
+00014920: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
+00014930: 6f6e 5f70 6f6c 6963 7920 3d20 646f 6375  on_policy = docu
+00014940: 6d65 6e74 732e 436f 6e6e 6563 7469 6f6e  ments.Connection
+00014950: 506f 6c69 6379 2829 0a20 2020 2020 2020  Policy().       
+00014960: 2023 206d 616b 696e 6720 7469 6d65 6f75   # making timeou
+00014970: 7420 3020 6d73 2074 6f20 6d61 6b65 2073  t 0 ms to make s
+00014980: 7572 6520 6974 2077 696c 6c20 7468 726f  ure it will thro
+00014990: 770a 2020 2020 2020 2020 636f 6e6e 6563  w.        connec
+000149a0: 7469 6f6e 5f70 6f6c 6963 792e 5265 7175  tion_policy.Requ
+000149b0: 6573 7454 696d 656f 7574 203d 2030 2e30  estTimeout = 0.0
+000149c0: 3030 3030 3030 3030 3030 310a 2020 2020  00000000001.    
+000149d0: 2020 2020 636f 6e6e 6563 7469 6f6e 5f70      connection_p
+000149e0: 6f6c 6963 792e 436f 6e6e 6563 7469 6f6e  olicy.Connection
+000149f0: 5265 7472 7943 6f6e 6669 6775 7261 7469  RetryConfigurati
+00014a00: 6f6e 203d 2052 6574 7279 280a 2020 2020  on = Retry(.    
+00014a10: 2020 2020 2020 2020 746f 7461 6c3d 332c          total=3,
+00014a20: 0a20 2020 2020 2020 2020 2020 2072 6561  .            rea
+00014a30: 643d 332c 0a20 2020 2020 2020 2020 2020  d=3,.           
+00014a40: 2063 6f6e 6e65 6374 3d33 2c0a 2020 2020   connect=3,.    
+00014a50: 2020 2020 2020 2020 6261 636b 6f66 665f          backoff_
+00014a60: 6661 6374 6f72 3d30 2e33 2c0a 2020 2020  factor=0.3,.    
+00014a70: 2020 2020 2020 2020 7374 6174 7573 5f66          status_f
+00014a80: 6f72 6365 6c69 7374 3d28 3530 302c 2035  orcelist=(500, 5
+00014a90: 3032 2c20 3530 3429 0a20 2020 2020 2020  02, 504).       
+00014aa0: 2029 0a20 2020 2020 2020 2077 6974 6820   ).        with 
+00014ab0: 7365 6c66 2e61 7373 6572 7452 6169 7365  self.assertRaise
+00014ac0: 7328 417a 7572 6545 7272 6f72 293a 0a20  s(AzureError):. 
+00014ad0: 2020 2020 2020 2020 2020 2023 2063 6c69             # cli
+00014ae0: 656e 7420 646f 6573 2061 2067 6574 4461  ent does a getDa
+00014af0: 7461 6261 7365 4163 636f 756e 7420 6f6e  tabaseAccount on
+00014b00: 2069 6e69 7469 616c 697a 6174 696f 6e2c   initialization,
+00014b10: 2077 6869 6368 2077 696c 6c20 7469 6d65   which will time
+00014b20: 206f 7574 0a20 2020 2020 2020 2020 2020   out.           
+00014b30: 2061 7379 6e63 2077 6974 6820 436f 736d   async with Cosm
+00014b40: 6f73 436c 6965 6e74 2843 5255 4454 6573  osClient(CRUDTes
+00014b50: 7473 2e68 6f73 742c 2043 5255 4454 6573  ts.host, CRUDTes
+00014b60: 7473 2e6d 6173 7465 724b 6579 2c20 636f  ts.masterKey, co
+00014b70: 6e73 6973 7465 6e63 795f 6c65 7665 6c3d  nsistency_level=
+00014b80: 2253 6573 7369 6f6e 222c 0a20 2020 2020  "Session",.     
+00014b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014bb0: 2020 636f 6e6e 6563 7469 6f6e 5f70 6f6c    connection_pol
+00014bc0: 6963 793d 636f 6e6e 6563 7469 6f6e 5f70  icy=connection_p
+00014bd0: 6f6c 6963 7929 2061 7320 636c 6965 6e74  olicy) as client
+00014be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014bf0: 2020 7072 696e 7428 2741 7379 6e63 2049    print('Async I
+00014c00: 6e69 7469 616c 697a 6174 696f 6e27 290a  nitialization').
+00014c10: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+00014c20: 6573 745f 636c 6965 6e74 5f63 6f6e 6e65  est_client_conne
+00014c30: 6374 696f 6e5f 7265 7472 795f 636f 6e66  ction_retry_conf
+00014c40: 6967 7572 6174 696f 6e28 7365 6c66 293a  iguration(self):
+00014c50: 0a20 2020 2020 2020 2074 6f74 616c 5f74  .        total_t
+00014c60: 696d 655f 666f 725f 7477 6f5f 7265 7472  ime_for_two_retr
+00014c70: 6965 7320 3d20 6177 6169 7420 7365 6c66  ies = await self
+00014c80: 2e69 6e69 7469 616c 697a 655f 636c 6965  .initialize_clie
+00014c90: 6e74 5f77 6974 685f 636f 6e6e 6563 7469  nt_with_connecti
+00014ca0: 6f6e 5f75 726c 6c69 625f 7265 7472 795f  on_urllib_retry_
+00014cb0: 636f 6e66 6967 2832 290a 2020 2020 2020  config(2).      
+00014cc0: 2020 746f 7461 6c5f 7469 6d65 5f66 6f72    total_time_for
+00014cd0: 5f74 6872 6565 5f72 6574 7269 6573 203d  _three_retries =
+00014ce0: 2061 7761 6974 2073 656c 662e 696e 6974   await self.init
+00014cf0: 6961 6c69 7a65 5f63 6c69 656e 745f 7769  ialize_client_wi
+00014d00: 7468 5f63 6f6e 6e65 6374 696f 6e5f 7572  th_connection_ur
+00014d10: 6c6c 6962 5f72 6574 7279 5f63 6f6e 6669  llib_retry_confi
+00014d20: 6728 3329 0a20 2020 2020 2020 2073 656c  g(3).        sel
+00014d30: 662e 6173 7365 7274 4772 6561 7465 7228  f.assertGreater(
+00014d40: 746f 7461 6c5f 7469 6d65 5f66 6f72 5f74  total_time_for_t
+00014d50: 6872 6565 5f72 6574 7269 6573 2c20 746f  hree_retries, to
+00014d60: 7461 6c5f 7469 6d65 5f66 6f72 5f74 776f  tal_time_for_two
+00014d70: 5f72 6574 7269 6573 290a 0a20 2020 2020  _retries)..     
+00014d80: 2020 2074 6f74 616c 5f74 696d 655f 666f     total_time_fo
+00014d90: 725f 7477 6f5f 7265 7472 6965 7320 3d20  r_two_retries = 
+00014da0: 6177 6169 7420 7365 6c66 2e69 6e69 7469  await self.initi
+00014db0: 616c 697a 655f 636c 6965 6e74 5f77 6974  alize_client_wit
+00014dc0: 685f 636f 6e6e 6563 7469 6f6e 5f63 6f72  h_connection_cor
+00014dd0: 655f 7265 7472 795f 636f 6e66 6967 2832  e_retry_config(2
+00014de0: 290a 2020 2020 2020 2020 746f 7461 6c5f  ).        total_
+00014df0: 7469 6d65 5f66 6f72 5f74 6872 6565 5f72  time_for_three_r
+00014e00: 6574 7269 6573 203d 2061 7761 6974 2073  etries = await s
+00014e10: 656c 662e 696e 6974 6961 6c69 7a65 5f63  elf.initialize_c
+00014e20: 6c69 656e 745f 7769 7468 5f63 6f6e 6e65  lient_with_conne
+00014e30: 6374 696f 6e5f 636f 7265 5f72 6574 7279  ction_core_retry
+00014e40: 5f63 6f6e 6669 6728 3329 0a20 2020 2020  _config(3).     
+00014e50: 2020 2073 656c 662e 6173 7365 7274 4772     self.assertGr
+00014e60: 6561 7465 7228 746f 7461 6c5f 7469 6d65  eater(total_time
+00014e70: 5f66 6f72 5f74 6872 6565 5f72 6574 7269  _for_three_retri
+00014e80: 6573 2c20 746f 7461 6c5f 7469 6d65 5f66  es, total_time_f
+00014e90: 6f72 5f74 776f 5f72 6574 7269 6573 290a  or_two_retries).
+00014ea0: 0a20 2020 2061 7379 6e63 2064 6566 2069  .    async def i
+00014eb0: 6e69 7469 616c 697a 655f 636c 6965 6e74  nitialize_client
+00014ec0: 5f77 6974 685f 636f 6e6e 6563 7469 6f6e  _with_connection
+00014ed0: 5f75 726c 6c69 625f 7265 7472 795f 636f  _urllib_retry_co
+00014ee0: 6e66 6967 2873 656c 662c 2072 6574 7269  nfig(self, retri
+00014ef0: 6573 293a 0a20 2020 2020 2020 2072 6574  es):.        ret
+00014f00: 7279 5f70 6f6c 6963 7920 3d20 5265 7472  ry_policy = Retr
+00014f10: 7928 0a20 2020 2020 2020 2020 2020 2074  y(.            t
+00014f20: 6f74 616c 3d72 6574 7269 6573 2c0a 2020  otal=retries,.  
+00014f30: 2020 2020 2020 2020 2020 7265 6164 3d72            read=r
+00014f40: 6574 7269 6573 2c0a 2020 2020 2020 2020  etries,.        
+00014f50: 2020 2020 636f 6e6e 6563 743d 7265 7472      connect=retr
+00014f60: 6965 732c 0a20 2020 2020 2020 2020 2020  ies,.           
+00014f70: 2062 6163 6b6f 6666 5f66 6163 746f 723d   backoff_factor=
+00014f80: 302e 332c 0a20 2020 2020 2020 2020 2020  0.3,.           
+00014f90: 2073 7461 7475 735f 666f 7263 656c 6973   status_forcelis
+00014fa0: 743d 2835 3030 2c20 3530 322c 2035 3034  t=(500, 502, 504
+00014fb0: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+00014fc0: 2020 2020 7374 6172 745f 7469 6d65 203d      start_time =
+00014fd0: 2074 696d 652e 7469 6d65 2829 0a20 2020   time.time().   
+00014fe0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00014ff0: 2020 2020 2020 6173 796e 6320 7769 7468        async with
+00015000: 2043 6f73 6d6f 7343 6c69 656e 7428 0a20   CosmosClient(. 
+00015010: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00015020: 6874 7470 733a 2f2f 6c6f 6361 6c68 6f73  https://localhos
+00015030: 743a 3939 3939 222c 0a20 2020 2020 2020  t:9999",.       
+00015040: 2020 2020 2020 2020 2043 5255 4454 6573           CRUDTes
+00015050: 7473 2e6d 6173 7465 724b 6579 2c0a 2020  ts.masterKey,.  
+00015060: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00015070: 6e73 6973 7465 6e63 795f 6c65 7665 6c3d  nsistency_level=
+00015080: 2253 6573 7369 6f6e 222c 0a20 2020 2020  "Session",.     
+00015090: 2020 2020 2020 2020 2020 2063 6f6e 6e65             conne
+000150a0: 6374 696f 6e5f 7265 7472 795f 706f 6c69  ction_retry_poli
+000150b0: 6379 3d72 6574 7279 5f70 6f6c 6963 7929  cy=retry_policy)
+000150c0: 2061 7320 636c 6965 6e74 3a20 7072 696e   as client: prin
+000150d0: 7428 2741 7379 6e63 2069 6e69 7469 616c  t('Async initial
+000150e0: 697a 6174 696f 6e27 290a 2020 2020 2020  ization').      
+000150f0: 2020 2020 2020 7365 6c66 2e66 6169 6c28        self.fail(
+00015100: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00015110: 2041 7a75 7265 4572 726f 7220 6173 2065   AzureError as e
+00015120: 3a0a 2020 2020 2020 2020 2020 2020 656e  :.            en
+00015130: 645f 7469 6d65 203d 2074 696d 652e 7469  d_time = time.ti
+00015140: 6d65 2829 0a20 2020 2020 2020 2020 2020  me().           
+00015150: 2072 6574 7572 6e20 656e 645f 7469 6d65   return end_time
+00015160: 202d 2073 7461 7274 5f74 696d 650a 0a20   - start_time.. 
+00015170: 2020 2061 7379 6e63 2064 6566 2069 6e69     async def ini
+00015180: 7469 616c 697a 655f 636c 6965 6e74 5f77  tialize_client_w
+00015190: 6974 685f 636f 6e6e 6563 7469 6f6e 5f63  ith_connection_c
+000151a0: 6f72 655f 7265 7472 795f 636f 6e66 6967  ore_retry_config
+000151b0: 2873 656c 662c 2072 6574 7269 6573 293a  (self, retries):
+000151c0: 0a20 2020 2020 2020 2073 7461 7274 5f74  .        start_t
+000151d0: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
+000151e0: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+000151f0: 2020 2020 2020 2020 2020 2061 7379 6e63             async
+00015200: 2077 6974 6820 436f 736d 6f73 436c 6965   with CosmosClie
+00015210: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+00015220: 2020 2020 2268 7474 7073 3a2f 2f6c 6f63      "https://loc
+00015230: 616c 686f 7374 3a39 3939 3922 2c0a 2020  alhost:9999",.  
+00015240: 2020 2020 2020 2020 2020 2020 2020 4352                CR
+00015250: 5544 5465 7374 732e 6d61 7374 6572 4b65  UDTests.masterKe
+00015260: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+00015270: 2020 2063 6f6e 7369 7374 656e 6379 5f6c     consistency_l
+00015280: 6576 656c 3d22 5365 7373 696f 6e22 2c0a  evel="Session",.
+00015290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152a0: 7265 7472 795f 746f 7461 6c3d 7265 7472  retry_total=retr
+000152b0: 6965 732c 0a20 2020 2020 2020 2020 2020  ies,.           
+000152c0: 2020 2020 2072 6574 7279 5f72 6561 643d       retry_read=
+000152d0: 7265 7472 6965 732c 0a20 2020 2020 2020  retries,.       
+000152e0: 2020 2020 2020 2020 2072 6574 7279 5f63           retry_c
+000152f0: 6f6e 6e65 6374 3d72 6574 7269 6573 2c0a  onnect=retries,.
+00015300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015310: 7265 7472 795f 7374 6174 7573 3d72 6574  retry_status=ret
+00015320: 7269 6573 2920 6173 2063 6c69 656e 743a  ries) as client:
+00015330: 2070 7269 6e74 2827 4173 796e 6320 696e   print('Async in
+00015340: 6974 6961 6c69 7a61 7469 6f6e 2729 0a20  itialization'). 
+00015350: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00015360: 6661 696c 2829 0a20 2020 2020 2020 2065  fail().        e
+00015370: 7863 6570 7420 417a 7572 6545 7272 6f72  xcept AzureError
+00015380: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00015390: 2020 2065 6e64 5f74 696d 6520 3d20 7469     end_time = ti
+000153a0: 6d65 2e74 696d 6528 290a 2020 2020 2020  me.time().      
+000153b0: 2020 2020 2020 7265 7475 726e 2065 6e64        return end
+000153c0: 5f74 696d 6520 2d20 7374 6172 745f 7469  _time - start_ti
+000153d0: 6d65 0a0a 2020 2020 6173 796e 6320 6465  me..    async de
+000153e0: 6620 7465 7374 5f61 6273 6f6c 7574 655f  f test_absolute_
+000153f0: 636c 6965 6e74 5f74 696d 656f 7574 2873  client_timeout(s
+00015400: 656c 6629 3a0a 2020 2020 2020 2020 7769  elf):.        wi
+00015410: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+00015420: 6973 6573 2865 7863 6570 7469 6f6e 732e  ises(exceptions.
+00015430: 436f 736d 6f73 436c 6965 6e74 5469 6d65  CosmosClientTime
+00015440: 6f75 7445 7272 6f72 293a 0a20 2020 2020  outError):.     
+00015450: 2020 2020 2020 2061 7379 6e63 2077 6974         async wit
+00015460: 6820 436f 736d 6f73 436c 6965 6e74 280a  h CosmosClient(.
+00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015480: 2268 7474 7073 3a2f 2f6c 6f63 616c 686f  "https://localho
+00015490: 7374 3a39 3939 3922 2c0a 2020 2020 2020  st:9999",.      
+000154a0: 2020 2020 2020 2020 2020 4352 5544 5465            CRUDTe
+000154b0: 7374 732e 6d61 7374 6572 4b65 792c 0a20  sts.masterKey,. 
+000154c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000154d0: 6f6e 7369 7374 656e 6379 5f6c 6576 656c  onsistency_level
+000154e0: 3d22 5365 7373 696f 6e22 2c0a 2020 2020  ="Session",.    
+000154f0: 2020 2020 2020 2020 2020 2020 7265 7472              retr
+00015500: 795f 746f 7461 6c3d 332c 0a20 2020 2020  y_total=3,.     
+00015510: 2020 2020 2020 2020 2020 2074 696d 656f             timeo
+00015520: 7574 3d31 2961 7320 636c 6965 6e74 3a20  ut=1)as client: 
+00015530: 7072 696e 7428 2741 7379 6e63 2069 6e69  print('Async ini
+00015540: 7469 616c 697a 6174 696f 6e27 290a 0a20  tialization').. 
+00015550: 2020 2020 2020 2065 7272 6f72 5f72 6573         error_res
+00015560: 706f 6e73 6520 3d20 5365 7276 6963 6552  ponse = ServiceR
+00015570: 6573 706f 6e73 6545 7272 6f72 2822 5265  esponseError("Re
+00015580: 6164 2074 696d 656f 7574 2229 0a20 2020  ad timeout").   
+00015590: 2020 2020 2074 696d 656f 7574 5f74 7261       timeout_tra
+000155a0: 6e73 706f 7274 203d 2054 696d 656f 7574  nsport = Timeout
+000155b0: 5472 616e 7370 6f72 7428 6572 726f 725f  Transport(error_
+000155c0: 7265 7370 6f6e 7365 290a 2020 2020 2020  response).      
+000155d0: 2020 6173 796e 6320 7769 7468 2043 6f73    async with Cos
+000155e0: 6d6f 7343 6c69 656e 7428 0a20 2020 2020  mosClient(.     
+000155f0: 2020 2020 2020 2073 656c 662e 686f 7374         self.host
+00015600: 2c20 7365 6c66 2e6d 6173 7465 724b 6579  , self.masterKey
+00015610: 2c20 636f 6e73 6973 7465 6e63 795f 6c65  , consistency_le
+00015620: 7665 6c3d 2253 6573 7369 6f6e 222c 2074  vel="Session", t
+00015630: 7261 6e73 706f 7274 3d74 696d 656f 7574  ransport=timeout
+00015640: 5f74 7261 6e73 706f 7274 2c20 7061 7373  _transport, pass
+00015650: 7468 726f 7567 683d 5472 7565 2920 6173  through=True) as
+00015660: 2063 6c69 656e 743a 2070 7269 6e74 2827   client: print('
+00015670: 4173 796e 6320 696e 6974 6961 6c69 7a61  Async initializa
+00015680: 7469 6f6e 2729 0a0a 2020 2020 2020 2020  tion')..        
+00015690: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+000156a0: 5261 6973 6573 2865 7863 6570 7469 6f6e  Raises(exception
+000156b0: 732e 436f 736d 6f73 436c 6965 6e74 5469  s.CosmosClientTi
+000156c0: 6d65 6f75 7445 7272 6f72 293a 0a20 2020  meoutError):.   
+000156d0: 2020 2020 2020 2020 2061 7761 6974 2063           await c
+000156e0: 6c69 656e 742e 6372 6561 7465 5f64 6174  lient.create_dat
+000156f0: 6162 6173 655f 6966 5f6e 6f74 5f65 7869  abase_if_not_exi
+00015700: 7374 7328 2274 6573 7422 2c20 7469 6d65  sts("test", time
+00015710: 6f75 743d 3229 0a0a 2020 2020 2020 2020  out=2)..        
+00015720: 7374 6174 7573 5f72 6573 706f 6e73 6520  status_response 
+00015730: 3d20 3530 3020 2023 2055 7365 7273 2063  = 500  # Users c
+00015740: 6f6e 6e65 6374 696f 6e20 6c65 7665 6c20  onnection level 
+00015750: 7265 7472 790a 2020 2020 2020 2020 7469  retry.        ti
+00015760: 6d65 6f75 745f 7472 616e 7370 6f72 7420  meout_transport 
+00015770: 3d20 5469 6d65 6f75 7454 7261 6e73 706f  = TimeoutTranspo
+00015780: 7274 2873 7461 7475 735f 7265 7370 6f6e  rt(status_respon
+00015790: 7365 290a 2020 2020 2020 2020 6173 796e  se).        asyn
+000157a0: 6320 7769 7468 2043 6f73 6d6f 7343 6c69  c with CosmosCli
+000157b0: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
+000157c0: 2020 2020 2073 656c 662e 686f 7374 2c20       self.host, 
+000157d0: 7365 6c66 2e6d 6173 7465 724b 6579 2c20  self.masterKey, 
+000157e0: 636f 6e73 6973 7465 6e63 795f 6c65 7665  consistency_leve
+000157f0: 6c3d 2253 6573 7369 6f6e 222c 2074 7261  l="Session", tra
+00015800: 6e73 706f 7274 3d74 696d 656f 7574 5f74  nsport=timeout_t
+00015810: 7261 6e73 706f 7274 2c20 7061 7373 7468  ransport, passth
+00015820: 726f 7567 683d 5472 7565 2920 6173 2063  rough=True) as c
+00015830: 6c69 656e 743a 2070 7269 6e74 280a 2020  lient: print(.  
+00015840: 2020 2020 2020 2020 2020 2741 7379 6e63            'Async
+00015850: 2069 6e69 7469 616c 697a 6174 696f 6e27   initialization'
+00015860: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
+00015870: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+00015880: 2865 7863 6570 7469 6f6e 732e 436f 736d  (exceptions.Cosm
+00015890: 6f73 436c 6965 6e74 5469 6d65 6f75 7445  osClientTimeoutE
+000158a0: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+000158b0: 2020 2061 7761 6974 2063 6c69 656e 742e     await client.
+000158c0: 6372 6561 7465 5f64 6174 6162 6173 6528  create_database(
+000158d0: 2274 6573 7422 2c20 7469 6d65 6f75 743d  "test", timeout=
+000158e0: 3229 0a0a 2020 2020 2020 2020 6461 7461  2)..        data
+000158f0: 6261 7365 7320 3d20 636c 6965 6e74 2e6c  bases = client.l
+00015900: 6973 745f 6461 7461 6261 7365 7328 7469  ist_databases(ti
+00015910: 6d65 6f75 743d 3229 0a20 2020 2020 2020  meout=2).       
+00015920: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+00015930: 7452 6169 7365 7328 6578 6365 7074 696f  tRaises(exceptio
+00015940: 6e73 2e43 6f73 6d6f 7343 6c69 656e 7454  ns.CosmosClientT
+00015950: 696d 656f 7574 4572 726f 7229 3a0a 2020  imeoutError):.  
+00015960: 2020 2020 2020 2020 2020 6461 7461 6261            databa
+00015970: 7365 7320 3d20 5b64 6174 6162 6173 6520  ses = [database 
+00015980: 6173 796e 6320 666f 7220 6461 7461 6261  async for databa
+00015990: 7365 2069 6e20 6461 7461 6261 7365 735d  se in databases]
+000159a0: 0a0a 2020 2020 2020 2020 7374 6174 7573  ..        status
+000159b0: 5f72 6573 706f 6e73 6520 3d20 3432 3920  _response = 429 
+000159c0: 2023 2055 7365 7320 436f 736d 6f73 2063   # Uses Cosmos c
+000159d0: 7573 746f 6d20 7265 7472 790a 2020 2020  ustom retry.    
+000159e0: 2020 2020 7469 6d65 6f75 745f 7472 616e      timeout_tran
+000159f0: 7370 6f72 7420 3d20 5469 6d65 6f75 7454  sport = TimeoutT
+00015a00: 7261 6e73 706f 7274 2873 7461 7475 735f  ransport(status_
+00015a10: 7265 7370 6f6e 7365 290a 2020 2020 2020  response).      
+00015a20: 2020 6173 796e 6320 7769 7468 2043 6f73    async with Cos
+00015a30: 6d6f 7343 6c69 656e 7428 0a20 2020 2020  mosClient(.     
+00015a40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00015a50: 686f 7374 2c20 7365 6c66 2e6d 6173 7465  host, self.maste
+00015a60: 724b 6579 2c20 636f 6e73 6973 7465 6e63  rKey, consistenc
+00015a70: 795f 6c65 7665 6c3d 2253 6573 7369 6f6e  y_level="Session
+00015a80: 222c 2074 7261 6e73 706f 7274 3d74 696d  ", transport=tim
+00015a90: 656f 7574 5f74 7261 6e73 706f 7274 2c20  eout_transport, 
+00015aa0: 7061 7373 7468 726f 7567 683d 5472 7565  passthrough=True
+00015ab0: 2920 6173 2063 6c69 656e 743a 2070 7269  ) as client: pri
+00015ac0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+00015ad0: 2741 7379 6e63 2069 6e69 7469 616c 697a  'Async initializ
+00015ae0: 6174 696f 6e27 290a 2020 2020 2020 2020  ation').        
+00015af0: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+00015b00: 5261 6973 6573 2865 7863 6570 7469 6f6e  Raises(exception
+00015b10: 732e 436f 736d 6f73 436c 6965 6e74 5469  s.CosmosClientTi
+00015b20: 6d65 6f75 7445 7272 6f72 293a 0a20 2020  meoutError):.   
+00015b30: 2020 2020 2020 2020 2061 7761 6974 2063           await c
+00015b40: 6c69 656e 742e 6372 6561 7465 5f64 6174  lient.create_dat
+00015b50: 6162 6173 655f 6966 5f6e 6f74 5f65 7869  abase_if_not_exi
+00015b60: 7374 7328 2274 6573 7422 2c20 7469 6d65  sts("test", time
+00015b70: 6f75 743d 3229 0a0a 2020 2020 2020 2020  out=2)..        
+00015b80: 6461 7461 6261 7365 7320 3d20 636c 6965  databases = clie
+00015b90: 6e74 2e6c 6973 745f 6461 7461 6261 7365  nt.list_database
+00015ba0: 7328 7469 6d65 6f75 743d 3229 0a20 2020  s(timeout=2).   
+00015bb0: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
+00015bc0: 7373 6572 7452 6169 7365 7328 6578 6365  ssertRaises(exce
+00015bd0: 7074 696f 6e73 2e43 6f73 6d6f 7343 6c69  ptions.CosmosCli
+00015be0: 656e 7454 696d 656f 7574 4572 726f 7229  entTimeoutError)
+00015bf0: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
+00015c00: 7461 6261 7365 7320 3d20 5b64 6174 6162  tabases = [datab
+00015c10: 6173 6520 6173 796e 6320 666f 7220 6461  ase async for da
+00015c20: 7461 6261 7365 2069 6e20 6461 7461 6261  tabase in databa
+00015c30: 7365 735d 0a0a 2020 2020 6173 796e 6320  ses]..    async 
+00015c40: 6465 6620 7465 7374 5f71 7565 7279 5f69  def test_query_i
+00015c50: 7465 7261 626c 655f 6675 6e63 7469 6f6e  terable_function
+00015c60: 616c 6974 7928 7365 6c66 293a 0a20 2020  ality(self):.   
+00015c70: 2020 2020 2061 7379 6e63 2064 6566 205f       async def _
+00015c80: 5f63 7265 6174 655f 7265 736f 7572 6365  _create_resource
+00015c90: 7328 636c 6965 6e74 293a 0a20 2020 2020  s(client):.     
+00015ca0: 2020 2020 2020 2022 2222 4372 6561 7465         """Create
+00015cb0: 7320 7265 736f 7572 6365 7320 666f 7220  s resources for 
+00015cc0: 7468 6973 2074 6573 742e 0a0a 2020 2020  this test...    
+00015cd0: 2020 2020 2020 2020 3a50 6172 616d 6574          :Paramet
+00015ce0: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
+00015cf0: 2020 2020 202d 2060 636c 6965 6e74 603a       - `client`:
+00015d00: 2063 6f73 6d6f 735f 636c 6965 6e74 5f63   cosmos_client_c
+00015d10: 6f6e 6e65 6374 696f 6e2e 436f 736d 6f73  onnection.Cosmos
+00015d20: 436c 6965 6e74 436f 6e6e 6563 7469 6f6e  ClientConnection
+00015d30: 0a0a 2020 2020 2020 2020 2020 2020 3a52  ..            :R
+00015d40: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
+00015d50: 2020 2020 2020 2020 6469 6374 0a0a 2020          dict..  
+00015d60: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
+00015d70: 2020 2020 2020 2020 2020 636f 6c6c 6563            collec
+00015d80: 7469 6f6e 203d 2061 7761 6974 2073 656c  tion = await sel
+00015d90: 662e 6461 7461 6261 7365 466f 7254 6573  f.databaseForTes
+00015da0: 742e 6372 6561 7465 5f63 6f6e 7461 696e  t.create_contain
+00015db0: 6572 2874 6573 745f 636f 6e66 6967 2e5f  er(test_config._
+00015dc0: 7465 7374 5f63 6f6e 6669 672e 5445 5354  test_config.TEST
+00015dd0: 5f43 4f4c 4c45 4354 494f 4e5f 4d55 4c54  _COLLECTION_MULT
+00015de0: 495f 5041 5254 4954 494f 4e5f 5749 5448  I_PARTITION_WITH
+00015df0: 5f43 5553 544f 4d5f 504b 5f50 4152 5449  _CUSTOM_PK_PARTI
+00015e00: 5449 4f4e 5f4b 4559 2c20 5061 7274 6974  TION_KEY, Partit
+00015e10: 696f 6e4b 6579 2870 6174 683d 222f 706b  ionKey(path="/pk
+00015e20: 2229 290a 2020 2020 2020 2020 2020 2020  ")).            
+00015e30: 646f 6331 203d 2061 7761 6974 2063 6f6c  doc1 = await col
+00015e40: 6c65 6374 696f 6e2e 6372 6561 7465 5f69  lection.create_i
+00015e50: 7465 6d28 626f 6479 3d7b 2769 6427 3a20  tem(body={'id': 
+00015e60: 2764 6f63 3127 2c20 2770 726f 7031 273a  'doc1', 'prop1':
+00015e70: 2027 7661 6c75 6531 277d 290a 2020 2020   'value1'}).    
+00015e80: 2020 2020 2020 2020 646f 6332 203d 2061          doc2 = a
+00015e90: 7761 6974 2063 6f6c 6c65 6374 696f 6e2e  wait collection.
+00015ea0: 6372 6561 7465 5f69 7465 6d28 626f 6479  create_item(body
+00015eb0: 3d7b 2769 6427 3a20 2764 6f63 3227 2c20  ={'id': 'doc2', 
+00015ec0: 2770 726f 7031 273a 2027 7661 6c75 6532  'prop1': 'value2
+00015ed0: 277d 290a 2020 2020 2020 2020 2020 2020  '}).            
+00015ee0: 646f 6333 203d 2061 7761 6974 2063 6f6c  doc3 = await col
+00015ef0: 6c65 6374 696f 6e2e 6372 6561 7465 5f69  lection.create_i
+00015f00: 7465 6d28 626f 6479 3d7b 2769 6427 3a20  tem(body={'id': 
+00015f10: 2764 6f63 3327 2c20 2770 726f 7031 273a  'doc3', 'prop1':
+00015f20: 2027 7661 6c75 6533 277d 290a 2020 2020   'value3'}).    
+00015f30: 2020 2020 2020 2020 7265 736f 7572 6365          resource
+00015f40: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+00015f50: 2020 2020 2020 2763 6f6c 6c27 3a20 636f        'coll': co
+00015f60: 6c6c 6563 7469 6f6e 2c0a 2020 2020 2020  llection,.      
+00015f70: 2020 2020 2020 2020 2020 2764 6f63 3127            'doc1'
+00015f80: 3a20 646f 6331 2c0a 2020 2020 2020 2020  : doc1,.        
+00015f90: 2020 2020 2020 2020 2764 6f63 3227 3a20          'doc2': 
+00015fa0: 646f 6332 2c0a 2020 2020 2020 2020 2020  doc2,.          
+00015fb0: 2020 2020 2020 2764 6f63 3327 3a20 646f        'doc3': do
+00015fc0: 6333 0a20 2020 2020 2020 2020 2020 207d  c3.            }
+00015fd0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00015fe0: 7572 6e20 7265 736f 7572 6365 730a 0a20  urn resources.. 
+00015ff0: 2020 2020 2020 2023 2056 616c 6964 6174         # Validat
+00016000: 6520 5175 6572 7949 7465 7261 626c 6520  e QueryIterable 
+00016010: 6279 2063 6f6e 7665 7274 696e 6720 6974  by converting it
+00016020: 2074 6f20 6120 6c69 7374 2e0a 2020 2020   to a list..    
+00016030: 2020 2020 7265 736f 7572 6365 7320 3d20      resources = 
+00016040: 6177 6169 7420 5f5f 6372 6561 7465 5f72  await __create_r
+00016050: 6573 6f75 7263 6573 2873 656c 662e 636c  esources(self.cl
+00016060: 6965 6e74 290a 2020 2020 2020 2020 7265  ient).        re
+00016070: 7375 6c74 7320 3d20 7265 736f 7572 6365  sults = resource
+00016080: 735b 2763 6f6c 6c27 5d2e 7265 6164 5f61  s['coll'].read_a
+00016090: 6c6c 5f69 7465 6d73 286d 6178 5f69 7465  ll_items(max_ite
+000160a0: 6d5f 636f 756e 743d 3229 0a20 2020 2020  m_count=2).     
+000160b0: 2020 2064 6f63 7320 3d20 5b64 6f63 2061     docs = [doc a
+000160c0: 7379 6e63 2066 6f72 2064 6f63 2069 6e20  sync for doc in 
+000160d0: 7265 7375 6c74 735d 0a20 2020 2020 2020  results].       
+000160e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000160f0: 6c28 332c 0a20 2020 2020 2020 2020 2020  l(3,.           
+00016100: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+00016110: 6e28 646f 6373 292c 0a20 2020 2020 2020  n(docs),.       
+00016120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016130: 2020 2751 7565 7279 4974 6572 6162 6c65    'QueryIterable
+00016140: 2073 686f 756c 6420 7265 7475 726e 2061   should return a
+00016150: 6c6c 2064 6f63 756d 656e 7473 2720 2b0a  ll documents' +.
+00016160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016170: 2020 2020 2020 2020 2027 2075 7369 6e67           ' using
+00016180: 2063 6f6e 7469 6e75 6174 696f 6e27 290a   continuation').
+00016190: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000161a0: 6572 7445 7175 616c 2872 6573 6f75 7263  ertEqual(resourc
+000161b0: 6573 5b27 646f 6331 275d 5b27 6964 275d  es['doc1']['id']
+000161c0: 2c20 646f 6373 5b30 5d5b 2769 6427 5d29  , docs[0]['id'])
+000161d0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000161e0: 7365 7274 4571 7561 6c28 7265 736f 7572  sertEqual(resour
+000161f0: 6365 735b 2764 6f63 3227 5d5b 2769 6427  ces['doc2']['id'
+00016200: 5d2c 2064 6f63 735b 315d 5b27 6964 275d  ], docs[1]['id']
+00016210: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00016220: 7373 6572 7445 7175 616c 2872 6573 6f75  ssertEqual(resou
+00016230: 7263 6573 5b27 646f 6333 275d 5b27 6964  rces['doc3']['id
+00016240: 275d 2c20 646f 6373 5b32 5d5b 2769 6427  '], docs[2]['id'
+00016250: 5d29 0a0a 2020 2020 2020 2020 2320 5661  ])..        # Va
+00016260: 6c69 6461 7465 2051 7565 7279 4974 6572  lidate QueryIter
+00016270: 6162 6c65 2069 7465 7261 746f 7220 7769  able iterator wi
+00016280: 7468 2027 666f 7227 2e0a 2020 2020 2020  th 'for'..      
+00016290: 2020 7265 7375 6c74 7320 3d20 7265 736f    results = reso
+000162a0: 7572 6365 735b 2763 6f6c 6c27 5d2e 7265  urces['coll'].re
+000162b0: 6164 5f61 6c6c 5f69 7465 6d73 286d 6178  ad_all_items(max
+000162c0: 5f69 7465 6d5f 636f 756e 743d 3229 0a20  _item_count=2). 
+000162d0: 2020 2020 2020 2063 6f75 6e74 6572 203d         counter =
+000162e0: 2030 0a20 2020 2020 2020 2023 2074 6573   0.        # tes
+000162f0: 7420 5175 6572 7949 7465 7261 626c 6520  t QueryIterable 
+00016300: 7769 7468 2027 666f 7227 2e0a 2020 2020  with 'for'..    
+00016310: 2020 2020 6173 796e 6320 666f 7220 646f      async for do
+00016320: 6320 696e 2072 6573 756c 7473 3a0a 2020  c in results:.  
+00016330: 2020 2020 2020 2020 2020 636f 756e 7465            counte
+00016340: 7220 2b3d 2031 0a20 2020 2020 2020 2020  r += 1.         
+00016350: 2020 2069 6620 636f 756e 7465 7220 3d3d     if counter ==
+00016360: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00016370: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00016380: 7175 616c 2872 6573 6f75 7263 6573 5b27  qual(resources['
+00016390: 646f 6331 275d 5b27 6964 275d 2c0a 2020  doc1']['id'],.  
+000163a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000163c0: 6f63 5b27 6964 275d 2c0a 2020 2020 2020  oc['id'],.      
+000163d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163e0: 2020 2020 2020 2020 2020 2027 6669 7273             'firs
+000163f0: 7420 646f 6375 6d65 6e74 2073 686f 756c  t document shoul
+00016400: 6420 6265 2064 6f63 3127 290a 2020 2020  d be doc1').    
+00016410: 2020 2020 2020 2020 656c 6966 2063 6f75          elif cou
+00016420: 6e74 6572 203d 3d20 323a 0a20 2020 2020  nter == 2:.     
+00016430: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00016440: 6173 7365 7274 4571 7561 6c28 7265 736f  assertEqual(reso
+00016450: 7572 6365 735b 2764 6f63 3227 5d5b 2769  urces['doc2']['i
+00016460: 6427 5d2c 0a20 2020 2020 2020 2020 2020  d'],.           
+00016470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016480: 2020 2020 2020 646f 635b 2769 6427 5d2c        doc['id'],
+00016490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000164a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164b0: 2020 2773 6563 6f6e 6420 646f 6375 6d65    'second docume
+000164c0: 6e74 2073 686f 756c 6420 6265 2064 6f63  nt should be doc
+000164d0: 3227 290a 2020 2020 2020 2020 2020 2020  2').            
+000164e0: 656c 6966 2063 6f75 6e74 6572 203d 3d20  elif counter == 
+000164f0: 333a 0a20 2020 2020 2020 2020 2020 2020  3:.             
+00016500: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00016510: 7561 6c28 7265 736f 7572 6365 735b 2764  ual(resources['d
+00016520: 6f63 3327 5d5b 2769 6427 5d2c 0a20 2020  oc3']['id'],.   
+00016530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016540: 2020 2020 2020 2020 2020 2020 2020 646f                do
+00016550: 635b 2769 6427 5d2c 0a20 2020 2020 2020  c['id'],.       
+00016560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016570: 2020 2020 2020 2020 2020 2774 6869 7264            'third
+00016580: 2064 6f63 756d 656e 7420 7368 6f75 6c64   document should
+00016590: 2062 6520 646f 6333 2729 0a20 2020 2020   be doc3').     
+000165a0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000165b0: 7561 6c28 636f 756e 7465 722c 2033 290a  ual(counter, 3).
+000165c0: 0a20 2020 2020 2020 2023 2047 6574 2071  .        # Get q
+000165d0: 7565 7279 2072 6573 756c 7473 2070 6167  uery results pag
+000165e0: 6520 6279 2070 6167 652e 0a20 2020 2020  e by page..     
+000165f0: 2020 2072 6573 756c 7473 203d 2072 6573     results = res
+00016600: 6f75 7263 6573 5b27 636f 6c6c 275d 2e72  ources['coll'].r
+00016610: 6561 645f 616c 6c5f 6974 656d 7328 6d61  ead_all_items(ma
+00016620: 785f 6974 656d 5f63 6f75 6e74 3d32 290a  x_item_count=2).
+00016630: 0a20 2020 2020 2020 2070 6167 655f 6974  .        page_it
+00016640: 6572 203d 2072 6573 756c 7473 2e62 795f  er = results.by_
+00016650: 7061 6765 2829 0a20 2020 2020 2020 2066  page().        f
+00016660: 6972 7374 5f62 6c6f 636b 203d 205b 7061  irst_block = [pa
+00016670: 6765 2061 7379 6e63 2066 6f72 2070 6167  ge async for pag
+00016680: 6520 696e 206e 6578 7428 7061 6765 5f69  e in next(page_i
+00016690: 7465 7229 5d0a 2020 2020 2020 2020 7365  ter)].        se
+000166a0: 6c66 2e61 7373 6572 7445 7175 616c 2832  lf.assertEqual(2
+000166b0: 2c20 6c65 6e28 6669 7273 745f 626c 6f63  , len(first_bloc
+000166c0: 6b29 2c20 2746 6972 7374 2062 6c6f 636b  k), 'First block
+000166d0: 2073 686f 756c 6420 6861 7665 2032 2065   should have 2 e
+000166e0: 6e74 7269 6573 2e27 290a 2020 2020 2020  ntries.').      
+000166f0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00016700: 616c 2872 6573 6f75 7263 6573 5b27 646f  al(resources['do
+00016710: 6331 275d 5b27 6964 275d 2c20 6669 7273  c1']['id'], firs
+00016720: 745f 626c 6f63 6b5b 305d 5b27 6964 275d  t_block[0]['id']
+00016730: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00016740: 7373 6572 7445 7175 616c 2872 6573 6f75  ssertEqual(resou
+00016750: 7263 6573 5b27 646f 6332 275d 5b27 6964  rces['doc2']['id
+00016760: 275d 2c20 6669 7273 745f 626c 6f63 6b5b  '], first_block[
+00016770: 315d 5b27 6964 275d 290a 2020 2020 2020  1]['id']).      
+00016780: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00016790: 616c 2831 2c20 6c65 6e28 5b70 6167 6520  al(1, len([page 
+000167a0: 6173 796e 6320 666f 7220 7061 6765 2069  async for page i
+000167b0: 6e20 6e65 7874 2870 6167 655f 6974 6572  n next(page_iter
+000167c0: 295d 292c 2027 5365 636f 6e64 2062 6c6f  )]), 'Second blo
+000167d0: 636b 2073 686f 756c 6420 6861 7665 2031  ck should have 1
+000167e0: 2065 6e74 7279 2e27 290a 2020 2020 2020   entry.').      
+000167f0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
+00016800: 7274 5261 6973 6573 2853 746f 7049 7465  rtRaises(StopIte
+00016810: 7261 7469 6f6e 293a 0a20 2020 2020 2020  ration):.       
+00016820: 2020 2020 206e 6578 7428 7061 6765 5f69       next(page_i
+00016830: 7465 7229 0a0a 2020 2020 6173 796e 6320  ter)..    async 
+00016840: 6465 6620 7465 7374 5f74 7269 6767 6572  def test_trigger
+00016850: 5f66 756e 6374 696f 6e61 6c69 7479 2873  _functionality(s
+00016860: 656c 6629 3a0a 2020 2020 2020 2020 7472  elf):.        tr
+00016870: 6967 6765 7273 5f69 6e5f 636f 6c6c 6563  iggers_in_collec
+00016880: 7469 6f6e 3120 3d20 5b0a 2020 2020 2020  tion1 = [.      
+00016890: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
+000168a0: 2020 2020 2020 2020 2769 6427 3a20 2774          'id': 't
+000168b0: 3127 2c0a 2020 2020 2020 2020 2020 2020  1',.            
+000168c0: 2020 2020 2762 6f64 7927 3a20 280a 2020      'body': (.  
+000168d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000168e0: 2020 2020 2020 2766 756e 6374 696f 6e28        'function(
+000168f0: 2920 7b27 202b 0a20 2020 2020 2020 2020  ) {' +.         
+00016900: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00016910: 2020 2020 7661 7220 6974 656d 203d 2067      var item = g
+00016920: 6574 436f 6e74 6578 7428 292e 6765 7452  etContext().getR
+00016930: 6571 7565 7374 2829 2e67 6574 426f 6479  equest().getBody
+00016940: 2829 3b27 202b 0a20 2020 2020 2020 2020  ();' +.         
+00016950: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00016960: 2020 2020 6974 656d 2e69 6420 3d20 6974      item.id = it
+00016970: 656d 2e69 642e 746f 5570 7065 7243 6173  em.id.toUpperCas
+00016980: 6528 2920 2b20 5c27 7431 5c27 3b27 202b  e() + \'t1\';' +
+00016990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000169a0: 2020 2020 2020 2020 2027 2020 2020 6765           '    ge
+000169b0: 7443 6f6e 7465 7874 2829 2e67 6574 5265  tContext().getRe
+000169c0: 7175 6573 7428 292e 7365 7442 6f64 7928  quest().setBody(
+000169d0: 6974 656d 293b 2720 2b0a 2020 2020 2020  item);' +.      
+000169e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169f0: 2020 277d 2729 2c0a 2020 2020 2020 2020    '}'),.        
+00016a00: 2020 2020 2020 2020 2774 7269 6767 6572          'trigger
+00016a10: 5479 7065 273a 2064 6f63 756d 656e 7473  Type': documents
+00016a20: 2e54 7269 6767 6572 5479 7065 2e50 7265  .TriggerType.Pre
+00016a30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016a40: 2020 2774 7269 6767 6572 4f70 6572 6174    'triggerOperat
+00016a50: 696f 6e27 3a20 646f 6375 6d65 6e74 732e  ion': documents.
+00016a60: 5472 6967 6765 724f 7065 7261 7469 6f6e  TriggerOperation
+00016a70: 2e41 6c6c 0a20 2020 2020 2020 2020 2020  .All.           
+00016a80: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
+00016a90: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00016aa0: 2020 2769 6427 3a20 2772 6573 706f 6e73    'id': 'respons
+00016ab0: 6531 272c 0a20 2020 2020 2020 2020 2020  e1',.           
+00016ac0: 2020 2020 2027 626f 6479 273a 2028 0a20       'body': (. 
+00016ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ae0: 2020 2020 2020 2027 6675 6e63 7469 6f6e         'function
+00016af0: 2829 207b 2720 2b0a 2020 2020 2020 2020  () {' +.        
+00016b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b10: 2720 2020 2076 6172 2070 7265 626f 6479  '    var prebody
+00016b20: 203d 2067 6574 436f 6e74 6578 7428 292e   = getContext().
+00016b30: 6765 7452 6571 7565 7374 2829 2e67 6574  getRequest().get
+00016b40: 426f 6479 2829 3b27 202b 0a20 2020 2020  Body();' +.     
+00016b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b60: 2020 2027 2020 2020 6966 2028 7072 6562     '    if (preb
+00016b70: 6f64 792e 6964 2021 3d20 5c27 5445 5354  ody.id != \'TEST
+00016b80: 494e 4720 504f 5354 2054 5249 4747 4552  ING POST TRIGGER
+00016b90: 7431 5c27 2927 0a20 2020 2020 2020 2020  t1\')'.         
+00016ba0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00016bb0: 2020 2020 2020 2020 7468 726f 7720 5c27          throw \'
+00016bc0: 6964 206d 6973 6d61 7463 685c 273b 2720  id mismatch\';' 
+00016bd0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+00016be0: 2020 2020 2020 2020 2020 2720 2020 2076            '    v
+00016bf0: 6172 2070 6f73 7462 6f64 7920 3d20 6765  ar postbody = ge
+00016c00: 7443 6f6e 7465 7874 2829 2e67 6574 5265  tContext().getRe
+00016c10: 7370 6f6e 7365 2829 2e67 6574 426f 6479  sponse().getBody
+00016c20: 2829 3b27 202b 0a20 2020 2020 2020 2020  ();' +.         
+00016c30: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00016c40: 2020 2020 6966 2028 706f 7374 626f 6479      if (postbody
+00016c50: 2e69 6420 213d 205c 2754 4553 5449 4e47  .id != \'TESTING
+00016c60: 2050 4f53 5420 5452 4947 4745 5274 315c   POST TRIGGERt1\
+00016c70: 2729 270a 2020 2020 2020 2020 2020 2020  ')'.            
+00016c80: 2020 2020 2020 2020 2020 2020 2720 2020              '   
+00016c90: 2020 2020 2074 6872 6f77 205c 2769 6420       throw \'id 
+00016ca0: 6d69 736d 6174 6368 5c27 3b27 0a20 2020  mismatch\';'.   
+00016cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cc0: 2020 2020 2027 7d27 292c 0a20 2020 2020       '}'),.     
+00016cd0: 2020 2020 2020 2020 2020 2027 7472 6967             'trig
+00016ce0: 6765 7254 7970 6527 3a20 646f 6375 6d65  gerType': docume
+00016cf0: 6e74 732e 5472 6967 6765 7254 7970 652e  nts.TriggerType.
+00016d00: 506f 7374 2c0a 2020 2020 2020 2020 2020  Post,.          
+00016d10: 2020 2020 2020 2774 7269 6767 6572 4f70        'triggerOp
+00016d20: 6572 6174 696f 6e27 3a20 646f 6375 6d65  eration': docume
+00016d30: 6e74 732e 5472 6967 6765 724f 7065 7261  nts.TriggerOpera
+00016d40: 7469 6f6e 2e41 6c6c 0a20 2020 2020 2020  tion.All.       
+00016d50: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+00016d60: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
+00016d70: 2020 2020 2020 2769 6427 3a20 2772 6573        'id': 'res
+00016d80: 706f 6e73 6532 272c 0a20 2020 2020 2020  ponse2',.       
+00016d90: 2020 2020 2020 2020 2023 2063 616e 2774           # can't
+00016da0: 2062 6520 7573 6564 2062 6563 6175 7365   be used because
+00016db0: 2073 6574 5661 6c75 6520 6973 2063 7572   setValue is cur
+00016dc0: 7265 6e74 6c79 2064 6973 6162 6c65 640a  rently disabled.
+00016dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016de0: 2762 6f64 7927 3a20 280a 2020 2020 2020  'body': (.      
+00016df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e00: 2020 2766 756e 6374 696f 6e28 2920 7b27    'function() {'
+00016e10: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+00016e20: 2020 2020 2020 2020 2020 2027 2020 2020             '    
+00016e30: 7661 7220 7072 6564 6f63 203d 2067 6574  var predoc = get
+00016e40: 436f 6e74 6578 7428 292e 6765 7452 6571  Context().getReq
+00016e50: 7565 7374 2829 2e67 6574 426f 6479 2829  uest().getBody()
+00016e60: 3b27 202b 0a20 2020 2020 2020 2020 2020  ;' +.           
+00016e70: 2020 2020 2020 2020 2020 2020 2027 2020               '  
+00016e80: 2020 7661 7220 706f 7374 646f 6320 3d20    var postdoc = 
+00016e90: 6765 7443 6f6e 7465 7874 2829 2e67 6574  getContext().get
+00016ea0: 5265 7370 6f6e 7365 2829 2e67 6574 426f  Response().getBo
+00016eb0: 6479 2829 3b27 202b 0a20 2020 2020 2020  dy();' +.       
+00016ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ed0: 2027 2020 2020 6765 7443 6f6e 7465 7874   '    getContext
+00016ee0: 2829 2e67 6574 5265 7370 6f6e 7365 2829  ().getResponse()
+00016ef0: 2e73 6574 5661 6c75 6528 2720 2b0a 2020  .setValue(' +.  
+00016f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f10: 2020 2020 2020 2720 2020 2020 2020 205c        '        \
+00016f20: 2770 7265 646f 636e 616d 655c 272c 2070  'predocname\', p
+00016f30: 7265 646f 632e 6964 202b 205c 2772 6573  redoc.id + \'res
+00016f40: 706f 6e73 6532 5c27 293b 2720 2b0a 2020  ponse2\');' +.  
+00016f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f60: 2020 2020 2020 2720 2020 2067 6574 436f        '    getCo
+00016f70: 6e74 6578 7428 292e 6765 7452 6573 706f  ntext().getRespo
+00016f80: 6e73 6528 292e 7365 7456 616c 7565 2827  nse().setValue('
+00016f90: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+00016fa0: 2020 2020 2020 2020 2020 2027 2020 2020             '    
+00016fb0: 2020 2020 5c27 706f 7374 646f 636e 616d      \'postdocnam
+00016fc0: 655c 272c 2070 6f73 7464 6f63 2e69 6420  e\', postdoc.id 
+00016fd0: 2b20 5c27 7265 7370 6f6e 7365 325c 2729  + \'response2\')
+00016fe0: 3b27 202b 0a20 2020 2020 2020 2020 2020  ;' +.           
+00016ff0: 2020 2020 2020 2020 2020 2020 2027 7d27               '}'
+00017000: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00017010: 2020 2027 7472 6967 6765 7254 7970 6527     'triggerType'
+00017020: 3a20 646f 6375 6d65 6e74 732e 5472 6967  : documents.Trig
+00017030: 6765 7254 7970 652e 506f 7374 2c0a 2020  gerType.Post,.  
+00017040: 2020 2020 2020 2020 2020 2020 2020 2774                't
+00017050: 7269 6767 6572 4f70 6572 6174 696f 6e27  riggerOperation'
+00017060: 3a20 646f 6375 6d65 6e74 732e 5472 6967  : documents.Trig
+00017070: 6765 724f 7065 7261 7469 6f6e 2e41 6c6c  gerOperation.All
+00017080: 2c0a 2020 2020 2020 2020 2020 2020 7d5d  ,.            }]
+00017090: 0a20 2020 2020 2020 2074 7269 6767 6572  .        trigger
+000170a0: 735f 696e 5f63 6f6c 6c65 6374 696f 6e32  s_in_collection2
+000170b0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+000170c0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+000170d0: 2020 2027 6964 273a 2022 7432 222c 0a20     'id': "t2",. 
+000170e0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000170f0: 626f 6479 273a 2022 6675 6e63 7469 6f6e  body': "function
+00017100: 2829 207b 207d 222c 2020 2320 7472 6967  () { }",  # trig
+00017110: 6765 7220 616c 7265 6164 7920 7374 7269  ger already stri
+00017120: 6e67 6966 6965 640a 2020 2020 2020 2020  ngified.        
+00017130: 2020 2020 2020 2020 2774 7269 6767 6572          'trigger
+00017140: 5479 7065 273a 2064 6f63 756d 656e 7473  Type': documents
+00017150: 2e54 7269 6767 6572 5479 7065 2e50 7265  .TriggerType.Pre
+00017160: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017170: 2020 2774 7269 6767 6572 4f70 6572 6174    'triggerOperat
+00017180: 696f 6e27 3a20 646f 6375 6d65 6e74 732e  ion': documents.
+00017190: 5472 6967 6765 724f 7065 7261 7469 6f6e  TriggerOperation
+000171a0: 2e41 6c6c 0a20 2020 2020 2020 2020 2020  .All.           
+000171b0: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
+000171c0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+000171d0: 2020 2769 6427 3a20 2274 3322 2c0a 2020    'id': "t3",.  
+000171e0: 2020 2020 2020 2020 2020 2020 2020 2762                'b
+000171f0: 6f64 7927 3a20 280a 2020 2020 2020 2020  ody': (.        
+00017200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017210: 2766 756e 6374 696f 6e28 2920 7b27 202b  'function() {' +
+00017220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017230: 2020 2020 2020 2020 2027 2020 2020 7661           '    va
+00017240: 7220 6974 656d 203d 2067 6574 436f 6e74  r item = getCont
+00017250: 6578 7428 292e 6765 7452 6571 7565 7374  ext().getRequest
+00017260: 2829 2e67 6574 426f 6479 2829 3b27 202b  ().getBody();' +
+00017270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017280: 2020 2020 2020 2020 2027 2020 2020 6974           '    it
+00017290: 656d 2e69 6420 3d20 6974 656d 2e69 642e  em.id = item.id.
+000172a0: 746f 4c6f 7765 7243 6173 6528 2920 2b20  toLowerCase() + 
+000172b0: 5c27 7433 5c27 3b27 202b 0a20 2020 2020  \'t3\';' +.     
+000172c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172d0: 2020 2027 2020 2020 6765 7443 6f6e 7465     '    getConte
+000172e0: 7874 2829 2e67 6574 5265 7175 6573 7428  xt().getRequest(
+000172f0: 292e 7365 7442 6f64 7928 6974 656d 293b  ).setBody(item);
+00017300: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
+00017310: 2020 2020 2020 2020 2020 2020 277d 2729              '}')
+00017320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017330: 2020 2774 7269 6767 6572 5479 7065 273a    'triggerType':
+00017340: 2064 6f63 756d 656e 7473 2e54 7269 6767   documents.Trigg
+00017350: 6572 5479 7065 2e50 7265 2c0a 2020 2020  erType.Pre,.    
+00017360: 2020 2020 2020 2020 2020 2020 2774 7269              'tri
+00017370: 6767 6572 4f70 6572 6174 696f 6e27 3a20  ggerOperation': 
+00017380: 646f 6375 6d65 6e74 732e 5472 6967 6765  documents.Trigge
+00017390: 724f 7065 7261 7469 6f6e 2e41 6c6c 0a20  rOperation.All. 
+000173a0: 2020 2020 2020 2020 2020 207d 5d0a 2020             }].  
+000173b0: 2020 2020 2020 7472 6967 6765 7273 5f69        triggers_i
+000173c0: 6e5f 636f 6c6c 6563 7469 6f6e 3320 3d20  n_collection3 = 
+000173d0: 5b0a 2020 2020 2020 2020 2020 2020 7b0a  [.            {.
+000173e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173f0: 2769 6427 3a20 2774 7269 6767 6572 4f70  'id': 'triggerOp
+00017400: 5479 7065 272c 0a20 2020 2020 2020 2020  Type',.         
+00017410: 2020 2020 2020 2027 626f 6479 273a 2027         'body': '
+00017420: 6675 6e63 7469 6f6e 2829 207b 207d 272c  function() { }',
+00017430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017440: 2027 7472 6967 6765 7254 7970 6527 3a20   'triggerType': 
+00017450: 646f 6375 6d65 6e74 732e 5472 6967 6765  documents.Trigge
+00017460: 7254 7970 652e 506f 7374 2c0a 2020 2020  rType.Post,.    
+00017470: 2020 2020 2020 2020 2020 2020 2774 7269              'tri
+00017480: 6767 6572 4f70 6572 6174 696f 6e27 3a20  ggerOperation': 
+00017490: 646f 6375 6d65 6e74 732e 5472 6967 6765  documents.Trigge
+000174a0: 724f 7065 7261 7469 6f6e 2e44 656c 6574  rOperation.Delet
+000174b0: 652c 0a20 2020 2020 2020 2020 2020 207d  e,.            }
+000174c0: 5d0a 0a20 2020 2020 2020 2061 7379 6e63  ]..        async
+000174d0: 2064 6566 205f 5f43 7265 6174 6554 7269   def __CreateTri
+000174e0: 6767 6572 7328 636f 6c6c 6563 7469 6f6e  ggers(collection
+000174f0: 2c20 7472 6967 6765 7273 293a 0a20 2020  , triggers):.   
+00017500: 2020 2020 2020 2020 2022 2222 4372 6561           """Crea
+00017510: 7465 7320 7472 6967 6765 7273 2e0a 0a20  tes triggers... 
+00017520: 2020 2020 2020 2020 2020 203a 5061 7261             :Para
+00017530: 6d65 7465 7273 3a0a 2020 2020 2020 2020  meters:.        
+00017540: 2020 2020 2020 2020 2d20 6063 6c69 656e          - `clien
+00017550: 7460 3a20 636f 736d 6f73 5f63 6c69 656e  t`: cosmos_clien
+00017560: 745f 636f 6e6e 6563 7469 6f6e 2e43 6f73  t_connection.Cos
+00017570: 6d6f 7343 6c69 656e 7443 6f6e 6e65 6374  mosClientConnect
+00017580: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00017590: 2020 2020 2d20 6063 6f6c 6c65 6374 696f      - `collectio
+000175a0: 6e60 3a20 6469 6374 0a0a 2020 2020 2020  n`: dict..      
+000175b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000175c0: 2020 2020 2020 6173 796e 6320 666f 7220        async for 
+000175d0: 7472 6967 6765 725f 6920 696e 2074 7269  trigger_i in tri
+000175e0: 6767 6572 733a 0a20 2020 2020 2020 2020  ggers:.         
+000175f0: 2020 2020 2020 2074 7269 6767 6572 203d         trigger =
+00017600: 2061 7761 6974 2063 6f6c 6c65 6374 696f   await collectio
+00017610: 6e2e 7363 7269 7074 732e 6372 6561 7465  n.scripts.create
+00017620: 5f74 7269 6767 6572 2862 6f64 793d 7472  _trigger(body=tr
+00017630: 6967 6765 725f 6929 0a20 2020 2020 2020  igger_i).       
+00017640: 2020 2020 2020 2020 2061 7379 6e63 2066           async f
+00017650: 6f72 2070 726f 7065 7274 7920 696e 2074  or property in t
+00017660: 7269 6767 6572 5f69 3a0a 2020 2020 2020  rigger_i:.      
+00017670: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00017680: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
+00017690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176a0: 2020 2020 2020 2020 7472 6967 6765 725b          trigger[
+000176b0: 7072 6f70 6572 7479 5d2c 0a20 2020 2020  property],.     
+000176c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176d0: 2020 2074 7269 6767 6572 5f69 5b70 726f     trigger_i[pro
+000176e0: 7065 7274 795d 2c0a 2020 2020 2020 2020  perty],.        
+000176f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017700: 2770 726f 7065 7274 7920 7b70 726f 7065  'property {prope
+00017710: 7274 797d 2073 686f 756c 6420 6d61 7463  rty} should matc
+00017720: 6827 2e66 6f72 6d61 7428 7072 6f70 6572  h'.format(proper
+00017730: 7479 3d70 726f 7065 7274 7929 290a 0a20  ty=property)).. 
+00017740: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+00017750: 6461 7461 6261 7365 0a20 2020 2020 2020  database.       
+00017760: 2064 6220 3d20 7365 6c66 2e64 6174 6162   db = self.datab
+00017770: 6173 6546 6f72 5465 7374 0a20 2020 2020  aseForTest.     
+00017780: 2020 2023 2063 7265 6174 6520 636f 6c6c     # create coll
+00017790: 6563 7469 6f6e 730a 2020 2020 2020 2020  ections.        
+000177a0: 706b 6420 3d20 5061 7274 6974 696f 6e4b  pkd = PartitionK
+000177b0: 6579 2870 6174 683d 272f 6964 272c 206b  ey(path='/id', k
+000177c0: 696e 643d 2748 6173 6827 290a 2020 2020  ind='Hash').    
+000177d0: 2020 2020 636f 6c6c 6563 7469 6f6e 3120      collection1 
+000177e0: 3d20 6177 6169 7420 6462 2e63 7265 6174  = await db.creat
+000177f0: 655f 636f 6e74 6169 6e65 7228 6964 3d27  e_container(id='
+00017800: 7465 7374 5f74 7269 6767 6572 5f66 756e  test_trigger_fun
+00017810: 6374 696f 6e61 6c69 7479 2031 2027 202b  ctionality 1 ' +
+00017820: 2073 7472 2875 7569 642e 7575 6964 3428   str(uuid.uuid4(
+00017830: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00017840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017850: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00017860: 7274 6974 696f 6e5f 6b65 793d 5061 7274  rtition_key=Part
+00017870: 6974 696f 6e4b 6579 2870 6174 683d 272f  itionKey(path='/
+00017880: 6b65 7927 2c20 6b69 6e64 3d27 4861 7368  key', kind='Hash
+00017890: 2729 290a 2020 2020 2020 2020 636f 6c6c  ')).        coll
+000178a0: 6563 7469 6f6e 3220 3d20 6177 6169 7420  ection2 = await 
+000178b0: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
+000178c0: 6e65 7228 6964 3d27 7465 7374 5f74 7269  ner(id='test_tri
+000178d0: 6767 6572 5f66 756e 6374 696f 6e61 6c69  gger_functionali
+000178e0: 7479 2032 2027 202b 2073 7472 2875 7569  ty 2 ' + str(uui
+000178f0: 642e 7575 6964 3428 2929 2c0a 2020 2020  d.uuid4()),.    
 00017900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017910: 2020 7061 7274 6974 696f 6e5f 6b65 793d    partition_key=
-00017920: 5061 7274 6974 696f 6e4b 6579 2870 6174  PartitionKey(pat
-00017930: 683d 272f 6b65 7927 2c20 6b69 6e64 3d27  h='/key', kind='
-00017940: 4861 7368 2729 290a 2020 2020 2020 2020  Hash')).        
-00017950: 636f 6c6c 6563 7469 6f6e 3320 3d20 6177  collection3 = aw
-00017960: 6169 7420 6462 2e63 7265 6174 655f 636f  ait db.create_co
-00017970: 6e74 6169 6e65 7228 6964 3d27 7465 7374  ntainer(id='test
-00017980: 5f74 7269 6767 6572 5f66 756e 6374 696f  _trigger_functio
-00017990: 6e61 6c69 7479 2033 2027 202b 2073 7472  nality 3 ' + str
-000179a0: 2875 7569 642e 7575 6964 3428 2929 2c0a  (uuid.uuid4()),.
-000179b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179d0: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-000179e0: 696f 6e5f 6b65 793d 5061 7274 6974 696f  ion_key=Partitio
-000179f0: 6e4b 6579 2870 6174 683d 272f 6b65 7927  nKey(path='/key'
-00017a00: 2c20 6b69 6e64 3d27 4861 7368 2729 290a  , kind='Hash')).
-00017a10: 2020 2020 2020 2020 2320 6372 6561 7465          # create
-00017a20: 2074 7269 6767 6572 730a 2020 2020 2020   triggers.      
-00017a30: 2020 6177 6169 7420 5f5f 4372 6561 7465    await __Create
-00017a40: 5472 6967 6765 7273 2863 6f6c 6c65 6374  Triggers(collect
-00017a50: 696f 6e31 2c20 7472 6967 6765 7273 5f69  ion1, triggers_i
-00017a60: 6e5f 636f 6c6c 6563 7469 6f6e 3129 0a20  n_collection1). 
-00017a70: 2020 2020 2020 2061 7761 6974 205f 5f43         await __C
-00017a80: 7265 6174 6554 7269 6767 6572 7328 636f  reateTriggers(co
-00017a90: 6c6c 6563 7469 6f6e 322c 2074 7269 6767  llection2, trigg
-00017aa0: 6572 735f 696e 5f63 6f6c 6c65 6374 696f  ers_in_collectio
-00017ab0: 6e32 290a 2020 2020 2020 2020 6177 6169  n2).        awai
-00017ac0: 7420 5f5f 4372 6561 7465 5472 6967 6765  t __CreateTrigge
-00017ad0: 7273 2863 6f6c 6c65 6374 696f 6e33 2c20  rs(collection3, 
-00017ae0: 7472 6967 6765 7273 5f69 6e5f 636f 6c6c  triggers_in_coll
-00017af0: 6563 7469 6f6e 3329 0a20 2020 2020 2020  ection3).       
-00017b00: 2023 2063 7265 6174 6520 646f 6375 6d65   # create docume
-00017b10: 6e74 0a20 2020 2020 2020 2074 7269 6767  nt.        trigg
-00017b20: 6572 735f 3120 3d20 5b74 7269 6767 6572  ers_1 = [trigger
-00017b30: 2061 7379 6e63 2066 6f72 2074 7269 6767   async for trigg
-00017b40: 6572 2069 6e20 636f 6c6c 6563 7469 6f6e  er in collection
-00017b50: 312e 7363 7269 7074 732e 6c69 7374 5f74  1.scripts.list_t
-00017b60: 7269 6767 6572 7328 295d 0a20 2020 2020  riggers()].     
-00017b70: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00017b80: 7561 6c28 6c65 6e28 7472 6967 6765 7273  ual(len(triggers
-00017b90: 5f31 292c 2033 290a 2020 2020 2020 2020  _1), 3).        
-00017ba0: 646f 6375 6d65 6e74 5f31 5f31 203d 2063  document_1_1 = c
-00017bb0: 6f6c 6c65 6374 696f 6e31 2e63 7265 6174  ollection1.creat
-00017bc0: 655f 6974 656d 280a 2020 2020 2020 2020  e_item(.        
-00017bd0: 2020 2020 626f 6479 3d7b 2769 6427 3a20      body={'id': 
-00017be0: 2764 6f63 3127 2c0a 2020 2020 2020 2020  'doc1',.        
-00017bf0: 2020 2020 2020 2020 2020 276b 6579 273a            'key':
-00017c00: 2027 7661 6c75 6527 7d2c 0a20 2020 2020   'value'},.     
-00017c10: 2020 2020 2020 2070 7265 5f74 7269 6767         pre_trigg
-00017c20: 6572 5f69 6e63 6c75 6465 3d27 7431 270a  er_include='t1'.
-00017c30: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00017c40: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00017c50: 616c 2864 6f63 756d 656e 745f 315f 315b  al(document_1_1[
-00017c60: 2769 6427 5d2c 0a20 2020 2020 2020 2020  'id'],.         
-00017c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c80: 2744 4f43 3174 3127 2c0a 2020 2020 2020  'DOC1t1',.      
-00017c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ca0: 2020 2027 6964 2073 686f 756c 6420 6265     'id should be
-00017cb0: 2063 6170 6974 616c 697a 6564 2729 0a0a   capitalized')..
-00017cc0: 2020 2020 2020 2020 646f 6375 6d65 6e74          document
-00017cd0: 5f31 5f32 203d 2061 7761 6974 2063 6f6c  _1_2 = await col
-00017ce0: 6c65 6374 696f 6e31 2e63 7265 6174 655f  lection1.create_
-00017cf0: 6974 656d 280a 2020 2020 2020 2020 2020  item(.          
-00017d00: 2020 626f 6479 3d7b 2769 6427 3a20 2774    body={'id': 't
-00017d10: 6573 7469 6e67 2070 6f73 7420 7472 6967  esting post trig
-00017d20: 6765 7227 2c20 276b 6579 273a 2027 7661  ger', 'key': 'va
-00017d30: 6c75 6527 7d2c 0a20 2020 2020 2020 2020  lue'},.         
-00017d40: 2020 2070 7265 5f74 7269 6767 6572 5f69     pre_trigger_i
-00017d50: 6e63 6c75 6465 3d27 7431 272c 0a20 2020  nclude='t1',.   
-00017d60: 2020 2020 2020 2020 2070 6f73 745f 7472           post_tr
-00017d70: 6967 6765 725f 696e 636c 7564 653d 2772  igger_include='r
-00017d80: 6573 706f 6e73 6531 272c 0a20 2020 2020  esponse1',.     
-00017d90: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
-00017da0: 662e 6173 7365 7274 4571 7561 6c28 646f  f.assertEqual(do
-00017db0: 6375 6d65 6e74 5f31 5f32 5b27 6964 275d  cument_1_2['id']
-00017dc0: 2c20 2754 4553 5449 4e47 2050 4f53 5420  , 'TESTING POST 
-00017dd0: 5452 4947 4745 5274 3127 290a 0a20 2020  TRIGGERt1')..   
-00017de0: 2020 2020 2064 6f63 756d 656e 745f 315f       document_1_
-00017df0: 3320 3d20 6177 6169 7420 636f 6c6c 6563  3 = await collec
-00017e00: 7469 6f6e 312e 6372 6561 7465 5f69 7465  tion1.create_ite
-00017e10: 6d28 0a20 2020 2020 2020 2020 2020 2062  m(.            b
-00017e20: 6f64 793d 7b27 6964 273a 2027 7265 7370  ody={'id': 'resp
-00017e30: 6f6e 7365 6865 6164 6572 7327 2c20 276b  onseheaders', 'k
-00017e40: 6579 273a 2027 7661 6c75 6527 7d2c 0a20  ey': 'value'},. 
-00017e50: 2020 2020 2020 2020 2020 2070 7265 5f74             pre_t
-00017e60: 7269 6767 6572 5f69 6e63 6c75 6465 3d27  rigger_include='
-00017e70: 7431 270a 2020 2020 2020 2020 290a 2020  t1'.        ).  
-00017e80: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00017e90: 7445 7175 616c 2864 6f63 756d 656e 745f  tEqual(document_
-00017ea0: 315f 335b 2769 6427 5d2c 2022 5245 5350  1_3['id'], "RESP
-00017eb0: 4f4e 5345 4845 4144 4552 5374 3122 290a  ONSEHEADERSt1").
-00017ec0: 0a20 2020 2020 2020 2074 7269 6767 6572  .        trigger
-00017ed0: 735f 3220 3d20 5b74 7269 6767 6572 2061  s_2 = [trigger a
-00017ee0: 7379 6e63 2066 6f72 2074 7269 6767 6572  sync for trigger
-00017ef0: 2069 6e20 636f 6c6c 6563 7469 6f6e 322e   in collection2.
-00017f00: 7363 7269 7074 732e 6c69 7374 5f74 7269  scripts.list_tri
-00017f10: 6767 6572 7328 295d 0a20 2020 2020 2020  ggers()].       
-00017f20: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00017f30: 6c28 6c65 6e28 7472 6967 6765 7273 5f32  l(len(triggers_2
-00017f40: 292c 2032 290a 2020 2020 2020 2020 646f  ), 2).        do
-00017f50: 6375 6d65 6e74 5f32 5f31 203d 2061 7761  cument_2_1 = awa
-00017f60: 6974 2063 6f6c 6c65 6374 696f 6e32 2e63  it collection2.c
-00017f70: 7265 6174 655f 6974 656d 280a 2020 2020  reate_item(.    
-00017f80: 2020 2020 2020 2020 626f 6479 3d7b 2769          body={'i
-00017f90: 6427 3a20 2764 6f63 3227 2c0a 2020 2020  d': 'doc2',.    
-00017fa0: 2020 2020 2020 2020 2020 2020 2020 276b                'k
-00017fb0: 6579 273a 2027 7661 6c75 6532 277d 2c0a  ey': 'value2'},.
-00017fc0: 2020 2020 2020 2020 2020 2020 7072 655f              pre_
-00017fd0: 7472 6967 6765 725f 696e 636c 7564 653d  trigger_include=
-00017fe0: 2774 3227 0a20 2020 2020 2020 2029 0a20  't2'.        ). 
-00017ff0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00018000: 7274 4571 7561 6c28 646f 6375 6d65 6e74  rtEqual(document
-00018010: 5f32 5f31 5b27 6964 275d 2c0a 2020 2020  _2_1['id'],.    
-00018020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018030: 2020 2020 2027 646f 6332 272c 0a20 2020       'doc2',.   
-00018040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018050: 2020 2020 2020 2769 6420 7368 6f75 6c64        'id should
-00018060: 6e5c 2774 2063 6861 6e67 6527 290a 2020  n\'t change').  
-00018070: 2020 2020 2020 646f 6375 6d65 6e74 5f32        document_2
-00018080: 5f32 203d 2061 7761 6974 2063 6f6c 6c65  _2 = await colle
-00018090: 6374 696f 6e32 2e63 7265 6174 655f 6974  ction2.create_it
-000180a0: 656d 280a 2020 2020 2020 2020 2020 2020  em(.            
-000180b0: 626f 6479 3d7b 2769 6427 3a20 2744 6f63  body={'id': 'Doc
-000180c0: 3327 2c0a 2020 2020 2020 2020 2020 2020  3',.            
-000180d0: 2020 2020 2020 2770 726f 7027 3a20 2765        'prop': 'e
-000180e0: 6d70 7479 272c 0a20 2020 2020 2020 2020  mpty',.         
-000180f0: 2020 2020 2020 2020 2027 6b65 7927 3a20           'key': 
-00018100: 2776 616c 7565 3227 7d2c 0a20 2020 2020  'value2'},.     
-00018110: 2020 2020 2020 2070 7265 5f74 7269 6767         pre_trigg
-00018120: 6572 5f69 6e63 6c75 6465 3d27 7433 2729  er_include='t3')
-00018130: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00018140: 7365 7274 4571 7561 6c28 646f 6375 6d65  sertEqual(docume
-00018150: 6e74 5f32 5f32 5b27 6964 275d 2c20 2764  nt_2_2['id'], 'd
-00018160: 6f63 3374 3327 290a 0a20 2020 2020 2020  oc3t3')..       
-00018170: 2074 7269 6767 6572 735f 3320 3d20 5b74   triggers_3 = [t
-00018180: 7269 6767 6572 2061 7379 6e63 2066 6f72  rigger async for
-00018190: 2074 7269 6767 6572 2069 6e20 636f 6c6c   trigger in coll
-000181a0: 6563 7469 6f6e 332e 7363 7269 7074 732e  ection3.scripts.
-000181b0: 6c69 7374 5f74 7269 6767 6572 7328 295d  list_triggers()]
-000181c0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000181d0: 7365 7274 4571 7561 6c28 6c65 6e28 7472  sertEqual(len(tr
-000181e0: 6967 6765 7273 5f33 292c 2031 290a 2020  iggers_3), 1).  
-000181f0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-00018200: 6173 7365 7274 5261 6973 6573 2845 7863  assertRaises(Exc
-00018210: 6570 7469 6f6e 293a 0a20 2020 2020 2020  eption):.       
-00018220: 2020 2020 2061 7761 6974 2063 6f6c 6c65       await colle
-00018230: 6374 696f 6e33 2e63 7265 6174 655f 6974  ction3.create_it
-00018240: 656d 280a 2020 2020 2020 2020 2020 2020  em(.            
-00018250: 2020 2020 626f 6479 3d7b 2769 6427 3a20      body={'id': 
-00018260: 2744 6f63 6f70 7479 7065 272c 2027 6b65  'Docoptype', 'ke
-00018270: 7927 3a20 2776 616c 7565 3227 7d2c 0a20  y': 'value2'},. 
-00018280: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00018290: 6f73 745f 7472 6967 6765 725f 696e 636c  ost_trigger_incl
-000182a0: 7564 653d 2774 7269 6767 6572 4f70 5479  ude='triggerOpTy
-000182b0: 7065 270a 2020 2020 2020 2020 2020 2020  pe'.            
-000182c0: 290a 0a20 2020 2020 2020 2061 7761 6974  )..        await
-000182d0: 2064 622e 6465 6c65 7465 5f63 6f6e 7461   db.delete_conta
-000182e0: 696e 6572 2863 6f6c 6c65 6374 696f 6e31  iner(collection1
-000182f0: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
-00018300: 6462 2e64 656c 6574 655f 636f 6e74 6169  db.delete_contai
-00018310: 6e65 7228 636f 6c6c 6563 7469 6f6e 3229  ner(collection2)
-00018320: 0a20 2020 2020 2020 2061 7761 6974 2064  .        await d
-00018330: 622e 6465 6c65 7465 5f63 6f6e 7461 696e  b.delete_contain
-00018340: 6572 2863 6f6c 6c65 6374 696f 6e33 290a  er(collection3).
-00018350: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
-00018360: 6573 745f 7374 6f72 6564 5f70 726f 6365  est_stored_proce
-00018370: 6475 7265 5f66 756e 6374 696f 6e61 6c69  dure_functionali
-00018380: 7479 2873 656c 6629 3a0a 2020 2020 2020  ty(self):.      
-00018390: 2020 2320 6372 6561 7465 2064 6174 6162    # create datab
-000183a0: 6173 650a 2020 2020 2020 2020 6462 203d  ase.        db =
-000183b0: 2073 656c 662e 6461 7461 6261 7365 466f   self.databaseFo
-000183c0: 7254 6573 740a 2020 2020 2020 2020 2320  rTest.        # 
-000183d0: 6372 6561 7465 2063 6f6c 6c65 6374 696f  create collectio
-000183e0: 6e0a 2020 2020 2020 2020 636f 6c6c 6563  n.        collec
-000183f0: 7469 6f6e 203d 2061 7761 6974 2073 656c  tion = await sel
-00018400: 662e 6461 7461 6261 7365 466f 7254 6573  f.databaseForTes
-00018410: 742e 6372 6561 7465 5f63 6f6e 7461 696e  t.create_contain
-00018420: 6572 2874 6573 745f 636f 6e66 6967 2e5f  er(test_config._
-00018430: 7465 7374 5f63 6f6e 6669 672e 5445 5354  test_config.TEST
-00018440: 5f43 4f4c 4c45 4354 494f 4e5f 4d55 4c54  _COLLECTION_MULT
-00018450: 495f 5041 5254 4954 494f 4e29 0a0a 2020  I_PARTITION)..  
-00018460: 2020 2020 2020 7370 726f 6331 203d 207b        sproc1 = {
-00018470: 0a20 2020 2020 2020 2020 2020 2027 6964  .            'id
-00018480: 273a 2027 7374 6f72 6564 5072 6f63 6564  ': 'storedProced
-00018490: 7572 6531 2720 2b20 7374 7228 7575 6964  ure1' + str(uuid
-000184a0: 2e75 7569 6434 2829 292c 0a20 2020 2020  .uuid4()),.     
-000184b0: 2020 2020 2020 2027 626f 6479 273a 2028         'body': (
-000184c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000184d0: 2020 2020 2027 6675 6e63 7469 6f6e 2028       'function (
-000184e0: 2920 7b27 202b 0a20 2020 2020 2020 2020  ) {' +.         
-000184f0: 2020 2020 2020 2020 2020 2027 2020 666f             '  fo
-00018500: 7220 2876 6172 2069 203d 2030 3b20 6920  r (var i = 0; i 
-00018510: 3c20 3130 3030 3b20 692b 2b29 207b 2720  < 1000; i++) {' 
-00018520: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-00018530: 2020 2020 2020 2720 2020 2076 6172 2069        '    var i
-00018540: 7465 6d20 3d20 6765 7443 6f6e 7465 7874  tem = getContext
-00018550: 2829 2e67 6574 5265 7370 6f6e 7365 2829  ().getResponse()
-00018560: 2e67 6574 426f 6479 2829 3b27 202b 0a20  .getBody();' +. 
-00018570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018580: 2020 2027 2020 2020 6966 2028 6920 3e20     '    if (i > 
-00018590: 3020 2626 2069 7465 6d20 213d 2069 202d  0 && item != i -
-000185a0: 2031 2920 7468 726f 7720 5c27 626f 6479   1) throw \'body
-000185b0: 206d 6973 6d61 7463 685c 273b 2720 2b0a   mismatch\';' +.
-000185c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185d0: 2020 2020 2720 2020 2067 6574 436f 6e74      '    getCont
-000185e0: 6578 7428 292e 6765 7452 6573 706f 6e73  ext().getRespons
-000185f0: 6528 292e 7365 7442 6f64 7928 6929 3b27  e().setBody(i);'
-00018600: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00018610: 2020 2020 2020 2027 2020 7d27 202b 0a20         '  }' +. 
-00018620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018630: 2020 2027 7d27 290a 2020 2020 2020 2020     '}').        
-00018640: 7d0a 0a20 2020 2020 2020 2072 6574 7269  }..        retri
-00018650: 6576 6564 5f73 7072 6f63 203d 2061 7761  eved_sproc = awa
-00018660: 6974 2063 6f6c 6c65 6374 696f 6e2e 7363  it collection.sc
-00018670: 7269 7074 732e 6372 6561 7465 5f73 746f  ripts.create_sto
-00018680: 7265 645f 7072 6f63 6564 7572 6528 626f  red_procedure(bo
-00018690: 6479 3d73 7072 6f63 3129 0a20 2020 2020  dy=sproc1).     
-000186a0: 2020 2072 6573 756c 7420 3d20 6177 6169     result = awai
-000186b0: 7420 636f 6c6c 6563 7469 6f6e 2e73 6372  t collection.scr
-000186c0: 6970 7473 2e65 7865 6375 7465 5f73 746f  ipts.execute_sto
-000186d0: 7265 645f 7072 6f63 6564 7572 6528 0a20  red_procedure(. 
-000186e0: 2020 2020 2020 2020 2020 2073 7072 6f63             sproc
-000186f0: 3d72 6574 7269 6576 6564 5f73 7072 6f63  =retrieved_sproc
-00018700: 5b27 6964 275d 2c0a 2020 2020 2020 2020  ['id'],.        
-00018710: 2020 2020 7061 7274 6974 696f 6e5f 6b65      partition_ke
-00018720: 793d 310a 2020 2020 2020 2020 290a 2020  y=1.        ).  
-00018730: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00018740: 7445 7175 616c 2872 6573 756c 742c 2039  tEqual(result, 9
-00018750: 3939 290a 2020 2020 2020 2020 7370 726f  99).        spro
-00018760: 6332 203d 207b 0a20 2020 2020 2020 2020  c2 = {.         
-00018770: 2020 2027 6964 273a 2027 7374 6f72 6564     'id': 'stored
-00018780: 5072 6f63 6564 7572 6532 2720 2b20 7374  Procedure2' + st
-00018790: 7228 7575 6964 2e75 7569 6434 2829 292c  r(uuid.uuid4()),
-000187a0: 0a20 2020 2020 2020 2020 2020 2027 626f  .            'bo
-000187b0: 6479 273a 2028 0a20 2020 2020 2020 2020  dy': (.         
-000187c0: 2020 2020 2020 2020 2020 2027 6675 6e63             'func
-000187d0: 7469 6f6e 2028 2920 7b27 202b 0a20 2020  tion () {' +.   
-000187e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187f0: 2027 2020 666f 7220 2876 6172 2069 203d   '  for (var i =
-00018800: 2030 3b20 6920 3c20 3130 3b20 692b 2b29   0; i < 10; i++)
-00018810: 207b 2720 2b0a 2020 2020 2020 2020 2020   {' +.          
-00018820: 2020 2020 2020 2020 2020 2720 2020 2067            '    g
-00018830: 6574 436f 6e74 6578 7428 292e 6765 7452  etContext().getR
-00018840: 6573 706f 6e73 6528 292e 6170 7065 6e64  esponse().append
-00018850: 5661 6c75 6528 5c27 426f 6479 5c27 2c20  Value(\'Body\', 
-00018860: 6929 3b27 202b 0a20 2020 2020 2020 2020  i);' +.         
-00018870: 2020 2020 2020 2020 2020 2027 2020 7d27             '  }'
-00018880: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00018890: 2020 2020 2020 2027 7d27 290a 2020 2020         '}').    
-000188a0: 2020 2020 7d0a 2020 2020 2020 2020 7265      }.        re
-000188b0: 7472 6965 7665 645f 7370 726f 6332 203d  trieved_sproc2 =
-000188c0: 2061 7761 6974 2063 6f6c 6c65 6374 696f   await collectio
-000188d0: 6e2e 7363 7269 7074 732e 6372 6561 7465  n.scripts.create
-000188e0: 5f73 746f 7265 645f 7072 6f63 6564 7572  _stored_procedur
-000188f0: 6528 626f 6479 3d73 7072 6f63 3229 0a20  e(body=sproc2). 
-00018900: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00018910: 6177 6169 7420 636f 6c6c 6563 7469 6f6e  await collection
-00018920: 2e73 6372 6970 7473 2e65 7865 6375 7465  .scripts.execute
-00018930: 5f73 746f 7265 645f 7072 6f63 6564 7572  _stored_procedur
-00018940: 6528 0a20 2020 2020 2020 2020 2020 2073  e(.            s
-00018950: 7072 6f63 3d72 6574 7269 6576 6564 5f73  proc=retrieved_s
-00018960: 7072 6f63 325b 2769 6427 5d2c 0a20 2020  proc2['id'],.   
-00018970: 2020 2020 2020 2020 2070 6172 7469 7469           partiti
-00018980: 6f6e 5f6b 6579 3d31 0a20 2020 2020 2020  on_key=1.       
-00018990: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-000189a0: 6173 7365 7274 4571 7561 6c28 696e 7428  assertEqual(int(
-000189b0: 7265 7375 6c74 292c 2031 3233 3435 3637  result), 1234567
-000189c0: 3839 290a 2020 2020 2020 2020 7370 726f  89).        spro
-000189d0: 6333 203d 207b 0a20 2020 2020 2020 2020  c3 = {.         
-000189e0: 2020 2027 6964 273a 2027 7374 6f72 6564     'id': 'stored
-000189f0: 5072 6f63 6564 7572 6533 2720 2b20 7374  Procedure3' + st
-00018a00: 7228 7575 6964 2e75 7569 6434 2829 292c  r(uuid.uuid4()),
-00018a10: 0a20 2020 2020 2020 2020 2020 2027 626f  .            'bo
-00018a20: 6479 273a 2028 0a20 2020 2020 2020 2020  dy': (.         
-00018a30: 2020 2020 2020 2020 2020 2027 6675 6e63             'func
-00018a40: 7469 6f6e 2028 696e 7075 7429 207b 2720  tion (input) {' 
-00018a50: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-00018a60: 2020 2020 2020 2720 2067 6574 436f 6e74        '  getCont
-00018a70: 6578 7428 292e 6765 7452 6573 706f 6e73  ext().getRespons
-00018a80: 6528 292e 7365 7442 6f64 7928 2720 2b0a  e().setBody(' +.
-00018a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018aa0: 2020 2020 2720 2020 2020 205c 2761 5c27      '      \'a\'
-00018ab0: 202b 2069 6e70 7574 2e74 656d 7029 3b27   + input.temp);'
-00018ac0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00018ad0: 2020 2020 2020 2027 7d27 290a 2020 2020         '}').    
-00018ae0: 2020 2020 7d0a 2020 2020 2020 2020 7265      }.        re
-00018af0: 7472 6965 7665 645f 7370 726f 6333 203d  trieved_sproc3 =
-00018b00: 2061 7761 6974 2063 6f6c 6c65 6374 696f   await collectio
-00018b10: 6e2e 7363 7269 7074 732e 6372 6561 7465  n.scripts.create
-00018b20: 5f73 746f 7265 645f 7072 6f63 6564 7572  _stored_procedur
-00018b30: 6528 626f 6479 3d73 7072 6f63 3329 0a20  e(body=sproc3). 
-00018b40: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00018b50: 6177 6169 7420 636f 6c6c 6563 7469 6f6e  await collection
-00018b60: 2e73 6372 6970 7473 2e65 7865 6375 7465  .scripts.execute
-00018b70: 5f73 746f 7265 645f 7072 6f63 6564 7572  _stored_procedur
-00018b80: 6528 0a20 2020 2020 2020 2020 2020 2073  e(.            s
-00018b90: 7072 6f63 3d72 6574 7269 6576 6564 5f73  proc=retrieved_s
-00018ba0: 7072 6f63 335b 2769 6427 5d2c 0a20 2020  proc3['id'],.   
-00018bb0: 2020 2020 2020 2020 2070 6172 616d 733d           params=
-00018bc0: 7b27 7465 6d70 273a 2027 736f 277d 2c0a  {'temp': 'so'},.
-00018bd0: 2020 2020 2020 2020 2020 2020 7061 7274              part
-00018be0: 6974 696f 6e5f 6b65 793d 310a 2020 2020  ition_key=1.    
-00018bf0: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
-00018c00: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00018c10: 6573 756c 742c 2027 6173 6f27 290a 0a20  esult, 'aso').. 
-00018c20: 2020 2061 7379 6e63 2064 6566 205f 5f56     async def __V
-00018c30: 616c 6964 6174 654f 6666 6572 5265 7370  alidateOfferResp
-00018c40: 6f6e 7365 426f 6479 2873 656c 662c 206f  onseBody(self, o
-00018c50: 6666 6572 2c20 6578 7065 6374 6564 5f63  ffer, expected_c
-00018c60: 6f6c 6c5f 6c69 6e6b 2c20 6578 7065 6374  oll_link, expect
-00018c70: 6564 5f6f 6666 6572 5f74 7970 6529 3a0a  ed_offer_type):.
-00018c80: 2020 2020 2020 2020 2320 7479 7065 3a20          # type: 
-00018c90: 284f 6666 6572 2c20 7374 722c 2041 6e79  (Offer, str, Any
-00018ca0: 2920 2d3e 204e 6f6e 650a 2020 2020 2020  ) -> None.      
-00018cb0: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
-00018cc0: 6f74 4e6f 6e65 286f 6666 6572 2e70 726f  otNone(offer.pro
-00018cd0: 7065 7274 6965 735b 2769 6427 5d2c 2027  perties['id'], '
-00018ce0: 4964 2063 616e 6e6f 7420 6265 206e 756c  Id cannot be nul
-00018cf0: 6c2e 2729 0a20 2020 2020 2020 2073 656c  l.').        sel
-00018d00: 662e 6173 7365 7274 4973 4e6f 744e 6f6e  f.assertIsNotNon
-00018d10: 6528 6f66 6665 722e 7072 6f70 6572 7469  e(offer.properti
-00018d20: 6573 2e67 6574 2827 5f72 6964 2729 2c20  es.get('_rid'), 
-00018d30: 2752 6573 6f75 7263 6520 4964 2028 5269  'Resource Id (Ri
-00018d40: 6429 2063 616e 6e6f 7420 6265 206e 756c  d) cannot be nul
-00018d50: 6c2e 2729 0a20 2020 2020 2020 2073 656c  l.').        sel
-00018d60: 662e 6173 7365 7274 4973 4e6f 744e 6f6e  f.assertIsNotNon
-00018d70: 6528 6f66 6665 722e 7072 6f70 6572 7469  e(offer.properti
-00018d80: 6573 2e67 6574 2827 5f73 656c 6627 292c  es.get('_self'),
-00018d90: 2027 5365 6c66 204c 696e 6b20 6361 6e6e   'Self Link cann
-00018da0: 6f74 2062 6520 6e75 6c6c 2e27 290a 2020  ot be null.').  
-00018db0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00018dc0: 7449 734e 6f74 4e6f 6e65 286f 6666 6572  tIsNotNone(offer
-00018dd0: 2e70 726f 7065 7274 6965 732e 6765 7428  .properties.get(
-00018de0: 2772 6573 6f75 7263 6527 292c 2027 5265  'resource'), 'Re
-00018df0: 736f 7572 6365 204c 696e 6b20 6361 6e6e  source Link cann
-00018e00: 6f74 2062 6520 6e75 6c6c 2e27 290a 2020  ot be null.').  
-00018e10: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00018e20: 7454 7275 6528 6f66 6665 722e 7072 6f70  tTrue(offer.prop
-00018e30: 6572 7469 6573 5b27 5f73 656c 6627 5d2e  erties['_self'].
-00018e40: 6669 6e64 286f 6666 6572 2e70 726f 7065  find(offer.prope
-00018e50: 7274 6965 735b 2769 6427 5d29 2021 3d20  rties['id']) != 
-00018e60: 2d31 2c0a 2020 2020 2020 2020 2020 2020  -1,.            
-00018e70: 2020 2020 2020 2020 2020 2020 274f 6666              'Off
-00018e80: 6572 2069 6420 6e6f 7420 636f 6e74 6169  er id not contai
-00018e90: 6e65 6420 696e 206f 6666 6572 2073 656c  ned in offer sel
-00018ea0: 6620 6c69 6e6b 2e27 290a 2020 2020 2020  f link.').      
-00018eb0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00018ec0: 616c 2865 7870 6563 7465 645f 636f 6c6c  al(expected_coll
-00018ed0: 5f6c 696e 6b2e 7374 7269 7028 272f 2729  _link.strip('/')
-00018ee0: 2c20 6f66 6665 722e 7072 6f70 6572 7469  , offer.properti
-00018ef0: 6573 5b27 7265 736f 7572 6365 275d 2e73  es['resource'].s
-00018f00: 7472 6970 2827 2f27 2929 0a20 2020 2020  trip('/')).     
-00018f10: 2020 2069 6620 2865 7870 6563 7465 645f     if (expected_
-00018f20: 6f66 6665 725f 7479 7065 293a 0a20 2020  offer_type):.   
-00018f30: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00018f40: 7365 7274 4571 7561 6c28 6578 7065 6374  sertEqual(expect
-00018f50: 6564 5f6f 6666 6572 5f74 7970 652c 206f  ed_offer_type, o
-00018f60: 6666 6572 2e70 726f 7065 7274 6965 732e  ffer.properties.
-00018f70: 6765 7428 276f 6666 6572 5479 7065 2729  get('offerType')
-00018f80: 290a 0a20 2020 2061 7379 6e63 2064 6566  )..    async def
-00018f90: 2074 6573 745f 6f66 6665 725f 7265 6164   test_offer_read
-00018fa0: 5f61 6e64 5f71 7565 7279 2873 656c 6629  _and_query(self)
-00018fb0: 3a0a 2020 2020 2020 2020 2320 4372 6561  :.        # Crea
-00018fc0: 7465 2064 6174 6162 6173 652e 0a20 2020  te database..   
-00018fd0: 2020 2020 2064 6220 3d20 7365 6c66 2e64       db = self.d
-00018fe0: 6174 6162 6173 6546 6f72 5465 7374 0a0a  atabaseForTest..
-00018ff0: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
-00019000: 2063 6f6c 6c65 6374 696f 6e2e 0a20 2020   collection..   
-00019010: 2020 2020 2063 6f6c 6c65 6374 696f 6e20       collection 
-00019020: 3d20 6177 6169 7420 6462 2e63 7265 6174  = await db.creat
-00019030: 655f 636f 6e74 6169 6e65 7228 0a20 2020  e_container(.   
-00019040: 2020 2020 2020 2020 2069 643d 2774 6573           id='tes
-00019050: 745f 6f66 6665 725f 7265 6164 5f61 6e64  t_offer_read_and
-00019060: 5f71 7565 7279 2027 202b 2073 7472 2875  _query ' + str(u
-00019070: 7569 642e 7575 6964 3428 2929 2c0a 2020  uid.uuid4()),.  
-00019080: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-00019090: 696f 6e5f 6b65 793d 5061 7274 6974 696f  ion_key=Partitio
-000190a0: 6e4b 6579 2870 6174 683d 272f 6964 272c  nKey(path='/id',
-000190b0: 206b 696e 643d 2748 6173 6827 290a 2020   kind='Hash').  
-000190c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000190d0: 2320 5265 6164 2074 6865 206f 6666 6572  # Read the offer
-000190e0: 2e0a 2020 2020 2020 2020 6578 7065 6374  ..        expect
-000190f0: 6564 5f6f 6666 6572 203d 2061 7761 6974  ed_offer = await
-00019100: 2063 6f6c 6c65 6374 696f 6e2e 6765 745f   collection.get_
-00019110: 7468 726f 7567 6870 7574 2829 0a20 2020  throughput().   
-00019120: 2020 2020 2063 6f6c 6c65 6374 696f 6e5f       collection_
-00019130: 7072 6f70 6572 7469 6573 203d 2061 7761  properties = awa
-00019140: 6974 2063 6f6c 6c65 6374 696f 6e2e 7265  it collection.re
-00019150: 6164 2829 0a20 2020 2020 2020 2061 7761  ad().        awa
-00019160: 6974 2073 656c 662e 5f5f 5661 6c69 6461  it self.__Valida
-00019170: 7465 4f66 6665 7252 6573 706f 6e73 6542  teOfferResponseB
-00019180: 6f64 7928 6578 7065 6374 6564 5f6f 6666  ody(expected_off
-00019190: 6572 2c20 636f 6c6c 6563 7469 6f6e 5f70  er, collection_p
-000191a0: 726f 7065 7274 6965 732e 6765 7428 275f  roperties.get('_
-000191b0: 7365 6c66 2729 2c20 4e6f 6e65 290a 0a20  self'), None).. 
-000191c0: 2020 2020 2020 2023 204e 6f77 2064 656c         # Now del
-000191d0: 6574 6520 7468 6520 636f 6c6c 6563 7469  ete the collecti
-000191e0: 6f6e 2e0a 2020 2020 2020 2020 6177 6169  on..        awai
-000191f0: 7420 6462 2e64 656c 6574 655f 636f 6e74  t db.delete_cont
-00019200: 6169 6e65 7228 636f 6e74 6169 6e65 723d  ainer(container=
-00019210: 636f 6c6c 6563 7469 6f6e 290a 2020 2020  collection).    
-00019220: 2020 2020 2320 5265 6164 696e 6720 6661      # Reading fa
-00019230: 696c 732e 0a20 2020 2020 2020 2061 7761  ils..        awa
-00019240: 6974 2073 656c 662e 5f5f 4173 7365 7274  it self.__Assert
-00019250: 4854 5450 4661 696c 7572 6557 6974 6853  HTTPFailureWithS
-00019260: 7461 7475 7328 5374 6174 7573 436f 6465  tatus(StatusCode
-00019270: 732e 4e4f 545f 464f 554e 442c 2063 6f6c  s.NOT_FOUND, col
-00019280: 6c65 6374 696f 6e2e 7265 6164 5f6f 6666  lection.read_off
-00019290: 6572 290a 0a20 2020 2061 7379 6e63 2064  er)..    async d
-000192a0: 6566 2074 6573 745f 6f66 6665 725f 7265  ef test_offer_re
-000192b0: 706c 6163 6528 7365 6c66 293a 0a20 2020  place(self):.   
-000192c0: 2020 2020 2023 2043 7265 6174 6520 6461       # Create da
-000192d0: 7461 6261 7365 2e0a 2020 2020 2020 2020  tabase..        
-000192e0: 6462 203d 2073 656c 662e 6461 7461 6261  db = self.databa
-000192f0: 7365 466f 7254 6573 740a 2020 2020 2020  seForTest.      
-00019300: 2020 2320 4372 6561 7465 2063 6f6c 6c65    # Create colle
-00019310: 6374 696f 6e2e 0a20 2020 2020 2020 2063  ction..        c
-00019320: 6f6c 6c65 6374 696f 6e20 3d20 6177 6169  ollection = awai
-00019330: 7420 7365 6c66 2e64 6174 6162 6173 6546  t self.databaseF
-00019340: 6f72 5465 7374 2e63 7265 6174 655f 636f  orTest.create_co
-00019350: 6e74 6169 6e65 7228 7465 7374 5f63 6f6e  ntainer(test_con
-00019360: 6669 672e 5f74 6573 745f 636f 6e66 6967  fig._test_config
-00019370: 2e54 4553 545f 434f 4c4c 4543 5449 4f4e  .TEST_COLLECTION
-00019380: 5f4d 554c 5449 5f50 4152 5449 5449 4f4e  _MULTI_PARTITION
-00019390: 290a 2020 2020 2020 2020 2320 5265 6164  ).        # Read
-000193a0: 204f 6666 6572 0a20 2020 2020 2020 2065   Offer.        e
-000193b0: 7870 6563 7465 645f 6f66 6665 7220 3d20  xpected_offer = 
-000193c0: 6177 6169 7420 636f 6c6c 6563 7469 6f6e  await collection
-000193d0: 2e67 6574 5f74 6872 6f75 6768 7075 7428  .get_throughput(
-000193e0: 290a 2020 2020 2020 2020 636f 6c6c 6563  ).        collec
-000193f0: 7469 6f6e 5f70 726f 7065 7274 6965 7320  tion_properties 
-00019400: 3d20 6177 6169 7420 636f 6c6c 6563 7469  = await collecti
-00019410: 6f6e 2e72 6561 6428 290a 2020 2020 2020  on.read().      
-00019420: 2020 6177 6169 7420 7365 6c66 2e5f 5f56    await self.__V
-00019430: 616c 6964 6174 654f 6666 6572 5265 7370  alidateOfferResp
-00019440: 6f6e 7365 426f 6479 2865 7870 6563 7465  onseBody(expecte
-00019450: 645f 6f66 6665 722c 2063 6f6c 6c65 6374  d_offer, collect
-00019460: 696f 6e5f 7072 6f70 6572 7469 6573 2e67  ion_properties.g
-00019470: 6574 2827 5f73 656c 6627 292c 204e 6f6e  et('_self'), Non
-00019480: 6529 0a20 2020 2020 2020 2023 2052 6570  e).        # Rep
-00019490: 6c61 6365 2074 6865 206f 6666 6572 2e0a  lace the offer..
-000194a0: 2020 2020 2020 2020 7265 706c 6163 6564          replaced
-000194b0: 5f6f 6666 6572 203d 2061 7761 6974 2063  _offer = await c
-000194c0: 6f6c 6c65 6374 696f 6e2e 7265 706c 6163  ollection.replac
-000194d0: 655f 7468 726f 7567 6870 7574 2865 7870  e_throughput(exp
-000194e0: 6563 7465 645f 6f66 6665 722e 6f66 6665  ected_offer.offe
-000194f0: 725f 7468 726f 7567 6870 7574 202b 2031  r_throughput + 1
-00019500: 3030 290a 2020 2020 2020 2020 636f 6c6c  00).        coll
-00019510: 6563 7469 6f6e 5f70 726f 7065 7274 6965  ection_propertie
-00019520: 7320 3d20 6177 6169 7420 636f 6c6c 6563  s = await collec
-00019530: 7469 6f6e 2e72 6561 6428 290a 2020 2020  tion.read().    
-00019540: 2020 2020 6177 6169 7420 7365 6c66 2e5f      await self._
-00019550: 5f56 616c 6964 6174 654f 6666 6572 5265  _ValidateOfferRe
-00019560: 7370 6f6e 7365 426f 6479 2872 6570 6c61  sponseBody(repla
-00019570: 6365 645f 6f66 6665 722c 2063 6f6c 6c65  ced_offer, colle
-00019580: 6374 696f 6e5f 7072 6f70 6572 7469 6573  ction_properties
-00019590: 2e67 6574 2827 5f73 656c 6627 292c 204e  .get('_self'), N
-000195a0: 6f6e 6529 0a20 2020 2020 2020 2023 2043  one).        # C
-000195b0: 6865 636b 2069 6620 7468 6520 7265 706c  heck if the repl
-000195c0: 6163 6564 206f 6666 6572 2069 7320 7768  aced offer is wh
-000195d0: 6174 2077 6520 6578 7065 6374 2e0a 2020  at we expect..  
-000195e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000195f0: 7445 7175 616c 2865 7870 6563 7465 645f  tEqual(expected_
-00019600: 6f66 6665 722e 7072 6f70 6572 7469 6573  offer.properties
-00019610: 2e67 6574 2827 636f 6e74 656e 7427 292e  .get('content').
-00019620: 6765 7428 276f 6666 6572 5468 726f 7567  get('offerThroug
-00019630: 6870 7574 2729 202b 2031 3030 2c0a 2020  hput') + 100,.  
-00019640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019650: 2020 2020 2020 2072 6570 6c61 6365 645f         replaced_
-00019660: 6f66 6665 722e 7072 6f70 6572 7469 6573  offer.properties
-00019670: 2e67 6574 2827 636f 6e74 656e 7427 292e  .get('content').
-00019680: 6765 7428 276f 6666 6572 5468 726f 7567  get('offerThroug
-00019690: 6870 7574 2729 290a 2020 2020 2020 2020  hput')).        
-000196a0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000196b0: 2865 7870 6563 7465 645f 6f66 6665 722e  (expected_offer.
-000196c0: 6f66 6665 725f 7468 726f 7567 6870 7574  offer_throughput
-000196d0: 202b 2031 3030 2c0a 2020 2020 2020 2020   + 100,.        
-000196e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196f0: 2072 6570 6c61 6365 645f 6f66 6665 722e   replaced_offer.
-00019700: 6f66 6665 725f 7468 726f 7567 6870 7574  offer_throughput
-00019710: 290a 0a20 2020 2061 7379 6e63 2064 6566  )..    async def
-00019720: 2074 6573 745f 6461 7461 6261 7365 5f61   test_database_a
-00019730: 6363 6f75 6e74 5f66 756e 6374 696f 6e61  ccount_functiona
-00019740: 6c69 7479 2873 656c 6629 3a0a 2020 2020  lity(self):.    
-00019750: 2020 2020 2320 5661 6c69 6461 7465 2064      # Validate d
-00019760: 6174 6162 6173 6520 6163 636f 756e 7420  atabase account 
-00019770: 6675 6e63 7469 6f6e 616c 6974 792e 0a20  functionality.. 
-00019780: 2020 2020 2020 2064 6174 6162 6173 655f         database_
-00019790: 6163 636f 756e 7420 3d20 6177 6169 7420  account = await 
-000197a0: 7365 6c66 2e63 6c69 656e 742e 5f67 6574  self.client._get
-000197b0: 5f64 6174 6162 6173 655f 6163 636f 756e  _database_accoun
-000197c0: 7428 290a 2020 2020 2020 2020 7365 6c66  t().        self
-000197d0: 2e61 7373 6572 7445 7175 616c 2864 6174  .assertEqual(dat
-000197e0: 6162 6173 655f 6163 636f 756e 742e 4461  abase_account.Da
-000197f0: 7461 6261 7365 734c 696e 6b2c 2027 2f64  tabasesLink, '/d
-00019800: 6273 2f27 290a 2020 2020 2020 2020 7365  bs/').        se
-00019810: 6c66 2e61 7373 6572 7445 7175 616c 2864  lf.assertEqual(d
-00019820: 6174 6162 6173 655f 6163 636f 756e 742e  atabase_account.
-00019830: 4d65 6469 614c 696e 6b2c 2027 2f6d 6564  MediaLink, '/med
-00019840: 6961 2f27 290a 2020 2020 2020 2020 6966  ia/').        if
-00019850: 2028 4874 7470 4865 6164 6572 732e 4d61   (HttpHeaders.Ma
-00019860: 784d 6564 6961 5374 6f72 6167 6555 7361  xMediaStorageUsa
-00019870: 6765 496e 4d42 2069 6e0a 2020 2020 2020  geInMB in.      
-00019880: 2020 2020 2020 2020 2020 6177 6169 7420            await 
-00019890: 7365 6c66 2e63 6c69 656e 742e 636c 6965  self.client.clie
-000198a0: 6e74 5f63 6f6e 6e65 6374 696f 6e2e 6c61  nt_connection.la
-000198b0: 7374 5f72 6573 706f 6e73 655f 6865 6164  st_response_head
-000198c0: 6572 7329 3a0a 2020 2020 2020 2020 2020  ers):.          
-000198d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000198e0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-000198f0: 2020 2020 6461 7461 6261 7365 5f61 6363      database_acc
-00019900: 6f75 6e74 2e4d 6178 4d65 6469 6153 746f  ount.MaxMediaSto
-00019910: 7261 6765 5573 6167 6549 6e4d 422c 0a20  rageUsageInMB,. 
-00019920: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00019930: 656c 662e 636c 6965 6e74 2e63 6c69 656e  elf.client.clien
-00019940: 745f 636f 6e6e 6563 7469 6f6e 2e6c 6173  t_connection.las
-00019950: 745f 7265 7370 6f6e 7365 5f68 6561 6465  t_response_heade
-00019960: 7273 5b0a 2020 2020 2020 2020 2020 2020  rs[.            
-00019970: 2020 2020 2020 2020 4874 7470 4865 6164          HttpHead
-00019980: 6572 732e 4d61 784d 6564 6961 5374 6f72  ers.MaxMediaStor
-00019990: 6167 6555 7361 6765 496e 4d42 5d29 0a20  ageUsageInMB]). 
-000199a0: 2020 2020 2020 2069 6620 2848 7474 7048         if (HttpH
-000199b0: 6561 6465 7273 2e43 7572 7265 6e74 4d65  eaders.CurrentMe
-000199c0: 6469 6153 746f 7261 6765 5573 6167 6549  diaStorageUsageI
-000199d0: 6e4d 4220 696e 0a20 2020 2020 2020 2020  nMB in.         
-000199e0: 2020 2020 2020 2061 7761 6974 2073 656c         await sel
-000199f0: 662e 636c 6965 6e74 2e63 6c69 656e 745f  f.client.client_
-00019a00: 636f 6e6e 6563 7469 6f6e 2e6c 6173 745f  connection.last_
-00019a10: 7265 7370 6f6e 7365 5f68 6561 6465 7273  response_headers
-00019a20: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00019a30: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00019a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019a50: 2064 6174 6162 6173 655f 6163 636f 756e   database_accoun
-00019a60: 742e 4375 7272 656e 744d 6564 6961 5374  t.CurrentMediaSt
-00019a70: 6f72 6167 6555 7361 6765 496e 4d42 2c0a  orageUsageInMB,.
-00019a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a90: 6177 6169 7420 7365 6c66 2e63 6c69 656e  await self.clien
-00019aa0: 742e 636c 6965 6e74 5f63 6f6e 6e65 6374  t.client_connect
-00019ab0: 696f 6e2e 6c61 7374 5f72 6573 706f 6e73  ion.last_respons
-00019ac0: 655f 6865 6164 6572 735b 0a20 2020 2020  e_headers[.     
-00019ad0: 2020 2020 2020 2020 2020 2020 2020 2048                 H
-00019ae0: 7474 7048 6561 6465 7273 2e43 7572 7265  ttpHeaders.Curre
-00019af0: 6e74 4d65 6469 6153 746f 7261 6765 5573  ntMediaStorageUs
-00019b00: 6167 6549 6e4d 425d 290a 2020 2020 2020  ageInMB]).      
-00019b10: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
-00019b20: 6f74 4e6f 6e65 2864 6174 6162 6173 655f  otNone(database_
-00019b30: 6163 636f 756e 742e 436f 6e73 6973 7465  account.Consiste
-00019b40: 6e63 7950 6f6c 6963 795b 2764 6566 6175  ncyPolicy['defau
-00019b50: 6c74 436f 6e73 6973 7465 6e63 794c 6576  ltConsistencyLev
-00019b60: 656c 275d 290a 0a20 2020 2061 7379 6e63  el'])..    async
-00019b70: 2064 6566 2074 6573 745f 696e 6465 785f   def test_index_
-00019b80: 7072 6f67 7265 7373 5f68 6561 6465 7273  progress_headers
-00019b90: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00019ba0: 6372 6561 7465 645f 6462 203d 2073 656c  created_db = sel
-00019bb0: 662e 6461 7461 6261 7365 466f 7254 6573  f.databaseForTes
-00019bc0: 740a 2020 2020 2020 2020 636f 6e73 6973  t.        consis
-00019bd0: 7465 6e74 5f63 6f6c 6c20 3d20 6177 6169  tent_coll = awai
-00019be0: 7420 6372 6561 7465 645f 6462 2e63 7265  t created_db.cre
-00019bf0: 6174 655f 636f 6e74 6169 6e65 7228 0a20  ate_container(. 
-00019c00: 2020 2020 2020 2020 2020 2069 643d 2774             id='t
-00019c10: 6573 745f 696e 6465 785f 7072 6f67 7265  est_index_progre
-00019c20: 7373 5f68 6561 6465 7273 2063 6f6e 7369  ss_headers consi
-00019c30: 7374 656e 745f 636f 6c6c 2027 202b 2073  stent_coll ' + s
-00019c40: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
-00019c50: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-00019c60: 7274 6974 696f 6e5f 6b65 793d 5061 7274  rtition_key=Part
-00019c70: 6974 696f 6e4b 6579 2870 6174 683d 222f  itionKey(path="/
-00019c80: 6964 222c 206b 696e 643d 2748 6173 6827  id", kind='Hash'
-00019c90: 292c 0a20 2020 2020 2020 2029 0a20 2020  ),.        ).   
-00019ca0: 2020 2020 2063 7265 6174 6564 5f63 6f6e       created_con
-00019cb0: 7461 696e 6572 203d 2063 7265 6174 6564  tainer = created
-00019cc0: 5f64 622e 6765 745f 636f 6e74 6169 6e65  _db.get_containe
-00019cd0: 725f 636c 6965 6e74 2863 6f6e 7461 696e  r_client(contain
-00019ce0: 6572 3d63 6f6e 7369 7374 656e 745f 636f  er=consistent_co
-00019cf0: 6c6c 290a 2020 2020 2020 2020 6177 6169  ll).        awai
-00019d00: 7420 6372 6561 7465 645f 636f 6e74 6169  t created_contai
-00019d10: 6e65 722e 7265 6164 2870 6f70 756c 6174  ner.read(populat
-00019d20: 655f 7175 6f74 615f 696e 666f 3d54 7275  e_quota_info=Tru
-00019d30: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-00019d40: 6173 7365 7274 4661 6c73 6528 4874 7470  assertFalse(Http
-00019d50: 4865 6164 6572 732e 4c61 7a79 496e 6465  Headers.LazyInde
-00019d60: 7869 6e67 5072 6f67 7265 7373 2069 6e20  xingProgress in 
-00019d70: 6372 6561 7465 645f 6462 2e63 6c69 656e  created_db.clien
-00019d80: 745f 636f 6e6e 6563 7469 6f6e 2e6c 6173  t_connection.las
-00019d90: 745f 7265 7370 6f6e 7365 5f68 6561 6465  t_response_heade
-00019da0: 7273 290a 2020 2020 2020 2020 7365 6c66  rs).        self
-00019db0: 2e61 7373 6572 7454 7275 6528 4874 7470  .assertTrue(Http
-00019dc0: 4865 6164 6572 732e 496e 6465 7854 7261  Headers.IndexTra
-00019dd0: 6e73 666f 726d 6174 696f 6e50 726f 6772  nsformationProgr
-00019de0: 6573 7320 696e 2063 7265 6174 6564 5f64  ess in created_d
-00019df0: 622e 636c 6965 6e74 5f63 6f6e 6e65 6374  b.client_connect
-00019e00: 696f 6e2e 6c61 7374 5f72 6573 706f 6e73  ion.last_respons
-00019e10: 655f 6865 6164 6572 7329 0a0a 2020 2020  e_headers)..    
-00019e20: 2020 2020 6e6f 6e65 5f63 6f6c 6c20 3d20      none_coll = 
-00019e30: 6177 6169 7420 6372 6561 7465 645f 6462  await created_db
-00019e40: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
-00019e50: 7228 0a20 2020 2020 2020 2020 2020 2069  r(.            i
-00019e60: 643d 2774 6573 745f 696e 6465 785f 7072  d='test_index_pr
-00019e70: 6f67 7265 7373 5f68 6561 6465 7273 206e  ogress_headers n
-00019e80: 6f6e 655f 636f 6c6c 2027 202b 2073 7472  one_coll ' + str
-00019e90: 2875 7569 642e 7575 6964 3428 2929 2c0a  (uuid.uuid4()),.
-00019ea0: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00019eb0: 7869 6e67 5f70 6f6c 6963 793d 7b0a 2020  xing_policy={.  
-00019ec0: 2020 2020 2020 2020 2020 2020 2020 2769                'i
-00019ed0: 6e64 6578 696e 674d 6f64 6527 3a20 646f  ndexingMode': do
-00019ee0: 6375 6d65 6e74 732e 496e 6465 7869 6e67  cuments.Indexing
-00019ef0: 4d6f 6465 2e4e 6f49 6e64 6578 2c0a 2020  Mode.NoIndex,.  
-00019f00: 2020 2020 2020 2020 2020 2020 2020 2761                'a
-00019f10: 7574 6f6d 6174 6963 273a 2046 616c 7365  utomatic': False
-00019f20: 0a20 2020 2020 2020 2020 2020 207d 2c0a  .            },.
-00019f30: 2020 2020 2020 2020 2020 2020 7061 7274              part
-00019f40: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
-00019f50: 696f 6e4b 6579 2870 6174 683d 222f 6964  ionKey(path="/id
-00019f60: 222c 206b 696e 643d 2748 6173 6827 290a  ", kind='Hash').
-00019f70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00019f80: 2020 6372 6561 7465 645f 636f 6e74 6169    created_contai
-00019f90: 6e65 7220 3d20 6372 6561 7465 645f 6462  ner = created_db
-00019fa0: 2e67 6574 5f63 6f6e 7461 696e 6572 5f63  .get_container_c
-00019fb0: 6c69 656e 7428 636f 6e74 6169 6e65 723d  lient(container=
-00019fc0: 6e6f 6e65 5f63 6f6c 6c29 0a20 2020 2020  none_coll).     
-00019fd0: 2020 2061 7761 6974 2063 7265 6174 6564     await created
-00019fe0: 5f63 6f6e 7461 696e 6572 2e72 6561 6428  _container.read(
-00019ff0: 706f 7075 6c61 7465 5f71 756f 7461 5f69  populate_quota_i
-0001a000: 6e66 6f3d 5472 7565 290a 2020 2020 2020  nfo=True).      
-0001a010: 2020 7365 6c66 2e61 7373 6572 7446 616c    self.assertFal
-0001a020: 7365 2848 7474 7048 6561 6465 7273 2e4c  se(HttpHeaders.L
-0001a030: 617a 7949 6e64 6578 696e 6750 726f 6772  azyIndexingProgr
-0001a040: 6573 7320 696e 2063 7265 6174 6564 5f64  ess in created_d
-0001a050: 622e 636c 6965 6e74 5f63 6f6e 6e65 6374  b.client_connect
-0001a060: 696f 6e2e 6c61 7374 5f72 6573 706f 6e73  ion.last_respons
-0001a070: 655f 6865 6164 6572 7329 0a20 2020 2020  e_headers).     
-0001a080: 2020 2073 656c 662e 6173 7365 7274 5472     self.assertTr
-0001a090: 7565 2848 7474 7048 6561 6465 7273 2e49  ue(HttpHeaders.I
-0001a0a0: 6e64 6578 5472 616e 7366 6f72 6d61 7469  ndexTransformati
-0001a0b0: 6f6e 5072 6f67 7265 7373 2069 6e20 6372  onProgress in cr
-0001a0c0: 6561 7465 645f 6462 2e63 6c69 656e 745f  eated_db.client_
-0001a0d0: 636f 6e6e 6563 7469 6f6e 2e6c 6173 745f  connection.last_
-0001a0e0: 7265 7370 6f6e 7365 5f68 6561 6465 7273  response_headers
-0001a0f0: 290a 0a20 2020 2020 2020 2061 7761 6974  )..        await
-0001a100: 2063 7265 6174 6564 5f64 622e 6465 6c65   created_db.dele
-0001a110: 7465 5f63 6f6e 7461 696e 6572 2863 6f6e  te_container(con
-0001a120: 7369 7374 656e 745f 636f 6c6c 290a 2020  sistent_coll).  
-0001a130: 2020 2020 2020 6177 6169 7420 6372 6561        await crea
-0001a140: 7465 645f 6462 2e64 656c 6574 655f 636f  ted_db.delete_co
-0001a150: 6e74 6169 6e65 7228 6e6f 6e65 5f63 6f6c  ntainer(none_col
-0001a160: 6c29 0a0a 2020 2020 6173 796e 6320 6465  l)..    async de
-0001a170: 6620 7465 7374 5f69 645f 7661 6c69 6461  f test_id_valida
-0001a180: 7469 6f6e 2873 656c 6629 3a0a 2020 2020  tion(self):.    
-0001a190: 2020 2020 2320 4964 2073 686f 756c 646e      # Id shouldn
-0001a1a0: 2774 2065 6e64 2077 6974 6820 7370 6163  't end with spac
-0001a1b0: 652e 0a20 2020 2020 2020 2074 7279 3a0a  e..        try:.
-0001a1c0: 2020 2020 2020 2020 2020 2020 6177 6169              awai
-0001a1d0: 7420 7365 6c66 2e63 6c69 656e 742e 6372  t self.client.cr
-0001a1e0: 6561 7465 5f64 6174 6162 6173 6528 6964  eate_database(id
-0001a1f0: 3d27 6964 5f77 6974 685f 7370 6163 6520  ='id_with_space 
-0001a200: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
-0001a210: 656c 662e 6173 7365 7274 4661 6c73 6528  elf.assertFalse(
-0001a220: 5472 7565 290a 2020 2020 2020 2020 6578  True).        ex
-0001a230: 6365 7074 2056 616c 7565 4572 726f 7220  cept ValueError 
-0001a240: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0001a250: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001a260: 616c 2827 4964 2065 6e64 7320 7769 7468  al('Id ends with
-0001a270: 2061 2073 7061 6365 2e27 2c20 652e 6172   a space.', e.ar
-0001a280: 6773 5b30 5d29 0a20 2020 2020 2020 2023  gs[0]).        #
-0001a290: 2049 6420 7368 6f75 6c64 6e27 7420 636f   Id shouldn't co
-0001a2a0: 6e74 6169 6e20 272f 272e 0a0a 2020 2020  ntain '/'...    
-0001a2b0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0001a2c0: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
-0001a2d0: 636c 6965 6e74 2e63 7265 6174 655f 6461  client.create_da
-0001a2e0: 7461 6261 7365 2869 643d 2769 645f 7769  tabase(id='id_wi
-0001a2f0: 7468 5f69 6c6c 6567 616c 2f5f 6368 6172  th_illegal/_char
-0001a300: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
-0001a310: 656c 662e 6173 7365 7274 4661 6c73 6528  elf.assertFalse(
-0001a320: 5472 7565 290a 2020 2020 2020 2020 6578  True).        ex
-0001a330: 6365 7074 2056 616c 7565 4572 726f 7220  cept ValueError 
-0001a340: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0001a350: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001a360: 616c 2827 4964 2063 6f6e 7461 696e 7320  al('Id contains 
-0001a370: 696c 6c65 6761 6c20 6368 6172 732e 272c  illegal chars.',
-0001a380: 2065 2e61 7267 735b 305d 290a 2020 2020   e.args[0]).    
-0001a390: 2020 2020 2320 4964 2073 686f 756c 646e      # Id shouldn
-0001a3a0: 2774 2063 6f6e 7461 696e 2027 5c5c 272e  't contain '\\'.
-0001a3b0: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
-0001a3c0: 2020 2020 2020 2020 2020 2061 7761 6974             await
-0001a3d0: 2073 656c 662e 636c 6965 6e74 2e63 7265   self.client.cre
-0001a3e0: 6174 655f 6461 7461 6261 7365 2869 643d  ate_database(id=
-0001a3f0: 2769 645f 7769 7468 5f69 6c6c 6567 616c  'id_with_illegal
-0001a400: 5c5c 5f63 6861 7227 290a 2020 2020 2020  \\_char').      
-0001a410: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001a420: 7446 616c 7365 2854 7275 6529 0a20 2020  tFalse(True).   
-0001a430: 2020 2020 2065 7863 6570 7420 5661 6c75       except Valu
-0001a440: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-0001a450: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-0001a460: 7365 7274 4571 7561 6c28 2749 6420 636f  sertEqual('Id co
-0001a470: 6e74 6169 6e73 2069 6c6c 6567 616c 2063  ntains illegal c
-0001a480: 6861 7273 2e27 2c20 652e 6172 6773 5b30  hars.', e.args[0
-0001a490: 5d29 0a20 2020 2020 2020 2023 2049 6420  ]).        # Id 
-0001a4a0: 7368 6f75 6c64 6e27 7420 636f 6e74 6169  shouldn't contai
-0001a4b0: 6e20 273f 272e 0a0a 2020 2020 2020 2020  n '?'...        
-0001a4c0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001a4d0: 2061 7761 6974 2073 656c 662e 636c 6965   await self.clie
-0001a4e0: 6e74 2e63 7265 6174 655f 6461 7461 6261  nt.create_databa
-0001a4f0: 7365 2869 643d 2769 645f 7769 7468 5f69  se(id='id_with_i
-0001a500: 6c6c 6567 616c 3f5f 6368 6172 2729 0a20  llegal?_char'). 
-0001a510: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001a520: 6173 7365 7274 4661 6c73 6528 5472 7565  assertFalse(True
-0001a530: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-0001a540: 2056 616c 7565 4572 726f 7220 6173 2065   ValueError as e
-0001a550: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0001a560: 6c66 2e61 7373 6572 7445 7175 616c 2827  lf.assertEqual('
-0001a570: 4964 2063 6f6e 7461 696e 7320 696c 6c65  Id contains ille
-0001a580: 6761 6c20 6368 6172 732e 272c 2065 2e61  gal chars.', e.a
-0001a590: 7267 735b 305d 290a 2020 2020 2020 2020  rgs[0]).        
-0001a5a0: 2320 4964 2073 686f 756c 646e 2774 2063  # Id shouldn't c
-0001a5b0: 6f6e 7461 696e 2027 2327 2e0a 0a20 2020  ontain '#'...   
-0001a5c0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0001a5d0: 2020 2020 2020 6177 6169 7420 7365 6c66        await self
-0001a5e0: 2e63 6c69 656e 742e 6372 6561 7465 5f64  .client.create_d
-0001a5f0: 6174 6162 6173 6528 6964 3d27 6964 5f77  atabase(id='id_w
-0001a600: 6974 685f 696c 6c65 6761 6c23 5f63 6861  ith_illegal#_cha
-0001a610: 7227 290a 2020 2020 2020 2020 2020 2020  r').            
-0001a620: 7365 6c66 2e61 7373 6572 7446 616c 7365  self.assertFalse
-0001a630: 2854 7275 6529 0a20 2020 2020 2020 2065  (True).        e
-0001a640: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
-0001a650: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001a660: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0001a670: 7561 6c28 2749 6420 636f 6e74 6169 6e73  ual('Id contains
-0001a680: 2069 6c6c 6567 616c 2063 6861 7273 2e27   illegal chars.'
-0001a690: 2c20 652e 6172 6773 5b30 5d29 0a0a 2020  , e.args[0])..  
-0001a6a0: 2020 2020 2020 2320 4964 2063 616e 2062        # Id can b
-0001a6b0: 6567 696e 2077 6974 6820 7370 6163 650a  egin with space.
-0001a6c0: 2020 2020 2020 2020 6462 203d 2061 7761          db = awa
-0001a6d0: 6974 2073 656c 662e 636c 6965 6e74 2e63  it self.client.c
-0001a6e0: 7265 6174 655f 6461 7461 6261 7365 2869  reate_database(i
-0001a6f0: 643d 2720 6964 5f62 6567 696e 5f73 7061  d=' id_begin_spa
-0001a700: 6365 2729 0a20 2020 2020 2020 2073 656c  ce').        sel
-0001a710: 662e 6173 7365 7274 5472 7565 2854 7275  f.assertTrue(Tru
-0001a720: 6529 0a0a 2020 2020 2020 2020 6177 6169  e)..        awai
-0001a730: 7420 7365 6c66 2e63 6c69 656e 742e 6465  t self.client.de
-0001a740: 6c65 7465 5f64 6174 6162 6173 6528 6461  lete_database(da
-0001a750: 7461 6261 7365 3d64 6229 0a0a 2020 2020  tabase=db)..    
-0001a760: 6173 796e 6320 6465 6620 7465 7374 5f69  async def test_i
-0001a770: 645f 6361 7365 5f76 616c 6964 6174 696f  d_case_validatio
-0001a780: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
-0001a790: 2023 2063 7265 6174 6520 6461 7461 6261   # create databa
-0001a7a0: 7365 0a20 2020 2020 2020 2063 7265 6174  se.        creat
-0001a7b0: 6564 5f64 6220 3d20 7365 6c66 2e64 6174  ed_db = self.dat
-0001a7c0: 6162 6173 6546 6f72 5465 7374 0a0a 2020  abaseForTest..  
-0001a7d0: 2020 2020 2020 7575 6964 5f73 7472 696e        uuid_strin
-0001a7e0: 6720 3d20 7374 7228 7575 6964 2e75 7569  g = str(uuid.uui
-0001a7f0: 6434 2829 290a 2020 2020 2020 2020 636f  d4()).        co
-0001a800: 6c6c 6563 7469 6f6e 5f69 6431 203d 2027  llection_id1 = '
-0001a810: 7361 6d70 6c65 436f 6c6c 6563 7469 6f6e  sampleCollection
-0001a820: 2027 202b 2075 7569 645f 7374 7269 6e67   ' + uuid_string
-0001a830: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
-0001a840: 696f 6e5f 6964 3220 3d20 2753 616d 706c  ion_id2 = 'Sampl
-0001a850: 6543 6f6c 6c65 6374 696f 6e20 2720 2b20  eCollection ' + 
-0001a860: 7575 6964 5f73 7472 696e 670a 0a20 2020  uuid_string..   
-0001a870: 2020 2020 2023 2056 6572 6966 7920 7468       # Verify th
-0001a880: 6174 206e 6f20 636f 6c6c 6563 7469 6f6e  at no collection
-0001a890: 7320 6578 6973 740a 2020 2020 2020 2020  s exist.        
-0001a8a0: 636f 6c6c 6563 7469 6f6e 7320 3d20 5b63  collections = [c
-0001a8b0: 6f6c 6c65 6374 696f 6e20 6173 796e 6320  ollection async 
-0001a8c0: 666f 7220 636f 6c6c 6563 7469 6f6e 2069  for collection i
-0001a8d0: 6e20 6372 6561 7465 645f 6462 2e6c 6973  n created_db.lis
-0001a8e0: 745f 636f 6e74 6169 6e65 7273 2829 5d0a  t_containers()].
-0001a8f0: 2020 2020 2020 2020 6e75 6d62 6572 5f6f          number_o
-0001a900: 665f 6578 6973 7469 6e67 5f63 6f6c 6c65  f_existing_colle
-0001a910: 6374 696f 6e73 203d 206c 656e 2863 6f6c  ctions = len(col
-0001a920: 6c65 6374 696f 6e73 290a 0a20 2020 2020  lections)..     
-0001a930: 2020 2023 2063 7265 6174 6520 3220 636f     # create 2 co
-0001a940: 6c6c 6563 7469 6f6e 7320 7769 7468 2064  llections with d
-0001a950: 6966 6665 7265 6e74 2063 6173 696e 6720  ifferent casing 
-0001a960: 6f66 2049 4473 0a20 2020 2020 2020 2023  of IDs.        #
-0001a970: 2070 6173 6361 6c43 6173 650a 2020 2020   pascalCase.    
-0001a980: 2020 2020 6372 6561 7465 645f 636f 6c6c      created_coll
-0001a990: 6563 7469 6f6e 3120 3d20 6177 6169 7420  ection1 = await 
-0001a9a0: 6372 6561 7465 645f 6462 2e63 7265 6174  created_db.creat
-0001a9b0: 655f 636f 6e74 6169 6e65 7228 0a20 2020  e_container(.   
-0001a9c0: 2020 2020 2020 2020 2069 643d 636f 6c6c           id=coll
-0001a9d0: 6563 7469 6f6e 5f69 6431 2c0a 2020 2020  ection_id1,.    
-0001a9e0: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
-0001a9f0: 6e5f 6b65 793d 5061 7274 6974 696f 6e4b  n_key=PartitionK
-0001aa00: 6579 2870 6174 683d 272f 6964 272c 206b  ey(path='/id', k
-0001aa10: 696e 643d 2748 6173 6827 290a 2020 2020  ind='Hash').    
-0001aa20: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-0001aa30: 2043 616d 656c 4361 7365 0a20 2020 2020   CamelCase.     
-0001aa40: 2020 2063 7265 6174 6564 5f63 6f6c 6c65     created_colle
-0001aa50: 6374 696f 6e32 203d 2061 7761 6974 2063  ction2 = await c
-0001aa60: 7265 6174 6564 5f64 622e 6372 6561 7465  reated_db.create
-0001aa70: 5f63 6f6e 7461 696e 6572 280a 2020 2020  _container(.    
-0001aa80: 2020 2020 2020 2020 6964 3d63 6f6c 6c65          id=colle
-0001aa90: 6374 696f 6e5f 6964 322c 0a20 2020 2020  ction_id2,.     
-0001aaa0: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
-0001aab0: 5f6b 6579 3d50 6172 7469 7469 6f6e 4b65  _key=PartitionKe
-0001aac0: 7928 7061 7468 3d27 2f69 6427 2c20 6b69  y(path='/id', ki
-0001aad0: 6e64 3d27 4861 7368 2729 0a20 2020 2020  nd='Hash').     
-0001aae0: 2020 2029 0a0a 2020 2020 2020 2020 636f     )..        co
-0001aaf0: 6c6c 6563 7469 6f6e 7320 3d20 5b63 6f6c  llections = [col
-0001ab00: 6c65 6374 696f 6e20 6173 796e 6320 666f  lection async fo
-0001ab10: 7220 636f 6c6c 6563 7469 6f6e 2069 6e20  r collection in 
-0001ab20: 6372 6561 7465 645f 6462 2e6c 6973 745f  created_db.list_
-0001ab30: 636f 6e74 6169 6e65 7273 2829 5d0a 0a20  containers()].. 
-0001ab40: 2020 2020 2020 2023 2076 6572 6966 7920         # verify 
-0001ab50: 6966 2061 2074 6f74 616c 206f 6620 3220  if a total of 2 
-0001ab60: 636f 6c6c 6563 7469 6f6e 7320 676f 7420  collections got 
-0001ab70: 6372 6561 7465 640a 2020 2020 2020 2020  created.        
-0001ab80: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0001ab90: 286c 656e 2863 6f6c 6c65 6374 696f 6e73  (len(collections
-0001aba0: 292c 206e 756d 6265 725f 6f66 5f65 7869  ), number_of_exi
-0001abb0: 7374 696e 675f 636f 6c6c 6563 7469 6f6e  sting_collection
-0001abc0: 7320 2b20 3229 0a0a 2020 2020 2020 2020  s + 2)..        
-0001abd0: 2320 7665 7269 6679 2074 6861 7420 636f  # verify that co
-0001abe0: 6c6c 6563 7469 6f6e 7320 6172 6520 6372  llections are cr
-0001abf0: 6561 7465 6420 7769 7468 2073 7065 6369  eated with speci
-0001ac00: 6669 6564 2049 4473 0a20 2020 2020 2020  fied IDs.       
-0001ac10: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0001ac20: 6c28 636f 6c6c 6563 7469 6f6e 5f69 6431  l(collection_id1
-0001ac30: 2c20 6372 6561 7465 645f 636f 6c6c 6563  , created_collec
-0001ac40: 7469 6f6e 312e 6964 290a 2020 2020 2020  tion1.id).      
-0001ac50: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001ac60: 616c 2863 6f6c 6c65 6374 696f 6e5f 6964  al(collection_id
-0001ac70: 322c 2063 7265 6174 6564 5f63 6f6c 6c65  2, created_colle
-0001ac80: 6374 696f 6e32 2e69 6429 0a0a 2020 2020  ction2.id)..    
-0001ac90: 2020 2020 6177 6169 7420 6372 6561 7465      await create
-0001aca0: 645f 6462 2e64 656c 6574 655f 636f 6e74  d_db.delete_cont
-0001acb0: 6169 6e65 7228 6372 6561 7465 645f 636f  ainer(created_co
-0001acc0: 6c6c 6563 7469 6f6e 3129 0a20 2020 2020  llection1).     
-0001acd0: 2020 2061 7761 6974 2063 7265 6174 6564     await created
-0001ace0: 5f64 622e 6465 6c65 7465 5f63 6f6e 7461  _db.delete_conta
-0001acf0: 696e 6572 2863 7265 6174 6564 5f63 6f6c  iner(created_col
-0001ad00: 6c65 6374 696f 6e32 290a 0a20 2020 2061  lection2)..    a
-0001ad10: 7379 6e63 2064 6566 2074 6573 745f 6964  sync def test_id
-0001ad20: 5f75 6e69 636f 6465 5f76 616c 6964 6174  _unicode_validat
-0001ad30: 696f 6e28 7365 6c66 293a 0a20 2020 2020  ion(self):.     
-0001ad40: 2020 2023 2063 7265 6174 6520 6461 7461     # create data
-0001ad50: 6261 7365 0a20 2020 2020 2020 2063 7265  base.        cre
-0001ad60: 6174 6564 5f64 6220 3d20 7365 6c66 2e64  ated_db = self.d
-0001ad70: 6174 6162 6173 6546 6f72 5465 7374 0a0a  atabaseForTest..
-0001ad80: 2020 2020 2020 2020 2320 756e 6963 6f64          # unicod
-0001ad90: 6520 6368 6172 7320 696e 2048 696e 6469  e chars in Hindi
-0001ada0: 2066 6f72 2049 6420 7768 6963 6820 7472   for Id which tr
-0001adb0: 616e 736c 6174 6573 2074 6f3a 2022 4869  anslates to: "Hi
-0001adc0: 6e64 6920 6973 2074 6865 206e 6174 696f  ndi is the natio
-0001add0: 6e61 6c20 6c61 6e67 7561 6765 206f 6620  nal language of 
-0001ade0: 496e 6469 6122 0a20 2020 2020 2020 2063  India".        c
-0001adf0: 6f6c 6c65 6374 696f 6e5f 6964 3120 3d20  ollection_id1 = 
-0001ae00: 7527 e0a4 b9e0 a4bf e0a4 a8e0 a58d e0a4  u'..............
-0001ae10: a6e0 a580 20e0 a4ad e0a4 bee0 a4b0 e0a4  .... ...........
-0001ae20: a420 e0a4 95e0 a580 20e0 a4b0 e0a4 bee0  . ...... .......
-0001ae30: a4b7 e0a5 8de0 a49f e0a5 8de0 a4b0 e0a5  ................
-0001ae40: 80e0 a4af 20e0 a4ad e0a4 bee0 a4b7 e0a4  .... ...........
-0001ae50: be20 e0a4 b9e0 a588 2720 2320 6373 7065  . ......' # cspe
-0001ae60: 6c6c 3a64 6973 6162 6c65 2d6c 696e 650a  ll:disable-line.
-0001ae70: 0a20 2020 2020 2020 2023 2053 7065 6369  .        # Speci
-0001ae80: 616c 2063 6861 7273 2066 6f72 2049 640a  al chars for Id.
-0001ae90: 2020 2020 2020 2020 636f 6c6c 6563 7469          collecti
-0001aea0: 6f6e 5f69 6432 203d 2022 2140 2425 5e26  on_id2 = "!@$%^&
-0001aeb0: 2a28 292d 7e60 275f 5b5d 7b7d 7c3b 3a2c  *()-~`'_[]{}|;:,
-0001aec0: 2e3c 3e22 0a0a 2020 2020 2020 2020 2320  .<>"..        # 
-0001aed0: 7665 7269 6679 2074 6861 7420 636f 6c6c  verify that coll
-0001aee0: 6563 7469 6f6e 7320 6172 6520 6372 6561  ections are crea
-0001aef0: 7465 6420 7769 7468 2073 7065 6369 6669  ted with specifi
-0001af00: 6564 2049 4473 0a20 2020 2020 2020 2063  ed IDs.        c
-0001af10: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
-0001af20: 6e31 203d 2061 7761 6974 2063 7265 6174  n1 = await creat
-0001af30: 6564 5f64 622e 6372 6561 7465 5f63 6f6e  ed_db.create_con
-0001af40: 7461 696e 6572 280a 2020 2020 2020 2020  tainer(.        
-0001af50: 2020 2020 6964 3d63 6f6c 6c65 6374 696f      id=collectio
-0001af60: 6e5f 6964 312c 0a20 2020 2020 2020 2020  n_id1,.         
-0001af70: 2020 2070 6172 7469 7469 6f6e 5f6b 6579     partition_key
-0001af80: 3d50 6172 7469 7469 6f6e 4b65 7928 7061  =PartitionKey(pa
-0001af90: 7468 3d27 2f69 6427 2c20 6b69 6e64 3d27  th='/id', kind='
-0001afa0: 4861 7368 2729 0a20 2020 2020 2020 2029  Hash').        )
-0001afb0: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
-0001afc0: 5f63 6f6c 6c65 6374 696f 6e32 203d 2061  _collection2 = a
-0001afd0: 7761 6974 2063 7265 6174 6564 5f64 622e  wait created_db.
-0001afe0: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
-0001aff0: 280a 2020 2020 2020 2020 2020 2020 6964  (.            id
-0001b000: 3d63 6f6c 6c65 6374 696f 6e5f 6964 322c  =collection_id2,
-0001b010: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-0001b020: 7469 7469 6f6e 5f6b 6579 3d50 6172 7469  tition_key=Parti
-0001b030: 7469 6f6e 4b65 7928 7061 7468 3d27 2f69  tionKey(path='/i
-0001b040: 6427 2c20 6b69 6e64 3d27 4861 7368 2729  d', kind='Hash')
-0001b050: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001b060: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001b070: 7175 616c 2863 6f6c 6c65 6374 696f 6e5f  qual(collection_
-0001b080: 6964 312c 2063 7265 6174 6564 5f63 6f6c  id1, created_col
-0001b090: 6c65 6374 696f 6e31 2e69 6429 0a20 2020  lection1.id).   
-0001b0a0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001b0b0: 4571 7561 6c28 636f 6c6c 6563 7469 6f6e  Equal(collection
-0001b0c0: 5f69 6432 2c20 6372 6561 7465 645f 636f  _id2, created_co
-0001b0d0: 6c6c 6563 7469 6f6e 322e 6964 290a 0a20  llection2.id).. 
-0001b0e0: 2020 2020 2020 2063 7265 6174 6564 5f63         created_c
-0001b0f0: 6f6c 6c65 6374 696f 6e31 5f70 726f 7065  ollection1_prope
-0001b100: 7274 6965 7320 3d20 6177 6169 7420 6372  rties = await cr
-0001b110: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
-0001b120: 312e 7265 6164 2829 0a20 2020 2020 2020  1.read().       
-0001b130: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-0001b140: 696f 6e32 5f70 726f 7065 7274 6965 7320  ion2_properties 
-0001b150: 3d20 6177 6169 7420 6372 6561 7465 645f  = await created_
-0001b160: 636f 6c6c 6563 7469 6f6e 322e 7265 6164  collection2.read
-0001b170: 2829 0a0a 2020 2020 2020 2020 6177 6169  ()..        awai
-0001b180: 7420 6372 6561 7465 645f 6462 2e64 656c  t created_db.del
-0001b190: 6574 655f 636f 6e74 6169 6e65 7228 6372  ete_container(cr
-0001b1a0: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
-0001b1b0: 315f 7072 6f70 6572 7469 6573 290a 2020  1_properties).  
-0001b1c0: 2020 2020 2020 6177 6169 7420 6372 6561        await crea
-0001b1d0: 7465 645f 6462 2e64 656c 6574 655f 636f  ted_db.delete_co
-0001b1e0: 6e74 6169 6e65 7228 6372 6561 7465 645f  ntainer(created_
-0001b1f0: 636f 6c6c 6563 7469 6f6e 325f 7072 6f70  collection2_prop
-0001b200: 6572 7469 6573 290a 0a20 2020 2061 7379  erties)..    asy
-0001b210: 6e63 2064 6566 2074 6573 745f 6765 745f  nc def test_get_
-0001b220: 7265 736f 7572 6365 5f77 6974 685f 6469  resource_with_di
-0001b230: 6374 696f 6e61 7279 5f61 6e64 5f6f 626a  ctionary_and_obj
-0001b240: 6563 7428 7365 6c66 293a 0a20 2020 2020  ect(self):.     
-0001b250: 2020 2063 7265 6174 6564 5f64 6220 3d20     created_db = 
-0001b260: 7365 6c66 2e64 6174 6162 6173 6546 6f72  self.databaseFor
-0001b270: 5465 7374 0a0a 2020 2020 2020 2020 2320  Test..        # 
-0001b280: 7265 6164 2064 6174 6162 6173 6520 7769  read database wi
-0001b290: 7468 2069 640a 2020 2020 2020 2020 7265  th id.        re
-0001b2a0: 6164 5f64 6220 3d20 7365 6c66 2e63 6c69  ad_db = self.cli
-0001b2b0: 656e 742e 6765 745f 6461 7461 6261 7365  ent.get_database
-0001b2c0: 5f63 6c69 656e 7428 6372 6561 7465 645f  _client(created_
-0001b2d0: 6462 2e69 6429 0a20 2020 2020 2020 2073  db.id).        s
-0001b2e0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0001b2f0: 7265 6164 5f64 622e 6964 2c20 6372 6561  read_db.id, crea
-0001b300: 7465 645f 6462 2e69 6429 0a0a 2020 2020  ted_db.id)..    
-0001b310: 2020 2020 2320 7265 6164 2064 6174 6162      # read datab
-0001b320: 6173 6520 7769 7468 2069 6e73 7461 6e63  ase with instanc
-0001b330: 650a 2020 2020 2020 2020 7265 6164 5f64  e.        read_d
-0001b340: 6220 3d20 7365 6c66 2e63 6c69 656e 742e  b = self.client.
-0001b350: 6765 745f 6461 7461 6261 7365 5f63 6c69  get_database_cli
-0001b360: 656e 7428 6372 6561 7465 645f 6462 290a  ent(created_db).
-0001b370: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001b380: 6572 7445 7175 616c 2872 6561 645f 6462  ertEqual(read_db
-0001b390: 2e69 642c 2063 7265 6174 6564 5f64 622e  .id, created_db.
-0001b3a0: 6964 290a 0a20 2020 2020 2020 2023 2072  id)..        # r
-0001b3b0: 6561 6420 6461 7461 6261 7365 2077 6974  ead database wit
-0001b3c0: 6820 7072 6f70 6572 7469 6573 0a20 2020  h properties.   
-0001b3d0: 2020 2020 2072 6561 645f 6462 203d 2073       read_db = s
-0001b3e0: 656c 662e 636c 6965 6e74 2e67 6574 5f64  elf.client.get_d
-0001b3f0: 6174 6162 6173 655f 636c 6965 6e74 2861  atabase_client(a
-0001b400: 7761 6974 2063 7265 6174 6564 5f64 622e  wait created_db.
-0001b410: 7265 6164 2829 290a 2020 2020 2020 2020  read()).        
-0001b420: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0001b430: 2872 6561 645f 6462 2e69 642c 2063 7265  (read_db.id, cre
-0001b440: 6174 6564 5f64 622e 6964 290a 0a20 2020  ated_db.id)..   
-0001b450: 2020 2020 2063 7265 6174 6564 5f63 6f6e       created_con
-0001b460: 7461 696e 6572 203d 2061 7761 6974 2073  tainer = await s
-0001b470: 656c 662e 6461 7461 6261 7365 466f 7254  elf.databaseForT
-0001b480: 6573 742e 6372 6561 7465 5f63 6f6e 7461  est.create_conta
-0001b490: 696e 6572 2874 6573 745f 636f 6e66 6967  iner(test_config
-0001b4a0: 2e5f 7465 7374 5f63 6f6e 6669 672e 5445  ._test_config.TE
-0001b4b0: 5354 5f43 4f4c 4c45 4354 494f 4e5f 4d55  ST_COLLECTION_MU
-0001b4c0: 4c54 495f 5041 5254 4954 494f 4e2c 2050  LTI_PARTITION, P
-0001b4d0: 6172 7469 7469 6f6e 4b65 7928 7061 7468  artitionKey(path
-0001b4e0: 3d22 2f69 6422 2929 0a0a 2020 2020 2020  ="/id"))..      
-0001b4f0: 2020 2320 7265 6164 2063 6f6e 7461 696e    # read contain
-0001b500: 6572 2077 6974 6820 6964 0a20 2020 2020  er with id.     
-0001b510: 2020 2072 6561 645f 636f 6e74 6169 6e65     read_containe
-0001b520: 7220 3d20 6372 6561 7465 645f 6462 2e67  r = created_db.g
-0001b530: 6574 5f63 6f6e 7461 696e 6572 5f63 6c69  et_container_cli
-0001b540: 656e 7428 6372 6561 7465 645f 636f 6e74  ent(created_cont
-0001b550: 6169 6e65 722e 6964 290a 2020 2020 2020  ainer.id).      
-0001b560: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001b570: 616c 2872 6561 645f 636f 6e74 6169 6e65  al(read_containe
-0001b580: 722e 6964 2c20 6372 6561 7465 645f 636f  r.id, created_co
-0001b590: 6e74 6169 6e65 722e 6964 290a 0a20 2020  ntainer.id)..   
-0001b5a0: 2020 2020 2023 2072 6561 6420 636f 6e74       # read cont
-0001b5b0: 6169 6e65 7220 7769 7468 2069 6e73 7461  ainer with insta
-0001b5c0: 6e63 650a 2020 2020 2020 2020 7265 6164  nce.        read
-0001b5d0: 5f63 6f6e 7461 696e 6572 203d 2063 7265  _container = cre
-0001b5e0: 6174 6564 5f64 622e 6765 745f 636f 6e74  ated_db.get_cont
-0001b5f0: 6169 6e65 725f 636c 6965 6e74 2863 7265  ainer_client(cre
-0001b600: 6174 6564 5f63 6f6e 7461 696e 6572 290a  ated_container).
-0001b610: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001b620: 6572 7445 7175 616c 2872 6561 645f 636f  ertEqual(read_co
-0001b630: 6e74 6169 6e65 722e 6964 2c20 6372 6561  ntainer.id, crea
-0001b640: 7465 645f 636f 6e74 6169 6e65 722e 6964  ted_container.id
-0001b650: 290a 0a20 2020 2020 2020 2023 2072 6561  )..        # rea
-0001b660: 6420 636f 6e74 6169 6e65 7220 7769 7468  d container with
-0001b670: 2070 726f 7065 7274 6965 730a 2020 2020   properties.    
-0001b680: 2020 2020 6372 6561 7465 645f 7072 6f70      created_prop
-0001b690: 6572 7469 6573 203d 2061 7761 6974 2063  erties = await c
-0001b6a0: 7265 6174 6564 5f63 6f6e 7461 696e 6572  reated_container
-0001b6b0: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
-0001b6c0: 7265 6164 5f63 6f6e 7461 696e 6572 203d  read_container =
-0001b6d0: 2063 7265 6174 6564 5f64 622e 6765 745f   created_db.get_
-0001b6e0: 636f 6e74 6169 6e65 725f 636c 6965 6e74  container_client
-0001b6f0: 2863 7265 6174 6564 5f70 726f 7065 7274  (created_propert
-0001b700: 6965 7329 0a20 2020 2020 2020 2073 656c  ies).        sel
-0001b710: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-0001b720: 6164 5f63 6f6e 7461 696e 6572 2e69 642c  ad_container.id,
-0001b730: 2063 7265 6174 6564 5f63 6f6e 7461 696e   created_contain
-0001b740: 6572 2e69 6429 0a0a 2020 2020 2020 2020  er.id)..        
-0001b750: 6372 6561 7465 645f 6974 656d 203d 2061  created_item = a
-0001b760: 7761 6974 2063 7265 6174 6564 5f63 6f6e  wait created_con
-0001b770: 7461 696e 6572 2e63 7265 6174 655f 6974  tainer.create_it
-0001b780: 656d 287b 2769 6427 3a20 2731 2720 2b20  em({'id': '1' + 
-0001b790: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
-0001b7a0: 297d 290a 0a20 2020 2020 2020 2023 2072  )})..        # r
-0001b7b0: 6561 6420 6974 656d 2077 6974 6820 6964  ead item with id
-0001b7c0: 0a20 2020 2020 2020 2072 6561 645f 6974  .        read_it
-0001b7d0: 656d 203d 2061 7761 6974 2063 7265 6174  em = await creat
-0001b7e0: 6564 5f63 6f6e 7461 696e 6572 2e72 6561  ed_container.rea
-0001b7f0: 645f 6974 656d 2869 7465 6d3d 6372 6561  d_item(item=crea
-0001b800: 7465 645f 6974 656d 5b27 6964 275d 2c20  ted_item['id'], 
-0001b810: 7061 7274 6974 696f 6e5f 6b65 793d 6372  partition_key=cr
-0001b820: 6561 7465 645f 6974 656d 5b27 6964 275d  eated_item['id']
-0001b830: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0001b840: 7373 6572 7445 7175 616c 2872 6561 645f  ssertEqual(read_
-0001b850: 6974 656d 5b27 6964 275d 2c20 6372 6561  item['id'], crea
-0001b860: 7465 645f 6974 656d 5b27 6964 275d 290a  ted_item['id']).
-0001b870: 0a20 2020 2020 2020 2023 2072 6561 6420  .        # read 
-0001b880: 6974 656d 2077 6974 6820 7072 6f70 6572  item with proper
-0001b890: 7469 6573 0a20 2020 2020 2020 2072 6561  ties.        rea
-0001b8a0: 645f 6974 656d 203d 2061 7761 6974 2063  d_item = await c
-0001b8b0: 7265 6174 6564 5f63 6f6e 7461 696e 6572  reated_container
-0001b8c0: 2e72 6561 645f 6974 656d 2869 7465 6d3d  .read_item(item=
-0001b8d0: 6372 6561 7465 645f 6974 656d 2c20 7061  created_item, pa
-0001b8e0: 7274 6974 696f 6e5f 6b65 793d 6372 6561  rtition_key=crea
-0001b8f0: 7465 645f 6974 656d 5b27 6964 275d 290a  ted_item['id']).
-0001b900: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001b910: 6572 7445 7175 616c 2872 6561 645f 6974  ertEqual(read_it
-0001b920: 656d 5b27 6964 275d 2c20 6372 6561 7465  em['id'], create
-0001b930: 645f 6974 656d 5b27 6964 275d 290a 0a20  d_item['id']).. 
-0001b940: 2020 2020 2020 2063 7265 6174 6564 5f73         created_s
-0001b950: 7072 6f63 203d 2061 7761 6974 2063 7265  proc = await cre
-0001b960: 6174 6564 5f63 6f6e 7461 696e 6572 2e73  ated_container.s
-0001b970: 6372 6970 7473 2e63 7265 6174 655f 7374  cripts.create_st
-0001b980: 6f72 6564 5f70 726f 6365 6475 7265 287b  ored_procedure({
-0001b990: 0a20 2020 2020 2020 2020 2020 2027 6964  .            'id
-0001b9a0: 273a 2027 7374 6f72 6564 5072 6f63 6564  ': 'storedProced
-0001b9b0: 7572 6527 202b 2073 7472 2875 7569 642e  ure' + str(uuid.
-0001b9c0: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
-0001b9d0: 2020 2020 2020 2762 6f64 7927 3a20 2766        'body': 'f
-0001b9e0: 756e 6374 696f 6e20 2829 207b 207d 270a  unction () { }'.
-0001b9f0: 2020 2020 2020 2020 7d29 0a0a 2020 2020          })..    
-0001ba00: 2020 2020 2320 7265 6164 2073 7072 6f63      # read sproc
-0001ba10: 2077 6974 6820 6964 0a20 2020 2020 2020   with id.       
-0001ba20: 2072 6561 645f 7370 726f 6320 3d20 6177   read_sproc = aw
-0001ba30: 6169 7420 6372 6561 7465 645f 636f 6e74  ait created_cont
-0001ba40: 6169 6e65 722e 7363 7269 7074 732e 6765  ainer.scripts.ge
-0001ba50: 745f 7374 6f72 6564 5f70 726f 6365 6475  t_stored_procedu
-0001ba60: 7265 2863 7265 6174 6564 5f73 7072 6f63  re(created_sproc
-0001ba70: 5b27 6964 275d 290a 2020 2020 2020 2020  ['id']).        
-0001ba80: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0001ba90: 2872 6561 645f 7370 726f 635b 2769 6427  (read_sproc['id'
-0001baa0: 5d2c 2063 7265 6174 6564 5f73 7072 6f63  ], created_sproc
-0001bab0: 5b27 6964 275d 290a 0a20 2020 2020 2020  ['id'])..       
-0001bac0: 2023 2072 6561 6420 7370 726f 6320 7769   # read sproc wi
-0001bad0: 7468 2070 726f 7065 7274 6965 730a 2020  th properties.  
-0001bae0: 2020 2020 2020 7265 6164 5f73 7072 6f63        read_sproc
-0001baf0: 203d 2061 7761 6974 2063 7265 6174 6564   = await created
-0001bb00: 5f63 6f6e 7461 696e 6572 2e73 6372 6970  _container.scrip
-0001bb10: 7473 2e67 6574 5f73 746f 7265 645f 7072  ts.get_stored_pr
-0001bb20: 6f63 6564 7572 6528 6372 6561 7465 645f  ocedure(created_
-0001bb30: 7370 726f 6329 0a20 2020 2020 2020 2073  sproc).        s
-0001bb40: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0001bb50: 7265 6164 5f73 7072 6f63 5b27 6964 275d  read_sproc['id']
-0001bb60: 2c20 6372 6561 7465 645f 7370 726f 635b  , created_sproc[
-0001bb70: 2769 6427 5d29 0a0a 2020 2020 2020 2020  'id'])..        
-0001bb80: 6372 6561 7465 645f 7472 6967 6765 7220  created_trigger 
-0001bb90: 3d20 6177 6169 7420 6372 6561 7465 645f  = await created_
-0001bba0: 636f 6e74 6169 6e65 722e 7363 7269 7074  container.script
-0001bbb0: 732e 6372 6561 7465 5f74 7269 6767 6572  s.create_trigger
-0001bbc0: 287b 0a20 2020 2020 2020 2020 2020 2027  ({.            '
-0001bbd0: 6964 273a 2027 7361 6d70 6c65 2074 7269  id': 'sample tri
-0001bbe0: 6767 6572 2720 2b20 7374 7228 7575 6964  gger' + str(uuid
-0001bbf0: 2e75 7569 6434 2829 292c 0a20 2020 2020  .uuid4()),.     
-0001bc00: 2020 2020 2020 2027 7365 7276 6572 5363         'serverSc
-0001bc10: 7269 7074 273a 2027 6675 6e63 7469 6f6e  ript': 'function
-0001bc20: 2829 207b 7661 7220 7820 3d20 3130 3b7d  () {var x = 10;}
-0001bc30: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-0001bc40: 7472 6967 6765 7254 7970 6527 3a20 646f  triggerType': do
-0001bc50: 6375 6d65 6e74 732e 5472 6967 6765 7254  cuments.TriggerT
-0001bc60: 7970 652e 5072 652c 0a20 2020 2020 2020  ype.Pre,.       
-0001bc70: 2020 2020 2027 7472 6967 6765 724f 7065       'triggerOpe
-0001bc80: 7261 7469 6f6e 273a 2064 6f63 756d 656e  ration': documen
-0001bc90: 7473 2e54 7269 6767 6572 4f70 6572 6174  ts.TriggerOperat
-0001bca0: 696f 6e2e 416c 6c0a 2020 2020 2020 2020  ion.All.        
-0001bcb0: 7d29 0a0a 2020 2020 2020 2020 2320 7265  })..        # re
-0001bcc0: 6164 2074 7269 6767 6572 2077 6974 6820  ad trigger with 
-0001bcd0: 6964 0a20 2020 2020 2020 2072 6561 645f  id.        read_
-0001bce0: 7472 6967 6765 7220 3d20 6177 6169 7420  trigger = await 
-0001bcf0: 6372 6561 7465 645f 636f 6e74 6169 6e65  created_containe
-0001bd00: 722e 7363 7269 7074 732e 6765 745f 7472  r.scripts.get_tr
-0001bd10: 6967 6765 7228 6372 6561 7465 645f 7472  igger(created_tr
-0001bd20: 6967 6765 725b 2769 6427 5d29 0a20 2020  igger['id']).   
-0001bd30: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001bd40: 4571 7561 6c28 7265 6164 5f74 7269 6767  Equal(read_trigg
-0001bd50: 6572 5b27 6964 275d 2c20 6372 6561 7465  er['id'], create
-0001bd60: 645f 7472 6967 6765 725b 2769 6427 5d29  d_trigger['id'])
-0001bd70: 0a0a 2020 2020 2020 2020 2320 7265 6164  ..        # read
-0001bd80: 2074 7269 6767 6572 2077 6974 6820 7072   trigger with pr
-0001bd90: 6f70 6572 7469 6573 0a20 2020 2020 2020  operties.       
-0001bda0: 2072 6561 645f 7472 6967 6765 7220 3d20   read_trigger = 
-0001bdb0: 6177 6169 7420 6372 6561 7465 645f 636f  await created_co
-0001bdc0: 6e74 6169 6e65 722e 7363 7269 7074 732e  ntainer.scripts.
-0001bdd0: 6765 745f 7472 6967 6765 7228 6372 6561  get_trigger(crea
-0001bde0: 7465 645f 7472 6967 6765 7229 0a20 2020  ted_trigger).   
-0001bdf0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001be00: 4571 7561 6c28 7265 6164 5f74 7269 6767  Equal(read_trigg
-0001be10: 6572 5b27 6964 275d 2c20 6372 6561 7465  er['id'], create
-0001be20: 645f 7472 6967 6765 725b 2769 6427 5d29  d_trigger['id'])
-0001be30: 0a0a 2020 2020 2020 2020 6372 6561 7465  ..        create
-0001be40: 645f 7564 6620 3d20 6177 6169 7420 6372  d_udf = await cr
-0001be50: 6561 7465 645f 636f 6e74 6169 6e65 722e  eated_container.
-0001be60: 7363 7269 7074 732e 6372 6561 7465 5f75  scripts.create_u
-0001be70: 7365 725f 6465 6669 6e65 645f 6675 6e63  ser_defined_func
-0001be80: 7469 6f6e 287b 0a20 2020 2020 2020 2020  tion({.         
-0001be90: 2020 2027 6964 273a 2027 7361 6d70 6c65     'id': 'sample
-0001bea0: 2075 6466 2720 2b20 7374 7228 7575 6964   udf' + str(uuid
-0001beb0: 2e75 7569 6434 2829 292c 0a20 2020 2020  .uuid4()),.     
-0001bec0: 2020 2020 2020 2027 626f 6479 273a 2027         'body': '
-0001bed0: 6675 6e63 7469 6f6e 2829 207b 7661 7220  function() {var 
-0001bee0: 7820 3d20 3130 3b7d 270a 2020 2020 2020  x = 10;}'.      
-0001bef0: 2020 7d29 0a0a 2020 2020 2020 2020 2320    })..        # 
-0001bf00: 7265 6164 2075 6466 2077 6974 6820 6964  read udf with id
-0001bf10: 0a20 2020 2020 2020 2072 6561 645f 7564  .        read_ud
-0001bf20: 6620 3d20 6177 6169 7420 6372 6561 7465  f = await create
-0001bf30: 645f 636f 6e74 6169 6e65 722e 7363 7269  d_container.scri
-0001bf40: 7074 732e 6765 745f 7573 6572 5f64 6566  pts.get_user_def
-0001bf50: 696e 6564 5f66 756e 6374 696f 6e28 6372  ined_function(cr
-0001bf60: 6561 7465 645f 7564 665b 2769 6427 5d29  eated_udf['id'])
-0001bf70: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0001bf80: 7365 7274 4571 7561 6c28 6372 6561 7465  sertEqual(create
-0001bf90: 645f 7564 665b 2769 6427 5d2c 2072 6561  d_udf['id'], rea
-0001bfa0: 645f 7564 665b 2769 6427 5d29 0a0a 2020  d_udf['id'])..  
-0001bfb0: 2020 2020 2020 2320 7265 6164 2075 6466        # read udf
-0001bfc0: 2077 6974 6820 7072 6f70 6572 7469 6573   with properties
-0001bfd0: 0a20 2020 2020 2020 2072 6561 645f 7564  .        read_ud
-0001bfe0: 6620 3d20 6177 6169 7420 6372 6561 7465  f = await create
-0001bff0: 645f 636f 6e74 6169 6e65 722e 7363 7269  d_container.scri
-0001c000: 7074 732e 6765 745f 7573 6572 5f64 6566  pts.get_user_def
-0001c010: 696e 6564 5f66 756e 6374 696f 6e28 6372  ined_function(cr
-0001c020: 6561 7465 645f 7564 6629 0a20 2020 2020  eated_udf).     
-0001c030: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0001c040: 7561 6c28 6372 6561 7465 645f 7564 665b  ual(created_udf[
-0001c050: 2769 6427 5d2c 2072 6561 645f 7564 665b  'id'], read_udf[
-0001c060: 2769 6427 5d29 0a0a 2020 2020 2020 2020  'id'])..        
-0001c070: 6372 6561 7465 645f 7573 6572 203d 2061  created_user = a
-0001c080: 7761 6974 2063 7265 6174 6564 5f64 622e  wait created_db.
-0001c090: 6372 6561 7465 5f75 7365 7228 7b0a 2020  create_user({.  
-0001c0a0: 2020 2020 2020 2020 2020 2769 6427 3a20            'id': 
-0001c0b0: 2775 7365 7227 202b 2073 7472 2875 7569  'user' + str(uui
-0001c0c0: 642e 7575 6964 3428 2929 0a20 2020 2020  d.uuid4()).     
-0001c0d0: 2020 207d 290a 0a20 2020 2020 2020 2023     })..        #
-0001c0e0: 2072 6561 6420 7573 6572 2077 6974 6820   read user with 
-0001c0f0: 6964 0a20 2020 2020 2020 2072 6561 645f  id.        read_
-0001c100: 7573 6572 203d 2063 7265 6174 6564 5f64  user = created_d
-0001c110: 622e 6765 745f 7573 6572 5f63 6c69 656e  b.get_user_clien
-0001c120: 7428 6372 6561 7465 645f 7573 6572 2e69  t(created_user.i
-0001c130: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
-0001c140: 6173 7365 7274 4571 7561 6c28 7265 6164  assertEqual(read
-0001c150: 5f75 7365 722e 6964 2c20 6372 6561 7465  _user.id, create
-0001c160: 645f 7573 6572 2e69 6429 0a0a 2020 2020  d_user.id)..    
-0001c170: 2020 2020 2320 7265 6164 2075 7365 7220      # read user 
-0001c180: 7769 7468 2069 6e73 7461 6e63 650a 2020  with instance.  
-0001c190: 2020 2020 2020 7265 6164 5f75 7365 7220        read_user 
-0001c1a0: 3d20 6372 6561 7465 645f 6462 2e67 6574  = created_db.get
-0001c1b0: 5f75 7365 725f 636c 6965 6e74 2863 7265  _user_client(cre
-0001c1c0: 6174 6564 5f75 7365 7229 0a20 2020 2020  ated_user).     
-0001c1d0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0001c1e0: 7561 6c28 7265 6164 5f75 7365 722e 6964  ual(read_user.id
-0001c1f0: 2c20 6372 6561 7465 645f 7573 6572 2e69  , created_user.i
-0001c200: 6429 0a0a 2020 2020 2020 2020 2320 7265  d)..        # re
-0001c210: 6164 2075 7365 7220 7769 7468 2070 726f  ad user with pro
-0001c220: 7065 7274 6965 730a 2020 2020 2020 2020  perties.        
-0001c230: 6372 6561 7465 645f 7573 6572 5f70 726f  created_user_pro
-0001c240: 7065 7274 6965 7320 3d20 6177 6169 7420  perties = await 
-0001c250: 6372 6561 7465 645f 7573 6572 2e72 6561  created_user.rea
-0001c260: 6428 290a 2020 2020 2020 2020 7265 6164  d().        read
-0001c270: 5f75 7365 7220 3d20 6372 6561 7465 645f  _user = created_
-0001c280: 6462 2e67 6574 5f75 7365 725f 636c 6965  db.get_user_clie
-0001c290: 6e74 2863 7265 6174 6564 5f75 7365 725f  nt(created_user_
-0001c2a0: 7072 6f70 6572 7469 6573 290a 2020 2020  properties).    
-0001c2b0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001c2c0: 7175 616c 2872 6561 645f 7573 6572 2e69  qual(read_user.i
-0001c2d0: 642c 2063 7265 6174 6564 5f75 7365 722e  d, created_user.
-0001c2e0: 6964 290a 0a20 2020 2020 2020 2063 7265  id)..        cre
-0001c2f0: 6174 6564 5f70 6572 6d69 7373 696f 6e20  ated_permission 
-0001c300: 3d20 6177 6169 7420 6372 6561 7465 645f  = await created_
-0001c310: 7573 6572 2e63 7265 6174 655f 7065 726d  user.create_perm
-0001c320: 6973 7369 6f6e 287b 0a20 2020 2020 2020  ission({.       
-0001c330: 2020 2020 2027 6964 273a 2027 616c 6c20       'id': 'all 
-0001c340: 7065 726d 6973 7369 6f6e 2720 2b20 7374  permission' + st
-0001c350: 7228 7575 6964 2e75 7569 6434 2829 292c  r(uuid.uuid4()),
-0001c360: 0a20 2020 2020 2020 2020 2020 2027 7065  .            'pe
-0001c370: 726d 6973 7369 6f6e 4d6f 6465 273a 2064  rmissionMode': d
-0001c380: 6f63 756d 656e 7473 2e50 6572 6d69 7373  ocuments.Permiss
-0001c390: 696f 6e4d 6f64 652e 416c 6c2c 0a20 2020  ionMode.All,.   
-0001c3a0: 2020 2020 2020 2020 2027 7265 736f 7572           'resour
-0001c3b0: 6365 273a 2063 7265 6174 6564 5f63 6f6e  ce': created_con
-0001c3c0: 7461 696e 6572 2e63 6f6e 7461 696e 6572  tainer.container
-0001c3d0: 5f6c 696e 6b2c 0a20 2020 2020 2020 2020  _link,.         
-0001c3e0: 2020 2027 7265 736f 7572 6365 5061 7274     'resourcePart
-0001c3f0: 6974 696f 6e4b 6579 273a 205b 315d 0a20  itionKey': [1]. 
-0001c400: 2020 2020 2020 207d 290a 0a20 2020 2020         })..     
-0001c410: 2020 2023 2072 6561 6420 7065 726d 6973     # read permis
-0001c420: 7369 6f6e 2077 6974 6820 6964 0a20 2020  sion with id.   
-0001c430: 2020 2020 2072 6561 645f 7065 726d 6973       read_permis
-0001c440: 7369 6f6e 203d 2061 7761 6974 2063 7265  sion = await cre
-0001c450: 6174 6564 5f75 7365 722e 6765 745f 7065  ated_user.get_pe
-0001c460: 726d 6973 7369 6f6e 2863 7265 6174 6564  rmission(created
-0001c470: 5f70 6572 6d69 7373 696f 6e2e 6964 290a  _permission.id).
-0001c480: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001c490: 6572 7445 7175 616c 2872 6561 645f 7065  ertEqual(read_pe
-0001c4a0: 726d 6973 7369 6f6e 2e69 642c 2063 7265  rmission.id, cre
-0001c4b0: 6174 6564 5f70 6572 6d69 7373 696f 6e2e  ated_permission.
-0001c4c0: 6964 290a 0a20 2020 2020 2020 2023 2072  id)..        # r
-0001c4d0: 6561 6420 7065 726d 6973 7369 6f6e 2077  ead permission w
-0001c4e0: 6974 6820 696e 7374 616e 6365 0a20 2020  ith instance.   
-0001c4f0: 2020 2020 2072 6561 645f 7065 726d 6973       read_permis
-0001c500: 7369 6f6e 203d 2061 7761 6974 2063 7265  sion = await cre
-0001c510: 6174 6564 5f75 7365 722e 6765 745f 7065  ated_user.get_pe
-0001c520: 726d 6973 7369 6f6e 2863 7265 6174 6564  rmission(created
-0001c530: 5f70 6572 6d69 7373 696f 6e29 0a20 2020  _permission).   
-0001c540: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001c550: 4571 7561 6c28 7265 6164 5f70 6572 6d69  Equal(read_permi
-0001c560: 7373 696f 6e2e 6964 2c20 6372 6561 7465  ssion.id, create
-0001c570: 645f 7065 726d 6973 7369 6f6e 2e69 6429  d_permission.id)
-0001c580: 0a0a 2020 2020 2020 2020 2320 7265 6164  ..        # read
-0001c590: 2070 6572 6d69 7373 696f 6e20 7769 7468   permission with
-0001c5a0: 2070 726f 7065 7274 6965 730a 2020 2020   properties.    
-0001c5b0: 2020 2020 7265 6164 5f70 6572 6d69 7373      read_permiss
-0001c5c0: 696f 6e20 3d20 6177 6169 7420 6372 6561  ion = await crea
-0001c5d0: 7465 645f 7573 6572 2e67 6574 5f70 6572  ted_user.get_per
-0001c5e0: 6d69 7373 696f 6e28 6372 6561 7465 645f  mission(created_
-0001c5f0: 7065 726d 6973 7369 6f6e 2e70 726f 7065  permission.prope
-0001c600: 7274 6965 7329 0a20 2020 2020 2020 2073  rties).        s
-0001c610: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0001c620: 7265 6164 5f70 6572 6d69 7373 696f 6e2e  read_permission.
-0001c630: 6964 2c20 6372 6561 7465 645f 7065 726d  id, created_perm
-0001c640: 6973 7369 6f6e 2e69 6429 0a0a 2020 2020  ission.id)..    
-0001c650: 2320 5465 6d70 6f72 6172 696c 7920 636f  # Temporarily co
-0001c660: 6d6d 656e 7469 6e67 2061 6e61 6c79 7469  mmenting analyti
-0001c670: 6361 6c20 7374 6f72 6167 6520 7465 7374  cal storage test
-0001c680: 7320 756e 7469 6c20 656d 756c 6174 6f72  s until emulator
-0001c690: 2073 7570 706f 7274 2063 6f6d 6573 2e0a   support comes..
-0001c6a0: 2020 2020 2320 6465 6620 7465 7374 5f63      # def test_c
-0001c6b0: 7265 6174 655f 636f 6e74 6169 6e65 725f  reate_container_
-0001c6c0: 7769 7468 5f61 6e61 6c79 7469 6361 6c5f  with_analytical_
-0001c6d0: 7374 6f72 655f 6f66 6628 7365 6c66 293a  store_off(self):
-0001c6e0: 0a20 2020 2023 2020 2020 2023 2064 6f6e  .    #     # don
-0001c6f0: 2774 2072 756e 2074 6573 742c 2066 6f72  't run test, for
-0001c700: 2074 6865 2074 696d 6520 6265 696e 672c   the time being,
-0001c710: 2069 6620 7275 6e6e 696e 6720 6167 6169   if running agai
-0001c720: 6e73 7420 7468 6520 656d 756c 6174 6f72  nst the emulator
-0001c730: 0a20 2020 2023 2020 2020 2069 6620 276c  .    #     if 'l
-0001c740: 6f63 616c 686f 7374 2720 696e 2073 656c  ocalhost' in sel
-0001c750: 662e 686f 7374 206f 7220 2731 3237 2e30  f.host or '127.0
-0001c760: 2e30 2e31 2720 696e 2073 656c 662e 686f  .0.1' in self.ho
-0001c770: 7374 3a0a 2020 2020 2320 2020 2020 2020  st:.    #       
-0001c780: 2020 7265 7475 726e 0a0a 2020 2020 2320    return..    # 
-0001c790: 2020 2020 6372 6561 7465 645f 6462 203d      created_db =
-0001c7a0: 2073 656c 662e 6461 7461 6261 7365 466f   self.databaseFo
-0001c7b0: 7254 6573 740a 2020 2020 2320 2020 2020  rTest.    #     
-0001c7c0: 636f 6c6c 6563 7469 6f6e 5f69 6420 3d20  collection_id = 
-0001c7d0: 2774 6573 745f 6372 6561 7465 5f63 6f6e  'test_create_con
-0001c7e0: 7461 696e 6572 5f77 6974 685f 616e 616c  tainer_with_anal
-0001c7f0: 7974 6963 616c 5f73 746f 7265 5f6f 6666  ytical_store_off
-0001c800: 5f27 202b 2073 7472 2875 7569 642e 7575  _' + str(uuid.uu
-0001c810: 6964 3428 2929 0a20 2020 2023 2020 2020  id4()).    #    
-0001c820: 2063 6f6c 6c65 6374 696f 6e5f 696e 6465   collection_inde
-0001c830: 7869 6e67 5f70 6f6c 6963 7920 3d20 7b27  xing_policy = {'
-0001c840: 696e 6465 7869 6e67 4d6f 6465 273a 2027  indexingMode': '
-0001c850: 636f 6e73 6973 7465 6e74 277d 0a20 2020  consistent'}.   
-0001c860: 2023 2020 2020 2063 7265 6174 6564 5f72   #     created_r
-0001c870: 6563 6f72 6465 7220 3d20 5265 636f 7264  ecorder = Record
-0001c880: 4469 6167 6e6f 7374 6963 7328 290a 2020  Diagnostics().  
-0001c890: 2020 2320 2020 2020 6372 6561 7465 645f    #     created_
-0001c8a0: 636f 6c6c 6563 7469 6f6e 203d 2063 7265  collection = cre
-0001c8b0: 6174 6564 5f64 622e 6372 6561 7465 5f63  ated_db.create_c
-0001c8c0: 6f6e 7461 696e 6572 2869 643d 636f 6c6c  ontainer(id=coll
-0001c8d0: 6563 7469 6f6e 5f69 642c 0a20 2020 2023  ection_id,.    #
-0001c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c910: 2020 2020 2020 696e 6465 7869 6e67 5f70        indexing_p
-0001c920: 6f6c 6963 793d 636f 6c6c 6563 7469 6f6e  olicy=collection
-0001c930: 5f69 6e64 6578 696e 675f 706f 6c69 6379  _indexing_policy
-0001c940: 2c0a 2020 2020 2320 2020 2020 2020 2020  ,.    #         
-0001c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c970: 2020 2020 2020 2020 2020 2020 2070 6172               par
-0001c980: 7469 7469 6f6e 5f6b 6579 3d50 6172 7469  tition_key=Parti
-0001c990: 7469 6f6e 4b65 7928 7061 7468 3d22 2f70  tionKey(path="/p
-0001c9a0: 6b22 2c20 6b69 6e64 3d22 4861 7368 2229  k", kind="Hash")
-0001c9b0: 2c20 0a20 2020 2023 2020 2020 2020 2020  , .    #        
-0001c9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001c9f0: 7370 6f6e 7365 5f68 6f6f 6b3d 6372 6561  sponse_hook=crea
-0001ca00: 7465 645f 7265 636f 7264 6572 290a 2020  ted_recorder).  
-0001ca10: 2020 2320 2020 2020 7072 6f70 6572 7469    #     properti
-0001ca20: 6573 203d 2063 7265 6174 6564 5f63 6f6c  es = created_col
-0001ca30: 6c65 6374 696f 6e2e 7265 6164 2829 0a20  lection.read(). 
-0001ca40: 2020 2023 2020 2020 2074 746c 5f6b 6579     #     ttl_key
-0001ca50: 203d 2022 616e 616c 7974 6963 616c 5374   = "analyticalSt
-0001ca60: 6f72 6167 6554 746c 220a 2020 2020 2320  orageTtl".    # 
-0001ca70: 2020 2020 7365 6c66 2e61 7373 6572 7454      self.assertT
-0001ca80: 7275 6528 7474 6c5f 6b65 7920 6e6f 7420  rue(ttl_key not 
-0001ca90: 696e 2070 726f 7065 7274 6965 7320 6f72  in properties or
-0001caa0: 2070 726f 7065 7274 6965 735b 7474 6c5f   properties[ttl_
-0001cab0: 6b65 795d 203d 3d20 4e6f 6e65 290a 0a20  key] == None).. 
-0001cac0: 2020 2023 2064 6566 2074 6573 745f 6372     # def test_cr
-0001cad0: 6561 7465 5f63 6f6e 7461 696e 6572 5f77  eate_container_w
-0001cae0: 6974 685f 616e 616c 7974 6963 616c 5f73  ith_analytical_s
-0001caf0: 746f 7265 5f6f 6e28 7365 6c66 293a 0a20  tore_on(self):. 
-0001cb00: 2020 2023 2020 2020 2023 2064 6f6e 2774     #     # don't
-0001cb10: 2072 756e 2074 6573 742c 2066 6f72 2074   run test, for t
-0001cb20: 6865 2074 696d 6520 6265 696e 672c 2069  he time being, i
-0001cb30: 6620 7275 6e6e 696e 6720 6167 6169 6e73  f running agains
-0001cb40: 7420 7468 6520 656d 756c 6174 6f72 0a20  t the emulator. 
-0001cb50: 2020 2023 2020 2020 2069 6620 276c 6f63     #     if 'loc
-0001cb60: 616c 686f 7374 2720 696e 2073 656c 662e  alhost' in self.
-0001cb70: 686f 7374 206f 7220 2731 3237 2e30 2e30  host or '127.0.0
-0001cb80: 2e31 2720 696e 2073 656c 662e 686f 7374  .1' in self.host
-0001cb90: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
-0001cba0: 7265 7475 726e 0a0a 2020 2020 2320 2020  return..    #   
-0001cbb0: 2020 6372 6561 7465 645f 6462 203d 2073    created_db = s
-0001cbc0: 656c 662e 6461 7461 6261 7365 466f 7254  elf.databaseForT
-0001cbd0: 6573 740a 2020 2020 2320 2020 2020 636f  est.    #     co
-0001cbe0: 6c6c 6563 7469 6f6e 5f69 6420 3d20 2774  llection_id = 't
-0001cbf0: 6573 745f 6372 6561 7465 5f63 6f6e 7461  est_create_conta
-0001cc00: 696e 6572 5f77 6974 685f 616e 616c 7974  iner_with_analyt
-0001cc10: 6963 616c 5f73 746f 7265 5f6f 6e5f 2720  ical_store_on_' 
-0001cc20: 2b20 7374 7228 7575 6964 2e75 7569 6434  + str(uuid.uuid4
-0001cc30: 2829 290a 2020 2020 2320 2020 2020 636f  ()).    #     co
-0001cc40: 6c6c 6563 7469 6f6e 5f69 6e64 6578 696e  llection_indexin
-0001cc50: 675f 706f 6c69 6379 203d 207b 2769 6e64  g_policy = {'ind
-0001cc60: 6578 696e 674d 6f64 6527 3a20 2763 6f6e  exingMode': 'con
-0001cc70: 7369 7374 656e 7427 7d0a 2020 2020 2320  sistent'}.    # 
-0001cc80: 2020 2020 6372 6561 7465 645f 7265 636f      created_reco
-0001cc90: 7264 6572 203d 2052 6563 6f72 6444 6961  rder = RecordDia
-0001cca0: 676e 6f73 7469 6373 2829 0a20 2020 2023  gnostics().    #
-0001ccb0: 2020 2020 2063 7265 6174 6564 5f63 6f6c       created_col
-0001ccc0: 6c65 6374 696f 6e20 3d20 6372 6561 7465  lection = create
-0001ccd0: 645f 6462 2e63 7265 6174 655f 636f 6e74  d_db.create_cont
-0001cce0: 6169 6e65 7228 6964 3d63 6f6c 6c65 6374  ainer(id=collect
-0001ccf0: 696f 6e5f 6964 2c0a 2020 2020 2320 2020  ion_id,.    #   
-0001cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd30: 2020 2061 6e61 6c79 7469 6361 6c5f 7374     analytical_st
-0001cd40: 6f72 6167 655f 7474 6c3d 2d31 2c0a 2020  orage_ttl=-1,.  
-0001cd50: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0001cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd80: 2020 2020 2020 2020 2069 6e64 6578 696e           indexin
-0001cd90: 675f 706f 6c69 6379 3d63 6f6c 6c65 6374  g_policy=collect
-0001cda0: 696f 6e5f 696e 6465 7869 6e67 5f70 6f6c  ion_indexing_pol
-0001cdb0: 6963 792c 0a20 2020 2023 2020 2020 2020  icy,.    #      
-0001cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdf0: 7061 7274 6974 696f 6e5f 6b65 793d 5061  partition_key=Pa
-0001ce00: 7274 6974 696f 6e4b 6579 2870 6174 683d  rtitionKey(path=
-0001ce10: 222f 706b 222c 206b 696e 643d 2248 6173  "/pk", kind="Has
-0001ce20: 6822 292c 200a 2020 2020 2320 2020 2020  h"), .    #     
-0001ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce60: 2072 6573 706f 6e73 655f 686f 6f6b 3d63   response_hook=c
-0001ce70: 7265 6174 6564 5f72 6563 6f72 6465 7229  reated_recorder)
-0001ce80: 0a20 2020 2023 2020 2020 2070 726f 7065  .    #     prope
-0001ce90: 7274 6965 7320 3d20 6372 6561 7465 645f  rties = created_
-0001cea0: 636f 6c6c 6563 7469 6f6e 2e72 6561 6428  collection.read(
-0001ceb0: 290a 2020 2020 2320 2020 2020 7474 6c5f  ).    #     ttl_
-0001cec0: 6b65 7920 3d20 2261 6e61 6c79 7469 6361  key = "analytica
-0001ced0: 6c53 746f 7261 6765 5474 6c22 0a20 2020  lStorageTtl".   
-0001cee0: 2023 2020 2020 2073 656c 662e 6173 7365   #     self.asse
-0001cef0: 7274 5472 7565 2874 746c 5f6b 6579 2069  rtTrue(ttl_key i
-0001cf00: 6e20 7072 6f70 6572 7469 6573 2061 6e64  n properties and
-0001cf10: 2070 726f 7065 7274 6965 735b 7474 6c5f   properties[ttl_
-0001cf20: 6b65 795d 203d 3d20 2d31 290a 0a20 2020  key] == -1)..   
-0001cf30: 2023 2064 6566 2074 6573 745f 6372 6561   # def test_crea
-0001cf40: 7465 5f63 6f6e 7461 696e 6572 5f69 665f  te_container_if_
-0001cf50: 6e6f 745f 6578 6973 7473 5f77 6974 685f  not_exists_with_
-0001cf60: 616e 616c 7974 6963 616c 5f73 746f 7265  analytical_store
-0001cf70: 5f6f 6e28 7365 6c66 293a 0a20 2020 2023  _on(self):.    #
-0001cf80: 2020 2020 2023 2064 6f6e 2774 2072 756e       # don't run
-0001cf90: 2074 6573 742c 2066 6f72 2074 6865 2074   test, for the t
-0001cfa0: 696d 6520 6265 696e 672c 2069 6620 7275  ime being, if ru
-0001cfb0: 6e6e 696e 6720 6167 6169 6e73 7420 7468  nning against th
-0001cfc0: 6520 656d 756c 6174 6f72 0a20 2020 2023  e emulator.    #
-0001cfd0: 2020 2020 2069 6620 276c 6f63 616c 686f       if 'localho
-0001cfe0: 7374 2720 696e 2073 656c 662e 686f 7374  st' in self.host
-0001cff0: 206f 7220 2731 3237 2e30 2e30 2e31 2720   or '127.0.0.1' 
-0001d000: 696e 2073 656c 662e 686f 7374 3a0a 2020  in self.host:.  
-0001d010: 2020 2320 2020 2020 2020 2020 7265 7475    #         retu
-0001d020: 726e 0a0a 2020 2020 2320 2020 2020 2320  rn..    #     # 
-0001d030: 6669 7273 742c 2074 7279 2077 6865 6e20  first, try when 
-0001d040: 7765 206b 6e6f 7720 7468 6520 636f 6e74  we know the cont
-0001d050: 6169 6e65 7220 646f 6573 6e27 7420 6578  ainer doesn't ex
-0001d060: 6973 742e 0a20 2020 2023 2020 2020 2063  ist..    #     c
-0001d070: 7265 6174 6564 5f64 6220 3d20 7365 6c66  reated_db = self
-0001d080: 2e64 6174 6162 6173 6546 6f72 5465 7374  .databaseForTest
-0001d090: 0a20 2020 2023 2020 2020 2063 6f6c 6c65  .    #     colle
-0001d0a0: 6374 696f 6e5f 6964 203d 2027 7465 7374  ction_id = 'test
-0001d0b0: 5f63 7265 6174 655f 636f 6e74 6169 6e65  _create_containe
-0001d0c0: 725f 6966 5f6e 6f74 5f65 7869 7374 735f  r_if_not_exists_
-0001d0d0: 7769 7468 5f61 6e61 6c79 7469 6361 6c5f  with_analytical_
-0001d0e0: 7374 6f72 655f 6f6e 5f27 202b 2073 7472  store_on_' + str
-0001d0f0: 2875 7569 642e 7575 6964 3428 2929 0a20  (uuid.uuid4()). 
-0001d100: 2020 2023 2020 2020 2063 6f6c 6c65 6374     #     collect
-0001d110: 696f 6e5f 696e 6465 7869 6e67 5f70 6f6c  ion_indexing_pol
-0001d120: 6963 7920 3d20 7b27 696e 6465 7869 6e67  icy = {'indexing
-0001d130: 4d6f 6465 273a 2027 636f 6e73 6973 7465  Mode': 'consiste
-0001d140: 6e74 277d 0a20 2020 2023 2020 2020 2063  nt'}.    #     c
-0001d150: 7265 6174 6564 5f72 6563 6f72 6465 7220  reated_recorder 
-0001d160: 3d20 5265 636f 7264 4469 6167 6e6f 7374  = RecordDiagnost
-0001d170: 6963 7328 290a 2020 2020 2320 2020 2020  ics().    #     
-0001d180: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
-0001d190: 6f6e 203d 2063 7265 6174 6564 5f64 622e  on = created_db.
-0001d1a0: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
-0001d1b0: 5f69 665f 6e6f 745f 6578 6973 7473 2869  _if_not_exists(i
-0001d1c0: 643d 636f 6c6c 6563 7469 6f6e 5f69 642c  d=collection_id,
-0001d1d0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0001d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d210: 2020 2020 2020 2020 2020 616e 616c 7974            analyt
-0001d220: 6963 616c 5f73 746f 7261 6765 5f74 746c  ical_storage_ttl
-0001d230: 3d2d 312c 0a20 2020 2023 2020 2020 2020  =-1,.    #      
-0001d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d270: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0001d280: 6465 7869 6e67 5f70 6f6c 6963 793d 636f  dexing_policy=co
-0001d290: 6c6c 6563 7469 6f6e 5f69 6e64 6578 696e  llection_indexin
-0001d2a0: 675f 706f 6c69 6379 2c0a 2020 2020 2320  g_policy,.    # 
-0001d2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2f0: 2020 2070 6172 7469 7469 6f6e 5f6b 6579     partition_key
-0001d300: 3d50 6172 7469 7469 6f6e 4b65 7928 7061  =PartitionKey(pa
-0001d310: 7468 3d22 2f70 6b22 2c20 6b69 6e64 3d22  th="/pk", kind="
-0001d320: 4861 7368 2229 2c0a 2020 2020 2320 2020  Hash"),.    #   
-0001d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d370: 2072 6573 706f 6e73 655f 686f 6f6b 3d63   response_hook=c
-0001d380: 7265 6174 6564 5f72 6563 6f72 6465 7229  reated_recorder)
-0001d390: 0a20 2020 2023 2020 2020 2070 726f 7065  .    #     prope
-0001d3a0: 7274 6965 7320 3d20 6372 6561 7465 645f  rties = created_
-0001d3b0: 636f 6c6c 6563 7469 6f6e 2e72 6561 6428  collection.read(
-0001d3c0: 290a 2020 2020 2320 2020 2020 7474 6c5f  ).    #     ttl_
-0001d3d0: 6b65 7920 3d20 2261 6e61 6c79 7469 6361  key = "analytica
-0001d3e0: 6c53 746f 7261 6765 5474 6c22 0a20 2020  lStorageTtl".   
-0001d3f0: 2023 2020 2020 2073 656c 662e 6173 7365   #     self.asse
-0001d400: 7274 5472 7565 2874 746c 5f6b 6579 2069  rtTrue(ttl_key i
-0001d410: 6e20 7072 6f70 6572 7469 6573 2061 6e64  n properties and
-0001d420: 2070 726f 7065 7274 6965 735b 7474 6c5f   properties[ttl_
-0001d430: 6b65 795d 203d 3d20 2d31 290a 0a20 2020  key] == -1)..   
-0001d440: 2023 2020 2020 2023 206e 6578 742c 2074   #     # next, t
-0001d450: 7279 2077 6865 6e20 7765 206b 6e6f 7720  ry when we know 
-0001d460: 7468 6520 636f 6e74 6169 6e65 7220 444f  the container DO
-0001d470: 4553 2065 7869 7374 2e20 5468 6973 2077  ES exist. This w
-0001d480: 6179 2062 6f74 6820 636f 6465 2070 6174  ay both code pat
-0001d490: 6873 2061 7265 2074 6573 7465 642e 0a20  hs are tested.. 
-0001d4a0: 2020 2023 2020 2020 2063 7265 6174 6564     #     created
-0001d4b0: 5f63 6f6c 6c65 6374 696f 6e20 3d20 6372  _collection = cr
-0001d4c0: 6561 7465 645f 6462 2e63 7265 6174 655f  eated_db.create_
-0001d4d0: 636f 6e74 6169 6e65 725f 6966 5f6e 6f74  container_if_not
-0001d4e0: 5f65 7869 7374 7328 6964 3d63 6f6c 6c65  _exists(id=colle
-0001d4f0: 6374 696f 6e5f 6964 2c0a 2020 2020 2320  ction_id,.    # 
-0001d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d540: 2020 2061 6e61 6c79 7469 6361 6c5f 7374     analytical_st
-0001d550: 6f72 6167 655f 7474 6c3d 2d31 2c0a 2020  orage_ttl=-1,.  
-0001d560: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0001d570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5a0: 2020 2020 2020 2069 6e64 6578 696e 675f         indexing_
-0001d5b0: 706f 6c69 6379 3d63 6f6c 6c65 6374 696f  policy=collectio
-0001d5c0: 6e5f 696e 6465 7869 6e67 5f70 6f6c 6963  n_indexing_polic
-0001d5d0: 792c 0a20 2020 2023 2020 2020 2020 2020  y,.    #        
-0001d5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d610: 2020 2020 2020 2020 2020 2020 7061 7274              part
-0001d620: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
-0001d630: 696f 6e4b 6579 2870 6174 683d 222f 706b  ionKey(path="/pk
-0001d640: 222c 206b 696e 643d 2248 6173 6822 292c  ", kind="Hash"),
-0001d650: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0001d660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d690: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
-0001d6a0: 7365 5f68 6f6f 6b3d 6372 6561 7465 645f  se_hook=created_
-0001d6b0: 7265 636f 7264 6572 290a 2020 2020 2320  recorder).    # 
-0001d6c0: 2020 2020 7072 6f70 6572 7469 6573 203d      properties =
-0001d6d0: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-0001d6e0: 696f 6e2e 7265 6164 2829 0a20 2020 2023  ion.read().    #
-0001d6f0: 2020 2020 2074 746c 5f6b 6579 203d 2022       ttl_key = "
-0001d700: 616e 616c 7974 6963 616c 5374 6f72 6167  analyticalStorag
-0001d710: 6554 746c 220a 2020 2020 2320 2020 2020  eTtl".    #     
-0001d720: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
-0001d730: 7474 6c5f 6b65 7920 696e 2070 726f 7065  ttl_key in prope
-0001d740: 7274 6965 7320 616e 6420 7072 6f70 6572  rties and proper
-0001d750: 7469 6573 5b74 746c 5f6b 6579 5d20 3d3d  ties[ttl_key] ==
-0001d760: 202d 3129 0a0a 2020 2020 6173 796e 6320   -1)..    async 
-0001d770: 6465 6620 5f4d 6f63 6b45 7865 6375 7465  def _MockExecute
-0001d780: 4675 6e63 7469 6f6e 2873 656c 662c 2066  Function(self, f
-0001d790: 756e 6374 696f 6e2c 202a 6172 6773 2c20  unction, *args, 
-0001d7a0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-0001d7b0: 2020 2073 656c 662e 6c61 7374 5f68 6561     self.last_hea
-0001d7c0: 6465 7273 2e61 7070 656e 6428 6172 6773  ders.append(args
-0001d7d0: 5b34 5d2e 6865 6164 6572 735b 4874 7470  [4].headers[Http
-0001d7e0: 4865 6164 6572 732e 5061 7274 6974 696f  Headers.Partitio
-0001d7f0: 6e4b 6579 5d0a 2020 2020 2020 2020 2020  nKey].          
-0001d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d810: 2020 2020 2020 2069 6620 4874 7470 4865         if HttpHe
-0001d820: 6164 6572 732e 5061 7274 6974 696f 6e4b  aders.PartitionK
-0001d830: 6579 2069 6e20 6172 6773 5b34 5d2e 6865  ey in args[4].he
-0001d840: 6164 6572 7320 656c 7365 2027 2729 0a20  aders else ''). 
-0001d850: 2020 2020 2020 2072 6574 7572 6e20 6177         return aw
-0001d860: 6169 7420 7365 6c66 2e4f 7269 6769 6e61  ait self.Origina
-0001d870: 6c45 7865 6375 7465 4675 6e63 7469 6f6e  lExecuteFunction
-0001d880: 2866 756e 6374 696f 6e2c 202a 6172 6773  (function, *args
-0001d890: 2c20 2a2a 6b77 6172 6773 290a 0a         , **kwargs)..
+00017910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017920: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+00017930: 6b65 793d 5061 7274 6974 696f 6e4b 6579  key=PartitionKey
+00017940: 2870 6174 683d 272f 6b65 7927 2c20 6b69  (path='/key', ki
+00017950: 6e64 3d27 4861 7368 2729 290a 2020 2020  nd='Hash')).    
+00017960: 2020 2020 636f 6c6c 6563 7469 6f6e 3320      collection3 
+00017970: 3d20 6177 6169 7420 6462 2e63 7265 6174  = await db.creat
+00017980: 655f 636f 6e74 6169 6e65 7228 6964 3d27  e_container(id='
+00017990: 7465 7374 5f74 7269 6767 6572 5f66 756e  test_trigger_fun
+000179a0: 6374 696f 6e61 6c69 7479 2033 2027 202b  ctionality 3 ' +
+000179b0: 2073 7472 2875 7569 642e 7575 6964 3428   str(uuid.uuid4(
+000179c0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+000179d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179e0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000179f0: 7274 6974 696f 6e5f 6b65 793d 5061 7274  rtition_key=Part
+00017a00: 6974 696f 6e4b 6579 2870 6174 683d 272f  itionKey(path='/
+00017a10: 6b65 7927 2c20 6b69 6e64 3d27 4861 7368  key', kind='Hash
+00017a20: 2729 290a 2020 2020 2020 2020 2320 6372  ')).        # cr
+00017a30: 6561 7465 2074 7269 6767 6572 730a 2020  eate triggers.  
+00017a40: 2020 2020 2020 6177 6169 7420 5f5f 4372        await __Cr
+00017a50: 6561 7465 5472 6967 6765 7273 2863 6f6c  eateTriggers(col
+00017a60: 6c65 6374 696f 6e31 2c20 7472 6967 6765  lection1, trigge
+00017a70: 7273 5f69 6e5f 636f 6c6c 6563 7469 6f6e  rs_in_collection
+00017a80: 3129 0a20 2020 2020 2020 2061 7761 6974  1).        await
+00017a90: 205f 5f43 7265 6174 6554 7269 6767 6572   __CreateTrigger
+00017aa0: 7328 636f 6c6c 6563 7469 6f6e 322c 2074  s(collection2, t
+00017ab0: 7269 6767 6572 735f 696e 5f63 6f6c 6c65  riggers_in_colle
+00017ac0: 6374 696f 6e32 290a 2020 2020 2020 2020  ction2).        
+00017ad0: 6177 6169 7420 5f5f 4372 6561 7465 5472  await __CreateTr
+00017ae0: 6967 6765 7273 2863 6f6c 6c65 6374 696f  iggers(collectio
+00017af0: 6e33 2c20 7472 6967 6765 7273 5f69 6e5f  n3, triggers_in_
+00017b00: 636f 6c6c 6563 7469 6f6e 3329 0a20 2020  collection3).   
+00017b10: 2020 2020 2023 2063 7265 6174 6520 646f       # create do
+00017b20: 6375 6d65 6e74 0a20 2020 2020 2020 2074  cument.        t
+00017b30: 7269 6767 6572 735f 3120 3d20 5b74 7269  riggers_1 = [tri
+00017b40: 6767 6572 2061 7379 6e63 2066 6f72 2074  gger async for t
+00017b50: 7269 6767 6572 2069 6e20 636f 6c6c 6563  rigger in collec
+00017b60: 7469 6f6e 312e 7363 7269 7074 732e 6c69  tion1.scripts.li
+00017b70: 7374 5f74 7269 6767 6572 7328 295d 0a20  st_triggers()]. 
+00017b80: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00017b90: 7274 4571 7561 6c28 6c65 6e28 7472 6967  rtEqual(len(trig
+00017ba0: 6765 7273 5f31 292c 2033 290a 2020 2020  gers_1), 3).    
+00017bb0: 2020 2020 646f 6375 6d65 6e74 5f31 5f31      document_1_1
+00017bc0: 203d 2063 6f6c 6c65 6374 696f 6e31 2e63   = collection1.c
+00017bd0: 7265 6174 655f 6974 656d 280a 2020 2020  reate_item(.    
+00017be0: 2020 2020 2020 2020 626f 6479 3d7b 2769          body={'i
+00017bf0: 6427 3a20 2764 6f63 3127 2c0a 2020 2020  d': 'doc1',.    
+00017c00: 2020 2020 2020 2020 2020 2020 2020 276b                'k
+00017c10: 6579 273a 2027 7661 6c75 6527 7d2c 0a20  ey': 'value'},. 
+00017c20: 2020 2020 2020 2020 2020 2070 7265 5f74             pre_t
+00017c30: 7269 6767 6572 5f69 6e63 6c75 6465 3d27  rigger_include='
+00017c40: 7431 270a 2020 2020 2020 2020 290a 2020  t1'.        ).  
+00017c50: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00017c60: 7445 7175 616c 2864 6f63 756d 656e 745f  tEqual(document_
+00017c70: 315f 315b 2769 6427 5d2c 0a20 2020 2020  1_1['id'],.     
+00017c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c90: 2020 2020 2744 4f43 3174 3127 2c0a 2020      'DOC1t1',.  
+00017ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cb0: 2020 2020 2020 2027 6964 2073 686f 756c         'id shoul
+00017cc0: 6420 6265 2063 6170 6974 616c 697a 6564  d be capitalized
+00017cd0: 2729 0a0a 2020 2020 2020 2020 646f 6375  ')..        docu
+00017ce0: 6d65 6e74 5f31 5f32 203d 2061 7761 6974  ment_1_2 = await
+00017cf0: 2063 6f6c 6c65 6374 696f 6e31 2e63 7265   collection1.cre
+00017d00: 6174 655f 6974 656d 280a 2020 2020 2020  ate_item(.      
+00017d10: 2020 2020 2020 626f 6479 3d7b 2769 6427        body={'id'
+00017d20: 3a20 2774 6573 7469 6e67 2070 6f73 7420  : 'testing post 
+00017d30: 7472 6967 6765 7227 2c20 276b 6579 273a  trigger', 'key':
+00017d40: 2027 7661 6c75 6527 7d2c 0a20 2020 2020   'value'},.     
+00017d50: 2020 2020 2020 2070 7265 5f74 7269 6767         pre_trigg
+00017d60: 6572 5f69 6e63 6c75 6465 3d27 7431 272c  er_include='t1',
+00017d70: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
+00017d80: 745f 7472 6967 6765 725f 696e 636c 7564  t_trigger_includ
+00017d90: 653d 2772 6573 706f 6e73 6531 272c 0a20  e='response1',. 
+00017da0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00017db0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00017dc0: 6c28 646f 6375 6d65 6e74 5f31 5f32 5b27  l(document_1_2['
+00017dd0: 6964 275d 2c20 2754 4553 5449 4e47 2050  id'], 'TESTING P
+00017de0: 4f53 5420 5452 4947 4745 5274 3127 290a  OST TRIGGERt1').
+00017df0: 0a20 2020 2020 2020 2064 6f63 756d 656e  .        documen
+00017e00: 745f 315f 3320 3d20 6177 6169 7420 636f  t_1_3 = await co
+00017e10: 6c6c 6563 7469 6f6e 312e 6372 6561 7465  llection1.create
+00017e20: 5f69 7465 6d28 0a20 2020 2020 2020 2020  _item(.         
+00017e30: 2020 2062 6f64 793d 7b27 6964 273a 2027     body={'id': '
+00017e40: 7265 7370 6f6e 7365 6865 6164 6572 7327  responseheaders'
+00017e50: 2c20 276b 6579 273a 2027 7661 6c75 6527  , 'key': 'value'
+00017e60: 7d2c 0a20 2020 2020 2020 2020 2020 2070  },.            p
+00017e70: 7265 5f74 7269 6767 6572 5f69 6e63 6c75  re_trigger_inclu
+00017e80: 6465 3d27 7431 270a 2020 2020 2020 2020  de='t1'.        
+00017e90: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00017ea0: 7373 6572 7445 7175 616c 2864 6f63 756d  ssertEqual(docum
+00017eb0: 656e 745f 315f 335b 2769 6427 5d2c 2022  ent_1_3['id'], "
+00017ec0: 5245 5350 4f4e 5345 4845 4144 4552 5374  RESPONSEHEADERSt
+00017ed0: 3122 290a 0a20 2020 2020 2020 2074 7269  1")..        tri
+00017ee0: 6767 6572 735f 3220 3d20 5b74 7269 6767  ggers_2 = [trigg
+00017ef0: 6572 2061 7379 6e63 2066 6f72 2074 7269  er async for tri
+00017f00: 6767 6572 2069 6e20 636f 6c6c 6563 7469  gger in collecti
+00017f10: 6f6e 322e 7363 7269 7074 732e 6c69 7374  on2.scripts.list
+00017f20: 5f74 7269 6767 6572 7328 295d 0a20 2020  _triggers()].   
+00017f30: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00017f40: 4571 7561 6c28 6c65 6e28 7472 6967 6765  Equal(len(trigge
+00017f50: 7273 5f32 292c 2032 290a 2020 2020 2020  rs_2), 2).      
+00017f60: 2020 646f 6375 6d65 6e74 5f32 5f31 203d    document_2_1 =
+00017f70: 2061 7761 6974 2063 6f6c 6c65 6374 696f   await collectio
+00017f80: 6e32 2e63 7265 6174 655f 6974 656d 280a  n2.create_item(.
+00017f90: 2020 2020 2020 2020 2020 2020 626f 6479              body
+00017fa0: 3d7b 2769 6427 3a20 2764 6f63 3227 2c0a  ={'id': 'doc2',.
+00017fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fc0: 2020 276b 6579 273a 2027 7661 6c75 6532    'key': 'value2
+00017fd0: 277d 2c0a 2020 2020 2020 2020 2020 2020  '},.            
+00017fe0: 7072 655f 7472 6967 6765 725f 696e 636c  pre_trigger_incl
+00017ff0: 7564 653d 2774 3227 0a20 2020 2020 2020  ude='t2'.       
+00018000: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
+00018010: 6173 7365 7274 4571 7561 6c28 646f 6375  assertEqual(docu
+00018020: 6d65 6e74 5f32 5f31 5b27 6964 275d 2c0a  ment_2_1['id'],.
+00018030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018040: 2020 2020 2020 2020 2027 646f 6332 272c           'doc2',
+00018050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018060: 2020 2020 2020 2020 2020 2769 6420 7368            'id sh
+00018070: 6f75 6c64 6e5c 2774 2063 6861 6e67 6527  ouldn\'t change'
+00018080: 290a 2020 2020 2020 2020 646f 6375 6d65  ).        docume
+00018090: 6e74 5f32 5f32 203d 2061 7761 6974 2063  nt_2_2 = await c
+000180a0: 6f6c 6c65 6374 696f 6e32 2e63 7265 6174  ollection2.creat
+000180b0: 655f 6974 656d 280a 2020 2020 2020 2020  e_item(.        
+000180c0: 2020 2020 626f 6479 3d7b 2769 6427 3a20      body={'id': 
+000180d0: 2744 6f63 3327 2c0a 2020 2020 2020 2020  'Doc3',.        
+000180e0: 2020 2020 2020 2020 2020 2770 726f 7027            'prop'
+000180f0: 3a20 2765 6d70 7479 272c 0a20 2020 2020  : 'empty',.     
+00018100: 2020 2020 2020 2020 2020 2020 2027 6b65               'ke
+00018110: 7927 3a20 2776 616c 7565 3227 7d2c 0a20  y': 'value2'},. 
+00018120: 2020 2020 2020 2020 2020 2070 7265 5f74             pre_t
+00018130: 7269 6767 6572 5f69 6e63 6c75 6465 3d27  rigger_include='
+00018140: 7433 2729 0a20 2020 2020 2020 2073 656c  t3').        sel
+00018150: 662e 6173 7365 7274 4571 7561 6c28 646f  f.assertEqual(do
+00018160: 6375 6d65 6e74 5f32 5f32 5b27 6964 275d  cument_2_2['id']
+00018170: 2c20 2764 6f63 3374 3327 290a 0a20 2020  , 'doc3t3')..   
+00018180: 2020 2020 2074 7269 6767 6572 735f 3320       triggers_3 
+00018190: 3d20 5b74 7269 6767 6572 2061 7379 6e63  = [trigger async
+000181a0: 2066 6f72 2074 7269 6767 6572 2069 6e20   for trigger in 
+000181b0: 636f 6c6c 6563 7469 6f6e 332e 7363 7269  collection3.scri
+000181c0: 7074 732e 6c69 7374 5f74 7269 6767 6572  pts.list_trigger
+000181d0: 7328 295d 0a20 2020 2020 2020 2073 656c  s()].        sel
+000181e0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+000181f0: 6e28 7472 6967 6765 7273 5f33 292c 2031  n(triggers_3), 1
+00018200: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
+00018210: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+00018220: 2845 7863 6570 7469 6f6e 293a 0a20 2020  (Exception):.   
+00018230: 2020 2020 2020 2020 2061 7761 6974 2063           await c
+00018240: 6f6c 6c65 6374 696f 6e33 2e63 7265 6174  ollection3.creat
+00018250: 655f 6974 656d 280a 2020 2020 2020 2020  e_item(.        
+00018260: 2020 2020 2020 2020 626f 6479 3d7b 2769          body={'i
+00018270: 6427 3a20 2744 6f63 6f70 7479 7065 272c  d': 'Docoptype',
+00018280: 2027 6b65 7927 3a20 2776 616c 7565 3227   'key': 'value2'
+00018290: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+000182a0: 2020 2070 6f73 745f 7472 6967 6765 725f     post_trigger_
+000182b0: 696e 636c 7564 653d 2774 7269 6767 6572  include='trigger
+000182c0: 4f70 5479 7065 270a 2020 2020 2020 2020  OpType'.        
+000182d0: 2020 2020 290a 0a20 2020 2020 2020 2061      )..        a
+000182e0: 7761 6974 2064 622e 6465 6c65 7465 5f63  wait db.delete_c
+000182f0: 6f6e 7461 696e 6572 2863 6f6c 6c65 6374  ontainer(collect
+00018300: 696f 6e31 290a 2020 2020 2020 2020 6177  ion1).        aw
+00018310: 6169 7420 6462 2e64 656c 6574 655f 636f  ait db.delete_co
+00018320: 6e74 6169 6e65 7228 636f 6c6c 6563 7469  ntainer(collecti
+00018330: 6f6e 3229 0a20 2020 2020 2020 2061 7761  on2).        awa
+00018340: 6974 2064 622e 6465 6c65 7465 5f63 6f6e  it db.delete_con
+00018350: 7461 696e 6572 2863 6f6c 6c65 6374 696f  tainer(collectio
+00018360: 6e33 290a 0a20 2020 2061 7379 6e63 2064  n3)..    async d
+00018370: 6566 2074 6573 745f 7374 6f72 6564 5f70  ef test_stored_p
+00018380: 726f 6365 6475 7265 5f66 756e 6374 696f  rocedure_functio
+00018390: 6e61 6c69 7479 2873 656c 6629 3a0a 2020  nality(self):.  
+000183a0: 2020 2020 2020 2320 6372 6561 7465 2064        # create d
+000183b0: 6174 6162 6173 650a 2020 2020 2020 2020  atabase.        
+000183c0: 6462 203d 2073 656c 662e 6461 7461 6261  db = self.databa
+000183d0: 7365 466f 7254 6573 740a 2020 2020 2020  seForTest.      
+000183e0: 2020 2320 6372 6561 7465 2063 6f6c 6c65    # create colle
+000183f0: 6374 696f 6e0a 2020 2020 2020 2020 636f  ction.        co
+00018400: 6c6c 6563 7469 6f6e 203d 2061 7761 6974  llection = await
+00018410: 2073 656c 662e 6461 7461 6261 7365 466f   self.databaseFo
+00018420: 7254 6573 742e 6372 6561 7465 5f63 6f6e  rTest.create_con
+00018430: 7461 696e 6572 2874 6573 745f 636f 6e66  tainer(test_conf
+00018440: 6967 2e5f 7465 7374 5f63 6f6e 6669 672e  ig._test_config.
+00018450: 5445 5354 5f43 4f4c 4c45 4354 494f 4e5f  TEST_COLLECTION_
+00018460: 4d55 4c54 495f 5041 5254 4954 494f 4e29  MULTI_PARTITION)
+00018470: 0a0a 2020 2020 2020 2020 7370 726f 6331  ..        sproc1
+00018480: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00018490: 2027 6964 273a 2027 7374 6f72 6564 5072   'id': 'storedPr
+000184a0: 6f63 6564 7572 6531 2720 2b20 7374 7228  ocedure1' + str(
+000184b0: 7575 6964 2e75 7569 6434 2829 292c 0a20  uuid.uuid4()),. 
+000184c0: 2020 2020 2020 2020 2020 2027 626f 6479             'body
+000184d0: 273a 2028 0a20 2020 2020 2020 2020 2020  ': (.           
+000184e0: 2020 2020 2020 2020 2027 6675 6e63 7469           'functi
+000184f0: 6f6e 2028 2920 7b27 202b 0a20 2020 2020  on () {' +.     
+00018500: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00018510: 2020 666f 7220 2876 6172 2069 203d 2030    for (var i = 0
+00018520: 3b20 6920 3c20 3130 3030 3b20 692b 2b29  ; i < 1000; i++)
+00018530: 207b 2720 2b0a 2020 2020 2020 2020 2020   {' +.          
+00018540: 2020 2020 2020 2020 2020 2720 2020 2076            '    v
+00018550: 6172 2069 7465 6d20 3d20 6765 7443 6f6e  ar item = getCon
+00018560: 7465 7874 2829 2e67 6574 5265 7370 6f6e  text().getRespon
+00018570: 7365 2829 2e67 6574 426f 6479 2829 3b27  se().getBody();'
+00018580: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+00018590: 2020 2020 2020 2027 2020 2020 6966 2028         '    if (
+000185a0: 6920 3e20 3020 2626 2069 7465 6d20 213d  i > 0 && item !=
+000185b0: 2069 202d 2031 2920 7468 726f 7720 5c27   i - 1) throw \'
+000185c0: 626f 6479 206d 6973 6d61 7463 685c 273b  body mismatch\';
+000185d0: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
+000185e0: 2020 2020 2020 2020 2720 2020 2067 6574          '    get
+000185f0: 436f 6e74 6578 7428 292e 6765 7452 6573  Context().getRes
+00018600: 706f 6e73 6528 292e 7365 7442 6f64 7928  ponse().setBody(
+00018610: 6929 3b27 202b 0a20 2020 2020 2020 2020  i);' +.         
+00018620: 2020 2020 2020 2020 2020 2027 2020 7d27             '  }'
+00018630: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+00018640: 2020 2020 2020 2027 7d27 290a 2020 2020         '}').    
+00018650: 2020 2020 7d0a 0a20 2020 2020 2020 2072      }..        r
+00018660: 6574 7269 6576 6564 5f73 7072 6f63 203d  etrieved_sproc =
+00018670: 2061 7761 6974 2063 6f6c 6c65 6374 696f   await collectio
+00018680: 6e2e 7363 7269 7074 732e 6372 6561 7465  n.scripts.create
+00018690: 5f73 746f 7265 645f 7072 6f63 6564 7572  _stored_procedur
+000186a0: 6528 626f 6479 3d73 7072 6f63 3129 0a20  e(body=sproc1). 
+000186b0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+000186c0: 6177 6169 7420 636f 6c6c 6563 7469 6f6e  await collection
+000186d0: 2e73 6372 6970 7473 2e65 7865 6375 7465  .scripts.execute
+000186e0: 5f73 746f 7265 645f 7072 6f63 6564 7572  _stored_procedur
+000186f0: 6528 0a20 2020 2020 2020 2020 2020 2073  e(.            s
+00018700: 7072 6f63 3d72 6574 7269 6576 6564 5f73  proc=retrieved_s
+00018710: 7072 6f63 5b27 6964 275d 2c0a 2020 2020  proc['id'],.    
+00018720: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
+00018730: 6e5f 6b65 793d 310a 2020 2020 2020 2020  n_key=1.        
+00018740: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00018750: 7373 6572 7445 7175 616c 2872 6573 756c  ssertEqual(resul
+00018760: 742c 2039 3939 290a 2020 2020 2020 2020  t, 999).        
+00018770: 7370 726f 6332 203d 207b 0a20 2020 2020  sproc2 = {.     
+00018780: 2020 2020 2020 2027 6964 273a 2027 7374         'id': 'st
+00018790: 6f72 6564 5072 6f63 6564 7572 6532 2720  oredProcedure2' 
+000187a0: 2b20 7374 7228 7575 6964 2e75 7569 6434  + str(uuid.uuid4
+000187b0: 2829 292c 0a20 2020 2020 2020 2020 2020  ()),.           
+000187c0: 2027 626f 6479 273a 2028 0a20 2020 2020   'body': (.     
+000187d0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000187e0: 6675 6e63 7469 6f6e 2028 2920 7b27 202b  function () {' +
+000187f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018800: 2020 2020 2027 2020 666f 7220 2876 6172       '  for (var
+00018810: 2069 203d 2030 3b20 6920 3c20 3130 3b20   i = 0; i < 10; 
+00018820: 692b 2b29 207b 2720 2b0a 2020 2020 2020  i++) {' +.      
+00018830: 2020 2020 2020 2020 2020 2020 2020 2720                ' 
+00018840: 2020 2067 6574 436f 6e74 6578 7428 292e     getContext().
+00018850: 6765 7452 6573 706f 6e73 6528 292e 6170  getResponse().ap
+00018860: 7065 6e64 5661 6c75 6528 5c27 426f 6479  pendValue(\'Body
+00018870: 5c27 2c20 6929 3b27 202b 0a20 2020 2020  \', i);' +.     
+00018880: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00018890: 2020 7d27 202b 0a20 2020 2020 2020 2020    }' +.         
+000188a0: 2020 2020 2020 2020 2020 2027 7d27 290a             '}').
+000188b0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+000188c0: 2020 7265 7472 6965 7665 645f 7370 726f    retrieved_spro
+000188d0: 6332 203d 2061 7761 6974 2063 6f6c 6c65  c2 = await colle
+000188e0: 6374 696f 6e2e 7363 7269 7074 732e 6372  ction.scripts.cr
+000188f0: 6561 7465 5f73 746f 7265 645f 7072 6f63  eate_stored_proc
+00018900: 6564 7572 6528 626f 6479 3d73 7072 6f63  edure(body=sproc
+00018910: 3229 0a20 2020 2020 2020 2072 6573 756c  2).        resul
+00018920: 7420 3d20 6177 6169 7420 636f 6c6c 6563  t = await collec
+00018930: 7469 6f6e 2e73 6372 6970 7473 2e65 7865  tion.scripts.exe
+00018940: 6375 7465 5f73 746f 7265 645f 7072 6f63  cute_stored_proc
+00018950: 6564 7572 6528 0a20 2020 2020 2020 2020  edure(.         
+00018960: 2020 2073 7072 6f63 3d72 6574 7269 6576     sproc=retriev
+00018970: 6564 5f73 7072 6f63 325b 2769 6427 5d2c  ed_sproc2['id'],
+00018980: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00018990: 7469 7469 6f6e 5f6b 6579 3d31 0a20 2020  tition_key=1.   
+000189a0: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
+000189b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000189c0: 696e 7428 7265 7375 6c74 292c 2031 3233  int(result), 123
+000189d0: 3435 3637 3839 290a 2020 2020 2020 2020  456789).        
+000189e0: 7370 726f 6333 203d 207b 0a20 2020 2020  sproc3 = {.     
+000189f0: 2020 2020 2020 2027 6964 273a 2027 7374         'id': 'st
+00018a00: 6f72 6564 5072 6f63 6564 7572 6533 2720  oredProcedure3' 
+00018a10: 2b20 7374 7228 7575 6964 2e75 7569 6434  + str(uuid.uuid4
+00018a20: 2829 292c 0a20 2020 2020 2020 2020 2020  ()),.           
+00018a30: 2027 626f 6479 273a 2028 0a20 2020 2020   'body': (.     
+00018a40: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00018a50: 6675 6e63 7469 6f6e 2028 696e 7075 7429  function (input)
+00018a60: 207b 2720 2b0a 2020 2020 2020 2020 2020   {' +.          
+00018a70: 2020 2020 2020 2020 2020 2720 2067 6574            '  get
+00018a80: 436f 6e74 6578 7428 292e 6765 7452 6573  Context().getRes
+00018a90: 706f 6e73 6528 292e 7365 7442 6f64 7928  ponse().setBody(
+00018aa0: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
+00018ab0: 2020 2020 2020 2020 2720 2020 2020 205c          '      \
+00018ac0: 2761 5c27 202b 2069 6e70 7574 2e74 656d  'a\' + input.tem
+00018ad0: 7029 3b27 202b 0a20 2020 2020 2020 2020  p);' +.         
+00018ae0: 2020 2020 2020 2020 2020 2027 7d27 290a             '}').
+00018af0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00018b00: 2020 7265 7472 6965 7665 645f 7370 726f    retrieved_spro
+00018b10: 6333 203d 2061 7761 6974 2063 6f6c 6c65  c3 = await colle
+00018b20: 6374 696f 6e2e 7363 7269 7074 732e 6372  ction.scripts.cr
+00018b30: 6561 7465 5f73 746f 7265 645f 7072 6f63  eate_stored_proc
+00018b40: 6564 7572 6528 626f 6479 3d73 7072 6f63  edure(body=sproc
+00018b50: 3329 0a20 2020 2020 2020 2072 6573 756c  3).        resul
+00018b60: 7420 3d20 6177 6169 7420 636f 6c6c 6563  t = await collec
+00018b70: 7469 6f6e 2e73 6372 6970 7473 2e65 7865  tion.scripts.exe
+00018b80: 6375 7465 5f73 746f 7265 645f 7072 6f63  cute_stored_proc
+00018b90: 6564 7572 6528 0a20 2020 2020 2020 2020  edure(.         
+00018ba0: 2020 2073 7072 6f63 3d72 6574 7269 6576     sproc=retriev
+00018bb0: 6564 5f73 7072 6f63 335b 2769 6427 5d2c  ed_sproc3['id'],
+00018bc0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00018bd0: 616d 733d 7b27 7465 6d70 273a 2027 736f  ams={'temp': 'so
+00018be0: 277d 2c0a 2020 2020 2020 2020 2020 2020  '},.            
+00018bf0: 7061 7274 6974 696f 6e5f 6b65 793d 310a  partition_key=1.
+00018c00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00018c10: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00018c20: 616c 2872 6573 756c 742c 2027 6173 6f27  al(result, 'aso'
+00018c30: 290a 0a20 2020 2061 7379 6e63 2064 6566  )..    async def
+00018c40: 205f 5f56 616c 6964 6174 654f 6666 6572   __ValidateOffer
+00018c50: 5265 7370 6f6e 7365 426f 6479 2873 656c  ResponseBody(sel
+00018c60: 662c 206f 6666 6572 2c20 6578 7065 6374  f, offer, expect
+00018c70: 6564 5f63 6f6c 6c5f 6c69 6e6b 2c20 6578  ed_coll_link, ex
+00018c80: 7065 6374 6564 5f6f 6666 6572 5f74 7970  pected_offer_typ
+00018c90: 6529 3a0a 2020 2020 2020 2020 2320 7479  e):.        # ty
+00018ca0: 7065 3a20 284f 6666 6572 2c20 7374 722c  pe: (Offer, str,
+00018cb0: 2041 6e79 2920 2d3e 204e 6f6e 650a 2020   Any) -> None.  
+00018cc0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00018cd0: 7449 734e 6f74 4e6f 6e65 286f 6666 6572  tIsNotNone(offer
+00018ce0: 2e70 726f 7065 7274 6965 735b 2769 6427  .properties['id'
+00018cf0: 5d2c 2027 4964 2063 616e 6e6f 7420 6265  ], 'Id cannot be
+00018d00: 206e 756c 6c2e 2729 0a20 2020 2020 2020   null.').       
+00018d10: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
+00018d20: 744e 6f6e 6528 6f66 6665 722e 7072 6f70  tNone(offer.prop
+00018d30: 6572 7469 6573 2e67 6574 2827 5f72 6964  erties.get('_rid
+00018d40: 2729 2c20 2752 6573 6f75 7263 6520 4964  '), 'Resource Id
+00018d50: 2028 5269 6429 2063 616e 6e6f 7420 6265   (Rid) cannot be
+00018d60: 206e 756c 6c2e 2729 0a20 2020 2020 2020   null.').       
+00018d70: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
+00018d80: 744e 6f6e 6528 6f66 6665 722e 7072 6f70  tNone(offer.prop
+00018d90: 6572 7469 6573 2e67 6574 2827 5f73 656c  erties.get('_sel
+00018da0: 6627 292c 2027 5365 6c66 204c 696e 6b20  f'), 'Self Link 
+00018db0: 6361 6e6e 6f74 2062 6520 6e75 6c6c 2e27  cannot be null.'
+00018dc0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00018dd0: 7373 6572 7449 734e 6f74 4e6f 6e65 286f  ssertIsNotNone(o
+00018de0: 6666 6572 2e70 726f 7065 7274 6965 732e  ffer.properties.
+00018df0: 6765 7428 2772 6573 6f75 7263 6527 292c  get('resource'),
+00018e00: 2027 5265 736f 7572 6365 204c 696e 6b20   'Resource Link 
+00018e10: 6361 6e6e 6f74 2062 6520 6e75 6c6c 2e27  cannot be null.'
+00018e20: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00018e30: 7373 6572 7454 7275 6528 6f66 6665 722e  ssertTrue(offer.
+00018e40: 7072 6f70 6572 7469 6573 5b27 5f73 656c  properties['_sel
+00018e50: 6627 5d2e 6669 6e64 286f 6666 6572 2e70  f'].find(offer.p
+00018e60: 726f 7065 7274 6965 735b 2769 6427 5d29  roperties['id'])
+00018e70: 2021 3d20 2d31 2c0a 2020 2020 2020 2020   != -1,.        
+00018e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e90: 274f 6666 6572 2069 6420 6e6f 7420 636f  'Offer id not co
+00018ea0: 6e74 6169 6e65 6420 696e 206f 6666 6572  ntained in offer
+00018eb0: 2073 656c 6620 6c69 6e6b 2e27 290a 2020   self link.').  
+00018ec0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00018ed0: 7445 7175 616c 2865 7870 6563 7465 645f  tEqual(expected_
+00018ee0: 636f 6c6c 5f6c 696e 6b2e 7374 7269 7028  coll_link.strip(
+00018ef0: 272f 2729 2c20 6f66 6665 722e 7072 6f70  '/'), offer.prop
+00018f00: 6572 7469 6573 5b27 7265 736f 7572 6365  erties['resource
+00018f10: 275d 2e73 7472 6970 2827 2f27 2929 0a20  '].strip('/')). 
+00018f20: 2020 2020 2020 2069 6620 2865 7870 6563         if (expec
+00018f30: 7465 645f 6f66 6665 725f 7479 7065 293a  ted_offer_type):
+00018f40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00018f50: 662e 6173 7365 7274 4571 7561 6c28 6578  f.assertEqual(ex
+00018f60: 7065 6374 6564 5f6f 6666 6572 5f74 7970  pected_offer_typ
+00018f70: 652c 206f 6666 6572 2e70 726f 7065 7274  e, offer.propert
+00018f80: 6965 732e 6765 7428 276f 6666 6572 5479  ies.get('offerTy
+00018f90: 7065 2729 290a 0a20 2020 2061 7379 6e63  pe'))..    async
+00018fa0: 2064 6566 2074 6573 745f 6f66 6665 725f   def test_offer_
+00018fb0: 7265 6164 5f61 6e64 5f71 7565 7279 2873  read_and_query(s
+00018fc0: 656c 6629 3a0a 2020 2020 2020 2020 2320  elf):.        # 
+00018fd0: 4372 6561 7465 2064 6174 6162 6173 652e  Create database.
+00018fe0: 0a20 2020 2020 2020 2064 6220 3d20 7365  .        db = se
+00018ff0: 6c66 2e64 6174 6162 6173 6546 6f72 5465  lf.databaseForTe
+00019000: 7374 0a0a 2020 2020 2020 2020 2320 4372  st..        # Cr
+00019010: 6561 7465 2063 6f6c 6c65 6374 696f 6e2e  eate collection.
+00019020: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
+00019030: 696f 6e20 3d20 6177 6169 7420 6462 2e63  ion = await db.c
+00019040: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
+00019050: 0a20 2020 2020 2020 2020 2020 2069 643d  .            id=
+00019060: 2774 6573 745f 6f66 6665 725f 7265 6164  'test_offer_read
+00019070: 5f61 6e64 5f71 7565 7279 2027 202b 2073  _and_query ' + s
+00019080: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
+00019090: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+000190a0: 7274 6974 696f 6e5f 6b65 793d 5061 7274  rtition_key=Part
+000190b0: 6974 696f 6e4b 6579 2870 6174 683d 272f  itionKey(path='/
+000190c0: 6964 272c 206b 696e 643d 2748 6173 6827  id', kind='Hash'
+000190d0: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+000190e0: 2020 2020 2320 5265 6164 2074 6865 206f      # Read the o
+000190f0: 6666 6572 2e0a 2020 2020 2020 2020 6578  ffer..        ex
+00019100: 7065 6374 6564 5f6f 6666 6572 203d 2061  pected_offer = a
+00019110: 7761 6974 2063 6f6c 6c65 6374 696f 6e2e  wait collection.
+00019120: 6765 745f 7468 726f 7567 6870 7574 2829  get_throughput()
+00019130: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
+00019140: 696f 6e5f 7072 6f70 6572 7469 6573 203d  ion_properties =
+00019150: 2061 7761 6974 2063 6f6c 6c65 6374 696f   await collectio
+00019160: 6e2e 7265 6164 2829 0a20 2020 2020 2020  n.read().       
+00019170: 2061 7761 6974 2073 656c 662e 5f5f 5661   await self.__Va
+00019180: 6c69 6461 7465 4f66 6665 7252 6573 706f  lidateOfferRespo
+00019190: 6e73 6542 6f64 7928 6578 7065 6374 6564  nseBody(expected
+000191a0: 5f6f 6666 6572 2c20 636f 6c6c 6563 7469  _offer, collecti
+000191b0: 6f6e 5f70 726f 7065 7274 6965 732e 6765  on_properties.ge
+000191c0: 7428 275f 7365 6c66 2729 2c20 4e6f 6e65  t('_self'), None
+000191d0: 290a 0a20 2020 2020 2020 2023 204e 6f77  )..        # Now
+000191e0: 2064 656c 6574 6520 7468 6520 636f 6c6c   delete the coll
+000191f0: 6563 7469 6f6e 2e0a 2020 2020 2020 2020  ection..        
+00019200: 6177 6169 7420 6462 2e64 656c 6574 655f  await db.delete_
+00019210: 636f 6e74 6169 6e65 7228 636f 6e74 6169  container(contai
+00019220: 6e65 723d 636f 6c6c 6563 7469 6f6e 290a  ner=collection).
+00019230: 2020 2020 2020 2020 2320 5265 6164 696e          # Readin
+00019240: 6720 6661 696c 732e 0a20 2020 2020 2020  g fails..       
+00019250: 2061 7761 6974 2073 656c 662e 5f5f 4173   await self.__As
+00019260: 7365 7274 4854 5450 4661 696c 7572 6557  sertHTTPFailureW
+00019270: 6974 6853 7461 7475 7328 5374 6174 7573  ithStatus(Status
+00019280: 436f 6465 732e 4e4f 545f 464f 554e 442c  Codes.NOT_FOUND,
+00019290: 2063 6f6c 6c65 6374 696f 6e2e 7265 6164   collection.read
+000192a0: 5f6f 6666 6572 290a 0a20 2020 2061 7379  _offer)..    asy
+000192b0: 6e63 2064 6566 2074 6573 745f 6f66 6665  nc def test_offe
+000192c0: 725f 7265 706c 6163 6528 7365 6c66 293a  r_replace(self):
+000192d0: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
+000192e0: 6520 6461 7461 6261 7365 2e0a 2020 2020  e database..    
+000192f0: 2020 2020 6462 203d 2073 656c 662e 6461      db = self.da
+00019300: 7461 6261 7365 466f 7254 6573 740a 2020  tabaseForTest.  
+00019310: 2020 2020 2020 2320 4372 6561 7465 2063        # Create c
+00019320: 6f6c 6c65 6374 696f 6e2e 0a20 2020 2020  ollection..     
+00019330: 2020 2063 6f6c 6c65 6374 696f 6e20 3d20     collection = 
+00019340: 6177 6169 7420 7365 6c66 2e64 6174 6162  await self.datab
+00019350: 6173 6546 6f72 5465 7374 2e63 7265 6174  aseForTest.creat
+00019360: 655f 636f 6e74 6169 6e65 7228 7465 7374  e_container(test
+00019370: 5f63 6f6e 6669 672e 5f74 6573 745f 636f  _config._test_co
+00019380: 6e66 6967 2e54 4553 545f 434f 4c4c 4543  nfig.TEST_COLLEC
+00019390: 5449 4f4e 5f4d 554c 5449 5f50 4152 5449  TION_MULTI_PARTI
+000193a0: 5449 4f4e 290a 2020 2020 2020 2020 2320  TION).        # 
+000193b0: 5265 6164 204f 6666 6572 0a20 2020 2020  Read Offer.     
+000193c0: 2020 2065 7870 6563 7465 645f 6f66 6665     expected_offe
+000193d0: 7220 3d20 6177 6169 7420 636f 6c6c 6563  r = await collec
+000193e0: 7469 6f6e 2e67 6574 5f74 6872 6f75 6768  tion.get_through
+000193f0: 7075 7428 290a 2020 2020 2020 2020 636f  put().        co
+00019400: 6c6c 6563 7469 6f6e 5f70 726f 7065 7274  llection_propert
+00019410: 6965 7320 3d20 6177 6169 7420 636f 6c6c  ies = await coll
+00019420: 6563 7469 6f6e 2e72 6561 6428 290a 2020  ection.read().  
+00019430: 2020 2020 2020 6177 6169 7420 7365 6c66        await self
+00019440: 2e5f 5f56 616c 6964 6174 654f 6666 6572  .__ValidateOffer
+00019450: 5265 7370 6f6e 7365 426f 6479 2865 7870  ResponseBody(exp
+00019460: 6563 7465 645f 6f66 6665 722c 2063 6f6c  ected_offer, col
+00019470: 6c65 6374 696f 6e5f 7072 6f70 6572 7469  lection_properti
+00019480: 6573 2e67 6574 2827 5f73 656c 6627 292c  es.get('_self'),
+00019490: 204e 6f6e 6529 0a20 2020 2020 2020 2023   None).        #
+000194a0: 2052 6570 6c61 6365 2074 6865 206f 6666   Replace the off
+000194b0: 6572 2e0a 2020 2020 2020 2020 7265 706c  er..        repl
+000194c0: 6163 6564 5f6f 6666 6572 203d 2061 7761  aced_offer = awa
+000194d0: 6974 2063 6f6c 6c65 6374 696f 6e2e 7265  it collection.re
+000194e0: 706c 6163 655f 7468 726f 7567 6870 7574  place_throughput
+000194f0: 2865 7870 6563 7465 645f 6f66 6665 722e  (expected_offer.
+00019500: 6f66 6665 725f 7468 726f 7567 6870 7574  offer_throughput
+00019510: 202b 2031 3030 290a 2020 2020 2020 2020   + 100).        
+00019520: 636f 6c6c 6563 7469 6f6e 5f70 726f 7065  collection_prope
+00019530: 7274 6965 7320 3d20 6177 6169 7420 636f  rties = await co
+00019540: 6c6c 6563 7469 6f6e 2e72 6561 6428 290a  llection.read().
+00019550: 2020 2020 2020 2020 6177 6169 7420 7365          await se
+00019560: 6c66 2e5f 5f56 616c 6964 6174 654f 6666  lf.__ValidateOff
+00019570: 6572 5265 7370 6f6e 7365 426f 6479 2872  erResponseBody(r
+00019580: 6570 6c61 6365 645f 6f66 6665 722c 2063  eplaced_offer, c
+00019590: 6f6c 6c65 6374 696f 6e5f 7072 6f70 6572  ollection_proper
+000195a0: 7469 6573 2e67 6574 2827 5f73 656c 6627  ties.get('_self'
+000195b0: 292c 204e 6f6e 6529 0a20 2020 2020 2020  ), None).       
+000195c0: 2023 2043 6865 636b 2069 6620 7468 6520   # Check if the 
+000195d0: 7265 706c 6163 6564 206f 6666 6572 2069  replaced offer i
+000195e0: 7320 7768 6174 2077 6520 6578 7065 6374  s what we expect
+000195f0: 2e0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+00019600: 7373 6572 7445 7175 616c 2865 7870 6563  ssertEqual(expec
+00019610: 7465 645f 6f66 6665 722e 7072 6f70 6572  ted_offer.proper
+00019620: 7469 6573 2e67 6574 2827 636f 6e74 656e  ties.get('conten
+00019630: 7427 292e 6765 7428 276f 6666 6572 5468  t').get('offerTh
+00019640: 726f 7567 6870 7574 2729 202b 2031 3030  roughput') + 100
+00019650: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019660: 2020 2020 2020 2020 2020 2072 6570 6c61             repla
+00019670: 6365 645f 6f66 6665 722e 7072 6f70 6572  ced_offer.proper
+00019680: 7469 6573 2e67 6574 2827 636f 6e74 656e  ties.get('conten
+00019690: 7427 292e 6765 7428 276f 6666 6572 5468  t').get('offerTh
+000196a0: 726f 7567 6870 7574 2729 290a 2020 2020  roughput')).    
+000196b0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000196c0: 7175 616c 2865 7870 6563 7465 645f 6f66  qual(expected_of
+000196d0: 6665 722e 6f66 6665 725f 7468 726f 7567  fer.offer_throug
+000196e0: 6870 7574 202b 2031 3030 2c0a 2020 2020  hput + 100,.    
+000196f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019700: 2020 2020 2072 6570 6c61 6365 645f 6f66       replaced_of
+00019710: 6665 722e 6f66 6665 725f 7468 726f 7567  fer.offer_throug
+00019720: 6870 7574 290a 0a20 2020 2061 7379 6e63  hput)..    async
+00019730: 2064 6566 2074 6573 745f 6461 7461 6261   def test_databa
+00019740: 7365 5f61 6363 6f75 6e74 5f66 756e 6374  se_account_funct
+00019750: 696f 6e61 6c69 7479 2873 656c 6629 3a0a  ionality(self):.
+00019760: 2020 2020 2020 2020 2320 5661 6c69 6461          # Valida
+00019770: 7465 2064 6174 6162 6173 6520 6163 636f  te database acco
+00019780: 756e 7420 6675 6e63 7469 6f6e 616c 6974  unt functionalit
+00019790: 792e 0a20 2020 2020 2020 2064 6174 6162  y..        datab
+000197a0: 6173 655f 6163 636f 756e 7420 3d20 6177  ase_account = aw
+000197b0: 6169 7420 7365 6c66 2e63 6c69 656e 742e  ait self.client.
+000197c0: 5f67 6574 5f64 6174 6162 6173 655f 6163  _get_database_ac
+000197d0: 636f 756e 7428 290a 2020 2020 2020 2020  count().        
+000197e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000197f0: 2864 6174 6162 6173 655f 6163 636f 756e  (database_accoun
+00019800: 742e 4461 7461 6261 7365 734c 696e 6b2c  t.DatabasesLink,
+00019810: 2027 2f64 6273 2f27 290a 2020 2020 2020   '/dbs/').      
+00019820: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00019830: 616c 2864 6174 6162 6173 655f 6163 636f  al(database_acco
+00019840: 756e 742e 4d65 6469 614c 696e 6b2c 2027  unt.MediaLink, '
+00019850: 2f6d 6564 6961 2f27 290a 2020 2020 2020  /media/').      
+00019860: 2020 6966 2028 4874 7470 4865 6164 6572    if (HttpHeader
+00019870: 732e 4d61 784d 6564 6961 5374 6f72 6167  s.MaxMediaStorag
+00019880: 6555 7361 6765 496e 4d42 2069 6e0a 2020  eUsageInMB in.  
+00019890: 2020 2020 2020 2020 2020 2020 2020 6177                aw
+000198a0: 6169 7420 7365 6c66 2e63 6c69 656e 742e  ait self.client.
+000198b0: 636c 6965 6e74 5f63 6f6e 6e65 6374 696f  client_connectio
+000198c0: 6e2e 6c61 7374 5f72 6573 706f 6e73 655f  n.last_response_
+000198d0: 6865 6164 6572 7329 3a0a 2020 2020 2020  headers):.      
+000198e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000198f0: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+00019900: 2020 2020 2020 2020 6461 7461 6261 7365          database
+00019910: 5f61 6363 6f75 6e74 2e4d 6178 4d65 6469  _account.MaxMedi
+00019920: 6153 746f 7261 6765 5573 6167 6549 6e4d  aStorageUsageInM
+00019930: 422c 0a20 2020 2020 2020 2020 2020 2020  B,.             
+00019940: 2020 2073 656c 662e 636c 6965 6e74 2e63     self.client.c
+00019950: 6c69 656e 745f 636f 6e6e 6563 7469 6f6e  lient_connection
+00019960: 2e6c 6173 745f 7265 7370 6f6e 7365 5f68  .last_response_h
+00019970: 6561 6465 7273 5b0a 2020 2020 2020 2020  eaders[.        
+00019980: 2020 2020 2020 2020 2020 2020 4874 7470              Http
+00019990: 4865 6164 6572 732e 4d61 784d 6564 6961  Headers.MaxMedia
+000199a0: 5374 6f72 6167 6555 7361 6765 496e 4d42  StorageUsageInMB
+000199b0: 5d29 0a20 2020 2020 2020 2069 6620 2848  ]).        if (H
+000199c0: 7474 7048 6561 6465 7273 2e43 7572 7265  ttpHeaders.Curre
+000199d0: 6e74 4d65 6469 6153 746f 7261 6765 5573  ntMediaStorageUs
+000199e0: 6167 6549 6e4d 4220 696e 0a20 2020 2020  ageInMB in.     
+000199f0: 2020 2020 2020 2020 2020 2061 7761 6974             await
+00019a00: 2073 656c 662e 636c 6965 6e74 2e63 6c69   self.client.cli
+00019a10: 656e 745f 636f 6e6e 6563 7469 6f6e 2e6c  ent_connection.l
+00019a20: 6173 745f 7265 7370 6f6e 7365 5f68 6561  ast_response_hea
+00019a30: 6465 7273 293a 0a20 2020 2020 2020 2020  ders):.         
+00019a40: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00019a50: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00019a60: 2020 2020 2064 6174 6162 6173 655f 6163       database_ac
+00019a70: 636f 756e 742e 4375 7272 656e 744d 6564  count.CurrentMed
+00019a80: 6961 5374 6f72 6167 6555 7361 6765 496e  iaStorageUsageIn
+00019a90: 4d42 2c0a 2020 2020 2020 2020 2020 2020  MB,.            
+00019aa0: 2020 2020 6177 6169 7420 7365 6c66 2e63      await self.c
+00019ab0: 6c69 656e 742e 636c 6965 6e74 5f63 6f6e  lient.client_con
+00019ac0: 6e65 6374 696f 6e2e 6c61 7374 5f72 6573  nection.last_res
+00019ad0: 706f 6e73 655f 6865 6164 6572 735b 0a20  ponse_headers[. 
+00019ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019af0: 2020 2048 7474 7048 6561 6465 7273 2e43     HttpHeaders.C
+00019b00: 7572 7265 6e74 4d65 6469 6153 746f 7261  urrentMediaStora
+00019b10: 6765 5573 6167 6549 6e4d 425d 290a 2020  geUsageInMB]).  
+00019b20: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00019b30: 7449 734e 6f74 4e6f 6e65 2864 6174 6162  tIsNotNone(datab
+00019b40: 6173 655f 6163 636f 756e 742e 436f 6e73  ase_account.Cons
+00019b50: 6973 7465 6e63 7950 6f6c 6963 795b 2764  istencyPolicy['d
+00019b60: 6566 6175 6c74 436f 6e73 6973 7465 6e63  efaultConsistenc
+00019b70: 794c 6576 656c 275d 290a 0a20 2020 2061  yLevel'])..    a
+00019b80: 7379 6e63 2064 6566 2074 6573 745f 696e  sync def test_in
+00019b90: 6465 785f 7072 6f67 7265 7373 5f68 6561  dex_progress_hea
+00019ba0: 6465 7273 2873 656c 6629 3a0a 2020 2020  ders(self):.    
+00019bb0: 2020 2020 6372 6561 7465 645f 6462 203d      created_db =
+00019bc0: 2073 656c 662e 6461 7461 6261 7365 466f   self.databaseFo
+00019bd0: 7254 6573 740a 2020 2020 2020 2020 636f  rTest.        co
+00019be0: 6e73 6973 7465 6e74 5f63 6f6c 6c20 3d20  nsistent_coll = 
+00019bf0: 6177 6169 7420 6372 6561 7465 645f 6462  await created_db
+00019c00: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
+00019c10: 7228 0a20 2020 2020 2020 2020 2020 2069  r(.            i
+00019c20: 643d 2774 6573 745f 696e 6465 785f 7072  d='test_index_pr
+00019c30: 6f67 7265 7373 5f68 6561 6465 7273 2063  ogress_headers c
+00019c40: 6f6e 7369 7374 656e 745f 636f 6c6c 2027  onsistent_coll '
+00019c50: 202b 2073 7472 2875 7569 642e 7575 6964   + str(uuid.uuid
+00019c60: 3428 2929 2c0a 2020 2020 2020 2020 2020  4()),.          
+00019c70: 2020 7061 7274 6974 696f 6e5f 6b65 793d    partition_key=
+00019c80: 5061 7274 6974 696f 6e4b 6579 2870 6174  PartitionKey(pat
+00019c90: 683d 222f 6964 222c 206b 696e 643d 2748  h="/id", kind='H
+00019ca0: 6173 6827 292c 0a20 2020 2020 2020 2029  ash'),.        )
+00019cb0: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+00019cc0: 5f63 6f6e 7461 696e 6572 203d 2063 7265  _container = cre
+00019cd0: 6174 6564 5f64 622e 6765 745f 636f 6e74  ated_db.get_cont
+00019ce0: 6169 6e65 725f 636c 6965 6e74 2863 6f6e  ainer_client(con
+00019cf0: 7461 696e 6572 3d63 6f6e 7369 7374 656e  tainer=consisten
+00019d00: 745f 636f 6c6c 290a 2020 2020 2020 2020  t_coll).        
+00019d10: 6177 6169 7420 6372 6561 7465 645f 636f  await created_co
+00019d20: 6e74 6169 6e65 722e 7265 6164 2870 6f70  ntainer.read(pop
+00019d30: 756c 6174 655f 7175 6f74 615f 696e 666f  ulate_quota_info
+00019d40: 3d54 7275 6529 0a20 2020 2020 2020 2073  =True).        s
+00019d50: 656c 662e 6173 7365 7274 4661 6c73 6528  elf.assertFalse(
+00019d60: 4874 7470 4865 6164 6572 732e 4c61 7a79  HttpHeaders.Lazy
+00019d70: 496e 6465 7869 6e67 5072 6f67 7265 7373  IndexingProgress
+00019d80: 2069 6e20 6372 6561 7465 645f 6462 2e63   in created_db.c
+00019d90: 6c69 656e 745f 636f 6e6e 6563 7469 6f6e  lient_connection
+00019da0: 2e6c 6173 745f 7265 7370 6f6e 7365 5f68  .last_response_h
+00019db0: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
+00019dc0: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
+00019dd0: 4874 7470 4865 6164 6572 732e 496e 6465  HttpHeaders.Inde
+00019de0: 7854 7261 6e73 666f 726d 6174 696f 6e50  xTransformationP
+00019df0: 726f 6772 6573 7320 696e 2063 7265 6174  rogress in creat
+00019e00: 6564 5f64 622e 636c 6965 6e74 5f63 6f6e  ed_db.client_con
+00019e10: 6e65 6374 696f 6e2e 6c61 7374 5f72 6573  nection.last_res
+00019e20: 706f 6e73 655f 6865 6164 6572 7329 0a0a  ponse_headers)..
+00019e30: 2020 2020 2020 2020 6e6f 6e65 5f63 6f6c          none_col
+00019e40: 6c20 3d20 6177 6169 7420 6372 6561 7465  l = await create
+00019e50: 645f 6462 2e63 7265 6174 655f 636f 6e74  d_db.create_cont
+00019e60: 6169 6e65 7228 0a20 2020 2020 2020 2020  ainer(.         
+00019e70: 2020 2069 643d 2774 6573 745f 696e 6465     id='test_inde
+00019e80: 785f 7072 6f67 7265 7373 5f68 6561 6465  x_progress_heade
+00019e90: 7273 206e 6f6e 655f 636f 6c6c 2027 202b  rs none_coll ' +
+00019ea0: 2073 7472 2875 7569 642e 7575 6964 3428   str(uuid.uuid4(
+00019eb0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00019ec0: 696e 6465 7869 6e67 5f70 6f6c 6963 793d  indexing_policy=
+00019ed0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00019ee0: 2020 2769 6e64 6578 696e 674d 6f64 6527    'indexingMode'
+00019ef0: 3a20 646f 6375 6d65 6e74 732e 496e 6465  : documents.Inde
+00019f00: 7869 6e67 4d6f 6465 2e4e 6f49 6e64 6578  xingMode.NoIndex
+00019f10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019f20: 2020 2761 7574 6f6d 6174 6963 273a 2046    'automatic': F
+00019f30: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00019f40: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
+00019f50: 7061 7274 6974 696f 6e5f 6b65 793d 5061  partition_key=Pa
+00019f60: 7274 6974 696f 6e4b 6579 2870 6174 683d  rtitionKey(path=
+00019f70: 222f 6964 222c 206b 696e 643d 2748 6173  "/id", kind='Has
+00019f80: 6827 290a 2020 2020 2020 2020 290a 2020  h').        ).  
+00019f90: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
+00019fa0: 6e74 6169 6e65 7220 3d20 6372 6561 7465  ntainer = create
+00019fb0: 645f 6462 2e67 6574 5f63 6f6e 7461 696e  d_db.get_contain
+00019fc0: 6572 5f63 6c69 656e 7428 636f 6e74 6169  er_client(contai
+00019fd0: 6e65 723d 6e6f 6e65 5f63 6f6c 6c29 0a20  ner=none_coll). 
+00019fe0: 2020 2020 2020 2061 7761 6974 2063 7265         await cre
+00019ff0: 6174 6564 5f63 6f6e 7461 696e 6572 2e72  ated_container.r
+0001a000: 6561 6428 706f 7075 6c61 7465 5f71 756f  ead(populate_quo
+0001a010: 7461 5f69 6e66 6f3d 5472 7565 290a 2020  ta_info=True).  
+0001a020: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001a030: 7446 616c 7365 2848 7474 7048 6561 6465  tFalse(HttpHeade
+0001a040: 7273 2e4c 617a 7949 6e64 6578 696e 6750  rs.LazyIndexingP
+0001a050: 726f 6772 6573 7320 696e 2063 7265 6174  rogress in creat
+0001a060: 6564 5f64 622e 636c 6965 6e74 5f63 6f6e  ed_db.client_con
+0001a070: 6e65 6374 696f 6e2e 6c61 7374 5f72 6573  nection.last_res
+0001a080: 706f 6e73 655f 6865 6164 6572 7329 0a20  ponse_headers). 
+0001a090: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001a0a0: 7274 5472 7565 2848 7474 7048 6561 6465  rtTrue(HttpHeade
+0001a0b0: 7273 2e49 6e64 6578 5472 616e 7366 6f72  rs.IndexTransfor
+0001a0c0: 6d61 7469 6f6e 5072 6f67 7265 7373 2069  mationProgress i
+0001a0d0: 6e20 6372 6561 7465 645f 6462 2e63 6c69  n created_db.cli
+0001a0e0: 656e 745f 636f 6e6e 6563 7469 6f6e 2e6c  ent_connection.l
+0001a0f0: 6173 745f 7265 7370 6f6e 7365 5f68 6561  ast_response_hea
+0001a100: 6465 7273 290a 0a20 2020 2020 2020 2061  ders)..        a
+0001a110: 7761 6974 2063 7265 6174 6564 5f64 622e  wait created_db.
+0001a120: 6465 6c65 7465 5f63 6f6e 7461 696e 6572  delete_container
+0001a130: 2863 6f6e 7369 7374 656e 745f 636f 6c6c  (consistent_coll
+0001a140: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
+0001a150: 6372 6561 7465 645f 6462 2e64 656c 6574  created_db.delet
+0001a160: 655f 636f 6e74 6169 6e65 7228 6e6f 6e65  e_container(none
+0001a170: 5f63 6f6c 6c29 0a0a 2020 2020 6173 796e  _coll)..    asyn
+0001a180: 6320 6465 6620 7465 7374 5f69 645f 7661  c def test_id_va
+0001a190: 6c69 6461 7469 6f6e 2873 656c 6629 3a0a  lidation(self):.
+0001a1a0: 2020 2020 2020 2020 2320 4964 2073 686f          # Id sho
+0001a1b0: 756c 646e 2774 2065 6e64 2077 6974 6820  uldn't end with 
+0001a1c0: 7370 6163 652e 0a20 2020 2020 2020 2074  space..        t
+0001a1d0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001a1e0: 6177 6169 7420 7365 6c66 2e63 6c69 656e  await self.clien
+0001a1f0: 742e 6372 6561 7465 5f64 6174 6162 6173  t.create_databas
+0001a200: 6528 6964 3d27 6964 5f77 6974 685f 7370  e(id='id_with_sp
+0001a210: 6163 6520 2729 0a20 2020 2020 2020 2020  ace ').         
+0001a220: 2020 2073 656c 662e 6173 7365 7274 4661     self.assertFa
+0001a230: 6c73 6528 5472 7565 290a 2020 2020 2020  lse(True).      
+0001a240: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
+0001a250: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+0001a260: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001a270: 7445 7175 616c 2827 4964 2065 6e64 7320  tEqual('Id ends 
+0001a280: 7769 7468 2061 2073 7061 6365 2e27 2c20  with a space.', 
+0001a290: 652e 6172 6773 5b30 5d29 0a20 2020 2020  e.args[0]).     
+0001a2a0: 2020 2023 2049 6420 7368 6f75 6c64 6e27     # Id shouldn'
+0001a2b0: 7420 636f 6e74 6169 6e20 272f 272e 0a0a  t contain '/'...
+0001a2c0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0001a2d0: 2020 2020 2020 2020 2061 7761 6974 2073           await s
+0001a2e0: 656c 662e 636c 6965 6e74 2e63 7265 6174  elf.client.creat
+0001a2f0: 655f 6461 7461 6261 7365 2869 643d 2769  e_database(id='i
+0001a300: 645f 7769 7468 5f69 6c6c 6567 616c 2f5f  d_with_illegal/_
+0001a310: 6368 6172 2729 0a20 2020 2020 2020 2020  char').         
+0001a320: 2020 2073 656c 662e 6173 7365 7274 4661     self.assertFa
+0001a330: 6c73 6528 5472 7565 290a 2020 2020 2020  lse(True).      
+0001a340: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
+0001a350: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+0001a360: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001a370: 7445 7175 616c 2827 4964 2063 6f6e 7461  tEqual('Id conta
+0001a380: 696e 7320 696c 6c65 6761 6c20 6368 6172  ins illegal char
+0001a390: 732e 272c 2065 2e61 7267 735b 305d 290a  s.', e.args[0]).
+0001a3a0: 2020 2020 2020 2020 2320 4964 2073 686f          # Id sho
+0001a3b0: 756c 646e 2774 2063 6f6e 7461 696e 2027  uldn't contain '
+0001a3c0: 5c5c 272e 0a0a 2020 2020 2020 2020 7472  \\'...        tr
+0001a3d0: 793a 0a20 2020 2020 2020 2020 2020 2061  y:.            a
+0001a3e0: 7761 6974 2073 656c 662e 636c 6965 6e74  wait self.client
+0001a3f0: 2e63 7265 6174 655f 6461 7461 6261 7365  .create_database
+0001a400: 2869 643d 2769 645f 7769 7468 5f69 6c6c  (id='id_with_ill
+0001a410: 6567 616c 5c5c 5f63 6861 7227 290a 2020  egal\\_char').  
+0001a420: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0001a430: 7373 6572 7446 616c 7365 2854 7275 6529  ssertFalse(True)
+0001a440: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0001a450: 5661 6c75 6545 7272 6f72 2061 7320 653a  ValueError as e:
+0001a460: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001a470: 662e 6173 7365 7274 4571 7561 6c28 2749  f.assertEqual('I
+0001a480: 6420 636f 6e74 6169 6e73 2069 6c6c 6567  d contains illeg
+0001a490: 616c 2063 6861 7273 2e27 2c20 652e 6172  al chars.', e.ar
+0001a4a0: 6773 5b30 5d29 0a20 2020 2020 2020 2023  gs[0]).        #
+0001a4b0: 2049 6420 7368 6f75 6c64 6e27 7420 636f   Id shouldn't co
+0001a4c0: 6e74 6169 6e20 273f 272e 0a0a 2020 2020  ntain '?'...    
+0001a4d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001a4e0: 2020 2020 2061 7761 6974 2073 656c 662e       await self.
+0001a4f0: 636c 6965 6e74 2e63 7265 6174 655f 6461  client.create_da
+0001a500: 7461 6261 7365 2869 643d 2769 645f 7769  tabase(id='id_wi
+0001a510: 7468 5f69 6c6c 6567 616c 3f5f 6368 6172  th_illegal?_char
+0001a520: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
+0001a530: 656c 662e 6173 7365 7274 4661 6c73 6528  elf.assertFalse(
+0001a540: 5472 7565 290a 2020 2020 2020 2020 6578  True).        ex
+0001a550: 6365 7074 2056 616c 7565 4572 726f 7220  cept ValueError 
+0001a560: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0001a570: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0001a580: 616c 2827 4964 2063 6f6e 7461 696e 7320  al('Id contains 
+0001a590: 696c 6c65 6761 6c20 6368 6172 732e 272c  illegal chars.',
+0001a5a0: 2065 2e61 7267 735b 305d 290a 2020 2020   e.args[0]).    
+0001a5b0: 2020 2020 2320 4964 2073 686f 756c 646e      # Id shouldn
+0001a5c0: 2774 2063 6f6e 7461 696e 2027 2327 2e0a  't contain '#'..
+0001a5d0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0001a5e0: 2020 2020 2020 2020 2020 6177 6169 7420            await 
+0001a5f0: 7365 6c66 2e63 6c69 656e 742e 6372 6561  self.client.crea
+0001a600: 7465 5f64 6174 6162 6173 6528 6964 3d27  te_database(id='
+0001a610: 6964 5f77 6974 685f 696c 6c65 6761 6c23  id_with_illegal#
+0001a620: 5f63 6861 7227 290a 2020 2020 2020 2020  _char').        
+0001a630: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+0001a640: 616c 7365 2854 7275 6529 0a20 2020 2020  alse(True).     
+0001a650: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
+0001a660: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
+0001a670: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001a680: 7274 4571 7561 6c28 2749 6420 636f 6e74  rtEqual('Id cont
+0001a690: 6169 6e73 2069 6c6c 6567 616c 2063 6861  ains illegal cha
+0001a6a0: 7273 2e27 2c20 652e 6172 6773 5b30 5d29  rs.', e.args[0])
+0001a6b0: 0a0a 2020 2020 2020 2020 2320 4964 2063  ..        # Id c
+0001a6c0: 616e 2062 6567 696e 2077 6974 6820 7370  an begin with sp
+0001a6d0: 6163 650a 2020 2020 2020 2020 6462 203d  ace.        db =
+0001a6e0: 2061 7761 6974 2073 656c 662e 636c 6965   await self.clie
+0001a6f0: 6e74 2e63 7265 6174 655f 6461 7461 6261  nt.create_databa
+0001a700: 7365 2869 643d 2720 6964 5f62 6567 696e  se(id=' id_begin
+0001a710: 5f73 7061 6365 2729 0a20 2020 2020 2020  _space').       
+0001a720: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
+0001a730: 2854 7275 6529 0a0a 2020 2020 2020 2020  (True)..        
+0001a740: 6177 6169 7420 7365 6c66 2e63 6c69 656e  await self.clien
+0001a750: 742e 6465 6c65 7465 5f64 6174 6162 6173  t.delete_databas
+0001a760: 6528 6461 7461 6261 7365 3d64 6229 0a0a  e(database=db)..
+0001a770: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
+0001a780: 7374 5f69 645f 6361 7365 5f76 616c 6964  st_id_case_valid
+0001a790: 6174 696f 6e28 7365 6c66 293a 0a20 2020  ation(self):.   
+0001a7a0: 2020 2020 2023 2063 7265 6174 6520 6461       # create da
+0001a7b0: 7461 6261 7365 0a20 2020 2020 2020 2063  tabase.        c
+0001a7c0: 7265 6174 6564 5f64 6220 3d20 7365 6c66  reated_db = self
+0001a7d0: 2e64 6174 6162 6173 6546 6f72 5465 7374  .databaseForTest
+0001a7e0: 0a0a 2020 2020 2020 2020 7575 6964 5f73  ..        uuid_s
+0001a7f0: 7472 696e 6720 3d20 7374 7228 7575 6964  tring = str(uuid
+0001a800: 2e75 7569 6434 2829 290a 2020 2020 2020  .uuid4()).      
+0001a810: 2020 636f 6c6c 6563 7469 6f6e 5f69 6431    collection_id1
+0001a820: 203d 2027 7361 6d70 6c65 436f 6c6c 6563   = 'sampleCollec
+0001a830: 7469 6f6e 2027 202b 2075 7569 645f 7374  tion ' + uuid_st
+0001a840: 7269 6e67 0a20 2020 2020 2020 2063 6f6c  ring.        col
+0001a850: 6c65 6374 696f 6e5f 6964 3220 3d20 2753  lection_id2 = 'S
+0001a860: 616d 706c 6543 6f6c 6c65 6374 696f 6e20  ampleCollection 
+0001a870: 2720 2b20 7575 6964 5f73 7472 696e 670a  ' + uuid_string.
+0001a880: 0a20 2020 2020 2020 2023 2056 6572 6966  .        # Verif
+0001a890: 7920 7468 6174 206e 6f20 636f 6c6c 6563  y that no collec
+0001a8a0: 7469 6f6e 7320 6578 6973 740a 2020 2020  tions exist.    
+0001a8b0: 2020 2020 636f 6c6c 6563 7469 6f6e 7320      collections 
+0001a8c0: 3d20 5b63 6f6c 6c65 6374 696f 6e20 6173  = [collection as
+0001a8d0: 796e 6320 666f 7220 636f 6c6c 6563 7469  ync for collecti
+0001a8e0: 6f6e 2069 6e20 6372 6561 7465 645f 6462  on in created_db
+0001a8f0: 2e6c 6973 745f 636f 6e74 6169 6e65 7273  .list_containers
+0001a900: 2829 5d0a 2020 2020 2020 2020 6e75 6d62  ()].        numb
+0001a910: 6572 5f6f 665f 6578 6973 7469 6e67 5f63  er_of_existing_c
+0001a920: 6f6c 6c65 6374 696f 6e73 203d 206c 656e  ollections = len
+0001a930: 2863 6f6c 6c65 6374 696f 6e73 290a 0a20  (collections).. 
+0001a940: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+0001a950: 3220 636f 6c6c 6563 7469 6f6e 7320 7769  2 collections wi
+0001a960: 7468 2064 6966 6665 7265 6e74 2063 6173  th different cas
+0001a970: 696e 6720 6f66 2049 4473 0a20 2020 2020  ing of IDs.     
+0001a980: 2020 2023 2070 6173 6361 6c43 6173 650a     # pascalCase.
+0001a990: 2020 2020 2020 2020 6372 6561 7465 645f          created_
+0001a9a0: 636f 6c6c 6563 7469 6f6e 3120 3d20 6177  collection1 = aw
+0001a9b0: 6169 7420 6372 6561 7465 645f 6462 2e63  ait created_db.c
+0001a9c0: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
+0001a9d0: 0a20 2020 2020 2020 2020 2020 2069 643d  .            id=
+0001a9e0: 636f 6c6c 6563 7469 6f6e 5f69 6431 2c0a  collection_id1,.
+0001a9f0: 2020 2020 2020 2020 2020 2020 7061 7274              part
+0001aa00: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
+0001aa10: 696f 6e4b 6579 2870 6174 683d 272f 6964  ionKey(path='/id
+0001aa20: 272c 206b 696e 643d 2748 6173 6827 290a  ', kind='Hash').
+0001aa30: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0001aa40: 2020 2023 2043 616d 656c 4361 7365 0a20     # CamelCase. 
+0001aa50: 2020 2020 2020 2063 7265 6174 6564 5f63         created_c
+0001aa60: 6f6c 6c65 6374 696f 6e32 203d 2061 7761  ollection2 = awa
+0001aa70: 6974 2063 7265 6174 6564 5f64 622e 6372  it created_db.cr
+0001aa80: 6561 7465 5f63 6f6e 7461 696e 6572 280a  eate_container(.
+0001aa90: 2020 2020 2020 2020 2020 2020 6964 3d63              id=c
+0001aaa0: 6f6c 6c65 6374 696f 6e5f 6964 322c 0a20  ollection_id2,. 
+0001aab0: 2020 2020 2020 2020 2020 2070 6172 7469             parti
+0001aac0: 7469 6f6e 5f6b 6579 3d50 6172 7469 7469  tion_key=Partiti
+0001aad0: 6f6e 4b65 7928 7061 7468 3d27 2f69 6427  onKey(path='/id'
+0001aae0: 2c20 6b69 6e64 3d27 4861 7368 2729 0a20  , kind='Hash'). 
+0001aaf0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0001ab00: 2020 636f 6c6c 6563 7469 6f6e 7320 3d20    collections = 
+0001ab10: 5b63 6f6c 6c65 6374 696f 6e20 6173 796e  [collection asyn
+0001ab20: 6320 666f 7220 636f 6c6c 6563 7469 6f6e  c for collection
+0001ab30: 2069 6e20 6372 6561 7465 645f 6462 2e6c   in created_db.l
+0001ab40: 6973 745f 636f 6e74 6169 6e65 7273 2829  ist_containers()
+0001ab50: 5d0a 0a20 2020 2020 2020 2023 2076 6572  ]..        # ver
+0001ab60: 6966 7920 6966 2061 2074 6f74 616c 206f  ify if a total o
+0001ab70: 6620 3220 636f 6c6c 6563 7469 6f6e 7320  f 2 collections 
+0001ab80: 676f 7420 6372 6561 7465 640a 2020 2020  got created.    
+0001ab90: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001aba0: 7175 616c 286c 656e 2863 6f6c 6c65 6374  qual(len(collect
+0001abb0: 696f 6e73 292c 206e 756d 6265 725f 6f66  ions), number_of
+0001abc0: 5f65 7869 7374 696e 675f 636f 6c6c 6563  _existing_collec
+0001abd0: 7469 6f6e 7320 2b20 3229 0a0a 2020 2020  tions + 2)..    
+0001abe0: 2020 2020 2320 7665 7269 6679 2074 6861      # verify tha
+0001abf0: 7420 636f 6c6c 6563 7469 6f6e 7320 6172  t collections ar
+0001ac00: 6520 6372 6561 7465 6420 7769 7468 2073  e created with s
+0001ac10: 7065 6369 6669 6564 2049 4473 0a20 2020  pecified IDs.   
+0001ac20: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0001ac30: 4571 7561 6c28 636f 6c6c 6563 7469 6f6e  Equal(collection
+0001ac40: 5f69 6431 2c20 6372 6561 7465 645f 636f  _id1, created_co
+0001ac50: 6c6c 6563 7469 6f6e 312e 6964 290a 2020  llection1.id).  
+0001ac60: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001ac70: 7445 7175 616c 2863 6f6c 6c65 6374 696f  tEqual(collectio
+0001ac80: 6e5f 6964 322c 2063 7265 6174 6564 5f63  n_id2, created_c
+0001ac90: 6f6c 6c65 6374 696f 6e32 2e69 6429 0a0a  ollection2.id)..
+0001aca0: 2020 2020 2020 2020 6177 6169 7420 6372          await cr
+0001acb0: 6561 7465 645f 6462 2e64 656c 6574 655f  eated_db.delete_
+0001acc0: 636f 6e74 6169 6e65 7228 6372 6561 7465  container(create
+0001acd0: 645f 636f 6c6c 6563 7469 6f6e 3129 0a20  d_collection1). 
+0001ace0: 2020 2020 2020 2061 7761 6974 2063 7265         await cre
+0001acf0: 6174 6564 5f64 622e 6465 6c65 7465 5f63  ated_db.delete_c
+0001ad00: 6f6e 7461 696e 6572 2863 7265 6174 6564  ontainer(created
+0001ad10: 5f63 6f6c 6c65 6374 696f 6e32 290a 0a20  _collection2).. 
+0001ad20: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
+0001ad30: 745f 6964 5f75 6e69 636f 6465 5f76 616c  t_id_unicode_val
+0001ad40: 6964 6174 696f 6e28 7365 6c66 293a 0a20  idation(self):. 
+0001ad50: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+0001ad60: 6461 7461 6261 7365 0a20 2020 2020 2020  database.       
+0001ad70: 2063 7265 6174 6564 5f64 6220 3d20 7365   created_db = se
+0001ad80: 6c66 2e64 6174 6162 6173 6546 6f72 5465  lf.databaseForTe
+0001ad90: 7374 0a0a 2020 2020 2020 2020 2320 756e  st..        # un
+0001ada0: 6963 6f64 6520 6368 6172 7320 696e 2048  icode chars in H
+0001adb0: 696e 6469 2066 6f72 2049 6420 7768 6963  indi for Id whic
+0001adc0: 6820 7472 616e 736c 6174 6573 2074 6f3a  h translates to:
+0001add0: 2022 4869 6e64 6920 6973 2074 6865 206e   "Hindi is the n
+0001ade0: 6174 696f 6e61 6c20 6c61 6e67 7561 6765  ational language
+0001adf0: 206f 6620 496e 6469 6122 0a20 2020 2020   of India".     
+0001ae00: 2020 2063 6f6c 6c65 6374 696f 6e5f 6964     collection_id
+0001ae10: 3120 3d20 7527 e0a4 b9e0 a4bf e0a4 a8e0  1 = u'..........
+0001ae20: a58d e0a4 a6e0 a580 20e0 a4ad e0a4 bee0  ........ .......
+0001ae30: a4b0 e0a4 a420 e0a4 95e0 a580 20e0 a4b0  ..... ...... ...
+0001ae40: e0a4 bee0 a4b7 e0a5 8de0 a49f e0a5 8de0  ................
+0001ae50: a4b0 e0a5 80e0 a4af 20e0 a4ad e0a4 bee0  ........ .......
+0001ae60: a4b7 e0a4 be20 e0a4 b9e0 a588 2720 2320  ..... ......' # 
+0001ae70: 6373 7065 6c6c 3a64 6973 6162 6c65 2d6c  cspell:disable-l
+0001ae80: 696e 650a 0a20 2020 2020 2020 2023 2053  ine..        # S
+0001ae90: 7065 6369 616c 2063 6861 7273 2066 6f72  pecial chars for
+0001aea0: 2049 640a 2020 2020 2020 2020 636f 6c6c   Id.        coll
+0001aeb0: 6563 7469 6f6e 5f69 6432 203d 2022 2140  ection_id2 = "!@
+0001aec0: 2425 5e26 2a28 292d 7e60 275f 5b5d 7b7d  $%^&*()-~`'_[]{}
+0001aed0: 7c3b 3a2c 2e3c 3e22 0a0a 2020 2020 2020  |;:,.<>"..      
+0001aee0: 2020 2320 7665 7269 6679 2074 6861 7420    # verify that 
+0001aef0: 636f 6c6c 6563 7469 6f6e 7320 6172 6520  collections are 
+0001af00: 6372 6561 7465 6420 7769 7468 2073 7065  created with spe
+0001af10: 6369 6669 6564 2049 4473 0a20 2020 2020  cified IDs.     
+0001af20: 2020 2063 7265 6174 6564 5f63 6f6c 6c65     created_colle
+0001af30: 6374 696f 6e31 203d 2061 7761 6974 2063  ction1 = await c
+0001af40: 7265 6174 6564 5f64 622e 6372 6561 7465  reated_db.create
+0001af50: 5f63 6f6e 7461 696e 6572 280a 2020 2020  _container(.    
+0001af60: 2020 2020 2020 2020 6964 3d63 6f6c 6c65          id=colle
+0001af70: 6374 696f 6e5f 6964 312c 0a20 2020 2020  ction_id1,.     
+0001af80: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+0001af90: 5f6b 6579 3d50 6172 7469 7469 6f6e 4b65  _key=PartitionKe
+0001afa0: 7928 7061 7468 3d27 2f69 6427 2c20 6b69  y(path='/id', ki
+0001afb0: 6e64 3d27 4861 7368 2729 0a20 2020 2020  nd='Hash').     
+0001afc0: 2020 2029 0a20 2020 2020 2020 2063 7265     ).        cre
+0001afd0: 6174 6564 5f63 6f6c 6c65 6374 696f 6e32  ated_collection2
+0001afe0: 203d 2061 7761 6974 2063 7265 6174 6564   = await created
+0001aff0: 5f64 622e 6372 6561 7465 5f63 6f6e 7461  _db.create_conta
+0001b000: 696e 6572 280a 2020 2020 2020 2020 2020  iner(.          
+0001b010: 2020 6964 3d63 6f6c 6c65 6374 696f 6e5f    id=collection_
+0001b020: 6964 322c 0a20 2020 2020 2020 2020 2020  id2,.           
+0001b030: 2070 6172 7469 7469 6f6e 5f6b 6579 3d50   partition_key=P
+0001b040: 6172 7469 7469 6f6e 4b65 7928 7061 7468  artitionKey(path
+0001b050: 3d27 2f69 6427 2c20 6b69 6e64 3d27 4861  ='/id', kind='Ha
+0001b060: 7368 2729 0a20 2020 2020 2020 2029 0a0a  sh').        )..
+0001b070: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001b080: 6572 7445 7175 616c 2863 6f6c 6c65 6374  ertEqual(collect
+0001b090: 696f 6e5f 6964 312c 2063 7265 6174 6564  ion_id1, created
+0001b0a0: 5f63 6f6c 6c65 6374 696f 6e31 2e69 6429  _collection1.id)
+0001b0b0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001b0c0: 7365 7274 4571 7561 6c28 636f 6c6c 6563  sertEqual(collec
+0001b0d0: 7469 6f6e 5f69 6432 2c20 6372 6561 7465  tion_id2, create
+0001b0e0: 645f 636f 6c6c 6563 7469 6f6e 322e 6964  d_collection2.id
+0001b0f0: 290a 0a20 2020 2020 2020 2063 7265 6174  )..        creat
+0001b100: 6564 5f63 6f6c 6c65 6374 696f 6e31 5f70  ed_collection1_p
+0001b110: 726f 7065 7274 6965 7320 3d20 6177 6169  roperties = awai
+0001b120: 7420 6372 6561 7465 645f 636f 6c6c 6563  t created_collec
+0001b130: 7469 6f6e 312e 7265 6164 2829 0a20 2020  tion1.read().   
+0001b140: 2020 2020 2063 7265 6174 6564 5f63 6f6c       created_col
+0001b150: 6c65 6374 696f 6e32 5f70 726f 7065 7274  lection2_propert
+0001b160: 6965 7320 3d20 6177 6169 7420 6372 6561  ies = await crea
+0001b170: 7465 645f 636f 6c6c 6563 7469 6f6e 322e  ted_collection2.
+0001b180: 7265 6164 2829 0a0a 2020 2020 2020 2020  read()..        
+0001b190: 6177 6169 7420 6372 6561 7465 645f 6462  await created_db
+0001b1a0: 2e64 656c 6574 655f 636f 6e74 6169 6e65  .delete_containe
+0001b1b0: 7228 6372 6561 7465 645f 636f 6c6c 6563  r(created_collec
+0001b1c0: 7469 6f6e 315f 7072 6f70 6572 7469 6573  tion1_properties
+0001b1d0: 290a 2020 2020 2020 2020 6177 6169 7420  ).        await 
+0001b1e0: 6372 6561 7465 645f 6462 2e64 656c 6574  created_db.delet
+0001b1f0: 655f 636f 6e74 6169 6e65 7228 6372 6561  e_container(crea
+0001b200: 7465 645f 636f 6c6c 6563 7469 6f6e 325f  ted_collection2_
+0001b210: 7072 6f70 6572 7469 6573 290a 0a20 2020  properties)..   
+0001b220: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
+0001b230: 6765 745f 7265 736f 7572 6365 5f77 6974  get_resource_wit
+0001b240: 685f 6469 6374 696f 6e61 7279 5f61 6e64  h_dictionary_and
+0001b250: 5f6f 626a 6563 7428 7365 6c66 293a 0a20  _object(self):. 
+0001b260: 2020 2020 2020 2063 7265 6174 6564 5f64         created_d
+0001b270: 6220 3d20 7365 6c66 2e64 6174 6162 6173  b = self.databas
+0001b280: 6546 6f72 5465 7374 0a0a 2020 2020 2020  eForTest..      
+0001b290: 2020 2320 7265 6164 2064 6174 6162 6173    # read databas
+0001b2a0: 6520 7769 7468 2069 640a 2020 2020 2020  e with id.      
+0001b2b0: 2020 7265 6164 5f64 6220 3d20 7365 6c66    read_db = self
+0001b2c0: 2e63 6c69 656e 742e 6765 745f 6461 7461  .client.get_data
+0001b2d0: 6261 7365 5f63 6c69 656e 7428 6372 6561  base_client(crea
+0001b2e0: 7465 645f 6462 2e69 6429 0a20 2020 2020  ted_db.id).     
+0001b2f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0001b300: 7561 6c28 7265 6164 5f64 622e 6964 2c20  ual(read_db.id, 
+0001b310: 6372 6561 7465 645f 6462 2e69 6429 0a0a  created_db.id)..
+0001b320: 2020 2020 2020 2020 2320 7265 6164 2064          # read d
+0001b330: 6174 6162 6173 6520 7769 7468 2069 6e73  atabase with ins
+0001b340: 7461 6e63 650a 2020 2020 2020 2020 7265  tance.        re
+0001b350: 6164 5f64 6220 3d20 7365 6c66 2e63 6c69  ad_db = self.cli
+0001b360: 656e 742e 6765 745f 6461 7461 6261 7365  ent.get_database
+0001b370: 5f63 6c69 656e 7428 6372 6561 7465 645f  _client(created_
+0001b380: 6462 290a 2020 2020 2020 2020 7365 6c66  db).        self
+0001b390: 2e61 7373 6572 7445 7175 616c 2872 6561  .assertEqual(rea
+0001b3a0: 645f 6462 2e69 642c 2063 7265 6174 6564  d_db.id, created
+0001b3b0: 5f64 622e 6964 290a 0a20 2020 2020 2020  _db.id)..       
+0001b3c0: 2023 2072 6561 6420 6461 7461 6261 7365   # read database
+0001b3d0: 2077 6974 6820 7072 6f70 6572 7469 6573   with properties
+0001b3e0: 0a20 2020 2020 2020 2072 6561 645f 6462  .        read_db
+0001b3f0: 203d 2073 656c 662e 636c 6965 6e74 2e67   = self.client.g
+0001b400: 6574 5f64 6174 6162 6173 655f 636c 6965  et_database_clie
+0001b410: 6e74 2861 7761 6974 2063 7265 6174 6564  nt(await created
+0001b420: 5f64 622e 7265 6164 2829 290a 2020 2020  _db.read()).    
+0001b430: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001b440: 7175 616c 2872 6561 645f 6462 2e69 642c  qual(read_db.id,
+0001b450: 2063 7265 6174 6564 5f64 622e 6964 290a   created_db.id).
+0001b460: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+0001b470: 5f63 6f6e 7461 696e 6572 203d 2061 7761  _container = awa
+0001b480: 6974 2073 656c 662e 6461 7461 6261 7365  it self.database
+0001b490: 466f 7254 6573 742e 6372 6561 7465 5f63  ForTest.create_c
+0001b4a0: 6f6e 7461 696e 6572 2874 6573 745f 636f  ontainer(test_co
+0001b4b0: 6e66 6967 2e5f 7465 7374 5f63 6f6e 6669  nfig._test_confi
+0001b4c0: 672e 5445 5354 5f43 4f4c 4c45 4354 494f  g.TEST_COLLECTIO
+0001b4d0: 4e5f 4d55 4c54 495f 5041 5254 4954 494f  N_MULTI_PARTITIO
+0001b4e0: 4e2c 2050 6172 7469 7469 6f6e 4b65 7928  N, PartitionKey(
+0001b4f0: 7061 7468 3d22 2f69 6422 2929 0a0a 2020  path="/id"))..  
+0001b500: 2020 2020 2020 2320 7265 6164 2063 6f6e        # read con
+0001b510: 7461 696e 6572 2077 6974 6820 6964 0a20  tainer with id. 
+0001b520: 2020 2020 2020 2072 6561 645f 636f 6e74         read_cont
+0001b530: 6169 6e65 7220 3d20 6372 6561 7465 645f  ainer = created_
+0001b540: 6462 2e67 6574 5f63 6f6e 7461 696e 6572  db.get_container
+0001b550: 5f63 6c69 656e 7428 6372 6561 7465 645f  _client(created_
+0001b560: 636f 6e74 6169 6e65 722e 6964 290a 2020  container.id).  
+0001b570: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001b580: 7445 7175 616c 2872 6561 645f 636f 6e74  tEqual(read_cont
+0001b590: 6169 6e65 722e 6964 2c20 6372 6561 7465  ainer.id, create
+0001b5a0: 645f 636f 6e74 6169 6e65 722e 6964 290a  d_container.id).
+0001b5b0: 0a20 2020 2020 2020 2023 2072 6561 6420  .        # read 
+0001b5c0: 636f 6e74 6169 6e65 7220 7769 7468 2069  container with i
+0001b5d0: 6e73 7461 6e63 650a 2020 2020 2020 2020  nstance.        
+0001b5e0: 7265 6164 5f63 6f6e 7461 696e 6572 203d  read_container =
+0001b5f0: 2063 7265 6174 6564 5f64 622e 6765 745f   created_db.get_
+0001b600: 636f 6e74 6169 6e65 725f 636c 6965 6e74  container_client
+0001b610: 2863 7265 6174 6564 5f63 6f6e 7461 696e  (created_contain
+0001b620: 6572 290a 2020 2020 2020 2020 7365 6c66  er).        self
+0001b630: 2e61 7373 6572 7445 7175 616c 2872 6561  .assertEqual(rea
+0001b640: 645f 636f 6e74 6169 6e65 722e 6964 2c20  d_container.id, 
+0001b650: 6372 6561 7465 645f 636f 6e74 6169 6e65  created_containe
+0001b660: 722e 6964 290a 0a20 2020 2020 2020 2023  r.id)..        #
+0001b670: 2072 6561 6420 636f 6e74 6169 6e65 7220   read container 
+0001b680: 7769 7468 2070 726f 7065 7274 6965 730a  with properties.
+0001b690: 2020 2020 2020 2020 6372 6561 7465 645f          created_
+0001b6a0: 7072 6f70 6572 7469 6573 203d 2061 7761  properties = awa
+0001b6b0: 6974 2063 7265 6174 6564 5f63 6f6e 7461  it created_conta
+0001b6c0: 696e 6572 2e72 6561 6428 290a 2020 2020  iner.read().    
+0001b6d0: 2020 2020 7265 6164 5f63 6f6e 7461 696e      read_contain
+0001b6e0: 6572 203d 2063 7265 6174 6564 5f64 622e  er = created_db.
+0001b6f0: 6765 745f 636f 6e74 6169 6e65 725f 636c  get_container_cl
+0001b700: 6965 6e74 2863 7265 6174 6564 5f70 726f  ient(created_pro
+0001b710: 7065 7274 6965 7329 0a20 2020 2020 2020  perties).       
+0001b720: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0001b730: 6c28 7265 6164 5f63 6f6e 7461 696e 6572  l(read_container
+0001b740: 2e69 642c 2063 7265 6174 6564 5f63 6f6e  .id, created_con
+0001b750: 7461 696e 6572 2e69 6429 0a0a 2020 2020  tainer.id)..    
+0001b760: 2020 2020 6372 6561 7465 645f 6974 656d      created_item
+0001b770: 203d 2061 7761 6974 2063 7265 6174 6564   = await created
+0001b780: 5f63 6f6e 7461 696e 6572 2e63 7265 6174  _container.creat
+0001b790: 655f 6974 656d 287b 2769 6427 3a20 2731  e_item({'id': '1
+0001b7a0: 2720 2b20 7374 7228 7575 6964 2e75 7569  ' + str(uuid.uui
+0001b7b0: 6434 2829 297d 290a 0a20 2020 2020 2020  d4())})..       
+0001b7c0: 2023 2072 6561 6420 6974 656d 2077 6974   # read item wit
+0001b7d0: 6820 6964 0a20 2020 2020 2020 2072 6561  h id.        rea
+0001b7e0: 645f 6974 656d 203d 2061 7761 6974 2063  d_item = await c
+0001b7f0: 7265 6174 6564 5f63 6f6e 7461 696e 6572  reated_container
+0001b800: 2e72 6561 645f 6974 656d 2869 7465 6d3d  .read_item(item=
+0001b810: 6372 6561 7465 645f 6974 656d 5b27 6964  created_item['id
+0001b820: 275d 2c20 7061 7274 6974 696f 6e5f 6b65  '], partition_ke
+0001b830: 793d 6372 6561 7465 645f 6974 656d 5b27  y=created_item['
+0001b840: 6964 275d 290a 2020 2020 2020 2020 7365  id']).        se
+0001b850: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+0001b860: 6561 645f 6974 656d 5b27 6964 275d 2c20  ead_item['id'], 
+0001b870: 6372 6561 7465 645f 6974 656d 5b27 6964  created_item['id
+0001b880: 275d 290a 0a20 2020 2020 2020 2023 2072  '])..        # r
+0001b890: 6561 6420 6974 656d 2077 6974 6820 7072  ead item with pr
+0001b8a0: 6f70 6572 7469 6573 0a20 2020 2020 2020  operties.       
+0001b8b0: 2072 6561 645f 6974 656d 203d 2061 7761   read_item = awa
+0001b8c0: 6974 2063 7265 6174 6564 5f63 6f6e 7461  it created_conta
+0001b8d0: 696e 6572 2e72 6561 645f 6974 656d 2869  iner.read_item(i
+0001b8e0: 7465 6d3d 6372 6561 7465 645f 6974 656d  tem=created_item
+0001b8f0: 2c20 7061 7274 6974 696f 6e5f 6b65 793d  , partition_key=
+0001b900: 6372 6561 7465 645f 6974 656d 5b27 6964  created_item['id
+0001b910: 275d 290a 2020 2020 2020 2020 7365 6c66  ']).        self
+0001b920: 2e61 7373 6572 7445 7175 616c 2872 6561  .assertEqual(rea
+0001b930: 645f 6974 656d 5b27 6964 275d 2c20 6372  d_item['id'], cr
+0001b940: 6561 7465 645f 6974 656d 5b27 6964 275d  eated_item['id']
+0001b950: 290a 0a20 2020 2020 2020 2063 7265 6174  )..        creat
+0001b960: 6564 5f73 7072 6f63 203d 2061 7761 6974  ed_sproc = await
+0001b970: 2063 7265 6174 6564 5f63 6f6e 7461 696e   created_contain
+0001b980: 6572 2e73 6372 6970 7473 2e63 7265 6174  er.scripts.creat
+0001b990: 655f 7374 6f72 6564 5f70 726f 6365 6475  e_stored_procedu
+0001b9a0: 7265 287b 0a20 2020 2020 2020 2020 2020  re({.           
+0001b9b0: 2027 6964 273a 2027 7374 6f72 6564 5072   'id': 'storedPr
+0001b9c0: 6f63 6564 7572 6527 202b 2073 7472 2875  ocedure' + str(u
+0001b9d0: 7569 642e 7575 6964 3428 2929 2c0a 2020  uid.uuid4()),.  
+0001b9e0: 2020 2020 2020 2020 2020 2762 6f64 7927            'body'
+0001b9f0: 3a20 2766 756e 6374 696f 6e20 2829 207b  : 'function () {
+0001ba00: 207d 270a 2020 2020 2020 2020 7d29 0a0a   }'.        })..
+0001ba10: 2020 2020 2020 2020 2320 7265 6164 2073          # read s
+0001ba20: 7072 6f63 2077 6974 6820 6964 0a20 2020  proc with id.   
+0001ba30: 2020 2020 2072 6561 645f 7370 726f 6320       read_sproc 
+0001ba40: 3d20 6177 6169 7420 6372 6561 7465 645f  = await created_
+0001ba50: 636f 6e74 6169 6e65 722e 7363 7269 7074  container.script
+0001ba60: 732e 6765 745f 7374 6f72 6564 5f70 726f  s.get_stored_pro
+0001ba70: 6365 6475 7265 2863 7265 6174 6564 5f73  cedure(created_s
+0001ba80: 7072 6f63 5b27 6964 275d 290a 2020 2020  proc['id']).    
+0001ba90: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001baa0: 7175 616c 2872 6561 645f 7370 726f 635b  qual(read_sproc[
+0001bab0: 2769 6427 5d2c 2063 7265 6174 6564 5f73  'id'], created_s
+0001bac0: 7072 6f63 5b27 6964 275d 290a 0a20 2020  proc['id'])..   
+0001bad0: 2020 2020 2023 2072 6561 6420 7370 726f       # read spro
+0001bae0: 6320 7769 7468 2070 726f 7065 7274 6965  c with propertie
+0001baf0: 730a 2020 2020 2020 2020 7265 6164 5f73  s.        read_s
+0001bb00: 7072 6f63 203d 2061 7761 6974 2063 7265  proc = await cre
+0001bb10: 6174 6564 5f63 6f6e 7461 696e 6572 2e73  ated_container.s
+0001bb20: 6372 6970 7473 2e67 6574 5f73 746f 7265  cripts.get_store
+0001bb30: 645f 7072 6f63 6564 7572 6528 6372 6561  d_procedure(crea
+0001bb40: 7465 645f 7370 726f 6329 0a20 2020 2020  ted_sproc).     
+0001bb50: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0001bb60: 7561 6c28 7265 6164 5f73 7072 6f63 5b27  ual(read_sproc['
+0001bb70: 6964 275d 2c20 6372 6561 7465 645f 7370  id'], created_sp
+0001bb80: 726f 635b 2769 6427 5d29 0a0a 2020 2020  roc['id'])..    
+0001bb90: 2020 2020 6372 6561 7465 645f 7472 6967      created_trig
+0001bba0: 6765 7220 3d20 6177 6169 7420 6372 6561  ger = await crea
+0001bbb0: 7465 645f 636f 6e74 6169 6e65 722e 7363  ted_container.sc
+0001bbc0: 7269 7074 732e 6372 6561 7465 5f74 7269  ripts.create_tri
+0001bbd0: 6767 6572 287b 0a20 2020 2020 2020 2020  gger({.         
+0001bbe0: 2020 2027 6964 273a 2027 7361 6d70 6c65     'id': 'sample
+0001bbf0: 2074 7269 6767 6572 2720 2b20 7374 7228   trigger' + str(
+0001bc00: 7575 6964 2e75 7569 6434 2829 292c 0a20  uuid.uuid4()),. 
+0001bc10: 2020 2020 2020 2020 2020 2027 7365 7276             'serv
+0001bc20: 6572 5363 7269 7074 273a 2027 6675 6e63  erScript': 'func
+0001bc30: 7469 6f6e 2829 207b 7661 7220 7820 3d20  tion() {var x = 
+0001bc40: 3130 3b7d 272c 0a20 2020 2020 2020 2020  10;}',.         
+0001bc50: 2020 2027 7472 6967 6765 7254 7970 6527     'triggerType'
+0001bc60: 3a20 646f 6375 6d65 6e74 732e 5472 6967  : documents.Trig
+0001bc70: 6765 7254 7970 652e 5072 652c 0a20 2020  gerType.Pre,.   
+0001bc80: 2020 2020 2020 2020 2027 7472 6967 6765           'trigge
+0001bc90: 724f 7065 7261 7469 6f6e 273a 2064 6f63  rOperation': doc
+0001bca0: 756d 656e 7473 2e54 7269 6767 6572 4f70  uments.TriggerOp
+0001bcb0: 6572 6174 696f 6e2e 416c 6c0a 2020 2020  eration.All.    
+0001bcc0: 2020 2020 7d29 0a0a 2020 2020 2020 2020      })..        
+0001bcd0: 2320 7265 6164 2074 7269 6767 6572 2077  # read trigger w
+0001bce0: 6974 6820 6964 0a20 2020 2020 2020 2072  ith id.        r
+0001bcf0: 6561 645f 7472 6967 6765 7220 3d20 6177  ead_trigger = aw
+0001bd00: 6169 7420 6372 6561 7465 645f 636f 6e74  ait created_cont
+0001bd10: 6169 6e65 722e 7363 7269 7074 732e 6765  ainer.scripts.ge
+0001bd20: 745f 7472 6967 6765 7228 6372 6561 7465  t_trigger(create
+0001bd30: 645f 7472 6967 6765 725b 2769 6427 5d29  d_trigger['id'])
+0001bd40: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001bd50: 7365 7274 4571 7561 6c28 7265 6164 5f74  sertEqual(read_t
+0001bd60: 7269 6767 6572 5b27 6964 275d 2c20 6372  rigger['id'], cr
+0001bd70: 6561 7465 645f 7472 6967 6765 725b 2769  eated_trigger['i
+0001bd80: 6427 5d29 0a0a 2020 2020 2020 2020 2320  d'])..        # 
+0001bd90: 7265 6164 2074 7269 6767 6572 2077 6974  read trigger wit
+0001bda0: 6820 7072 6f70 6572 7469 6573 0a20 2020  h properties.   
+0001bdb0: 2020 2020 2072 6561 645f 7472 6967 6765       read_trigge
+0001bdc0: 7220 3d20 6177 6169 7420 6372 6561 7465  r = await create
+0001bdd0: 645f 636f 6e74 6169 6e65 722e 7363 7269  d_container.scri
+0001bde0: 7074 732e 6765 745f 7472 6967 6765 7228  pts.get_trigger(
+0001bdf0: 6372 6561 7465 645f 7472 6967 6765 7229  created_trigger)
+0001be00: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001be10: 7365 7274 4571 7561 6c28 7265 6164 5f74  sertEqual(read_t
+0001be20: 7269 6767 6572 5b27 6964 275d 2c20 6372  rigger['id'], cr
+0001be30: 6561 7465 645f 7472 6967 6765 725b 2769  eated_trigger['i
+0001be40: 6427 5d29 0a0a 2020 2020 2020 2020 6372  d'])..        cr
+0001be50: 6561 7465 645f 7564 6620 3d20 6177 6169  eated_udf = awai
+0001be60: 7420 6372 6561 7465 645f 636f 6e74 6169  t created_contai
+0001be70: 6e65 722e 7363 7269 7074 732e 6372 6561  ner.scripts.crea
+0001be80: 7465 5f75 7365 725f 6465 6669 6e65 645f  te_user_defined_
+0001be90: 6675 6e63 7469 6f6e 287b 0a20 2020 2020  function({.     
+0001bea0: 2020 2020 2020 2027 6964 273a 2027 7361         'id': 'sa
+0001beb0: 6d70 6c65 2075 6466 2720 2b20 7374 7228  mple udf' + str(
+0001bec0: 7575 6964 2e75 7569 6434 2829 292c 0a20  uuid.uuid4()),. 
+0001bed0: 2020 2020 2020 2020 2020 2027 626f 6479             'body
+0001bee0: 273a 2027 6675 6e63 7469 6f6e 2829 207b  ': 'function() {
+0001bef0: 7661 7220 7820 3d20 3130 3b7d 270a 2020  var x = 10;}'.  
+0001bf00: 2020 2020 2020 7d29 0a0a 2020 2020 2020        })..      
+0001bf10: 2020 2320 7265 6164 2075 6466 2077 6974    # read udf wit
+0001bf20: 6820 6964 0a20 2020 2020 2020 2072 6561  h id.        rea
+0001bf30: 645f 7564 6620 3d20 6177 6169 7420 6372  d_udf = await cr
+0001bf40: 6561 7465 645f 636f 6e74 6169 6e65 722e  eated_container.
+0001bf50: 7363 7269 7074 732e 6765 745f 7573 6572  scripts.get_user
+0001bf60: 5f64 6566 696e 6564 5f66 756e 6374 696f  _defined_functio
+0001bf70: 6e28 6372 6561 7465 645f 7564 665b 2769  n(created_udf['i
+0001bf80: 6427 5d29 0a20 2020 2020 2020 2073 656c  d']).        sel
+0001bf90: 662e 6173 7365 7274 4571 7561 6c28 6372  f.assertEqual(cr
+0001bfa0: 6561 7465 645f 7564 665b 2769 6427 5d2c  eated_udf['id'],
+0001bfb0: 2072 6561 645f 7564 665b 2769 6427 5d29   read_udf['id'])
+0001bfc0: 0a0a 2020 2020 2020 2020 2320 7265 6164  ..        # read
+0001bfd0: 2075 6466 2077 6974 6820 7072 6f70 6572   udf with proper
+0001bfe0: 7469 6573 0a20 2020 2020 2020 2072 6561  ties.        rea
+0001bff0: 645f 7564 6620 3d20 6177 6169 7420 6372  d_udf = await cr
+0001c000: 6561 7465 645f 636f 6e74 6169 6e65 722e  eated_container.
+0001c010: 7363 7269 7074 732e 6765 745f 7573 6572  scripts.get_user
+0001c020: 5f64 6566 696e 6564 5f66 756e 6374 696f  _defined_functio
+0001c030: 6e28 6372 6561 7465 645f 7564 6629 0a20  n(created_udf). 
+0001c040: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001c050: 7274 4571 7561 6c28 6372 6561 7465 645f  rtEqual(created_
+0001c060: 7564 665b 2769 6427 5d2c 2072 6561 645f  udf['id'], read_
+0001c070: 7564 665b 2769 6427 5d29 0a0a 2020 2020  udf['id'])..    
+0001c080: 2020 2020 6372 6561 7465 645f 7573 6572      created_user
+0001c090: 203d 2061 7761 6974 2063 7265 6174 6564   = await created
+0001c0a0: 5f64 622e 6372 6561 7465 5f75 7365 7228  _db.create_user(
+0001c0b0: 7b0a 2020 2020 2020 2020 2020 2020 2769  {.            'i
+0001c0c0: 6427 3a20 2775 7365 7227 202b 2073 7472  d': 'user' + str
+0001c0d0: 2875 7569 642e 7575 6964 3428 2929 0a20  (uuid.uuid4()). 
+0001c0e0: 2020 2020 2020 207d 290a 0a20 2020 2020         })..     
+0001c0f0: 2020 2023 2072 6561 6420 7573 6572 2077     # read user w
+0001c100: 6974 6820 6964 0a20 2020 2020 2020 2072  ith id.        r
+0001c110: 6561 645f 7573 6572 203d 2063 7265 6174  ead_user = creat
+0001c120: 6564 5f64 622e 6765 745f 7573 6572 5f63  ed_db.get_user_c
+0001c130: 6c69 656e 7428 6372 6561 7465 645f 7573  lient(created_us
+0001c140: 6572 2e69 6429 0a20 2020 2020 2020 2073  er.id).        s
+0001c150: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001c160: 7265 6164 5f75 7365 722e 6964 2c20 6372  read_user.id, cr
+0001c170: 6561 7465 645f 7573 6572 2e69 6429 0a0a  eated_user.id)..
+0001c180: 2020 2020 2020 2020 2320 7265 6164 2075          # read u
+0001c190: 7365 7220 7769 7468 2069 6e73 7461 6e63  ser with instanc
+0001c1a0: 650a 2020 2020 2020 2020 7265 6164 5f75  e.        read_u
+0001c1b0: 7365 7220 3d20 6372 6561 7465 645f 6462  ser = created_db
+0001c1c0: 2e67 6574 5f75 7365 725f 636c 6965 6e74  .get_user_client
+0001c1d0: 2863 7265 6174 6564 5f75 7365 7229 0a20  (created_user). 
+0001c1e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001c1f0: 7274 4571 7561 6c28 7265 6164 5f75 7365  rtEqual(read_use
+0001c200: 722e 6964 2c20 6372 6561 7465 645f 7573  r.id, created_us
+0001c210: 6572 2e69 6429 0a0a 2020 2020 2020 2020  er.id)..        
+0001c220: 2320 7265 6164 2075 7365 7220 7769 7468  # read user with
+0001c230: 2070 726f 7065 7274 6965 730a 2020 2020   properties.    
+0001c240: 2020 2020 6372 6561 7465 645f 7573 6572      created_user
+0001c250: 5f70 726f 7065 7274 6965 7320 3d20 6177  _properties = aw
+0001c260: 6169 7420 6372 6561 7465 645f 7573 6572  ait created_user
+0001c270: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
+0001c280: 7265 6164 5f75 7365 7220 3d20 6372 6561  read_user = crea
+0001c290: 7465 645f 6462 2e67 6574 5f75 7365 725f  ted_db.get_user_
+0001c2a0: 636c 6965 6e74 2863 7265 6174 6564 5f75  client(created_u
+0001c2b0: 7365 725f 7072 6f70 6572 7469 6573 290a  ser_properties).
+0001c2c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001c2d0: 6572 7445 7175 616c 2872 6561 645f 7573  ertEqual(read_us
+0001c2e0: 6572 2e69 642c 2063 7265 6174 6564 5f75  er.id, created_u
+0001c2f0: 7365 722e 6964 290a 0a20 2020 2020 2020  ser.id)..       
+0001c300: 2063 7265 6174 6564 5f70 6572 6d69 7373   created_permiss
+0001c310: 696f 6e20 3d20 6177 6169 7420 6372 6561  ion = await crea
+0001c320: 7465 645f 7573 6572 2e63 7265 6174 655f  ted_user.create_
+0001c330: 7065 726d 6973 7369 6f6e 287b 0a20 2020  permission({.   
+0001c340: 2020 2020 2020 2020 2027 6964 273a 2027           'id': '
+0001c350: 616c 6c20 7065 726d 6973 7369 6f6e 2720  all permission' 
+0001c360: 2b20 7374 7228 7575 6964 2e75 7569 6434  + str(uuid.uuid4
+0001c370: 2829 292c 0a20 2020 2020 2020 2020 2020  ()),.           
+0001c380: 2027 7065 726d 6973 7369 6f6e 4d6f 6465   'permissionMode
+0001c390: 273a 2064 6f63 756d 656e 7473 2e50 6572  ': documents.Per
+0001c3a0: 6d69 7373 696f 6e4d 6f64 652e 416c 6c2c  missionMode.All,
+0001c3b0: 0a20 2020 2020 2020 2020 2020 2027 7265  .            're
+0001c3c0: 736f 7572 6365 273a 2063 7265 6174 6564  source': created
+0001c3d0: 5f63 6f6e 7461 696e 6572 2e63 6f6e 7461  _container.conta
+0001c3e0: 696e 6572 5f6c 696e 6b2c 0a20 2020 2020  iner_link,.     
+0001c3f0: 2020 2020 2020 2027 7265 736f 7572 6365         'resource
+0001c400: 5061 7274 6974 696f 6e4b 6579 273a 205b  PartitionKey': [
+0001c410: 315d 0a20 2020 2020 2020 207d 290a 0a20  1].        }).. 
+0001c420: 2020 2020 2020 2023 2072 6561 6420 7065         # read pe
+0001c430: 726d 6973 7369 6f6e 2077 6974 6820 6964  rmission with id
+0001c440: 0a20 2020 2020 2020 2072 6561 645f 7065  .        read_pe
+0001c450: 726d 6973 7369 6f6e 203d 2061 7761 6974  rmission = await
+0001c460: 2063 7265 6174 6564 5f75 7365 722e 6765   created_user.ge
+0001c470: 745f 7065 726d 6973 7369 6f6e 2863 7265  t_permission(cre
+0001c480: 6174 6564 5f70 6572 6d69 7373 696f 6e2e  ated_permission.
+0001c490: 6964 290a 2020 2020 2020 2020 7365 6c66  id).        self
+0001c4a0: 2e61 7373 6572 7445 7175 616c 2872 6561  .assertEqual(rea
+0001c4b0: 645f 7065 726d 6973 7369 6f6e 2e69 642c  d_permission.id,
+0001c4c0: 2063 7265 6174 6564 5f70 6572 6d69 7373   created_permiss
+0001c4d0: 696f 6e2e 6964 290a 0a20 2020 2020 2020  ion.id)..       
+0001c4e0: 2023 2072 6561 6420 7065 726d 6973 7369   # read permissi
+0001c4f0: 6f6e 2077 6974 6820 696e 7374 616e 6365  on with instance
+0001c500: 0a20 2020 2020 2020 2072 6561 645f 7065  .        read_pe
+0001c510: 726d 6973 7369 6f6e 203d 2061 7761 6974  rmission = await
+0001c520: 2063 7265 6174 6564 5f75 7365 722e 6765   created_user.ge
+0001c530: 745f 7065 726d 6973 7369 6f6e 2863 7265  t_permission(cre
+0001c540: 6174 6564 5f70 6572 6d69 7373 696f 6e29  ated_permission)
+0001c550: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001c560: 7365 7274 4571 7561 6c28 7265 6164 5f70  sertEqual(read_p
+0001c570: 6572 6d69 7373 696f 6e2e 6964 2c20 6372  ermission.id, cr
+0001c580: 6561 7465 645f 7065 726d 6973 7369 6f6e  eated_permission
+0001c590: 2e69 6429 0a0a 2020 2020 2020 2020 2320  .id)..        # 
+0001c5a0: 7265 6164 2070 6572 6d69 7373 696f 6e20  read permission 
+0001c5b0: 7769 7468 2070 726f 7065 7274 6965 730a  with properties.
+0001c5c0: 2020 2020 2020 2020 7265 6164 5f70 6572          read_per
+0001c5d0: 6d69 7373 696f 6e20 3d20 6177 6169 7420  mission = await 
+0001c5e0: 6372 6561 7465 645f 7573 6572 2e67 6574  created_user.get
+0001c5f0: 5f70 6572 6d69 7373 696f 6e28 6372 6561  _permission(crea
+0001c600: 7465 645f 7065 726d 6973 7369 6f6e 2e70  ted_permission.p
+0001c610: 726f 7065 7274 6965 7329 0a20 2020 2020  roperties).     
+0001c620: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0001c630: 7561 6c28 7265 6164 5f70 6572 6d69 7373  ual(read_permiss
+0001c640: 696f 6e2e 6964 2c20 6372 6561 7465 645f  ion.id, created_
+0001c650: 7065 726d 6973 7369 6f6e 2e69 6429 0a0a  permission.id)..
+0001c660: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
+0001c670: 7374 5f64 656c 6574 655f 616c 6c5f 6974  st_delete_all_it
+0001c680: 656d 735f 6279 5f70 6172 7469 7469 6f6e  ems_by_partition
+0001c690: 5f6b 6579 2873 656c 6629 3a0a 2020 2020  _key(self):.    
+0001c6a0: 2020 2020 2320 6372 6561 7465 2064 6174      # create dat
+0001c6b0: 6162 6173 650a 2020 2020 2020 2020 6372  abase.        cr
+0001c6c0: 6561 7465 645f 6462 203d 2073 656c 662e  eated_db = self.
+0001c6d0: 6461 7461 6261 7365 466f 7254 6573 740a  databaseForTest.
+0001c6e0: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
+0001c6f0: 6520 636f 6e74 6169 6e65 720a 2020 2020  e container.    
+0001c700: 2020 2020 6372 6561 7465 645f 636f 6c6c      created_coll
+0001c710: 6563 7469 6f6e 203d 2061 7761 6974 2063  ection = await c
+0001c720: 7265 6174 6564 5f64 622e 6372 6561 7465  reated_db.create
+0001c730: 5f63 6f6e 7461 696e 6572 280a 2020 2020  _container(.    
+0001c740: 2020 2020 2020 2020 6964 3d27 7465 7374          id='test
+0001c750: 5f64 656c 6574 655f 616c 6c5f 6974 656d  _delete_all_item
+0001c760: 735f 6279 5f70 6172 7469 7469 6f6e 5f6b  s_by_partition_k
+0001c770: 6579 2027 202b 2073 7472 2875 7569 642e  ey ' + str(uuid.
+0001c780: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
+0001c790: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+0001c7a0: 6b65 793d 5061 7274 6974 696f 6e4b 6579  key=PartitionKey
+0001c7b0: 2870 6174 683d 272f 706b 272c 206b 696e  (path='/pk', kin
+0001c7c0: 643d 2748 6173 6827 290a 2020 2020 2020  d='Hash').      
+0001c7d0: 2020 290a 2020 2020 2020 2020 2320 4372    ).        # Cr
+0001c7e0: 6561 7465 2074 776f 2070 6172 7469 7469  eate two partiti
+0001c7f0: 6f6e 206b 6579 730a 2020 2020 2020 2020  on keys.        
+0001c800: 7061 7274 6974 696f 6e5f 6b65 7931 203d  partition_key1 =
+0001c810: 2022 7b7d 2d7b 7d22 2e66 6f72 6d61 7428   "{}-{}".format(
+0001c820: 2250 6172 7469 7469 6f6e 204b 6579 2031  "Partition Key 1
+0001c830: 222c 2073 7472 2875 7569 642e 7575 6964  ", str(uuid.uuid
+0001c840: 3428 2929 290a 2020 2020 2020 2020 7061  4())).        pa
+0001c850: 7274 6974 696f 6e5f 6b65 7932 203d 2022  rtition_key2 = "
+0001c860: 7b7d 2d7b 7d22 2e66 6f72 6d61 7428 2250  {}-{}".format("P
+0001c870: 6172 7469 7469 6f6e 204b 6579 2032 222c  artition Key 2",
+0001c880: 2073 7472 2875 7569 642e 7575 6964 3428   str(uuid.uuid4(
+0001c890: 2929 290a 0a20 2020 2020 2020 2023 2061  )))..        # a
+0001c8a0: 6464 2069 7465 6d73 2066 6f72 2070 6172  dd items for par
+0001c8b0: 7469 7469 6f6e 206b 6579 2031 0a20 2020  tition key 1.   
+0001c8c0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+0001c8d0: 6e67 6528 312c 2033 293a 0a20 2020 2020  nge(1, 3):.     
+0001c8e0: 2020 2020 2020 2061 7761 6974 2063 7265         await cre
+0001c8f0: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
+0001c900: 7570 7365 7274 5f69 7465 6d28 0a20 2020  upsert_item(.   
+0001c910: 2020 2020 2020 2020 2020 2020 2064 6963               dic
+0001c920: 7428 6964 3d22 6974 656d 7b7d 222e 666f  t(id="item{}".fo
+0001c930: 726d 6174 2869 292c 2070 6b3d 7061 7274  rmat(i), pk=part
+0001c940: 6974 696f 6e5f 6b65 7931 290a 2020 2020  ition_key1).    
+0001c950: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0001c960: 2020 2023 2061 6464 2069 7465 6d73 2066     # add items f
+0001c970: 6f72 2070 6172 7469 7469 6f6e 206b 6579  or partition key
+0001c980: 2032 0a20 2020 2020 2020 2070 6b32 5f69   2.        pk2_i
+0001c990: 7465 6d20 3d20 6177 6169 7420 6372 6561  tem = await crea
+0001c9a0: 7465 645f 636f 6c6c 6563 7469 6f6e 2e75  ted_collection.u
+0001c9b0: 7073 6572 745f 6974 656d 2864 6963 7428  psert_item(dict(
+0001c9c0: 6964 3d22 6974 656d 7b7d 222e 666f 726d  id="item{}".form
+0001c9d0: 6174 2833 292c 2070 6b3d 7061 7274 6974  at(3), pk=partit
+0001c9e0: 696f 6e5f 6b65 7932 2929 0a0a 2020 2020  ion_key2))..    
+0001c9f0: 2020 2020 2320 6465 6c65 7465 2061 6c6c      # delete all
+0001ca00: 2069 7465 6d73 2066 6f72 2070 6172 7469   items for parti
+0001ca10: 7469 6f6e 206b 6579 2031 0a20 2020 2020  tion key 1.     
+0001ca20: 2020 2061 7761 6974 2063 7265 6174 6564     await created
+0001ca30: 5f63 6f6c 6c65 6374 696f 6e2e 6465 6c65  _collection.dele
+0001ca40: 7465 5f61 6c6c 5f69 7465 6d73 5f62 795f  te_all_items_by_
+0001ca50: 7061 7274 6974 696f 6e5f 6b65 7928 7061  partition_key(pa
+0001ca60: 7274 6974 696f 6e5f 6b65 7931 290a 0a20  rtition_key1).. 
+0001ca70: 2020 2020 2020 2023 2063 6865 636b 2074         # check t
+0001ca80: 6861 7420 6f6e 6c79 2069 7465 6d73 2066  hat only items f
+0001ca90: 726f 6d20 7061 7274 6974 696f 6e20 6b65  rom partition ke
+0001caa0: 7920 3120 6861 7665 2062 6565 6e20 6465  y 1 have been de
+0001cab0: 6c65 7465 640a 2020 2020 2020 2020 6974  leted.        it
+0001cac0: 656d 7320 3d20 5b69 7465 6d20 6173 796e  ems = [item asyn
+0001cad0: 6320 666f 7220 6974 656d 2069 6e20 6372  c for item in cr
+0001cae0: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+0001caf0: 2e72 6561 645f 616c 6c5f 6974 656d 7328  .read_all_items(
+0001cb00: 295d 0a0a 2020 2020 2020 2020 2320 6974  )]..        # it
+0001cb10: 656d 7320 7368 6f75 6c64 206f 6e6c 7920  ems should only 
+0001cb20: 6861 7665 2031 2069 7465 6d2c 2061 6e64  have 1 item, and
+0001cb30: 2069 7420 7368 6f75 6c64 2065 7175 616c   it should equal
+0001cb40: 2070 6b32 5f69 7465 6d0a 2020 2020 2020   pk2_item.      
+0001cb50: 2020 7365 6c66 2e61 7373 6572 7444 6963    self.assertDic
+0001cb60: 7445 7175 616c 2870 6b32 5f69 7465 6d2c  tEqual(pk2_item,
+0001cb70: 2069 7465 6d73 5b30 5d29 0a0a 2020 2020   items[0])..    
+0001cb80: 2020 2020 2320 6174 7465 6d70 7469 6e67      # attempting
+0001cb90: 2074 6f20 6465 6c65 7465 2061 206e 6f6e   to delete a non
+0001cba0: 2d65 7869 7374 656e 7420 7061 7274 6974  -existent partit
+0001cbb0: 696f 6e20 6b65 7920 6f72 2070 6173 7369  ion key or passi
+0001cbc0: 6e67 206e 6f6e 6520 7368 6f75 6c64 206e  ng none should n
+0001cbd0: 6f74 2064 656c 6574 650a 2020 2020 2020  ot delete.      
+0001cbe0: 2020 2320 616e 7974 6869 6e67 2061 6e64    # anything and
+0001cbf0: 206c 6561 7665 2074 6869 6e67 7320 756e   leave things un
+0001cc00: 6368 616e 6765 640a 2020 2020 2020 2020  changed.        
+0001cc10: 6177 6169 7420 6372 6561 7465 645f 636f  await created_co
+0001cc20: 6c6c 6563 7469 6f6e 2e64 656c 6574 655f  llection.delete_
+0001cc30: 616c 6c5f 6974 656d 735f 6279 5f70 6172  all_items_by_par
+0001cc40: 7469 7469 6f6e 5f6b 6579 284e 6f6e 6529  tition_key(None)
+0001cc50: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
+0001cc60: 6b20 7468 6174 206e 6f20 6368 616e 6765  k that no change
+0001cc70: 7320 7765 7265 206d 6164 6520 6279 2063  s were made by c
+0001cc80: 6865 636b 696e 6720 6966 2074 6865 206f  hecking if the o
+0001cc90: 6e6c 7920 6974 656d 2069 7320 7374 696c  nly item is stil
+0001cca0: 6c20 7468 6572 650a 2020 2020 2020 2020  l there.        
+0001ccb0: 6974 656d 7320 3d20 5b69 7465 6d20 6173  items = [item as
+0001ccc0: 796e 6320 666f 7220 6974 656d 2069 6e20  ync for item in 
+0001ccd0: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
+0001cce0: 6f6e 2e72 6561 645f 616c 6c5f 6974 656d  on.read_all_item
+0001ccf0: 7328 295d 0a0a 2020 2020 2020 2020 2320  s()]..        # 
+0001cd00: 6974 656d 7320 7368 6f75 6c64 206f 6e6c  items should onl
+0001cd10: 7920 6861 7665 2031 2069 7465 6d2c 2061  y have 1 item, a
+0001cd20: 6e64 2069 7420 7368 6f75 6c64 2065 7175  nd it should equ
+0001cd30: 616c 2070 6b32 5f69 7465 6d0a 2020 2020  al pk2_item.    
+0001cd40: 2020 2020 7365 6c66 2e61 7373 6572 7444      self.assertD
+0001cd50: 6963 7445 7175 616c 2870 6b32 5f69 7465  ictEqual(pk2_ite
+0001cd60: 6d2c 2069 7465 6d73 5b30 5d29 0a0a 2020  m, items[0])..  
+0001cd70: 2020 2020 2020 6177 6169 7420 6372 6561        await crea
+0001cd80: 7465 645f 6462 2e64 656c 6574 655f 636f  ted_db.delete_co
+0001cd90: 6e74 6169 6e65 7228 6372 6561 7465 645f  ntainer(created_
+0001cda0: 636f 6c6c 6563 7469 6f6e 290a 0a20 2020  collection)..   
+0001cdb0: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
+0001cdc0: 7061 7463 685f 6f70 6572 6174 696f 6e73  patch_operations
+0001cdd0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001cde0: 6372 6561 7465 645f 636f 6e74 6169 6e65  created_containe
+0001cdf0: 7220 3d20 6177 6169 7420 7365 6c66 2e64  r = await self.d
+0001ce00: 6174 6162 6173 6546 6f72 5465 7374 2e63  atabaseForTest.c
+0001ce10: 7265 6174 655f 636f 6e74 6169 6e65 725f  reate_container_
+0001ce20: 6966 5f6e 6f74 5f65 7869 7374 7328 6964  if_not_exists(id
+0001ce30: 3d22 7061 7463 685f 636f 6e74 6169 6e65  ="patch_containe
+0001ce40: 7222 2c20 7061 7274 6974 696f 6e5f 6b65  r", partition_ke
+0001ce50: 793d 5061 7274 6974 696f 6e4b 6579 2870  y=PartitionKey(p
+0001ce60: 6174 683d 222f 706b 2229 290a 0a20 2020  ath="/pk"))..   
+0001ce70: 2020 2020 2023 4372 6561 7465 2069 7465       #Create ite
+0001ce80: 6d20 746f 2070 6174 6368 0a20 2020 2020  m to patch.     
+0001ce90: 2020 2069 7465 6d20 3d20 7b0a 2020 2020     item = {.    
+0001cea0: 2020 2020 2020 2020 2269 6422 3a20 2270          "id": "p
+0001ceb0: 6174 6368 5f69 7465 6d22 2c0a 2020 2020  atch_item",.    
+0001cec0: 2020 2020 2020 2020 2270 6b22 3a20 2270          "pk": "p
+0001ced0: 6174 6368 5f69 7465 6d5f 706b 222c 0a20  atch_item_pk",. 
+0001cee0: 2020 2020 2020 2020 2020 2022 7072 6f70             "prop
+0001cef0: 223a 2022 7072 6f70 3122 2c0a 2020 2020  ": "prop1",.    
+0001cf00: 2020 2020 2020 2020 2261 6464 7265 7373          "address
+0001cf10: 223a 207b 0a20 2020 2020 2020 2020 2020  ": {.           
+0001cf20: 2020 2020 2022 6369 7479 223a 2022 5265       "city": "Re
+0001cf30: 646d 6f6e 6422 0a20 2020 2020 2020 2020  dmond".         
+0001cf40: 2020 207d 2c0a 2020 2020 2020 2020 2020     },.          
+0001cf50: 2020 2263 6f6d 7061 6e79 223a 2022 4d69    "company": "Mi
+0001cf60: 6372 6f73 6f66 7422 2c0a 2020 2020 2020  crosoft",.      
+0001cf70: 2020 2020 2020 226e 756d 6265 7222 3a20        "number": 
+0001cf80: 337d 0a20 2020 2020 2020 2061 7761 6974  3}.        await
+0001cf90: 2063 7265 6174 6564 5f63 6f6e 7461 696e   created_contain
+0001cfa0: 6572 2e63 7265 6174 655f 6974 656d 2869  er.create_item(i
+0001cfb0: 7465 6d29 0a20 2020 2020 2020 2023 4465  tem).        #De
+0001cfc0: 6669 6e65 2061 6e64 2072 756e 2070 6174  fine and run pat
+0001cfd0: 6368 206f 7065 7261 7469 6f6e 730a 2020  ch operations.  
+0001cfe0: 2020 2020 2020 6f70 6572 6174 696f 6e73        operations
+0001cff0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+0001d000: 207b 226f 7022 3a20 2261 6464 222c 2022   {"op": "add", "
+0001d010: 7061 7468 223a 2022 2f63 6f6c 6f72 222c  path": "/color",
+0001d020: 2022 7661 6c75 6522 3a20 2279 656c 6c6f   "value": "yello
+0001d030: 7722 7d2c 0a20 2020 2020 2020 2020 2020  w"},.           
+0001d040: 207b 226f 7022 3a20 2272 656d 6f76 6522   {"op": "remove"
+0001d050: 2c20 2270 6174 6822 3a20 222f 7072 6f70  , "path": "/prop
+0001d060: 227d 2c0a 2020 2020 2020 2020 2020 2020  "},.            
+0001d070: 7b22 6f70 223a 2022 7265 706c 6163 6522  {"op": "replace"
+0001d080: 2c20 2270 6174 6822 3a20 222f 636f 6d70  , "path": "/comp
+0001d090: 616e 7922 2c20 2276 616c 7565 223a 2022  any", "value": "
+0001d0a0: 436f 736d 6f73 4442 227d 2c0a 2020 2020  CosmosDB"},.    
+0001d0b0: 2020 2020 2020 2020 7b22 6f70 223a 2022          {"op": "
+0001d0c0: 7365 7422 2c20 2270 6174 6822 3a20 222f  set", "path": "/
+0001d0d0: 6164 6472 6573 732f 6e65 775f 6369 7479  address/new_city
+0001d0e0: 222c 2022 7661 6c75 6522 3a20 2241 746c  ", "value": "Atl
+0001d0f0: 616e 7461 227d 2c0a 2020 2020 2020 2020  anta"},.        
+0001d100: 2020 2020 7b22 6f70 223a 2022 696e 6372      {"op": "incr
+0001d110: 222c 2022 7061 7468 223a 2022 2f6e 756d  ", "path": "/num
+0001d120: 6265 7222 2c20 2276 616c 7565 223a 2037  ber", "value": 7
+0001d130: 7d2c 0a20 2020 2020 2020 2020 2020 207b  },.            {
+0001d140: 226f 7022 3a20 226d 6f76 6522 2c20 2266  "op": "move", "f
+0001d150: 726f 6d22 3a20 222f 636f 6c6f 7222 2c20  rom": "/color", 
+0001d160: 2270 6174 6822 3a20 222f 6661 766f 7269  "path": "/favori
+0001d170: 7465 5f63 6f6c 6f72 227d 0a20 2020 2020  te_color"}.     
+0001d180: 2020 205d 0a20 2020 2020 2020 2070 6174     ].        pat
+0001d190: 6368 6564 5f69 7465 6d20 3d20 6177 6169  ched_item = awai
+0001d1a0: 7420 6372 6561 7465 645f 636f 6e74 6169  t created_contai
+0001d1b0: 6e65 722e 7061 7463 685f 6974 656d 2869  ner.patch_item(i
+0001d1c0: 7465 6d3d 2270 6174 6368 5f69 7465 6d22  tem="patch_item"
+0001d1d0: 2c20 7061 7274 6974 696f 6e5f 6b65 793d  , partition_key=
+0001d1e0: 2270 6174 6368 5f69 7465 6d5f 706b 222c  "patch_item_pk",
+0001d1f0: 2070 6174 6368 5f6f 7065 7261 7469 6f6e   patch_operation
+0001d200: 733d 6f70 6572 6174 696f 6e73 290a 2020  s=operations).  
+0001d210: 2020 2020 2020 2356 6572 6966 7920 7265        #Verify re
+0001d220: 7375 6c74 7320 6672 6f6d 2070 6174 6368  sults from patch
+0001d230: 206f 7065 7261 7469 6f6e 730a 2020 2020   operations.    
+0001d240: 2020 2020 7365 6c66 2e61 7373 6572 7454      self.assertT
+0001d250: 7275 6528 7061 7463 6865 645f 6974 656d  rue(patched_item
+0001d260: 2e67 6574 2822 636f 6c6f 7222 2920 6973  .get("color") is
+0001d270: 204e 6f6e 6529 0a20 2020 2020 2020 2073   None).        s
+0001d280: 656c 662e 6173 7365 7274 5472 7565 2870  elf.assertTrue(p
+0001d290: 6174 6368 6564 5f69 7465 6d2e 6765 7428  atched_item.get(
+0001d2a0: 2270 726f 7022 2920 6973 204e 6f6e 6529  "prop") is None)
+0001d2b0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001d2c0: 7365 7274 4571 7561 6c28 7061 7463 6865  sertEqual(patche
+0001d2d0: 645f 6974 656d 2e67 6574 2822 636f 6d70  d_item.get("comp
+0001d2e0: 616e 7922 292c 2022 436f 736d 6f73 4442  any"), "CosmosDB
+0001d2f0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+0001d300: 6173 7365 7274 4571 7561 6c28 7061 7463  assertEqual(patc
+0001d310: 6865 645f 6974 656d 2e67 6574 2822 6164  hed_item.get("ad
+0001d320: 6472 6573 7322 292e 6765 7428 226e 6577  dress").get("new
+0001d330: 5f63 6974 7922 292c 2022 4174 6c61 6e74  _city"), "Atlant
+0001d340: 6122 290a 2020 2020 2020 2020 7365 6c66  a").        self
+0001d350: 2e61 7373 6572 7445 7175 616c 2870 6174  .assertEqual(pat
+0001d360: 6368 6564 5f69 7465 6d2e 6765 7428 226e  ched_item.get("n
+0001d370: 756d 6265 7222 292c 2031 3029 0a20 2020  umber"), 10).   
+0001d380: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0001d390: 4571 7561 6c28 7061 7463 6865 645f 6974  Equal(patched_it
+0001d3a0: 656d 2e67 6574 2822 6661 766f 7269 7465  em.get("favorite
+0001d3b0: 5f63 6f6c 6f72 2229 2c20 2279 656c 6c6f  _color"), "yello
+0001d3c0: 7722 290a 0a20 2020 2020 2020 2023 4e65  w")..        #Ne
+0001d3d0: 6761 7469 7665 2074 6573 7420 2d20 6174  gative test - at
+0001d3e0: 7465 6d70 7420 746f 2072 6570 6c61 6365  tempt to replace
+0001d3f0: 206e 6f6e 2d65 7869 7374 656e 7420 6669   non-existent fi
+0001d400: 656c 640a 2020 2020 2020 2020 6f70 6572  eld.        oper
+0001d410: 6174 696f 6e73 203d 205b 7b22 6f70 223a  ations = [{"op":
+0001d420: 2022 7265 706c 6163 6522 2c20 2270 6174   "replace", "pat
+0001d430: 6822 3a20 222f 7772 6f6e 675f 6669 656c  h": "/wrong_fiel
+0001d440: 6422 2c20 2276 616c 7565 223a 2022 7772  d", "value": "wr
+0001d450: 6f6e 675f 7661 6c75 6522 7d5d 0a20 2020  ong_value"}].   
+0001d460: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0001d470: 2020 2020 2020 6177 6169 7420 6372 6561        await crea
+0001d480: 7465 645f 636f 6e74 6169 6e65 722e 7061  ted_container.pa
+0001d490: 7463 685f 6974 656d 2869 7465 6d3d 2270  tch_item(item="p
+0001d4a0: 6174 6368 5f69 7465 6d22 2c20 7061 7274  atch_item", part
+0001d4b0: 6974 696f 6e5f 6b65 793d 2270 6174 6368  ition_key="patch
+0001d4c0: 5f69 7465 6d5f 706b 222c 2070 6174 6368  _item_pk", patch
+0001d4d0: 5f6f 7065 7261 7469 6f6e 733d 6f70 6572  _operations=oper
+0001d4e0: 6174 696f 6e73 290a 2020 2020 2020 2020  ations).        
+0001d4f0: 6578 6365 7074 2065 7863 6570 7469 6f6e  except exception
+0001d500: 732e 436f 736d 6f73 4874 7470 5265 7370  s.CosmosHttpResp
+0001d510: 6f6e 7365 4572 726f 7220 6173 2065 3a0a  onseError as e:.
+0001d520: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001d530: 2e61 7373 6572 7445 7175 616c 2865 2e73  .assertEqual(e.s
+0001d540: 7461 7475 735f 636f 6465 2c20 5374 6174  tatus_code, Stat
+0001d550: 7573 436f 6465 732e 4241 445f 5245 5155  usCodes.BAD_REQU
+0001d560: 4553 5429 0a0a 2020 2020 2020 2020 234e  EST)..        #N
+0001d570: 6567 6174 6976 6520 7465 7374 202d 2061  egative test - a
+0001d580: 7474 656d 7074 2074 6f20 7265 6d6f 7665  ttempt to remove
+0001d590: 206e 6f6e 2d65 7869 7374 656e 7420 6669   non-existent fi
+0001d5a0: 656c 640a 2020 2020 2020 2020 6f70 6572  eld.        oper
+0001d5b0: 6174 696f 6e73 203d 205b 7b22 6f70 223a  ations = [{"op":
+0001d5c0: 2022 7265 6d6f 7665 222c 2022 7061 7468   "remove", "path
+0001d5d0: 223a 2022 2f77 726f 6e67 5f66 6965 6c64  ": "/wrong_field
+0001d5e0: 227d 5d0a 2020 2020 2020 2020 7472 793a  "}].        try:
+0001d5f0: 0a20 2020 2020 2020 2020 2020 2061 7761  .            awa
+0001d600: 6974 2063 7265 6174 6564 5f63 6f6e 7461  it created_conta
+0001d610: 696e 6572 2e70 6174 6368 5f69 7465 6d28  iner.patch_item(
+0001d620: 6974 656d 3d22 7061 7463 685f 6974 656d  item="patch_item
+0001d630: 222c 2070 6172 7469 7469 6f6e 5f6b 6579  ", partition_key
+0001d640: 3d22 7061 7463 685f 6974 656d 5f70 6b22  ="patch_item_pk"
+0001d650: 2c20 7061 7463 685f 6f70 6572 6174 696f  , patch_operatio
+0001d660: 6e73 3d6f 7065 7261 7469 6f6e 7329 0a20  ns=operations). 
+0001d670: 2020 2020 2020 2065 7863 6570 7420 6578         except ex
+0001d680: 6365 7074 696f 6e73 2e43 6f73 6d6f 7348  ceptions.CosmosH
+0001d690: 7474 7052 6573 706f 6e73 6545 7272 6f72  ttpResponseError
+0001d6a0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0001d6b0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0001d6c0: 7561 6c28 652e 7374 6174 7573 5f63 6f64  ual(e.status_cod
+0001d6d0: 652c 2053 7461 7475 7343 6f64 6573 2e42  e, StatusCodes.B
+0001d6e0: 4144 5f52 4551 5545 5354 290a 0a20 2020  AD_REQUEST)..   
+0001d6f0: 2020 2020 2023 4e65 6761 7469 7665 2074       #Negative t
+0001d700: 6573 7420 2d20 6174 7465 6d70 7420 746f  est - attempt to
+0001d710: 2069 6e63 7265 6d65 6e74 206e 6f6e 2d6e   increment non-n
+0001d720: 756d 6265 7220 6669 656c 640a 2020 2020  umber field.    
+0001d730: 2020 2020 6f70 6572 6174 696f 6e73 203d      operations =
+0001d740: 205b 7b22 6f70 223a 2022 696e 6372 222c   [{"op": "incr",
+0001d750: 2022 7061 7468 223a 2022 2f63 6f6d 7061   "path": "/compa
+0001d760: 6e79 222c 2022 7661 6c75 6522 3a20 337d  ny", "value": 3}
+0001d770: 5d0a 2020 2020 2020 2020 7472 793a 0a20  ].        try:. 
+0001d780: 2020 2020 2020 2020 2020 2061 7761 6974             await
+0001d790: 2063 7265 6174 6564 5f63 6f6e 7461 696e   created_contain
+0001d7a0: 6572 2e70 6174 6368 5f69 7465 6d28 6974  er.patch_item(it
+0001d7b0: 656d 3d22 7061 7463 685f 6974 656d 222c  em="patch_item",
+0001d7c0: 2070 6172 7469 7469 6f6e 5f6b 6579 3d22   partition_key="
+0001d7d0: 7061 7463 685f 6974 656d 5f70 6b22 2c20  patch_item_pk", 
+0001d7e0: 7061 7463 685f 6f70 6572 6174 696f 6e73  patch_operations
+0001d7f0: 3d6f 7065 7261 7469 6f6e 7329 0a20 2020  =operations).   
+0001d800: 2020 2020 2065 7863 6570 7420 6578 6365       except exce
+0001d810: 7074 696f 6e73 2e43 6f73 6d6f 7348 7474  ptions.CosmosHtt
+0001d820: 7052 6573 706f 6e73 6545 7272 6f72 2061  pResponseError a
+0001d830: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0001d840: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0001d850: 6c28 652e 7374 6174 7573 5f63 6f64 652c  l(e.status_code,
+0001d860: 2053 7461 7475 7343 6f64 6573 2e42 4144   StatusCodes.BAD
+0001d870: 5f52 4551 5545 5354 290a 0a20 2020 2020  _REQUEST)..     
+0001d880: 2020 2023 4e65 6761 7469 7665 2074 6573     #Negative tes
+0001d890: 7420 2d20 6174 7465 6d70 7420 746f 206d  t - attempt to m
+0001d8a0: 6f76 6520 6672 6f6d 206e 6f6e 2d65 7869  ove from non-exi
+0001d8b0: 7374 656e 7420 6669 656c 640a 2020 2020  stent field.    
+0001d8c0: 2020 2020 6f70 6572 6174 696f 6e73 203d      operations =
+0001d8d0: 205b 7b22 6f70 223a 2022 6d6f 7665 222c   [{"op": "move",
+0001d8e0: 2022 6672 6f6d 223a 2022 2f77 726f 6e67   "from": "/wrong
+0001d8f0: 5f66 6965 6c64 222c 2022 7061 7468 223a  _field", "path":
+0001d900: 2022 2f6f 7468 6572 5f66 6965 6c64 227d   "/other_field"}
+0001d910: 5d0a 2020 2020 2020 2020 7472 793a 0a20  ].        try:. 
+0001d920: 2020 2020 2020 2020 2020 2061 7761 6974             await
+0001d930: 2063 7265 6174 6564 5f63 6f6e 7461 696e   created_contain
+0001d940: 6572 2e70 6174 6368 5f69 7465 6d28 6974  er.patch_item(it
+0001d950: 656d 3d22 7061 7463 685f 6974 656d 222c  em="patch_item",
+0001d960: 2070 6172 7469 7469 6f6e 5f6b 6579 3d22   partition_key="
+0001d970: 7061 7463 685f 6974 656d 5f70 6b22 2c20  patch_item_pk", 
+0001d980: 7061 7463 685f 6f70 6572 6174 696f 6e73  patch_operations
+0001d990: 3d6f 7065 7261 7469 6f6e 7329 0a20 2020  =operations).   
+0001d9a0: 2020 2020 2065 7863 6570 7420 6578 6365       except exce
+0001d9b0: 7074 696f 6e73 2e43 6f73 6d6f 7348 7474  ptions.CosmosHtt
+0001d9c0: 7052 6573 706f 6e73 6545 7272 6f72 2061  pResponseError a
+0001d9d0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0001d9e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0001d9f0: 6c28 652e 7374 6174 7573 5f63 6f64 652c  l(e.status_code,
+0001da00: 2053 7461 7475 7343 6f64 6573 2e42 4144   StatusCodes.BAD
+0001da10: 5f52 4551 5545 5354 290a 0a20 2020 2023  _REQUEST)..    #
+0001da20: 2054 656d 706f 7261 7269 6c79 2063 6f6d   Temporarily com
+0001da30: 6d65 6e74 696e 6720 616e 616c 7974 6963  menting analytic
+0001da40: 616c 2073 746f 7261 6765 2074 6573 7473  al storage tests
+0001da50: 2075 6e74 696c 2065 6d75 6c61 746f 7220   until emulator 
+0001da60: 7375 7070 6f72 7420 636f 6d65 732e 0a20  support comes.. 
+0001da70: 2020 2023 2064 6566 2074 6573 745f 6372     # def test_cr
+0001da80: 6561 7465 5f63 6f6e 7461 696e 6572 5f77  eate_container_w
+0001da90: 6974 685f 616e 616c 7974 6963 616c 5f73  ith_analytical_s
+0001daa0: 746f 7265 5f6f 6666 2873 656c 6629 3a0a  tore_off(self):.
+0001dab0: 2020 2020 2320 2020 2020 2320 646f 6e27      #     # don'
+0001dac0: 7420 7275 6e20 7465 7374 2c20 666f 7220  t run test, for 
+0001dad0: 7468 6520 7469 6d65 2062 6569 6e67 2c20  the time being, 
+0001dae0: 6966 2072 756e 6e69 6e67 2061 6761 696e  if running again
+0001daf0: 7374 2074 6865 2065 6d75 6c61 746f 720a  st the emulator.
+0001db00: 2020 2020 2320 2020 2020 6966 2027 6c6f      #     if 'lo
+0001db10: 6361 6c68 6f73 7427 2069 6e20 7365 6c66  calhost' in self
+0001db20: 2e68 6f73 7420 6f72 2027 3132 372e 302e  .host or '127.0.
+0001db30: 302e 3127 2069 6e20 7365 6c66 2e68 6f73  0.1' in self.hos
+0001db40: 743a 0a20 2020 2023 2020 2020 2020 2020  t:.    #        
+0001db50: 2072 6574 7572 6e0a 0a20 2020 2023 2020   return..    #  
+0001db60: 2020 2063 7265 6174 6564 5f64 6220 3d20     created_db = 
+0001db70: 7365 6c66 2e64 6174 6162 6173 6546 6f72  self.databaseFor
+0001db80: 5465 7374 0a20 2020 2023 2020 2020 2063  Test.    #     c
+0001db90: 6f6c 6c65 6374 696f 6e5f 6964 203d 2027  ollection_id = '
+0001dba0: 7465 7374 5f63 7265 6174 655f 636f 6e74  test_create_cont
+0001dbb0: 6169 6e65 725f 7769 7468 5f61 6e61 6c79  ainer_with_analy
+0001dbc0: 7469 6361 6c5f 7374 6f72 655f 6f66 665f  tical_store_off_
+0001dbd0: 2720 2b20 7374 7228 7575 6964 2e75 7569  ' + str(uuid.uui
+0001dbe0: 6434 2829 290a 2020 2020 2320 2020 2020  d4()).    #     
+0001dbf0: 636f 6c6c 6563 7469 6f6e 5f69 6e64 6578  collection_index
+0001dc00: 696e 675f 706f 6c69 6379 203d 207b 2769  ing_policy = {'i
+0001dc10: 6e64 6578 696e 674d 6f64 6527 3a20 2763  ndexingMode': 'c
+0001dc20: 6f6e 7369 7374 656e 7427 7d0a 2020 2020  onsistent'}.    
+0001dc30: 2320 2020 2020 6372 6561 7465 645f 7265  #     created_re
+0001dc40: 636f 7264 6572 203d 2052 6563 6f72 6444  corder = RecordD
+0001dc50: 6961 676e 6f73 7469 6373 2829 0a20 2020  iagnostics().   
+0001dc60: 2023 2020 2020 2063 7265 6174 6564 5f63   #     created_c
+0001dc70: 6f6c 6c65 6374 696f 6e20 3d20 6372 6561  ollection = crea
+0001dc80: 7465 645f 6462 2e63 7265 6174 655f 636f  ted_db.create_co
+0001dc90: 6e74 6169 6e65 7228 6964 3d63 6f6c 6c65  ntainer(id=colle
+0001dca0: 6374 696f 6e5f 6964 2c0a 2020 2020 2320  ction_id,.    # 
+0001dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dce0: 2020 2020 2069 6e64 6578 696e 675f 706f       indexing_po
+0001dcf0: 6c69 6379 3d63 6f6c 6c65 6374 696f 6e5f  licy=collection_
+0001dd00: 696e 6465 7869 6e67 5f70 6f6c 6963 792c  indexing_policy,
+0001dd10: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0001dd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd40: 2020 2020 2020 2020 2020 2020 7061 7274              part
+0001dd50: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
+0001dd60: 696f 6e4b 6579 2870 6174 683d 222f 706b  ionKey(path="/pk
+0001dd70: 222c 206b 696e 643d 2248 6173 6822 292c  ", kind="Hash"),
+0001dd80: 200a 2020 2020 2320 2020 2020 2020 2020   .    #         
+0001dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ddb0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0001ddc0: 706f 6e73 655f 686f 6f6b 3d63 7265 6174  ponse_hook=creat
+0001ddd0: 6564 5f72 6563 6f72 6465 7229 0a20 2020  ed_recorder).   
+0001dde0: 2023 2020 2020 2070 726f 7065 7274 6965   #     propertie
+0001ddf0: 7320 3d20 6372 6561 7465 645f 636f 6c6c  s = created_coll
+0001de00: 6563 7469 6f6e 2e72 6561 6428 290a 2020  ection.read().  
+0001de10: 2020 2320 2020 2020 7474 6c5f 6b65 7920    #     ttl_key 
+0001de20: 3d20 2261 6e61 6c79 7469 6361 6c53 746f  = "analyticalSto
+0001de30: 7261 6765 5474 6c22 0a20 2020 2023 2020  rageTtl".    #  
+0001de40: 2020 2073 656c 662e 6173 7365 7274 5472     self.assertTr
+0001de50: 7565 2874 746c 5f6b 6579 206e 6f74 2069  ue(ttl_key not i
+0001de60: 6e20 7072 6f70 6572 7469 6573 206f 7220  n properties or 
+0001de70: 7072 6f70 6572 7469 6573 5b74 746c 5f6b  properties[ttl_k
+0001de80: 6579 5d20 3d3d 204e 6f6e 6529 0a0a 2020  ey] == None)..  
+0001de90: 2020 2320 6465 6620 7465 7374 5f63 7265    # def test_cre
+0001dea0: 6174 655f 636f 6e74 6169 6e65 725f 7769  ate_container_wi
+0001deb0: 7468 5f61 6e61 6c79 7469 6361 6c5f 7374  th_analytical_st
+0001dec0: 6f72 655f 6f6e 2873 656c 6629 3a0a 2020  ore_on(self):.  
+0001ded0: 2020 2320 2020 2020 2320 646f 6e27 7420    #     # don't 
+0001dee0: 7275 6e20 7465 7374 2c20 666f 7220 7468  run test, for th
+0001def0: 6520 7469 6d65 2062 6569 6e67 2c20 6966  e time being, if
+0001df00: 2072 756e 6e69 6e67 2061 6761 696e 7374   running against
+0001df10: 2074 6865 2065 6d75 6c61 746f 720a 2020   the emulator.  
+0001df20: 2020 2320 2020 2020 6966 2027 6c6f 6361    #     if 'loca
+0001df30: 6c68 6f73 7427 2069 6e20 7365 6c66 2e68  lhost' in self.h
+0001df40: 6f73 7420 6f72 2027 3132 372e 302e 302e  ost or '127.0.0.
+0001df50: 3127 2069 6e20 7365 6c66 2e68 6f73 743a  1' in self.host:
+0001df60: 0a20 2020 2023 2020 2020 2020 2020 2072  .    #         r
+0001df70: 6574 7572 6e0a 0a20 2020 2023 2020 2020  eturn..    #    
+0001df80: 2063 7265 6174 6564 5f64 6220 3d20 7365   created_db = se
+0001df90: 6c66 2e64 6174 6162 6173 6546 6f72 5465  lf.databaseForTe
+0001dfa0: 7374 0a20 2020 2023 2020 2020 2063 6f6c  st.    #     col
+0001dfb0: 6c65 6374 696f 6e5f 6964 203d 2027 7465  lection_id = 'te
+0001dfc0: 7374 5f63 7265 6174 655f 636f 6e74 6169  st_create_contai
+0001dfd0: 6e65 725f 7769 7468 5f61 6e61 6c79 7469  ner_with_analyti
+0001dfe0: 6361 6c5f 7374 6f72 655f 6f6e 5f27 202b  cal_store_on_' +
+0001dff0: 2073 7472 2875 7569 642e 7575 6964 3428   str(uuid.uuid4(
+0001e000: 2929 0a20 2020 2023 2020 2020 2063 6f6c  )).    #     col
+0001e010: 6c65 6374 696f 6e5f 696e 6465 7869 6e67  lection_indexing
+0001e020: 5f70 6f6c 6963 7920 3d20 7b27 696e 6465  _policy = {'inde
+0001e030: 7869 6e67 4d6f 6465 273a 2027 636f 6e73  xingMode': 'cons
+0001e040: 6973 7465 6e74 277d 0a20 2020 2023 2020  istent'}.    #  
+0001e050: 2020 2063 7265 6174 6564 5f72 6563 6f72     created_recor
+0001e060: 6465 7220 3d20 5265 636f 7264 4469 6167  der = RecordDiag
+0001e070: 6e6f 7374 6963 7328 290a 2020 2020 2320  nostics().    # 
+0001e080: 2020 2020 6372 6561 7465 645f 636f 6c6c      created_coll
+0001e090: 6563 7469 6f6e 203d 2063 7265 6174 6564  ection = created
+0001e0a0: 5f64 622e 6372 6561 7465 5f63 6f6e 7461  _db.create_conta
+0001e0b0: 696e 6572 2869 643d 636f 6c6c 6563 7469  iner(id=collecti
+0001e0c0: 6f6e 5f69 642c 0a20 2020 2023 2020 2020  on_id,.    #    
+0001e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e100: 2020 616e 616c 7974 6963 616c 5f73 746f    analytical_sto
+0001e110: 7261 6765 5f74 746c 3d2d 312c 0a20 2020  rage_ttl=-1,.   
+0001e120: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0001e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e150: 2020 2020 2020 2020 696e 6465 7869 6e67          indexing
+0001e160: 5f70 6f6c 6963 793d 636f 6c6c 6563 7469  _policy=collecti
+0001e170: 6f6e 5f69 6e64 6578 696e 675f 706f 6c69  on_indexing_poli
+0001e180: 6379 2c0a 2020 2020 2320 2020 2020 2020  cy,.    #       
+0001e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001e1c0: 6172 7469 7469 6f6e 5f6b 6579 3d50 6172  artition_key=Par
+0001e1d0: 7469 7469 6f6e 4b65 7928 7061 7468 3d22  titionKey(path="
+0001e1e0: 2f70 6b22 2c20 6b69 6e64 3d22 4861 7368  /pk", kind="Hash
+0001e1f0: 2229 2c20 0a20 2020 2023 2020 2020 2020  "), .    #      
+0001e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e230: 7265 7370 6f6e 7365 5f68 6f6f 6b3d 6372  response_hook=cr
+0001e240: 6561 7465 645f 7265 636f 7264 6572 290a  eated_recorder).
+0001e250: 2020 2020 2320 2020 2020 7072 6f70 6572      #     proper
+0001e260: 7469 6573 203d 2063 7265 6174 6564 5f63  ties = created_c
+0001e270: 6f6c 6c65 6374 696f 6e2e 7265 6164 2829  ollection.read()
+0001e280: 0a20 2020 2023 2020 2020 2074 746c 5f6b  .    #     ttl_k
+0001e290: 6579 203d 2022 616e 616c 7974 6963 616c  ey = "analytical
+0001e2a0: 5374 6f72 6167 6554 746c 220a 2020 2020  StorageTtl".    
+0001e2b0: 2320 2020 2020 7365 6c66 2e61 7373 6572  #     self.asser
+0001e2c0: 7454 7275 6528 7474 6c5f 6b65 7920 696e  tTrue(ttl_key in
+0001e2d0: 2070 726f 7065 7274 6965 7320 616e 6420   properties and 
+0001e2e0: 7072 6f70 6572 7469 6573 5b74 746c 5f6b  properties[ttl_k
+0001e2f0: 6579 5d20 3d3d 202d 3129 0a0a 2020 2020  ey] == -1)..    
+0001e300: 2320 6465 6620 7465 7374 5f63 7265 6174  # def test_creat
+0001e310: 655f 636f 6e74 6169 6e65 725f 6966 5f6e  e_container_if_n
+0001e320: 6f74 5f65 7869 7374 735f 7769 7468 5f61  ot_exists_with_a
+0001e330: 6e61 6c79 7469 6361 6c5f 7374 6f72 655f  nalytical_store_
+0001e340: 6f6e 2873 656c 6629 3a0a 2020 2020 2320  on(self):.    # 
+0001e350: 2020 2020 2320 646f 6e27 7420 7275 6e20      # don't run 
+0001e360: 7465 7374 2c20 666f 7220 7468 6520 7469  test, for the ti
+0001e370: 6d65 2062 6569 6e67 2c20 6966 2072 756e  me being, if run
+0001e380: 6e69 6e67 2061 6761 696e 7374 2074 6865  ning against the
+0001e390: 2065 6d75 6c61 746f 720a 2020 2020 2320   emulator.    # 
+0001e3a0: 2020 2020 6966 2027 6c6f 6361 6c68 6f73      if 'localhos
+0001e3b0: 7427 2069 6e20 7365 6c66 2e68 6f73 7420  t' in self.host 
+0001e3c0: 6f72 2027 3132 372e 302e 302e 3127 2069  or '127.0.0.1' i
+0001e3d0: 6e20 7365 6c66 2e68 6f73 743a 0a20 2020  n self.host:.   
+0001e3e0: 2023 2020 2020 2020 2020 2072 6574 7572   #         retur
+0001e3f0: 6e0a 0a20 2020 2023 2020 2020 2023 2066  n..    #     # f
+0001e400: 6972 7374 2c20 7472 7920 7768 656e 2077  irst, try when w
+0001e410: 6520 6b6e 6f77 2074 6865 2063 6f6e 7461  e know the conta
+0001e420: 696e 6572 2064 6f65 736e 2774 2065 7869  iner doesn't exi
+0001e430: 7374 2e0a 2020 2020 2320 2020 2020 6372  st..    #     cr
+0001e440: 6561 7465 645f 6462 203d 2073 656c 662e  eated_db = self.
+0001e450: 6461 7461 6261 7365 466f 7254 6573 740a  databaseForTest.
+0001e460: 2020 2020 2320 2020 2020 636f 6c6c 6563      #     collec
+0001e470: 7469 6f6e 5f69 6420 3d20 2774 6573 745f  tion_id = 'test_
+0001e480: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
+0001e490: 5f69 665f 6e6f 745f 6578 6973 7473 5f77  _if_not_exists_w
+0001e4a0: 6974 685f 616e 616c 7974 6963 616c 5f73  ith_analytical_s
+0001e4b0: 746f 7265 5f6f 6e5f 2720 2b20 7374 7228  tore_on_' + str(
+0001e4c0: 7575 6964 2e75 7569 6434 2829 290a 2020  uuid.uuid4()).  
+0001e4d0: 2020 2320 2020 2020 636f 6c6c 6563 7469    #     collecti
+0001e4e0: 6f6e 5f69 6e64 6578 696e 675f 706f 6c69  on_indexing_poli
+0001e4f0: 6379 203d 207b 2769 6e64 6578 696e 674d  cy = {'indexingM
+0001e500: 6f64 6527 3a20 2763 6f6e 7369 7374 656e  ode': 'consisten
+0001e510: 7427 7d0a 2020 2020 2320 2020 2020 6372  t'}.    #     cr
+0001e520: 6561 7465 645f 7265 636f 7264 6572 203d  eated_recorder =
+0001e530: 2052 6563 6f72 6444 6961 676e 6f73 7469   RecordDiagnosti
+0001e540: 6373 2829 0a20 2020 2023 2020 2020 2063  cs().    #     c
+0001e550: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
+0001e560: 6e20 3d20 6372 6561 7465 645f 6462 2e63  n = created_db.c
+0001e570: 7265 6174 655f 636f 6e74 6169 6e65 725f  reate_container_
+0001e580: 6966 5f6e 6f74 5f65 7869 7374 7328 6964  if_not_exists(id
+0001e590: 3d63 6f6c 6c65 6374 696f 6e5f 6964 2c0a  =collection_id,.
+0001e5a0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0001e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5e0: 2020 2020 2020 2020 2061 6e61 6c79 7469           analyti
+0001e5f0: 6361 6c5f 7374 6f72 6167 655f 7474 6c3d  cal_storage_ttl=
+0001e600: 2d31 2c0a 2020 2020 2320 2020 2020 2020  -1,.    #       
+0001e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e640: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+0001e650: 6578 696e 675f 706f 6c69 6379 3d63 6f6c  exing_policy=col
+0001e660: 6c65 6374 696f 6e5f 696e 6465 7869 6e67  lection_indexing
+0001e670: 5f70 6f6c 6963 792c 0a20 2020 2023 2020  _policy,.    #  
+0001e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6c0: 2020 7061 7274 6974 696f 6e5f 6b65 793d    partition_key=
+0001e6d0: 5061 7274 6974 696f 6e4b 6579 2870 6174  PartitionKey(pat
+0001e6e0: 683d 222f 706b 222c 206b 696e 643d 2248  h="/pk", kind="H
+0001e6f0: 6173 6822 292c 0a20 2020 2023 2020 2020  ash"),.    #    
+0001e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e740: 7265 7370 6f6e 7365 5f68 6f6f 6b3d 6372  response_hook=cr
+0001e750: 6561 7465 645f 7265 636f 7264 6572 290a  eated_recorder).
+0001e760: 2020 2020 2320 2020 2020 7072 6f70 6572      #     proper
+0001e770: 7469 6573 203d 2063 7265 6174 6564 5f63  ties = created_c
+0001e780: 6f6c 6c65 6374 696f 6e2e 7265 6164 2829  ollection.read()
+0001e790: 0a20 2020 2023 2020 2020 2074 746c 5f6b  .    #     ttl_k
+0001e7a0: 6579 203d 2022 616e 616c 7974 6963 616c  ey = "analytical
+0001e7b0: 5374 6f72 6167 6554 746c 220a 2020 2020  StorageTtl".    
+0001e7c0: 2320 2020 2020 7365 6c66 2e61 7373 6572  #     self.asser
+0001e7d0: 7454 7275 6528 7474 6c5f 6b65 7920 696e  tTrue(ttl_key in
+0001e7e0: 2070 726f 7065 7274 6965 7320 616e 6420   properties and 
+0001e7f0: 7072 6f70 6572 7469 6573 5b74 746c 5f6b  properties[ttl_k
+0001e800: 6579 5d20 3d3d 202d 3129 0a0a 2020 2020  ey] == -1)..    
+0001e810: 2320 2020 2020 2320 6e65 7874 2c20 7472  #     # next, tr
+0001e820: 7920 7768 656e 2077 6520 6b6e 6f77 2074  y when we know t
+0001e830: 6865 2063 6f6e 7461 696e 6572 2044 4f45  he container DOE
+0001e840: 5320 6578 6973 742e 2054 6869 7320 7761  S exist. This wa
+0001e850: 7920 626f 7468 2063 6f64 6520 7061 7468  y both code path
+0001e860: 7320 6172 6520 7465 7374 6564 2e0a 2020  s are tested..  
+0001e870: 2020 2320 2020 2020 6372 6561 7465 645f    #     created_
+0001e880: 636f 6c6c 6563 7469 6f6e 203d 2063 7265  collection = cre
+0001e890: 6174 6564 5f64 622e 6372 6561 7465 5f63  ated_db.create_c
+0001e8a0: 6f6e 7461 696e 6572 5f69 665f 6e6f 745f  ontainer_if_not_
+0001e8b0: 6578 6973 7473 2869 643d 636f 6c6c 6563  exists(id=collec
+0001e8c0: 7469 6f6e 5f69 642c 0a20 2020 2023 2020  tion_id,.    #  
+0001e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e910: 2020 616e 616c 7974 6963 616c 5f73 746f    analytical_sto
+0001e920: 7261 6765 5f74 746c 3d2d 312c 0a20 2020  rage_ttl=-1,.   
+0001e930: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+0001e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e970: 2020 2020 2020 696e 6465 7869 6e67 5f70        indexing_p
+0001e980: 6f6c 6963 793d 636f 6c6c 6563 7469 6f6e  olicy=collection
+0001e990: 5f69 6e64 6578 696e 675f 706f 6c69 6379  _indexing_policy
+0001e9a0: 2c0a 2020 2020 2320 2020 2020 2020 2020  ,.    #         
+0001e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9e0: 2020 2020 2020 2020 2020 2070 6172 7469             parti
+0001e9f0: 7469 6f6e 5f6b 6579 3d50 6172 7469 7469  tion_key=Partiti
+0001ea00: 6f6e 4b65 7928 7061 7468 3d22 2f70 6b22  onKey(path="/pk"
+0001ea10: 2c20 6b69 6e64 3d22 4861 7368 2229 2c0a  , kind="Hash"),.
+0001ea20: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0001ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea60: 2020 2020 2020 2020 2072 6573 706f 6e73           respons
+0001ea70: 655f 686f 6f6b 3d63 7265 6174 6564 5f72  e_hook=created_r
+0001ea80: 6563 6f72 6465 7229 0a20 2020 2023 2020  ecorder).    #  
+0001ea90: 2020 2070 726f 7065 7274 6965 7320 3d20     properties = 
+0001eaa0: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
+0001eab0: 6f6e 2e72 6561 6428 290a 2020 2020 2320  on.read().    # 
+0001eac0: 2020 2020 7474 6c5f 6b65 7920 3d20 2261      ttl_key = "a
+0001ead0: 6e61 6c79 7469 6361 6c53 746f 7261 6765  nalyticalStorage
+0001eae0: 5474 6c22 0a20 2020 2023 2020 2020 2073  Ttl".    #     s
+0001eaf0: 656c 662e 6173 7365 7274 5472 7565 2874  elf.assertTrue(t
+0001eb00: 746c 5f6b 6579 2069 6e20 7072 6f70 6572  tl_key in proper
+0001eb10: 7469 6573 2061 6e64 2070 726f 7065 7274  ties and propert
+0001eb20: 6965 735b 7474 6c5f 6b65 795d 203d 3d20  ies[ttl_key] == 
+0001eb30: 2d31 290a 0a20 2020 2061 7379 6e63 2064  -1)..    async d
+0001eb40: 6566 205f 4d6f 636b 4578 6563 7574 6546  ef _MockExecuteF
+0001eb50: 756e 6374 696f 6e28 7365 6c66 2c20 6675  unction(self, fu
+0001eb60: 6e63 7469 6f6e 2c20 2a61 7267 732c 202a  nction, *args, *
+0001eb70: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
+0001eb80: 2020 7365 6c66 2e6c 6173 745f 6865 6164    self.last_head
+0001eb90: 6572 732e 6170 7065 6e64 2861 7267 735b  ers.append(args[
+0001eba0: 345d 2e68 6561 6465 7273 5b48 7474 7048  4].headers[HttpH
+0001ebb0: 6561 6465 7273 2e50 6172 7469 7469 6f6e  eaders.Partition
+0001ebc0: 4b65 795d 0a20 2020 2020 2020 2020 2020  Key].           
+0001ebd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebe0: 2020 2020 2020 6966 2048 7474 7048 6561        if HttpHea
+0001ebf0: 6465 7273 2e50 6172 7469 7469 6f6e 4b65  ders.PartitionKe
+0001ec00: 7920 696e 2061 7267 735b 345d 2e68 6561  y in args[4].hea
+0001ec10: 6465 7273 2065 6c73 6520 2727 290a 2020  ders else '').  
+0001ec20: 2020 2020 2020 7265 7475 726e 2061 7761        return awa
+0001ec30: 6974 2073 656c 662e 4f72 6967 696e 616c  it self.Original
+0001ec40: 4578 6563 7574 6546 756e 6374 696f 6e28  ExecuteFunction(
+0001ec50: 6675 6e63 7469 6f6e 2c20 2a61 7267 732c  function, *args,
+0001ec60: 202a 2a6b 7761 7267 7329 0a0a             **kwargs)..
```

## Comparing `azure-cosmos-4.3.1b1/test/test_analytical_ttl_async.py` & `azure-cosmos-4.4.0b1/test/test_analytical_ttl_async.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_orderby.py` & `azure-cosmos-4.4.0b1/test/test_orderby.py`

 * *Files 1% similar despite different names*

```diff
@@ -19,20 +19,18 @@
 #OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 #SOFTWARE.
 
 import unittest
 import uuid
 import pytest
 from azure.core.paging import ItemPaged
-import azure.cosmos.documents as documents
 from azure.cosmos.partition_key import PartitionKey
 import azure.cosmos.cosmos_client as cosmos_client
 from azure.cosmos import _query_iterable as query_iterable
 import azure.cosmos._base as base
-from six.moves import xrange
 import test_config
 
 pytestmark = pytest.mark.cosmosEmulator
 
 #IMPORTANT NOTES:
   
 #      Most test cases in this file create collections in your Azure Cosmos account.
@@ -87,15 +85,15 @@
             partition_key=PartitionKey(path='/id'),
             offer_throughput=30000)
 
         cls.collection_link = cls.GetDocumentCollectionLink(cls.created_db, cls.created_collection)
 
         # create a document using the document definition
         cls.document_definitions = []
-        for i in xrange(20):
+        for i in range(20):
             d = {'id': str(i),
                  'name': 'sample document',
                  'spam': 'eggs' + str(i),
                  'cnt': i,
                  'key': 'value',
                  'spam2': 'eggs' + str(i) if (i == 3) else i,
                  'boolVar': (i % 2 == 0),
@@ -466,15 +464,15 @@
         # test next() behavior
         ######################################
         it = result_iterable.__iter__()
         def invokeNext():
             return next(it)
                     
         # validate that invocations of next() produces the same results as expected_ordered_ids
-        for i in xrange(len(expected_ordered_ids)):
+        for i in range(len(expected_ordered_ids)):
             item = invokeNext()
             self.assertEqual(item['id'], expected_ordered_ids[i])
 
         ######################################
         # test by_page() behavior
         ######################################
         results = {}
```

## Comparing `azure-cosmos-4.3.1b1/test/test_utils.py` & `azure-cosmos-4.4.0b1/test/test_utils.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_crud.py` & `azure-cosmos-4.4.0b1/test/test_crud.py`

 * *Files 3% similar despite different names*

```diff
@@ -65,7181 +65,7490 @@
 00000400: 204f 5220 4f54 4845 5257 4953 452c 2041   OR OTHERWISE, A
 00000410: 5249 5349 4e47 2046 524f 4d2c 0a23 204f  RISING FROM,.# O
 00000420: 5554 204f 4620 4f52 2049 4e20 434f 4e4e  UT OF OR IN CONN
 00000430: 4543 5449 4f4e 2057 4954 4820 5448 4520  ECTION WITH THE 
 00000440: 534f 4654 5741 5245 204f 5220 5448 4520  SOFTWARE OR THE 
 00000450: 5553 4520 4f52 204f 5448 4552 2044 4541  USE OR OTHER DEA
 00000460: 4c49 4e47 5320 494e 2054 4845 0a23 2053  LINGS IN THE.# S
-00000470: 4f46 5457 4152 452e 0a0a 2222 2245 6e64  OFTWARE..."""End
-00000480: 2074 6f20 656e 6420 7465 7374 2e0a 2222   to end test..""
-00000490: 220a 0a69 6d70 6f72 7420 6a73 6f6e 0a69  "..import json.i
-000004a0: 6d70 6f72 7420 6c6f 6767 696e 670a 696d  mport logging.im
-000004b0: 706f 7274 206f 732e 7061 7468 0a69 6d70  port os.path.imp
-000004c0: 6f72 7420 756e 6974 7465 7374 0a69 6d70  ort unittest.imp
-000004d0: 6f72 7420 7469 6d65 0a66 726f 6d20 7479  ort time.from ty
-000004e0: 7069 6e67 2069 6d70 6f72 7420 4d61 7070  ping import Mapp
-000004f0: 696e 670a 0a69 6d70 6f72 7420 7572 6c6c  ing..import urll
-00000500: 6962 2e70 6172 7365 2061 7320 7572 6c6c  ib.parse as urll
-00000510: 6962 0a69 6d70 6f72 7420 7575 6964 0a69  ib.import uuid.i
-00000520: 6d70 6f72 7420 7079 7465 7374 0a66 726f  mport pytest.fro
-00000530: 6d20 617a 7572 652e 636f 7265 2069 6d70  m azure.core imp
-00000540: 6f72 7420 4d61 7463 6843 6f6e 6469 7469  ort MatchConditi
-00000550: 6f6e 730a 6672 6f6d 2061 7a75 7265 2e63  ons.from azure.c
-00000560: 6f72 652e 6578 6365 7074 696f 6e73 2069  ore.exceptions i
-00000570: 6d70 6f72 7420 417a 7572 6545 7272 6f72  mport AzureError
-00000580: 2c20 5365 7276 6963 6552 6573 706f 6e73  , ServiceRespons
-00000590: 6545 7272 6f72 0a66 726f 6d20 617a 7572  eError.from azur
-000005a0: 652e 636f 7265 2e70 6970 656c 696e 652e  e.core.pipeline.
-000005b0: 7472 616e 7370 6f72 7420 696d 706f 7274  transport import
-000005c0: 2052 6571 7565 7374 7354 7261 6e73 706f   RequestsTranspo
-000005d0: 7274 2c20 5265 7175 6573 7473 5472 616e  rt, RequestsTran
-000005e0: 7370 6f72 7452 6573 706f 6e73 650a 696d  sportResponse.im
-000005f0: 706f 7274 2061 7a75 7265 2e63 6f73 6d6f  port azure.cosmo
-00000600: 732e 646f 6375 6d65 6e74 7320 6173 2064  s.documents as d
-00000610: 6f63 756d 656e 7473 0a69 6d70 6f72 7420  ocuments.import 
-00000620: 617a 7572 652e 636f 736d 6f73 2e65 7863  azure.cosmos.exc
-00000630: 6570 7469 6f6e 7320 6173 2065 7863 6570  eptions as excep
-00000640: 7469 6f6e 730a 6672 6f6d 2061 7a75 7265  tions.from azure
-00000650: 2e63 6f73 6d6f 732e 6874 7470 5f63 6f6e  .cosmos.http_con
-00000660: 7374 616e 7473 2069 6d70 6f72 7420 4874  stants import Ht
-00000670: 7470 4865 6164 6572 732c 2053 7461 7475  tpHeaders, Statu
-00000680: 7343 6f64 6573 0a69 6d70 6f72 7420 7465  sCodes.import te
-00000690: 7374 5f63 6f6e 6669 670a 696d 706f 7274  st_config.import
-000006a0: 2061 7a75 7265 2e63 6f73 6d6f 732e 5f62   azure.cosmos._b
-000006b0: 6173 6520 6173 2062 6173 650a 696d 706f  ase as base.impo
-000006c0: 7274 2061 7a75 7265 2e63 6f73 6d6f 732e  rt azure.cosmos.
-000006d0: 636f 736d 6f73 5f63 6c69 656e 7420 6173  cosmos_client as
-000006e0: 2063 6f73 6d6f 735f 636c 6965 6e74 0a66   cosmos_client.f
-000006f0: 726f 6d20 617a 7572 652e 636f 736d 6f73  rom azure.cosmos
-00000700: 2e64 6961 676e 6f73 7469 6373 2069 6d70  .diagnostics imp
-00000710: 6f72 7420 5265 636f 7264 4469 6167 6e6f  ort RecordDiagno
-00000720: 7374 6963 730a 6672 6f6d 2061 7a75 7265  stics.from azure
-00000730: 2e63 6f73 6d6f 732e 7061 7274 6974 696f  .cosmos.partitio
-00000740: 6e5f 6b65 7920 696d 706f 7274 2050 6172  n_key import Par
-00000750: 7469 7469 6f6e 4b65 790a 6672 6f6d 2061  titionKey.from a
-00000760: 7a75 7265 2e63 6f73 6d6f 7320 696d 706f  zure.cosmos impo
-00000770: 7274 205f 7265 7472 795f 7574 696c 6974  rt _retry_utilit
-00000780: 790a 696d 706f 7274 2072 6571 7565 7374  y.import request
-00000790: 730a 6672 6f6d 2075 726c 6c69 6233 2e75  s.from urllib3.u
-000007a0: 7469 6c2e 7265 7472 7920 696d 706f 7274  til.retry import
-000007b0: 2052 6574 7279 0a0a 7079 7465 7374 6d61   Retry..pytestma
-000007c0: 726b 203d 2070 7974 6573 742e 6d61 726b  rk = pytest.mark
-000007d0: 2e63 6f73 6d6f 7345 6d75 6c61 746f 720a  .cosmosEmulator.
-000007e0: 0a23 2049 4d50 4f52 5441 4e54 204e 4f54  .# IMPORTANT NOT
-000007f0: 4553 3a0a 2320 2009 4d6f 7374 2074 6573  ES:.#  .Most tes
-00000800: 7420 6361 7365 7320 696e 2074 6869 7320  t cases in this 
-00000810: 6669 6c65 2063 7265 6174 6520 636f 6c6c  file create coll
-00000820: 6563 7469 6f6e 7320 696e 2079 6f75 7220  ections in your 
-00000830: 417a 7572 6520 436f 736d 6f73 2061 6363  Azure Cosmos acc
-00000840: 6f75 6e74 2e0a 2320 2009 436f 6c6c 6563  ount..#  .Collec
-00000850: 7469 6f6e 7320 6172 6520 6269 6c6c 696e  tions are billin
-00000860: 6720 656e 7469 7469 6573 2e20 2042 7920  g entities.  By 
-00000870: 7275 6e6e 696e 6720 7468 6573 6520 7465  running these te
-00000880: 7374 2063 6173 6573 2c20 796f 7520 6d61  st cases, you ma
-00000890: 7920 696e 6375 7220 6d6f 6e65 7461 7279  y incur monetary
-000008a0: 2063 6f73 7473 206f 6e20 796f 7572 2061   costs on your a
-000008b0: 6363 6f75 6e74 2e0a 0a23 2020 0954 6f20  ccount...#  .To 
-000008c0: 5275 6e20 7468 6520 7465 7374 2c20 7265  Run the test, re
-000008d0: 706c 6163 6520 7468 6520 7477 6f20 6d65  place the two me
-000008e0: 6d62 6572 2066 6965 6c64 7320 286d 6173  mber fields (mas
-000008f0: 7465 724b 6579 2061 6e64 2068 6f73 7429  terKey and host)
-00000900: 2077 6974 6820 7661 6c75 6573 0a23 2020   with values.#  
-00000910: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
-00000920: 2079 6f75 7220 417a 7572 6520 436f 736d   your Azure Cosm
-00000930: 6f73 2061 6363 6f75 6e74 2e0a 0a0a 636c  os account....cl
-00000940: 6173 7320 5469 6d65 6f75 7454 7261 6e73  ass TimeoutTrans
-00000950: 706f 7274 2852 6571 7565 7374 7354 7261  port(RequestsTra
-00000960: 6e73 706f 7274 293a 0a0a 2020 2020 6465  nsport):..    de
-00000970: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00000980: 2072 6573 706f 6e73 6529 3a0a 2020 2020   response):.    
-00000990: 2020 2020 7365 6c66 2e5f 7265 7370 6f6e      self._respon
-000009a0: 7365 203d 2072 6573 706f 6e73 650a 2020  se = response.  
-000009b0: 2020 2020 2020 7375 7065 7228 5469 6d65        super(Time
-000009c0: 6f75 7454 7261 6e73 706f 7274 2c20 7365  outTransport, se
-000009d0: 6c66 292e 5f5f 696e 6974 5f5f 2829 0a0a  lf).__init__()..
-000009e0: 2020 2020 6465 6620 7365 6e64 2873 656c      def send(sel
-000009f0: 662c 202a 6172 6773 2c20 2a2a 6b77 6172  f, *args, **kwar
-00000a00: 6773 293a 0a20 2020 2020 2020 2069 6620  gs):.        if 
-00000a10: 6b77 6172 6773 2e70 6f70 2822 7061 7373  kwargs.pop("pass
-00000a20: 7468 726f 7567 6822 2c20 4661 6c73 6529  through", False)
-00000a30: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00000a40: 7475 726e 2073 7570 6572 2854 696d 656f  turn super(Timeo
-00000a50: 7574 5472 616e 7370 6f72 742c 2073 656c  utTransport, sel
-00000a60: 6629 2e73 656e 6428 2a61 7267 732c 202a  f).send(*args, *
-00000a70: 2a6b 7761 7267 7329 0a0a 2020 2020 2020  *kwargs)..      
-00000a80: 2020 7469 6d65 2e73 6c65 6570 2835 290a    time.sleep(5).
-00000a90: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00000aa0: 7461 6e63 6528 7365 6c66 2e5f 7265 7370  tance(self._resp
-00000ab0: 6f6e 7365 2c20 4578 6365 7074 696f 6e29  onse, Exception)
-00000ac0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00000ad0: 6973 6520 7365 6c66 2e5f 7265 7370 6f6e  ise self._respon
-00000ae0: 7365 0a20 2020 2020 2020 206f 7574 7075  se.        outpu
-00000af0: 7420 3d20 7265 7175 6573 7473 2e52 6573  t = requests.Res
-00000b00: 706f 6e73 6528 290a 2020 2020 2020 2020  ponse().        
-00000b10: 6f75 7470 7574 2e73 7461 7475 735f 636f  output.status_co
-00000b20: 6465 203d 2073 656c 662e 5f72 6573 706f  de = self._respo
-00000b30: 6e73 650a 2020 2020 2020 2020 7265 7370  nse.        resp
-00000b40: 6f6e 7365 203d 2052 6571 7565 7374 7354  onse = RequestsT
-00000b50: 7261 6e73 706f 7274 5265 7370 6f6e 7365  ransportResponse
-00000b60: 284e 6f6e 652c 206f 7574 7075 7429 0a20  (None, output). 
-00000b70: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00000b80: 7370 6f6e 7365 0a0a 0a40 7079 7465 7374  sponse...@pytest
-00000b90: 2e6d 6172 6b2e 7573 6566 6978 7475 7265  .mark.usefixture
-00000ba0: 7328 2274 6561 7264 6f77 6e22 290a 636c  s("teardown").cl
-00000bb0: 6173 7320 4352 5544 5465 7374 7328 756e  ass CRUDTests(un
-00000bc0: 6974 7465 7374 2e54 6573 7443 6173 6529  ittest.TestCase)
-00000bd0: 3a0a 2020 2020 2222 2250 7974 686f 6e20  :.    """Python 
-00000be0: 4352 5544 2054 6573 7473 2e0a 2020 2020  CRUD Tests..    
-00000bf0: 2222 220a 0a20 2020 2063 6f6e 6669 6773  """..    configs
-00000c00: 203d 2074 6573 745f 636f 6e66 6967 2e5f   = test_config._
-00000c10: 7465 7374 5f63 6f6e 6669 670a 2020 2020  test_config.    
-00000c20: 686f 7374 203d 2063 6f6e 6669 6773 2e68  host = configs.h
-00000c30: 6f73 740a 2020 2020 6d61 7374 6572 4b65  ost.    masterKe
-00000c40: 7920 3d20 636f 6e66 6967 732e 6d61 7374  y = configs.mast
-00000c50: 6572 4b65 790a 2020 2020 636f 6e6e 6563  erKey.    connec
-00000c60: 7469 6f6e 506f 6c69 6379 203d 2063 6f6e  tionPolicy = con
-00000c70: 6669 6773 2e63 6f6e 6e65 6374 696f 6e50  figs.connectionP
-00000c80: 6f6c 6963 790a 2020 2020 6c61 7374 5f68  olicy.    last_h
-00000c90: 6561 6465 7273 203d 205b 5d0a 0a20 2020  eaders = []..   
-00000ca0: 2064 6566 205f 5f41 7373 6572 7448 5454   def __AssertHTT
-00000cb0: 5046 6169 6c75 7265 5769 7468 5374 6174  PFailureWithStat
-00000cc0: 7573 2873 656c 662c 2073 7461 7475 735f  us(self, status_
-00000cd0: 636f 6465 2c20 6675 6e63 2c20 2a61 7267  code, func, *arg
-00000ce0: 732c 202a 2a6b 7761 7267 7329 3a0a 2020  s, **kwargs):.  
-00000cf0: 2020 2020 2020 2222 2241 7373 6572 7420        """Assert 
-00000d00: 4854 5450 2066 6169 6c75 7265 2077 6974  HTTP failure wit
-00000d10: 6820 7374 6174 7573 2e0a 0a20 2020 2020  h status...     
-00000d20: 2020 203a 5061 7261 6d65 7465 7273 3a0a     :Parameters:.
-00000d30: 2020 2020 2020 2020 2020 2020 2d20 6073              - `s
-00000d40: 7461 7475 735f 636f 6465 603a 2069 6e74  tatus_code`: int
-00000d50: 0a20 2020 2020 2020 2020 2020 202d 2060  .            - `
-00000d60: 6675 6e63 603a 2066 756e 6374 696f 6e0a  func`: function.
-00000d70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00000d80: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00000d90: 2020 2020 2066 756e 6328 2a61 7267 732c       func(*args,
-00000da0: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-00000db0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00000dc0: 7274 4661 6c73 6528 5472 7565 2c20 2766  rtFalse(True, 'f
-00000dd0: 756e 6374 696f 6e20 7368 6f75 6c64 2066  unction should f
-00000de0: 6169 6c2e 2729 0a20 2020 2020 2020 2065  ail.').        e
-00000df0: 7863 6570 7420 6578 6365 7074 696f 6e73  xcept exceptions
-00000e00: 2e43 6f73 6d6f 7348 7474 7052 6573 706f  .CosmosHttpRespo
-00000e10: 6e73 6545 7272 6f72 2061 7320 696e 7374  nseError as inst
-00000e20: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00000e30: 6c66 2e61 7373 6572 7445 7175 616c 2869  lf.assertEqual(i
-00000e40: 6e73 742e 7374 6174 7573 5f63 6f64 652c  nst.status_code,
-00000e50: 2073 7461 7475 735f 636f 6465 290a 0a20   status_code).. 
-00000e60: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00000e70: 2020 2020 6465 6620 7365 7455 7043 6c61      def setUpCla
-00000e80: 7373 2863 6c73 293a 0a20 2020 2020 2020  ss(cls):.       
-00000e90: 2069 6620 2863 6c73 2e6d 6173 7465 724b   if (cls.masterK
-00000ea0: 6579 203d 3d20 275b 594f 5552 5f4b 4559  ey == '[YOUR_KEY
-00000eb0: 5f48 4552 455d 2720 6f72 0a20 2020 2020  _HERE]' or.     
-00000ec0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00000ed0: 6c73 2e68 6f73 7420 3d3d 2027 5b59 4f55  ls.host == '[YOU
-00000ee0: 525f 454e 4450 4f49 4e54 5f48 4552 455d  R_ENDPOINT_HERE]
-00000ef0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-00000f00: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-00000f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000f20: 2022 596f 7520 6d75 7374 2073 7065 6369   "You must speci
-00000f30: 6679 2079 6f75 7220 417a 7572 6520 436f  fy your Azure Co
-00000f40: 736d 6f73 2061 6363 6f75 6e74 2076 616c  smos account val
-00000f50: 7565 7320 666f 7220 220a 2020 2020 2020  ues for ".      
-00000f60: 2020 2020 2020 2020 2020 2227 6d61 7374            "'mast
-00000f70: 6572 4b65 7927 2061 6e64 2027 686f 7374  erKey' and 'host
-00000f80: 2720 6174 2074 6865 2074 6f70 206f 6620  ' at the top of 
-00000f90: 7468 6973 2063 6c61 7373 2074 6f20 7275  this class to ru
-00000fa0: 6e20 7468 6520 220a 2020 2020 2020 2020  n the ".        
-00000fb0: 2020 2020 2020 2020 2274 6573 7473 2e22          "tests."
-00000fc0: 290a 2020 2020 2020 2020 636c 732e 636c  ).        cls.cl
-00000fd0: 6965 6e74 203d 2063 6f73 6d6f 735f 636c  ient = cosmos_cl
-00000fe0: 6965 6e74 2e43 6f73 6d6f 7343 6c69 656e  ient.CosmosClien
-00000ff0: 7428 636c 732e 686f 7374 2c20 636c 732e  t(cls.host, cls.
-00001000: 6d61 7374 6572 4b65 792c 2063 6f6e 6e65  masterKey, conne
-00001010: 6374 696f 6e5f 706f 6c69 6379 3d63 6c73  ction_policy=cls
-00001020: 2e63 6f6e 6e65 6374 696f 6e50 6f6c 6963  .connectionPolic
-00001030: 7929 0a20 2020 2020 2020 2063 6c73 2e64  y).        cls.d
-00001040: 6174 6162 6173 6546 6f72 5465 7374 203d  atabaseForTest =
-00001050: 2063 6c73 2e63 6f6e 6669 6773 2e63 7265   cls.configs.cre
-00001060: 6174 655f 6461 7461 6261 7365 5f69 665f  ate_database_if_
-00001070: 6e6f 745f 6578 6973 7428 636c 732e 636c  not_exist(cls.cl
-00001080: 6965 6e74 290a 0a0a 2020 2020 6465 6620  ient)...    def 
-00001090: 7465 7374 5f64 6174 6162 6173 655f 6372  test_database_cr
-000010a0: 7564 2873 656c 6629 3a0a 2020 2020 2020  ud(self):.      
-000010b0: 2020 2320 7265 6164 2064 6174 6162 6173    # read databas
-000010c0: 6573 2e0a 2020 2020 2020 2020 6461 7461  es..        data
-000010d0: 6261 7365 7320 3d20 6c69 7374 2873 656c  bases = list(sel
-000010e0: 662e 636c 6965 6e74 2e6c 6973 745f 6461  f.client.list_da
-000010f0: 7461 6261 7365 7328 2929 0a20 2020 2020  tabases()).     
-00001100: 2020 2023 2063 7265 6174 6520 6120 6461     # create a da
-00001110: 7461 6261 7365 2e0a 2020 2020 2020 2020  tabase..        
-00001120: 6265 666f 7265 5f63 7265 6174 655f 6461  before_create_da
-00001130: 7461 6261 7365 735f 636f 756e 7420 3d20  tabases_count = 
-00001140: 6c65 6e28 6461 7461 6261 7365 7329 0a20  len(databases). 
-00001150: 2020 2020 2020 2064 6174 6162 6173 655f         database_
-00001160: 6964 203d 2073 7472 2875 7569 642e 7575  id = str(uuid.uu
-00001170: 6964 3428 2929 0a20 2020 2020 2020 2063  id4()).        c
-00001180: 7265 6174 6564 5f64 6220 3d20 7365 6c66  reated_db = self
-00001190: 2e63 6c69 656e 742e 6372 6561 7465 5f64  .client.create_d
-000011a0: 6174 6162 6173 6528 6461 7461 6261 7365  atabase(database
-000011b0: 5f69 6429 0a20 2020 2020 2020 2073 656c  _id).        sel
-000011c0: 662e 6173 7365 7274 4571 7561 6c28 6372  f.assertEqual(cr
-000011d0: 6561 7465 645f 6462 2e69 642c 2064 6174  eated_db.id, dat
-000011e0: 6162 6173 655f 6964 290a 2020 2020 2020  abase_id).      
-000011f0: 2020 2320 5265 6164 2064 6174 6162 6173    # Read databas
-00001200: 6573 2061 6674 6572 2063 7265 6174 696f  es after creatio
-00001210: 6e2e 0a20 2020 2020 2020 2064 6174 6162  n..        datab
-00001220: 6173 6573 203d 206c 6973 7428 7365 6c66  ases = list(self
-00001230: 2e63 6c69 656e 742e 6c69 7374 5f64 6174  .client.list_dat
-00001240: 6162 6173 6573 2829 290a 2020 2020 2020  abases()).      
-00001250: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00001260: 616c 286c 656e 2864 6174 6162 6173 6573  al(len(databases
-00001270: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00001280: 2020 2020 2020 2020 2020 2020 6265 666f              befo
-00001290: 7265 5f63 7265 6174 655f 6461 7461 6261  re_create_databa
-000012a0: 7365 735f 636f 756e 7420 2b20 312c 0a20  ses_count + 1,. 
+00000470: 4f46 5457 4152 452e 0a0a 0a22 2222 456e  OFTWARE...."""En
+00000480: 6420 746f 2065 6e64 2074 6573 742e 0a22  d to end test.."
+00000490: 2222 0a0a 696d 706f 7274 206a 736f 6e0a  ""..import json.
+000004a0: 696d 706f 7274 206c 6f67 6769 6e67 0a69  import logging.i
+000004b0: 6d70 6f72 7420 6f73 2e70 6174 680a 696d  mport os.path.im
+000004c0: 706f 7274 2075 6e69 7474 6573 740a 696d  port unittest.im
+000004d0: 706f 7274 2074 696d 650a 6672 6f6d 2074  port time.from t
+000004e0: 7970 696e 6720 696d 706f 7274 204d 6170  yping import Map
+000004f0: 7069 6e67 0a0a 696d 706f 7274 2075 726c  ping..import url
+00000500: 6c69 622e 7061 7273 6520 6173 2075 726c  lib.parse as url
+00000510: 6c69 620a 696d 706f 7274 2075 7569 640a  lib.import uuid.
+00000520: 696d 706f 7274 2070 7974 6573 740a 6672  import pytest.fr
+00000530: 6f6d 2061 7a75 7265 2e63 6f72 6520 696d  om azure.core im
+00000540: 706f 7274 204d 6174 6368 436f 6e64 6974  port MatchCondit
+00000550: 696f 6e73 0a66 726f 6d20 617a 7572 652e  ions.from azure.
+00000560: 636f 7265 2e65 7863 6570 7469 6f6e 7320  core.exceptions 
+00000570: 696d 706f 7274 2041 7a75 7265 4572 726f  import AzureErro
+00000580: 722c 2053 6572 7669 6365 5265 7370 6f6e  r, ServiceRespon
+00000590: 7365 4572 726f 720a 6672 6f6d 2061 7a75  seError.from azu
+000005a0: 7265 2e63 6f72 652e 7069 7065 6c69 6e65  re.core.pipeline
+000005b0: 2e74 7261 6e73 706f 7274 2069 6d70 6f72  .transport impor
+000005c0: 7420 5265 7175 6573 7473 5472 616e 7370  t RequestsTransp
+000005d0: 6f72 742c 2052 6571 7565 7374 7354 7261  ort, RequestsTra
+000005e0: 6e73 706f 7274 5265 7370 6f6e 7365 0a69  nsportResponse.i
+000005f0: 6d70 6f72 7420 617a 7572 652e 636f 736d  mport azure.cosm
+00000600: 6f73 2e64 6f63 756d 656e 7473 2061 7320  os.documents as 
+00000610: 646f 6375 6d65 6e74 730a 696d 706f 7274  documents.import
+00000620: 2061 7a75 7265 2e63 6f73 6d6f 732e 6578   azure.cosmos.ex
+00000630: 6365 7074 696f 6e73 2061 7320 6578 6365  ceptions as exce
+00000640: 7074 696f 6e73 0a66 726f 6d20 617a 7572  ptions.from azur
+00000650: 652e 636f 736d 6f73 2e68 7474 705f 636f  e.cosmos.http_co
+00000660: 6e73 7461 6e74 7320 696d 706f 7274 2048  nstants import H
+00000670: 7474 7048 6561 6465 7273 2c20 5374 6174  ttpHeaders, Stat
+00000680: 7573 436f 6465 730a 696d 706f 7274 2074  usCodes.import t
+00000690: 6573 745f 636f 6e66 6967 0a69 6d70 6f72  est_config.impor
+000006a0: 7420 617a 7572 652e 636f 736d 6f73 2e5f  t azure.cosmos._
+000006b0: 6261 7365 2061 7320 6261 7365 0a69 6d70  base as base.imp
+000006c0: 6f72 7420 617a 7572 652e 636f 736d 6f73  ort azure.cosmos
+000006d0: 2e63 6f73 6d6f 735f 636c 6965 6e74 2061  .cosmos_client a
+000006e0: 7320 636f 736d 6f73 5f63 6c69 656e 740a  s cosmos_client.
+000006f0: 6672 6f6d 2061 7a75 7265 2e63 6f73 6d6f  from azure.cosmo
+00000700: 732e 6469 6167 6e6f 7374 6963 7320 696d  s.diagnostics im
+00000710: 706f 7274 2052 6563 6f72 6444 6961 676e  port RecordDiagn
+00000720: 6f73 7469 6373 0a66 726f 6d20 617a 7572  ostics.from azur
+00000730: 652e 636f 736d 6f73 2e70 6172 7469 7469  e.cosmos.partiti
+00000740: 6f6e 5f6b 6579 2069 6d70 6f72 7420 5061  on_key import Pa
+00000750: 7274 6974 696f 6e4b 6579 0a66 726f 6d20  rtitionKey.from 
+00000760: 617a 7572 652e 636f 736d 6f73 2069 6d70  azure.cosmos imp
+00000770: 6f72 7420 5f72 6574 7279 5f75 7469 6c69  ort _retry_utili
+00000780: 7479 0a69 6d70 6f72 7420 7265 7175 6573  ty.import reques
+00000790: 7473 0a66 726f 6d20 7572 6c6c 6962 332e  ts.from urllib3.
+000007a0: 7574 696c 2e72 6574 7279 2069 6d70 6f72  util.retry impor
+000007b0: 7420 5265 7472 790a 0a70 7974 6573 746d  t Retry..pytestm
+000007c0: 6172 6b20 3d20 7079 7465 7374 2e6d 6172  ark = pytest.mar
+000007d0: 6b2e 636f 736d 6f73 456d 756c 6174 6f72  k.cosmosEmulator
+000007e0: 0a0a 2320 494d 504f 5254 414e 5420 4e4f  ..# IMPORTANT NO
+000007f0: 5445 533a 0a23 2020 094d 6f73 7420 7465  TES:.#  .Most te
+00000800: 7374 2063 6173 6573 2069 6e20 7468 6973  st cases in this
+00000810: 2066 696c 6520 6372 6561 7465 2063 6f6c   file create col
+00000820: 6c65 6374 696f 6e73 2069 6e20 796f 7572  lections in your
+00000830: 2041 7a75 7265 2043 6f73 6d6f 7320 6163   Azure Cosmos ac
+00000840: 636f 756e 742e 0a23 2020 0943 6f6c 6c65  count..#  .Colle
+00000850: 6374 696f 6e73 2061 7265 2062 696c 6c69  ctions are billi
+00000860: 6e67 2065 6e74 6974 6965 732e 2020 4279  ng entities.  By
+00000870: 2072 756e 6e69 6e67 2074 6865 7365 2074   running these t
+00000880: 6573 7420 6361 7365 732c 2079 6f75 206d  est cases, you m
+00000890: 6179 2069 6e63 7572 206d 6f6e 6574 6172  ay incur monetar
+000008a0: 7920 636f 7374 7320 6f6e 2079 6f75 7220  y costs on your 
+000008b0: 6163 636f 756e 742e 0a0a 2320 2009 546f  account...#  .To
+000008c0: 2052 756e 2074 6865 2074 6573 742c 2072   Run the test, r
+000008d0: 6570 6c61 6365 2074 6865 2074 776f 206d  eplace the two m
+000008e0: 656d 6265 7220 6669 656c 6473 2028 6d61  ember fields (ma
+000008f0: 7374 6572 4b65 7920 616e 6420 686f 7374  sterKey and host
+00000900: 2920 7769 7468 2076 616c 7565 730a 2320  ) with values.# 
+00000910: 2020 6173 736f 6369 6174 6564 2077 6974    associated wit
+00000920: 6820 796f 7572 2041 7a75 7265 2043 6f73  h your Azure Cos
+00000930: 6d6f 7320 6163 636f 756e 742e 0a0a 0a63  mos account....c
+00000940: 6c61 7373 2054 696d 656f 7574 5472 616e  lass TimeoutTran
+00000950: 7370 6f72 7428 5265 7175 6573 7473 5472  sport(RequestsTr
+00000960: 616e 7370 6f72 7429 3a0a 0a20 2020 2064  ansport):..    d
+00000970: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00000980: 2c20 7265 7370 6f6e 7365 293a 0a20 2020  , response):.   
+00000990: 2020 2020 2073 656c 662e 5f72 6573 706f       self._respo
+000009a0: 6e73 6520 3d20 7265 7370 6f6e 7365 0a20  nse = response. 
+000009b0: 2020 2020 2020 2073 7570 6572 2854 696d         super(Tim
+000009c0: 656f 7574 5472 616e 7370 6f72 742c 2073  eoutTransport, s
+000009d0: 656c 6629 2e5f 5f69 6e69 745f 5f28 290a  elf).__init__().
+000009e0: 0a20 2020 2064 6566 2073 656e 6428 7365  .    def send(se
+000009f0: 6c66 2c20 2a61 7267 732c 202a 2a6b 7761  lf, *args, **kwa
+00000a00: 7267 7329 3a0a 2020 2020 2020 2020 6966  rgs):.        if
+00000a10: 206b 7761 7267 732e 706f 7028 2270 6173   kwargs.pop("pas
+00000a20: 7374 6872 6f75 6768 222c 2046 616c 7365  sthrough", False
+00000a30: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00000a40: 6574 7572 6e20 7375 7065 7228 5469 6d65  eturn super(Time
+00000a50: 6f75 7454 7261 6e73 706f 7274 2c20 7365  outTransport, se
+00000a60: 6c66 292e 7365 6e64 282a 6172 6773 2c20  lf).send(*args, 
+00000a70: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
+00000a80: 2020 2074 696d 652e 736c 6565 7028 3529     time.sleep(5)
+00000a90: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+00000aa0: 7374 616e 6365 2873 656c 662e 5f72 6573  stance(self._res
+00000ab0: 706f 6e73 652c 2045 7863 6570 7469 6f6e  ponse, Exception
+00000ac0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00000ad0: 6169 7365 2073 656c 662e 5f72 6573 706f  aise self._respo
+00000ae0: 6e73 650a 2020 2020 2020 2020 6f75 7470  nse.        outp
+00000af0: 7574 203d 2072 6571 7565 7374 732e 5265  ut = requests.Re
+00000b00: 7370 6f6e 7365 2829 0a20 2020 2020 2020  sponse().       
+00000b10: 206f 7574 7075 742e 7374 6174 7573 5f63   output.status_c
+00000b20: 6f64 6520 3d20 7365 6c66 2e5f 7265 7370  ode = self._resp
+00000b30: 6f6e 7365 0a20 2020 2020 2020 2072 6573  onse.        res
+00000b40: 706f 6e73 6520 3d20 5265 7175 6573 7473  ponse = Requests
+00000b50: 5472 616e 7370 6f72 7452 6573 706f 6e73  TransportRespons
+00000b60: 6528 4e6f 6e65 2c20 6f75 7470 7574 290a  e(None, output).
+00000b70: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00000b80: 6573 706f 6e73 650a 0a0a 4070 7974 6573  esponse...@pytes
+00000b90: 742e 6d61 726b 2e75 7365 6669 7874 7572  t.mark.usefixtur
+00000ba0: 6573 2822 7465 6172 646f 776e 2229 0a63  es("teardown").c
+00000bb0: 6c61 7373 2043 5255 4454 6573 7473 2875  lass CRUDTests(u
+00000bc0: 6e69 7474 6573 742e 5465 7374 4361 7365  nittest.TestCase
+00000bd0: 293a 0a20 2020 2022 2222 5079 7468 6f6e  ):.    """Python
+00000be0: 2043 5255 4420 5465 7374 732e 0a20 2020   CRUD Tests..   
+00000bf0: 2022 2222 0a0a 2020 2020 636f 6e66 6967   """..    config
+00000c00: 7320 3d20 7465 7374 5f63 6f6e 6669 672e  s = test_config.
+00000c10: 5f74 6573 745f 636f 6e66 6967 0a20 2020  _test_config.   
+00000c20: 2068 6f73 7420 3d20 636f 6e66 6967 732e   host = configs.
+00000c30: 686f 7374 0a20 2020 206d 6173 7465 724b  host.    masterK
+00000c40: 6579 203d 2063 6f6e 6669 6773 2e6d 6173  ey = configs.mas
+00000c50: 7465 724b 6579 0a20 2020 2063 6f6e 6e65  terKey.    conne
+00000c60: 6374 696f 6e50 6f6c 6963 7920 3d20 636f  ctionPolicy = co
+00000c70: 6e66 6967 732e 636f 6e6e 6563 7469 6f6e  nfigs.connection
+00000c80: 506f 6c69 6379 0a20 2020 206c 6173 745f  Policy.    last_
+00000c90: 6865 6164 6572 7320 3d20 5b5d 0a0a 2020  headers = []..  
+00000ca0: 2020 6465 6620 5f5f 4173 7365 7274 4854    def __AssertHT
+00000cb0: 5450 4661 696c 7572 6557 6974 6853 7461  TPFailureWithSta
+00000cc0: 7475 7328 7365 6c66 2c20 7374 6174 7573  tus(self, status
+00000cd0: 5f63 6f64 652c 2066 756e 632c 202a 6172  _code, func, *ar
+00000ce0: 6773 2c20 2a2a 6b77 6172 6773 293a 0a20  gs, **kwargs):. 
+00000cf0: 2020 2020 2020 2022 2222 4173 7365 7274         """Assert
+00000d00: 2048 5454 5020 6661 696c 7572 6520 7769   HTTP failure wi
+00000d10: 7468 2073 7461 7475 732e 0a0a 2020 2020  th status...    
+00000d20: 2020 2020 3a50 6172 616d 6574 6572 733a      :Parameters:
+00000d30: 0a20 2020 2020 2020 2020 2020 202d 2060  .            - `
+00000d40: 7374 6174 7573 5f63 6f64 6560 3a20 696e  status_code`: in
+00000d50: 740a 2020 2020 2020 2020 2020 2020 2d20  t.            - 
+00000d60: 6066 756e 6360 3a20 6675 6e63 7469 6f6e  `func`: function
+00000d70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00000d80: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00000d90: 2020 2020 2020 6675 6e63 282a 6172 6773        func(*args
+00000da0: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
+00000db0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00000dc0: 6572 7446 616c 7365 2854 7275 652c 2027  ertFalse(True, '
+00000dd0: 6675 6e63 7469 6f6e 2073 686f 756c 6420  function should 
+00000de0: 6661 696c 2e27 290a 2020 2020 2020 2020  fail.').        
+00000df0: 6578 6365 7074 2065 7863 6570 7469 6f6e  except exception
+00000e00: 732e 436f 736d 6f73 4874 7470 5265 7370  s.CosmosHttpResp
+00000e10: 6f6e 7365 4572 726f 7220 6173 2069 6e73  onseError as ins
+00000e20: 743a 0a20 2020 2020 2020 2020 2020 2073  t:.            s
+00000e30: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00000e40: 696e 7374 2e73 7461 7475 735f 636f 6465  inst.status_code
+00000e50: 2c20 7374 6174 7573 5f63 6f64 6529 0a0a  , status_code)..
+00000e60: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00000e70: 0a20 2020 2064 6566 2073 6574 5570 436c  .    def setUpCl
+00000e80: 6173 7328 636c 7329 3a0a 2020 2020 2020  ass(cls):.      
+00000e90: 2020 6966 2028 636c 732e 6d61 7374 6572    if (cls.master
+00000ea0: 4b65 7920 3d3d 2027 5b59 4f55 525f 4b45  Key == '[YOUR_KE
+00000eb0: 595f 4845 5245 5d27 206f 720a 2020 2020  Y_HERE]' or.    
+00000ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000ed0: 636c 732e 686f 7374 203d 3d20 275b 594f  cls.host == '[YO
+00000ee0: 5552 5f45 4e44 504f 494e 545f 4845 5245  UR_ENDPOINT_HERE
+00000ef0: 5d27 293a 0a20 2020 2020 2020 2020 2020  ]'):.           
+00000f00: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+00000f10: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00000f20: 2020 2259 6f75 206d 7573 7420 7370 6563    "You must spec
+00000f30: 6966 7920 796f 7572 2041 7a75 7265 2043  ify your Azure C
+00000f40: 6f73 6d6f 7320 6163 636f 756e 7420 7661  osmos account va
+00000f50: 6c75 6573 2066 6f72 2022 0a20 2020 2020  lues for ".     
+00000f60: 2020 2020 2020 2020 2020 2022 276d 6173             "'mas
+00000f70: 7465 724b 6579 2720 616e 6420 2768 6f73  terKey' and 'hos
+00000f80: 7427 2061 7420 7468 6520 746f 7020 6f66  t' at the top of
+00000f90: 2074 6869 7320 636c 6173 7320 746f 2072   this class to r
+00000fa0: 756e 2074 6865 2022 0a20 2020 2020 2020  un the ".       
+00000fb0: 2020 2020 2020 2020 2022 7465 7374 732e           "tests.
+00000fc0: 2229 0a20 2020 2020 2020 2063 6c73 2e63  ").        cls.c
+00000fd0: 6c69 656e 7420 3d20 636f 736d 6f73 5f63  lient = cosmos_c
+00000fe0: 6c69 656e 742e 436f 736d 6f73 436c 6965  lient.CosmosClie
+00000ff0: 6e74 2863 6c73 2e68 6f73 742c 2063 6c73  nt(cls.host, cls
+00001000: 2e6d 6173 7465 724b 6579 2c20 636f 6e6e  .masterKey, conn
+00001010: 6563 7469 6f6e 5f70 6f6c 6963 793d 636c  ection_policy=cl
+00001020: 732e 636f 6e6e 6563 7469 6f6e 506f 6c69  s.connectionPoli
+00001030: 6379 290a 2020 2020 2020 2020 636c 732e  cy).        cls.
+00001040: 6461 7461 6261 7365 466f 7254 6573 7420  databaseForTest 
+00001050: 3d20 636c 732e 636f 6e66 6967 732e 6372  = cls.configs.cr
+00001060: 6561 7465 5f64 6174 6162 6173 655f 6966  eate_database_if
+00001070: 5f6e 6f74 5f65 7869 7374 2863 6c73 2e63  _not_exist(cls.c
+00001080: 6c69 656e 7429 0a0a 0a20 2020 2064 6566  lient)...    def
+00001090: 2074 6573 745f 6461 7461 6261 7365 5f63   test_database_c
+000010a0: 7275 6428 7365 6c66 293a 0a20 2020 2020  rud(self):.     
+000010b0: 2020 2023 2072 6561 6420 6461 7461 6261     # read databa
+000010c0: 7365 732e 0a20 2020 2020 2020 2064 6174  ses..        dat
+000010d0: 6162 6173 6573 203d 206c 6973 7428 7365  abases = list(se
+000010e0: 6c66 2e63 6c69 656e 742e 6c69 7374 5f64  lf.client.list_d
+000010f0: 6174 6162 6173 6573 2829 290a 2020 2020  atabases()).    
+00001100: 2020 2020 2320 6372 6561 7465 2061 2064      # create a d
+00001110: 6174 6162 6173 652e 0a20 2020 2020 2020  atabase..       
+00001120: 2062 6566 6f72 655f 6372 6561 7465 5f64   before_create_d
+00001130: 6174 6162 6173 6573 5f63 6f75 6e74 203d  atabases_count =
+00001140: 206c 656e 2864 6174 6162 6173 6573 290a   len(databases).
+00001150: 2020 2020 2020 2020 6461 7461 6261 7365          database
+00001160: 5f69 6420 3d20 7374 7228 7575 6964 2e75  _id = str(uuid.u
+00001170: 7569 6434 2829 290a 2020 2020 2020 2020  uid4()).        
+00001180: 6372 6561 7465 645f 6462 203d 2073 656c  created_db = sel
+00001190: 662e 636c 6965 6e74 2e63 7265 6174 655f  f.client.create_
+000011a0: 6461 7461 6261 7365 2864 6174 6162 6173  database(databas
+000011b0: 655f 6964 290a 2020 2020 2020 2020 7365  e_id).        se
+000011c0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+000011d0: 7265 6174 6564 5f64 622e 6964 2c20 6461  reated_db.id, da
+000011e0: 7461 6261 7365 5f69 6429 0a20 2020 2020  tabase_id).     
+000011f0: 2020 2023 2052 6561 6420 6461 7461 6261     # Read databa
+00001200: 7365 7320 6166 7465 7220 6372 6561 7469  ses after creati
+00001210: 6f6e 2e0a 2020 2020 2020 2020 6461 7461  on..        data
+00001220: 6261 7365 7320 3d20 6c69 7374 2873 656c  bases = list(sel
+00001230: 662e 636c 6965 6e74 2e6c 6973 745f 6461  f.client.list_da
+00001240: 7461 6261 7365 7328 2929 0a20 2020 2020  tabases()).     
+00001250: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00001260: 7561 6c28 6c65 6e28 6461 7461 6261 7365  ual(len(database
+00001270: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
+00001280: 2020 2020 2020 2020 2020 2020 2062 6566               bef
+00001290: 6f72 655f 6372 6561 7465 5f64 6174 6162  ore_create_datab
+000012a0: 6173 6573 5f63 6f75 6e74 202b 2031 2c0a  ases_count + 1,.
 000012b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000012c0: 2020 2020 2020 2020 2763 7265 6174 6520          'create 
-000012d0: 7368 6f75 6c64 2069 6e63 7265 6173 6520  should increase 
-000012e0: 7468 6520 6e75 6d62 6572 206f 6620 6461  the number of da
-000012f0: 7461 6261 7365 7327 290a 2020 2020 2020  tabases').      
-00001300: 2020 2320 7175 6572 7920 6461 7461 6261    # query databa
-00001310: 7365 732e 0a20 2020 2020 2020 2064 6174  ses..        dat
-00001320: 6162 6173 6573 203d 206c 6973 7428 7365  abases = list(se
-00001330: 6c66 2e63 6c69 656e 742e 7175 6572 795f  lf.client.query_
-00001340: 6461 7461 6261 7365 7328 7b0a 2020 2020  databases({.    
-00001350: 2020 2020 2020 2020 2771 7565 7279 273a          'query':
-00001360: 2027 5345 4c45 4354 202a 2046 524f 4d20   'SELECT * FROM 
-00001370: 726f 6f74 2072 2057 4845 5245 2072 2e69  root r WHERE r.i
-00001380: 643d 4069 6427 2c0a 2020 2020 2020 2020  d=@id',.        
-00001390: 2020 2020 2770 6172 616d 6574 6572 7327      'parameters'
-000013a0: 3a20 5b0a 2020 2020 2020 2020 2020 2020  : [.            
-000013b0: 2020 2020 7b27 6e61 6d65 273a 2027 4069      {'name': '@i
-000013c0: 6427 2c20 2776 616c 7565 273a 2064 6174  d', 'value': dat
-000013d0: 6162 6173 655f 6964 7d0a 2020 2020 2020  abase_id}.      
-000013e0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-000013f0: 7d29 290a 2020 2020 2020 2020 7365 6c66  })).        self
-00001400: 2e61 7373 6572 7454 7275 6528 6461 7461  .assertTrue(data
-00001410: 6261 7365 732c 2027 6e75 6d62 6572 206f  bases, 'number o
-00001420: 6620 7265 7375 6c74 7320 666f 7220 7468  f results for th
-00001430: 6520 7175 6572 7920 7368 6f75 6c64 2062  e query should b
-00001440: 6520 3e20 3027 290a 0a20 2020 2020 2020  e > 0')..       
-00001450: 2023 2072 6561 6420 6461 7461 6261 7365   # read database
-00001460: 2e0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00001470: 6c69 656e 742e 6765 745f 6461 7461 6261  lient.get_databa
-00001480: 7365 5f63 6c69 656e 7428 6372 6561 7465  se_client(create
-00001490: 645f 6462 2e69 6429 0a0a 2020 2020 2020  d_db.id)..      
-000014a0: 2020 2320 6465 6c65 7465 2064 6174 6162    # delete datab
-000014b0: 6173 652e 0a20 2020 2020 2020 2073 656c  ase..        sel
-000014c0: 662e 636c 6965 6e74 2e64 656c 6574 655f  f.client.delete_
-000014d0: 6461 7461 6261 7365 2863 7265 6174 6564  database(created
-000014e0: 5f64 622e 6964 290a 2020 2020 2020 2020  _db.id).        
-000014f0: 2320 7265 6164 2064 6174 6162 6173 6520  # read database 
-00001500: 6166 7465 7220 6465 6c65 7469 6f6e 0a20  after deletion. 
-00001510: 2020 2020 2020 2072 6561 645f 6462 203d         read_db =
-00001520: 2073 656c 662e 636c 6965 6e74 2e67 6574   self.client.get
-00001530: 5f64 6174 6162 6173 655f 636c 6965 6e74  _database_client
-00001540: 2863 7265 6174 6564 5f64 622e 6964 290a  (created_db.id).
-00001550: 2020 2020 2020 2020 7365 6c66 2e5f 5f41          self.__A
-00001560: 7373 6572 7448 5454 5046 6169 6c75 7265  ssertHTTPFailure
-00001570: 5769 7468 5374 6174 7573 2853 7461 7475  WithStatus(Statu
-00001580: 7343 6f64 6573 2e4e 4f54 5f46 4f55 4e44  sCodes.NOT_FOUND
-00001590: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000012c0: 2020 2020 2020 2020 2027 6372 6561 7465           'create
+000012d0: 2073 686f 756c 6420 696e 6372 6561 7365   should increase
+000012e0: 2074 6865 206e 756d 6265 7220 6f66 2064   the number of d
+000012f0: 6174 6162 6173 6573 2729 0a20 2020 2020  atabases').     
+00001300: 2020 2023 2071 7565 7279 2064 6174 6162     # query datab
+00001310: 6173 6573 2e0a 2020 2020 2020 2020 6461  ases..        da
+00001320: 7461 6261 7365 7320 3d20 6c69 7374 2873  tabases = list(s
+00001330: 656c 662e 636c 6965 6e74 2e71 7565 7279  elf.client.query
+00001340: 5f64 6174 6162 6173 6573 287b 0a20 2020  _databases({.   
+00001350: 2020 2020 2020 2020 2027 7175 6572 7927           'query'
+00001360: 3a20 2753 454c 4543 5420 2a20 4652 4f4d  : 'SELECT * FROM
+00001370: 2072 6f6f 7420 7220 5748 4552 4520 722e   root r WHERE r.
+00001380: 6964 3d40 6964 272c 0a20 2020 2020 2020  id=@id',.       
+00001390: 2020 2020 2027 7061 7261 6d65 7465 7273       'parameters
+000013a0: 273a 205b 0a20 2020 2020 2020 2020 2020  ': [.           
+000013b0: 2020 2020 207b 276e 616d 6527 3a20 2740       {'name': '@
+000013c0: 6964 272c 2027 7661 6c75 6527 3a20 6461  id', 'value': da
+000013d0: 7461 6261 7365 5f69 647d 0a20 2020 2020  tabase_id}.     
+000013e0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+000013f0: 207d 2929 0a20 2020 2020 2020 2073 656c   })).        sel
+00001400: 662e 6173 7365 7274 5472 7565 2864 6174  f.assertTrue(dat
+00001410: 6162 6173 6573 2c20 276e 756d 6265 7220  abases, 'number 
+00001420: 6f66 2072 6573 756c 7473 2066 6f72 2074  of results for t
+00001430: 6865 2071 7565 7279 2073 686f 756c 6420  he query should 
+00001440: 6265 203e 2030 2729 0a0a 2020 2020 2020  be > 0')..      
+00001450: 2020 2320 7265 6164 2064 6174 6162 6173    # read databas
+00001460: 652e 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00001470: 636c 6965 6e74 2e67 6574 5f64 6174 6162  client.get_datab
+00001480: 6173 655f 636c 6965 6e74 2863 7265 6174  ase_client(creat
+00001490: 6564 5f64 622e 6964 290a 0a20 2020 2020  ed_db.id)..     
+000014a0: 2020 2023 2064 656c 6574 6520 6461 7461     # delete data
+000014b0: 6261 7365 2e0a 2020 2020 2020 2020 7365  base..        se
+000014c0: 6c66 2e63 6c69 656e 742e 6465 6c65 7465  lf.client.delete
+000014d0: 5f64 6174 6162 6173 6528 6372 6561 7465  _database(create
+000014e0: 645f 6462 2e69 6429 0a20 2020 2020 2020  d_db.id).       
+000014f0: 2023 2072 6561 6420 6461 7461 6261 7365   # read database
+00001500: 2061 6674 6572 2064 656c 6574 696f 6e0a   after deletion.
+00001510: 2020 2020 2020 2020 7265 6164 5f64 6220          read_db 
+00001520: 3d20 7365 6c66 2e63 6c69 656e 742e 6765  = self.client.ge
+00001530: 745f 6461 7461 6261 7365 5f63 6c69 656e  t_database_clien
+00001540: 7428 6372 6561 7465 645f 6462 2e69 6429  t(created_db.id)
+00001550: 0a20 2020 2020 2020 2073 656c 662e 5f5f  .        self.__
+00001560: 4173 7365 7274 4854 5450 4661 696c 7572  AssertHTTPFailur
+00001570: 6557 6974 6853 7461 7475 7328 5374 6174  eWithStatus(Stat
+00001580: 7573 436f 6465 732e 4e4f 545f 464f 554e  usCodes.NOT_FOUN
+00001590: 442c 0a20 2020 2020 2020 2020 2020 2020  D,.             
 000015a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000015b0: 2020 2020 2020 2020 2020 2020 2072 6561               rea
-000015c0: 645f 6462 2e72 6561 6429 0a0a 2020 2020  d_db.read)..    
-000015d0: 2020 2020 6461 7461 6261 7365 5f70 726f      database_pro
-000015e0: 7879 203d 2073 656c 662e 636c 6965 6e74  xy = self.client
-000015f0: 2e63 7265 6174 655f 6461 7461 6261 7365  .create_database
-00001600: 5f69 665f 6e6f 745f 6578 6973 7473 2869  _if_not_exists(i
-00001610: 643d 6461 7461 6261 7365 5f69 642c 206f  d=database_id, o
-00001620: 6666 6572 5f74 6872 6f75 6768 7075 743d  ffer_throughput=
-00001630: 3130 3030 3029 0a20 2020 2020 2020 2073  10000).        s
-00001640: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00001650: 6461 7461 6261 7365 5f69 642c 2064 6174  database_id, dat
-00001660: 6162 6173 655f 7072 6f78 792e 6964 290a  abase_proxy.id).
-00001670: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00001680: 6572 7445 7175 616c 2831 3030 3030 2c20  ertEqual(10000, 
-00001690: 6461 7461 6261 7365 5f70 726f 7879 2e72  database_proxy.r
-000016a0: 6561 645f 6f66 6665 7228 292e 6f66 6665  ead_offer().offe
-000016b0: 725f 7468 726f 7567 6870 7574 290a 0a20  r_throughput).. 
-000016c0: 2020 2020 2020 2064 6174 6162 6173 655f         database_
-000016d0: 7072 6f78 7920 3d20 7365 6c66 2e63 6c69  proxy = self.cli
-000016e0: 656e 742e 6372 6561 7465 5f64 6174 6162  ent.create_datab
-000016f0: 6173 655f 6966 5f6e 6f74 5f65 7869 7374  ase_if_not_exist
-00001700: 7328 6964 3d64 6174 6162 6173 655f 6964  s(id=database_id
-00001710: 2c20 6f66 6665 725f 7468 726f 7567 6870  , offer_throughp
-00001720: 7574 3d39 3030 3029 0a20 2020 2020 2020  ut=9000).       
-00001730: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00001740: 6c28 6461 7461 6261 7365 5f69 642c 2064  l(database_id, d
-00001750: 6174 6162 6173 655f 7072 6f78 792e 6964  atabase_proxy.id
-00001760: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00001770: 7373 6572 7445 7175 616c 2831 3030 3030  ssertEqual(10000
-00001780: 2c20 6461 7461 6261 7365 5f70 726f 7879  , database_proxy
-00001790: 2e72 6561 645f 6f66 6665 7228 292e 6f66  .read_offer().of
-000017a0: 6665 725f 7468 726f 7567 6870 7574 290a  fer_throughput).
-000017b0: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
-000017c0: 6965 6e74 2e64 656c 6574 655f 6461 7461  ient.delete_data
-000017d0: 6261 7365 2864 6174 6162 6173 655f 6964  base(database_id
-000017e0: 290a 0a20 2020 2040 7079 7465 7374 2e6d  )..    @pytest.m
-000017f0: 6172 6b2e 736b 6970 2822 736b 6970 7069  ark.skip("skippi
-00001800: 6e67 2061 7320 7468 6520 5465 7374 5265  ng as the TestRe
-00001810: 736f 7572 6365 7320 7375 6273 6372 6970  sources subscrip
-00001820: 7469 6f6e 2064 6f65 736e 2774 2073 7570  tion doesn't sup
-00001830: 706f 7274 2074 6869 7320 6f66 6665 7222  port this offer"
-00001840: 290a 2020 2020 6465 6620 7465 7374 5f64  ).    def test_d
-00001850: 6174 6162 6173 655f 6c65 7665 6c5f 6f66  atabase_level_of
-00001860: 6665 725f 7468 726f 7567 6870 7574 2873  fer_throughput(s
-00001870: 656c 6629 3a0a 2020 2020 2020 2020 2320  elf):.        # 
-00001880: 4372 6561 7465 2061 2064 6174 6162 6173  Create a databas
-00001890: 6520 7769 7468 2074 6872 6f75 6768 7075  e with throughpu
-000018a0: 740a 2020 2020 2020 2020 6f66 6665 725f  t.        offer_
-000018b0: 7468 726f 7567 6870 7574 203d 2031 3030  throughput = 100
-000018c0: 300a 2020 2020 2020 2020 6461 7461 6261  0.        databa
-000018d0: 7365 5f69 6420 3d20 7374 7228 7575 6964  se_id = str(uuid
-000018e0: 2e75 7569 6434 2829 290a 2020 2020 2020  .uuid4()).      
-000018f0: 2020 6372 6561 7465 645f 6462 203d 2073    created_db = s
-00001900: 656c 662e 636c 6965 6e74 2e63 7265 6174  elf.client.creat
-00001910: 655f 6461 7461 6261 7365 280a 2020 2020  e_database(.    
-00001920: 2020 2020 2020 2020 6964 3d64 6174 6162          id=datab
-00001930: 6173 655f 6964 2c0a 2020 2020 2020 2020  ase_id,.        
-00001940: 2020 2020 6f66 6665 725f 7468 726f 7567      offer_throug
-00001950: 6870 7574 3d6f 6666 6572 5f74 6872 6f75  hput=offer_throu
-00001960: 6768 7075 740a 2020 2020 2020 2020 290a  ghput.        ).
-00001970: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00001980: 6572 7445 7175 616c 2863 7265 6174 6564  ertEqual(created
-00001990: 5f64 622e 6964 2c20 6461 7461 6261 7365  _db.id, database
-000019a0: 5f69 6429 0a0a 2020 2020 2020 2020 2320  _id)..        # 
-000019b0: 5665 7269 6679 206f 6666 6572 2074 6872  Verify offer thr
-000019c0: 6f75 6768 7075 7420 666f 7220 6461 7461  oughput for data
-000019d0: 6261 7365 0a20 2020 2020 2020 206f 6666  base.        off
-000019e0: 6572 203d 2063 7265 6174 6564 5f64 622e  er = created_db.
-000019f0: 7265 6164 5f6f 6666 6572 2829 0a20 2020  read_offer().   
-00001a00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00001a10: 4571 7561 6c28 6f66 6665 722e 6f66 6665  Equal(offer.offe
-00001a20: 725f 7468 726f 7567 6870 7574 2c20 6f66  r_throughput, of
-00001a30: 6665 725f 7468 726f 7567 6870 7574 290a  fer_throughput).
-00001a40: 0a20 2020 2020 2020 2023 2055 7064 6174  .        # Updat
-00001a50: 6520 6461 7461 6261 7365 206f 6666 6572  e database offer
-00001a60: 2074 6872 6f75 6768 7075 740a 2020 2020   throughput.    
-00001a70: 2020 2020 6e65 775f 6f66 6665 725f 7468      new_offer_th
-00001a80: 726f 7567 6870 7574 203d 2032 3030 300a  roughput = 2000.
-00001a90: 2020 2020 2020 2020 6f66 6665 7220 3d20          offer = 
-00001aa0: 6372 6561 7465 645f 6462 2e72 6570 6c61  created_db.repla
-00001ab0: 6365 5f74 6872 6f75 6768 7075 7428 6e65  ce_throughput(ne
-00001ac0: 775f 6f66 6665 725f 7468 726f 7567 6870  w_offer_throughp
-00001ad0: 7574 290a 2020 2020 2020 2020 7365 6c66  ut).        self
-00001ae0: 2e61 7373 6572 7445 7175 616c 286f 6666  .assertEqual(off
-00001af0: 6572 2e6f 6666 6572 5f74 6872 6f75 6768  er.offer_through
-00001b00: 7075 742c 206e 6577 5f6f 6666 6572 5f74  put, new_offer_t
-00001b10: 6872 6f75 6768 7075 7429 0a20 2020 2020  hroughput).     
-00001b20: 2020 2073 656c 662e 636c 6965 6e74 2e64     self.client.d
-00001b30: 656c 6574 655f 6461 7461 6261 7365 2863  elete_database(c
-00001b40: 7265 6174 6564 5f64 622e 6964 290a 0a20  reated_db.id).. 
-00001b50: 2020 2064 6566 2074 6573 745f 7371 6c5f     def test_sql_
-00001b60: 7175 6572 795f 6372 7564 2873 656c 6629  query_crud(self)
-00001b70: 3a0a 2020 2020 2020 2020 2320 6372 6561  :.        # crea
-00001b80: 7465 2074 776f 2064 6174 6162 6173 6573  te two databases
-00001b90: 2e0a 2020 2020 2020 2020 6462 3120 3d20  ..        db1 = 
-00001ba0: 7365 6c66 2e63 6c69 656e 742e 6372 6561  self.client.crea
-00001bb0: 7465 5f64 6174 6162 6173 6528 2764 6174  te_database('dat
-00001bc0: 6162 6173 6520 3127 202b 2073 7472 2875  abase 1' + str(u
-00001bd0: 7569 642e 7575 6964 3428 2929 290a 2020  uid.uuid4())).  
-00001be0: 2020 2020 2020 6462 3220 3d20 7365 6c66        db2 = self
-00001bf0: 2e63 6c69 656e 742e 6372 6561 7465 5f64  .client.create_d
-00001c00: 6174 6162 6173 6528 2764 6174 6162 6173  atabase('databas
-00001c10: 6520 3227 202b 2073 7472 2875 7569 642e  e 2' + str(uuid.
-00001c20: 7575 6964 3428 2929 290a 0a20 2020 2020  uuid4()))..     
-00001c30: 2020 2023 2071 7565 7279 2077 6974 6820     # query with 
-00001c40: 7061 7261 6d65 7465 7273 2e0a 2020 2020  parameters..    
-00001c50: 2020 2020 6461 7461 6261 7365 7320 3d20      databases = 
-00001c60: 6c69 7374 2873 656c 662e 636c 6965 6e74  list(self.client
-00001c70: 2e71 7565 7279 5f64 6174 6162 6173 6573  .query_databases
-00001c80: 287b 0a20 2020 2020 2020 2020 2020 2027  ({.            '
-00001c90: 7175 6572 7927 3a20 2753 454c 4543 5420  query': 'SELECT 
-00001ca0: 2a20 4652 4f4d 2072 6f6f 7420 7220 5748  * FROM root r WH
-00001cb0: 4552 4520 722e 6964 3d40 6964 272c 0a20  ERE r.id=@id',. 
-00001cc0: 2020 2020 2020 2020 2020 2027 7061 7261             'para
-00001cd0: 6d65 7465 7273 273a 205b 0a20 2020 2020  meters': [.     
-00001ce0: 2020 2020 2020 2020 2020 207b 276e 616d             {'nam
-00001cf0: 6527 3a20 2740 6964 272c 2027 7661 6c75  e': '@id', 'valu
-00001d00: 6527 3a20 6462 312e 6964 7d0a 2020 2020  e': db1.id}.    
-00001d10: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00001d20: 2020 7d29 290a 2020 2020 2020 2020 7365    })).        se
-00001d30: 6c66 2e61 7373 6572 7445 7175 616c 2831  lf.assertEqual(1
-00001d40: 2c20 6c65 6e28 6461 7461 6261 7365 7329  , len(databases)
-00001d50: 2c20 2755 6e65 7870 6563 7465 6420 6e75  , 'Unexpected nu
-00001d60: 6d62 6572 206f 6620 7175 6572 7920 7265  mber of query re
-00001d70: 7375 6c74 732e 2729 0a0a 2020 2020 2020  sults.')..      
-00001d80: 2020 2320 7175 6572 7920 7769 7468 6f75    # query withou
-00001d90: 7420 7061 7261 6d65 7465 7273 2e0a 2020  t parameters..  
-00001da0: 2020 2020 2020 6461 7461 6261 7365 7320        databases 
-00001db0: 3d20 6c69 7374 2873 656c 662e 636c 6965  = list(self.clie
-00001dc0: 6e74 2e71 7565 7279 5f64 6174 6162 6173  nt.query_databas
-00001dd0: 6573 287b 0a20 2020 2020 2020 2020 2020  es({.           
-00001de0: 2027 7175 6572 7927 3a20 2753 454c 4543   'query': 'SELEC
-00001df0: 5420 2a20 4652 4f4d 2072 6f6f 7420 7220  T * FROM root r 
-00001e00: 5748 4552 4520 722e 6964 3d22 6461 7461  WHERE r.id="data
-00001e10: 6261 7365 206e 6f6e 2d65 7869 7374 696e  base non-existin
-00001e20: 6722 270a 2020 2020 2020 2020 7d29 290a  g"'.        })).
-00001e30: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00001e40: 6572 7445 7175 616c 2830 2c20 6c65 6e28  ertEqual(0, len(
-00001e50: 6461 7461 6261 7365 7329 2c20 2755 6e65  databases), 'Une
-00001e60: 7870 6563 7465 6420 6e75 6d62 6572 206f  xpected number o
-00001e70: 6620 7175 6572 7920 7265 7375 6c74 732e  f query results.
-00001e80: 2729 0a0a 2020 2020 2020 2020 2320 7175  ')..        # qu
-00001e90: 6572 7920 7769 7468 2061 2073 7472 696e  ery with a strin
-00001ea0: 672e 0a20 2020 2020 2020 2064 6174 6162  g..        datab
-00001eb0: 6173 6573 203d 206c 6973 7428 7365 6c66  ases = list(self
-00001ec0: 2e63 6c69 656e 742e 7175 6572 795f 6461  .client.query_da
-00001ed0: 7461 6261 7365 7328 2753 454c 4543 5420  tabases('SELECT 
-00001ee0: 2a20 4652 4f4d 2072 6f6f 7420 7220 5748  * FROM root r WH
-00001ef0: 4552 4520 722e 6964 3d22 2720 2b20 6462  ERE r.id="' + db
-00001f00: 322e 6964 202b 2027 2227 2929 2020 2023  2.id + '"'))   #
-00001f10: 206e 6f73 6563 0a20 2020 2020 2020 2073   nosec.        s
-00001f20: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00001f30: 312c 206c 656e 2864 6174 6162 6173 6573  1, len(databases
-00001f40: 292c 2027 556e 6578 7065 6374 6564 206e  ), 'Unexpected n
-00001f50: 756d 6265 7220 6f66 2071 7565 7279 2072  umber of query r
-00001f60: 6573 756c 7473 2e27 290a 2020 2020 2020  esults.').      
-00001f70: 2020 7365 6c66 2e63 6c69 656e 742e 6465    self.client.de
-00001f80: 6c65 7465 5f64 6174 6162 6173 6528 6462  lete_database(db
-00001f90: 312e 6964 290a 2020 2020 2020 2020 7365  1.id).        se
-00001fa0: 6c66 2e63 6c69 656e 742e 6465 6c65 7465  lf.client.delete
-00001fb0: 5f64 6174 6162 6173 6528 6462 322e 6964  _database(db2.id
-00001fc0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00001fd0: 636f 6c6c 6563 7469 6f6e 5f63 7275 6428  collection_crud(
-00001fe0: 7365 6c66 293a 0a20 2020 2020 2020 2063  self):.        c
-00001ff0: 7265 6174 6564 5f64 6220 3d20 7365 6c66  reated_db = self
-00002000: 2e64 6174 6162 6173 6546 6f72 5465 7374  .databaseForTest
-00002010: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
-00002020: 696f 6e73 203d 206c 6973 7428 6372 6561  ions = list(crea
-00002030: 7465 645f 6462 2e6c 6973 745f 636f 6e74  ted_db.list_cont
-00002040: 6169 6e65 7273 2829 290a 2020 2020 2020  ainers()).      
-00002050: 2020 2320 6372 6561 7465 2061 2063 6f6c    # create a col
-00002060: 6c65 6374 696f 6e0a 2020 2020 2020 2020  lection.        
-00002070: 6265 666f 7265 5f63 7265 6174 655f 636f  before_create_co
-00002080: 6c6c 6563 7469 6f6e 735f 636f 756e 7420  llections_count 
-00002090: 3d20 6c65 6e28 636f 6c6c 6563 7469 6f6e  = len(collection
-000020a0: 7329 0a20 2020 2020 2020 2063 6f6c 6c65  s).        colle
-000020b0: 6374 696f 6e5f 6964 203d 2027 7465 7374  ction_id = 'test
-000020c0: 5f63 6f6c 6c65 6374 696f 6e5f 6372 7564  _collection_crud
-000020d0: 2027 202b 2073 7472 2875 7569 642e 7575   ' + str(uuid.uu
-000020e0: 6964 3428 2929 0a20 2020 2020 2020 2063  id4()).        c
-000020f0: 6f6c 6c65 6374 696f 6e5f 696e 6465 7869  ollection_indexi
-00002100: 6e67 5f70 6f6c 6963 7920 3d20 7b27 696e  ng_policy = {'in
-00002110: 6465 7869 6e67 4d6f 6465 273a 2027 636f  dexingMode': 'co
-00002120: 6e73 6973 7465 6e74 277d 0a20 2020 2020  nsistent'}.     
-00002130: 2020 2063 7265 6174 6564 5f72 6563 6f72     created_recor
-00002140: 6465 7220 3d20 5265 636f 7264 4469 6167  der = RecordDiag
-00002150: 6e6f 7374 6963 7328 290a 2020 2020 2020  nostics().      
-00002160: 2020 6372 6561 7465 645f 636f 6c6c 6563    created_collec
-00002170: 7469 6f6e 203d 2063 7265 6174 6564 5f64  tion = created_d
-00002180: 622e 6372 6561 7465 5f63 6f6e 7461 696e  b.create_contain
-00002190: 6572 2869 643d 636f 6c6c 6563 7469 6f6e  er(id=collection
-000021a0: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
+000015b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000015c0: 6164 5f64 622e 7265 6164 290a 0a20 2020  ad_db.read)..   
+000015d0: 2020 2020 2064 6174 6162 6173 655f 7072       database_pr
+000015e0: 6f78 7920 3d20 7365 6c66 2e63 6c69 656e  oxy = self.clien
+000015f0: 742e 6372 6561 7465 5f64 6174 6162 6173  t.create_databas
+00001600: 655f 6966 5f6e 6f74 5f65 7869 7374 7328  e_if_not_exists(
+00001610: 6964 3d64 6174 6162 6173 655f 6964 2c20  id=database_id, 
+00001620: 6f66 6665 725f 7468 726f 7567 6870 7574  offer_throughput
+00001630: 3d31 3030 3030 290a 2020 2020 2020 2020  =10000).        
+00001640: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00001650: 2864 6174 6162 6173 655f 6964 2c20 6461  (database_id, da
+00001660: 7461 6261 7365 5f70 726f 7879 2e69 6429  tabase_proxy.id)
+00001670: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00001680: 7365 7274 4571 7561 6c28 3130 3030 302c  sertEqual(10000,
+00001690: 2064 6174 6162 6173 655f 7072 6f78 792e   database_proxy.
+000016a0: 7265 6164 5f6f 6666 6572 2829 2e6f 6666  read_offer().off
+000016b0: 6572 5f74 6872 6f75 6768 7075 7429 0a0a  er_throughput)..
+000016c0: 2020 2020 2020 2020 6461 7461 6261 7365          database
+000016d0: 5f70 726f 7879 203d 2073 656c 662e 636c  _proxy = self.cl
+000016e0: 6965 6e74 2e63 7265 6174 655f 6461 7461  ient.create_data
+000016f0: 6261 7365 5f69 665f 6e6f 745f 6578 6973  base_if_not_exis
+00001700: 7473 2869 643d 6461 7461 6261 7365 5f69  ts(id=database_i
+00001710: 642c 206f 6666 6572 5f74 6872 6f75 6768  d, offer_through
+00001720: 7075 743d 3930 3030 290a 2020 2020 2020  put=9000).      
+00001730: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00001740: 616c 2864 6174 6162 6173 655f 6964 2c20  al(database_id, 
+00001750: 6461 7461 6261 7365 5f70 726f 7879 2e69  database_proxy.i
+00001760: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
+00001770: 6173 7365 7274 4571 7561 6c28 3130 3030  assertEqual(1000
+00001780: 302c 2064 6174 6162 6173 655f 7072 6f78  0, database_prox
+00001790: 792e 7265 6164 5f6f 6666 6572 2829 2e6f  y.read_offer().o
+000017a0: 6666 6572 5f74 6872 6f75 6768 7075 7429  ffer_throughput)
+000017b0: 0a0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+000017c0: 6c69 656e 742e 6465 6c65 7465 5f64 6174  lient.delete_dat
+000017d0: 6162 6173 6528 6461 7461 6261 7365 5f69  abase(database_i
+000017e0: 6429 0a0a 2020 2020 4070 7974 6573 742e  d)..    @pytest.
+000017f0: 6d61 726b 2e73 6b69 7028 2273 6b69 7070  mark.skip("skipp
+00001800: 696e 6720 6173 2074 6865 2054 6573 7452  ing as the TestR
+00001810: 6573 6f75 7263 6573 2073 7562 7363 7269  esources subscri
+00001820: 7074 696f 6e20 646f 6573 6e27 7420 7375  ption doesn't su
+00001830: 7070 6f72 7420 7468 6973 206f 6666 6572  pport this offer
+00001840: 2229 0a20 2020 2064 6566 2074 6573 745f  ").    def test_
+00001850: 6461 7461 6261 7365 5f6c 6576 656c 5f6f  database_level_o
+00001860: 6666 6572 5f74 6872 6f75 6768 7075 7428  ffer_throughput(
+00001870: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
+00001880: 2043 7265 6174 6520 6120 6461 7461 6261   Create a databa
+00001890: 7365 2077 6974 6820 7468 726f 7567 6870  se with throughp
+000018a0: 7574 0a20 2020 2020 2020 206f 6666 6572  ut.        offer
+000018b0: 5f74 6872 6f75 6768 7075 7420 3d20 3130  _throughput = 10
+000018c0: 3030 0a20 2020 2020 2020 2064 6174 6162  00.        datab
+000018d0: 6173 655f 6964 203d 2073 7472 2875 7569  ase_id = str(uui
+000018e0: 642e 7575 6964 3428 2929 0a20 2020 2020  d.uuid4()).     
+000018f0: 2020 2063 7265 6174 6564 5f64 6220 3d20     created_db = 
+00001900: 7365 6c66 2e63 6c69 656e 742e 6372 6561  self.client.crea
+00001910: 7465 5f64 6174 6162 6173 6528 0a20 2020  te_database(.   
+00001920: 2020 2020 2020 2020 2069 643d 6461 7461           id=data
+00001930: 6261 7365 5f69 642c 0a20 2020 2020 2020  base_id,.       
+00001940: 2020 2020 206f 6666 6572 5f74 6872 6f75       offer_throu
+00001950: 6768 7075 743d 6f66 6665 725f 7468 726f  ghput=offer_thro
+00001960: 7567 6870 7574 0a20 2020 2020 2020 2029  ughput.        )
+00001970: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00001980: 7365 7274 4571 7561 6c28 6372 6561 7465  sertEqual(create
+00001990: 645f 6462 2e69 642c 2064 6174 6162 6173  d_db.id, databas
+000019a0: 655f 6964 290a 0a20 2020 2020 2020 2023  e_id)..        #
+000019b0: 2056 6572 6966 7920 6f66 6665 7220 7468   Verify offer th
+000019c0: 726f 7567 6870 7574 2066 6f72 2064 6174  roughput for dat
+000019d0: 6162 6173 650a 2020 2020 2020 2020 6f66  abase.        of
+000019e0: 6665 7220 3d20 6372 6561 7465 645f 6462  fer = created_db
+000019f0: 2e72 6561 645f 6f66 6665 7228 290a 2020  .read_offer().  
+00001a00: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00001a10: 7445 7175 616c 286f 6666 6572 2e6f 6666  tEqual(offer.off
+00001a20: 6572 5f74 6872 6f75 6768 7075 742c 206f  er_throughput, o
+00001a30: 6666 6572 5f74 6872 6f75 6768 7075 7429  ffer_throughput)
+00001a40: 0a0a 2020 2020 2020 2020 2320 5570 6461  ..        # Upda
+00001a50: 7465 2064 6174 6162 6173 6520 6f66 6665  te database offe
+00001a60: 7220 7468 726f 7567 6870 7574 0a20 2020  r throughput.   
+00001a70: 2020 2020 206e 6577 5f6f 6666 6572 5f74       new_offer_t
+00001a80: 6872 6f75 6768 7075 7420 3d20 3230 3030  hroughput = 2000
+00001a90: 0a20 2020 2020 2020 206f 6666 6572 203d  .        offer =
+00001aa0: 2063 7265 6174 6564 5f64 622e 7265 706c   created_db.repl
+00001ab0: 6163 655f 7468 726f 7567 6870 7574 286e  ace_throughput(n
+00001ac0: 6577 5f6f 6666 6572 5f74 6872 6f75 6768  ew_offer_through
+00001ad0: 7075 7429 0a20 2020 2020 2020 2073 656c  put).        sel
+00001ae0: 662e 6173 7365 7274 4571 7561 6c28 6f66  f.assertEqual(of
+00001af0: 6665 722e 6f66 6665 725f 7468 726f 7567  fer.offer_throug
+00001b00: 6870 7574 2c20 6e65 775f 6f66 6665 725f  hput, new_offer_
+00001b10: 7468 726f 7567 6870 7574 290a 2020 2020  throughput).    
+00001b20: 2020 2020 7365 6c66 2e63 6c69 656e 742e      self.client.
+00001b30: 6465 6c65 7465 5f64 6174 6162 6173 6528  delete_database(
+00001b40: 6372 6561 7465 645f 6462 2e69 6429 0a0a  created_db.id)..
+00001b50: 2020 2020 6465 6620 7465 7374 5f73 716c      def test_sql
+00001b60: 5f71 7565 7279 5f63 7275 6428 7365 6c66  _query_crud(self
+00001b70: 293a 0a20 2020 2020 2020 2023 2063 7265  ):.        # cre
+00001b80: 6174 6520 7477 6f20 6461 7461 6261 7365  ate two database
+00001b90: 732e 0a20 2020 2020 2020 2064 6231 203d  s..        db1 =
+00001ba0: 2073 656c 662e 636c 6965 6e74 2e63 7265   self.client.cre
+00001bb0: 6174 655f 6461 7461 6261 7365 2827 6461  ate_database('da
+00001bc0: 7461 6261 7365 2031 2720 2b20 7374 7228  tabase 1' + str(
+00001bd0: 7575 6964 2e75 7569 6434 2829 2929 0a20  uuid.uuid4())). 
+00001be0: 2020 2020 2020 2064 6232 203d 2073 656c         db2 = sel
+00001bf0: 662e 636c 6965 6e74 2e63 7265 6174 655f  f.client.create_
+00001c00: 6461 7461 6261 7365 2827 6461 7461 6261  database('databa
+00001c10: 7365 2032 2720 2b20 7374 7228 7575 6964  se 2' + str(uuid
+00001c20: 2e75 7569 6434 2829 2929 0a0a 2020 2020  .uuid4()))..    
+00001c30: 2020 2020 2320 7175 6572 7920 7769 7468      # query with
+00001c40: 2070 6172 616d 6574 6572 732e 0a20 2020   parameters..   
+00001c50: 2020 2020 2064 6174 6162 6173 6573 203d       databases =
+00001c60: 206c 6973 7428 7365 6c66 2e63 6c69 656e   list(self.clien
+00001c70: 742e 7175 6572 795f 6461 7461 6261 7365  t.query_database
+00001c80: 7328 7b0a 2020 2020 2020 2020 2020 2020  s({.            
+00001c90: 2771 7565 7279 273a 2027 5345 4c45 4354  'query': 'SELECT
+00001ca0: 202a 2046 524f 4d20 726f 6f74 2072 2057   * FROM root r W
+00001cb0: 4845 5245 2072 2e69 643d 4069 6427 2c0a  HERE r.id=@id',.
+00001cc0: 2020 2020 2020 2020 2020 2020 2770 6172              'par
+00001cd0: 616d 6574 6572 7327 3a20 5b0a 2020 2020  ameters': [.    
+00001ce0: 2020 2020 2020 2020 2020 2020 7b27 6e61              {'na
+00001cf0: 6d65 273a 2027 4069 6427 2c20 2776 616c  me': '@id', 'val
+00001d00: 7565 273a 2064 6231 2e69 647d 0a20 2020  ue': db1.id}.   
+00001d10: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+00001d20: 2020 207d 2929 0a20 2020 2020 2020 2073     })).        s
+00001d30: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00001d40: 312c 206c 656e 2864 6174 6162 6173 6573  1, len(databases
+00001d50: 292c 2027 556e 6578 7065 6374 6564 206e  ), 'Unexpected n
+00001d60: 756d 6265 7220 6f66 2071 7565 7279 2072  umber of query r
+00001d70: 6573 756c 7473 2e27 290a 0a20 2020 2020  esults.')..     
+00001d80: 2020 2023 2071 7565 7279 2077 6974 686f     # query witho
+00001d90: 7574 2070 6172 616d 6574 6572 732e 0a20  ut parameters.. 
+00001da0: 2020 2020 2020 2064 6174 6162 6173 6573         databases
+00001db0: 203d 206c 6973 7428 7365 6c66 2e63 6c69   = list(self.cli
+00001dc0: 656e 742e 7175 6572 795f 6461 7461 6261  ent.query_databa
+00001dd0: 7365 7328 7b0a 2020 2020 2020 2020 2020  ses({.          
+00001de0: 2020 2771 7565 7279 273a 2027 5345 4c45    'query': 'SELE
+00001df0: 4354 202a 2046 524f 4d20 726f 6f74 2072  CT * FROM root r
+00001e00: 2057 4845 5245 2072 2e69 643d 2264 6174   WHERE r.id="dat
+00001e10: 6162 6173 6520 6e6f 6e2d 6578 6973 7469  abase non-existi
+00001e20: 6e67 2227 0a20 2020 2020 2020 207d 2929  ng"'.        }))
+00001e30: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00001e40: 7365 7274 4571 7561 6c28 302c 206c 656e  sertEqual(0, len
+00001e50: 2864 6174 6162 6173 6573 292c 2027 556e  (databases), 'Un
+00001e60: 6578 7065 6374 6564 206e 756d 6265 7220  expected number 
+00001e70: 6f66 2071 7565 7279 2072 6573 756c 7473  of query results
+00001e80: 2e27 290a 0a20 2020 2020 2020 2023 2071  .')..        # q
+00001e90: 7565 7279 2077 6974 6820 6120 7374 7269  uery with a stri
+00001ea0: 6e67 2e0a 2020 2020 2020 2020 6461 7461  ng..        data
+00001eb0: 6261 7365 7320 3d20 6c69 7374 2873 656c  bases = list(sel
+00001ec0: 662e 636c 6965 6e74 2e71 7565 7279 5f64  f.client.query_d
+00001ed0: 6174 6162 6173 6573 2827 5345 4c45 4354  atabases('SELECT
+00001ee0: 202a 2046 524f 4d20 726f 6f74 2072 2057   * FROM root r W
+00001ef0: 4845 5245 2072 2e69 643d 2227 202b 2064  HERE r.id="' + d
+00001f00: 6232 2e69 6420 2b20 2722 2729 2920 2020  b2.id + '"'))   
+00001f10: 2320 6e6f 7365 630a 2020 2020 2020 2020  # nosec.        
+00001f20: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00001f30: 2831 2c20 6c65 6e28 6461 7461 6261 7365  (1, len(database
+00001f40: 7329 2c20 2755 6e65 7870 6563 7465 6420  s), 'Unexpected 
+00001f50: 6e75 6d62 6572 206f 6620 7175 6572 7920  number of query 
+00001f60: 7265 7375 6c74 732e 2729 0a20 2020 2020  results.').     
+00001f70: 2020 2073 656c 662e 636c 6965 6e74 2e64     self.client.d
+00001f80: 656c 6574 655f 6461 7461 6261 7365 2864  elete_database(d
+00001f90: 6231 2e69 6429 0a20 2020 2020 2020 2073  b1.id).        s
+00001fa0: 656c 662e 636c 6965 6e74 2e64 656c 6574  elf.client.delet
+00001fb0: 655f 6461 7461 6261 7365 2864 6232 2e69  e_database(db2.i
+00001fc0: 6429 0a0a 2020 2020 6465 6620 7465 7374  d)..    def test
+00001fd0: 5f63 6f6c 6c65 6374 696f 6e5f 6372 7564  _collection_crud
+00001fe0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00001ff0: 6372 6561 7465 645f 6462 203d 2073 656c  created_db = sel
+00002000: 662e 6461 7461 6261 7365 466f 7254 6573  f.databaseForTes
+00002010: 740a 2020 2020 2020 2020 636f 6c6c 6563  t.        collec
+00002020: 7469 6f6e 7320 3d20 6c69 7374 2863 7265  tions = list(cre
+00002030: 6174 6564 5f64 622e 6c69 7374 5f63 6f6e  ated_db.list_con
+00002040: 7461 696e 6572 7328 2929 0a20 2020 2020  tainers()).     
+00002050: 2020 2023 2063 7265 6174 6520 6120 636f     # create a co
+00002060: 6c6c 6563 7469 6f6e 0a20 2020 2020 2020  llection.       
+00002070: 2062 6566 6f72 655f 6372 6561 7465 5f63   before_create_c
+00002080: 6f6c 6c65 6374 696f 6e73 5f63 6f75 6e74  ollections_count
+00002090: 203d 206c 656e 2863 6f6c 6c65 6374 696f   = len(collectio
+000020a0: 6e73 290a 2020 2020 2020 2020 636f 6c6c  ns).        coll
+000020b0: 6563 7469 6f6e 5f69 6420 3d20 2774 6573  ection_id = 'tes
+000020c0: 745f 636f 6c6c 6563 7469 6f6e 5f63 7275  t_collection_cru
+000020d0: 6420 2720 2b20 7374 7228 7575 6964 2e75  d ' + str(uuid.u
+000020e0: 7569 6434 2829 290a 2020 2020 2020 2020  uid4()).        
+000020f0: 636f 6c6c 6563 7469 6f6e 5f69 6e64 6578  collection_index
+00002100: 696e 675f 706f 6c69 6379 203d 207b 2769  ing_policy = {'i
+00002110: 6e64 6578 696e 674d 6f64 6527 3a20 2763  ndexingMode': 'c
+00002120: 6f6e 7369 7374 656e 7427 7d0a 2020 2020  onsistent'}.    
+00002130: 2020 2020 6372 6561 7465 645f 7265 636f      created_reco
+00002140: 7264 6572 203d 2052 6563 6f72 6444 6961  rder = RecordDia
+00002150: 676e 6f73 7469 6373 2829 0a20 2020 2020  gnostics().     
+00002160: 2020 2063 7265 6174 6564 5f63 6f6c 6c65     created_colle
+00002170: 6374 696f 6e20 3d20 6372 6561 7465 645f  ction = created_
+00002180: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
+00002190: 6e65 7228 6964 3d63 6f6c 6c65 6374 696f  ner(id=collectio
+000021a0: 6e5f 6964 2c0a 2020 2020 2020 2020 2020  n_id,.          
 000021b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000021c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000021d0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-000021e0: 6465 7869 6e67 5f70 6f6c 6963 793d 636f  dexing_policy=co
-000021f0: 6c6c 6563 7469 6f6e 5f69 6e64 6578 696e  llection_indexin
-00002200: 675f 706f 6c69 6379 2c0a 2020 2020 2020  g_policy,.      
+000021d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000021e0: 6e64 6578 696e 675f 706f 6c69 6379 3d63  ndexing_policy=c
+000021f0: 6f6c 6c65 6374 696f 6e5f 696e 6465 7869  ollection_indexi
+00002200: 6e67 5f70 6f6c 6963 792c 0a20 2020 2020  ng_policy,.     
 00002210: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002220: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002240: 2020 2070 6172 7469 7469 6f6e 5f6b 6579     partition_key
-00002250: 3d50 6172 7469 7469 6f6e 4b65 7928 7061  =PartitionKey(pa
-00002260: 7468 3d22 2f70 6b22 2c20 6b69 6e64 3d22  th="/pk", kind="
-00002270: 4861 7368 2229 2c20 0a20 2020 2020 2020  Hash"), .       
+00002240: 2020 2020 7061 7274 6974 696f 6e5f 6b65      partition_ke
+00002250: 793d 5061 7274 6974 696f 6e4b 6579 2870  y=PartitionKey(p
+00002260: 6174 683d 222f 706b 222c 206b 696e 643d  ath="/pk", kind=
+00002270: 2248 6173 6822 292c 200a 2020 2020 2020  "Hash"), .      
 00002280: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002290: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000022a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000022b0: 2020 7265 7370 6f6e 7365 5f68 6f6f 6b3d    response_hook=
-000022c0: 6372 6561 7465 645f 7265 636f 7264 6572  created_recorder
-000022d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000022e0: 7373 6572 7445 7175 616c 2863 6f6c 6c65  ssertEqual(colle
-000022f0: 6374 696f 6e5f 6964 2c20 6372 6561 7465  ction_id, create
-00002300: 645f 636f 6c6c 6563 7469 6f6e 2e69 6429  d_collection.id)
-00002310: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00002320: 6973 696e 7374 616e 6365 2863 7265 6174  isinstance(creat
-00002330: 6564 5f72 6563 6f72 6465 722e 6865 6164  ed_recorder.head
-00002340: 6572 732c 204d 6170 7069 6e67 290a 2020  ers, Mapping).  
-00002350: 2020 2020 2020 6173 7365 7274 2027 436f        assert 'Co
-00002360: 6e74 656e 742d 5479 7065 2720 696e 2063  ntent-Type' in c
-00002370: 7265 6174 6564 5f72 6563 6f72 6465 722e  reated_recorder.
-00002380: 6865 6164 6572 730a 2020 2020 2020 2020  headers.        
-00002390: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
-000023a0: 6528 6372 6561 7465 645f 7265 636f 7264  e(created_record
-000023b0: 6572 2e62 6f64 792c 204d 6170 7069 6e67  er.body, Mapping
-000023c0: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-000023d0: 2027 6964 2720 696e 2063 7265 6174 6564   'id' in created
-000023e0: 5f72 6563 6f72 6465 722e 626f 6479 0a0a  _recorder.body..
-000023f0: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-00002400: 7072 6f70 6572 7469 6573 203d 2063 7265  properties = cre
-00002410: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
-00002420: 7265 6164 2829 0a20 2020 2020 2020 2073  read().        s
-00002430: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00002440: 2763 6f6e 7369 7374 656e 7427 2c20 6372  'consistent', cr
-00002450: 6561 7465 645f 7072 6f70 6572 7469 6573  eated_properties
-00002460: 5b27 696e 6465 7869 6e67 506f 6c69 6379  ['indexingPolicy
-00002470: 275d 5b27 696e 6465 7869 6e67 4d6f 6465  ']['indexingMode
-00002480: 275d 290a 0a20 2020 2020 2020 2023 2072  '])..        # r
-00002490: 6561 6420 636f 6c6c 6563 7469 6f6e 7320  ead collections 
-000024a0: 6166 7465 7220 6372 6561 7469 6f6e 0a20  after creation. 
-000024b0: 2020 2020 2020 2063 6f6c 6c65 6374 696f         collectio
-000024c0: 6e73 203d 206c 6973 7428 6372 6561 7465  ns = list(create
-000024d0: 645f 6462 2e6c 6973 745f 636f 6e74 6169  d_db.list_contai
-000024e0: 6e65 7273 2829 290a 2020 2020 2020 2020  ners()).        
-000024f0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00002500: 286c 656e 2863 6f6c 6c65 6374 696f 6e73  (len(collections
-00002510: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00002520: 2020 2020 2020 2020 2020 2020 6265 666f              befo
-00002530: 7265 5f63 7265 6174 655f 636f 6c6c 6563  re_create_collec
-00002540: 7469 6f6e 735f 636f 756e 7420 2b20 312c  tions_count + 1,
-00002550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002560: 2020 2020 2020 2020 2020 2763 7265 6174            'creat
-00002570: 6520 7368 6f75 6c64 2069 6e63 7265 6173  e should increas
-00002580: 6520 7468 6520 6e75 6d62 6572 206f 6620  e the number of 
-00002590: 636f 6c6c 6563 7469 6f6e 7327 290a 2020  collections').  
-000025a0: 2020 2020 2020 2320 7175 6572 7920 636f        # query co
-000025b0: 6c6c 6563 7469 6f6e 730a 2020 2020 2020  llections.      
-000025c0: 2020 636f 6c6c 6563 7469 6f6e 7320 3d20    collections = 
-000025d0: 6c69 7374 2863 7265 6174 6564 5f64 622e  list(created_db.
-000025e0: 7175 6572 795f 636f 6e74 6169 6e65 7273  query_containers
-000025f0: 280a 2020 2020 2020 2020 2020 2020 7b0a  (.            {.
-00002600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002610: 2771 7565 7279 273a 2027 5345 4c45 4354  'query': 'SELECT
-00002620: 202a 2046 524f 4d20 726f 6f74 2072 2057   * FROM root r W
-00002630: 4845 5245 2072 2e69 643d 4069 6427 2c0a  HERE r.id=@id',.
-00002640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002650: 2770 6172 616d 6574 6572 7327 3a20 5b0a  'parameters': [.
-00002660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002670: 2020 2020 7b27 6e61 6d65 273a 2027 4069      {'name': '@i
-00002680: 6427 2c20 2776 616c 7565 273a 2063 6f6c  d', 'value': col
-00002690: 6c65 6374 696f 6e5f 6964 7d0a 2020 2020  lection_id}.    
-000026a0: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
-000026b0: 2020 2020 2020 2020 2020 7d29 290a 0a20            })).. 
-000026c0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000026d0: 7274 5472 7565 2863 6f6c 6c65 6374 696f  rtTrue(collectio
-000026e0: 6e73 290a 2020 2020 2020 2020 2320 6465  ns).        # de
-000026f0: 6c65 7465 2063 6f6c 6c65 6374 696f 6e0a  lete collection.
-00002700: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-00002710: 6462 2e64 656c 6574 655f 636f 6e74 6169  db.delete_contai
-00002720: 6e65 7228 6372 6561 7465 645f 636f 6c6c  ner(created_coll
-00002730: 6563 7469 6f6e 2e69 6429 0a20 2020 2020  ection.id).     
-00002740: 2020 2023 2072 6561 6420 636f 6c6c 6563     # read collec
-00002750: 7469 6f6e 2061 6674 6572 2064 656c 6574  tion after delet
-00002760: 696f 6e0a 2020 2020 2020 2020 6372 6561  ion.        crea
-00002770: 7465 645f 636f 6e74 6169 6e65 7220 3d20  ted_container = 
-00002780: 6372 6561 7465 645f 6462 2e67 6574 5f63  created_db.get_c
-00002790: 6f6e 7461 696e 6572 5f63 6c69 656e 7428  ontainer_client(
-000027a0: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
-000027b0: 6f6e 2e69 6429 0a20 2020 2020 2020 2073  on.id).        s
-000027c0: 656c 662e 5f5f 4173 7365 7274 4854 5450  elf.__AssertHTTP
-000027d0: 4661 696c 7572 6557 6974 6853 7461 7475  FailureWithStatu
-000027e0: 7328 5374 6174 7573 436f 6465 732e 4e4f  s(StatusCodes.NO
-000027f0: 545f 464f 554e 442c 0a20 2020 2020 2020  T_FOUND,.       
+000022b0: 2020 2072 6573 706f 6e73 655f 686f 6f6b     response_hook
+000022c0: 3d63 7265 6174 6564 5f72 6563 6f72 6465  =created_recorde
+000022d0: 7229 0a20 2020 2020 2020 2073 656c 662e  r).        self.
+000022e0: 6173 7365 7274 4571 7561 6c28 636f 6c6c  assertEqual(coll
+000022f0: 6563 7469 6f6e 5f69 642c 2063 7265 6174  ection_id, creat
+00002300: 6564 5f63 6f6c 6c65 6374 696f 6e2e 6964  ed_collection.id
+00002310: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+00002320: 2069 7369 6e73 7461 6e63 6528 6372 6561   isinstance(crea
+00002330: 7465 645f 7265 636f 7264 6572 2e68 6561  ted_recorder.hea
+00002340: 6465 7273 2c20 4d61 7070 696e 6729 0a20  ders, Mapping). 
+00002350: 2020 2020 2020 2061 7373 6572 7420 2743         assert 'C
+00002360: 6f6e 7465 6e74 2d54 7970 6527 2069 6e20  ontent-Type' in 
+00002370: 6372 6561 7465 645f 7265 636f 7264 6572  created_recorder
+00002380: 2e68 6561 6465 7273 0a20 2020 2020 2020  .headers.       
+00002390: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
+000023a0: 6365 2863 7265 6174 6564 5f72 6563 6f72  ce(created_recor
+000023b0: 6465 722e 626f 6479 2c20 4d61 7070 696e  der.body, Mappin
+000023c0: 6729 0a20 2020 2020 2020 2061 7373 6572  g).        asser
+000023d0: 7420 2769 6427 2069 6e20 6372 6561 7465  t 'id' in create
+000023e0: 645f 7265 636f 7264 6572 2e62 6f64 790a  d_recorder.body.
+000023f0: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+00002400: 5f70 726f 7065 7274 6965 7320 3d20 6372  _properties = cr
+00002410: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+00002420: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
+00002430: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00002440: 2827 636f 6e73 6973 7465 6e74 272c 2063  ('consistent', c
+00002450: 7265 6174 6564 5f70 726f 7065 7274 6965  reated_propertie
+00002460: 735b 2769 6e64 6578 696e 6750 6f6c 6963  s['indexingPolic
+00002470: 7927 5d5b 2769 6e64 6578 696e 674d 6f64  y']['indexingMod
+00002480: 6527 5d29 0a0a 2020 2020 2020 2020 2320  e'])..        # 
+00002490: 7265 6164 2063 6f6c 6c65 6374 696f 6e73  read collections
+000024a0: 2061 6674 6572 2063 7265 6174 696f 6e0a   after creation.
+000024b0: 2020 2020 2020 2020 636f 6c6c 6563 7469          collecti
+000024c0: 6f6e 7320 3d20 6c69 7374 2863 7265 6174  ons = list(creat
+000024d0: 6564 5f64 622e 6c69 7374 5f63 6f6e 7461  ed_db.list_conta
+000024e0: 696e 6572 7328 2929 0a20 2020 2020 2020  iners()).       
+000024f0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00002500: 6c28 6c65 6e28 636f 6c6c 6563 7469 6f6e  l(len(collection
+00002510: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
+00002520: 2020 2020 2020 2020 2020 2020 2062 6566               bef
+00002530: 6f72 655f 6372 6561 7465 5f63 6f6c 6c65  ore_create_colle
+00002540: 6374 696f 6e73 5f63 6f75 6e74 202b 2031  ctions_count + 1
+00002550: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00002560: 2020 2020 2020 2020 2020 2027 6372 6561             'crea
+00002570: 7465 2073 686f 756c 6420 696e 6372 6561  te should increa
+00002580: 7365 2074 6865 206e 756d 6265 7220 6f66  se the number of
+00002590: 2063 6f6c 6c65 6374 696f 6e73 2729 0a20   collections'). 
+000025a0: 2020 2020 2020 2023 2071 7565 7279 2063         # query c
+000025b0: 6f6c 6c65 6374 696f 6e73 0a20 2020 2020  ollections.     
+000025c0: 2020 2063 6f6c 6c65 6374 696f 6e73 203d     collections =
+000025d0: 206c 6973 7428 6372 6561 7465 645f 6462   list(created_db
+000025e0: 2e71 7565 7279 5f63 6f6e 7461 696e 6572  .query_container
+000025f0: 7328 0a20 2020 2020 2020 2020 2020 207b  s(.            {
+00002600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002610: 2027 7175 6572 7927 3a20 2753 454c 4543   'query': 'SELEC
+00002620: 5420 2a20 4652 4f4d 2072 6f6f 7420 7220  T * FROM root r 
+00002630: 5748 4552 4520 722e 6964 3d40 6964 272c  WHERE r.id=@id',
+00002640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002650: 2027 7061 7261 6d65 7465 7273 273a 205b   'parameters': [
+00002660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002670: 2020 2020 207b 276e 616d 6527 3a20 2740       {'name': '@
+00002680: 6964 272c 2027 7661 6c75 6527 3a20 636f  id', 'value': co
+00002690: 6c6c 6563 7469 6f6e 5f69 647d 0a20 2020  llection_id}.   
+000026a0: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
+000026b0: 2020 2020 2020 2020 2020 207d 2929 0a0a             }))..
+000026c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000026d0: 6572 7454 7275 6528 636f 6c6c 6563 7469  ertTrue(collecti
+000026e0: 6f6e 7329 0a20 2020 2020 2020 2023 2064  ons).        # d
+000026f0: 656c 6574 6520 636f 6c6c 6563 7469 6f6e  elete collection
+00002700: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+00002710: 5f64 622e 6465 6c65 7465 5f63 6f6e 7461  _db.delete_conta
+00002720: 696e 6572 2863 7265 6174 6564 5f63 6f6c  iner(created_col
+00002730: 6c65 6374 696f 6e2e 6964 290a 2020 2020  lection.id).    
+00002740: 2020 2020 2320 7265 6164 2063 6f6c 6c65      # read colle
+00002750: 6374 696f 6e20 6166 7465 7220 6465 6c65  ction after dele
+00002760: 7469 6f6e 0a20 2020 2020 2020 2063 7265  tion.        cre
+00002770: 6174 6564 5f63 6f6e 7461 696e 6572 203d  ated_container =
+00002780: 2063 7265 6174 6564 5f64 622e 6765 745f   created_db.get_
+00002790: 636f 6e74 6169 6e65 725f 636c 6965 6e74  container_client
+000027a0: 2863 7265 6174 6564 5f63 6f6c 6c65 6374  (created_collect
+000027b0: 696f 6e2e 6964 290a 2020 2020 2020 2020  ion.id).        
+000027c0: 7365 6c66 2e5f 5f41 7373 6572 7448 5454  self.__AssertHTT
+000027d0: 5046 6169 6c75 7265 5769 7468 5374 6174  PFailureWithStat
+000027e0: 7573 2853 7461 7475 7343 6f64 6573 2e4e  us(StatusCodes.N
+000027f0: 4f54 5f46 4f55 4e44 2c0a 2020 2020 2020  OT_FOUND,.      
 00002800: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002820: 2020 2020 6372 6561 7465 645f 636f 6e74      created_cont
-00002830: 6169 6e65 722e 7265 6164 290a 0a20 2020  ainer.read)..   
-00002840: 2020 2020 2063 6f6e 7461 696e 6572 5f70       container_p
-00002850: 726f 7879 203d 2063 7265 6174 6564 5f64  roxy = created_d
-00002860: 622e 6372 6561 7465 5f63 6f6e 7461 696e  b.create_contain
-00002870: 6572 5f69 665f 6e6f 745f 6578 6973 7473  er_if_not_exists
-00002880: 2869 643d 6372 6561 7465 645f 636f 6c6c  (id=created_coll
-00002890: 6563 7469 6f6e 2e69 642c 2070 6172 7469  ection.id, parti
-000028a0: 7469 6f6e 5f6b 6579 3d50 6172 7469 7469  tion_key=Partiti
-000028b0: 6f6e 4b65 7928 7061 7468 3d27 2f69 6427  onKey(path='/id'
-000028c0: 2c20 6b69 6e64 3d27 4861 7368 2729 290a  , kind='Hash')).
-000028d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000028e0: 6572 7445 7175 616c 2863 7265 6174 6564  ertEqual(created
-000028f0: 5f63 6f6c 6c65 6374 696f 6e2e 6964 2c20  _collection.id, 
-00002900: 636f 6e74 6169 6e65 725f 7072 6f78 792e  container_proxy.
-00002910: 6964 290a 2020 2020 2020 2020 7365 6c66  id).        self
-00002920: 2e61 7373 6572 7444 6963 7445 7175 616c  .assertDictEqual
-00002930: 2850 6172 7469 7469 6f6e 4b65 7928 7061  (PartitionKey(pa
-00002940: 7468 3d27 2f69 6427 2c20 6b69 6e64 3d27  th='/id', kind='
-00002950: 4861 7368 2729 2c20 636f 6e74 6169 6e65  Hash'), containe
-00002960: 725f 7072 6f78 792e 5f70 726f 7065 7274  r_proxy._propert
-00002970: 6965 735b 2770 6172 7469 7469 6f6e 4b65  ies['partitionKe
-00002980: 7927 5d29 0a0a 2020 2020 2020 2020 636f  y'])..        co
-00002990: 6e74 6169 6e65 725f 7072 6f78 7920 3d20  ntainer_proxy = 
-000029a0: 6372 6561 7465 645f 6462 2e63 7265 6174  created_db.creat
-000029b0: 655f 636f 6e74 6169 6e65 725f 6966 5f6e  e_container_if_n
-000029c0: 6f74 5f65 7869 7374 7328 6964 3d63 7265  ot_exists(id=cre
-000029d0: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
-000029e0: 6964 2c20 7061 7274 6974 696f 6e5f 6b65  id, partition_ke
-000029f0: 793d 6372 6561 7465 645f 7072 6f70 6572  y=created_proper
-00002a00: 7469 6573 5b27 7061 7274 6974 696f 6e4b  ties['partitionK
-00002a10: 6579 275d 290a 2020 2020 2020 2020 7365  ey']).        se
-00002a20: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-00002a30: 7265 6174 6564 5f63 6f6e 7461 696e 6572  reated_container
-00002a40: 2e69 642c 2063 6f6e 7461 696e 6572 5f70  .id, container_p
-00002a50: 726f 7879 2e69 6429 0a20 2020 2020 2020  roxy.id).       
-00002a60: 2073 656c 662e 6173 7365 7274 4469 6374   self.assertDict
-00002a70: 4571 7561 6c28 5061 7274 6974 696f 6e4b  Equal(PartitionK
-00002a80: 6579 2870 6174 683d 272f 6964 272c 206b  ey(path='/id', k
-00002a90: 696e 643d 2748 6173 6827 292c 2063 6f6e  ind='Hash'), con
-00002aa0: 7461 696e 6572 5f70 726f 7879 2e5f 7072  tainer_proxy._pr
-00002ab0: 6f70 6572 7469 6573 5b27 7061 7274 6974  operties['partit
-00002ac0: 696f 6e4b 6579 275d 290a 0a20 2020 2020  ionKey'])..     
-00002ad0: 2020 2063 7265 6174 6564 5f64 622e 6465     created_db.de
-00002ae0: 6c65 7465 5f63 6f6e 7461 696e 6572 2863  lete_container(c
-00002af0: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
-00002b00: 6e2e 6964 290a 0a20 2020 2064 6566 2074  n.id)..    def t
-00002b10: 6573 745f 7061 7274 6974 696f 6e65 645f  est_partitioned_
-00002b20: 636f 6c6c 6563 7469 6f6e 2873 656c 6629  collection(self)
-00002b30: 3a0a 2020 2020 2020 2020 6372 6561 7465  :.        create
-00002b40: 645f 6462 203d 2073 656c 662e 6461 7461  d_db = self.data
-00002b50: 6261 7365 466f 7254 6573 740a 0a20 2020  baseForTest..   
-00002b60: 2020 2020 2063 6f6c 6c65 6374 696f 6e5f       collection_
-00002b70: 6465 6669 6e69 7469 6f6e 203d 207b 2769  definition = {'i
-00002b80: 6427 3a20 2774 6573 745f 7061 7274 6974  d': 'test_partit
-00002b90: 696f 6e65 645f 636f 6c6c 6563 7469 6f6e  ioned_collection
-00002ba0: 2027 202b 2073 7472 2875 7569 642e 7575   ' + str(uuid.uu
-00002bb0: 6964 3428 2929 2c0a 2020 2020 2020 2020  id4()),.        
+00002820: 2020 2020 2063 7265 6174 6564 5f63 6f6e       created_con
+00002830: 7461 696e 6572 2e72 6561 6429 0a0a 2020  tainer.read)..  
+00002840: 2020 2020 2020 636f 6e74 6169 6e65 725f        container_
+00002850: 7072 6f78 7920 3d20 6372 6561 7465 645f  proxy = created_
+00002860: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
+00002870: 6e65 725f 6966 5f6e 6f74 5f65 7869 7374  ner_if_not_exist
+00002880: 7328 6964 3d63 7265 6174 6564 5f63 6f6c  s(id=created_col
+00002890: 6c65 6374 696f 6e2e 6964 2c20 7061 7274  lection.id, part
+000028a0: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
+000028b0: 696f 6e4b 6579 2870 6174 683d 272f 6964  ionKey(path='/id
+000028c0: 272c 206b 696e 643d 2748 6173 6827 2929  ', kind='Hash'))
+000028d0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000028e0: 7365 7274 4571 7561 6c28 6372 6561 7465  sertEqual(create
+000028f0: 645f 636f 6c6c 6563 7469 6f6e 2e69 642c  d_collection.id,
+00002900: 2063 6f6e 7461 696e 6572 5f70 726f 7879   container_proxy
+00002910: 2e69 6429 0a20 2020 2020 2020 2073 656c  .id).        sel
+00002920: 662e 6173 7365 7274 4469 6374 4571 7561  f.assertDictEqua
+00002930: 6c28 5061 7274 6974 696f 6e4b 6579 2870  l(PartitionKey(p
+00002940: 6174 683d 272f 6964 272c 206b 696e 643d  ath='/id', kind=
+00002950: 2748 6173 6827 292c 2063 6f6e 7461 696e  'Hash'), contain
+00002960: 6572 5f70 726f 7879 2e5f 7072 6f70 6572  er_proxy._proper
+00002970: 7469 6573 5b27 7061 7274 6974 696f 6e4b  ties['partitionK
+00002980: 6579 275d 290a 0a20 2020 2020 2020 2063  ey'])..        c
+00002990: 6f6e 7461 696e 6572 5f70 726f 7879 203d  ontainer_proxy =
+000029a0: 2063 7265 6174 6564 5f64 622e 6372 6561   created_db.crea
+000029b0: 7465 5f63 6f6e 7461 696e 6572 5f69 665f  te_container_if_
+000029c0: 6e6f 745f 6578 6973 7473 2869 643d 6372  not_exists(id=cr
+000029d0: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+000029e0: 2e69 642c 2070 6172 7469 7469 6f6e 5f6b  .id, partition_k
+000029f0: 6579 3d63 7265 6174 6564 5f70 726f 7065  ey=created_prope
+00002a00: 7274 6965 735b 2770 6172 7469 7469 6f6e  rties['partition
+00002a10: 4b65 7927 5d29 0a20 2020 2020 2020 2073  Key']).        s
+00002a20: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00002a30: 6372 6561 7465 645f 636f 6e74 6169 6e65  created_containe
+00002a40: 722e 6964 2c20 636f 6e74 6169 6e65 725f  r.id, container_
+00002a50: 7072 6f78 792e 6964 290a 2020 2020 2020  proxy.id).      
+00002a60: 2020 7365 6c66 2e61 7373 6572 7444 6963    self.assertDic
+00002a70: 7445 7175 616c 2850 6172 7469 7469 6f6e  tEqual(Partition
+00002a80: 4b65 7928 7061 7468 3d27 2f69 6427 2c20  Key(path='/id', 
+00002a90: 6b69 6e64 3d27 4861 7368 2729 2c20 636f  kind='Hash'), co
+00002aa0: 6e74 6169 6e65 725f 7072 6f78 792e 5f70  ntainer_proxy._p
+00002ab0: 726f 7065 7274 6965 735b 2770 6172 7469  roperties['parti
+00002ac0: 7469 6f6e 4b65 7927 5d29 0a0a 2020 2020  tionKey'])..    
+00002ad0: 2020 2020 6372 6561 7465 645f 6462 2e64      created_db.d
+00002ae0: 656c 6574 655f 636f 6e74 6169 6e65 7228  elete_container(
+00002af0: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
+00002b00: 6f6e 2e69 6429 0a0a 2020 2020 6465 6620  on.id)..    def 
+00002b10: 7465 7374 5f70 6172 7469 7469 6f6e 6564  test_partitioned
+00002b20: 5f63 6f6c 6c65 6374 696f 6e28 7365 6c66  _collection(self
+00002b30: 293a 0a20 2020 2020 2020 2063 7265 6174  ):.        creat
+00002b40: 6564 5f64 6220 3d20 7365 6c66 2e64 6174  ed_db = self.dat
+00002b50: 6162 6173 6546 6f72 5465 7374 0a0a 2020  abaseForTest..  
+00002b60: 2020 2020 2020 636f 6c6c 6563 7469 6f6e        collection
+00002b70: 5f64 6566 696e 6974 696f 6e20 3d20 7b27  _definition = {'
+00002b80: 6964 273a 2027 7465 7374 5f70 6172 7469  id': 'test_parti
+00002b90: 7469 6f6e 6564 5f63 6f6c 6c65 6374 696f  tioned_collectio
+00002ba0: 6e20 2720 2b20 7374 7228 7575 6964 2e75  n ' + str(uuid.u
+00002bb0: 7569 6434 2829 292c 0a20 2020 2020 2020  uid4()),.       
 00002bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002bd0: 2020 2020 2020 2020 2027 7061 7274 6974           'partit
-00002be0: 696f 6e4b 6579 273a 0a20 2020 2020 2020  ionKey':.       
+00002bd0: 2020 2020 2020 2020 2020 2770 6172 7469            'parti
+00002be0: 7469 6f6e 4b65 7927 3a0a 2020 2020 2020  tionKey':.      
 00002bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c00: 2020 2020 2020 2020 2020 2020 2020 7b0a                {.
-00002c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c00: 2020 2020 2020 2020 2020 2020 2020 207b                 {
+00002c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00002c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c30: 2020 2020 2020 2020 2027 7061 7468 7327           'paths'
-00002c40: 3a20 5b27 2f69 6427 5d2c 0a20 2020 2020  : ['/id'],.     
+00002c30: 2020 2020 2020 2020 2020 2770 6174 6873            'paths
+00002c40: 273a 205b 272f 6964 275d 2c0a 2020 2020  ': ['/id'],.    
 00002c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c70: 2020 2020 276b 696e 6427 3a20 646f 6375      'kind': docu
-00002c80: 6d65 6e74 732e 5061 7274 6974 696f 6e4b  ments.PartitionK
-00002c90: 696e 642e 4861 7368 0a20 2020 2020 2020  ind.Hash.       
+00002c70: 2020 2020 2027 6b69 6e64 273a 2064 6f63       'kind': doc
+00002c80: 756d 656e 7473 2e50 6172 7469 7469 6f6e  uments.Partition
+00002c90: 4b69 6e64 2e48 6173 680a 2020 2020 2020  Kind.Hash.      
 00002ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002cb0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-00002cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002cb0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00002cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00002cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ce0: 207d 0a0a 2020 2020 2020 2020 6f66 6665   }..        offe
-00002cf0: 725f 7468 726f 7567 6870 7574 203d 2031  r_throughput = 1
-00002d00: 3031 3030 0a20 2020 2020 2020 2063 7265  0100.        cre
-00002d10: 6174 6564 5f63 6f6c 6c65 6374 696f 6e20  ated_collection 
-00002d20: 3d20 6372 6561 7465 645f 6462 2e63 7265  = created_db.cre
-00002d30: 6174 655f 636f 6e74 6169 6e65 7228 6964  ate_container(id
-00002d40: 3d63 6f6c 6c65 6374 696f 6e5f 6465 6669  =collection_defi
-00002d50: 6e69 7469 6f6e 5b27 6964 275d 2c0a 2020  nition['id'],.  
+00002ce0: 2020 7d0a 0a20 2020 2020 2020 206f 6666    }..        off
+00002cf0: 6572 5f74 6872 6f75 6768 7075 7420 3d20  er_throughput = 
+00002d00: 3130 3130 300a 2020 2020 2020 2020 6372  10100.        cr
+00002d10: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+00002d20: 203d 2063 7265 6174 6564 5f64 622e 6372   = created_db.cr
+00002d30: 6561 7465 5f63 6f6e 7461 696e 6572 2869  eate_container(i
+00002d40: 643d 636f 6c6c 6563 7469 6f6e 5f64 6566  d=collection_def
+00002d50: 696e 6974 696f 6e5b 2769 6427 5d2c 0a20  inition['id'],. 
 00002d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d90: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
-00002da0: 6b65 793d 636f 6c6c 6563 7469 6f6e 5f64  key=collection_d
-00002db0: 6566 696e 6974 696f 6e5b 2770 6172 7469  efinition['parti
-00002dc0: 7469 6f6e 4b65 7927 5d2c 0a20 2020 2020  tionKey'],.     
+00002d90: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+00002da0: 5f6b 6579 3d63 6f6c 6c65 6374 696f 6e5f  _key=collection_
+00002db0: 6465 6669 6e69 7469 6f6e 5b27 7061 7274  definition['part
+00002dc0: 6974 696f 6e4b 6579 275d 2c0a 2020 2020  itionKey'],.    
 00002dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e00: 2020 206f 6666 6572 5f74 6872 6f75 6768     offer_through
-00002e10: 7075 743d 6f66 6665 725f 7468 726f 7567  put=offer_throug
-00002e20: 6870 7574 290a 0a20 2020 2020 2020 2073  hput)..        s
-00002e30: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00002e40: 636f 6c6c 6563 7469 6f6e 5f64 6566 696e  collection_defin
-00002e50: 6974 696f 6e2e 6765 7428 2769 6427 292c  ition.get('id'),
-00002e60: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-00002e70: 696f 6e2e 6964 290a 0a20 2020 2020 2020  ion.id)..       
-00002e80: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-00002e90: 696f 6e5f 7072 6f70 6572 7469 6573 203d  ion_properties =
-00002ea0: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-00002eb0: 696f 6e2e 7265 6164 2829 0a20 2020 2020  ion.read().     
-00002ec0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00002ed0: 7561 6c28 636f 6c6c 6563 7469 6f6e 5f64  ual(collection_d
-00002ee0: 6566 696e 6974 696f 6e2e 6765 7428 2770  efinition.get('p
-00002ef0: 6172 7469 7469 6f6e 4b65 7927 292e 6765  artitionKey').ge
-00002f00: 7428 2770 6174 6873 2729 5b30 5d2c 0a20  t('paths')[0],. 
+00002e00: 2020 2020 6f66 6665 725f 7468 726f 7567      offer_throug
+00002e10: 6870 7574 3d6f 6666 6572 5f74 6872 6f75  hput=offer_throu
+00002e20: 6768 7075 7429 0a0a 2020 2020 2020 2020  ghput)..        
+00002e30: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00002e40: 2863 6f6c 6c65 6374 696f 6e5f 6465 6669  (collection_defi
+00002e50: 6e69 7469 6f6e 2e67 6574 2827 6964 2729  nition.get('id')
+00002e60: 2c20 6372 6561 7465 645f 636f 6c6c 6563  , created_collec
+00002e70: 7469 6f6e 2e69 6429 0a0a 2020 2020 2020  tion.id)..      
+00002e80: 2020 6372 6561 7465 645f 636f 6c6c 6563    created_collec
+00002e90: 7469 6f6e 5f70 726f 7065 7274 6965 7320  tion_properties 
+00002ea0: 3d20 6372 6561 7465 645f 636f 6c6c 6563  = created_collec
+00002eb0: 7469 6f6e 2e72 6561 6428 290a 2020 2020  tion.read().    
+00002ec0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00002ed0: 7175 616c 2863 6f6c 6c65 6374 696f 6e5f  qual(collection_
+00002ee0: 6465 6669 6e69 7469 6f6e 2e67 6574 2827  definition.get('
+00002ef0: 7061 7274 6974 696f 6e4b 6579 2729 2e67  partitionKey').g
+00002f00: 6574 2827 7061 7468 7327 295b 305d 2c0a  et('paths')[0],.
 00002f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f20: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-00002f30: 636f 6c6c 6563 7469 6f6e 5f70 726f 7065  collection_prope
-00002f40: 7274 6965 735b 2770 6172 7469 7469 6f6e  rties['partition
-00002f50: 4b65 7927 5d5b 2770 6174 6873 275d 5b30  Key']['paths'][0
-00002f60: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-00002f70: 6173 7365 7274 4571 7561 6c28 636f 6c6c  assertEqual(coll
-00002f80: 6563 7469 6f6e 5f64 6566 696e 6974 696f  ection_definitio
-00002f90: 6e2e 6765 7428 2770 6172 7469 7469 6f6e  n.get('partition
-00002fa0: 4b65 7927 292e 6765 7428 276b 696e 6427  Key').get('kind'
-00002fb0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00002fc0: 2020 2020 2020 2020 2020 2020 6372 6561              crea
-00002fd0: 7465 645f 636f 6c6c 6563 7469 6f6e 5f70  ted_collection_p
-00002fe0: 726f 7065 7274 6965 735b 2770 6172 7469  roperties['parti
-00002ff0: 7469 6f6e 4b65 7927 5d5b 276b 696e 6427  tionKey']['kind'
-00003000: 5d29 0a0a 2020 2020 2020 2020 6578 7065  ])..        expe
-00003010: 6374 6564 5f6f 6666 6572 203d 2063 7265  cted_offer = cre
-00003020: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
-00003030: 6765 745f 7468 726f 7567 6870 7574 2829  get_throughput()
-00003040: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00003050: 7373 6572 7449 734e 6f74 4e6f 6e65 2865  ssertIsNotNone(e
-00003060: 7870 6563 7465 645f 6f66 6665 7229 0a0a  xpected_offer)..
-00003070: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00003080: 6572 7445 7175 616c 2865 7870 6563 7465  ertEqual(expecte
-00003090: 645f 6f66 6665 722e 6f66 6665 725f 7468  d_offer.offer_th
-000030a0: 726f 7567 6870 7574 2c20 6f66 6665 725f  roughput, offer_
-000030b0: 7468 726f 7567 6870 7574 290a 0a20 2020  throughput)..   
-000030c0: 2020 2020 2063 7265 6174 6564 5f64 622e       created_db.
-000030d0: 6465 6c65 7465 5f63 6f6e 7461 696e 6572  delete_container
-000030e0: 2863 7265 6174 6564 5f63 6f6c 6c65 6374  (created_collect
-000030f0: 696f 6e2e 6964 290a 0a20 2020 2064 6566  ion.id)..    def
-00003100: 2074 6573 745f 7061 7274 6974 696f 6e65   test_partitione
-00003110: 645f 636f 6c6c 6563 7469 6f6e 5f71 756f  d_collection_quo
-00003120: 7461 2873 656c 6629 3a0a 2020 2020 2020  ta(self):.      
-00003130: 2020 6372 6561 7465 645f 6462 203d 2073    created_db = s
-00003140: 656c 662e 6461 7461 6261 7365 466f 7254  elf.databaseForT
-00003150: 6573 740a 0a20 2020 2020 2020 2063 7265  est..        cre
-00003160: 6174 6564 5f63 6f6c 6c65 6374 696f 6e20  ated_collection 
-00003170: 3d20 7365 6c66 2e63 6f6e 6669 6773 2e63  = self.configs.c
-00003180: 7265 6174 655f 6d75 6c74 695f 7061 7274  reate_multi_part
-00003190: 6974 696f 6e5f 636f 6c6c 6563 7469 6f6e  ition_collection
-000031a0: 5f69 665f 6e6f 745f 6578 6973 7428 7365  _if_not_exist(se
-000031b0: 6c66 2e63 6c69 656e 7429 0a0a 2020 2020  lf.client)..    
-000031c0: 2020 2020 7265 7472 6965 7665 645f 636f      retrieved_co
-000031d0: 6c6c 6563 7469 6f6e 203d 2063 7265 6174  llection = creat
-000031e0: 6564 5f64 622e 6765 745f 636f 6e74 6169  ed_db.get_contai
-000031f0: 6e65 725f 636c 6965 6e74 280a 2020 2020  ner_client(.    
-00003200: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
-00003210: 723d 6372 6561 7465 645f 636f 6c6c 6563  r=created_collec
-00003220: 7469 6f6e 2e69 640a 2020 2020 2020 2020  tion.id.        
-00003230: 290a 0a20 2020 2020 2020 2072 6574 7269  )..        retri
-00003240: 6576 6564 5f63 6f6c 6c65 6374 696f 6e5f  eved_collection_
-00003250: 7072 6f70 6572 7469 6573 203d 2072 6574  properties = ret
-00003260: 7269 6576 6564 5f63 6f6c 6c65 6374 696f  rieved_collectio
-00003270: 6e2e 7265 6164 280a 2020 2020 2020 2020  n.read(.        
-00003280: 2020 2020 706f 7075 6c61 7465 5f70 6172      populate_par
-00003290: 7469 7469 6f6e 5f6b 6579 5f72 616e 6765  tition_key_range
-000032a0: 5f73 7461 7469 7374 6963 733d 5472 7565  _statistics=True
-000032b0: 2c0a 2020 2020 2020 2020 2020 2020 706f  ,.            po
-000032c0: 7075 6c61 7465 5f71 756f 7461 5f69 6e66  pulate_quota_inf
-000032d0: 6f3d 5472 7565 290a 2020 2020 2020 2020  o=True).        
-000032e0: 7365 6c66 2e61 7373 6572 7449 734e 6f74  self.assertIsNot
-000032f0: 4e6f 6e65 2872 6574 7269 6576 6564 5f63  None(retrieved_c
-00003300: 6f6c 6c65 6374 696f 6e5f 7072 6f70 6572  ollection_proper
-00003310: 7469 6573 2e67 6574 2822 7374 6174 6973  ties.get("statis
-00003320: 7469 6373 2229 290a 2020 2020 2020 2020  tics")).        
-00003330: 7365 6c66 2e61 7373 6572 7449 734e 6f74  self.assertIsNot
-00003340: 4e6f 6e65 2863 7265 6174 6564 5f64 622e  None(created_db.
-00003350: 636c 6965 6e74 5f63 6f6e 6e65 6374 696f  client_connectio
-00003360: 6e2e 6c61 7374 5f72 6573 706f 6e73 655f  n.last_response_
-00003370: 6865 6164 6572 732e 6765 7428 2278 2d6d  headers.get("x-m
-00003380: 732d 7265 736f 7572 6365 2d75 7361 6765  s-resource-usage
-00003390: 2229 290a 0a20 2020 2064 6566 2074 6573  "))..    def tes
-000033a0: 745f 7061 7274 6974 696f 6e65 645f 636f  t_partitioned_co
-000033b0: 6c6c 6563 7469 6f6e 5f70 6172 7469 7469  llection_partiti
-000033c0: 6f6e 5f6b 6579 5f65 7874 7261 6374 696f  on_key_extractio
-000033d0: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
-000033e0: 2063 7265 6174 6564 5f64 6220 3d20 7365   created_db = se
-000033f0: 6c66 2e64 6174 6162 6173 6546 6f72 5465  lf.databaseForTe
-00003400: 7374 0a0a 2020 2020 2020 2020 636f 6c6c  st..        coll
-00003410: 6563 7469 6f6e 5f69 6420 3d20 2774 6573  ection_id = 'tes
-00003420: 745f 7061 7274 6974 696f 6e65 645f 636f  t_partitioned_co
-00003430: 6c6c 6563 7469 6f6e 5f70 6172 7469 7469  llection_partiti
-00003440: 6f6e 5f6b 6579 5f65 7874 7261 6374 696f  on_key_extractio
-00003450: 6e20 2720 2b20 7374 7228 7575 6964 2e75  n ' + str(uuid.u
-00003460: 7569 6434 2829 290a 2020 2020 2020 2020  uid4()).        
-00003470: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
-00003480: 6f6e 203d 2063 7265 6174 6564 5f64 622e  on = created_db.
-00003490: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
-000034a0: 280a 2020 2020 2020 2020 2020 2020 6964  (.            id
-000034b0: 3d63 6f6c 6c65 6374 696f 6e5f 6964 2c0a  =collection_id,.
-000034c0: 2020 2020 2020 2020 2020 2020 7061 7274              part
-000034d0: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
-000034e0: 696f 6e4b 6579 2870 6174 683d 272f 6164  ionKey(path='/ad
-000034f0: 6472 6573 732f 7374 6174 6527 2c20 6b69  dress/state', ki
-00003500: 6e64 3d64 6f63 756d 656e 7473 2e50 6172  nd=documents.Par
-00003510: 7469 7469 6f6e 4b69 6e64 2e48 6173 6829  titionKind.Hash)
-00003520: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00003530: 2020 2020 646f 6375 6d65 6e74 5f64 6566      document_def
-00003540: 696e 6974 696f 6e20 3d20 7b27 6964 273a  inition = {'id':
-00003550: 2027 646f 6375 6d65 6e74 3127 2c0a 2020   'document1',.  
+00002f20: 2020 2020 2020 2020 2063 7265 6174 6564           created
+00002f30: 5f63 6f6c 6c65 6374 696f 6e5f 7072 6f70  _collection_prop
+00002f40: 6572 7469 6573 5b27 7061 7274 6974 696f  erties['partitio
+00002f50: 6e4b 6579 275d 5b27 7061 7468 7327 5d5b  nKey']['paths'][
+00002f60: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
+00002f70: 2e61 7373 6572 7445 7175 616c 2863 6f6c  .assertEqual(col
+00002f80: 6c65 6374 696f 6e5f 6465 6669 6e69 7469  lection_definiti
+00002f90: 6f6e 2e67 6574 2827 7061 7274 6974 696f  on.get('partitio
+00002fa0: 6e4b 6579 2729 2e67 6574 2827 6b69 6e64  nKey').get('kind
+00002fb0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
+00002fc0: 2020 2020 2020 2020 2020 2020 2063 7265               cre
+00002fd0: 6174 6564 5f63 6f6c 6c65 6374 696f 6e5f  ated_collection_
+00002fe0: 7072 6f70 6572 7469 6573 5b27 7061 7274  properties['part
+00002ff0: 6974 696f 6e4b 6579 275d 5b27 6b69 6e64  itionKey']['kind
+00003000: 275d 290a 0a20 2020 2020 2020 2065 7870  '])..        exp
+00003010: 6563 7465 645f 6f66 6665 7220 3d20 6372  ected_offer = cr
+00003020: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+00003030: 2e67 6574 5f74 6872 6f75 6768 7075 7428  .get_throughput(
+00003040: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00003050: 6173 7365 7274 4973 4e6f 744e 6f6e 6528  assertIsNotNone(
+00003060: 6578 7065 6374 6564 5f6f 6666 6572 290a  expected_offer).
+00003070: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00003080: 7365 7274 4571 7561 6c28 6578 7065 6374  sertEqual(expect
+00003090: 6564 5f6f 6666 6572 2e6f 6666 6572 5f74  ed_offer.offer_t
+000030a0: 6872 6f75 6768 7075 742c 206f 6666 6572  hroughput, offer
+000030b0: 5f74 6872 6f75 6768 7075 7429 0a0a 2020  _throughput)..  
+000030c0: 2020 2020 2020 6372 6561 7465 645f 6462        created_db
+000030d0: 2e64 656c 6574 655f 636f 6e74 6169 6e65  .delete_containe
+000030e0: 7228 6372 6561 7465 645f 636f 6c6c 6563  r(created_collec
+000030f0: 7469 6f6e 2e69 6429 0a0a 2020 2020 6465  tion.id)..    de
+00003100: 6620 7465 7374 5f70 6172 7469 7469 6f6e  f test_partition
+00003110: 6564 5f63 6f6c 6c65 6374 696f 6e5f 7175  ed_collection_qu
+00003120: 6f74 6128 7365 6c66 293a 0a20 2020 2020  ota(self):.     
+00003130: 2020 2063 7265 6174 6564 5f64 6220 3d20     created_db = 
+00003140: 7365 6c66 2e64 6174 6162 6173 6546 6f72  self.databaseFor
+00003150: 5465 7374 0a0a 2020 2020 2020 2020 6372  Test..        cr
+00003160: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+00003170: 203d 2073 656c 662e 636f 6e66 6967 732e   = self.configs.
+00003180: 6372 6561 7465 5f6d 756c 7469 5f70 6172  create_multi_par
+00003190: 7469 7469 6f6e 5f63 6f6c 6c65 6374 696f  tition_collectio
+000031a0: 6e5f 6966 5f6e 6f74 5f65 7869 7374 2873  n_if_not_exist(s
+000031b0: 656c 662e 636c 6965 6e74 290a 0a20 2020  elf.client)..   
+000031c0: 2020 2020 2072 6574 7269 6576 6564 5f63       retrieved_c
+000031d0: 6f6c 6c65 6374 696f 6e20 3d20 6372 6561  ollection = crea
+000031e0: 7465 645f 6462 2e67 6574 5f63 6f6e 7461  ted_db.get_conta
+000031f0: 696e 6572 5f63 6c69 656e 7428 0a20 2020  iner_client(.   
+00003200: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
+00003210: 6572 3d63 7265 6174 6564 5f63 6f6c 6c65  er=created_colle
+00003220: 6374 696f 6e2e 6964 0a20 2020 2020 2020  ction.id.       
+00003230: 2029 0a0a 2020 2020 2020 2020 7265 7472   )..        retr
+00003240: 6965 7665 645f 636f 6c6c 6563 7469 6f6e  ieved_collection
+00003250: 5f70 726f 7065 7274 6965 7320 3d20 7265  _properties = re
+00003260: 7472 6965 7665 645f 636f 6c6c 6563 7469  trieved_collecti
+00003270: 6f6e 2e72 6561 6428 0a20 2020 2020 2020  on.read(.       
+00003280: 2020 2020 2070 6f70 756c 6174 655f 7061       populate_pa
+00003290: 7274 6974 696f 6e5f 6b65 795f 7261 6e67  rtition_key_rang
+000032a0: 655f 7374 6174 6973 7469 6373 3d54 7275  e_statistics=Tru
+000032b0: 652c 0a20 2020 2020 2020 2020 2020 2070  e,.            p
+000032c0: 6f70 756c 6174 655f 7175 6f74 615f 696e  opulate_quota_in
+000032d0: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
+000032e0: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
+000032f0: 744e 6f6e 6528 7265 7472 6965 7665 645f  tNone(retrieved_
+00003300: 636f 6c6c 6563 7469 6f6e 5f70 726f 7065  collection_prope
+00003310: 7274 6965 732e 6765 7428 2273 7461 7469  rties.get("stati
+00003320: 7374 6963 7322 2929 0a20 2020 2020 2020  stics")).       
+00003330: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
+00003340: 744e 6f6e 6528 6372 6561 7465 645f 6462  tNone(created_db
+00003350: 2e63 6c69 656e 745f 636f 6e6e 6563 7469  .client_connecti
+00003360: 6f6e 2e6c 6173 745f 7265 7370 6f6e 7365  on.last_response
+00003370: 5f68 6561 6465 7273 2e67 6574 2822 782d  _headers.get("x-
+00003380: 6d73 2d72 6573 6f75 7263 652d 7573 6167  ms-resource-usag
+00003390: 6522 2929 0a0a 2020 2020 6465 6620 7465  e"))..    def te
+000033a0: 7374 5f70 6172 7469 7469 6f6e 6564 5f63  st_partitioned_c
+000033b0: 6f6c 6c65 6374 696f 6e5f 7061 7274 6974  ollection_partit
+000033c0: 696f 6e5f 6b65 795f 6578 7472 6163 7469  ion_key_extracti
+000033d0: 6f6e 2873 656c 6629 3a0a 2020 2020 2020  on(self):.      
+000033e0: 2020 6372 6561 7465 645f 6462 203d 2073    created_db = s
+000033f0: 656c 662e 6461 7461 6261 7365 466f 7254  elf.databaseForT
+00003400: 6573 740a 0a20 2020 2020 2020 2063 6f6c  est..        col
+00003410: 6c65 6374 696f 6e5f 6964 203d 2027 7465  lection_id = 'te
+00003420: 7374 5f70 6172 7469 7469 6f6e 6564 5f63  st_partitioned_c
+00003430: 6f6c 6c65 6374 696f 6e5f 7061 7274 6974  ollection_partit
+00003440: 696f 6e5f 6b65 795f 6578 7472 6163 7469  ion_key_extracti
+00003450: 6f6e 2027 202b 2073 7472 2875 7569 642e  on ' + str(uuid.
+00003460: 7575 6964 3428 2929 0a20 2020 2020 2020  uuid4()).       
+00003470: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
+00003480: 696f 6e20 3d20 6372 6561 7465 645f 6462  ion = created_db
+00003490: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
+000034a0: 7228 0a20 2020 2020 2020 2020 2020 2069  r(.            i
+000034b0: 643d 636f 6c6c 6563 7469 6f6e 5f69 642c  d=collection_id,
+000034c0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+000034d0: 7469 7469 6f6e 5f6b 6579 3d50 6172 7469  tition_key=Parti
+000034e0: 7469 6f6e 4b65 7928 7061 7468 3d27 2f61  tionKey(path='/a
+000034f0: 6464 7265 7373 2f73 7461 7465 272c 206b  ddress/state', k
+00003500: 696e 643d 646f 6375 6d65 6e74 732e 5061  ind=documents.Pa
+00003510: 7274 6974 696f 6e4b 696e 642e 4861 7368  rtitionKind.Hash
+00003520: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
+00003530: 2020 2020 2064 6f63 756d 656e 745f 6465       document_de
+00003540: 6669 6e69 7469 6f6e 203d 207b 2769 6427  finition = {'id'
+00003550: 3a20 2764 6f63 756d 656e 7431 272c 0a20  : 'document1',. 
 00003560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003570: 2020 2020 2020 2020 2020 2020 2027 6164               'ad
-00003580: 6472 6573 7327 3a20 7b27 7374 7265 6574  dress': {'street
-00003590: 273a 2027 3120 4d69 6372 6f73 6f66 7420  ': '1 Microsoft 
-000035a0: 5761 7927 2c0a 2020 2020 2020 2020 2020  Way',.          
+00003570: 2020 2020 2020 2020 2020 2020 2020 2761                'a
+00003580: 6464 7265 7373 273a 207b 2773 7472 6565  ddress': {'stree
+00003590: 7427 3a20 2731 204d 6963 726f 736f 6674  t': '1 Microsoft
+000035a0: 2057 6179 272c 0a20 2020 2020 2020 2020   Way',.         
 000035b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000035c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000035d0: 2027 6369 7479 273a 2027 5265 646d 6f6e   'city': 'Redmon
-000035e0: 6427 2c0a 2020 2020 2020 2020 2020 2020  d',.            
+000035d0: 2020 2763 6974 7927 3a20 2752 6564 6d6f    'city': 'Redmo
+000035e0: 6e64 272c 0a20 2020 2020 2020 2020 2020  nd',.           
 000035f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003600: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00003610: 7374 6174 6527 3a20 2757 4127 2c0a 2020  state': 'WA',.  
+00003600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003610: 2773 7461 7465 273a 2027 5741 272c 0a20  'state': 'WA',. 
 00003620: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00003630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003640: 2020 2020 2020 2020 2027 7a69 7020 636f           'zip co
-00003650: 6465 273a 2039 3830 3532 0a20 2020 2020  de': 98052.     
+00003640: 2020 2020 2020 2020 2020 277a 6970 2063            'zip c
+00003650: 6f64 6527 3a20 3938 3035 320a 2020 2020  ode': 98052.    
 00003660: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00003670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003680: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00003680: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
 00003690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000036a0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-000036b0: 2020 7365 6c66 2e4f 7269 6769 6e61 6c45    self.OriginalE
-000036c0: 7865 6375 7465 4675 6e63 7469 6f6e 203d  xecuteFunction =
-000036d0: 205f 7265 7472 795f 7574 696c 6974 792e   _retry_utility.
-000036e0: 4578 6563 7574 6546 756e 6374 696f 6e0a  ExecuteFunction.
-000036f0: 2020 2020 2020 2020 5f72 6574 7279 5f75          _retry_u
-00003700: 7469 6c69 7479 2e45 7865 6375 7465 4675  tility.ExecuteFu
-00003710: 6e63 7469 6f6e 203d 2073 656c 662e 5f4d  nction = self._M
-00003720: 6f63 6b45 7865 6375 7465 4675 6e63 7469  ockExecuteFuncti
-00003730: 6f6e 0a20 2020 2020 2020 2023 2063 7265  on.        # cre
-00003740: 6174 6520 646f 6375 6d65 6e74 2077 6974  ate document wit
-00003750: 686f 7574 2070 6172 7469 7469 6f6e 206b  hout partition k
-00003760: 6579 2062 6569 6e67 2073 7065 6369 6669  ey being specifi
-00003770: 6564 0a20 2020 2020 2020 2063 7265 6174  ed.        creat
-00003780: 6564 5f64 6f63 756d 656e 7420 3d20 6372  ed_document = cr
-00003790: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
-000037a0: 2e63 7265 6174 655f 6974 656d 2862 6f64  .create_item(bod
-000037b0: 793d 646f 6375 6d65 6e74 5f64 6566 696e  y=document_defin
-000037c0: 6974 696f 6e29 0a20 2020 2020 2020 205f  ition).        _
-000037d0: 7265 7472 795f 7574 696c 6974 792e 4578  retry_utility.Ex
-000037e0: 6563 7574 6546 756e 6374 696f 6e20 3d20  ecuteFunction = 
-000037f0: 7365 6c66 2e4f 7269 6769 6e61 6c45 7865  self.OriginalExe
-00003800: 6375 7465 4675 6e63 7469 6f6e 0a20 2020  cuteFunction.   
-00003810: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00003820: 4571 7561 6c28 7365 6c66 2e6c 6173 745f  Equal(self.last_
-00003830: 6865 6164 6572 735b 315d 2c20 275b 2257  headers[1], '["W
-00003840: 4122 5d27 290a 2020 2020 2020 2020 6465  A"]').        de
-00003850: 6c20 7365 6c66 2e6c 6173 745f 6865 6164  l self.last_head
-00003860: 6572 735b 3a5d 0a0a 2020 2020 2020 2020  ers[:]..        
-00003870: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00003880: 2863 7265 6174 6564 5f64 6f63 756d 656e  (created_documen
-00003890: 742e 6765 7428 2769 6427 292c 2064 6f63  t.get('id'), doc
-000038a0: 756d 656e 745f 6465 6669 6e69 7469 6f6e  ument_definition
-000038b0: 2e67 6574 2827 6964 2729 290a 2020 2020  .get('id')).    
-000038c0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000038d0: 7175 616c 2863 7265 6174 6564 5f64 6f63  qual(created_doc
-000038e0: 756d 656e 742e 6765 7428 2761 6464 7265  ument.get('addre
-000038f0: 7373 2729 2e67 6574 2827 7374 6174 6527  ss').get('state'
-00003900: 292c 2064 6f63 756d 656e 745f 6465 6669  ), document_defi
-00003910: 6e69 7469 6f6e 2e67 6574 2827 6164 6472  nition.get('addr
-00003920: 6573 7327 292e 6765 7428 2773 7461 7465  ess').get('state
-00003930: 2729 290a 0a20 2020 2020 2020 2063 6f6c  '))..        col
-00003940: 6c65 6374 696f 6e5f 6964 203d 2027 7465  lection_id = 'te
-00003950: 7374 5f70 6172 7469 7469 6f6e 6564 5f63  st_partitioned_c
-00003960: 6f6c 6c65 6374 696f 6e5f 7061 7274 6974  ollection_partit
-00003970: 696f 6e5f 6b65 795f 6578 7472 6163 7469  ion_key_extracti
-00003980: 6f6e 3120 2720 2b20 7374 7228 7575 6964  on1 ' + str(uuid
-00003990: 2e75 7569 6434 2829 290a 2020 2020 2020  .uuid4()).      
-000039a0: 2020 6372 6561 7465 645f 636f 6c6c 6563    created_collec
-000039b0: 7469 6f6e 3120 3d20 6372 6561 7465 645f  tion1 = created_
-000039c0: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
-000039d0: 6e65 7228 0a20 2020 2020 2020 2020 2020  ner(.           
-000039e0: 2069 643d 636f 6c6c 6563 7469 6f6e 5f69   id=collection_i
-000039f0: 642c 0a20 2020 2020 2020 2020 2020 2070  d,.            p
-00003a00: 6172 7469 7469 6f6e 5f6b 6579 3d50 6172  artition_key=Par
-00003a10: 7469 7469 6f6e 4b65 7928 7061 7468 3d27  titionKey(path='
-00003a20: 2f61 6464 7265 7373 272c 206b 696e 643d  /address', kind=
-00003a30: 646f 6375 6d65 6e74 732e 5061 7274 6974  documents.Partit
-00003a40: 696f 6e4b 696e 642e 4861 7368 290a 2020  ionKind.Hash).  
-00003a50: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00003a60: 2073 656c 662e 4f72 6967 696e 616c 4578   self.OriginalEx
-00003a70: 6563 7574 6546 756e 6374 696f 6e20 3d20  ecuteFunction = 
-00003a80: 5f72 6574 7279 5f75 7469 6c69 7479 2e45  _retry_utility.E
-00003a90: 7865 6375 7465 4675 6e63 7469 6f6e 0a20  xecuteFunction. 
-00003aa0: 2020 2020 2020 205f 7265 7472 795f 7574         _retry_ut
-00003ab0: 696c 6974 792e 4578 6563 7574 6546 756e  ility.ExecuteFun
-00003ac0: 6374 696f 6e20 3d20 7365 6c66 2e5f 4d6f  ction = self._Mo
-00003ad0: 636b 4578 6563 7574 6546 756e 6374 696f  ckExecuteFunctio
-00003ae0: 6e0a 2020 2020 2020 2020 2320 4372 6561  n.        # Crea
-00003af0: 7465 2064 6f63 756d 656e 7420 7769 7468  te document with
-00003b00: 2070 6172 7469 7469 6f6e 6b65 7920 6e6f   partitionkey no
-00003b10: 7420 7072 6573 656e 7420 6173 2061 206c  t present as a l
-00003b20: 6561 6620 6c65 7665 6c20 7072 6f70 6572  eaf level proper
-00003b30: 7479 2062 7574 2061 2064 6963 740a 2020  ty but a dict.  
-00003b40: 2020 2020 2020 6372 6561 7465 645f 646f        created_do
-00003b50: 6375 6d65 6e74 203d 2063 7265 6174 6564  cument = created
-00003b60: 5f63 6f6c 6c65 6374 696f 6e31 2e63 7265  _collection1.cre
-00003b70: 6174 655f 6974 656d 2864 6f63 756d 656e  ate_item(documen
-00003b80: 745f 6465 6669 6e69 7469 6f6e 290a 2020  t_definition).  
-00003b90: 2020 2020 2020 5f72 6574 7279 5f75 7469        _retry_uti
-00003ba0: 6c69 7479 2e45 7865 6375 7465 4675 6e63  lity.ExecuteFunc
-00003bb0: 7469 6f6e 203d 2073 656c 662e 4f72 6967  tion = self.Orig
-00003bc0: 696e 616c 4578 6563 7574 6546 756e 6374  inalExecuteFunct
-00003bd0: 696f 6e0a 2020 2020 2020 2020 7365 6c66  ion.        self
-00003be0: 2e61 7373 6572 7445 7175 616c 2873 656c  .assertEqual(sel
-00003bf0: 662e 6c61 7374 5f68 6561 6465 7273 5b31  f.last_headers[1
-00003c00: 5d2c 205b 7b7d 5d29 0a20 2020 2020 2020  ], [{}]).       
-00003c10: 2064 656c 2073 656c 662e 6c61 7374 5f68   del self.last_h
-00003c20: 6561 6465 7273 5b3a 5d0a 0a20 2020 2020  eaders[:]..     
-00003c30: 2020 2023 7365 6c66 2e61 7373 6572 7445     #self.assertE
-00003c40: 7175 616c 286f 7074 696f 6e73 5b27 7061  qual(options['pa
-00003c50: 7274 6974 696f 6e4b 6579 275d 2c20 646f  rtitionKey'], do
-00003c60: 6375 6d65 6e74 732e 556e 6465 6669 6e65  cuments.Undefine
-00003c70: 6429 0a0a 2020 2020 2020 2020 636f 6c6c  d)..        coll
-00003c80: 6563 7469 6f6e 5f69 6420 3d20 2774 6573  ection_id = 'tes
-00003c90: 745f 7061 7274 6974 696f 6e65 645f 636f  t_partitioned_co
-00003ca0: 6c6c 6563 7469 6f6e 5f70 6172 7469 7469  llection_partiti
-00003cb0: 6f6e 5f6b 6579 5f65 7874 7261 6374 696f  on_key_extractio
-00003cc0: 6e32 2027 202b 2073 7472 2875 7569 642e  n2 ' + str(uuid.
-00003cd0: 7575 6964 3428 2929 0a20 2020 2020 2020  uuid4()).       
-00003ce0: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-00003cf0: 696f 6e32 203d 2063 7265 6174 6564 5f64  ion2 = created_d
-00003d00: 622e 6372 6561 7465 5f63 6f6e 7461 696e  b.create_contain
-00003d10: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
-00003d20: 6964 3d63 6f6c 6c65 6374 696f 6e5f 6964  id=collection_id
-00003d30: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-00003d40: 7274 6974 696f 6e5f 6b65 793d 5061 7274  rtition_key=Part
-00003d50: 6974 696f 6e4b 6579 2870 6174 683d 272f  itionKey(path='/
-00003d60: 6164 6472 6573 732f 7374 6174 652f 6369  address/state/ci
-00003d70: 7479 272c 206b 696e 643d 646f 6375 6d65  ty', kind=docume
-00003d80: 6e74 732e 5061 7274 6974 696f 6e4b 696e  nts.PartitionKin
-00003d90: 642e 4861 7368 290a 2020 2020 2020 2020  d.Hash).        
-00003da0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00003db0: 4f72 6967 696e 616c 4578 6563 7574 6546  OriginalExecuteF
-00003dc0: 756e 6374 696f 6e20 3d20 5f72 6574 7279  unction = _retry
-00003dd0: 5f75 7469 6c69 7479 2e45 7865 6375 7465  _utility.Execute
-00003de0: 4675 6e63 7469 6f6e 0a20 2020 2020 2020  Function.       
-00003df0: 205f 7265 7472 795f 7574 696c 6974 792e   _retry_utility.
-00003e00: 4578 6563 7574 6546 756e 6374 696f 6e20  ExecuteFunction 
-00003e10: 3d20 7365 6c66 2e5f 4d6f 636b 4578 6563  = self._MockExec
-00003e20: 7574 6546 756e 6374 696f 6e0a 2020 2020  uteFunction.    
-00003e30: 2020 2020 2320 4372 6561 7465 2064 6f63      # Create doc
-00003e40: 756d 656e 7420 7769 7468 2070 6172 7469  ument with parti
-00003e50: 7469 6f6e 6b65 7920 6e6f 7420 7072 6573  tionkey not pres
-00003e60: 656e 7420 696e 2074 6865 2064 6f63 756d  ent in the docum
-00003e70: 656e 740a 2020 2020 2020 2020 6372 6561  ent.        crea
-00003e80: 7465 645f 646f 6375 6d65 6e74 203d 2063  ted_document = c
-00003e90: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
-00003ea0: 6e32 2e63 7265 6174 655f 6974 656d 2864  n2.create_item(d
-00003eb0: 6f63 756d 656e 745f 6465 6669 6e69 7469  ocument_definiti
-00003ec0: 6f6e 290a 2020 2020 2020 2020 5f72 6574  on).        _ret
-00003ed0: 7279 5f75 7469 6c69 7479 2e45 7865 6375  ry_utility.Execu
-00003ee0: 7465 4675 6e63 7469 6f6e 203d 2073 656c  teFunction = sel
-00003ef0: 662e 4f72 6967 696e 616c 4578 6563 7574  f.OriginalExecut
-00003f00: 6546 756e 6374 696f 6e0a 2020 2020 2020  eFunction.      
-00003f10: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00003f20: 616c 2873 656c 662e 6c61 7374 5f68 6561  al(self.last_hea
-00003f30: 6465 7273 5b31 5d2c 205b 7b7d 5d29 0a20  ders[1], [{}]). 
-00003f40: 2020 2020 2020 2064 656c 2073 656c 662e         del self.
-00003f50: 6c61 7374 5f68 6561 6465 7273 5b3a 5d0a  last_headers[:].
-00003f60: 0a20 2020 2020 2020 2023 7365 6c66 2e61  .        #self.a
-00003f70: 7373 6572 7445 7175 616c 286f 7074 696f  ssertEqual(optio
-00003f80: 6e73 5b27 7061 7274 6974 696f 6e4b 6579  ns['partitionKey
-00003f90: 275d 2c20 646f 6375 6d65 6e74 732e 556e  '], documents.Un
-00003fa0: 6465 6669 6e65 6429 0a0a 2020 2020 2020  defined)..      
-00003fb0: 2020 6372 6561 7465 645f 6462 2e64 656c    created_db.del
-00003fc0: 6574 655f 636f 6e74 6169 6e65 7228 6372  ete_container(cr
-00003fd0: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
-00003fe0: 2e69 6429 0a20 2020 2020 2020 2063 7265  .id).        cre
-00003ff0: 6174 6564 5f64 622e 6465 6c65 7465 5f63  ated_db.delete_c
-00004000: 6f6e 7461 696e 6572 2863 7265 6174 6564  ontainer(created
-00004010: 5f63 6f6c 6c65 6374 696f 6e31 2e69 6429  _collection1.id)
-00004020: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
-00004030: 5f64 622e 6465 6c65 7465 5f63 6f6e 7461  _db.delete_conta
-00004040: 696e 6572 2863 7265 6174 6564 5f63 6f6c  iner(created_col
-00004050: 6c65 6374 696f 6e32 2e69 6429 0a0a 2020  lection2.id)..  
-00004060: 2020 6465 6620 7465 7374 5f70 6172 7469    def test_parti
-00004070: 7469 6f6e 6564 5f63 6f6c 6c65 6374 696f  tioned_collectio
-00004080: 6e5f 7061 7274 6974 696f 6e5f 6b65 795f  n_partition_key_
-00004090: 6578 7472 6163 7469 6f6e 5f73 7065 6369  extraction_speci
-000040a0: 616c 5f63 6861 7273 2873 656c 6629 3a0a  al_chars(self):.
-000040b0: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-000040c0: 6462 203d 2073 656c 662e 6461 7461 6261  db = self.databa
-000040d0: 7365 466f 7254 6573 740a 0a20 2020 2020  seForTest..     
-000040e0: 2020 2063 6f6c 6c65 6374 696f 6e5f 6964     collection_id
-000040f0: 203d 2027 7465 7374 5f70 6172 7469 7469   = 'test_partiti
-00004100: 6f6e 6564 5f63 6f6c 6c65 6374 696f 6e5f  oned_collection_
-00004110: 7061 7274 6974 696f 6e5f 6b65 795f 6578  partition_key_ex
-00004120: 7472 6163 7469 6f6e 5f73 7065 6369 616c  traction_special
-00004130: 5f63 6861 7273 3120 2720 2b20 7374 7228  _chars1 ' + str(
-00004140: 7575 6964 2e75 7569 6434 2829 290a 0a20  uuid.uuid4()).. 
-00004150: 2020 2020 2020 2063 7265 6174 6564 5f63         created_c
-00004160: 6f6c 6c65 6374 696f 6e31 203d 2063 7265  ollection1 = cre
-00004170: 6174 6564 5f64 622e 6372 6561 7465 5f63  ated_db.create_c
-00004180: 6f6e 7461 696e 6572 280a 2020 2020 2020  ontainer(.      
-00004190: 2020 2020 2020 6964 3d63 6f6c 6c65 6374        id=collect
-000041a0: 696f 6e5f 6964 2c0a 2020 2020 2020 2020  ion_id,.        
-000041b0: 2020 2020 7061 7274 6974 696f 6e5f 6b65      partition_ke
-000041c0: 793d 5061 7274 6974 696f 6e4b 6579 2870  y=PartitionKey(p
-000041d0: 6174 683d 272f 5c22 6c65 7665 6c5c 2720  ath='/\"level\' 
-000041e0: 312a 2829 5c22 2f5c 226c 652f 7665 6c32  1*()\"/\"le/vel2
-000041f0: 5c22 272c 206b 696e 643d 646f 6375 6d65  \"', kind=docume
-00004200: 6e74 732e 5061 7274 6974 696f 6e4b 696e  nts.PartitionKin
-00004210: 642e 4861 7368 290a 2020 2020 2020 2020  d.Hash).        
-00004220: 290a 2020 2020 2020 2020 646f 6375 6d65  ).        docume
-00004230: 6e74 5f64 6566 696e 6974 696f 6e20 3d20  nt_definition = 
-00004240: 7b27 6964 273a 2027 646f 6375 6d65 6e74  {'id': 'document
-00004250: 3127 2c0a 2020 2020 2020 2020 2020 2020  1',.            
+000036a0: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
+000036b0: 2020 2073 656c 662e 4f72 6967 696e 616c     self.Original
+000036c0: 4578 6563 7574 6546 756e 6374 696f 6e20  ExecuteFunction 
+000036d0: 3d20 5f72 6574 7279 5f75 7469 6c69 7479  = _retry_utility
+000036e0: 2e45 7865 6375 7465 4675 6e63 7469 6f6e  .ExecuteFunction
+000036f0: 0a20 2020 2020 2020 205f 7265 7472 795f  .        _retry_
+00003700: 7574 696c 6974 792e 4578 6563 7574 6546  utility.ExecuteF
+00003710: 756e 6374 696f 6e20 3d20 7365 6c66 2e5f  unction = self._
+00003720: 4d6f 636b 4578 6563 7574 6546 756e 6374  MockExecuteFunct
+00003730: 696f 6e0a 2020 2020 2020 2020 2320 6372  ion.        # cr
+00003740: 6561 7465 2064 6f63 756d 656e 7420 7769  eate document wi
+00003750: 7468 6f75 7420 7061 7274 6974 696f 6e20  thout partition 
+00003760: 6b65 7920 6265 696e 6720 7370 6563 6966  key being specif
+00003770: 6965 640a 2020 2020 2020 2020 6372 6561  ied.        crea
+00003780: 7465 645f 646f 6375 6d65 6e74 203d 2063  ted_document = c
+00003790: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
+000037a0: 6e2e 6372 6561 7465 5f69 7465 6d28 626f  n.create_item(bo
+000037b0: 6479 3d64 6f63 756d 656e 745f 6465 6669  dy=document_defi
+000037c0: 6e69 7469 6f6e 290a 2020 2020 2020 2020  nition).        
+000037d0: 5f72 6574 7279 5f75 7469 6c69 7479 2e45  _retry_utility.E
+000037e0: 7865 6375 7465 4675 6e63 7469 6f6e 203d  xecuteFunction =
+000037f0: 2073 656c 662e 4f72 6967 696e 616c 4578   self.OriginalEx
+00003800: 6563 7574 6546 756e 6374 696f 6e0a 2020  ecuteFunction.  
+00003810: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00003820: 7445 7175 616c 2873 656c 662e 6c61 7374  tEqual(self.last
+00003830: 5f68 6561 6465 7273 5b31 5d2c 2027 5b22  _headers[1], '["
+00003840: 5741 225d 2729 0a20 2020 2020 2020 2064  WA"]').        d
+00003850: 656c 2073 656c 662e 6c61 7374 5f68 6561  el self.last_hea
+00003860: 6465 7273 5b3a 5d0a 0a20 2020 2020 2020  ders[:]..       
+00003870: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00003880: 6c28 6372 6561 7465 645f 646f 6375 6d65  l(created_docume
+00003890: 6e74 2e67 6574 2827 6964 2729 2c20 646f  nt.get('id'), do
+000038a0: 6375 6d65 6e74 5f64 6566 696e 6974 696f  cument_definitio
+000038b0: 6e2e 6765 7428 2769 6427 2929 0a20 2020  n.get('id')).   
+000038c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000038d0: 4571 7561 6c28 6372 6561 7465 645f 646f  Equal(created_do
+000038e0: 6375 6d65 6e74 2e67 6574 2827 6164 6472  cument.get('addr
+000038f0: 6573 7327 292e 6765 7428 2773 7461 7465  ess').get('state
+00003900: 2729 2c20 646f 6375 6d65 6e74 5f64 6566  '), document_def
+00003910: 696e 6974 696f 6e2e 6765 7428 2761 6464  inition.get('add
+00003920: 7265 7373 2729 2e67 6574 2827 7374 6174  ress').get('stat
+00003930: 6527 2929 0a0a 2020 2020 2020 2020 636f  e'))..        co
+00003940: 6c6c 6563 7469 6f6e 5f69 6420 3d20 2774  llection_id = 't
+00003950: 6573 745f 7061 7274 6974 696f 6e65 645f  est_partitioned_
+00003960: 636f 6c6c 6563 7469 6f6e 5f70 6172 7469  collection_parti
+00003970: 7469 6f6e 5f6b 6579 5f65 7874 7261 6374  tion_key_extract
+00003980: 696f 6e31 2027 202b 2073 7472 2875 7569  ion1 ' + str(uui
+00003990: 642e 7575 6964 3428 2929 0a20 2020 2020  d.uuid4()).     
+000039a0: 2020 2063 7265 6174 6564 5f63 6f6c 6c65     created_colle
+000039b0: 6374 696f 6e31 203d 2063 7265 6174 6564  ction1 = created
+000039c0: 5f64 622e 6372 6561 7465 5f63 6f6e 7461  _db.create_conta
+000039d0: 696e 6572 280a 2020 2020 2020 2020 2020  iner(.          
+000039e0: 2020 6964 3d63 6f6c 6c65 6374 696f 6e5f    id=collection_
+000039f0: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
+00003a00: 7061 7274 6974 696f 6e5f 6b65 793d 5061  partition_key=Pa
+00003a10: 7274 6974 696f 6e4b 6579 2870 6174 683d  rtitionKey(path=
+00003a20: 272f 6164 6472 6573 7327 2c20 6b69 6e64  '/address', kind
+00003a30: 3d64 6f63 756d 656e 7473 2e50 6172 7469  =documents.Parti
+00003a40: 7469 6f6e 4b69 6e64 2e48 6173 6829 0a20  tionKind.Hash). 
+00003a50: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00003a60: 2020 7365 6c66 2e4f 7269 6769 6e61 6c45    self.OriginalE
+00003a70: 7865 6375 7465 4675 6e63 7469 6f6e 203d  xecuteFunction =
+00003a80: 205f 7265 7472 795f 7574 696c 6974 792e   _retry_utility.
+00003a90: 4578 6563 7574 6546 756e 6374 696f 6e0a  ExecuteFunction.
+00003aa0: 2020 2020 2020 2020 5f72 6574 7279 5f75          _retry_u
+00003ab0: 7469 6c69 7479 2e45 7865 6375 7465 4675  tility.ExecuteFu
+00003ac0: 6e63 7469 6f6e 203d 2073 656c 662e 5f4d  nction = self._M
+00003ad0: 6f63 6b45 7865 6375 7465 4675 6e63 7469  ockExecuteFuncti
+00003ae0: 6f6e 0a20 2020 2020 2020 2023 2043 7265  on.        # Cre
+00003af0: 6174 6520 646f 6375 6d65 6e74 2077 6974  ate document wit
+00003b00: 6820 7061 7274 6974 696f 6e6b 6579 206e  h partitionkey n
+00003b10: 6f74 2070 7265 7365 6e74 2061 7320 6120  ot present as a 
+00003b20: 6c65 6166 206c 6576 656c 2070 726f 7065  leaf level prope
+00003b30: 7274 7920 6275 7420 6120 6469 6374 0a20  rty but a dict. 
+00003b40: 2020 2020 2020 2063 7265 6174 6564 5f64         created_d
+00003b50: 6f63 756d 656e 7420 3d20 6372 6561 7465  ocument = create
+00003b60: 645f 636f 6c6c 6563 7469 6f6e 312e 6372  d_collection1.cr
+00003b70: 6561 7465 5f69 7465 6d28 646f 6375 6d65  eate_item(docume
+00003b80: 6e74 5f64 6566 696e 6974 696f 6e29 0a20  nt_definition). 
+00003b90: 2020 2020 2020 205f 7265 7472 795f 7574         _retry_ut
+00003ba0: 696c 6974 792e 4578 6563 7574 6546 756e  ility.ExecuteFun
+00003bb0: 6374 696f 6e20 3d20 7365 6c66 2e4f 7269  ction = self.Ori
+00003bc0: 6769 6e61 6c45 7865 6375 7465 4675 6e63  ginalExecuteFunc
+00003bd0: 7469 6f6e 0a20 2020 2020 2020 2073 656c  tion.        sel
+00003be0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00003bf0: 6c66 2e6c 6173 745f 6865 6164 6572 735b  lf.last_headers[
+00003c00: 315d 2c20 5b7b 7d5d 290a 2020 2020 2020  1], [{}]).      
+00003c10: 2020 6465 6c20 7365 6c66 2e6c 6173 745f    del self.last_
+00003c20: 6865 6164 6572 735b 3a5d 0a0a 2020 2020  headers[:]..    
+00003c30: 2020 2020 2373 656c 662e 6173 7365 7274      #self.assert
+00003c40: 4571 7561 6c28 6f70 7469 6f6e 735b 2770  Equal(options['p
+00003c50: 6172 7469 7469 6f6e 4b65 7927 5d2c 2064  artitionKey'], d
+00003c60: 6f63 756d 656e 7473 2e55 6e64 6566 696e  ocuments.Undefin
+00003c70: 6564 290a 0a20 2020 2020 2020 2063 6f6c  ed)..        col
+00003c80: 6c65 6374 696f 6e5f 6964 203d 2027 7465  lection_id = 'te
+00003c90: 7374 5f70 6172 7469 7469 6f6e 6564 5f63  st_partitioned_c
+00003ca0: 6f6c 6c65 6374 696f 6e5f 7061 7274 6974  ollection_partit
+00003cb0: 696f 6e5f 6b65 795f 6578 7472 6163 7469  ion_key_extracti
+00003cc0: 6f6e 3220 2720 2b20 7374 7228 7575 6964  on2 ' + str(uuid
+00003cd0: 2e75 7569 6434 2829 290a 2020 2020 2020  .uuid4()).      
+00003ce0: 2020 6372 6561 7465 645f 636f 6c6c 6563    created_collec
+00003cf0: 7469 6f6e 3220 3d20 6372 6561 7465 645f  tion2 = created_
+00003d00: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
+00003d10: 6e65 7228 0a20 2020 2020 2020 2020 2020  ner(.           
+00003d20: 2069 643d 636f 6c6c 6563 7469 6f6e 5f69   id=collection_i
+00003d30: 642c 0a20 2020 2020 2020 2020 2020 2070  d,.            p
+00003d40: 6172 7469 7469 6f6e 5f6b 6579 3d50 6172  artition_key=Par
+00003d50: 7469 7469 6f6e 4b65 7928 7061 7468 3d27  titionKey(path='
+00003d60: 2f61 6464 7265 7373 2f73 7461 7465 2f63  /address/state/c
+00003d70: 6974 7927 2c20 6b69 6e64 3d64 6f63 756d  ity', kind=docum
+00003d80: 656e 7473 2e50 6172 7469 7469 6f6e 4b69  ents.PartitionKi
+00003d90: 6e64 2e48 6173 6829 0a20 2020 2020 2020  nd.Hash).       
+00003da0: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
+00003db0: 2e4f 7269 6769 6e61 6c45 7865 6375 7465  .OriginalExecute
+00003dc0: 4675 6e63 7469 6f6e 203d 205f 7265 7472  Function = _retr
+00003dd0: 795f 7574 696c 6974 792e 4578 6563 7574  y_utility.Execut
+00003de0: 6546 756e 6374 696f 6e0a 2020 2020 2020  eFunction.      
+00003df0: 2020 5f72 6574 7279 5f75 7469 6c69 7479    _retry_utility
+00003e00: 2e45 7865 6375 7465 4675 6e63 7469 6f6e  .ExecuteFunction
+00003e10: 203d 2073 656c 662e 5f4d 6f63 6b45 7865   = self._MockExe
+00003e20: 6375 7465 4675 6e63 7469 6f6e 0a20 2020  cuteFunction.   
+00003e30: 2020 2020 2023 2043 7265 6174 6520 646f       # Create do
+00003e40: 6375 6d65 6e74 2077 6974 6820 7061 7274  cument with part
+00003e50: 6974 696f 6e6b 6579 206e 6f74 2070 7265  itionkey not pre
+00003e60: 7365 6e74 2069 6e20 7468 6520 646f 6375  sent in the docu
+00003e70: 6d65 6e74 0a20 2020 2020 2020 2063 7265  ment.        cre
+00003e80: 6174 6564 5f64 6f63 756d 656e 7420 3d20  ated_document = 
+00003e90: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
+00003ea0: 6f6e 322e 6372 6561 7465 5f69 7465 6d28  on2.create_item(
+00003eb0: 646f 6375 6d65 6e74 5f64 6566 696e 6974  document_definit
+00003ec0: 696f 6e29 0a20 2020 2020 2020 205f 7265  ion).        _re
+00003ed0: 7472 795f 7574 696c 6974 792e 4578 6563  try_utility.Exec
+00003ee0: 7574 6546 756e 6374 696f 6e20 3d20 7365  uteFunction = se
+00003ef0: 6c66 2e4f 7269 6769 6e61 6c45 7865 6375  lf.OriginalExecu
+00003f00: 7465 4675 6e63 7469 6f6e 0a20 2020 2020  teFunction.     
+00003f10: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00003f20: 7561 6c28 7365 6c66 2e6c 6173 745f 6865  ual(self.last_he
+00003f30: 6164 6572 735b 315d 2c20 5b7b 7d5d 290a  aders[1], [{}]).
+00003f40: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+00003f50: 2e6c 6173 745f 6865 6164 6572 735b 3a5d  .last_headers[:]
+00003f60: 0a0a 2020 2020 2020 2020 2373 656c 662e  ..        #self.
+00003f70: 6173 7365 7274 4571 7561 6c28 6f70 7469  assertEqual(opti
+00003f80: 6f6e 735b 2770 6172 7469 7469 6f6e 4b65  ons['partitionKe
+00003f90: 7927 5d2c 2064 6f63 756d 656e 7473 2e55  y'], documents.U
+00003fa0: 6e64 6566 696e 6564 290a 0a20 2020 2020  ndefined)..     
+00003fb0: 2020 2063 7265 6174 6564 5f64 622e 6465     created_db.de
+00003fc0: 6c65 7465 5f63 6f6e 7461 696e 6572 2863  lete_container(c
+00003fd0: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
+00003fe0: 6e2e 6964 290a 2020 2020 2020 2020 6372  n.id).        cr
+00003ff0: 6561 7465 645f 6462 2e64 656c 6574 655f  eated_db.delete_
+00004000: 636f 6e74 6169 6e65 7228 6372 6561 7465  container(create
+00004010: 645f 636f 6c6c 6563 7469 6f6e 312e 6964  d_collection1.id
+00004020: 290a 2020 2020 2020 2020 6372 6561 7465  ).        create
+00004030: 645f 6462 2e64 656c 6574 655f 636f 6e74  d_db.delete_cont
+00004040: 6169 6e65 7228 6372 6561 7465 645f 636f  ainer(created_co
+00004050: 6c6c 6563 7469 6f6e 322e 6964 290a 0a20  llection2.id).. 
+00004060: 2020 2064 6566 2074 6573 745f 7061 7274     def test_part
+00004070: 6974 696f 6e65 645f 636f 6c6c 6563 7469  itioned_collecti
+00004080: 6f6e 5f70 6172 7469 7469 6f6e 5f6b 6579  on_partition_key
+00004090: 5f65 7874 7261 6374 696f 6e5f 7370 6563  _extraction_spec
+000040a0: 6961 6c5f 6368 6172 7328 7365 6c66 293a  ial_chars(self):
+000040b0: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+000040c0: 5f64 6220 3d20 7365 6c66 2e64 6174 6162  _db = self.datab
+000040d0: 6173 6546 6f72 5465 7374 0a0a 2020 2020  aseForTest..    
+000040e0: 2020 2020 636f 6c6c 6563 7469 6f6e 5f69      collection_i
+000040f0: 6420 3d20 2774 6573 745f 7061 7274 6974  d = 'test_partit
+00004100: 696f 6e65 645f 636f 6c6c 6563 7469 6f6e  ioned_collection
+00004110: 5f70 6172 7469 7469 6f6e 5f6b 6579 5f65  _partition_key_e
+00004120: 7874 7261 6374 696f 6e5f 7370 6563 6961  xtraction_specia
+00004130: 6c5f 6368 6172 7331 2027 202b 2073 7472  l_chars1 ' + str
+00004140: 2875 7569 642e 7575 6964 3428 2929 0a0a  (uuid.uuid4())..
+00004150: 2020 2020 2020 2020 6372 6561 7465 645f          created_
+00004160: 636f 6c6c 6563 7469 6f6e 3120 3d20 6372  collection1 = cr
+00004170: 6561 7465 645f 6462 2e63 7265 6174 655f  eated_db.create_
+00004180: 636f 6e74 6169 6e65 7228 0a20 2020 2020  container(.     
+00004190: 2020 2020 2020 2069 643d 636f 6c6c 6563         id=collec
+000041a0: 7469 6f6e 5f69 642c 0a20 2020 2020 2020  tion_id,.       
+000041b0: 2020 2020 2070 6172 7469 7469 6f6e 5f6b       partition_k
+000041c0: 6579 3d50 6172 7469 7469 6f6e 4b65 7928  ey=PartitionKey(
+000041d0: 7061 7468 3d27 2f5c 226c 6576 656c 5c27  path='/\"level\'
+000041e0: 2031 2a28 295c 222f 5c22 6c65 2f76 656c   1*()\"/\"le/vel
+000041f0: 325c 2227 2c20 6b69 6e64 3d64 6f63 756d  2\"', kind=docum
+00004200: 656e 7473 2e50 6172 7469 7469 6f6e 4b69  ents.PartitionKi
+00004210: 6e64 2e48 6173 6829 0a20 2020 2020 2020  nd.Hash).       
+00004220: 2029 0a20 2020 2020 2020 2064 6f63 756d   ).        docum
+00004230: 656e 745f 6465 6669 6e69 7469 6f6e 203d  ent_definition =
+00004240: 207b 2769 6427 3a20 2764 6f63 756d 656e   {'id': 'documen
+00004250: 7431 272c 0a20 2020 2020 2020 2020 2020  t1',.           
 00004260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004270: 2020 2022 6c65 7665 6c27 2031 2a28 2922     "level' 1*()"
-00004280: 3a20 7b22 6c65 2f76 656c 3222 3a20 2776  : {"le/vel2": 'v
-00004290: 616c 3127 7d0a 2020 2020 2020 2020 2020  al1'}.          
+00004270: 2020 2020 226c 6576 656c 2720 312a 2829      "level' 1*()
+00004280: 223a 207b 226c 652f 7665 6c32 223a 2027  ": {"le/vel2": '
+00004290: 7661 6c31 277d 0a20 2020 2020 2020 2020  val1'}.         
 000042a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042b0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-000042c0: 7365 6c66 2e4f 7269 6769 6e61 6c45 7865  self.OriginalExe
-000042d0: 6375 7465 4675 6e63 7469 6f6e 203d 205f  cuteFunction = _
-000042e0: 7265 7472 795f 7574 696c 6974 792e 4578  retry_utility.Ex
-000042f0: 6563 7574 6546 756e 6374 696f 6e0a 2020  ecuteFunction.  
-00004300: 2020 2020 2020 5f72 6574 7279 5f75 7469        _retry_uti
-00004310: 6c69 7479 2e45 7865 6375 7465 4675 6e63  lity.ExecuteFunc
-00004320: 7469 6f6e 203d 2073 656c 662e 5f4d 6f63  tion = self._Moc
-00004330: 6b45 7865 6375 7465 4675 6e63 7469 6f6e  kExecuteFunction
-00004340: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
-00004350: 5f64 6f63 756d 656e 7420 3d20 6372 6561  _document = crea
-00004360: 7465 645f 636f 6c6c 6563 7469 6f6e 312e  ted_collection1.
-00004370: 6372 6561 7465 5f69 7465 6d28 626f 6479  create_item(body
-00004380: 3d64 6f63 756d 656e 745f 6465 6669 6e69  =document_defini
-00004390: 7469 6f6e 290a 2020 2020 2020 2020 5f72  tion).        _r
-000043a0: 6574 7279 5f75 7469 6c69 7479 2e45 7865  etry_utility.Exe
-000043b0: 6375 7465 4675 6e63 7469 6f6e 203d 2073  cuteFunction = s
-000043c0: 656c 662e 4f72 6967 696e 616c 4578 6563  elf.OriginalExec
-000043d0: 7574 6546 756e 6374 696f 6e0a 2020 2020  uteFunction.    
-000043e0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000043f0: 7175 616c 2873 656c 662e 6c61 7374 5f68  qual(self.last_h
-00004400: 6561 6465 7273 5b31 5d2c 2027 5b22 7661  eaders[1], '["va
-00004410: 6c31 225d 2729 0a20 2020 2020 2020 2064  l1"]').        d
-00004420: 656c 2073 656c 662e 6c61 7374 5f68 6561  el self.last_hea
-00004430: 6465 7273 5b3a 5d0a 0a20 2020 2020 2020  ders[:]..       
-00004440: 2063 6f6c 6c65 6374 696f 6e5f 6465 6669   collection_defi
-00004450: 6e69 7469 6f6e 3220 3d20 7b0a 2020 2020  nition2 = {.    
-00004460: 2020 2020 2020 2020 2769 6427 3a20 2774          'id': 't
-00004470: 6573 745f 7061 7274 6974 696f 6e65 645f  est_partitioned_
-00004480: 636f 6c6c 6563 7469 6f6e 5f70 6172 7469  collection_parti
-00004490: 7469 6f6e 5f6b 6579 5f65 7874 7261 6374  tion_key_extract
-000044a0: 696f 6e5f 7370 6563 6961 6c5f 6368 6172  ion_special_char
-000044b0: 7332 2027 202b 2073 7472 2875 7569 642e  s2 ' + str(uuid.
-000044c0: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
-000044d0: 2020 2020 2020 2770 6172 7469 7469 6f6e        'partition
-000044e0: 4b65 7927 3a0a 2020 2020 2020 2020 2020  Key':.          
-000044f0: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
-00004500: 2020 2020 2020 2020 2020 2020 2770 6174              'pat
-00004510: 6873 273a 205b 272f 5c27 6c65 7665 6c5c  hs': ['/\'level\
-00004520: 2220 312a 2829 5c27 2f5c 276c 652f 7665  " 1*()\'/\'le/ve
-00004530: 6c32 5c27 275d 2c0a 2020 2020 2020 2020  l2\''],.        
-00004540: 2020 2020 2020 2020 2020 2020 276b 696e              'kin
-00004550: 6427 3a20 646f 6375 6d65 6e74 732e 5061  d': documents.Pa
-00004560: 7274 6974 696f 6e4b 696e 642e 4861 7368  rtitionKind.Hash
-00004570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004580: 207d 0a20 2020 2020 2020 2020 2020 207d   }.            }
-00004590: 0a0a 2020 2020 2020 2020 636f 6c6c 6563  ..        collec
-000045a0: 7469 6f6e 5f69 6420 3d20 2774 6573 745f  tion_id = 'test_
-000045b0: 7061 7274 6974 696f 6e65 645f 636f 6c6c  partitioned_coll
-000045c0: 6563 7469 6f6e 5f70 6172 7469 7469 6f6e  ection_partition
-000045d0: 5f6b 6579 5f65 7874 7261 6374 696f 6e5f  _key_extraction_
-000045e0: 7370 6563 6961 6c5f 6368 6172 7332 2027  special_chars2 '
-000045f0: 202b 2073 7472 2875 7569 642e 7575 6964   + str(uuid.uuid
-00004600: 3428 2929 0a0a 2020 2020 2020 2020 6372  4())..        cr
-00004610: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
-00004620: 3220 3d20 6372 6561 7465 645f 6462 2e63  2 = created_db.c
-00004630: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
-00004640: 0a20 2020 2020 2020 2020 2020 2069 643d  .            id=
-00004650: 636f 6c6c 6563 7469 6f6e 5f69 642c 0a20  collection_id,. 
-00004660: 2020 2020 2020 2020 2020 2070 6172 7469             parti
-00004670: 7469 6f6e 5f6b 6579 3d50 6172 7469 7469  tion_key=Partiti
-00004680: 6f6e 4b65 7928 7061 7468 3d27 2f5c 276c  onKey(path='/\'l
-00004690: 6576 656c 5c22 2031 2a28 295c 272f 5c27  evel\" 1*()\'/\'
-000046a0: 6c65 2f76 656c 325c 2727 2c20 6b69 6e64  le/vel2\'', kind
-000046b0: 3d64 6f63 756d 656e 7473 2e50 6172 7469  =documents.Parti
-000046c0: 7469 6f6e 4b69 6e64 2e48 6173 6829 0a20  tionKind.Hash). 
-000046d0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-000046e0: 2020 646f 6375 6d65 6e74 5f64 6566 696e    document_defin
-000046f0: 6974 696f 6e20 3d20 7b27 6964 273a 2027  ition = {'id': '
-00004700: 646f 6375 6d65 6e74 3227 2c0a 2020 2020  document2',.    
+000042b0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+000042c0: 2073 656c 662e 4f72 6967 696e 616c 4578   self.OriginalEx
+000042d0: 6563 7574 6546 756e 6374 696f 6e20 3d20  ecuteFunction = 
+000042e0: 5f72 6574 7279 5f75 7469 6c69 7479 2e45  _retry_utility.E
+000042f0: 7865 6375 7465 4675 6e63 7469 6f6e 0a20  xecuteFunction. 
+00004300: 2020 2020 2020 205f 7265 7472 795f 7574         _retry_ut
+00004310: 696c 6974 792e 4578 6563 7574 6546 756e  ility.ExecuteFun
+00004320: 6374 696f 6e20 3d20 7365 6c66 2e5f 4d6f  ction = self._Mo
+00004330: 636b 4578 6563 7574 6546 756e 6374 696f  ckExecuteFunctio
+00004340: 6e0a 2020 2020 2020 2020 6372 6561 7465  n.        create
+00004350: 645f 646f 6375 6d65 6e74 203d 2063 7265  d_document = cre
+00004360: 6174 6564 5f63 6f6c 6c65 6374 696f 6e31  ated_collection1
+00004370: 2e63 7265 6174 655f 6974 656d 2862 6f64  .create_item(bod
+00004380: 793d 646f 6375 6d65 6e74 5f64 6566 696e  y=document_defin
+00004390: 6974 696f 6e29 0a20 2020 2020 2020 205f  ition).        _
+000043a0: 7265 7472 795f 7574 696c 6974 792e 4578  retry_utility.Ex
+000043b0: 6563 7574 6546 756e 6374 696f 6e20 3d20  ecuteFunction = 
+000043c0: 7365 6c66 2e4f 7269 6769 6e61 6c45 7865  self.OriginalExe
+000043d0: 6375 7465 4675 6e63 7469 6f6e 0a20 2020  cuteFunction.   
+000043e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000043f0: 4571 7561 6c28 7365 6c66 2e6c 6173 745f  Equal(self.last_
+00004400: 6865 6164 6572 735b 315d 2c20 275b 2276  headers[1], '["v
+00004410: 616c 3122 5d27 290a 2020 2020 2020 2020  al1"]').        
+00004420: 6465 6c20 7365 6c66 2e6c 6173 745f 6865  del self.last_he
+00004430: 6164 6572 735b 3a5d 0a0a 2020 2020 2020  aders[:]..      
+00004440: 2020 636f 6c6c 6563 7469 6f6e 5f64 6566    collection_def
+00004450: 696e 6974 696f 6e32 203d 207b 0a20 2020  inition2 = {.   
+00004460: 2020 2020 2020 2020 2027 6964 273a 2027           'id': '
+00004470: 7465 7374 5f70 6172 7469 7469 6f6e 6564  test_partitioned
+00004480: 5f63 6f6c 6c65 6374 696f 6e5f 7061 7274  _collection_part
+00004490: 6974 696f 6e5f 6b65 795f 6578 7472 6163  ition_key_extrac
+000044a0: 7469 6f6e 5f73 7065 6369 616c 5f63 6861  tion_special_cha
+000044b0: 7273 3220 2720 2b20 7374 7228 7575 6964  rs2 ' + str(uuid
+000044c0: 2e75 7569 6434 2829 292c 0a20 2020 2020  .uuid4()),.     
+000044d0: 2020 2020 2020 2027 7061 7274 6974 696f         'partitio
+000044e0: 6e4b 6579 273a 0a20 2020 2020 2020 2020  nKey':.         
+000044f0: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
+00004500: 2020 2020 2020 2020 2020 2020 2027 7061               'pa
+00004510: 7468 7327 3a20 5b27 2f5c 276c 6576 656c  ths': ['/\'level
+00004520: 5c22 2031 2a28 295c 272f 5c27 6c65 2f76  \" 1*()\'/\'le/v
+00004530: 656c 325c 2727 5d2c 0a20 2020 2020 2020  el2\''],.       
+00004540: 2020 2020 2020 2020 2020 2020 2027 6b69               'ki
+00004550: 6e64 273a 2064 6f63 756d 656e 7473 2e50  nd': documents.P
+00004560: 6172 7469 7469 6f6e 4b69 6e64 2e48 6173  artitionKind.Has
+00004570: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
+00004580: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+00004590: 7d0a 0a20 2020 2020 2020 2063 6f6c 6c65  }..        colle
+000045a0: 6374 696f 6e5f 6964 203d 2027 7465 7374  ction_id = 'test
+000045b0: 5f70 6172 7469 7469 6f6e 6564 5f63 6f6c  _partitioned_col
+000045c0: 6c65 6374 696f 6e5f 7061 7274 6974 696f  lection_partitio
+000045d0: 6e5f 6b65 795f 6578 7472 6163 7469 6f6e  n_key_extraction
+000045e0: 5f73 7065 6369 616c 5f63 6861 7273 3220  _special_chars2 
+000045f0: 2720 2b20 7374 7228 7575 6964 2e75 7569  ' + str(uuid.uui
+00004600: 6434 2829 290a 0a20 2020 2020 2020 2063  d4())..        c
+00004610: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
+00004620: 6e32 203d 2063 7265 6174 6564 5f64 622e  n2 = created_db.
+00004630: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
+00004640: 280a 2020 2020 2020 2020 2020 2020 6964  (.            id
+00004650: 3d63 6f6c 6c65 6374 696f 6e5f 6964 2c0a  =collection_id,.
+00004660: 2020 2020 2020 2020 2020 2020 7061 7274              part
+00004670: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
+00004680: 696f 6e4b 6579 2870 6174 683d 272f 5c27  ionKey(path='/\'
+00004690: 6c65 7665 6c5c 2220 312a 2829 5c27 2f5c  level\" 1*()\'/\
+000046a0: 276c 652f 7665 6c32 5c27 272c 206b 696e  'le/vel2\'', kin
+000046b0: 643d 646f 6375 6d65 6e74 732e 5061 7274  d=documents.Part
+000046c0: 6974 696f 6e4b 696e 642e 4861 7368 290a  itionKind.Hash).
+000046d0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000046e0: 2020 2064 6f63 756d 656e 745f 6465 6669     document_defi
+000046f0: 6e69 7469 6f6e 203d 207b 2769 6427 3a20  nition = {'id': 
+00004700: 2764 6f63 756d 656e 7432 272c 0a20 2020  'document2',.   
 00004710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004720: 2020 2020 2020 2020 2020 2027 6c65 7665             'leve
-00004730: 6c5c 2220 312a 2829 273a 207b 276c 652f  l\" 1*()': {'le/
-00004740: 7665 6c32 273a 2027 7661 6c32 277d 0a20  vel2': 'val2'}. 
+00004720: 2020 2020 2020 2020 2020 2020 276c 6576              'lev
+00004730: 656c 5c22 2031 2a28 2927 3a20 7b27 6c65  el\" 1*()': {'le
+00004740: 2f76 656c 3227 3a20 2776 616c 3227 7d0a  /vel2': 'val2'}.
 00004750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004760: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-00004770: 0a20 2020 2020 2020 2073 656c 662e 4f72  .        self.Or
-00004780: 6967 696e 616c 4578 6563 7574 6546 756e  iginalExecuteFun
-00004790: 6374 696f 6e20 3d20 5f72 6574 7279 5f75  ction = _retry_u
-000047a0: 7469 6c69 7479 2e45 7865 6375 7465 4675  tility.ExecuteFu
-000047b0: 6e63 7469 6f6e 0a20 2020 2020 2020 205f  nction.        _
-000047c0: 7265 7472 795f 7574 696c 6974 792e 4578  retry_utility.Ex
-000047d0: 6563 7574 6546 756e 6374 696f 6e20 3d20  ecuteFunction = 
-000047e0: 7365 6c66 2e5f 4d6f 636b 4578 6563 7574  self._MockExecut
-000047f0: 6546 756e 6374 696f 6e0a 2020 2020 2020  eFunction.      
-00004800: 2020 2320 6372 6561 7465 2064 6f63 756d    # create docum
-00004810: 656e 7420 7769 7468 6f75 7420 7061 7274  ent without part
-00004820: 6974 696f 6e20 6b65 7920 6265 696e 6720  ition key being 
-00004830: 7370 6563 6966 6965 640a 2020 2020 2020  specified.      
-00004840: 2020 6372 6561 7465 645f 646f 6375 6d65    created_docume
-00004850: 6e74 203d 2063 7265 6174 6564 5f63 6f6c  nt = created_col
-00004860: 6c65 6374 696f 6e32 2e63 7265 6174 655f  lection2.create_
-00004870: 6974 656d 2862 6f64 793d 646f 6375 6d65  item(body=docume
-00004880: 6e74 5f64 6566 696e 6974 696f 6e29 0a20  nt_definition). 
-00004890: 2020 2020 2020 205f 7265 7472 795f 7574         _retry_ut
-000048a0: 696c 6974 792e 4578 6563 7574 6546 756e  ility.ExecuteFun
-000048b0: 6374 696f 6e20 3d20 7365 6c66 2e4f 7269  ction = self.Ori
-000048c0: 6769 6e61 6c45 7865 6375 7465 4675 6e63  ginalExecuteFunc
-000048d0: 7469 6f6e 0a20 2020 2020 2020 2073 656c  tion.        sel
-000048e0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-000048f0: 6c66 2e6c 6173 745f 6865 6164 6572 735b  lf.last_headers[
-00004900: 315d 2c20 275b 2276 616c 3222 5d27 290a  1], '["val2"]').
-00004910: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
-00004920: 2e6c 6173 745f 6865 6164 6572 735b 3a5d  .last_headers[:]
-00004930: 0a0a 2020 2020 2020 2020 6372 6561 7465  ..        create
-00004940: 645f 6462 2e64 656c 6574 655f 636f 6e74  d_db.delete_cont
-00004950: 6169 6e65 7228 6372 6561 7465 645f 636f  ainer(created_co
-00004960: 6c6c 6563 7469 6f6e 312e 6964 290a 2020  llection1.id).  
-00004970: 2020 2020 2020 6372 6561 7465 645f 6462        created_db
-00004980: 2e64 656c 6574 655f 636f 6e74 6169 6e65  .delete_containe
-00004990: 7228 6372 6561 7465 645f 636f 6c6c 6563  r(created_collec
-000049a0: 7469 6f6e 322e 6964 290a 0a20 2020 2064  tion2.id)..    d
-000049b0: 6566 2074 6573 745f 7061 7274 6974 696f  ef test_partitio
-000049c0: 6e65 645f 636f 6c6c 6563 7469 6f6e 5f70  ned_collection_p
-000049d0: 6174 685f 7061 7273 6572 2873 656c 6629  ath_parser(self)
-000049e0: 3a0a 2020 2020 2020 2020 7465 7374 5f64  :.        test_d
-000049f0: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
-00004a00: 6e61 6d65 286f 732e 7061 7468 2e61 6273  name(os.path.abs
-00004a10: 7061 7468 285f 5f66 696c 655f 5f29 290a  path(__file__)).
-00004a20: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-00004a30: 6e28 6f73 2e70 6174 682e 6a6f 696e 2874  n(os.path.join(t
-00004a40: 6573 745f 6469 722c 2022 4261 7365 6c69  est_dir, "Baseli
-00004a50: 6e65 5465 7374 2e50 6174 6850 6172 7365  neTest.PathParse
-00004a60: 722e 6a73 6f6e 2229 2920 6173 206a 736f  r.json")) as jso
-00004a70: 6e5f 6669 6c65 3a0a 2020 2020 2020 2020  n_file:.        
-00004a80: 2020 2020 656e 7472 6965 7320 3d20 6a73      entries = js
-00004a90: 6f6e 2e6c 6f61 6473 286a 736f 6e5f 6669  on.loads(json_fi
-00004aa0: 6c65 2e72 6561 6428 2929 0a20 2020 2020  le.read()).     
-00004ab0: 2020 2066 6f72 2065 6e74 7279 2069 6e20     for entry in 
-00004ac0: 656e 7472 6965 733a 0a20 2020 2020 2020  entries:.       
-00004ad0: 2020 2020 2070 6172 7473 203d 2062 6173       parts = bas
-00004ae0: 652e 5061 7273 6550 6174 6873 285b 656e  e.ParsePaths([en
-00004af0: 7472 795b 2770 6174 6827 5d5d 290a 2020  try['path']]).  
-00004b00: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00004b10: 7373 6572 7445 7175 616c 2870 6172 7473  ssertEqual(parts
-00004b20: 2c20 656e 7472 795b 2770 6172 7473 275d  , entry['parts']
-00004b30: 290a 0a20 2020 2020 2020 2070 6174 6873  )..        paths
-00004b40: 203d 205b 222f 5c22 4b65 205c 5c20 5c5c   = ["/\"Ke \\ \\
-00004b50: 5c22 205c 5c5c 2720 5c5c 3f20 5c5c 6120  \" \\\' \\? \\a 
-00004b60: 5c5c 5c62 205c 5c5c 6620 5c5c 5c6e 205c  \\\b \\\f \\\n \
-00004b70: 5c5c 7220 5c5c 5c74 205c 5c76 2079 315c  \\r \\\t \\v y1\
-00004b80: 222f 2a22 5d0a 2020 2020 2020 2020 7061  "/*"].        pa
-00004b90: 7274 7320 3d20 5b22 4b65 205c 5c20 5c5c  rts = ["Ke \\ \\
-00004ba0: 5c22 205c 5c5c 2720 5c5c 3f20 5c5c 6120  \" \\\' \\? \\a 
-00004bb0: 5c5c 5c62 205c 5c5c 6620 5c5c 5c6e 205c  \\\b \\\f \\\n \
-00004bc0: 5c5c 7220 5c5c 5c74 205c 5c76 2079 3122  \\r \\\t \\v y1"
-00004bd0: 2c20 222a 225d 0a20 2020 2020 2020 2073  , "*"].        s
-00004be0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00004bf0: 7061 7274 732c 2062 6173 652e 5061 7273  parts, base.Pars
-00004c00: 6550 6174 6873 2870 6174 6873 2929 0a0a  ePaths(paths))..
-00004c10: 2020 2020 2020 2020 7061 7468 7320 3d20          paths = 
-00004c20: 5b22 2f27 4b65 205c 5c20 5c5c 5c22 205c  ["/'Ke \\ \\\" \
-00004c30: 5c5c 2720 5c5c 3f20 5c5c 6120 5c5c 5c62  \\' \\? \\a \\\b
-00004c40: 205c 5c5c 6620 5c5c 5c6e 205c 5c5c 7220   \\\f \\\n \\\r 
-00004c50: 5c5c 5c74 205c 5c76 2079 3127 2f2a 225d  \\\t \\v y1'/*"]
-00004c60: 0a20 2020 2020 2020 2070 6172 7473 203d  .        parts =
-00004c70: 205b 224b 6520 5c5c 205c 5c5c 2220 5c5c   ["Ke \\ \\\" \\
-00004c80: 5c27 205c 5c3f 205c 5c61 205c 5c5c 6220  \' \\? \\a \\\b 
-00004c90: 5c5c 5c66 205c 5c5c 6e20 5c5c 5c72 205c  \\\f \\\n \\\r \
-00004ca0: 5c5c 7420 5c5c 7620 7931 222c 2022 2a22  \\t \\v y1", "*"
-00004cb0: 5d0a 2020 2020 2020 2020 7365 6c66 2e61  ].        self.a
-00004cc0: 7373 6572 7445 7175 616c 2870 6172 7473  ssertEqual(parts
-00004cd0: 2c20 6261 7365 2e50 6172 7365 5061 7468  , base.ParsePath
-00004ce0: 7328 7061 7468 7329 290a 0a20 2020 2064  s(paths))..    d
-00004cf0: 6566 2074 6573 745f 7061 7274 6974 696f  ef test_partitio
-00004d00: 6e65 645f 636f 6c6c 6563 7469 6f6e 5f64  ned_collection_d
-00004d10: 6f63 756d 656e 745f 6372 7564 5f61 6e64  ocument_crud_and
-00004d20: 5f71 7565 7279 2873 656c 6629 3a0a 2020  _query(self):.  
-00004d30: 2020 2020 2020 6372 6561 7465 645f 6462        created_db
-00004d40: 203d 2073 656c 662e 6461 7461 6261 7365   = self.database
-00004d50: 466f 7254 6573 740a 0a20 2020 2020 2020  ForTest..       
-00004d60: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-00004d70: 696f 6e20 3d20 7365 6c66 2e63 6f6e 6669  ion = self.confi
-00004d80: 6773 2e63 7265 6174 655f 6d75 6c74 695f  gs.create_multi_
-00004d90: 7061 7274 6974 696f 6e5f 636f 6c6c 6563  partition_collec
-00004da0: 7469 6f6e 5f69 665f 6e6f 745f 6578 6973  tion_if_not_exis
-00004db0: 7428 7365 6c66 2e63 6c69 656e 7429 0a0a  t(self.client)..
-00004dc0: 2020 2020 2020 2020 646f 6375 6d65 6e74          document
-00004dd0: 5f64 6566 696e 6974 696f 6e20 3d20 7b27  _definition = {'
-00004de0: 6964 273a 2027 646f 6375 6d65 6e74 272c  id': 'document',
-00004df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004760: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00004770: 0a0a 2020 2020 2020 2020 7365 6c66 2e4f  ..        self.O
+00004780: 7269 6769 6e61 6c45 7865 6375 7465 4675  riginalExecuteFu
+00004790: 6e63 7469 6f6e 203d 205f 7265 7472 795f  nction = _retry_
+000047a0: 7574 696c 6974 792e 4578 6563 7574 6546  utility.ExecuteF
+000047b0: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
+000047c0: 5f72 6574 7279 5f75 7469 6c69 7479 2e45  _retry_utility.E
+000047d0: 7865 6375 7465 4675 6e63 7469 6f6e 203d  xecuteFunction =
+000047e0: 2073 656c 662e 5f4d 6f63 6b45 7865 6375   self._MockExecu
+000047f0: 7465 4675 6e63 7469 6f6e 0a20 2020 2020  teFunction.     
+00004800: 2020 2023 2063 7265 6174 6520 646f 6375     # create docu
+00004810: 6d65 6e74 2077 6974 686f 7574 2070 6172  ment without par
+00004820: 7469 7469 6f6e 206b 6579 2062 6569 6e67  tition key being
+00004830: 2073 7065 6369 6669 6564 0a20 2020 2020   specified.     
+00004840: 2020 2063 7265 6174 6564 5f64 6f63 756d     created_docum
+00004850: 656e 7420 3d20 6372 6561 7465 645f 636f  ent = created_co
+00004860: 6c6c 6563 7469 6f6e 322e 6372 6561 7465  llection2.create
+00004870: 5f69 7465 6d28 626f 6479 3d64 6f63 756d  _item(body=docum
+00004880: 656e 745f 6465 6669 6e69 7469 6f6e 290a  ent_definition).
+00004890: 2020 2020 2020 2020 5f72 6574 7279 5f75          _retry_u
+000048a0: 7469 6c69 7479 2e45 7865 6375 7465 4675  tility.ExecuteFu
+000048b0: 6e63 7469 6f6e 203d 2073 656c 662e 4f72  nction = self.Or
+000048c0: 6967 696e 616c 4578 6563 7574 6546 756e  iginalExecuteFun
+000048d0: 6374 696f 6e0a 2020 2020 2020 2020 7365  ction.        se
+000048e0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+000048f0: 656c 662e 6c61 7374 5f68 6561 6465 7273  elf.last_headers
+00004900: 5b31 5d2c 2027 5b22 7661 6c32 225d 2729  [1], '["val2"]')
+00004910: 0a20 2020 2020 2020 2064 656c 2073 656c  .        del sel
+00004920: 662e 6c61 7374 5f68 6561 6465 7273 5b3a  f.last_headers[:
+00004930: 5d0a 0a20 2020 2020 2020 2063 7265 6174  ]..        creat
+00004940: 6564 5f64 622e 6465 6c65 7465 5f63 6f6e  ed_db.delete_con
+00004950: 7461 696e 6572 2863 7265 6174 6564 5f63  tainer(created_c
+00004960: 6f6c 6c65 6374 696f 6e31 2e69 6429 0a20  ollection1.id). 
+00004970: 2020 2020 2020 2063 7265 6174 6564 5f64         created_d
+00004980: 622e 6465 6c65 7465 5f63 6f6e 7461 696e  b.delete_contain
+00004990: 6572 2863 7265 6174 6564 5f63 6f6c 6c65  er(created_colle
+000049a0: 6374 696f 6e32 2e69 6429 0a0a 2020 2020  ction2.id)..    
+000049b0: 6465 6620 7465 7374 5f70 6172 7469 7469  def test_partiti
+000049c0: 6f6e 6564 5f63 6f6c 6c65 6374 696f 6e5f  oned_collection_
+000049d0: 7061 7468 5f70 6172 7365 7228 7365 6c66  path_parser(self
+000049e0: 293a 0a20 2020 2020 2020 2074 6573 745f  ):.        test_
+000049f0: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
+00004a00: 726e 616d 6528 6f73 2e70 6174 682e 6162  rname(os.path.ab
+00004a10: 7370 6174 6828 5f5f 6669 6c65 5f5f 2929  spath(__file__))
+00004a20: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
+00004a30: 656e 286f 732e 7061 7468 2e6a 6f69 6e28  en(os.path.join(
+00004a40: 7465 7374 5f64 6972 2c20 2242 6173 656c  test_dir, "Basel
+00004a50: 696e 6554 6573 742e 5061 7468 5061 7273  ineTest.PathPars
+00004a60: 6572 2e6a 736f 6e22 2929 2061 7320 6a73  er.json")) as js
+00004a70: 6f6e 5f66 696c 653a 0a20 2020 2020 2020  on_file:.       
+00004a80: 2020 2020 2065 6e74 7269 6573 203d 206a       entries = j
+00004a90: 736f 6e2e 6c6f 6164 7328 6a73 6f6e 5f66  son.loads(json_f
+00004aa0: 696c 652e 7265 6164 2829 290a 2020 2020  ile.read()).    
+00004ab0: 2020 2020 666f 7220 656e 7472 7920 696e      for entry in
+00004ac0: 2065 6e74 7269 6573 3a0a 2020 2020 2020   entries:.      
+00004ad0: 2020 2020 2020 7061 7274 7320 3d20 6261        parts = ba
+00004ae0: 7365 2e50 6172 7365 5061 7468 7328 5b65  se.ParsePaths([e
+00004af0: 6e74 7279 5b27 7061 7468 275d 5d29 0a20  ntry['path']]). 
+00004b00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004b10: 6173 7365 7274 4571 7561 6c28 7061 7274  assertEqual(part
+00004b20: 732c 2065 6e74 7279 5b27 7061 7274 7327  s, entry['parts'
+00004b30: 5d29 0a0a 2020 2020 2020 2020 7061 7468  ])..        path
+00004b40: 7320 3d20 5b22 2f5c 224b 6520 5c5c 205c  s = ["/\"Ke \\ \
+00004b50: 5c5c 2220 5c5c 5c27 205c 5c3f 205c 5c61  \\" \\\' \\? \\a
+00004b60: 205c 5c5c 6220 5c5c 5c66 205c 5c5c 6e20   \\\b \\\f \\\n 
+00004b70: 5c5c 5c72 205c 5c5c 7420 5c5c 7620 7931  \\\r \\\t \\v y1
+00004b80: 5c22 2f2a 225d 0a20 2020 2020 2020 2070  \"/*"].        p
+00004b90: 6172 7473 203d 205b 224b 6520 5c5c 205c  arts = ["Ke \\ \
+00004ba0: 5c5c 2220 5c5c 5c27 205c 5c3f 205c 5c61  \\" \\\' \\? \\a
+00004bb0: 205c 5c5c 6220 5c5c 5c66 205c 5c5c 6e20   \\\b \\\f \\\n 
+00004bc0: 5c5c 5c72 205c 5c5c 7420 5c5c 7620 7931  \\\r \\\t \\v y1
+00004bd0: 222c 2022 2a22 5d0a 2020 2020 2020 2020  ", "*"].        
+00004be0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00004bf0: 2870 6172 7473 2c20 6261 7365 2e50 6172  (parts, base.Par
+00004c00: 7365 5061 7468 7328 7061 7468 7329 290a  sePaths(paths)).
+00004c10: 0a20 2020 2020 2020 2070 6174 6873 203d  .        paths =
+00004c20: 205b 222f 274b 6520 5c5c 205c 5c5c 2220   ["/'Ke \\ \\\" 
+00004c30: 5c5c 5c27 205c 5c3f 205c 5c61 205c 5c5c  \\\' \\? \\a \\\
+00004c40: 6220 5c5c 5c66 205c 5c5c 6e20 5c5c 5c72  b \\\f \\\n \\\r
+00004c50: 205c 5c5c 7420 5c5c 7620 7931 272f 2a22   \\\t \\v y1'/*"
+00004c60: 5d0a 2020 2020 2020 2020 7061 7274 7320  ].        parts 
+00004c70: 3d20 5b22 4b65 205c 5c20 5c5c 5c22 205c  = ["Ke \\ \\\" \
+00004c80: 5c5c 2720 5c5c 3f20 5c5c 6120 5c5c 5c62  \\' \\? \\a \\\b
+00004c90: 205c 5c5c 6620 5c5c 5c6e 205c 5c5c 7220   \\\f \\\n \\\r 
+00004ca0: 5c5c 5c74 205c 5c76 2079 3122 2c20 222a  \\\t \\v y1", "*
+00004cb0: 225d 0a20 2020 2020 2020 2073 656c 662e  "].        self.
+00004cc0: 6173 7365 7274 4571 7561 6c28 7061 7274  assertEqual(part
+00004cd0: 732c 2062 6173 652e 5061 7273 6550 6174  s, base.ParsePat
+00004ce0: 6873 2870 6174 6873 2929 0a0a 2020 2020  hs(paths))..    
+00004cf0: 6465 6620 7465 7374 5f70 6172 7469 7469  def test_partiti
+00004d00: 6f6e 6564 5f63 6f6c 6c65 6374 696f 6e5f  oned_collection_
+00004d10: 646f 6375 6d65 6e74 5f63 7275 645f 616e  document_crud_an
+00004d20: 645f 7175 6572 7928 7365 6c66 293a 0a20  d_query(self):. 
+00004d30: 2020 2020 2020 2063 7265 6174 6564 5f64         created_d
+00004d40: 6220 3d20 7365 6c66 2e64 6174 6162 6173  b = self.databas
+00004d50: 6546 6f72 5465 7374 0a0a 2020 2020 2020  eForTest..      
+00004d60: 2020 6372 6561 7465 645f 636f 6c6c 6563    created_collec
+00004d70: 7469 6f6e 203d 2073 656c 662e 636f 6e66  tion = self.conf
+00004d80: 6967 732e 6372 6561 7465 5f6d 756c 7469  igs.create_multi
+00004d90: 5f70 6172 7469 7469 6f6e 5f63 6f6c 6c65  _partition_colle
+00004da0: 6374 696f 6e5f 6966 5f6e 6f74 5f65 7869  ction_if_not_exi
+00004db0: 7374 2873 656c 662e 636c 6965 6e74 290a  st(self.client).
+00004dc0: 0a20 2020 2020 2020 2064 6f63 756d 656e  .        documen
+00004dd0: 745f 6465 6669 6e69 7469 6f6e 203d 207b  t_definition = {
+00004de0: 2769 6427 3a20 2764 6f63 756d 656e 7427  'id': 'document'
+00004df0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00004e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e10: 276b 6579 273a 2027 7661 6c75 6527 7d0a  'key': 'value'}.
-00004e20: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
-00004e30: 5f64 6f63 756d 656e 7420 3d20 6372 6561  _document = crea
-00004e40: 7465 645f 636f 6c6c 6563 7469 6f6e 2e63  ted_collection.c
-00004e50: 7265 6174 655f 6974 656d 280a 2020 2020  reate_item(.    
-00004e60: 2020 2020 2020 2020 626f 6479 3d64 6f63          body=doc
-00004e70: 756d 656e 745f 6465 6669 6e69 7469 6f6e  ument_definition
-00004e80: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00004e90: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00004ea0: 7175 616c 2863 7265 6174 6564 5f64 6f63  qual(created_doc
-00004eb0: 756d 656e 742e 6765 7428 2769 6427 292c  ument.get('id'),
-00004ec0: 2064 6f63 756d 656e 745f 6465 6669 6e69   document_defini
-00004ed0: 7469 6f6e 2e67 6574 2827 6964 2729 290a  tion.get('id')).
-00004ee0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00004ef0: 6572 7445 7175 616c 2863 7265 6174 6564  ertEqual(created
-00004f00: 5f64 6f63 756d 656e 742e 6765 7428 276b  _document.get('k
-00004f10: 6579 2729 2c20 646f 6375 6d65 6e74 5f64  ey'), document_d
-00004f20: 6566 696e 6974 696f 6e2e 6765 7428 276b  efinition.get('k
-00004f30: 6579 2729 290a 0a20 2020 2020 2020 2023  ey'))..        #
-00004f40: 2072 6561 6420 646f 6375 6d65 6e74 0a20   read document. 
-00004f50: 2020 2020 2020 2072 6561 645f 646f 6375         read_docu
-00004f60: 6d65 6e74 203d 2063 7265 6174 6564 5f63  ment = created_c
-00004f70: 6f6c 6c65 6374 696f 6e2e 7265 6164 5f69  ollection.read_i
-00004f80: 7465 6d28 0a20 2020 2020 2020 2020 2020  tem(.           
-00004f90: 2069 7465 6d3d 6372 6561 7465 645f 646f   item=created_do
-00004fa0: 6375 6d65 6e74 2e67 6574 2827 6964 2729  cument.get('id')
-00004fb0: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-00004fc0: 7274 6974 696f 6e5f 6b65 793d 6372 6561  rtition_key=crea
-00004fd0: 7465 645f 646f 6375 6d65 6e74 2e67 6574  ted_document.get
-00004fe0: 2827 6964 2729 0a20 2020 2020 2020 2029  ('id').        )
-00004ff0: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00005000: 7373 6572 7445 7175 616c 2872 6561 645f  ssertEqual(read_
-00005010: 646f 6375 6d65 6e74 2e67 6574 2827 6964  document.get('id
-00005020: 2729 2c20 6372 6561 7465 645f 646f 6375  '), created_docu
-00005030: 6d65 6e74 2e67 6574 2827 6964 2729 290a  ment.get('id')).
-00005040: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00005050: 6572 7445 7175 616c 2872 6561 645f 646f  ertEqual(read_do
-00005060: 6375 6d65 6e74 2e67 6574 2827 6b65 7927  cument.get('key'
-00005070: 292c 2063 7265 6174 6564 5f64 6f63 756d  ), created_docum
-00005080: 656e 742e 6765 7428 276b 6579 2729 290a  ent.get('key')).
-00005090: 0a20 2020 2020 2020 2023 2052 6561 6420  .        # Read 
-000050a0: 646f 6375 6d65 6e74 2066 6565 6420 646f  document feed do
-000050b0: 6573 6e27 7420 7265 7175 6972 6520 7061  esn't require pa
-000050c0: 7274 6974 696f 6e4b 6579 2061 7320 6974  rtitionKey as it
-000050d0: 2773 2061 6c77 6179 7320 6120 6372 6f73  's always a cros
-000050e0: 7320 7061 7274 6974 696f 6e20 7175 6572  s partition quer
-000050f0: 790a 2020 2020 2020 2020 646f 6375 6d65  y.        docume
-00005100: 6e74 6c69 7374 203d 206c 6973 7428 6372  ntlist = list(cr
-00005110: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
-00005120: 2e72 6561 645f 616c 6c5f 6974 656d 7328  .read_all_items(
-00005130: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-00005140: 6173 7365 7274 4571 7561 6c28 312c 206c  assertEqual(1, l
-00005150: 656e 2864 6f63 756d 656e 746c 6973 7429  en(documentlist)
-00005160: 290a 0a20 2020 2020 2020 2023 2072 6570  )..        # rep
-00005170: 6c61 6365 2064 6f63 756d 656e 740a 2020  lace document.  
-00005180: 2020 2020 2020 646f 6375 6d65 6e74 5f64        document_d
-00005190: 6566 696e 6974 696f 6e5b 276b 6579 275d  efinition['key']
-000051a0: 203d 2027 6e65 7720 7661 6c75 6527 0a0a   = 'new value'..
-000051b0: 2020 2020 2020 2020 7265 706c 6163 6564          replaced
-000051c0: 5f64 6f63 756d 656e 7420 3d20 6372 6561  _document = crea
-000051d0: 7465 645f 636f 6c6c 6563 7469 6f6e 2e72  ted_collection.r
-000051e0: 6570 6c61 6365 5f69 7465 6d28 0a20 2020  eplace_item(.   
-000051f0: 2020 2020 2020 2020 2069 7465 6d3d 7265           item=re
-00005200: 6164 5f64 6f63 756d 656e 742c 0a20 2020  ad_document,.   
-00005210: 2020 2020 2020 2020 2062 6f64 793d 646f           body=do
-00005220: 6375 6d65 6e74 5f64 6566 696e 6974 696f  cument_definitio
-00005230: 6e0a 2020 2020 2020 2020 290a 0a20 2020  n.        )..   
-00005240: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00005250: 4571 7561 6c28 7265 706c 6163 6564 5f64  Equal(replaced_d
-00005260: 6f63 756d 656e 742e 6765 7428 276b 6579  ocument.get('key
-00005270: 2729 2c20 646f 6375 6d65 6e74 5f64 6566  '), document_def
-00005280: 696e 6974 696f 6e2e 6765 7428 276b 6579  inition.get('key
-00005290: 2729 290a 0a20 2020 2020 2020 2023 2075  '))..        # u
-000052a0: 7073 6572 7420 646f 6375 6d65 6e74 2863  psert document(c
-000052b0: 7265 6174 6520 7363 656e 6172 696f 290a  reate scenario).
-000052c0: 2020 2020 2020 2020 646f 6375 6d65 6e74          document
-000052d0: 5f64 6566 696e 6974 696f 6e5b 2769 6427  _definition['id'
-000052e0: 5d20 3d20 2764 6f63 756d 656e 7432 270a  ] = 'document2'.
-000052f0: 2020 2020 2020 2020 646f 6375 6d65 6e74          document
-00005300: 5f64 6566 696e 6974 696f 6e5b 276b 6579  _definition['key
-00005310: 275d 203d 2027 7661 6c75 6532 270a 0a20  '] = 'value2'.. 
-00005320: 2020 2020 2020 2075 7073 6572 7465 645f         upserted_
-00005330: 646f 6375 6d65 6e74 203d 2063 7265 6174  document = creat
-00005340: 6564 5f63 6f6c 6c65 6374 696f 6e2e 7570  ed_collection.up
-00005350: 7365 7274 5f69 7465 6d28 626f 6479 3d64  sert_item(body=d
-00005360: 6f63 756d 656e 745f 6465 6669 6e69 7469  ocument_definiti
-00005370: 6f6e 290a 0a20 2020 2020 2020 2073 656c  on)..        sel
-00005380: 662e 6173 7365 7274 4571 7561 6c28 7570  f.assertEqual(up
-00005390: 7365 7274 6564 5f64 6f63 756d 656e 742e  serted_document.
-000053a0: 6765 7428 2769 6427 292c 2064 6f63 756d  get('id'), docum
-000053b0: 656e 745f 6465 6669 6e69 7469 6f6e 2e67  ent_definition.g
-000053c0: 6574 2827 6964 2729 290a 2020 2020 2020  et('id')).      
-000053d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000053e0: 616c 2875 7073 6572 7465 645f 646f 6375  al(upserted_docu
-000053f0: 6d65 6e74 2e67 6574 2827 6b65 7927 292c  ment.get('key'),
-00005400: 2064 6f63 756d 656e 745f 6465 6669 6e69   document_defini
-00005410: 7469 6f6e 2e67 6574 2827 6b65 7927 2929  tion.get('key'))
-00005420: 0a0a 2020 2020 2020 2020 646f 6375 6d65  ..        docume
-00005430: 6e74 6c69 7374 203d 206c 6973 7428 6372  ntlist = list(cr
-00005440: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
-00005450: 2e72 6561 645f 616c 6c5f 6974 656d 7328  .read_all_items(
-00005460: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-00005470: 6173 7365 7274 4571 7561 6c28 322c 206c  assertEqual(2, l
-00005480: 656e 2864 6f63 756d 656e 746c 6973 7429  en(documentlist)
-00005490: 290a 0a20 2020 2020 2020 2023 2064 656c  )..        # del
-000054a0: 6574 6520 646f 6375 6d65 6e74 0a20 2020  ete document.   
-000054b0: 2020 2020 2063 7265 6174 6564 5f63 6f6c       created_col
-000054c0: 6c65 6374 696f 6e2e 6465 6c65 7465 5f69  lection.delete_i
-000054d0: 7465 6d28 6974 656d 3d75 7073 6572 7465  tem(item=upserte
-000054e0: 645f 646f 6375 6d65 6e74 2c20 7061 7274  d_document, part
-000054f0: 6974 696f 6e5f 6b65 793d 7570 7365 7274  ition_key=upsert
-00005500: 6564 5f64 6f63 756d 656e 742e 6765 7428  ed_document.get(
-00005510: 2769 6427 2929 0a0a 2020 2020 2020 2020  'id'))..        
-00005520: 2320 7175 6572 7920 646f 6375 6d65 6e74  # query document
-00005530: 206f 6e20 7468 6520 7061 7274 6974 696f   on the partitio
-00005540: 6e20 6b65 7920 7370 6563 6966 6965 6420  n key specified 
-00005550: 696e 2074 6865 2070 7265 6469 6361 7465  in the predicate
-00005560: 2077 696c 6c20 7061 7373 2065 7665 6e20   will pass even 
-00005570: 7769 7468 6f75 7420 7365 7474 696e 6720  without setting 
-00005580: 656e 6162 6c65 4372 6f73 7350 6172 7469  enableCrossParti
-00005590: 7469 6f6e 5175 6572 7920 6f72 2070 6173  tionQuery or pas
-000055a0: 7369 6e67 2069 6e20 7468 6520 7061 7274  sing in the part
-000055b0: 6974 696f 6e4b 6579 2076 616c 7565 0a20  itionKey value. 
-000055c0: 2020 2020 2020 2064 6f63 756d 656e 746c         documentl
-000055d0: 6973 7420 3d20 6c69 7374 2863 7265 6174  ist = list(creat
-000055e0: 6564 5f63 6f6c 6c65 6374 696f 6e2e 7175  ed_collection.qu
-000055f0: 6572 795f 6974 656d 7328 0a20 2020 2020  ery_items(.     
-00005600: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-00005610: 2020 2020 2020 2020 2027 7175 6572 7927           'query'
-00005620: 3a20 2753 454c 4543 5420 2a20 4652 4f4d  : 'SELECT * FROM
-00005630: 2072 6f6f 7420 7220 5748 4552 4520 722e   root r WHERE r.
-00005640: 6964 3d5c 2727 202b 2072 6570 6c61 6365  id=\'' + replace
-00005650: 645f 646f 6375 6d65 6e74 2e67 6574 2827  d_document.get('
-00005660: 6964 2729 202b 2027 5c27 2720 2023 206e  id') + '\''  # n
-00005670: 6f73 6563 0a20 2020 2020 2020 2020 2020  osec.           
-00005680: 207d 2929 0a20 2020 2020 2020 2073 656c   })).        sel
-00005690: 662e 6173 7365 7274 4571 7561 6c28 312c  f.assertEqual(1,
-000056a0: 206c 656e 2864 6f63 756d 656e 746c 6973   len(documentlis
-000056b0: 7429 290a 0a20 2020 2020 2020 2023 2071  t))..        # q
-000056c0: 7565 7279 2064 6f63 756d 656e 7420 6f6e  uery document on
-000056d0: 2061 6e79 2070 726f 7065 7274 7920 6f74   any property ot
-000056e0: 6865 7220 7468 616e 2070 6172 7469 7469  her than partiti
-000056f0: 6f6e 4b65 7920 7769 6c6c 2066 6169 6c20  onKey will fail 
-00005700: 7769 7468 6f75 7420 7365 7474 696e 6720  without setting 
-00005710: 656e 6162 6c65 4372 6f73 7350 6172 7469  enableCrossParti
-00005720: 7469 6f6e 5175 6572 7920 6f72 2070 6173  tionQuery or pas
-00005730: 7369 6e67 2069 6e20 7468 6520 7061 7274  sing in the part
-00005740: 6974 696f 6e4b 6579 2076 616c 7565 0a20  itionKey value. 
-00005750: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00005760: 2020 2020 2020 2020 6c69 7374 2863 7265          list(cre
-00005770: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
-00005780: 7175 6572 795f 6974 656d 7328 0a20 2020  query_items(.   
-00005790: 2020 2020 2020 2020 2020 2020 207b 0a20               {. 
+00004e10: 2027 6b65 7927 3a20 2776 616c 7565 277d   'key': 'value'}
+00004e20: 0a0a 2020 2020 2020 2020 6372 6561 7465  ..        create
+00004e30: 645f 646f 6375 6d65 6e74 203d 2063 7265  d_document = cre
+00004e40: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
+00004e50: 6372 6561 7465 5f69 7465 6d28 0a20 2020  create_item(.   
+00004e60: 2020 2020 2020 2020 2062 6f64 793d 646f           body=do
+00004e70: 6375 6d65 6e74 5f64 6566 696e 6974 696f  cument_definitio
+00004e80: 6e0a 2020 2020 2020 2020 290a 0a20 2020  n.        )..   
+00004e90: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00004ea0: 4571 7561 6c28 6372 6561 7465 645f 646f  Equal(created_do
+00004eb0: 6375 6d65 6e74 2e67 6574 2827 6964 2729  cument.get('id')
+00004ec0: 2c20 646f 6375 6d65 6e74 5f64 6566 696e  , document_defin
+00004ed0: 6974 696f 6e2e 6765 7428 2769 6427 2929  ition.get('id'))
+00004ee0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00004ef0: 7365 7274 4571 7561 6c28 6372 6561 7465  sertEqual(create
+00004f00: 645f 646f 6375 6d65 6e74 2e67 6574 2827  d_document.get('
+00004f10: 6b65 7927 292c 2064 6f63 756d 656e 745f  key'), document_
+00004f20: 6465 6669 6e69 7469 6f6e 2e67 6574 2827  definition.get('
+00004f30: 6b65 7927 2929 0a0a 2020 2020 2020 2020  key'))..        
+00004f40: 2320 7265 6164 2064 6f63 756d 656e 740a  # read document.
+00004f50: 2020 2020 2020 2020 7265 6164 5f64 6f63          read_doc
+00004f60: 756d 656e 7420 3d20 6372 6561 7465 645f  ument = created_
+00004f70: 636f 6c6c 6563 7469 6f6e 2e72 6561 645f  collection.read_
+00004f80: 6974 656d 280a 2020 2020 2020 2020 2020  item(.          
+00004f90: 2020 6974 656d 3d63 7265 6174 6564 5f64    item=created_d
+00004fa0: 6f63 756d 656e 742e 6765 7428 2769 6427  ocument.get('id'
+00004fb0: 292c 0a20 2020 2020 2020 2020 2020 2070  ),.            p
+00004fc0: 6172 7469 7469 6f6e 5f6b 6579 3d63 7265  artition_key=cre
+00004fd0: 6174 6564 5f64 6f63 756d 656e 742e 6765  ated_document.ge
+00004fe0: 7428 2769 6427 290a 2020 2020 2020 2020  t('id').        
+00004ff0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00005000: 6173 7365 7274 4571 7561 6c28 7265 6164  assertEqual(read
+00005010: 5f64 6f63 756d 656e 742e 6765 7428 2769  _document.get('i
+00005020: 6427 292c 2063 7265 6174 6564 5f64 6f63  d'), created_doc
+00005030: 756d 656e 742e 6765 7428 2769 6427 2929  ument.get('id'))
+00005040: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00005050: 7365 7274 4571 7561 6c28 7265 6164 5f64  sertEqual(read_d
+00005060: 6f63 756d 656e 742e 6765 7428 276b 6579  ocument.get('key
+00005070: 2729 2c20 6372 6561 7465 645f 646f 6375  '), created_docu
+00005080: 6d65 6e74 2e67 6574 2827 6b65 7927 2929  ment.get('key'))
+00005090: 0a0a 2020 2020 2020 2020 2320 5265 6164  ..        # Read
+000050a0: 2064 6f63 756d 656e 7420 6665 6564 2064   document feed d
+000050b0: 6f65 736e 2774 2072 6571 7569 7265 2070  oesn't require p
+000050c0: 6172 7469 7469 6f6e 4b65 7920 6173 2069  artitionKey as i
+000050d0: 7427 7320 616c 7761 7973 2061 2063 726f  t's always a cro
+000050e0: 7373 2070 6172 7469 7469 6f6e 2071 7565  ss partition que
+000050f0: 7279 0a20 2020 2020 2020 2064 6f63 756d  ry.        docum
+00005100: 656e 746c 6973 7420 3d20 6c69 7374 2863  entlist = list(c
+00005110: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
+00005120: 6e2e 7265 6164 5f61 6c6c 5f69 7465 6d73  n.read_all_items
+00005130: 2829 290a 2020 2020 2020 2020 7365 6c66  ()).        self
+00005140: 2e61 7373 6572 7445 7175 616c 2831 2c20  .assertEqual(1, 
+00005150: 6c65 6e28 646f 6375 6d65 6e74 6c69 7374  len(documentlist
+00005160: 2929 0a0a 2020 2020 2020 2020 2320 7265  ))..        # re
+00005170: 706c 6163 6520 646f 6375 6d65 6e74 0a20  place document. 
+00005180: 2020 2020 2020 2064 6f63 756d 656e 745f         document_
+00005190: 6465 6669 6e69 7469 6f6e 5b27 6b65 7927  definition['key'
+000051a0: 5d20 3d20 276e 6577 2076 616c 7565 270a  ] = 'new value'.
+000051b0: 0a20 2020 2020 2020 2072 6570 6c61 6365  .        replace
+000051c0: 645f 646f 6375 6d65 6e74 203d 2063 7265  d_document = cre
+000051d0: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
+000051e0: 7265 706c 6163 655f 6974 656d 280a 2020  replace_item(.  
+000051f0: 2020 2020 2020 2020 2020 6974 656d 3d72            item=r
+00005200: 6561 645f 646f 6375 6d65 6e74 2c0a 2020  ead_document,.  
+00005210: 2020 2020 2020 2020 2020 626f 6479 3d64            body=d
+00005220: 6f63 756d 656e 745f 6465 6669 6e69 7469  ocument_definiti
+00005230: 6f6e 0a20 2020 2020 2020 2029 0a0a 2020  on.        )..  
+00005240: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005250: 7445 7175 616c 2872 6570 6c61 6365 645f  tEqual(replaced_
+00005260: 646f 6375 6d65 6e74 2e67 6574 2827 6b65  document.get('ke
+00005270: 7927 292c 2064 6f63 756d 656e 745f 6465  y'), document_de
+00005280: 6669 6e69 7469 6f6e 2e67 6574 2827 6b65  finition.get('ke
+00005290: 7927 2929 0a0a 2020 2020 2020 2020 2320  y'))..        # 
+000052a0: 7570 7365 7274 2064 6f63 756d 656e 7428  upsert document(
+000052b0: 6372 6561 7465 2073 6365 6e61 7269 6f29  create scenario)
+000052c0: 0a20 2020 2020 2020 2064 6f63 756d 656e  .        documen
+000052d0: 745f 6465 6669 6e69 7469 6f6e 5b27 6964  t_definition['id
+000052e0: 275d 203d 2027 646f 6375 6d65 6e74 3227  '] = 'document2'
+000052f0: 0a20 2020 2020 2020 2064 6f63 756d 656e  .        documen
+00005300: 745f 6465 6669 6e69 7469 6f6e 5b27 6b65  t_definition['ke
+00005310: 7927 5d20 3d20 2776 616c 7565 3227 0a0a  y'] = 'value2'..
+00005320: 2020 2020 2020 2020 7570 7365 7274 6564          upserted
+00005330: 5f64 6f63 756d 656e 7420 3d20 6372 6561  _document = crea
+00005340: 7465 645f 636f 6c6c 6563 7469 6f6e 2e75  ted_collection.u
+00005350: 7073 6572 745f 6974 656d 2862 6f64 793d  psert_item(body=
+00005360: 646f 6375 6d65 6e74 5f64 6566 696e 6974  document_definit
+00005370: 696f 6e29 0a0a 2020 2020 2020 2020 7365  ion)..        se
+00005380: 6c66 2e61 7373 6572 7445 7175 616c 2875  lf.assertEqual(u
+00005390: 7073 6572 7465 645f 646f 6375 6d65 6e74  pserted_document
+000053a0: 2e67 6574 2827 6964 2729 2c20 646f 6375  .get('id'), docu
+000053b0: 6d65 6e74 5f64 6566 696e 6974 696f 6e2e  ment_definition.
+000053c0: 6765 7428 2769 6427 2929 0a20 2020 2020  get('id')).     
+000053d0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000053e0: 7561 6c28 7570 7365 7274 6564 5f64 6f63  ual(upserted_doc
+000053f0: 756d 656e 742e 6765 7428 276b 6579 2729  ument.get('key')
+00005400: 2c20 646f 6375 6d65 6e74 5f64 6566 696e  , document_defin
+00005410: 6974 696f 6e2e 6765 7428 276b 6579 2729  ition.get('key')
+00005420: 290a 0a20 2020 2020 2020 2064 6f63 756d  )..        docum
+00005430: 656e 746c 6973 7420 3d20 6c69 7374 2863  entlist = list(c
+00005440: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
+00005450: 6e2e 7265 6164 5f61 6c6c 5f69 7465 6d73  n.read_all_items
+00005460: 2829 290a 2020 2020 2020 2020 7365 6c66  ()).        self
+00005470: 2e61 7373 6572 7445 7175 616c 2832 2c20  .assertEqual(2, 
+00005480: 6c65 6e28 646f 6375 6d65 6e74 6c69 7374  len(documentlist
+00005490: 2929 0a0a 2020 2020 2020 2020 2320 6465  ))..        # de
+000054a0: 6c65 7465 2064 6f63 756d 656e 740a 2020  lete document.  
+000054b0: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
+000054c0: 6c6c 6563 7469 6f6e 2e64 656c 6574 655f  llection.delete_
+000054d0: 6974 656d 2869 7465 6d3d 7570 7365 7274  item(item=upsert
+000054e0: 6564 5f64 6f63 756d 656e 742c 2070 6172  ed_document, par
+000054f0: 7469 7469 6f6e 5f6b 6579 3d75 7073 6572  tition_key=upser
+00005500: 7465 645f 646f 6375 6d65 6e74 2e67 6574  ted_document.get
+00005510: 2827 6964 2729 290a 0a20 2020 2020 2020  ('id'))..       
+00005520: 2023 2071 7565 7279 2064 6f63 756d 656e   # query documen
+00005530: 7420 6f6e 2074 6865 2070 6172 7469 7469  t on the partiti
+00005540: 6f6e 206b 6579 2073 7065 6369 6669 6564  on key specified
+00005550: 2069 6e20 7468 6520 7072 6564 6963 6174   in the predicat
+00005560: 6520 7769 6c6c 2070 6173 7320 6576 656e  e will pass even
+00005570: 2077 6974 686f 7574 2073 6574 7469 6e67   without setting
+00005580: 2065 6e61 626c 6543 726f 7373 5061 7274   enableCrossPart
+00005590: 6974 696f 6e51 7565 7279 206f 7220 7061  itionQuery or pa
+000055a0: 7373 696e 6720 696e 2074 6865 2070 6172  ssing in the par
+000055b0: 7469 7469 6f6e 4b65 7920 7661 6c75 650a  titionKey value.
+000055c0: 2020 2020 2020 2020 646f 6375 6d65 6e74          document
+000055d0: 6c69 7374 203d 206c 6973 7428 6372 6561  list = list(crea
+000055e0: 7465 645f 636f 6c6c 6563 7469 6f6e 2e71  ted_collection.q
+000055f0: 7565 7279 5f69 7465 6d73 280a 2020 2020  uery_items(.    
+00005600: 2020 2020 2020 2020 7b0a 2020 2020 2020          {.      
+00005610: 2020 2020 2020 2020 2020 2771 7565 7279            'query
+00005620: 273a 2027 5345 4c45 4354 202a 2046 524f  ': 'SELECT * FRO
+00005630: 4d20 726f 6f74 2072 2057 4845 5245 2072  M root r WHERE r
+00005640: 2e69 643d 5c27 2720 2b20 7265 706c 6163  .id=\'' + replac
+00005650: 6564 5f64 6f63 756d 656e 742e 6765 7428  ed_document.get(
+00005660: 2769 6427 2920 2b20 275c 2727 2020 2320  'id') + '\''  # 
+00005670: 6e6f 7365 630a 2020 2020 2020 2020 2020  nosec.          
+00005680: 2020 7d29 290a 2020 2020 2020 2020 7365    })).        se
+00005690: 6c66 2e61 7373 6572 7445 7175 616c 2831  lf.assertEqual(1
+000056a0: 2c20 6c65 6e28 646f 6375 6d65 6e74 6c69  , len(documentli
+000056b0: 7374 2929 0a0a 2020 2020 2020 2020 2320  st))..        # 
+000056c0: 7175 6572 7920 646f 6375 6d65 6e74 206f  query document o
+000056d0: 6e20 616e 7920 7072 6f70 6572 7479 206f  n any property o
+000056e0: 7468 6572 2074 6861 6e20 7061 7274 6974  ther than partit
+000056f0: 696f 6e4b 6579 2077 696c 6c20 6661 696c  ionKey will fail
+00005700: 2077 6974 686f 7574 2073 6574 7469 6e67   without setting
+00005710: 2065 6e61 626c 6543 726f 7373 5061 7274   enableCrossPart
+00005720: 6974 696f 6e51 7565 7279 206f 7220 7061  itionQuery or pa
+00005730: 7373 696e 6720 696e 2074 6865 2070 6172  ssing in the par
+00005740: 7469 7469 6f6e 4b65 7920 7661 6c75 650a  titionKey value.
+00005750: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00005760: 2020 2020 2020 2020 206c 6973 7428 6372           list(cr
+00005770: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+00005780: 2e71 7565 7279 5f69 7465 6d73 280a 2020  .query_items(.  
+00005790: 2020 2020 2020 2020 2020 2020 2020 7b0a                {.
 000057a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057b0: 2020 2027 7175 6572 7927 3a20 2753 454c     'query': 'SEL
-000057c0: 4543 5420 2a20 4652 4f4d 2072 6f6f 7420  ECT * FROM root 
-000057d0: 7220 5748 4552 4520 722e 6b65 793d 5c27  r WHERE r.key=\'
-000057e0: 2720 2b20 7265 706c 6163 6564 5f64 6f63  ' + replaced_doc
-000057f0: 756d 656e 742e 6765 7428 276b 6579 2729  ument.get('key')
-00005800: 202b 2027 5c27 2720 2020 2023 206e 6f73   + '\''    # nos
-00005810: 6563 0a20 2020 2020 2020 2020 2020 2020  ec.             
-00005820: 2020 207d 2929 0a20 2020 2020 2020 2065     })).        e
-00005830: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-00005840: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-00005850: 730a 0a20 2020 2020 2020 2023 2063 726f  s..        # cro
-00005860: 7373 2070 6172 7469 7469 6f6e 2071 7565  ss partition que
-00005870: 7279 0a20 2020 2020 2020 2064 6f63 756d  ry.        docum
-00005880: 656e 746c 6973 7420 3d20 6c69 7374 2863  entlist = list(c
-00005890: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
-000058a0: 6e2e 7175 6572 795f 6974 656d 7328 0a20  n.query_items(. 
-000058b0: 2020 2020 2020 2020 2020 2071 7565 7279             query
-000058c0: 3d27 5345 4c45 4354 202a 2046 524f 4d20  ='SELECT * FROM 
-000058d0: 726f 6f74 2072 2057 4845 5245 2072 2e6b  root r WHERE r.k
-000058e0: 6579 3d5c 2727 202b 2072 6570 6c61 6365  ey=\'' + replace
-000058f0: 645f 646f 6375 6d65 6e74 2e67 6574 2827  d_document.get('
-00005900: 6b65 7927 2920 2b20 275c 2727 2c20 2023  key') + '\'',  #
-00005910: 206e 6f73 6563 0a20 2020 2020 2020 2020   nosec.         
-00005920: 2020 2065 6e61 626c 655f 6372 6f73 735f     enable_cross_
-00005930: 7061 7274 6974 696f 6e5f 7175 6572 793d  partition_query=
-00005940: 5472 7565 0a20 2020 2020 2020 2029 290a  True.        )).
-00005950: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00005960: 7365 7274 4571 7561 6c28 312c 206c 656e  sertEqual(1, len
-00005970: 2864 6f63 756d 656e 746c 6973 7429 290a  (documentlist)).
-00005980: 0a20 2020 2020 2020 2023 2071 7565 7279  .        # query
-00005990: 2064 6f63 756d 656e 7420 6279 2070 726f   document by pro
-000059a0: 7669 6469 6e67 2074 6865 2070 6172 7469  viding the parti
-000059b0: 7469 6f6e 4b65 7920 7661 6c75 650a 2020  tionKey value.  
-000059c0: 2020 2020 2020 646f 6375 6d65 6e74 6c69        documentli
-000059d0: 7374 203d 206c 6973 7428 6372 6561 7465  st = list(create
-000059e0: 645f 636f 6c6c 6563 7469 6f6e 2e71 7565  d_collection.que
-000059f0: 7279 5f69 7465 6d73 280a 2020 2020 2020  ry_items(.      
-00005a00: 2020 2020 2020 7175 6572 793d 2753 454c        query='SEL
-00005a10: 4543 5420 2a20 4652 4f4d 2072 6f6f 7420  ECT * FROM root 
-00005a20: 7220 5748 4552 4520 722e 6b65 793d 5c27  r WHERE r.key=\'
-00005a30: 2720 2b20 7265 706c 6163 6564 5f64 6f63  ' + replaced_doc
-00005a40: 756d 656e 742e 6765 7428 276b 6579 2729  ument.get('key')
-00005a50: 202b 2027 5c27 272c 2020 2320 6e6f 7365   + '\'',  # nose
-00005a60: 630a 2020 2020 2020 2020 2020 2020 7061  c.            pa
-00005a70: 7274 6974 696f 6e5f 6b65 793d 7265 706c  rtition_key=repl
-00005a80: 6163 6564 5f64 6f63 756d 656e 742e 6765  aced_document.ge
-00005a90: 7428 2769 6427 290a 2020 2020 2020 2020  t('id').        
-00005aa0: 2929 0a0a 2020 2020 2020 2020 7365 6c66  ))..        self
-00005ab0: 2e61 7373 6572 7445 7175 616c 2831 2c20  .assertEqual(1, 
-00005ac0: 6c65 6e28 646f 6375 6d65 6e74 6c69 7374  len(documentlist
-00005ad0: 2929 0a0a 2020 2020 6465 6620 7465 7374  ))..    def test
-00005ae0: 5f70 6172 7469 7469 6f6e 6564 5f63 6f6c  _partitioned_col
-00005af0: 6c65 6374 696f 6e5f 7065 726d 6973 7369  lection_permissi
-00005b00: 6f6e 7328 7365 6c66 293a 0a20 2020 2020  ons(self):.     
-00005b10: 2020 2063 7265 6174 6564 5f64 6220 3d20     created_db = 
-00005b20: 7365 6c66 2e64 6174 6162 6173 6546 6f72  self.databaseFor
-00005b30: 5465 7374 0a0a 2020 2020 2020 2020 636f  Test..        co
-00005b40: 6c6c 6563 7469 6f6e 5f69 6420 3d20 2774  llection_id = 't
-00005b50: 6573 745f 7061 7274 6974 696f 6e65 645f  est_partitioned_
-00005b60: 636f 6c6c 6563 7469 6f6e 5f70 6572 6d69  collection_permi
-00005b70: 7373 696f 6e73 2061 6c6c 2063 6f6c 6c65  ssions all colle
-00005b80: 6374 696f 6e27 202b 2073 7472 2875 7569  ction' + str(uui
-00005b90: 642e 7575 6964 3428 2929 0a0a 2020 2020  d.uuid4())..    
-00005ba0: 2020 2020 616c 6c5f 636f 6c6c 6563 7469      all_collecti
-00005bb0: 6f6e 203d 2063 7265 6174 6564 5f64 622e  on = created_db.
-00005bc0: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
-00005bd0: 280a 2020 2020 2020 2020 2020 2020 6964  (.            id
-00005be0: 3d63 6f6c 6c65 6374 696f 6e5f 6964 2c0a  =collection_id,.
-00005bf0: 2020 2020 2020 2020 2020 2020 7061 7274              part
-00005c00: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
-00005c10: 696f 6e4b 6579 2870 6174 683d 272f 6b65  ionKey(path='/ke
-00005c20: 7927 2c20 6b69 6e64 3d64 6f63 756d 656e  y', kind=documen
-00005c30: 7473 2e50 6172 7469 7469 6f6e 4b69 6e64  ts.PartitionKind
-00005c40: 2e48 6173 6829 0a20 2020 2020 2020 2029  .Hash).        )
-00005c50: 0a0a 2020 2020 2020 2020 636f 6c6c 6563  ..        collec
-00005c60: 7469 6f6e 5f69 6420 3d20 2774 6573 745f  tion_id = 'test_
-00005c70: 7061 7274 6974 696f 6e65 645f 636f 6c6c  partitioned_coll
-00005c80: 6563 7469 6f6e 5f70 6572 6d69 7373 696f  ection_permissio
-00005c90: 6e73 2072 6561 6420 636f 6c6c 6563 7469  ns read collecti
-00005ca0: 6f6e 2720 2b20 7374 7228 7575 6964 2e75  on' + str(uuid.u
-00005cb0: 7569 6434 2829 290a 0a20 2020 2020 2020  uid4())..       
-00005cc0: 2072 6561 645f 636f 6c6c 6563 7469 6f6e   read_collection
-00005cd0: 203d 2063 7265 6174 6564 5f64 622e 6372   = created_db.cr
-00005ce0: 6561 7465 5f63 6f6e 7461 696e 6572 280a  eate_container(.
-00005cf0: 2020 2020 2020 2020 2020 2020 6964 3d63              id=c
-00005d00: 6f6c 6c65 6374 696f 6e5f 6964 2c0a 2020  ollection_id,.  
-00005d10: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-00005d20: 696f 6e5f 6b65 793d 5061 7274 6974 696f  ion_key=Partitio
-00005d30: 6e4b 6579 2870 6174 683d 272f 6b65 7927  nKey(path='/key'
-00005d40: 2c20 6b69 6e64 3d64 6f63 756d 656e 7473  , kind=documents
-00005d50: 2e50 6172 7469 7469 6f6e 4b69 6e64 2e48  .PartitionKind.H
-00005d60: 6173 6829 0a20 2020 2020 2020 2029 0a0a  ash).        )..
-00005d70: 2020 2020 2020 2020 7573 6572 203d 2063          user = c
-00005d80: 7265 6174 6564 5f64 622e 6372 6561 7465  reated_db.create
-00005d90: 5f75 7365 7228 626f 6479 3d7b 2769 6427  _user(body={'id'
-00005da0: 3a20 2775 7365 7227 202b 2073 7472 2875  : 'user' + str(u
-00005db0: 7569 642e 7575 6964 3428 2929 7d29 0a0a  uid.uuid4())})..
-00005dc0: 2020 2020 2020 2020 7065 726d 6973 7369          permissi
-00005dd0: 6f6e 5f64 6566 696e 6974 696f 6e20 3d20  on_definition = 
-00005de0: 7b0a 2020 2020 2020 2020 2020 2020 2769  {.            'i
-00005df0: 6427 3a20 2761 6c6c 2070 6572 6d69 7373  d': 'all permiss
-00005e00: 696f 6e27 2c0a 2020 2020 2020 2020 2020  ion',.          
-00005e10: 2020 2770 6572 6d69 7373 696f 6e4d 6f64    'permissionMod
-00005e20: 6527 3a20 646f 6375 6d65 6e74 732e 5065  e': documents.Pe
-00005e30: 726d 6973 7369 6f6e 4d6f 6465 2e41 6c6c  rmissionMode.All
-00005e40: 2c0a 2020 2020 2020 2020 2020 2020 2772  ,.            'r
-00005e50: 6573 6f75 7263 6527 3a20 616c 6c5f 636f  esource': all_co
-00005e60: 6c6c 6563 7469 6f6e 2e63 6f6e 7461 696e  llection.contain
-00005e70: 6572 5f6c 696e 6b2c 0a20 2020 2020 2020  er_link,.       
-00005e80: 2020 2020 2027 7265 736f 7572 6365 5061       'resourcePa
-00005e90: 7274 6974 696f 6e4b 6579 273a 205b 315d  rtitionKey': [1]
-00005ea0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
-00005eb0: 2020 2020 616c 6c5f 7065 726d 6973 7369      all_permissi
-00005ec0: 6f6e 203d 2075 7365 722e 6372 6561 7465  on = user.create
-00005ed0: 5f70 6572 6d69 7373 696f 6e28 626f 6479  _permission(body
-00005ee0: 3d70 6572 6d69 7373 696f 6e5f 6465 6669  =permission_defi
-00005ef0: 6e69 7469 6f6e 290a 0a20 2020 2020 2020  nition)..       
-00005f00: 2070 6572 6d69 7373 696f 6e5f 6465 6669   permission_defi
-00005f10: 6e69 7469 6f6e 203d 207b 0a20 2020 2020  nition = {.     
-00005f20: 2020 2020 2020 2027 6964 273a 2027 7265         'id': 're
-00005f30: 6164 2070 6572 6d69 7373 696f 6e27 2c0a  ad permission',.
-00005f40: 2020 2020 2020 2020 2020 2020 2770 6572              'per
-00005f50: 6d69 7373 696f 6e4d 6f64 6527 3a20 646f  missionMode': do
-00005f60: 6375 6d65 6e74 732e 5065 726d 6973 7369  cuments.Permissi
-00005f70: 6f6e 4d6f 6465 2e52 6561 642c 0a20 2020  onMode.Read,.   
-00005f80: 2020 2020 2020 2020 2027 7265 736f 7572           'resour
-00005f90: 6365 273a 2072 6561 645f 636f 6c6c 6563  ce': read_collec
-00005fa0: 7469 6f6e 2e63 6f6e 7461 696e 6572 5f6c  tion.container_l
-00005fb0: 696e 6b2c 0a20 2020 2020 2020 2020 2020  ink,.           
-00005fc0: 2027 7265 736f 7572 6365 5061 7274 6974   'resourcePartit
-00005fd0: 696f 6e4b 6579 273a 205b 315d 0a20 2020  ionKey': [1].   
-00005fe0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-00005ff0: 7265 6164 5f70 6572 6d69 7373 696f 6e20  read_permission 
-00006000: 3d20 7573 6572 2e63 7265 6174 655f 7065  = user.create_pe
-00006010: 726d 6973 7369 6f6e 2862 6f64 793d 7065  rmission(body=pe
-00006020: 726d 6973 7369 6f6e 5f64 6566 696e 6974  rmission_definit
-00006030: 696f 6e29 0a0a 2020 2020 2020 2020 7265  ion)..        re
-00006040: 736f 7572 6365 5f74 6f6b 656e 7320 3d20  source_tokens = 
-00006050: 7b7d 0a20 2020 2020 2020 2023 2073 746f  {}.        # sto
-00006060: 7269 6e67 2074 6865 2072 6573 6f75 7263  ring the resourc
-00006070: 6520 746f 6b65 6e73 2062 6173 6564 206f  e tokens based o
-00006080: 6e20 5265 736f 7572 6365 2049 4473 0a20  n Resource IDs. 
-00006090: 2020 2020 2020 2072 6573 6f75 7263 655f         resource_
-000060a0: 746f 6b65 6e73 5b22 6462 732f 2220 2b20  tokens["dbs/" + 
-000060b0: 6372 6561 7465 645f 6462 2e69 6420 2b20  created_db.id + 
-000060c0: 222f 636f 6c6c 732f 2220 2b20 616c 6c5f  "/colls/" + all_
-000060d0: 636f 6c6c 6563 7469 6f6e 2e69 645d 203d  collection.id] =
-000060e0: 2028 616c 6c5f 7065 726d 6973 7369 6f6e   (all_permission
-000060f0: 2e70 726f 7065 7274 6965 735b 275f 746f  .properties['_to
-00006100: 6b65 6e27 5d29 0a20 2020 2020 2020 2072  ken']).        r
-00006110: 6573 6f75 7263 655f 746f 6b65 6e73 5b22  esource_tokens["
-00006120: 6462 732f 2220 2b20 6372 6561 7465 645f  dbs/" + created_
-00006130: 6462 2e69 6420 2b20 222f 636f 6c6c 732f  db.id + "/colls/
-00006140: 2220 2b20 7265 6164 5f63 6f6c 6c65 6374  " + read_collect
-00006150: 696f 6e2e 6964 5d20 3d20 2872 6561 645f  ion.id] = (read_
-00006160: 7065 726d 6973 7369 6f6e 2e70 726f 7065  permission.prope
-00006170: 7274 6965 735b 275f 746f 6b65 6e27 5d29  rties['_token'])
-00006180: 0a0a 2020 2020 2020 2020 7265 7374 7269  ..        restri
-00006190: 6374 6564 5f63 6c69 656e 7420 3d20 636f  cted_client = co
-000061a0: 736d 6f73 5f63 6c69 656e 742e 436f 736d  smos_client.Cosm
-000061b0: 6f73 436c 6965 6e74 280a 2020 2020 2020  osClient(.      
-000061c0: 2020 2020 2020 4352 5544 5465 7374 732e        CRUDTests.
-000061d0: 686f 7374 2c20 7265 736f 7572 6365 5f74  host, resource_t
-000061e0: 6f6b 656e 732c 2022 5365 7373 696f 6e22  okens, "Session"
-000061f0: 2c20 636f 6e6e 6563 7469 6f6e 5f70 6f6c  , connection_pol
-00006200: 6963 793d 4352 5544 5465 7374 732e 636f  icy=CRUDTests.co
-00006210: 6e6e 6563 7469 6f6e 506f 6c69 6379 290a  nnectionPolicy).
-00006220: 0a20 2020 2020 2020 2064 6f63 756d 656e  .        documen
-00006230: 745f 6465 6669 6e69 7469 6f6e 203d 207b  t_definition = {
-00006240: 2769 6427 3a20 2764 6f63 756d 656e 7431  'id': 'document1
-00006250: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+000057b0: 2020 2020 2771 7565 7279 273a 2027 5345      'query': 'SE
+000057c0: 4c45 4354 202a 2046 524f 4d20 726f 6f74  LECT * FROM root
+000057d0: 2072 2057 4845 5245 2072 2e6b 6579 3d5c   r WHERE r.key=\
+000057e0: 2727 202b 2072 6570 6c61 6365 645f 646f  '' + replaced_do
+000057f0: 6375 6d65 6e74 2e67 6574 2827 6b65 7927  cument.get('key'
+00005800: 2920 2b20 275c 2727 2020 2020 2320 6e6f  ) + '\''    # no
+00005810: 7365 630a 2020 2020 2020 2020 2020 2020  sec.            
+00005820: 2020 2020 7d29 290a 2020 2020 2020 2020      })).        
+00005830: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00005840: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00005850: 7373 0a0a 2020 2020 2020 2020 2320 6372  ss..        # cr
+00005860: 6f73 7320 7061 7274 6974 696f 6e20 7175  oss partition qu
+00005870: 6572 790a 2020 2020 2020 2020 646f 6375  ery.        docu
+00005880: 6d65 6e74 6c69 7374 203d 206c 6973 7428  mentlist = list(
+00005890: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
+000058a0: 6f6e 2e71 7565 7279 5f69 7465 6d73 280a  on.query_items(.
+000058b0: 2020 2020 2020 2020 2020 2020 7175 6572              quer
+000058c0: 793d 2753 454c 4543 5420 2a20 4652 4f4d  y='SELECT * FROM
+000058d0: 2072 6f6f 7420 7220 5748 4552 4520 722e   root r WHERE r.
+000058e0: 6b65 793d 5c27 2720 2b20 7265 706c 6163  key=\'' + replac
+000058f0: 6564 5f64 6f63 756d 656e 742e 6765 7428  ed_document.get(
+00005900: 276b 6579 2729 202b 2027 5c27 272c 2020  'key') + '\'',  
+00005910: 2320 6e6f 7365 630a 2020 2020 2020 2020  # nosec.        
+00005920: 2020 2020 656e 6162 6c65 5f63 726f 7373      enable_cross
+00005930: 5f70 6172 7469 7469 6f6e 5f71 7565 7279  _partition_query
+00005940: 3d54 7275 650a 2020 2020 2020 2020 2929  =True.        ))
+00005950: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+00005960: 7373 6572 7445 7175 616c 2831 2c20 6c65  ssertEqual(1, le
+00005970: 6e28 646f 6375 6d65 6e74 6c69 7374 2929  n(documentlist))
+00005980: 0a0a 2020 2020 2020 2020 2320 7175 6572  ..        # quer
+00005990: 7920 646f 6375 6d65 6e74 2062 7920 7072  y document by pr
+000059a0: 6f76 6964 696e 6720 7468 6520 7061 7274  oviding the part
+000059b0: 6974 696f 6e4b 6579 2076 616c 7565 0a20  itionKey value. 
+000059c0: 2020 2020 2020 2064 6f63 756d 656e 746c         documentl
+000059d0: 6973 7420 3d20 6c69 7374 2863 7265 6174  ist = list(creat
+000059e0: 6564 5f63 6f6c 6c65 6374 696f 6e2e 7175  ed_collection.qu
+000059f0: 6572 795f 6974 656d 7328 0a20 2020 2020  ery_items(.     
+00005a00: 2020 2020 2020 2071 7565 7279 3d27 5345         query='SE
+00005a10: 4c45 4354 202a 2046 524f 4d20 726f 6f74  LECT * FROM root
+00005a20: 2072 2057 4845 5245 2072 2e6b 6579 3d5c   r WHERE r.key=\
+00005a30: 2727 202b 2072 6570 6c61 6365 645f 646f  '' + replaced_do
+00005a40: 6375 6d65 6e74 2e67 6574 2827 6b65 7927  cument.get('key'
+00005a50: 2920 2b20 275c 2727 2c20 2023 206e 6f73  ) + '\'',  # nos
+00005a60: 6563 0a20 2020 2020 2020 2020 2020 2070  ec.            p
+00005a70: 6172 7469 7469 6f6e 5f6b 6579 3d72 6570  artition_key=rep
+00005a80: 6c61 6365 645f 646f 6375 6d65 6e74 2e67  laced_document.g
+00005a90: 6574 2827 6964 2729 0a20 2020 2020 2020  et('id').       
+00005aa0: 2029 290a 0a20 2020 2020 2020 2073 656c   ))..        sel
+00005ab0: 662e 6173 7365 7274 4571 7561 6c28 312c  f.assertEqual(1,
+00005ac0: 206c 656e 2864 6f63 756d 656e 746c 6973   len(documentlis
+00005ad0: 7429 290a 0a20 2020 2064 6566 2074 6573  t))..    def tes
+00005ae0: 745f 7061 7274 6974 696f 6e65 645f 636f  t_partitioned_co
+00005af0: 6c6c 6563 7469 6f6e 5f70 6572 6d69 7373  llection_permiss
+00005b00: 696f 6e73 2873 656c 6629 3a0a 2020 2020  ions(self):.    
+00005b10: 2020 2020 6372 6561 7465 645f 6462 203d      created_db =
+00005b20: 2073 656c 662e 6461 7461 6261 7365 466f   self.databaseFo
+00005b30: 7254 6573 740a 0a20 2020 2020 2020 2063  rTest..        c
+00005b40: 6f6c 6c65 6374 696f 6e5f 6964 203d 2027  ollection_id = '
+00005b50: 7465 7374 5f70 6172 7469 7469 6f6e 6564  test_partitioned
+00005b60: 5f63 6f6c 6c65 6374 696f 6e5f 7065 726d  _collection_perm
+00005b70: 6973 7369 6f6e 7320 616c 6c20 636f 6c6c  issions all coll
+00005b80: 6563 7469 6f6e 2720 2b20 7374 7228 7575  ection' + str(uu
+00005b90: 6964 2e75 7569 6434 2829 290a 0a20 2020  id.uuid4())..   
+00005ba0: 2020 2020 2061 6c6c 5f63 6f6c 6c65 6374       all_collect
+00005bb0: 696f 6e20 3d20 6372 6561 7465 645f 6462  ion = created_db
+00005bc0: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
+00005bd0: 7228 0a20 2020 2020 2020 2020 2020 2069  r(.            i
+00005be0: 643d 636f 6c6c 6563 7469 6f6e 5f69 642c  d=collection_id,
+00005bf0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00005c00: 7469 7469 6f6e 5f6b 6579 3d50 6172 7469  tition_key=Parti
+00005c10: 7469 6f6e 4b65 7928 7061 7468 3d27 2f6b  tionKey(path='/k
+00005c20: 6579 272c 206b 696e 643d 646f 6375 6d65  ey', kind=docume
+00005c30: 6e74 732e 5061 7274 6974 696f 6e4b 696e  nts.PartitionKin
+00005c40: 642e 4861 7368 290a 2020 2020 2020 2020  d.Hash).        
+00005c50: 290a 0a20 2020 2020 2020 2063 6f6c 6c65  )..        colle
+00005c60: 6374 696f 6e5f 6964 203d 2027 7465 7374  ction_id = 'test
+00005c70: 5f70 6172 7469 7469 6f6e 6564 5f63 6f6c  _partitioned_col
+00005c80: 6c65 6374 696f 6e5f 7065 726d 6973 7369  lection_permissi
+00005c90: 6f6e 7320 7265 6164 2063 6f6c 6c65 6374  ons read collect
+00005ca0: 696f 6e27 202b 2073 7472 2875 7569 642e  ion' + str(uuid.
+00005cb0: 7575 6964 3428 2929 0a0a 2020 2020 2020  uuid4())..      
+00005cc0: 2020 7265 6164 5f63 6f6c 6c65 6374 696f    read_collectio
+00005cd0: 6e20 3d20 6372 6561 7465 645f 6462 2e63  n = created_db.c
+00005ce0: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
+00005cf0: 0a20 2020 2020 2020 2020 2020 2069 643d  .            id=
+00005d00: 636f 6c6c 6563 7469 6f6e 5f69 642c 0a20  collection_id,. 
+00005d10: 2020 2020 2020 2020 2020 2070 6172 7469             parti
+00005d20: 7469 6f6e 5f6b 6579 3d50 6172 7469 7469  tion_key=Partiti
+00005d30: 6f6e 4b65 7928 7061 7468 3d27 2f6b 6579  onKey(path='/key
+00005d40: 272c 206b 696e 643d 646f 6375 6d65 6e74  ', kind=document
+00005d50: 732e 5061 7274 6974 696f 6e4b 696e 642e  s.PartitionKind.
+00005d60: 4861 7368 290a 2020 2020 2020 2020 290a  Hash).        ).
+00005d70: 0a20 2020 2020 2020 2075 7365 7220 3d20  .        user = 
+00005d80: 6372 6561 7465 645f 6462 2e63 7265 6174  created_db.creat
+00005d90: 655f 7573 6572 2862 6f64 793d 7b27 6964  e_user(body={'id
+00005da0: 273a 2027 7573 6572 2720 2b20 7374 7228  ': 'user' + str(
+00005db0: 7575 6964 2e75 7569 6434 2829 297d 290a  uuid.uuid4())}).
+00005dc0: 0a20 2020 2020 2020 2070 6572 6d69 7373  .        permiss
+00005dd0: 696f 6e5f 6465 6669 6e69 7469 6f6e 203d  ion_definition =
+00005de0: 207b 0a20 2020 2020 2020 2020 2020 2027   {.            '
+00005df0: 6964 273a 2027 616c 6c20 7065 726d 6973  id': 'all permis
+00005e00: 7369 6f6e 272c 0a20 2020 2020 2020 2020  sion',.         
+00005e10: 2020 2027 7065 726d 6973 7369 6f6e 4d6f     'permissionMo
+00005e20: 6465 273a 2064 6f63 756d 656e 7473 2e50  de': documents.P
+00005e30: 6572 6d69 7373 696f 6e4d 6f64 652e 416c  ermissionMode.Al
+00005e40: 6c2c 0a20 2020 2020 2020 2020 2020 2027  l,.            '
+00005e50: 7265 736f 7572 6365 273a 2061 6c6c 5f63  resource': all_c
+00005e60: 6f6c 6c65 6374 696f 6e2e 636f 6e74 6169  ollection.contai
+00005e70: 6e65 725f 6c69 6e6b 2c0a 2020 2020 2020  ner_link,.      
+00005e80: 2020 2020 2020 2772 6573 6f75 7263 6550        'resourceP
+00005e90: 6172 7469 7469 6f6e 4b65 7927 3a20 5b31  artitionKey': [1
+00005ea0: 5d0a 2020 2020 2020 2020 7d0a 0a20 2020  ].        }..   
+00005eb0: 2020 2020 2061 6c6c 5f70 6572 6d69 7373       all_permiss
+00005ec0: 696f 6e20 3d20 7573 6572 2e63 7265 6174  ion = user.creat
+00005ed0: 655f 7065 726d 6973 7369 6f6e 2862 6f64  e_permission(bod
+00005ee0: 793d 7065 726d 6973 7369 6f6e 5f64 6566  y=permission_def
+00005ef0: 696e 6974 696f 6e29 0a0a 2020 2020 2020  inition)..      
+00005f00: 2020 7065 726d 6973 7369 6f6e 5f64 6566    permission_def
+00005f10: 696e 6974 696f 6e20 3d20 7b0a 2020 2020  inition = {.    
+00005f20: 2020 2020 2020 2020 2769 6427 3a20 2772          'id': 'r
+00005f30: 6561 6420 7065 726d 6973 7369 6f6e 272c  ead permission',
+00005f40: 0a20 2020 2020 2020 2020 2020 2027 7065  .            'pe
+00005f50: 726d 6973 7369 6f6e 4d6f 6465 273a 2064  rmissionMode': d
+00005f60: 6f63 756d 656e 7473 2e50 6572 6d69 7373  ocuments.Permiss
+00005f70: 696f 6e4d 6f64 652e 5265 6164 2c0a 2020  ionMode.Read,.  
+00005f80: 2020 2020 2020 2020 2020 2772 6573 6f75            'resou
+00005f90: 7263 6527 3a20 7265 6164 5f63 6f6c 6c65  rce': read_colle
+00005fa0: 6374 696f 6e2e 636f 6e74 6169 6e65 725f  ction.container_
+00005fb0: 6c69 6e6b 2c0a 2020 2020 2020 2020 2020  link,.          
+00005fc0: 2020 2772 6573 6f75 7263 6550 6172 7469    'resourceParti
+00005fd0: 7469 6f6e 4b65 7927 3a20 5b31 5d0a 2020  tionKey': [1].  
+00005fe0: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00005ff0: 2072 6561 645f 7065 726d 6973 7369 6f6e   read_permission
+00006000: 203d 2075 7365 722e 6372 6561 7465 5f70   = user.create_p
+00006010: 6572 6d69 7373 696f 6e28 626f 6479 3d70  ermission(body=p
+00006020: 6572 6d69 7373 696f 6e5f 6465 6669 6e69  ermission_defini
+00006030: 7469 6f6e 290a 0a20 2020 2020 2020 2072  tion)..        r
+00006040: 6573 6f75 7263 655f 746f 6b65 6e73 203d  esource_tokens =
+00006050: 207b 7d0a 2020 2020 2020 2020 2320 7374   {}.        # st
+00006060: 6f72 696e 6720 7468 6520 7265 736f 7572  oring the resour
+00006070: 6365 2074 6f6b 656e 7320 6261 7365 6420  ce tokens based 
+00006080: 6f6e 2052 6573 6f75 7263 6520 4944 730a  on Resource IDs.
+00006090: 2020 2020 2020 2020 7265 736f 7572 6365          resource
+000060a0: 5f74 6f6b 656e 735b 2264 6273 2f22 202b  _tokens["dbs/" +
+000060b0: 2063 7265 6174 6564 5f64 622e 6964 202b   created_db.id +
+000060c0: 2022 2f63 6f6c 6c73 2f22 202b 2061 6c6c   "/colls/" + all
+000060d0: 5f63 6f6c 6c65 6374 696f 6e2e 6964 5d20  _collection.id] 
+000060e0: 3d20 2861 6c6c 5f70 6572 6d69 7373 696f  = (all_permissio
+000060f0: 6e2e 7072 6f70 6572 7469 6573 5b27 5f74  n.properties['_t
+00006100: 6f6b 656e 275d 290a 2020 2020 2020 2020  oken']).        
+00006110: 7265 736f 7572 6365 5f74 6f6b 656e 735b  resource_tokens[
+00006120: 2264 6273 2f22 202b 2063 7265 6174 6564  "dbs/" + created
+00006130: 5f64 622e 6964 202b 2022 2f63 6f6c 6c73  _db.id + "/colls
+00006140: 2f22 202b 2072 6561 645f 636f 6c6c 6563  /" + read_collec
+00006150: 7469 6f6e 2e69 645d 203d 2028 7265 6164  tion.id] = (read
+00006160: 5f70 6572 6d69 7373 696f 6e2e 7072 6f70  _permission.prop
+00006170: 6572 7469 6573 5b27 5f74 6f6b 656e 275d  erties['_token']
+00006180: 290a 0a20 2020 2020 2020 2072 6573 7472  )..        restr
+00006190: 6963 7465 645f 636c 6965 6e74 203d 2063  icted_client = c
+000061a0: 6f73 6d6f 735f 636c 6965 6e74 2e43 6f73  osmos_client.Cos
+000061b0: 6d6f 7343 6c69 656e 7428 0a20 2020 2020  mosClient(.     
+000061c0: 2020 2020 2020 2043 5255 4454 6573 7473         CRUDTests
+000061d0: 2e68 6f73 742c 2072 6573 6f75 7263 655f  .host, resource_
+000061e0: 746f 6b65 6e73 2c20 2253 6573 7369 6f6e  tokens, "Session
+000061f0: 222c 2063 6f6e 6e65 6374 696f 6e5f 706f  ", connection_po
+00006200: 6c69 6379 3d43 5255 4454 6573 7473 2e63  licy=CRUDTests.c
+00006210: 6f6e 6e65 6374 696f 6e50 6f6c 6963 7929  onnectionPolicy)
+00006220: 0a0a 2020 2020 2020 2020 646f 6375 6d65  ..        docume
+00006230: 6e74 5f64 6566 696e 6974 696f 6e20 3d20  nt_definition = 
+00006240: 7b27 6964 273a 2027 646f 6375 6d65 6e74  {'id': 'document
+00006250: 3127 2c0a 2020 2020 2020 2020 2020 2020  1',.            
 00006260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006270: 2020 276b 6579 273a 2031 0a20 2020 2020    'key': 1.     
+00006270: 2020 2027 6b65 7927 3a20 310a 2020 2020     'key': 1.    
 00006280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006290: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
-000062a0: 2020 2020 2061 6c6c 5f63 6f6c 6c65 6374       all_collect
-000062b0: 696f 6e2e 636c 6965 6e74 5f63 6f6e 6e65  ion.client_conne
-000062c0: 6374 696f 6e20 3d20 7265 7374 7269 6374  ction = restrict
-000062d0: 6564 5f63 6c69 656e 742e 636c 6965 6e74  ed_client.client
-000062e0: 5f63 6f6e 6e65 6374 696f 6e0a 2020 2020  _connection.    
-000062f0: 2020 2020 7265 6164 5f63 6f6c 6c65 6374      read_collect
-00006300: 696f 6e2e 636c 6965 6e74 5f63 6f6e 6e65  ion.client_conne
-00006310: 6374 696f 6e20 3d20 7265 7374 7269 6374  ction = restrict
-00006320: 6564 5f63 6c69 656e 742e 636c 6965 6e74  ed_client.client
-00006330: 5f63 6f6e 6e65 6374 696f 6e0a 0a20 2020  _connection..   
-00006340: 2020 2020 2023 2043 7265 6174 6520 646f       # Create do
-00006350: 6375 6d65 6e74 2069 6e20 616c 6c5f 636f  cument in all_co
-00006360: 6c6c 6563 7469 6f6e 2073 686f 756c 6420  llection should 
-00006370: 7375 6363 6565 6420 7369 6e63 6520 7468  succeed since th
-00006380: 6520 7061 7274 6974 696f 6e4b 6579 2069  e partitionKey i
-00006390: 7320 3120 7768 6963 6820 6973 2077 6861  s 1 which is wha
-000063a0: 7420 7370 6563 6966 6965 6420 6173 2072  t specified as r
-000063b0: 6573 6f75 7263 6550 6172 7469 7469 6f6e  esourcePartition
-000063c0: 4b65 7920 696e 2070 6572 6d69 7373 696f  Key in permissio
-000063d0: 6e20 6f62 6a65 6374 2061 6e64 2069 7420  n object and it 
-000063e0: 6861 7320 616c 6c20 7065 726d 6973 7369  has all permissi
-000063f0: 6f6e 730a 2020 2020 2020 2020 6372 6561  ons.        crea
-00006400: 7465 645f 646f 6375 6d65 6e74 203d 2061  ted_document = a
-00006410: 6c6c 5f63 6f6c 6c65 6374 696f 6e2e 6372  ll_collection.cr
-00006420: 6561 7465 5f69 7465 6d28 626f 6479 3d64  eate_item(body=d
-00006430: 6f63 756d 656e 745f 6465 6669 6e69 7469  ocument_definiti
-00006440: 6f6e 290a 0a20 2020 2020 2020 2023 2043  on)..        # C
-00006450: 7265 6174 6520 646f 6375 6d65 6e74 2069  reate document i
-00006460: 6e20 7265 6164 5f63 6f6c 6c65 6374 696f  n read_collectio
-00006470: 6e20 7368 6f75 6c64 2066 6169 6c20 7369  n should fail si
-00006480: 6e63 6520 6974 2068 6173 206f 6e6c 7920  nce it has only 
-00006490: 7265 6164 2070 6572 6d69 7373 696f 6e73  read permissions
-000064a0: 2066 6f72 2074 6869 7320 636f 6c6c 6563   for this collec
-000064b0: 7469 6f6e 0a20 2020 2020 2020 2073 656c  tion.        sel
-000064c0: 662e 5f5f 4173 7365 7274 4854 5450 4661  f.__AssertHTTPFa
-000064d0: 696c 7572 6557 6974 6853 7461 7475 7328  ilureWithStatus(
-000064e0: 0a20 2020 2020 2020 2020 2020 2053 7461  .            Sta
-000064f0: 7475 7343 6f64 6573 2e46 4f52 4249 4444  tusCodes.FORBIDD
-00006500: 454e 2c0a 2020 2020 2020 2020 2020 2020  EN,.            
-00006510: 7265 6164 5f63 6f6c 6c65 6374 696f 6e2e  read_collection.
-00006520: 6372 6561 7465 5f69 7465 6d2c 0a20 2020  create_item,.   
-00006530: 2020 2020 2020 2020 2064 6f63 756d 656e           documen
-00006540: 745f 6465 6669 6e69 7469 6f6e 290a 0a20  t_definition).. 
-00006550: 2020 2020 2020 2064 6f63 756d 656e 745f         document_
-00006560: 6465 6669 6e69 7469 6f6e 5b27 6b65 7927  definition['key'
-00006570: 5d20 3d20 320a 2020 2020 2020 2020 2320  ] = 2.        # 
-00006580: 4372 6561 7465 2064 6f63 756d 656e 7420  Create document 
-00006590: 7368 6f75 6c64 2066 6169 6c20 7369 6e63  should fail sinc
-000065a0: 6520 7468 6520 7061 7274 6974 696f 6e4b  e the partitionK
-000065b0: 6579 2069 7320 3220 7768 6963 6820 6973  ey is 2 which is
-000065c0: 2064 6966 6665 7265 6e74 2074 6861 7420   different that 
-000065d0: 7768 6174 2069 7320 7370 6563 6966 6965  what is specifie
-000065e0: 6420 6173 2072 6573 6f75 7263 6550 6172  d as resourcePar
-000065f0: 7469 7469 6f6e 4b65 7920 696e 2070 6572  titionKey in per
-00006600: 6d69 7373 696f 6e20 6f62 6a65 6374 0a20  mission object. 
-00006610: 2020 2020 2020 2073 656c 662e 5f5f 4173         self.__As
-00006620: 7365 7274 4854 5450 4661 696c 7572 6557  sertHTTPFailureW
-00006630: 6974 6853 7461 7475 7328 0a20 2020 2020  ithStatus(.     
-00006640: 2020 2020 2020 2053 7461 7475 7343 6f64         StatusCod
-00006650: 6573 2e46 4f52 4249 4444 454e 2c0a 2020  es.FORBIDDEN,.  
-00006660: 2020 2020 2020 2020 2020 616c 6c5f 636f            all_co
-00006670: 6c6c 6563 7469 6f6e 2e63 7265 6174 655f  llection.create_
-00006680: 6974 656d 2c0a 2020 2020 2020 2020 2020  item,.          
-00006690: 2020 646f 6375 6d65 6e74 5f64 6566 696e    document_defin
-000066a0: 6974 696f 6e29 0a0a 2020 2020 2020 2020  ition)..        
-000066b0: 646f 6375 6d65 6e74 5f64 6566 696e 6974  document_definit
-000066c0: 696f 6e5b 276b 6579 275d 203d 2031 0a20  ion['key'] = 1. 
-000066d0: 2020 2020 2020 2023 2044 656c 6574 6520         # Delete 
-000066e0: 646f 6375 6d65 6e74 2073 686f 756c 6420  document should 
-000066f0: 7375 6363 6565 6420 7369 6e63 6520 7468  succeed since th
-00006700: 6520 7061 7274 6974 696f 6e4b 6579 2069  e partitionKey i
-00006710: 7320 3120 7768 6963 6820 6973 2077 6861  s 1 which is wha
-00006720: 7420 7370 6563 6966 6965 6420 6173 2072  t specified as r
-00006730: 6573 6f75 7263 6550 6172 7469 7469 6f6e  esourcePartition
-00006740: 4b65 7920 696e 2070 6572 6d69 7373 696f  Key in permissio
-00006750: 6e20 6f62 6a65 6374 0a20 2020 2020 2020  n object.       
-00006760: 2063 7265 6174 6564 5f64 6f63 756d 656e   created_documen
-00006770: 7420 3d20 616c 6c5f 636f 6c6c 6563 7469  t = all_collecti
-00006780: 6f6e 2e64 656c 6574 655f 6974 656d 2869  on.delete_item(i
-00006790: 7465 6d3d 6372 6561 7465 645f 646f 6375  tem=created_docu
-000067a0: 6d65 6e74 5b27 6964 275d 2c20 7061 7274  ment['id'], part
-000067b0: 6974 696f 6e5f 6b65 793d 646f 6375 6d65  ition_key=docume
-000067c0: 6e74 5f64 6566 696e 6974 696f 6e5b 276b  nt_definition['k
-000067d0: 6579 275d 290a 0a20 2020 2020 2020 2023  ey'])..        #
-000067e0: 2044 656c 6574 6520 646f 6375 6d65 6e74   Delete document
-000067f0: 2069 6e20 7265 6164 5f63 6f6c 6c65 6374   in read_collect
-00006800: 696f 6e20 7368 6f75 6c64 2066 6169 6c20  ion should fail 
-00006810: 7369 6e63 6520 6974 2068 6173 206f 6e6c  since it has onl
-00006820: 7920 7265 6164 2070 6572 6d69 7373 696f  y read permissio
-00006830: 6e73 2066 6f72 2074 6869 7320 636f 6c6c  ns for this coll
-00006840: 6563 7469 6f6e 0a20 2020 2020 2020 2073  ection.        s
-00006850: 656c 662e 5f5f 4173 7365 7274 4854 5450  elf.__AssertHTTP
-00006860: 4661 696c 7572 6557 6974 6853 7461 7475  FailureWithStatu
-00006870: 7328 0a20 2020 2020 2020 2020 2020 2053  s(.            S
-00006880: 7461 7475 7343 6f64 6573 2e46 4f52 4249  tatusCodes.FORBI
-00006890: 4444 454e 2c0a 2020 2020 2020 2020 2020  DDEN,.          
-000068a0: 2020 7265 6164 5f63 6f6c 6c65 6374 696f    read_collectio
-000068b0: 6e2e 6465 6c65 7465 5f69 7465 6d2c 0a20  n.delete_item,. 
-000068c0: 2020 2020 2020 2020 2020 2064 6f63 756d             docum
-000068d0: 656e 745f 6465 6669 6e69 7469 6f6e 5b27  ent_definition['
-000068e0: 6964 275d 2c0a 2020 2020 2020 2020 2020  id'],.          
-000068f0: 2020 646f 6375 6d65 6e74 5f64 6566 696e    document_defin
-00006900: 6974 696f 6e5b 2769 6427 5d0a 2020 2020  ition['id'].    
-00006910: 2020 2020 290a 0a20 2020 2020 2020 2063      )..        c
-00006920: 7265 6174 6564 5f64 622e 6465 6c65 7465  reated_db.delete
-00006930: 5f63 6f6e 7461 696e 6572 2861 6c6c 5f63  _container(all_c
-00006940: 6f6c 6c65 6374 696f 6e29 0a20 2020 2020  ollection).     
-00006950: 2020 2063 7265 6174 6564 5f64 622e 6465     created_db.de
-00006960: 6c65 7465 5f63 6f6e 7461 696e 6572 2872  lete_container(r
-00006970: 6561 645f 636f 6c6c 6563 7469 6f6e 290a  ead_collection).
-00006980: 0a20 2020 2064 6566 2074 6573 745f 7061  .    def test_pa
-00006990: 7274 6974 696f 6e65 645f 636f 6c6c 6563  rtitioned_collec
-000069a0: 7469 6f6e 5f65 7865 6375 7465 5f73 746f  tion_execute_sto
-000069b0: 7265 645f 7072 6f63 6564 7572 6528 7365  red_procedure(se
-000069c0: 6c66 293a 0a20 2020 2020 2020 2063 7265  lf):.        cre
-000069d0: 6174 6564 5f64 6220 3d20 7365 6c66 2e64  ated_db = self.d
-000069e0: 6174 6162 6173 6546 6f72 5465 7374 0a0a  atabaseForTest..
-000069f0: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-00006a00: 636f 6c6c 6563 7469 6f6e 203d 2073 656c  collection = sel
-00006a10: 662e 636f 6e66 6967 732e 6372 6561 7465  f.configs.create
-00006a20: 5f6d 756c 7469 5f70 6172 7469 7469 6f6e  _multi_partition
-00006a30: 5f63 6f6c 6c65 6374 696f 6e5f 7769 7468  _collection_with
-00006a40: 5f63 7573 746f 6d5f 706b 5f69 665f 6e6f  _custom_pk_if_no
-00006a50: 745f 6578 6973 7428 7365 6c66 2e63 6c69  t_exist(self.cli
-00006a60: 656e 7429 0a0a 2020 2020 2020 2020 7370  ent)..        sp
-00006a70: 726f 6320 3d20 7b0a 2020 2020 2020 2020  roc = {.        
-00006a80: 2020 2020 2769 6427 3a20 2773 746f 7265      'id': 'store
-00006a90: 6450 726f 6365 6475 7265 2720 2b20 7374  dProcedure' + st
-00006aa0: 7228 7575 6964 2e75 7569 6434 2829 292c  r(uuid.uuid4()),
-00006ab0: 0a20 2020 2020 2020 2020 2020 2027 626f  .            'bo
-00006ac0: 6479 273a 2028 0a20 2020 2020 2020 2020  dy': (.         
-00006ad0: 2020 2020 2020 2027 6675 6e63 7469 6f6e         'function
-00006ae0: 2028 2920 7b27 202b 0a20 2020 2020 2020   () {' +.       
-00006af0: 2020 2020 2020 2020 2027 2020 2076 6172           '   var
-00006b00: 2063 6c69 656e 7420 3d20 6765 7443 6f6e   client = getCon
-00006b10: 7465 7874 2829 2e67 6574 436f 6c6c 6563  text().getCollec
-00006b20: 7469 6f6e 2829 3b27 202b 0a20 2020 2020  tion();' +.     
-00006b30: 2020 2020 2020 2020 2020 2027 2020 2063             '   c
-00006b40: 6c69 656e 742e 6372 6561 7465 446f 6375  lient.createDocu
-00006b50: 6d65 6e74 2863 6c69 656e 742e 6765 7453  ment(client.getS
-00006b60: 656c 664c 696e 6b28 292c 207b 2069 643a  elfLink(), { id:
-00006b70: 205c 2774 6573 7444 6f63 5c27 2c20 706b   \'testDoc\', pk
-00006b80: 203a 2032 7d2c 207b 7d2c 2066 756e 6374   : 2}, {}, funct
-00006b90: 696f 6e28 6572 722c 2064 6f63 4372 6561  ion(err, docCrea
-00006ba0: 7465 642c 206f 7074 696f 6e73 2920 7b20  ted, options) { 
-00006bb0: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
-00006bc0: 2020 2020 2720 2020 6966 2865 7272 2920      '   if(err) 
-00006bd0: 7468 726f 7720 6e65 7720 4572 726f 7228  throw new Error(
-00006be0: 5c27 4572 726f 7220 7768 696c 6520 6372  \'Error while cr
-00006bf0: 6561 7469 6e67 2064 6f63 756d 656e 743a  eating document:
-00006c00: 205c 2720 2b20 6572 722e 6d65 7373 6167   \' + err.messag
-00006c10: 6529 3b27 202b 0a20 2020 2020 2020 2020  e);' +.         
-00006c20: 2020 2020 2020 2027 2020 2065 6c73 6520         '   else 
-00006c30: 7b27 202b 0a20 2020 2020 2020 2020 2020  {' +.           
-00006c40: 2020 2020 2027 2020 2067 6574 436f 6e74       '   getCont
-00006c50: 6578 7428 292e 6765 7452 6573 706f 6e73  ext().getRespons
-00006c60: 6528 292e 7365 7442 6f64 7928 3129 3b27  e().setBody(1);'
-00006c70: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00006c80: 2020 2027 2020 2020 2020 2020 7d27 202b     '        }' +
-00006c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006ca0: 2027 2020 207d 293b 7d27 290a 2020 2020   '   });}').    
-00006cb0: 2020 2020 7d0a 0a20 2020 2020 2020 2063      }..        c
-00006cc0: 7265 6174 6564 5f73 7072 6f63 203d 2063  reated_sproc = c
-00006cd0: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
-00006ce0: 6e2e 7363 7269 7074 732e 6372 6561 7465  n.scripts.create
-00006cf0: 5f73 746f 7265 645f 7072 6f63 6564 7572  _stored_procedur
-00006d00: 6528 626f 6479 3d73 7072 6f63 290a 0a20  e(body=sproc).. 
-00006d10: 2020 2020 2020 2023 2050 6172 7469 746f         # Partito
-00006d20: 6e20 4b65 7920 7661 6c75 6520 7361 6d65  n Key value same
-00006d30: 2061 7320 7768 6174 2069 7320 7370 6563   as what is spec
-00006d40: 6966 6965 6420 696e 2074 6865 2073 746f  ified in the sto
-00006d50: 7265 6420 7072 6f63 6564 7572 6520 626f  red procedure bo
-00006d60: 6479 0a20 2020 2020 2020 2072 6573 756c  dy.        resul
-00006d70: 7420 3d20 6372 6561 7465 645f 636f 6c6c  t = created_coll
-00006d80: 6563 7469 6f6e 2e73 6372 6970 7473 2e65  ection.scripts.e
-00006d90: 7865 6375 7465 5f73 746f 7265 645f 7072  xecute_stored_pr
-00006da0: 6f63 6564 7572 6528 7370 726f 633d 6372  ocedure(sproc=cr
-00006db0: 6561 7465 645f 7370 726f 635b 2769 6427  eated_sproc['id'
-00006dc0: 5d2c 2070 6172 7469 7469 6f6e 5f6b 6579  ], partition_key
-00006dd0: 3d32 290a 2020 2020 2020 2020 7365 6c66  =2).        self
-00006de0: 2e61 7373 6572 7445 7175 616c 2872 6573  .assertEqual(res
-00006df0: 756c 742c 2031 290a 0a20 2020 2020 2020  ult, 1)..       
-00006e00: 2023 2050 6172 7469 746f 6e20 4b65 7920   # Partiton Key 
-00006e10: 7661 6c75 6520 6469 6666 6572 656e 7420  value different 
-00006e20: 7468 616e 2077 6861 7420 6973 2073 7065  than what is spe
-00006e30: 6369 6669 6564 2069 6e20 7468 6520 7374  cified in the st
-00006e40: 6f72 6564 2070 726f 6365 6475 7265 2062  ored procedure b
-00006e50: 6f64 7920 7769 6c6c 2063 6175 7365 2061  ody will cause a
-00006e60: 2062 6164 2072 6571 7565 7374 2834 3030   bad request(400
-00006e70: 2920 6572 726f 720a 2020 2020 2020 2020  ) error.        
-00006e80: 7365 6c66 2e5f 5f41 7373 6572 7448 5454  self.__AssertHTT
-00006e90: 5046 6169 6c75 7265 5769 7468 5374 6174  PFailureWithStat
-00006ea0: 7573 280a 2020 2020 2020 2020 2020 2020  us(.            
-00006eb0: 5374 6174 7573 436f 6465 732e 4241 445f  StatusCodes.BAD_
-00006ec0: 5245 5155 4553 542c 0a20 2020 2020 2020  REQUEST,.       
-00006ed0: 2020 2020 2063 7265 6174 6564 5f63 6f6c       created_col
-00006ee0: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
-00006ef0: 6578 6563 7574 655f 7374 6f72 6564 5f70  execute_stored_p
-00006f00: 726f 6365 6475 7265 2c0a 2020 2020 2020  rocedure,.      
-00006f10: 2020 2020 2020 6372 6561 7465 645f 7370        created_sp
-00006f20: 726f 635b 2769 6427 5d2c 0a20 2020 2020  roc['id'],.     
-00006f30: 2020 2020 2020 2033 290a 0a20 2020 2064         3)..    d
-00006f40: 6566 2074 6573 745f 7061 7274 6974 696f  ef test_partitio
-00006f50: 6e65 645f 636f 6c6c 6563 7469 6f6e 5f70  ned_collection_p
-00006f60: 6172 7469 7469 6f6e 5f6b 6579 5f76 616c  artition_key_val
-00006f70: 7565 5f74 7970 6573 2873 656c 6629 3a0a  ue_types(self):.
-00006f80: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-00006f90: 6462 203d 2073 656c 662e 6461 7461 6261  db = self.databa
-00006fa0: 7365 466f 7254 6573 740a 0a20 2020 2020  seForTest..     
-00006fb0: 2020 2063 7265 6174 6564 5f63 6f6c 6c65     created_colle
-00006fc0: 6374 696f 6e20 3d20 6372 6561 7465 645f  ction = created_
-00006fd0: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
-00006fe0: 6e65 7228 0a20 2020 2020 2020 2020 2020  ner(.           
-00006ff0: 2069 643d 2774 6573 745f 7061 7274 6974   id='test_partit
-00007000: 696f 6e65 645f 636f 6c6c 6563 7469 6f6e  ioned_collection
-00007010: 5f70 6172 7469 7469 6f6e 5f6b 6579 5f76  _partition_key_v
-00007020: 616c 7565 5f74 7970 6573 2027 202b 2073  alue_types ' + s
-00007030: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
-00007040: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-00007050: 7274 6974 696f 6e5f 6b65 793d 5061 7274  rtition_key=Part
-00007060: 6974 696f 6e4b 6579 2870 6174 683d 272f  itionKey(path='/
-00007070: 706b 272c 206b 696e 643d 2748 6173 6827  pk', kind='Hash'
-00007080: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
-00007090: 2020 2020 2064 6f63 756d 656e 745f 6465       document_de
-000070a0: 6669 6e69 7469 6f6e 203d 207b 2769 6427  finition = {'id'
-000070b0: 3a20 2764 6f63 756d 656e 7431 2720 2b20  : 'document1' + 
-000070c0: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
-000070d0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00006290: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
+000062a0: 2020 2020 2020 616c 6c5f 636f 6c6c 6563        all_collec
+000062b0: 7469 6f6e 2e63 6c69 656e 745f 636f 6e6e  tion.client_conn
+000062c0: 6563 7469 6f6e 203d 2072 6573 7472 6963  ection = restric
+000062d0: 7465 645f 636c 6965 6e74 2e63 6c69 656e  ted_client.clien
+000062e0: 745f 636f 6e6e 6563 7469 6f6e 0a20 2020  t_connection.   
+000062f0: 2020 2020 2072 6561 645f 636f 6c6c 6563       read_collec
+00006300: 7469 6f6e 2e63 6c69 656e 745f 636f 6e6e  tion.client_conn
+00006310: 6563 7469 6f6e 203d 2072 6573 7472 6963  ection = restric
+00006320: 7465 645f 636c 6965 6e74 2e63 6c69 656e  ted_client.clien
+00006330: 745f 636f 6e6e 6563 7469 6f6e 0a0a 2020  t_connection..  
+00006340: 2020 2020 2020 2320 4372 6561 7465 2064        # Create d
+00006350: 6f63 756d 656e 7420 696e 2061 6c6c 5f63  ocument in all_c
+00006360: 6f6c 6c65 6374 696f 6e20 7368 6f75 6c64  ollection should
+00006370: 2073 7563 6365 6564 2073 696e 6365 2074   succeed since t
+00006380: 6865 2070 6172 7469 7469 6f6e 4b65 7920  he partitionKey 
+00006390: 6973 2031 2077 6869 6368 2069 7320 7768  is 1 which is wh
+000063a0: 6174 2073 7065 6369 6669 6564 2061 7320  at specified as 
+000063b0: 7265 736f 7572 6365 5061 7274 6974 696f  resourcePartitio
+000063c0: 6e4b 6579 2069 6e20 7065 726d 6973 7369  nKey in permissi
+000063d0: 6f6e 206f 626a 6563 7420 616e 6420 6974  on object and it
+000063e0: 2068 6173 2061 6c6c 2070 6572 6d69 7373   has all permiss
+000063f0: 696f 6e73 0a20 2020 2020 2020 2063 7265  ions.        cre
+00006400: 6174 6564 5f64 6f63 756d 656e 7420 3d20  ated_document = 
+00006410: 616c 6c5f 636f 6c6c 6563 7469 6f6e 2e63  all_collection.c
+00006420: 7265 6174 655f 6974 656d 2862 6f64 793d  reate_item(body=
+00006430: 646f 6375 6d65 6e74 5f64 6566 696e 6974  document_definit
+00006440: 696f 6e29 0a0a 2020 2020 2020 2020 2320  ion)..        # 
+00006450: 4372 6561 7465 2064 6f63 756d 656e 7420  Create document 
+00006460: 696e 2072 6561 645f 636f 6c6c 6563 7469  in read_collecti
+00006470: 6f6e 2073 686f 756c 6420 6661 696c 2073  on should fail s
+00006480: 696e 6365 2069 7420 6861 7320 6f6e 6c79  ince it has only
+00006490: 2072 6561 6420 7065 726d 6973 7369 6f6e   read permission
+000064a0: 7320 666f 7220 7468 6973 2063 6f6c 6c65  s for this colle
+000064b0: 6374 696f 6e0a 2020 2020 2020 2020 7365  ction.        se
+000064c0: 6c66 2e5f 5f41 7373 6572 7448 5454 5046  lf.__AssertHTTPF
+000064d0: 6169 6c75 7265 5769 7468 5374 6174 7573  ailureWithStatus
+000064e0: 280a 2020 2020 2020 2020 2020 2020 5374  (.            St
+000064f0: 6174 7573 436f 6465 732e 464f 5242 4944  atusCodes.FORBID
+00006500: 4445 4e2c 0a20 2020 2020 2020 2020 2020  DEN,.           
+00006510: 2072 6561 645f 636f 6c6c 6563 7469 6f6e   read_collection
+00006520: 2e63 7265 6174 655f 6974 656d 2c0a 2020  .create_item,.  
+00006530: 2020 2020 2020 2020 2020 646f 6375 6d65            docume
+00006540: 6e74 5f64 6566 696e 6974 696f 6e29 0a0a  nt_definition)..
+00006550: 2020 2020 2020 2020 646f 6375 6d65 6e74          document
+00006560: 5f64 6566 696e 6974 696f 6e5b 276b 6579  _definition['key
+00006570: 275d 203d 2032 0a20 2020 2020 2020 2023  '] = 2.        #
+00006580: 2043 7265 6174 6520 646f 6375 6d65 6e74   Create document
+00006590: 2073 686f 756c 6420 6661 696c 2073 696e   should fail sin
+000065a0: 6365 2074 6865 2070 6172 7469 7469 6f6e  ce the partition
+000065b0: 4b65 7920 6973 2032 2077 6869 6368 2069  Key is 2 which i
+000065c0: 7320 6469 6666 6572 656e 7420 7468 6174  s different that
+000065d0: 2077 6861 7420 6973 2073 7065 6369 6669   what is specifi
+000065e0: 6564 2061 7320 7265 736f 7572 6365 5061  ed as resourcePa
+000065f0: 7274 6974 696f 6e4b 6579 2069 6e20 7065  rtitionKey in pe
+00006600: 726d 6973 7369 6f6e 206f 626a 6563 740a  rmission object.
+00006610: 2020 2020 2020 2020 7365 6c66 2e5f 5f41          self.__A
+00006620: 7373 6572 7448 5454 5046 6169 6c75 7265  ssertHTTPFailure
+00006630: 5769 7468 5374 6174 7573 280a 2020 2020  WithStatus(.    
+00006640: 2020 2020 2020 2020 5374 6174 7573 436f          StatusCo
+00006650: 6465 732e 464f 5242 4944 4445 4e2c 0a20  des.FORBIDDEN,. 
+00006660: 2020 2020 2020 2020 2020 2061 6c6c 5f63             all_c
+00006670: 6f6c 6c65 6374 696f 6e2e 6372 6561 7465  ollection.create
+00006680: 5f69 7465 6d2c 0a20 2020 2020 2020 2020  _item,.         
+00006690: 2020 2064 6f63 756d 656e 745f 6465 6669     document_defi
+000066a0: 6e69 7469 6f6e 290a 0a20 2020 2020 2020  nition)..       
+000066b0: 2064 6f63 756d 656e 745f 6465 6669 6e69   document_defini
+000066c0: 7469 6f6e 5b27 6b65 7927 5d20 3d20 310a  tion['key'] = 1.
+000066d0: 2020 2020 2020 2020 2320 4465 6c65 7465          # Delete
+000066e0: 2064 6f63 756d 656e 7420 7368 6f75 6c64   document should
+000066f0: 2073 7563 6365 6564 2073 696e 6365 2074   succeed since t
+00006700: 6865 2070 6172 7469 7469 6f6e 4b65 7920  he partitionKey 
+00006710: 6973 2031 2077 6869 6368 2069 7320 7768  is 1 which is wh
+00006720: 6174 2073 7065 6369 6669 6564 2061 7320  at specified as 
+00006730: 7265 736f 7572 6365 5061 7274 6974 696f  resourcePartitio
+00006740: 6e4b 6579 2069 6e20 7065 726d 6973 7369  nKey in permissi
+00006750: 6f6e 206f 626a 6563 740a 2020 2020 2020  on object.      
+00006760: 2020 6372 6561 7465 645f 646f 6375 6d65    created_docume
+00006770: 6e74 203d 2061 6c6c 5f63 6f6c 6c65 6374  nt = all_collect
+00006780: 696f 6e2e 6465 6c65 7465 5f69 7465 6d28  ion.delete_item(
+00006790: 6974 656d 3d63 7265 6174 6564 5f64 6f63  item=created_doc
+000067a0: 756d 656e 745b 2769 6427 5d2c 2070 6172  ument['id'], par
+000067b0: 7469 7469 6f6e 5f6b 6579 3d64 6f63 756d  tition_key=docum
+000067c0: 656e 745f 6465 6669 6e69 7469 6f6e 5b27  ent_definition['
+000067d0: 6b65 7927 5d29 0a0a 2020 2020 2020 2020  key'])..        
+000067e0: 2320 4465 6c65 7465 2064 6f63 756d 656e  # Delete documen
+000067f0: 7420 696e 2072 6561 645f 636f 6c6c 6563  t in read_collec
+00006800: 7469 6f6e 2073 686f 756c 6420 6661 696c  tion should fail
+00006810: 2073 696e 6365 2069 7420 6861 7320 6f6e   since it has on
+00006820: 6c79 2072 6561 6420 7065 726d 6973 7369  ly read permissi
+00006830: 6f6e 7320 666f 7220 7468 6973 2063 6f6c  ons for this col
+00006840: 6c65 6374 696f 6e0a 2020 2020 2020 2020  lection.        
+00006850: 7365 6c66 2e5f 5f41 7373 6572 7448 5454  self.__AssertHTT
+00006860: 5046 6169 6c75 7265 5769 7468 5374 6174  PFailureWithStat
+00006870: 7573 280a 2020 2020 2020 2020 2020 2020  us(.            
+00006880: 5374 6174 7573 436f 6465 732e 464f 5242  StatusCodes.FORB
+00006890: 4944 4445 4e2c 0a20 2020 2020 2020 2020  IDDEN,.         
+000068a0: 2020 2072 6561 645f 636f 6c6c 6563 7469     read_collecti
+000068b0: 6f6e 2e64 656c 6574 655f 6974 656d 2c0a  on.delete_item,.
+000068c0: 2020 2020 2020 2020 2020 2020 646f 6375              docu
+000068d0: 6d65 6e74 5f64 6566 696e 6974 696f 6e5b  ment_definition[
+000068e0: 2769 6427 5d2c 0a20 2020 2020 2020 2020  'id'],.         
+000068f0: 2020 2064 6f63 756d 656e 745f 6465 6669     document_defi
+00006900: 6e69 7469 6f6e 5b27 6964 275d 0a20 2020  nition['id'].   
+00006910: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00006920: 6372 6561 7465 645f 6462 2e64 656c 6574  created_db.delet
+00006930: 655f 636f 6e74 6169 6e65 7228 616c 6c5f  e_container(all_
+00006940: 636f 6c6c 6563 7469 6f6e 290a 2020 2020  collection).    
+00006950: 2020 2020 6372 6561 7465 645f 6462 2e64      created_db.d
+00006960: 656c 6574 655f 636f 6e74 6169 6e65 7228  elete_container(
+00006970: 7265 6164 5f63 6f6c 6c65 6374 696f 6e29  read_collection)
+00006980: 0a0a 2020 2020 6465 6620 7465 7374 5f70  ..    def test_p
+00006990: 6172 7469 7469 6f6e 6564 5f63 6f6c 6c65  artitioned_colle
+000069a0: 6374 696f 6e5f 6578 6563 7574 655f 7374  ction_execute_st
+000069b0: 6f72 6564 5f70 726f 6365 6475 7265 2873  ored_procedure(s
+000069c0: 656c 6629 3a0a 2020 2020 2020 2020 6372  elf):.        cr
+000069d0: 6561 7465 645f 6462 203d 2073 656c 662e  eated_db = self.
+000069e0: 6461 7461 6261 7365 466f 7254 6573 740a  databaseForTest.
+000069f0: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+00006a00: 5f63 6f6c 6c65 6374 696f 6e20 3d20 7365  _collection = se
+00006a10: 6c66 2e63 6f6e 6669 6773 2e63 7265 6174  lf.configs.creat
+00006a20: 655f 6d75 6c74 695f 7061 7274 6974 696f  e_multi_partitio
+00006a30: 6e5f 636f 6c6c 6563 7469 6f6e 5f77 6974  n_collection_wit
+00006a40: 685f 6375 7374 6f6d 5f70 6b5f 6966 5f6e  h_custom_pk_if_n
+00006a50: 6f74 5f65 7869 7374 2873 656c 662e 636c  ot_exist(self.cl
+00006a60: 6965 6e74 290a 0a20 2020 2020 2020 2073  ient)..        s
+00006a70: 7072 6f63 203d 207b 0a20 2020 2020 2020  proc = {.       
+00006a80: 2020 2020 2027 6964 273a 2027 7374 6f72       'id': 'stor
+00006a90: 6564 5072 6f63 6564 7572 6527 202b 2073  edProcedure' + s
+00006aa0: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
+00006ab0: 2c0a 2020 2020 2020 2020 2020 2020 2762  ,.            'b
+00006ac0: 6f64 7927 3a20 280a 2020 2020 2020 2020  ody': (.        
+00006ad0: 2020 2020 2020 2020 2766 756e 6374 696f          'functio
+00006ae0: 6e20 2829 207b 2720 2b0a 2020 2020 2020  n () {' +.      
+00006af0: 2020 2020 2020 2020 2020 2720 2020 7661            '   va
+00006b00: 7220 636c 6965 6e74 203d 2067 6574 436f  r client = getCo
+00006b10: 6e74 6578 7428 292e 6765 7443 6f6c 6c65  ntext().getColle
+00006b20: 6374 696f 6e28 293b 2720 2b0a 2020 2020  ction();' +.    
+00006b30: 2020 2020 2020 2020 2020 2020 2720 2020              '   
+00006b40: 636c 6965 6e74 2e63 7265 6174 6544 6f63  client.createDoc
+00006b50: 756d 656e 7428 636c 6965 6e74 2e67 6574  ument(client.get
+00006b60: 5365 6c66 4c69 6e6b 2829 2c20 7b20 6964  SelfLink(), { id
+00006b70: 3a20 5c27 7465 7374 446f 635c 272c 2070  : \'testDoc\', p
+00006b80: 6b20 3a20 327d 2c20 7b7d 2c20 6675 6e63  k : 2}, {}, func
+00006b90: 7469 6f6e 2865 7272 2c20 646f 6343 7265  tion(err, docCre
+00006ba0: 6174 6564 2c20 6f70 7469 6f6e 7329 207b  ated, options) {
+00006bb0: 2027 202b 0a20 2020 2020 2020 2020 2020   ' +.           
+00006bc0: 2020 2020 2027 2020 2069 6628 6572 7229       '   if(err)
+00006bd0: 2074 6872 6f77 206e 6577 2045 7272 6f72   throw new Error
+00006be0: 285c 2745 7272 6f72 2077 6869 6c65 2063  (\'Error while c
+00006bf0: 7265 6174 696e 6720 646f 6375 6d65 6e74  reating document
+00006c00: 3a20 5c27 202b 2065 7272 2e6d 6573 7361  : \' + err.messa
+00006c10: 6765 293b 2720 2b0a 2020 2020 2020 2020  ge);' +.        
+00006c20: 2020 2020 2020 2020 2720 2020 656c 7365          '   else
+00006c30: 207b 2720 2b0a 2020 2020 2020 2020 2020   {' +.          
+00006c40: 2020 2020 2020 2720 2020 6765 7443 6f6e        '   getCon
+00006c50: 7465 7874 2829 2e67 6574 5265 7370 6f6e  text().getRespon
+00006c60: 7365 2829 2e73 6574 426f 6479 2831 293b  se().setBody(1);
+00006c70: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
+00006c80: 2020 2020 2720 2020 2020 2020 207d 2720      '        }' 
+00006c90: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+00006ca0: 2020 2720 2020 7d29 3b7d 2729 0a20 2020    '   });}').   
+00006cb0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+00006cc0: 6372 6561 7465 645f 7370 726f 6320 3d20  created_sproc = 
+00006cd0: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
+00006ce0: 6f6e 2e73 6372 6970 7473 2e63 7265 6174  on.scripts.creat
+00006cf0: 655f 7374 6f72 6564 5f70 726f 6365 6475  e_stored_procedu
+00006d00: 7265 2862 6f64 793d 7370 726f 6329 0a0a  re(body=sproc)..
+00006d10: 2020 2020 2020 2020 2320 5061 7274 6974          # Partit
+00006d20: 6f6e 204b 6579 2076 616c 7565 2073 616d  on Key value sam
+00006d30: 6520 6173 2077 6861 7420 6973 2073 7065  e as what is spe
+00006d40: 6369 6669 6564 2069 6e20 7468 6520 7374  cified in the st
+00006d50: 6f72 6564 2070 726f 6365 6475 7265 2062  ored procedure b
+00006d60: 6f64 790a 2020 2020 2020 2020 7265 7375  ody.        resu
+00006d70: 6c74 203d 2063 7265 6174 6564 5f63 6f6c  lt = created_col
+00006d80: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
+00006d90: 6578 6563 7574 655f 7374 6f72 6564 5f70  execute_stored_p
+00006da0: 726f 6365 6475 7265 2873 7072 6f63 3d63  rocedure(sproc=c
+00006db0: 7265 6174 6564 5f73 7072 6f63 5b27 6964  reated_sproc['id
+00006dc0: 275d 2c20 7061 7274 6974 696f 6e5f 6b65  '], partition_ke
+00006dd0: 793d 3229 0a20 2020 2020 2020 2073 656c  y=2).        sel
+00006de0: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+00006df0: 7375 6c74 2c20 3129 0a0a 2020 2020 2020  sult, 1)..      
+00006e00: 2020 2320 5061 7274 6974 6f6e 204b 6579    # Partiton Key
+00006e10: 2076 616c 7565 2064 6966 6665 7265 6e74   value different
+00006e20: 2074 6861 6e20 7768 6174 2069 7320 7370   than what is sp
+00006e30: 6563 6966 6965 6420 696e 2074 6865 2073  ecified in the s
+00006e40: 746f 7265 6420 7072 6f63 6564 7572 6520  tored procedure 
+00006e50: 626f 6479 2077 696c 6c20 6361 7573 6520  body will cause 
+00006e60: 6120 6261 6420 7265 7175 6573 7428 3430  a bad request(40
+00006e70: 3029 2065 7272 6f72 0a20 2020 2020 2020  0) error.       
+00006e80: 2073 656c 662e 5f5f 4173 7365 7274 4854   self.__AssertHT
+00006e90: 5450 4661 696c 7572 6557 6974 6853 7461  TPFailureWithSta
+00006ea0: 7475 7328 0a20 2020 2020 2020 2020 2020  tus(.           
+00006eb0: 2053 7461 7475 7343 6f64 6573 2e42 4144   StatusCodes.BAD
+00006ec0: 5f52 4551 5545 5354 2c0a 2020 2020 2020  _REQUEST,.      
+00006ed0: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
+00006ee0: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
+00006ef0: 2e65 7865 6375 7465 5f73 746f 7265 645f  .execute_stored_
+00006f00: 7072 6f63 6564 7572 652c 0a20 2020 2020  procedure,.     
+00006f10: 2020 2020 2020 2063 7265 6174 6564 5f73         created_s
+00006f20: 7072 6f63 5b27 6964 275d 2c0a 2020 2020  proc['id'],.    
+00006f30: 2020 2020 2020 2020 3329 0a0a 2020 2020          3)..    
+00006f40: 6465 6620 7465 7374 5f70 6172 7469 7469  def test_partiti
+00006f50: 6f6e 6564 5f63 6f6c 6c65 6374 696f 6e5f  oned_collection_
+00006f60: 7061 7274 6974 696f 6e5f 6b65 795f 7661  partition_key_va
+00006f70: 6c75 655f 7479 7065 7328 7365 6c66 293a  lue_types(self):
+00006f80: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+00006f90: 5f64 6220 3d20 7365 6c66 2e64 6174 6162  _db = self.datab
+00006fa0: 6173 6546 6f72 5465 7374 0a0a 2020 2020  aseForTest..    
+00006fb0: 2020 2020 6372 6561 7465 645f 636f 6c6c      created_coll
+00006fc0: 6563 7469 6f6e 203d 2063 7265 6174 6564  ection = created
+00006fd0: 5f64 622e 6372 6561 7465 5f63 6f6e 7461  _db.create_conta
+00006fe0: 696e 6572 280a 2020 2020 2020 2020 2020  iner(.          
+00006ff0: 2020 6964 3d27 7465 7374 5f70 6172 7469    id='test_parti
+00007000: 7469 6f6e 6564 5f63 6f6c 6c65 6374 696f  tioned_collectio
+00007010: 6e5f 7061 7274 6974 696f 6e5f 6b65 795f  n_partition_key_
+00007020: 7661 6c75 655f 7479 7065 7320 2720 2b20  value_types ' + 
+00007030: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
+00007040: 292c 0a20 2020 2020 2020 2020 2020 2070  ),.            p
+00007050: 6172 7469 7469 6f6e 5f6b 6579 3d50 6172  artition_key=Par
+00007060: 7469 7469 6f6e 4b65 7928 7061 7468 3d27  titionKey(path='
+00007070: 2f70 6b27 2c20 6b69 6e64 3d27 4861 7368  /pk', kind='Hash
+00007080: 2729 0a20 2020 2020 2020 2029 0a0a 2020  ').        )..  
+00007090: 2020 2020 2020 646f 6375 6d65 6e74 5f64        document_d
+000070a0: 6566 696e 6974 696f 6e20 3d20 7b27 6964  efinition = {'id
+000070b0: 273a 2027 646f 6375 6d65 6e74 3127 202b  ': 'document1' +
+000070c0: 2073 7472 2875 7569 642e 7575 6964 3428   str(uuid.uuid4(
+000070d0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
 000070e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070f0: 2020 2770 6b27 3a20 4e6f 6e65 2c0a 2020    'pk': None,.  
+000070f0: 2020 2027 706b 273a 204e 6f6e 652c 0a20     'pk': None,. 
 00007100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007110: 2020 2020 2020 2020 2020 2020 2027 7370               'sp
-00007120: 616d 273a 2027 6567 6773 277d 0a0a 2020  am': 'eggs'}..  
-00007130: 2020 2020 2020 2320 6372 6561 7465 2064        # create d
-00007140: 6f63 756d 656e 7420 7769 7468 2070 6172  ocument with par
-00007150: 7469 7469 6f6e 4b65 7920 7365 7420 6173  titionKey set as
-00007160: 204e 6f6e 6520 6865 7265 0a20 2020 2020   None here.     
-00007170: 2020 2063 7265 6174 6564 5f63 6f6c 6c65     created_colle
-00007180: 6374 696f 6e2e 6372 6561 7465 5f69 7465  ction.create_ite
-00007190: 6d28 626f 6479 3d64 6f63 756d 656e 745f  m(body=document_
-000071a0: 6465 6669 6e69 7469 6f6e 290a 0a20 2020  definition)..   
-000071b0: 2020 2020 2064 6f63 756d 656e 745f 6465       document_de
-000071c0: 6669 6e69 7469 6f6e 203d 207b 2769 6427  finition = {'id'
-000071d0: 3a20 2764 6f63 756d 656e 7431 2720 2b20  : 'document1' + 
-000071e0: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
-000071f0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00007110: 2020 2020 2020 2020 2020 2020 2020 2773                's
+00007120: 7061 6d27 3a20 2765 6767 7327 7d0a 0a20  pam': 'eggs'}.. 
+00007130: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+00007140: 646f 6375 6d65 6e74 2077 6974 6820 7061  document with pa
+00007150: 7274 6974 696f 6e4b 6579 2073 6574 2061  rtitionKey set a
+00007160: 7320 4e6f 6e65 2068 6572 650a 2020 2020  s None here.    
+00007170: 2020 2020 6372 6561 7465 645f 636f 6c6c      created_coll
+00007180: 6563 7469 6f6e 2e63 7265 6174 655f 6974  ection.create_it
+00007190: 656d 2862 6f64 793d 646f 6375 6d65 6e74  em(body=document
+000071a0: 5f64 6566 696e 6974 696f 6e29 0a0a 2020  _definition)..  
+000071b0: 2020 2020 2020 646f 6375 6d65 6e74 5f64        document_d
+000071c0: 6566 696e 6974 696f 6e20 3d20 7b27 6964  efinition = {'id
+000071d0: 273a 2027 646f 6375 6d65 6e74 3127 202b  ': 'document1' +
+000071e0: 2073 7472 2875 7569 642e 7575 6964 3428   str(uuid.uuid4(
+000071f0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
 00007200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007210: 2020 2773 7061 6d27 3a20 2765 6767 7327    'spam': 'eggs'
-00007220: 7d0a 0a20 2020 2020 2020 2023 2063 7265  }..        # cre
-00007230: 6174 6520 646f 6375 6d65 6e74 2077 6974  ate document wit
-00007240: 6820 7061 7274 6974 696f 6e4b 6579 2073  h partitionKey s
-00007250: 6574 2061 7320 556e 6465 6669 6e65 6420  et as Undefined 
-00007260: 6865 7265 0a20 2020 2020 2020 2063 7265  here.        cre
-00007270: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
-00007280: 6372 6561 7465 5f69 7465 6d28 626f 6479  create_item(body
-00007290: 3d64 6f63 756d 656e 745f 6465 6669 6e69  =document_defini
-000072a0: 7469 6f6e 290a 0a20 2020 2020 2020 2064  tion)..        d
-000072b0: 6f63 756d 656e 745f 6465 6669 6e69 7469  ocument_definiti
-000072c0: 6f6e 203d 207b 2769 6427 3a20 2764 6f63  on = {'id': 'doc
-000072d0: 756d 656e 7431 2720 2b20 7374 7228 7575  ument1' + str(uu
-000072e0: 6964 2e75 7569 6434 2829 292c 0a20 2020  id.uuid4()),.   
+00007210: 2020 2027 7370 616d 273a 2027 6567 6773     'spam': 'eggs
+00007220: 277d 0a0a 2020 2020 2020 2020 2320 6372  '}..        # cr
+00007230: 6561 7465 2064 6f63 756d 656e 7420 7769  eate document wi
+00007240: 7468 2070 6172 7469 7469 6f6e 4b65 7920  th partitionKey 
+00007250: 7365 7420 6173 2055 6e64 6566 696e 6564  set as Undefined
+00007260: 2068 6572 650a 2020 2020 2020 2020 6372   here.        cr
+00007270: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+00007280: 2e63 7265 6174 655f 6974 656d 2862 6f64  .create_item(bod
+00007290: 793d 646f 6375 6d65 6e74 5f64 6566 696e  y=document_defin
+000072a0: 6974 696f 6e29 0a0a 2020 2020 2020 2020  ition)..        
+000072b0: 646f 6375 6d65 6e74 5f64 6566 696e 6974  document_definit
+000072c0: 696f 6e20 3d20 7b27 6964 273a 2027 646f  ion = {'id': 'do
+000072d0: 6375 6d65 6e74 3127 202b 2073 7472 2875  cument1' + str(u
+000072e0: 7569 642e 7575 6964 3428 2929 2c0a 2020  uid.uuid4()),.  
 000072f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007300: 2020 2020 2020 2020 2020 2020 2770 6b27              'pk'
-00007310: 3a20 5472 7565 2c0a 2020 2020 2020 2020  : True,.        
+00007300: 2020 2020 2020 2020 2020 2020 2027 706b               'pk
+00007310: 273a 2054 7275 652c 0a20 2020 2020 2020  ': True,.       
 00007320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007330: 2020 2020 2020 2027 7370 616d 273a 2027         'spam': '
-00007340: 6567 6773 277d 0a0a 2020 2020 2020 2020  eggs'}..        
-00007350: 2320 6372 6561 7465 2064 6f63 756d 656e  # create documen
-00007360: 7420 7769 7468 2062 6f6f 6c20 7061 7274  t with bool part
-00007370: 6974 696f 6e4b 6579 0a20 2020 2020 2020  itionKey.       
-00007380: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-00007390: 696f 6e2e 6372 6561 7465 5f69 7465 6d28  ion.create_item(
-000073a0: 626f 6479 3d64 6f63 756d 656e 745f 6465  body=document_de
-000073b0: 6669 6e69 7469 6f6e 290a 0a20 2020 2020  finition)..     
-000073c0: 2020 2064 6f63 756d 656e 745f 6465 6669     document_defi
-000073d0: 6e69 7469 6f6e 203d 207b 2769 6427 3a20  nition = {'id': 
-000073e0: 2764 6f63 756d 656e 7431 2720 2b20 7374  'document1' + st
-000073f0: 7228 7575 6964 2e75 7569 6434 2829 292c  r(uuid.uuid4()),
-00007400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007330: 2020 2020 2020 2020 2773 7061 6d27 3a20          'spam': 
+00007340: 2765 6767 7327 7d0a 0a20 2020 2020 2020  'eggs'}..       
+00007350: 2023 2063 7265 6174 6520 646f 6375 6d65   # create docume
+00007360: 6e74 2077 6974 6820 626f 6f6c 2070 6172  nt with bool par
+00007370: 7469 7469 6f6e 4b65 790a 2020 2020 2020  titionKey.      
+00007380: 2020 6372 6561 7465 645f 636f 6c6c 6563    created_collec
+00007390: 7469 6f6e 2e63 7265 6174 655f 6974 656d  tion.create_item
+000073a0: 2862 6f64 793d 646f 6375 6d65 6e74 5f64  (body=document_d
+000073b0: 6566 696e 6974 696f 6e29 0a0a 2020 2020  efinition)..    
+000073c0: 2020 2020 646f 6375 6d65 6e74 5f64 6566      document_def
+000073d0: 696e 6974 696f 6e20 3d20 7b27 6964 273a  inition = {'id':
+000073e0: 2027 646f 6375 6d65 6e74 3127 202b 2073   'document1' + s
+000073f0: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
+00007400: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00007410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007420: 2770 6b27 3a20 2776 616c 7565 272c 0a20  'pk': 'value',. 
+00007420: 2027 706b 273a 2027 7661 6c75 6527 2c0a   'pk': 'value',.
 00007430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007440: 2020 2020 2020 2020 2020 2020 2020 2773                's
-00007450: 7061 6d27 3a20 2765 6767 7327 7d0a 0a20  pam': 'eggs'}.. 
-00007460: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
-00007470: 646f 6375 6d65 6e74 2077 6974 6820 7374  document with st
-00007480: 7269 6e67 2070 6172 7469 7469 6f6e 4b65  ring partitionKe
-00007490: 790a 2020 2020 2020 2020 6372 6561 7465  y.        create
-000074a0: 645f 636f 6c6c 6563 7469 6f6e 2e63 7265  d_collection.cre
-000074b0: 6174 655f 6974 656d 2862 6f64 793d 646f  ate_item(body=do
-000074c0: 6375 6d65 6e74 5f64 6566 696e 6974 696f  cument_definitio
-000074d0: 6e29 0a0a 2020 2020 2020 2020 646f 6375  n)..        docu
-000074e0: 6d65 6e74 5f64 6566 696e 6974 696f 6e20  ment_definition 
-000074f0: 3d20 7b27 6964 273a 2027 646f 6375 6d65  = {'id': 'docume
-00007500: 6e74 3127 202b 2073 7472 2875 7569 642e  nt1' + str(uuid.
-00007510: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
+00007440: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00007450: 7370 616d 273a 2027 6567 6773 277d 0a0a  spam': 'eggs'}..
+00007460: 2020 2020 2020 2020 2320 6372 6561 7465          # create
+00007470: 2064 6f63 756d 656e 7420 7769 7468 2073   document with s
+00007480: 7472 696e 6720 7061 7274 6974 696f 6e4b  tring partitionK
+00007490: 6579 0a20 2020 2020 2020 2063 7265 6174  ey.        creat
+000074a0: 6564 5f63 6f6c 6c65 6374 696f 6e2e 6372  ed_collection.cr
+000074b0: 6561 7465 5f69 7465 6d28 626f 6479 3d64  eate_item(body=d
+000074c0: 6f63 756d 656e 745f 6465 6669 6e69 7469  ocument_definiti
+000074d0: 6f6e 290a 0a20 2020 2020 2020 2064 6f63  on)..        doc
+000074e0: 756d 656e 745f 6465 6669 6e69 7469 6f6e  ument_definition
+000074f0: 203d 207b 2769 6427 3a20 2764 6f63 756d   = {'id': 'docum
+00007500: 656e 7431 2720 2b20 7374 7228 7575 6964  ent1' + str(uuid
+00007510: 2e75 7569 6434 2829 292c 0a20 2020 2020  .uuid4()),.     
 00007520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007530: 2020 2020 2020 2020 2027 706b 273a 2031           'pk': 1
-00007540: 3030 2c0a 2020 2020 2020 2020 2020 2020  00,.            
+00007530: 2020 2020 2020 2020 2020 2770 6b27 3a20            'pk': 
+00007540: 3130 302c 0a20 2020 2020 2020 2020 2020  100,.           
 00007550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007560: 2020 2027 7370 616d 273a 2027 6567 6773     'spam': 'eggs
-00007570: 277d 0a0a 2020 2020 2020 2020 2320 6372  '}..        # cr
-00007580: 6561 7465 2064 6f63 756d 656e 7420 7769  eate document wi
-00007590: 7468 2069 6e74 2070 6172 7469 7469 6f6e  th int partition
-000075a0: 4b65 790a 2020 2020 2020 2020 6372 6561  Key.        crea
-000075b0: 7465 645f 636f 6c6c 6563 7469 6f6e 2e63  ted_collection.c
-000075c0: 7265 6174 655f 6974 656d 2862 6f64 793d  reate_item(body=
-000075d0: 646f 6375 6d65 6e74 5f64 6566 696e 6974  document_definit
-000075e0: 696f 6e29 0a0a 2020 2020 2020 2020 646f  ion)..        do
-000075f0: 6375 6d65 6e74 5f64 6566 696e 6974 696f  cument_definitio
-00007600: 6e20 3d20 7b27 6964 273a 2027 646f 6375  n = {'id': 'docu
-00007610: 6d65 6e74 3127 202b 2073 7472 2875 7569  ment1' + str(uui
-00007620: 642e 7575 6964 3428 2929 2c0a 2020 2020  d.uuid4()),.    
+00007560: 2020 2020 2773 7061 6d27 3a20 2765 6767      'spam': 'egg
+00007570: 7327 7d0a 0a20 2020 2020 2020 2023 2063  s'}..        # c
+00007580: 7265 6174 6520 646f 6375 6d65 6e74 2077  reate document w
+00007590: 6974 6820 696e 7420 7061 7274 6974 696f  ith int partitio
+000075a0: 6e4b 6579 0a20 2020 2020 2020 2063 7265  nKey.        cre
+000075b0: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
+000075c0: 6372 6561 7465 5f69 7465 6d28 626f 6479  create_item(body
+000075d0: 3d64 6f63 756d 656e 745f 6465 6669 6e69  =document_defini
+000075e0: 7469 6f6e 290a 0a20 2020 2020 2020 2064  tion)..        d
+000075f0: 6f63 756d 656e 745f 6465 6669 6e69 7469  ocument_definiti
+00007600: 6f6e 203d 207b 2769 6427 3a20 2764 6f63  on = {'id': 'doc
+00007610: 756d 656e 7431 2720 2b20 7374 7228 7575  ument1' + str(uu
+00007620: 6964 2e75 7569 6434 2829 292c 0a20 2020  id.uuid4()),.   
 00007630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007640: 2020 2020 2020 2020 2020 2027 706b 273a             'pk':
-00007650: 2031 302e 3530 2c0a 2020 2020 2020 2020   10.50,.        
+00007640: 2020 2020 2020 2020 2020 2020 2770 6b27              'pk'
+00007650: 3a20 3130 2e35 302c 0a20 2020 2020 2020  : 10.50,.       
 00007660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007670: 2020 2020 2020 2027 7370 616d 273a 2027         'spam': '
-00007680: 6567 6773 277d 0a0a 2020 2020 2020 2020  eggs'}..        
-00007690: 2320 6372 6561 7465 2064 6f63 756d 656e  # create documen
-000076a0: 7420 7769 7468 2066 6c6f 6174 2070 6172  t with float par
-000076b0: 7469 7469 6f6e 4b65 790a 2020 2020 2020  titionKey.      
-000076c0: 2020 6372 6561 7465 645f 636f 6c6c 6563    created_collec
-000076d0: 7469 6f6e 2e63 7265 6174 655f 6974 656d  tion.create_item
-000076e0: 2862 6f64 793d 646f 6375 6d65 6e74 5f64  (body=document_d
-000076f0: 6566 696e 6974 696f 6e29 0a0a 2020 2020  efinition)..    
-00007700: 2020 2020 646f 6375 6d65 6e74 5f64 6566      document_def
-00007710: 696e 6974 696f 6e20 3d20 7b27 6e61 6d65  inition = {'name
-00007720: 273a 2027 7361 6d70 6c65 2064 6f63 756d  ': 'sample docum
-00007730: 656e 7427 2c0a 2020 2020 2020 2020 2020  ent',.          
+00007670: 2020 2020 2020 2020 2773 7061 6d27 3a20          'spam': 
+00007680: 2765 6767 7327 7d0a 0a20 2020 2020 2020  'eggs'}..       
+00007690: 2023 2063 7265 6174 6520 646f 6375 6d65   # create docume
+000076a0: 6e74 2077 6974 6820 666c 6f61 7420 7061  nt with float pa
+000076b0: 7274 6974 696f 6e4b 6579 0a20 2020 2020  rtitionKey.     
+000076c0: 2020 2063 7265 6174 6564 5f63 6f6c 6c65     created_colle
+000076d0: 6374 696f 6e2e 6372 6561 7465 5f69 7465  ction.create_ite
+000076e0: 6d28 626f 6479 3d64 6f63 756d 656e 745f  m(body=document_
+000076f0: 6465 6669 6e69 7469 6f6e 290a 0a20 2020  definition)..   
+00007700: 2020 2020 2064 6f63 756d 656e 745f 6465       document_de
+00007710: 6669 6e69 7469 6f6e 203d 207b 276e 616d  finition = {'nam
+00007720: 6527 3a20 2773 616d 706c 6520 646f 6375  e': 'sample docu
+00007730: 6d65 6e74 272c 0a20 2020 2020 2020 2020  ment',.         
 00007740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007750: 2020 2020 2027 7370 616d 273a 2027 6567       'spam': 'eg
-00007760: 6773 272c 0a20 2020 2020 2020 2020 2020  gs',.           
+00007750: 2020 2020 2020 2773 7061 6d27 3a20 2765        'spam': 'e
+00007760: 6767 7327 2c0a 2020 2020 2020 2020 2020  ggs',.          
 00007770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007780: 2020 2020 2770 6b27 3a20 2776 616c 7565      'pk': 'value
-00007790: 277d 0a0a 2020 2020 2020 2020 2320 5368  '}..        # Sh
-000077a0: 6f75 6c64 2074 6872 6f77 2061 6e20 6572  ould throw an er
-000077b0: 726f 7220 6265 6361 7573 6520 6175 746f  ror because auto
-000077c0: 6d61 7469 6320 6964 2067 656e 6572 6174  matic id generat
-000077d0: 696f 6e20 6973 2064 6973 6162 6c65 6420  ion is disabled 
-000077e0: 616c 7761 7973 2e0a 2020 2020 2020 2020  always..        
-000077f0: 7365 6c66 2e5f 5f41 7373 6572 7448 5454  self.__AssertHTT
-00007800: 5046 6169 6c75 7265 5769 7468 5374 6174  PFailureWithStat
-00007810: 7573 280a 2020 2020 2020 2020 2020 2020  us(.            
-00007820: 5374 6174 7573 436f 6465 732e 4241 445f  StatusCodes.BAD_
-00007830: 5245 5155 4553 542c 0a20 2020 2020 2020  REQUEST,.       
-00007840: 2020 2020 2063 7265 6174 6564 5f63 6f6c       created_col
-00007850: 6c65 6374 696f 6e2e 6372 6561 7465 5f69  lection.create_i
-00007860: 7465 6d2c 0a20 2020 2020 2020 2020 2020  tem,.           
-00007870: 2064 6f63 756d 656e 745f 6465 6669 6e69   document_defini
-00007880: 7469 6f6e 0a20 2020 2020 2020 2029 0a0a  tion.        )..
-00007890: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-000078a0: 6462 2e64 656c 6574 655f 636f 6e74 6169  db.delete_contai
-000078b0: 6e65 7228 6372 6561 7465 645f 636f 6c6c  ner(created_coll
-000078c0: 6563 7469 6f6e 290a 0a20 2020 2064 6566  ection)..    def
-000078d0: 2074 6573 745f 7061 7274 6974 696f 6e65   test_partitione
-000078e0: 645f 636f 6c6c 6563 7469 6f6e 5f63 6f6e  d_collection_con
-000078f0: 666c 6963 745f 6372 7564 5f61 6e64 5f71  flict_crud_and_q
-00007900: 7565 7279 2873 656c 6629 3a0a 2020 2020  uery(self):.    
-00007910: 2020 2020 6372 6561 7465 645f 6462 203d      created_db =
-00007920: 2073 656c 662e 6461 7461 6261 7365 466f   self.databaseFo
-00007930: 7254 6573 740a 0a20 2020 2020 2020 2063  rTest..        c
-00007940: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
-00007950: 6e20 3d20 7365 6c66 2e63 6f6e 6669 6773  n = self.configs
-00007960: 2e63 7265 6174 655f 6d75 6c74 695f 7061  .create_multi_pa
-00007970: 7274 6974 696f 6e5f 636f 6c6c 6563 7469  rtition_collecti
-00007980: 6f6e 5f69 665f 6e6f 745f 6578 6973 7428  on_if_not_exist(
-00007990: 7365 6c66 2e63 6c69 656e 7429 0a0a 2020  self.client)..  
-000079a0: 2020 2020 2020 636f 6e66 6c69 6374 5f64        conflict_d
-000079b0: 6566 696e 6974 696f 6e20 3d20 7b27 6964  efinition = {'id
-000079c0: 273a 2027 6e65 7720 636f 6e66 6c69 6374  ': 'new conflict
-000079d0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00007780: 2020 2020 2027 706b 273a 2027 7661 6c75       'pk': 'valu
+00007790: 6527 7d0a 0a20 2020 2020 2020 2023 2053  e'}..        # S
+000077a0: 686f 756c 6420 7468 726f 7720 616e 2065  hould throw an e
+000077b0: 7272 6f72 2062 6563 6175 7365 2061 7574  rror because aut
+000077c0: 6f6d 6174 6963 2069 6420 6765 6e65 7261  omatic id genera
+000077d0: 7469 6f6e 2069 7320 6469 7361 626c 6564  tion is disabled
+000077e0: 2061 6c77 6179 732e 0a20 2020 2020 2020   always..       
+000077f0: 2073 656c 662e 5f5f 4173 7365 7274 4854   self.__AssertHT
+00007800: 5450 4661 696c 7572 6557 6974 6853 7461  TPFailureWithSta
+00007810: 7475 7328 0a20 2020 2020 2020 2020 2020  tus(.           
+00007820: 2053 7461 7475 7343 6f64 6573 2e42 4144   StatusCodes.BAD
+00007830: 5f52 4551 5545 5354 2c0a 2020 2020 2020  _REQUEST,.      
+00007840: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
+00007850: 6c6c 6563 7469 6f6e 2e63 7265 6174 655f  llection.create_
+00007860: 6974 656d 2c0a 2020 2020 2020 2020 2020  item,.          
+00007870: 2020 646f 6375 6d65 6e74 5f64 6566 696e    document_defin
+00007880: 6974 696f 6e0a 2020 2020 2020 2020 290a  ition.        ).
+00007890: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+000078a0: 5f64 622e 6465 6c65 7465 5f63 6f6e 7461  _db.delete_conta
+000078b0: 696e 6572 2863 7265 6174 6564 5f63 6f6c  iner(created_col
+000078c0: 6c65 6374 696f 6e29 0a0a 2020 2020 6465  lection)..    de
+000078d0: 6620 7465 7374 5f70 6172 7469 7469 6f6e  f test_partition
+000078e0: 6564 5f63 6f6c 6c65 6374 696f 6e5f 636f  ed_collection_co
+000078f0: 6e66 6c69 6374 5f63 7275 645f 616e 645f  nflict_crud_and_
+00007900: 7175 6572 7928 7365 6c66 293a 0a20 2020  query(self):.   
+00007910: 2020 2020 2063 7265 6174 6564 5f64 6220       created_db 
+00007920: 3d20 7365 6c66 2e64 6174 6162 6173 6546  = self.databaseF
+00007930: 6f72 5465 7374 0a0a 2020 2020 2020 2020  orTest..        
+00007940: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
+00007950: 6f6e 203d 2073 656c 662e 636f 6e66 6967  on = self.config
+00007960: 732e 6372 6561 7465 5f6d 756c 7469 5f70  s.create_multi_p
+00007970: 6172 7469 7469 6f6e 5f63 6f6c 6c65 6374  artition_collect
+00007980: 696f 6e5f 6966 5f6e 6f74 5f65 7869 7374  ion_if_not_exist
+00007990: 2873 656c 662e 636c 6965 6e74 290a 0a20  (self.client).. 
+000079a0: 2020 2020 2020 2063 6f6e 666c 6963 745f         conflict_
+000079b0: 6465 6669 6e69 7469 6f6e 203d 207b 2769  definition = {'i
+000079c0: 6427 3a20 276e 6577 2063 6f6e 666c 6963  d': 'new conflic
+000079d0: 7427 2c0a 2020 2020 2020 2020 2020 2020  t',.            
 000079e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079f0: 2020 2772 6573 6f75 7263 6549 6427 3a20    'resourceId': 
-00007a00: 2764 6f63 3127 2c0a 2020 2020 2020 2020  'doc1',.        
+000079f0: 2020 2027 7265 736f 7572 6365 4964 273a     'resourceId':
+00007a00: 2027 646f 6331 272c 0a20 2020 2020 2020   'doc1',.       
 00007a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a20: 2020 2020 2020 2027 6f70 6572 6174 696f         'operatio
-00007a30: 6e54 7970 6527 3a20 2763 7265 6174 6527  nType': 'create'
-00007a40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007a20: 2020 2020 2020 2020 276f 7065 7261 7469          'operati
+00007a30: 6f6e 5479 7065 273a 2027 6372 6561 7465  onType': 'create
+00007a40: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
 00007a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a60: 2027 7265 736f 7572 6365 5479 7065 273a   'resourceType':
-00007a70: 2027 646f 6375 6d65 6e74 270a 2020 2020   'document'.    
+00007a60: 2020 2772 6573 6f75 7263 6554 7970 6527    'resourceType'
+00007a70: 3a20 2764 6f63 756d 656e 7427 0a20 2020  : 'document'.   
 00007a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a90: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
-00007aa0: 2020 2020 2020 2320 7265 6164 2063 6f6e        # read con
-00007ab0: 666c 6963 7420 6865 7265 2077 696c 6c20  flict here will 
-00007ac0: 7265 7475 726e 2072 6573 6f75 7263 6520  return resource 
-00007ad0: 6e6f 7420 666f 756e 6428 3430 3429 2073  not found(404) s
-00007ae0: 696e 6365 2074 6865 7265 2069 7320 6e6f  ince there is no
-00007af0: 2063 6f6e 666c 6963 7420 6865 7265 0a20   conflict here. 
-00007b00: 2020 2020 2020 2073 656c 662e 5f5f 4173         self.__As
-00007b10: 7365 7274 4854 5450 4661 696c 7572 6557  sertHTTPFailureW
-00007b20: 6974 6853 7461 7475 7328 0a20 2020 2020  ithStatus(.     
-00007b30: 2020 2020 2020 2053 7461 7475 7343 6f64         StatusCod
-00007b40: 6573 2e4e 4f54 5f46 4f55 4e44 2c0a 2020  es.NOT_FOUND,.  
-00007b50: 2020 2020 2020 2020 2020 6372 6561 7465            create
-00007b60: 645f 636f 6c6c 6563 7469 6f6e 2e67 6574  d_collection.get
-00007b70: 5f63 6f6e 666c 6963 742c 0a20 2020 2020  _conflict,.     
-00007b80: 2020 2020 2020 2063 6f6e 666c 6963 745f         conflict_
-00007b90: 6465 6669 6e69 7469 6f6e 5b27 6964 275d  definition['id']
-00007ba0: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00007bb0: 6e66 6c69 6374 5f64 6566 696e 6974 696f  nflict_definitio
-00007bc0: 6e5b 2769 6427 5d0a 2020 2020 2020 2020  n['id'].        
-00007bd0: 290a 0a20 2020 2020 2020 2023 2052 6561  )..        # Rea
-00007be0: 6420 636f 6e66 6c69 6374 2066 6565 6420  d conflict feed 
-00007bf0: 646f 6573 6e27 7420 7265 7175 6972 6573  doesn't requires
-00007c00: 2070 6172 7469 7469 6f6e 4b65 7920 746f   partitionKey to
-00007c10: 2062 6520 7370 6563 6966 6965 6420 6173   be specified as
-00007c20: 2069 7427 7320 6120 6372 6f73 7320 7061   it's a cross pa
-00007c30: 7274 6974 696f 6e20 7468 696e 670a 2020  rtition thing.  
-00007c40: 2020 2020 2020 636f 6e66 6c69 6374 6c69        conflictli
-00007c50: 7374 203d 206c 6973 7428 6372 6561 7465  st = list(create
-00007c60: 645f 636f 6c6c 6563 7469 6f6e 2e6c 6973  d_collection.lis
-00007c70: 745f 636f 6e66 6c69 6374 7328 2929 0a20  t_conflicts()). 
-00007c80: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007c90: 7274 4571 7561 6c28 302c 206c 656e 2863  rtEqual(0, len(c
-00007ca0: 6f6e 666c 6963 746c 6973 7429 290a 0a20  onflictlist)).. 
-00007cb0: 2020 2020 2020 2023 2064 656c 6574 6520         # delete 
-00007cc0: 636f 6e66 6c69 6374 2068 6572 6520 7769  conflict here wi
-00007cd0: 6c6c 2072 6574 7572 6e20 7265 736f 7572  ll return resour
-00007ce0: 6365 206e 6f74 2066 6f75 6e64 2834 3034  ce not found(404
-00007cf0: 2920 7369 6e63 6520 7468 6572 6520 6973  ) since there is
-00007d00: 206e 6f20 636f 6e66 6c69 6374 2068 6572   no conflict her
-00007d10: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
-00007d20: 5f41 7373 6572 7448 5454 5046 6169 6c75  _AssertHTTPFailu
-00007d30: 7265 5769 7468 5374 6174 7573 280a 2020  reWithStatus(.  
-00007d40: 2020 2020 2020 2020 2020 5374 6174 7573            Status
-00007d50: 436f 6465 732e 4e4f 545f 464f 554e 442c  Codes.NOT_FOUND,
-00007d60: 0a20 2020 2020 2020 2020 2020 2063 7265  .            cre
-00007d70: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
-00007d80: 6465 6c65 7465 5f63 6f6e 666c 6963 742c  delete_conflict,
-00007d90: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00007da0: 666c 6963 745f 6465 6669 6e69 7469 6f6e  flict_definition
-00007db0: 5b27 6964 275d 2c0a 2020 2020 2020 2020  ['id'],.        
-00007dc0: 2020 2020 636f 6e66 6c69 6374 5f64 6566      conflict_def
-00007dd0: 696e 6974 696f 6e5b 2769 6427 5d0a 2020  inition['id'].  
-00007de0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00007df0: 2023 2071 7565 7279 2063 6f6e 666c 6963   # query conflic
-00007e00: 7473 206f 6e20 616e 7920 7072 6f70 6572  ts on any proper
-00007e10: 7479 206f 7468 6572 2074 6861 6e20 7061  ty other than pa
-00007e20: 7274 6974 696f 6e4b 6579 2077 696c 6c20  rtitionKey will 
-00007e30: 6661 696c 2077 6974 686f 7574 2073 6574  fail without set
-00007e40: 7469 6e67 2065 6e61 626c 6543 726f 7373  ting enableCross
-00007e50: 5061 7274 6974 696f 6e51 7565 7279 206f  PartitionQuery o
-00007e60: 7220 7061 7373 696e 6720 696e 2074 6865  r passing in the
-00007e70: 2070 6172 7469 7469 6f6e 4b65 7920 7661   partitionKey va
-00007e80: 6c75 650a 2020 2020 2020 2020 7472 793a  lue.        try:
-00007e90: 0a20 2020 2020 2020 2020 2020 206c 6973  .            lis
-00007ea0: 7428 6372 6561 7465 645f 636f 6c6c 6563  t(created_collec
-00007eb0: 7469 6f6e 2e71 7565 7279 5f63 6f6e 666c  tion.query_confl
-00007ec0: 6963 7473 280a 2020 2020 2020 2020 2020  icts(.          
-00007ed0: 2020 2020 2020 2020 2020 7175 6572 793d            query=
-00007ee0: 2753 454c 4543 5420 2a20 4652 4f4d 2072  'SELECT * FROM r
-00007ef0: 6f6f 7420 7220 5748 4552 4520 722e 7265  oot r WHERE r.re
-00007f00: 736f 7572 6365 5479 7065 3d5c 2727 202b  sourceType=\'' +
-00007f10: 2063 6f6e 666c 6963 745f 6465 6669 6e69   conflict_defini
-00007f20: 7469 6f6e 2e67 6574 2820 2320 6e6f 7365  tion.get( # nose
-00007f30: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
-00007f40: 2020 2020 2020 2020 2020 2772 6573 6f75            'resou
-00007f50: 7263 6554 7970 6527 2920 2b20 275c 2727  rceType') + '\''
-00007f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007f70: 2029 290a 2020 2020 2020 2020 6578 6365   )).        exce
-00007f80: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-00007f90: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
-00007fa0: 2020 2020 2020 2020 636f 6e66 6c69 6374          conflict
-00007fb0: 6c69 7374 203d 206c 6973 7428 6372 6561  list = list(crea
-00007fc0: 7465 645f 636f 6c6c 6563 7469 6f6e 2e71  ted_collection.q
-00007fd0: 7565 7279 5f63 6f6e 666c 6963 7473 280a  uery_conflicts(.
-00007fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ff0: 7175 6572 793d 2753 454c 4543 5420 2a20  query='SELECT * 
-00008000: 4652 4f4d 2072 6f6f 7420 7220 5748 4552  FROM root r WHER
-00008010: 4520 722e 7265 736f 7572 6365 5479 7065  E r.resourceType
-00008020: 3d5c 2727 202b 2063 6f6e 666c 6963 745f  =\'' + conflict_
-00008030: 6465 6669 6e69 7469 6f6e 2e67 6574 2827  definition.get('
-00008040: 7265 736f 7572 6365 5479 7065 2729 202b  resourceType') +
-00008050: 2027 5c27 272c 2020 2320 6e6f 7365 630a   '\'',  # nosec.
-00008060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008070: 656e 6162 6c65 5f63 726f 7373 5f70 6172  enable_cross_par
-00008080: 7469 7469 6f6e 5f71 7565 7279 3d54 7275  tition_query=Tru
-00008090: 650a 2020 2020 2020 2020 2929 0a0a 2020  e.        ))..  
-000080a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000080b0: 7445 7175 616c 2830 2c20 6c65 6e28 636f  tEqual(0, len(co
-000080c0: 6e66 6c69 6374 6c69 7374 2929 0a0a 2020  nflictlist))..  
-000080d0: 2020 2020 2020 2320 7175 6572 7920 636f        # query co
-000080e0: 6e66 6c69 6374 7320 6279 2070 726f 7669  nflicts by provi
-000080f0: 6469 6e67 2074 6865 2070 6172 7469 7469  ding the partiti
-00008100: 6f6e 4b65 7920 7661 6c75 650a 2020 2020  onKey value.    
-00008110: 2020 2020 6f70 7469 6f6e 7320 3d20 7b27      options = {'
-00008120: 7061 7274 6974 696f 6e4b 6579 273a 2063  partitionKey': c
-00008130: 6f6e 666c 6963 745f 6465 6669 6e69 7469  onflict_definiti
-00008140: 6f6e 2e67 6574 2827 6964 2729 7d0a 2020  on.get('id')}.  
-00008150: 2020 2020 2020 636f 6e66 6c69 6374 6c69        conflictli
-00008160: 7374 203d 206c 6973 7428 6372 6561 7465  st = list(create
-00008170: 645f 636f 6c6c 6563 7469 6f6e 2e71 7565  d_collection.que
-00008180: 7279 5f63 6f6e 666c 6963 7473 280a 2020  ry_conflicts(.  
-00008190: 2020 2020 2020 2020 2020 7175 6572 793d            query=
-000081a0: 2753 454c 4543 5420 2a20 4652 4f4d 2072  'SELECT * FROM r
-000081b0: 6f6f 7420 7220 5748 4552 4520 722e 7265  oot r WHERE r.re
-000081c0: 736f 7572 6365 5479 7065 3d5c 2727 202b  sourceType=\'' +
-000081d0: 2063 6f6e 666c 6963 745f 6465 6669 6e69   conflict_defini
-000081e0: 7469 6f6e 2e67 6574 2827 7265 736f 7572  tion.get('resour
-000081f0: 6365 5479 7065 2729 202b 2027 5c27 272c  ceType') + '\'',
-00008200: 2020 2320 6e6f 7365 630a 2020 2020 2020    # nosec.      
-00008210: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
-00008220: 6b65 793d 636f 6e66 6c69 6374 5f64 6566  key=conflict_def
-00008230: 696e 6974 696f 6e5b 2769 6427 5d0a 2020  inition['id'].  
-00008240: 2020 2020 2020 2929 0a0a 2020 2020 2020        ))..      
-00008250: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00008260: 616c 2830 2c20 6c65 6e28 636f 6e66 6c69  al(0, len(confli
-00008270: 6374 6c69 7374 2929 0a0a 2020 2020 6465  ctlist))..    de
-00008280: 6620 7465 7374 5f64 6f63 756d 656e 745f  f test_document_
-00008290: 6372 7564 2873 656c 6629 3a0a 2020 2020  crud(self):.    
-000082a0: 2020 2020 2320 6372 6561 7465 2064 6174      # create dat
-000082b0: 6162 6173 650a 2020 2020 2020 2020 6372  abase.        cr
-000082c0: 6561 7465 645f 6462 203d 2073 656c 662e  eated_db = self.
-000082d0: 6461 7461 6261 7365 466f 7254 6573 740a  databaseForTest.
-000082e0: 2020 2020 2020 2020 2320 6372 6561 7465          # create
-000082f0: 2063 6f6c 6c65 6374 696f 6e0a 2020 2020   collection.    
-00008300: 2020 2020 6372 6561 7465 645f 636f 6c6c      created_coll
-00008310: 6563 7469 6f6e 203d 2073 656c 662e 636f  ection = self.co
-00008320: 6e66 6967 732e 6372 6561 7465 5f6d 756c  nfigs.create_mul
-00008330: 7469 5f70 6172 7469 7469 6f6e 5f63 6f6c  ti_partition_col
-00008340: 6c65 6374 696f 6e5f 6966 5f6e 6f74 5f65  lection_if_not_e
-00008350: 7869 7374 2873 656c 662e 636c 6965 6e74  xist(self.client
-00008360: 290a 2020 2020 2020 2020 2320 7265 6164  ).        # read
-00008370: 2064 6f63 756d 656e 7473 0a20 2020 2020   documents.     
-00008380: 2020 2064 6f63 756d 656e 7473 203d 206c     documents = l
-00008390: 6973 7428 6372 6561 7465 645f 636f 6c6c  ist(created_coll
-000083a0: 6563 7469 6f6e 2e72 6561 645f 616c 6c5f  ection.read_all_
-000083b0: 6974 656d 7328 2929 0a20 2020 2020 2020  items()).       
-000083c0: 2023 2063 7265 6174 6520 6120 646f 6375   # create a docu
-000083d0: 6d65 6e74 0a20 2020 2020 2020 2062 6566  ment.        bef
-000083e0: 6f72 655f 6372 6561 7465 5f64 6f63 756d  ore_create_docum
-000083f0: 656e 7473 5f63 6f75 6e74 203d 206c 656e  ents_count = len
-00008400: 2864 6f63 756d 656e 7473 290a 0a20 2020  (documents)..   
-00008410: 2020 2020 2023 2063 7265 6174 6520 6120       # create a 
-00008420: 646f 6375 6d65 6e74 2077 6974 6820 6175  document with au
-00008430: 746f 2049 4420 6765 6e65 7261 7469 6f6e  to ID generation
-00008440: 0a20 2020 2020 2020 2064 6f63 756d 656e  .        documen
-00008450: 745f 6465 6669 6e69 7469 6f6e 203d 207b  t_definition = {
-00008460: 276e 616d 6527 3a20 2773 616d 706c 6520  'name': 'sample 
-00008470: 646f 6375 6d65 6e74 272c 0a20 2020 2020  document',.     
+00007a90: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
+00007aa0: 2020 2020 2020 2023 2072 6561 6420 636f         # read co
+00007ab0: 6e66 6c69 6374 2068 6572 6520 7769 6c6c  nflict here will
+00007ac0: 2072 6574 7572 6e20 7265 736f 7572 6365   return resource
+00007ad0: 206e 6f74 2066 6f75 6e64 2834 3034 2920   not found(404) 
+00007ae0: 7369 6e63 6520 7468 6572 6520 6973 206e  since there is n
+00007af0: 6f20 636f 6e66 6c69 6374 2068 6572 650a  o conflict here.
+00007b00: 2020 2020 2020 2020 7365 6c66 2e5f 5f41          self.__A
+00007b10: 7373 6572 7448 5454 5046 6169 6c75 7265  ssertHTTPFailure
+00007b20: 5769 7468 5374 6174 7573 280a 2020 2020  WithStatus(.    
+00007b30: 2020 2020 2020 2020 5374 6174 7573 436f          StatusCo
+00007b40: 6465 732e 4e4f 545f 464f 554e 442c 0a20  des.NOT_FOUND,. 
+00007b50: 2020 2020 2020 2020 2020 2063 7265 6174             creat
+00007b60: 6564 5f63 6f6c 6c65 6374 696f 6e2e 6765  ed_collection.ge
+00007b70: 745f 636f 6e66 6c69 6374 2c0a 2020 2020  t_conflict,.    
+00007b80: 2020 2020 2020 2020 636f 6e66 6c69 6374          conflict
+00007b90: 5f64 6566 696e 6974 696f 6e5b 2769 6427  _definition['id'
+00007ba0: 5d2c 0a20 2020 2020 2020 2020 2020 2063  ],.            c
+00007bb0: 6f6e 666c 6963 745f 6465 6669 6e69 7469  onflict_definiti
+00007bc0: 6f6e 5b27 6964 275d 0a20 2020 2020 2020  on['id'].       
+00007bd0: 2029 0a0a 2020 2020 2020 2020 2320 5265   )..        # Re
+00007be0: 6164 2063 6f6e 666c 6963 7420 6665 6564  ad conflict feed
+00007bf0: 2064 6f65 736e 2774 2072 6571 7569 7265   doesn't require
+00007c00: 7320 7061 7274 6974 696f 6e4b 6579 2074  s partitionKey t
+00007c10: 6f20 6265 2073 7065 6369 6669 6564 2061  o be specified a
+00007c20: 7320 6974 2773 2061 2063 726f 7373 2070  s it's a cross p
+00007c30: 6172 7469 7469 6f6e 2074 6869 6e67 0a20  artition thing. 
+00007c40: 2020 2020 2020 2063 6f6e 666c 6963 746c         conflictl
+00007c50: 6973 7420 3d20 6c69 7374 2863 7265 6174  ist = list(creat
+00007c60: 6564 5f63 6f6c 6c65 6374 696f 6e2e 6c69  ed_collection.li
+00007c70: 7374 5f63 6f6e 666c 6963 7473 2829 290a  st_conflicts()).
+00007c80: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00007c90: 6572 7445 7175 616c 2830 2c20 6c65 6e28  ertEqual(0, len(
+00007ca0: 636f 6e66 6c69 6374 6c69 7374 2929 0a0a  conflictlist))..
+00007cb0: 2020 2020 2020 2020 2320 6465 6c65 7465          # delete
+00007cc0: 2063 6f6e 666c 6963 7420 6865 7265 2077   conflict here w
+00007cd0: 696c 6c20 7265 7475 726e 2072 6573 6f75  ill return resou
+00007ce0: 7263 6520 6e6f 7420 666f 756e 6428 3430  rce not found(40
+00007cf0: 3429 2073 696e 6365 2074 6865 7265 2069  4) since there i
+00007d00: 7320 6e6f 2063 6f6e 666c 6963 7420 6865  s no conflict he
+00007d10: 7265 0a20 2020 2020 2020 2073 656c 662e  re.        self.
+00007d20: 5f5f 4173 7365 7274 4854 5450 4661 696c  __AssertHTTPFail
+00007d30: 7572 6557 6974 6853 7461 7475 7328 0a20  ureWithStatus(. 
+00007d40: 2020 2020 2020 2020 2020 2053 7461 7475             Statu
+00007d50: 7343 6f64 6573 2e4e 4f54 5f46 4f55 4e44  sCodes.NOT_FOUND
+00007d60: 2c0a 2020 2020 2020 2020 2020 2020 6372  ,.            cr
+00007d70: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+00007d80: 2e64 656c 6574 655f 636f 6e66 6c69 6374  .delete_conflict
+00007d90: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+00007da0: 6e66 6c69 6374 5f64 6566 696e 6974 696f  nflict_definitio
+00007db0: 6e5b 2769 6427 5d2c 0a20 2020 2020 2020  n['id'],.       
+00007dc0: 2020 2020 2063 6f6e 666c 6963 745f 6465       conflict_de
+00007dd0: 6669 6e69 7469 6f6e 5b27 6964 275d 0a20  finition['id']. 
+00007de0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00007df0: 2020 2320 7175 6572 7920 636f 6e66 6c69    # query confli
+00007e00: 6374 7320 6f6e 2061 6e79 2070 726f 7065  cts on any prope
+00007e10: 7274 7920 6f74 6865 7220 7468 616e 2070  rty other than p
+00007e20: 6172 7469 7469 6f6e 4b65 7920 7769 6c6c  artitionKey will
+00007e30: 2066 6169 6c20 7769 7468 6f75 7420 7365   fail without se
+00007e40: 7474 696e 6720 656e 6162 6c65 4372 6f73  tting enableCros
+00007e50: 7350 6172 7469 7469 6f6e 5175 6572 7920  sPartitionQuery 
+00007e60: 6f72 2070 6173 7369 6e67 2069 6e20 7468  or passing in th
+00007e70: 6520 7061 7274 6974 696f 6e4b 6579 2076  e partitionKey v
+00007e80: 616c 7565 0a20 2020 2020 2020 2074 7279  alue.        try
+00007e90: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
+00007ea0: 7374 2863 7265 6174 6564 5f63 6f6c 6c65  st(created_colle
+00007eb0: 6374 696f 6e2e 7175 6572 795f 636f 6e66  ction.query_conf
+00007ec0: 6c69 6374 7328 0a20 2020 2020 2020 2020  licts(.         
+00007ed0: 2020 2020 2020 2020 2020 2071 7565 7279             query
+00007ee0: 3d27 5345 4c45 4354 202a 2046 524f 4d20  ='SELECT * FROM 
+00007ef0: 726f 6f74 2072 2057 4845 5245 2072 2e72  root r WHERE r.r
+00007f00: 6573 6f75 7263 6554 7970 653d 5c27 2720  esourceType=\'' 
+00007f10: 2b20 636f 6e66 6c69 6374 5f64 6566 696e  + conflict_defin
+00007f20: 6974 696f 6e2e 6765 7428 2023 206e 6f73  ition.get( # nos
+00007f30: 6563 0a20 2020 2020 2020 2020 2020 2020  ec.             
+00007f40: 2020 2020 2020 2020 2020 2027 7265 736f             'reso
+00007f50: 7572 6365 5479 7065 2729 202b 2027 5c27  urceType') + '\'
+00007f60: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00007f70: 2020 2929 0a20 2020 2020 2020 2065 7863    )).        exc
+00007f80: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+00007f90: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00007fa0: 0a20 2020 2020 2020 2063 6f6e 666c 6963  .        conflic
+00007fb0: 746c 6973 7420 3d20 6c69 7374 2863 7265  tlist = list(cre
+00007fc0: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
+00007fd0: 7175 6572 795f 636f 6e66 6c69 6374 7328  query_conflicts(
+00007fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007ff0: 2071 7565 7279 3d27 5345 4c45 4354 202a   query='SELECT *
+00008000: 2046 524f 4d20 726f 6f74 2072 2057 4845   FROM root r WHE
+00008010: 5245 2072 2e72 6573 6f75 7263 6554 7970  RE r.resourceTyp
+00008020: 653d 5c27 2720 2b20 636f 6e66 6c69 6374  e=\'' + conflict
+00008030: 5f64 6566 696e 6974 696f 6e2e 6765 7428  _definition.get(
+00008040: 2772 6573 6f75 7263 6554 7970 6527 2920  'resourceType') 
+00008050: 2b20 275c 2727 2c20 2023 206e 6f73 6563  + '\'',  # nosec
+00008060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008070: 2065 6e61 626c 655f 6372 6f73 735f 7061   enable_cross_pa
+00008080: 7274 6974 696f 6e5f 7175 6572 793d 5472  rtition_query=Tr
+00008090: 7565 0a20 2020 2020 2020 2029 290a 0a20  ue.        )).. 
+000080a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000080b0: 7274 4571 7561 6c28 302c 206c 656e 2863  rtEqual(0, len(c
+000080c0: 6f6e 666c 6963 746c 6973 7429 290a 0a20  onflictlist)).. 
+000080d0: 2020 2020 2020 2023 2071 7565 7279 2063         # query c
+000080e0: 6f6e 666c 6963 7473 2062 7920 7072 6f76  onflicts by prov
+000080f0: 6964 696e 6720 7468 6520 7061 7274 6974  iding the partit
+00008100: 696f 6e4b 6579 2076 616c 7565 0a20 2020  ionKey value.   
+00008110: 2020 2020 206f 7074 696f 6e73 203d 207b       options = {
+00008120: 2770 6172 7469 7469 6f6e 4b65 7927 3a20  'partitionKey': 
+00008130: 636f 6e66 6c69 6374 5f64 6566 696e 6974  conflict_definit
+00008140: 696f 6e2e 6765 7428 2769 6427 297d 0a20  ion.get('id')}. 
+00008150: 2020 2020 2020 2063 6f6e 666c 6963 746c         conflictl
+00008160: 6973 7420 3d20 6c69 7374 2863 7265 6174  ist = list(creat
+00008170: 6564 5f63 6f6c 6c65 6374 696f 6e2e 7175  ed_collection.qu
+00008180: 6572 795f 636f 6e66 6c69 6374 7328 0a20  ery_conflicts(. 
+00008190: 2020 2020 2020 2020 2020 2071 7565 7279             query
+000081a0: 3d27 5345 4c45 4354 202a 2046 524f 4d20  ='SELECT * FROM 
+000081b0: 726f 6f74 2072 2057 4845 5245 2072 2e72  root r WHERE r.r
+000081c0: 6573 6f75 7263 6554 7970 653d 5c27 2720  esourceType=\'' 
+000081d0: 2b20 636f 6e66 6c69 6374 5f64 6566 696e  + conflict_defin
+000081e0: 6974 696f 6e2e 6765 7428 2772 6573 6f75  ition.get('resou
+000081f0: 7263 6554 7970 6527 2920 2b20 275c 2727  rceType') + '\''
+00008200: 2c20 2023 206e 6f73 6563 0a20 2020 2020  ,  # nosec.     
+00008210: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
+00008220: 5f6b 6579 3d63 6f6e 666c 6963 745f 6465  _key=conflict_de
+00008230: 6669 6e69 7469 6f6e 5b27 6964 275d 0a20  finition['id']. 
+00008240: 2020 2020 2020 2029 290a 0a20 2020 2020         ))..     
+00008250: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00008260: 7561 6c28 302c 206c 656e 2863 6f6e 666c  ual(0, len(confl
+00008270: 6963 746c 6973 7429 290a 0a20 2020 2064  ictlist))..    d
+00008280: 6566 2074 6573 745f 646f 6375 6d65 6e74  ef test_document
+00008290: 5f63 7275 6428 7365 6c66 293a 0a20 2020  _crud(self):.   
+000082a0: 2020 2020 2023 2063 7265 6174 6520 6461       # create da
+000082b0: 7461 6261 7365 0a20 2020 2020 2020 2063  tabase.        c
+000082c0: 7265 6174 6564 5f64 6220 3d20 7365 6c66  reated_db = self
+000082d0: 2e64 6174 6162 6173 6546 6f72 5465 7374  .databaseForTest
+000082e0: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
+000082f0: 6520 636f 6c6c 6563 7469 6f6e 0a20 2020  e collection.   
+00008300: 2020 2020 2063 7265 6174 6564 5f63 6f6c       created_col
+00008310: 6c65 6374 696f 6e20 3d20 7365 6c66 2e63  lection = self.c
+00008320: 6f6e 6669 6773 2e63 7265 6174 655f 6d75  onfigs.create_mu
+00008330: 6c74 695f 7061 7274 6974 696f 6e5f 636f  lti_partition_co
+00008340: 6c6c 6563 7469 6f6e 5f69 665f 6e6f 745f  llection_if_not_
+00008350: 6578 6973 7428 7365 6c66 2e63 6c69 656e  exist(self.clien
+00008360: 7429 0a20 2020 2020 2020 2023 2072 6561  t).        # rea
+00008370: 6420 646f 6375 6d65 6e74 730a 2020 2020  d documents.    
+00008380: 2020 2020 646f 6375 6d65 6e74 7320 3d20      documents = 
+00008390: 6c69 7374 2863 7265 6174 6564 5f63 6f6c  list(created_col
+000083a0: 6c65 6374 696f 6e2e 7265 6164 5f61 6c6c  lection.read_all
+000083b0: 5f69 7465 6d73 2829 290a 2020 2020 2020  _items()).      
+000083c0: 2020 2320 6372 6561 7465 2061 2064 6f63    # create a doc
+000083d0: 756d 656e 740a 2020 2020 2020 2020 6265  ument.        be
+000083e0: 666f 7265 5f63 7265 6174 655f 646f 6375  fore_create_docu
+000083f0: 6d65 6e74 735f 636f 756e 7420 3d20 6c65  ments_count = le
+00008400: 6e28 646f 6375 6d65 6e74 7329 0a0a 2020  n(documents)..  
+00008410: 2020 2020 2020 2320 6372 6561 7465 2061        # create a
+00008420: 2064 6f63 756d 656e 7420 7769 7468 2061   document with a
+00008430: 7574 6f20 4944 2067 656e 6572 6174 696f  uto ID generatio
+00008440: 6e0a 2020 2020 2020 2020 646f 6375 6d65  n.        docume
+00008450: 6e74 5f64 6566 696e 6974 696f 6e20 3d20  nt_definition = 
+00008460: 7b27 6e61 6d65 273a 2027 7361 6d70 6c65  {'name': 'sample
+00008470: 2064 6f63 756d 656e 7427 2c0a 2020 2020   document',.    
 00008480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008490: 2020 2020 2020 2020 2020 2773 7061 6d27            'spam'
-000084a0: 3a20 2765 6767 7327 2c0a 2020 2020 2020  : 'eggs',.      
+00008490: 2020 2020 2020 2020 2020 2027 7370 616d             'spam
+000084a0: 273a 2027 6567 6773 272c 0a20 2020 2020  ': 'eggs',.     
 000084b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000084c0: 2020 2020 2020 2020 2027 6b65 7927 3a20           'key': 
-000084d0: 2776 616c 7565 277d 0a0a 2020 2020 2020  'value'}..      
-000084e0: 2020 6372 6561 7465 645f 646f 6375 6d65    created_docume
-000084f0: 6e74 203d 2063 7265 6174 6564 5f63 6f6c  nt = created_col
-00008500: 6c65 6374 696f 6e2e 6372 6561 7465 5f69  lection.create_i
-00008510: 7465 6d28 626f 6479 3d64 6f63 756d 656e  tem(body=documen
-00008520: 745f 6465 6669 6e69 7469 6f6e 2c20 656e  t_definition, en
-00008530: 6162 6c65 5f61 7574 6f6d 6174 6963 5f69  able_automatic_i
-00008540: 645f 6765 6e65 7261 7469 6f6e 3d54 7275  d_generation=Tru
-00008550: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-00008560: 6173 7365 7274 4571 7561 6c28 6372 6561  assertEqual(crea
-00008570: 7465 645f 646f 6375 6d65 6e74 2e67 6574  ted_document.get
-00008580: 2827 6e61 6d65 2729 2c0a 2020 2020 2020  ('name'),.      
+000084c0: 2020 2020 2020 2020 2020 276b 6579 273a            'key':
+000084d0: 2027 7661 6c75 6527 7d0a 0a20 2020 2020   'value'}..     
+000084e0: 2020 2063 7265 6174 6564 5f64 6f63 756d     created_docum
+000084f0: 656e 7420 3d20 6372 6561 7465 645f 636f  ent = created_co
+00008500: 6c6c 6563 7469 6f6e 2e63 7265 6174 655f  llection.create_
+00008510: 6974 656d 2862 6f64 793d 646f 6375 6d65  item(body=docume
+00008520: 6e74 5f64 6566 696e 6974 696f 6e2c 2065  nt_definition, e
+00008530: 6e61 626c 655f 6175 746f 6d61 7469 635f  nable_automatic_
+00008540: 6964 5f67 656e 6572 6174 696f 6e3d 5472  id_generation=Tr
+00008550: 7565 290a 2020 2020 2020 2020 7365 6c66  ue).        self
+00008560: 2e61 7373 6572 7445 7175 616c 2863 7265  .assertEqual(cre
+00008570: 6174 6564 5f64 6f63 756d 656e 742e 6765  ated_document.ge
+00008580: 7428 276e 616d 6527 292c 0a20 2020 2020  t('name'),.     
 00008590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085a0: 2020 2064 6f63 756d 656e 745f 6465 6669     document_defi
-000085b0: 6e69 7469 6f6e 5b27 6e61 6d65 275d 290a  nition['name']).
-000085c0: 0a20 2020 2020 2020 2064 6f63 756d 656e  .        documen
-000085d0: 745f 6465 6669 6e69 7469 6f6e 203d 207b  t_definition = {
-000085e0: 276e 616d 6527 3a20 2773 616d 706c 6520  'name': 'sample 
-000085f0: 646f 6375 6d65 6e74 272c 0a20 2020 2020  document',.     
+000085a0: 2020 2020 646f 6375 6d65 6e74 5f64 6566      document_def
+000085b0: 696e 6974 696f 6e5b 276e 616d 6527 5d29  inition['name'])
+000085c0: 0a0a 2020 2020 2020 2020 646f 6375 6d65  ..        docume
+000085d0: 6e74 5f64 6566 696e 6974 696f 6e20 3d20  nt_definition = 
+000085e0: 7b27 6e61 6d65 273a 2027 7361 6d70 6c65  {'name': 'sample
+000085f0: 2064 6f63 756d 656e 7427 2c0a 2020 2020   document',.    
 00008600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008610: 2020 2020 2020 2020 2020 2773 7061 6d27            'spam'
-00008620: 3a20 2765 6767 7327 2c0a 2020 2020 2020  : 'eggs',.      
+00008610: 2020 2020 2020 2020 2020 2027 7370 616d             'spam
+00008620: 273a 2027 6567 6773 272c 0a20 2020 2020  ': 'eggs',.     
 00008630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008640: 2020 2020 2020 2020 2027 6b65 7927 3a20           'key': 
-00008650: 2776 616c 7565 272c 0a20 2020 2020 2020  'value',.       
+00008640: 2020 2020 2020 2020 2020 276b 6579 273a            'key':
+00008650: 2027 7661 6c75 6527 2c0a 2020 2020 2020   'value',.      
 00008660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008670: 2020 2020 2020 2020 2769 6427 3a20 7374          'id': st
-00008680: 7228 7575 6964 2e75 7569 6434 2829 297d  r(uuid.uuid4())}
-00008690: 0a0a 2020 2020 2020 2020 6372 6561 7465  ..        create
-000086a0: 645f 646f 6375 6d65 6e74 203d 2063 7265  d_document = cre
-000086b0: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
-000086c0: 6372 6561 7465 5f69 7465 6d28 626f 6479  create_item(body
-000086d0: 3d64 6f63 756d 656e 745f 6465 6669 6e69  =document_defini
-000086e0: 7469 6f6e 290a 2020 2020 2020 2020 7365  tion).        se
-000086f0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-00008700: 7265 6174 6564 5f64 6f63 756d 656e 742e  reated_document.
-00008710: 6765 7428 276e 616d 6527 292c 0a20 2020  get('name'),.   
+00008670: 2020 2020 2020 2020 2027 6964 273a 2073           'id': s
+00008680: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
+00008690: 7d0a 0a20 2020 2020 2020 2063 7265 6174  }..        creat
+000086a0: 6564 5f64 6f63 756d 656e 7420 3d20 6372  ed_document = cr
+000086b0: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+000086c0: 2e63 7265 6174 655f 6974 656d 2862 6f64  .create_item(bod
+000086d0: 793d 646f 6375 6d65 6e74 5f64 6566 696e  y=document_defin
+000086e0: 6974 696f 6e29 0a20 2020 2020 2020 2073  ition).        s
+000086f0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00008700: 6372 6561 7465 645f 646f 6375 6d65 6e74  created_document
+00008710: 2e67 6574 2827 6e61 6d65 2729 2c0a 2020  .get('name'),.  
 00008720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008730: 2020 2020 2020 646f 6375 6d65 6e74 5f64        document_d
-00008740: 6566 696e 6974 696f 6e5b 276e 616d 6527  efinition['name'
-00008750: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-00008760: 6173 7365 7274 4571 7561 6c28 6372 6561  assertEqual(crea
-00008770: 7465 645f 646f 6375 6d65 6e74 2e67 6574  ted_document.get
-00008780: 2827 6964 2729 2c0a 2020 2020 2020 2020  ('id'),.        
+00008730: 2020 2020 2020 2064 6f63 756d 656e 745f         document_
+00008740: 6465 6669 6e69 7469 6f6e 5b27 6e61 6d65  definition['name
+00008750: 275d 290a 2020 2020 2020 2020 7365 6c66  ']).        self
+00008760: 2e61 7373 6572 7445 7175 616c 2863 7265  .assertEqual(cre
+00008770: 6174 6564 5f64 6f63 756d 656e 742e 6765  ated_document.ge
+00008780: 7428 2769 6427 292c 0a20 2020 2020 2020  t('id'),.       
 00008790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000087a0: 2064 6f63 756d 656e 745f 6465 6669 6e69   document_defini
-000087b0: 7469 6f6e 5b27 6964 275d 290a 0a20 2020  tion['id'])..   
-000087c0: 2020 2020 2023 2064 7570 6c69 6361 7465       # duplicate
-000087d0: 6420 646f 6375 6d65 6e74 7320 6172 6520  d documents are 
-000087e0: 6e6f 7420 616c 6c6f 7765 6420 7768 656e  not allowed when
-000087f0: 2027 6964 2720 6973 2070 726f 7669 6465   'id' is provide
-00008800: 642e 0a20 2020 2020 2020 2064 7570 6c69  d..        dupli
-00008810: 6361 7465 645f 6465 6669 6e69 7469 6f6e  cated_definition
-00008820: 5f77 6974 685f 6964 203d 2064 6f63 756d  _with_id = docum
-00008830: 656e 745f 6465 6669 6e69 7469 6f6e 2e63  ent_definition.c
-00008840: 6f70 7928 290a 2020 2020 2020 2020 7365  opy().        se
-00008850: 6c66 2e5f 5f41 7373 6572 7448 5454 5046  lf.__AssertHTTPF
-00008860: 6169 6c75 7265 5769 7468 5374 6174 7573  ailureWithStatus
-00008870: 2853 7461 7475 7343 6f64 6573 2e43 4f4e  (StatusCodes.CON
-00008880: 464c 4943 542c 0a20 2020 2020 2020 2020  FLICT,.         
+000087a0: 2020 646f 6375 6d65 6e74 5f64 6566 696e    document_defin
+000087b0: 6974 696f 6e5b 2769 6427 5d29 0a0a 2020  ition['id'])..  
+000087c0: 2020 2020 2020 2320 6475 706c 6963 6174        # duplicat
+000087d0: 6564 2064 6f63 756d 656e 7473 2061 7265  ed documents are
+000087e0: 206e 6f74 2061 6c6c 6f77 6564 2077 6865   not allowed whe
+000087f0: 6e20 2769 6427 2069 7320 7072 6f76 6964  n 'id' is provid
+00008800: 6564 2e0a 2020 2020 2020 2020 6475 706c  ed..        dupl
+00008810: 6963 6174 6564 5f64 6566 696e 6974 696f  icated_definitio
+00008820: 6e5f 7769 7468 5f69 6420 3d20 646f 6375  n_with_id = docu
+00008830: 6d65 6e74 5f64 6566 696e 6974 696f 6e2e  ment_definition.
+00008840: 636f 7079 2829 0a20 2020 2020 2020 2073  copy().        s
+00008850: 656c 662e 5f5f 4173 7365 7274 4854 5450  elf.__AssertHTTP
+00008860: 4661 696c 7572 6557 6974 6853 7461 7475  FailureWithStatu
+00008870: 7328 5374 6174 7573 436f 6465 732e 434f  s(StatusCodes.CO
+00008880: 4e46 4c49 4354 2c0a 2020 2020 2020 2020  NFLICT,.        
 00008890: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000088a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000088b0: 2020 6372 6561 7465 645f 636f 6c6c 6563    created_collec
-000088c0: 7469 6f6e 2e63 7265 6174 655f 6974 656d  tion.create_item
-000088d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000088b0: 2020 2063 7265 6174 6564 5f63 6f6c 6c65     created_colle
+000088c0: 6374 696f 6e2e 6372 6561 7465 5f69 7465  ction.create_ite
+000088d0: 6d2c 0a20 2020 2020 2020 2020 2020 2020  m,.             
 000088e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000088f0: 2020 2020 2020 2020 2020 2020 2064 7570               dup
-00008900: 6c69 6361 7465 645f 6465 6669 6e69 7469  licated_definiti
-00008910: 6f6e 5f77 6974 685f 6964 290a 2020 2020  on_with_id).    
-00008920: 2020 2020 2320 7265 6164 2064 6f63 756d      # read docum
-00008930: 656e 7473 2061 6674 6572 2063 7265 6174  ents after creat
-00008940: 696f 6e0a 2020 2020 2020 2020 646f 6375  ion.        docu
-00008950: 6d65 6e74 7320 3d20 6c69 7374 2863 7265  ments = list(cre
-00008960: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
-00008970: 7265 6164 5f61 6c6c 5f69 7465 6d73 2829  read_all_items()
-00008980: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00008990: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-000089a0: 2020 2020 2020 2020 6c65 6e28 646f 6375          len(docu
-000089b0: 6d65 6e74 7329 2c0a 2020 2020 2020 2020  ments),.        
-000089c0: 2020 2020 6265 666f 7265 5f63 7265 6174      before_creat
-000089d0: 655f 646f 6375 6d65 6e74 735f 636f 756e  e_documents_coun
-000089e0: 7420 2b20 322c 0a20 2020 2020 2020 2020  t + 2,.         
-000089f0: 2020 2027 6372 6561 7465 2073 686f 756c     'create shoul
-00008a00: 6420 696e 6372 6561 7365 2074 6865 206e  d increase the n
-00008a10: 756d 6265 7220 6f66 2064 6f63 756d 656e  umber of documen
-00008a20: 7473 2729 0a20 2020 2020 2020 2023 2071  ts').        # q
-00008a30: 7565 7279 2064 6f63 756d 656e 7473 0a20  uery documents. 
-00008a40: 2020 2020 2020 2064 6f63 756d 656e 7473         documents
-00008a50: 203d 206c 6973 7428 6372 6561 7465 645f   = list(created_
-00008a60: 636f 6c6c 6563 7469 6f6e 2e71 7565 7279  collection.query
-00008a70: 5f69 7465 6d73 280a 2020 2020 2020 2020  _items(.        
-00008a80: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
-00008a90: 2020 2020 2020 2771 7565 7279 273a 2027        'query': '
-00008aa0: 5345 4c45 4354 202a 2046 524f 4d20 726f  SELECT * FROM ro
-00008ab0: 6f74 2072 2057 4845 5245 2072 2e6e 616d  ot r WHERE r.nam
-00008ac0: 653d 406e 616d 6527 2c0a 2020 2020 2020  e=@name',.      
-00008ad0: 2020 2020 2020 2020 2020 2770 6172 616d            'param
-00008ae0: 6574 6572 7327 3a20 5b0a 2020 2020 2020  eters': [.      
-00008af0: 2020 2020 2020 2020 2020 2020 2020 7b27                {'
-00008b00: 6e61 6d65 273a 2027 406e 616d 6527 2c20  name': '@name', 
-00008b10: 2776 616c 7565 273a 2064 6f63 756d 656e  'value': documen
-00008b20: 745f 6465 6669 6e69 7469 6f6e 5b27 6e61  t_definition['na
-00008b30: 6d65 275d 7d0a 2020 2020 2020 2020 2020  me']}.          
-00008b40: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00008b50: 2020 2020 7d2c 2065 6e61 626c 655f 6372      }, enable_cr
-00008b60: 6f73 735f 7061 7274 6974 696f 6e5f 7175  oss_partition_qu
-00008b70: 6572 793d 5472 7565 0a20 2020 2020 2020  ery=True.       
-00008b80: 2029 290a 2020 2020 2020 2020 7365 6c66   )).        self
-00008b90: 2e61 7373 6572 7454 7275 6528 646f 6375  .assertTrue(docu
-00008ba0: 6d65 6e74 7329 0a20 2020 2020 2020 2064  ments).        d
-00008bb0: 6f63 756d 656e 7473 203d 206c 6973 7428  ocuments = list(
-00008bc0: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
-00008bd0: 6f6e 2e71 7565 7279 5f69 7465 6d73 280a  on.query_items(.
-00008be0: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
-00008bf0: 2020 2020 2020 2020 2020 2020 2020 2771                'q
-00008c00: 7565 7279 273a 2027 5345 4c45 4354 202a  uery': 'SELECT *
-00008c10: 2046 524f 4d20 726f 6f74 2072 2057 4845   FROM root r WHE
-00008c20: 5245 2072 2e6e 616d 653d 406e 616d 6527  RE r.name=@name'
-00008c30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00008c40: 2020 2770 6172 616d 6574 6572 7327 3a20    'parameters': 
-00008c50: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00008c60: 2020 2020 2020 7b27 6e61 6d65 273a 2027        {'name': '
-00008c70: 406e 616d 6527 2c20 2776 616c 7565 273a  @name', 'value':
-00008c80: 2064 6f63 756d 656e 745f 6465 6669 6e69   document_defini
-00008c90: 7469 6f6e 5b27 6e61 6d65 275d 7d0a 2020  tion['name']}.  
-00008ca0: 2020 2020 2020 2020 2020 2020 2020 5d2c                ],
-00008cb0: 0a20 2020 2020 2020 2020 2020 207d 2c20  .            }, 
-00008cc0: 656e 6162 6c65 5f63 726f 7373 5f70 6172  enable_cross_par
-00008cd0: 7469 7469 6f6e 5f71 7565 7279 3d54 7275  tition_query=Tru
-00008ce0: 652c 0a20 2020 2020 2020 2020 2020 2065  e,.            e
-00008cf0: 6e61 626c 655f 7363 616e 5f69 6e5f 7175  nable_scan_in_qu
-00008d00: 6572 793d 5472 7565 0a20 2020 2020 2020  ery=True.       
-00008d10: 2029 290a 2020 2020 2020 2020 7365 6c66   )).        self
-00008d20: 2e61 7373 6572 7454 7275 6528 646f 6375  .assertTrue(docu
-00008d30: 6d65 6e74 7329 0a20 2020 2020 2020 2023  ments).        #
-00008d40: 2072 6570 6c61 6365 2064 6f63 756d 656e   replace documen
-00008d50: 742e 0a20 2020 2020 2020 2063 7265 6174  t..        creat
-00008d60: 6564 5f64 6f63 756d 656e 745b 276e 616d  ed_document['nam
-00008d70: 6527 5d20 3d20 2772 6570 6c61 6365 6420  e'] = 'replaced 
-00008d80: 646f 6375 6d65 6e74 270a 2020 2020 2020  document'.      
-00008d90: 2020 6372 6561 7465 645f 646f 6375 6d65    created_docume
-00008da0: 6e74 5b27 7370 616d 275d 203d 2027 6e6f  nt['spam'] = 'no
-00008db0: 7420 6567 6773 270a 2020 2020 2020 2020  t eggs'.        
-00008dc0: 6f6c 645f 6574 6167 203d 2063 7265 6174  old_etag = creat
-00008dd0: 6564 5f64 6f63 756d 656e 745b 275f 6574  ed_document['_et
-00008de0: 6167 275d 0a20 2020 2020 2020 2072 6570  ag'].        rep
-00008df0: 6c61 6365 645f 646f 6375 6d65 6e74 203d  laced_document =
-00008e00: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-00008e10: 696f 6e2e 7265 706c 6163 655f 6974 656d  ion.replace_item
-00008e20: 280a 2020 2020 2020 2020 2020 2020 6974  (.            it
-00008e30: 656d 3d63 7265 6174 6564 5f64 6f63 756d  em=created_docum
-00008e40: 656e 745b 2769 6427 5d2c 0a20 2020 2020  ent['id'],.     
-00008e50: 2020 2020 2020 2062 6f64 793d 6372 6561         body=crea
-00008e60: 7465 645f 646f 6375 6d65 6e74 0a20 2020  ted_document.   
-00008e70: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-00008e80: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00008e90: 7265 706c 6163 6564 5f64 6f63 756d 656e  replaced_documen
-00008ea0: 745b 276e 616d 6527 5d2c 0a20 2020 2020  t['name'],.     
+000088f0: 2020 2020 2020 2020 2020 2020 2020 6475                du
+00008900: 706c 6963 6174 6564 5f64 6566 696e 6974  plicated_definit
+00008910: 696f 6e5f 7769 7468 5f69 6429 0a20 2020  ion_with_id).   
+00008920: 2020 2020 2023 2072 6561 6420 646f 6375       # read docu
+00008930: 6d65 6e74 7320 6166 7465 7220 6372 6561  ments after crea
+00008940: 7469 6f6e 0a20 2020 2020 2020 2064 6f63  tion.        doc
+00008950: 756d 656e 7473 203d 206c 6973 7428 6372  uments = list(cr
+00008960: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+00008970: 2e72 6561 645f 616c 6c5f 6974 656d 7328  .read_all_items(
+00008980: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+00008990: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+000089a0: 2020 2020 2020 2020 206c 656e 2864 6f63           len(doc
+000089b0: 756d 656e 7473 292c 0a20 2020 2020 2020  uments),.       
+000089c0: 2020 2020 2062 6566 6f72 655f 6372 6561       before_crea
+000089d0: 7465 5f64 6f63 756d 656e 7473 5f63 6f75  te_documents_cou
+000089e0: 6e74 202b 2032 2c0a 2020 2020 2020 2020  nt + 2,.        
+000089f0: 2020 2020 2763 7265 6174 6520 7368 6f75      'create shou
+00008a00: 6c64 2069 6e63 7265 6173 6520 7468 6520  ld increase the 
+00008a10: 6e75 6d62 6572 206f 6620 646f 6375 6d65  number of docume
+00008a20: 6e74 7327 290a 2020 2020 2020 2020 2320  nts').        # 
+00008a30: 7175 6572 7920 646f 6375 6d65 6e74 730a  query documents.
+00008a40: 2020 2020 2020 2020 646f 6375 6d65 6e74          document
+00008a50: 7320 3d20 6c69 7374 2863 7265 6174 6564  s = list(created
+00008a60: 5f63 6f6c 6c65 6374 696f 6e2e 7175 6572  _collection.quer
+00008a70: 795f 6974 656d 7328 0a20 2020 2020 2020  y_items(.       
+00008a80: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+00008a90: 2020 2020 2020 2027 7175 6572 7927 3a20         'query': 
+00008aa0: 2753 454c 4543 5420 2a20 4652 4f4d 2072  'SELECT * FROM r
+00008ab0: 6f6f 7420 7220 5748 4552 4520 722e 6e61  oot r WHERE r.na
+00008ac0: 6d65 3d40 6e61 6d65 272c 0a20 2020 2020  me=@name',.     
+00008ad0: 2020 2020 2020 2020 2020 2027 7061 7261             'para
+00008ae0: 6d65 7465 7273 273a 205b 0a20 2020 2020  meters': [.     
+00008af0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
+00008b00: 276e 616d 6527 3a20 2740 6e61 6d65 272c  'name': '@name',
+00008b10: 2027 7661 6c75 6527 3a20 646f 6375 6d65   'value': docume
+00008b20: 6e74 5f64 6566 696e 6974 696f 6e5b 276e  nt_definition['n
+00008b30: 616d 6527 5d7d 0a20 2020 2020 2020 2020  ame']}.         
+00008b40: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00008b50: 2020 2020 207d 2c20 656e 6162 6c65 5f63       }, enable_c
+00008b60: 726f 7373 5f70 6172 7469 7469 6f6e 5f71  ross_partition_q
+00008b70: 7565 7279 3d54 7275 650a 2020 2020 2020  uery=True.      
+00008b80: 2020 2929 0a20 2020 2020 2020 2073 656c    )).        sel
+00008b90: 662e 6173 7365 7274 5472 7565 2864 6f63  f.assertTrue(doc
+00008ba0: 756d 656e 7473 290a 2020 2020 2020 2020  uments).        
+00008bb0: 646f 6375 6d65 6e74 7320 3d20 6c69 7374  documents = list
+00008bc0: 2863 7265 6174 6564 5f63 6f6c 6c65 6374  (created_collect
+00008bd0: 696f 6e2e 7175 6572 795f 6974 656d 7328  ion.query_items(
+00008be0: 0a20 2020 2020 2020 2020 2020 207b 0a20  .            {. 
+00008bf0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00008c00: 7175 6572 7927 3a20 2753 454c 4543 5420  query': 'SELECT 
+00008c10: 2a20 4652 4f4d 2072 6f6f 7420 7220 5748  * FROM root r WH
+00008c20: 4552 4520 722e 6e61 6d65 3d40 6e61 6d65  ERE r.name=@name
+00008c30: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00008c40: 2020 2027 7061 7261 6d65 7465 7273 273a     'parameters':
+00008c50: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+00008c60: 2020 2020 2020 207b 276e 616d 6527 3a20         {'name': 
+00008c70: 2740 6e61 6d65 272c 2027 7661 6c75 6527  '@name', 'value'
+00008c80: 3a20 646f 6375 6d65 6e74 5f64 6566 696e  : document_defin
+00008c90: 6974 696f 6e5b 276e 616d 6527 5d7d 0a20  ition['name']}. 
+00008ca0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00008cb0: 2c0a 2020 2020 2020 2020 2020 2020 7d2c  ,.            },
+00008cc0: 2065 6e61 626c 655f 6372 6f73 735f 7061   enable_cross_pa
+00008cd0: 7274 6974 696f 6e5f 7175 6572 793d 5472  rtition_query=Tr
+00008ce0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00008cf0: 656e 6162 6c65 5f73 6361 6e5f 696e 5f71  enable_scan_in_q
+00008d00: 7565 7279 3d54 7275 650a 2020 2020 2020  uery=True.      
+00008d10: 2020 2929 0a20 2020 2020 2020 2073 656c    )).        sel
+00008d20: 662e 6173 7365 7274 5472 7565 2864 6f63  f.assertTrue(doc
+00008d30: 756d 656e 7473 290a 2020 2020 2020 2020  uments).        
+00008d40: 2320 7265 706c 6163 6520 646f 6375 6d65  # replace docume
+00008d50: 6e74 2e0a 2020 2020 2020 2020 6372 6561  nt..        crea
+00008d60: 7465 645f 646f 6375 6d65 6e74 5b27 6e61  ted_document['na
+00008d70: 6d65 275d 203d 2027 7265 706c 6163 6564  me'] = 'replaced
+00008d80: 2064 6f63 756d 656e 7427 0a20 2020 2020   document'.     
+00008d90: 2020 2063 7265 6174 6564 5f64 6f63 756d     created_docum
+00008da0: 656e 745b 2773 7061 6d27 5d20 3d20 276e  ent['spam'] = 'n
+00008db0: 6f74 2065 6767 7327 0a20 2020 2020 2020  ot eggs'.       
+00008dc0: 206f 6c64 5f65 7461 6720 3d20 6372 6561   old_etag = crea
+00008dd0: 7465 645f 646f 6375 6d65 6e74 5b27 5f65  ted_document['_e
+00008de0: 7461 6727 5d0a 2020 2020 2020 2020 7265  tag'].        re
+00008df0: 706c 6163 6564 5f64 6f63 756d 656e 7420  placed_document 
+00008e00: 3d20 6372 6561 7465 645f 636f 6c6c 6563  = created_collec
+00008e10: 7469 6f6e 2e72 6570 6c61 6365 5f69 7465  tion.replace_ite
+00008e20: 6d28 0a20 2020 2020 2020 2020 2020 2069  m(.            i
+00008e30: 7465 6d3d 6372 6561 7465 645f 646f 6375  tem=created_docu
+00008e40: 6d65 6e74 5b27 6964 275d 2c0a 2020 2020  ment['id'],.    
+00008e50: 2020 2020 2020 2020 626f 6479 3d63 7265          body=cre
+00008e60: 6174 6564 5f64 6f63 756d 656e 740a 2020  ated_document.  
+00008e70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00008e80: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00008e90: 2872 6570 6c61 6365 645f 646f 6375 6d65  (replaced_docume
+00008ea0: 6e74 5b27 6e61 6d65 275d 2c0a 2020 2020  nt['name'],.    
 00008eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ec0: 2020 2020 2772 6570 6c61 6365 6420 646f      'replaced do
-00008ed0: 6375 6d65 6e74 272c 0a20 2020 2020 2020  cument',.       
+00008ec0: 2020 2020 2027 7265 706c 6163 6564 2064       'replaced d
+00008ed0: 6f63 756d 656e 7427 2c0a 2020 2020 2020  ocument',.      
 00008ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ef0: 2020 2764 6f63 756d 656e 7420 6964 2070    'document id p
-00008f00: 726f 7065 7274 7920 7368 6f75 6c64 2063  roperty should c
-00008f10: 6861 6e67 6527 290a 2020 2020 2020 2020  hange').        
-00008f20: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00008f30: 2872 6570 6c61 6365 645f 646f 6375 6d65  (replaced_docume
-00008f40: 6e74 5b27 7370 616d 275d 2c0a 2020 2020  nt['spam'],.    
+00008ef0: 2020 2027 646f 6375 6d65 6e74 2069 6420     'document id 
+00008f00: 7072 6f70 6572 7479 2073 686f 756c 6420  property should 
+00008f10: 6368 616e 6765 2729 0a20 2020 2020 2020  change').       
+00008f20: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00008f30: 6c28 7265 706c 6163 6564 5f64 6f63 756d  l(replaced_docum
+00008f40: 656e 745b 2773 7061 6d27 5d2c 0a20 2020  ent['spam'],.   
 00008f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f60: 2020 2020 2027 6e6f 7420 6567 6773 272c       'not eggs',
-00008f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008f80: 2020 2020 2020 2020 2020 2770 726f 7065            'prope
-00008f90: 7274 7920 7368 6f75 6c64 2068 6176 6520  rty should have 
-00008fa0: 6368 616e 6765 6427 290a 2020 2020 2020  changed').      
-00008fb0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00008fc0: 616c 2863 7265 6174 6564 5f64 6f63 756d  al(created_docum
-00008fd0: 656e 745b 2769 6427 5d2c 0a20 2020 2020  ent['id'],.     
+00008f60: 2020 2020 2020 276e 6f74 2065 6767 7327        'not eggs'
+00008f70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00008f80: 2020 2020 2020 2020 2020 2027 7072 6f70             'prop
+00008f90: 6572 7479 2073 686f 756c 6420 6861 7665  erty should have
+00008fa0: 2063 6861 6e67 6564 2729 0a20 2020 2020   changed').     
+00008fb0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00008fc0: 7561 6c28 6372 6561 7465 645f 646f 6375  ual(created_docu
+00008fd0: 6d65 6e74 5b27 6964 275d 2c0a 2020 2020  ment['id'],.    
 00008fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ff0: 2020 2020 7265 706c 6163 6564 5f64 6f63      replaced_doc
-00009000: 756d 656e 745b 2769 6427 5d2c 0a20 2020  ument['id'],.   
+00008ff0: 2020 2020 2072 6570 6c61 6365 645f 646f       replaced_do
+00009000: 6375 6d65 6e74 5b27 6964 275d 2c0a 2020  cument['id'],.  
 00009010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009020: 2020 2020 2020 2764 6f63 756d 656e 7420        'document 
-00009030: 6964 2073 686f 756c 6420 7374 6179 2074  id should stay t
-00009040: 6865 2073 616d 6527 290a 0a20 2020 2020  he same')..     
-00009050: 2020 2023 2072 6570 6c61 6365 2064 6f63     # replace doc
-00009060: 756d 656e 7420 6261 7365 6420 6f6e 2063  ument based on c
-00009070: 6f6e 6469 7469 6f6e 0a20 2020 2020 2020  ondition.       
-00009080: 2072 6570 6c61 6365 645f 646f 6375 6d65   replaced_docume
-00009090: 6e74 5b27 6e61 6d65 275d 203d 2027 7265  nt['name'] = 're
-000090a0: 706c 6163 6564 2064 6f63 756d 656e 7420  placed document 
-000090b0: 6261 7365 6420 6f6e 2063 6f6e 6469 7469  based on conditi
-000090c0: 6f6e 270a 2020 2020 2020 2020 7265 706c  on'.        repl
-000090d0: 6163 6564 5f64 6f63 756d 656e 745b 2773  aced_document['s
-000090e0: 7061 6d27 5d20 3d20 276e 6577 2073 7061  pam'] = 'new spa
-000090f0: 6d20 6669 656c 6427 0a0a 2020 2020 2020  m field'..      
-00009100: 2020 2320 7368 6f75 6c64 2066 6169 6c20    # should fail 
-00009110: 666f 7220 7374 616c 6520 6574 6167 0a20  for stale etag. 
-00009120: 2020 2020 2020 2073 656c 662e 5f5f 4173         self.__As
-00009130: 7365 7274 4854 5450 4661 696c 7572 6557  sertHTTPFailureW
-00009140: 6974 6853 7461 7475 7328 0a20 2020 2020  ithStatus(.     
-00009150: 2020 2020 2020 2053 7461 7475 7343 6f64         StatusCod
-00009160: 6573 2e50 5245 434f 4e44 4954 494f 4e5f  es.PRECONDITION_
-00009170: 4641 494c 4544 2c0a 2020 2020 2020 2020  FAILED,.        
-00009180: 2020 2020 6372 6561 7465 645f 636f 6c6c      created_coll
-00009190: 6563 7469 6f6e 2e72 6570 6c61 6365 5f69  ection.replace_i
-000091a0: 7465 6d2c 0a20 2020 2020 2020 2020 2020  tem,.           
-000091b0: 2072 6570 6c61 6365 645f 646f 6375 6d65   replaced_docume
-000091c0: 6e74 5b27 6964 275d 2c0a 2020 2020 2020  nt['id'],.      
-000091d0: 2020 2020 2020 7265 706c 6163 6564 5f64        replaced_d
-000091e0: 6f63 756d 656e 742c 0a20 2020 2020 2020  ocument,.       
-000091f0: 2020 2020 2069 665f 6d61 7463 683d 6f6c       if_match=ol
-00009200: 645f 6574 6167 2c0a 2020 2020 2020 2020  d_etag,.        
-00009210: 290a 0a20 2020 2020 2020 2023 2073 686f  )..        # sho
-00009220: 756c 6420 6661 696c 2069 6620 6f6e 6c79  uld fail if only
-00009230: 2065 7461 6720 7370 6563 6966 6965 640a   etag specified.
-00009240: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-00009250: 662e 6173 7365 7274 5261 6973 6573 2856  f.assertRaises(V
-00009260: 616c 7565 4572 726f 7229 3a0a 2020 2020  alueError):.    
-00009270: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-00009280: 636f 6c6c 6563 7469 6f6e 2e72 6570 6c61  collection.repla
-00009290: 6365 5f69 7465 6d28 0a20 2020 2020 2020  ce_item(.       
-000092a0: 2020 2020 2020 2020 2065 7461 673d 7265           etag=re
-000092b0: 706c 6163 6564 5f64 6f63 756d 656e 745b  placed_document[
-000092c0: 275f 6574 6167 275d 2c0a 2020 2020 2020  '_etag'],.      
-000092d0: 2020 2020 2020 2020 2020 6974 656d 3d72            item=r
-000092e0: 6570 6c61 6365 645f 646f 6375 6d65 6e74  eplaced_document
-000092f0: 5b27 6964 275d 2c0a 2020 2020 2020 2020  ['id'],.        
-00009300: 2020 2020 2020 2020 626f 6479 3d72 6570          body=rep
-00009310: 6c61 6365 645f 646f 6375 6d65 6e74 0a20  laced_document. 
-00009320: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00009330: 2020 2020 2020 2320 7368 6f75 6c64 2066        # should f
-00009340: 6169 6c20 6966 206f 6e6c 7920 6d61 7463  ail if only matc
-00009350: 6820 636f 6e64 6974 696f 6e20 7370 6563  h condition spec
-00009360: 6966 6965 640a 2020 2020 2020 2020 7769  ified.        wi
-00009370: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-00009380: 6973 6573 2856 616c 7565 4572 726f 7229  ises(ValueError)
-00009390: 3a0a 2020 2020 2020 2020 2020 2020 6372  :.            cr
-000093a0: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
-000093b0: 2e72 6570 6c61 6365 5f69 7465 6d28 0a20  .replace_item(. 
-000093c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000093d0: 6174 6368 5f63 6f6e 6469 7469 6f6e 3d4d  atch_condition=M
-000093e0: 6174 6368 436f 6e64 6974 696f 6e73 2e49  atchConditions.I
-000093f0: 664e 6f74 4d6f 6469 6669 6564 2c0a 2020  fNotModified,.  
-00009400: 2020 2020 2020 2020 2020 2020 2020 6974                it
-00009410: 656d 3d72 6570 6c61 6365 645f 646f 6375  em=replaced_docu
-00009420: 6d65 6e74 5b27 6964 275d 2c0a 2020 2020  ment['id'],.    
-00009430: 2020 2020 2020 2020 2020 2020 626f 6479              body
-00009440: 3d72 6570 6c61 6365 645f 646f 6375 6d65  =replaced_docume
-00009450: 6e74 0a20 2020 2020 2020 2020 2020 2029  nt.            )
-00009460: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-00009470: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
-00009480: 5661 6c75 6545 7272 6f72 293a 0a20 2020  ValueError):.   
-00009490: 2020 2020 2020 2020 2063 7265 6174 6564           created
-000094a0: 5f63 6f6c 6c65 6374 696f 6e2e 7265 706c  _collection.repl
-000094b0: 6163 655f 6974 656d 280a 2020 2020 2020  ace_item(.      
-000094c0: 2020 2020 2020 2020 2020 6d61 7463 685f            match_
-000094d0: 636f 6e64 6974 696f 6e3d 4d61 7463 6843  condition=MatchC
-000094e0: 6f6e 6469 7469 6f6e 732e 4966 4d6f 6469  onditions.IfModi
-000094f0: 6669 6564 2c0a 2020 2020 2020 2020 2020  fied,.          
-00009500: 2020 2020 2020 6974 656d 3d72 6570 6c61        item=repla
-00009510: 6365 645f 646f 6375 6d65 6e74 5b27 6964  ced_document['id
-00009520: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00009530: 2020 2020 626f 6479 3d72 6570 6c61 6365      body=replace
-00009540: 645f 646f 6375 6d65 6e74 0a20 2020 2020  d_document.     
-00009550: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00009560: 2020 2320 7368 6f75 6c64 2066 6169 6c20    # should fail 
-00009570: 6966 2069 6e76 616c 6964 206d 6174 6368  if invalid match
-00009580: 2063 6f6e 6469 7469 6f6e 2073 7065 6369   condition speci
-00009590: 6669 6564 0a20 2020 2020 2020 2077 6974  fied.        wit
-000095a0: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-000095b0: 7365 7328 5479 7065 4572 726f 7229 3a0a  ses(TypeError):.
-000095c0: 2020 2020 2020 2020 2020 2020 6372 6561              crea
-000095d0: 7465 645f 636f 6c6c 6563 7469 6f6e 2e72  ted_collection.r
-000095e0: 6570 6c61 6365 5f69 7465 6d28 0a20 2020  eplace_item(.   
-000095f0: 2020 2020 2020 2020 2020 2020 206d 6174               mat
-00009600: 6368 5f63 6f6e 6469 7469 6f6e 3d72 6570  ch_condition=rep
-00009610: 6c61 6365 645f 646f 6375 6d65 6e74 5b27  laced_document['
-00009620: 5f65 7461 6727 5d2c 0a20 2020 2020 2020  _etag'],.       
-00009630: 2020 2020 2020 2020 2069 7465 6d3d 7265           item=re
-00009640: 706c 6163 6564 5f64 6f63 756d 656e 745b  placed_document[
-00009650: 2769 6427 5d2c 0a20 2020 2020 2020 2020  'id'],.         
-00009660: 2020 2020 2020 2062 6f64 793d 7265 706c         body=repl
-00009670: 6163 6564 5f64 6f63 756d 656e 740a 2020  aced_document.  
-00009680: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00009690: 2020 2020 2023 2073 686f 756c 6420 7061       # should pa
-000096a0: 7373 2066 6f72 206d 6f73 7420 7265 6365  ss for most rece
-000096b0: 6e74 2065 7461 670a 2020 2020 2020 2020  nt etag.        
-000096c0: 7265 706c 6163 6564 5f64 6f63 756d 656e  replaced_documen
-000096d0: 745f 636f 6e64 6974 696f 6e61 6c20 3d20  t_conditional = 
-000096e0: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
-000096f0: 6f6e 2e72 6570 6c61 6365 5f69 7465 6d28  on.replace_item(
-00009700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009710: 206d 6174 6368 5f63 6f6e 6469 7469 6f6e   match_condition
-00009720: 3d4d 6174 6368 436f 6e64 6974 696f 6e73  =MatchConditions
-00009730: 2e49 664e 6f74 4d6f 6469 6669 6564 2c0a  .IfNotModified,.
-00009740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009750: 6574 6167 3d72 6570 6c61 6365 645f 646f  etag=replaced_do
-00009760: 6375 6d65 6e74 5b27 5f65 7461 6727 5d2c  cument['_etag'],
-00009770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009780: 2069 7465 6d3d 7265 706c 6163 6564 5f64   item=replaced_d
-00009790: 6f63 756d 656e 745b 2769 6427 5d2c 0a20  ocument['id'],. 
-000097a0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-000097b0: 6f64 793d 7265 706c 6163 6564 5f64 6f63  ody=replaced_doc
-000097c0: 756d 656e 740a 2020 2020 2020 2020 2020  ument.          
-000097d0: 2020 290a 2020 2020 2020 2020 7365 6c66    ).        self
-000097e0: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
-000097f0: 6c61 6365 645f 646f 6375 6d65 6e74 5f63  laced_document_c
-00009800: 6f6e 6469 7469 6f6e 616c 5b27 6e61 6d65  onditional['name
-00009810: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00009820: 2020 2020 2020 2020 2020 2020 2027 7265               're
-00009830: 706c 6163 6564 2064 6f63 756d 656e 7420  placed document 
-00009840: 6261 7365 6420 6f6e 2063 6f6e 6469 7469  based on conditi
-00009850: 6f6e 272c 0a20 2020 2020 2020 2020 2020  on',.           
-00009860: 2020 2020 2020 2020 2020 2020 2020 2764                'd
-00009870: 6f63 756d 656e 7420 6964 2070 726f 7065  ocument id prope
-00009880: 7274 7920 7368 6f75 6c64 2063 6861 6e67  rty should chang
-00009890: 6527 290a 2020 2020 2020 2020 7365 6c66  e').        self
-000098a0: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
-000098b0: 6c61 6365 645f 646f 6375 6d65 6e74 5f63  laced_document_c
-000098c0: 6f6e 6469 7469 6f6e 616c 5b27 7370 616d  onditional['spam
-000098d0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-000098e0: 2020 2020 2020 2020 2020 2020 2027 6e65               'ne
-000098f0: 7720 7370 616d 2066 6965 6c64 272c 0a20  w spam field',. 
+00009020: 2020 2020 2020 2027 646f 6375 6d65 6e74         'document
+00009030: 2069 6420 7368 6f75 6c64 2073 7461 7920   id should stay 
+00009040: 7468 6520 7361 6d65 2729 0a0a 2020 2020  the same')..    
+00009050: 2020 2020 2320 7265 706c 6163 6520 646f      # replace do
+00009060: 6375 6d65 6e74 2062 6173 6564 206f 6e20  cument based on 
+00009070: 636f 6e64 6974 696f 6e0a 2020 2020 2020  condition.      
+00009080: 2020 7265 706c 6163 6564 5f64 6f63 756d    replaced_docum
+00009090: 656e 745b 276e 616d 6527 5d20 3d20 2772  ent['name'] = 'r
+000090a0: 6570 6c61 6365 6420 646f 6375 6d65 6e74  eplaced document
+000090b0: 2062 6173 6564 206f 6e20 636f 6e64 6974   based on condit
+000090c0: 696f 6e27 0a20 2020 2020 2020 2072 6570  ion'.        rep
+000090d0: 6c61 6365 645f 646f 6375 6d65 6e74 5b27  laced_document['
+000090e0: 7370 616d 275d 203d 2027 6e65 7720 7370  spam'] = 'new sp
+000090f0: 616d 2066 6965 6c64 270a 0a20 2020 2020  am field'..     
+00009100: 2020 2023 2073 686f 756c 6420 6661 696c     # should fail
+00009110: 2066 6f72 2073 7461 6c65 2065 7461 670a   for stale etag.
+00009120: 2020 2020 2020 2020 7365 6c66 2e5f 5f41          self.__A
+00009130: 7373 6572 7448 5454 5046 6169 6c75 7265  ssertHTTPFailure
+00009140: 5769 7468 5374 6174 7573 280a 2020 2020  WithStatus(.    
+00009150: 2020 2020 2020 2020 5374 6174 7573 436f          StatusCo
+00009160: 6465 732e 5052 4543 4f4e 4449 5449 4f4e  des.PRECONDITION
+00009170: 5f46 4149 4c45 442c 0a20 2020 2020 2020  _FAILED,.       
+00009180: 2020 2020 2063 7265 6174 6564 5f63 6f6c       created_col
+00009190: 6c65 6374 696f 6e2e 7265 706c 6163 655f  lection.replace_
+000091a0: 6974 656d 2c0a 2020 2020 2020 2020 2020  item,.          
+000091b0: 2020 7265 706c 6163 6564 5f64 6f63 756d    replaced_docum
+000091c0: 656e 745b 2769 6427 5d2c 0a20 2020 2020  ent['id'],.     
+000091d0: 2020 2020 2020 2072 6570 6c61 6365 645f         replaced_
+000091e0: 646f 6375 6d65 6e74 2c0a 2020 2020 2020  document,.      
+000091f0: 2020 2020 2020 6966 5f6d 6174 6368 3d6f        if_match=o
+00009200: 6c64 5f65 7461 672c 0a20 2020 2020 2020  ld_etag,.       
+00009210: 2029 0a0a 2020 2020 2020 2020 2320 7368   )..        # sh
+00009220: 6f75 6c64 2066 6169 6c20 6966 206f 6e6c  ould fail if onl
+00009230: 7920 6574 6167 2073 7065 6369 6669 6564  y etag specified
+00009240: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+00009250: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+00009260: 5661 6c75 6545 7272 6f72 293a 0a20 2020  ValueError):.   
+00009270: 2020 2020 2020 2020 2063 7265 6174 6564           created
+00009280: 5f63 6f6c 6c65 6374 696f 6e2e 7265 706c  _collection.repl
+00009290: 6163 655f 6974 656d 280a 2020 2020 2020  ace_item(.      
+000092a0: 2020 2020 2020 2020 2020 6574 6167 3d72            etag=r
+000092b0: 6570 6c61 6365 645f 646f 6375 6d65 6e74  eplaced_document
+000092c0: 5b27 5f65 7461 6727 5d2c 0a20 2020 2020  ['_etag'],.     
+000092d0: 2020 2020 2020 2020 2020 2069 7465 6d3d             item=
+000092e0: 7265 706c 6163 6564 5f64 6f63 756d 656e  replaced_documen
+000092f0: 745b 2769 6427 5d2c 0a20 2020 2020 2020  t['id'],.       
+00009300: 2020 2020 2020 2020 2062 6f64 793d 7265           body=re
+00009310: 706c 6163 6564 5f64 6f63 756d 656e 740a  placed_document.
+00009320: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00009330: 2020 2020 2020 2023 2073 686f 756c 6420         # should 
+00009340: 6661 696c 2069 6620 6f6e 6c79 206d 6174  fail if only mat
+00009350: 6368 2063 6f6e 6469 7469 6f6e 2073 7065  ch condition spe
+00009360: 6369 6669 6564 0a20 2020 2020 2020 2077  cified.        w
+00009370: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+00009380: 6169 7365 7328 5661 6c75 6545 7272 6f72  aises(ValueError
+00009390: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
+000093a0: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
+000093b0: 6e2e 7265 706c 6163 655f 6974 656d 280a  n.replace_item(.
+000093c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093d0: 6d61 7463 685f 636f 6e64 6974 696f 6e3d  match_condition=
+000093e0: 4d61 7463 6843 6f6e 6469 7469 6f6e 732e  MatchConditions.
+000093f0: 4966 4e6f 744d 6f64 6966 6965 642c 0a20  IfNotModified,. 
+00009400: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00009410: 7465 6d3d 7265 706c 6163 6564 5f64 6f63  tem=replaced_doc
+00009420: 756d 656e 745b 2769 6427 5d2c 0a20 2020  ument['id'],.   
+00009430: 2020 2020 2020 2020 2020 2020 2062 6f64               bod
+00009440: 793d 7265 706c 6163 6564 5f64 6f63 756d  y=replaced_docum
+00009450: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+00009460: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
+00009470: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+00009480: 2856 616c 7565 4572 726f 7229 3a0a 2020  (ValueError):.  
+00009490: 2020 2020 2020 2020 2020 6372 6561 7465            create
+000094a0: 645f 636f 6c6c 6563 7469 6f6e 2e72 6570  d_collection.rep
+000094b0: 6c61 6365 5f69 7465 6d28 0a20 2020 2020  lace_item(.     
+000094c0: 2020 2020 2020 2020 2020 206d 6174 6368             match
+000094d0: 5f63 6f6e 6469 7469 6f6e 3d4d 6174 6368  _condition=Match
+000094e0: 436f 6e64 6974 696f 6e73 2e49 664d 6f64  Conditions.IfMod
+000094f0: 6966 6965 642c 0a20 2020 2020 2020 2020  ified,.         
+00009500: 2020 2020 2020 2069 7465 6d3d 7265 706c         item=repl
+00009510: 6163 6564 5f64 6f63 756d 656e 745b 2769  aced_document['i
+00009520: 6427 5d2c 0a20 2020 2020 2020 2020 2020  d'],.           
+00009530: 2020 2020 2062 6f64 793d 7265 706c 6163       body=replac
+00009540: 6564 5f64 6f63 756d 656e 740a 2020 2020  ed_document.    
+00009550: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00009560: 2020 2023 2073 686f 756c 6420 6661 696c     # should fail
+00009570: 2069 6620 696e 7661 6c69 6420 6d61 7463   if invalid matc
+00009580: 6820 636f 6e64 6974 696f 6e20 7370 6563  h condition spec
+00009590: 6966 6965 640a 2020 2020 2020 2020 7769  ified.        wi
+000095a0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+000095b0: 6973 6573 2854 7970 6545 7272 6f72 293a  ises(TypeError):
+000095c0: 0a20 2020 2020 2020 2020 2020 2063 7265  .            cre
+000095d0: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
+000095e0: 7265 706c 6163 655f 6974 656d 280a 2020  replace_item(.  
+000095f0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00009600: 7463 685f 636f 6e64 6974 696f 6e3d 7265  tch_condition=re
+00009610: 706c 6163 6564 5f64 6f63 756d 656e 745b  placed_document[
+00009620: 275f 6574 6167 275d 2c0a 2020 2020 2020  '_etag'],.      
+00009630: 2020 2020 2020 2020 2020 6974 656d 3d72            item=r
+00009640: 6570 6c61 6365 645f 646f 6375 6d65 6e74  eplaced_document
+00009650: 5b27 6964 275d 2c0a 2020 2020 2020 2020  ['id'],.        
+00009660: 2020 2020 2020 2020 626f 6479 3d72 6570          body=rep
+00009670: 6c61 6365 645f 646f 6375 6d65 6e74 0a20  laced_document. 
+00009680: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00009690: 2020 2020 2020 2320 7368 6f75 6c64 2070        # should p
+000096a0: 6173 7320 666f 7220 6d6f 7374 2072 6563  ass for most rec
+000096b0: 656e 7420 6574 6167 0a20 2020 2020 2020  ent etag.       
+000096c0: 2072 6570 6c61 6365 645f 646f 6375 6d65   replaced_docume
+000096d0: 6e74 5f63 6f6e 6469 7469 6f6e 616c 203d  nt_conditional =
+000096e0: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
+000096f0: 696f 6e2e 7265 706c 6163 655f 6974 656d  ion.replace_item
+00009700: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00009710: 2020 6d61 7463 685f 636f 6e64 6974 696f    match_conditio
+00009720: 6e3d 4d61 7463 6843 6f6e 6469 7469 6f6e  n=MatchCondition
+00009730: 732e 4966 4e6f 744d 6f64 6966 6965 642c  s.IfNotModified,
+00009740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009750: 2065 7461 673d 7265 706c 6163 6564 5f64   etag=replaced_d
+00009760: 6f63 756d 656e 745b 275f 6574 6167 275d  ocument['_etag']
+00009770: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00009780: 2020 6974 656d 3d72 6570 6c61 6365 645f    item=replaced_
+00009790: 646f 6375 6d65 6e74 5b27 6964 275d 2c0a  document['id'],.
+000097a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000097b0: 626f 6479 3d72 6570 6c61 6365 645f 646f  body=replaced_do
+000097c0: 6375 6d65 6e74 0a20 2020 2020 2020 2020  cument.         
+000097d0: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+000097e0: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+000097f0: 706c 6163 6564 5f64 6f63 756d 656e 745f  placed_document_
+00009800: 636f 6e64 6974 696f 6e61 6c5b 276e 616d  conditional['nam
+00009810: 6527 5d2c 0a20 2020 2020 2020 2020 2020  e'],.           
+00009820: 2020 2020 2020 2020 2020 2020 2020 2772                'r
+00009830: 6570 6c61 6365 6420 646f 6375 6d65 6e74  eplaced document
+00009840: 2062 6173 6564 206f 6e20 636f 6e64 6974   based on condit
+00009850: 696f 6e27 2c0a 2020 2020 2020 2020 2020  ion',.          
+00009860: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00009870: 646f 6375 6d65 6e74 2069 6420 7072 6f70  document id prop
+00009880: 6572 7479 2073 686f 756c 6420 6368 616e  erty should chan
+00009890: 6765 2729 0a20 2020 2020 2020 2073 656c  ge').        sel
+000098a0: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+000098b0: 706c 6163 6564 5f64 6f63 756d 656e 745f  placed_document_
+000098c0: 636f 6e64 6974 696f 6e61 6c5b 2773 7061  conditional['spa
+000098d0: 6d27 5d2c 0a20 2020 2020 2020 2020 2020  m'],.           
+000098e0: 2020 2020 2020 2020 2020 2020 2020 276e                'n
+000098f0: 6577 2073 7061 6d20 6669 656c 6427 2c0a  ew spam field',.
 00009900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009910: 2020 2020 2020 2020 2770 726f 7065 7274          'propert
-00009920: 7920 7368 6f75 6c64 2068 6176 6520 6368  y should have ch
-00009930: 616e 6765 6427 290a 2020 2020 2020 2020  anged').        
-00009940: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00009950: 2872 6570 6c61 6365 645f 646f 6375 6d65  (replaced_docume
-00009960: 6e74 5f63 6f6e 6469 7469 6f6e 616c 5b27  nt_conditional['
-00009970: 6964 275d 2c0a 2020 2020 2020 2020 2020  id'],.          
-00009980: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00009990: 6570 6c61 6365 645f 646f 6375 6d65 6e74  eplaced_document
-000099a0: 5b27 6964 275d 2c0a 2020 2020 2020 2020  ['id'],.        
+00009910: 2020 2020 2020 2020 2027 7072 6f70 6572           'proper
+00009920: 7479 2073 686f 756c 6420 6861 7665 2063  ty should have c
+00009930: 6861 6e67 6564 2729 0a20 2020 2020 2020  hanged').       
+00009940: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00009950: 6c28 7265 706c 6163 6564 5f64 6f63 756d  l(replaced_docum
+00009960: 656e 745f 636f 6e64 6974 696f 6e61 6c5b  ent_conditional[
+00009970: 2769 6427 5d2c 0a20 2020 2020 2020 2020  'id'],.         
+00009980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009990: 7265 706c 6163 6564 5f64 6f63 756d 656e  replaced_documen
+000099a0: 745b 2769 6427 5d2c 0a20 2020 2020 2020  t['id'],.       
 000099b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099c0: 2027 646f 6375 6d65 6e74 2069 6420 7368   'document id sh
-000099d0: 6f75 6c64 2073 7461 7920 7468 6520 7361  ould stay the sa
-000099e0: 6d65 2729 0a20 2020 2020 2020 2023 2072  me').        # r
-000099f0: 6561 6420 646f 6375 6d65 6e74 0a20 2020  ead document.   
-00009a00: 2020 2020 206f 6e65 5f64 6f63 756d 656e       one_documen
-00009a10: 745f 6672 6f6d 5f72 6561 6420 3d20 6372  t_from_read = cr
-00009a20: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
-00009a30: 2e72 6561 645f 6974 656d 280a 2020 2020  .read_item(.    
-00009a40: 2020 2020 2020 2020 6974 656d 3d72 6570          item=rep
-00009a50: 6c61 6365 645f 646f 6375 6d65 6e74 5b27  laced_document['
-00009a60: 6964 275d 2c0a 2020 2020 2020 2020 2020  id'],.          
-00009a70: 2020 7061 7274 6974 696f 6e5f 6b65 793d    partition_key=
-00009a80: 7265 706c 6163 6564 5f64 6f63 756d 656e  replaced_documen
-00009a90: 745b 2769 6427 5d0a 2020 2020 2020 2020  t['id'].        
-00009aa0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00009ab0: 7373 6572 7445 7175 616c 2872 6570 6c61  ssertEqual(repla
-00009ac0: 6365 645f 646f 6375 6d65 6e74 5b27 6964  ced_document['id
-00009ad0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00009ae0: 2020 2020 2020 2020 2020 2020 206f 6e65               one
-00009af0: 5f64 6f63 756d 656e 745f 6672 6f6d 5f72  _document_from_r
-00009b00: 6561 645b 2769 6427 5d29 0a20 2020 2020  ead['id']).     
-00009b10: 2020 2023 2064 656c 6574 6520 646f 6375     # delete docu
-00009b20: 6d65 6e74 0a20 2020 2020 2020 2063 7265  ment.        cre
-00009b30: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
-00009b40: 6465 6c65 7465 5f69 7465 6d28 0a20 2020  delete_item(.   
-00009b50: 2020 2020 2020 2020 2069 7465 6d3d 7265           item=re
-00009b60: 706c 6163 6564 5f64 6f63 756d 656e 742c  placed_document,
-00009b70: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-00009b80: 7469 7469 6f6e 5f6b 6579 3d72 6570 6c61  tition_key=repla
-00009b90: 6365 645f 646f 6375 6d65 6e74 5b27 6964  ced_document['id
-00009ba0: 275d 0a20 2020 2020 2020 2029 0a20 2020  '].        ).   
-00009bb0: 2020 2020 2023 2072 6561 6420 646f 6375       # read docu
-00009bc0: 6d65 6e74 7320 6166 7465 7220 6465 6c65  ments after dele
-00009bd0: 7469 6f6e 0a20 2020 2020 2020 2073 656c  tion.        sel
-00009be0: 662e 5f5f 4173 7365 7274 4854 5450 4661  f.__AssertHTTPFa
-00009bf0: 696c 7572 6557 6974 6853 7461 7475 7328  ilureWithStatus(
-00009c00: 5374 6174 7573 436f 6465 732e 4e4f 545f  StatusCodes.NOT_
-00009c10: 464f 554e 442c 0a20 2020 2020 2020 2020  FOUND,.         
+000099c0: 2020 2764 6f63 756d 656e 7420 6964 2073    'document id s
+000099d0: 686f 756c 6420 7374 6179 2074 6865 2073  hould stay the s
+000099e0: 616d 6527 290a 2020 2020 2020 2020 2320  ame').        # 
+000099f0: 7265 6164 2064 6f63 756d 656e 740a 2020  read document.  
+00009a00: 2020 2020 2020 6f6e 655f 646f 6375 6d65        one_docume
+00009a10: 6e74 5f66 726f 6d5f 7265 6164 203d 2063  nt_from_read = c
+00009a20: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
+00009a30: 6e2e 7265 6164 5f69 7465 6d28 0a20 2020  n.read_item(.   
+00009a40: 2020 2020 2020 2020 2069 7465 6d3d 7265           item=re
+00009a50: 706c 6163 6564 5f64 6f63 756d 656e 745b  placed_document[
+00009a60: 2769 6427 5d2c 0a20 2020 2020 2020 2020  'id'],.         
+00009a70: 2020 2070 6172 7469 7469 6f6e 5f6b 6579     partition_key
+00009a80: 3d72 6570 6c61 6365 645f 646f 6375 6d65  =replaced_docume
+00009a90: 6e74 5b27 6964 275d 0a20 2020 2020 2020  nt['id'].       
+00009aa0: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
+00009ab0: 6173 7365 7274 4571 7561 6c28 7265 706c  assertEqual(repl
+00009ac0: 6163 6564 5f64 6f63 756d 656e 745b 2769  aced_document['i
+00009ad0: 6427 5d2c 0a20 2020 2020 2020 2020 2020  d'],.           
+00009ae0: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
+00009af0: 655f 646f 6375 6d65 6e74 5f66 726f 6d5f  e_document_from_
+00009b00: 7265 6164 5b27 6964 275d 290a 2020 2020  read['id']).    
+00009b10: 2020 2020 2320 6465 6c65 7465 2064 6f63      # delete doc
+00009b20: 756d 656e 740a 2020 2020 2020 2020 6372  ument.        cr
+00009b30: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+00009b40: 2e64 656c 6574 655f 6974 656d 280a 2020  .delete_item(.  
+00009b50: 2020 2020 2020 2020 2020 6974 656d 3d72            item=r
+00009b60: 6570 6c61 6365 645f 646f 6375 6d65 6e74  eplaced_document
+00009b70: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+00009b80: 7274 6974 696f 6e5f 6b65 793d 7265 706c  rtition_key=repl
+00009b90: 6163 6564 5f64 6f63 756d 656e 745b 2769  aced_document['i
+00009ba0: 6427 5d0a 2020 2020 2020 2020 290a 2020  d'].        ).  
+00009bb0: 2020 2020 2020 2320 7265 6164 2064 6f63        # read doc
+00009bc0: 756d 656e 7473 2061 6674 6572 2064 656c  uments after del
+00009bd0: 6574 696f 6e0a 2020 2020 2020 2020 7365  etion.        se
+00009be0: 6c66 2e5f 5f41 7373 6572 7448 5454 5046  lf.__AssertHTTPF
+00009bf0: 6169 6c75 7265 5769 7468 5374 6174 7573  ailureWithStatus
+00009c00: 2853 7461 7475 7343 6f64 6573 2e4e 4f54  (StatusCodes.NOT
+00009c10: 5f46 4f55 4e44 2c0a 2020 2020 2020 2020  _FOUND,.        
 00009c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c40: 2020 6372 6561 7465 645f 636f 6c6c 6563    created_collec
-00009c50: 7469 6f6e 2e72 6561 645f 6974 656d 2c0a  tion.read_item,.
-00009c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c40: 2020 2063 7265 6174 6564 5f63 6f6c 6c65     created_colle
+00009c50: 6374 696f 6e2e 7265 6164 5f69 7465 6d2c  ction.read_item,
+00009c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00009c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c80: 2020 2020 2020 2020 2020 2072 6570 6c61             repla
-00009c90: 6365 645f 646f 6375 6d65 6e74 5b27 6964  ced_document['id
-00009ca0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+00009c80: 2020 2020 2020 2020 2020 2020 7265 706c              repl
+00009c90: 6163 6564 5f64 6f63 756d 656e 745b 2769  aced_document['i
+00009ca0: 6427 5d2c 0a20 2020 2020 2020 2020 2020  d'],.           
 00009cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cc0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00009cd0: 6570 6c61 6365 645f 646f 6375 6d65 6e74  eplaced_document
-00009ce0: 5b27 6964 275d 290a 0a20 2020 2064 6566  ['id'])..    def
-00009cf0: 2074 6573 745f 646f 6375 6d65 6e74 5f75   test_document_u
-00009d00: 7073 6572 7428 7365 6c66 293a 0a20 2020  psert(self):.   
-00009d10: 2020 2020 2023 2063 7265 6174 6520 6461       # create da
-00009d20: 7461 6261 7365 0a20 2020 2020 2020 2063  tabase.        c
-00009d30: 7265 6174 6564 5f64 6220 3d20 7365 6c66  reated_db = self
-00009d40: 2e64 6174 6162 6173 6546 6f72 5465 7374  .databaseForTest
-00009d50: 0a0a 2020 2020 2020 2020 2320 6372 6561  ..        # crea
-00009d60: 7465 2063 6f6c 6c65 6374 696f 6e0a 2020  te collection.  
-00009d70: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
-00009d80: 6c6c 6563 7469 6f6e 203d 2073 656c 662e  llection = self.
-00009d90: 636f 6e66 6967 732e 6372 6561 7465 5f6d  configs.create_m
-00009da0: 756c 7469 5f70 6172 7469 7469 6f6e 5f63  ulti_partition_c
-00009db0: 6f6c 6c65 6374 696f 6e5f 6966 5f6e 6f74  ollection_if_not
-00009dc0: 5f65 7869 7374 2873 656c 662e 636c 6965  _exist(self.clie
-00009dd0: 6e74 290a 0a20 2020 2020 2020 2023 2072  nt)..        # r
-00009de0: 6561 6420 646f 6375 6d65 6e74 7320 616e  ead documents an
-00009df0: 6420 6368 6563 6b20 636f 756e 740a 2020  d check count.  
-00009e00: 2020 2020 2020 646f 6375 6d65 6e74 7320        documents 
-00009e10: 3d20 6c69 7374 2863 7265 6174 6564 5f63  = list(created_c
-00009e20: 6f6c 6c65 6374 696f 6e2e 7265 6164 5f61  ollection.read_a
-00009e30: 6c6c 5f69 7465 6d73 2829 290a 2020 2020  ll_items()).    
-00009e40: 2020 2020 6265 666f 7265 5f63 7265 6174      before_creat
-00009e50: 655f 646f 6375 6d65 6e74 735f 636f 756e  e_documents_coun
-00009e60: 7420 3d20 6c65 6e28 646f 6375 6d65 6e74  t = len(document
-00009e70: 7329 0a0a 2020 2020 2020 2020 2320 6372  s)..        # cr
-00009e80: 6561 7465 2064 6f63 756d 656e 7420 6465  eate document de
-00009e90: 6669 6e69 7469 6f6e 0a20 2020 2020 2020  finition.       
-00009ea0: 2064 6f63 756d 656e 745f 6465 6669 6e69   document_defini
-00009eb0: 7469 6f6e 203d 207b 2769 6427 3a20 2764  tion = {'id': 'd
-00009ec0: 6f63 272c 0a20 2020 2020 2020 2020 2020  oc',.           
+00009cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009cd0: 7265 706c 6163 6564 5f64 6f63 756d 656e  replaced_documen
+00009ce0: 745b 2769 6427 5d29 0a0a 2020 2020 6465  t['id'])..    de
+00009cf0: 6620 7465 7374 5f64 6f63 756d 656e 745f  f test_document_
+00009d00: 7570 7365 7274 2873 656c 6629 3a0a 2020  upsert(self):.  
+00009d10: 2020 2020 2020 2320 6372 6561 7465 2064        # create d
+00009d20: 6174 6162 6173 650a 2020 2020 2020 2020  atabase.        
+00009d30: 6372 6561 7465 645f 6462 203d 2073 656c  created_db = sel
+00009d40: 662e 6461 7461 6261 7365 466f 7254 6573  f.databaseForTes
+00009d50: 740a 0a20 2020 2020 2020 2023 2063 7265  t..        # cre
+00009d60: 6174 6520 636f 6c6c 6563 7469 6f6e 0a20  ate collection. 
+00009d70: 2020 2020 2020 2063 7265 6174 6564 5f63         created_c
+00009d80: 6f6c 6c65 6374 696f 6e20 3d20 7365 6c66  ollection = self
+00009d90: 2e63 6f6e 6669 6773 2e63 7265 6174 655f  .configs.create_
+00009da0: 6d75 6c74 695f 7061 7274 6974 696f 6e5f  multi_partition_
+00009db0: 636f 6c6c 6563 7469 6f6e 5f69 665f 6e6f  collection_if_no
+00009dc0: 745f 6578 6973 7428 7365 6c66 2e63 6c69  t_exist(self.cli
+00009dd0: 656e 7429 0a0a 2020 2020 2020 2020 2320  ent)..        # 
+00009de0: 7265 6164 2064 6f63 756d 656e 7473 2061  read documents a
+00009df0: 6e64 2063 6865 636b 2063 6f75 6e74 0a20  nd check count. 
+00009e00: 2020 2020 2020 2064 6f63 756d 656e 7473         documents
+00009e10: 203d 206c 6973 7428 6372 6561 7465 645f   = list(created_
+00009e20: 636f 6c6c 6563 7469 6f6e 2e72 6561 645f  collection.read_
+00009e30: 616c 6c5f 6974 656d 7328 2929 0a20 2020  all_items()).   
+00009e40: 2020 2020 2062 6566 6f72 655f 6372 6561       before_crea
+00009e50: 7465 5f64 6f63 756d 656e 7473 5f63 6f75  te_documents_cou
+00009e60: 6e74 203d 206c 656e 2864 6f63 756d 656e  nt = len(documen
+00009e70: 7473 290a 0a20 2020 2020 2020 2023 2063  ts)..        # c
+00009e80: 7265 6174 6520 646f 6375 6d65 6e74 2064  reate document d
+00009e90: 6566 696e 6974 696f 6e0a 2020 2020 2020  efinition.      
+00009ea0: 2020 646f 6375 6d65 6e74 5f64 6566 696e    document_defin
+00009eb0: 6974 696f 6e20 3d20 7b27 6964 273a 2027  ition = {'id': '
+00009ec0: 646f 6327 2c0a 2020 2020 2020 2020 2020  doc',.          
 00009ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ee0: 2020 2020 276e 616d 6527 3a20 2773 616d      'name': 'sam
-00009ef0: 706c 6520 646f 6375 6d65 6e74 272c 0a20  ple document',. 
+00009ee0: 2020 2020 2027 6e61 6d65 273a 2027 7361       'name': 'sa
+00009ef0: 6d70 6c65 2064 6f63 756d 656e 7427 2c0a  mple document',.
 00009f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f10: 2020 2020 2020 2020 2020 2020 2020 2773                's
-00009f20: 7061 6d27 3a20 2765 6767 7327 2c0a 2020  pam': 'eggs',.  
+00009f10: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00009f20: 7370 616d 273a 2027 6567 6773 272c 0a20  spam': 'eggs',. 
 00009f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f40: 2020 2020 2020 2020 2020 2020 2027 6b65               'ke
-00009f50: 7927 3a20 2776 616c 7565 277d 0a0a 2020  y': 'value'}..  
-00009f60: 2020 2020 2020 2320 6372 6561 7465 2064        # create d
-00009f70: 6f63 756d 656e 7420 7573 696e 6720 5570  ocument using Up
-00009f80: 7365 7274 2041 5049 0a20 2020 2020 2020  sert API.       
-00009f90: 2063 7265 6174 6564 5f64 6f63 756d 656e   created_documen
-00009fa0: 7420 3d20 6372 6561 7465 645f 636f 6c6c  t = created_coll
-00009fb0: 6563 7469 6f6e 2e75 7073 6572 745f 6974  ection.upsert_it
-00009fc0: 656d 2862 6f64 793d 646f 6375 6d65 6e74  em(body=document
-00009fd0: 5f64 6566 696e 6974 696f 6e29 0a0a 2020  _definition)..  
-00009fe0: 2020 2020 2020 2320 7665 7269 6679 2069        # verify i
-00009ff0: 6420 7072 6f70 6572 7479 0a20 2020 2020  d property.     
-0000a000: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000a010: 7561 6c28 6372 6561 7465 645f 646f 6375  ual(created_docu
-0000a020: 6d65 6e74 5b27 6964 275d 2c0a 2020 2020  ment['id'],.    
+00009f40: 2020 2020 2020 2020 2020 2020 2020 276b                'k
+00009f50: 6579 273a 2027 7661 6c75 6527 7d0a 0a20  ey': 'value'}.. 
+00009f60: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+00009f70: 646f 6375 6d65 6e74 2075 7369 6e67 2055  document using U
+00009f80: 7073 6572 7420 4150 490a 2020 2020 2020  psert API.      
+00009f90: 2020 6372 6561 7465 645f 646f 6375 6d65    created_docume
+00009fa0: 6e74 203d 2063 7265 6174 6564 5f63 6f6c  nt = created_col
+00009fb0: 6c65 6374 696f 6e2e 7570 7365 7274 5f69  lection.upsert_i
+00009fc0: 7465 6d28 626f 6479 3d64 6f63 756d 656e  tem(body=documen
+00009fd0: 745f 6465 6669 6e69 7469 6f6e 290a 0a20  t_definition).. 
+00009fe0: 2020 2020 2020 2023 2076 6572 6966 7920         # verify 
+00009ff0: 6964 2070 726f 7065 7274 790a 2020 2020  id property.    
+0000a000: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000a010: 7175 616c 2863 7265 6174 6564 5f64 6f63  qual(created_doc
+0000a020: 756d 656e 745b 2769 6427 5d2c 0a20 2020  ument['id'],.   
 0000a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a040: 2020 2020 2064 6f63 756d 656e 745f 6465       document_de
-0000a050: 6669 6e69 7469 6f6e 5b27 6964 275d 290a  finition['id']).
-0000a060: 0a20 2020 2020 2020 2023 2074 6573 7420  .        # test 
-0000a070: 6572 726f 7220 666f 7220 6e6f 6e2d 7374  error for non-st
-0000a080: 7269 6e67 2069 640a 2020 2020 2020 2020  ring id.        
-0000a090: 7769 7468 2070 7974 6573 742e 7261 6973  with pytest.rais
-0000a0a0: 6573 2854 7970 6545 7272 6f72 293a 0a20  es(TypeError):. 
-0000a0b0: 2020 2020 2020 2020 2020 2064 6f63 756d             docum
-0000a0c0: 656e 745f 6465 6669 6e69 7469 6f6e 5b27  ent_definition['
-0000a0d0: 6964 275d 203d 2037 0a20 2020 2020 2020  id'] = 7.       
-0000a0e0: 2020 2020 2063 7265 6174 6564 5f63 6f6c       created_col
-0000a0f0: 6c65 6374 696f 6e2e 7570 7365 7274 5f69  lection.upsert_i
-0000a100: 7465 6d28 626f 6479 3d64 6f63 756d 656e  tem(body=documen
-0000a110: 745f 6465 6669 6e69 7469 6f6e 290a 0a20  t_definition).. 
-0000a120: 2020 2020 2020 2023 2072 6561 6420 646f         # read do
-0000a130: 6375 6d65 6e74 7320 6166 7465 7220 6372  cuments after cr
-0000a140: 6561 7469 6f6e 2061 6e64 2076 6572 6966  eation and verif
-0000a150: 7920 7570 6461 7465 6420 636f 756e 740a  y updated count.
-0000a160: 2020 2020 2020 2020 646f 6375 6d65 6e74          document
-0000a170: 7320 3d20 6c69 7374 2863 7265 6174 6564  s = list(created
-0000a180: 5f63 6f6c 6c65 6374 696f 6e2e 7265 6164  _collection.read
-0000a190: 5f61 6c6c 5f69 7465 6d73 2829 290a 2020  _all_items()).  
-0000a1a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000a1b0: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-0000a1c0: 2020 2020 6c65 6e28 646f 6375 6d65 6e74      len(document
-0000a1d0: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
-0000a1e0: 6265 666f 7265 5f63 7265 6174 655f 646f  before_create_do
-0000a1f0: 6375 6d65 6e74 735f 636f 756e 7420 2b20  cuments_count + 
-0000a200: 312c 0a20 2020 2020 2020 2020 2020 2027  1,.            '
-0000a210: 6372 6561 7465 2073 686f 756c 6420 696e  create should in
-0000a220: 6372 6561 7365 2074 6865 206e 756d 6265  crease the numbe
-0000a230: 7220 6f66 2064 6f63 756d 656e 7473 2729  r of documents')
-0000a240: 0a0a 2020 2020 2020 2020 2320 7570 6461  ..        # upda
-0000a250: 7465 2064 6f63 756d 656e 740a 2020 2020  te document.    
-0000a260: 2020 2020 6372 6561 7465 645f 646f 6375      created_docu
-0000a270: 6d65 6e74 5b27 6e61 6d65 275d 203d 2027  ment['name'] = '
-0000a280: 7265 706c 6163 6564 2064 6f63 756d 656e  replaced documen
-0000a290: 7427 0a20 2020 2020 2020 2063 7265 6174  t'.        creat
-0000a2a0: 6564 5f64 6f63 756d 656e 745b 2773 7061  ed_document['spa
-0000a2b0: 6d27 5d20 3d20 276e 6f74 2065 6767 7327  m'] = 'not eggs'
-0000a2c0: 0a0a 2020 2020 2020 2020 2320 7368 6f75  ..        # shou
-0000a2d0: 6c64 2072 6570 6c61 6365 2064 6f63 756d  ld replace docum
-0000a2e0: 656e 7420 7369 6e63 6520 6974 2061 6c72  ent since it alr
-0000a2f0: 6561 6479 2065 7869 7374 730a 2020 2020  eady exists.    
-0000a300: 2020 2020 7570 7365 7274 6564 5f64 6f63      upserted_doc
-0000a310: 756d 656e 7420 3d20 6372 6561 7465 645f  ument = created_
-0000a320: 636f 6c6c 6563 7469 6f6e 2e75 7073 6572  collection.upser
-0000a330: 745f 6974 656d 2862 6f64 793d 6372 6561  t_item(body=crea
-0000a340: 7465 645f 646f 6375 6d65 6e74 290a 0a20  ted_document).. 
-0000a350: 2020 2020 2020 2023 2076 6572 6966 7920         # verify 
-0000a360: 7468 6520 6368 616e 6765 6420 7072 6f70  the changed prop
-0000a370: 6572 7469 6573 0a20 2020 2020 2020 2073  erties.        s
-0000a380: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000a390: 7570 7365 7274 6564 5f64 6f63 756d 656e  upserted_documen
-0000a3a0: 745b 276e 616d 6527 5d2c 0a20 2020 2020  t['name'],.     
+0000a040: 2020 2020 2020 646f 6375 6d65 6e74 5f64        document_d
+0000a050: 6566 696e 6974 696f 6e5b 2769 6427 5d29  efinition['id'])
+0000a060: 0a0a 2020 2020 2020 2020 2320 7465 7374  ..        # test
+0000a070: 2065 7272 6f72 2066 6f72 206e 6f6e 2d73   error for non-s
+0000a080: 7472 696e 6720 6964 0a20 2020 2020 2020  tring id.       
+0000a090: 2077 6974 6820 7079 7465 7374 2e72 6169   with pytest.rai
+0000a0a0: 7365 7328 5479 7065 4572 726f 7229 3a0a  ses(TypeError):.
+0000a0b0: 2020 2020 2020 2020 2020 2020 646f 6375              docu
+0000a0c0: 6d65 6e74 5f64 6566 696e 6974 696f 6e5b  ment_definition[
+0000a0d0: 2769 6427 5d20 3d20 370a 2020 2020 2020  'id'] = 7.      
+0000a0e0: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
+0000a0f0: 6c6c 6563 7469 6f6e 2e75 7073 6572 745f  llection.upsert_
+0000a100: 6974 656d 2862 6f64 793d 646f 6375 6d65  item(body=docume
+0000a110: 6e74 5f64 6566 696e 6974 696f 6e29 0a0a  nt_definition)..
+0000a120: 2020 2020 2020 2020 2320 7265 6164 2064          # read d
+0000a130: 6f63 756d 656e 7473 2061 6674 6572 2063  ocuments after c
+0000a140: 7265 6174 696f 6e20 616e 6420 7665 7269  reation and veri
+0000a150: 6679 2075 7064 6174 6564 2063 6f75 6e74  fy updated count
+0000a160: 0a20 2020 2020 2020 2064 6f63 756d 656e  .        documen
+0000a170: 7473 203d 206c 6973 7428 6372 6561 7465  ts = list(create
+0000a180: 645f 636f 6c6c 6563 7469 6f6e 2e72 6561  d_collection.rea
+0000a190: 645f 616c 6c5f 6974 656d 7328 2929 0a20  d_all_items()). 
+0000a1a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000a1b0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+0000a1c0: 2020 2020 206c 656e 2864 6f63 756d 656e       len(documen
+0000a1d0: 7473 292c 0a20 2020 2020 2020 2020 2020  ts),.           
+0000a1e0: 2062 6566 6f72 655f 6372 6561 7465 5f64   before_create_d
+0000a1f0: 6f63 756d 656e 7473 5f63 6f75 6e74 202b  ocuments_count +
+0000a200: 2031 2c0a 2020 2020 2020 2020 2020 2020   1,.            
+0000a210: 2763 7265 6174 6520 7368 6f75 6c64 2069  'create should i
+0000a220: 6e63 7265 6173 6520 7468 6520 6e75 6d62  ncrease the numb
+0000a230: 6572 206f 6620 646f 6375 6d65 6e74 7327  er of documents'
+0000a240: 290a 0a20 2020 2020 2020 2023 2075 7064  )..        # upd
+0000a250: 6174 6520 646f 6375 6d65 6e74 0a20 2020  ate document.   
+0000a260: 2020 2020 2063 7265 6174 6564 5f64 6f63       created_doc
+0000a270: 756d 656e 745b 276e 616d 6527 5d20 3d20  ument['name'] = 
+0000a280: 2772 6570 6c61 6365 6420 646f 6375 6d65  'replaced docume
+0000a290: 6e74 270a 2020 2020 2020 2020 6372 6561  nt'.        crea
+0000a2a0: 7465 645f 646f 6375 6d65 6e74 5b27 7370  ted_document['sp
+0000a2b0: 616d 275d 203d 2027 6e6f 7420 6567 6773  am'] = 'not eggs
+0000a2c0: 270a 0a20 2020 2020 2020 2023 2073 686f  '..        # sho
+0000a2d0: 756c 6420 7265 706c 6163 6520 646f 6375  uld replace docu
+0000a2e0: 6d65 6e74 2073 696e 6365 2069 7420 616c  ment since it al
+0000a2f0: 7265 6164 7920 6578 6973 7473 0a20 2020  ready exists.   
+0000a300: 2020 2020 2075 7073 6572 7465 645f 646f       upserted_do
+0000a310: 6375 6d65 6e74 203d 2063 7265 6174 6564  cument = created
+0000a320: 5f63 6f6c 6c65 6374 696f 6e2e 7570 7365  _collection.upse
+0000a330: 7274 5f69 7465 6d28 626f 6479 3d63 7265  rt_item(body=cre
+0000a340: 6174 6564 5f64 6f63 756d 656e 7429 0a0a  ated_document)..
+0000a350: 2020 2020 2020 2020 2320 7665 7269 6679          # verify
+0000a360: 2074 6865 2063 6861 6e67 6564 2070 726f   the changed pro
+0000a370: 7065 7274 6965 730a 2020 2020 2020 2020  perties.        
+0000a380: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000a390: 2875 7073 6572 7465 645f 646f 6375 6d65  (upserted_docume
+0000a3a0: 6e74 5b27 6e61 6d65 275d 2c0a 2020 2020  nt['name'],.    
 0000a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3c0: 2020 2020 6372 6561 7465 645f 646f 6375      created_docu
-0000a3d0: 6d65 6e74 5b27 6e61 6d65 275d 2c0a 2020  ment['name'],.  
+0000a3c0: 2020 2020 2063 7265 6174 6564 5f64 6f63       created_doc
+0000a3d0: 756d 656e 745b 276e 616d 6527 5d2c 0a20  ument['name'],. 
 0000a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3f0: 2020 2020 2020 2027 646f 6375 6d65 6e74         'document
-0000a400: 206e 616d 6520 7072 6f70 6572 7479 2073   name property s
-0000a410: 686f 756c 6420 6368 616e 6765 2729 0a20  hould change'). 
-0000a420: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000a430: 7274 4571 7561 6c28 7570 7365 7274 6564  rtEqual(upserted
-0000a440: 5f64 6f63 756d 656e 745b 2773 7061 6d27  _document['spam'
-0000a450: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0000a460: 2020 2020 2020 2020 2020 2020 6372 6561              crea
-0000a470: 7465 645f 646f 6375 6d65 6e74 5b27 7370  ted_document['sp
-0000a480: 616d 275d 2c0a 2020 2020 2020 2020 2020  am'],.          
-0000a490: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000a4a0: 7072 6f70 6572 7479 2073 686f 756c 6420  property should 
-0000a4b0: 6861 7665 2063 6861 6e67 6564 2729 0a0a  have changed')..
-0000a4c0: 2020 2020 2020 2020 2320 7665 7269 6679          # verify
-0000a4d0: 2069 6420 7072 6f70 6572 7479 0a20 2020   id property.   
-0000a4e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000a4f0: 4571 7561 6c28 7570 7365 7274 6564 5f64  Equal(upserted_d
-0000a500: 6f63 756d 656e 745b 2769 6427 5d2c 0a20  ocument['id'],. 
+0000a3f0: 2020 2020 2020 2020 2764 6f63 756d 656e          'documen
+0000a400: 7420 6e61 6d65 2070 726f 7065 7274 7920  t name property 
+0000a410: 7368 6f75 6c64 2063 6861 6e67 6527 290a  should change').
+0000a420: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000a430: 6572 7445 7175 616c 2875 7073 6572 7465  ertEqual(upserte
+0000a440: 645f 646f 6375 6d65 6e74 5b27 7370 616d  d_document['spam
+0000a450: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+0000a460: 2020 2020 2020 2020 2020 2020 2063 7265               cre
+0000a470: 6174 6564 5f64 6f63 756d 656e 745b 2773  ated_document['s
+0000a480: 7061 6d27 5d2c 0a20 2020 2020 2020 2020  pam'],.         
+0000a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4a0: 2770 726f 7065 7274 7920 7368 6f75 6c64  'property should
+0000a4b0: 2068 6176 6520 6368 616e 6765 6427 290a   have changed').
+0000a4c0: 0a20 2020 2020 2020 2023 2076 6572 6966  .        # verif
+0000a4d0: 7920 6964 2070 726f 7065 7274 790a 2020  y id property.  
+0000a4e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000a4f0: 7445 7175 616c 2875 7073 6572 7465 645f  tEqual(upserted_
+0000a500: 646f 6375 6d65 6e74 5b27 6964 275d 2c0a  document['id'],.
 0000a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a520: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-0000a530: 646f 6375 6d65 6e74 5b27 6964 275d 2c0a  document['id'],.
-0000a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a550: 2020 2020 2020 2020 2027 646f 6375 6d65           'docume
-0000a560: 6e74 2069 6420 7368 6f75 6c64 2073 7461  nt id should sta
-0000a570: 7920 7468 6520 7361 6d65 2729 0a0a 2020  y the same')..  
-0000a580: 2020 2020 2020 2320 7265 6164 2064 6f63        # read doc
-0000a590: 756d 656e 7473 2061 6674 6572 2075 7073  uments after ups
-0000a5a0: 6572 7420 616e 6420 7665 7269 6679 2063  ert and verify c
-0000a5b0: 6f75 6e74 2064 6f65 736e 2774 2069 6e63  ount doesn't inc
-0000a5c0: 7265 6173 6573 2061 6761 696e 0a20 2020  reases again.   
-0000a5d0: 2020 2020 2064 6f63 756d 656e 7473 203d       documents =
-0000a5e0: 206c 6973 7428 6372 6561 7465 645f 636f   list(created_co
-0000a5f0: 6c6c 6563 7469 6f6e 2e72 6561 645f 616c  llection.read_al
-0000a600: 6c5f 6974 656d 7328 2929 0a20 2020 2020  l_items()).     
-0000a610: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000a620: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-0000a630: 206c 656e 2864 6f63 756d 656e 7473 292c   len(documents),
-0000a640: 0a20 2020 2020 2020 2020 2020 2062 6566  .            bef
-0000a650: 6f72 655f 6372 6561 7465 5f64 6f63 756d  ore_create_docum
-0000a660: 656e 7473 5f63 6f75 6e74 202b 2031 2c0a  ents_count + 1,.
-0000a670: 2020 2020 2020 2020 2020 2020 276e 756d              'num
-0000a680: 6265 7220 6f66 2064 6f63 756d 656e 7473  ber of documents
-0000a690: 2073 686f 756c 6420 7265 6d61 696e 2073   should remain s
-0000a6a0: 616d 6527 290a 0a20 2020 2020 2020 2063  ame')..        c
-0000a6b0: 7265 6174 6564 5f64 6f63 756d 656e 745b  reated_document[
-0000a6c0: 2769 6427 5d20 3d20 276e 6577 2069 6427  'id'] = 'new id'
-0000a6d0: 0a0a 2020 2020 2020 2020 2320 5570 7365  ..        # Upse
-0000a6e0: 7274 2073 686f 756c 6420 6372 6561 7465  rt should create
-0000a6f0: 206e 6577 2064 6f63 756d 656e 7420 7369   new document si
-0000a700: 6e63 6520 7468 6520 6964 2069 7320 6469  nce the id is di
-0000a710: 6666 6572 656e 740a 2020 2020 2020 2020  fferent.        
-0000a720: 6e65 775f 646f 6375 6d65 6e74 203d 2063  new_document = c
-0000a730: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
-0000a740: 6e2e 7570 7365 7274 5f69 7465 6d28 626f  n.upsert_item(bo
-0000a750: 6479 3d63 7265 6174 6564 5f64 6f63 756d  dy=created_docum
-0000a760: 656e 7429 0a0a 2020 2020 2020 2020 2320  ent)..        # 
-0000a770: 5465 7374 206d 6f64 6966 6965 6420 6163  Test modified ac
-0000a780: 6365 7373 2063 6f6e 6469 7469 6f6e 730a  cess conditions.
-0000a790: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-0000a7a0: 646f 6375 6d65 6e74 5b27 7370 616d 275d  document['spam']
-0000a7b0: 203d 2027 6d6f 7265 2065 6767 7327 0a20   = 'more eggs'. 
-0000a7c0: 2020 2020 2020 2063 7265 6174 6564 5f63         created_c
-0000a7d0: 6f6c 6c65 6374 696f 6e2e 7570 7365 7274  ollection.upsert
-0000a7e0: 5f69 7465 6d28 626f 6479 3d63 7265 6174  _item(body=creat
-0000a7f0: 6564 5f64 6f63 756d 656e 7429 0a20 2020  ed_document).   
-0000a800: 2020 2020 2077 6974 6820 7079 7465 7374       with pytest
-0000a810: 2e72 6169 7365 7328 6578 6365 7074 696f  .raises(exceptio
-0000a820: 6e73 2e43 6f73 6d6f 7348 7474 7052 6573  ns.CosmosHttpRes
-0000a830: 706f 6e73 6545 7272 6f72 293a 0a20 2020  ponseError):.   
-0000a840: 2020 2020 2020 2020 2063 7265 6174 6564           created
-0000a850: 5f63 6f6c 6c65 6374 696f 6e2e 7570 7365  _collection.upse
-0000a860: 7274 5f69 7465 6d28 0a20 2020 2020 2020  rt_item(.       
-0000a870: 2020 2020 2020 2020 2062 6f64 793d 6372           body=cr
-0000a880: 6561 7465 645f 646f 6375 6d65 6e74 2c0a  eated_document,.
-0000a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a8a0: 6d61 7463 685f 636f 6e64 6974 696f 6e3d  match_condition=
-0000a8b0: 4d61 7463 6843 6f6e 6469 7469 6f6e 732e  MatchConditions.
-0000a8c0: 4966 4e6f 744d 6f64 6966 6965 642c 0a20  IfNotModified,. 
-0000a8d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000a8e0: 7461 673d 6e65 775f 646f 6375 6d65 6e74  tag=new_document
-0000a8f0: 5b27 5f65 7461 6727 5d29 0a0a 2020 2020  ['_etag'])..    
-0000a900: 2020 2020 2320 7665 7269 6679 2069 6420      # verify id 
-0000a910: 7072 6f70 6572 7479 0a20 2020 2020 2020  property.       
-0000a920: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000a930: 6c28 6372 6561 7465 645f 646f 6375 6d65  l(created_docume
-0000a940: 6e74 5b27 6964 275d 2c0a 2020 2020 2020  nt['id'],.      
+0000a520: 2020 2020 2020 2020 2063 7265 6174 6564           created
+0000a530: 5f64 6f63 756d 656e 745b 2769 6427 5d2c  _document['id'],
+0000a540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a550: 2020 2020 2020 2020 2020 2764 6f63 756d            'docum
+0000a560: 656e 7420 6964 2073 686f 756c 6420 7374  ent id should st
+0000a570: 6179 2074 6865 2073 616d 6527 290a 0a20  ay the same').. 
+0000a580: 2020 2020 2020 2023 2072 6561 6420 646f         # read do
+0000a590: 6375 6d65 6e74 7320 6166 7465 7220 7570  cuments after up
+0000a5a0: 7365 7274 2061 6e64 2076 6572 6966 7920  sert and verify 
+0000a5b0: 636f 756e 7420 646f 6573 6e27 7420 696e  count doesn't in
+0000a5c0: 6372 6561 7365 7320 6167 6169 6e0a 2020  creases again.  
+0000a5d0: 2020 2020 2020 646f 6375 6d65 6e74 7320        documents 
+0000a5e0: 3d20 6c69 7374 2863 7265 6174 6564 5f63  = list(created_c
+0000a5f0: 6f6c 6c65 6374 696f 6e2e 7265 6164 5f61  ollection.read_a
+0000a600: 6c6c 5f69 7465 6d73 2829 290a 2020 2020  ll_items()).    
+0000a610: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000a620: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
+0000a630: 2020 6c65 6e28 646f 6375 6d65 6e74 7329    len(documents)
+0000a640: 2c0a 2020 2020 2020 2020 2020 2020 6265  ,.            be
+0000a650: 666f 7265 5f63 7265 6174 655f 646f 6375  fore_create_docu
+0000a660: 6d65 6e74 735f 636f 756e 7420 2b20 312c  ments_count + 1,
+0000a670: 0a20 2020 2020 2020 2020 2020 2027 6e75  .            'nu
+0000a680: 6d62 6572 206f 6620 646f 6375 6d65 6e74  mber of document
+0000a690: 7320 7368 6f75 6c64 2072 656d 6169 6e20  s should remain 
+0000a6a0: 7361 6d65 2729 0a0a 2020 2020 2020 2020  same')..        
+0000a6b0: 6372 6561 7465 645f 646f 6375 6d65 6e74  created_document
+0000a6c0: 5b27 6964 275d 203d 2027 6e65 7720 6964  ['id'] = 'new id
+0000a6d0: 270a 0a20 2020 2020 2020 2023 2055 7073  '..        # Ups
+0000a6e0: 6572 7420 7368 6f75 6c64 2063 7265 6174  ert should creat
+0000a6f0: 6520 6e65 7720 646f 6375 6d65 6e74 2073  e new document s
+0000a700: 696e 6365 2074 6865 2069 6420 6973 2064  ince the id is d
+0000a710: 6966 6665 7265 6e74 0a20 2020 2020 2020  ifferent.       
+0000a720: 206e 6577 5f64 6f63 756d 656e 7420 3d20   new_document = 
+0000a730: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
+0000a740: 6f6e 2e75 7073 6572 745f 6974 656d 2862  on.upsert_item(b
+0000a750: 6f64 793d 6372 6561 7465 645f 646f 6375  ody=created_docu
+0000a760: 6d65 6e74 290a 0a20 2020 2020 2020 2023  ment)..        #
+0000a770: 2054 6573 7420 6d6f 6469 6669 6564 2061   Test modified a
+0000a780: 6363 6573 7320 636f 6e64 6974 696f 6e73  ccess conditions
+0000a790: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+0000a7a0: 5f64 6f63 756d 656e 745b 2773 7061 6d27  _document['spam'
+0000a7b0: 5d20 3d20 276d 6f72 6520 6567 6773 270a  ] = 'more eggs'.
+0000a7c0: 2020 2020 2020 2020 6372 6561 7465 645f          created_
+0000a7d0: 636f 6c6c 6563 7469 6f6e 2e75 7073 6572  collection.upser
+0000a7e0: 745f 6974 656d 2862 6f64 793d 6372 6561  t_item(body=crea
+0000a7f0: 7465 645f 646f 6375 6d65 6e74 290a 2020  ted_document).  
+0000a800: 2020 2020 2020 7769 7468 2070 7974 6573        with pytes
+0000a810: 742e 7261 6973 6573 2865 7863 6570 7469  t.raises(excepti
+0000a820: 6f6e 732e 436f 736d 6f73 4874 7470 5265  ons.CosmosHttpRe
+0000a830: 7370 6f6e 7365 4572 726f 7229 3a0a 2020  sponseError):.  
+0000a840: 2020 2020 2020 2020 2020 6372 6561 7465            create
+0000a850: 645f 636f 6c6c 6563 7469 6f6e 2e75 7073  d_collection.ups
+0000a860: 6572 745f 6974 656d 280a 2020 2020 2020  ert_item(.      
+0000a870: 2020 2020 2020 2020 2020 626f 6479 3d63            body=c
+0000a880: 7265 6174 6564 5f64 6f63 756d 656e 742c  reated_document,
+0000a890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a8a0: 206d 6174 6368 5f63 6f6e 6469 7469 6f6e   match_condition
+0000a8b0: 3d4d 6174 6368 436f 6e64 6974 696f 6e73  =MatchConditions
+0000a8c0: 2e49 664e 6f74 4d6f 6469 6669 6564 2c0a  .IfNotModified,.
+0000a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8e0: 6574 6167 3d6e 6577 5f64 6f63 756d 656e  etag=new_documen
+0000a8f0: 745b 275f 6574 6167 275d 290a 0a20 2020  t['_etag'])..   
+0000a900: 2020 2020 2023 2076 6572 6966 7920 6964       # verify id
+0000a910: 2070 726f 7065 7274 790a 2020 2020 2020   property.      
+0000a920: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000a930: 616c 2863 7265 6174 6564 5f64 6f63 756d  al(created_docum
+0000a940: 656e 745b 2769 6427 5d2c 0a20 2020 2020  ent['id'],.     
 0000a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a960: 2020 206e 6577 5f64 6f63 756d 656e 745b     new_document[
-0000a970: 2769 6427 5d2c 0a20 2020 2020 2020 2020  'id'],.         
+0000a960: 2020 2020 6e65 775f 646f 6375 6d65 6e74      new_document
+0000a970: 5b27 6964 275d 2c0a 2020 2020 2020 2020  ['id'],.        
 0000a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a990: 2764 6f63 756d 656e 7420 6964 2073 686f  'document id sho
-0000a9a0: 756c 6420 6265 2073 616d 6527 290a 0a20  uld be same').. 
-0000a9b0: 2020 2020 2020 2023 2072 6561 6420 646f         # read do
-0000a9c0: 6375 6d65 6e74 7320 6166 7465 7220 7570  cuments after up
-0000a9d0: 7365 7274 2061 6e64 2076 6572 6966 7920  sert and verify 
-0000a9e0: 636f 756e 7420 696e 6372 6561 7365 730a  count increases.
-0000a9f0: 2020 2020 2020 2020 646f 6375 6d65 6e74          document
-0000aa00: 7320 3d20 6c69 7374 2863 7265 6174 6564  s = list(created
-0000aa10: 5f63 6f6c 6c65 6374 696f 6e2e 7265 6164  _collection.read
-0000aa20: 5f61 6c6c 5f69 7465 6d73 2829 290a 2020  _all_items()).  
-0000aa30: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000aa40: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-0000aa50: 2020 2020 6c65 6e28 646f 6375 6d65 6e74      len(document
-0000aa60: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
-0000aa70: 6265 666f 7265 5f63 7265 6174 655f 646f  before_create_do
-0000aa80: 6375 6d65 6e74 735f 636f 756e 7420 2b20  cuments_count + 
-0000aa90: 322c 0a20 2020 2020 2020 2020 2020 2027  2,.            '
-0000aaa0: 7570 7365 7274 2073 686f 756c 6420 696e  upsert should in
-0000aab0: 6372 6561 7365 2074 6865 206e 756d 6265  crease the numbe
-0000aac0: 7220 6f66 2064 6f63 756d 656e 7473 2729  r of documents')
-0000aad0: 0a0a 2020 2020 2020 2020 2320 6465 6c65  ..        # dele
-0000aae0: 7465 2064 6f63 756d 656e 7473 0a20 2020  te documents.   
-0000aaf0: 2020 2020 2063 7265 6174 6564 5f63 6f6c       created_col
-0000ab00: 6c65 6374 696f 6e2e 6465 6c65 7465 5f69  lection.delete_i
-0000ab10: 7465 6d28 6974 656d 3d75 7073 6572 7465  tem(item=upserte
-0000ab20: 645f 646f 6375 6d65 6e74 2c20 7061 7274  d_document, part
-0000ab30: 6974 696f 6e5f 6b65 793d 7570 7365 7274  ition_key=upsert
-0000ab40: 6564 5f64 6f63 756d 656e 745b 2769 6427  ed_document['id'
-0000ab50: 5d29 0a20 2020 2020 2020 2063 7265 6174  ]).        creat
-0000ab60: 6564 5f63 6f6c 6c65 6374 696f 6e2e 6465  ed_collection.de
-0000ab70: 6c65 7465 5f69 7465 6d28 6974 656d 3d6e  lete_item(item=n
-0000ab80: 6577 5f64 6f63 756d 656e 742c 2070 6172  ew_document, par
-0000ab90: 7469 7469 6f6e 5f6b 6579 3d6e 6577 5f64  tition_key=new_d
-0000aba0: 6f63 756d 656e 745b 2769 6427 5d29 0a0a  ocument['id'])..
-0000abb0: 2020 2020 2020 2020 2320 7265 6164 2064          # read d
-0000abc0: 6f63 756d 656e 7473 2061 6674 6572 2064  ocuments after d
-0000abd0: 656c 6574 6520 616e 6420 7665 7269 6679  elete and verify
-0000abe0: 2063 6f75 6e74 2069 7320 7361 6d65 2061   count is same a
-0000abf0: 7320 6f72 6967 696e 616c 0a20 2020 2020  s original.     
-0000ac00: 2020 2064 6f63 756d 656e 7473 203d 206c     documents = l
-0000ac10: 6973 7428 6372 6561 7465 645f 636f 6c6c  ist(created_coll
-0000ac20: 6563 7469 6f6e 2e72 6561 645f 616c 6c5f  ection.read_all_
-0000ac30: 6974 656d 7328 2929 0a20 2020 2020 2020  items()).       
-0000ac40: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000ac50: 6c28 0a20 2020 2020 2020 2020 2020 206c  l(.            l
-0000ac60: 656e 2864 6f63 756d 656e 7473 292c 0a20  en(documents),. 
-0000ac70: 2020 2020 2020 2020 2020 2062 6566 6f72             befor
-0000ac80: 655f 6372 6561 7465 5f64 6f63 756d 656e  e_create_documen
-0000ac90: 7473 5f63 6f75 6e74 2c0a 2020 2020 2020  ts_count,.      
-0000aca0: 2020 2020 2020 276e 756d 6265 7220 6f66        'number of
-0000acb0: 2064 6f63 756d 656e 7473 2073 686f 756c   documents shoul
-0000acc0: 6420 7265 6d61 696e 2073 616d 6527 290a  d remain same').
-0000acd0: 0a0a 2020 2020 6465 6620 5f74 6573 745f  ..    def _test_
-0000ace0: 7370 6174 6961 6c5f 696e 6465 7828 7365  spatial_index(se
-0000acf0: 6c66 293a 0a20 2020 2020 2020 2064 6220  lf):.        db 
-0000ad00: 3d20 7365 6c66 2e64 6174 6162 6173 6546  = self.databaseF
-0000ad10: 6f72 5465 7374 0a20 2020 2020 2020 2023  orTest.        #
-0000ad20: 2070 6172 7469 616c 2070 6f6c 6963 7920   partial policy 
-0000ad30: 7370 6563 6966 6965 640a 2020 2020 2020  specified.      
-0000ad40: 2020 636f 6c6c 6563 7469 6f6e 203d 2064    collection = d
-0000ad50: 622e 6372 6561 7465 5f63 6f6e 7461 696e  b.create_contain
-0000ad60: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
-0000ad70: 6964 3d27 636f 6c6c 6563 7469 6f6e 2077  id='collection w
-0000ad80: 6974 6820 7370 6174 6961 6c20 696e 6465  ith spatial inde
-0000ad90: 7820 2720 2b20 7374 7228 7575 6964 2e75  x ' + str(uuid.u
-0000ada0: 7569 6434 2829 292c 0a20 2020 2020 2020  uid4()),.       
-0000adb0: 2020 2020 2069 6e64 6578 696e 675f 706f       indexing_po
-0000adc0: 6c69 6379 3d7b 0a20 2020 2020 2020 2020  licy={.         
+0000a990: 2027 646f 6375 6d65 6e74 2069 6420 7368   'document id sh
+0000a9a0: 6f75 6c64 2062 6520 7361 6d65 2729 0a0a  ould be same')..
+0000a9b0: 2020 2020 2020 2020 2320 7265 6164 2064          # read d
+0000a9c0: 6f63 756d 656e 7473 2061 6674 6572 2075  ocuments after u
+0000a9d0: 7073 6572 7420 616e 6420 7665 7269 6679  psert and verify
+0000a9e0: 2063 6f75 6e74 2069 6e63 7265 6173 6573   count increases
+0000a9f0: 0a20 2020 2020 2020 2064 6f63 756d 656e  .        documen
+0000aa00: 7473 203d 206c 6973 7428 6372 6561 7465  ts = list(create
+0000aa10: 645f 636f 6c6c 6563 7469 6f6e 2e72 6561  d_collection.rea
+0000aa20: 645f 616c 6c5f 6974 656d 7328 2929 0a20  d_all_items()). 
+0000aa30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000aa40: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+0000aa50: 2020 2020 206c 656e 2864 6f63 756d 656e       len(documen
+0000aa60: 7473 292c 0a20 2020 2020 2020 2020 2020  ts),.           
+0000aa70: 2062 6566 6f72 655f 6372 6561 7465 5f64   before_create_d
+0000aa80: 6f63 756d 656e 7473 5f63 6f75 6e74 202b  ocuments_count +
+0000aa90: 2032 2c0a 2020 2020 2020 2020 2020 2020   2,.            
+0000aaa0: 2775 7073 6572 7420 7368 6f75 6c64 2069  'upsert should i
+0000aab0: 6e63 7265 6173 6520 7468 6520 6e75 6d62  ncrease the numb
+0000aac0: 6572 206f 6620 646f 6375 6d65 6e74 7327  er of documents'
+0000aad0: 290a 0a20 2020 2020 2020 2023 2064 656c  )..        # del
+0000aae0: 6574 6520 646f 6375 6d65 6e74 730a 2020  ete documents.  
+0000aaf0: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
+0000ab00: 6c6c 6563 7469 6f6e 2e64 656c 6574 655f  llection.delete_
+0000ab10: 6974 656d 2869 7465 6d3d 7570 7365 7274  item(item=upsert
+0000ab20: 6564 5f64 6f63 756d 656e 742c 2070 6172  ed_document, par
+0000ab30: 7469 7469 6f6e 5f6b 6579 3d75 7073 6572  tition_key=upser
+0000ab40: 7465 645f 646f 6375 6d65 6e74 5b27 6964  ted_document['id
+0000ab50: 275d 290a 2020 2020 2020 2020 6372 6561  ']).        crea
+0000ab60: 7465 645f 636f 6c6c 6563 7469 6f6e 2e64  ted_collection.d
+0000ab70: 656c 6574 655f 6974 656d 2869 7465 6d3d  elete_item(item=
+0000ab80: 6e65 775f 646f 6375 6d65 6e74 2c20 7061  new_document, pa
+0000ab90: 7274 6974 696f 6e5f 6b65 793d 6e65 775f  rtition_key=new_
+0000aba0: 646f 6375 6d65 6e74 5b27 6964 275d 290a  document['id']).
+0000abb0: 0a20 2020 2020 2020 2023 2072 6561 6420  .        # read 
+0000abc0: 646f 6375 6d65 6e74 7320 6166 7465 7220  documents after 
+0000abd0: 6465 6c65 7465 2061 6e64 2076 6572 6966  delete and verif
+0000abe0: 7920 636f 756e 7420 6973 2073 616d 6520  y count is same 
+0000abf0: 6173 206f 7269 6769 6e61 6c0a 2020 2020  as original.    
+0000ac00: 2020 2020 646f 6375 6d65 6e74 7320 3d20      documents = 
+0000ac10: 6c69 7374 2863 7265 6174 6564 5f63 6f6c  list(created_col
+0000ac20: 6c65 6374 696f 6e2e 7265 6164 5f61 6c6c  lection.read_all
+0000ac30: 5f69 7465 6d73 2829 290a 2020 2020 2020  _items()).      
+0000ac40: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000ac50: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+0000ac60: 6c65 6e28 646f 6375 6d65 6e74 7329 2c0a  len(documents),.
+0000ac70: 2020 2020 2020 2020 2020 2020 6265 666f              befo
+0000ac80: 7265 5f63 7265 6174 655f 646f 6375 6d65  re_create_docume
+0000ac90: 6e74 735f 636f 756e 742c 0a20 2020 2020  nts_count,.     
+0000aca0: 2020 2020 2020 2027 6e75 6d62 6572 206f         'number o
+0000acb0: 6620 646f 6375 6d65 6e74 7320 7368 6f75  f documents shou
+0000acc0: 6c64 2072 656d 6169 6e20 7361 6d65 2729  ld remain same')
+0000acd0: 0a0a 0a20 2020 2064 6566 205f 7465 7374  ...    def _test
+0000ace0: 5f73 7061 7469 616c 5f69 6e64 6578 2873  _spatial_index(s
+0000acf0: 656c 6629 3a0a 2020 2020 2020 2020 6462  elf):.        db
+0000ad00: 203d 2073 656c 662e 6461 7461 6261 7365   = self.database
+0000ad10: 466f 7254 6573 740a 2020 2020 2020 2020  ForTest.        
+0000ad20: 2320 7061 7274 6961 6c20 706f 6c69 6379  # partial policy
+0000ad30: 2073 7065 6369 6669 6564 0a20 2020 2020   specified.     
+0000ad40: 2020 2063 6f6c 6c65 6374 696f 6e20 3d20     collection = 
+0000ad50: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
+0000ad60: 6e65 7228 0a20 2020 2020 2020 2020 2020  ner(.           
+0000ad70: 2069 643d 2763 6f6c 6c65 6374 696f 6e20   id='collection 
+0000ad80: 7769 7468 2073 7061 7469 616c 2069 6e64  with spatial ind
+0000ad90: 6578 2027 202b 2073 7472 2875 7569 642e  ex ' + str(uuid.
+0000ada0: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
+0000adb0: 2020 2020 2020 696e 6465 7869 6e67 5f70        indexing_p
+0000adc0: 6f6c 6963 793d 7b0a 2020 2020 2020 2020  olicy={.        
 0000add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ade0: 2020 2027 696e 636c 7564 6564 5061 7468     'includedPath
-0000adf0: 7327 3a20 5b0a 2020 2020 2020 2020 2020  s': [.          
+0000ade0: 2020 2020 2769 6e63 6c75 6465 6450 6174      'includedPat
+0000adf0: 6873 273a 205b 0a20 2020 2020 2020 2020  hs': [.         
 0000ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae10: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
+0000ae10: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
 0000ae20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae30: 2020 2020 2020 2020 2020 2020 2770 6174              'pat
-0000ae40: 6827 3a20 272f 224c 6f63 6174 696f 6e22  h': '/"Location"
-0000ae50: 2f3f 272c 0a20 2020 2020 2020 2020 2020  /?',.           
+0000ae30: 2020 2020 2020 2020 2020 2020 2027 7061               'pa
+0000ae40: 7468 273a 2027 2f22 4c6f 6361 7469 6f6e  th': '/"Location
+0000ae50: 222f 3f27 2c0a 2020 2020 2020 2020 2020  "/?',.          
 0000ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae70: 2020 2020 2020 2020 2027 696e 6465 7865           'indexe
-0000ae80: 7327 3a20 5b0a 2020 2020 2020 2020 2020  s': [.          
+0000ae70: 2020 2020 2020 2020 2020 2769 6e64 6578            'index
+0000ae80: 6573 273a 205b 0a20 2020 2020 2020 2020  es': [.         
 0000ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aea0: 2020 2020 2020 2020 2020 2020 2020 7b0a                {.
-0000aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aea0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
+0000aeb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0000aec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aed0: 2020 2020 2020 2020 276b 696e 6427 3a20          'kind': 
-0000aee0: 2753 7061 7469 616c 272c 0a20 2020 2020  'Spatial',.     
+0000aed0: 2020 2020 2020 2020 2027 6b69 6e64 273a           'kind':
+0000aee0: 2027 5370 6174 6961 6c27 2c0a 2020 2020   'Spatial',.    
 0000aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af10: 2020 2027 6461 7461 5479 7065 273a 2027     'dataType': '
-0000af20: 506f 696e 7427 0a20 2020 2020 2020 2020  Point'.         
+0000af10: 2020 2020 2764 6174 6154 7970 6527 3a20      'dataType': 
+0000af20: 2750 6f69 6e74 270a 2020 2020 2020 2020  'Point'.        
 0000af30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af40: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-0000af50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af50: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
 0000af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af70: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
+0000af70: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
 0000af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af90: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
+0000af90: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
 0000afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afb0: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
+0000afb0: 2020 2020 2020 2020 2020 207b 0a20 2020             {.   
 0000afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afd0: 2020 2020 2020 2020 2020 2020 2770 6174              'pat
-0000afe0: 6827 3a20 272f 270a 2020 2020 2020 2020  h': '/'.        
+0000afd0: 2020 2020 2020 2020 2020 2020 2027 7061               'pa
+0000afe0: 7468 273a 2027 2f27 0a20 2020 2020 2020  th': '/'.       
 0000aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b000: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0000b000: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
 0000b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b020: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+0000b020: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
 0000b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b040: 7d2c 0a20 2020 2020 2020 2020 2020 2070  },.            p
-0000b050: 6172 7469 7469 6f6e 5f6b 6579 3d50 6172  artition_key=Par
-0000b060: 7469 7469 6f6e 4b65 7928 7061 7468 3d27  titionKey(path='
-0000b070: 2f69 6427 2c20 6b69 6e64 3d27 4861 7368  /id', kind='Hash
-0000b080: 2729 0a20 2020 2020 2020 2020 2020 2029  ').            )
-0000b090: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
-0000b0a0: 696f 6e2e 6372 6561 7465 5f69 7465 6d28  ion.create_item(
-0000b0b0: 0a20 2020 2020 2020 2020 2020 2062 6f64  .            bod
-0000b0c0: 793d 7b0a 2020 2020 2020 2020 2020 2020  y={.            
-0000b0d0: 2020 2020 2027 6964 273a 2027 6c6f 6331       'id': 'loc1
-0000b0e0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0000b0f0: 2020 2020 274c 6f63 6174 696f 6e27 3a20      'Location': 
-0000b100: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0000b110: 2020 2020 2020 2774 7970 6527 3a20 2750        'type': 'P
-0000b120: 6f69 6e74 272c 0a20 2020 2020 2020 2020  oint',.         
-0000b130: 2020 2020 2020 2020 2020 2027 636f 6f72             'coor
-0000b140: 6469 6e61 7465 7327 3a20 5b32 302e 302c  dinates': [20.0,
-0000b150: 2032 302e 305d 0a20 2020 2020 2020 2020   20.0].         
-0000b160: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0000b170: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0000b180: 290a 2020 2020 2020 2020 636f 6c6c 6563  ).        collec
-0000b190: 7469 6f6e 2e63 7265 6174 655f 6974 656d  tion.create_item
-0000b1a0: 280a 2020 2020 2020 2020 2020 2020 626f  (.            bo
-0000b1b0: 6479 3d7b 0a20 2020 2020 2020 2020 2020  dy={.           
-0000b1c0: 2020 2020 2027 6964 273a 2027 6c6f 6332       'id': 'loc2
-0000b1d0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0000b1e0: 2020 2027 4c6f 6361 7469 6f6e 273a 207b     'Location': {
-0000b1f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b200: 2020 2020 2027 7479 7065 273a 2027 506f       'type': 'Po
-0000b210: 696e 7427 2c0a 2020 2020 2020 2020 2020  int',.          
-0000b220: 2020 2020 2020 2020 2020 2763 6f6f 7264            'coord
-0000b230: 696e 6174 6573 273a 205b 3130 302e 302c  inates': [100.0,
-0000b240: 2031 3030 2e30 5d0a 2020 2020 2020 2020   100.0].        
-0000b250: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0000b260: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0000b270: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-0000b280: 7320 3d20 6c69 7374 2863 6f6c 6c65 6374  s = list(collect
-0000b290: 696f 6e2e 7175 6572 795f 6974 656d 7328  ion.query_items(
-0000b2a0: 0a20 2020 2020 2020 2020 2020 2071 7565  .            que
-0000b2b0: 7279 3d22 5345 4c45 4354 202a 2046 524f  ry="SELECT * FRO
-0000b2c0: 4d20 726f 6f74 2057 4845 5245 2028 5354  M root WHERE (ST
-0000b2d0: 5f44 4953 5441 4e43 4528 726f 6f74 2e4c  _DISTANCE(root.L
-0000b2e0: 6f63 6174 696f 6e2c 207b 7479 7065 3a20  ocation, {type: 
-0000b2f0: 2750 6f69 6e74 272c 2063 6f6f 7264 696e  'Point', coordin
-0000b300: 6174 6573 3a20 5b32 302e 312c 2032 305d  ates: [20.1, 20]
-0000b310: 7d29 203c 2032 3030 3030 2922 2c0a 2020  }) < 20000)",.  
-0000b320: 2020 2020 2020 2020 2020 656e 6162 6c65            enable
-0000b330: 5f63 726f 7373 5f70 6172 7469 7469 6f6e  _cross_partition
-0000b340: 5f71 7565 7279 3d54 7275 650a 2020 2020  _query=True.    
-0000b350: 2020 2020 2929 0a20 2020 2020 2020 2073      )).        s
-0000b360: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000b370: 312c 206c 656e 2872 6573 756c 7473 2929  1, len(results))
-0000b380: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000b390: 7365 7274 4571 7561 6c28 276c 6f63 3127  sertEqual('loc1'
-0000b3a0: 2c20 7265 7375 6c74 735b 305d 5b27 6964  , results[0]['id
-0000b3b0: 275d 290a 0a20 2020 2020 2020 2064 622e  '])..        db.
-0000b3c0: 6465 6c65 7465 5f63 6f6e 7461 696e 6572  delete_container
-0000b3d0: 2863 6f6e 7461 696e 6572 3d63 6f6c 6c65  (container=colle
-0000b3e0: 6374 696f 6e29 0a0a 2020 2020 2320 4352  ction)..    # CR
-0000b3f0: 5544 2074 6573 7420 666f 7220 5573 6572  UD test for User
-0000b400: 2072 6573 6f75 7263 650a 2020 2020 6465   resource.    de
-0000b410: 6620 7465 7374 5f75 7365 725f 6372 7564  f test_user_crud
-0000b420: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000b430: 2320 5368 6f75 6c64 2064 6f20 5573 6572  # Should do User
-0000b440: 2043 5255 4420 6f70 6572 6174 696f 6e73   CRUD operations
-0000b450: 2073 7563 6365 7373 6675 6c6c 792e 0a20   successfully.. 
-0000b460: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
-0000b470: 6461 7461 6261 7365 0a20 2020 2020 2020  database.       
-0000b480: 2064 6220 3d20 7365 6c66 2e64 6174 6162   db = self.datab
-0000b490: 6173 6546 6f72 5465 7374 0a20 2020 2020  aseForTest.     
-0000b4a0: 2020 2023 206c 6973 7420 7573 6572 730a     # list users.
-0000b4b0: 2020 2020 2020 2020 7573 6572 7320 3d20          users = 
-0000b4c0: 6c69 7374 2864 622e 6c69 7374 5f75 7365  list(db.list_use
-0000b4d0: 7273 2829 290a 2020 2020 2020 2020 6265  rs()).        be
-0000b4e0: 666f 7265 5f63 7265 6174 655f 636f 756e  fore_create_coun
-0000b4f0: 7420 3d20 6c65 6e28 7573 6572 7329 0a20  t = len(users). 
-0000b500: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
-0000b510: 7573 6572 0a20 2020 2020 2020 2075 7365  user.        use
-0000b520: 725f 6964 203d 2027 6e65 7720 7573 6572  r_id = 'new user
-0000b530: 2720 2b20 7374 7228 7575 6964 2e75 7569  ' + str(uuid.uui
-0000b540: 6434 2829 290a 2020 2020 2020 2020 7573  d4()).        us
-0000b550: 6572 203d 2064 622e 6372 6561 7465 5f75  er = db.create_u
-0000b560: 7365 7228 626f 6479 3d7b 2769 6427 3a20  ser(body={'id': 
-0000b570: 7573 6572 5f69 647d 290a 2020 2020 2020  user_id}).      
-0000b580: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000b590: 616c 2875 7365 722e 6964 2c20 7573 6572  al(user.id, user
-0000b5a0: 5f69 642c 2027 7573 6572 2069 6420 6572  _id, 'user id er
-0000b5b0: 726f 7227 290a 2020 2020 2020 2020 2320  ror').        # 
-0000b5c0: 6c69 7374 2075 7365 7273 2061 6674 6572  list users after
-0000b5d0: 2063 7265 6174 696f 6e0a 2020 2020 2020   creation.      
-0000b5e0: 2020 7573 6572 7320 3d20 6c69 7374 2864    users = list(d
-0000b5f0: 622e 6c69 7374 5f75 7365 7273 2829 290a  b.list_users()).
-0000b600: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000b610: 6572 7445 7175 616c 286c 656e 2875 7365  ertEqual(len(use
-0000b620: 7273 292c 2062 6566 6f72 655f 6372 6561  rs), before_crea
-0000b630: 7465 5f63 6f75 6e74 202b 2031 290a 2020  te_count + 1).  
-0000b640: 2020 2020 2020 2320 7175 6572 7920 7573        # query us
-0000b650: 6572 730a 2020 2020 2020 2020 7265 7375  ers.        resu
-0000b660: 6c74 7320 3d20 6c69 7374 2864 622e 7175  lts = list(db.qu
-0000b670: 6572 795f 7573 6572 7328 0a20 2020 2020  ery_users(.     
-0000b680: 2020 2020 2020 2020 2020 2071 7565 7279             query
-0000b690: 3d27 5345 4c45 4354 202a 2046 524f 4d20  ='SELECT * FROM 
-0000b6a0: 726f 6f74 2072 2057 4845 5245 2072 2e69  root r WHERE r.i
-0000b6b0: 643d 4069 6427 2c0a 2020 2020 2020 2020  d=@id',.        
-0000b6c0: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
-0000b6d0: 7273 3d5b 0a20 2020 2020 2020 2020 2020  rs=[.           
-0000b6e0: 2020 2020 2020 2020 207b 276e 616d 6527           {'name'
-0000b6f0: 3a20 2740 6964 272c 2027 7661 6c75 6527  : '@id', 'value'
-0000b700: 3a20 7573 6572 5f69 647d 0a20 2020 2020  : user_id}.     
-0000b710: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-0000b720: 2020 2020 2029 290a 2020 2020 2020 2020       )).        
-0000b730: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
-0000b740: 7265 7375 6c74 7329 0a0a 2020 2020 2020  results)..      
-0000b750: 2020 2320 7265 706c 6163 6520 7573 6572    # replace user
-0000b760: 0a20 2020 2020 2020 2072 6570 6c61 6365  .        replace
-0000b770: 645f 7573 6572 5f69 6420 3d20 2772 6570  d_user_id = 'rep
-0000b780: 6c61 6365 6420 7573 6572 2720 2b20 7374  laced user' + st
-0000b790: 7228 7575 6964 2e75 7569 6434 2829 290a  r(uuid.uuid4()).
-0000b7a0: 2020 2020 2020 2020 7573 6572 5f70 726f          user_pro
-0000b7b0: 7065 7274 6965 7320 3d20 7573 6572 2e72  perties = user.r
-0000b7c0: 6561 6428 290a 2020 2020 2020 2020 7573  ead().        us
-0000b7d0: 6572 5f70 726f 7065 7274 6965 735b 2769  er_properties['i
-0000b7e0: 6427 5d20 3d20 7265 706c 6163 6564 5f75  d'] = replaced_u
-0000b7f0: 7365 725f 6964 0a20 2020 2020 2020 2072  ser_id.        r
-0000b800: 6570 6c61 6365 645f 7573 6572 203d 2064  eplaced_user = d
-0000b810: 622e 7265 706c 6163 655f 7573 6572 2875  b.replace_user(u
-0000b820: 7365 725f 6964 2c20 7573 6572 5f70 726f  ser_id, user_pro
-0000b830: 7065 7274 6965 7329 0a20 2020 2020 2020  perties).       
-0000b840: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000b850: 6c28 7265 706c 6163 6564 5f75 7365 722e  l(replaced_user.
-0000b860: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-0000b870: 2020 2020 2020 2020 2020 2020 2072 6570               rep
-0000b880: 6c61 6365 645f 7573 6572 5f69 642c 0a20  laced_user_id,. 
+0000b040: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
+0000b050: 7061 7274 6974 696f 6e5f 6b65 793d 5061  partition_key=Pa
+0000b060: 7274 6974 696f 6e4b 6579 2870 6174 683d  rtitionKey(path=
+0000b070: 272f 6964 272c 206b 696e 643d 2748 6173  '/id', kind='Has
+0000b080: 6827 290a 2020 2020 2020 2020 2020 2020  h').            
+0000b090: 290a 2020 2020 2020 2020 636f 6c6c 6563  ).        collec
+0000b0a0: 7469 6f6e 2e63 7265 6174 655f 6974 656d  tion.create_item
+0000b0b0: 280a 2020 2020 2020 2020 2020 2020 626f  (.            bo
+0000b0c0: 6479 3d7b 0a20 2020 2020 2020 2020 2020  dy={.           
+0000b0d0: 2020 2020 2020 2769 6427 3a20 276c 6f63        'id': 'loc
+0000b0e0: 3127 2c0a 2020 2020 2020 2020 2020 2020  1',.            
+0000b0f0: 2020 2020 2027 4c6f 6361 7469 6f6e 273a       'Location':
+0000b100: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0000b110: 2020 2020 2020 2027 7479 7065 273a 2027         'type': '
+0000b120: 506f 696e 7427 2c0a 2020 2020 2020 2020  Point',.        
+0000b130: 2020 2020 2020 2020 2020 2020 2763 6f6f              'coo
+0000b140: 7264 696e 6174 6573 273a 205b 3230 2e30  rdinates': [20.0
+0000b150: 2c20 3230 2e30 5d0a 2020 2020 2020 2020  , 20.0].        
+0000b160: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+0000b170: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0000b180: 2029 0a20 2020 2020 2020 2063 6f6c 6c65   ).        colle
+0000b190: 6374 696f 6e2e 6372 6561 7465 5f69 7465  ction.create_ite
+0000b1a0: 6d28 0a20 2020 2020 2020 2020 2020 2062  m(.            b
+0000b1b0: 6f64 793d 7b0a 2020 2020 2020 2020 2020  ody={.          
+0000b1c0: 2020 2020 2020 2769 6427 3a20 276c 6f63        'id': 'loc
+0000b1d0: 3227 2c0a 2020 2020 2020 2020 2020 2020  2',.            
+0000b1e0: 2020 2020 274c 6f63 6174 696f 6e27 3a20      'Location': 
+0000b1f0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0000b200: 2020 2020 2020 2774 7970 6527 3a20 2750        'type': 'P
+0000b210: 6f69 6e74 272c 0a20 2020 2020 2020 2020  oint',.         
+0000b220: 2020 2020 2020 2020 2020 2027 636f 6f72             'coor
+0000b230: 6469 6e61 7465 7327 3a20 5b31 3030 2e30  dinates': [100.0
+0000b240: 2c20 3130 302e 305d 0a20 2020 2020 2020  , 100.0].       
+0000b250: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+0000b260: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0000b270: 2029 0a20 2020 2020 2020 2072 6573 756c   ).        resul
+0000b280: 7473 203d 206c 6973 7428 636f 6c6c 6563  ts = list(collec
+0000b290: 7469 6f6e 2e71 7565 7279 5f69 7465 6d73  tion.query_items
+0000b2a0: 280a 2020 2020 2020 2020 2020 2020 7175  (.            qu
+0000b2b0: 6572 793d 2253 454c 4543 5420 2a20 4652  ery="SELECT * FR
+0000b2c0: 4f4d 2072 6f6f 7420 5748 4552 4520 2853  OM root WHERE (S
+0000b2d0: 545f 4449 5354 414e 4345 2872 6f6f 742e  T_DISTANCE(root.
+0000b2e0: 4c6f 6361 7469 6f6e 2c20 7b74 7970 653a  Location, {type:
+0000b2f0: 2027 506f 696e 7427 2c20 636f 6f72 6469   'Point', coordi
+0000b300: 6e61 7465 733a 205b 3230 2e31 2c20 3230  nates: [20.1, 20
+0000b310: 5d7d 2920 3c20 3230 3030 3029 222c 0a20  ]}) < 20000)",. 
+0000b320: 2020 2020 2020 2020 2020 2065 6e61 626c             enabl
+0000b330: 655f 6372 6f73 735f 7061 7274 6974 696f  e_cross_partitio
+0000b340: 6e5f 7175 6572 793d 5472 7565 0a20 2020  n_query=True.   
+0000b350: 2020 2020 2029 290a 2020 2020 2020 2020       )).        
+0000b360: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000b370: 2831 2c20 6c65 6e28 7265 7375 6c74 7329  (1, len(results)
+0000b380: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000b390: 7373 6572 7445 7175 616c 2827 6c6f 6331  ssertEqual('loc1
+0000b3a0: 272c 2072 6573 756c 7473 5b30 5d5b 2769  ', results[0]['i
+0000b3b0: 6427 5d29 0a0a 2020 2020 2020 2020 6462  d'])..        db
+0000b3c0: 2e64 656c 6574 655f 636f 6e74 6169 6e65  .delete_containe
+0000b3d0: 7228 636f 6e74 6169 6e65 723d 636f 6c6c  r(container=coll
+0000b3e0: 6563 7469 6f6e 290a 0a20 2020 2023 2043  ection)..    # C
+0000b3f0: 5255 4420 7465 7374 2066 6f72 2055 7365  RUD test for Use
+0000b400: 7220 7265 736f 7572 6365 0a20 2020 2064  r resource.    d
+0000b410: 6566 2074 6573 745f 7573 6572 5f63 7275  ef test_user_cru
+0000b420: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
+0000b430: 2023 2053 686f 756c 6420 646f 2055 7365   # Should do Use
+0000b440: 7220 4352 5544 206f 7065 7261 7469 6f6e  r CRUD operation
+0000b450: 7320 7375 6363 6573 7366 756c 6c79 2e0a  s successfully..
+0000b460: 2020 2020 2020 2020 2320 6372 6561 7465          # create
+0000b470: 2064 6174 6162 6173 650a 2020 2020 2020   database.      
+0000b480: 2020 6462 203d 2073 656c 662e 6461 7461    db = self.data
+0000b490: 6261 7365 466f 7254 6573 740a 2020 2020  baseForTest.    
+0000b4a0: 2020 2020 2320 6c69 7374 2075 7365 7273      # list users
+0000b4b0: 0a20 2020 2020 2020 2075 7365 7273 203d  .        users =
+0000b4c0: 206c 6973 7428 6462 2e6c 6973 745f 7573   list(db.list_us
+0000b4d0: 6572 7328 2929 0a20 2020 2020 2020 2062  ers()).        b
+0000b4e0: 6566 6f72 655f 6372 6561 7465 5f63 6f75  efore_create_cou
+0000b4f0: 6e74 203d 206c 656e 2875 7365 7273 290a  nt = len(users).
+0000b500: 2020 2020 2020 2020 2320 6372 6561 7465          # create
+0000b510: 2075 7365 720a 2020 2020 2020 2020 7573   user.        us
+0000b520: 6572 5f69 6420 3d20 276e 6577 2075 7365  er_id = 'new use
+0000b530: 7227 202b 2073 7472 2875 7569 642e 7575  r' + str(uuid.uu
+0000b540: 6964 3428 2929 0a20 2020 2020 2020 2075  id4()).        u
+0000b550: 7365 7220 3d20 6462 2e63 7265 6174 655f  ser = db.create_
+0000b560: 7573 6572 2862 6f64 793d 7b27 6964 273a  user(body={'id':
+0000b570: 2075 7365 725f 6964 7d29 0a20 2020 2020   user_id}).     
+0000b580: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000b590: 7561 6c28 7573 6572 2e69 642c 2075 7365  ual(user.id, use
+0000b5a0: 725f 6964 2c20 2775 7365 7220 6964 2065  r_id, 'user id e
+0000b5b0: 7272 6f72 2729 0a20 2020 2020 2020 2023  rror').        #
+0000b5c0: 206c 6973 7420 7573 6572 7320 6166 7465   list users afte
+0000b5d0: 7220 6372 6561 7469 6f6e 0a20 2020 2020  r creation.     
+0000b5e0: 2020 2075 7365 7273 203d 206c 6973 7428     users = list(
+0000b5f0: 6462 2e6c 6973 745f 7573 6572 7328 2929  db.list_users())
+0000b600: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000b610: 7365 7274 4571 7561 6c28 6c65 6e28 7573  sertEqual(len(us
+0000b620: 6572 7329 2c20 6265 666f 7265 5f63 7265  ers), before_cre
+0000b630: 6174 655f 636f 756e 7420 2b20 3129 0a20  ate_count + 1). 
+0000b640: 2020 2020 2020 2023 2071 7565 7279 2075         # query u
+0000b650: 7365 7273 0a20 2020 2020 2020 2072 6573  sers.        res
+0000b660: 756c 7473 203d 206c 6973 7428 6462 2e71  ults = list(db.q
+0000b670: 7565 7279 5f75 7365 7273 280a 2020 2020  uery_users(.    
+0000b680: 2020 2020 2020 2020 2020 2020 7175 6572              quer
+0000b690: 793d 2753 454c 4543 5420 2a20 4652 4f4d  y='SELECT * FROM
+0000b6a0: 2072 6f6f 7420 7220 5748 4552 4520 722e   root r WHERE r.
+0000b6b0: 6964 3d40 6964 272c 0a20 2020 2020 2020  id=@id',.       
+0000b6c0: 2020 2020 2020 2020 2070 6172 616d 6574           paramet
+0000b6d0: 6572 733d 5b0a 2020 2020 2020 2020 2020  ers=[.          
+0000b6e0: 2020 2020 2020 2020 2020 7b27 6e61 6d65            {'name
+0000b6f0: 273a 2027 4069 6427 2c20 2776 616c 7565  ': '@id', 'value
+0000b700: 273a 2075 7365 725f 6964 7d0a 2020 2020  ': user_id}.    
+0000b710: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
+0000b720: 2020 2020 2020 2929 0a20 2020 2020 2020        )).       
+0000b730: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
+0000b740: 2872 6573 756c 7473 290a 0a20 2020 2020  (results)..     
+0000b750: 2020 2023 2072 6570 6c61 6365 2075 7365     # replace use
+0000b760: 720a 2020 2020 2020 2020 7265 706c 6163  r.        replac
+0000b770: 6564 5f75 7365 725f 6964 203d 2027 7265  ed_user_id = 're
+0000b780: 706c 6163 6564 2075 7365 7227 202b 2073  placed user' + s
+0000b790: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
+0000b7a0: 0a20 2020 2020 2020 2075 7365 725f 7072  .        user_pr
+0000b7b0: 6f70 6572 7469 6573 203d 2075 7365 722e  operties = user.
+0000b7c0: 7265 6164 2829 0a20 2020 2020 2020 2075  read().        u
+0000b7d0: 7365 725f 7072 6f70 6572 7469 6573 5b27  ser_properties['
+0000b7e0: 6964 275d 203d 2072 6570 6c61 6365 645f  id'] = replaced_
+0000b7f0: 7573 6572 5f69 640a 2020 2020 2020 2020  user_id.        
+0000b800: 7265 706c 6163 6564 5f75 7365 7220 3d20  replaced_user = 
+0000b810: 6462 2e72 6570 6c61 6365 5f75 7365 7228  db.replace_user(
+0000b820: 7573 6572 5f69 642c 2075 7365 725f 7072  user_id, user_pr
+0000b830: 6f70 6572 7469 6573 290a 2020 2020 2020  operties).      
+0000b840: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000b850: 616c 2872 6570 6c61 6365 645f 7573 6572  al(replaced_user
+0000b860: 2e69 642c 0a20 2020 2020 2020 2020 2020  .id,.           
+0000b870: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000b880: 706c 6163 6564 5f75 7365 725f 6964 2c0a  placed_user_id,.
 0000b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8a0: 2020 2020 2020 2020 2775 7365 7220 6964          'user id
-0000b8b0: 2073 686f 756c 6420 6368 616e 6765 2729   should change')
-0000b8c0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000b8d0: 7365 7274 4571 7561 6c28 7573 6572 5f70  sertEqual(user_p
-0000b8e0: 726f 7065 7274 6965 735b 2769 6427 5d2c  roperties['id'],
-0000b8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b900: 2020 2020 2020 2020 2020 7265 706c 6163            replac
-0000b910: 6564 5f75 7365 722e 6964 2c0a 2020 2020  ed_user.id,.    
+0000b8a0: 2020 2020 2020 2020 2027 7573 6572 2069           'user i
+0000b8b0: 6420 7368 6f75 6c64 2063 6861 6e67 6527  d should change'
+0000b8c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000b8d0: 7373 6572 7445 7175 616c 2875 7365 725f  ssertEqual(user_
+0000b8e0: 7072 6f70 6572 7469 6573 5b27 6964 275d  properties['id']
+0000b8f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b900: 2020 2020 2020 2020 2020 2072 6570 6c61             repla
+0000b910: 6365 645f 7573 6572 2e69 642c 0a20 2020  ced_user.id,.   
 0000b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b930: 2020 2020 2027 7573 6572 2069 6420 7368       'user id sh
-0000b940: 6f75 6c64 2073 7461 7920 7468 6520 7361  ould stay the sa
-0000b950: 6d65 2729 0a20 2020 2020 2020 2023 2072  me').        # r
-0000b960: 6561 6420 7573 6572 0a20 2020 2020 2020  ead user.       
-0000b970: 2075 7365 7220 3d20 6462 2e67 6574 5f75   user = db.get_u
-0000b980: 7365 725f 636c 6965 6e74 2872 6570 6c61  ser_client(repla
-0000b990: 6365 645f 7573 6572 2e69 6429 0a20 2020  ced_user.id).   
-0000b9a0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000b9b0: 4571 7561 6c28 7265 706c 6163 6564 5f75  Equal(replaced_u
-0000b9c0: 7365 722e 6964 2c20 7573 6572 2e69 6429  ser.id, user.id)
-0000b9d0: 0a20 2020 2020 2020 2023 2064 656c 6574  .        # delet
-0000b9e0: 6520 7573 6572 0a20 2020 2020 2020 2064  e user.        d
-0000b9f0: 622e 6465 6c65 7465 5f75 7365 7228 7573  b.delete_user(us
-0000ba00: 6572 2e69 6429 0a20 2020 2020 2020 2023  er.id).        #
-0000ba10: 2072 6561 6420 7573 6572 2061 6674 6572   read user after
-0000ba20: 2064 656c 6574 696f 6e0a 2020 2020 2020   deletion.      
-0000ba30: 2020 6465 6c65 7465 645f 7573 6572 203d    deleted_user =
-0000ba40: 2064 622e 6765 745f 7573 6572 5f63 6c69   db.get_user_cli
-0000ba50: 656e 7428 7573 6572 2e69 6429 0a20 2020  ent(user.id).   
-0000ba60: 2020 2020 2073 656c 662e 5f5f 4173 7365       self.__Asse
-0000ba70: 7274 4854 5450 4661 696c 7572 6557 6974  rtHTTPFailureWit
-0000ba80: 6853 7461 7475 7328 5374 6174 7573 436f  hStatus(StatusCo
-0000ba90: 6465 732e 4e4f 545f 464f 554e 442c 0a20  des.NOT_FOUND,. 
+0000b930: 2020 2020 2020 2775 7365 7220 6964 2073        'user id s
+0000b940: 686f 756c 6420 7374 6179 2074 6865 2073  hould stay the s
+0000b950: 616d 6527 290a 2020 2020 2020 2020 2320  ame').        # 
+0000b960: 7265 6164 2075 7365 720a 2020 2020 2020  read user.      
+0000b970: 2020 7573 6572 203d 2064 622e 6765 745f    user = db.get_
+0000b980: 7573 6572 5f63 6c69 656e 7428 7265 706c  user_client(repl
+0000b990: 6163 6564 5f75 7365 722e 6964 290a 2020  aced_user.id).  
+0000b9a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000b9b0: 7445 7175 616c 2872 6570 6c61 6365 645f  tEqual(replaced_
+0000b9c0: 7573 6572 2e69 642c 2075 7365 722e 6964  user.id, user.id
+0000b9d0: 290a 2020 2020 2020 2020 2320 6465 6c65  ).        # dele
+0000b9e0: 7465 2075 7365 720a 2020 2020 2020 2020  te user.        
+0000b9f0: 6462 2e64 656c 6574 655f 7573 6572 2875  db.delete_user(u
+0000ba00: 7365 722e 6964 290a 2020 2020 2020 2020  ser.id).        
+0000ba10: 2320 7265 6164 2075 7365 7220 6166 7465  # read user afte
+0000ba20: 7220 6465 6c65 7469 6f6e 0a20 2020 2020  r deletion.     
+0000ba30: 2020 2064 656c 6574 6564 5f75 7365 7220     deleted_user 
+0000ba40: 3d20 6462 2e67 6574 5f75 7365 725f 636c  = db.get_user_cl
+0000ba50: 6965 6e74 2875 7365 722e 6964 290a 2020  ient(user.id).  
+0000ba60: 2020 2020 2020 7365 6c66 2e5f 5f41 7373        self.__Ass
+0000ba70: 6572 7448 5454 5046 6169 6c75 7265 5769  ertHTTPFailureWi
+0000ba80: 7468 5374 6174 7573 2853 7461 7475 7343  thStatus(StatusC
+0000ba90: 6f64 6573 2e4e 4f54 5f46 4f55 4e44 2c0a  odes.NOT_FOUND,.
 0000baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bac0: 2020 2020 2020 2020 2020 6465 6c65 7465            delete
-0000bad0: 645f 7573 6572 2e72 6561 6429 0a0a 2020  d_user.read)..  
-0000bae0: 2020 6465 6620 7465 7374 5f75 7365 725f    def test_user_
-0000baf0: 7570 7365 7274 2873 656c 6629 3a0a 2020  upsert(self):.  
-0000bb00: 2020 2020 2020 2320 6372 6561 7465 2064        # create d
-0000bb10: 6174 6162 6173 650a 2020 2020 2020 2020  atabase.        
-0000bb20: 6462 203d 2073 656c 662e 6461 7461 6261  db = self.databa
-0000bb30: 7365 466f 7254 6573 740a 0a20 2020 2020  seForTest..     
-0000bb40: 2020 2023 2072 6561 6420 7573 6572 7320     # read users 
-0000bb50: 616e 6420 6368 6563 6b20 636f 756e 740a  and check count.
-0000bb60: 2020 2020 2020 2020 7573 6572 7320 3d20          users = 
-0000bb70: 6c69 7374 2864 622e 6c69 7374 5f75 7365  list(db.list_use
-0000bb80: 7273 2829 290a 2020 2020 2020 2020 6265  rs()).        be
-0000bb90: 666f 7265 5f63 7265 6174 655f 636f 756e  fore_create_coun
-0000bba0: 7420 3d20 6c65 6e28 7573 6572 7329 0a0a  t = len(users)..
-0000bbb0: 2020 2020 2020 2020 2320 6372 6561 7465          # create
-0000bbc0: 2075 7365 7220 7573 696e 6720 5570 7365   user using Upse
-0000bbd0: 7274 2041 5049 0a20 2020 2020 2020 2075  rt API.        u
-0000bbe0: 7365 725f 6964 203d 2027 7573 6572 2720  ser_id = 'user' 
-0000bbf0: 2b20 7374 7228 7575 6964 2e75 7569 6434  + str(uuid.uuid4
-0000bc00: 2829 290a 2020 2020 2020 2020 7573 6572  ()).        user
-0000bc10: 203d 2064 622e 7570 7365 7274 5f75 7365   = db.upsert_use
-0000bc20: 7228 626f 6479 3d7b 2769 6427 3a20 7573  r(body={'id': us
-0000bc30: 6572 5f69 647d 290a 0a20 2020 2020 2020  er_id})..       
-0000bc40: 2023 2076 6572 6966 7920 6964 2070 726f   # verify id pro
-0000bc50: 7065 7274 790a 2020 2020 2020 2020 7365  perty.        se
-0000bc60: 6c66 2e61 7373 6572 7445 7175 616c 2875  lf.assertEqual(u
-0000bc70: 7365 722e 6964 2c20 7573 6572 5f69 642c  ser.id, user_id,
-0000bc80: 2027 7573 6572 2069 6420 6572 726f 7227   'user id error'
-0000bc90: 290a 0a20 2020 2020 2020 2023 2072 6561  )..        # rea
-0000bca0: 6420 7573 6572 7320 6166 7465 7220 6372  d users after cr
-0000bcb0: 6561 7469 6f6e 2061 6e64 2076 6572 6966  eation and verif
-0000bcc0: 7920 7570 6461 7465 6420 636f 756e 740a  y updated count.
-0000bcd0: 2020 2020 2020 2020 7573 6572 7320 3d20          users = 
-0000bce0: 6c69 7374 2864 622e 6c69 7374 5f75 7365  list(db.list_use
-0000bcf0: 7273 2829 290a 2020 2020 2020 2020 7365  rs()).        se
-0000bd00: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-0000bd10: 656e 2875 7365 7273 292c 2062 6566 6f72  en(users), befor
-0000bd20: 655f 6372 6561 7465 5f63 6f75 6e74 202b  e_create_count +
-0000bd30: 2031 290a 0a20 2020 2020 2020 2023 2053   1)..        # S
-0000bd40: 686f 756c 6420 7265 706c 6163 6520 7468  hould replace th
-0000bd50: 6520 7573 6572 2073 696e 6365 2069 7420  e user since it 
-0000bd60: 616c 7265 6164 7920 6578 6973 7473 2c20  already exists, 
-0000bd70: 7468 6572 6520 6973 206e 6f20 7075 626c  there is no publ
-0000bd80: 6963 2070 726f 7065 7274 7920 746f 2063  ic property to c
-0000bd90: 6861 6e67 6520 6865 7265 0a20 2020 2020  hange here.     
-0000bda0: 2020 2075 7365 725f 7072 6f70 6572 7469     user_properti
-0000bdb0: 6573 203d 2075 7365 722e 7265 6164 2829  es = user.read()
-0000bdc0: 0a20 2020 2020 2020 2075 7073 6572 7465  .        upserte
-0000bdd0: 645f 7573 6572 203d 2064 622e 7570 7365  d_user = db.upse
-0000bde0: 7274 5f75 7365 7228 7573 6572 5f70 726f  rt_user(user_pro
-0000bdf0: 7065 7274 6965 7329 0a0a 2020 2020 2020  perties)..      
-0000be00: 2020 2320 7665 7269 6679 2069 6420 7072    # verify id pr
-0000be10: 6f70 6572 7479 0a20 2020 2020 2020 2073  operty.        s
-0000be20: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000be30: 7570 7365 7274 6564 5f75 7365 722e 6964  upserted_user.id
-0000be40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000be50: 2020 2020 2020 2020 2020 2075 7365 722e             user.
-0000be60: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-0000be70: 2020 2020 2020 2020 2020 2020 2027 7573               'us
-0000be80: 6572 2069 6420 7368 6f75 6c64 2072 656d  er id should rem
-0000be90: 6169 6e20 7361 6d65 2729 0a0a 2020 2020  ain same')..    
-0000bea0: 2020 2020 2320 7265 6164 2075 7365 7273      # read users
-0000beb0: 2061 6674 6572 2075 7073 6572 7420 616e   after upsert an
-0000bec0: 6420 7665 7269 6679 2063 6f75 6e74 2064  d verify count d
-0000bed0: 6f65 736e 2774 2069 6e63 7265 6173 6573  oesn't increases
-0000bee0: 2061 6761 696e 0a20 2020 2020 2020 2075   again.        u
-0000bef0: 7365 7273 203d 206c 6973 7428 6462 2e6c  sers = list(db.l
-0000bf00: 6973 745f 7573 6572 7328 2929 0a20 2020  ist_users()).   
-0000bf10: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000bf20: 4571 7561 6c28 6c65 6e28 7573 6572 7329  Equal(len(users)
-0000bf30: 2c20 6265 666f 7265 5f63 7265 6174 655f  , before_create_
-0000bf40: 636f 756e 7420 2b20 3129 0a0a 2020 2020  count + 1)..    
-0000bf50: 2020 2020 7573 6572 5f70 726f 7065 7274      user_propert
-0000bf60: 6965 7320 3d20 7573 6572 2e72 6561 6428  ies = user.read(
-0000bf70: 290a 2020 2020 2020 2020 7573 6572 5f70  ).        user_p
-0000bf80: 726f 7065 7274 6965 735b 2769 6427 5d20  roperties['id'] 
-0000bf90: 3d20 276e 6577 2075 7365 7227 202b 2073  = 'new user' + s
-0000bfa0: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
-0000bfb0: 0a20 2020 2020 2020 2075 7365 722e 6964  .        user.id
-0000bfc0: 203d 2075 7365 725f 7072 6f70 6572 7469   = user_properti
-0000bfd0: 6573 5b27 6964 275d 0a0a 2020 2020 2020  es['id']..      
-0000bfe0: 2020 2320 5570 7365 7274 2073 686f 756c    # Upsert shoul
-0000bff0: 6420 6372 6561 7465 206e 6577 2075 7365  d create new use
-0000c000: 7220 7369 6e63 6520 6964 2069 7320 6469  r since id is di
-0000c010: 6666 6572 656e 740a 2020 2020 2020 2020  fferent.        
-0000c020: 6e65 775f 7573 6572 203d 2064 622e 7570  new_user = db.up
-0000c030: 7365 7274 5f75 7365 7228 7573 6572 5f70  sert_user(user_p
-0000c040: 726f 7065 7274 6965 7329 0a0a 2020 2020  roperties)..    
-0000c050: 2020 2020 2320 7665 7269 6679 2069 6420      # verify id 
-0000c060: 7072 6f70 6572 7479 0a20 2020 2020 2020  property.       
-0000c070: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000c080: 6c28 6e65 775f 7573 6572 2e69 642c 2075  l(new_user.id, u
-0000c090: 7365 722e 6964 2c20 2775 7365 7220 6964  ser.id, 'user id
-0000c0a0: 2065 7272 6f72 2729 0a0a 2020 2020 2020   error')..      
-0000c0b0: 2020 2320 7265 6164 2075 7365 7273 2061    # read users a
-0000c0c0: 6674 6572 2075 7073 6572 7420 616e 6420  fter upsert and 
-0000c0d0: 7665 7269 6679 2063 6f75 6e74 2069 6e63  verify count inc
-0000c0e0: 7265 6173 6573 0a20 2020 2020 2020 2075  reases.        u
-0000c0f0: 7365 7273 203d 206c 6973 7428 6462 2e6c  sers = list(db.l
-0000c100: 6973 745f 7573 6572 7328 2929 0a20 2020  ist_users()).   
-0000c110: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000c120: 4571 7561 6c28 6c65 6e28 7573 6572 7329  Equal(len(users)
-0000c130: 2c20 6265 666f 7265 5f63 7265 6174 655f  , before_create_
-0000c140: 636f 756e 7420 2b20 3229 0a0a 2020 2020  count + 2)..    
-0000c150: 2020 2020 2320 6465 6c65 7465 2075 7365      # delete use
-0000c160: 7273 0a20 2020 2020 2020 2064 622e 6465  rs.        db.de
-0000c170: 6c65 7465 5f75 7365 7228 7570 7365 7274  lete_user(upsert
-0000c180: 6564 5f75 7365 722e 6964 290a 2020 2020  ed_user.id).    
-0000c190: 2020 2020 6462 2e64 656c 6574 655f 7573      db.delete_us
-0000c1a0: 6572 286e 6577 5f75 7365 722e 6964 290a  er(new_user.id).
-0000c1b0: 0a20 2020 2020 2020 2023 2072 6561 6420  .        # read 
-0000c1c0: 7573 6572 7320 6166 7465 7220 6465 6c65  users after dele
-0000c1d0: 7465 2061 6e64 2076 6572 6966 7920 636f  te and verify co
-0000c1e0: 756e 7420 7265 6d61 696e 7320 7468 6520  unt remains the 
-0000c1f0: 7361 6d65 0a20 2020 2020 2020 2075 7365  same.        use
-0000c200: 7273 203d 206c 6973 7428 6462 2e6c 6973  rs = list(db.lis
-0000c210: 745f 7573 6572 7328 2929 0a20 2020 2020  t_users()).     
-0000c220: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000c230: 7561 6c28 6c65 6e28 7573 6572 7329 2c20  ual(len(users), 
-0000c240: 6265 666f 7265 5f63 7265 6174 655f 636f  before_create_co
-0000c250: 756e 7429 0a0a 2020 2020 6465 6620 7465  unt)..    def te
-0000c260: 7374 5f70 6572 6d69 7373 696f 6e5f 6372  st_permission_cr
-0000c270: 7564 2873 656c 6629 3a0a 2020 2020 2020  ud(self):.      
-0000c280: 2020 2320 5368 6f75 6c64 2064 6f20 5065    # Should do Pe
-0000c290: 726d 6973 7369 6f6e 2043 5255 4420 6f70  rmission CRUD op
-0000c2a0: 6572 6174 696f 6e73 2073 7563 6365 7373  erations success
-0000c2b0: 6675 6c6c 790a 2020 2020 2020 2020 2320  fully.        # 
-0000c2c0: 6372 6561 7465 2064 6174 6162 6173 650a  create database.
-0000c2d0: 2020 2020 2020 2020 6462 203d 2073 656c          db = sel
-0000c2e0: 662e 6461 7461 6261 7365 466f 7254 6573  f.databaseForTes
-0000c2f0: 740a 2020 2020 2020 2020 2320 6372 6561  t.        # crea
-0000c300: 7465 2075 7365 720a 2020 2020 2020 2020  te user.        
-0000c310: 7573 6572 203d 2064 622e 6372 6561 7465  user = db.create
-0000c320: 5f75 7365 7228 626f 6479 3d7b 2769 6427  _user(body={'id'
-0000c330: 3a20 276e 6577 2075 7365 7227 202b 2073  : 'new user' + s
-0000c340: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
-0000c350: 7d29 0a20 2020 2020 2020 2023 206c 6973  }).        # lis
-0000c360: 7420 7065 726d 6973 7369 6f6e 730a 2020  t permissions.  
-0000c370: 2020 2020 2020 7065 726d 6973 7369 6f6e        permission
-0000c380: 7320 3d20 6c69 7374 2875 7365 722e 6c69  s = list(user.li
-0000c390: 7374 5f70 6572 6d69 7373 696f 6e73 2829  st_permissions()
-0000c3a0: 290a 2020 2020 2020 2020 6265 666f 7265  ).        before
-0000c3b0: 5f63 7265 6174 655f 636f 756e 7420 3d20  _create_count = 
-0000c3c0: 6c65 6e28 7065 726d 6973 7369 6f6e 7329  len(permissions)
-0000c3d0: 0a20 2020 2020 2020 2070 6572 6d69 7373  .        permiss
-0000c3e0: 696f 6e20 3d20 7b0a 2020 2020 2020 2020  ion = {.        
-0000c3f0: 2020 2020 2769 6427 3a20 276e 6577 2070      'id': 'new p
-0000c400: 6572 6d69 7373 696f 6e27 2c0a 2020 2020  ermission',.    
-0000c410: 2020 2020 2020 2020 2770 6572 6d69 7373          'permiss
-0000c420: 696f 6e4d 6f64 6527 3a20 646f 6375 6d65  ionMode': docume
-0000c430: 6e74 732e 5065 726d 6973 7369 6f6e 4d6f  nts.PermissionMo
-0000c440: 6465 2e52 6561 642c 0a20 2020 2020 2020  de.Read,.       
-0000c450: 2020 2020 2027 7265 736f 7572 6365 273a       'resource':
-0000c460: 2027 6462 732f 4151 4141 4141 3d3d 2f63   'dbs/AQAAAA==/c
-0000c470: 6f6c 6c73 2f41 5141 4141 4a30 6667 5463  olls/AQAAAJ0fgTc
-0000c480: 3d27 2020 2320 4120 7261 6e64 6f6d 206f  ='  # A random o
-0000c490: 6e65 2e0a 2020 2020 2020 2020 7d0a 2020  ne..        }.  
-0000c4a0: 2020 2020 2020 2320 6372 6561 7465 2070        # create p
-0000c4b0: 6572 6d69 7373 696f 6e0a 2020 2020 2020  ermission.      
-0000c4c0: 2020 7065 726d 6973 7369 6f6e 203d 2075    permission = u
-0000c4d0: 7365 722e 6372 6561 7465 5f70 6572 6d69  ser.create_permi
-0000c4e0: 7373 696f 6e28 7065 726d 6973 7369 6f6e  ssion(permission
-0000c4f0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000c500: 7373 6572 7445 7175 616c 2870 6572 6d69  ssertEqual(permi
-0000c510: 7373 696f 6e2e 6964 2c0a 2020 2020 2020  ssion.id,.      
+0000bac0: 2020 2020 2020 2020 2020 2064 656c 6574             delet
+0000bad0: 6564 5f75 7365 722e 7265 6164 290a 0a20  ed_user.read).. 
+0000bae0: 2020 2064 6566 2074 6573 745f 7573 6572     def test_user
+0000baf0: 5f75 7073 6572 7428 7365 6c66 293a 0a20  _upsert(self):. 
+0000bb00: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+0000bb10: 6461 7461 6261 7365 0a20 2020 2020 2020  database.       
+0000bb20: 2064 6220 3d20 7365 6c66 2e64 6174 6162   db = self.datab
+0000bb30: 6173 6546 6f72 5465 7374 0a0a 2020 2020  aseForTest..    
+0000bb40: 2020 2020 2320 7265 6164 2075 7365 7273      # read users
+0000bb50: 2061 6e64 2063 6865 636b 2063 6f75 6e74   and check count
+0000bb60: 0a20 2020 2020 2020 2075 7365 7273 203d  .        users =
+0000bb70: 206c 6973 7428 6462 2e6c 6973 745f 7573   list(db.list_us
+0000bb80: 6572 7328 2929 0a20 2020 2020 2020 2062  ers()).        b
+0000bb90: 6566 6f72 655f 6372 6561 7465 5f63 6f75  efore_create_cou
+0000bba0: 6e74 203d 206c 656e 2875 7365 7273 290a  nt = len(users).
+0000bbb0: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
+0000bbc0: 6520 7573 6572 2075 7369 6e67 2055 7073  e user using Ups
+0000bbd0: 6572 7420 4150 490a 2020 2020 2020 2020  ert API.        
+0000bbe0: 7573 6572 5f69 6420 3d20 2775 7365 7227  user_id = 'user'
+0000bbf0: 202b 2073 7472 2875 7569 642e 7575 6964   + str(uuid.uuid
+0000bc00: 3428 2929 0a20 2020 2020 2020 2075 7365  4()).        use
+0000bc10: 7220 3d20 6462 2e75 7073 6572 745f 7573  r = db.upsert_us
+0000bc20: 6572 2862 6f64 793d 7b27 6964 273a 2075  er(body={'id': u
+0000bc30: 7365 725f 6964 7d29 0a0a 2020 2020 2020  ser_id})..      
+0000bc40: 2020 2320 7665 7269 6679 2069 6420 7072    # verify id pr
+0000bc50: 6f70 6572 7479 0a20 2020 2020 2020 2073  operty.        s
+0000bc60: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000bc70: 7573 6572 2e69 642c 2075 7365 725f 6964  user.id, user_id
+0000bc80: 2c20 2775 7365 7220 6964 2065 7272 6f72  , 'user id error
+0000bc90: 2729 0a0a 2020 2020 2020 2020 2320 7265  ')..        # re
+0000bca0: 6164 2075 7365 7273 2061 6674 6572 2063  ad users after c
+0000bcb0: 7265 6174 696f 6e20 616e 6420 7665 7269  reation and veri
+0000bcc0: 6679 2075 7064 6174 6564 2063 6f75 6e74  fy updated count
+0000bcd0: 0a20 2020 2020 2020 2075 7365 7273 203d  .        users =
+0000bce0: 206c 6973 7428 6462 2e6c 6973 745f 7573   list(db.list_us
+0000bcf0: 6572 7328 2929 0a20 2020 2020 2020 2073  ers()).        s
+0000bd00: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000bd10: 6c65 6e28 7573 6572 7329 2c20 6265 666f  len(users), befo
+0000bd20: 7265 5f63 7265 6174 655f 636f 756e 7420  re_create_count 
+0000bd30: 2b20 3129 0a0a 2020 2020 2020 2020 2320  + 1)..        # 
+0000bd40: 5368 6f75 6c64 2072 6570 6c61 6365 2074  Should replace t
+0000bd50: 6865 2075 7365 7220 7369 6e63 6520 6974  he user since it
+0000bd60: 2061 6c72 6561 6479 2065 7869 7374 732c   already exists,
+0000bd70: 2074 6865 7265 2069 7320 6e6f 2070 7562   there is no pub
+0000bd80: 6c69 6320 7072 6f70 6572 7479 2074 6f20  lic property to 
+0000bd90: 6368 616e 6765 2068 6572 650a 2020 2020  change here.    
+0000bda0: 2020 2020 7573 6572 5f70 726f 7065 7274      user_propert
+0000bdb0: 6965 7320 3d20 7573 6572 2e72 6561 6428  ies = user.read(
+0000bdc0: 290a 2020 2020 2020 2020 7570 7365 7274  ).        upsert
+0000bdd0: 6564 5f75 7365 7220 3d20 6462 2e75 7073  ed_user = db.ups
+0000bde0: 6572 745f 7573 6572 2875 7365 725f 7072  ert_user(user_pr
+0000bdf0: 6f70 6572 7469 6573 290a 0a20 2020 2020  operties)..     
+0000be00: 2020 2023 2076 6572 6966 7920 6964 2070     # verify id p
+0000be10: 726f 7065 7274 790a 2020 2020 2020 2020  roperty.        
+0000be20: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000be30: 2875 7073 6572 7465 645f 7573 6572 2e69  (upserted_user.i
+0000be40: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+0000be50: 2020 2020 2020 2020 2020 2020 7573 6572              user
+0000be60: 2e69 642c 0a20 2020 2020 2020 2020 2020  .id,.           
+0000be70: 2020 2020 2020 2020 2020 2020 2020 2775                'u
+0000be80: 7365 7220 6964 2073 686f 756c 6420 7265  ser id should re
+0000be90: 6d61 696e 2073 616d 6527 290a 0a20 2020  main same')..   
+0000bea0: 2020 2020 2023 2072 6561 6420 7573 6572       # read user
+0000beb0: 7320 6166 7465 7220 7570 7365 7274 2061  s after upsert a
+0000bec0: 6e64 2076 6572 6966 7920 636f 756e 7420  nd verify count 
+0000bed0: 646f 6573 6e27 7420 696e 6372 6561 7365  doesn't increase
+0000bee0: 7320 6167 6169 6e0a 2020 2020 2020 2020  s again.        
+0000bef0: 7573 6572 7320 3d20 6c69 7374 2864 622e  users = list(db.
+0000bf00: 6c69 7374 5f75 7365 7273 2829 290a 2020  list_users()).  
+0000bf10: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000bf20: 7445 7175 616c 286c 656e 2875 7365 7273  tEqual(len(users
+0000bf30: 292c 2062 6566 6f72 655f 6372 6561 7465  ), before_create
+0000bf40: 5f63 6f75 6e74 202b 2031 290a 0a20 2020  _count + 1)..   
+0000bf50: 2020 2020 2075 7365 725f 7072 6f70 6572       user_proper
+0000bf60: 7469 6573 203d 2075 7365 722e 7265 6164  ties = user.read
+0000bf70: 2829 0a20 2020 2020 2020 2075 7365 725f  ().        user_
+0000bf80: 7072 6f70 6572 7469 6573 5b27 6964 275d  properties['id']
+0000bf90: 203d 2027 6e65 7720 7573 6572 2720 2b20   = 'new user' + 
+0000bfa0: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
+0000bfb0: 290a 2020 2020 2020 2020 7573 6572 2e69  ).        user.i
+0000bfc0: 6420 3d20 7573 6572 5f70 726f 7065 7274  d = user_propert
+0000bfd0: 6965 735b 2769 6427 5d0a 0a20 2020 2020  ies['id']..     
+0000bfe0: 2020 2023 2055 7073 6572 7420 7368 6f75     # Upsert shou
+0000bff0: 6c64 2063 7265 6174 6520 6e65 7720 7573  ld create new us
+0000c000: 6572 2073 696e 6365 2069 6420 6973 2064  er since id is d
+0000c010: 6966 6665 7265 6e74 0a20 2020 2020 2020  ifferent.       
+0000c020: 206e 6577 5f75 7365 7220 3d20 6462 2e75   new_user = db.u
+0000c030: 7073 6572 745f 7573 6572 2875 7365 725f  psert_user(user_
+0000c040: 7072 6f70 6572 7469 6573 290a 0a20 2020  properties)..   
+0000c050: 2020 2020 2023 2076 6572 6966 7920 6964       # verify id
+0000c060: 2070 726f 7065 7274 790a 2020 2020 2020   property.      
+0000c070: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000c080: 616c 286e 6577 5f75 7365 722e 6964 2c20  al(new_user.id, 
+0000c090: 7573 6572 2e69 642c 2027 7573 6572 2069  user.id, 'user i
+0000c0a0: 6420 6572 726f 7227 290a 0a20 2020 2020  d error')..     
+0000c0b0: 2020 2023 2072 6561 6420 7573 6572 7320     # read users 
+0000c0c0: 6166 7465 7220 7570 7365 7274 2061 6e64  after upsert and
+0000c0d0: 2076 6572 6966 7920 636f 756e 7420 696e   verify count in
+0000c0e0: 6372 6561 7365 730a 2020 2020 2020 2020  creases.        
+0000c0f0: 7573 6572 7320 3d20 6c69 7374 2864 622e  users = list(db.
+0000c100: 6c69 7374 5f75 7365 7273 2829 290a 2020  list_users()).  
+0000c110: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000c120: 7445 7175 616c 286c 656e 2875 7365 7273  tEqual(len(users
+0000c130: 292c 2062 6566 6f72 655f 6372 6561 7465  ), before_create
+0000c140: 5f63 6f75 6e74 202b 2032 290a 0a20 2020  _count + 2)..   
+0000c150: 2020 2020 2023 2064 656c 6574 6520 7573       # delete us
+0000c160: 6572 730a 2020 2020 2020 2020 6462 2e64  ers.        db.d
+0000c170: 656c 6574 655f 7573 6572 2875 7073 6572  elete_user(upser
+0000c180: 7465 645f 7573 6572 2e69 6429 0a20 2020  ted_user.id).   
+0000c190: 2020 2020 2064 622e 6465 6c65 7465 5f75       db.delete_u
+0000c1a0: 7365 7228 6e65 775f 7573 6572 2e69 6429  ser(new_user.id)
+0000c1b0: 0a0a 2020 2020 2020 2020 2320 7265 6164  ..        # read
+0000c1c0: 2075 7365 7273 2061 6674 6572 2064 656c   users after del
+0000c1d0: 6574 6520 616e 6420 7665 7269 6679 2063  ete and verify c
+0000c1e0: 6f75 6e74 2072 656d 6169 6e73 2074 6865  ount remains the
+0000c1f0: 2073 616d 650a 2020 2020 2020 2020 7573   same.        us
+0000c200: 6572 7320 3d20 6c69 7374 2864 622e 6c69  ers = list(db.li
+0000c210: 7374 5f75 7365 7273 2829 290a 2020 2020  st_users()).    
+0000c220: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000c230: 7175 616c 286c 656e 2875 7365 7273 292c  qual(len(users),
+0000c240: 2062 6566 6f72 655f 6372 6561 7465 5f63   before_create_c
+0000c250: 6f75 6e74 290a 0a20 2020 2064 6566 2074  ount)..    def t
+0000c260: 6573 745f 7065 726d 6973 7369 6f6e 5f63  est_permission_c
+0000c270: 7275 6428 7365 6c66 293a 0a20 2020 2020  rud(self):.     
+0000c280: 2020 2023 2053 686f 756c 6420 646f 2050     # Should do P
+0000c290: 6572 6d69 7373 696f 6e20 4352 5544 206f  ermission CRUD o
+0000c2a0: 7065 7261 7469 6f6e 7320 7375 6363 6573  perations succes
+0000c2b0: 7366 756c 6c79 0a20 2020 2020 2020 2023  sfully.        #
+0000c2c0: 2063 7265 6174 6520 6461 7461 6261 7365   create database
+0000c2d0: 0a20 2020 2020 2020 2064 6220 3d20 7365  .        db = se
+0000c2e0: 6c66 2e64 6174 6162 6173 6546 6f72 5465  lf.databaseForTe
+0000c2f0: 7374 0a20 2020 2020 2020 2023 2063 7265  st.        # cre
+0000c300: 6174 6520 7573 6572 0a20 2020 2020 2020  ate user.       
+0000c310: 2075 7365 7220 3d20 6462 2e63 7265 6174   user = db.creat
+0000c320: 655f 7573 6572 2862 6f64 793d 7b27 6964  e_user(body={'id
+0000c330: 273a 2027 6e65 7720 7573 6572 2720 2b20  ': 'new user' + 
+0000c340: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
+0000c350: 297d 290a 2020 2020 2020 2020 2320 6c69  )}).        # li
+0000c360: 7374 2070 6572 6d69 7373 696f 6e73 0a20  st permissions. 
+0000c370: 2020 2020 2020 2070 6572 6d69 7373 696f         permissio
+0000c380: 6e73 203d 206c 6973 7428 7573 6572 2e6c  ns = list(user.l
+0000c390: 6973 745f 7065 726d 6973 7369 6f6e 7328  ist_permissions(
+0000c3a0: 2929 0a20 2020 2020 2020 2062 6566 6f72  )).        befor
+0000c3b0: 655f 6372 6561 7465 5f63 6f75 6e74 203d  e_create_count =
+0000c3c0: 206c 656e 2870 6572 6d69 7373 696f 6e73   len(permissions
+0000c3d0: 290a 2020 2020 2020 2020 7065 726d 6973  ).        permis
+0000c3e0: 7369 6f6e 203d 207b 0a20 2020 2020 2020  sion = {.       
+0000c3f0: 2020 2020 2027 6964 273a 2027 6e65 7720       'id': 'new 
+0000c400: 7065 726d 6973 7369 6f6e 272c 0a20 2020  permission',.   
+0000c410: 2020 2020 2020 2020 2027 7065 726d 6973           'permis
+0000c420: 7369 6f6e 4d6f 6465 273a 2064 6f63 756d  sionMode': docum
+0000c430: 656e 7473 2e50 6572 6d69 7373 696f 6e4d  ents.PermissionM
+0000c440: 6f64 652e 5265 6164 2c0a 2020 2020 2020  ode.Read,.      
+0000c450: 2020 2020 2020 2772 6573 6f75 7263 6527        'resource'
+0000c460: 3a20 2764 6273 2f41 5141 4141 413d 3d2f  : 'dbs/AQAAAA==/
+0000c470: 636f 6c6c 732f 4151 4141 414a 3066 6754  colls/AQAAAJ0fgT
+0000c480: 633d 2720 2023 2041 2072 616e 646f 6d20  c='  # A random 
+0000c490: 6f6e 652e 0a20 2020 2020 2020 207d 0a20  one..        }. 
+0000c4a0: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+0000c4b0: 7065 726d 6973 7369 6f6e 0a20 2020 2020  permission.     
+0000c4c0: 2020 2070 6572 6d69 7373 696f 6e20 3d20     permission = 
+0000c4d0: 7573 6572 2e63 7265 6174 655f 7065 726d  user.create_perm
+0000c4e0: 6973 7369 6f6e 2870 6572 6d69 7373 696f  ission(permissio
+0000c4f0: 6e29 0a20 2020 2020 2020 2073 656c 662e  n).        self.
+0000c500: 6173 7365 7274 4571 7561 6c28 7065 726d  assertEqual(perm
+0000c510: 6973 7369 6f6e 2e69 642c 0a20 2020 2020  ission.id,.     
 0000c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c530: 2020 2027 6e65 7720 7065 726d 6973 7369     'new permissi
-0000c540: 6f6e 272c 0a20 2020 2020 2020 2020 2020  on',.           
-0000c550: 2020 2020 2020 2020 2020 2020 2020 2770                'p
-0000c560: 6572 6d69 7373 696f 6e20 6964 2065 7272  ermission id err
-0000c570: 6f72 2729 0a20 2020 2020 2020 2023 206c  or').        # l
-0000c580: 6973 7420 7065 726d 6973 7369 6f6e 7320  ist permissions 
-0000c590: 6166 7465 7220 6372 6561 7469 6f6e 0a20  after creation. 
-0000c5a0: 2020 2020 2020 2070 6572 6d69 7373 696f         permissio
-0000c5b0: 6e73 203d 206c 6973 7428 7573 6572 2e6c  ns = list(user.l
-0000c5c0: 6973 745f 7065 726d 6973 7369 6f6e 7328  ist_permissions(
-0000c5d0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-0000c5e0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-0000c5f0: 7065 726d 6973 7369 6f6e 7329 2c20 6265  permissions), be
-0000c600: 666f 7265 5f63 7265 6174 655f 636f 756e  fore_create_coun
-0000c610: 7420 2b20 3129 0a20 2020 2020 2020 2023  t + 1).        #
-0000c620: 2071 7565 7279 2070 6572 6d69 7373 696f   query permissio
-0000c630: 6e73 0a20 2020 2020 2020 2072 6573 756c  ns.        resul
-0000c640: 7473 203d 206c 6973 7428 7573 6572 2e71  ts = list(user.q
-0000c650: 7565 7279 5f70 6572 6d69 7373 696f 6e73  uery_permissions
-0000c660: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000c670: 2020 7175 6572 793d 2753 454c 4543 5420    query='SELECT 
-0000c680: 2a20 4652 4f4d 2072 6f6f 7420 7220 5748  * FROM root r WH
-0000c690: 4552 4520 722e 6964 3d40 6964 272c 0a20  ERE r.id=@id',. 
-0000c6a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000c6b0: 6172 616d 6574 6572 733d 5b0a 2020 2020  arameters=[.    
+0000c530: 2020 2020 276e 6577 2070 6572 6d69 7373      'new permiss
+0000c540: 696f 6e27 2c0a 2020 2020 2020 2020 2020  ion',.          
+0000c550: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0000c560: 7065 726d 6973 7369 6f6e 2069 6420 6572  permission id er
+0000c570: 726f 7227 290a 2020 2020 2020 2020 2320  ror').        # 
+0000c580: 6c69 7374 2070 6572 6d69 7373 696f 6e73  list permissions
+0000c590: 2061 6674 6572 2063 7265 6174 696f 6e0a   after creation.
+0000c5a0: 2020 2020 2020 2020 7065 726d 6973 7369          permissi
+0000c5b0: 6f6e 7320 3d20 6c69 7374 2875 7365 722e  ons = list(user.
+0000c5c0: 6c69 7374 5f70 6572 6d69 7373 696f 6e73  list_permissions
+0000c5d0: 2829 290a 2020 2020 2020 2020 7365 6c66  ()).        self
+0000c5e0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+0000c5f0: 2870 6572 6d69 7373 696f 6e73 292c 2062  (permissions), b
+0000c600: 6566 6f72 655f 6372 6561 7465 5f63 6f75  efore_create_cou
+0000c610: 6e74 202b 2031 290a 2020 2020 2020 2020  nt + 1).        
+0000c620: 2320 7175 6572 7920 7065 726d 6973 7369  # query permissi
+0000c630: 6f6e 730a 2020 2020 2020 2020 7265 7375  ons.        resu
+0000c640: 6c74 7320 3d20 6c69 7374 2875 7365 722e  lts = list(user.
+0000c650: 7175 6572 795f 7065 726d 6973 7369 6f6e  query_permission
+0000c660: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+0000c670: 2020 2071 7565 7279 3d27 5345 4c45 4354     query='SELECT
+0000c680: 202a 2046 524f 4d20 726f 6f74 2072 2057   * FROM root r W
+0000c690: 4845 5245 2072 2e69 643d 4069 6427 2c0a  HERE r.id=@id',.
+0000c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6b0: 7061 7261 6d65 7465 7273 3d5b 0a20 2020  parameters=[.   
 0000c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c6d0: 7b27 6e61 6d65 273a 2027 4069 6427 2c20  {'name': '@id', 
-0000c6e0: 2776 616c 7565 273a 2070 6572 6d69 7373  'value': permiss
-0000c6f0: 696f 6e2e 6964 7d0a 2020 2020 2020 2020  ion.id}.        
-0000c700: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-0000c710: 2020 2929 0a20 2020 2020 2020 2073 656c    )).        sel
-0000c720: 662e 6173 7365 7274 5472 7565 2872 6573  f.assertTrue(res
-0000c730: 756c 7473 290a 0a20 2020 2020 2020 2023  ults)..        #
-0000c740: 2072 6570 6c61 6365 2070 6572 6d69 7373   replace permiss
-0000c750: 696f 6e0a 2020 2020 2020 2020 6368 616e  ion.        chan
-0000c760: 6765 5f70 6572 6d69 7373 696f 6e20 3d20  ge_permission = 
-0000c770: 7065 726d 6973 7369 6f6e 2e70 726f 7065  permission.prope
-0000c780: 7274 6965 732e 636f 7079 2829 0a20 2020  rties.copy().   
-0000c790: 2020 2020 2070 6572 6d69 7373 696f 6e2e       permission.
-0000c7a0: 7072 6f70 6572 7469 6573 5b27 6964 275d  properties['id']
-0000c7b0: 203d 2027 7265 706c 6163 6564 2070 6572   = 'replaced per
-0000c7c0: 6d69 7373 696f 6e27 0a20 2020 2020 2020  mission'.       
-0000c7d0: 2070 6572 6d69 7373 696f 6e2e 6964 203d   permission.id =
-0000c7e0: 2070 6572 6d69 7373 696f 6e2e 7072 6f70   permission.prop
-0000c7f0: 6572 7469 6573 5b27 6964 275d 0a20 2020  erties['id'].   
-0000c800: 2020 2020 2072 6570 6c61 6365 645f 7065       replaced_pe
-0000c810: 726d 6973 7369 6f6e 203d 2075 7365 722e  rmission = user.
-0000c820: 7265 706c 6163 655f 7065 726d 6973 7369  replace_permissi
-0000c830: 6f6e 2863 6861 6e67 655f 7065 726d 6973  on(change_permis
-0000c840: 7369 6f6e 5b27 6964 275d 2c20 7065 726d  sion['id'], perm
-0000c850: 6973 7369 6f6e 2e70 726f 7065 7274 6965  ission.propertie
-0000c860: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-0000c870: 6173 7365 7274 4571 7561 6c28 7265 706c  assertEqual(repl
-0000c880: 6163 6564 5f70 6572 6d69 7373 696f 6e2e  aced_permission.
-0000c890: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-0000c8a0: 2020 2020 2020 2020 2020 2020 2027 7265               're
-0000c8b0: 706c 6163 6564 2070 6572 6d69 7373 696f  placed permissio
-0000c8c0: 6e27 2c0a 2020 2020 2020 2020 2020 2020  n',.            
-0000c8d0: 2020 2020 2020 2020 2020 2020 2027 7065               'pe
-0000c8e0: 726d 6973 7369 6f6e 2069 6420 7368 6f75  rmission id shou
-0000c8f0: 6c64 2063 6861 6e67 6527 290a 2020 2020  ld change').    
-0000c900: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000c910: 7175 616c 2870 6572 6d69 7373 696f 6e2e  qual(permission.
-0000c920: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-0000c930: 2020 2020 2020 2020 2020 2020 2072 6570               rep
-0000c940: 6c61 6365 645f 7065 726d 6973 7369 6f6e  laced_permission
-0000c950: 2e69 642c 0a20 2020 2020 2020 2020 2020  .id,.           
-0000c960: 2020 2020 2020 2020 2020 2020 2020 2770                'p
-0000c970: 6572 6d69 7373 696f 6e20 6964 2073 686f  ermission id sho
-0000c980: 756c 6420 7374 6179 2074 6865 2073 616d  uld stay the sam
-0000c990: 6527 290a 2020 2020 2020 2020 2320 7265  e').        # re
-0000c9a0: 6164 2070 6572 6d69 7373 696f 6e0a 2020  ad permission.  
-0000c9b0: 2020 2020 2020 7065 726d 6973 7369 6f6e        permission
-0000c9c0: 203d 2075 7365 722e 6765 745f 7065 726d   = user.get_perm
-0000c9d0: 6973 7369 6f6e 2872 6570 6c61 6365 645f  ission(replaced_
-0000c9e0: 7065 726d 6973 7369 6f6e 2e69 6429 0a20  permission.id). 
-0000c9f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000ca00: 7274 4571 7561 6c28 7265 706c 6163 6564  rtEqual(replaced
-0000ca10: 5f70 6572 6d69 7373 696f 6e2e 6964 2c20  _permission.id, 
-0000ca20: 7065 726d 6973 7369 6f6e 2e69 6429 0a20  permission.id). 
-0000ca30: 2020 2020 2020 2023 2064 656c 6574 6520         # delete 
-0000ca40: 7065 726d 6973 7369 6f6e 0a20 2020 2020  permission.     
-0000ca50: 2020 2075 7365 722e 6465 6c65 7465 5f70     user.delete_p
-0000ca60: 6572 6d69 7373 696f 6e28 7265 706c 6163  ermission(replac
-0000ca70: 6564 5f70 6572 6d69 7373 696f 6e2e 6964  ed_permission.id
-0000ca80: 290a 2020 2020 2020 2020 2320 7265 6164  ).        # read
-0000ca90: 2070 6572 6d69 7373 696f 6e20 6166 7465   permission afte
-0000caa0: 7220 6465 6c65 7469 6f6e 0a20 2020 2020  r deletion.     
-0000cab0: 2020 2073 656c 662e 5f5f 4173 7365 7274     self.__Assert
-0000cac0: 4854 5450 4661 696c 7572 6557 6974 6853  HTTPFailureWithS
-0000cad0: 7461 7475 7328 5374 6174 7573 436f 6465  tatus(StatusCode
-0000cae0: 732e 4e4f 545f 464f 554e 442c 0a20 2020  s.NOT_FOUND,.   
+0000c6d0: 207b 276e 616d 6527 3a20 2740 6964 272c   {'name': '@id',
+0000c6e0: 2027 7661 6c75 6527 3a20 7065 726d 6973   'value': permis
+0000c6f0: 7369 6f6e 2e69 647d 0a20 2020 2020 2020  sion.id}.       
+0000c700: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+0000c710: 2020 2029 290a 2020 2020 2020 2020 7365     )).        se
+0000c720: 6c66 2e61 7373 6572 7454 7275 6528 7265  lf.assertTrue(re
+0000c730: 7375 6c74 7329 0a0a 2020 2020 2020 2020  sults)..        
+0000c740: 2320 7265 706c 6163 6520 7065 726d 6973  # replace permis
+0000c750: 7369 6f6e 0a20 2020 2020 2020 2063 6861  sion.        cha
+0000c760: 6e67 655f 7065 726d 6973 7369 6f6e 203d  nge_permission =
+0000c770: 2070 6572 6d69 7373 696f 6e2e 7072 6f70   permission.prop
+0000c780: 6572 7469 6573 2e63 6f70 7928 290a 2020  erties.copy().  
+0000c790: 2020 2020 2020 7065 726d 6973 7369 6f6e        permission
+0000c7a0: 2e70 726f 7065 7274 6965 735b 2769 6427  .properties['id'
+0000c7b0: 5d20 3d20 2772 6570 6c61 6365 6420 7065  ] = 'replaced pe
+0000c7c0: 726d 6973 7369 6f6e 270a 2020 2020 2020  rmission'.      
+0000c7d0: 2020 7065 726d 6973 7369 6f6e 2e69 6420    permission.id 
+0000c7e0: 3d20 7065 726d 6973 7369 6f6e 2e70 726f  = permission.pro
+0000c7f0: 7065 7274 6965 735b 2769 6427 5d0a 2020  perties['id'].  
+0000c800: 2020 2020 2020 7265 706c 6163 6564 5f70        replaced_p
+0000c810: 6572 6d69 7373 696f 6e20 3d20 7573 6572  ermission = user
+0000c820: 2e72 6570 6c61 6365 5f70 6572 6d69 7373  .replace_permiss
+0000c830: 696f 6e28 6368 616e 6765 5f70 6572 6d69  ion(change_permi
+0000c840: 7373 696f 6e5b 2769 6427 5d2c 2070 6572  ssion['id'], per
+0000c850: 6d69 7373 696f 6e2e 7072 6f70 6572 7469  mission.properti
+0000c860: 6573 290a 2020 2020 2020 2020 7365 6c66  es).        self
+0000c870: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
+0000c880: 6c61 6365 645f 7065 726d 6973 7369 6f6e  laced_permission
+0000c890: 2e69 642c 0a20 2020 2020 2020 2020 2020  .id,.           
+0000c8a0: 2020 2020 2020 2020 2020 2020 2020 2772                'r
+0000c8b0: 6570 6c61 6365 6420 7065 726d 6973 7369  eplaced permissi
+0000c8c0: 6f6e 272c 0a20 2020 2020 2020 2020 2020  on',.           
+0000c8d0: 2020 2020 2020 2020 2020 2020 2020 2770                'p
+0000c8e0: 6572 6d69 7373 696f 6e20 6964 2073 686f  ermission id sho
+0000c8f0: 756c 6420 6368 616e 6765 2729 0a20 2020  uld change').   
+0000c900: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000c910: 4571 7561 6c28 7065 726d 6973 7369 6f6e  Equal(permission
+0000c920: 2e69 642c 0a20 2020 2020 2020 2020 2020  .id,.           
+0000c930: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000c940: 706c 6163 6564 5f70 6572 6d69 7373 696f  placed_permissio
+0000c950: 6e2e 6964 2c0a 2020 2020 2020 2020 2020  n.id,.          
+0000c960: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0000c970: 7065 726d 6973 7369 6f6e 2069 6420 7368  permission id sh
+0000c980: 6f75 6c64 2073 7461 7920 7468 6520 7361  ould stay the sa
+0000c990: 6d65 2729 0a20 2020 2020 2020 2023 2072  me').        # r
+0000c9a0: 6561 6420 7065 726d 6973 7369 6f6e 0a20  ead permission. 
+0000c9b0: 2020 2020 2020 2070 6572 6d69 7373 696f         permissio
+0000c9c0: 6e20 3d20 7573 6572 2e67 6574 5f70 6572  n = user.get_per
+0000c9d0: 6d69 7373 696f 6e28 7265 706c 6163 6564  mission(replaced
+0000c9e0: 5f70 6572 6d69 7373 696f 6e2e 6964 290a  _permission.id).
+0000c9f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000ca00: 6572 7445 7175 616c 2872 6570 6c61 6365  ertEqual(replace
+0000ca10: 645f 7065 726d 6973 7369 6f6e 2e69 642c  d_permission.id,
+0000ca20: 2070 6572 6d69 7373 696f 6e2e 6964 290a   permission.id).
+0000ca30: 2020 2020 2020 2020 2320 6465 6c65 7465          # delete
+0000ca40: 2070 6572 6d69 7373 696f 6e0a 2020 2020   permission.    
+0000ca50: 2020 2020 7573 6572 2e64 656c 6574 655f      user.delete_
+0000ca60: 7065 726d 6973 7369 6f6e 2872 6570 6c61  permission(repla
+0000ca70: 6365 645f 7065 726d 6973 7369 6f6e 2e69  ced_permission.i
+0000ca80: 6429 0a20 2020 2020 2020 2023 2072 6561  d).        # rea
+0000ca90: 6420 7065 726d 6973 7369 6f6e 2061 6674  d permission aft
+0000caa0: 6572 2064 656c 6574 696f 6e0a 2020 2020  er deletion.    
+0000cab0: 2020 2020 7365 6c66 2e5f 5f41 7373 6572      self.__Asser
+0000cac0: 7448 5454 5046 6169 6c75 7265 5769 7468  tHTTPFailureWith
+0000cad0: 5374 6174 7573 2853 7461 7475 7343 6f64  Status(StatusCod
+0000cae0: 6573 2e4e 4f54 5f46 4f55 4e44 2c0a 2020  es.NOT_FOUND,.  
 0000caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb10: 2020 2020 2020 2020 7573 6572 2e67 6574          user.get
-0000cb20: 5f70 6572 6d69 7373 696f 6e2c 0a20 2020  _permission,.   
+0000cb10: 2020 2020 2020 2020 2075 7365 722e 6765           user.ge
+0000cb20: 745f 7065 726d 6973 7369 6f6e 2c0a 2020  t_permission,.  
 0000cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb50: 2020 2020 2020 2020 7065 726d 6973 7369          permissi
-0000cb60: 6f6e 2e69 6429 0a0a 2020 2020 6465 6620  on.id)..    def 
-0000cb70: 7465 7374 5f70 6572 6d69 7373 696f 6e5f  test_permission_
-0000cb80: 7570 7365 7274 2873 656c 6629 3a0a 2020  upsert(self):.  
-0000cb90: 2020 2020 2020 2320 6372 6561 7465 2064        # create d
-0000cba0: 6174 6162 6173 650a 2020 2020 2020 2020  atabase.        
-0000cbb0: 6462 203d 2073 656c 662e 6461 7461 6261  db = self.databa
-0000cbc0: 7365 466f 7254 6573 740a 0a20 2020 2020  seForTest..     
-0000cbd0: 2020 2023 2063 7265 6174 6520 7573 6572     # create user
-0000cbe0: 0a20 2020 2020 2020 2075 7365 7220 3d20  .        user = 
-0000cbf0: 6462 2e63 7265 6174 655f 7573 6572 2862  db.create_user(b
-0000cc00: 6f64 793d 7b27 6964 273a 2027 6e65 7720  ody={'id': 'new 
-0000cc10: 7573 6572 2720 2b20 7374 7228 7575 6964  user' + str(uuid
-0000cc20: 2e75 7569 6434 2829 297d 290a 0a20 2020  .uuid4())})..   
-0000cc30: 2020 2020 2023 2072 6561 6420 7065 726d       # read perm
-0000cc40: 6973 7369 6f6e 7320 616e 6420 6368 6563  issions and chec
-0000cc50: 6b20 636f 756e 740a 2020 2020 2020 2020  k count.        
-0000cc60: 7065 726d 6973 7369 6f6e 7320 3d20 6c69  permissions = li
-0000cc70: 7374 2875 7365 722e 6c69 7374 5f70 6572  st(user.list_per
-0000cc80: 6d69 7373 696f 6e73 2829 290a 2020 2020  missions()).    
-0000cc90: 2020 2020 6265 666f 7265 5f63 7265 6174      before_creat
-0000cca0: 655f 636f 756e 7420 3d20 6c65 6e28 7065  e_count = len(pe
-0000ccb0: 726d 6973 7369 6f6e 7329 0a0a 2020 2020  rmissions)..    
-0000ccc0: 2020 2020 7065 726d 6973 7369 6f6e 5f64      permission_d
-0000ccd0: 6566 696e 6974 696f 6e20 3d20 7b0a 2020  efinition = {.  
-0000cce0: 2020 2020 2020 2020 2020 2769 6427 3a20            'id': 
-0000ccf0: 2770 6572 6d69 7373 696f 6e27 2c0a 2020  'permission',.  
-0000cd00: 2020 2020 2020 2020 2020 2770 6572 6d69            'permi
-0000cd10: 7373 696f 6e4d 6f64 6527 3a20 646f 6375  ssionMode': docu
-0000cd20: 6d65 6e74 732e 5065 726d 6973 7369 6f6e  ments.Permission
-0000cd30: 4d6f 6465 2e52 6561 642c 0a20 2020 2020  Mode.Read,.     
-0000cd40: 2020 2020 2020 2027 7265 736f 7572 6365         'resource
-0000cd50: 273a 2027 6462 732f 4151 4141 4141 3d3d  ': 'dbs/AQAAAA==
-0000cd60: 2f63 6f6c 6c73 2f41 5141 4141 4a30 6667  /colls/AQAAAJ0fg
-0000cd70: 5463 3d27 2020 2320 4120 7261 6e64 6f6d  Tc='  # A random
-0000cd80: 206f 6e65 2e0a 2020 2020 2020 2020 7d0a   one..        }.
-0000cd90: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
-0000cda0: 6520 7065 726d 6973 7369 6f6e 2075 7369  e permission usi
-0000cdb0: 6e67 2055 7073 6572 7420 4150 490a 2020  ng Upsert API.  
-0000cdc0: 2020 2020 2020 6372 6561 7465 645f 7065        created_pe
-0000cdd0: 726d 6973 7369 6f6e 203d 2075 7365 722e  rmission = user.
-0000cde0: 7570 7365 7274 5f70 6572 6d69 7373 696f  upsert_permissio
-0000cdf0: 6e28 7065 726d 6973 7369 6f6e 5f64 6566  n(permission_def
-0000ce00: 696e 6974 696f 6e29 0a0a 2020 2020 2020  inition)..      
-0000ce10: 2020 2320 7665 7269 6679 2069 6420 7072    # verify id pr
-0000ce20: 6f70 6572 7479 0a20 2020 2020 2020 2073  operty.        s
-0000ce30: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000ce40: 6372 6561 7465 645f 7065 726d 6973 7369  created_permissi
-0000ce50: 6f6e 2e69 642c 0a20 2020 2020 2020 2020  on.id,.         
+0000cb50: 2020 2020 2020 2020 2070 6572 6d69 7373           permiss
+0000cb60: 696f 6e2e 6964 290a 0a20 2020 2064 6566  ion.id)..    def
+0000cb70: 2074 6573 745f 7065 726d 6973 7369 6f6e   test_permission
+0000cb80: 5f75 7073 6572 7428 7365 6c66 293a 0a20  _upsert(self):. 
+0000cb90: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+0000cba0: 6461 7461 6261 7365 0a20 2020 2020 2020  database.       
+0000cbb0: 2064 6220 3d20 7365 6c66 2e64 6174 6162   db = self.datab
+0000cbc0: 6173 6546 6f72 5465 7374 0a0a 2020 2020  aseForTest..    
+0000cbd0: 2020 2020 2320 6372 6561 7465 2075 7365      # create use
+0000cbe0: 720a 2020 2020 2020 2020 7573 6572 203d  r.        user =
+0000cbf0: 2064 622e 6372 6561 7465 5f75 7365 7228   db.create_user(
+0000cc00: 626f 6479 3d7b 2769 6427 3a20 276e 6577  body={'id': 'new
+0000cc10: 2075 7365 7227 202b 2073 7472 2875 7569   user' + str(uui
+0000cc20: 642e 7575 6964 3428 2929 7d29 0a0a 2020  d.uuid4())})..  
+0000cc30: 2020 2020 2020 2320 7265 6164 2070 6572        # read per
+0000cc40: 6d69 7373 696f 6e73 2061 6e64 2063 6865  missions and che
+0000cc50: 636b 2063 6f75 6e74 0a20 2020 2020 2020  ck count.       
+0000cc60: 2070 6572 6d69 7373 696f 6e73 203d 206c   permissions = l
+0000cc70: 6973 7428 7573 6572 2e6c 6973 745f 7065  ist(user.list_pe
+0000cc80: 726d 6973 7369 6f6e 7328 2929 0a20 2020  rmissions()).   
+0000cc90: 2020 2020 2062 6566 6f72 655f 6372 6561       before_crea
+0000cca0: 7465 5f63 6f75 6e74 203d 206c 656e 2870  te_count = len(p
+0000ccb0: 6572 6d69 7373 696f 6e73 290a 0a20 2020  ermissions)..   
+0000ccc0: 2020 2020 2070 6572 6d69 7373 696f 6e5f       permission_
+0000ccd0: 6465 6669 6e69 7469 6f6e 203d 207b 0a20  definition = {. 
+0000cce0: 2020 2020 2020 2020 2020 2027 6964 273a             'id':
+0000ccf0: 2027 7065 726d 6973 7369 6f6e 272c 0a20   'permission',. 
+0000cd00: 2020 2020 2020 2020 2020 2027 7065 726d             'perm
+0000cd10: 6973 7369 6f6e 4d6f 6465 273a 2064 6f63  issionMode': doc
+0000cd20: 756d 656e 7473 2e50 6572 6d69 7373 696f  uments.Permissio
+0000cd30: 6e4d 6f64 652e 5265 6164 2c0a 2020 2020  nMode.Read,.    
+0000cd40: 2020 2020 2020 2020 2772 6573 6f75 7263          'resourc
+0000cd50: 6527 3a20 2764 6273 2f41 5141 4141 413d  e': 'dbs/AQAAAA=
+0000cd60: 3d2f 636f 6c6c 732f 4151 4141 414a 3066  =/colls/AQAAAJ0f
+0000cd70: 6754 633d 2720 2023 2041 2072 616e 646f  gTc='  # A rando
+0000cd80: 6d20 6f6e 652e 0a20 2020 2020 2020 207d  m one..        }
+0000cd90: 0a0a 2020 2020 2020 2020 2320 6372 6561  ..        # crea
+0000cda0: 7465 2070 6572 6d69 7373 696f 6e20 7573  te permission us
+0000cdb0: 696e 6720 5570 7365 7274 2041 5049 0a20  ing Upsert API. 
+0000cdc0: 2020 2020 2020 2063 7265 6174 6564 5f70         created_p
+0000cdd0: 6572 6d69 7373 696f 6e20 3d20 7573 6572  ermission = user
+0000cde0: 2e75 7073 6572 745f 7065 726d 6973 7369  .upsert_permissi
+0000cdf0: 6f6e 2870 6572 6d69 7373 696f 6e5f 6465  on(permission_de
+0000ce00: 6669 6e69 7469 6f6e 290a 0a20 2020 2020  finition)..     
+0000ce10: 2020 2023 2076 6572 6966 7920 6964 2070     # verify id p
+0000ce20: 726f 7065 7274 790a 2020 2020 2020 2020  roperty.        
+0000ce30: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000ce40: 2863 7265 6174 6564 5f70 6572 6d69 7373  (created_permiss
+0000ce50: 696f 6e2e 6964 2c0a 2020 2020 2020 2020  ion.id,.        
 0000ce60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce70: 7065 726d 6973 7369 6f6e 5f64 6566 696e  permission_defin
-0000ce80: 6974 696f 6e5b 2769 6427 5d2c 0a20 2020  ition['id'],.   
+0000ce70: 2070 6572 6d69 7373 696f 6e5f 6465 6669   permission_defi
+0000ce80: 6e69 7469 6f6e 5b27 6964 275d 2c0a 2020  nition['id'],.  
 0000ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cea0: 2020 2020 2020 2770 6572 6d69 7373 696f        'permissio
-0000ceb0: 6e20 6964 2065 7272 6f72 2729 0a0a 2020  n id error')..  
-0000cec0: 2020 2020 2020 2320 7265 6164 2070 6572        # read per
-0000ced0: 6d69 7373 696f 6e73 2061 6674 6572 2063  missions after c
-0000cee0: 7265 6174 696f 6e20 616e 6420 7665 7269  reation and veri
-0000cef0: 6679 2075 7064 6174 6564 2063 6f75 6e74  fy updated count
-0000cf00: 0a20 2020 2020 2020 2070 6572 6d69 7373  .        permiss
-0000cf10: 696f 6e73 203d 206c 6973 7428 7573 6572  ions = list(user
-0000cf20: 2e6c 6973 745f 7065 726d 6973 7369 6f6e  .list_permission
-0000cf30: 7328 2929 0a20 2020 2020 2020 2073 656c  s()).        sel
-0000cf40: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-0000cf50: 6e28 7065 726d 6973 7369 6f6e 7329 2c20  n(permissions), 
-0000cf60: 6265 666f 7265 5f63 7265 6174 655f 636f  before_create_co
-0000cf70: 756e 7420 2b20 3129 0a0a 2020 2020 2020  unt + 1)..      
-0000cf80: 2020 2320 7570 6461 7465 2070 6572 6d69    # update permi
-0000cf90: 7373 696f 6e20 6d6f 6465 0a20 2020 2020  ssion mode.     
-0000cfa0: 2020 2070 6572 6d69 7373 696f 6e5f 6465     permission_de
-0000cfb0: 6669 6e69 7469 6f6e 5b27 7065 726d 6973  finition['permis
-0000cfc0: 7369 6f6e 4d6f 6465 275d 203d 2064 6f63  sionMode'] = doc
-0000cfd0: 756d 656e 7473 2e50 6572 6d69 7373 696f  uments.Permissio
-0000cfe0: 6e4d 6f64 652e 416c 6c0a 0a20 2020 2020  nMode.All..     
-0000cff0: 2020 2023 2073 686f 756c 6420 7265 7061     # should repa
-0000d000: 6365 2074 6865 2070 6572 6d69 7373 696f  ce the permissio
-0000d010: 6e20 7369 6e63 6520 6974 2061 6c72 6561  n since it alrea
-0000d020: 6479 2065 7869 7374 730a 2020 2020 2020  dy exists.      
-0000d030: 2020 7570 7365 7274 6564 5f70 6572 6d69    upserted_permi
-0000d040: 7373 696f 6e20 3d20 7573 6572 2e75 7073  ssion = user.ups
-0000d050: 6572 745f 7065 726d 6973 7369 6f6e 2870  ert_permission(p
-0000d060: 6572 6d69 7373 696f 6e5f 6465 6669 6e69  ermission_defini
-0000d070: 7469 6f6e 290a 2020 2020 2020 2020 2320  tion).        # 
-0000d080: 7665 7269 6679 2069 6420 7072 6f70 6572  verify id proper
-0000d090: 7479 0a20 2020 2020 2020 2073 656c 662e  ty.        self.
-0000d0a0: 6173 7365 7274 4571 7561 6c28 7570 7365  assertEqual(upse
-0000d0b0: 7274 6564 5f70 6572 6d69 7373 696f 6e2e  rted_permission.
-0000d0c0: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-0000d0d0: 2020 2020 2020 2020 2020 2020 2063 7265               cre
-0000d0e0: 6174 6564 5f70 6572 6d69 7373 696f 6e2e  ated_permission.
-0000d0f0: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-0000d100: 2020 2020 2020 2020 2020 2020 2027 7065               'pe
-0000d110: 726d 6973 7369 6f6e 2069 6420 7368 6f75  rmission id shou
-0000d120: 6c64 2072 656d 6169 6e20 7361 6d65 2729  ld remain same')
-0000d130: 0a0a 2020 2020 2020 2020 2320 7665 7269  ..        # veri
-0000d140: 6679 2063 6861 6e67 6564 2070 726f 7065  fy changed prope
-0000d150: 7274 790a 2020 2020 2020 2020 7365 6c66  rty.        self
-0000d160: 2e61 7373 6572 7445 7175 616c 2875 7073  .assertEqual(ups
-0000d170: 6572 7465 645f 7065 726d 6973 7369 6f6e  erted_permission
-0000d180: 2e70 6572 6d69 7373 696f 6e5f 6d6f 6465  .permission_mode
-0000d190: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000d1a0: 2020 2020 2020 2020 2020 2070 6572 6d69             permi
-0000d1b0: 7373 696f 6e5f 6465 6669 6e69 7469 6f6e  ssion_definition
-0000d1c0: 5b27 7065 726d 6973 7369 6f6e 4d6f 6465  ['permissionMode
-0000d1d0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-0000d1e0: 2020 2020 2020 2020 2020 2020 2027 7065               'pe
-0000d1f0: 726d 6973 7369 6f6e 4d6f 6465 2073 686f  rmissionMode sho
-0000d200: 756c 6420 6368 616e 6765 2729 0a0a 2020  uld change')..  
-0000d210: 2020 2020 2020 2320 7265 6164 2070 6572        # read per
-0000d220: 6d69 7373 696f 6e73 2061 6e64 2076 6572  missions and ver
-0000d230: 6966 7920 636f 756e 7420 646f 6573 6e27  ify count doesn'
-0000d240: 7420 696e 6372 6561 7365 7320 6167 6169  t increases agai
-0000d250: 6e0a 2020 2020 2020 2020 7065 726d 6973  n.        permis
-0000d260: 7369 6f6e 7320 3d20 6c69 7374 2875 7365  sions = list(use
-0000d270: 722e 6c69 7374 5f70 6572 6d69 7373 696f  r.list_permissio
-0000d280: 6e73 2829 290a 2020 2020 2020 2020 7365  ns()).        se
-0000d290: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-0000d2a0: 656e 2870 6572 6d69 7373 696f 6e73 292c  en(permissions),
-0000d2b0: 2062 6566 6f72 655f 6372 6561 7465 5f63   before_create_c
-0000d2c0: 6f75 6e74 202b 2031 290a 0a20 2020 2020  ount + 1)..     
-0000d2d0: 2020 2023 2075 7064 6174 6520 7065 726d     # update perm
-0000d2e0: 6973 7369 6f6e 2069 640a 2020 2020 2020  ission id.      
-0000d2f0: 2020 6372 6561 7465 645f 7065 726d 6973    created_permis
-0000d300: 7369 6f6e 2e70 726f 7065 7274 6965 735b  sion.properties[
-0000d310: 2769 6427 5d20 3d20 276e 6577 2070 6572  'id'] = 'new per
-0000d320: 6d69 7373 696f 6e27 0a20 2020 2020 2020  mission'.       
-0000d330: 2063 7265 6174 6564 5f70 6572 6d69 7373   created_permiss
-0000d340: 696f 6e2e 6964 203d 2063 7265 6174 6564  ion.id = created
-0000d350: 5f70 6572 6d69 7373 696f 6e2e 7072 6f70  _permission.prop
-0000d360: 6572 7469 6573 5b27 6964 275d 0a20 2020  erties['id'].   
-0000d370: 2020 2020 2023 2072 6573 6f75 7263 6520       # resource 
-0000d380: 6e65 6564 7320 746f 2062 6520 6368 616e  needs to be chan
-0000d390: 6765 6420 616c 6f6e 6720 7769 7468 2074  ged along with t
-0000d3a0: 6865 2069 6420 696e 206f 7264 6572 2074  he id in order t
-0000d3b0: 6f20 6372 6561 7465 2061 206e 6577 2070  o create a new p
-0000d3c0: 6572 6d69 7373 696f 6e0a 2020 2020 2020  ermission.      
-0000d3d0: 2020 6372 6561 7465 645f 7065 726d 6973    created_permis
-0000d3e0: 7369 6f6e 2e70 726f 7065 7274 6965 735b  sion.properties[
-0000d3f0: 2772 6573 6f75 7263 6527 5d20 3d20 2764  'resource'] = 'd
-0000d400: 6273 2f4e 3945 6441 413d 3d2f 636f 6c6c  bs/N9EdAA==/coll
-0000d410: 732f 4e39 4564 4149 7567 5867 413d 270a  s/N9EdAIugXgA='.
-0000d420: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-0000d430: 7065 726d 6973 7369 6f6e 2e72 6573 6f75  permission.resou
-0000d440: 7263 655f 6c69 6e6b 203d 2063 7265 6174  rce_link = creat
-0000d450: 6564 5f70 6572 6d69 7373 696f 6e2e 7072  ed_permission.pr
-0000d460: 6f70 6572 7469 6573 5b27 7265 736f 7572  operties['resour
-0000d470: 6365 275d 0a0a 2020 2020 2020 2020 2320  ce']..        # 
-0000d480: 7368 6f75 6c64 2063 7265 6174 6520 6e65  should create ne
-0000d490: 7720 7065 726d 6973 7369 6f6e 2073 696e  w permission sin
-0000d4a0: 6365 2069 6420 6861 7320 6368 616e 6765  ce id has change
-0000d4b0: 640a 2020 2020 2020 2020 6e65 775f 7065  d.        new_pe
-0000d4c0: 726d 6973 7369 6f6e 203d 2075 7365 722e  rmission = user.
-0000d4d0: 7570 7365 7274 5f70 6572 6d69 7373 696f  upsert_permissio
-0000d4e0: 6e28 6372 6561 7465 645f 7065 726d 6973  n(created_permis
-0000d4f0: 7369 6f6e 2e70 726f 7065 7274 6965 7329  sion.properties)
-0000d500: 0a0a 2020 2020 2020 2020 2320 7665 7269  ..        # veri
-0000d510: 6679 2069 6420 616e 6420 7265 736f 7572  fy id and resour
-0000d520: 6365 2070 726f 7065 7274 790a 2020 2020  ce property.    
-0000d530: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000d540: 7175 616c 286e 6577 5f70 6572 6d69 7373  qual(new_permiss
-0000d550: 696f 6e2e 6964 2c0a 2020 2020 2020 2020  ion.id,.        
+0000cea0: 2020 2020 2020 2027 7065 726d 6973 7369         'permissi
+0000ceb0: 6f6e 2069 6420 6572 726f 7227 290a 0a20  on id error').. 
+0000cec0: 2020 2020 2020 2023 2072 6561 6420 7065         # read pe
+0000ced0: 726d 6973 7369 6f6e 7320 6166 7465 7220  rmissions after 
+0000cee0: 6372 6561 7469 6f6e 2061 6e64 2076 6572  creation and ver
+0000cef0: 6966 7920 7570 6461 7465 6420 636f 756e  ify updated coun
+0000cf00: 740a 2020 2020 2020 2020 7065 726d 6973  t.        permis
+0000cf10: 7369 6f6e 7320 3d20 6c69 7374 2875 7365  sions = list(use
+0000cf20: 722e 6c69 7374 5f70 6572 6d69 7373 696f  r.list_permissio
+0000cf30: 6e73 2829 290a 2020 2020 2020 2020 7365  ns()).        se
+0000cf40: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+0000cf50: 656e 2870 6572 6d69 7373 696f 6e73 292c  en(permissions),
+0000cf60: 2062 6566 6f72 655f 6372 6561 7465 5f63   before_create_c
+0000cf70: 6f75 6e74 202b 2031 290a 0a20 2020 2020  ount + 1)..     
+0000cf80: 2020 2023 2075 7064 6174 6520 7065 726d     # update perm
+0000cf90: 6973 7369 6f6e 206d 6f64 650a 2020 2020  ission mode.    
+0000cfa0: 2020 2020 7065 726d 6973 7369 6f6e 5f64      permission_d
+0000cfb0: 6566 696e 6974 696f 6e5b 2770 6572 6d69  efinition['permi
+0000cfc0: 7373 696f 6e4d 6f64 6527 5d20 3d20 646f  ssionMode'] = do
+0000cfd0: 6375 6d65 6e74 732e 5065 726d 6973 7369  cuments.Permissi
+0000cfe0: 6f6e 4d6f 6465 2e41 6c6c 0a0a 2020 2020  onMode.All..    
+0000cff0: 2020 2020 2320 7368 6f75 6c64 2072 6570      # should rep
+0000d000: 6163 6520 7468 6520 7065 726d 6973 7369  ace the permissi
+0000d010: 6f6e 2073 696e 6365 2069 7420 616c 7265  on since it alre
+0000d020: 6164 7920 6578 6973 7473 0a20 2020 2020  ady exists.     
+0000d030: 2020 2075 7073 6572 7465 645f 7065 726d     upserted_perm
+0000d040: 6973 7369 6f6e 203d 2075 7365 722e 7570  ission = user.up
+0000d050: 7365 7274 5f70 6572 6d69 7373 696f 6e28  sert_permission(
+0000d060: 7065 726d 6973 7369 6f6e 5f64 6566 696e  permission_defin
+0000d070: 6974 696f 6e29 0a20 2020 2020 2020 2023  ition).        #
+0000d080: 2076 6572 6966 7920 6964 2070 726f 7065   verify id prope
+0000d090: 7274 790a 2020 2020 2020 2020 7365 6c66  rty.        self
+0000d0a0: 2e61 7373 6572 7445 7175 616c 2875 7073  .assertEqual(ups
+0000d0b0: 6572 7465 645f 7065 726d 6973 7369 6f6e  erted_permission
+0000d0c0: 2e69 642c 0a20 2020 2020 2020 2020 2020  .id,.           
+0000d0d0: 2020 2020 2020 2020 2020 2020 2020 6372                cr
+0000d0e0: 6561 7465 645f 7065 726d 6973 7369 6f6e  eated_permission
+0000d0f0: 2e69 642c 0a20 2020 2020 2020 2020 2020  .id,.           
+0000d100: 2020 2020 2020 2020 2020 2020 2020 2770                'p
+0000d110: 6572 6d69 7373 696f 6e20 6964 2073 686f  ermission id sho
+0000d120: 756c 6420 7265 6d61 696e 2073 616d 6527  uld remain same'
+0000d130: 290a 0a20 2020 2020 2020 2023 2076 6572  )..        # ver
+0000d140: 6966 7920 6368 616e 6765 6420 7072 6f70  ify changed prop
+0000d150: 6572 7479 0a20 2020 2020 2020 2073 656c  erty.        sel
+0000d160: 662e 6173 7365 7274 4571 7561 6c28 7570  f.assertEqual(up
+0000d170: 7365 7274 6564 5f70 6572 6d69 7373 696f  serted_permissio
+0000d180: 6e2e 7065 726d 6973 7369 6f6e 5f6d 6f64  n.permission_mod
+0000d190: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000d1a0: 2020 2020 2020 2020 2020 2020 7065 726d              perm
+0000d1b0: 6973 7369 6f6e 5f64 6566 696e 6974 696f  ission_definitio
+0000d1c0: 6e5b 2770 6572 6d69 7373 696f 6e4d 6f64  n['permissionMod
+0000d1d0: 6527 5d2c 0a20 2020 2020 2020 2020 2020  e'],.           
+0000d1e0: 2020 2020 2020 2020 2020 2020 2020 2770                'p
+0000d1f0: 6572 6d69 7373 696f 6e4d 6f64 6520 7368  ermissionMode sh
+0000d200: 6f75 6c64 2063 6861 6e67 6527 290a 0a20  ould change').. 
+0000d210: 2020 2020 2020 2023 2072 6561 6420 7065         # read pe
+0000d220: 726d 6973 7369 6f6e 7320 616e 6420 7665  rmissions and ve
+0000d230: 7269 6679 2063 6f75 6e74 2064 6f65 736e  rify count doesn
+0000d240: 2774 2069 6e63 7265 6173 6573 2061 6761  't increases aga
+0000d250: 696e 0a20 2020 2020 2020 2070 6572 6d69  in.        permi
+0000d260: 7373 696f 6e73 203d 206c 6973 7428 7573  ssions = list(us
+0000d270: 6572 2e6c 6973 745f 7065 726d 6973 7369  er.list_permissi
+0000d280: 6f6e 7328 2929 0a20 2020 2020 2020 2073  ons()).        s
+0000d290: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000d2a0: 6c65 6e28 7065 726d 6973 7369 6f6e 7329  len(permissions)
+0000d2b0: 2c20 6265 666f 7265 5f63 7265 6174 655f  , before_create_
+0000d2c0: 636f 756e 7420 2b20 3129 0a0a 2020 2020  count + 1)..    
+0000d2d0: 2020 2020 2320 7570 6461 7465 2070 6572      # update per
+0000d2e0: 6d69 7373 696f 6e20 6964 0a20 2020 2020  mission id.     
+0000d2f0: 2020 2063 7265 6174 6564 5f70 6572 6d69     created_permi
+0000d300: 7373 696f 6e2e 7072 6f70 6572 7469 6573  ssion.properties
+0000d310: 5b27 6964 275d 203d 2027 6e65 7720 7065  ['id'] = 'new pe
+0000d320: 726d 6973 7369 6f6e 270a 2020 2020 2020  rmission'.      
+0000d330: 2020 6372 6561 7465 645f 7065 726d 6973    created_permis
+0000d340: 7369 6f6e 2e69 6420 3d20 6372 6561 7465  sion.id = create
+0000d350: 645f 7065 726d 6973 7369 6f6e 2e70 726f  d_permission.pro
+0000d360: 7065 7274 6965 735b 2769 6427 5d0a 2020  perties['id'].  
+0000d370: 2020 2020 2020 2320 7265 736f 7572 6365        # resource
+0000d380: 206e 6565 6473 2074 6f20 6265 2063 6861   needs to be cha
+0000d390: 6e67 6564 2061 6c6f 6e67 2077 6974 6820  nged along with 
+0000d3a0: 7468 6520 6964 2069 6e20 6f72 6465 7220  the id in order 
+0000d3b0: 746f 2063 7265 6174 6520 6120 6e65 7720  to create a new 
+0000d3c0: 7065 726d 6973 7369 6f6e 0a20 2020 2020  permission.     
+0000d3d0: 2020 2063 7265 6174 6564 5f70 6572 6d69     created_permi
+0000d3e0: 7373 696f 6e2e 7072 6f70 6572 7469 6573  ssion.properties
+0000d3f0: 5b27 7265 736f 7572 6365 275d 203d 2027  ['resource'] = '
+0000d400: 6462 732f 4e39 4564 4141 3d3d 2f63 6f6c  dbs/N9EdAA==/col
+0000d410: 6c73 2f4e 3945 6441 4975 6758 6741 3d27  ls/N9EdAIugXgA='
+0000d420: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+0000d430: 5f70 6572 6d69 7373 696f 6e2e 7265 736f  _permission.reso
+0000d440: 7572 6365 5f6c 696e 6b20 3d20 6372 6561  urce_link = crea
+0000d450: 7465 645f 7065 726d 6973 7369 6f6e 2e70  ted_permission.p
+0000d460: 726f 7065 7274 6965 735b 2772 6573 6f75  roperties['resou
+0000d470: 7263 6527 5d0a 0a20 2020 2020 2020 2023  rce']..        #
+0000d480: 2073 686f 756c 6420 6372 6561 7465 206e   should create n
+0000d490: 6577 2070 6572 6d69 7373 696f 6e20 7369  ew permission si
+0000d4a0: 6e63 6520 6964 2068 6173 2063 6861 6e67  nce id has chang
+0000d4b0: 6564 0a20 2020 2020 2020 206e 6577 5f70  ed.        new_p
+0000d4c0: 6572 6d69 7373 696f 6e20 3d20 7573 6572  ermission = user
+0000d4d0: 2e75 7073 6572 745f 7065 726d 6973 7369  .upsert_permissi
+0000d4e0: 6f6e 2863 7265 6174 6564 5f70 6572 6d69  on(created_permi
+0000d4f0: 7373 696f 6e2e 7072 6f70 6572 7469 6573  ssion.properties
+0000d500: 290a 0a20 2020 2020 2020 2023 2076 6572  )..        # ver
+0000d510: 6966 7920 6964 2061 6e64 2072 6573 6f75  ify id and resou
+0000d520: 7263 6520 7072 6f70 6572 7479 0a20 2020  rce property.   
+0000d530: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000d540: 4571 7561 6c28 6e65 775f 7065 726d 6973  Equal(new_permis
+0000d550: 7369 6f6e 2e69 642c 0a20 2020 2020 2020  sion.id,.       
 0000d560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d570: 2063 7265 6174 6564 5f70 6572 6d69 7373   created_permiss
-0000d580: 696f 6e2e 6964 2c0a 2020 2020 2020 2020  ion.id,.        
+0000d570: 2020 6372 6561 7465 645f 7065 726d 6973    created_permis
+0000d580: 7369 6f6e 2e69 642c 0a20 2020 2020 2020  sion.id,.       
 0000d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5a0: 2027 7065 726d 6973 7369 6f6e 2069 6420   'permission id 
-0000d5b0: 7368 6f75 6c64 2062 6520 7361 6d65 2729  should be same')
-0000d5c0: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-0000d5d0: 7373 6572 7445 7175 616c 286e 6577 5f70  ssertEqual(new_p
-0000d5e0: 6572 6d69 7373 696f 6e2e 7265 736f 7572  ermission.resour
-0000d5f0: 6365 5f6c 696e 6b2c 0a20 2020 2020 2020  ce_link,.       
+0000d5a0: 2020 2770 6572 6d69 7373 696f 6e20 6964    'permission id
+0000d5b0: 2073 686f 756c 6420 6265 2073 616d 6527   should be same'
+0000d5c0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000d5d0: 6173 7365 7274 4571 7561 6c28 6e65 775f  assertEqual(new_
+0000d5e0: 7065 726d 6973 7369 6f6e 2e72 6573 6f75  permission.resou
+0000d5f0: 7263 655f 6c69 6e6b 2c0a 2020 2020 2020  rce_link,.      
 0000d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d610: 2020 6372 6561 7465 645f 7065 726d 6973    created_permis
-0000d620: 7369 6f6e 2e72 6573 6f75 7263 655f 6c69  sion.resource_li
-0000d630: 6e6b 2c0a 2020 2020 2020 2020 2020 2020  nk,.            
-0000d640: 2020 2020 2020 2020 2020 2020 2027 7065               'pe
-0000d650: 726d 6973 7369 6f6e 2072 6573 6f75 7263  rmission resourc
-0000d660: 6520 7368 6f75 6c64 2062 6520 7361 6d65  e should be same
-0000d670: 2729 0a0a 2020 2020 2020 2020 2320 7265  ')..        # re
-0000d680: 6164 2070 6572 6d69 7373 696f 6e73 2061  ad permissions a
-0000d690: 6e64 2076 6572 6966 7920 636f 756e 7420  nd verify count 
-0000d6a0: 696e 6372 6561 7365 730a 2020 2020 2020  increases.      
-0000d6b0: 2020 7065 726d 6973 7369 6f6e 7320 3d20    permissions = 
-0000d6c0: 6c69 7374 2875 7365 722e 6c69 7374 5f70  list(user.list_p
-0000d6d0: 6572 6d69 7373 696f 6e73 2829 290a 2020  ermissions()).  
-0000d6e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000d6f0: 7445 7175 616c 286c 656e 2870 6572 6d69  tEqual(len(permi
-0000d700: 7373 696f 6e73 292c 2062 6566 6f72 655f  ssions), before_
-0000d710: 6372 6561 7465 5f63 6f75 6e74 202b 2032  create_count + 2
-0000d720: 290a 0a20 2020 2020 2020 2023 2064 656c  )..        # del
-0000d730: 6574 6520 7065 726d 6973 7369 6f6e 730a  ete permissions.
-0000d740: 2020 2020 2020 2020 7573 6572 2e64 656c          user.del
-0000d750: 6574 655f 7065 726d 6973 7369 6f6e 2875  ete_permission(u
-0000d760: 7073 6572 7465 645f 7065 726d 6973 7369  pserted_permissi
-0000d770: 6f6e 2e69 6429 0a20 2020 2020 2020 2075  on.id).        u
-0000d780: 7365 722e 6465 6c65 7465 5f70 6572 6d69  ser.delete_permi
-0000d790: 7373 696f 6e28 6e65 775f 7065 726d 6973  ssion(new_permis
-0000d7a0: 7369 6f6e 2e69 6429 0a0a 2020 2020 2020  sion.id)..      
-0000d7b0: 2020 2320 7265 6164 2070 6572 6d69 7373    # read permiss
-0000d7c0: 696f 6e73 2061 6e64 2076 6572 6966 7920  ions and verify 
-0000d7d0: 636f 756e 7420 7265 6d61 696e 7320 7468  count remains th
-0000d7e0: 6520 7361 6d65 0a20 2020 2020 2020 2070  e same.        p
-0000d7f0: 6572 6d69 7373 696f 6e73 203d 206c 6973  ermissions = lis
-0000d800: 7428 7573 6572 2e6c 6973 745f 7065 726d  t(user.list_perm
-0000d810: 6973 7369 6f6e 7328 2929 0a20 2020 2020  issions()).     
-0000d820: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000d830: 7561 6c28 6c65 6e28 7065 726d 6973 7369  ual(len(permissi
-0000d840: 6f6e 7329 2c20 6265 666f 7265 5f63 7265  ons), before_cre
-0000d850: 6174 655f 636f 756e 7429 0a0a 2020 2020  ate_count)..    
-0000d860: 6465 6620 7465 7374 5f61 7574 686f 7269  def test_authori
-0000d870: 7a61 7469 6f6e 2873 656c 6629 3a0a 2020  zation(self):.  
-0000d880: 2020 2020 2020 6465 6620 5f5f 5365 7475        def __Setu
-0000d890: 7045 6e74 6974 6965 7328 636c 6965 6e74  pEntities(client
-0000d8a0: 293a 0a20 2020 2020 2020 2020 2020 2022  ):.            "
-0000d8b0: 2222 0a20 2020 2020 2020 2020 2020 2053  "".            S
-0000d8c0: 6574 7320 7570 2065 6e74 6974 6965 7320  ets up entities 
-0000d8d0: 666f 7220 7468 6973 2074 6573 742e 0a0a  for this test...
-0000d8e0: 2020 2020 2020 2020 2020 2020 3a50 6172              :Par
-0000d8f0: 616d 6574 6572 733a 0a20 2020 2020 2020  ameters:.       
-0000d900: 2020 2020 2020 2020 202d 2060 636c 6965           - `clie
-0000d910: 6e74 603a 2063 6f73 6d6f 735f 636c 6965  nt`: cosmos_clie
-0000d920: 6e74 5f63 6f6e 6e65 6374 696f 6e2e 436f  nt_connection.Co
-0000d930: 736d 6f73 436c 6965 6e74 436f 6e6e 6563  smosClientConnec
-0000d940: 7469 6f6e 0a0a 2020 2020 2020 2020 2020  tion..          
-0000d950: 2020 3a52 6574 7572 6e73 3a0a 2020 2020    :Returns:.    
-0000d960: 2020 2020 2020 2020 2020 2020 6469 6374              dict
-0000d970: 0a0a 2020 2020 2020 2020 2020 2020 2222  ..            ""
-0000d980: 220a 2020 2020 2020 2020 2020 2020 2320  ".            # 
-0000d990: 6372 6561 7465 2064 6174 6162 6173 650a  create database.
-0000d9a0: 2020 2020 2020 2020 2020 2020 6462 203d              db =
-0000d9b0: 2073 656c 662e 6461 7461 6261 7365 466f   self.databaseFo
-0000d9c0: 7254 6573 740a 2020 2020 2020 2020 2020  rTest.          
-0000d9d0: 2020 2320 6372 6561 7465 2063 6f6c 6c65    # create colle
-0000d9e0: 6374 696f 6e0a 2020 2020 2020 2020 2020  ction.          
-0000d9f0: 2020 636f 6c6c 6563 7469 6f6e 203d 2064    collection = d
-0000da00: 622e 6372 6561 7465 5f63 6f6e 7461 696e  b.create_contain
-0000da10: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
-0000da20: 2020 2020 6964 3d27 7465 7374 5f61 7574      id='test_aut
-0000da30: 686f 7269 7a61 7469 6f6e 2720 2b20 7374  horization' + st
-0000da40: 7228 7575 6964 2e75 7569 6434 2829 292c  r(uuid.uuid4()),
-0000da50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000da60: 2070 6172 7469 7469 6f6e 5f6b 6579 3d50   partition_key=P
-0000da70: 6172 7469 7469 6f6e 4b65 7928 7061 7468  artitionKey(path
-0000da80: 3d27 2f69 6427 2c20 6b69 6e64 3d27 4861  ='/id', kind='Ha
-0000da90: 7368 2729 0a20 2020 2020 2020 2020 2020  sh').           
-0000daa0: 2029 0a20 2020 2020 2020 2020 2020 2023   ).            #
-0000dab0: 2063 7265 6174 6520 646f 6375 6d65 6e74   create document
-0000dac0: 310a 2020 2020 2020 2020 2020 2020 646f  1.            do
-0000dad0: 6375 6d65 6e74 203d 2063 6f6c 6c65 6374  cument = collect
-0000dae0: 696f 6e2e 6372 6561 7465 5f69 7465 6d28  ion.create_item(
-0000daf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000db00: 2020 2020 2020 2020 2020 2020 2062 6f64               bod
-0000db10: 793d 7b27 6964 273a 2027 646f 6331 272c  y={'id': 'doc1',
-0000db20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d610: 2020 2063 7265 6174 6564 5f70 6572 6d69     created_permi
+0000d620: 7373 696f 6e2e 7265 736f 7572 6365 5f6c  ssion.resource_l
+0000d630: 696e 6b2c 0a20 2020 2020 2020 2020 2020  ink,.           
+0000d640: 2020 2020 2020 2020 2020 2020 2020 2770                'p
+0000d650: 6572 6d69 7373 696f 6e20 7265 736f 7572  ermission resour
+0000d660: 6365 2073 686f 756c 6420 6265 2073 616d  ce should be sam
+0000d670: 6527 290a 0a20 2020 2020 2020 2023 2072  e')..        # r
+0000d680: 6561 6420 7065 726d 6973 7369 6f6e 7320  ead permissions 
+0000d690: 616e 6420 7665 7269 6679 2063 6f75 6e74  and verify count
+0000d6a0: 2069 6e63 7265 6173 6573 0a20 2020 2020   increases.     
+0000d6b0: 2020 2070 6572 6d69 7373 696f 6e73 203d     permissions =
+0000d6c0: 206c 6973 7428 7573 6572 2e6c 6973 745f   list(user.list_
+0000d6d0: 7065 726d 6973 7369 6f6e 7328 2929 0a20  permissions()). 
+0000d6e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000d6f0: 7274 4571 7561 6c28 6c65 6e28 7065 726d  rtEqual(len(perm
+0000d700: 6973 7369 6f6e 7329 2c20 6265 666f 7265  issions), before
+0000d710: 5f63 7265 6174 655f 636f 756e 7420 2b20  _create_count + 
+0000d720: 3229 0a0a 2020 2020 2020 2020 2320 6465  2)..        # de
+0000d730: 6c65 7465 2070 6572 6d69 7373 696f 6e73  lete permissions
+0000d740: 0a20 2020 2020 2020 2075 7365 722e 6465  .        user.de
+0000d750: 6c65 7465 5f70 6572 6d69 7373 696f 6e28  lete_permission(
+0000d760: 7570 7365 7274 6564 5f70 6572 6d69 7373  upserted_permiss
+0000d770: 696f 6e2e 6964 290a 2020 2020 2020 2020  ion.id).        
+0000d780: 7573 6572 2e64 656c 6574 655f 7065 726d  user.delete_perm
+0000d790: 6973 7369 6f6e 286e 6577 5f70 6572 6d69  ission(new_permi
+0000d7a0: 7373 696f 6e2e 6964 290a 0a20 2020 2020  ssion.id)..     
+0000d7b0: 2020 2023 2072 6561 6420 7065 726d 6973     # read permis
+0000d7c0: 7369 6f6e 7320 616e 6420 7665 7269 6679  sions and verify
+0000d7d0: 2063 6f75 6e74 2072 656d 6169 6e73 2074   count remains t
+0000d7e0: 6865 2073 616d 650a 2020 2020 2020 2020  he same.        
+0000d7f0: 7065 726d 6973 7369 6f6e 7320 3d20 6c69  permissions = li
+0000d800: 7374 2875 7365 722e 6c69 7374 5f70 6572  st(user.list_per
+0000d810: 6d69 7373 696f 6e73 2829 290a 2020 2020  missions()).    
+0000d820: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000d830: 7175 616c 286c 656e 2870 6572 6d69 7373  qual(len(permiss
+0000d840: 696f 6e73 292c 2062 6566 6f72 655f 6372  ions), before_cr
+0000d850: 6561 7465 5f63 6f75 6e74 290a 0a20 2020  eate_count)..   
+0000d860: 2064 6566 2074 6573 745f 6175 7468 6f72   def test_author
+0000d870: 697a 6174 696f 6e28 7365 6c66 293a 0a20  ization(self):. 
+0000d880: 2020 2020 2020 2064 6566 205f 5f53 6574         def __Set
+0000d890: 7570 456e 7469 7469 6573 2863 6c69 656e  upEntities(clien
+0000d8a0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0000d8b0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+0000d8c0: 5365 7473 2075 7020 656e 7469 7469 6573  Sets up entities
+0000d8d0: 2066 6f72 2074 6869 7320 7465 7374 2e0a   for this test..
+0000d8e0: 0a20 2020 2020 2020 2020 2020 203a 5061  .            :Pa
+0000d8f0: 7261 6d65 7465 7273 3a0a 2020 2020 2020  rameters:.      
+0000d900: 2020 2020 2020 2020 2020 2d20 6063 6c69            - `cli
+0000d910: 656e 7460 3a20 636f 736d 6f73 5f63 6c69  ent`: cosmos_cli
+0000d920: 656e 745f 636f 6e6e 6563 7469 6f6e 2e43  ent_connection.C
+0000d930: 6f73 6d6f 7343 6c69 656e 7443 6f6e 6e65  osmosClientConne
+0000d940: 6374 696f 6e0a 0a20 2020 2020 2020 2020  ction..         
+0000d950: 2020 203a 5265 7475 726e 733a 0a20 2020     :Returns:.   
+0000d960: 2020 2020 2020 2020 2020 2020 2064 6963               dic
+0000d970: 740a 0a20 2020 2020 2020 2020 2020 2022  t..            "
+0000d980: 2222 0a20 2020 2020 2020 2020 2020 2023  "".            #
+0000d990: 2063 7265 6174 6520 6461 7461 6261 7365   create database
+0000d9a0: 0a20 2020 2020 2020 2020 2020 2064 6220  .            db 
+0000d9b0: 3d20 7365 6c66 2e64 6174 6162 6173 6546  = self.databaseF
+0000d9c0: 6f72 5465 7374 0a20 2020 2020 2020 2020  orTest.         
+0000d9d0: 2020 2023 2063 7265 6174 6520 636f 6c6c     # create coll
+0000d9e0: 6563 7469 6f6e 0a20 2020 2020 2020 2020  ection.         
+0000d9f0: 2020 2063 6f6c 6c65 6374 696f 6e20 3d20     collection = 
+0000da00: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
+0000da10: 6e65 7228 0a20 2020 2020 2020 2020 2020  ner(.           
+0000da20: 2020 2020 2069 643d 2774 6573 745f 6175       id='test_au
+0000da30: 7468 6f72 697a 6174 696f 6e27 202b 2073  thorization' + s
+0000da40: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
+0000da50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000da60: 2020 7061 7274 6974 696f 6e5f 6b65 793d    partition_key=
+0000da70: 5061 7274 6974 696f 6e4b 6579 2870 6174  PartitionKey(pat
+0000da80: 683d 272f 6964 272c 206b 696e 643d 2748  h='/id', kind='H
+0000da90: 6173 6827 290a 2020 2020 2020 2020 2020  ash').          
+0000daa0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000dab0: 2320 6372 6561 7465 2064 6f63 756d 656e  # create documen
+0000dac0: 7431 0a20 2020 2020 2020 2020 2020 2064  t1.            d
+0000dad0: 6f63 756d 656e 7420 3d20 636f 6c6c 6563  ocument = collec
+0000dae0: 7469 6f6e 2e63 7265 6174 655f 6974 656d  tion.create_item
+0000daf0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000db00: 2020 2020 2020 2020 2020 2020 2020 626f                bo
+0000db10: 6479 3d7b 2769 6427 3a20 2764 6f63 3127  dy={'id': 'doc1'
+0000db20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0000db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db40: 2020 2027 7370 616d 273a 2027 6567 6773     'spam': 'eggs
-0000db50: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0000db40: 2020 2020 2773 7061 6d27 3a20 2765 6767      'spam': 'egg
+0000db50: 7327 2c0a 2020 2020 2020 2020 2020 2020  s',.            
 0000db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db70: 2020 2020 2027 6b65 7927 3a20 2776 616c       'key': 'val
-0000db80: 7565 277d 2c0a 2020 2020 2020 2020 2020  ue'},.          
-0000db90: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-0000dba0: 2023 2063 7265 6174 6520 7573 6572 0a20   # create user. 
-0000dbb0: 2020 2020 2020 2020 2020 2075 7365 7220             user 
-0000dbc0: 3d20 6462 2e63 7265 6174 655f 7573 6572  = db.create_user
-0000dbd0: 2862 6f64 793d 7b27 6964 273a 2027 7573  (body={'id': 'us
-0000dbe0: 6572 2720 2b20 7374 7228 7575 6964 2e75  er' + str(uuid.u
-0000dbf0: 7569 6434 2829 297d 290a 0a20 2020 2020  uid4())})..     
-0000dc00: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
-0000dc10: 7065 726d 6973 7369 6f6e 2066 6f72 2063  permission for c
-0000dc20: 6f6c 6c65 6374 696f 6e0a 2020 2020 2020  ollection.      
-0000dc30: 2020 2020 2020 7065 726d 6973 7369 6f6e        permission
-0000dc40: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-0000dc50: 2020 2020 2027 6964 273a 2027 7065 726d       'id': 'perm
-0000dc60: 6973 7369 6f6e 204f 6e20 436f 6c6c 272c  ission On Coll',
-0000dc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dc80: 2027 7065 726d 6973 7369 6f6e 4d6f 6465   'permissionMode
-0000dc90: 273a 2064 6f63 756d 656e 7473 2e50 6572  ': documents.Per
-0000dca0: 6d69 7373 696f 6e4d 6f64 652e 5265 6164  missionMode.Read
-0000dcb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000dcc0: 2020 2772 6573 6f75 7263 6527 3a20 2264    'resource': "d
-0000dcd0: 6273 2f22 202b 2064 622e 6964 202b 2022  bs/" + db.id + "
-0000dce0: 2f63 6f6c 6c73 2f22 202b 2063 6f6c 6c65  /colls/" + colle
-0000dcf0: 6374 696f 6e2e 6964 0a20 2020 2020 2020  ction.id.       
-0000dd00: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-0000dd10: 2020 2070 6572 6d69 7373 696f 6e5f 6f6e     permission_on
-0000dd20: 5f63 6f6c 6c20 3d20 7573 6572 2e63 7265  _coll = user.cre
-0000dd30: 6174 655f 7065 726d 6973 7369 6f6e 2862  ate_permission(b
-0000dd40: 6f64 793d 7065 726d 6973 7369 6f6e 290a  ody=permission).
-0000dd50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000dd60: 2e61 7373 6572 7449 734e 6f74 4e6f 6e65  .assertIsNotNone
-0000dd70: 2870 6572 6d69 7373 696f 6e5f 6f6e 5f63  (permission_on_c
-0000dd80: 6f6c 6c2e 7072 6f70 6572 7469 6573 5b27  oll.properties['
-0000dd90: 5f74 6f6b 656e 275d 2c0a 2020 2020 2020  _token'],.      
+0000db70: 2020 2020 2020 276b 6579 273a 2027 7661        'key': 'va
+0000db80: 6c75 6527 7d2c 0a20 2020 2020 2020 2020  lue'},.         
+0000db90: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+0000dba0: 2020 2320 6372 6561 7465 2075 7365 720a    # create user.
+0000dbb0: 2020 2020 2020 2020 2020 2020 7573 6572              user
+0000dbc0: 203d 2064 622e 6372 6561 7465 5f75 7365   = db.create_use
+0000dbd0: 7228 626f 6479 3d7b 2769 6427 3a20 2775  r(body={'id': 'u
+0000dbe0: 7365 7227 202b 2073 7472 2875 7569 642e  ser' + str(uuid.
+0000dbf0: 7575 6964 3428 2929 7d29 0a0a 2020 2020  uuid4())})..    
+0000dc00: 2020 2020 2020 2020 2320 6372 6561 7465          # create
+0000dc10: 2070 6572 6d69 7373 696f 6e20 666f 7220   permission for 
+0000dc20: 636f 6c6c 6563 7469 6f6e 0a20 2020 2020  collection.     
+0000dc30: 2020 2020 2020 2070 6572 6d69 7373 696f         permissio
+0000dc40: 6e20 3d20 7b0a 2020 2020 2020 2020 2020  n = {.          
+0000dc50: 2020 2020 2020 2769 6427 3a20 2770 6572        'id': 'per
+0000dc60: 6d69 7373 696f 6e20 4f6e 2043 6f6c 6c27  mission On Coll'
+0000dc70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000dc80: 2020 2770 6572 6d69 7373 696f 6e4d 6f64    'permissionMod
+0000dc90: 6527 3a20 646f 6375 6d65 6e74 732e 5065  e': documents.Pe
+0000dca0: 726d 6973 7369 6f6e 4d6f 6465 2e52 6561  rmissionMode.Rea
+0000dcb0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+0000dcc0: 2020 2027 7265 736f 7572 6365 273a 2022     'resource': "
+0000dcd0: 6462 732f 2220 2b20 6462 2e69 6420 2b20  dbs/" + db.id + 
+0000dce0: 222f 636f 6c6c 732f 2220 2b20 636f 6c6c  "/colls/" + coll
+0000dcf0: 6563 7469 6f6e 2e69 640a 2020 2020 2020  ection.id.      
+0000dd00: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0000dd10: 2020 2020 7065 726d 6973 7369 6f6e 5f6f      permission_o
+0000dd20: 6e5f 636f 6c6c 203d 2075 7365 722e 6372  n_coll = user.cr
+0000dd30: 6561 7465 5f70 6572 6d69 7373 696f 6e28  eate_permission(
+0000dd40: 626f 6479 3d70 6572 6d69 7373 696f 6e29  body=permission)
+0000dd50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000dd60: 662e 6173 7365 7274 4973 4e6f 744e 6f6e  f.assertIsNotNon
+0000dd70: 6528 7065 726d 6973 7369 6f6e 5f6f 6e5f  e(permission_on_
+0000dd80: 636f 6c6c 2e70 726f 7065 7274 6965 735b  coll.properties[
+0000dd90: 275f 746f 6b65 6e27 5d2c 0a20 2020 2020  '_token'],.     
 0000dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ddb0: 2020 2020 2020 2770 6572 6d69 7373 696f        'permissio
-0000ddc0: 6e20 746f 6b65 6e20 6973 2069 6e76 616c  n token is inval
-0000ddd0: 6964 2729 0a0a 2020 2020 2020 2020 2020  id')..          
-0000dde0: 2020 2320 6372 6561 7465 2070 6572 6d69    # create permi
-0000ddf0: 7373 696f 6e20 666f 7220 646f 6375 6d65  ssion for docume
-0000de00: 6e74 0a20 2020 2020 2020 2020 2020 2070  nt.            p
-0000de10: 6572 6d69 7373 696f 6e20 3d20 7b0a 2020  ermission = {.  
-0000de20: 2020 2020 2020 2020 2020 2020 2020 2769                'i
-0000de30: 6427 3a20 2770 6572 6d69 7373 696f 6e20  d': 'permission 
-0000de40: 4f6e 2044 6f63 272c 0a20 2020 2020 2020  On Doc',.       
-0000de50: 2020 2020 2020 2020 2027 7065 726d 6973           'permis
-0000de60: 7369 6f6e 4d6f 6465 273a 2064 6f63 756d  sionMode': docum
-0000de70: 656e 7473 2e50 6572 6d69 7373 696f 6e4d  ents.PermissionM
-0000de80: 6f64 652e 416c 6c2c 0a20 2020 2020 2020  ode.All,.       
-0000de90: 2020 2020 2020 2020 2027 7265 736f 7572           'resour
-0000dea0: 6365 273a 2022 6462 732f 2220 2b20 6462  ce': "dbs/" + db
-0000deb0: 2e69 6420 2b20 222f 636f 6c6c 732f 2220  .id + "/colls/" 
-0000dec0: 2b20 636f 6c6c 6563 7469 6f6e 2e69 6420  + collection.id 
-0000ded0: 2b20 222f 646f 6373 2f22 202b 2064 6f63  + "/docs/" + doc
-0000dee0: 756d 656e 745b 2269 6422 5d0a 2020 2020  ument["id"].    
-0000def0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0000df00: 2020 2020 2020 7065 726d 6973 7369 6f6e        permission
-0000df10: 5f6f 6e5f 646f 6320 3d20 7573 6572 2e63  _on_doc = user.c
-0000df20: 7265 6174 655f 7065 726d 6973 7369 6f6e  reate_permission
-0000df30: 2862 6f64 793d 7065 726d 6973 7369 6f6e  (body=permission
-0000df40: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000df50: 6c66 2e61 7373 6572 7449 734e 6f74 4e6f  lf.assertIsNotNo
-0000df60: 6e65 2870 6572 6d69 7373 696f 6e5f 6f6e  ne(permission_on
-0000df70: 5f64 6f63 2e70 726f 7065 7274 6965 735b  _doc.properties[
-0000df80: 275f 746f 6b65 6e27 5d2c 0a20 2020 2020  '_token'],.     
+0000ddb0: 2020 2020 2020 2027 7065 726d 6973 7369         'permissi
+0000ddc0: 6f6e 2074 6f6b 656e 2069 7320 696e 7661  on token is inva
+0000ddd0: 6c69 6427 290a 0a20 2020 2020 2020 2020  lid')..         
+0000dde0: 2020 2023 2063 7265 6174 6520 7065 726d     # create perm
+0000ddf0: 6973 7369 6f6e 2066 6f72 2064 6f63 756d  ission for docum
+0000de00: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+0000de10: 7065 726d 6973 7369 6f6e 203d 207b 0a20  permission = {. 
+0000de20: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0000de30: 6964 273a 2027 7065 726d 6973 7369 6f6e  id': 'permission
+0000de40: 204f 6e20 446f 6327 2c0a 2020 2020 2020   On Doc',.      
+0000de50: 2020 2020 2020 2020 2020 2770 6572 6d69            'permi
+0000de60: 7373 696f 6e4d 6f64 6527 3a20 646f 6375  ssionMode': docu
+0000de70: 6d65 6e74 732e 5065 726d 6973 7369 6f6e  ments.Permission
+0000de80: 4d6f 6465 2e41 6c6c 2c0a 2020 2020 2020  Mode.All,.      
+0000de90: 2020 2020 2020 2020 2020 2772 6573 6f75            'resou
+0000dea0: 7263 6527 3a20 2264 6273 2f22 202b 2064  rce': "dbs/" + d
+0000deb0: 622e 6964 202b 2022 2f63 6f6c 6c73 2f22  b.id + "/colls/"
+0000dec0: 202b 2063 6f6c 6c65 6374 696f 6e2e 6964   + collection.id
+0000ded0: 202b 2022 2f64 6f63 732f 2220 2b20 646f   + "/docs/" + do
+0000dee0: 6375 6d65 6e74 5b22 6964 225d 0a20 2020  cument["id"].   
+0000def0: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+0000df00: 2020 2020 2020 2070 6572 6d69 7373 696f         permissio
+0000df10: 6e5f 6f6e 5f64 6f63 203d 2075 7365 722e  n_on_doc = user.
+0000df20: 6372 6561 7465 5f70 6572 6d69 7373 696f  create_permissio
+0000df30: 6e28 626f 6479 3d70 6572 6d69 7373 696f  n(body=permissio
+0000df40: 6e29 0a20 2020 2020 2020 2020 2020 2073  n).            s
+0000df50: 656c 662e 6173 7365 7274 4973 4e6f 744e  elf.assertIsNotN
+0000df60: 6f6e 6528 7065 726d 6973 7369 6f6e 5f6f  one(permission_o
+0000df70: 6e5f 646f 632e 7072 6f70 6572 7469 6573  n_doc.properties
+0000df80: 5b27 5f74 6f6b 656e 275d 2c0a 2020 2020  ['_token'],.    
 0000df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfa0: 2020 2020 2020 2027 7065 726d 6973 7369         'permissi
-0000dfb0: 6f6e 2074 6f6b 656e 2069 7320 696e 7661  on token is inva
-0000dfc0: 6c69 6427 290a 0a20 2020 2020 2020 2020  lid')..         
-0000dfd0: 2020 2065 6e74 6974 6965 7320 3d20 7b0a     entities = {.
-0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dff0: 2764 6227 3a20 6462 2c0a 2020 2020 2020  'db': db,.      
-0000e000: 2020 2020 2020 2020 2020 2763 6f6c 6c27            'coll'
-0000e010: 3a20 636f 6c6c 6563 7469 6f6e 2c0a 2020  : collection,.  
-0000e020: 2020 2020 2020 2020 2020 2020 2020 2764                'd
-0000e030: 6f63 273a 2064 6f63 756d 656e 742c 0a20  oc': document,. 
-0000e040: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000e050: 7573 6572 273a 2075 7365 722c 0a20 2020  user': user,.   
-0000e060: 2020 2020 2020 2020 2020 2020 2027 7065               'pe
-0000e070: 726d 6973 7369 6f6e 4f6e 436f 6c6c 273a  rmissionOnColl':
-0000e080: 2070 6572 6d69 7373 696f 6e5f 6f6e 5f63   permission_on_c
-0000e090: 6f6c 6c2c 0a20 2020 2020 2020 2020 2020  oll,.           
-0000e0a0: 2020 2020 2027 7065 726d 6973 7369 6f6e       'permission
-0000e0b0: 4f6e 446f 6327 3a20 7065 726d 6973 7369  OnDoc': permissi
-0000e0c0: 6f6e 5f6f 6e5f 646f 632c 0a20 2020 2020  on_on_doc,.     
-0000e0d0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0000e0e0: 2020 2020 2072 6574 7572 6e20 656e 7469       return enti
-0000e0f0: 7469 6573 0a0a 2020 2020 2020 2020 2320  ties..        # 
-0000e100: 436c 6965 6e74 2077 6974 686f 7574 2061  Client without a
-0000e110: 6e79 2061 7574 686f 7269 7a61 7469 6f6e  ny authorization
-0000e120: 2077 696c 6c20 6661 696c 2e0a 2020 2020   will fail..    
-0000e130: 2020 2020 636c 6965 6e74 203d 2063 6f73      client = cos
-0000e140: 6d6f 735f 636c 6965 6e74 2e43 6f73 6d6f  mos_client.Cosmo
-0000e150: 7343 6c69 656e 7428 4352 5544 5465 7374  sClient(CRUDTest
-0000e160: 732e 686f 7374 2c20 7b7d 2c20 2253 6573  s.host, {}, "Ses
-0000e170: 7369 6f6e 222c 2063 6f6e 6e65 6374 696f  sion", connectio
-0000e180: 6e5f 706f 6c69 6379 3d43 5255 4454 6573  n_policy=CRUDTes
-0000e190: 7473 2e63 6f6e 6e65 6374 696f 6e50 6f6c  ts.connectionPol
-0000e1a0: 6963 7929 0a20 2020 2020 2020 2073 656c  icy).        sel
-0000e1b0: 662e 5f5f 4173 7365 7274 4854 5450 4661  f.__AssertHTTPFa
-0000e1c0: 696c 7572 6557 6974 6853 7461 7475 7328  ilureWithStatus(
-0000e1d0: 5374 6174 7573 436f 6465 732e 554e 4155  StatusCodes.UNAU
-0000e1e0: 5448 4f52 495a 4544 2c0a 2020 2020 2020  THORIZED,.      
-0000e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e210: 2020 2020 206c 6973 742c 0a20 2020 2020       list,.     
-0000e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e240: 2020 2020 2020 636c 6965 6e74 2e6c 6973        client.lis
-0000e250: 745f 6461 7461 6261 7365 7328 2929 0a20  t_databases()). 
-0000e260: 2020 2020 2020 2023 2043 6c69 656e 7420         # Client 
-0000e270: 7769 7468 206d 6173 7465 7220 6b65 792e  with master key.
-0000e280: 0a20 2020 2020 2020 2063 6c69 656e 7420  .        client 
-0000e290: 3d20 636f 736d 6f73 5f63 6c69 656e 742e  = cosmos_client.
-0000e2a0: 436f 736d 6f73 436c 6965 6e74 2843 5255  CosmosClient(CRU
-0000e2b0: 4454 6573 7473 2e68 6f73 742c 0a20 2020  DTests.host,.   
-0000e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2e0: 2020 2020 2020 2020 2043 5255 4454 6573           CRUDTes
-0000e2f0: 7473 2e6d 6173 7465 724b 6579 2c0a 2020  ts.masterKey,.  
-0000e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e320: 2020 2020 2020 2020 2020 2253 6573 7369            "Sessi
-0000e330: 6f6e 222c 0a20 2020 2020 2020 2020 2020  on",.           
-0000e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfa0: 2020 2020 2020 2020 2770 6572 6d69 7373          'permiss
+0000dfb0: 696f 6e20 746f 6b65 6e20 6973 2069 6e76  ion token is inv
+0000dfc0: 616c 6964 2729 0a0a 2020 2020 2020 2020  alid')..        
+0000dfd0: 2020 2020 656e 7469 7469 6573 203d 207b      entities = {
+0000dfe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dff0: 2027 6462 273a 2064 622c 0a20 2020 2020   'db': db,.     
+0000e000: 2020 2020 2020 2020 2020 2027 636f 6c6c             'coll
+0000e010: 273a 2063 6f6c 6c65 6374 696f 6e2c 0a20  ': collection,. 
+0000e020: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0000e030: 646f 6327 3a20 646f 6375 6d65 6e74 2c0a  doc': document,.
+0000e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e050: 2775 7365 7227 3a20 7573 6572 2c0a 2020  'user': user,.  
+0000e060: 2020 2020 2020 2020 2020 2020 2020 2770                'p
+0000e070: 6572 6d69 7373 696f 6e4f 6e43 6f6c 6c27  ermissionOnColl'
+0000e080: 3a20 7065 726d 6973 7369 6f6e 5f6f 6e5f  : permission_on_
+0000e090: 636f 6c6c 2c0a 2020 2020 2020 2020 2020  coll,.          
+0000e0a0: 2020 2020 2020 2770 6572 6d69 7373 696f        'permissio
+0000e0b0: 6e4f 6e44 6f63 273a 2070 6572 6d69 7373  nOnDoc': permiss
+0000e0c0: 696f 6e5f 6f6e 5f64 6f63 2c0a 2020 2020  ion_on_doc,.    
+0000e0d0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0000e0e0: 2020 2020 2020 7265 7475 726e 2065 6e74        return ent
+0000e0f0: 6974 6965 730a 0a20 2020 2020 2020 2023  ities..        #
+0000e100: 2043 6c69 656e 7420 7769 7468 6f75 7420   Client without 
+0000e110: 616e 7920 6175 7468 6f72 697a 6174 696f  any authorizatio
+0000e120: 6e20 7769 6c6c 2066 6169 6c2e 0a20 2020  n will fail..   
+0000e130: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000e140: 2020 2020 2020 636f 736d 6f73 5f63 6c69        cosmos_cli
+0000e150: 656e 742e 436f 736d 6f73 436c 6965 6e74  ent.CosmosClient
+0000e160: 2843 5255 4454 6573 7473 2e68 6f73 742c  (CRUDTests.host,
+0000e170: 207b 7d2c 2022 5365 7373 696f 6e22 2c20   {}, "Session", 
+0000e180: 636f 6e6e 6563 7469 6f6e 5f70 6f6c 6963  connection_polic
+0000e190: 793d 4352 5544 5465 7374 732e 636f 6e6e  y=CRUDTests.conn
+0000e1a0: 6563 7469 6f6e 506f 6c69 6379 290a 2020  ectionPolicy).  
+0000e1b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000e1c0: 4578 6365 7074 696f 6e28 2254 6573 7420  Exception("Test 
+0000e1d0: 6469 6420 6e6f 7420 6661 696c 2061 7320  did not fail as 
+0000e1e0: 6578 7065 6374 6564 2e22 290a 2020 2020  expected.").    
+0000e1f0: 2020 2020 6578 6365 7074 2065 7863 6570      except excep
+0000e200: 7469 6f6e 732e 436f 736d 6f73 4874 7470  tions.CosmosHttp
+0000e210: 5265 7370 6f6e 7365 4572 726f 7220 6173  ResponseError as
+0000e220: 2065 7272 6f72 3a0a 2020 2020 2020 2020   error:.        
+0000e230: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000e240: 7175 616c 2865 7272 6f72 2e73 7461 7475  qual(error.statu
+0000e250: 735f 636f 6465 2c20 5374 6174 7573 436f  s_code, StatusCo
+0000e260: 6465 732e 554e 4155 5448 4f52 495a 4544  des.UNAUTHORIZED
+0000e270: 290a 0a20 2020 2020 2020 2023 2043 6c69  )..        # Cli
+0000e280: 656e 7420 7769 7468 206d 6173 7465 7220  ent with master 
+0000e290: 6b65 792e 0a20 2020 2020 2020 2063 6c69  key..        cli
+0000e2a0: 656e 7420 3d20 636f 736d 6f73 5f63 6c69  ent = cosmos_cli
+0000e2b0: 656e 742e 436f 736d 6f73 436c 6965 6e74  ent.CosmosClient
+0000e2c0: 2843 5255 4454 6573 7473 2e68 6f73 742c  (CRUDTests.host,
+0000e2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e2f0: 2020 2020 2020 2020 2020 2020 2043 5255               CRU
+0000e300: 4454 6573 7473 2e6d 6173 7465 724b 6579  DTests.masterKey
+0000e310: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e330: 2020 2020 2020 2020 2020 2020 2020 2253                "S
+0000e340: 6573 7369 6f6e 222c 0a20 2020 2020 2020  ession",.       
 0000e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e360: 2063 6f6e 6e65 6374 696f 6e5f 706f 6c69   connection_poli
-0000e370: 6379 3d43 5255 4454 6573 7473 2e63 6f6e  cy=CRUDTests.con
-0000e380: 6e65 6374 696f 6e50 6f6c 6963 7929 0a20  nectionPolicy). 
-0000e390: 2020 2020 2020 2023 2073 6574 7570 2065         # setup e
-0000e3a0: 6e74 6974 6965 730a 2020 2020 2020 2020  ntities.        
-0000e3b0: 656e 7469 7469 6573 203d 205f 5f53 6574  entities = __Set
-0000e3c0: 7570 456e 7469 7469 6573 2863 6c69 656e  upEntities(clien
-0000e3d0: 7429 0a20 2020 2020 2020 2072 6573 6f75  t).        resou
-0000e3e0: 7263 655f 746f 6b65 6e73 203d 207b 2264  rce_tokens = {"d
-0000e3f0: 6273 2f22 202b 2065 6e74 6974 6965 735b  bs/" + entities[
-0000e400: 2764 6227 5d2e 6964 202b 2022 2f63 6f6c  'db'].id + "/col
-0000e410: 6c73 2f22 202b 2065 6e74 6974 6965 735b  ls/" + entities[
-0000e420: 2763 6f6c 6c27 5d2e 6964 3a0a 2020 2020  'coll'].id:.    
-0000e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e440: 2020 2020 2020 2065 6e74 6974 6965 735b         entities[
-0000e450: 2770 6572 6d69 7373 696f 6e4f 6e43 6f6c  'permissionOnCol
-0000e460: 6c27 5d2e 7072 6f70 6572 7469 6573 5b27  l'].properties['
-0000e470: 5f74 6f6b 656e 275d 7d0a 2020 2020 2020  _token']}.      
-0000e480: 2020 636f 6c5f 636c 6965 6e74 203d 2063    col_client = c
-0000e490: 6f73 6d6f 735f 636c 6965 6e74 2e43 6f73  osmos_client.Cos
-0000e4a0: 6d6f 7343 6c69 656e 7428 0a20 2020 2020  mosClient(.     
-0000e4b0: 2020 2020 2020 2043 5255 4454 6573 7473         CRUDTests
-0000e4c0: 2e68 6f73 742c 2072 6573 6f75 7263 655f  .host, resource_
-0000e4d0: 746f 6b65 6e73 2c22 5365 7373 696f 6e22  tokens,"Session"
-0000e4e0: 2c20 636f 6e6e 6563 7469 6f6e 5f70 6f6c  , connection_pol
-0000e4f0: 6963 793d 4352 5544 5465 7374 732e 636f  icy=CRUDTests.co
-0000e500: 6e6e 6563 7469 6f6e 506f 6c69 6379 290a  nnectionPolicy).
-0000e510: 2020 2020 2020 2020 6462 203d 2065 6e74          db = ent
-0000e520: 6974 6965 735b 2764 6227 5d0a 0a20 2020  ities['db']..   
-0000e530: 2020 2020 206f 6c64 5f63 6c69 656e 745f       old_client_
-0000e540: 636f 6e6e 6563 7469 6f6e 203d 2064 622e  connection = db.
-0000e550: 636c 6965 6e74 5f63 6f6e 6e65 6374 696f  client_connectio
-0000e560: 6e0a 2020 2020 2020 2020 6462 2e63 6c69  n.        db.cli
-0000e570: 656e 745f 636f 6e6e 6563 7469 6f6e 203d  ent_connection =
-0000e580: 2063 6f6c 5f63 6c69 656e 742e 636c 6965   col_client.clie
-0000e590: 6e74 5f63 6f6e 6e65 6374 696f 6e0a 2020  nt_connection.  
-0000e5a0: 2020 2020 2020 2320 312e 2053 7563 6365        # 1. Succe
-0000e5b0: 7373 2d2d 2055 7365 2043 6f6c 2050 6572  ss-- Use Col Per
-0000e5c0: 6d69 7373 696f 6e20 746f 2052 6561 640a  mission to Read.
-0000e5d0: 2020 2020 2020 2020 7375 6363 6573 735f          success_
-0000e5e0: 636f 6c6c 203d 2064 622e 6765 745f 636f  coll = db.get_co
-0000e5f0: 6e74 6169 6e65 725f 636c 6965 6e74 2863  ntainer_client(c
-0000e600: 6f6e 7461 696e 6572 3d65 6e74 6974 6965  ontainer=entitie
-0000e610: 735b 2763 6f6c 6c27 5d29 0a20 2020 2020  s['coll']).     
-0000e620: 2020 2023 2032 2e20 4661 696c 7572 652d     # 2. Failure-
-0000e630: 2d20 5573 6520 436f 6c20 5065 726d 6973  - Use Col Permis
-0000e640: 7369 6f6e 2074 6f20 6465 6c65 7465 0a20  sion to delete. 
-0000e650: 2020 2020 2020 2073 656c 662e 5f5f 4173         self.__As
-0000e660: 7365 7274 4854 5450 4661 696c 7572 6557  sertHTTPFailureW
-0000e670: 6974 6853 7461 7475 7328 5374 6174 7573  ithStatus(Status
-0000e680: 436f 6465 732e 464f 5242 4944 4445 4e2c  Codes.FORBIDDEN,
-0000e690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6b0: 2020 2020 2020 2020 2020 2020 6462 2e64              db.d
-0000e6c0: 656c 6574 655f 636f 6e74 6169 6e65 722c  elete_container,
-0000e6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6f0: 2020 2020 2020 2020 2020 2020 7375 6363              succ
-0000e700: 6573 735f 636f 6c6c 290a 2020 2020 2020  ess_coll).      
-0000e710: 2020 2320 332e 2053 7563 6365 7373 2d2d    # 3. Success--
-0000e720: 2055 7365 2043 6f6c 2050 6572 6d69 7373   Use Col Permiss
-0000e730: 696f 6e20 746f 2052 6561 6420 416c 6c20  ion to Read All 
-0000e740: 446f 6373 0a20 2020 2020 2020 2073 7563  Docs.        suc
-0000e750: 6365 7373 5f64 6f63 756d 656e 7473 203d  cess_documents =
-0000e760: 206c 6973 7428 7375 6363 6573 735f 636f   list(success_co
-0000e770: 6c6c 2e72 6561 645f 616c 6c5f 6974 656d  ll.read_all_item
-0000e780: 7328 2929 0a20 2020 2020 2020 2073 656c  s()).        sel
-0000e790: 662e 6173 7365 7274 5472 7565 2873 7563  f.assertTrue(suc
-0000e7a0: 6365 7373 5f64 6f63 756d 656e 7473 2021  cess_documents !
-0000e7b0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0000e7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e7d0: 2765 7272 6f72 2072 6561 6469 6e67 2064  'error reading d
-0000e7e0: 6f63 756d 656e 7473 2729 0a20 2020 2020  ocuments').     
-0000e7f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000e800: 7561 6c28 6c65 6e28 7375 6363 6573 735f  ual(len(success_
-0000e810: 646f 6375 6d65 6e74 7329 2c0a 2020 2020  documents),.    
-0000e820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e830: 2020 2020 2031 2c0a 2020 2020 2020 2020       1,.        
-0000e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e850: 2027 4578 7065 6374 6564 2031 2044 6f63   'Expected 1 Doc
-0000e860: 756d 656e 7420 746f 2062 6520 7375 6363  ument to be succ
-0000e870: 6573 7366 756c 6c79 2072 6561 6427 290a  essfully read').
-0000e880: 2020 2020 2020 2020 2320 342e 2053 7563          # 4. Suc
-0000e890: 6365 7373 2d2d 2055 7365 2043 6f6c 2050  cess-- Use Col P
-0000e8a0: 6572 6d69 7373 696f 6e20 746f 2052 6561  ermission to Rea
-0000e8b0: 6420 446f 630a 0a20 2020 2020 2020 2064  d Doc..        d
-0000e8c0: 6f63 4964 203d 2065 6e74 6974 6965 735b  ocId = entities[
-0000e8d0: 2764 6f63 275d 5b27 6964 275d 0a20 2020  'doc']['id'].   
-0000e8e0: 2020 2020 2073 7563 6365 7373 5f64 6f63       success_doc
-0000e8f0: 203d 2073 7563 6365 7373 5f63 6f6c 6c2e   = success_coll.
-0000e900: 7265 6164 5f69 7465 6d28 0a20 2020 2020  read_item(.     
-0000e910: 2020 2020 2020 2069 7465 6d3d 646f 6349         item=docI
-0000e920: 642c 0a20 2020 2020 2020 2020 2020 2070  d,.            p
-0000e930: 6172 7469 7469 6f6e 5f6b 6579 3d64 6f63  artition_key=doc
-0000e940: 4964 0a20 2020 2020 2020 2029 0a20 2020  Id.        ).   
-0000e950: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000e960: 5472 7565 2873 7563 6365 7373 5f64 6f63  True(success_doc
-0000e970: 2021 3d20 4e6f 6e65 2c20 2765 7272 6f72   != None, 'error
-0000e980: 2072 6561 6469 6e67 2064 6f63 756d 656e   reading documen
-0000e990: 7427 290a 2020 2020 2020 2020 7365 6c66  t').        self
-0000e9a0: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-0000e9b0: 2020 2020 2020 2020 2020 7375 6363 6573            succes
-0000e9c0: 735f 646f 635b 2769 6427 5d2c 0a20 2020  s_doc['id'],.   
-0000e9d0: 2020 2020 2020 2020 2065 6e74 6974 6965           entitie
-0000e9e0: 735b 2764 6f63 275d 5b27 6964 275d 2c0a  s['doc']['id'],.
-0000e9f0: 2020 2020 2020 2020 2020 2020 2745 7870              'Exp
-0000ea00: 6563 7465 6420 746f 2072 6561 6420 6368  ected to read ch
-0000ea10: 696c 6472 656e 2075 7369 6e67 2070 6172  ildren using par
-0000ea20: 656e 7420 7065 726d 6973 7369 6f6e 7327  ent permissions'
-0000ea30: 290a 0a20 2020 2020 2020 2023 352e 2046  )..        #5. F
-0000ea40: 6169 6c75 7265 2d2d 2055 7365 2043 6f6c  ailure-- Use Col
-0000ea50: 2050 6572 6d69 7373 696f 6e20 746f 2044   Permission to D
-0000ea60: 656c 6574 6520 446f 630a 2020 2020 2020  elete Doc.      
-0000ea70: 2020 7365 6c66 2e5f 5f41 7373 6572 7448    self.__AssertH
-0000ea80: 5454 5046 6169 6c75 7265 5769 7468 5374  TTPFailureWithSt
-0000ea90: 6174 7573 2853 7461 7475 7343 6f64 6573  atus(StatusCodes
-0000eaa0: 2e46 4f52 4249 4444 454e 2c0a 2020 2020  .FORBIDDEN,.    
-0000eab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e370: 2020 2020 2063 6f6e 6e65 6374 696f 6e5f       connection_
+0000e380: 706f 6c69 6379 3d43 5255 4454 6573 7473  policy=CRUDTests
+0000e390: 2e63 6f6e 6e65 6374 696f 6e50 6f6c 6963  .connectionPolic
+0000e3a0: 7929 0a20 2020 2020 2020 2023 2073 6574  y).        # set
+0000e3b0: 7570 2065 6e74 6974 6965 730a 2020 2020  up entities.    
+0000e3c0: 2020 2020 656e 7469 7469 6573 203d 205f      entities = _
+0000e3d0: 5f53 6574 7570 456e 7469 7469 6573 2863  _SetupEntities(c
+0000e3e0: 6c69 656e 7429 0a20 2020 2020 2020 2072  lient).        r
+0000e3f0: 6573 6f75 7263 655f 746f 6b65 6e73 203d  esource_tokens =
+0000e400: 207b 2264 6273 2f22 202b 2065 6e74 6974   {"dbs/" + entit
+0000e410: 6965 735b 2764 6227 5d2e 6964 202b 2022  ies['db'].id + "
+0000e420: 2f63 6f6c 6c73 2f22 202b 2065 6e74 6974  /colls/" + entit
+0000e430: 6965 735b 2763 6f6c 6c27 5d2e 6964 3a0a  ies['coll'].id:.
+0000e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e450: 2020 2020 2020 2020 2020 2065 6e74 6974             entit
+0000e460: 6965 735b 2770 6572 6d69 7373 696f 6e4f  ies['permissionO
+0000e470: 6e43 6f6c 6c27 5d2e 7072 6f70 6572 7469  nColl'].properti
+0000e480: 6573 5b27 5f74 6f6b 656e 275d 7d0a 2020  es['_token']}.  
+0000e490: 2020 2020 2020 636f 6c5f 636c 6965 6e74        col_client
+0000e4a0: 203d 2063 6f73 6d6f 735f 636c 6965 6e74   = cosmos_client
+0000e4b0: 2e43 6f73 6d6f 7343 6c69 656e 7428 0a20  .CosmosClient(. 
+0000e4c0: 2020 2020 2020 2020 2020 2043 5255 4454             CRUDT
+0000e4d0: 6573 7473 2e68 6f73 742c 2072 6573 6f75  ests.host, resou
+0000e4e0: 7263 655f 746f 6b65 6e73 2c22 5365 7373  rce_tokens,"Sess
+0000e4f0: 696f 6e22 2c20 636f 6e6e 6563 7469 6f6e  ion", connection
+0000e500: 5f70 6f6c 6963 793d 4352 5544 5465 7374  _policy=CRUDTest
+0000e510: 732e 636f 6e6e 6563 7469 6f6e 506f 6c69  s.connectionPoli
+0000e520: 6379 290a 2020 2020 2020 2020 6462 203d  cy).        db =
+0000e530: 2065 6e74 6974 6965 735b 2764 6227 5d0a   entities['db'].
+0000e540: 0a20 2020 2020 2020 206f 6c64 5f63 6c69  .        old_cli
+0000e550: 656e 745f 636f 6e6e 6563 7469 6f6e 203d  ent_connection =
+0000e560: 2064 622e 636c 6965 6e74 5f63 6f6e 6e65   db.client_conne
+0000e570: 6374 696f 6e0a 2020 2020 2020 2020 6462  ction.        db
+0000e580: 2e63 6c69 656e 745f 636f 6e6e 6563 7469  .client_connecti
+0000e590: 6f6e 203d 2063 6f6c 5f63 6c69 656e 742e  on = col_client.
+0000e5a0: 636c 6965 6e74 5f63 6f6e 6e65 6374 696f  client_connectio
+0000e5b0: 6e0a 2020 2020 2020 2020 2320 312e 2053  n.        # 1. S
+0000e5c0: 7563 6365 7373 2d2d 2055 7365 2043 6f6c  uccess-- Use Col
+0000e5d0: 2050 6572 6d69 7373 696f 6e20 746f 2052   Permission to R
+0000e5e0: 6561 640a 2020 2020 2020 2020 7375 6363  ead.        succ
+0000e5f0: 6573 735f 636f 6c6c 203d 2064 622e 6765  ess_coll = db.ge
+0000e600: 745f 636f 6e74 6169 6e65 725f 636c 6965  t_container_clie
+0000e610: 6e74 2863 6f6e 7461 696e 6572 3d65 6e74  nt(container=ent
+0000e620: 6974 6965 735b 2763 6f6c 6c27 5d29 0a20  ities['coll']). 
+0000e630: 2020 2020 2020 2023 2032 2e20 4661 696c         # 2. Fail
+0000e640: 7572 652d 2d20 5573 6520 436f 6c20 5065  ure-- Use Col Pe
+0000e650: 726d 6973 7369 6f6e 2074 6f20 6465 6c65  rmission to dele
+0000e660: 7465 0a20 2020 2020 2020 2073 656c 662e  te.        self.
+0000e670: 5f5f 4173 7365 7274 4854 5450 4661 696c  __AssertHTTPFail
+0000e680: 7572 6557 6974 6853 7461 7475 7328 5374  ureWithStatus(St
+0000e690: 6174 7573 436f 6465 732e 464f 5242 4944  atusCodes.FORBID
+0000e6a0: 4445 4e2c 0a20 2020 2020 2020 2020 2020  DEN,.           
+0000e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6d0: 6462 2e64 656c 6574 655f 636f 6e74 6169  db.delete_contai
+0000e6e0: 6e65 722c 0a20 2020 2020 2020 2020 2020  ner,.           
+0000e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e710: 7375 6363 6573 735f 636f 6c6c 290a 2020  success_coll).  
+0000e720: 2020 2020 2020 2320 332e 2053 7563 6365        # 3. Succe
+0000e730: 7373 2d2d 2055 7365 2043 6f6c 2050 6572  ss-- Use Col Per
+0000e740: 6d69 7373 696f 6e20 746f 2052 6561 6420  mission to Read 
+0000e750: 416c 6c20 446f 6373 0a20 2020 2020 2020  All Docs.       
+0000e760: 2073 7563 6365 7373 5f64 6f63 756d 656e   success_documen
+0000e770: 7473 203d 206c 6973 7428 7375 6363 6573  ts = list(succes
+0000e780: 735f 636f 6c6c 2e72 6561 645f 616c 6c5f  s_coll.read_all_
+0000e790: 6974 656d 7328 2929 0a20 2020 2020 2020  items()).       
+0000e7a0: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
+0000e7b0: 2873 7563 6365 7373 5f64 6f63 756d 656e  (success_documen
+0000e7c0: 7473 2021 3d20 4e6f 6e65 2c0a 2020 2020  ts != None,.    
+0000e7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e7e0: 2020 2020 2765 7272 6f72 2072 6561 6469      'error readi
+0000e7f0: 6e67 2064 6f63 756d 656e 7473 2729 0a20  ng documents'). 
+0000e800: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000e810: 7274 4571 7561 6c28 6c65 6e28 7375 6363  rtEqual(len(succ
+0000e820: 6573 735f 646f 6375 6d65 6e74 7329 2c0a  ess_documents),.
+0000e830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e840: 2020 2020 2020 2020 2031 2c0a 2020 2020           1,.    
+0000e850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e860: 2020 2020 2027 4578 7065 6374 6564 2031       'Expected 1
+0000e870: 2044 6f63 756d 656e 7420 746f 2062 6520   Document to be 
+0000e880: 7375 6363 6573 7366 756c 6c79 2072 6561  successfully rea
+0000e890: 6427 290a 2020 2020 2020 2020 2320 342e  d').        # 4.
+0000e8a0: 2053 7563 6365 7373 2d2d 2055 7365 2043   Success-- Use C
+0000e8b0: 6f6c 2050 6572 6d69 7373 696f 6e20 746f  ol Permission to
+0000e8c0: 2052 6561 6420 446f 630a 0a20 2020 2020   Read Doc..     
+0000e8d0: 2020 2064 6f63 4964 203d 2065 6e74 6974     docId = entit
+0000e8e0: 6965 735b 2764 6f63 275d 5b27 6964 275d  ies['doc']['id']
+0000e8f0: 0a20 2020 2020 2020 2073 7563 6365 7373  .        success
+0000e900: 5f64 6f63 203d 2073 7563 6365 7373 5f63  _doc = success_c
+0000e910: 6f6c 6c2e 7265 6164 5f69 7465 6d28 0a20  oll.read_item(. 
+0000e920: 2020 2020 2020 2020 2020 2069 7465 6d3d             item=
+0000e930: 646f 6349 642c 0a20 2020 2020 2020 2020  docId,.         
+0000e940: 2020 2070 6172 7469 7469 6f6e 5f6b 6579     partition_key
+0000e950: 3d64 6f63 4964 0a20 2020 2020 2020 2029  =docId.        )
+0000e960: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000e970: 7365 7274 5472 7565 2873 7563 6365 7373  sertTrue(success
+0000e980: 5f64 6f63 2021 3d20 4e6f 6e65 2c20 2765  _doc != None, 'e
+0000e990: 7272 6f72 2072 6561 6469 6e67 2064 6f63  rror reading doc
+0000e9a0: 756d 656e 7427 290a 2020 2020 2020 2020  ument').        
+0000e9b0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000e9c0: 280a 2020 2020 2020 2020 2020 2020 7375  (.            su
+0000e9d0: 6363 6573 735f 646f 635b 2769 6427 5d2c  ccess_doc['id'],
+0000e9e0: 0a20 2020 2020 2020 2020 2020 2065 6e74  .            ent
+0000e9f0: 6974 6965 735b 2764 6f63 275d 5b27 6964  ities['doc']['id
+0000ea00: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+0000ea10: 2745 7870 6563 7465 6420 746f 2072 6561  'Expected to rea
+0000ea20: 6420 6368 696c 6472 656e 2075 7369 6e67  d children using
+0000ea30: 2070 6172 656e 7420 7065 726d 6973 7369   parent permissi
+0000ea40: 6f6e 7327 290a 0a20 2020 2020 2020 2023  ons')..        #
+0000ea50: 352e 2046 6169 6c75 7265 2d2d 2055 7365  5. Failure-- Use
+0000ea60: 2043 6f6c 2050 6572 6d69 7373 696f 6e20   Col Permission 
+0000ea70: 746f 2044 656c 6574 6520 446f 630a 2020  to Delete Doc.  
+0000ea80: 2020 2020 2020 7365 6c66 2e5f 5f41 7373        self.__Ass
+0000ea90: 6572 7448 5454 5046 6169 6c75 7265 5769  ertHTTPFailureWi
+0000eaa0: 7468 5374 6174 7573 2853 7461 7475 7343  thStatus(StatusC
+0000eab0: 6f64 6573 2e46 4f52 4249 4444 454e 2c0a  odes.FORBIDDEN,.
 0000eac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ead0: 2020 2020 2020 2073 7563 6365 7373 5f63         success_c
-0000eae0: 6f6c 6c2e 6465 6c65 7465 5f69 7465 6d2c  oll.delete_item,
-0000eaf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb10: 2020 2020 2020 2020 2020 2020 646f 6349              docI
-0000eb20: 642c 2064 6f63 4964 290a 0a20 2020 2020  d, docId)..     
-0000eb30: 2020 2072 6573 6f75 7263 655f 746f 6b65     resource_toke
-0000eb40: 6e73 203d 207b 2264 6273 2f22 202b 2065  ns = {"dbs/" + e
-0000eb50: 6e74 6974 6965 735b 2764 6227 5d2e 6964  ntities['db'].id
-0000eb60: 202b 2022 2f63 6f6c 6c73 2f22 202b 2065   + "/colls/" + e
-0000eb70: 6e74 6974 6965 735b 2763 6f6c 6c27 5d2e  ntities['coll'].
-0000eb80: 6964 202b 2022 2f64 6f63 732f 2220 2b20  id + "/docs/" + 
-0000eb90: 646f 6349 6420 3a0a 2020 2020 2020 2020  docId :.        
-0000eba0: 2020 2020 656e 7469 7469 6573 5b27 7065      entities['pe
-0000ebb0: 726d 6973 7369 6f6e 4f6e 446f 6327 5d2e  rmissionOnDoc'].
-0000ebc0: 7072 6f70 6572 7469 6573 5b27 5f74 6f6b  properties['_tok
-0000ebd0: 656e 275d 7d0a 0a20 2020 2020 2020 2064  en']}..        d
-0000ebe0: 6f63 5f63 6c69 656e 7420 3d20 636f 736d  oc_client = cosm
-0000ebf0: 6f73 5f63 6c69 656e 742e 436f 736d 6f73  os_client.Cosmos
-0000ec00: 436c 6965 6e74 280a 2020 2020 2020 2020  Client(.        
-0000ec10: 2020 2020 4352 5544 5465 7374 732e 686f      CRUDTests.ho
-0000ec20: 7374 2c20 7265 736f 7572 6365 5f74 6f6b  st, resource_tok
-0000ec30: 656e 732c 2253 6573 7369 6f6e 222c 2063  ens,"Session", c
-0000ec40: 6f6e 6e65 6374 696f 6e5f 706f 6c69 6379  onnection_policy
-0000ec50: 3d43 5255 4454 6573 7473 2e63 6f6e 6e65  =CRUDTests.conne
-0000ec60: 6374 696f 6e50 6f6c 6963 7929 0a0a 2020  ctionPolicy)..  
-0000ec70: 2020 2020 2020 2336 2e20 5375 6363 6573        #6. Succes
-0000ec80: 732d 2d20 5573 6520 446f 6320 7065 726d  s-- Use Doc perm
-0000ec90: 6973 7369 6f6e 2074 6f20 7265 6164 2064  ission to read d
-0000eca0: 6f63 0a20 2020 2020 2020 2072 6561 645f  oc.        read_
-0000ecb0: 646f 6320 3d20 646f 635f 636c 6965 6e74  doc = doc_client
-0000ecc0: 2e67 6574 5f64 6174 6162 6173 655f 636c  .get_database_cl
-0000ecd0: 6965 6e74 2864 622e 6964 292e 6765 745f  ient(db.id).get_
-0000ece0: 636f 6e74 6169 6e65 725f 636c 6965 6e74  container_client
-0000ecf0: 2873 7563 6365 7373 5f63 6f6c 6c2e 6964  (success_coll.id
-0000ed00: 292e 7265 6164 5f69 7465 6d28 646f 6349  ).read_item(docI
-0000ed10: 642c 2064 6f63 4964 290a 2020 2020 2020  d, docId).      
-0000ed20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000ed30: 616c 2872 6561 645f 646f 635b 2269 6422  al(read_doc["id"
-0000ed40: 5d2c 2064 6f63 4964 290a 0a20 2020 2020  ], docId)..     
-0000ed50: 2020 2023 362e 2053 7563 6365 7373 2d2d     #6. Success--
-0000ed60: 2055 7365 2044 6f63 2070 6572 6d69 7373   Use Doc permiss
-0000ed70: 696f 6e20 746f 2064 656c 6574 6520 646f  ion to delete do
-0000ed80: 630a 2020 2020 2020 2020 646f 635f 636c  c.        doc_cl
-0000ed90: 6965 6e74 2e67 6574 5f64 6174 6162 6173  ient.get_databas
-0000eda0: 655f 636c 6965 6e74 2864 622e 6964 292e  e_client(db.id).
-0000edb0: 6765 745f 636f 6e74 6169 6e65 725f 636c  get_container_cl
-0000edc0: 6965 6e74 2873 7563 6365 7373 5f63 6f6c  ient(success_col
-0000edd0: 6c2e 6964 292e 6465 6c65 7465 5f69 7465  l.id).delete_ite
-0000ede0: 6d28 646f 6349 642c 2064 6f63 4964 290a  m(docId, docId).
-0000edf0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000ee00: 6572 7445 7175 616c 2872 6561 645f 646f  ertEqual(read_do
-0000ee10: 635b 2269 6422 5d2c 2064 6f63 4964 290a  c["id"], docId).
-0000ee20: 0a20 2020 2020 2020 2064 622e 636c 6965  .        db.clie
-0000ee30: 6e74 5f63 6f6e 6e65 6374 696f 6e20 3d20  nt_connection = 
-0000ee40: 6f6c 645f 636c 6965 6e74 5f63 6f6e 6e65  old_client_conne
-0000ee50: 6374 696f 6e0a 2020 2020 2020 2020 6462  ction.        db
-0000ee60: 2e64 656c 6574 655f 636f 6e74 6169 6e65  .delete_containe
-0000ee70: 7228 656e 7469 7469 6573 5b27 636f 6c6c  r(entities['coll
-0000ee80: 275d 290a 0a20 2020 2064 6566 2074 6573  '])..    def tes
-0000ee90: 745f 7472 6967 6765 725f 6372 7564 2873  t_trigger_crud(s
-0000eea0: 656c 6629 3a0a 2020 2020 2020 2020 2320  elf):.        # 
-0000eeb0: 6372 6561 7465 2064 6174 6162 6173 650a  create database.
-0000eec0: 2020 2020 2020 2020 6462 203d 2073 656c          db = sel
-0000eed0: 662e 6461 7461 6261 7365 466f 7254 6573  f.databaseForTes
-0000eee0: 740a 2020 2020 2020 2020 2320 6372 6561  t.        # crea
-0000eef0: 7465 2063 6f6c 6c65 6374 696f 6e0a 2020  te collection.  
-0000ef00: 2020 2020 2020 636f 6c6c 6563 7469 6f6e        collection
-0000ef10: 203d 2073 656c 662e 636f 6e66 6967 732e   = self.configs.
-0000ef20: 6372 6561 7465 5f6d 756c 7469 5f70 6172  create_multi_par
-0000ef30: 7469 7469 6f6e 5f63 6f6c 6c65 6374 696f  tition_collectio
-0000ef40: 6e5f 6966 5f6e 6f74 5f65 7869 7374 2873  n_if_not_exist(s
-0000ef50: 656c 662e 636c 6965 6e74 290a 2020 2020  elf.client).    
-0000ef60: 2020 2020 2320 7265 6164 2074 7269 6767      # read trigg
-0000ef70: 6572 730a 2020 2020 2020 2020 7472 6967  ers.        trig
-0000ef80: 6765 7273 203d 206c 6973 7428 636f 6c6c  gers = list(coll
-0000ef90: 6563 7469 6f6e 2e73 6372 6970 7473 2e6c  ection.scripts.l
-0000efa0: 6973 745f 7472 6967 6765 7273 2829 290a  ist_triggers()).
-0000efb0: 2020 2020 2020 2020 2320 6372 6561 7465          # create
-0000efc0: 2061 2074 7269 6767 6572 0a20 2020 2020   a trigger.     
-0000efd0: 2020 2062 6566 6f72 655f 6372 6561 7465     before_create
-0000efe0: 5f74 7269 6767 6572 735f 636f 756e 7420  _triggers_count 
-0000eff0: 3d20 6c65 6e28 7472 6967 6765 7273 290a  = len(triggers).
-0000f000: 2020 2020 2020 2020 7472 6967 6765 725f          trigger_
-0000f010: 6465 6669 6e69 7469 6f6e 203d 207b 0a20  definition = {. 
-0000f020: 2020 2020 2020 2020 2020 2027 6964 273a             'id':
-0000f030: 2027 7361 6d70 6c65 2074 7269 6767 6572   'sample trigger
-0000f040: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-0000f050: 7365 7276 6572 5363 7269 7074 273a 2027  serverScript': '
-0000f060: 6675 6e63 7469 6f6e 2829 207b 7661 7220  function() {var 
-0000f070: 7820 3d20 3130 3b7d 272c 0a20 2020 2020  x = 10;}',.     
-0000f080: 2020 2020 2020 2027 7472 6967 6765 7254         'triggerT
-0000f090: 7970 6527 3a20 646f 6375 6d65 6e74 732e  ype': documents.
-0000f0a0: 5472 6967 6765 7254 7970 652e 5072 652c  TriggerType.Pre,
-0000f0b0: 0a20 2020 2020 2020 2020 2020 2027 7472  .            'tr
-0000f0c0: 6967 6765 724f 7065 7261 7469 6f6e 273a  iggerOperation':
-0000f0d0: 2064 6f63 756d 656e 7473 2e54 7269 6767   documents.Trigg
-0000f0e0: 6572 4f70 6572 6174 696f 6e2e 416c 6c0a  erOperation.All.
-0000f0f0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0000f100: 2020 7472 6967 6765 7220 3d20 636f 6c6c    trigger = coll
-0000f110: 6563 7469 6f6e 2e73 6372 6970 7473 2e63  ection.scripts.c
-0000f120: 7265 6174 655f 7472 6967 6765 7228 626f  reate_trigger(bo
-0000f130: 6479 3d74 7269 6767 6572 5f64 6566 696e  dy=trigger_defin
-0000f140: 6974 696f 6e29 0a20 2020 2020 2020 2066  ition).        f
-0000f150: 6f72 2070 726f 7065 7274 7920 696e 2074  or property in t
-0000f160: 7269 6767 6572 5f64 6566 696e 6974 696f  rigger_definitio
-0000f170: 6e3a 0a20 2020 2020 2020 2020 2020 2069  n:.            i
-0000f180: 6620 7072 6f70 6572 7479 2021 3d20 2273  f property != "s
-0000f190: 6572 7665 7253 6372 6970 7422 3a0a 2020  erverScript":.  
-0000f1a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000f1b0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-0000f1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1d0: 2020 2020 7472 6967 6765 725b 7072 6f70      trigger[prop
-0000f1e0: 6572 7479 5d2c 0a20 2020 2020 2020 2020  erty],.         
-0000f1f0: 2020 2020 2020 2020 2020 2074 7269 6767             trigg
-0000f200: 6572 5f64 6566 696e 6974 696f 6e5b 7072  er_definition[pr
-0000f210: 6f70 6572 7479 5d2c 0a20 2020 2020 2020  operty],.       
-0000f220: 2020 2020 2020 2020 2020 2020 2027 7072               'pr
-0000f230: 6f70 6572 7479 207b 7072 6f70 6572 7479  operty {property
-0000f240: 7d20 7368 6f75 6c64 206d 6174 6368 272e  } should match'.
-0000f250: 666f 726d 6174 2870 726f 7065 7274 793d  format(property=
-0000f260: 7072 6f70 6572 7479 2929 0a20 2020 2020  property)).     
-0000f270: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000f280: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000f290: 662e 6173 7365 7274 4571 7561 6c28 7472  f.assertEqual(tr
-0000f2a0: 6967 6765 725b 2762 6f64 7927 5d2c 0a20  igger['body'],. 
-0000f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2d0: 2766 756e 6374 696f 6e28 2920 7b76 6172  'function() {var
-0000f2e0: 2078 203d 2031 303b 7d27 290a 0a20 2020   x = 10;}')..   
-0000f2f0: 2020 2020 2023 2072 6561 6420 7472 6967       # read trig
-0000f300: 6765 7273 2061 6674 6572 2063 7265 6174  gers after creat
-0000f310: 696f 6e0a 2020 2020 2020 2020 7472 6967  ion.        trig
-0000f320: 6765 7273 203d 206c 6973 7428 636f 6c6c  gers = list(coll
-0000f330: 6563 7469 6f6e 2e73 6372 6970 7473 2e6c  ection.scripts.l
-0000f340: 6973 745f 7472 6967 6765 7273 2829 290a  ist_triggers()).
-0000f350: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000f360: 6572 7445 7175 616c 286c 656e 2874 7269  ertEqual(len(tri
-0000f370: 6767 6572 7329 2c0a 2020 2020 2020 2020  ggers),.        
-0000f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f390: 2062 6566 6f72 655f 6372 6561 7465 5f74   before_create_t
-0000f3a0: 7269 6767 6572 735f 636f 756e 7420 2b20  riggers_count + 
-0000f3b0: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
-0000f3c0: 2020 2020 2020 2020 2020 2020 2763 7265              'cre
-0000f3d0: 6174 6520 7368 6f75 6c64 2069 6e63 7265  ate should incre
-0000f3e0: 6173 6520 7468 6520 6e75 6d62 6572 206f  ase the number o
-0000f3f0: 6620 7472 6967 6765 7273 2729 0a20 2020  f triggers').   
-0000f400: 2020 2020 2023 2071 7565 7279 2074 7269       # query tri
-0000f410: 6767 6572 730a 2020 2020 2020 2020 7472  ggers.        tr
-0000f420: 6967 6765 7273 203d 206c 6973 7428 636f  iggers = list(co
-0000f430: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
-0000f440: 2e71 7565 7279 5f74 7269 6767 6572 7328  .query_triggers(
-0000f450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f460: 2071 7565 7279 3d27 5345 4c45 4354 202a   query='SELECT *
-0000f470: 2046 524f 4d20 726f 6f74 2072 2057 4845   FROM root r WHE
-0000f480: 5245 2072 2e69 643d 4069 6427 2c0a 2020  RE r.id=@id',.  
-0000f490: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0000f4a0: 7261 6d65 7465 7273 3d5b 0a20 2020 2020  rameters=[.     
-0000f4b0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-0000f4c0: 276e 616d 6527 3a20 2740 6964 272c 2027  'name': '@id', '
-0000f4d0: 7661 6c75 6527 3a20 7472 6967 6765 725f  value': trigger_
-0000f4e0: 6465 6669 6e69 7469 6f6e 5b27 6964 275d  definition['id']
-0000f4f0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0000f500: 2020 5d0a 2020 2020 2020 2020 2929 0a20    ].        )). 
-0000f510: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000f520: 7274 5472 7565 2874 7269 6767 6572 7329  rtTrue(triggers)
-0000f530: 0a0a 2020 2020 2020 2020 2320 7265 706c  ..        # repl
-0000f540: 6163 6520 7472 6967 6765 720a 2020 2020  ace trigger.    
-0000f550: 2020 2020 6368 616e 6765 5f74 7269 6767      change_trigg
-0000f560: 6572 203d 2074 7269 6767 6572 2e63 6f70  er = trigger.cop
-0000f570: 7928 290a 2020 2020 2020 2020 7472 6967  y().        trig
-0000f580: 6765 725b 2762 6f64 7927 5d20 3d20 2766  ger['body'] = 'f
-0000f590: 756e 6374 696f 6e28 2920 7b76 6172 2078  unction() {var x
-0000f5a0: 203d 2032 303b 7d27 0a20 2020 2020 2020   = 20;}'.       
-0000f5b0: 2072 6570 6c61 6365 645f 7472 6967 6765   replaced_trigge
-0000f5c0: 7220 3d20 636f 6c6c 6563 7469 6f6e 2e73  r = collection.s
-0000f5d0: 6372 6970 7473 2e72 6570 6c61 6365 5f74  cripts.replace_t
-0000f5e0: 7269 6767 6572 2863 6861 6e67 655f 7472  rigger(change_tr
-0000f5f0: 6967 6765 725b 2769 6427 5d2c 2074 7269  igger['id'], tri
-0000f600: 6767 6572 290a 2020 2020 2020 2020 666f  gger).        fo
-0000f610: 7220 7072 6f70 6572 7479 2069 6e20 7472  r property in tr
-0000f620: 6967 6765 725f 6465 6669 6e69 7469 6f6e  igger_definition
-0000f630: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000f640: 2070 726f 7065 7274 7920 213d 2022 7365   property != "se
-0000f650: 7276 6572 5363 7269 7074 223a 0a20 2020  rverScript":.   
-0000f660: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000f670: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-0000f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f690: 2020 2072 6570 6c61 6365 645f 7472 6967     replaced_trig
-0000f6a0: 6765 725b 7072 6f70 6572 7479 5d2c 0a20  ger[property],. 
-0000f6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f6c0: 2020 2074 7269 6767 6572 5b70 726f 7065     trigger[prope
-0000f6d0: 7274 795d 2c0a 2020 2020 2020 2020 2020  rty],.          
-0000f6e0: 2020 2020 2020 2020 2020 2770 726f 7065            'prope
-0000f6f0: 7274 7920 7b70 726f 7065 7274 797d 2073  rty {property} s
-0000f700: 686f 756c 6420 6d61 7463 6827 2e66 6f72  hould match'.for
-0000f710: 6d61 7428 7072 6f70 6572 7479 3d70 726f  mat(property=pro
-0000f720: 7065 7274 7929 290a 2020 2020 2020 2020  perty)).        
-0000f730: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000f740: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000f750: 7373 6572 7445 7175 616c 2872 6570 6c61  ssertEqual(repla
-0000f760: 6365 645f 7472 6967 6765 725b 2762 6f64  ced_trigger['bod
-0000f770: 7927 5d2c 0a20 2020 2020 2020 2020 2020  y'],.           
-0000f780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f790: 2020 2020 2020 2766 756e 6374 696f 6e28        'function(
-0000f7a0: 2920 7b76 6172 2078 203d 2032 303b 7d27  ) {var x = 20;}'
-0000f7b0: 290a 0a20 2020 2020 2020 2023 2072 6561  )..        # rea
-0000f7c0: 6420 7472 6967 6765 720a 2020 2020 2020  d trigger.      
-0000f7d0: 2020 7472 6967 6765 7220 3d20 636f 6c6c    trigger = coll
-0000f7e0: 6563 7469 6f6e 2e73 6372 6970 7473 2e67  ection.scripts.g
-0000f7f0: 6574 5f74 7269 6767 6572 2872 6570 6c61  et_trigger(repla
-0000f800: 6365 645f 7472 6967 6765 725b 2769 6427  ced_trigger['id'
-0000f810: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-0000f820: 6173 7365 7274 4571 7561 6c28 7265 706c  assertEqual(repl
-0000f830: 6163 6564 5f74 7269 6767 6572 5b27 6964  aced_trigger['id
-0000f840: 275d 2c20 7472 6967 6765 725b 2769 6427  '], trigger['id'
-0000f850: 5d29 0a20 2020 2020 2020 2023 2064 656c  ]).        # del
-0000f860: 6574 6520 7472 6967 6765 720a 2020 2020  ete trigger.    
-0000f870: 2020 2020 636f 6c6c 6563 7469 6f6e 2e73      collection.s
-0000f880: 6372 6970 7473 2e64 656c 6574 655f 7472  cripts.delete_tr
-0000f890: 6967 6765 7228 7265 706c 6163 6564 5f74  igger(replaced_t
-0000f8a0: 7269 6767 6572 5b27 6964 275d 290a 2020  rigger['id']).  
-0000f8b0: 2020 2020 2020 2320 7265 6164 2074 7269        # read tri
-0000f8c0: 6767 6572 7320 6166 7465 7220 6465 6c65  ggers after dele
-0000f8d0: 7469 6f6e 0a20 2020 2020 2020 2073 656c  tion.        sel
-0000f8e0: 662e 5f5f 4173 7365 7274 4854 5450 4661  f.__AssertHTTPFa
-0000f8f0: 696c 7572 6557 6974 6853 7461 7475 7328  ilureWithStatus(
-0000f900: 5374 6174 7573 436f 6465 732e 4e4f 545f  StatusCodes.NOT_
-0000f910: 464f 554e 442c 0a20 2020 2020 2020 2020  FOUND,.         
-0000f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eae0: 2020 2020 2020 2020 2020 2073 7563 6365             succe
+0000eaf0: 7373 5f63 6f6c 6c2e 6465 6c65 7465 5f69  ss_coll.delete_i
+0000eb00: 7465 6d2c 0a20 2020 2020 2020 2020 2020  tem,.           
+0000eb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb30: 646f 6349 642c 2064 6f63 4964 290a 0a20  docId, docId).. 
+0000eb40: 2020 2020 2020 2072 6573 6f75 7263 655f         resource_
+0000eb50: 746f 6b65 6e73 203d 207b 2264 6273 2f22  tokens = {"dbs/"
+0000eb60: 202b 2065 6e74 6974 6965 735b 2764 6227   + entities['db'
+0000eb70: 5d2e 6964 202b 2022 2f63 6f6c 6c73 2f22  ].id + "/colls/"
+0000eb80: 202b 2065 6e74 6974 6965 735b 2763 6f6c   + entities['col
+0000eb90: 6c27 5d2e 6964 202b 2022 2f64 6f63 732f  l'].id + "/docs/
+0000eba0: 2220 2b20 646f 6349 6420 3a0a 2020 2020  " + docId :.    
+0000ebb0: 2020 2020 2020 2020 656e 7469 7469 6573          entities
+0000ebc0: 5b27 7065 726d 6973 7369 6f6e 4f6e 446f  ['permissionOnDo
+0000ebd0: 6327 5d2e 7072 6f70 6572 7469 6573 5b27  c'].properties['
+0000ebe0: 5f74 6f6b 656e 275d 7d0a 0a20 2020 2020  _token']}..     
+0000ebf0: 2020 2064 6f63 5f63 6c69 656e 7420 3d20     doc_client = 
+0000ec00: 636f 736d 6f73 5f63 6c69 656e 742e 436f  cosmos_client.Co
+0000ec10: 736d 6f73 436c 6965 6e74 280a 2020 2020  smosClient(.    
+0000ec20: 2020 2020 2020 2020 4352 5544 5465 7374          CRUDTest
+0000ec30: 732e 686f 7374 2c20 7265 736f 7572 6365  s.host, resource
+0000ec40: 5f74 6f6b 656e 732c 2253 6573 7369 6f6e  _tokens,"Session
+0000ec50: 222c 2063 6f6e 6e65 6374 696f 6e5f 706f  ", connection_po
+0000ec60: 6c69 6379 3d43 5255 4454 6573 7473 2e63  licy=CRUDTests.c
+0000ec70: 6f6e 6e65 6374 696f 6e50 6f6c 6963 7929  onnectionPolicy)
+0000ec80: 0a0a 2020 2020 2020 2020 2336 2e20 5375  ..        #6. Su
+0000ec90: 6363 6573 732d 2d20 5573 6520 446f 6320  ccess-- Use Doc 
+0000eca0: 7065 726d 6973 7369 6f6e 2074 6f20 7265  permission to re
+0000ecb0: 6164 2064 6f63 0a20 2020 2020 2020 2072  ad doc.        r
+0000ecc0: 6561 645f 646f 6320 3d20 646f 635f 636c  ead_doc = doc_cl
+0000ecd0: 6965 6e74 2e67 6574 5f64 6174 6162 6173  ient.get_databas
+0000ece0: 655f 636c 6965 6e74 2864 622e 6964 292e  e_client(db.id).
+0000ecf0: 6765 745f 636f 6e74 6169 6e65 725f 636c  get_container_cl
+0000ed00: 6965 6e74 2873 7563 6365 7373 5f63 6f6c  ient(success_col
+0000ed10: 6c2e 6964 292e 7265 6164 5f69 7465 6d28  l.id).read_item(
+0000ed20: 646f 6349 642c 2064 6f63 4964 290a 2020  docId, docId).  
+0000ed30: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000ed40: 7445 7175 616c 2872 6561 645f 646f 635b  tEqual(read_doc[
+0000ed50: 2269 6422 5d2c 2064 6f63 4964 290a 0a20  "id"], docId).. 
+0000ed60: 2020 2020 2020 2023 362e 2053 7563 6365         #6. Succe
+0000ed70: 7373 2d2d 2055 7365 2044 6f63 2070 6572  ss-- Use Doc per
+0000ed80: 6d69 7373 696f 6e20 746f 2064 656c 6574  mission to delet
+0000ed90: 6520 646f 630a 2020 2020 2020 2020 646f  e doc.        do
+0000eda0: 635f 636c 6965 6e74 2e67 6574 5f64 6174  c_client.get_dat
+0000edb0: 6162 6173 655f 636c 6965 6e74 2864 622e  abase_client(db.
+0000edc0: 6964 292e 6765 745f 636f 6e74 6169 6e65  id).get_containe
+0000edd0: 725f 636c 6965 6e74 2873 7563 6365 7373  r_client(success
+0000ede0: 5f63 6f6c 6c2e 6964 292e 6465 6c65 7465  _coll.id).delete
+0000edf0: 5f69 7465 6d28 646f 6349 642c 2064 6f63  _item(docId, doc
+0000ee00: 4964 290a 2020 2020 2020 2020 7365 6c66  Id).        self
+0000ee10: 2e61 7373 6572 7445 7175 616c 2872 6561  .assertEqual(rea
+0000ee20: 645f 646f 635b 2269 6422 5d2c 2064 6f63  d_doc["id"], doc
+0000ee30: 4964 290a 0a20 2020 2020 2020 2064 622e  Id)..        db.
+0000ee40: 636c 6965 6e74 5f63 6f6e 6e65 6374 696f  client_connectio
+0000ee50: 6e20 3d20 6f6c 645f 636c 6965 6e74 5f63  n = old_client_c
+0000ee60: 6f6e 6e65 6374 696f 6e0a 2020 2020 2020  onnection.      
+0000ee70: 2020 6462 2e64 656c 6574 655f 636f 6e74    db.delete_cont
+0000ee80: 6169 6e65 7228 656e 7469 7469 6573 5b27  ainer(entities['
+0000ee90: 636f 6c6c 275d 290a 0a20 2020 2064 6566  coll'])..    def
+0000eea0: 2074 6573 745f 7472 6967 6765 725f 6372   test_trigger_cr
+0000eeb0: 7564 2873 656c 6629 3a0a 2020 2020 2020  ud(self):.      
+0000eec0: 2020 2320 6372 6561 7465 2064 6174 6162    # create datab
+0000eed0: 6173 650a 2020 2020 2020 2020 6462 203d  ase.        db =
+0000eee0: 2073 656c 662e 6461 7461 6261 7365 466f   self.databaseFo
+0000eef0: 7254 6573 740a 2020 2020 2020 2020 2320  rTest.        # 
+0000ef00: 6372 6561 7465 2063 6f6c 6c65 6374 696f  create collectio
+0000ef10: 6e0a 2020 2020 2020 2020 636f 6c6c 6563  n.        collec
+0000ef20: 7469 6f6e 203d 2073 656c 662e 636f 6e66  tion = self.conf
+0000ef30: 6967 732e 6372 6561 7465 5f6d 756c 7469  igs.create_multi
+0000ef40: 5f70 6172 7469 7469 6f6e 5f63 6f6c 6c65  _partition_colle
+0000ef50: 6374 696f 6e5f 6966 5f6e 6f74 5f65 7869  ction_if_not_exi
+0000ef60: 7374 2873 656c 662e 636c 6965 6e74 290a  st(self.client).
+0000ef70: 2020 2020 2020 2020 2320 7265 6164 2074          # read t
+0000ef80: 7269 6767 6572 730a 2020 2020 2020 2020  riggers.        
+0000ef90: 7472 6967 6765 7273 203d 206c 6973 7428  triggers = list(
+0000efa0: 636f 6c6c 6563 7469 6f6e 2e73 6372 6970  collection.scrip
+0000efb0: 7473 2e6c 6973 745f 7472 6967 6765 7273  ts.list_triggers
+0000efc0: 2829 290a 2020 2020 2020 2020 2320 6372  ()).        # cr
+0000efd0: 6561 7465 2061 2074 7269 6767 6572 0a20  eate a trigger. 
+0000efe0: 2020 2020 2020 2062 6566 6f72 655f 6372         before_cr
+0000eff0: 6561 7465 5f74 7269 6767 6572 735f 636f  eate_triggers_co
+0000f000: 756e 7420 3d20 6c65 6e28 7472 6967 6765  unt = len(trigge
+0000f010: 7273 290a 2020 2020 2020 2020 7472 6967  rs).        trig
+0000f020: 6765 725f 6465 6669 6e69 7469 6f6e 203d  ger_definition =
+0000f030: 207b 0a20 2020 2020 2020 2020 2020 2027   {.            '
+0000f040: 6964 273a 2027 7361 6d70 6c65 2074 7269  id': 'sample tri
+0000f050: 6767 6572 272c 0a20 2020 2020 2020 2020  gger',.         
+0000f060: 2020 2027 7365 7276 6572 5363 7269 7074     'serverScript
+0000f070: 273a 2027 6675 6e63 7469 6f6e 2829 207b  ': 'function() {
+0000f080: 7661 7220 7820 3d20 3130 3b7d 272c 0a20  var x = 10;}',. 
+0000f090: 2020 2020 2020 2020 2020 2027 7472 6967             'trig
+0000f0a0: 6765 7254 7970 6527 3a20 646f 6375 6d65  gerType': docume
+0000f0b0: 6e74 732e 5472 6967 6765 7254 7970 652e  nts.TriggerType.
+0000f0c0: 5072 652c 0a20 2020 2020 2020 2020 2020  Pre,.           
+0000f0d0: 2027 7472 6967 6765 724f 7065 7261 7469   'triggerOperati
+0000f0e0: 6f6e 273a 2064 6f63 756d 656e 7473 2e54  on': documents.T
+0000f0f0: 7269 6767 6572 4f70 6572 6174 696f 6e2e  riggerOperation.
+0000f100: 416c 6c0a 2020 2020 2020 2020 7d0a 2020  All.        }.  
+0000f110: 2020 2020 2020 7472 6967 6765 7220 3d20        trigger = 
+0000f120: 636f 6c6c 6563 7469 6f6e 2e73 6372 6970  collection.scrip
+0000f130: 7473 2e63 7265 6174 655f 7472 6967 6765  ts.create_trigge
+0000f140: 7228 626f 6479 3d74 7269 6767 6572 5f64  r(body=trigger_d
+0000f150: 6566 696e 6974 696f 6e29 0a20 2020 2020  efinition).     
+0000f160: 2020 2066 6f72 2070 726f 7065 7274 7920     for property 
+0000f170: 696e 2074 7269 6767 6572 5f64 6566 696e  in trigger_defin
+0000f180: 6974 696f 6e3a 0a20 2020 2020 2020 2020  ition:.         
+0000f190: 2020 2069 6620 7072 6f70 6572 7479 2021     if property !
+0000f1a0: 3d20 2273 6572 7665 7253 6372 6970 7422  = "serverScript"
+0000f1b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f1c0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000f1d0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+0000f1e0: 2020 2020 2020 2020 7472 6967 6765 725b          trigger[
+0000f1f0: 7072 6f70 6572 7479 5d2c 0a20 2020 2020  property],.     
+0000f200: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000f210: 7269 6767 6572 5f64 6566 696e 6974 696f  rigger_definitio
+0000f220: 6e5b 7072 6f70 6572 7479 5d2c 0a20 2020  n[property],.   
+0000f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f240: 2027 7072 6f70 6572 7479 207b 7072 6f70   'property {prop
+0000f250: 6572 7479 7d20 7368 6f75 6c64 206d 6174  erty} should mat
+0000f260: 6368 272e 666f 726d 6174 2870 726f 7065  ch'.format(prope
+0000f270: 7274 793d 7072 6f70 6572 7479 2929 0a20  rty=property)). 
+0000f280: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000f290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f2a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000f2b0: 6c28 7472 6967 6765 725b 2762 6f64 7927  l(trigger['body'
+0000f2c0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0000f2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2e0: 2020 2020 2766 756e 6374 696f 6e28 2920      'function() 
+0000f2f0: 7b76 6172 2078 203d 2031 303b 7d27 290a  {var x = 10;}').
+0000f300: 0a20 2020 2020 2020 2023 2072 6561 6420  .        # read 
+0000f310: 7472 6967 6765 7273 2061 6674 6572 2063  triggers after c
+0000f320: 7265 6174 696f 6e0a 2020 2020 2020 2020  reation.        
+0000f330: 7472 6967 6765 7273 203d 206c 6973 7428  triggers = list(
+0000f340: 636f 6c6c 6563 7469 6f6e 2e73 6372 6970  collection.scrip
+0000f350: 7473 2e6c 6973 745f 7472 6967 6765 7273  ts.list_triggers
+0000f360: 2829 290a 2020 2020 2020 2020 7365 6c66  ()).        self
+0000f370: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+0000f380: 2874 7269 6767 6572 7329 2c0a 2020 2020  (triggers),.    
+0000f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3a0: 2020 2020 2062 6566 6f72 655f 6372 6561       before_crea
+0000f3b0: 7465 5f74 7269 6767 6572 735f 636f 756e  te_triggers_coun
+0000f3c0: 7420 2b20 312c 0a20 2020 2020 2020 2020  t + 1,.         
+0000f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3e0: 2763 7265 6174 6520 7368 6f75 6c64 2069  'create should i
+0000f3f0: 6e63 7265 6173 6520 7468 6520 6e75 6d62  ncrease the numb
+0000f400: 6572 206f 6620 7472 6967 6765 7273 2729  er of triggers')
+0000f410: 0a20 2020 2020 2020 2023 2071 7565 7279  .        # query
+0000f420: 2074 7269 6767 6572 730a 2020 2020 2020   triggers.      
+0000f430: 2020 7472 6967 6765 7273 203d 206c 6973    triggers = lis
+0000f440: 7428 636f 6c6c 6563 7469 6f6e 2e73 6372  t(collection.scr
+0000f450: 6970 7473 2e71 7565 7279 5f74 7269 6767  ipts.query_trigg
+0000f460: 6572 7328 0a20 2020 2020 2020 2020 2020  ers(.           
+0000f470: 2020 2020 2071 7565 7279 3d27 5345 4c45       query='SELE
+0000f480: 4354 202a 2046 524f 4d20 726f 6f74 2072  CT * FROM root r
+0000f490: 2057 4845 5245 2072 2e69 643d 4069 6427   WHERE r.id=@id'
+0000f4a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f4b0: 2020 7061 7261 6d65 7465 7273 3d5b 0a20    parameters=[. 
+0000f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4d0: 2020 207b 276e 616d 6527 3a20 2740 6964     {'name': '@id
+0000f4e0: 272c 2027 7661 6c75 6527 3a20 7472 6967  ', 'value': trig
+0000f4f0: 6765 725f 6465 6669 6e69 7469 6f6e 5b27  ger_definition['
+0000f500: 6964 275d 7d0a 2020 2020 2020 2020 2020  id']}.          
+0000f510: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+0000f520: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+0000f530: 6173 7365 7274 5472 7565 2874 7269 6767  assertTrue(trigg
+0000f540: 6572 7329 0a0a 2020 2020 2020 2020 2320  ers)..        # 
+0000f550: 7265 706c 6163 6520 7472 6967 6765 720a  replace trigger.
+0000f560: 2020 2020 2020 2020 6368 616e 6765 5f74          change_t
+0000f570: 7269 6767 6572 203d 2074 7269 6767 6572  rigger = trigger
+0000f580: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+0000f590: 7472 6967 6765 725b 2762 6f64 7927 5d20  trigger['body'] 
+0000f5a0: 3d20 2766 756e 6374 696f 6e28 2920 7b76  = 'function() {v
+0000f5b0: 6172 2078 203d 2032 303b 7d27 0a20 2020  ar x = 20;}'.   
+0000f5c0: 2020 2020 2072 6570 6c61 6365 645f 7472       replaced_tr
+0000f5d0: 6967 6765 7220 3d20 636f 6c6c 6563 7469  igger = collecti
+0000f5e0: 6f6e 2e73 6372 6970 7473 2e72 6570 6c61  on.scripts.repla
+0000f5f0: 6365 5f74 7269 6767 6572 2863 6861 6e67  ce_trigger(chang
+0000f600: 655f 7472 6967 6765 725b 2769 6427 5d2c  e_trigger['id'],
+0000f610: 2074 7269 6767 6572 290a 2020 2020 2020   trigger).      
+0000f620: 2020 666f 7220 7072 6f70 6572 7479 2069    for property i
+0000f630: 6e20 7472 6967 6765 725f 6465 6669 6e69  n trigger_defini
+0000f640: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+0000f650: 2020 6966 2070 726f 7065 7274 7920 213d    if property !=
+0000f660: 2022 7365 7276 6572 5363 7269 7074 223a   "serverScript":
+0000f670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f680: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000f690: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+0000f6a0: 2020 2020 2020 2072 6570 6c61 6365 645f         replaced_
+0000f6b0: 7472 6967 6765 725b 7072 6f70 6572 7479  trigger[property
+0000f6c0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0000f6d0: 2020 2020 2020 2074 7269 6767 6572 5b70         trigger[p
+0000f6e0: 726f 7065 7274 795d 2c0a 2020 2020 2020  roperty],.      
+0000f6f0: 2020 2020 2020 2020 2020 2020 2020 2770                'p
+0000f700: 726f 7065 7274 7920 7b70 726f 7065 7274  roperty {propert
+0000f710: 797d 2073 686f 756c 6420 6d61 7463 6827  y} should match'
+0000f720: 2e66 6f72 6d61 7428 7072 6f70 6572 7479  .format(property
+0000f730: 3d70 726f 7065 7274 7929 290a 2020 2020  =property)).    
+0000f740: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000f750: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000f760: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+0000f770: 6570 6c61 6365 645f 7472 6967 6765 725b  eplaced_trigger[
+0000f780: 2762 6f64 7927 5d2c 0a20 2020 2020 2020  'body'],.       
+0000f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f7a0: 2020 2020 2020 2020 2020 2766 756e 6374            'funct
+0000f7b0: 696f 6e28 2920 7b76 6172 2078 203d 2032  ion() {var x = 2
+0000f7c0: 303b 7d27 290a 0a20 2020 2020 2020 2023  0;}')..        #
+0000f7d0: 2072 6561 6420 7472 6967 6765 720a 2020   read trigger.  
+0000f7e0: 2020 2020 2020 7472 6967 6765 7220 3d20        trigger = 
+0000f7f0: 636f 6c6c 6563 7469 6f6e 2e73 6372 6970  collection.scrip
+0000f800: 7473 2e67 6574 5f74 7269 6767 6572 2872  ts.get_trigger(r
+0000f810: 6570 6c61 6365 645f 7472 6967 6765 725b  eplaced_trigger[
+0000f820: 2769 6427 5d29 0a20 2020 2020 2020 2073  'id']).        s
+0000f830: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000f840: 7265 706c 6163 6564 5f74 7269 6767 6572  replaced_trigger
+0000f850: 5b27 6964 275d 2c20 7472 6967 6765 725b  ['id'], trigger[
+0000f860: 2769 6427 5d29 0a20 2020 2020 2020 2023  'id']).        #
+0000f870: 2064 656c 6574 6520 7472 6967 6765 720a   delete trigger.
+0000f880: 2020 2020 2020 2020 636f 6c6c 6563 7469          collecti
+0000f890: 6f6e 2e73 6372 6970 7473 2e64 656c 6574  on.scripts.delet
+0000f8a0: 655f 7472 6967 6765 7228 7265 706c 6163  e_trigger(replac
+0000f8b0: 6564 5f74 7269 6767 6572 5b27 6964 275d  ed_trigger['id']
+0000f8c0: 290a 2020 2020 2020 2020 2320 7265 6164  ).        # read
+0000f8d0: 2074 7269 6767 6572 7320 6166 7465 7220   triggers after 
+0000f8e0: 6465 6c65 7469 6f6e 0a20 2020 2020 2020  deletion.       
+0000f8f0: 2073 656c 662e 5f5f 4173 7365 7274 4854   self.__AssertHT
+0000f900: 5450 4661 696c 7572 6557 6974 6853 7461  TPFailureWithSta
+0000f910: 7475 7328 5374 6174 7573 436f 6465 732e  tus(StatusCodes.
+0000f920: 4e4f 545f 464f 554e 442c 0a20 2020 2020  NOT_FOUND,.     
 0000f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f940: 2020 636f 6c6c 6563 7469 6f6e 2e73 6372    collection.scr
-0000f950: 6970 7473 2e64 656c 6574 655f 7472 6967  ipts.delete_trig
-0000f960: 6765 722c 0a20 2020 2020 2020 2020 2020  ger,.           
-0000f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f950: 2020 2020 2020 636f 6c6c 6563 7469 6f6e        collection
+0000f960: 2e73 6372 6970 7473 2e64 656c 6574 655f  .scripts.delete_
+0000f970: 7472 6967 6765 722c 0a20 2020 2020 2020  trigger,.       
 0000f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f990: 7265 706c 6163 6564 5f74 7269 6767 6572  replaced_trigger
-0000f9a0: 5b27 6964 275d 290a 0a20 2020 2064 6566  ['id'])..    def
-0000f9b0: 2074 6573 745f 7564 665f 6372 7564 2873   test_udf_crud(s
-0000f9c0: 656c 6629 3a0a 2020 2020 2020 2020 2320  elf):.        # 
-0000f9d0: 6372 6561 7465 2064 6174 6162 6173 650a  create database.
-0000f9e0: 2020 2020 2020 2020 6462 203d 2073 656c          db = sel
-0000f9f0: 662e 6461 7461 6261 7365 466f 7254 6573  f.databaseForTes
-0000fa00: 740a 2020 2020 2020 2020 2320 6372 6561  t.        # crea
-0000fa10: 7465 2063 6f6c 6c65 6374 696f 6e0a 2020  te collection.  
-0000fa20: 2020 2020 2020 636f 6c6c 6563 7469 6f6e        collection
-0000fa30: 203d 2073 656c 662e 636f 6e66 6967 732e   = self.configs.
-0000fa40: 6372 6561 7465 5f6d 756c 7469 5f70 6172  create_multi_par
-0000fa50: 7469 7469 6f6e 5f63 6f6c 6c65 6374 696f  tition_collectio
-0000fa60: 6e5f 6966 5f6e 6f74 5f65 7869 7374 2873  n_if_not_exist(s
-0000fa70: 656c 662e 636c 6965 6e74 290a 2020 2020  elf.client).    
-0000fa80: 2020 2020 2320 7265 6164 2075 6466 730a      # read udfs.
-0000fa90: 2020 2020 2020 2020 7564 6673 203d 206c          udfs = l
-0000faa0: 6973 7428 636f 6c6c 6563 7469 6f6e 2e73  ist(collection.s
-0000fab0: 6372 6970 7473 2e6c 6973 745f 7573 6572  cripts.list_user
-0000fac0: 5f64 6566 696e 6564 5f66 756e 6374 696f  _defined_functio
-0000fad0: 6e73 2829 290a 2020 2020 2020 2020 2320  ns()).        # 
-0000fae0: 6372 6561 7465 2061 2075 6466 0a20 2020  create a udf.   
-0000faf0: 2020 2020 2062 6566 6f72 655f 6372 6561       before_crea
-0000fb00: 7465 5f75 6466 735f 636f 756e 7420 3d20  te_udfs_count = 
-0000fb10: 6c65 6e28 7564 6673 290a 2020 2020 2020  len(udfs).      
-0000fb20: 2020 7564 665f 6465 6669 6e69 7469 6f6e    udf_definition
-0000fb30: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-0000fb40: 2027 6964 273a 2027 7361 6d70 6c65 2075   'id': 'sample u
-0000fb50: 6466 272c 0a20 2020 2020 2020 2020 2020  df',.           
-0000fb60: 2027 626f 6479 273a 2027 6675 6e63 7469   'body': 'functi
-0000fb70: 6f6e 2829 207b 7661 7220 7820 3d20 3130  on() {var x = 10
-0000fb80: 3b7d 270a 2020 2020 2020 2020 7d0a 2020  ;}'.        }.  
-0000fb90: 2020 2020 2020 7564 6620 3d20 636f 6c6c        udf = coll
-0000fba0: 6563 7469 6f6e 2e73 6372 6970 7473 2e63  ection.scripts.c
-0000fbb0: 7265 6174 655f 7573 6572 5f64 6566 696e  reate_user_defin
-0000fbc0: 6564 5f66 756e 6374 696f 6e28 626f 6479  ed_function(body
-0000fbd0: 3d75 6466 5f64 6566 696e 6974 696f 6e29  =udf_definition)
-0000fbe0: 0a20 2020 2020 2020 2066 6f72 2070 726f  .        for pro
-0000fbf0: 7065 7274 7920 696e 2075 6466 5f64 6566  perty in udf_def
-0000fc00: 696e 6974 696f 6e3a 0a20 2020 2020 2020  inition:.       
-0000fc10: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000fc20: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-0000fc30: 2020 2020 2020 2075 6466 5b70 726f 7065         udf[prope
-0000fc40: 7274 795d 2c0a 2020 2020 2020 2020 2020  rty],.          
-0000fc50: 2020 2020 2020 7564 665f 6465 6669 6e69        udf_defini
-0000fc60: 7469 6f6e 5b70 726f 7065 7274 795d 2c0a  tion[property],.
-0000fc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc80: 2770 726f 7065 7274 7920 7b70 726f 7065  'property {prope
-0000fc90: 7274 797d 2073 686f 756c 6420 6d61 7463  rty} should matc
-0000fca0: 6827 2e66 6f72 6d61 7428 7072 6f70 6572  h'.format(proper
-0000fcb0: 7479 3d70 726f 7065 7274 7929 290a 0a20  ty=property)).. 
-0000fcc0: 2020 2020 2020 2023 2072 6561 6420 7564         # read ud
-0000fcd0: 6673 2061 6674 6572 2063 7265 6174 696f  fs after creatio
-0000fce0: 6e0a 2020 2020 2020 2020 7564 6673 203d  n.        udfs =
-0000fcf0: 206c 6973 7428 636f 6c6c 6563 7469 6f6e   list(collection
-0000fd00: 2e73 6372 6970 7473 2e6c 6973 745f 7573  .scripts.list_us
-0000fd10: 6572 5f64 6566 696e 6564 5f66 756e 6374  er_defined_funct
-0000fd20: 696f 6e73 2829 290a 2020 2020 2020 2020  ions()).        
-0000fd30: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000fd40: 286c 656e 2875 6466 7329 2c0a 2020 2020  (len(udfs),.    
-0000fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd60: 2020 2020 2062 6566 6f72 655f 6372 6561       before_crea
-0000fd70: 7465 5f75 6466 735f 636f 756e 7420 2b20  te_udfs_count + 
-0000fd80: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
-0000fd90: 2020 2020 2020 2020 2020 2020 2763 7265              'cre
-0000fda0: 6174 6520 7368 6f75 6c64 2069 6e63 7265  ate should incre
-0000fdb0: 6173 6520 7468 6520 6e75 6d62 6572 206f  ase the number o
-0000fdc0: 6620 7564 6673 2729 0a20 2020 2020 2020  f udfs').       
-0000fdd0: 2023 2071 7565 7279 2075 6466 730a 2020   # query udfs.  
-0000fde0: 2020 2020 2020 7265 7375 6c74 7320 3d20        results = 
-0000fdf0: 6c69 7374 2863 6f6c 6c65 6374 696f 6e2e  list(collection.
-0000fe00: 7363 7269 7074 732e 7175 6572 795f 7573  scripts.query_us
-0000fe10: 6572 5f64 6566 696e 6564 5f66 756e 6374  er_defined_funct
-0000fe20: 696f 6e73 280a 2020 2020 2020 2020 2020  ions(.          
-0000fe30: 2020 2020 2020 7175 6572 793d 2753 454c        query='SEL
-0000fe40: 4543 5420 2a20 4652 4f4d 2072 6f6f 7420  ECT * FROM root 
-0000fe50: 7220 5748 4552 4520 722e 6964 3d40 6964  r WHERE r.id=@id
-0000fe60: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0000fe70: 2020 2070 6172 616d 6574 6572 733d 5b0a     parameters=[.
-0000fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe90: 2020 2020 7b27 6e61 6d65 273a 2027 4069      {'name': '@i
-0000fea0: 6427 2c20 2776 616c 7565 273a 2075 6466  d', 'value': udf
-0000feb0: 5f64 6566 696e 6974 696f 6e5b 2769 6427  _definition['id'
-0000fec0: 5d7d 0a20 2020 2020 2020 2020 2020 2020  ]}.             
-0000fed0: 2020 205d 0a20 2020 2020 2020 2029 290a     ].        )).
-0000fee0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000fef0: 6572 7454 7275 6528 7265 7375 6c74 7329  ertTrue(results)
-0000ff00: 0a20 2020 2020 2020 2023 2072 6570 6c61  .        # repla
-0000ff10: 6365 2075 6466 0a20 2020 2020 2020 2063  ce udf.        c
-0000ff20: 6861 6e67 655f 7564 6620 3d20 7564 662e  hange_udf = udf.
-0000ff30: 636f 7079 2829 0a20 2020 2020 2020 2075  copy().        u
-0000ff40: 6466 5b27 626f 6479 275d 203d 2027 6675  df['body'] = 'fu
-0000ff50: 6e63 7469 6f6e 2829 207b 7661 7220 7820  nction() {var x 
-0000ff60: 3d20 3230 3b7d 270a 2020 2020 2020 2020  = 20;}'.        
-0000ff70: 7265 706c 6163 6564 5f75 6466 203d 2063  replaced_udf = c
-0000ff80: 6f6c 6c65 6374 696f 6e2e 7363 7269 7074  ollection.script
-0000ff90: 732e 7265 706c 6163 655f 7573 6572 5f64  s.replace_user_d
-0000ffa0: 6566 696e 6564 5f66 756e 6374 696f 6e28  efined_function(
-0000ffb0: 7564 663d 7564 665b 2769 6427 5d2c 2062  udf=udf['id'], b
-0000ffc0: 6f64 793d 7564 6629 0a20 2020 2020 2020  ody=udf).       
-0000ffd0: 2066 6f72 2070 726f 7065 7274 7920 696e   for property in
-0000ffe0: 2075 6466 5f64 6566 696e 6974 696f 6e3a   udf_definition:
-0000fff0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00010000: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00010010: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00010020: 6570 6c61 6365 645f 7564 665b 7072 6f70  eplaced_udf[prop
-00010030: 6572 7479 5d2c 0a20 2020 2020 2020 2020  erty],.         
-00010040: 2020 2020 2020 2075 6466 5b70 726f 7065         udf[prope
-00010050: 7274 795d 2c0a 2020 2020 2020 2020 2020  rty],.          
-00010060: 2020 2020 2020 2770 726f 7065 7274 7920        'property 
-00010070: 7b70 726f 7065 7274 797d 2073 686f 756c  {property} shoul
-00010080: 6420 6d61 7463 6827 2e66 6f72 6d61 7428  d match'.format(
-00010090: 7072 6f70 6572 7479 3d70 726f 7065 7274  property=propert
-000100a0: 7929 290a 2020 2020 2020 2020 2320 7265  y)).        # re
-000100b0: 6164 2075 6466 0a20 2020 2020 2020 2075  ad udf.        u
-000100c0: 6466 203d 2063 6f6c 6c65 6374 696f 6e2e  df = collection.
-000100d0: 7363 7269 7074 732e 6765 745f 7573 6572  scripts.get_user
-000100e0: 5f64 6566 696e 6564 5f66 756e 6374 696f  _defined_functio
-000100f0: 6e28 7265 706c 6163 6564 5f75 6466 5b27  n(replaced_udf['
-00010100: 6964 275d 290a 2020 2020 2020 2020 7365  id']).        se
-00010110: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00010120: 6570 6c61 6365 645f 7564 665b 2769 6427  eplaced_udf['id'
-00010130: 5d2c 2075 6466 5b27 6964 275d 290a 2020  ], udf['id']).  
-00010140: 2020 2020 2020 2320 6465 6c65 7465 2075        # delete u
-00010150: 6466 0a20 2020 2020 2020 2063 6f6c 6c65  df.        colle
-00010160: 6374 696f 6e2e 7363 7269 7074 732e 6465  ction.scripts.de
-00010170: 6c65 7465 5f75 7365 725f 6465 6669 6e65  lete_user_define
-00010180: 645f 6675 6e63 7469 6f6e 2872 6570 6c61  d_function(repla
-00010190: 6365 645f 7564 665b 2769 6427 5d29 0a20  ced_udf['id']). 
-000101a0: 2020 2020 2020 2023 2072 6561 6420 7564         # read ud
-000101b0: 6673 2061 6674 6572 2064 656c 6574 696f  fs after deletio
-000101c0: 6e0a 2020 2020 2020 2020 7365 6c66 2e5f  n.        self._
-000101d0: 5f41 7373 6572 7448 5454 5046 6169 6c75  _AssertHTTPFailu
-000101e0: 7265 5769 7468 5374 6174 7573 2853 7461  reWithStatus(Sta
-000101f0: 7475 7343 6f64 6573 2e4e 4f54 5f46 4f55  tusCodes.NOT_FOU
-00010200: 4e44 2c0a 2020 2020 2020 2020 2020 2020  ND,.            
-00010210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010220: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00010230: 6f6c 6c65 6374 696f 6e2e 7363 7269 7074  ollection.script
-00010240: 732e 6765 745f 7573 6572 5f64 6566 696e  s.get_user_defin
-00010250: 6564 5f66 756e 6374 696f 6e2c 0a20 2020  ed_function,.   
-00010260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010280: 2020 2020 2020 2020 7265 706c 6163 6564          replaced
-00010290: 5f75 6466 5b27 6964 275d 290a 0a20 2020  _udf['id'])..   
-000102a0: 2064 6566 2074 6573 745f 7370 726f 635f   def test_sproc_
-000102b0: 6372 7564 2873 656c 6629 3a0a 2020 2020  crud(self):.    
-000102c0: 2020 2020 2320 6372 6561 7465 2064 6174      # create dat
-000102d0: 6162 6173 650a 2020 2020 2020 2020 6462  abase.        db
-000102e0: 203d 2073 656c 662e 6461 7461 6261 7365   = self.database
-000102f0: 466f 7254 6573 740a 2020 2020 2020 2020  ForTest.        
-00010300: 2320 6372 6561 7465 2063 6f6c 6c65 6374  # create collect
-00010310: 696f 6e0a 2020 2020 2020 2020 636f 6c6c  ion.        coll
-00010320: 6563 7469 6f6e 203d 2073 656c 662e 636f  ection = self.co
-00010330: 6e66 6967 732e 6372 6561 7465 5f6d 756c  nfigs.create_mul
-00010340: 7469 5f70 6172 7469 7469 6f6e 5f63 6f6c  ti_partition_col
-00010350: 6c65 6374 696f 6e5f 6966 5f6e 6f74 5f65  lection_if_not_e
-00010360: 7869 7374 2873 656c 662e 636c 6965 6e74  xist(self.client
-00010370: 290a 2020 2020 2020 2020 2320 7265 6164  ).        # read
-00010380: 2073 7072 6f63 730a 2020 2020 2020 2020   sprocs.        
-00010390: 7370 726f 6373 203d 206c 6973 7428 636f  sprocs = list(co
-000103a0: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
-000103b0: 2e6c 6973 745f 7374 6f72 6564 5f70 726f  .list_stored_pro
-000103c0: 6365 6475 7265 7328 2929 0a20 2020 2020  cedures()).     
-000103d0: 2020 2023 2063 7265 6174 6520 6120 7370     # create a sp
-000103e0: 726f 630a 2020 2020 2020 2020 6265 666f  roc.        befo
-000103f0: 7265 5f63 7265 6174 655f 7370 726f 6373  re_create_sprocs
-00010400: 5f63 6f75 6e74 203d 206c 656e 2873 7072  _count = len(spr
-00010410: 6f63 7329 0a20 2020 2020 2020 2073 7072  ocs).        spr
-00010420: 6f63 5f64 6566 696e 6974 696f 6e20 3d20  oc_definition = 
-00010430: 7b0a 2020 2020 2020 2020 2020 2020 2769  {.            'i
-00010440: 6427 3a20 2773 616d 706c 6520 7370 726f  d': 'sample spro
-00010450: 6327 2c0a 2020 2020 2020 2020 2020 2020  c',.            
-00010460: 2773 6572 7665 7253 6372 6970 7427 3a20  'serverScript': 
-00010470: 2766 756e 6374 696f 6e28 2920 7b76 6172  'function() {var
-00010480: 2078 203d 2031 303b 7d27 0a20 2020 2020   x = 10;}'.     
-00010490: 2020 207d 0a20 2020 2020 2020 2073 7072     }.        spr
-000104a0: 6f63 203d 2063 6f6c 6c65 6374 696f 6e2e  oc = collection.
-000104b0: 7363 7269 7074 732e 6372 6561 7465 5f73  scripts.create_s
-000104c0: 746f 7265 645f 7072 6f63 6564 7572 6528  tored_procedure(
-000104d0: 626f 6479 3d73 7072 6f63 5f64 6566 696e  body=sproc_defin
-000104e0: 6974 696f 6e29 0a20 2020 2020 2020 2066  ition).        f
-000104f0: 6f72 2070 726f 7065 7274 7920 696e 2073  or property in s
-00010500: 7072 6f63 5f64 6566 696e 6974 696f 6e3a  proc_definition:
-00010510: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00010520: 7072 6f70 6572 7479 2021 3d20 2273 6572  property != "ser
-00010530: 7665 7253 6372 6970 7422 3a0a 2020 2020  verScript":.    
-00010540: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00010550: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-00010560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010570: 2020 7370 726f 635b 7072 6f70 6572 7479    sproc[property
-00010580: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00010590: 2020 2020 2020 2073 7072 6f63 5f64 6566         sproc_def
-000105a0: 696e 6974 696f 6e5b 7072 6f70 6572 7479  inition[property
-000105b0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-000105c0: 2020 2020 2020 2027 7072 6f70 6572 7479         'property
-000105d0: 207b 7072 6f70 6572 7479 7d20 7368 6f75   {property} shou
-000105e0: 6c64 206d 6174 6368 272e 666f 726d 6174  ld match'.format
-000105f0: 2870 726f 7065 7274 793d 7072 6f70 6572  (property=proper
-00010600: 7479 2929 0a20 2020 2020 2020 2020 2020  ty)).           
-00010610: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00010620: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00010630: 7274 4571 7561 6c28 7370 726f 635b 2762  rtEqual(sproc['b
-00010640: 6f64 7927 5d2c 2027 6675 6e63 7469 6f6e  ody'], 'function
-00010650: 2829 207b 7661 7220 7820 3d20 3130 3b7d  () {var x = 10;}
-00010660: 2729 0a0a 2020 2020 2020 2020 2320 7265  ')..        # re
-00010670: 6164 2073 7072 6f63 7320 6166 7465 7220  ad sprocs after 
-00010680: 6372 6561 7469 6f6e 0a20 2020 2020 2020  creation.       
-00010690: 2073 7072 6f63 7320 3d20 6c69 7374 2863   sprocs = list(c
-000106a0: 6f6c 6c65 6374 696f 6e2e 7363 7269 7074  ollection.script
-000106b0: 732e 6c69 7374 5f73 746f 7265 645f 7072  s.list_stored_pr
-000106c0: 6f63 6564 7572 6573 2829 290a 2020 2020  ocedures()).    
-000106d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000106e0: 7175 616c 286c 656e 2873 7072 6f63 7329  qual(len(sprocs)
-000106f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010700: 2020 2020 2020 2020 2020 2062 6566 6f72             befor
-00010710: 655f 6372 6561 7465 5f73 7072 6f63 735f  e_create_sprocs_
-00010720: 636f 756e 7420 2b20 312c 0a20 2020 2020  count + 1,.     
-00010730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010740: 2020 2020 2763 7265 6174 6520 7368 6f75      'create shou
-00010750: 6c64 2069 6e63 7265 6173 6520 7468 6520  ld increase the 
-00010760: 6e75 6d62 6572 206f 6620 7370 726f 6373  number of sprocs
-00010770: 2729 0a20 2020 2020 2020 2023 2071 7565  ').        # que
-00010780: 7279 2073 7072 6f63 730a 2020 2020 2020  ry sprocs.      
-00010790: 2020 7370 726f 6373 203d 206c 6973 7428    sprocs = list(
-000107a0: 636f 6c6c 6563 7469 6f6e 2e73 6372 6970  collection.scrip
-000107b0: 7473 2e71 7565 7279 5f73 746f 7265 645f  ts.query_stored_
-000107c0: 7072 6f63 6564 7572 6573 280a 2020 2020  procedures(.    
-000107d0: 2020 2020 2020 2020 2020 2020 7175 6572              quer
-000107e0: 793d 2753 454c 4543 5420 2a20 4652 4f4d  y='SELECT * FROM
-000107f0: 2072 6f6f 7420 7220 5748 4552 4520 722e   root r WHERE r.
-00010800: 6964 3d40 6964 272c 0a20 2020 2020 2020  id=@id',.       
-00010810: 2020 2020 2020 2020 2070 6172 616d 6574           paramet
-00010820: 6572 733d 5b0a 2020 2020 2020 2020 2020  ers=[.          
-00010830: 2020 2020 2020 2020 2020 7b27 6e61 6d65            {'name
-00010840: 273a 2027 4069 6427 2c20 2776 616c 7565  ': '@id', 'value
-00010850: 273a 2073 7072 6f63 5f64 6566 696e 6974  ': sproc_definit
-00010860: 696f 6e5b 2769 6427 5d7d 0a20 2020 2020  ion['id']}.     
-00010870: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-00010880: 2020 2020 2029 290a 2020 2020 2020 2020       )).        
-00010890: 7365 6c66 2e61 7373 6572 7449 734e 6f74  self.assertIsNot
-000108a0: 4e6f 6e65 2873 7072 6f63 7329 0a20 2020  None(sprocs).   
-000108b0: 2020 2020 2023 2072 6570 6c61 6365 2073       # replace s
-000108c0: 7072 6f63 0a20 2020 2020 2020 2063 6861  proc.        cha
-000108d0: 6e67 655f 7370 726f 6320 3d20 7370 726f  nge_sproc = spro
-000108e0: 632e 636f 7079 2829 0a20 2020 2020 2020  c.copy().       
-000108f0: 2073 7072 6f63 5b27 626f 6479 275d 203d   sproc['body'] =
-00010900: 2027 6675 6e63 7469 6f6e 2829 207b 7661   'function() {va
-00010910: 7220 7820 3d20 3230 3b7d 270a 2020 2020  r x = 20;}'.    
-00010920: 2020 2020 7265 706c 6163 6564 5f73 7072      replaced_spr
-00010930: 6f63 203d 2063 6f6c 6c65 6374 696f 6e2e  oc = collection.
-00010940: 7363 7269 7074 732e 7265 706c 6163 655f  scripts.replace_
-00010950: 7374 6f72 6564 5f70 726f 6365 6475 7265  stored_procedure
-00010960: 2873 7072 6f63 3d63 6861 6e67 655f 7370  (sproc=change_sp
-00010970: 726f 635b 2769 6427 5d2c 2062 6f64 793d  roc['id'], body=
-00010980: 7370 726f 6329 0a20 2020 2020 2020 2066  sproc).        f
-00010990: 6f72 2070 726f 7065 7274 7920 696e 2073  or property in s
-000109a0: 7072 6f63 5f64 6566 696e 6974 696f 6e3a  proc_definition:
-000109b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000109c0: 7072 6f70 6572 7479 2021 3d20 2773 6572  property != 'ser
-000109d0: 7665 7253 6372 6970 7427 3a0a 2020 2020  verScript':.    
-000109e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000109f0: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-00010a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a10: 2020 7265 706c 6163 6564 5f73 7072 6f63    replaced_sproc
-00010a20: 5b70 726f 7065 7274 795d 2c0a 2020 2020  [property],.    
-00010a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a40: 7370 726f 635b 7072 6f70 6572 7479 5d2c  sproc[property],
-00010a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010a60: 2020 2020 2027 7072 6f70 6572 7479 207b       'property {
-00010a70: 7072 6f70 6572 7479 7d20 7368 6f75 6c64  property} should
-00010a80: 206d 6174 6368 272e 666f 726d 6174 2870   match'.format(p
-00010a90: 726f 7065 7274 793d 7072 6f70 6572 7479  roperty=property
-00010aa0: 2929 0a20 2020 2020 2020 2020 2020 2065  )).            e
-00010ab0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00010ac0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00010ad0: 4571 7561 6c28 7265 706c 6163 6564 5f73  Equal(replaced_s
-00010ae0: 7072 6f63 5b27 626f 6479 275d 2c0a 2020  proc['body'],.  
-00010af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b00: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00010b10: 6675 6e63 7469 6f6e 2829 207b 7661 7220  function() {var 
-00010b20: 7820 3d20 3230 3b7d 2229 0a20 2020 2020  x = 20;}").     
-00010b30: 2020 2023 2072 6561 6420 7370 726f 630a     # read sproc.
-00010b40: 2020 2020 2020 2020 7370 726f 6320 3d20          sproc = 
-00010b50: 636f 6c6c 6563 7469 6f6e 2e73 6372 6970  collection.scrip
-00010b60: 7473 2e67 6574 5f73 746f 7265 645f 7072  ts.get_stored_pr
-00010b70: 6f63 6564 7572 6528 7265 706c 6163 6564  ocedure(replaced
-00010b80: 5f73 7072 6f63 5b27 6964 275d 290a 2020  _sproc['id']).  
-00010b90: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00010ba0: 7445 7175 616c 2872 6570 6c61 6365 645f  tEqual(replaced_
-00010bb0: 7370 726f 635b 2769 6427 5d2c 2073 7072  sproc['id'], spr
-00010bc0: 6f63 5b27 6964 275d 290a 2020 2020 2020  oc['id']).      
-00010bd0: 2020 2320 6465 6c65 7465 2073 7072 6f63    # delete sproc
-00010be0: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
-00010bf0: 696f 6e2e 7363 7269 7074 732e 6465 6c65  ion.scripts.dele
-00010c00: 7465 5f73 746f 7265 645f 7072 6f63 6564  te_stored_proced
-00010c10: 7572 6528 7265 706c 6163 6564 5f73 7072  ure(replaced_spr
-00010c20: 6f63 5b27 6964 275d 290a 2020 2020 2020  oc['id']).      
-00010c30: 2020 2320 7265 6164 2073 7072 6f63 7320    # read sprocs 
-00010c40: 6166 7465 7220 6465 6c65 7469 6f6e 0a20  after deletion. 
-00010c50: 2020 2020 2020 2073 656c 662e 5f5f 4173         self.__As
-00010c60: 7365 7274 4854 5450 4661 696c 7572 6557  sertHTTPFailureW
-00010c70: 6974 6853 7461 7475 7328 5374 6174 7573  ithStatus(Status
-00010c80: 436f 6465 732e 4e4f 545f 464f 554e 442c  Codes.NOT_FOUND,
-00010c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cb0: 2020 2020 2020 2020 2020 2020 636f 6c6c              coll
-00010cc0: 6563 7469 6f6e 2e73 6372 6970 7473 2e67  ection.scripts.g
-00010cd0: 6574 5f73 746f 7265 645f 7072 6f63 6564  et_stored_proced
-00010ce0: 7572 652c 0a20 2020 2020 2020 2020 2020  ure,.           
-00010cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f9a0: 2020 2020 7265 706c 6163 6564 5f74 7269      replaced_tri
+0000f9b0: 6767 6572 5b27 6964 275d 290a 0a20 2020  gger['id'])..   
+0000f9c0: 2064 6566 2074 6573 745f 7564 665f 6372   def test_udf_cr
+0000f9d0: 7564 2873 656c 6629 3a0a 2020 2020 2020  ud(self):.      
+0000f9e0: 2020 2320 6372 6561 7465 2064 6174 6162    # create datab
+0000f9f0: 6173 650a 2020 2020 2020 2020 6462 203d  ase.        db =
+0000fa00: 2073 656c 662e 6461 7461 6261 7365 466f   self.databaseFo
+0000fa10: 7254 6573 740a 2020 2020 2020 2020 2320  rTest.        # 
+0000fa20: 6372 6561 7465 2063 6f6c 6c65 6374 696f  create collectio
+0000fa30: 6e0a 2020 2020 2020 2020 636f 6c6c 6563  n.        collec
+0000fa40: 7469 6f6e 203d 2073 656c 662e 636f 6e66  tion = self.conf
+0000fa50: 6967 732e 6372 6561 7465 5f6d 756c 7469  igs.create_multi
+0000fa60: 5f70 6172 7469 7469 6f6e 5f63 6f6c 6c65  _partition_colle
+0000fa70: 6374 696f 6e5f 6966 5f6e 6f74 5f65 7869  ction_if_not_exi
+0000fa80: 7374 2873 656c 662e 636c 6965 6e74 290a  st(self.client).
+0000fa90: 2020 2020 2020 2020 2320 7265 6164 2075          # read u
+0000faa0: 6466 730a 2020 2020 2020 2020 7564 6673  dfs.        udfs
+0000fab0: 203d 206c 6973 7428 636f 6c6c 6563 7469   = list(collecti
+0000fac0: 6f6e 2e73 6372 6970 7473 2e6c 6973 745f  on.scripts.list_
+0000fad0: 7573 6572 5f64 6566 696e 6564 5f66 756e  user_defined_fun
+0000fae0: 6374 696f 6e73 2829 290a 2020 2020 2020  ctions()).      
+0000faf0: 2020 2320 6372 6561 7465 2061 2075 6466    # create a udf
+0000fb00: 0a20 2020 2020 2020 2062 6566 6f72 655f  .        before_
+0000fb10: 6372 6561 7465 5f75 6466 735f 636f 756e  create_udfs_coun
+0000fb20: 7420 3d20 6c65 6e28 7564 6673 290a 2020  t = len(udfs).  
+0000fb30: 2020 2020 2020 7564 665f 6465 6669 6e69        udf_defini
+0000fb40: 7469 6f6e 203d 207b 0a20 2020 2020 2020  tion = {.       
+0000fb50: 2020 2020 2027 6964 273a 2027 7361 6d70       'id': 'samp
+0000fb60: 6c65 2075 6466 272c 0a20 2020 2020 2020  le udf',.       
+0000fb70: 2020 2020 2027 626f 6479 273a 2027 6675       'body': 'fu
+0000fb80: 6e63 7469 6f6e 2829 207b 7661 7220 7820  nction() {var x 
+0000fb90: 3d20 3130 3b7d 270a 2020 2020 2020 2020  = 10;}'.        
+0000fba0: 7d0a 2020 2020 2020 2020 7564 6620 3d20  }.        udf = 
+0000fbb0: 636f 6c6c 6563 7469 6f6e 2e73 6372 6970  collection.scrip
+0000fbc0: 7473 2e63 7265 6174 655f 7573 6572 5f64  ts.create_user_d
+0000fbd0: 6566 696e 6564 5f66 756e 6374 696f 6e28  efined_function(
+0000fbe0: 626f 6479 3d75 6466 5f64 6566 696e 6974  body=udf_definit
+0000fbf0: 696f 6e29 0a20 2020 2020 2020 2066 6f72  ion).        for
+0000fc00: 2070 726f 7065 7274 7920 696e 2075 6466   property in udf
+0000fc10: 5f64 6566 696e 6974 696f 6e3a 0a20 2020  _definition:.   
+0000fc20: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0000fc30: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+0000fc40: 2020 2020 2020 2020 2020 2075 6466 5b70             udf[p
+0000fc50: 726f 7065 7274 795d 2c0a 2020 2020 2020  roperty],.      
+0000fc60: 2020 2020 2020 2020 2020 7564 665f 6465            udf_de
+0000fc70: 6669 6e69 7469 6f6e 5b70 726f 7065 7274  finition[propert
+0000fc80: 795d 2c0a 2020 2020 2020 2020 2020 2020  y],.            
+0000fc90: 2020 2020 2770 726f 7065 7274 7920 7b70      'property {p
+0000fca0: 726f 7065 7274 797d 2073 686f 756c 6420  roperty} should 
+0000fcb0: 6d61 7463 6827 2e66 6f72 6d61 7428 7072  match'.format(pr
+0000fcc0: 6f70 6572 7479 3d70 726f 7065 7274 7929  operty=property)
+0000fcd0: 290a 0a20 2020 2020 2020 2023 2072 6561  )..        # rea
+0000fce0: 6420 7564 6673 2061 6674 6572 2063 7265  d udfs after cre
+0000fcf0: 6174 696f 6e0a 2020 2020 2020 2020 7564  ation.        ud
+0000fd00: 6673 203d 206c 6973 7428 636f 6c6c 6563  fs = list(collec
+0000fd10: 7469 6f6e 2e73 6372 6970 7473 2e6c 6973  tion.scripts.lis
+0000fd20: 745f 7573 6572 5f64 6566 696e 6564 5f66  t_user_defined_f
+0000fd30: 756e 6374 696f 6e73 2829 290a 2020 2020  unctions()).    
+0000fd40: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000fd50: 7175 616c 286c 656e 2875 6466 7329 2c0a  qual(len(udfs),.
+0000fd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd70: 2020 2020 2020 2020 2062 6566 6f72 655f           before_
+0000fd80: 6372 6561 7465 5f75 6466 735f 636f 756e  create_udfs_coun
+0000fd90: 7420 2b20 312c 0a20 2020 2020 2020 2020  t + 1,.         
+0000fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fdb0: 2763 7265 6174 6520 7368 6f75 6c64 2069  'create should i
+0000fdc0: 6e63 7265 6173 6520 7468 6520 6e75 6d62  ncrease the numb
+0000fdd0: 6572 206f 6620 7564 6673 2729 0a20 2020  er of udfs').   
+0000fde0: 2020 2020 2023 2071 7565 7279 2075 6466       # query udf
+0000fdf0: 730a 2020 2020 2020 2020 7265 7375 6c74  s.        result
+0000fe00: 7320 3d20 6c69 7374 2863 6f6c 6c65 6374  s = list(collect
+0000fe10: 696f 6e2e 7363 7269 7074 732e 7175 6572  ion.scripts.quer
+0000fe20: 795f 7573 6572 5f64 6566 696e 6564 5f66  y_user_defined_f
+0000fe30: 756e 6374 696f 6e73 280a 2020 2020 2020  unctions(.      
+0000fe40: 2020 2020 2020 2020 2020 7175 6572 793d            query=
+0000fe50: 2753 454c 4543 5420 2a20 4652 4f4d 2072  'SELECT * FROM r
+0000fe60: 6f6f 7420 7220 5748 4552 4520 722e 6964  oot r WHERE r.id
+0000fe70: 3d40 6964 272c 0a20 2020 2020 2020 2020  =@id',.         
+0000fe80: 2020 2020 2020 2070 6172 616d 6574 6572         parameter
+0000fe90: 733d 5b0a 2020 2020 2020 2020 2020 2020  s=[.            
+0000fea0: 2020 2020 2020 2020 7b27 6e61 6d65 273a          {'name':
+0000feb0: 2027 4069 6427 2c20 2776 616c 7565 273a   '@id', 'value':
+0000fec0: 2075 6466 5f64 6566 696e 6974 696f 6e5b   udf_definition[
+0000fed0: 2769 6427 5d7d 0a20 2020 2020 2020 2020  'id']}.         
+0000fee0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+0000fef0: 2029 290a 2020 2020 2020 2020 7365 6c66   )).        self
+0000ff00: 2e61 7373 6572 7454 7275 6528 7265 7375  .assertTrue(resu
+0000ff10: 6c74 7329 0a20 2020 2020 2020 2023 2072  lts).        # r
+0000ff20: 6570 6c61 6365 2075 6466 0a20 2020 2020  eplace udf.     
+0000ff30: 2020 2063 6861 6e67 655f 7564 6620 3d20     change_udf = 
+0000ff40: 7564 662e 636f 7079 2829 0a20 2020 2020  udf.copy().     
+0000ff50: 2020 2075 6466 5b27 626f 6479 275d 203d     udf['body'] =
+0000ff60: 2027 6675 6e63 7469 6f6e 2829 207b 7661   'function() {va
+0000ff70: 7220 7820 3d20 3230 3b7d 270a 2020 2020  r x = 20;}'.    
+0000ff80: 2020 2020 7265 706c 6163 6564 5f75 6466      replaced_udf
+0000ff90: 203d 2063 6f6c 6c65 6374 696f 6e2e 7363   = collection.sc
+0000ffa0: 7269 7074 732e 7265 706c 6163 655f 7573  ripts.replace_us
+0000ffb0: 6572 5f64 6566 696e 6564 5f66 756e 6374  er_defined_funct
+0000ffc0: 696f 6e28 7564 663d 7564 665b 2769 6427  ion(udf=udf['id'
+0000ffd0: 5d2c 2062 6f64 793d 7564 6629 0a20 2020  ], body=udf).   
+0000ffe0: 2020 2020 2066 6f72 2070 726f 7065 7274       for propert
+0000fff0: 7920 696e 2075 6466 5f64 6566 696e 6974  y in udf_definit
+00010000: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+00010010: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00010020: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00010030: 2020 2072 6570 6c61 6365 645f 7564 665b     replaced_udf[
+00010040: 7072 6f70 6572 7479 5d2c 0a20 2020 2020  property],.     
+00010050: 2020 2020 2020 2020 2020 2075 6466 5b70             udf[p
+00010060: 726f 7065 7274 795d 2c0a 2020 2020 2020  roperty],.      
+00010070: 2020 2020 2020 2020 2020 2770 726f 7065            'prope
+00010080: 7274 7920 7b70 726f 7065 7274 797d 2073  rty {property} s
+00010090: 686f 756c 6420 6d61 7463 6827 2e66 6f72  hould match'.for
+000100a0: 6d61 7428 7072 6f70 6572 7479 3d70 726f  mat(property=pro
+000100b0: 7065 7274 7929 290a 2020 2020 2020 2020  perty)).        
+000100c0: 2320 7265 6164 2075 6466 0a20 2020 2020  # read udf.     
+000100d0: 2020 2075 6466 203d 2063 6f6c 6c65 6374     udf = collect
+000100e0: 696f 6e2e 7363 7269 7074 732e 6765 745f  ion.scripts.get_
+000100f0: 7573 6572 5f64 6566 696e 6564 5f66 756e  user_defined_fun
+00010100: 6374 696f 6e28 7265 706c 6163 6564 5f75  ction(replaced_u
+00010110: 6466 5b27 6964 275d 290a 2020 2020 2020  df['id']).      
+00010120: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00010130: 616c 2872 6570 6c61 6365 645f 7564 665b  al(replaced_udf[
+00010140: 2769 6427 5d2c 2075 6466 5b27 6964 275d  'id'], udf['id']
+00010150: 290a 2020 2020 2020 2020 2320 6465 6c65  ).        # dele
+00010160: 7465 2075 6466 0a20 2020 2020 2020 2063  te udf.        c
+00010170: 6f6c 6c65 6374 696f 6e2e 7363 7269 7074  ollection.script
+00010180: 732e 6465 6c65 7465 5f75 7365 725f 6465  s.delete_user_de
+00010190: 6669 6e65 645f 6675 6e63 7469 6f6e 2872  fined_function(r
+000101a0: 6570 6c61 6365 645f 7564 665b 2769 6427  eplaced_udf['id'
+000101b0: 5d29 0a20 2020 2020 2020 2023 2072 6561  ]).        # rea
+000101c0: 6420 7564 6673 2061 6674 6572 2064 656c  d udfs after del
+000101d0: 6574 696f 6e0a 2020 2020 2020 2020 7365  etion.        se
+000101e0: 6c66 2e5f 5f41 7373 6572 7448 5454 5046  lf.__AssertHTTPF
+000101f0: 6169 6c75 7265 5769 7468 5374 6174 7573  ailureWithStatus
+00010200: 2853 7461 7475 7343 6f64 6573 2e4e 4f54  (StatusCodes.NOT
+00010210: 5f46 4f55 4e44 2c0a 2020 2020 2020 2020  _FOUND,.        
+00010220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010240: 2020 2063 6f6c 6c65 6374 696f 6e2e 7363     collection.sc
+00010250: 7269 7074 732e 6765 745f 7573 6572 5f64  ripts.get_user_d
+00010260: 6566 696e 6564 5f66 756e 6374 696f 6e2c  efined_function,
+00010270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010290: 2020 2020 2020 2020 2020 2020 7265 706c              repl
+000102a0: 6163 6564 5f75 6466 5b27 6964 275d 290a  aced_udf['id']).
+000102b0: 0a20 2020 2064 6566 2074 6573 745f 7370  .    def test_sp
+000102c0: 726f 635f 6372 7564 2873 656c 6629 3a0a  roc_crud(self):.
+000102d0: 2020 2020 2020 2020 2320 6372 6561 7465          # create
+000102e0: 2064 6174 6162 6173 650a 2020 2020 2020   database.      
+000102f0: 2020 6462 203d 2073 656c 662e 6461 7461    db = self.data
+00010300: 6261 7365 466f 7254 6573 740a 2020 2020  baseForTest.    
+00010310: 2020 2020 2320 6372 6561 7465 2063 6f6c      # create col
+00010320: 6c65 6374 696f 6e0a 2020 2020 2020 2020  lection.        
+00010330: 636f 6c6c 6563 7469 6f6e 203d 2073 656c  collection = sel
+00010340: 662e 636f 6e66 6967 732e 6372 6561 7465  f.configs.create
+00010350: 5f6d 756c 7469 5f70 6172 7469 7469 6f6e  _multi_partition
+00010360: 5f63 6f6c 6c65 6374 696f 6e5f 6966 5f6e  _collection_if_n
+00010370: 6f74 5f65 7869 7374 2873 656c 662e 636c  ot_exist(self.cl
+00010380: 6965 6e74 290a 2020 2020 2020 2020 2320  ient).        # 
+00010390: 7265 6164 2073 7072 6f63 730a 2020 2020  read sprocs.    
+000103a0: 2020 2020 7370 726f 6373 203d 206c 6973      sprocs = lis
+000103b0: 7428 636f 6c6c 6563 7469 6f6e 2e73 6372  t(collection.scr
+000103c0: 6970 7473 2e6c 6973 745f 7374 6f72 6564  ipts.list_stored
+000103d0: 5f70 726f 6365 6475 7265 7328 2929 0a20  _procedures()). 
+000103e0: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+000103f0: 6120 7370 726f 630a 2020 2020 2020 2020  a sproc.        
+00010400: 6265 666f 7265 5f63 7265 6174 655f 7370  before_create_sp
+00010410: 726f 6373 5f63 6f75 6e74 203d 206c 656e  rocs_count = len
+00010420: 2873 7072 6f63 7329 0a20 2020 2020 2020  (sprocs).       
+00010430: 2073 7072 6f63 5f64 6566 696e 6974 696f   sproc_definitio
+00010440: 6e20 3d20 7b0a 2020 2020 2020 2020 2020  n = {.          
+00010450: 2020 2769 6427 3a20 2773 616d 706c 6520    'id': 'sample 
+00010460: 7370 726f 6327 2c0a 2020 2020 2020 2020  sproc',.        
+00010470: 2020 2020 2773 6572 7665 7253 6372 6970      'serverScrip
+00010480: 7427 3a20 2766 756e 6374 696f 6e28 2920  t': 'function() 
+00010490: 7b76 6172 2078 203d 2031 303b 7d27 0a20  {var x = 10;}'. 
+000104a0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000104b0: 2073 7072 6f63 203d 2063 6f6c 6c65 6374   sproc = collect
+000104c0: 696f 6e2e 7363 7269 7074 732e 6372 6561  ion.scripts.crea
+000104d0: 7465 5f73 746f 7265 645f 7072 6f63 6564  te_stored_proced
+000104e0: 7572 6528 626f 6479 3d73 7072 6f63 5f64  ure(body=sproc_d
+000104f0: 6566 696e 6974 696f 6e29 0a20 2020 2020  efinition).     
+00010500: 2020 2066 6f72 2070 726f 7065 7274 7920     for property 
+00010510: 696e 2073 7072 6f63 5f64 6566 696e 6974  in sproc_definit
+00010520: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+00010530: 2069 6620 7072 6f70 6572 7479 2021 3d20   if property != 
+00010540: 2273 6572 7665 7253 6372 6970 7422 3a0a  "serverScript":.
+00010550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010560: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00010570: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00010580: 2020 2020 2020 7370 726f 635b 7072 6f70        sproc[prop
+00010590: 6572 7479 5d2c 0a20 2020 2020 2020 2020  erty],.         
+000105a0: 2020 2020 2020 2020 2020 2073 7072 6f63             sproc
+000105b0: 5f64 6566 696e 6974 696f 6e5b 7072 6f70  _definition[prop
+000105c0: 6572 7479 5d2c 0a20 2020 2020 2020 2020  erty],.         
+000105d0: 2020 2020 2020 2020 2020 2027 7072 6f70             'prop
+000105e0: 6572 7479 207b 7072 6f70 6572 7479 7d20  erty {property} 
+000105f0: 7368 6f75 6c64 206d 6174 6368 272e 666f  should match'.fo
+00010600: 726d 6174 2870 726f 7065 7274 793d 7072  rmat(property=pr
+00010610: 6f70 6572 7479 2929 0a20 2020 2020 2020  operty)).       
+00010620: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00010630: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00010640: 6173 7365 7274 4571 7561 6c28 7370 726f  assertEqual(spro
+00010650: 635b 2762 6f64 7927 5d2c 2027 6675 6e63  c['body'], 'func
+00010660: 7469 6f6e 2829 207b 7661 7220 7820 3d20  tion() {var x = 
+00010670: 3130 3b7d 2729 0a0a 2020 2020 2020 2020  10;}')..        
+00010680: 2320 7265 6164 2073 7072 6f63 7320 6166  # read sprocs af
+00010690: 7465 7220 6372 6561 7469 6f6e 0a20 2020  ter creation.   
+000106a0: 2020 2020 2073 7072 6f63 7320 3d20 6c69       sprocs = li
+000106b0: 7374 2863 6f6c 6c65 6374 696f 6e2e 7363  st(collection.sc
+000106c0: 7269 7074 732e 6c69 7374 5f73 746f 7265  ripts.list_store
+000106d0: 645f 7072 6f63 6564 7572 6573 2829 290a  d_procedures()).
+000106e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000106f0: 6572 7445 7175 616c 286c 656e 2873 7072  ertEqual(len(spr
+00010700: 6f63 7329 2c0a 2020 2020 2020 2020 2020  ocs),.          
+00010710: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00010720: 6566 6f72 655f 6372 6561 7465 5f73 7072  efore_create_spr
+00010730: 6f63 735f 636f 756e 7420 2b20 312c 0a20  ocs_count + 1,. 
+00010740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010750: 2020 2020 2020 2020 2763 7265 6174 6520          'create 
+00010760: 7368 6f75 6c64 2069 6e63 7265 6173 6520  should increase 
+00010770: 7468 6520 6e75 6d62 6572 206f 6620 7370  the number of sp
+00010780: 726f 6373 2729 0a20 2020 2020 2020 2023  rocs').        #
+00010790: 2071 7565 7279 2073 7072 6f63 730a 2020   query sprocs.  
+000107a0: 2020 2020 2020 7370 726f 6373 203d 206c        sprocs = l
+000107b0: 6973 7428 636f 6c6c 6563 7469 6f6e 2e73  ist(collection.s
+000107c0: 6372 6970 7473 2e71 7565 7279 5f73 746f  cripts.query_sto
+000107d0: 7265 645f 7072 6f63 6564 7572 6573 280a  red_procedures(.
+000107e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000107f0: 7175 6572 793d 2753 454c 4543 5420 2a20  query='SELECT * 
+00010800: 4652 4f4d 2072 6f6f 7420 7220 5748 4552  FROM root r WHER
+00010810: 4520 722e 6964 3d40 6964 272c 0a20 2020  E r.id=@id',.   
+00010820: 2020 2020 2020 2020 2020 2020 2070 6172               par
+00010830: 616d 6574 6572 733d 5b0a 2020 2020 2020  ameters=[.      
+00010840: 2020 2020 2020 2020 2020 2020 2020 7b27                {'
+00010850: 6e61 6d65 273a 2027 4069 6427 2c20 2776  name': '@id', 'v
+00010860: 616c 7565 273a 2073 7072 6f63 5f64 6566  alue': sproc_def
+00010870: 696e 6974 696f 6e5b 2769 6427 5d7d 0a20  inition['id']}. 
+00010880: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00010890: 0a20 2020 2020 2020 2029 290a 2020 2020  .        )).    
+000108a0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+000108b0: 734e 6f74 4e6f 6e65 2873 7072 6f63 7329  sNotNone(sprocs)
+000108c0: 0a20 2020 2020 2020 2023 2072 6570 6c61  .        # repla
+000108d0: 6365 2073 7072 6f63 0a20 2020 2020 2020  ce sproc.       
+000108e0: 2063 6861 6e67 655f 7370 726f 6320 3d20   change_sproc = 
+000108f0: 7370 726f 632e 636f 7079 2829 0a20 2020  sproc.copy().   
+00010900: 2020 2020 2073 7072 6f63 5b27 626f 6479       sproc['body
+00010910: 275d 203d 2027 6675 6e63 7469 6f6e 2829  '] = 'function()
+00010920: 207b 7661 7220 7820 3d20 3230 3b7d 270a   {var x = 20;}'.
+00010930: 2020 2020 2020 2020 7265 706c 6163 6564          replaced
+00010940: 5f73 7072 6f63 203d 2063 6f6c 6c65 6374  _sproc = collect
+00010950: 696f 6e2e 7363 7269 7074 732e 7265 706c  ion.scripts.repl
+00010960: 6163 655f 7374 6f72 6564 5f70 726f 6365  ace_stored_proce
+00010970: 6475 7265 2873 7072 6f63 3d63 6861 6e67  dure(sproc=chang
+00010980: 655f 7370 726f 635b 2769 6427 5d2c 2062  e_sproc['id'], b
+00010990: 6f64 793d 7370 726f 6329 0a20 2020 2020  ody=sproc).     
+000109a0: 2020 2066 6f72 2070 726f 7065 7274 7920     for property 
+000109b0: 696e 2073 7072 6f63 5f64 6566 696e 6974  in sproc_definit
+000109c0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+000109d0: 2069 6620 7072 6f70 6572 7479 2021 3d20   if property != 
+000109e0: 2773 6572 7665 7253 6372 6970 7427 3a0a  'serverScript':.
+000109f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a00: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00010a10: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00010a20: 2020 2020 2020 7265 706c 6163 6564 5f73        replaced_s
+00010a30: 7072 6f63 5b70 726f 7065 7274 795d 2c0a  proc[property],.
+00010a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a50: 2020 2020 7370 726f 635b 7072 6f70 6572      sproc[proper
+00010a60: 7479 5d2c 0a20 2020 2020 2020 2020 2020  ty],.           
+00010a70: 2020 2020 2020 2020 2027 7072 6f70 6572           'proper
+00010a80: 7479 207b 7072 6f70 6572 7479 7d20 7368  ty {property} sh
+00010a90: 6f75 6c64 206d 6174 6368 272e 666f 726d  ould match'.form
+00010aa0: 6174 2870 726f 7065 7274 793d 7072 6f70  at(property=prop
+00010ab0: 6572 7479 2929 0a20 2020 2020 2020 2020  erty)).         
+00010ac0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00010ad0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00010ae0: 7365 7274 4571 7561 6c28 7265 706c 6163  sertEqual(replac
+00010af0: 6564 5f73 7072 6f63 5b27 626f 6479 275d  ed_sproc['body']
+00010b00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b20: 2020 2022 6675 6e63 7469 6f6e 2829 207b     "function() {
+00010b30: 7661 7220 7820 3d20 3230 3b7d 2229 0a20  var x = 20;}"). 
+00010b40: 2020 2020 2020 2023 2072 6561 6420 7370         # read sp
+00010b50: 726f 630a 2020 2020 2020 2020 7370 726f  roc.        spro
+00010b60: 6320 3d20 636f 6c6c 6563 7469 6f6e 2e73  c = collection.s
+00010b70: 6372 6970 7473 2e67 6574 5f73 746f 7265  cripts.get_store
+00010b80: 645f 7072 6f63 6564 7572 6528 7265 706c  d_procedure(repl
+00010b90: 6163 6564 5f73 7072 6f63 5b27 6964 275d  aced_sproc['id']
+00010ba0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00010bb0: 7373 6572 7445 7175 616c 2872 6570 6c61  ssertEqual(repla
+00010bc0: 6365 645f 7370 726f 635b 2769 6427 5d2c  ced_sproc['id'],
+00010bd0: 2073 7072 6f63 5b27 6964 275d 290a 2020   sproc['id']).  
+00010be0: 2020 2020 2020 2320 6465 6c65 7465 2073        # delete s
+00010bf0: 7072 6f63 0a20 2020 2020 2020 2063 6f6c  proc.        col
+00010c00: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
+00010c10: 6465 6c65 7465 5f73 746f 7265 645f 7072  delete_stored_pr
+00010c20: 6f63 6564 7572 6528 7265 706c 6163 6564  ocedure(replaced
+00010c30: 5f73 7072 6f63 5b27 6964 275d 290a 2020  _sproc['id']).  
+00010c40: 2020 2020 2020 2320 7265 6164 2073 7072        # read spr
+00010c50: 6f63 7320 6166 7465 7220 6465 6c65 7469  ocs after deleti
+00010c60: 6f6e 0a20 2020 2020 2020 2073 656c 662e  on.        self.
+00010c70: 5f5f 4173 7365 7274 4854 5450 4661 696c  __AssertHTTPFail
+00010c80: 7572 6557 6974 6853 7461 7475 7328 5374  ureWithStatus(St
+00010c90: 6174 7573 436f 6465 732e 4e4f 545f 464f  atusCodes.NOT_FO
+00010ca0: 554e 442c 0a20 2020 2020 2020 2020 2020  UND,.           
+00010cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010cd0: 636f 6c6c 6563 7469 6f6e 2e73 6372 6970  collection.scrip
+00010ce0: 7473 2e67 6574 5f73 746f 7265 645f 7072  ts.get_stored_pr
+00010cf0: 6f63 6564 7572 652c 0a20 2020 2020 2020  ocedure,.       
 00010d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d10: 7265 706c 6163 6564 5f73 7072 6f63 5b27  replaced_sproc['
-00010d20: 6964 275d 290a 0a20 2020 2064 6566 2074  id'])..    def t
-00010d30: 6573 745f 7363 7269 7074 5f6c 6f67 6769  est_script_loggi
-00010d40: 6e67 5f65 7865 6375 7465 5f73 746f 7265  ng_execute_store
-00010d50: 645f 7072 6f63 6564 7572 6528 7365 6c66  d_procedure(self
-00010d60: 293a 0a20 2020 2020 2020 2063 7265 6174  ):.        creat
-00010d70: 6564 5f64 6220 3d20 7365 6c66 2e64 6174  ed_db = self.dat
-00010d80: 6162 6173 6546 6f72 5465 7374 0a0a 2020  abaseForTest..  
-00010d90: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
-00010da0: 6c6c 6563 7469 6f6e 203d 2073 656c 662e  llection = self.
-00010db0: 636f 6e66 6967 732e 6372 6561 7465 5f6d  configs.create_m
-00010dc0: 756c 7469 5f70 6172 7469 7469 6f6e 5f63  ulti_partition_c
-00010dd0: 6f6c 6c65 6374 696f 6e5f 6966 5f6e 6f74  ollection_if_not
-00010de0: 5f65 7869 7374 2873 656c 662e 636c 6965  _exist(self.clie
-00010df0: 6e74 290a 0a20 2020 2020 2020 2073 7072  nt)..        spr
-00010e00: 6f63 203d 207b 0a20 2020 2020 2020 2020  oc = {.         
-00010e10: 2020 2027 6964 273a 2027 7374 6f72 6564     'id': 'stored
-00010e20: 5072 6f63 6564 7572 6527 202b 2073 7472  Procedure' + str
-00010e30: 2875 7569 642e 7575 6964 3428 2929 2c0a  (uuid.uuid4()),.
-00010e40: 2020 2020 2020 2020 2020 2020 2762 6f64              'bod
-00010e50: 7927 3a20 280a 2020 2020 2020 2020 2020  y': (.          
-00010e60: 2020 2020 2020 2766 756e 6374 696f 6e20        'function 
-00010e70: 2829 207b 2720 2b0a 2020 2020 2020 2020  () {' +.        
-00010e80: 2020 2020 2020 2020 2720 2020 7661 7220          '   var 
-00010e90: 6d79 7465 7874 203d 205c 2778 5c27 3b27  mytext = \'x\';'
-00010ea0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00010eb0: 2020 2027 2020 2076 6172 206d 7976 616c     '   var myval
-00010ec0: 203d 2031 3b27 202b 0a20 2020 2020 2020   = 1;' +.       
-00010ed0: 2020 2020 2020 2020 2027 2020 2074 7279           '   try
-00010ee0: 207b 2720 2b0a 2020 2020 2020 2020 2020   {' +.          
-00010ef0: 2020 2020 2020 2720 2020 2020 2020 636f        '       co
-00010f00: 6e73 6f6c 652e 6c6f 6728 5c27 5468 6520  nsole.log(\'The 
-00010f10: 7661 6c75 6520 6f66 2025 7320 6973 2025  value of %s is %
-00010f20: 732e 5c27 2c20 6d79 7465 7874 2c20 6d79  s.\', mytext, my
-00010f30: 7661 6c29 3b27 202b 0a20 2020 2020 2020  val);' +.       
-00010f40: 2020 2020 2020 2020 2027 2020 2020 2020           '      
-00010f50: 2067 6574 436f 6e74 6578 7428 292e 6765   getContext().ge
-00010f60: 7452 6573 706f 6e73 6528 292e 7365 7442  tResponse().setB
-00010f70: 6f64 7928 5c27 5375 6363 6573 7321 5c27  ody(\'Success!\'
-00010f80: 293b 2720 2b0a 2020 2020 2020 2020 2020  );' +.          
-00010f90: 2020 2020 2020 2720 2020 7d27 202b 0a20        '   }' +. 
-00010fa0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00010fb0: 2020 2063 6174 6368 2028 6572 7229 207b     catch (err) {
-00010fc0: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
-00010fd0: 2020 2020 2720 2020 2020 2020 6765 7443      '       getC
-00010fe0: 6f6e 7465 7874 2829 2e67 6574 5265 7370  ontext().getResp
-00010ff0: 6f6e 7365 2829 2e73 6574 426f 6479 285c  onse().setBody(\
-00011000: 2769 6e6c 696e 6520 6572 723a 205b 5c27  'inline err: [\'
-00011010: 202b 2065 7272 2e6e 756d 6265 7220 2b20   + err.number + 
-00011020: 5c27 5d20 5c27 202b 2065 7272 293b 2720  \'] \' + err);' 
-00011030: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-00011040: 2020 2720 2020 7d27 0a20 2020 2020 2020    '   }'.       
-00011050: 2020 2020 2020 2020 2027 7d27 290a 2020           '}').  
-00011060: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-00011070: 2063 7265 6174 6564 5f73 7072 6f63 203d   created_sproc =
-00011080: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-00011090: 696f 6e2e 7363 7269 7074 732e 6372 6561  ion.scripts.crea
-000110a0: 7465 5f73 746f 7265 645f 7072 6f63 6564  te_stored_proced
-000110b0: 7572 6528 626f 6479 3d73 7072 6f63 290a  ure(body=sproc).
-000110c0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-000110d0: 3d20 6372 6561 7465 645f 636f 6c6c 6563  = created_collec
-000110e0: 7469 6f6e 2e73 6372 6970 7473 2e65 7865  tion.scripts.exe
-000110f0: 6375 7465 5f73 746f 7265 645f 7072 6f63  cute_stored_proc
-00011100: 6564 7572 6528 0a20 2020 2020 2020 2020  edure(.         
-00011110: 2020 2073 7072 6f63 3d63 7265 6174 6564     sproc=created
-00011120: 5f73 7072 6f63 5b27 6964 275d 2c0a 2020  _sproc['id'],.  
-00011130: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-00011140: 696f 6e5f 6b65 793d 310a 2020 2020 2020  ion_key=1.      
-00011150: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-00011160: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-00011170: 7375 6c74 2c20 2753 7563 6365 7373 2127  sult, 'Success!'
-00011180: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00011190: 7373 6572 7446 616c 7365 2848 7474 7048  ssertFalse(HttpH
-000111a0: 6561 6465 7273 2e53 6372 6970 744c 6f67  eaders.ScriptLog
-000111b0: 5265 7375 6c74 7320 696e 2063 7265 6174  Results in creat
-000111c0: 6564 5f63 6f6c 6c65 6374 696f 6e2e 7363  ed_collection.sc
-000111d0: 7269 7074 732e 636c 6965 6e74 5f63 6f6e  ripts.client_con
-000111e0: 6e65 6374 696f 6e2e 6c61 7374 5f72 6573  nection.last_res
-000111f0: 706f 6e73 655f 6865 6164 6572 7329 0a0a  ponse_headers)..
-00011200: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00011210: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-00011220: 696f 6e2e 7363 7269 7074 732e 6578 6563  ion.scripts.exec
-00011230: 7574 655f 7374 6f72 6564 5f70 726f 6365  ute_stored_proce
-00011240: 6475 7265 280a 2020 2020 2020 2020 2020  dure(.          
-00011250: 2020 7370 726f 633d 6372 6561 7465 645f    sproc=created_
-00011260: 7370 726f 635b 2769 6427 5d2c 0a20 2020  sproc['id'],.   
-00011270: 2020 2020 2020 2020 2065 6e61 626c 655f           enable_
-00011280: 7363 7269 7074 5f6c 6f67 6769 6e67 3d54  script_logging=T
-00011290: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-000112a0: 2070 6172 7469 7469 6f6e 5f6b 6579 3d31   partition_key=1
-000112b0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000112c0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000112d0: 7175 616c 2872 6573 756c 742c 2027 5375  qual(result, 'Su
-000112e0: 6363 6573 7321 2729 0a20 2020 2020 2020  ccess!').       
-000112f0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00011300: 6c28 7572 6c6c 6962 2e71 756f 7465 2827  l(urllib.quote('
-00011310: 5468 6520 7661 6c75 6520 6f66 2078 2069  The value of x i
-00011320: 7320 312e 2729 2c0a 2020 2020 2020 2020  s 1.'),.        
-00011330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011340: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-00011350: 696f 6e2e 7363 7269 7074 732e 636c 6965  ion.scripts.clie
-00011360: 6e74 5f63 6f6e 6e65 6374 696f 6e2e 6c61  nt_connection.la
-00011370: 7374 5f72 6573 706f 6e73 655f 6865 6164  st_response_head
-00011380: 6572 732e 6765 7428 4874 7470 4865 6164  ers.get(HttpHead
-00011390: 6572 732e 5363 7269 7074 4c6f 6752 6573  ers.ScriptLogRes
-000113a0: 756c 7473 2929 0a0a 2020 2020 2020 2020  ults))..        
-000113b0: 7265 7375 6c74 203d 2063 7265 6174 6564  result = created
-000113c0: 5f63 6f6c 6c65 6374 696f 6e2e 7363 7269  _collection.scri
-000113d0: 7074 732e 6578 6563 7574 655f 7374 6f72  pts.execute_stor
-000113e0: 6564 5f70 726f 6365 6475 7265 280a 2020  ed_procedure(.  
-000113f0: 2020 2020 2020 2020 2020 7370 726f 633d            sproc=
-00011400: 6372 6561 7465 645f 7370 726f 635b 2769  created_sproc['i
-00011410: 6427 5d2c 0a20 2020 2020 2020 2020 2020  d'],.           
-00011420: 2065 6e61 626c 655f 7363 7269 7074 5f6c   enable_script_l
-00011430: 6f67 6769 6e67 3d46 616c 7365 2c0a 2020  ogging=False,.  
-00011440: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-00011450: 696f 6e5f 6b65 793d 310a 2020 2020 2020  ion_key=1.      
-00011460: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-00011470: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-00011480: 7375 6c74 2c20 2753 7563 6365 7373 2127  sult, 'Success!'
-00011490: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000114a0: 7373 6572 7446 616c 7365 2848 7474 7048  ssertFalse(HttpH
-000114b0: 6561 6465 7273 2e53 6372 6970 744c 6f67  eaders.ScriptLog
-000114c0: 5265 7375 6c74 7320 696e 2063 7265 6174  Results in creat
-000114d0: 6564 5f63 6f6c 6c65 6374 696f 6e2e 7363  ed_collection.sc
-000114e0: 7269 7074 732e 636c 6965 6e74 5f63 6f6e  ripts.client_con
-000114f0: 6e65 6374 696f 6e2e 6c61 7374 5f72 6573  nection.last_res
-00011500: 706f 6e73 655f 6865 6164 6572 7329 0a0a  ponse_headers)..
-00011510: 2020 2020 6465 6620 7465 7374 5f63 6f6c      def test_col
-00011520: 6c65 6374 696f 6e5f 696e 6465 7869 6e67  lection_indexing
-00011530: 5f70 6f6c 6963 7928 7365 6c66 293a 0a20  _policy(self):. 
-00011540: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
-00011550: 6461 7461 6261 7365 0a20 2020 2020 2020  database.       
-00011560: 2064 6220 3d20 7365 6c66 2e64 6174 6162   db = self.datab
-00011570: 6173 6546 6f72 5465 7374 0a20 2020 2020  aseForTest.     
-00011580: 2020 2023 2063 7265 6174 6520 636f 6c6c     # create coll
-00011590: 6563 7469 6f6e 0a20 2020 2020 2020 2063  ection.        c
-000115a0: 6f6c 6c65 6374 696f 6e20 3d20 6462 2e63  ollection = db.c
-000115b0: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
-000115c0: 0a20 2020 2020 2020 2020 2020 2069 643d  .            id=
-000115d0: 2774 6573 745f 636f 6c6c 6563 7469 6f6e  'test_collection
-000115e0: 5f69 6e64 6578 696e 675f 706f 6c69 6379  _indexing_policy
-000115f0: 2064 6566 6175 6c74 2070 6f6c 6963 7927   default policy'
-00011600: 202b 2073 7472 2875 7569 642e 7575 6964   + str(uuid.uuid
-00011610: 3428 2929 2c0a 2020 2020 2020 2020 2020  4()),.          
-00011620: 2020 7061 7274 6974 696f 6e5f 6b65 793d    partition_key=
-00011630: 5061 7274 6974 696f 6e4b 6579 2870 6174  PartitionKey(pat
-00011640: 683d 272f 6964 272c 206b 696e 643d 2748  h='/id', kind='H
-00011650: 6173 6827 290a 2020 2020 2020 2020 290a  ash').        ).
-00011660: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
-00011670: 696f 6e5f 7072 6f70 6572 7469 6573 203d  ion_properties =
-00011680: 2063 6f6c 6c65 6374 696f 6e2e 7265 6164   collection.read
-00011690: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-000116a0: 6173 7365 7274 4571 7561 6c28 636f 6c6c  assertEqual(coll
-000116b0: 6563 7469 6f6e 5f70 726f 7065 7274 6965  ection_propertie
-000116c0: 735b 2769 6e64 6578 696e 6750 6f6c 6963  s['indexingPolic
-000116d0: 7927 5d5b 2769 6e64 6578 696e 674d 6f64  y']['indexingMod
-000116e0: 6527 5d2c 0a20 2020 2020 2020 2020 2020  e'],.           
-000116f0: 2020 2020 2020 2020 2020 2020 2020 646f                do
-00011700: 6375 6d65 6e74 732e 496e 6465 7869 6e67  cuments.Indexing
-00011710: 4d6f 6465 2e43 6f6e 7369 7374 656e 742c  Mode.Consistent,
-00011720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011730: 2020 2020 2020 2020 2020 2764 6566 6175            'defau
-00011740: 6c74 2069 6e64 6578 696e 6720 6d6f 6465  lt indexing mode
-00011750: 2073 686f 756c 6420 6265 2063 6f6e 7369   should be consi
-00011760: 7374 656e 7427 290a 0a20 2020 2020 2020  stent')..       
-00011770: 2064 622e 6465 6c65 7465 5f63 6f6e 7461   db.delete_conta
-00011780: 696e 6572 2863 6f6e 7461 696e 6572 3d63  iner(container=c
-00011790: 6f6c 6c65 6374 696f 6e29 0a0a 2020 2020  ollection)..    
-000117a0: 2020 2020 636f 6e73 6973 7465 6e74 5f63      consistent_c
-000117b0: 6f6c 6c65 6374 696f 6e20 3d20 6462 2e63  ollection = db.c
-000117c0: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
-000117d0: 0a20 2020 2020 2020 2020 2020 2069 643d  .            id=
-000117e0: 2774 6573 745f 636f 6c6c 6563 7469 6f6e  'test_collection
-000117f0: 5f69 6e64 6578 696e 675f 706f 6c69 6379  _indexing_policy
-00011800: 2063 6f6e 7369 7374 656e 7420 636f 6c6c   consistent coll
-00011810: 6563 7469 6f6e 2027 202b 2073 7472 2875  ection ' + str(u
-00011820: 7569 642e 7575 6964 3428 2929 2c0a 2020  uid.uuid4()),.  
-00011830: 2020 2020 2020 2020 2020 696e 6465 7869            indexi
-00011840: 6e67 5f70 6f6c 6963 793d 7b0a 2020 2020  ng_policy={.    
-00011850: 2020 2020 2020 2020 2020 2020 2769 6e64              'ind
-00011860: 6578 696e 674d 6f64 6527 3a20 646f 6375  exingMode': docu
-00011870: 6d65 6e74 732e 496e 6465 7869 6e67 4d6f  ments.IndexingMo
-00011880: 6465 2e43 6f6e 7369 7374 656e 740a 2020  de.Consistent.  
-00011890: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
-000118a0: 2020 2020 2020 2020 2070 6172 7469 7469           partiti
-000118b0: 6f6e 5f6b 6579 3d50 6172 7469 7469 6f6e  on_key=Partition
-000118c0: 4b65 7928 7061 7468 3d27 2f69 6427 2c20  Key(path='/id', 
-000118d0: 6b69 6e64 3d27 4861 7368 2729 0a20 2020  kind='Hash').   
-000118e0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-000118f0: 636f 6e73 6973 7465 6e74 5f63 6f6c 6c65  consistent_colle
-00011900: 6374 696f 6e5f 7072 6f70 6572 7469 6573  ction_properties
-00011910: 203d 2063 6f6e 7369 7374 656e 745f 636f   = consistent_co
-00011920: 6c6c 6563 7469 6f6e 2e72 6561 6428 290a  llection.read().
-00011930: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00011940: 6572 7445 7175 616c 2863 6f6e 7369 7374  ertEqual(consist
-00011950: 656e 745f 636f 6c6c 6563 7469 6f6e 5f70  ent_collection_p
-00011960: 726f 7065 7274 6965 735b 2769 6e64 6578  roperties['index
-00011970: 696e 6750 6f6c 6963 7927 5d5b 2769 6e64  ingPolicy']['ind
-00011980: 6578 696e 674d 6f64 6527 5d2c 0a20 2020  exingMode'],.   
-00011990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119a0: 2020 2020 2020 646f 6375 6d65 6e74 732e        documents.
-000119b0: 496e 6465 7869 6e67 4d6f 6465 2e43 6f6e  IndexingMode.Con
-000119c0: 7369 7374 656e 742c 0a20 2020 2020 2020  sistent,.       
-000119d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119e0: 2020 2769 6e64 6578 696e 6720 6d6f 6465    'indexing mode
-000119f0: 2073 686f 756c 6420 6265 2063 6f6e 7369   should be consi
-00011a00: 7374 656e 7427 290a 0a20 2020 2020 2020  stent')..       
-00011a10: 2064 622e 6465 6c65 7465 5f63 6f6e 7461   db.delete_conta
-00011a20: 696e 6572 2863 6f6e 7461 696e 6572 3d63  iner(container=c
-00011a30: 6f6e 7369 7374 656e 745f 636f 6c6c 6563  onsistent_collec
-00011a40: 7469 6f6e 290a 0a20 2020 2020 2020 2063  tion)..        c
-00011a50: 6f6c 6c65 6374 696f 6e5f 7769 7468 5f69  ollection_with_i
-00011a60: 6e64 6578 696e 675f 706f 6c69 6379 203d  ndexing_policy =
-00011a70: 2064 622e 6372 6561 7465 5f63 6f6e 7461   db.create_conta
-00011a80: 696e 6572 280a 2020 2020 2020 2020 2020  iner(.          
-00011a90: 2020 6964 3d27 436f 6c6c 6563 7469 6f6e    id='Collection
-00011aa0: 5769 7468 496e 6465 7869 6e67 506f 6c69  WithIndexingPoli
-00011ab0: 6379 2027 202b 2073 7472 2875 7569 642e  cy ' + str(uuid.
-00011ac0: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
-00011ad0: 2020 2020 2020 696e 6465 7869 6e67 5f70        indexing_p
-00011ae0: 6f6c 6963 793d 7b0a 2020 2020 2020 2020  olicy={.        
-00011af0: 2020 2020 2020 2020 2761 7574 6f6d 6174          'automat
-00011b00: 6963 273a 2054 7275 652c 0a20 2020 2020  ic': True,.     
-00011b10: 2020 2020 2020 2020 2020 2027 696e 6465             'inde
-00011b20: 7869 6e67 4d6f 6465 273a 2064 6f63 756d  xingMode': docum
-00011b30: 656e 7473 2e49 6e64 6578 696e 674d 6f64  ents.IndexingMod
-00011b40: 652e 436f 6e73 6973 7465 6e74 2c0a 2020  e.Consistent,.  
-00011b50: 2020 2020 2020 2020 2020 2020 2020 2769                'i
-00011b60: 6e63 6c75 6465 6450 6174 6873 273a 205b  ncludedPaths': [
-00011b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011b80: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-00011b90: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00011ba0: 7061 7468 273a 2027 2f27 2c0a 2020 2020  path': '/',.    
-00011bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011bc0: 2020 2020 2769 6e64 6578 6573 273a 205b      'indexes': [
-00011bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011be0: 2020 2020 2020 2020 2020 2020 207b 0a20               {. 
+00010d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d20: 2020 2020 7265 706c 6163 6564 5f73 7072      replaced_spr
+00010d30: 6f63 5b27 6964 275d 290a 0a20 2020 2064  oc['id'])..    d
+00010d40: 6566 2074 6573 745f 7363 7269 7074 5f6c  ef test_script_l
+00010d50: 6f67 6769 6e67 5f65 7865 6375 7465 5f73  ogging_execute_s
+00010d60: 746f 7265 645f 7072 6f63 6564 7572 6528  tored_procedure(
+00010d70: 7365 6c66 293a 0a20 2020 2020 2020 2063  self):.        c
+00010d80: 7265 6174 6564 5f64 6220 3d20 7365 6c66  reated_db = self
+00010d90: 2e64 6174 6162 6173 6546 6f72 5465 7374  .databaseForTest
+00010da0: 0a0a 2020 2020 2020 2020 6372 6561 7465  ..        create
+00010db0: 645f 636f 6c6c 6563 7469 6f6e 203d 2073  d_collection = s
+00010dc0: 656c 662e 636f 6e66 6967 732e 6372 6561  elf.configs.crea
+00010dd0: 7465 5f6d 756c 7469 5f70 6172 7469 7469  te_multi_partiti
+00010de0: 6f6e 5f63 6f6c 6c65 6374 696f 6e5f 6966  on_collection_if
+00010df0: 5f6e 6f74 5f65 7869 7374 2873 656c 662e  _not_exist(self.
+00010e00: 636c 6965 6e74 290a 0a20 2020 2020 2020  client)..       
+00010e10: 2073 7072 6f63 203d 207b 0a20 2020 2020   sproc = {.     
+00010e20: 2020 2020 2020 2027 6964 273a 2027 7374         'id': 'st
+00010e30: 6f72 6564 5072 6f63 6564 7572 6527 202b  oredProcedure' +
+00010e40: 2073 7472 2875 7569 642e 7575 6964 3428   str(uuid.uuid4(
+00010e50: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00010e60: 2762 6f64 7927 3a20 280a 2020 2020 2020  'body': (.      
+00010e70: 2020 2020 2020 2020 2020 2766 756e 6374            'funct
+00010e80: 696f 6e20 2829 207b 2720 2b0a 2020 2020  ion () {' +.    
+00010e90: 2020 2020 2020 2020 2020 2020 2720 2020              '   
+00010ea0: 7661 7220 6d79 7465 7874 203d 205c 2778  var mytext = \'x
+00010eb0: 5c27 3b27 202b 0a20 2020 2020 2020 2020  \';' +.         
+00010ec0: 2020 2020 2020 2027 2020 2076 6172 206d         '   var m
+00010ed0: 7976 616c 203d 2031 3b27 202b 0a20 2020  yval = 1;' +.   
+00010ee0: 2020 2020 2020 2020 2020 2020 2027 2020               '  
+00010ef0: 2074 7279 207b 2720 2b0a 2020 2020 2020   try {' +.      
+00010f00: 2020 2020 2020 2020 2020 2720 2020 2020            '     
+00010f10: 2020 636f 6e73 6f6c 652e 6c6f 6728 5c27    console.log(\'
+00010f20: 5468 6520 7661 6c75 6520 6f66 2025 7320  The value of %s 
+00010f30: 6973 2025 732e 5c27 2c20 6d79 7465 7874  is %s.\', mytext
+00010f40: 2c20 6d79 7661 6c29 3b27 202b 0a20 2020  , myval);' +.   
+00010f50: 2020 2020 2020 2020 2020 2020 2027 2020               '  
+00010f60: 2020 2020 2067 6574 436f 6e74 6578 7428       getContext(
+00010f70: 292e 6765 7452 6573 706f 6e73 6528 292e  ).getResponse().
+00010f80: 7365 7442 6f64 7928 5c27 5375 6363 6573  setBody(\'Succes
+00010f90: 7321 5c27 293b 2720 2b0a 2020 2020 2020  s!\');' +.      
+00010fa0: 2020 2020 2020 2020 2020 2720 2020 7d27            '   }'
+00010fb0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+00010fc0: 2020 2027 2020 2063 6174 6368 2028 6572     '   catch (er
+00010fd0: 7229 207b 2720 2b0a 2020 2020 2020 2020  r) {' +.        
+00010fe0: 2020 2020 2020 2020 2720 2020 2020 2020          '       
+00010ff0: 6765 7443 6f6e 7465 7874 2829 2e67 6574  getContext().get
+00011000: 5265 7370 6f6e 7365 2829 2e73 6574 426f  Response().setBo
+00011010: 6479 285c 2769 6e6c 696e 6520 6572 723a  dy(\'inline err:
+00011020: 205b 5c27 202b 2065 7272 2e6e 756d 6265   [\' + err.numbe
+00011030: 7220 2b20 5c27 5d20 5c27 202b 2065 7272  r + \'] \' + err
+00011040: 293b 2720 2b0a 2020 2020 2020 2020 2020  );' +.          
+00011050: 2020 2020 2020 2720 2020 7d27 0a20 2020        '   }'.   
+00011060: 2020 2020 2020 2020 2020 2020 2027 7d27               '}'
+00011070: 290a 2020 2020 2020 2020 7d0a 0a20 2020  ).        }..   
+00011080: 2020 2020 2063 7265 6174 6564 5f73 7072       created_spr
+00011090: 6f63 203d 2063 7265 6174 6564 5f63 6f6c  oc = created_col
+000110a0: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
+000110b0: 6372 6561 7465 5f73 746f 7265 645f 7072  create_stored_pr
+000110c0: 6f63 6564 7572 6528 626f 6479 3d73 7072  ocedure(body=spr
+000110d0: 6f63 290a 0a20 2020 2020 2020 2072 6573  oc)..        res
+000110e0: 756c 7420 3d20 6372 6561 7465 645f 636f  ult = created_co
+000110f0: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
+00011100: 2e65 7865 6375 7465 5f73 746f 7265 645f  .execute_stored_
+00011110: 7072 6f63 6564 7572 6528 0a20 2020 2020  procedure(.     
+00011120: 2020 2020 2020 2073 7072 6f63 3d63 7265         sproc=cre
+00011130: 6174 6564 5f73 7072 6f63 5b27 6964 275d  ated_sproc['id']
+00011140: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+00011150: 7274 6974 696f 6e5f 6b65 793d 310a 2020  rtition_key=1.  
+00011160: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00011170: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00011180: 6c28 7265 7375 6c74 2c20 2753 7563 6365  l(result, 'Succe
+00011190: 7373 2127 290a 2020 2020 2020 2020 7365  ss!').        se
+000111a0: 6c66 2e61 7373 6572 7446 616c 7365 2848  lf.assertFalse(H
+000111b0: 7474 7048 6561 6465 7273 2e53 6372 6970  ttpHeaders.Scrip
+000111c0: 744c 6f67 5265 7375 6c74 7320 696e 2063  tLogResults in c
+000111d0: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
+000111e0: 6e2e 7363 7269 7074 732e 636c 6965 6e74  n.scripts.client
+000111f0: 5f63 6f6e 6e65 6374 696f 6e2e 6c61 7374  _connection.last
+00011200: 5f72 6573 706f 6e73 655f 6865 6164 6572  _response_header
+00011210: 7329 0a0a 2020 2020 2020 2020 7265 7375  s)..        resu
+00011220: 6c74 203d 2063 7265 6174 6564 5f63 6f6c  lt = created_col
+00011230: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
+00011240: 6578 6563 7574 655f 7374 6f72 6564 5f70  execute_stored_p
+00011250: 726f 6365 6475 7265 280a 2020 2020 2020  rocedure(.      
+00011260: 2020 2020 2020 7370 726f 633d 6372 6561        sproc=crea
+00011270: 7465 645f 7370 726f 635b 2769 6427 5d2c  ted_sproc['id'],
+00011280: 0a20 2020 2020 2020 2020 2020 2065 6e61  .            ena
+00011290: 626c 655f 7363 7269 7074 5f6c 6f67 6769  ble_script_loggi
+000112a0: 6e67 3d54 7275 652c 0a20 2020 2020 2020  ng=True,.       
+000112b0: 2020 2020 2070 6172 7469 7469 6f6e 5f6b       partition_k
+000112c0: 6579 3d31 0a20 2020 2020 2020 2029 0a0a  ey=1.        )..
+000112d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000112e0: 6572 7445 7175 616c 2872 6573 756c 742c  ertEqual(result,
+000112f0: 2027 5375 6363 6573 7321 2729 0a20 2020   'Success!').   
+00011300: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00011310: 4571 7561 6c28 7572 6c6c 6962 2e71 756f  Equal(urllib.quo
+00011320: 7465 2827 5468 6520 7661 6c75 6520 6f66  te('The value of
+00011330: 2078 2069 7320 312e 2729 2c0a 2020 2020   x is 1.'),.    
+00011340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011350: 2020 2020 2063 7265 6174 6564 5f63 6f6c       created_col
+00011360: 6c65 6374 696f 6e2e 7363 7269 7074 732e  lection.scripts.
+00011370: 636c 6965 6e74 5f63 6f6e 6e65 6374 696f  client_connectio
+00011380: 6e2e 6c61 7374 5f72 6573 706f 6e73 655f  n.last_response_
+00011390: 6865 6164 6572 732e 6765 7428 4874 7470  headers.get(Http
+000113a0: 4865 6164 6572 732e 5363 7269 7074 4c6f  Headers.ScriptLo
+000113b0: 6752 6573 756c 7473 2929 0a0a 2020 2020  gResults))..    
+000113c0: 2020 2020 7265 7375 6c74 203d 2063 7265      result = cre
+000113d0: 6174 6564 5f63 6f6c 6c65 6374 696f 6e2e  ated_collection.
+000113e0: 7363 7269 7074 732e 6578 6563 7574 655f  scripts.execute_
+000113f0: 7374 6f72 6564 5f70 726f 6365 6475 7265  stored_procedure
+00011400: 280a 2020 2020 2020 2020 2020 2020 7370  (.            sp
+00011410: 726f 633d 6372 6561 7465 645f 7370 726f  roc=created_spro
+00011420: 635b 2769 6427 5d2c 0a20 2020 2020 2020  c['id'],.       
+00011430: 2020 2020 2065 6e61 626c 655f 7363 7269       enable_scri
+00011440: 7074 5f6c 6f67 6769 6e67 3d46 616c 7365  pt_logging=False
+00011450: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+00011460: 7274 6974 696f 6e5f 6b65 793d 310a 2020  rtition_key=1.  
+00011470: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00011480: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00011490: 6c28 7265 7375 6c74 2c20 2753 7563 6365  l(result, 'Succe
+000114a0: 7373 2127 290a 2020 2020 2020 2020 7365  ss!').        se
+000114b0: 6c66 2e61 7373 6572 7446 616c 7365 2848  lf.assertFalse(H
+000114c0: 7474 7048 6561 6465 7273 2e53 6372 6970  ttpHeaders.Scrip
+000114d0: 744c 6f67 5265 7375 6c74 7320 696e 2063  tLogResults in c
+000114e0: 7265 6174 6564 5f63 6f6c 6c65 6374 696f  reated_collectio
+000114f0: 6e2e 7363 7269 7074 732e 636c 6965 6e74  n.scripts.client
+00011500: 5f63 6f6e 6e65 6374 696f 6e2e 6c61 7374  _connection.last
+00011510: 5f72 6573 706f 6e73 655f 6865 6164 6572  _response_header
+00011520: 7329 0a0a 2020 2020 6465 6620 7465 7374  s)..    def test
+00011530: 5f63 6f6c 6c65 6374 696f 6e5f 696e 6465  _collection_inde
+00011540: 7869 6e67 5f70 6f6c 6963 7928 7365 6c66  xing_policy(self
+00011550: 293a 0a20 2020 2020 2020 2023 2063 7265  ):.        # cre
+00011560: 6174 6520 6461 7461 6261 7365 0a20 2020  ate database.   
+00011570: 2020 2020 2064 6220 3d20 7365 6c66 2e64       db = self.d
+00011580: 6174 6162 6173 6546 6f72 5465 7374 0a20  atabaseForTest. 
+00011590: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+000115a0: 636f 6c6c 6563 7469 6f6e 0a20 2020 2020  collection.     
+000115b0: 2020 2063 6f6c 6c65 6374 696f 6e20 3d20     collection = 
+000115c0: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
+000115d0: 6e65 7228 0a20 2020 2020 2020 2020 2020  ner(.           
+000115e0: 2069 643d 2774 6573 745f 636f 6c6c 6563   id='test_collec
+000115f0: 7469 6f6e 5f69 6e64 6578 696e 675f 706f  tion_indexing_po
+00011600: 6c69 6379 2064 6566 6175 6c74 2070 6f6c  licy default pol
+00011610: 6963 7927 202b 2073 7472 2875 7569 642e  icy' + str(uuid.
+00011620: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
+00011630: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+00011640: 6b65 793d 5061 7274 6974 696f 6e4b 6579  key=PartitionKey
+00011650: 2870 6174 683d 272f 6964 272c 206b 696e  (path='/id', kin
+00011660: 643d 2748 6173 6827 290a 2020 2020 2020  d='Hash').      
+00011670: 2020 290a 0a20 2020 2020 2020 2063 6f6c    )..        col
+00011680: 6c65 6374 696f 6e5f 7072 6f70 6572 7469  lection_properti
+00011690: 6573 203d 2063 6f6c 6c65 6374 696f 6e2e  es = collection.
+000116a0: 7265 6164 2829 0a20 2020 2020 2020 2073  read().        s
+000116b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000116c0: 636f 6c6c 6563 7469 6f6e 5f70 726f 7065  collection_prope
+000116d0: 7274 6965 735b 2769 6e64 6578 696e 6750  rties['indexingP
+000116e0: 6f6c 6963 7927 5d5b 2769 6e64 6578 696e  olicy']['indexin
+000116f0: 674d 6f64 6527 5d2c 0a20 2020 2020 2020  gMode'],.       
+00011700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011710: 2020 646f 6375 6d65 6e74 732e 496e 6465    documents.Inde
+00011720: 7869 6e67 4d6f 6465 2e43 6f6e 7369 7374  xingMode.Consist
+00011730: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
+00011740: 2020 2020 2020 2020 2020 2020 2020 2764                'd
+00011750: 6566 6175 6c74 2069 6e64 6578 696e 6720  efault indexing 
+00011760: 6d6f 6465 2073 686f 756c 6420 6265 2063  mode should be c
+00011770: 6f6e 7369 7374 656e 7427 290a 0a20 2020  onsistent')..   
+00011780: 2020 2020 2064 622e 6465 6c65 7465 5f63       db.delete_c
+00011790: 6f6e 7461 696e 6572 2863 6f6e 7461 696e  ontainer(contain
+000117a0: 6572 3d63 6f6c 6c65 6374 696f 6e29 0a0a  er=collection)..
+000117b0: 2020 2020 2020 2020 636f 6e73 6973 7465          consiste
+000117c0: 6e74 5f63 6f6c 6c65 6374 696f 6e20 3d20  nt_collection = 
+000117d0: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
+000117e0: 6e65 7228 0a20 2020 2020 2020 2020 2020  ner(.           
+000117f0: 2069 643d 2774 6573 745f 636f 6c6c 6563   id='test_collec
+00011800: 7469 6f6e 5f69 6e64 6578 696e 675f 706f  tion_indexing_po
+00011810: 6c69 6379 2063 6f6e 7369 7374 656e 7420  licy consistent 
+00011820: 636f 6c6c 6563 7469 6f6e 2027 202b 2073  collection ' + s
+00011830: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
+00011840: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
+00011850: 6465 7869 6e67 5f70 6f6c 6963 793d 7b0a  dexing_policy={.
+00011860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011870: 2769 6e64 6578 696e 674d 6f64 6527 3a20  'indexingMode': 
+00011880: 646f 6375 6d65 6e74 732e 496e 6465 7869  documents.Indexi
+00011890: 6e67 4d6f 6465 2e43 6f6e 7369 7374 656e  ngMode.Consisten
+000118a0: 740a 2020 2020 2020 2020 2020 2020 7d2c  t.            },
+000118b0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+000118c0: 7469 7469 6f6e 5f6b 6579 3d50 6172 7469  tition_key=Parti
+000118d0: 7469 6f6e 4b65 7928 7061 7468 3d27 2f69  tionKey(path='/i
+000118e0: 6427 2c20 6b69 6e64 3d27 4861 7368 2729  d', kind='Hash')
+000118f0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00011900: 2020 2020 636f 6e73 6973 7465 6e74 5f63      consistent_c
+00011910: 6f6c 6c65 6374 696f 6e5f 7072 6f70 6572  ollection_proper
+00011920: 7469 6573 203d 2063 6f6e 7369 7374 656e  ties = consisten
+00011930: 745f 636f 6c6c 6563 7469 6f6e 2e72 6561  t_collection.rea
+00011940: 6428 290a 2020 2020 2020 2020 7365 6c66  d().        self
+00011950: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
+00011960: 7369 7374 656e 745f 636f 6c6c 6563 7469  sistent_collecti
+00011970: 6f6e 5f70 726f 7065 7274 6965 735b 2769  on_properties['i
+00011980: 6e64 6578 696e 6750 6f6c 6963 7927 5d5b  ndexingPolicy'][
+00011990: 2769 6e64 6578 696e 674d 6f64 6527 5d2c  'indexingMode'],
+000119a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000119b0: 2020 2020 2020 2020 2020 646f 6375 6d65            docume
+000119c0: 6e74 732e 496e 6465 7869 6e67 4d6f 6465  nts.IndexingMode
+000119d0: 2e43 6f6e 7369 7374 656e 742c 0a20 2020  .Consistent,.   
+000119e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119f0: 2020 2020 2020 2769 6e64 6578 696e 6720        'indexing 
+00011a00: 6d6f 6465 2073 686f 756c 6420 6265 2063  mode should be c
+00011a10: 6f6e 7369 7374 656e 7427 290a 0a20 2020  onsistent')..   
+00011a20: 2020 2020 2064 622e 6465 6c65 7465 5f63       db.delete_c
+00011a30: 6f6e 7461 696e 6572 2863 6f6e 7461 696e  ontainer(contain
+00011a40: 6572 3d63 6f6e 7369 7374 656e 745f 636f  er=consistent_co
+00011a50: 6c6c 6563 7469 6f6e 290a 0a20 2020 2020  llection)..     
+00011a60: 2020 2063 6f6c 6c65 6374 696f 6e5f 7769     collection_wi
+00011a70: 7468 5f69 6e64 6578 696e 675f 706f 6c69  th_indexing_poli
+00011a80: 6379 203d 2064 622e 6372 6561 7465 5f63  cy = db.create_c
+00011a90: 6f6e 7461 696e 6572 280a 2020 2020 2020  ontainer(.      
+00011aa0: 2020 2020 2020 6964 3d27 436f 6c6c 6563        id='Collec
+00011ab0: 7469 6f6e 5769 7468 496e 6465 7869 6e67  tionWithIndexing
+00011ac0: 506f 6c69 6379 2027 202b 2073 7472 2875  Policy ' + str(u
+00011ad0: 7569 642e 7575 6964 3428 2929 2c0a 2020  uid.uuid4()),.  
+00011ae0: 2020 2020 2020 2020 2020 696e 6465 7869            indexi
+00011af0: 6e67 5f70 6f6c 6963 793d 7b0a 2020 2020  ng_policy={.    
+00011b00: 2020 2020 2020 2020 2020 2020 2761 7574              'aut
+00011b10: 6f6d 6174 6963 273a 2054 7275 652c 0a20  omatic': True,. 
+00011b20: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00011b30: 696e 6465 7869 6e67 4d6f 6465 273a 2064  indexingMode': d
+00011b40: 6f63 756d 656e 7473 2e49 6e64 6578 696e  ocuments.Indexin
+00011b50: 674d 6f64 652e 436f 6e73 6973 7465 6e74  gMode.Consistent
+00011b60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00011b70: 2020 2769 6e63 6c75 6465 6450 6174 6873    'includedPaths
+00011b80: 273a 205b 0a20 2020 2020 2020 2020 2020  ': [.           
+00011b90: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
+00011ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bb0: 2020 2027 7061 7468 273a 2027 2f27 2c0a     'path': '/',.
+00011bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bd0: 2020 2020 2020 2020 2769 6e64 6578 6573          'indexes
+00011be0: 273a 205b 0a20 2020 2020 2020 2020 2020  ': [.           
 00011bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c00: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00011c10: 6b69 6e64 273a 2064 6f63 756d 656e 7473  kind': documents
-00011c20: 2e49 6e64 6578 4b69 6e64 2e48 6173 682c  .IndexKind.Hash,
-00011c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c50: 2027 6461 7461 5479 7065 273a 2064 6f63   'dataType': doc
-00011c60: 756d 656e 7473 2e44 6174 6154 7970 652e  uments.DataType.
-00011c70: 4e75 6d62 6572 2c0a 2020 2020 2020 2020  Number,.        
-00011c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c90: 2020 2020 2020 2020 2770 7265 6369 7369          'precisi
-00011ca0: 6f6e 273a 2032 0a20 2020 2020 2020 2020  on': 2.         
-00011cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cc0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00011cd0: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
+00011c00: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00011c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c20: 2020 2027 6b69 6e64 273a 2064 6f63 756d     'kind': docum
+00011c30: 656e 7473 2e49 6e64 6578 4b69 6e64 2e48  ents.IndexKind.H
+00011c40: 6173 682c 0a20 2020 2020 2020 2020 2020  ash,.           
+00011c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c60: 2020 2020 2027 6461 7461 5479 7065 273a       'dataType':
+00011c70: 2064 6f63 756d 656e 7473 2e44 6174 6154   documents.DataT
+00011c80: 7970 652e 4e75 6d62 6572 2c0a 2020 2020  ype.Number,.    
+00011c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ca0: 2020 2020 2020 2020 2020 2020 2770 7265              'pre
+00011cb0: 6369 7369 6f6e 273a 2032 0a20 2020 2020  cision': 2.     
+00011cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011cd0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
 00011ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cf0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00011d00: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
-00011d10: 2020 2020 2020 2020 2765 7863 6c75 6465          'exclude
-00011d20: 6450 6174 6873 273a 205b 0a20 2020 2020  dPaths': [.     
-00011d30: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-00011d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011d50: 2020 2020 2020 2020 2027 7061 7468 273a           'path':
-00011d60: 2027 2f22 7379 7374 656d 4d65 7461 6461   '/"systemMetada
-00011d70: 7461 222f 2a27 0a20 2020 2020 2020 2020  ta"/*'.         
-00011d80: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-00011d90: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
-00011da0: 2020 2020 2020 2020 2020 207d 2c0a 2020             },.  
-00011db0: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-00011dc0: 696f 6e5f 6b65 793d 5061 7274 6974 696f  ion_key=Partitio
-00011dd0: 6e4b 6579 2870 6174 683d 272f 6964 272c  nKey(path='/id',
-00011de0: 206b 696e 643d 2748 6173 6827 290a 2020   kind='Hash').  
-00011df0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00011e00: 2063 6f6c 6c65 6374 696f 6e5f 7769 7468   collection_with
-00011e10: 5f69 6e64 6578 696e 675f 706f 6c69 6379  _indexing_policy
-00011e20: 5f70 726f 7065 7274 6965 7320 3d20 636f  _properties = co
-00011e30: 6c6c 6563 7469 6f6e 5f77 6974 685f 696e  llection_with_in
-00011e40: 6465 7869 6e67 5f70 6f6c 6963 792e 7265  dexing_policy.re
-00011e50: 6164 2829 0a20 2020 2020 2020 2073 656c  ad().        sel
-00011e60: 662e 6173 7365 7274 4571 7561 6c28 312c  f.assertEqual(1,
-00011e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011e80: 2020 2020 2020 2020 2020 6c65 6e28 636f            len(co
-00011e90: 6c6c 6563 7469 6f6e 5f77 6974 685f 696e  llection_with_in
-00011ea0: 6465 7869 6e67 5f70 6f6c 6963 795f 7072  dexing_policy_pr
-00011eb0: 6f70 6572 7469 6573 5b27 696e 6465 7869  operties['indexi
-00011ec0: 6e67 506f 6c69 6379 275d 5b27 696e 636c  ngPolicy']['incl
-00011ed0: 7564 6564 5061 7468 7327 5d29 2c0a 2020  udedPaths']),.  
-00011ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ef0: 2020 2020 2020 2027 556e 6578 7065 6374         'Unexpect
-00011f00: 6564 2069 6e63 6c75 6465 6450 6174 6873  ed includedPaths
-00011f10: 206c 656e 6774 6827 290a 2020 2020 2020   length').      
-00011f20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00011f30: 616c 2832 2c0a 2020 2020 2020 2020 2020  al(2,.          
-00011f40: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00011f50: 656e 2863 6f6c 6c65 6374 696f 6e5f 7769  en(collection_wi
-00011f60: 7468 5f69 6e64 6578 696e 675f 706f 6c69  th_indexing_poli
-00011f70: 6379 5f70 726f 7065 7274 6965 735b 2769  cy_properties['i
-00011f80: 6e64 6578 696e 6750 6f6c 6963 7927 5d5b  ndexingPolicy'][
-00011f90: 2765 7863 6c75 6465 6450 6174 6873 275d  'excludedPaths']
-00011fa0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00011fb0: 2020 2020 2020 2020 2020 2020 2755 6e65              'Une
-00011fc0: 7870 6563 7465 6420 6578 636c 7564 6564  xpected excluded
-00011fd0: 2070 6174 6820 636f 756e 7427 290a 2020   path count').  
-00011fe0: 2020 2020 2020 6462 2e64 656c 6574 655f        db.delete_
-00011ff0: 636f 6e74 6169 6e65 7228 636f 6e74 6169  container(contai
-00012000: 6e65 723d 636f 6c6c 6563 7469 6f6e 5f77  ner=collection_w
-00012010: 6974 685f 696e 6465 7869 6e67 5f70 6f6c  ith_indexing_pol
-00012020: 6963 7929 0a0a 2020 2020 6465 6620 7465  icy)..    def te
-00012030: 7374 5f63 7265 6174 655f 6465 6661 756c  st_create_defaul
-00012040: 745f 696e 6465 7869 6e67 5f70 6f6c 6963  t_indexing_polic
-00012050: 7928 7365 6c66 293a 0a20 2020 2020 2020  y(self):.       
-00012060: 2023 2063 7265 6174 6520 6461 7461 6261   # create databa
-00012070: 7365 0a20 2020 2020 2020 2064 6220 3d20  se.        db = 
-00012080: 7365 6c66 2e64 6174 6162 6173 6546 6f72  self.databaseFor
-00012090: 5465 7374 0a0a 2020 2020 2020 2020 2320  Test..        # 
-000120a0: 6e6f 2069 6e64 6578 696e 6720 706f 6c69  no indexing poli
-000120b0: 6379 2073 7065 6369 6669 6564 0a20 2020  cy specified.   
-000120c0: 2020 2020 2063 6f6c 6c65 6374 696f 6e20       collection 
-000120d0: 3d20 6462 2e63 7265 6174 655f 636f 6e74  = db.create_cont
-000120e0: 6169 6e65 7228 0a20 2020 2020 2020 2020  ainer(.         
-000120f0: 2020 2069 643d 2774 6573 745f 6372 6561     id='test_crea
-00012100: 7465 5f64 6566 6175 6c74 5f69 6e64 6578  te_default_index
-00012110: 696e 675f 706f 6c69 6379 2054 6573 7443  ing_policy TestC
-00012120: 7265 6174 6544 6566 6175 6c74 506f 6c69  reateDefaultPoli
-00012130: 6379 3031 2720 2b20 7374 7228 7575 6964  cy01' + str(uuid
-00012140: 2e75 7569 6434 2829 292c 0a20 2020 2020  .uuid4()),.     
-00012150: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
-00012160: 5f6b 6579 3d50 6172 7469 7469 6f6e 4b65  _key=PartitionKe
-00012170: 7928 7061 7468 3d27 2f69 6427 2c20 6b69  y(path='/id', ki
-00012180: 6e64 3d27 4861 7368 2729 0a20 2020 2020  nd='Hash').     
-00012190: 2020 2029 0a20 2020 2020 2020 2063 6f6c     ).        col
-000121a0: 6c65 6374 696f 6e5f 7072 6f70 6572 7469  lection_properti
-000121b0: 6573 203d 2063 6f6c 6c65 6374 696f 6e2e  es = collection.
-000121c0: 7265 6164 2829 0a20 2020 2020 2020 2073  read().        s
-000121d0: 656c 662e 5f63 6865 636b 5f64 6566 6175  elf._check_defau
-000121e0: 6c74 5f69 6e64 6578 696e 675f 706f 6c69  lt_indexing_poli
-000121f0: 6379 5f70 6174 6873 2863 6f6c 6c65 6374  cy_paths(collect
-00012200: 696f 6e5f 7072 6f70 6572 7469 6573 5b27  ion_properties['
-00012210: 696e 6465 7869 6e67 506f 6c69 6379 275d  indexingPolicy']
-00012220: 290a 2020 2020 2020 2020 6462 2e64 656c  ).        db.del
-00012230: 6574 655f 636f 6e74 6169 6e65 7228 636f  ete_container(co
-00012240: 6e74 6169 6e65 723d 636f 6c6c 6563 7469  ntainer=collecti
-00012250: 6f6e 290a 0a20 2020 2020 2020 2023 2070  on)..        # p
-00012260: 6172 7469 616c 2070 6f6c 6963 7920 7370  artial policy sp
-00012270: 6563 6966 6965 640a 2020 2020 2020 2020  ecified.        
-00012280: 636f 6c6c 6563 7469 6f6e 203d 2064 622e  collection = db.
-00012290: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
-000122a0: 280a 2020 2020 2020 2020 2020 2020 6964  (.            id
-000122b0: 3d27 7465 7374 5f63 7265 6174 655f 6465  ='test_create_de
-000122c0: 6661 756c 745f 696e 6465 7869 6e67 5f70  fault_indexing_p
-000122d0: 6f6c 6963 7920 5465 7374 4372 6561 7465  olicy TestCreate
-000122e0: 4465 6661 756c 7450 6f6c 6963 7930 3127  DefaultPolicy01'
-000122f0: 202b 2073 7472 2875 7569 642e 7575 6964   + str(uuid.uuid
-00012300: 3428 2929 2c0a 2020 2020 2020 2020 2020  4()),.          
-00012310: 2020 696e 6465 7869 6e67 5f70 6f6c 6963    indexing_polic
-00012320: 793d 7b0a 2020 2020 2020 2020 2020 2020  y={.            
-00012330: 2020 2020 2020 2020 2769 6e64 6578 696e          'indexin
-00012340: 674d 6f64 6527 3a20 646f 6375 6d65 6e74  gMode': document
-00012350: 732e 496e 6465 7869 6e67 4d6f 6465 2e43  s.IndexingMode.C
-00012360: 6f6e 7369 7374 656e 742c 2027 6175 746f  onsistent, 'auto
-00012370: 6d61 7469 6327 3a20 5472 7565 0a20 2020  matic': True.   
-00012380: 2020 2020 2020 2020 2020 2020 207d 2c0a               },.
-00012390: 2020 2020 2020 2020 2020 2020 7061 7274              part
-000123a0: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
-000123b0: 696f 6e4b 6579 2870 6174 683d 272f 6964  ionKey(path='/id
-000123c0: 272c 206b 696e 643d 2748 6173 6827 290a  ', kind='Hash').
-000123d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000123e0: 2020 636f 6c6c 6563 7469 6f6e 5f70 726f    collection_pro
-000123f0: 7065 7274 6965 7320 3d20 636f 6c6c 6563  perties = collec
-00012400: 7469 6f6e 2e72 6561 6428 290a 2020 2020  tion.read().    
-00012410: 2020 2020 7365 6c66 2e5f 6368 6563 6b5f      self._check_
-00012420: 6465 6661 756c 745f 696e 6465 7869 6e67  default_indexing
-00012430: 5f70 6f6c 6963 795f 7061 7468 7328 636f  _policy_paths(co
-00012440: 6c6c 6563 7469 6f6e 5f70 726f 7065 7274  llection_propert
-00012450: 6965 735b 2769 6e64 6578 696e 6750 6f6c  ies['indexingPol
-00012460: 6963 7927 5d29 0a20 2020 2020 2020 2064  icy']).        d
-00012470: 622e 6465 6c65 7465 5f63 6f6e 7461 696e  b.delete_contain
-00012480: 6572 2863 6f6e 7461 696e 6572 3d63 6f6c  er(container=col
-00012490: 6c65 6374 696f 6e29 0a0a 2020 2020 2020  lection)..      
-000124a0: 2020 2320 6465 6661 756c 7420 706f 6c69    # default poli
-000124b0: 6379 0a20 2020 2020 2020 2063 6f6c 6c65  cy.        colle
-000124c0: 6374 696f 6e20 3d20 6462 2e63 7265 6174  ction = db.creat
-000124d0: 655f 636f 6e74 6169 6e65 7228 0a20 2020  e_container(.   
-000124e0: 2020 2020 2020 2020 2069 643d 2774 6573           id='tes
-000124f0: 745f 6372 6561 7465 5f64 6566 6175 6c74  t_create_default
-00012500: 5f69 6e64 6578 696e 675f 706f 6c69 6379  _indexing_policy
-00012510: 2054 6573 7443 7265 6174 6544 6566 6175   TestCreateDefau
-00012520: 6c74 506f 6c69 6379 3033 2720 2b20 7374  ltPolicy03' + st
-00012530: 7228 7575 6964 2e75 7569 6434 2829 292c  r(uuid.uuid4()),
-00012540: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-00012550: 6578 696e 675f 706f 6c69 6379 3d7b 7d2c  exing_policy={},
-00012560: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-00012570: 7469 7469 6f6e 5f6b 6579 3d50 6172 7469  tition_key=Parti
-00012580: 7469 6f6e 4b65 7928 7061 7468 3d27 2f69  tionKey(path='/i
-00012590: 6427 2c20 6b69 6e64 3d27 4861 7368 2729  d', kind='Hash')
-000125a0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000125b0: 2020 2063 6f6c 6c65 6374 696f 6e5f 7072     collection_pr
-000125c0: 6f70 6572 7469 6573 203d 2063 6f6c 6c65  operties = colle
-000125d0: 6374 696f 6e2e 7265 6164 2829 0a20 2020  ction.read().   
-000125e0: 2020 2020 2073 656c 662e 5f63 6865 636b       self._check
-000125f0: 5f64 6566 6175 6c74 5f69 6e64 6578 696e  _default_indexin
-00012600: 675f 706f 6c69 6379 5f70 6174 6873 2863  g_policy_paths(c
-00012610: 6f6c 6c65 6374 696f 6e5f 7072 6f70 6572  ollection_proper
-00012620: 7469 6573 5b27 696e 6465 7869 6e67 506f  ties['indexingPo
-00012630: 6c69 6379 275d 290a 2020 2020 2020 2020  licy']).        
-00012640: 6462 2e64 656c 6574 655f 636f 6e74 6169  db.delete_contai
-00012650: 6e65 7228 636f 6e74 6169 6e65 723d 636f  ner(container=co
-00012660: 6c6c 6563 7469 6f6e 290a 0a20 2020 2020  llection)..     
-00012670: 2020 2023 206d 6973 7369 6e67 2069 6e64     # missing ind
-00012680: 6578 6573 0a20 2020 2020 2020 2063 6f6c  exes.        col
-00012690: 6c65 6374 696f 6e20 3d20 6462 2e63 7265  lection = db.cre
-000126a0: 6174 655f 636f 6e74 6169 6e65 7228 0a20  ate_container(. 
-000126b0: 2020 2020 2020 2020 2020 2069 643d 2774             id='t
-000126c0: 6573 745f 6372 6561 7465 5f64 6566 6175  est_create_defau
-000126d0: 6c74 5f69 6e64 6578 696e 675f 706f 6c69  lt_indexing_poli
-000126e0: 6379 2054 6573 7443 7265 6174 6544 6566  cy TestCreateDef
-000126f0: 6175 6c74 506f 6c69 6379 3034 2720 2b20  aultPolicy04' + 
-00012700: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
-00012710: 292c 0a20 2020 2020 2020 2020 2020 2069  ),.            i
-00012720: 6e64 6578 696e 675f 706f 6c69 6379 3d7b  ndexing_policy={
-00012730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012740: 2020 2020 2027 696e 636c 7564 6564 5061       'includedPa
-00012750: 7468 7327 3a20 5b0a 2020 2020 2020 2020  ths': [.        
-00012760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012770: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00012780: 2020 2020 2020 2020 2020 2020 2020 2770                'p
-00012790: 6174 6827 3a20 272f 2a27 0a20 2020 2020  ath': '/*'.     
-000127a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127b0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-000127c0: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-000127d0: 2020 2020 2020 2020 2020 207d 2c0a 2020             },.  
-000127e0: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-000127f0: 696f 6e5f 6b65 793d 5061 7274 6974 696f  ion_key=Partitio
-00012800: 6e4b 6579 2870 6174 683d 272f 6964 272c  nKey(path='/id',
-00012810: 206b 696e 643d 2748 6173 6827 290a 2020   kind='Hash').  
-00012820: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00012830: 636f 6c6c 6563 7469 6f6e 5f70 726f 7065  collection_prope
-00012840: 7274 6965 7320 3d20 636f 6c6c 6563 7469  rties = collecti
-00012850: 6f6e 2e72 6561 6428 290a 2020 2020 2020  on.read().      
-00012860: 2020 7365 6c66 2e5f 6368 6563 6b5f 6465    self._check_de
-00012870: 6661 756c 745f 696e 6465 7869 6e67 5f70  fault_indexing_p
-00012880: 6f6c 6963 795f 7061 7468 7328 636f 6c6c  olicy_paths(coll
-00012890: 6563 7469 6f6e 5f70 726f 7065 7274 6965  ection_propertie
-000128a0: 735b 2769 6e64 6578 696e 6750 6f6c 6963  s['indexingPolic
-000128b0: 7927 5d29 0a20 2020 2020 2020 2064 622e  y']).        db.
-000128c0: 6465 6c65 7465 5f63 6f6e 7461 696e 6572  delete_container
-000128d0: 2863 6f6e 7461 696e 6572 3d63 6f6c 6c65  (container=colle
-000128e0: 6374 696f 6e29 0a0a 2020 2020 2020 2020  ction)..        
-000128f0: 2320 6d69 7373 696e 6720 7072 6563 6973  # missing precis
-00012900: 696f 6e0a 2020 2020 2020 2020 636f 6c6c  ion.        coll
-00012910: 6563 7469 6f6e 203d 2064 622e 6372 6561  ection = db.crea
-00012920: 7465 5f63 6f6e 7461 696e 6572 280a 2020  te_container(.  
-00012930: 2020 2020 2020 2020 2020 6964 3d27 7465            id='te
-00012940: 7374 5f63 7265 6174 655f 6465 6661 756c  st_create_defaul
-00012950: 745f 696e 6465 7869 6e67 5f70 6f6c 6963  t_indexing_polic
-00012960: 7920 5465 7374 4372 6561 7465 4465 6661  y TestCreateDefa
-00012970: 756c 7450 6f6c 6963 7930 3527 202b 2073  ultPolicy05' + s
-00012980: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
-00012990: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
-000129a0: 6465 7869 6e67 5f70 6f6c 6963 793d 7b0a  dexing_policy={.
-000129b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129c0: 2020 2020 2769 6e63 6c75 6465 6450 6174      'includedPat
-000129d0: 6873 273a 205b 0a20 2020 2020 2020 2020  hs': [.         
-000129e0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
-000129f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012a00: 2020 2020 2020 2020 2020 2020 2027 7061               'pa
-00012a10: 7468 273a 2027 2f2a 272c 0a20 2020 2020  th': '/*',.     
-00012a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a30: 2020 2020 2020 2027 696e 6465 7865 7327         'indexes'
-00012a40: 3a20 5b0a 2020 2020 2020 2020 2020 2020  : [.            
-00012a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a60: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
-00012a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a80: 2020 2020 2020 2020 2020 276b 696e 6427            'kind'
-00012a90: 3a20 646f 6375 6d65 6e74 732e 496e 6465  : documents.Inde
-00012aa0: 784b 696e 642e 4861 7368 2c0a 2020 2020  xKind.Hash,.    
-00012ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011cf0: 205d 0a20 2020 2020 2020 2020 2020 2020   ].             
+00011d00: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00011d10: 2020 2020 2020 2020 205d 2c0a 2020 2020           ],.    
+00011d20: 2020 2020 2020 2020 2020 2020 2765 7863              'exc
+00011d30: 6c75 6465 6450 6174 6873 273a 205b 0a20  ludedPaths': [. 
+00011d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d50: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+00011d60: 2020 2020 2020 2020 2020 2020 2027 7061               'pa
+00011d70: 7468 273a 2027 2f22 7379 7374 656d 4d65  th': '/"systemMe
+00011d80: 7461 6461 7461 222f 2a27 0a20 2020 2020  tadata"/*'.     
+00011d90: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00011da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011db0: 205d 0a20 2020 2020 2020 2020 2020 207d   ].            }
+00011dc0: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+00011dd0: 7274 6974 696f 6e5f 6b65 793d 5061 7274  rtition_key=Part
+00011de0: 6974 696f 6e4b 6579 2870 6174 683d 272f  itionKey(path='/
+00011df0: 6964 272c 206b 696e 643d 2748 6173 6827  id', kind='Hash'
+00011e00: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
+00011e10: 2020 2020 2063 6f6c 6c65 6374 696f 6e5f       collection_
+00011e20: 7769 7468 5f69 6e64 6578 696e 675f 706f  with_indexing_po
+00011e30: 6c69 6379 5f70 726f 7065 7274 6965 7320  licy_properties 
+00011e40: 3d20 636f 6c6c 6563 7469 6f6e 5f77 6974  = collection_wit
+00011e50: 685f 696e 6465 7869 6e67 5f70 6f6c 6963  h_indexing_polic
+00011e60: 792e 7265 6164 2829 0a20 2020 2020 2020  y.read().       
+00011e70: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00011e80: 6c28 312c 0a20 2020 2020 2020 2020 2020  l(1,.           
+00011e90: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+00011ea0: 6e28 636f 6c6c 6563 7469 6f6e 5f77 6974  n(collection_wit
+00011eb0: 685f 696e 6465 7869 6e67 5f70 6f6c 6963  h_indexing_polic
+00011ec0: 795f 7072 6f70 6572 7469 6573 5b27 696e  y_properties['in
+00011ed0: 6465 7869 6e67 506f 6c69 6379 275d 5b27  dexingPolicy']['
+00011ee0: 696e 636c 7564 6564 5061 7468 7327 5d29  includedPaths'])
+00011ef0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00011f00: 2020 2020 2020 2020 2020 2027 556e 6578             'Unex
+00011f10: 7065 6374 6564 2069 6e63 6c75 6465 6450  pected includedP
+00011f20: 6174 6873 206c 656e 6774 6827 290a 2020  aths length').  
+00011f30: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00011f40: 7445 7175 616c 2832 2c0a 2020 2020 2020  tEqual(2,.      
+00011f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f60: 2020 206c 656e 2863 6f6c 6c65 6374 696f     len(collectio
+00011f70: 6e5f 7769 7468 5f69 6e64 6578 696e 675f  n_with_indexing_
+00011f80: 706f 6c69 6379 5f70 726f 7065 7274 6965  policy_propertie
+00011f90: 735b 2769 6e64 6578 696e 6750 6f6c 6963  s['indexingPolic
+00011fa0: 7927 5d5b 2765 7863 6c75 6465 6450 6174  y']['excludedPat
+00011fb0: 6873 275d 292c 0a20 2020 2020 2020 2020  hs']),.         
+00011fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fd0: 2755 6e65 7870 6563 7465 6420 6578 636c  'Unexpected excl
+00011fe0: 7564 6564 2070 6174 6820 636f 756e 7427  uded path count'
+00011ff0: 290a 2020 2020 2020 2020 6462 2e64 656c  ).        db.del
+00012000: 6574 655f 636f 6e74 6169 6e65 7228 636f  ete_container(co
+00012010: 6e74 6169 6e65 723d 636f 6c6c 6563 7469  ntainer=collecti
+00012020: 6f6e 5f77 6974 685f 696e 6465 7869 6e67  on_with_indexing
+00012030: 5f70 6f6c 6963 7929 0a0a 2020 2020 6465  _policy)..    de
+00012040: 6620 7465 7374 5f63 7265 6174 655f 6465  f test_create_de
+00012050: 6661 756c 745f 696e 6465 7869 6e67 5f70  fault_indexing_p
+00012060: 6f6c 6963 7928 7365 6c66 293a 0a20 2020  olicy(self):.   
+00012070: 2020 2020 2023 2063 7265 6174 6520 6461       # create da
+00012080: 7461 6261 7365 0a20 2020 2020 2020 2064  tabase.        d
+00012090: 6220 3d20 7365 6c66 2e64 6174 6162 6173  b = self.databas
+000120a0: 6546 6f72 5465 7374 0a0a 2020 2020 2020  eForTest..      
+000120b0: 2020 2320 6e6f 2069 6e64 6578 696e 6720    # no indexing 
+000120c0: 706f 6c69 6379 2073 7065 6369 6669 6564  policy specified
+000120d0: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
+000120e0: 696f 6e20 3d20 6462 2e63 7265 6174 655f  ion = db.create_
+000120f0: 636f 6e74 6169 6e65 7228 0a20 2020 2020  container(.     
+00012100: 2020 2020 2020 2069 643d 2774 6573 745f         id='test_
+00012110: 6372 6561 7465 5f64 6566 6175 6c74 5f69  create_default_i
+00012120: 6e64 6578 696e 675f 706f 6c69 6379 2054  ndexing_policy T
+00012130: 6573 7443 7265 6174 6544 6566 6175 6c74  estCreateDefault
+00012140: 506f 6c69 6379 3031 2720 2b20 7374 7228  Policy01' + str(
+00012150: 7575 6964 2e75 7569 6434 2829 292c 0a20  uuid.uuid4()),. 
+00012160: 2020 2020 2020 2020 2020 2070 6172 7469             parti
+00012170: 7469 6f6e 5f6b 6579 3d50 6172 7469 7469  tion_key=Partiti
+00012180: 6f6e 4b65 7928 7061 7468 3d27 2f69 6427  onKey(path='/id'
+00012190: 2c20 6b69 6e64 3d27 4861 7368 2729 0a20  , kind='Hash'). 
+000121a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000121b0: 2063 6f6c 6c65 6374 696f 6e5f 7072 6f70   collection_prop
+000121c0: 6572 7469 6573 203d 2063 6f6c 6c65 6374  erties = collect
+000121d0: 696f 6e2e 7265 6164 2829 0a20 2020 2020  ion.read().     
+000121e0: 2020 2073 656c 662e 5f63 6865 636b 5f64     self._check_d
+000121f0: 6566 6175 6c74 5f69 6e64 6578 696e 675f  efault_indexing_
+00012200: 706f 6c69 6379 5f70 6174 6873 2863 6f6c  policy_paths(col
+00012210: 6c65 6374 696f 6e5f 7072 6f70 6572 7469  lection_properti
+00012220: 6573 5b27 696e 6465 7869 6e67 506f 6c69  es['indexingPoli
+00012230: 6379 275d 290a 2020 2020 2020 2020 6462  cy']).        db
+00012240: 2e64 656c 6574 655f 636f 6e74 6169 6e65  .delete_containe
+00012250: 7228 636f 6e74 6169 6e65 723d 636f 6c6c  r(container=coll
+00012260: 6563 7469 6f6e 290a 0a20 2020 2020 2020  ection)..       
+00012270: 2023 2070 6172 7469 616c 2070 6f6c 6963   # partial polic
+00012280: 7920 7370 6563 6966 6965 640a 2020 2020  y specified.    
+00012290: 2020 2020 636f 6c6c 6563 7469 6f6e 203d      collection =
+000122a0: 2064 622e 6372 6561 7465 5f63 6f6e 7461   db.create_conta
+000122b0: 696e 6572 280a 2020 2020 2020 2020 2020  iner(.          
+000122c0: 2020 6964 3d27 7465 7374 5f63 7265 6174    id='test_creat
+000122d0: 655f 6465 6661 756c 745f 696e 6465 7869  e_default_indexi
+000122e0: 6e67 5f70 6f6c 6963 7920 5465 7374 4372  ng_policy TestCr
+000122f0: 6561 7465 4465 6661 756c 7450 6f6c 6963  eateDefaultPolic
+00012300: 7930 3127 202b 2073 7472 2875 7569 642e  y01' + str(uuid.
+00012310: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
+00012320: 2020 2020 2020 696e 6465 7869 6e67 5f70        indexing_p
+00012330: 6f6c 6963 793d 7b0a 2020 2020 2020 2020  olicy={.        
+00012340: 2020 2020 2020 2020 2020 2020 2769 6e64              'ind
+00012350: 6578 696e 674d 6f64 6527 3a20 646f 6375  exingMode': docu
+00012360: 6d65 6e74 732e 496e 6465 7869 6e67 4d6f  ments.IndexingMo
+00012370: 6465 2e43 6f6e 7369 7374 656e 742c 2027  de.Consistent, '
+00012380: 6175 746f 6d61 7469 6327 3a20 5472 7565  automatic': True
+00012390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000123a0: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
+000123b0: 7061 7274 6974 696f 6e5f 6b65 793d 5061  partition_key=Pa
+000123c0: 7274 6974 696f 6e4b 6579 2870 6174 683d  rtitionKey(path=
+000123d0: 272f 6964 272c 206b 696e 643d 2748 6173  '/id', kind='Has
+000123e0: 6827 290a 2020 2020 2020 2020 290a 2020  h').        ).  
+000123f0: 2020 2020 2020 636f 6c6c 6563 7469 6f6e        collection
+00012400: 5f70 726f 7065 7274 6965 7320 3d20 636f  _properties = co
+00012410: 6c6c 6563 7469 6f6e 2e72 6561 6428 290a  llection.read().
+00012420: 2020 2020 2020 2020 7365 6c66 2e5f 6368          self._ch
+00012430: 6563 6b5f 6465 6661 756c 745f 696e 6465  eck_default_inde
+00012440: 7869 6e67 5f70 6f6c 6963 795f 7061 7468  xing_policy_path
+00012450: 7328 636f 6c6c 6563 7469 6f6e 5f70 726f  s(collection_pro
+00012460: 7065 7274 6965 735b 2769 6e64 6578 696e  perties['indexin
+00012470: 6750 6f6c 6963 7927 5d29 0a20 2020 2020  gPolicy']).     
+00012480: 2020 2064 622e 6465 6c65 7465 5f63 6f6e     db.delete_con
+00012490: 7461 696e 6572 2863 6f6e 7461 696e 6572  tainer(container
+000124a0: 3d63 6f6c 6c65 6374 696f 6e29 0a0a 2020  =collection)..  
+000124b0: 2020 2020 2020 2320 6465 6661 756c 7420        # default 
+000124c0: 706f 6c69 6379 0a20 2020 2020 2020 2063  policy.        c
+000124d0: 6f6c 6c65 6374 696f 6e20 3d20 6462 2e63  ollection = db.c
+000124e0: 7265 6174 655f 636f 6e74 6169 6e65 7228  reate_container(
+000124f0: 0a20 2020 2020 2020 2020 2020 2069 643d  .            id=
+00012500: 2774 6573 745f 6372 6561 7465 5f64 6566  'test_create_def
+00012510: 6175 6c74 5f69 6e64 6578 696e 675f 706f  ault_indexing_po
+00012520: 6c69 6379 2054 6573 7443 7265 6174 6544  licy TestCreateD
+00012530: 6566 6175 6c74 506f 6c69 6379 3033 2720  efaultPolicy03' 
+00012540: 2b20 7374 7228 7575 6964 2e75 7569 6434  + str(uuid.uuid4
+00012550: 2829 292c 0a20 2020 2020 2020 2020 2020  ()),.           
+00012560: 2069 6e64 6578 696e 675f 706f 6c69 6379   indexing_policy
+00012570: 3d7b 7d2c 0a20 2020 2020 2020 2020 2020  ={},.           
+00012580: 2070 6172 7469 7469 6f6e 5f6b 6579 3d50   partition_key=P
+00012590: 6172 7469 7469 6f6e 4b65 7928 7061 7468  artitionKey(path
+000125a0: 3d27 2f69 6427 2c20 6b69 6e64 3d27 4861  ='/id', kind='Ha
+000125b0: 7368 2729 0a20 2020 2020 2020 2029 0a20  sh').        ). 
+000125c0: 2020 2020 2020 2063 6f6c 6c65 6374 696f         collectio
+000125d0: 6e5f 7072 6f70 6572 7469 6573 203d 2063  n_properties = c
+000125e0: 6f6c 6c65 6374 696f 6e2e 7265 6164 2829  ollection.read()
+000125f0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+00012600: 6865 636b 5f64 6566 6175 6c74 5f69 6e64  heck_default_ind
+00012610: 6578 696e 675f 706f 6c69 6379 5f70 6174  exing_policy_pat
+00012620: 6873 2863 6f6c 6c65 6374 696f 6e5f 7072  hs(collection_pr
+00012630: 6f70 6572 7469 6573 5b27 696e 6465 7869  operties['indexi
+00012640: 6e67 506f 6c69 6379 275d 290a 2020 2020  ngPolicy']).    
+00012650: 2020 2020 6462 2e64 656c 6574 655f 636f      db.delete_co
+00012660: 6e74 6169 6e65 7228 636f 6e74 6169 6e65  ntainer(containe
+00012670: 723d 636f 6c6c 6563 7469 6f6e 290a 0a20  r=collection).. 
+00012680: 2020 2020 2020 2023 206d 6973 7369 6e67         # missing
+00012690: 2069 6e64 6578 6573 0a20 2020 2020 2020   indexes.       
+000126a0: 2063 6f6c 6c65 6374 696f 6e20 3d20 6462   collection = db
+000126b0: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
+000126c0: 7228 0a20 2020 2020 2020 2020 2020 2069  r(.            i
+000126d0: 643d 2774 6573 745f 6372 6561 7465 5f64  d='test_create_d
+000126e0: 6566 6175 6c74 5f69 6e64 6578 696e 675f  efault_indexing_
+000126f0: 706f 6c69 6379 2054 6573 7443 7265 6174  policy TestCreat
+00012700: 6544 6566 6175 6c74 506f 6c69 6379 3034  eDefaultPolicy04
+00012710: 2720 2b20 7374 7228 7575 6964 2e75 7569  ' + str(uuid.uui
+00012720: 6434 2829 292c 0a20 2020 2020 2020 2020  d4()),.         
+00012730: 2020 2069 6e64 6578 696e 675f 706f 6c69     indexing_poli
+00012740: 6379 3d7b 0a20 2020 2020 2020 2020 2020  cy={.           
+00012750: 2020 2020 2020 2020 2027 696e 636c 7564           'includ
+00012760: 6564 5061 7468 7327 3a20 5b0a 2020 2020  edPaths': [.    
+00012770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012780: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
+00012790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127a0: 2020 2770 6174 6827 3a20 272f 2a27 0a20    'path': '/*'. 
+000127b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127c0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000127d0: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
+000127e0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+000127f0: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+00012800: 7274 6974 696f 6e5f 6b65 793d 5061 7274  rtition_key=Part
+00012810: 6974 696f 6e4b 6579 2870 6174 683d 272f  itionKey(path='/
+00012820: 6964 272c 206b 696e 643d 2748 6173 6827  id', kind='Hash'
+00012830: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+00012840: 2020 2020 636f 6c6c 6563 7469 6f6e 5f70      collection_p
+00012850: 726f 7065 7274 6965 7320 3d20 636f 6c6c  roperties = coll
+00012860: 6563 7469 6f6e 2e72 6561 6428 290a 2020  ection.read().  
+00012870: 2020 2020 2020 7365 6c66 2e5f 6368 6563        self._chec
+00012880: 6b5f 6465 6661 756c 745f 696e 6465 7869  k_default_indexi
+00012890: 6e67 5f70 6f6c 6963 795f 7061 7468 7328  ng_policy_paths(
+000128a0: 636f 6c6c 6563 7469 6f6e 5f70 726f 7065  collection_prope
+000128b0: 7274 6965 735b 2769 6e64 6578 696e 6750  rties['indexingP
+000128c0: 6f6c 6963 7927 5d29 0a20 2020 2020 2020  olicy']).       
+000128d0: 2064 622e 6465 6c65 7465 5f63 6f6e 7461   db.delete_conta
+000128e0: 696e 6572 2863 6f6e 7461 696e 6572 3d63  iner(container=c
+000128f0: 6f6c 6c65 6374 696f 6e29 0a0a 2020 2020  ollection)..    
+00012900: 2020 2020 2320 6d69 7373 696e 6720 7072      # missing pr
+00012910: 6563 6973 696f 6e0a 2020 2020 2020 2020  ecision.        
+00012920: 636f 6c6c 6563 7469 6f6e 203d 2064 622e  collection = db.
+00012930: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
+00012940: 280a 2020 2020 2020 2020 2020 2020 6964  (.            id
+00012950: 3d27 7465 7374 5f63 7265 6174 655f 6465  ='test_create_de
+00012960: 6661 756c 745f 696e 6465 7869 6e67 5f70  fault_indexing_p
+00012970: 6f6c 6963 7920 5465 7374 4372 6561 7465  olicy TestCreate
+00012980: 4465 6661 756c 7450 6f6c 6963 7930 3527  DefaultPolicy05'
+00012990: 202b 2073 7472 2875 7569 642e 7575 6964   + str(uuid.uuid
+000129a0: 3428 2929 2c0a 2020 2020 2020 2020 2020  4()),.          
+000129b0: 2020 696e 6465 7869 6e67 5f70 6f6c 6963    indexing_polic
+000129c0: 793d 7b0a 2020 2020 2020 2020 2020 2020  y={.            
+000129d0: 2020 2020 2020 2020 2769 6e63 6c75 6465          'include
+000129e0: 6450 6174 6873 273a 205b 0a20 2020 2020  dPaths': [.     
+000129f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a00: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+00012a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a20: 2027 7061 7468 273a 2027 2f2a 272c 0a20   'path': '/*',. 
+00012a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a40: 2020 2020 2020 2020 2020 2027 696e 6465             'inde
+00012a50: 7865 7327 3a20 5b0a 2020 2020 2020 2020  xes': [.        
+00012a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a70: 2020 2020 2020 2020 7b0a 2020 2020 2020          {.      
+00012a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a90: 2020 2020 2020 2020 2020 2020 2020 276b                'k
+00012aa0: 696e 6427 3a20 646f 6375 6d65 6e74 732e  ind': documents.
+00012ab0: 496e 6465 784b 696e 642e 4861 7368 2c0a  IndexKind.Hash,.
 00012ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ad0: 2764 6174 6154 7970 6527 3a20 646f 6375  'dataType': docu
-00012ae0: 6d65 6e74 732e 4461 7461 5479 7065 2e53  ments.DataType.S
-00012af0: 7472 696e 670a 2020 2020 2020 2020 2020  tring.          
-00012b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b10: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
-00012b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b30: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
-00012b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b50: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00012b60: 6b69 6e64 273a 2064 6f63 756d 656e 7473  kind': documents
-00012b70: 2e49 6e64 6578 4b69 6e64 2e52 616e 6765  .IndexKind.Range
-00012b80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00012b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ba0: 2020 2020 2020 2764 6174 6154 7970 6527        'dataType'
-00012bb0: 3a20 646f 6375 6d65 6e74 732e 4461 7461  : documents.Data
-00012bc0: 5479 7065 2e4e 756d 6265 720a 2020 2020  Type.Number.    
-00012bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012be0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+00012ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ae0: 2020 2020 2764 6174 6154 7970 6527 3a20      'dataType': 
+00012af0: 646f 6375 6d65 6e74 732e 4461 7461 5479  documents.DataTy
+00012b00: 7065 2e53 7472 696e 670a 2020 2020 2020  pe.String.      
+00012b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b20: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
+00012b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b40: 2020 2020 2020 2020 2020 2020 207b 0a20               {. 
+00012b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b70: 2020 2027 6b69 6e64 273a 2064 6f63 756d     'kind': docum
+00012b80: 656e 7473 2e49 6e64 6578 4b69 6e64 2e52  ents.IndexKind.R
+00012b90: 616e 6765 2c0a 2020 2020 2020 2020 2020  ange,.          
+00012ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bb0: 2020 2020 2020 2020 2020 2764 6174 6154            'dataT
+00012bc0: 7970 6527 3a20 646f 6375 6d65 6e74 732e  ype': documents.
+00012bd0: 4461 7461 5479 7065 2e4e 756d 6265 720a  DataType.Number.
+00012be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c00: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-00012c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c20: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-00012c30: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-00012c40: 2020 2020 2020 2020 2020 2020 7d2c 0a20              },. 
-00012c50: 2020 2020 2020 2020 2020 2070 6172 7469             parti
-00012c60: 7469 6f6e 5f6b 6579 3d50 6172 7469 7469  tion_key=Partiti
-00012c70: 6f6e 4b65 7928 7061 7468 3d27 2f69 6427  onKey(path='/id'
-00012c80: 2c20 6b69 6e64 3d27 4861 7368 2729 0a20  , kind='Hash'). 
-00012c90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00012ca0: 2063 6f6c 6c65 6374 696f 6e5f 7072 6f70   collection_prop
-00012cb0: 6572 7469 6573 203d 2063 6f6c 6c65 6374  erties = collect
-00012cc0: 696f 6e2e 7265 6164 2829 0a20 2020 2020  ion.read().     
-00012cd0: 2020 2073 656c 662e 5f63 6865 636b 5f64     self._check_d
-00012ce0: 6566 6175 6c74 5f69 6e64 6578 696e 675f  efault_indexing_
-00012cf0: 706f 6c69 6379 5f70 6174 6873 2863 6f6c  policy_paths(col
-00012d00: 6c65 6374 696f 6e5f 7072 6f70 6572 7469  lection_properti
-00012d10: 6573 5b27 696e 6465 7869 6e67 506f 6c69  es['indexingPoli
-00012d20: 6379 275d 290a 2020 2020 2020 2020 6462  cy']).        db
-00012d30: 2e64 656c 6574 655f 636f 6e74 6169 6e65  .delete_containe
-00012d40: 7228 636f 6e74 6169 6e65 723d 636f 6c6c  r(container=coll
-00012d50: 6563 7469 6f6e 290a 0a20 2020 2064 6566  ection)..    def
-00012d60: 2074 6573 745f 6372 6561 7465 5f69 6e64   test_create_ind
-00012d70: 6578 696e 675f 706f 6c69 6379 5f77 6974  exing_policy_wit
-00012d80: 685f 636f 6d70 6f73 6974 655f 616e 645f  h_composite_and_
-00012d90: 7370 6174 6961 6c5f 696e 6465 7865 7328  spatial_indexes(
-00012da0: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
-00012db0: 2063 7265 6174 6520 6461 7461 6261 7365   create database
-00012dc0: 0a20 2020 2020 2020 2064 6220 3d20 7365  .        db = se
-00012dd0: 6c66 2e64 6174 6162 6173 6546 6f72 5465  lf.databaseForTe
-00012de0: 7374 0a0a 2020 2020 2020 2020 696e 6465  st..        inde
-00012df0: 7869 6e67 5f70 6f6c 6963 7920 3d20 7b0a  xing_policy = {.
-00012e00: 2020 2020 2020 2020 2020 2020 2273 7061              "spa
-00012e10: 7469 616c 496e 6465 7865 7322 3a20 5b0a  tialIndexes": [.
-00012e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e30: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00012e40: 2020 2020 2020 2270 6174 6822 3a20 222f        "path": "/
-00012e50: 7061 7468 302f 2a22 2c0a 2020 2020 2020  path0/*",.      
-00012e60: 2020 2020 2020 2020 2020 2020 2020 2274                "t
-00012e70: 7970 6573 223a 205b 0a20 2020 2020 2020  ypes": [.       
-00012e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e90: 2022 506f 696e 7422 2c0a 2020 2020 2020   "Point",.      
-00012ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012eb0: 2020 224c 696e 6553 7472 696e 6722 2c0a    "LineString",.
-00012ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ed0: 2020 2020 2020 2020 2250 6f6c 7967 6f6e          "Polygon
-00012ee0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00012ef0: 2020 2020 2020 2020 2020 2022 4d75 6c74             "Mult
-00012f00: 6950 6f6c 7967 6f6e 220a 2020 2020 2020  iPolygon".      
-00012f10: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+00012c00: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00012c10: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+00012c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c30: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00012c40: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+00012c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c60: 7d2c 0a20 2020 2020 2020 2020 2020 2070  },.            p
+00012c70: 6172 7469 7469 6f6e 5f6b 6579 3d50 6172  artition_key=Par
+00012c80: 7469 7469 6f6e 4b65 7928 7061 7468 3d27  titionKey(path='
+00012c90: 2f69 6427 2c20 6b69 6e64 3d27 4861 7368  /id', kind='Hash
+00012ca0: 2729 0a20 2020 2020 2020 2029 0a20 2020  ').        ).   
+00012cb0: 2020 2020 2063 6f6c 6c65 6374 696f 6e5f       collection_
+00012cc0: 7072 6f70 6572 7469 6573 203d 2063 6f6c  properties = col
+00012cd0: 6c65 6374 696f 6e2e 7265 6164 2829 0a20  lection.read(). 
+00012ce0: 2020 2020 2020 2073 656c 662e 5f63 6865         self._che
+00012cf0: 636b 5f64 6566 6175 6c74 5f69 6e64 6578  ck_default_index
+00012d00: 696e 675f 706f 6c69 6379 5f70 6174 6873  ing_policy_paths
+00012d10: 2863 6f6c 6c65 6374 696f 6e5f 7072 6f70  (collection_prop
+00012d20: 6572 7469 6573 5b27 696e 6465 7869 6e67  erties['indexing
+00012d30: 506f 6c69 6379 275d 290a 2020 2020 2020  Policy']).      
+00012d40: 2020 6462 2e64 656c 6574 655f 636f 6e74    db.delete_cont
+00012d50: 6169 6e65 7228 636f 6e74 6169 6e65 723d  ainer(container=
+00012d60: 636f 6c6c 6563 7469 6f6e 290a 0a20 2020  collection)..   
+00012d70: 2064 6566 2074 6573 745f 6372 6561 7465   def test_create
+00012d80: 5f69 6e64 6578 696e 675f 706f 6c69 6379  _indexing_policy
+00012d90: 5f77 6974 685f 636f 6d70 6f73 6974 655f  _with_composite_
+00012da0: 616e 645f 7370 6174 6961 6c5f 696e 6465  and_spatial_inde
+00012db0: 7865 7328 7365 6c66 293a 0a20 2020 2020  xes(self):.     
+00012dc0: 2020 2023 2063 7265 6174 6520 6461 7461     # create data
+00012dd0: 6261 7365 0a20 2020 2020 2020 2064 6220  base.        db 
+00012de0: 3d20 7365 6c66 2e64 6174 6162 6173 6546  = self.databaseF
+00012df0: 6f72 5465 7374 0a0a 2020 2020 2020 2020  orTest..        
+00012e00: 696e 6465 7869 6e67 5f70 6f6c 6963 7920  indexing_policy 
+00012e10: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00012e20: 2273 7061 7469 616c 496e 6465 7865 7322  "spatialIndexes"
+00012e30: 3a20 5b0a 2020 2020 2020 2020 2020 2020  : [.            
+00012e40: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
+00012e50: 2020 2020 2020 2020 2020 2270 6174 6822            "path"
+00012e60: 3a20 222f 7061 7468 302f 2a22 2c0a 2020  : "/path0/*",.  
+00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e80: 2020 2274 7970 6573 223a 205b 0a20 2020    "types": [.   
+00012e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ea0: 2020 2020 2022 506f 696e 7422 2c0a 2020       "Point",.  
+00012eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ec0: 2020 2020 2020 224c 696e 6553 7472 696e        "LineStrin
+00012ed0: 6722 2c0a 2020 2020 2020 2020 2020 2020  g",.            
+00012ee0: 2020 2020 2020 2020 2020 2020 2250 6f6c              "Pol
+00012ef0: 7967 6f6e 222c 0a20 2020 2020 2020 2020  ygon",.         
+00012f00: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00012f10: 4d75 6c74 6950 6f6c 7967 6f6e 220a 2020  MultiPolygon".  
 00012f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f30: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-00012f40: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
-00012f50: 2020 2020 2020 2020 2022 7061 7468 223a           "path":
-00012f60: 2022 2f70 6174 6831 2f2a 222c 0a20 2020   "/path1/*",.   
-00012f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f80: 2022 7479 7065 7322 3a20 5b0a 2020 2020   "types": [.    
-00012f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fa0: 2020 2020 2250 6f69 6e74 222c 0a20 2020      "Point",.   
-00012fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fc0: 2020 2020 2022 4c69 6e65 5374 7269 6e67       "LineString
-00012fd0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00012fe0: 2020 2020 2020 2020 2020 2022 506f 6c79             "Poly
-00012ff0: 676f 6e22 2c0a 2020 2020 2020 2020 2020  gon",.          
-00013000: 2020 2020 2020 2020 2020 2020 2020 224d                "M
-00013010: 756c 7469 506f 6c79 676f 6e22 0a20 2020  ultiPolygon".   
-00013020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013030: 205d 0a20 2020 2020 2020 2020 2020 2020   ].             
-00013040: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00013050: 205d 2c0a 2020 2020 2020 2020 2020 2020   ],.            
-00013060: 2263 6f6d 706f 7369 7465 496e 6465 7865  "compositeIndexe
-00013070: 7322 3a20 5b0a 2020 2020 2020 2020 2020  s": [.          
-00013080: 2020 2020 2020 5b0a 2020 2020 2020 2020        [.        
-00013090: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
+00012f30: 2020 5d0a 2020 2020 2020 2020 2020 2020    ].            
+00012f40: 2020 2020 7d2c 0a20 2020 2020 2020 2020      },.         
+00012f50: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
+00012f60: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
+00012f70: 7468 223a 2022 2f70 6174 6831 2f2a 222c  th": "/path1/*",
+00012f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012f90: 2020 2020 2022 7479 7065 7322 3a20 5b0a       "types": [.
+00012fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fb0: 2020 2020 2020 2020 2250 6f69 6e74 222c          "Point",
+00012fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012fd0: 2020 2020 2020 2020 2022 4c69 6e65 5374           "LineSt
+00012fe0: 7269 6e67 222c 0a20 2020 2020 2020 2020  ring",.         
+00012ff0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00013000: 506f 6c79 676f 6e22 2c0a 2020 2020 2020  Polygon",.      
+00013010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013020: 2020 224d 756c 7469 506f 6c79 676f 6e22    "MultiPolygon"
+00013030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013040: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
+00013050: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00013060: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
+00013070: 2020 2020 2263 6f6d 706f 7369 7465 496e      "compositeIn
+00013080: 6465 7865 7322 3a20 5b0a 2020 2020 2020  dexes": [.      
+00013090: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
 000130a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000130b0: 2020 2020 2020 2270 6174 6822 3a20 222f        "path": "/
-000130c0: 7061 7468 3122 2c0a 2020 2020 2020 2020  path1",.        
-000130d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000130e0: 226f 7264 6572 223a 2022 6173 6365 6e64  "order": "ascend
-000130f0: 696e 6722 0a20 2020 2020 2020 2020 2020  ing".           
-00013100: 2020 2020 2020 2020 207d 2c0a 2020 2020           },.    
-00013110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013120: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00013130: 2020 2020 2020 2020 2020 2270 6174 6822            "path"
-00013140: 3a20 222f 7061 7468 3222 2c0a 2020 2020  : "/path2",.    
-00013150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013160: 2020 2020 226f 7264 6572 223a 2022 6465      "order": "de
-00013170: 7363 656e 6469 6e67 220a 2020 2020 2020  scending".      
-00013180: 2020 2020 2020 2020 2020 2020 2020 7d2c                },
-00013190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000131a0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-000131b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000131c0: 7061 7468 223a 2022 2f70 6174 6833 222c  path": "/path3",
-000131d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000131e0: 2020 2020 2020 2020 2022 6f72 6465 7222           "order"
-000131f0: 3a20 2261 7363 656e 6469 6e67 220a 2020  : "ascending".  
-00013200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013210: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-00013220: 2020 2020 5d2c 0a20 2020 2020 2020 2020      ],.         
-00013230: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
-00013240: 2020 2020 2020 2020 2020 2020 207b 0a20               {. 
+000130b0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+000130c0: 2020 2020 2020 2020 2020 2270 6174 6822            "path"
+000130d0: 3a20 222f 7061 7468 3122 2c0a 2020 2020  : "/path1",.    
+000130e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130f0: 2020 2020 226f 7264 6572 223a 2022 6173      "order": "as
+00013100: 6365 6e64 696e 6722 0a20 2020 2020 2020  cending".       
+00013110: 2020 2020 2020 2020 2020 2020 207d 2c0a               },.
+00013120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013130: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
+00013140: 2020 2020 2020 2020 2020 2020 2020 2270                "p
+00013150: 6174 6822 3a20 222f 7061 7468 3222 2c0a  ath": "/path2",.
+00013160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013170: 2020 2020 2020 2020 226f 7264 6572 223a          "order":
+00013180: 2022 6465 7363 656e 6469 6e67 220a 2020   "descending".  
+00013190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131a0: 2020 7d2c 0a20 2020 2020 2020 2020 2020    },.           
+000131b0: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
+000131c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131d0: 2020 2022 7061 7468 223a 2022 2f70 6174     "path": "/pat
+000131e0: 6833 222c 0a20 2020 2020 2020 2020 2020  h3",.           
+000131f0: 2020 2020 2020 2020 2020 2020 2022 6f72               "or
+00013200: 6465 7222 3a20 2261 7363 656e 6469 6e67  der": "ascending
+00013210: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00013220: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00013230: 2020 2020 2020 2020 5d2c 0a20 2020 2020          ],.     
+00013240: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
 00013250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013260: 2020 2020 2020 2022 7061 7468 223a 2022         "path": "
-00013270: 2f70 6174 6834 222c 0a20 2020 2020 2020  /path4",.       
-00013280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013290: 2022 6f72 6465 7222 3a20 2261 7363 656e   "order": "ascen
-000132a0: 6469 6e67 220a 2020 2020 2020 2020 2020  ding".          
-000132b0: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
-000132c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132d0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-000132e0: 2020 2020 2020 2020 2020 2022 7061 7468             "path
-000132f0: 223a 2022 2f70 6174 6835 222c 0a20 2020  ": "/path5",.   
-00013300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013310: 2020 2020 2022 6f72 6465 7222 3a20 2264       "order": "d
-00013320: 6573 6365 6e64 696e 6722 0a20 2020 2020  escending".     
-00013330: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00013340: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013350: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
-00013360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013370: 2270 6174 6822 3a20 222f 7061 7468 3622  "path": "/path6"
-00013380: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013390: 2020 2020 2020 2020 2020 226f 7264 6572            "order
-000133a0: 223a 2022 6173 6365 6e64 696e 6722 0a20  ": "ascending". 
-000133b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133c0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-000133d0: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
-000133e0: 2020 205d 0a20 2020 2020 2020 207d 0a0a     ].        }..
-000133f0: 2020 2020 2020 2020 6375 7374 6f6d 5f6c          custom_l
-00013400: 6f67 6765 7220 3d20 6c6f 6767 696e 672e  ogger = logging.
-00013410: 6765 744c 6f67 6765 7228 2243 7573 746f  getLogger("Custo
-00013420: 6d4c 6f67 6765 7222 290a 2020 2020 2020  mLogger").      
-00013430: 2020 6372 6561 7465 645f 636f 6e74 6169    created_contai
-00013440: 6e65 7220 3d20 6462 2e63 7265 6174 655f  ner = db.create_
-00013450: 636f 6e74 6169 6e65 7228 0a20 2020 2020  container(.     
-00013460: 2020 2020 2020 2069 643d 2763 6f6d 706f         id='compo
-00013470: 7369 7465 5f69 6e64 6578 5f73 7061 7469  site_index_spati
-00013480: 616c 5f69 6e64 6578 2720 2b20 7374 7228  al_index' + str(
-00013490: 7575 6964 2e75 7569 6434 2829 292c 0a20  uuid.uuid4()),. 
-000134a0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-000134b0: 696e 675f 706f 6c69 6379 3d69 6e64 6578  ing_policy=index
-000134c0: 696e 675f 706f 6c69 6379 2c0a 2020 2020  ing_policy,.    
-000134d0: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
-000134e0: 6e5f 6b65 793d 5061 7274 6974 696f 6e4b  n_key=PartitionK
-000134f0: 6579 2870 6174 683d 272f 6964 272c 206b  ey(path='/id', k
-00013500: 696e 643d 2748 6173 6827 292c 0a20 2020  ind='Hash'),.   
-00013510: 2020 2020 2020 2020 2068 6561 6465 7273           headers
-00013520: 3d7b 2246 6f6f 223a 2262 6172 227d 2c0a  ={"Foo":"bar"},.
-00013530: 2020 2020 2020 2020 2020 2020 7573 6572              user
-00013540: 5f61 6765 6e74 3d22 626c 6168 222c 0a20  _agent="blah",. 
-00013550: 2020 2020 2020 2020 2020 2075 7365 725f             user_
-00013560: 6167 656e 745f 6f76 6572 7772 6974 653d  agent_overwrite=
-00013570: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00013580: 2020 6c6f 6767 696e 675f 656e 6162 6c65    logging_enable
-00013590: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-000135a0: 2020 206c 6f67 6765 723d 6375 7374 6f6d     logger=custom
-000135b0: 5f6c 6f67 6765 722c 0a20 2020 2020 2020  _logger,.       
-000135c0: 2029 0a20 2020 2020 2020 2063 7265 6174   ).        creat
-000135d0: 6564 5f70 726f 7065 7274 6965 7320 3d20  ed_properties = 
-000135e0: 6372 6561 7465 645f 636f 6e74 6169 6e65  created_containe
-000135f0: 722e 7265 6164 286c 6f67 6765 723d 6375  r.read(logger=cu
-00013600: 7374 6f6d 5f6c 6f67 6765 7229 0a20 2020  stom_logger).   
-00013610: 2020 2020 2072 6561 645f 696e 6465 7869       read_indexi
-00013620: 6e67 5f70 6f6c 6963 7920 3d20 6372 6561  ng_policy = crea
-00013630: 7465 645f 7072 6f70 6572 7469 6573 5b27  ted_properties['
-00013640: 696e 6465 7869 6e67 506f 6c69 6379 275d  indexingPolicy']
-00013650: 0a0a 2020 2020 2020 2020 6966 2027 6c6f  ..        if 'lo
-00013660: 6361 6c68 6f73 7427 2069 6e20 7365 6c66  calhost' in self
-00013670: 2e68 6f73 7420 6f72 2027 3132 372e 302e  .host or '127.0.
-00013680: 302e 3127 2069 6e20 7365 6c66 2e68 6f73  0.1' in self.hos
-00013690: 743a 2020 2320 544f 444f 3a20 4469 6666  t:  # TODO: Diff
-000136a0: 6572 696e 6720 7265 7375 6c74 2062 6574  ering result bet
-000136b0: 7765 656e 206c 6976 6520 616e 6420 656d  ween live and em
-000136c0: 756c 6174 6f72 0a20 2020 2020 2020 2020  ulator.         
-000136d0: 2020 2073 656c 662e 6173 7365 7274 4c69     self.assertLi
-000136e0: 7374 4571 7561 6c28 696e 6465 7869 6e67  stEqual(indexing
-000136f0: 5f70 6f6c 6963 795b 2773 7061 7469 616c  _policy['spatial
-00013700: 496e 6465 7865 7327 5d2c 2072 6561 645f  Indexes'], read_
-00013710: 696e 6465 7869 6e67 5f70 6f6c 6963 795b  indexing_policy[
-00013720: 2773 7061 7469 616c 496e 6465 7865 7327  'spatialIndexes'
-00013730: 5d29 0a20 2020 2020 2020 2065 6c73 653a  ]).        else:
-00013740: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
-00013750: 6c6c 2074 7970 6573 2061 7265 2072 6574  ll types are ret
-00013760: 7572 6e65 6420 666f 7220 7370 6174 6961  urned for spatia
-00013770: 6c20 496e 6465 7865 730a 2020 2020 2020  l Indexes.      
-00013780: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00013790: 744c 6973 7445 7175 616c 2869 6e64 6578  tListEqual(index
-000137a0: 696e 675f 706f 6c69 6379 5b27 7370 6174  ing_policy['spat
-000137b0: 6961 6c49 6e64 6578 6573 275d 2c20 7265  ialIndexes'], re
-000137c0: 6164 5f69 6e64 6578 696e 675f 706f 6c69  ad_indexing_poli
-000137d0: 6379 5b27 7370 6174 6961 6c49 6e64 6578  cy['spatialIndex
-000137e0: 6573 275d 290a 0a20 2020 2020 2020 2073  es'])..        s
-000137f0: 656c 662e 6173 7365 7274 4c69 7374 4571  elf.assertListEq
-00013800: 7561 6c28 696e 6465 7869 6e67 5f70 6f6c  ual(indexing_pol
-00013810: 6963 795b 2763 6f6d 706f 7369 7465 496e  icy['compositeIn
-00013820: 6465 7865 7327 5d2c 2072 6561 645f 696e  dexes'], read_in
-00013830: 6465 7869 6e67 5f70 6f6c 6963 795b 2763  dexing_policy['c
-00013840: 6f6d 706f 7369 7465 496e 6465 7865 7327  ompositeIndexes'
-00013850: 5d29 0a20 2020 2020 2020 2064 622e 6465  ]).        db.de
-00013860: 6c65 7465 5f63 6f6e 7461 696e 6572 2863  lete_container(c
-00013870: 6f6e 7461 696e 6572 3d63 7265 6174 6564  ontainer=created
-00013880: 5f63 6f6e 7461 696e 6572 290a 0a20 2020  _container)..   
-00013890: 2064 6566 205f 6368 6563 6b5f 6465 6661   def _check_defa
-000138a0: 756c 745f 696e 6465 7869 6e67 5f70 6f6c  ult_indexing_pol
-000138b0: 6963 795f 7061 7468 7328 7365 6c66 2c20  icy_paths(self, 
-000138c0: 696e 6465 7869 6e67 5f70 6f6c 6963 7929  indexing_policy)
-000138d0: 3a0a 2020 2020 2020 2020 6465 6620 5f5f  :.        def __
-000138e0: 6765 745f 6669 7273 7428 6172 7261 7929  get_first(array)
-000138f0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00013900: 2061 7272 6179 3a0a 2020 2020 2020 2020   array:.        
-00013910: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00013920: 7272 6179 5b30 5d0a 2020 2020 2020 2020  rray[0].        
-00013930: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00013940: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00013950: 204e 6f6e 650a 0a20 2020 2020 2020 2023   None..        #
-00013960: 2027 2f5f 6574 6167 2720 6973 2070 7265   '/_etag' is pre
-00013970: 7365 6e74 2069 6e20 6578 636c 7564 6564  sent in excluded
-00013980: 2070 6174 6873 2062 7920 6465 6661 756c   paths by defaul
-00013990: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
-000139a0: 7373 6572 7445 7175 616c 2831 2c20 6c65  ssertEqual(1, le
-000139b0: 6e28 696e 6465 7869 6e67 5f70 6f6c 6963  n(indexing_polic
-000139c0: 795b 2765 7863 6c75 6465 6450 6174 6873  y['excludedPaths
-000139d0: 275d 2929 0a20 2020 2020 2020 2023 2069  '])).        # i
-000139e0: 6e63 6c75 6465 6420 7061 7468 7320 7368  ncluded paths sh
-000139f0: 6f75 6c64 2062 6520 313a 2027 2f27 2e0a  ould be 1: '/'..
-00013a00: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00013a10: 6572 7445 7175 616c 2831 2c20 6c65 6e28  ertEqual(1, len(
-00013a20: 696e 6465 7869 6e67 5f70 6f6c 6963 795b  indexing_policy[
-00013a30: 2769 6e63 6c75 6465 6450 6174 6873 275d  'includedPaths']
-00013a40: 2929 0a0a 2020 2020 2020 2020 726f 6f74  ))..        root
-00013a50: 5f69 6e63 6c75 6465 645f 7061 7468 203d  _included_path =
-00013a60: 205f 5f67 6574 5f66 6972 7374 285b 696e   __get_first([in
-00013a70: 636c 7564 6564 5f70 6174 6820 666f 7220  cluded_path for 
-00013a80: 696e 636c 7564 6564 5f70 6174 6820 696e  included_path in
-00013a90: 2069 6e64 6578 696e 675f 706f 6c69 6379   indexing_policy
-00013aa0: 5b27 696e 636c 7564 6564 5061 7468 7327  ['includedPaths'
-00013ab0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ad0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00013ae0: 6e63 6c75 6465 645f 7061 7468 5b27 7061  ncluded_path['pa
-00013af0: 7468 275d 203d 3d20 272f 2a27 5d29 0a20  th'] == '/*']). 
-00013b00: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00013b10: 7274 4661 6c73 6528 726f 6f74 5f69 6e63  rtFalse(root_inc
-00013b20: 6c75 6465 645f 7061 7468 2e67 6574 2827  luded_path.get('
-00013b30: 696e 6465 7865 7327 2929 0a0a 2020 2020  indexes'))..    
-00013b40: 6465 6620 7465 7374 5f63 6c69 656e 745f  def test_client_
-00013b50: 7265 7175 6573 745f 7469 6d65 6f75 7428  request_timeout(
-00013b60: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
-00013b70: 2054 6573 7420 6973 2066 6c61 6b79 206f   Test is flaky o
-00013b80: 6e20 456d 756c 6174 6f72 0a20 2020 2020  n Emulator.     
-00013b90: 2020 2069 6620 6e6f 7428 276c 6f63 616c     if not('local
-00013ba0: 686f 7374 2720 696e 2073 656c 662e 686f  host' in self.ho
-00013bb0: 7374 206f 7220 2731 3237 2e30 2e30 2e31  st or '127.0.0.1
-00013bc0: 2720 696e 2073 656c 662e 686f 7374 293a  ' in self.host):
-00013bd0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00013be0: 6e65 6374 696f 6e5f 706f 6c69 6379 203d  nection_policy =
-00013bf0: 2064 6f63 756d 656e 7473 2e43 6f6e 6e65   documents.Conne
-00013c00: 6374 696f 6e50 6f6c 6963 7928 290a 2020  ctionPolicy().  
-00013c10: 2020 2020 2020 2020 2020 2320 6d61 6b69            # maki
-00013c20: 6e67 2074 696d 656f 7574 2030 206d 7320  ng timeout 0 ms 
-00013c30: 746f 206d 616b 6520 7375 7265 2069 7420  to make sure it 
-00013c40: 7769 6c6c 2074 6872 6f77 0a20 2020 2020  will throw.     
-00013c50: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
-00013c60: 6e5f 706f 6c69 6379 2e52 6571 7565 7374  n_policy.Request
-00013c70: 5469 6d65 6f75 7420 3d20 2030 2e30 3030  Timeout =  0.000
-00013c80: 3030 3030 3030 3030 310a 0a20 2020 2020  000000001..     
-00013c90: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00013ca0: 2e61 7373 6572 7452 6169 7365 7328 4578  .assertRaises(Ex
-00013cb0: 6365 7074 696f 6e29 3a0a 2020 2020 2020  ception):.      
-00013cc0: 2020 2020 2020 2020 2020 2320 636c 6965            # clie
-00013cd0: 6e74 2064 6f65 7320 6120 6765 7444 6174  nt does a getDat
-00013ce0: 6162 6173 6541 6363 6f75 6e74 206f 6e20  abaseAccount on 
-00013cf0: 696e 6974 6961 6c69 7a61 7469 6f6e 2c20  initialization, 
-00013d00: 7768 6963 6820 7769 6c6c 2074 696d 6520  which will time 
-00013d10: 6f75 740a 2020 2020 2020 2020 2020 2020  out.            
-00013d20: 2020 2020 636f 736d 6f73 5f63 6c69 656e      cosmos_clien
-00013d30: 742e 436f 736d 6f73 436c 6965 6e74 2843  t.CosmosClient(C
-00013d40: 5255 4454 6573 7473 2e68 6f73 742c 2043  RUDTests.host, C
-00013d50: 5255 4454 6573 7473 2e6d 6173 7465 724b  RUDTests.masterK
-00013d60: 6579 2c20 2253 6573 7369 6f6e 222c 2063  ey, "Session", c
-00013d70: 6f6e 6e65 6374 696f 6e5f 706f 6c69 6379  onnection_policy
-00013d80: 3d63 6f6e 6e65 6374 696f 6e5f 706f 6c69  =connection_poli
-00013d90: 6379 290a 0a20 2020 2064 6566 2074 6573  cy)..    def tes
-00013da0: 745f 636c 6965 6e74 5f72 6571 7565 7374  t_client_request
-00013db0: 5f74 696d 656f 7574 5f77 6865 6e5f 636f  _timeout_when_co
-00013dc0: 6e6e 6563 7469 6f6e 5f72 6574 7279 5f63  nnection_retry_c
-00013dd0: 6f6e 6669 6775 7261 7469 6f6e 5f73 7065  onfiguration_spe
-00013de0: 6369 6669 6564 2873 656c 6629 3a0a 2020  cified(self):.  
-00013df0: 2020 2020 2020 636f 6e6e 6563 7469 6f6e        connection
-00013e00: 5f70 6f6c 6963 7920 3d20 646f 6375 6d65  _policy = docume
-00013e10: 6e74 732e 436f 6e6e 6563 7469 6f6e 506f  nts.ConnectionPo
-00013e20: 6c69 6379 2829 0a20 2020 2020 2020 2023  licy().        #
-00013e30: 206d 616b 696e 6720 7469 6d65 6f75 7420   making timeout 
-00013e40: 3020 6d73 2074 6f20 6d61 6b65 2073 7572  0 ms to make sur
-00013e50: 6520 6974 2077 696c 6c20 7468 726f 770a  e it will throw.
-00013e60: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
-00013e70: 6f6e 5f70 6f6c 6963 792e 5265 7175 6573  on_policy.Reques
-00013e80: 7454 696d 656f 7574 203d 2020 302e 3030  tTimeout =  0.00
-00013e90: 3030 3030 3030 3030 3031 0a20 2020 2020  0000000001.     
-00013ea0: 2020 2063 6f6e 6e65 6374 696f 6e5f 706f     connection_po
-00013eb0: 6c69 6379 2e43 6f6e 6e65 6374 696f 6e52  licy.ConnectionR
-00013ec0: 6574 7279 436f 6e66 6967 7572 6174 696f  etryConfiguratio
-00013ed0: 6e20 3d20 5265 7472 7928 0a20 2020 2020  n = Retry(.     
-00013ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013260: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00013270: 2020 2020 2020 2020 2020 2022 7061 7468             "path
+00013280: 223a 2022 2f70 6174 6834 222c 0a20 2020  ": "/path4",.   
+00013290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132a0: 2020 2020 2022 6f72 6465 7222 3a20 2261       "order": "a
+000132b0: 7363 656e 6469 6e67 220a 2020 2020 2020  scending".      
+000132c0: 2020 2020 2020 2020 2020 2020 2020 7d2c                },
+000132d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000132e0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+000132f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00013300: 7061 7468 223a 2022 2f70 6174 6835 222c  path": "/path5",
+00013310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013320: 2020 2020 2020 2020 2022 6f72 6465 7222           "order"
+00013330: 3a20 2264 6573 6365 6e64 696e 6722 0a20  : "descending". 
+00013340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013350: 2020 207d 2c0a 2020 2020 2020 2020 2020     },.          
+00013360: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
+00013370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013380: 2020 2020 2270 6174 6822 3a20 222f 7061      "path": "/pa
+00013390: 7468 3622 2c0a 2020 2020 2020 2020 2020  th6",.          
+000133a0: 2020 2020 2020 2020 2020 2020 2020 226f                "o
+000133b0: 7264 6572 223a 2022 6173 6365 6e64 696e  rder": "ascendin
+000133c0: 6722 0a20 2020 2020 2020 2020 2020 2020  g".             
+000133d0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+000133e0: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+000133f0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00013400: 207d 0a0a 2020 2020 2020 2020 6375 7374   }..        cust
+00013410: 6f6d 5f6c 6f67 6765 7220 3d20 6c6f 6767  om_logger = logg
+00013420: 696e 672e 6765 744c 6f67 6765 7228 2243  ing.getLogger("C
+00013430: 7573 746f 6d4c 6f67 6765 7222 290a 2020  ustomLogger").  
+00013440: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
+00013450: 6e74 6169 6e65 7220 3d20 6462 2e63 7265  ntainer = db.cre
+00013460: 6174 655f 636f 6e74 6169 6e65 7228 0a20  ate_container(. 
+00013470: 2020 2020 2020 2020 2020 2069 643d 2763             id='c
+00013480: 6f6d 706f 7369 7465 5f69 6e64 6578 5f73  omposite_index_s
+00013490: 7061 7469 616c 5f69 6e64 6578 2720 2b20  patial_index' + 
+000134a0: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
+000134b0: 292c 0a20 2020 2020 2020 2020 2020 2069  ),.            i
+000134c0: 6e64 6578 696e 675f 706f 6c69 6379 3d69  ndexing_policy=i
+000134d0: 6e64 6578 696e 675f 706f 6c69 6379 2c0a  ndexing_policy,.
+000134e0: 2020 2020 2020 2020 2020 2020 7061 7274              part
+000134f0: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
+00013500: 696f 6e4b 6579 2870 6174 683d 272f 6964  ionKey(path='/id
+00013510: 272c 206b 696e 643d 2748 6173 6827 292c  ', kind='Hash'),
+00013520: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
+00013530: 6465 7273 3d7b 2246 6f6f 223a 2262 6172  ders={"Foo":"bar
+00013540: 227d 2c0a 2020 2020 2020 2020 2020 2020  "},.            
+00013550: 7573 6572 5f61 6765 6e74 3d22 626c 6168  user_agent="blah
+00013560: 222c 0a20 2020 2020 2020 2020 2020 2075  ",.            u
+00013570: 7365 725f 6167 656e 745f 6f76 6572 7772  ser_agent_overwr
+00013580: 6974 653d 5472 7565 2c0a 2020 2020 2020  ite=True,.      
+00013590: 2020 2020 2020 6c6f 6767 696e 675f 656e        logging_en
+000135a0: 6162 6c65 3d54 7275 652c 0a20 2020 2020  able=True,.     
+000135b0: 2020 2020 2020 206c 6f67 6765 723d 6375         logger=cu
+000135c0: 7374 6f6d 5f6c 6f67 6765 722c 0a20 2020  stom_logger,.   
+000135d0: 2020 2020 2029 0a20 2020 2020 2020 2063       ).        c
+000135e0: 7265 6174 6564 5f70 726f 7065 7274 6965  reated_propertie
+000135f0: 7320 3d20 6372 6561 7465 645f 636f 6e74  s = created_cont
+00013600: 6169 6e65 722e 7265 6164 286c 6f67 6765  ainer.read(logge
+00013610: 723d 6375 7374 6f6d 5f6c 6f67 6765 7229  r=custom_logger)
+00013620: 0a20 2020 2020 2020 2072 6561 645f 696e  .        read_in
+00013630: 6465 7869 6e67 5f70 6f6c 6963 7920 3d20  dexing_policy = 
+00013640: 6372 6561 7465 645f 7072 6f70 6572 7469  created_properti
+00013650: 6573 5b27 696e 6465 7869 6e67 506f 6c69  es['indexingPoli
+00013660: 6379 275d 0a0a 2020 2020 2020 2020 6966  cy']..        if
+00013670: 2027 6c6f 6361 6c68 6f73 7427 2069 6e20   'localhost' in 
+00013680: 7365 6c66 2e68 6f73 7420 6f72 2027 3132  self.host or '12
+00013690: 372e 302e 302e 3127 2069 6e20 7365 6c66  7.0.0.1' in self
+000136a0: 2e68 6f73 743a 2020 2320 544f 444f 3a20  .host:  # TODO: 
+000136b0: 4469 6666 6572 696e 6720 7265 7375 6c74  Differing result
+000136c0: 2062 6574 7765 656e 206c 6976 6520 616e   between live an
+000136d0: 6420 656d 756c 6174 6f72 0a20 2020 2020  d emulator.     
+000136e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000136f0: 7274 4c69 7374 4571 7561 6c28 696e 6465  rtListEqual(inde
+00013700: 7869 6e67 5f70 6f6c 6963 795b 2773 7061  xing_policy['spa
+00013710: 7469 616c 496e 6465 7865 7327 5d2c 2072  tialIndexes'], r
+00013720: 6561 645f 696e 6465 7869 6e67 5f70 6f6c  ead_indexing_pol
+00013730: 6963 795b 2773 7061 7469 616c 496e 6465  icy['spatialInde
+00013740: 7865 7327 5d29 0a20 2020 2020 2020 2065  xes']).        e
+00013750: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00013760: 2023 2041 6c6c 2074 7970 6573 2061 7265   # All types are
+00013770: 2072 6574 7572 6e65 6420 666f 7220 7370   returned for sp
+00013780: 6174 6961 6c20 496e 6465 7865 730a 2020  atial Indexes.  
+00013790: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000137a0: 7373 6572 744c 6973 7445 7175 616c 2869  ssertListEqual(i
+000137b0: 6e64 6578 696e 675f 706f 6c69 6379 5b27  ndexing_policy['
+000137c0: 7370 6174 6961 6c49 6e64 6578 6573 275d  spatialIndexes']
+000137d0: 2c20 7265 6164 5f69 6e64 6578 696e 675f  , read_indexing_
+000137e0: 706f 6c69 6379 5b27 7370 6174 6961 6c49  policy['spatialI
+000137f0: 6e64 6578 6573 275d 290a 0a20 2020 2020  ndexes'])..     
+00013800: 2020 2073 656c 662e 6173 7365 7274 4c69     self.assertLi
+00013810: 7374 4571 7561 6c28 696e 6465 7869 6e67  stEqual(indexing
+00013820: 5f70 6f6c 6963 795b 2763 6f6d 706f 7369  _policy['composi
+00013830: 7465 496e 6465 7865 7327 5d2c 2072 6561  teIndexes'], rea
+00013840: 645f 696e 6465 7869 6e67 5f70 6f6c 6963  d_indexing_polic
+00013850: 795b 2763 6f6d 706f 7369 7465 496e 6465  y['compositeInde
+00013860: 7865 7327 5d29 0a20 2020 2020 2020 2064  xes']).        d
+00013870: 622e 6465 6c65 7465 5f63 6f6e 7461 696e  b.delete_contain
+00013880: 6572 2863 6f6e 7461 696e 6572 3d63 7265  er(container=cre
+00013890: 6174 6564 5f63 6f6e 7461 696e 6572 290a  ated_container).
+000138a0: 0a20 2020 2064 6566 205f 6368 6563 6b5f  .    def _check_
+000138b0: 6465 6661 756c 745f 696e 6465 7869 6e67  default_indexing
+000138c0: 5f70 6f6c 6963 795f 7061 7468 7328 7365  _policy_paths(se
+000138d0: 6c66 2c20 696e 6465 7869 6e67 5f70 6f6c  lf, indexing_pol
+000138e0: 6963 7929 3a0a 2020 2020 2020 2020 6465  icy):.        de
+000138f0: 6620 5f5f 6765 745f 6669 7273 7428 6172  f __get_first(ar
+00013900: 7261 7929 3a0a 2020 2020 2020 2020 2020  ray):.          
+00013910: 2020 6966 2061 7272 6179 3a0a 2020 2020    if array:.    
+00013920: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013930: 726e 2061 7272 6179 5b30 5d0a 2020 2020  rn array[0].    
+00013940: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00013950: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00013960: 7475 726e 204e 6f6e 650a 0a20 2020 2020  turn None..     
+00013970: 2020 2023 2027 2f5f 6574 6167 2720 6973     # '/_etag' is
+00013980: 2070 7265 7365 6e74 2069 6e20 6578 636c   present in excl
+00013990: 7564 6564 2070 6174 6873 2062 7920 6465  uded paths by de
+000139a0: 6661 756c 740a 2020 2020 2020 2020 7365  fault.        se
+000139b0: 6c66 2e61 7373 6572 7445 7175 616c 2831  lf.assertEqual(1
+000139c0: 2c20 6c65 6e28 696e 6465 7869 6e67 5f70  , len(indexing_p
+000139d0: 6f6c 6963 795b 2765 7863 6c75 6465 6450  olicy['excludedP
+000139e0: 6174 6873 275d 2929 0a20 2020 2020 2020  aths'])).       
+000139f0: 2023 2069 6e63 6c75 6465 6420 7061 7468   # included path
+00013a00: 7320 7368 6f75 6c64 2062 6520 313a 2027  s should be 1: '
+00013a10: 2f27 2e0a 2020 2020 2020 2020 7365 6c66  /'..        self
+00013a20: 2e61 7373 6572 7445 7175 616c 2831 2c20  .assertEqual(1, 
+00013a30: 6c65 6e28 696e 6465 7869 6e67 5f70 6f6c  len(indexing_pol
+00013a40: 6963 795b 2769 6e63 6c75 6465 6450 6174  icy['includedPat
+00013a50: 6873 275d 2929 0a0a 2020 2020 2020 2020  hs']))..        
+00013a60: 726f 6f74 5f69 6e63 6c75 6465 645f 7061  root_included_pa
+00013a70: 7468 203d 205f 5f67 6574 5f66 6972 7374  th = __get_first
+00013a80: 285b 696e 636c 7564 6564 5f70 6174 6820  ([included_path 
+00013a90: 666f 7220 696e 636c 7564 6564 5f70 6174  for included_pat
+00013aa0: 6820 696e 2069 6e64 6578 696e 675f 706f  h in indexing_po
+00013ab0: 6c69 6379 5b27 696e 636c 7564 6564 5061  licy['includedPa
+00013ac0: 7468 7327 5d0a 2020 2020 2020 2020 2020  ths'].          
+00013ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013af0: 6966 2069 6e63 6c75 6465 645f 7061 7468  if included_path
+00013b00: 5b27 7061 7468 275d 203d 3d20 272f 2a27  ['path'] == '/*'
+00013b10: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
+00013b20: 6173 7365 7274 4661 6c73 6528 726f 6f74  assertFalse(root
+00013b30: 5f69 6e63 6c75 6465 645f 7061 7468 2e67  _included_path.g
+00013b40: 6574 2827 696e 6465 7865 7327 2929 0a0a  et('indexes'))..
+00013b50: 2020 2020 6465 6620 7465 7374 5f63 6c69      def test_cli
+00013b60: 656e 745f 7265 7175 6573 745f 7469 6d65  ent_request_time
+00013b70: 6f75 7428 7365 6c66 293a 0a20 2020 2020  out(self):.     
+00013b80: 2020 2023 2054 6573 7420 6973 2066 6c61     # Test is fla
+00013b90: 6b79 206f 6e20 456d 756c 6174 6f72 0a20  ky on Emulator. 
+00013ba0: 2020 2020 2020 2069 6620 6e6f 7428 276c         if not('l
+00013bb0: 6f63 616c 686f 7374 2720 696e 2073 656c  ocalhost' in sel
+00013bc0: 662e 686f 7374 206f 7220 2731 3237 2e30  f.host or '127.0
+00013bd0: 2e30 2e31 2720 696e 2073 656c 662e 686f  .0.1' in self.ho
+00013be0: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
+00013bf0: 2063 6f6e 6e65 6374 696f 6e5f 706f 6c69   connection_poli
+00013c00: 6379 203d 2064 6f63 756d 656e 7473 2e43  cy = documents.C
+00013c10: 6f6e 6e65 6374 696f 6e50 6f6c 6963 7928  onnectionPolicy(
+00013c20: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00013c30: 6d61 6b69 6e67 2074 696d 656f 7574 2030  making timeout 0
+00013c40: 206d 7320 746f 206d 616b 6520 7375 7265   ms to make sure
+00013c50: 2069 7420 7769 6c6c 2074 6872 6f77 0a20   it will throw. 
+00013c60: 2020 2020 2020 2020 2020 2063 6f6e 6e65             conne
+00013c70: 6374 696f 6e5f 706f 6c69 6379 2e52 6571  ction_policy.Req
+00013c80: 7565 7374 5469 6d65 6f75 7420 3d20 2030  uestTimeout =  0
+00013c90: 2e30 3030 3030 3030 3030 3030 310a 0a20  .000000000001.. 
+00013ca0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00013cb0: 7365 6c66 2e61 7373 6572 7452 6169 7365  self.assertRaise
+00013cc0: 7328 4578 6365 7074 696f 6e29 3a0a 2020  s(Exception):.  
+00013cd0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00013ce0: 636c 6965 6e74 2064 6f65 7320 6120 6765  client does a ge
+00013cf0: 7444 6174 6162 6173 6541 6363 6f75 6e74  tDatabaseAccount
+00013d00: 206f 6e20 696e 6974 6961 6c69 7a61 7469   on initializati
+00013d10: 6f6e 2c20 7768 6963 6820 7769 6c6c 2074  on, which will t
+00013d20: 696d 6520 6f75 740a 2020 2020 2020 2020  ime out.        
+00013d30: 2020 2020 2020 2020 636f 736d 6f73 5f63          cosmos_c
+00013d40: 6c69 656e 742e 436f 736d 6f73 436c 6965  lient.CosmosClie
+00013d50: 6e74 2843 5255 4454 6573 7473 2e68 6f73  nt(CRUDTests.hos
+00013d60: 742c 2043 5255 4454 6573 7473 2e6d 6173  t, CRUDTests.mas
+00013d70: 7465 724b 6579 2c20 2253 6573 7369 6f6e  terKey, "Session
+00013d80: 222c 2063 6f6e 6e65 6374 696f 6e5f 706f  ", connection_po
+00013d90: 6c69 6379 3d63 6f6e 6e65 6374 696f 6e5f  licy=connection_
+00013da0: 706f 6c69 6379 290a 0a20 2020 2064 6566  policy)..    def
+00013db0: 2074 6573 745f 636c 6965 6e74 5f72 6571   test_client_req
+00013dc0: 7565 7374 5f74 696d 656f 7574 5f77 6865  uest_timeout_whe
+00013dd0: 6e5f 636f 6e6e 6563 7469 6f6e 5f72 6574  n_connection_ret
+00013de0: 7279 5f63 6f6e 6669 6775 7261 7469 6f6e  ry_configuration
+00013df0: 5f73 7065 6369 6669 6564 2873 656c 6629  _specified(self)
+00013e00: 3a0a 2020 2020 2020 2020 636f 6e6e 6563  :.        connec
+00013e10: 7469 6f6e 5f70 6f6c 6963 7920 3d20 646f  tion_policy = do
+00013e20: 6375 6d65 6e74 732e 436f 6e6e 6563 7469  cuments.Connecti
+00013e30: 6f6e 506f 6c69 6379 2829 0a20 2020 2020  onPolicy().     
+00013e40: 2020 2023 206d 616b 696e 6720 7469 6d65     # making time
+00013e50: 6f75 7420 3020 6d73 2074 6f20 6d61 6b65  out 0 ms to make
+00013e60: 2073 7572 6520 6974 2077 696c 6c20 7468   sure it will th
+00013e70: 726f 770a 2020 2020 2020 2020 636f 6e6e  row.        conn
+00013e80: 6563 7469 6f6e 5f70 6f6c 6963 792e 5265  ection_policy.Re
+00013e90: 7175 6573 7454 696d 656f 7574 203d 2020  questTimeout =  
+00013ea0: 302e 3030 3030 3030 3030 3030 3031 0a20  0.000000000001. 
+00013eb0: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
+00013ec0: 6e5f 706f 6c69 6379 2e43 6f6e 6e65 6374  n_policy.Connect
+00013ed0: 696f 6e52 6574 7279 436f 6e66 6967 7572  ionRetryConfigur
+00013ee0: 6174 696f 6e20 3d20 5265 7472 7928 0a20  ation = Retry(. 
 00013ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f10: 2020 2020 2020 2074 6f74 616c 3d33 2c0a         total=3,.
-00013f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f20: 2020 2020 2020 2020 2020 2074 6f74 616c             total
+00013f30: 3d33 2c0a 2020 2020 2020 2020 2020 2020  =3,.            
 00013f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f50: 2020 2020 2020 2020 2020 2020 7265 6164              read
-00013f60: 3d33 2c0a 2020 2020 2020 2020 2020 2020  =3,.            
-00013f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f70: 7265 6164 3d33 2c0a 2020 2020 2020 2020  read=3,.        
 00013f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fa0: 636f 6e6e 6563 743d 332c 0a20 2020 2020  connect=3,.     
-00013fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fb0: 2020 2020 636f 6e6e 6563 743d 332c 0a20      connect=3,. 
 00013fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fe0: 2020 2020 2020 2062 6163 6b6f 6666 5f66         backoff_f
-00013ff0: 6163 746f 723d 302e 332c 0a20 2020 2020  actor=0.3,.     
-00014000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ff0: 2020 2020 2020 2020 2020 2062 6163 6b6f             backo
+00014000: 6666 5f66 6163 746f 723d 302e 332c 0a20  ff_factor=0.3,. 
 00014010: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00014020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014030: 2020 2020 2020 2073 7461 7475 735f 666f         status_fo
-00014040: 7263 656c 6973 743d 2835 3030 2c20 3530  rcelist=(500, 50
-00014050: 322c 2035 3034 290a 2020 2020 2020 2020  2, 504).        
-00014060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014040: 2020 2020 2020 2020 2020 2073 7461 7475             statu
+00014050: 735f 666f 7263 656c 6973 743d 2835 3030  s_forcelist=(500
+00014060: 2c20 3530 322c 2035 3034 290a 2020 2020  , 502, 504).    
 00014070: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00014080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014090: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
-000140a0: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-000140b0: 2841 7a75 7265 4572 726f 7229 3a0a 2020  (AzureError):.  
-000140c0: 2020 2020 2020 2020 2020 2320 636c 6965            # clie
-000140d0: 6e74 2064 6f65 7320 6120 6765 7444 6174  nt does a getDat
-000140e0: 6162 6173 6541 6363 6f75 6e74 206f 6e20  abaseAccount on 
-000140f0: 696e 6974 6961 6c69 7a61 7469 6f6e 2c20  initialization, 
-00014100: 7768 6963 6820 7769 6c6c 2074 696d 6520  which will time 
-00014110: 6f75 740a 2020 2020 2020 2020 2020 2020  out.            
-00014120: 636f 736d 6f73 5f63 6c69 656e 742e 436f  cosmos_client.Co
-00014130: 736d 6f73 436c 6965 6e74 2843 5255 4454  smosClient(CRUDT
-00014140: 6573 7473 2e68 6f73 742c 2043 5255 4454  ests.host, CRUDT
-00014150: 6573 7473 2e6d 6173 7465 724b 6579 2c20  ests.masterKey, 
-00014160: 2253 6573 7369 6f6e 222c 2063 6f6e 6e65  "Session", conne
-00014170: 6374 696f 6e5f 706f 6c69 6379 3d63 6f6e  ction_policy=con
-00014180: 6e65 6374 696f 6e5f 706f 6c69 6379 290a  nection_policy).
-00014190: 0a20 2020 2064 6566 2074 6573 745f 636c  .    def test_cl
-000141a0: 6965 6e74 5f63 6f6e 6e65 6374 696f 6e5f  ient_connection_
-000141b0: 7265 7472 795f 636f 6e66 6967 7572 6174  retry_configurat
-000141c0: 696f 6e28 7365 6c66 293a 0a20 2020 2020  ion(self):.     
-000141d0: 2020 2074 6f74 616c 5f74 696d 655f 666f     total_time_fo
-000141e0: 725f 7477 6f5f 7265 7472 6965 7320 3d20  r_two_retries = 
-000141f0: 7365 6c66 2e69 6e69 7469 616c 697a 655f  self.initialize_
-00014200: 636c 6965 6e74 5f77 6974 685f 636f 6e6e  client_with_conn
-00014210: 6563 7469 6f6e 5f63 6f72 655f 7265 7472  ection_core_retr
-00014220: 795f 636f 6e66 6967 2832 290a 2020 2020  y_config(2).    
-00014230: 2020 2020 746f 7461 6c5f 7469 6d65 5f66      total_time_f
-00014240: 6f72 5f74 6872 6565 5f72 6574 7269 6573  or_three_retries
-00014250: 203d 2073 656c 662e 696e 6974 6961 6c69   = self.initiali
-00014260: 7a65 5f63 6c69 656e 745f 7769 7468 5f63  ze_client_with_c
-00014270: 6f6e 6e65 6374 696f 6e5f 636f 7265 5f72  onnection_core_r
-00014280: 6574 7279 5f63 6f6e 6669 6728 3329 0a20  etry_config(3). 
-00014290: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000142a0: 7274 4772 6561 7465 7228 746f 7461 6c5f  rtGreater(total_
-000142b0: 7469 6d65 5f66 6f72 5f74 6872 6565 5f72  time_for_three_r
-000142c0: 6574 7269 6573 2c20 746f 7461 6c5f 7469  etries, total_ti
-000142d0: 6d65 5f66 6f72 5f74 776f 5f72 6574 7269  me_for_two_retri
-000142e0: 6573 290a 0a0a 2020 2020 6465 6620 696e  es)...    def in
-000142f0: 6974 6961 6c69 7a65 5f63 6c69 656e 745f  itialize_client_
-00014300: 7769 7468 5f63 6f6e 6e65 6374 696f 6e5f  with_connection_
-00014310: 636f 7265 5f72 6574 7279 5f63 6f6e 6669  core_retry_confi
-00014320: 6728 7365 6c66 2c20 7265 7472 6965 7329  g(self, retries)
-00014330: 3a0a 2020 2020 2020 2020 7374 6172 745f  :.        start_
-00014340: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
-00014350: 2829 0a20 2020 2020 2020 2074 7279 3a0a  ().        try:.
-00014360: 2020 2020 2020 2020 2020 2020 636f 736d              cosm
-00014370: 6f73 5f63 6c69 656e 742e 436f 736d 6f73  os_client.Cosmos
-00014380: 436c 6965 6e74 280a 2020 2020 2020 2020  Client(.        
-00014390: 2020 2020 2020 2020 2268 7474 7073 3a2f          "https:/
-000143a0: 2f6c 6f63 616c 686f 7374 3a39 3939 3922  /localhost:9999"
-000143b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000143c0: 2020 4352 5544 5465 7374 732e 6d61 7374    CRUDTests.mast
-000143d0: 6572 4b65 792c 0a20 2020 2020 2020 2020  erKey,.         
-000143e0: 2020 2020 2020 2022 5365 7373 696f 6e22         "Session"
-000143f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014400: 2020 7265 7472 795f 746f 7461 6c3d 7265    retry_total=re
-00014410: 7472 6965 732c 0a20 2020 2020 2020 2020  tries,.         
-00014420: 2020 2020 2020 2072 6574 7279 5f72 6561         retry_rea
-00014430: 643d 7265 7472 6965 732c 0a20 2020 2020  d=retries,.     
-00014440: 2020 2020 2020 2020 2020 2072 6574 7279             retry
-00014450: 5f63 6f6e 6e65 6374 3d72 6574 7269 6573  _connect=retries
-00014460: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014470: 2020 7265 7472 795f 7374 6174 7573 3d72    retry_status=r
-00014480: 6574 7269 6573 290a 2020 2020 2020 2020  etries).        
-00014490: 2020 2020 7365 6c66 2e66 6169 6c28 290a      self.fail().
-000144a0: 2020 2020 2020 2020 6578 6365 7074 2041          except A
-000144b0: 7a75 7265 4572 726f 7220 6173 2065 3a0a  zureError as e:.
-000144c0: 2020 2020 2020 2020 2020 2020 656e 645f              end_
-000144d0: 7469 6d65 203d 2074 696d 652e 7469 6d65  time = time.time
-000144e0: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
-000144f0: 6574 7572 6e20 656e 645f 7469 6d65 202d  eturn end_time -
-00014500: 2073 7461 7274 5f74 696d 650a 0a20 2020   start_time..   
-00014510: 2064 6566 2074 6573 745f 6162 736f 6c75   def test_absolu
-00014520: 7465 5f63 6c69 656e 745f 7469 6d65 6f75  te_client_timeou
-00014530: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
-00014540: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-00014550: 7452 6169 7365 7328 6578 6365 7074 696f  tRaises(exceptio
-00014560: 6e73 2e43 6f73 6d6f 7343 6c69 656e 7454  ns.CosmosClientT
-00014570: 696d 656f 7574 4572 726f 7229 3a0a 2020  imeoutError):.  
-00014580: 2020 2020 2020 2020 2020 636f 736d 6f73            cosmos
-00014590: 5f63 6c69 656e 742e 436f 736d 6f73 436c  _client.CosmosCl
-000145a0: 6965 6e74 280a 2020 2020 2020 2020 2020  ient(.          
-000145b0: 2020 2020 2020 2268 7474 7073 3a2f 2f6c        "https://l
-000145c0: 6f63 616c 686f 7374 3a39 3939 3922 2c0a  ocalhost:9999",.
-000145d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145e0: 4352 5544 5465 7374 732e 6d61 7374 6572  CRUDTests.master
-000145f0: 4b65 792c 0a20 2020 2020 2020 2020 2020  Key,.           
-00014600: 2020 2020 2022 5365 7373 696f 6e22 2c0a       "Session",.
-00014610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014620: 7265 7472 795f 746f 7461 6c3d 332c 0a20  retry_total=3,. 
-00014630: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00014640: 696d 656f 7574 3d31 290a 0a20 2020 2020  imeout=1)..     
-00014650: 2020 2065 7272 6f72 5f72 6573 706f 6e73     error_respons
-00014660: 6520 3d20 5365 7276 6963 6552 6573 706f  e = ServiceRespo
-00014670: 6e73 6545 7272 6f72 2822 5265 6164 2074  nseError("Read t
-00014680: 696d 656f 7574 2229 0a20 2020 2020 2020  imeout").       
-00014690: 2074 696d 656f 7574 5f74 7261 6e73 706f   timeout_transpo
-000146a0: 7274 203d 2054 696d 656f 7574 5472 616e  rt = TimeoutTran
-000146b0: 7370 6f72 7428 6572 726f 725f 7265 7370  sport(error_resp
-000146c0: 6f6e 7365 290a 2020 2020 2020 2020 636c  onse).        cl
-000146d0: 6965 6e74 203d 2063 6f73 6d6f 735f 636c  ient = cosmos_cl
-000146e0: 6965 6e74 2e43 6f73 6d6f 7343 6c69 656e  ient.CosmosClien
-000146f0: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
-00014700: 656c 662e 686f 7374 2c20 7365 6c66 2e6d  elf.host, self.m
-00014710: 6173 7465 724b 6579 2c20 2253 6573 7369  asterKey, "Sessi
-00014720: 6f6e 222c 2074 7261 6e73 706f 7274 3d74  on", transport=t
-00014730: 696d 656f 7574 5f74 7261 6e73 706f 7274  imeout_transport
-00014740: 2c20 7061 7373 7468 726f 7567 683d 5472  , passthrough=Tr
-00014750: 7565 290a 0a20 2020 2020 2020 2077 6974  ue)..        wit
-00014760: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-00014770: 7365 7328 6578 6365 7074 696f 6e73 2e43  ses(exceptions.C
-00014780: 6f73 6d6f 7343 6c69 656e 7454 696d 656f  osmosClientTimeo
-00014790: 7574 4572 726f 7229 3a0a 2020 2020 2020  utError):.      
-000147a0: 2020 2020 2020 636c 6965 6e74 2e63 7265        client.cre
-000147b0: 6174 655f 6461 7461 6261 7365 5f69 665f  ate_database_if_
-000147c0: 6e6f 745f 6578 6973 7473 2822 7465 7374  not_exists("test
-000147d0: 222c 2074 696d 656f 7574 3d32 290a 0a20  ", timeout=2).. 
-000147e0: 2020 2020 2020 2073 7461 7475 735f 7265         status_re
-000147f0: 7370 6f6e 7365 203d 2035 3030 2020 2320  sponse = 500  # 
-00014800: 5573 6572 7320 636f 6e6e 6563 7469 6f6e  Users connection
-00014810: 206c 6576 656c 2072 6574 7279 0a20 2020   level retry.   
-00014820: 2020 2020 2074 696d 656f 7574 5f74 7261       timeout_tra
-00014830: 6e73 706f 7274 203d 2054 696d 656f 7574  nsport = Timeout
-00014840: 5472 616e 7370 6f72 7428 7374 6174 7573  Transport(status
-00014850: 5f72 6573 706f 6e73 6529 0a20 2020 2020  _response).     
-00014860: 2020 2063 6c69 656e 7420 3d20 636f 736d     client = cosm
-00014870: 6f73 5f63 6c69 656e 742e 436f 736d 6f73  os_client.Cosmos
-00014880: 436c 6965 6e74 280a 2020 2020 2020 2020  Client(.        
-00014890: 2020 2020 7365 6c66 2e68 6f73 742c 2073      self.host, s
-000148a0: 656c 662e 6d61 7374 6572 4b65 792c 2022  elf.masterKey, "
-000148b0: 5365 7373 696f 6e22 2c20 7472 616e 7370  Session", transp
-000148c0: 6f72 743d 7469 6d65 6f75 745f 7472 616e  ort=timeout_tran
-000148d0: 7370 6f72 742c 2070 6173 7374 6872 6f75  sport, passthrou
-000148e0: 6768 3d54 7275 6529 0a20 2020 2020 2020  gh=True).       
-000148f0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-00014900: 7452 6169 7365 7328 6578 6365 7074 696f  tRaises(exceptio
-00014910: 6e73 2e43 6f73 6d6f 7343 6c69 656e 7454  ns.CosmosClientT
-00014920: 696d 656f 7574 4572 726f 7229 3a0a 2020  imeoutError):.  
-00014930: 2020 2020 2020 2020 2020 636c 6965 6e74            client
-00014940: 2e63 7265 6174 655f 6461 7461 6261 7365  .create_database
-00014950: 2822 7465 7374 222c 2074 696d 656f 7574  ("test", timeout
-00014960: 3d32 290a 0a20 2020 2020 2020 2064 6174  =2)..        dat
-00014970: 6162 6173 6573 203d 2063 6c69 656e 742e  abases = client.
-00014980: 6c69 7374 5f64 6174 6162 6173 6573 2874  list_databases(t
-00014990: 696d 656f 7574 3d32 290a 2020 2020 2020  imeout=2).      
-000149a0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-000149b0: 7274 5261 6973 6573 2865 7863 6570 7469  rtRaises(excepti
-000149c0: 6f6e 732e 436f 736d 6f73 436c 6965 6e74  ons.CosmosClient
-000149d0: 5469 6d65 6f75 7445 7272 6f72 293a 0a20  TimeoutError):. 
-000149e0: 2020 2020 2020 2020 2020 206c 6973 7428             list(
-000149f0: 6461 7461 6261 7365 7329 0a0a 2020 2020  databases)..    
-00014a00: 2020 2020 7374 6174 7573 5f72 6573 706f      status_respo
-00014a10: 6e73 6520 3d20 3432 3920 2023 2055 7365  nse = 429  # Use
-00014a20: 7320 436f 736d 6f73 2063 7573 746f 6d20  s Cosmos custom 
-00014a30: 7265 7472 790a 2020 2020 2020 2020 7469  retry.        ti
-00014a40: 6d65 6f75 745f 7472 616e 7370 6f72 7420  meout_transport 
-00014a50: 3d20 5469 6d65 6f75 7454 7261 6e73 706f  = TimeoutTranspo
-00014a60: 7274 2873 7461 7475 735f 7265 7370 6f6e  rt(status_respon
-00014a70: 7365 290a 2020 2020 2020 2020 636c 6965  se).        clie
-00014a80: 6e74 203d 2063 6f73 6d6f 735f 636c 6965  nt = cosmos_clie
-00014a90: 6e74 2e43 6f73 6d6f 7343 6c69 656e 7428  nt.CosmosClient(
-00014aa0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00014ab0: 662e 686f 7374 2c20 7365 6c66 2e6d 6173  f.host, self.mas
-00014ac0: 7465 724b 6579 2c20 2253 6573 7369 6f6e  terKey, "Session
-00014ad0: 222c 2074 7261 6e73 706f 7274 3d74 696d  ", transport=tim
-00014ae0: 656f 7574 5f74 7261 6e73 706f 7274 2c20  eout_transport, 
-00014af0: 7061 7373 7468 726f 7567 683d 5472 7565  passthrough=True
-00014b00: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
-00014b10: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-00014b20: 2865 7863 6570 7469 6f6e 732e 436f 736d  (exceptions.Cosm
-00014b30: 6f73 436c 6965 6e74 5469 6d65 6f75 7445  osClientTimeoutE
-00014b40: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-00014b50: 2020 2063 6c69 656e 742e 6372 6561 7465     client.create
-00014b60: 5f64 6174 6162 6173 655f 6966 5f6e 6f74  _database_if_not
-00014b70: 5f65 7869 7374 7328 2274 6573 7422 2c20  _exists("test", 
-00014b80: 7469 6d65 6f75 743d 3229 0a0a 2020 2020  timeout=2)..    
-00014b90: 2020 2020 6461 7461 6261 7365 7320 3d20      databases = 
-00014ba0: 636c 6965 6e74 2e6c 6973 745f 6461 7461  client.list_data
-00014bb0: 6261 7365 7328 7469 6d65 6f75 743d 3229  bases(timeout=2)
-00014bc0: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-00014bd0: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
-00014be0: 6578 6365 7074 696f 6e73 2e43 6f73 6d6f  exceptions.Cosmo
-00014bf0: 7343 6c69 656e 7454 696d 656f 7574 4572  sClientTimeoutEr
-00014c00: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-00014c10: 2020 6c69 7374 2864 6174 6162 6173 6573    list(databases
-00014c20: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00014c30: 7175 6572 795f 6974 6572 6162 6c65 5f66  query_iterable_f
-00014c40: 756e 6374 696f 6e61 6c69 7479 2873 656c  unctionality(sel
-00014c50: 6629 3a0a 2020 2020 2020 2020 6465 6620  f):.        def 
-00014c60: 5f5f 6372 6561 7465 5f72 6573 6f75 7263  __create_resourc
-00014c70: 6573 2863 6c69 656e 7429 3a0a 2020 2020  es(client):.    
-00014c80: 2020 2020 2020 2020 2222 2243 7265 6174          """Creat
-00014c90: 6573 2072 6573 6f75 7263 6573 2066 6f72  es resources for
-00014ca0: 2074 6869 7320 7465 7374 2e0a 0a20 2020   this test...   
-00014cb0: 2020 2020 2020 2020 203a 5061 7261 6d65           :Parame
-00014cc0: 7465 7273 3a0a 2020 2020 2020 2020 2020  ters:.          
-00014cd0: 2020 2020 2020 2d20 6063 6c69 656e 7460        - `client`
-00014ce0: 3a20 636f 736d 6f73 5f63 6c69 656e 745f  : cosmos_client_
-00014cf0: 636f 6e6e 6563 7469 6f6e 2e43 6f73 6d6f  connection.Cosmo
-00014d00: 7343 6c69 656e 7443 6f6e 6e65 6374 696f  sClientConnectio
-00014d10: 6e0a 0a20 2020 2020 2020 2020 2020 203a  n..            :
-00014d20: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
-00014d30: 2020 2020 2020 2020 2064 6963 740a 0a20           dict.. 
-00014d40: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
-00014d50: 2020 2020 2020 2020 2020 2063 6f6c 6c65             colle
-00014d60: 6374 696f 6e20 3d20 7365 6c66 2e63 6f6e  ction = self.con
-00014d70: 6669 6773 2e63 7265 6174 655f 6d75 6c74  figs.create_mult
-00014d80: 695f 7061 7274 6974 696f 6e5f 636f 6c6c  i_partition_coll
-00014d90: 6563 7469 6f6e 5f77 6974 685f 6375 7374  ection_with_cust
-00014da0: 6f6d 5f70 6b5f 6966 5f6e 6f74 5f65 7869  om_pk_if_not_exi
-00014db0: 7374 2873 656c 662e 636c 6965 6e74 290a  st(self.client).
-00014dc0: 2020 2020 2020 2020 2020 2020 646f 6331              doc1
-00014dd0: 203d 2063 6f6c 6c65 6374 696f 6e2e 6372   = collection.cr
-00014de0: 6561 7465 5f69 7465 6d28 626f 6479 3d7b  eate_item(body={
-00014df0: 2769 6427 3a20 2764 6f63 3127 2c20 2770  'id': 'doc1', 'p
-00014e00: 726f 7031 273a 2027 7661 6c75 6531 277d  rop1': 'value1'}
-00014e10: 290a 2020 2020 2020 2020 2020 2020 646f  ).            do
-00014e20: 6332 203d 2063 6f6c 6c65 6374 696f 6e2e  c2 = collection.
-00014e30: 6372 6561 7465 5f69 7465 6d28 626f 6479  create_item(body
-00014e40: 3d7b 2769 6427 3a20 2764 6f63 3227 2c20  ={'id': 'doc2', 
-00014e50: 2770 726f 7031 273a 2027 7661 6c75 6532  'prop1': 'value2
-00014e60: 277d 290a 2020 2020 2020 2020 2020 2020  '}).            
-00014e70: 646f 6333 203d 2063 6f6c 6c65 6374 696f  doc3 = collectio
-00014e80: 6e2e 6372 6561 7465 5f69 7465 6d28 626f  n.create_item(bo
-00014e90: 6479 3d7b 2769 6427 3a20 2764 6f63 3327  dy={'id': 'doc3'
-00014ea0: 2c20 2770 726f 7031 273a 2027 7661 6c75  , 'prop1': 'valu
-00014eb0: 6533 277d 290a 2020 2020 2020 2020 2020  e3'}).          
-00014ec0: 2020 7265 736f 7572 6365 7320 3d20 7b0a    resources = {.
-00014ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ee0: 2763 6f6c 6c27 3a20 636f 6c6c 6563 7469  'coll': collecti
-00014ef0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00014f00: 2020 2020 2764 6f63 3127 3a20 646f 6331      'doc1': doc1
-00014f10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014f20: 2020 2764 6f63 3227 3a20 646f 6332 2c0a    'doc2': doc2,.
-00014f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f40: 2764 6f63 3327 3a20 646f 6333 0a20 2020  'doc3': doc3.   
-00014f50: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-00014f60: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00014f70: 736f 7572 6365 730a 0a20 2020 2020 2020  sources..       
-00014f80: 2023 2056 616c 6964 6174 6520 5175 6572   # Validate Quer
-00014f90: 7949 7465 7261 626c 6520 6279 2063 6f6e  yIterable by con
-00014fa0: 7665 7274 696e 6720 6974 2074 6f20 6120  verting it to a 
-00014fb0: 6c69 7374 2e0a 2020 2020 2020 2020 7265  list..        re
-00014fc0: 736f 7572 6365 7320 3d20 5f5f 6372 6561  sources = __crea
-00014fd0: 7465 5f72 6573 6f75 7263 6573 2873 656c  te_resources(sel
-00014fe0: 662e 636c 6965 6e74 290a 2020 2020 2020  f.client).      
-00014ff0: 2020 7265 7375 6c74 7320 3d20 7265 736f    results = reso
-00015000: 7572 6365 735b 2763 6f6c 6c27 5d2e 7265  urces['coll'].re
-00015010: 6164 5f61 6c6c 5f69 7465 6d73 286d 6178  ad_all_items(max
-00015020: 5f69 7465 6d5f 636f 756e 743d 3229 0a20  _item_count=2). 
-00015030: 2020 2020 2020 2064 6f63 7320 3d20 6c69         docs = li
-00015040: 7374 2869 7465 7228 7265 7375 6c74 7329  st(iter(results)
-00015050: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00015060: 7373 6572 7445 7175 616c 2833 2c0a 2020  ssertEqual(3,.  
-00015070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015080: 2020 2020 2020 206c 656e 2864 6f63 7329         len(docs)
-00015090: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000150a0: 2020 2020 2020 2020 2020 2027 5175 6572             'Quer
-000150b0: 7949 7465 7261 626c 6520 7368 6f75 6c64  yIterable should
-000150c0: 2072 6574 7572 6e20 616c 6c20 646f 6375   return all docu
-000150d0: 6d65 6e74 7327 202b 0a20 2020 2020 2020  ments' +.       
-000150e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150f0: 2020 2720 7573 696e 6720 636f 6e74 696e    ' using contin
-00015100: 7561 7469 6f6e 2729 0a20 2020 2020 2020  uation').       
-00015110: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00015120: 6c28 7265 736f 7572 6365 735b 2764 6f63  l(resources['doc
-00015130: 3127 5d5b 2769 6427 5d2c 2064 6f63 735b  1']['id'], docs[
-00015140: 305d 5b27 6964 275d 290a 2020 2020 2020  0]['id']).      
-00015150: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00015160: 616c 2872 6573 6f75 7263 6573 5b27 646f  al(resources['do
-00015170: 6332 275d 5b27 6964 275d 2c20 646f 6373  c2']['id'], docs
-00015180: 5b31 5d5b 2769 6427 5d29 0a20 2020 2020  [1]['id']).     
-00015190: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000151a0: 7561 6c28 7265 736f 7572 6365 735b 2764  ual(resources['d
-000151b0: 6f63 3327 5d5b 2769 6427 5d2c 2064 6f63  oc3']['id'], doc
-000151c0: 735b 325d 5b27 6964 275d 290a 0a20 2020  s[2]['id'])..   
-000151d0: 2020 2020 2023 2056 616c 6964 6174 6520       # Validate 
-000151e0: 5175 6572 7949 7465 7261 626c 6520 6974  QueryIterable it
-000151f0: 6572 6174 6f72 2077 6974 6820 2766 6f72  erator with 'for
-00015200: 272e 0a20 2020 2020 2020 2072 6573 756c  '..        resul
-00015210: 7473 203d 2072 6573 6f75 7263 6573 5b27  ts = resources['
-00015220: 636f 6c6c 275d 2e72 6561 645f 616c 6c5f  coll'].read_all_
-00015230: 6974 656d 7328 6d61 785f 6974 656d 5f63  items(max_item_c
-00015240: 6f75 6e74 3d32 290a 2020 2020 2020 2020  ount=2).        
-00015250: 636f 756e 7465 7220 3d20 300a 2020 2020  counter = 0.    
-00015260: 2020 2020 2320 7465 7374 2051 7565 7279      # test Query
-00015270: 4974 6572 6162 6c65 2077 6974 6820 2766  Iterable with 'f
-00015280: 6f72 272e 0a20 2020 2020 2020 2066 6f72  or'..        for
-00015290: 2064 6f63 2069 6e20 6974 6572 2872 6573   doc in iter(res
-000152a0: 756c 7473 293a 0a20 2020 2020 2020 2020  ults):.         
-000152b0: 2020 2063 6f75 6e74 6572 202b 3d20 310a     counter += 1.
-000152c0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-000152d0: 6f75 6e74 6572 203d 3d20 313a 0a20 2020  ounter == 1:.   
-000152e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000152f0: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-00015300: 736f 7572 6365 735b 2764 6f63 3127 5d5b  sources['doc1'][
-00015310: 2769 6427 5d2c 0a20 2020 2020 2020 2020  'id'],.         
-00015320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015330: 2020 2020 2020 2020 646f 635b 2769 6427          doc['id'
-00015340: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00015350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015360: 2020 2020 2766 6972 7374 2064 6f63 756d      'first docum
-00015370: 656e 7420 7368 6f75 6c64 2062 6520 646f  ent should be do
-00015380: 6331 2729 0a20 2020 2020 2020 2020 2020  c1').           
-00015390: 2065 6c69 6620 636f 756e 7465 7220 3d3d   elif counter ==
-000153a0: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-000153b0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000153c0: 7175 616c 2872 6573 6f75 7263 6573 5b27  qual(resources['
-000153d0: 646f 6332 275d 5b27 6964 275d 2c0a 2020  doc2']['id'],.  
-000153e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153f0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00015400: 6f63 5b27 6964 275d 2c0a 2020 2020 2020  oc['id'],.      
-00015410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015420: 2020 2020 2020 2020 2020 2027 7365 636f             'seco
-00015430: 6e64 2064 6f63 756d 656e 7420 7368 6f75  nd document shou
-00015440: 6c64 2062 6520 646f 6332 2729 0a20 2020  ld be doc2').   
-00015450: 2020 2020 2020 2020 2065 6c69 6620 636f           elif co
-00015460: 756e 7465 7220 3d3d 2033 3a0a 2020 2020  unter == 3:.    
-00015470: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00015480: 2e61 7373 6572 7445 7175 616c 2872 6573  .assertEqual(res
-00015490: 6f75 7263 6573 5b27 646f 6333 275d 5b27  ources['doc3']['
-000154a0: 6964 275d 2c0a 2020 2020 2020 2020 2020  id'],.          
-000154b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154c0: 2020 2020 2020 2064 6f63 5b27 6964 275d         doc['id']
-000154d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000154e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154f0: 2020 2027 7468 6972 6420 646f 6375 6d65     'third docume
-00015500: 6e74 2073 686f 756c 6420 6265 2064 6f63  nt should be doc
-00015510: 3327 290a 2020 2020 2020 2020 7365 6c66  3').        self
-00015520: 2e61 7373 6572 7445 7175 616c 2863 6f75  .assertEqual(cou
-00015530: 6e74 6572 2c20 3329 0a0a 2020 2020 2020  nter, 3)..      
-00015540: 2020 2320 4765 7420 7175 6572 7920 7265    # Get query re
-00015550: 7375 6c74 7320 7061 6765 2062 7920 7061  sults page by pa
-00015560: 6765 2e0a 2020 2020 2020 2020 7265 7375  ge..        resu
-00015570: 6c74 7320 3d20 7265 736f 7572 6365 735b  lts = resources[
-00015580: 2763 6f6c 6c27 5d2e 7265 6164 5f61 6c6c  'coll'].read_all
-00015590: 5f69 7465 6d73 286d 6178 5f69 7465 6d5f  _items(max_item_
-000155a0: 636f 756e 743d 3229 0a0a 2020 2020 2020  count=2)..      
-000155b0: 2020 7061 6765 5f69 7465 7220 3d20 7265    page_iter = re
-000155c0: 7375 6c74 732e 6279 5f70 6167 6528 290a  sults.by_page().
-000155d0: 2020 2020 2020 2020 6669 7273 745f 626c          first_bl
-000155e0: 6f63 6b20 3d20 6c69 7374 286e 6578 7428  ock = list(next(
-000155f0: 7061 6765 5f69 7465 7229 290a 2020 2020  page_iter)).    
-00015600: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00015610: 7175 616c 2832 2c20 6c65 6e28 6669 7273  qual(2, len(firs
-00015620: 745f 626c 6f63 6b29 2c20 2746 6972 7374  t_block), 'First
-00015630: 2062 6c6f 636b 2073 686f 756c 6420 6861   block should ha
-00015640: 7665 2032 2065 6e74 7269 6573 2e27 290a  ve 2 entries.').
-00015650: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00015660: 6572 7445 7175 616c 2872 6573 6f75 7263  ertEqual(resourc
-00015670: 6573 5b27 646f 6331 275d 5b27 6964 275d  es['doc1']['id']
-00015680: 2c20 6669 7273 745f 626c 6f63 6b5b 305d  , first_block[0]
-00015690: 5b27 6964 275d 290a 2020 2020 2020 2020  ['id']).        
-000156a0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000156b0: 2872 6573 6f75 7263 6573 5b27 646f 6332  (resources['doc2
-000156c0: 275d 5b27 6964 275d 2c20 6669 7273 745f  ']['id'], first_
-000156d0: 626c 6f63 6b5b 315d 5b27 6964 275d 290a  block[1]['id']).
-000156e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000156f0: 6572 7445 7175 616c 2831 2c20 6c65 6e28  ertEqual(1, len(
-00015700: 6c69 7374 286e 6578 7428 7061 6765 5f69  list(next(page_i
-00015710: 7465 7229 2929 2c20 2753 6563 6f6e 6420  ter))), 'Second 
-00015720: 626c 6f63 6b20 7368 6f75 6c64 2068 6176  block should hav
-00015730: 6520 3120 656e 7472 792e 2729 0a20 2020  e 1 entry.').   
-00015740: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
-00015750: 7373 6572 7452 6169 7365 7328 5374 6f70  ssertRaises(Stop
-00015760: 4974 6572 6174 696f 6e29 3a0a 2020 2020  Iteration):.    
-00015770: 2020 2020 2020 2020 6e65 7874 2870 6167          next(pag
-00015780: 655f 6974 6572 290a 0a20 2020 2064 6566  e_iter)..    def
-00015790: 2074 6573 745f 7472 6967 6765 725f 6675   test_trigger_fu
-000157a0: 6e63 7469 6f6e 616c 6974 7928 7365 6c66  nctionality(self
-000157b0: 293a 0a20 2020 2020 2020 2074 7269 6767  ):.        trigg
-000157c0: 6572 735f 696e 5f63 6f6c 6c65 6374 696f  ers_in_collectio
-000157d0: 6e31 203d 205b 0a20 2020 2020 2020 2020  n1 = [.         
-000157e0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
-000157f0: 2020 2020 2027 6964 273a 2027 7431 272c       'id': 't1',
-00015800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015810: 2027 626f 6479 273a 2028 0a20 2020 2020   'body': (.     
-00015820: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00015830: 6675 6e63 7469 6f6e 2829 207b 2720 2b0a  function() {' +.
-00015840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015850: 2020 2020 2720 2020 2076 6172 2069 7465      '    var ite
-00015860: 6d20 3d20 6765 7443 6f6e 7465 7874 2829  m = getContext()
-00015870: 2e67 6574 5265 7175 6573 7428 292e 6765  .getRequest().ge
-00015880: 7442 6f64 7928 293b 2720 2b0a 2020 2020  tBody();' +.    
-00015890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158a0: 2720 2020 2069 7465 6d2e 6964 203d 2069  '    item.id = i
-000158b0: 7465 6d2e 6964 2e74 6f55 7070 6572 4361  tem.id.toUpperCa
-000158c0: 7365 2829 202b 205c 2774 315c 273b 2720  se() + \'t1\';' 
-000158d0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-000158e0: 2020 2020 2020 2720 2020 2067 6574 436f        '    getCo
-000158f0: 6e74 6578 7428 292e 6765 7452 6571 7565  ntext().getReque
-00015900: 7374 2829 2e73 6574 426f 6479 2869 7465  st().setBody(ite
-00015910: 6d29 3b27 202b 0a20 2020 2020 2020 2020  m);' +.         
-00015920: 2020 2020 2020 2020 2020 2027 7d27 292c             '}'),
-00015930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015940: 2027 7472 6967 6765 7254 7970 6527 3a20   'triggerType': 
-00015950: 646f 6375 6d65 6e74 732e 5472 6967 6765  documents.Trigge
-00015960: 7254 7970 652e 5072 652c 0a20 2020 2020  rType.Pre,.     
-00015970: 2020 2020 2020 2020 2020 2027 7472 6967             'trig
-00015980: 6765 724f 7065 7261 7469 6f6e 273a 2064  gerOperation': d
-00015990: 6f63 756d 656e 7473 2e54 7269 6767 6572  ocuments.Trigger
-000159a0: 4f70 6572 6174 696f 6e2e 416c 6c0a 2020  Operation.All.  
-000159b0: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
-000159c0: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
-000159d0: 2020 2020 2020 2020 2020 2027 6964 273a             'id':
-000159e0: 2027 7265 7370 6f6e 7365 3127 2c0a 2020   'response1',.  
-000159f0: 2020 2020 2020 2020 2020 2020 2020 2762                'b
-00015a00: 6f64 7927 3a20 280a 2020 2020 2020 2020  ody': (.        
-00015a10: 2020 2020 2020 2020 2020 2020 2766 756e              'fun
-00015a20: 6374 696f 6e28 2920 7b27 202b 0a20 2020  ction() {' +.   
-00015a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a40: 2027 2020 2020 7661 7220 7072 6562 6f64   '    var prebod
-00015a50: 7920 3d20 6765 7443 6f6e 7465 7874 2829  y = getContext()
-00015a60: 2e67 6574 5265 7175 6573 7428 292e 6765  .getRequest().ge
-00015a70: 7442 6f64 7928 293b 2720 2b0a 2020 2020  tBody();' +.    
-00015a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a90: 2720 2020 2069 6620 2870 7265 626f 6479  '    if (prebody
-00015aa0: 2e69 6420 213d 205c 2754 4553 5449 4e47  .id != \'TESTING
-00015ab0: 2050 4f53 5420 5452 4947 4745 5274 315c   POST TRIGGERt1\
-00015ac0: 2729 270a 2020 2020 2020 2020 2020 2020  ')'.            
-00015ad0: 2020 2020 2020 2020 2720 2020 2020 2020          '       
-00015ae0: 2074 6872 6f77 205c 2769 6420 6d69 736d   throw \'id mism
-00015af0: 6174 6368 5c27 3b27 202b 0a20 2020 2020  atch\';' +.     
-00015b00: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00015b10: 2020 2020 7661 7220 706f 7374 626f 6479      var postbody
-00015b20: 203d 2067 6574 436f 6e74 6578 7428 292e   = getContext().
-00015b30: 6765 7452 6573 706f 6e73 6528 292e 6765  getResponse().ge
-00015b40: 7442 6f64 7928 293b 2720 2b0a 2020 2020  tBody();' +.    
-00015b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b60: 2720 2020 2069 6620 2870 6f73 7462 6f64  '    if (postbod
-00015b70: 792e 6964 2021 3d20 5c27 5445 5354 494e  y.id != \'TESTIN
-00015b80: 4720 504f 5354 2054 5249 4747 4552 7431  G POST TRIGGERt1
-00015b90: 5c27 2927 0a20 2020 2020 2020 2020 2020  \')'.           
-00015ba0: 2020 2020 2020 2020 2027 2020 2020 2020           '      
-00015bb0: 2020 7468 726f 7720 5c27 6964 206d 6973    throw \'id mis
-00015bc0: 6d61 7463 685c 273b 270a 2020 2020 2020  match\';'.      
-00015bd0: 2020 2020 2020 2020 2020 2020 2020 277d                '}
-00015be0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-00015bf0: 2020 2020 2774 7269 6767 6572 5479 7065      'triggerType
-00015c00: 273a 2064 6f63 756d 656e 7473 2e54 7269  ': documents.Tri
-00015c10: 6767 6572 5479 7065 2e50 6f73 742c 0a20  ggerType.Post,. 
-00015c20: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00015c30: 7472 6967 6765 724f 7065 7261 7469 6f6e  triggerOperation
-00015c40: 273a 2064 6f63 756d 656e 7473 2e54 7269  ': documents.Tri
-00015c50: 6767 6572 4f70 6572 6174 696f 6e2e 416c  ggerOperation.Al
-00015c60: 6c0a 2020 2020 2020 2020 2020 2020 7d2c  l.            },
-00015c70: 0a20 2020 2020 2020 2020 2020 207b 0a20  .            {. 
-00015c80: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00015c90: 6964 273a 2027 7265 7370 6f6e 7365 3227  id': 'response2'
-00015ca0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015cb0: 2020 2320 6361 6e27 7420 6265 2075 7365    # can't be use
-00015cc0: 6420 6265 6361 7573 6520 7365 7456 616c  d because setVal
-00015cd0: 7565 2069 7320 6375 7272 656e 746c 7920  ue is currently 
-00015ce0: 6469 7361 626c 6564 0a20 2020 2020 2020  disabled.       
-00015cf0: 2020 2020 2020 2020 2027 626f 6479 273a           'body':
-00015d00: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00015d10: 2020 2020 2020 2027 6675 6e63 7469 6f6e         'function
-00015d20: 2829 207b 2720 2b0a 2020 2020 2020 2020  () {' +.        
-00015d30: 2020 2020 2020 2020 2020 2020 2720 2020              '   
-00015d40: 2076 6172 2070 7265 646f 6320 3d20 6765   var predoc = ge
-00015d50: 7443 6f6e 7465 7874 2829 2e67 6574 5265  tContext().getRe
-00015d60: 7175 6573 7428 292e 6765 7442 6f64 7928  quest().getBody(
-00015d70: 293b 2720 2b0a 2020 2020 2020 2020 2020  );' +.          
-00015d80: 2020 2020 2020 2020 2020 2720 2020 2076            '    v
-00015d90: 6172 2070 6f73 7464 6f63 203d 2067 6574  ar postdoc = get
-00015da0: 436f 6e74 6578 7428 292e 6765 7452 6573  Context().getRes
-00015db0: 706f 6e73 6528 292e 6765 7442 6f64 7928  ponse().getBody(
-00015dc0: 293b 2720 2b0a 2020 2020 2020 2020 2020  );' +.          
-00015dd0: 2020 2020 2020 2020 2020 2720 2020 2067            '    g
-00015de0: 6574 436f 6e74 6578 7428 292e 6765 7452  etContext().getR
-00015df0: 6573 706f 6e73 6528 292e 7365 7456 616c  esponse().setVal
-00015e00: 7565 2827 202b 0a20 2020 2020 2020 2020  ue(' +.         
-00015e10: 2020 2020 2020 2020 2020 2027 2020 2020             '    
-00015e20: 2020 2020 5c27 7072 6564 6f63 6e61 6d65      \'predocname
-00015e30: 5c27 2c20 7072 6564 6f63 2e69 6420 2b20  \', predoc.id + 
-00015e40: 5c27 7265 7370 6f6e 7365 325c 2729 3b27  \'response2\');'
-00015e50: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00015e60: 2020 2020 2020 2027 2020 2020 6765 7443         '    getC
-00015e70: 6f6e 7465 7874 2829 2e67 6574 5265 7370  ontext().getResp
-00015e80: 6f6e 7365 2829 2e73 6574 5661 6c75 6528  onse().setValue(
-00015e90: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
-00015ea0: 2020 2020 2020 2020 2720 2020 2020 2020          '       
-00015eb0: 205c 2770 6f73 7464 6f63 6e61 6d65 5c27   \'postdocname\'
-00015ec0: 2c20 706f 7374 646f 632e 6964 202b 205c  , postdoc.id + \
-00015ed0: 2772 6573 706f 6e73 6532 5c27 293b 2720  'response2\');' 
-00015ee0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-00015ef0: 2020 2020 2020 277d 2729 2c0a 2020 2020        '}'),.    
-00015f00: 2020 2020 2020 2020 2020 2020 2774 7269              'tri
-00015f10: 6767 6572 5479 7065 273a 2064 6f63 756d  ggerType': docum
-00015f20: 656e 7473 2e54 7269 6767 6572 5479 7065  ents.TriggerType
-00015f30: 2e50 6f73 742c 0a20 2020 2020 2020 2020  .Post,.         
-00015f40: 2020 2020 2020 2027 7472 6967 6765 724f         'triggerO
-00015f50: 7065 7261 7469 6f6e 273a 2064 6f63 756d  peration': docum
-00015f60: 656e 7473 2e54 7269 6767 6572 4f70 6572  ents.TriggerOper
-00015f70: 6174 696f 6e2e 416c 6c2c 0a20 2020 2020  ation.All,.     
-00015f80: 2020 2020 2020 207d 5d0a 2020 2020 2020         }].      
-00015f90: 2020 7472 6967 6765 7273 5f69 6e5f 636f    triggers_in_co
-00015fa0: 6c6c 6563 7469 6f6e 3220 3d20 5b0a 2020  llection2 = [.  
-00015fb0: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
-00015fc0: 2020 2020 2020 2020 2020 2020 2769 6427              'id'
-00015fd0: 3a20 2274 3222 2c0a 2020 2020 2020 2020  : "t2",.        
-00015fe0: 2020 2020 2020 2020 2762 6f64 7927 3a20          'body': 
-00015ff0: 2266 756e 6374 696f 6e28 2920 7b20 7d22  "function() { }"
-00016000: 2c20 2023 2074 7269 6767 6572 2061 6c72  ,  # trigger alr
-00016010: 6561 6479 2073 7472 696e 6769 6669 6564  eady stringified
-00016020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016030: 2027 7472 6967 6765 7254 7970 6527 3a20   'triggerType': 
-00016040: 646f 6375 6d65 6e74 732e 5472 6967 6765  documents.Trigge
-00016050: 7254 7970 652e 5072 652c 0a20 2020 2020  rType.Pre,.     
-00016060: 2020 2020 2020 2020 2020 2027 7472 6967             'trig
-00016070: 6765 724f 7065 7261 7469 6f6e 273a 2064  gerOperation': d
-00016080: 6f63 756d 656e 7473 2e54 7269 6767 6572  ocuments.Trigger
-00016090: 4f70 6572 6174 696f 6e2e 416c 6c0a 2020  Operation.All.  
-000160a0: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
-000160b0: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
-000160c0: 2020 2020 2020 2020 2020 2027 6964 273a             'id':
-000160d0: 2022 7433 222c 0a20 2020 2020 2020 2020   "t3",.         
-000160e0: 2020 2020 2020 2027 626f 6479 273a 2028         'body': (
-000160f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016100: 2020 2020 2027 6675 6e63 7469 6f6e 2829       'function()
-00016110: 207b 2720 2b0a 2020 2020 2020 2020 2020   {' +.          
-00016120: 2020 2020 2020 2020 2020 2720 2020 2076            '    v
-00016130: 6172 2069 7465 6d20 3d20 6765 7443 6f6e  ar item = getCon
-00016140: 7465 7874 2829 2e67 6574 5265 7175 6573  text().getReques
-00016150: 7428 292e 6765 7442 6f64 7928 293b 2720  t().getBody();' 
-00016160: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-00016170: 2020 2020 2020 2720 2020 2069 7465 6d2e        '    item.
-00016180: 6964 203d 2069 7465 6d2e 6964 2e74 6f4c  id = item.id.toL
-00016190: 6f77 6572 4361 7365 2829 202b 205c 2774  owerCase() + \'t
-000161a0: 335c 273b 2720 2b0a 2020 2020 2020 2020  3\';' +.        
-000161b0: 2020 2020 2020 2020 2020 2020 2720 2020              '   
-000161c0: 2067 6574 436f 6e74 6578 7428 292e 6765   getContext().ge
-000161d0: 7452 6571 7565 7374 2829 2e73 6574 426f  tRequest().setBo
-000161e0: 6479 2869 7465 6d29 3b27 202b 0a20 2020  dy(item);' +.   
-000161f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016200: 2027 7d27 292c 0a20 2020 2020 2020 2020   '}'),.         
-00016210: 2020 2020 2020 2027 7472 6967 6765 7254         'triggerT
-00016220: 7970 6527 3a20 646f 6375 6d65 6e74 732e  ype': documents.
-00016230: 5472 6967 6765 7254 7970 652e 5072 652c  TriggerType.Pre,
-00016240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016250: 2027 7472 6967 6765 724f 7065 7261 7469   'triggerOperati
-00016260: 6f6e 273a 2064 6f63 756d 656e 7473 2e54  on': documents.T
-00016270: 7269 6767 6572 4f70 6572 6174 696f 6e2e  riggerOperation.
-00016280: 416c 6c0a 2020 2020 2020 2020 2020 2020  All.            
-00016290: 7d5d 0a20 2020 2020 2020 2074 7269 6767  }].        trigg
-000162a0: 6572 735f 696e 5f63 6f6c 6c65 6374 696f  ers_in_collectio
-000162b0: 6e33 203d 205b 0a20 2020 2020 2020 2020  n3 = [.         
-000162c0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
-000162d0: 2020 2020 2027 6964 273a 2027 7472 6967       'id': 'trig
-000162e0: 6765 724f 7054 7970 6527 2c0a 2020 2020  gerOpType',.    
-000162f0: 2020 2020 2020 2020 2020 2020 2762 6f64              'bod
-00016300: 7927 3a20 2766 756e 6374 696f 6e28 2920  y': 'function() 
-00016310: 7b20 7d27 2c0a 2020 2020 2020 2020 2020  { }',.          
-00016320: 2020 2020 2020 2774 7269 6767 6572 5479        'triggerTy
-00016330: 7065 273a 2064 6f63 756d 656e 7473 2e54  pe': documents.T
-00016340: 7269 6767 6572 5479 7065 2e50 6f73 742c  riggerType.Post,
-00016350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016360: 2027 7472 6967 6765 724f 7065 7261 7469   'triggerOperati
-00016370: 6f6e 273a 2064 6f63 756d 656e 7473 2e54  on': documents.T
-00016380: 7269 6767 6572 4f70 6572 6174 696f 6e2e  riggerOperation.
-00016390: 4465 6c65 7465 2c0a 2020 2020 2020 2020  Delete,.        
-000163a0: 2020 2020 7d5d 0a0a 2020 2020 2020 2020      }]..        
-000163b0: 6465 6620 5f5f 4372 6561 7465 5472 6967  def __CreateTrig
-000163c0: 6765 7273 2863 6f6c 6c65 6374 696f 6e2c  gers(collection,
-000163d0: 2074 7269 6767 6572 7329 3a0a 2020 2020   triggers):.    
-000163e0: 2020 2020 2020 2020 2222 2243 7265 6174          """Creat
-000163f0: 6573 2074 7269 6767 6572 732e 0a0a 2020  es triggers...  
-00016400: 2020 2020 2020 2020 2020 3a50 6172 616d            :Param
-00016410: 6574 6572 733a 0a20 2020 2020 2020 2020  eters:.         
-00016420: 2020 2020 2020 202d 2060 636c 6965 6e74         - `client
-00016430: 603a 2063 6f73 6d6f 735f 636c 6965 6e74  `: cosmos_client
-00016440: 5f63 6f6e 6e65 6374 696f 6e2e 436f 736d  _connection.Cosm
-00016450: 6f73 436c 6965 6e74 436f 6e6e 6563 7469  osClientConnecti
-00016460: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-00016470: 2020 202d 2060 636f 6c6c 6563 7469 6f6e     - `collection
-00016480: 603a 2064 6963 740a 0a20 2020 2020 2020  `: dict..       
-00016490: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000164a0: 2020 2020 2066 6f72 2074 7269 6767 6572       for trigger
-000164b0: 5f69 2069 6e20 7472 6967 6765 7273 3a0a  _i in triggers:.
-000164c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000164d0: 7472 6967 6765 7220 3d20 636f 6c6c 6563  trigger = collec
-000164e0: 7469 6f6e 2e73 6372 6970 7473 2e63 7265  tion.scripts.cre
-000164f0: 6174 655f 7472 6967 6765 7228 626f 6479  ate_trigger(body
-00016500: 3d74 7269 6767 6572 5f69 290a 2020 2020  =trigger_i).    
-00016510: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00016520: 7072 6f70 6572 7479 2069 6e20 7472 6967  property in trig
-00016530: 6765 725f 693a 0a20 2020 2020 2020 2020  ger_i:.         
-00016540: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00016550: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
-00016560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016570: 2020 2020 2074 7269 6767 6572 5b70 726f       trigger[pro
-00016580: 7065 7274 795d 2c0a 2020 2020 2020 2020  perty],.        
-00016590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165a0: 7472 6967 6765 725f 695b 7072 6f70 6572  trigger_i[proper
-000165b0: 7479 5d2c 0a20 2020 2020 2020 2020 2020  ty],.           
-000165c0: 2020 2020 2020 2020 2020 2020 2027 7072               'pr
-000165d0: 6f70 6572 7479 207b 7072 6f70 6572 7479  operty {property
-000165e0: 7d20 7368 6f75 6c64 206d 6174 6368 272e  } should match'.
-000165f0: 666f 726d 6174 2870 726f 7065 7274 793d  format(property=
-00016600: 7072 6f70 6572 7479 2929 0a0a 2020 2020  property))..    
-00016610: 2020 2020 2320 6372 6561 7465 2064 6174      # create dat
-00016620: 6162 6173 650a 2020 2020 2020 2020 6462  abase.        db
-00016630: 203d 2073 656c 662e 6461 7461 6261 7365   = self.database
-00016640: 466f 7254 6573 740a 2020 2020 2020 2020  ForTest.        
-00016650: 2320 6372 6561 7465 2063 6f6c 6c65 6374  # create collect
-00016660: 696f 6e73 0a20 2020 2020 2020 2070 6b64  ions.        pkd
-00016670: 203d 2050 6172 7469 7469 6f6e 4b65 7928   = PartitionKey(
-00016680: 7061 7468 3d27 2f69 6427 2c20 6b69 6e64  path='/id', kind
-00016690: 3d27 4861 7368 2729 0a20 2020 2020 2020  ='Hash').       
-000166a0: 2063 6f6c 6c65 6374 696f 6e31 203d 2064   collection1 = d
-000166b0: 622e 6372 6561 7465 5f63 6f6e 7461 696e  b.create_contain
-000166c0: 6572 2869 643d 2774 6573 745f 7472 6967  er(id='test_trig
-000166d0: 6765 725f 6675 6e63 7469 6f6e 616c 6974  ger_functionalit
-000166e0: 7920 3120 2720 2b20 7374 7228 7575 6964  y 1 ' + str(uuid
-000166f0: 2e75 7569 6434 2829 292c 2070 6172 7469  .uuid4()), parti
-00016700: 7469 6f6e 5f6b 6579 3d50 6172 7469 7469  tion_key=Partiti
-00016710: 6f6e 4b65 7928 7061 7468 3d27 2f6b 6579  onKey(path='/key
-00016720: 272c 206b 696e 643d 2748 6173 6827 2929  ', kind='Hash'))
-00016730: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
-00016740: 696f 6e32 203d 2064 622e 6372 6561 7465  ion2 = db.create
-00016750: 5f63 6f6e 7461 696e 6572 2869 643d 2774  _container(id='t
-00016760: 6573 745f 7472 6967 6765 725f 6675 6e63  est_trigger_func
-00016770: 7469 6f6e 616c 6974 7920 3220 2720 2b20  tionality 2 ' + 
-00016780: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
-00016790: 292c 2070 6172 7469 7469 6f6e 5f6b 6579  ), partition_key
-000167a0: 3d50 6172 7469 7469 6f6e 4b65 7928 7061  =PartitionKey(pa
-000167b0: 7468 3d27 2f6b 6579 272c 206b 696e 643d  th='/key', kind=
-000167c0: 2748 6173 6827 2929 0a20 2020 2020 2020  'Hash')).       
-000167d0: 2063 6f6c 6c65 6374 696f 6e33 203d 2064   collection3 = d
-000167e0: 622e 6372 6561 7465 5f63 6f6e 7461 696e  b.create_contain
-000167f0: 6572 2869 643d 2774 6573 745f 7472 6967  er(id='test_trig
-00016800: 6765 725f 6675 6e63 7469 6f6e 616c 6974  ger_functionalit
-00016810: 7920 3320 2720 2b20 7374 7228 7575 6964  y 3 ' + str(uuid
-00016820: 2e75 7569 6434 2829 292c 2070 6172 7469  .uuid4()), parti
-00016830: 7469 6f6e 5f6b 6579 3d50 6172 7469 7469  tion_key=Partiti
-00016840: 6f6e 4b65 7928 7061 7468 3d27 2f6b 6579  onKey(path='/key
-00016850: 272c 206b 696e 643d 2748 6173 6827 2929  ', kind='Hash'))
-00016860: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
-00016870: 6520 7472 6967 6765 7273 0a20 2020 2020  e triggers.     
-00016880: 2020 205f 5f43 7265 6174 6554 7269 6767     __CreateTrigg
-00016890: 6572 7328 636f 6c6c 6563 7469 6f6e 312c  ers(collection1,
-000168a0: 2074 7269 6767 6572 735f 696e 5f63 6f6c   triggers_in_col
-000168b0: 6c65 6374 696f 6e31 290a 2020 2020 2020  lection1).      
-000168c0: 2020 5f5f 4372 6561 7465 5472 6967 6765    __CreateTrigge
-000168d0: 7273 2863 6f6c 6c65 6374 696f 6e32 2c20  rs(collection2, 
-000168e0: 7472 6967 6765 7273 5f69 6e5f 636f 6c6c  triggers_in_coll
-000168f0: 6563 7469 6f6e 3229 0a20 2020 2020 2020  ection2).       
-00016900: 205f 5f43 7265 6174 6554 7269 6767 6572   __CreateTrigger
-00016910: 7328 636f 6c6c 6563 7469 6f6e 332c 2074  s(collection3, t
-00016920: 7269 6767 6572 735f 696e 5f63 6f6c 6c65  riggers_in_colle
-00016930: 6374 696f 6e33 290a 2020 2020 2020 2020  ction3).        
-00016940: 2320 6372 6561 7465 2064 6f63 756d 656e  # create documen
-00016950: 740a 2020 2020 2020 2020 7472 6967 6765  t.        trigge
-00016960: 7273 5f31 203d 206c 6973 7428 636f 6c6c  rs_1 = list(coll
-00016970: 6563 7469 6f6e 312e 7363 7269 7074 732e  ection1.scripts.
-00016980: 6c69 7374 5f74 7269 6767 6572 7328 2929  list_triggers())
-00016990: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000169a0: 7365 7274 4571 7561 6c28 6c65 6e28 7472  sertEqual(len(tr
-000169b0: 6967 6765 7273 5f31 292c 2033 290a 2020  iggers_1), 3).  
-000169c0: 2020 2020 2020 646f 6375 6d65 6e74 5f31        document_1
-000169d0: 5f31 203d 2063 6f6c 6c65 6374 696f 6e31  _1 = collection1
-000169e0: 2e63 7265 6174 655f 6974 656d 280a 2020  .create_item(.  
-000169f0: 2020 2020 2020 2020 2020 626f 6479 3d7b            body={
-00016a00: 2769 6427 3a20 2764 6f63 3127 2c0a 2020  'id': 'doc1',.  
-00016a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a20: 276b 6579 273a 2027 7661 6c75 6527 7d2c  'key': 'value'},
-00016a30: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00016a40: 5f74 7269 6767 6572 5f69 6e63 6c75 6465  _trigger_include
-00016a50: 3d27 7431 270a 2020 2020 2020 2020 290a  ='t1'.        ).
-00016a60: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00016a70: 6572 7445 7175 616c 2864 6f63 756d 656e  ertEqual(documen
-00016a80: 745f 315f 315b 2769 6427 5d2c 0a20 2020  t_1_1['id'],.   
-00016a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016aa0: 2020 2020 2020 2744 4f43 3174 3127 2c0a        'DOC1t1',.
-00016ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ac0: 2020 2020 2020 2020 2027 6964 2073 686f           'id sho
-00016ad0: 756c 6420 6265 2063 6170 6974 616c 697a  uld be capitaliz
-00016ae0: 6564 2729 0a0a 2020 2020 2020 2020 646f  ed')..        do
-00016af0: 6375 6d65 6e74 5f31 5f32 203d 2063 6f6c  cument_1_2 = col
-00016b00: 6c65 6374 696f 6e31 2e63 7265 6174 655f  lection1.create_
-00016b10: 6974 656d 280a 2020 2020 2020 2020 2020  item(.          
-00016b20: 2020 626f 6479 3d7b 2769 6427 3a20 2774    body={'id': 't
-00016b30: 6573 7469 6e67 2070 6f73 7420 7472 6967  esting post trig
-00016b40: 6765 7227 2c20 276b 6579 273a 2027 7661  ger', 'key': 'va
-00016b50: 6c75 6527 7d2c 0a20 2020 2020 2020 2020  lue'},.         
-00016b60: 2020 2070 7265 5f74 7269 6767 6572 5f69     pre_trigger_i
-00016b70: 6e63 6c75 6465 3d27 7431 272c 0a20 2020  nclude='t1',.   
-00016b80: 2020 2020 2020 2020 2070 6f73 745f 7472           post_tr
-00016b90: 6967 6765 725f 696e 636c 7564 653d 2772  igger_include='r
-00016ba0: 6573 706f 6e73 6531 272c 0a20 2020 2020  esponse1',.     
-00016bb0: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
-00016bc0: 662e 6173 7365 7274 4571 7561 6c28 646f  f.assertEqual(do
-00016bd0: 6375 6d65 6e74 5f31 5f32 5b27 6964 275d  cument_1_2['id']
-00016be0: 2c20 2754 4553 5449 4e47 2050 4f53 5420  , 'TESTING POST 
-00016bf0: 5452 4947 4745 5274 3127 290a 0a20 2020  TRIGGERt1')..   
-00016c00: 2020 2020 2064 6f63 756d 656e 745f 315f       document_1_
-00016c10: 3320 3d20 636f 6c6c 6563 7469 6f6e 312e  3 = collection1.
-00016c20: 6372 6561 7465 5f69 7465 6d28 0a20 2020  create_item(.   
-00016c30: 2020 2020 2020 2020 2062 6f64 793d 7b27           body={'
-00016c40: 6964 273a 2027 7265 7370 6f6e 7365 6865  id': 'responsehe
-00016c50: 6164 6572 7327 2c20 276b 6579 273a 2027  aders', 'key': '
-00016c60: 7661 6c75 6527 7d2c 0a20 2020 2020 2020  value'},.       
-00016c70: 2020 2020 2070 7265 5f74 7269 6767 6572       pre_trigger
-00016c80: 5f69 6e63 6c75 6465 3d27 7431 270a 2020  _include='t1'.  
-00016c90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00016ca0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00016cb0: 2864 6f63 756d 656e 745f 315f 335b 2769  (document_1_3['i
-00016cc0: 6427 5d2c 2022 5245 5350 4f4e 5345 4845  d'], "RESPONSEHE
-00016cd0: 4144 4552 5374 3122 290a 0a20 2020 2020  ADERSt1")..     
-00016ce0: 2020 2074 7269 6767 6572 735f 3220 3d20     triggers_2 = 
-00016cf0: 6c69 7374 2863 6f6c 6c65 6374 696f 6e32  list(collection2
-00016d00: 2e73 6372 6970 7473 2e6c 6973 745f 7472  .scripts.list_tr
-00016d10: 6967 6765 7273 2829 290a 2020 2020 2020  iggers()).      
-00016d20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00016d30: 616c 286c 656e 2874 7269 6767 6572 735f  al(len(triggers_
-00016d40: 3229 2c20 3229 0a20 2020 2020 2020 2064  2), 2).        d
-00016d50: 6f63 756d 656e 745f 325f 3120 3d20 636f  ocument_2_1 = co
-00016d60: 6c6c 6563 7469 6f6e 322e 6372 6561 7465  llection2.create
-00016d70: 5f69 7465 6d28 0a20 2020 2020 2020 2020  _item(.         
-00016d80: 2020 2062 6f64 793d 7b27 6964 273a 2027     body={'id': '
-00016d90: 646f 6332 272c 0a20 2020 2020 2020 2020  doc2',.         
-00016da0: 2020 2020 2020 2020 2027 6b65 7927 3a20           'key': 
-00016db0: 2776 616c 7565 3227 7d2c 0a20 2020 2020  'value2'},.     
-00016dc0: 2020 2020 2020 2070 7265 5f74 7269 6767         pre_trigg
-00016dd0: 6572 5f69 6e63 6c75 6465 3d27 7432 270a  er_include='t2'.
-00016de0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00016df0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00016e00: 616c 2864 6f63 756d 656e 745f 325f 315b  al(document_2_1[
-00016e10: 2769 6427 5d2c 0a20 2020 2020 2020 2020  'id'],.         
-00016e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e30: 2764 6f63 3227 2c0a 2020 2020 2020 2020  'doc2',.        
-00016e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e50: 2027 6964 2073 686f 756c 646e 5c27 7420   'id shouldn\'t 
-00016e60: 6368 616e 6765 2729 0a20 2020 2020 2020  change').       
-00016e70: 2064 6f63 756d 656e 745f 325f 3220 3d20   document_2_2 = 
-00016e80: 636f 6c6c 6563 7469 6f6e 322e 6372 6561  collection2.crea
-00016e90: 7465 5f69 7465 6d28 0a20 2020 2020 2020  te_item(.       
-00016ea0: 2020 2020 2062 6f64 793d 7b27 6964 273a       body={'id':
-00016eb0: 2027 446f 6333 272c 0a20 2020 2020 2020   'Doc3',.       
-00016ec0: 2020 2020 2020 2020 2020 2027 7072 6f70             'prop
-00016ed0: 273a 2027 656d 7074 7927 2c0a 2020 2020  ': 'empty',.    
-00016ee0: 2020 2020 2020 2020 2020 2020 2020 276b                'k
-00016ef0: 6579 273a 2027 7661 6c75 6532 277d 2c0a  ey': 'value2'},.
-00016f00: 2020 2020 2020 2020 2020 2020 7072 655f              pre_
-00016f10: 7472 6967 6765 725f 696e 636c 7564 653d  trigger_include=
-00016f20: 2774 3327 290a 2020 2020 2020 2020 7365  't3').        se
-00016f30: 6c66 2e61 7373 6572 7445 7175 616c 2864  lf.assertEqual(d
-00016f40: 6f63 756d 656e 745f 325f 325b 2769 6427  ocument_2_2['id'
-00016f50: 5d2c 2027 646f 6333 7433 2729 0a0a 2020  ], 'doc3t3')..  
-00016f60: 2020 2020 2020 7472 6967 6765 7273 5f33        triggers_3
-00016f70: 203d 206c 6973 7428 636f 6c6c 6563 7469   = list(collecti
-00016f80: 6f6e 332e 7363 7269 7074 732e 6c69 7374  on3.scripts.list
-00016f90: 5f74 7269 6767 6572 7328 2929 0a20 2020  _triggers()).   
-00016fa0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00016fb0: 4571 7561 6c28 6c65 6e28 7472 6967 6765  Equal(len(trigge
-00016fc0: 7273 5f33 292c 2031 290a 2020 2020 2020  rs_3), 1).      
-00016fd0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-00016fe0: 7274 5261 6973 6573 2845 7863 6570 7469  rtRaises(Excepti
-00016ff0: 6f6e 293a 0a20 2020 2020 2020 2020 2020  on):.           
-00017000: 2063 6f6c 6c65 6374 696f 6e33 2e63 7265   collection3.cre
-00017010: 6174 655f 6974 656d 280a 2020 2020 2020  ate_item(.      
-00017020: 2020 2020 2020 2020 2020 626f 6479 3d7b            body={
-00017030: 2769 6427 3a20 2744 6f63 6f70 7479 7065  'id': 'Docoptype
-00017040: 272c 2027 6b65 7927 3a20 2776 616c 7565  ', 'key': 'value
-00017050: 3227 7d2c 0a20 2020 2020 2020 2020 2020  2'},.           
-00017060: 2020 2020 2070 6f73 745f 7472 6967 6765       post_trigge
-00017070: 725f 696e 636c 7564 653d 2774 7269 6767  r_include='trigg
-00017080: 6572 4f70 5479 7065 270a 2020 2020 2020  erOpType'.      
-00017090: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000170a0: 2064 622e 6465 6c65 7465 5f63 6f6e 7461   db.delete_conta
-000170b0: 696e 6572 2863 6f6c 6c65 6374 696f 6e31  iner(collection1
-000170c0: 290a 2020 2020 2020 2020 6462 2e64 656c  ).        db.del
-000170d0: 6574 655f 636f 6e74 6169 6e65 7228 636f  ete_container(co
-000170e0: 6c6c 6563 7469 6f6e 3229 0a20 2020 2020  llection2).     
-000170f0: 2020 2064 622e 6465 6c65 7465 5f63 6f6e     db.delete_con
-00017100: 7461 696e 6572 2863 6f6c 6c65 6374 696f  tainer(collectio
-00017110: 6e33 290a 0a20 2020 2064 6566 2074 6573  n3)..    def tes
-00017120: 745f 7374 6f72 6564 5f70 726f 6365 6475  t_stored_procedu
-00017130: 7265 5f66 756e 6374 696f 6e61 6c69 7479  re_functionality
-00017140: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00017150: 2320 6372 6561 7465 2064 6174 6162 6173  # create databas
-00017160: 650a 2020 2020 2020 2020 6462 203d 2073  e.        db = s
-00017170: 656c 662e 6461 7461 6261 7365 466f 7254  elf.databaseForT
-00017180: 6573 740a 2020 2020 2020 2020 2320 6372  est.        # cr
-00017190: 6561 7465 2063 6f6c 6c65 6374 696f 6e0a  eate collection.
-000171a0: 2020 2020 2020 2020 636f 6c6c 6563 7469          collecti
-000171b0: 6f6e 203d 2073 656c 662e 636f 6e66 6967  on = self.config
-000171c0: 732e 6372 6561 7465 5f6d 756c 7469 5f70  s.create_multi_p
-000171d0: 6172 7469 7469 6f6e 5f63 6f6c 6c65 6374  artition_collect
-000171e0: 696f 6e5f 6966 5f6e 6f74 5f65 7869 7374  ion_if_not_exist
-000171f0: 2873 656c 662e 636c 6965 6e74 290a 0a20  (self.client).. 
-00017200: 2020 2020 2020 2073 7072 6f63 3120 3d20         sproc1 = 
-00017210: 7b0a 2020 2020 2020 2020 2020 2020 2769  {.            'i
-00017220: 6427 3a20 2773 746f 7265 6450 726f 6365  d': 'storedProce
-00017230: 6475 7265 3127 202b 2073 7472 2875 7569  dure1' + str(uui
-00017240: 642e 7575 6964 3428 2929 2c0a 2020 2020  d.uuid4()),.    
-00017250: 2020 2020 2020 2020 2762 6f64 7927 3a20          'body': 
-00017260: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00017270: 2020 2766 756e 6374 696f 6e20 2829 207b    'function () {
-00017280: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
-00017290: 2020 2020 2720 2066 6f72 2028 7661 7220      '  for (var 
-000172a0: 6920 3d20 303b 2069 203c 2031 3030 303b  i = 0; i < 1000;
-000172b0: 2069 2b2b 2920 7b27 202b 0a20 2020 2020   i++) {' +.     
-000172c0: 2020 2020 2020 2020 2020 2027 2020 2020             '    
-000172d0: 7661 7220 6974 656d 203d 2067 6574 436f  var item = getCo
-000172e0: 6e74 6578 7428 292e 6765 7452 6573 706f  ntext().getRespo
-000172f0: 6e73 6528 292e 6765 7442 6f64 7928 293b  nse().getBody();
-00017300: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
-00017310: 2020 2020 2720 2020 2069 6620 2869 203e      '    if (i >
-00017320: 2030 2026 2620 6974 656d 2021 3d20 6920   0 && item != i 
-00017330: 2d20 3129 2074 6872 6f77 205c 2762 6f64  - 1) throw \'bod
-00017340: 7920 6d69 736d 6174 6368 5c27 3b27 202b  y mismatch\';' +
-00017350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017360: 2027 2020 2020 6765 7443 6f6e 7465 7874   '    getContext
-00017370: 2829 2e67 6574 5265 7370 6f6e 7365 2829  ().getResponse()
-00017380: 2e73 6574 426f 6479 2869 293b 2720 2b0a  .setBody(i);' +.
-00017390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173a0: 2720 207d 2720 2b0a 2020 2020 2020 2020  '  }' +.        
-000173b0: 2020 2020 2020 2020 277d 2729 0a20 2020          '}').   
-000173c0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-000173d0: 7265 7472 6965 7665 645f 7370 726f 6320  retrieved_sproc 
-000173e0: 3d20 636f 6c6c 6563 7469 6f6e 2e73 6372  = collection.scr
-000173f0: 6970 7473 2e63 7265 6174 655f 7374 6f72  ipts.create_stor
-00017400: 6564 5f70 726f 6365 6475 7265 2862 6f64  ed_procedure(bod
-00017410: 793d 7370 726f 6331 290a 2020 2020 2020  y=sproc1).      
-00017420: 2020 7265 7375 6c74 203d 2063 6f6c 6c65    result = colle
-00017430: 6374 696f 6e2e 7363 7269 7074 732e 6578  ction.scripts.ex
-00017440: 6563 7574 655f 7374 6f72 6564 5f70 726f  ecute_stored_pro
-00017450: 6365 6475 7265 280a 2020 2020 2020 2020  cedure(.        
-00017460: 2020 2020 7370 726f 633d 7265 7472 6965      sproc=retrie
-00017470: 7665 645f 7370 726f 635b 2769 6427 5d2c  ved_sproc['id'],
-00017480: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-00017490: 7469 7469 6f6e 5f6b 6579 3d31 0a20 2020  tition_key=1.   
-000174a0: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-000174b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000174c0: 7265 7375 6c74 2c20 3939 3929 0a20 2020  result, 999).   
-000174d0: 2020 2020 2073 7072 6f63 3220 3d20 7b0a       sproc2 = {.
-000174e0: 2020 2020 2020 2020 2020 2020 2769 6427              'id'
-000174f0: 3a20 2773 746f 7265 6450 726f 6365 6475  : 'storedProcedu
-00017500: 7265 3227 202b 2073 7472 2875 7569 642e  re2' + str(uuid.
-00017510: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
-00017520: 2020 2020 2020 2762 6f64 7927 3a20 280a        'body': (.
-00017530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017540: 2766 756e 6374 696f 6e20 2829 207b 2720  'function () {' 
-00017550: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-00017560: 2020 2720 2066 6f72 2028 7661 7220 6920    '  for (var i 
-00017570: 3d20 303b 2069 203c 2031 303b 2069 2b2b  = 0; i < 10; i++
-00017580: 2920 7b27 202b 0a20 2020 2020 2020 2020  ) {' +.         
-00017590: 2020 2020 2020 2027 2020 2020 6765 7443         '    getC
-000175a0: 6f6e 7465 7874 2829 2e67 6574 5265 7370  ontext().getResp
-000175b0: 6f6e 7365 2829 2e61 7070 656e 6456 616c  onse().appendVal
-000175c0: 7565 285c 2742 6f64 795c 272c 2069 293b  ue(\'Body\', i);
-000175d0: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
-000175e0: 2020 2020 2720 207d 2720 2b0a 2020 2020      '  }' +.    
-000175f0: 2020 2020 2020 2020 2020 2020 277d 2729              '}')
-00017600: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-00017610: 2020 2072 6574 7269 6576 6564 5f73 7072     retrieved_spr
-00017620: 6f63 3220 3d20 636f 6c6c 6563 7469 6f6e  oc2 = collection
-00017630: 2e73 6372 6970 7473 2e63 7265 6174 655f  .scripts.create_
-00017640: 7374 6f72 6564 5f70 726f 6365 6475 7265  stored_procedure
-00017650: 2862 6f64 793d 7370 726f 6332 290a 2020  (body=sproc2).  
-00017660: 2020 2020 2020 7265 7375 6c74 203d 2063        result = c
-00017670: 6f6c 6c65 6374 696f 6e2e 7363 7269 7074  ollection.script
-00017680: 732e 6578 6563 7574 655f 7374 6f72 6564  s.execute_stored
-00017690: 5f70 726f 6365 6475 7265 280a 2020 2020  _procedure(.    
-000176a0: 2020 2020 2020 2020 7370 726f 633d 7265          sproc=re
-000176b0: 7472 6965 7665 645f 7370 726f 6332 5b27  trieved_sproc2['
-000176c0: 6964 275d 2c0a 2020 2020 2020 2020 2020  id'],.          
-000176d0: 2020 7061 7274 6974 696f 6e5f 6b65 793d    partition_key=
-000176e0: 310a 2020 2020 2020 2020 290a 2020 2020  1.        ).    
-000176f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00017700: 7175 616c 2869 6e74 2872 6573 756c 7429  qual(int(result)
-00017710: 2c20 3132 3334 3536 3738 3929 0a20 2020  , 123456789).   
-00017720: 2020 2020 2073 7072 6f63 3320 3d20 7b0a       sproc3 = {.
-00017730: 2020 2020 2020 2020 2020 2020 2769 6427              'id'
-00017740: 3a20 2773 746f 7265 6450 726f 6365 6475  : 'storedProcedu
-00017750: 7265 3327 202b 2073 7472 2875 7569 642e  re3' + str(uuid.
-00017760: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
-00017770: 2020 2020 2020 2762 6f64 7927 3a20 280a        'body': (.
-00017780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017790: 2766 756e 6374 696f 6e20 2869 6e70 7574  'function (input
-000177a0: 2920 7b27 202b 0a20 2020 2020 2020 2020  ) {' +.         
-000177b0: 2020 2020 2020 2027 2020 6765 7443 6f6e         '  getCon
-000177c0: 7465 7874 2829 2e67 6574 5265 7370 6f6e  text().getRespon
-000177d0: 7365 2829 2e73 6574 426f 6479 2827 202b  se().setBody(' +
-000177e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000177f0: 2027 2020 2020 2020 5c27 615c 2720 2b20   '      \'a\' + 
-00017800: 696e 7075 742e 7465 6d70 293b 2720 2b0a  input.temp);' +.
-00017810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017820: 277d 2729 0a20 2020 2020 2020 207d 0a20  '}').        }. 
-00017830: 2020 2020 2020 2072 6574 7269 6576 6564         retrieved
-00017840: 5f73 7072 6f63 3320 3d20 636f 6c6c 6563  _sproc3 = collec
-00017850: 7469 6f6e 2e73 6372 6970 7473 2e63 7265  tion.scripts.cre
-00017860: 6174 655f 7374 6f72 6564 5f70 726f 6365  ate_stored_proce
-00017870: 6475 7265 2862 6f64 793d 7370 726f 6333  dure(body=sproc3
-00017880: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-00017890: 203d 2063 6f6c 6c65 6374 696f 6e2e 7363   = collection.sc
-000178a0: 7269 7074 732e 6578 6563 7574 655f 7374  ripts.execute_st
-000178b0: 6f72 6564 5f70 726f 6365 6475 7265 280a  ored_procedure(.
-000178c0: 2020 2020 2020 2020 2020 2020 7370 726f              spro
-000178d0: 633d 7265 7472 6965 7665 645f 7370 726f  c=retrieved_spro
-000178e0: 6333 5b27 6964 275d 2c0a 2020 2020 2020  c3['id'],.      
-000178f0: 2020 2020 2020 7061 7261 6d73 3d7b 2774        params={'t
-00017900: 656d 7027 3a20 2773 6f27 7d2c 0a20 2020  emp': 'so'},.   
-00017910: 2020 2020 2020 2020 2070 6172 7469 7469           partiti
-00017920: 6f6e 5f6b 6579 3d31 0a20 2020 2020 2020  on_key=1.       
-00017930: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-00017940: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
-00017950: 6c74 2c20 2761 736f 2729 0a0a 2020 2020  lt, 'aso')..    
-00017960: 6465 6620 5f5f 5661 6c69 6461 7465 4f66  def __ValidateOf
-00017970: 6665 7252 6573 706f 6e73 6542 6f64 7928  ferResponseBody(
-00017980: 7365 6c66 2c20 6f66 6665 722c 2065 7870  self, offer, exp
-00017990: 6563 7465 645f 636f 6c6c 5f6c 696e 6b2c  ected_coll_link,
-000179a0: 2065 7870 6563 7465 645f 6f66 6665 725f   expected_offer_
-000179b0: 7479 7065 293a 0a20 2020 2020 2020 2023  type):.        #
-000179c0: 2074 7970 653a 2028 4f66 6665 722c 2073   type: (Offer, s
-000179d0: 7472 2c20 416e 7929 202d 3e20 4e6f 6e65  tr, Any) -> None
-000179e0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000179f0: 7365 7274 4973 4e6f 744e 6f6e 6528 6f66  sertIsNotNone(of
-00017a00: 6665 722e 7072 6f70 6572 7469 6573 5b27  fer.properties['
-00017a10: 6964 275d 2c20 2749 6420 6361 6e6e 6f74  id'], 'Id cannot
-00017a20: 2062 6520 6e75 6c6c 2e27 290a 2020 2020   be null.').    
-00017a30: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00017a40: 734e 6f74 4e6f 6e65 286f 6666 6572 2e70  sNotNone(offer.p
-00017a50: 726f 7065 7274 6965 732e 6765 7428 275f  roperties.get('_
-00017a60: 7269 6427 292c 2027 5265 736f 7572 6365  rid'), 'Resource
-00017a70: 2049 6420 2852 6964 2920 6361 6e6e 6f74   Id (Rid) cannot
-00017a80: 2062 6520 6e75 6c6c 2e27 290a 2020 2020   be null.').    
-00017a90: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00017aa0: 734e 6f74 4e6f 6e65 286f 6666 6572 2e70  sNotNone(offer.p
-00017ab0: 726f 7065 7274 6965 732e 6765 7428 275f  roperties.get('_
-00017ac0: 7365 6c66 2729 2c20 2753 656c 6620 4c69  self'), 'Self Li
-00017ad0: 6e6b 2063 616e 6e6f 7420 6265 206e 756c  nk cannot be nul
-00017ae0: 6c2e 2729 0a20 2020 2020 2020 2073 656c  l.').        sel
-00017af0: 662e 6173 7365 7274 4973 4e6f 744e 6f6e  f.assertIsNotNon
-00017b00: 6528 6f66 6665 722e 7072 6f70 6572 7469  e(offer.properti
-00017b10: 6573 2e67 6574 2827 7265 736f 7572 6365  es.get('resource
-00017b20: 2729 2c20 2752 6573 6f75 7263 6520 4c69  '), 'Resource Li
-00017b30: 6e6b 2063 616e 6e6f 7420 6265 206e 756c  nk cannot be nul
-00017b40: 6c2e 2729 0a20 2020 2020 2020 2073 656c  l.').        sel
-00017b50: 662e 6173 7365 7274 5472 7565 286f 6666  f.assertTrue(off
-00017b60: 6572 2e70 726f 7065 7274 6965 735b 275f  er.properties['_
-00017b70: 7365 6c66 275d 2e66 696e 6428 6f66 6665  self'].find(offe
-00017b80: 722e 7072 6f70 6572 7469 6573 5b27 6964  r.properties['id
-00017b90: 275d 2920 213d 202d 312c 0a20 2020 2020  ']) != -1,.     
-00017ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017bb0: 2020 2027 4f66 6665 7220 6964 206e 6f74     'Offer id not
-00017bc0: 2063 6f6e 7461 696e 6564 2069 6e20 6f66   contained in of
-00017bd0: 6665 7220 7365 6c66 206c 696e 6b2e 2729  fer self link.')
-00017be0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00017bf0: 7365 7274 4571 7561 6c28 6578 7065 6374  sertEqual(expect
-00017c00: 6564 5f63 6f6c 6c5f 6c69 6e6b 2e73 7472  ed_coll_link.str
-00017c10: 6970 2827 2f27 292c 206f 6666 6572 2e70  ip('/'), offer.p
-00017c20: 726f 7065 7274 6965 735b 2772 6573 6f75  roperties['resou
-00017c30: 7263 6527 5d2e 7374 7269 7028 272f 2729  rce'].strip('/')
-00017c40: 290a 2020 2020 2020 2020 6966 2028 6578  ).        if (ex
-00017c50: 7065 6374 6564 5f6f 6666 6572 5f74 7970  pected_offer_typ
-00017c60: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00017c70: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00017c80: 2865 7870 6563 7465 645f 6f66 6665 725f  (expected_offer_
-00017c90: 7479 7065 2c20 6f66 6665 722e 7072 6f70  type, offer.prop
-00017ca0: 6572 7469 6573 2e67 6574 2827 6f66 6665  erties.get('offe
-00017cb0: 7254 7970 6527 2929 0a0a 2020 2020 6465  rType'))..    de
-00017cc0: 6620 7465 7374 5f6f 6666 6572 5f72 6561  f test_offer_rea
-00017cd0: 645f 616e 645f 7175 6572 7928 7365 6c66  d_and_query(self
-00017ce0: 293a 0a20 2020 2020 2020 2023 2043 7265  ):.        # Cre
-00017cf0: 6174 6520 6461 7461 6261 7365 2e0a 2020  ate database..  
-00017d00: 2020 2020 2020 6462 203d 2073 656c 662e        db = self.
-00017d10: 6461 7461 6261 7365 466f 7254 6573 740a  databaseForTest.
-00017d20: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
-00017d30: 6520 636f 6c6c 6563 7469 6f6e 2e0a 2020  e collection..  
-00017d40: 2020 2020 2020 636f 6c6c 6563 7469 6f6e        collection
-00017d50: 203d 2064 622e 6372 6561 7465 5f63 6f6e   = db.create_con
-00017d60: 7461 696e 6572 280a 2020 2020 2020 2020  tainer(.        
-00017d70: 2020 2020 6964 3d27 7465 7374 5f6f 6666      id='test_off
-00017d80: 6572 5f72 6561 645f 616e 645f 7175 6572  er_read_and_quer
-00017d90: 7920 2720 2b20 7374 7228 7575 6964 2e75  y ' + str(uuid.u
-00017da0: 7569 6434 2829 292c 0a20 2020 2020 2020  uid4()),.       
-00017db0: 2020 2020 2070 6172 7469 7469 6f6e 5f6b       partition_k
-00017dc0: 6579 3d50 6172 7469 7469 6f6e 4b65 7928  ey=PartitionKey(
-00017dd0: 7061 7468 3d27 2f69 6427 2c20 6b69 6e64  path='/id', kind
-00017de0: 3d27 4861 7368 2729 0a20 2020 2020 2020  ='Hash').       
-00017df0: 2029 0a20 2020 2020 2020 2023 2052 6561   ).        # Rea
-00017e00: 6420 7468 6520 6f66 6665 722e 0a20 2020  d the offer..   
-00017e10: 2020 2020 2065 7870 6563 7465 645f 6f66       expected_of
-00017e20: 6665 7220 3d20 636f 6c6c 6563 7469 6f6e  fer = collection
-00017e30: 2e67 6574 5f74 6872 6f75 6768 7075 7428  .get_throughput(
-00017e40: 290a 2020 2020 2020 2020 636f 6c6c 6563  ).        collec
-00017e50: 7469 6f6e 5f70 726f 7065 7274 6965 7320  tion_properties 
-00017e60: 3d20 636f 6c6c 6563 7469 6f6e 2e72 6561  = collection.rea
-00017e70: 6428 290a 2020 2020 2020 2020 7365 6c66  d().        self
-00017e80: 2e5f 5f56 616c 6964 6174 654f 6666 6572  .__ValidateOffer
-00017e90: 5265 7370 6f6e 7365 426f 6479 2865 7870  ResponseBody(exp
-00017ea0: 6563 7465 645f 6f66 6665 722c 2063 6f6c  ected_offer, col
-00017eb0: 6c65 6374 696f 6e5f 7072 6f70 6572 7469  lection_properti
-00017ec0: 6573 2e67 6574 2827 5f73 656c 6627 292c  es.get('_self'),
-00017ed0: 204e 6f6e 6529 0a0a 2020 2020 2020 2020   None)..        
-00017ee0: 2320 4e6f 7720 6465 6c65 7465 2074 6865  # Now delete the
-00017ef0: 2063 6f6c 6c65 6374 696f 6e2e 0a20 2020   collection..   
-00017f00: 2020 2020 2064 622e 6465 6c65 7465 5f63       db.delete_c
-00017f10: 6f6e 7461 696e 6572 2863 6f6e 7461 696e  ontainer(contain
-00017f20: 6572 3d63 6f6c 6c65 6374 696f 6e29 0a20  er=collection). 
-00017f30: 2020 2020 2020 2023 2052 6561 6469 6e67         # Reading
-00017f40: 2066 6169 6c73 2e0a 2020 2020 2020 2020   fails..        
-00017f50: 7365 6c66 2e5f 5f41 7373 6572 7448 5454  self.__AssertHTT
-00017f60: 5046 6169 6c75 7265 5769 7468 5374 6174  PFailureWithStat
-00017f70: 7573 2853 7461 7475 7343 6f64 6573 2e4e  us(StatusCodes.N
-00017f80: 4f54 5f46 4f55 4e44 2c20 636f 6c6c 6563  OT_FOUND, collec
-00017f90: 7469 6f6e 2e67 6574 5f74 6872 6f75 6768  tion.get_through
-00017fa0: 7075 7429 0a0a 2020 2020 6465 6620 7465  put)..    def te
-00017fb0: 7374 5f6f 6666 6572 5f72 6570 6c61 6365  st_offer_replace
-00017fc0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00017fd0: 2320 4372 6561 7465 2064 6174 6162 6173  # Create databas
-00017fe0: 652e 0a20 2020 2020 2020 2064 6220 3d20  e..        db = 
-00017ff0: 7365 6c66 2e64 6174 6162 6173 6546 6f72  self.databaseFor
-00018000: 5465 7374 0a20 2020 2020 2020 2023 2043  Test.        # C
-00018010: 7265 6174 6520 636f 6c6c 6563 7469 6f6e  reate collection
-00018020: 2e0a 2020 2020 2020 2020 636f 6c6c 6563  ..        collec
-00018030: 7469 6f6e 203d 2073 656c 662e 636f 6e66  tion = self.conf
-00018040: 6967 732e 6372 6561 7465 5f6d 756c 7469  igs.create_multi
-00018050: 5f70 6172 7469 7469 6f6e 5f63 6f6c 6c65  _partition_colle
-00018060: 6374 696f 6e5f 6966 5f6e 6f74 5f65 7869  ction_if_not_exi
-00018070: 7374 2873 656c 662e 636c 6965 6e74 290a  st(self.client).
-00018080: 2020 2020 2020 2020 2320 5265 6164 204f          # Read O
-00018090: 6666 6572 0a20 2020 2020 2020 2065 7870  ffer.        exp
-000180a0: 6563 7465 645f 6f66 6665 7220 3d20 636f  ected_offer = co
-000180b0: 6c6c 6563 7469 6f6e 2e67 6574 5f74 6872  llection.get_thr
-000180c0: 6f75 6768 7075 7428 290a 2020 2020 2020  oughput().      
-000180d0: 2020 636f 6c6c 6563 7469 6f6e 5f70 726f    collection_pro
-000180e0: 7065 7274 6965 7320 3d20 636f 6c6c 6563  perties = collec
-000180f0: 7469 6f6e 2e72 6561 6428 290a 2020 2020  tion.read().    
-00018100: 2020 2020 7365 6c66 2e5f 5f56 616c 6964      self.__Valid
-00018110: 6174 654f 6666 6572 5265 7370 6f6e 7365  ateOfferResponse
-00018120: 426f 6479 2865 7870 6563 7465 645f 6f66  Body(expected_of
-00018130: 6665 722c 2063 6f6c 6c65 6374 696f 6e5f  fer, collection_
-00018140: 7072 6f70 6572 7469 6573 2e67 6574 2827  properties.get('
-00018150: 5f73 656c 6627 292c 204e 6f6e 6529 0a20  _self'), None). 
-00018160: 2020 2020 2020 2023 2052 6570 6c61 6365         # Replace
-00018170: 2074 6865 206f 6666 6572 2e0a 2020 2020   the offer..    
-00018180: 2020 2020 7265 706c 6163 6564 5f6f 6666      replaced_off
-00018190: 6572 203d 2063 6f6c 6c65 6374 696f 6e2e  er = collection.
-000181a0: 7265 706c 6163 655f 7468 726f 7567 6870  replace_throughp
-000181b0: 7574 2865 7870 6563 7465 645f 6f66 6665  ut(expected_offe
-000181c0: 722e 6f66 6665 725f 7468 726f 7567 6870  r.offer_throughp
-000181d0: 7574 202b 2031 3030 290a 2020 2020 2020  ut + 100).      
-000181e0: 2020 636f 6c6c 6563 7469 6f6e 5f70 726f    collection_pro
-000181f0: 7065 7274 6965 7320 3d20 636f 6c6c 6563  perties = collec
-00018200: 7469 6f6e 2e72 6561 6428 290a 2020 2020  tion.read().    
-00018210: 2020 2020 7365 6c66 2e5f 5f56 616c 6964      self.__Valid
-00018220: 6174 654f 6666 6572 5265 7370 6f6e 7365  ateOfferResponse
-00018230: 426f 6479 2872 6570 6c61 6365 645f 6f66  Body(replaced_of
-00018240: 6665 722c 2063 6f6c 6c65 6374 696f 6e5f  fer, collection_
-00018250: 7072 6f70 6572 7469 6573 2e67 6574 2827  properties.get('
-00018260: 5f73 656c 6627 292c 204e 6f6e 6529 0a20  _self'), None). 
-00018270: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
-00018280: 6620 7468 6520 7265 706c 6163 6564 206f  f the replaced o
-00018290: 6666 6572 2069 7320 7768 6174 2077 6520  ffer is what we 
-000182a0: 6578 7065 6374 2e0a 2020 2020 2020 2020  expect..        
-000182b0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000182c0: 2865 7870 6563 7465 645f 6f66 6665 722e  (expected_offer.
-000182d0: 7072 6f70 6572 7469 6573 2e67 6574 2827  properties.get('
-000182e0: 636f 6e74 656e 7427 292e 6765 7428 276f  content').get('o
-000182f0: 6666 6572 5468 726f 7567 6870 7574 2729  fferThroughput')
-00018300: 202b 2031 3030 2c0a 2020 2020 2020 2020   + 100,.        
-00018310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018320: 2072 6570 6c61 6365 645f 6f66 6665 722e   replaced_offer.
-00018330: 7072 6f70 6572 7469 6573 2e67 6574 2827  properties.get('
-00018340: 636f 6e74 656e 7427 292e 6765 7428 276f  content').get('o
-00018350: 6666 6572 5468 726f 7567 6870 7574 2729  fferThroughput')
-00018360: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00018370: 7373 6572 7445 7175 616c 2865 7870 6563  ssertEqual(expec
-00018380: 7465 645f 6f66 6665 722e 6f66 6665 725f  ted_offer.offer_
-00018390: 7468 726f 7567 6870 7574 202b 2031 3030  throughput + 100
-000183a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000183b0: 2020 2020 2020 2020 2020 2072 6570 6c61             repla
-000183c0: 6365 645f 6f66 6665 722e 6f66 6665 725f  ced_offer.offer_
-000183d0: 7468 726f 7567 6870 7574 290a 0a20 2020  throughput)..   
-000183e0: 2064 6566 2074 6573 745f 6461 7461 6261   def test_databa
-000183f0: 7365 5f61 6363 6f75 6e74 5f66 756e 6374  se_account_funct
-00018400: 696f 6e61 6c69 7479 2873 656c 6629 3a0a  ionality(self):.
-00018410: 2020 2020 2020 2020 2320 5661 6c69 6461          # Valida
-00018420: 7465 2064 6174 6162 6173 6520 6163 636f  te database acco
-00018430: 756e 7420 6675 6e63 7469 6f6e 616c 6974  unt functionalit
-00018440: 792e 0a20 2020 2020 2020 2064 6174 6162  y..        datab
-00018450: 6173 655f 6163 636f 756e 7420 3d20 7365  ase_account = se
-00018460: 6c66 2e63 6c69 656e 742e 6765 745f 6461  lf.client.get_da
-00018470: 7461 6261 7365 5f61 6363 6f75 6e74 2829  tabase_account()
-00018480: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00018490: 7365 7274 4571 7561 6c28 6461 7461 6261  sertEqual(databa
-000184a0: 7365 5f61 6363 6f75 6e74 2e44 6174 6162  se_account.Datab
-000184b0: 6173 6573 4c69 6e6b 2c20 272f 6462 732f  asesLink, '/dbs/
-000184c0: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
-000184d0: 6173 7365 7274 4571 7561 6c28 6461 7461  assertEqual(data
-000184e0: 6261 7365 5f61 6363 6f75 6e74 2e4d 6564  base_account.Med
-000184f0: 6961 4c69 6e6b 2c20 272f 6d65 6469 612f  iaLink, '/media/
-00018500: 2729 0a20 2020 2020 2020 2069 6620 2848  ').        if (H
-00018510: 7474 7048 6561 6465 7273 2e4d 6178 4d65  ttpHeaders.MaxMe
-00018520: 6469 6153 746f 7261 6765 5573 6167 6549  diaStorageUsageI
-00018530: 6e4d 4220 696e 0a20 2020 2020 2020 2020  nMB in.         
-00018540: 2020 2020 2020 2073 656c 662e 636c 6965         self.clie
-00018550: 6e74 2e63 6c69 656e 745f 636f 6e6e 6563  nt.client_connec
-00018560: 7469 6f6e 2e6c 6173 745f 7265 7370 6f6e  tion.last_respon
-00018570: 7365 5f68 6561 6465 7273 293a 0a20 2020  se_headers):.   
-00018580: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00018590: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-000185a0: 2020 2020 2020 2020 2020 2064 6174 6162             datab
-000185b0: 6173 655f 6163 636f 756e 742e 4d61 784d  ase_account.MaxM
-000185c0: 6564 6961 5374 6f72 6167 6555 7361 6765  ediaStorageUsage
-000185d0: 496e 4d42 2c0a 2020 2020 2020 2020 2020  InMB,.          
-000185e0: 2020 2020 2020 7365 6c66 2e63 6c69 656e        self.clien
-000185f0: 742e 636c 6965 6e74 5f63 6f6e 6e65 6374  t.client_connect
-00018600: 696f 6e2e 6c61 7374 5f72 6573 706f 6e73  ion.last_respons
-00018610: 655f 6865 6164 6572 735b 0a20 2020 2020  e_headers[.     
-00018620: 2020 2020 2020 2020 2020 2020 2020 2048                 H
-00018630: 7474 7048 6561 6465 7273 2e4d 6178 4d65  ttpHeaders.MaxMe
-00018640: 6469 6153 746f 7261 6765 5573 6167 6549  diaStorageUsageI
-00018650: 6e4d 425d 290a 2020 2020 2020 2020 6966  nMB]).        if
-00018660: 2028 4874 7470 4865 6164 6572 732e 4375   (HttpHeaders.Cu
-00018670: 7272 656e 744d 6564 6961 5374 6f72 6167  rrentMediaStorag
-00018680: 6555 7361 6765 496e 4d42 2069 6e0a 2020  eUsageInMB in.  
-00018690: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000186a0: 6c66 2e63 6c69 656e 742e 636c 6965 6e74  lf.client.client
-000186b0: 5f63 6f6e 6e65 6374 696f 6e2e 6c61 7374  _connection.last
-000186c0: 5f72 6573 706f 6e73 655f 6865 6164 6572  _response_header
-000186d0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-000186e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000186f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00018700: 2020 6461 7461 6261 7365 5f61 6363 6f75    database_accou
-00018710: 6e74 2e43 7572 7265 6e74 4d65 6469 6153  nt.CurrentMediaS
-00018720: 746f 7261 6765 5573 6167 6549 6e4d 422c  torageUsageInMB,
-00018730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018740: 2073 656c 662e 636c 6965 6e74 2e63 6c69   self.client.cli
-00018750: 656e 745f 636f 6e6e 6563 7469 6f6e 2e6c  ent_connection.l
-00018760: 6173 745f 7265 7370 6f6e 7365 5f68 6561  ast_response_hea
-00018770: 6465 7273 5b0a 2020 2020 2020 2020 2020  ders[.          
-00018780: 2020 2020 2020 2020 2020 4874 7470 4865            HttpHe
-00018790: 6164 6572 732e 4375 7272 656e 744d 6564  aders.CurrentMed
-000187a0: 6961 5374 6f72 6167 6555 7361 6765 496e  iaStorageUsageIn
-000187b0: 4d42 5d29 0a20 2020 2020 2020 2073 656c  MB]).        sel
-000187c0: 662e 6173 7365 7274 4973 4e6f 744e 6f6e  f.assertIsNotNon
-000187d0: 6528 6461 7461 6261 7365 5f61 6363 6f75  e(database_accou
-000187e0: 6e74 2e43 6f6e 7369 7374 656e 6379 506f  nt.ConsistencyPo
-000187f0: 6c69 6379 5b27 6465 6661 756c 7443 6f6e  licy['defaultCon
-00018800: 7369 7374 656e 6379 4c65 7665 6c27 5d29  sistencyLevel'])
-00018810: 0a0a 2020 2020 6465 6620 7465 7374 5f69  ..    def test_i
-00018820: 6e64 6578 5f70 726f 6772 6573 735f 6865  ndex_progress_he
-00018830: 6164 6572 7328 7365 6c66 293a 0a20 2020  aders(self):.   
-00018840: 2020 2020 2063 7265 6174 6564 5f64 6220       created_db 
-00018850: 3d20 7365 6c66 2e64 6174 6162 6173 6546  = self.databaseF
-00018860: 6f72 5465 7374 0a20 2020 2020 2020 2063  orTest.        c
-00018870: 6f6e 7369 7374 656e 745f 636f 6c6c 203d  onsistent_coll =
-00018880: 2063 7265 6174 6564 5f64 622e 6372 6561   created_db.crea
-00018890: 7465 5f63 6f6e 7461 696e 6572 280a 2020  te_container(.  
-000188a0: 2020 2020 2020 2020 2020 6964 3d27 7465            id='te
-000188b0: 7374 5f69 6e64 6578 5f70 726f 6772 6573  st_index_progres
-000188c0: 735f 6865 6164 6572 7320 636f 6e73 6973  s_headers consis
-000188d0: 7465 6e74 5f63 6f6c 6c20 2720 2b20 7374  tent_coll ' + st
-000188e0: 7228 7575 6964 2e75 7569 6434 2829 292c  r(uuid.uuid4()),
-000188f0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-00018900: 7469 7469 6f6e 5f6b 6579 3d50 6172 7469  tition_key=Parti
-00018910: 7469 6f6e 4b65 7928 7061 7468 3d22 2f69  tionKey(path="/i
-00018920: 6422 2c20 6b69 6e64 3d27 4861 7368 2729  d", kind='Hash')
-00018930: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-00018940: 2020 2020 6372 6561 7465 645f 636f 6e74      created_cont
-00018950: 6169 6e65 7220 3d20 6372 6561 7465 645f  ainer = created_
-00018960: 6462 2e67 6574 5f63 6f6e 7461 696e 6572  db.get_container
-00018970: 5f63 6c69 656e 7428 636f 6e74 6169 6e65  _client(containe
-00018980: 723d 636f 6e73 6973 7465 6e74 5f63 6f6c  r=consistent_col
-00018990: 6c29 0a20 2020 2020 2020 2063 7265 6174  l).        creat
-000189a0: 6564 5f63 6f6e 7461 696e 6572 2e72 6561  ed_container.rea
-000189b0: 6428 706f 7075 6c61 7465 5f71 756f 7461  d(populate_quota
-000189c0: 5f69 6e66 6f3d 5472 7565 290a 2020 2020  _info=True).    
-000189d0: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
-000189e0: 616c 7365 2848 7474 7048 6561 6465 7273  alse(HttpHeaders
-000189f0: 2e4c 617a 7949 6e64 6578 696e 6750 726f  .LazyIndexingPro
-00018a00: 6772 6573 7320 696e 2063 7265 6174 6564  gress in created
-00018a10: 5f64 622e 636c 6965 6e74 5f63 6f6e 6e65  _db.client_conne
-00018a20: 6374 696f 6e2e 6c61 7374 5f72 6573 706f  ction.last_respo
-00018a30: 6e73 655f 6865 6164 6572 7329 0a20 2020  nse_headers).   
-00018a40: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00018a50: 5472 7565 2848 7474 7048 6561 6465 7273  True(HttpHeaders
-00018a60: 2e49 6e64 6578 5472 616e 7366 6f72 6d61  .IndexTransforma
-00018a70: 7469 6f6e 5072 6f67 7265 7373 2069 6e20  tionProgress in 
-00018a80: 6372 6561 7465 645f 6462 2e63 6c69 656e  created_db.clien
-00018a90: 745f 636f 6e6e 6563 7469 6f6e 2e6c 6173  t_connection.las
-00018aa0: 745f 7265 7370 6f6e 7365 5f68 6561 6465  t_response_heade
-00018ab0: 7273 290a 0a20 2020 2020 2020 206e 6f6e  rs)..        non
-00018ac0: 655f 636f 6c6c 203d 2063 7265 6174 6564  e_coll = created
-00018ad0: 5f64 622e 6372 6561 7465 5f63 6f6e 7461  _db.create_conta
-00018ae0: 696e 6572 280a 2020 2020 2020 2020 2020  iner(.          
-00018af0: 2020 6964 3d27 7465 7374 5f69 6e64 6578    id='test_index
-00018b00: 5f70 726f 6772 6573 735f 6865 6164 6572  _progress_header
-00018b10: 7320 6e6f 6e65 5f63 6f6c 6c20 2720 2b20  s none_coll ' + 
-00018b20: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
-00018b30: 292c 0a20 2020 2020 2020 2020 2020 2069  ),.            i
-00018b40: 6e64 6578 696e 675f 706f 6c69 6379 3d7b  ndexing_policy={
-00018b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018b60: 2027 696e 6465 7869 6e67 4d6f 6465 273a   'indexingMode':
-00018b70: 2064 6f63 756d 656e 7473 2e49 6e64 6578   documents.Index
-00018b80: 696e 674d 6f64 652e 4e6f 496e 6465 782c  ingMode.NoIndex,
-00018b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018ba0: 2027 6175 746f 6d61 7469 6327 3a20 4661   'automatic': Fa
-00018bb0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00018bc0: 7d2c 0a20 2020 2020 2020 2020 2020 2070  },.            p
-00018bd0: 6172 7469 7469 6f6e 5f6b 6579 3d50 6172  artition_key=Par
-00018be0: 7469 7469 6f6e 4b65 7928 7061 7468 3d22  titionKey(path="
-00018bf0: 2f69 6422 2c20 6b69 6e64 3d27 4861 7368  /id", kind='Hash
-00018c00: 2729 0a20 2020 2020 2020 2029 0a20 2020  ').        ).   
-00018c10: 2020 2020 2063 7265 6174 6564 5f63 6f6e       created_con
-00018c20: 7461 696e 6572 203d 2063 7265 6174 6564  tainer = created
-00018c30: 5f64 622e 6765 745f 636f 6e74 6169 6e65  _db.get_containe
-00018c40: 725f 636c 6965 6e74 2863 6f6e 7461 696e  r_client(contain
-00018c50: 6572 3d6e 6f6e 655f 636f 6c6c 290a 2020  er=none_coll).  
-00018c60: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
-00018c70: 6e74 6169 6e65 722e 7265 6164 2870 6f70  ntainer.read(pop
-00018c80: 756c 6174 655f 7175 6f74 615f 696e 666f  ulate_quota_info
-00018c90: 3d54 7275 6529 0a20 2020 2020 2020 2073  =True).        s
-00018ca0: 656c 662e 6173 7365 7274 4661 6c73 6528  elf.assertFalse(
-00018cb0: 4874 7470 4865 6164 6572 732e 4c61 7a79  HttpHeaders.Lazy
-00018cc0: 496e 6465 7869 6e67 5072 6f67 7265 7373  IndexingProgress
-00018cd0: 2069 6e20 6372 6561 7465 645f 6462 2e63   in created_db.c
-00018ce0: 6c69 656e 745f 636f 6e6e 6563 7469 6f6e  lient_connection
-00018cf0: 2e6c 6173 745f 7265 7370 6f6e 7365 5f68  .last_response_h
-00018d00: 6561 6465 7273 290a 2020 2020 2020 2020  eaders).        
-00018d10: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
-00018d20: 4874 7470 4865 6164 6572 732e 496e 6465  HttpHeaders.Inde
-00018d30: 7854 7261 6e73 666f 726d 6174 696f 6e50  xTransformationP
-00018d40: 726f 6772 6573 7320 696e 2063 7265 6174  rogress in creat
-00018d50: 6564 5f64 622e 636c 6965 6e74 5f63 6f6e  ed_db.client_con
-00018d60: 6e65 6374 696f 6e2e 6c61 7374 5f72 6573  nection.last_res
-00018d70: 706f 6e73 655f 6865 6164 6572 7329 0a0a  ponse_headers)..
-00018d80: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-00018d90: 6462 2e64 656c 6574 655f 636f 6e74 6169  db.delete_contai
-00018da0: 6e65 7228 636f 6e73 6973 7465 6e74 5f63  ner(consistent_c
-00018db0: 6f6c 6c29 0a20 2020 2020 2020 2063 7265  oll).        cre
-00018dc0: 6174 6564 5f64 622e 6465 6c65 7465 5f63  ated_db.delete_c
-00018dd0: 6f6e 7461 696e 6572 286e 6f6e 655f 636f  ontainer(none_co
-00018de0: 6c6c 290a 0a20 2020 2064 6566 2074 6573  ll)..    def tes
-00018df0: 745f 6964 5f76 616c 6964 6174 696f 6e28  t_id_validation(
-00018e00: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
-00018e10: 2049 6420 7368 6f75 6c64 6e27 7420 656e   Id shouldn't en
-00018e20: 6420 7769 7468 2073 7061 6365 2e0a 2020  d with space..  
-00018e30: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00018e40: 2020 2020 2020 2073 656c 662e 636c 6965         self.clie
-00018e50: 6e74 2e63 7265 6174 655f 6461 7461 6261  nt.create_databa
-00018e60: 7365 2869 643d 2769 645f 7769 7468 5f73  se(id='id_with_s
-00018e70: 7061 6365 2027 290a 2020 2020 2020 2020  pace ').        
-00018e80: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
-00018e90: 616c 7365 2854 7275 6529 0a20 2020 2020  alse(True).     
-00018ea0: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
-00018eb0: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-00018ec0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00018ed0: 7274 4571 7561 6c28 2749 6420 656e 6473  rtEqual('Id ends
-00018ee0: 2077 6974 6820 6120 7370 6163 652e 272c   with a space.',
-00018ef0: 2065 2e61 7267 735b 305d 290a 2020 2020   e.args[0]).    
-00018f00: 2020 2020 2320 4964 2073 686f 756c 646e      # Id shouldn
-00018f10: 2774 2063 6f6e 7461 696e 2027 2f27 2e0a  't contain '/'..
-00018f20: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00018f30: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00018f40: 6c69 656e 742e 6372 6561 7465 5f64 6174  lient.create_dat
-00018f50: 6162 6173 6528 6964 3d27 6964 5f77 6974  abase(id='id_wit
-00018f60: 685f 696c 6c65 6761 6c2f 5f63 6861 7227  h_illegal/_char'
-00018f70: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00018f80: 6c66 2e61 7373 6572 7446 616c 7365 2854  lf.assertFalse(T
-00018f90: 7275 6529 0a20 2020 2020 2020 2065 7863  rue).        exc
-00018fa0: 6570 7420 5661 6c75 6545 7272 6f72 2061  ept ValueError a
-00018fb0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00018fc0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00018fd0: 6c28 2749 6420 636f 6e74 6169 6e73 2069  l('Id contains i
-00018fe0: 6c6c 6567 616c 2063 6861 7273 2e27 2c20  llegal chars.', 
-00018ff0: 652e 6172 6773 5b30 5d29 0a20 2020 2020  e.args[0]).     
-00019000: 2020 2023 2049 6420 7368 6f75 6c64 6e27     # Id shouldn'
-00019010: 7420 636f 6e74 6169 6e20 275c 5c27 2e0a  t contain '\\'..
-00019020: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00019030: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00019040: 6c69 656e 742e 6372 6561 7465 5f64 6174  lient.create_dat
-00019050: 6162 6173 6528 6964 3d27 6964 5f77 6974  abase(id='id_wit
-00019060: 685f 696c 6c65 6761 6c5c 5c5f 6368 6172  h_illegal\\_char
-00019070: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
-00019080: 656c 662e 6173 7365 7274 4661 6c73 6528  elf.assertFalse(
-00019090: 5472 7565 290a 2020 2020 2020 2020 6578  True).        ex
-000190a0: 6365 7074 2056 616c 7565 4572 726f 7220  cept ValueError 
-000190b0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-000190c0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000190d0: 616c 2827 4964 2063 6f6e 7461 696e 7320  al('Id contains 
-000190e0: 696c 6c65 6761 6c20 6368 6172 732e 272c  illegal chars.',
-000190f0: 2065 2e61 7267 735b 305d 290a 2020 2020   e.args[0]).    
-00019100: 2020 2020 2320 4964 2073 686f 756c 646e      # Id shouldn
-00019110: 2774 2063 6f6e 7461 696e 2027 3f27 2e0a  't contain '?'..
-00019120: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00019130: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00019140: 6c69 656e 742e 6372 6561 7465 5f64 6174  lient.create_dat
-00019150: 6162 6173 6528 6964 3d27 6964 5f77 6974  abase(id='id_wit
-00019160: 685f 696c 6c65 6761 6c3f 5f63 6861 7227  h_illegal?_char'
-00019170: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00019180: 6c66 2e61 7373 6572 7446 616c 7365 2854  lf.assertFalse(T
-00019190: 7275 6529 0a20 2020 2020 2020 2065 7863  rue).        exc
-000191a0: 6570 7420 5661 6c75 6545 7272 6f72 2061  ept ValueError a
-000191b0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-000191c0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000191d0: 6c28 2749 6420 636f 6e74 6169 6e73 2069  l('Id contains i
-000191e0: 6c6c 6567 616c 2063 6861 7273 2e27 2c20  llegal chars.', 
-000191f0: 652e 6172 6773 5b30 5d29 0a20 2020 2020  e.args[0]).     
-00019200: 2020 2023 2049 6420 7368 6f75 6c64 6e27     # Id shouldn'
-00019210: 7420 636f 6e74 6169 6e20 2723 272e 0a0a  t contain '#'...
-00019220: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00019230: 2020 2020 2020 2020 2073 656c 662e 636c           self.cl
-00019240: 6965 6e74 2e63 7265 6174 655f 6461 7461  ient.create_data
-00019250: 6261 7365 2869 643d 2769 645f 7769 7468  base(id='id_with
-00019260: 5f69 6c6c 6567 616c 235f 6368 6172 2729  _illegal#_char')
-00019270: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00019280: 662e 6173 7365 7274 4661 6c73 6528 5472  f.assertFalse(Tr
-00019290: 7565 290a 2020 2020 2020 2020 6578 6365  ue).        exce
-000192a0: 7074 2056 616c 7565 4572 726f 7220 6173  pt ValueError as
-000192b0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-000192c0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000192d0: 2827 4964 2063 6f6e 7461 696e 7320 696c  ('Id contains il
-000192e0: 6c65 6761 6c20 6368 6172 732e 272c 2065  legal chars.', e
-000192f0: 2e61 7267 735b 305d 290a 0a20 2020 2020  .args[0])..     
-00019300: 2020 2023 2049 6420 6361 6e20 6265 6769     # Id can begi
-00019310: 6e20 7769 7468 2073 7061 6365 0a20 2020  n with space.   
-00019320: 2020 2020 2064 6220 3d20 7365 6c66 2e63       db = self.c
-00019330: 6c69 656e 742e 6372 6561 7465 5f64 6174  lient.create_dat
-00019340: 6162 6173 6528 6964 3d27 2069 645f 6265  abase(id=' id_be
-00019350: 6769 6e5f 7370 6163 6527 290a 2020 2020  gin_space').    
-00019360: 2020 2020 7365 6c66 2e61 7373 6572 7454      self.assertT
-00019370: 7275 6528 5472 7565 290a 0a20 2020 2020  rue(True)..     
-00019380: 2020 2073 656c 662e 636c 6965 6e74 2e64     self.client.d
-00019390: 656c 6574 655f 6461 7461 6261 7365 2864  elete_database(d
-000193a0: 6174 6162 6173 653d 6462 290a 0a20 2020  atabase=db)..   
-000193b0: 2064 6566 2074 6573 745f 6964 5f63 6173   def test_id_cas
-000193c0: 655f 7661 6c69 6461 7469 6f6e 2873 656c  e_validation(sel
-000193d0: 6629 3a0a 2020 2020 2020 2020 2320 6372  f):.        # cr
-000193e0: 6561 7465 2064 6174 6162 6173 650a 2020  eate database.  
-000193f0: 2020 2020 2020 6372 6561 7465 645f 6462        created_db
-00019400: 203d 2073 656c 662e 6461 7461 6261 7365   = self.database
-00019410: 466f 7254 6573 740a 0a20 2020 2020 2020  ForTest..       
-00019420: 2075 7569 645f 7374 7269 6e67 203d 2073   uuid_string = s
-00019430: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
-00019440: 0a20 2020 2020 2020 2063 6f6c 6c65 6374  .        collect
-00019450: 696f 6e5f 6964 3120 3d20 2773 616d 706c  ion_id1 = 'sampl
-00019460: 6543 6f6c 6c65 6374 696f 6e20 2720 2b20  eCollection ' + 
-00019470: 7575 6964 5f73 7472 696e 670a 2020 2020  uuid_string.    
-00019480: 2020 2020 636f 6c6c 6563 7469 6f6e 5f69      collection_i
-00019490: 6432 203d 2027 5361 6d70 6c65 436f 6c6c  d2 = 'SampleColl
-000194a0: 6563 7469 6f6e 2027 202b 2075 7569 645f  ection ' + uuid_
-000194b0: 7374 7269 6e67 0a0a 2020 2020 2020 2020  string..        
-000194c0: 2320 5665 7269 6679 2074 6861 7420 6e6f  # Verify that no
-000194d0: 2063 6f6c 6c65 6374 696f 6e73 2065 7869   collections exi
-000194e0: 7374 0a20 2020 2020 2020 2063 6f6c 6c65  st.        colle
-000194f0: 6374 696f 6e73 203d 206c 6973 7428 6372  ctions = list(cr
-00019500: 6561 7465 645f 6462 2e6c 6973 745f 636f  eated_db.list_co
-00019510: 6e74 6169 6e65 7273 2829 290a 2020 2020  ntainers()).    
-00019520: 2020 2020 6e75 6d62 6572 5f6f 665f 6578      number_of_ex
-00019530: 6973 7469 6e67 5f63 6f6c 6c65 6374 696f  isting_collectio
-00019540: 6e73 203d 206c 656e 2863 6f6c 6c65 6374  ns = len(collect
-00019550: 696f 6e73 290a 0a20 2020 2020 2020 2023  ions)..        #
-00019560: 2063 7265 6174 6520 3220 636f 6c6c 6563   create 2 collec
-00019570: 7469 6f6e 7320 7769 7468 2064 6966 6665  tions with diffe
-00019580: 7265 6e74 2063 6173 696e 6720 6f66 2049  rent casing of I
-00019590: 4473 0a20 2020 2020 2020 2023 2070 6173  Ds.        # pas
-000195a0: 6361 6c43 6173 650a 2020 2020 2020 2020  calCase.        
-000195b0: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
-000195c0: 6f6e 3120 3d20 6372 6561 7465 645f 6462  on1 = created_db
-000195d0: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
-000195e0: 7228 0a20 2020 2020 2020 2020 2020 2069  r(.            i
-000195f0: 643d 636f 6c6c 6563 7469 6f6e 5f69 6431  d=collection_id1
-00019600: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-00019610: 7274 6974 696f 6e5f 6b65 793d 5061 7274  rtition_key=Part
-00019620: 6974 696f 6e4b 6579 2870 6174 683d 272f  itionKey(path='/
-00019630: 6964 272c 206b 696e 643d 2748 6173 6827  id', kind='Hash'
-00019640: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
-00019650: 2020 2020 2023 2043 616d 656c 4361 7365       # CamelCase
-00019660: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
-00019670: 5f63 6f6c 6c65 6374 696f 6e32 203d 2063  _collection2 = c
-00019680: 7265 6174 6564 5f64 622e 6372 6561 7465  reated_db.create
-00019690: 5f63 6f6e 7461 696e 6572 280a 2020 2020  _container(.    
-000196a0: 2020 2020 2020 2020 6964 3d63 6f6c 6c65          id=colle
-000196b0: 6374 696f 6e5f 6964 322c 0a20 2020 2020  ction_id2,.     
-000196c0: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
-000196d0: 5f6b 6579 3d50 6172 7469 7469 6f6e 4b65  _key=PartitionKe
-000196e0: 7928 7061 7468 3d27 2f69 6427 2c20 6b69  y(path='/id', ki
-000196f0: 6e64 3d27 4861 7368 2729 0a20 2020 2020  nd='Hash').     
-00019700: 2020 2029 0a0a 2020 2020 2020 2020 636f     )..        co
-00019710: 6c6c 6563 7469 6f6e 7320 3d20 6c69 7374  llections = list
-00019720: 2863 7265 6174 6564 5f64 622e 6c69 7374  (created_db.list
-00019730: 5f63 6f6e 7461 696e 6572 7328 2929 0a0a  _containers())..
-00019740: 2020 2020 2020 2020 2320 7665 7269 6679          # verify
-00019750: 2069 6620 6120 746f 7461 6c20 6f66 2032   if a total of 2
-00019760: 2063 6f6c 6c65 6374 696f 6e73 2067 6f74   collections got
-00019770: 2063 7265 6174 6564 0a20 2020 2020 2020   created.       
-00019780: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00019790: 6c28 6c65 6e28 636f 6c6c 6563 7469 6f6e  l(len(collection
-000197a0: 7329 2c20 6e75 6d62 6572 5f6f 665f 6578  s), number_of_ex
-000197b0: 6973 7469 6e67 5f63 6f6c 6c65 6374 696f  isting_collectio
-000197c0: 6e73 202b 2032 290a 0a20 2020 2020 2020  ns + 2)..       
-000197d0: 2023 2076 6572 6966 7920 7468 6174 2063   # verify that c
-000197e0: 6f6c 6c65 6374 696f 6e73 2061 7265 2063  ollections are c
-000197f0: 7265 6174 6564 2077 6974 6820 7370 6563  reated with spec
-00019800: 6966 6965 6420 4944 730a 2020 2020 2020  ified IDs.      
-00019810: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00019820: 616c 2863 6f6c 6c65 6374 696f 6e5f 6964  al(collection_id
-00019830: 312c 2063 7265 6174 6564 5f63 6f6c 6c65  1, created_colle
-00019840: 6374 696f 6e31 2e69 6429 0a20 2020 2020  ction1.id).     
-00019850: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00019860: 7561 6c28 636f 6c6c 6563 7469 6f6e 5f69  ual(collection_i
-00019870: 6432 2c20 6372 6561 7465 645f 636f 6c6c  d2, created_coll
-00019880: 6563 7469 6f6e 322e 6964 290a 0a20 2020  ection2.id)..   
-00019890: 2020 2020 2063 7265 6174 6564 5f64 622e       created_db.
-000198a0: 6465 6c65 7465 5f63 6f6e 7461 696e 6572  delete_container
-000198b0: 2863 7265 6174 6564 5f63 6f6c 6c65 6374  (created_collect
-000198c0: 696f 6e31 290a 2020 2020 2020 2020 6372  ion1).        cr
-000198d0: 6561 7465 645f 6462 2e64 656c 6574 655f  eated_db.delete_
-000198e0: 636f 6e74 6169 6e65 7228 6372 6561 7465  container(create
-000198f0: 645f 636f 6c6c 6563 7469 6f6e 3229 0a0a  d_collection2)..
-00019900: 2020 2020 2354 4f44 4f3a 2066 6978 2074      #TODO: fix t
-00019910: 6573 740a 2020 2020 4070 7974 6573 742e  est.    @pytest.
-00019920: 6d61 726b 2e73 6b69 700a 2020 2020 6465  mark.skip.    de
-00019930: 6620 7465 7374 5f69 645f 756e 6963 6f64  f test_id_unicod
-00019940: 655f 7661 6c69 6461 7469 6f6e 2873 656c  e_validation(sel
-00019950: 6629 3a0a 2020 2020 2020 2020 2320 6372  f):.        # cr
-00019960: 6561 7465 2064 6174 6162 6173 650a 2020  eate database.  
-00019970: 2020 2020 2020 6372 6561 7465 645f 6462        created_db
-00019980: 203d 2073 656c 662e 6461 7461 6261 7365   = self.database
-00019990: 466f 7254 6573 740a 0a20 2020 2020 2020  ForTest..       
-000199a0: 2023 2075 6e69 636f 6465 2063 6861 7273   # unicode chars
-000199b0: 2069 6e20 4869 6e64 6920 666f 7220 4964   in Hindi for Id
-000199c0: 2077 6869 6368 2074 7261 6e73 6c61 7465   which translate
-000199d0: 7320 746f 3a20 2248 696e 6469 2069 7320  s to: "Hindi is 
-000199e0: 7468 6520 6e61 7469 6f6e 616c 206c 616e  the national lan
-000199f0: 6775 6167 6520 6f66 2049 6e64 6961 220a  guage of India".
-00019a00: 2020 2020 2020 2020 636f 6c6c 6563 7469          collecti
-00019a10: 6f6e 5f69 6431 203d 2075 27e0 a4b9 e0a4  on_id1 = u'.....
-00019a20: bfe0 a4a8 e0a5 8de0 a4a6 e0a5 8020 e0a4  ............. ..
-00019a30: ade0 a4be e0a4 b0e0 a4a4 20e0 a495 e0a5  .......... .....
-00019a40: 8020 e0a4 b0e0 a4be e0a4 b7e0 a58d e0a4  . ..............
-00019a50: 9fe0 a58d e0a4 b0e0 a580 e0a4 af20 e0a4  ............. ..
-00019a60: ade0 a4be e0a4 b7e0 a4be 20e0 a4b9 e0a5  .......... .....
-00019a70: 8827 2023 2063 7370 656c 6c3a 6469 7361  .' # cspell:disa
-00019a80: 626c 652d 6c69 6e65 0a0a 2020 2020 2020  ble-line..      
-00019a90: 2020 2320 5370 6563 6961 6c20 6368 6172    # Special char
-00019aa0: 7320 666f 7220 4964 0a20 2020 2020 2020  s for Id.       
-00019ab0: 2063 6f6c 6c65 6374 696f 6e5f 6964 3220   collection_id2 
-00019ac0: 3d20 2221 4024 255e 262a 2829 2d7e 6027  = "!@$%^&*()-~`'
-00019ad0: 5f5b 5d7b 7d7c 3b3a 2c2e 3c3e 220a 0a20  _[]{}|;:,.<>".. 
-00019ae0: 2020 2020 2020 2023 2076 6572 6966 7920         # verify 
-00019af0: 7468 6174 2063 6f6c 6c65 6374 696f 6e73  that collections
-00019b00: 2061 7265 2063 7265 6174 6564 2077 6974   are created wit
-00019b10: 6820 7370 6563 6966 6965 6420 4944 730a  h specified IDs.
-00019b20: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-00019b30: 636f 6c6c 6563 7469 6f6e 3120 3d20 6372  collection1 = cr
-00019b40: 6561 7465 645f 6462 2e63 7265 6174 655f  eated_db.create_
-00019b50: 636f 6e74 6169 6e65 7228 0a20 2020 2020  container(.     
-00019b60: 2020 2020 2020 2069 643d 636f 6c6c 6563         id=collec
-00019b70: 7469 6f6e 5f69 6431 2c0a 2020 2020 2020  tion_id1,.      
-00019b80: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
-00019b90: 6b65 793d 5061 7274 6974 696f 6e4b 6579  key=PartitionKey
-00019ba0: 2870 6174 683d 272f 6964 272c 206b 696e  (path='/id', kin
-00019bb0: 643d 2748 6173 6827 290a 2020 2020 2020  d='Hash').      
-00019bc0: 2020 290a 2020 2020 2020 2020 6372 6561    ).        crea
-00019bd0: 7465 645f 636f 6c6c 6563 7469 6f6e 3220  ted_collection2 
-00019be0: 3d20 6372 6561 7465 645f 6462 2e63 7265  = created_db.cre
-00019bf0: 6174 655f 636f 6e74 6169 6e65 7228 0a20  ate_container(. 
-00019c00: 2020 2020 2020 2020 2020 2069 643d 636f             id=co
-00019c10: 6c6c 6563 7469 6f6e 5f69 6432 2c0a 2020  llection_id2,.  
-00019c20: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-00019c30: 696f 6e5f 6b65 793d 5061 7274 6974 696f  ion_key=Partitio
-00019c40: 6e4b 6579 2870 6174 683d 272f 6964 272c  nKey(path='/id',
-00019c50: 206b 696e 643d 2748 6173 6827 290a 2020   kind='Hash').  
-00019c60: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00019c70: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00019c80: 6c28 636f 6c6c 6563 7469 6f6e 5f69 6431  l(collection_id1
-00019c90: 2c20 6372 6561 7465 645f 636f 6c6c 6563  , created_collec
-00019ca0: 7469 6f6e 312e 6964 290a 2020 2020 2020  tion1.id).      
-00019cb0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00019cc0: 616c 2863 6f6c 6c65 6374 696f 6e5f 6964  al(collection_id
-00019cd0: 322c 2063 7265 6174 6564 5f63 6f6c 6c65  2, created_colle
-00019ce0: 6374 696f 6e32 2e69 6429 0a20 2020 2020  ction2.id).     
-00019cf0: 2020 200a 2020 2020 2020 2020 6372 6561     .        crea
-00019d00: 7465 645f 636f 6c6c 6563 7469 6f6e 315f  ted_collection1_
-00019d10: 7072 6f70 6572 7469 6573 203d 2063 7265  properties = cre
-00019d20: 6174 6564 5f63 6f6c 6c65 6374 696f 6e31  ated_collection1
-00019d30: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
-00019d40: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
-00019d50: 6f6e 325f 7072 6f70 6572 7469 6573 203d  on2_properties =
-00019d60: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
-00019d70: 696f 6e32 2e72 6561 6428 290a 0a20 2020  ion2.read()..   
-00019d80: 2020 2020 2063 7265 6174 6564 5f64 622e       created_db.
-00019d90: 636c 6965 6e74 5f63 6f6e 6e65 6374 696f  client_connectio
-00019da0: 6e2e 4465 6c65 7465 436f 6e74 6169 6e65  n.DeleteContaine
-00019db0: 7228 6372 6561 7465 645f 636f 6c6c 6563  r(created_collec
-00019dc0: 7469 6f6e 315f 7072 6f70 6572 7469 6573  tion1_properties
-00019dd0: 5b27 5f73 656c 6627 5d29 0a20 2020 2020  ['_self']).     
-00019de0: 2020 2063 7265 6174 6564 5f64 622e 636c     created_db.cl
-00019df0: 6965 6e74 5f63 6f6e 6e65 6374 696f 6e2e  ient_connection.
-00019e00: 4465 6c65 7465 436f 6e74 6169 6e65 7228  DeleteContainer(
-00019e10: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
-00019e20: 6f6e 325f 7072 6f70 6572 7469 6573 5b27  on2_properties['
-00019e30: 5f73 656c 6627 5d29 0a0a 2020 2020 6465  _self'])..    de
-00019e40: 6620 7465 7374 5f67 6574 5f72 6573 6f75  f test_get_resou
-00019e50: 7263 655f 7769 7468 5f64 6963 7469 6f6e  rce_with_diction
-00019e60: 6172 795f 616e 645f 6f62 6a65 6374 2873  ary_and_object(s
-00019e70: 656c 6629 3a0a 2020 2020 2020 2020 6372  elf):.        cr
-00019e80: 6561 7465 645f 6462 203d 2073 656c 662e  eated_db = self.
-00019e90: 6461 7461 6261 7365 466f 7254 6573 740a  databaseForTest.
-00019ea0: 0a20 2020 2020 2020 2023 2072 6561 6420  .        # read 
-00019eb0: 6461 7461 6261 7365 2077 6974 6820 6964  database with id
-00019ec0: 0a20 2020 2020 2020 2072 6561 645f 6462  .        read_db
-00019ed0: 203d 2073 656c 662e 636c 6965 6e74 2e67   = self.client.g
-00019ee0: 6574 5f64 6174 6162 6173 655f 636c 6965  et_database_clie
-00019ef0: 6e74 2863 7265 6174 6564 5f64 622e 6964  nt(created_db.id
-00019f00: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00019f10: 7373 6572 7445 7175 616c 2872 6561 645f  ssertEqual(read_
-00019f20: 6462 2e69 642c 2063 7265 6174 6564 5f64  db.id, created_d
-00019f30: 622e 6964 290a 0a20 2020 2020 2020 2023  b.id)..        #
-00019f40: 2072 6561 6420 6461 7461 6261 7365 2077   read database w
-00019f50: 6974 6820 696e 7374 616e 6365 0a20 2020  ith instance.   
-00019f60: 2020 2020 2072 6561 645f 6462 203d 2073       read_db = s
-00019f70: 656c 662e 636c 6965 6e74 2e67 6574 5f64  elf.client.get_d
-00019f80: 6174 6162 6173 655f 636c 6965 6e74 2863  atabase_client(c
-00019f90: 7265 6174 6564 5f64 6229 0a20 2020 2020  reated_db).     
-00019fa0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00019fb0: 7561 6c28 7265 6164 5f64 622e 6964 2c20  ual(read_db.id, 
-00019fc0: 6372 6561 7465 645f 6462 2e69 6429 0a0a  created_db.id)..
-00019fd0: 2020 2020 2020 2020 2320 7265 6164 2064          # read d
-00019fe0: 6174 6162 6173 6520 7769 7468 2070 726f  atabase with pro
-00019ff0: 7065 7274 6965 730a 2020 2020 2020 2020  perties.        
-0001a000: 7265 6164 5f64 6220 3d20 7365 6c66 2e63  read_db = self.c
-0001a010: 6c69 656e 742e 6765 745f 6461 7461 6261  lient.get_databa
-0001a020: 7365 5f63 6c69 656e 7428 6372 6561 7465  se_client(create
-0001a030: 645f 6462 2e72 6561 6428 2929 0a20 2020  d_db.read()).   
-0001a040: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001a050: 4571 7561 6c28 7265 6164 5f64 622e 6964  Equal(read_db.id
-0001a060: 2c20 6372 6561 7465 645f 6462 2e69 6429  , created_db.id)
-0001a070: 0a0a 2020 2020 2020 2020 6372 6561 7465  ..        create
-0001a080: 645f 636f 6e74 6169 6e65 7220 3d20 7365  d_container = se
-0001a090: 6c66 2e63 6f6e 6669 6773 2e63 7265 6174  lf.configs.creat
-0001a0a0: 655f 6d75 6c74 695f 7061 7274 6974 696f  e_multi_partitio
-0001a0b0: 6e5f 636f 6c6c 6563 7469 6f6e 5f69 665f  n_collection_if_
-0001a0c0: 6e6f 745f 6578 6973 7428 7365 6c66 2e63  not_exist(self.c
-0001a0d0: 6c69 656e 7429 0a0a 2020 2020 2020 2020  lient)..        
-0001a0e0: 2320 7265 6164 2063 6f6e 7461 696e 6572  # read container
-0001a0f0: 2077 6974 6820 6964 0a20 2020 2020 2020   with id.       
-0001a100: 2072 6561 645f 636f 6e74 6169 6e65 7220   read_container 
-0001a110: 3d20 6372 6561 7465 645f 6462 2e67 6574  = created_db.get
-0001a120: 5f63 6f6e 7461 696e 6572 5f63 6c69 656e  _container_clien
-0001a130: 7428 6372 6561 7465 645f 636f 6e74 6169  t(created_contai
-0001a140: 6e65 722e 6964 290a 2020 2020 2020 2020  ner.id).        
-0001a150: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0001a160: 2872 6561 645f 636f 6e74 6169 6e65 722e  (read_container.
-0001a170: 6964 2c20 6372 6561 7465 645f 636f 6e74  id, created_cont
-0001a180: 6169 6e65 722e 6964 290a 0a20 2020 2020  ainer.id)..     
-0001a190: 2020 2023 2072 6561 6420 636f 6e74 6169     # read contai
-0001a1a0: 6e65 7220 7769 7468 2069 6e73 7461 6e63  ner with instanc
-0001a1b0: 650a 2020 2020 2020 2020 7265 6164 5f63  e.        read_c
-0001a1c0: 6f6e 7461 696e 6572 203d 2063 7265 6174  ontainer = creat
-0001a1d0: 6564 5f64 622e 6765 745f 636f 6e74 6169  ed_db.get_contai
-0001a1e0: 6e65 725f 636c 6965 6e74 2863 7265 6174  ner_client(creat
-0001a1f0: 6564 5f63 6f6e 7461 696e 6572 290a 2020  ed_container).  
-0001a200: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001a210: 7445 7175 616c 2872 6561 645f 636f 6e74  tEqual(read_cont
-0001a220: 6169 6e65 722e 6964 2c20 6372 6561 7465  ainer.id, create
-0001a230: 645f 636f 6e74 6169 6e65 722e 6964 290a  d_container.id).
-0001a240: 0a20 2020 2020 2020 2023 2072 6561 6420  .        # read 
-0001a250: 636f 6e74 6169 6e65 7220 7769 7468 2070  container with p
-0001a260: 726f 7065 7274 6965 730a 2020 2020 2020  roperties.      
-0001a270: 2020 6372 6561 7465 645f 7072 6f70 6572    created_proper
-0001a280: 7469 6573 203d 2063 7265 6174 6564 5f63  ties = created_c
-0001a290: 6f6e 7461 696e 6572 2e72 6561 6428 290a  ontainer.read().
-0001a2a0: 2020 2020 2020 2020 7265 6164 5f63 6f6e          read_con
-0001a2b0: 7461 696e 6572 203d 2063 7265 6174 6564  tainer = created
-0001a2c0: 5f64 622e 6765 745f 636f 6e74 6169 6e65  _db.get_containe
-0001a2d0: 725f 636c 6965 6e74 2863 7265 6174 6564  r_client(created
-0001a2e0: 5f70 726f 7065 7274 6965 7329 0a20 2020  _properties).   
-0001a2f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001a300: 4571 7561 6c28 7265 6164 5f63 6f6e 7461  Equal(read_conta
-0001a310: 696e 6572 2e69 642c 2063 7265 6174 6564  iner.id, created
-0001a320: 5f63 6f6e 7461 696e 6572 2e69 6429 0a0a  _container.id)..
-0001a330: 2020 2020 2020 2020 6372 6561 7465 645f          created_
-0001a340: 6974 656d 203d 2063 7265 6174 6564 5f63  item = created_c
-0001a350: 6f6e 7461 696e 6572 2e63 7265 6174 655f  ontainer.create_
-0001a360: 6974 656d 287b 2769 6427 3a27 3127 202b  item({'id':'1' +
-0001a370: 2073 7472 2875 7569 642e 7575 6964 3428   str(uuid.uuid4(
-0001a380: 2929 7d29 0a0a 2020 2020 2020 2020 2320  ))})..        # 
-0001a390: 7265 6164 2069 7465 6d20 7769 7468 2069  read item with i
-0001a3a0: 640a 2020 2020 2020 2020 7265 6164 5f69  d.        read_i
-0001a3b0: 7465 6d20 3d20 6372 6561 7465 645f 636f  tem = created_co
-0001a3c0: 6e74 6169 6e65 722e 7265 6164 5f69 7465  ntainer.read_ite
-0001a3d0: 6d28 6974 656d 3d63 7265 6174 6564 5f69  m(item=created_i
-0001a3e0: 7465 6d5b 2769 6427 5d2c 2070 6172 7469  tem['id'], parti
-0001a3f0: 7469 6f6e 5f6b 6579 3d63 7265 6174 6564  tion_key=created
-0001a400: 5f69 7465 6d5b 2769 6427 5d29 0a20 2020  _item['id']).   
-0001a410: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001a420: 4571 7561 6c28 7265 6164 5f69 7465 6d5b  Equal(read_item[
-0001a430: 2769 6427 5d2c 2063 7265 6174 6564 5f69  'id'], created_i
-0001a440: 7465 6d5b 2769 6427 5d29 0a0a 2020 2020  tem['id'])..    
-0001a450: 2020 2020 2320 7265 6164 2069 7465 6d20      # read item 
-0001a460: 7769 7468 2070 726f 7065 7274 6965 730a  with properties.
-0001a470: 2020 2020 2020 2020 7265 6164 5f69 7465          read_ite
-0001a480: 6d20 3d20 6372 6561 7465 645f 636f 6e74  m = created_cont
-0001a490: 6169 6e65 722e 7265 6164 5f69 7465 6d28  ainer.read_item(
-0001a4a0: 6974 656d 3d63 7265 6174 6564 5f69 7465  item=created_ite
-0001a4b0: 6d2c 2070 6172 7469 7469 6f6e 5f6b 6579  m, partition_key
-0001a4c0: 3d63 7265 6174 6564 5f69 7465 6d5b 2769  =created_item['i
-0001a4d0: 6427 5d29 0a20 2020 2020 2020 2073 656c  d']).        sel
-0001a4e0: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-0001a4f0: 6164 5f69 7465 6d5b 2769 6427 5d2c 2063  ad_item['id'], c
-0001a500: 7265 6174 6564 5f69 7465 6d5b 2769 6427  reated_item['id'
-0001a510: 5d29 0a0a 2020 2020 2020 2020 6372 6561  ])..        crea
-0001a520: 7465 645f 7370 726f 6320 3d20 6372 6561  ted_sproc = crea
-0001a530: 7465 645f 636f 6e74 6169 6e65 722e 7363  ted_container.sc
-0001a540: 7269 7074 732e 6372 6561 7465 5f73 746f  ripts.create_sto
-0001a550: 7265 645f 7072 6f63 6564 7572 6528 7b0a  red_procedure({.
-0001a560: 2020 2020 2020 2020 2020 2020 2769 6427              'id'
-0001a570: 3a20 2773 746f 7265 6450 726f 6365 6475  : 'storedProcedu
-0001a580: 7265 2720 2b20 7374 7228 7575 6964 2e75  re' + str(uuid.u
-0001a590: 7569 6434 2829 292c 0a20 2020 2020 2020  uid4()),.       
-0001a5a0: 2020 2020 2027 626f 6479 273a 2027 6675       'body': 'fu
-0001a5b0: 6e63 7469 6f6e 2028 2920 7b20 7d27 0a20  nction () { }'. 
-0001a5c0: 2020 2020 2020 207d 290a 0a20 2020 2020         })..     
-0001a5d0: 2020 2023 2072 6561 6420 7370 726f 6320     # read sproc 
-0001a5e0: 7769 7468 2069 640a 2020 2020 2020 2020  with id.        
-0001a5f0: 7265 6164 5f73 7072 6f63 203d 2063 7265  read_sproc = cre
-0001a600: 6174 6564 5f63 6f6e 7461 696e 6572 2e73  ated_container.s
-0001a610: 6372 6970 7473 2e67 6574 5f73 746f 7265  cripts.get_store
-0001a620: 645f 7072 6f63 6564 7572 6528 6372 6561  d_procedure(crea
-0001a630: 7465 645f 7370 726f 635b 2769 6427 5d29  ted_sproc['id'])
-0001a640: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0001a650: 7365 7274 4571 7561 6c28 7265 6164 5f73  sertEqual(read_s
-0001a660: 7072 6f63 5b27 6964 275d 2c20 6372 6561  proc['id'], crea
-0001a670: 7465 645f 7370 726f 635b 2769 6427 5d29  ted_sproc['id'])
-0001a680: 0a0a 2020 2020 2020 2020 2320 7265 6164  ..        # read
-0001a690: 2073 7072 6f63 2077 6974 6820 7072 6f70   sproc with prop
-0001a6a0: 6572 7469 6573 0a20 2020 2020 2020 2072  erties.        r
-0001a6b0: 6561 645f 7370 726f 6320 3d20 6372 6561  ead_sproc = crea
-0001a6c0: 7465 645f 636f 6e74 6169 6e65 722e 7363  ted_container.sc
-0001a6d0: 7269 7074 732e 6765 745f 7374 6f72 6564  ripts.get_stored
-0001a6e0: 5f70 726f 6365 6475 7265 2863 7265 6174  _procedure(creat
-0001a6f0: 6564 5f73 7072 6f63 290a 2020 2020 2020  ed_sproc).      
-0001a700: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001a710: 616c 2872 6561 645f 7370 726f 635b 2769  al(read_sproc['i
-0001a720: 6427 5d2c 2063 7265 6174 6564 5f73 7072  d'], created_spr
-0001a730: 6f63 5b27 6964 275d 290a 0a20 2020 2020  oc['id'])..     
-0001a740: 2020 2063 7265 6174 6564 5f74 7269 6767     created_trigg
-0001a750: 6572 203d 2063 7265 6174 6564 5f63 6f6e  er = created_con
-0001a760: 7461 696e 6572 2e73 6372 6970 7473 2e63  tainer.scripts.c
-0001a770: 7265 6174 655f 7472 6967 6765 7228 7b0a  reate_trigger({.
-0001a780: 2020 2020 2020 2020 2020 2020 2769 6427              'id'
-0001a790: 3a20 2773 616d 706c 6520 7472 6967 6765  : 'sample trigge
-0001a7a0: 7227 202b 2073 7472 2875 7569 642e 7575  r' + str(uuid.uu
-0001a7b0: 6964 3428 2929 2c0a 2020 2020 2020 2020  id4()),.        
-0001a7c0: 2020 2020 2773 6572 7665 7253 6372 6970      'serverScrip
-0001a7d0: 7427 3a20 2766 756e 6374 696f 6e28 2920  t': 'function() 
-0001a7e0: 7b76 6172 2078 203d 2031 303b 7d27 2c0a  {var x = 10;}',.
-0001a7f0: 2020 2020 2020 2020 2020 2020 2774 7269              'tri
-0001a800: 6767 6572 5479 7065 273a 2064 6f63 756d  ggerType': docum
-0001a810: 656e 7473 2e54 7269 6767 6572 5479 7065  ents.TriggerType
-0001a820: 2e50 7265 2c0a 2020 2020 2020 2020 2020  .Pre,.          
-0001a830: 2020 2774 7269 6767 6572 4f70 6572 6174    'triggerOperat
-0001a840: 696f 6e27 3a20 646f 6375 6d65 6e74 732e  ion': documents.
-0001a850: 5472 6967 6765 724f 7065 7261 7469 6f6e  TriggerOperation
-0001a860: 2e41 6c6c 0a20 2020 2020 2020 207d 290a  .All.        }).
-0001a870: 0a20 2020 2020 2020 2023 2072 6561 6420  .        # read 
-0001a880: 7472 6967 6765 7220 7769 7468 2069 640a  trigger with id.
-0001a890: 2020 2020 2020 2020 7265 6164 5f74 7269          read_tri
-0001a8a0: 6767 6572 203d 2063 7265 6174 6564 5f63  gger = created_c
-0001a8b0: 6f6e 7461 696e 6572 2e73 6372 6970 7473  ontainer.scripts
-0001a8c0: 2e67 6574 5f74 7269 6767 6572 2863 7265  .get_trigger(cre
-0001a8d0: 6174 6564 5f74 7269 6767 6572 5b27 6964  ated_trigger['id
-0001a8e0: 275d 290a 2020 2020 2020 2020 7365 6c66  ']).        self
-0001a8f0: 2e61 7373 6572 7445 7175 616c 2872 6561  .assertEqual(rea
-0001a900: 645f 7472 6967 6765 725b 2769 6427 5d2c  d_trigger['id'],
-0001a910: 2063 7265 6174 6564 5f74 7269 6767 6572   created_trigger
-0001a920: 5b27 6964 275d 290a 0a20 2020 2020 2020  ['id'])..       
-0001a930: 2023 2072 6561 6420 7472 6967 6765 7220   # read trigger 
-0001a940: 7769 7468 2070 726f 7065 7274 6965 730a  with properties.
-0001a950: 2020 2020 2020 2020 7265 6164 5f74 7269          read_tri
-0001a960: 6767 6572 203d 2063 7265 6174 6564 5f63  gger = created_c
-0001a970: 6f6e 7461 696e 6572 2e73 6372 6970 7473  ontainer.scripts
-0001a980: 2e67 6574 5f74 7269 6767 6572 2863 7265  .get_trigger(cre
-0001a990: 6174 6564 5f74 7269 6767 6572 290a 2020  ated_trigger).  
-0001a9a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001a9b0: 7445 7175 616c 2872 6561 645f 7472 6967  tEqual(read_trig
-0001a9c0: 6765 725b 2769 6427 5d2c 2063 7265 6174  ger['id'], creat
-0001a9d0: 6564 5f74 7269 6767 6572 5b27 6964 275d  ed_trigger['id']
-0001a9e0: 290a 0a20 2020 2020 2020 2063 7265 6174  )..        creat
-0001a9f0: 6564 5f75 6466 203d 2063 7265 6174 6564  ed_udf = created
-0001aa00: 5f63 6f6e 7461 696e 6572 2e73 6372 6970  _container.scrip
-0001aa10: 7473 2e63 7265 6174 655f 7573 6572 5f64  ts.create_user_d
-0001aa20: 6566 696e 6564 5f66 756e 6374 696f 6e28  efined_function(
-0001aa30: 7b0a 2020 2020 2020 2020 2020 2020 2769  {.            'i
-0001aa40: 6427 3a20 2773 616d 706c 6520 7564 6627  d': 'sample udf'
-0001aa50: 202b 2073 7472 2875 7569 642e 7575 6964   + str(uuid.uuid
-0001aa60: 3428 2929 2c0a 2020 2020 2020 2020 2020  4()),.          
-0001aa70: 2020 2762 6f64 7927 3a20 2766 756e 6374    'body': 'funct
-0001aa80: 696f 6e28 2920 7b76 6172 2078 203d 2031  ion() {var x = 1
-0001aa90: 303b 7d27 0a20 2020 2020 2020 207d 290a  0;}'.        }).
-0001aaa0: 0a20 2020 2020 2020 2023 2072 6561 6420  .        # read 
-0001aab0: 7564 6620 7769 7468 2069 640a 2020 2020  udf with id.    
-0001aac0: 2020 2020 7265 6164 5f75 6466 203d 2063      read_udf = c
-0001aad0: 7265 6174 6564 5f63 6f6e 7461 696e 6572  reated_container
-0001aae0: 2e73 6372 6970 7473 2e67 6574 5f75 7365  .scripts.get_use
-0001aaf0: 725f 6465 6669 6e65 645f 6675 6e63 7469  r_defined_functi
-0001ab00: 6f6e 2863 7265 6174 6564 5f75 6466 5b27  on(created_udf['
-0001ab10: 6964 275d 290a 2020 2020 2020 2020 7365  id']).        se
-0001ab20: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
-0001ab30: 7265 6174 6564 5f75 6466 5b27 6964 275d  reated_udf['id']
-0001ab40: 2c20 7265 6164 5f75 6466 5b27 6964 275d  , read_udf['id']
-0001ab50: 290a 0a20 2020 2020 2020 2023 2072 6561  )..        # rea
-0001ab60: 6420 7564 6620 7769 7468 2070 726f 7065  d udf with prope
-0001ab70: 7274 6965 730a 2020 2020 2020 2020 7265  rties.        re
-0001ab80: 6164 5f75 6466 203d 2063 7265 6174 6564  ad_udf = created
-0001ab90: 5f63 6f6e 7461 696e 6572 2e73 6372 6970  _container.scrip
-0001aba0: 7473 2e67 6574 5f75 7365 725f 6465 6669  ts.get_user_defi
-0001abb0: 6e65 645f 6675 6e63 7469 6f6e 2863 7265  ned_function(cre
-0001abc0: 6174 6564 5f75 6466 290a 2020 2020 2020  ated_udf).      
-0001abd0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001abe0: 616c 2863 7265 6174 6564 5f75 6466 5b27  al(created_udf['
-0001abf0: 6964 275d 2c20 7265 6164 5f75 6466 5b27  id'], read_udf['
-0001ac00: 6964 275d 290a 0a20 2020 2020 2020 2063  id'])..        c
-0001ac10: 7265 6174 6564 5f75 7365 7220 3d20 6372  reated_user = cr
-0001ac20: 6561 7465 645f 6462 2e63 7265 6174 655f  eated_db.create_
-0001ac30: 7573 6572 287b 0a20 2020 2020 2020 2020  user({.         
-0001ac40: 2020 2027 6964 273a 2027 7573 6572 2720     'id': 'user' 
-0001ac50: 2b20 7374 7228 7575 6964 2e75 7569 6434  + str(uuid.uuid4
-0001ac60: 2829 290a 2020 2020 2020 2020 7d29 0a0a  ()).        })..
-0001ac70: 2020 2020 2020 2020 2320 7265 6164 2075          # read u
-0001ac80: 7365 7220 7769 7468 2069 640a 2020 2020  ser with id.    
-0001ac90: 2020 2020 7265 6164 5f75 7365 7220 3d20      read_user = 
-0001aca0: 6372 6561 7465 645f 6462 2e67 6574 5f75  created_db.get_u
-0001acb0: 7365 725f 636c 6965 6e74 2863 7265 6174  ser_client(creat
-0001acc0: 6564 5f75 7365 722e 6964 290a 2020 2020  ed_user.id).    
-0001acd0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001ace0: 7175 616c 2872 6561 645f 7573 6572 2e69  qual(read_user.i
-0001acf0: 642c 2063 7265 6174 6564 5f75 7365 722e  d, created_user.
-0001ad00: 6964 290a 0a20 2020 2020 2020 2023 2072  id)..        # r
-0001ad10: 6561 6420 7573 6572 2077 6974 6820 696e  ead user with in
-0001ad20: 7374 616e 6365 0a20 2020 2020 2020 2072  stance.        r
-0001ad30: 6561 645f 7573 6572 203d 2063 7265 6174  ead_user = creat
-0001ad40: 6564 5f64 622e 6765 745f 7573 6572 5f63  ed_db.get_user_c
-0001ad50: 6c69 656e 7428 6372 6561 7465 645f 7573  lient(created_us
-0001ad60: 6572 290a 2020 2020 2020 2020 7365 6c66  er).        self
-0001ad70: 2e61 7373 6572 7445 7175 616c 2872 6561  .assertEqual(rea
-0001ad80: 645f 7573 6572 2e69 642c 2063 7265 6174  d_user.id, creat
-0001ad90: 6564 5f75 7365 722e 6964 290a 0a20 2020  ed_user.id)..   
-0001ada0: 2020 2020 2023 2072 6561 6420 7573 6572       # read user
-0001adb0: 2077 6974 6820 7072 6f70 6572 7469 6573   with properties
-0001adc0: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
-0001add0: 5f75 7365 725f 7072 6f70 6572 7469 6573  _user_properties
-0001ade0: 203d 2063 7265 6174 6564 5f75 7365 722e   = created_user.
-0001adf0: 7265 6164 2829 0a20 2020 2020 2020 2072  read().        r
-0001ae00: 6561 645f 7573 6572 203d 2063 7265 6174  ead_user = creat
-0001ae10: 6564 5f64 622e 6765 745f 7573 6572 5f63  ed_db.get_user_c
-0001ae20: 6c69 656e 7428 6372 6561 7465 645f 7573  lient(created_us
-0001ae30: 6572 5f70 726f 7065 7274 6965 7329 0a20  er_properties). 
-0001ae40: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0001ae50: 7274 4571 7561 6c28 7265 6164 5f75 7365  rtEqual(read_use
-0001ae60: 722e 6964 2c20 6372 6561 7465 645f 7573  r.id, created_us
-0001ae70: 6572 2e69 6429 0a0a 2020 2020 2020 2020  er.id)..        
-0001ae80: 6372 6561 7465 645f 7065 726d 6973 7369  created_permissi
-0001ae90: 6f6e 203d 2063 7265 6174 6564 5f75 7365  on = created_use
-0001aea0: 722e 6372 6561 7465 5f70 6572 6d69 7373  r.create_permiss
-0001aeb0: 696f 6e28 7b0a 2020 2020 2020 2020 2020  ion({.          
-0001aec0: 2020 2769 6427 3a20 2761 6c6c 2070 6572    'id': 'all per
-0001aed0: 6d69 7373 696f 6e27 202b 2073 7472 2875  mission' + str(u
-0001aee0: 7569 642e 7575 6964 3428 2929 2c0a 2020  uid.uuid4()),.  
-0001aef0: 2020 2020 2020 2020 2020 2770 6572 6d69            'permi
-0001af00: 7373 696f 6e4d 6f64 6527 3a20 646f 6375  ssionMode': docu
-0001af10: 6d65 6e74 732e 5065 726d 6973 7369 6f6e  ments.Permission
-0001af20: 4d6f 6465 2e41 6c6c 2c0a 2020 2020 2020  Mode.All,.      
-0001af30: 2020 2020 2020 2772 6573 6f75 7263 6527        'resource'
-0001af40: 3a20 6372 6561 7465 645f 636f 6e74 6169  : created_contai
-0001af50: 6e65 722e 636f 6e74 6169 6e65 725f 6c69  ner.container_li
-0001af60: 6e6b 2c0a 2020 2020 2020 2020 2020 2020  nk,.            
-0001af70: 2772 6573 6f75 7263 6550 6172 7469 7469  'resourcePartiti
-0001af80: 6f6e 4b65 7927 3a20 5b31 5d0a 2020 2020  onKey': [1].    
-0001af90: 2020 2020 7d29 0a0a 2020 2020 2020 2020      })..        
-0001afa0: 2320 7265 6164 2070 6572 6d69 7373 696f  # read permissio
-0001afb0: 6e20 7769 7468 2069 640a 2020 2020 2020  n with id.      
-0001afc0: 2020 7265 6164 5f70 6572 6d69 7373 696f    read_permissio
-0001afd0: 6e20 3d20 6372 6561 7465 645f 7573 6572  n = created_user
-0001afe0: 2e67 6574 5f70 6572 6d69 7373 696f 6e28  .get_permission(
-0001aff0: 6372 6561 7465 645f 7065 726d 6973 7369  created_permissi
-0001b000: 6f6e 2e69 6429 0a20 2020 2020 2020 2073  on.id).        s
-0001b010: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0001b020: 7265 6164 5f70 6572 6d69 7373 696f 6e2e  read_permission.
-0001b030: 6964 2c20 6372 6561 7465 645f 7065 726d  id, created_perm
-0001b040: 6973 7369 6f6e 2e69 6429 0a0a 2020 2020  ission.id)..    
-0001b050: 2020 2020 2320 7265 6164 2070 6572 6d69      # read permi
-0001b060: 7373 696f 6e20 7769 7468 2069 6e73 7461  ssion with insta
-0001b070: 6e63 650a 2020 2020 2020 2020 7265 6164  nce.        read
-0001b080: 5f70 6572 6d69 7373 696f 6e20 3d20 6372  _permission = cr
-0001b090: 6561 7465 645f 7573 6572 2e67 6574 5f70  eated_user.get_p
-0001b0a0: 6572 6d69 7373 696f 6e28 6372 6561 7465  ermission(create
-0001b0b0: 645f 7065 726d 6973 7369 6f6e 290a 2020  d_permission).  
-0001b0c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001b0d0: 7445 7175 616c 2872 6561 645f 7065 726d  tEqual(read_perm
-0001b0e0: 6973 7369 6f6e 2e69 642c 2063 7265 6174  ission.id, creat
-0001b0f0: 6564 5f70 6572 6d69 7373 696f 6e2e 6964  ed_permission.id
-0001b100: 290a 0a20 2020 2020 2020 2023 2072 6561  )..        # rea
-0001b110: 6420 7065 726d 6973 7369 6f6e 2077 6974  d permission wit
-0001b120: 6820 7072 6f70 6572 7469 6573 0a20 2020  h properties.   
-0001b130: 2020 2020 2072 6561 645f 7065 726d 6973       read_permis
-0001b140: 7369 6f6e 203d 2063 7265 6174 6564 5f75  sion = created_u
-0001b150: 7365 722e 6765 745f 7065 726d 6973 7369  ser.get_permissi
-0001b160: 6f6e 2863 7265 6174 6564 5f70 6572 6d69  on(created_permi
-0001b170: 7373 696f 6e2e 7072 6f70 6572 7469 6573  ssion.properties
-0001b180: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0001b190: 7373 6572 7445 7175 616c 2872 6561 645f  ssertEqual(read_
-0001b1a0: 7065 726d 6973 7369 6f6e 2e69 642c 2063  permission.id, c
-0001b1b0: 7265 6174 6564 5f70 6572 6d69 7373 696f  reated_permissio
-0001b1c0: 6e2e 6964 290a 0a20 2020 2023 2054 656d  n.id)..    # Tem
-0001b1d0: 706f 7261 7269 6c79 2063 6f6d 6d65 6e74  porarily comment
-0001b1e0: 696e 6720 616e 616c 7974 6963 616c 2073  ing analytical s
-0001b1f0: 746f 7261 6765 2074 6573 7473 2075 6e74  torage tests unt
-0001b200: 696c 2065 6d75 6c61 746f 7220 7375 7070  il emulator supp
-0001b210: 6f72 7420 636f 6d65 732e 0a20 2020 2023  ort comes..    #
-0001b220: 2064 6566 2074 6573 745f 6372 6561 7465   def test_create
-0001b230: 5f63 6f6e 7461 696e 6572 5f77 6974 685f  _container_with_
-0001b240: 616e 616c 7974 6963 616c 5f73 746f 7265  analytical_store
-0001b250: 5f6f 6666 2873 656c 6629 3a0a 2020 2020  _off(self):.    
-0001b260: 2320 2020 2020 2320 646f 6e27 7420 7275  #     # don't ru
-0001b270: 6e20 7465 7374 2c20 666f 7220 7468 6520  n test, for the 
-0001b280: 7469 6d65 2062 6569 6e67 2c20 6966 2072  time being, if r
-0001b290: 756e 6e69 6e67 2061 6761 696e 7374 2074  unning against t
-0001b2a0: 6865 2065 6d75 6c61 746f 720a 2020 2020  he emulator.    
-0001b2b0: 2320 2020 2020 6966 2027 6c6f 6361 6c68  #     if 'localh
-0001b2c0: 6f73 7427 2069 6e20 7365 6c66 2e68 6f73  ost' in self.hos
-0001b2d0: 7420 6f72 2027 3132 372e 302e 302e 3127  t or '127.0.0.1'
-0001b2e0: 2069 6e20 7365 6c66 2e68 6f73 743a 0a20   in self.host:. 
-0001b2f0: 2020 2023 2020 2020 2020 2020 2072 6574     #         ret
-0001b300: 7572 6e0a 0a20 2020 2023 2020 2020 2063  urn..    #     c
-0001b310: 7265 6174 6564 5f64 6220 3d20 7365 6c66  reated_db = self
-0001b320: 2e64 6174 6162 6173 6546 6f72 5465 7374  .databaseForTest
-0001b330: 0a20 2020 2023 2020 2020 2063 6f6c 6c65  .    #     colle
-0001b340: 6374 696f 6e5f 6964 203d 2027 7465 7374  ction_id = 'test
-0001b350: 5f63 7265 6174 655f 636f 6e74 6169 6e65  _create_containe
-0001b360: 725f 7769 7468 5f61 6e61 6c79 7469 6361  r_with_analytica
-0001b370: 6c5f 7374 6f72 655f 6f66 665f 2720 2b20  l_store_off_' + 
-0001b380: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
-0001b390: 290a 2020 2020 2320 2020 2020 636f 6c6c  ).    #     coll
-0001b3a0: 6563 7469 6f6e 5f69 6e64 6578 696e 675f  ection_indexing_
-0001b3b0: 706f 6c69 6379 203d 207b 2769 6e64 6578  policy = {'index
-0001b3c0: 696e 674d 6f64 6527 3a20 2763 6f6e 7369  ingMode': 'consi
-0001b3d0: 7374 656e 7427 7d0a 2020 2020 2320 2020  stent'}.    #   
-0001b3e0: 2020 6372 6561 7465 645f 7265 636f 7264    created_record
-0001b3f0: 6572 203d 2052 6563 6f72 6444 6961 676e  er = RecordDiagn
-0001b400: 6f73 7469 6373 2829 0a20 2020 2023 2020  ostics().    #  
-0001b410: 2020 2063 7265 6174 6564 5f63 6f6c 6c65     created_colle
-0001b420: 6374 696f 6e20 3d20 6372 6561 7465 645f  ction = created_
-0001b430: 6462 2e63 7265 6174 655f 636f 6e74 6169  db.create_contai
-0001b440: 6e65 7228 6964 3d63 6f6c 6c65 6374 696f  ner(id=collectio
-0001b450: 6e5f 6964 2c0a 2020 2020 2320 2020 2020  n_id,.    #     
-0001b460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b490: 2069 6e64 6578 696e 675f 706f 6c69 6379   indexing_policy
-0001b4a0: 3d63 6f6c 6c65 6374 696f 6e5f 696e 6465  =collection_inde
-0001b4b0: 7869 6e67 5f70 6f6c 6963 792c 0a20 2020  xing_policy,.   
-0001b4c0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0001b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4f0: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
-0001b500: 6e5f 6b65 793d 5061 7274 6974 696f 6e4b  n_key=PartitionK
-0001b510: 6579 2870 6174 683d 222f 706b 222c 206b  ey(path="/pk", k
-0001b520: 696e 643d 2248 6173 6822 292c 200a 2020  ind="Hash"), .  
-0001b530: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0001b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b560: 2020 2020 2020 2020 2072 6573 706f 6e73           respons
-0001b570: 655f 686f 6f6b 3d63 7265 6174 6564 5f72  e_hook=created_r
-0001b580: 6563 6f72 6465 7229 0a20 2020 2023 2020  ecorder).    #  
-0001b590: 2020 2070 726f 7065 7274 6965 7320 3d20     properties = 
-0001b5a0: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
-0001b5b0: 6f6e 2e72 6561 6428 290a 2020 2020 2320  on.read().    # 
-0001b5c0: 2020 2020 7474 6c5f 6b65 7920 3d20 2261      ttl_key = "a
-0001b5d0: 6e61 6c79 7469 6361 6c53 746f 7261 6765  nalyticalStorage
-0001b5e0: 5474 6c22 0a20 2020 2023 2020 2020 2073  Ttl".    #     s
-0001b5f0: 656c 662e 6173 7365 7274 5472 7565 2874  elf.assertTrue(t
-0001b600: 746c 5f6b 6579 206e 6f74 2069 6e20 7072  tl_key not in pr
-0001b610: 6f70 6572 7469 6573 206f 7220 7072 6f70  operties or prop
-0001b620: 6572 7469 6573 5b74 746c 5f6b 6579 5d20  erties[ttl_key] 
-0001b630: 3d3d 204e 6f6e 6529 0a0a 2020 2020 2320  == None)..    # 
-0001b640: 6465 6620 7465 7374 5f63 7265 6174 655f  def test_create_
-0001b650: 636f 6e74 6169 6e65 725f 7769 7468 5f61  container_with_a
-0001b660: 6e61 6c79 7469 6361 6c5f 7374 6f72 655f  nalytical_store_
-0001b670: 6f6e 2873 656c 6629 3a0a 2020 2020 2320  on(self):.    # 
-0001b680: 2020 2020 2320 646f 6e27 7420 7275 6e20      # don't run 
-0001b690: 7465 7374 2c20 666f 7220 7468 6520 7469  test, for the ti
-0001b6a0: 6d65 2062 6569 6e67 2c20 6966 2072 756e  me being, if run
-0001b6b0: 6e69 6e67 2061 6761 696e 7374 2074 6865  ning against the
-0001b6c0: 2065 6d75 6c61 746f 720a 2020 2020 2320   emulator.    # 
-0001b6d0: 2020 2020 6966 2027 6c6f 6361 6c68 6f73      if 'localhos
-0001b6e0: 7427 2069 6e20 7365 6c66 2e68 6f73 7420  t' in self.host 
-0001b6f0: 6f72 2027 3132 372e 302e 302e 3127 2069  or '127.0.0.1' i
-0001b700: 6e20 7365 6c66 2e68 6f73 743a 0a20 2020  n self.host:.   
-0001b710: 2023 2020 2020 2020 2020 2072 6574 7572   #         retur
-0001b720: 6e0a 0a20 2020 2023 2020 2020 2063 7265  n..    #     cre
-0001b730: 6174 6564 5f64 6220 3d20 7365 6c66 2e64  ated_db = self.d
-0001b740: 6174 6162 6173 6546 6f72 5465 7374 0a20  atabaseForTest. 
-0001b750: 2020 2023 2020 2020 2063 6f6c 6c65 6374     #     collect
-0001b760: 696f 6e5f 6964 203d 2027 7465 7374 5f63  ion_id = 'test_c
-0001b770: 7265 6174 655f 636f 6e74 6169 6e65 725f  reate_container_
-0001b780: 7769 7468 5f61 6e61 6c79 7469 6361 6c5f  with_analytical_
-0001b790: 7374 6f72 655f 6f6e 5f27 202b 2073 7472  store_on_' + str
-0001b7a0: 2875 7569 642e 7575 6964 3428 2929 0a20  (uuid.uuid4()). 
-0001b7b0: 2020 2023 2020 2020 2063 6f6c 6c65 6374     #     collect
-0001b7c0: 696f 6e5f 696e 6465 7869 6e67 5f70 6f6c  ion_indexing_pol
-0001b7d0: 6963 7920 3d20 7b27 696e 6465 7869 6e67  icy = {'indexing
-0001b7e0: 4d6f 6465 273a 2027 636f 6e73 6973 7465  Mode': 'consiste
-0001b7f0: 6e74 277d 0a20 2020 2023 2020 2020 2063  nt'}.    #     c
-0001b800: 7265 6174 6564 5f72 6563 6f72 6465 7220  reated_recorder 
-0001b810: 3d20 5265 636f 7264 4469 6167 6e6f 7374  = RecordDiagnost
-0001b820: 6963 7328 290a 2020 2020 2320 2020 2020  ics().    #     
-0001b830: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
-0001b840: 6f6e 203d 2063 7265 6174 6564 5f64 622e  on = created_db.
-0001b850: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
-0001b860: 2869 643d 636f 6c6c 6563 7469 6f6e 5f69  (id=collection_i
-0001b870: 642c 0a20 2020 2023 2020 2020 2020 2020  d,.    #        
-0001b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8a0: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0001b8b0: 616c 7974 6963 616c 5f73 746f 7261 6765  alytical_storage
-0001b8c0: 5f74 746c 3d2d 312c 0a20 2020 2023 2020  _ttl=-1,.    #  
-0001b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b900: 2020 2020 696e 6465 7869 6e67 5f70 6f6c      indexing_pol
-0001b910: 6963 793d 636f 6c6c 6563 7469 6f6e 5f69  icy=collection_i
-0001b920: 6e64 6578 696e 675f 706f 6c69 6379 2c0a  ndexing_policy,.
-0001b930: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0001b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b960: 2020 2020 2020 2020 2020 2070 6172 7469             parti
-0001b970: 7469 6f6e 5f6b 6579 3d50 6172 7469 7469  tion_key=Partiti
-0001b980: 6f6e 4b65 7928 7061 7468 3d22 2f70 6b22  onKey(path="/pk"
-0001b990: 2c20 6b69 6e64 3d22 4861 7368 2229 2c20  , kind="Hash"), 
-0001b9a0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0001b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9d0: 2020 2020 2020 2020 2020 2020 7265 7370              resp
-0001b9e0: 6f6e 7365 5f68 6f6f 6b3d 6372 6561 7465  onse_hook=create
-0001b9f0: 645f 7265 636f 7264 6572 290a 2020 2020  d_recorder).    
-0001ba00: 2320 2020 2020 7072 6f70 6572 7469 6573  #     properties
-0001ba10: 203d 2063 7265 6174 6564 5f63 6f6c 6c65   = created_colle
-0001ba20: 6374 696f 6e2e 7265 6164 2829 0a20 2020  ction.read().   
-0001ba30: 2023 2020 2020 2074 746c 5f6b 6579 203d   #     ttl_key =
-0001ba40: 2022 616e 616c 7974 6963 616c 5374 6f72   "analyticalStor
-0001ba50: 6167 6554 746c 220a 2020 2020 2320 2020  ageTtl".    #   
-0001ba60: 2020 7365 6c66 2e61 7373 6572 7454 7275    self.assertTru
-0001ba70: 6528 7474 6c5f 6b65 7920 696e 2070 726f  e(ttl_key in pro
-0001ba80: 7065 7274 6965 7320 616e 6420 7072 6f70  perties and prop
-0001ba90: 6572 7469 6573 5b74 746c 5f6b 6579 5d20  erties[ttl_key] 
-0001baa0: 3d3d 202d 3129 0a0a 2020 2020 2320 6465  == -1)..    # de
-0001bab0: 6620 7465 7374 5f63 7265 6174 655f 636f  f test_create_co
-0001bac0: 6e74 6169 6e65 725f 6966 5f6e 6f74 5f65  ntainer_if_not_e
-0001bad0: 7869 7374 735f 7769 7468 5f61 6e61 6c79  xists_with_analy
-0001bae0: 7469 6361 6c5f 7374 6f72 655f 6f6e 2873  tical_store_on(s
-0001baf0: 656c 6629 3a0a 2020 2020 2320 2020 2020  elf):.    #     
-0001bb00: 2320 646f 6e27 7420 7275 6e20 7465 7374  # don't run test
-0001bb10: 2c20 666f 7220 7468 6520 7469 6d65 2062  , for the time b
-0001bb20: 6569 6e67 2c20 6966 2072 756e 6e69 6e67  eing, if running
-0001bb30: 2061 6761 696e 7374 2074 6865 2065 6d75   against the emu
-0001bb40: 6c61 746f 720a 2020 2020 2320 2020 2020  lator.    #     
-0001bb50: 6966 2027 6c6f 6361 6c68 6f73 7427 2069  if 'localhost' i
-0001bb60: 6e20 7365 6c66 2e68 6f73 7420 6f72 2027  n self.host or '
-0001bb70: 3132 372e 302e 302e 3127 2069 6e20 7365  127.0.0.1' in se
-0001bb80: 6c66 2e68 6f73 743a 0a20 2020 2023 2020  lf.host:.    #  
-0001bb90: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
-0001bba0: 2020 2023 2020 2020 2023 2066 6972 7374     #     # first
-0001bbb0: 2c20 7472 7920 7768 656e 2077 6520 6b6e  , try when we kn
-0001bbc0: 6f77 2074 6865 2063 6f6e 7461 696e 6572  ow the container
-0001bbd0: 2064 6f65 736e 2774 2065 7869 7374 2e0a   doesn't exist..
-0001bbe0: 2020 2020 2320 2020 2020 6372 6561 7465      #     create
-0001bbf0: 645f 6462 203d 2073 656c 662e 6461 7461  d_db = self.data
-0001bc00: 6261 7365 466f 7254 6573 740a 2020 2020  baseForTest.    
-0001bc10: 2320 2020 2020 636f 6c6c 6563 7469 6f6e  #     collection
-0001bc20: 5f69 6420 3d20 2774 6573 745f 6372 6561  _id = 'test_crea
-0001bc30: 7465 5f63 6f6e 7461 696e 6572 5f69 665f  te_container_if_
-0001bc40: 6e6f 745f 6578 6973 7473 5f77 6974 685f  not_exists_with_
-0001bc50: 616e 616c 7974 6963 616c 5f73 746f 7265  analytical_store
-0001bc60: 5f6f 6e5f 2720 2b20 7374 7228 7575 6964  _on_' + str(uuid
-0001bc70: 2e75 7569 6434 2829 290a 2020 2020 2320  .uuid4()).    # 
-0001bc80: 2020 2020 636f 6c6c 6563 7469 6f6e 5f69      collection_i
-0001bc90: 6e64 6578 696e 675f 706f 6c69 6379 203d  ndexing_policy =
-0001bca0: 207b 2769 6e64 6578 696e 674d 6f64 6527   {'indexingMode'
-0001bcb0: 3a20 2763 6f6e 7369 7374 656e 7427 7d0a  : 'consistent'}.
-0001bcc0: 2020 2020 2320 2020 2020 6372 6561 7465      #     create
-0001bcd0: 645f 7265 636f 7264 6572 203d 2052 6563  d_recorder = Rec
-0001bce0: 6f72 6444 6961 676e 6f73 7469 6373 2829  ordDiagnostics()
-0001bcf0: 0a20 2020 2023 2020 2020 2063 7265 6174  .    #     creat
-0001bd00: 6564 5f63 6f6c 6c65 6374 696f 6e20 3d20  ed_collection = 
-0001bd10: 6372 6561 7465 645f 6462 2e63 7265 6174  created_db.creat
-0001bd20: 655f 636f 6e74 6169 6e65 725f 6966 5f6e  e_container_if_n
-0001bd30: 6f74 5f65 7869 7374 7328 6964 3d63 6f6c  ot_exists(id=col
-0001bd40: 6c65 6374 696f 6e5f 6964 2c0a 2020 2020  lection_id,.    
-0001bd50: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd90: 2020 2020 2061 6e61 6c79 7469 6361 6c5f       analytical_
-0001bda0: 7374 6f72 6167 655f 7474 6c3d 2d31 2c0a  storage_ttl=-1,.
-0001bdb0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0001bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bdf0: 2020 2020 2020 2020 2069 6e64 6578 696e           indexin
-0001be00: 675f 706f 6c69 6379 3d63 6f6c 6c65 6374  g_policy=collect
-0001be10: 696f 6e5f 696e 6465 7869 6e67 5f70 6f6c  ion_indexing_pol
-0001be20: 6963 792c 0a20 2020 2023 2020 2020 2020  icy,.    #      
-0001be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be60: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0001be70: 7274 6974 696f 6e5f 6b65 793d 5061 7274  rtition_key=Part
-0001be80: 6974 696f 6e4b 6579 2870 6174 683d 222f  itionKey(path="/
-0001be90: 706b 222c 206b 696e 643d 2248 6173 6822  pk", kind="Hash"
-0001bea0: 292c 0a20 2020 2023 2020 2020 2020 2020  ),.    #        
-0001beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bee0: 2020 2020 2020 2020 2020 2020 7265 7370              resp
-0001bef0: 6f6e 7365 5f68 6f6f 6b3d 6372 6561 7465  onse_hook=create
-0001bf00: 645f 7265 636f 7264 6572 290a 2020 2020  d_recorder).    
-0001bf10: 2320 2020 2020 7072 6f70 6572 7469 6573  #     properties
-0001bf20: 203d 2063 7265 6174 6564 5f63 6f6c 6c65   = created_colle
-0001bf30: 6374 696f 6e2e 7265 6164 2829 0a20 2020  ction.read().   
-0001bf40: 2023 2020 2020 2074 746c 5f6b 6579 203d   #     ttl_key =
-0001bf50: 2022 616e 616c 7974 6963 616c 5374 6f72   "analyticalStor
-0001bf60: 6167 6554 746c 220a 2020 2020 2320 2020  ageTtl".    #   
-0001bf70: 2020 7365 6c66 2e61 7373 6572 7454 7275    self.assertTru
-0001bf80: 6528 7474 6c5f 6b65 7920 696e 2070 726f  e(ttl_key in pro
-0001bf90: 7065 7274 6965 7320 616e 6420 7072 6f70  perties and prop
-0001bfa0: 6572 7469 6573 5b74 746c 5f6b 6579 5d20  erties[ttl_key] 
-0001bfb0: 3d3d 202d 3129 0a0a 2020 2020 2320 2020  == -1)..    #   
-0001bfc0: 2020 2320 6e65 7874 2c20 7472 7920 7768    # next, try wh
-0001bfd0: 656e 2077 6520 6b6e 6f77 2074 6865 2063  en we know the c
-0001bfe0: 6f6e 7461 696e 6572 2044 4f45 5320 6578  ontainer DOES ex
-0001bff0: 6973 742e 2054 6869 7320 7761 7920 626f  ist. This way bo
-0001c000: 7468 2063 6f64 6520 7061 7468 7320 6172  th code paths ar
-0001c010: 6520 7465 7374 6564 2e0a 2020 2020 2320  e tested..    # 
-0001c020: 2020 2020 6372 6561 7465 645f 636f 6c6c      created_coll
-0001c030: 6563 7469 6f6e 203d 2063 7265 6174 6564  ection = created
-0001c040: 5f64 622e 6372 6561 7465 5f63 6f6e 7461  _db.create_conta
-0001c050: 696e 6572 5f69 665f 6e6f 745f 6578 6973  iner_if_not_exis
-0001c060: 7473 2869 643d 636f 6c6c 6563 7469 6f6e  ts(id=collection
-0001c070: 5f69 642c 0a20 2020 2023 2020 2020 2020  _id,.    #      
-0001c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0b0: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0001c0c0: 616c 7974 6963 616c 5f73 746f 7261 6765  alytical_storage
-0001c0d0: 5f74 746c 3d2d 312c 0a20 2020 2023 2020  _ttl=-1,.    #  
-0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c120: 2020 696e 6465 7869 6e67 5f70 6f6c 6963    indexing_polic
-0001c130: 793d 636f 6c6c 6563 7469 6f6e 5f69 6e64  y=collection_ind
-0001c140: 6578 696e 675f 706f 6c69 6379 2c0a 2020  exing_policy,.  
-0001c150: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0001c160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c190: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
-0001c1a0: 5f6b 6579 3d50 6172 7469 7469 6f6e 4b65  _key=PartitionKe
-0001c1b0: 7928 7061 7468 3d22 2f70 6b22 2c20 6b69  y(path="/pk", ki
-0001c1c0: 6e64 3d22 4861 7368 2229 2c0a 2020 2020  nd="Hash"),.    
-0001c1d0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c210: 2020 2020 2072 6573 706f 6e73 655f 686f       response_ho
-0001c220: 6f6b 3d63 7265 6174 6564 5f72 6563 6f72  ok=created_recor
-0001c230: 6465 7229 0a20 2020 2023 2020 2020 2070  der).    #     p
-0001c240: 726f 7065 7274 6965 7320 3d20 6372 6561  roperties = crea
-0001c250: 7465 645f 636f 6c6c 6563 7469 6f6e 2e72  ted_collection.r
-0001c260: 6561 6428 290a 2020 2020 2320 2020 2020  ead().    #     
-0001c270: 7474 6c5f 6b65 7920 3d20 2261 6e61 6c79  ttl_key = "analy
-0001c280: 7469 6361 6c53 746f 7261 6765 5474 6c22  ticalStorageTtl"
-0001c290: 0a20 2020 2023 2020 2020 2073 656c 662e  .    #     self.
-0001c2a0: 6173 7365 7274 5472 7565 2874 746c 5f6b  assertTrue(ttl_k
-0001c2b0: 6579 2069 6e20 7072 6f70 6572 7469 6573  ey in properties
-0001c2c0: 2061 6e64 2070 726f 7065 7274 6965 735b   and properties[
-0001c2d0: 7474 6c5f 6b65 795d 203d 3d20 2d31 290a  ttl_key] == -1).
-0001c2e0: 0a20 2020 2064 6566 205f 4d6f 636b 4578  .    def _MockEx
-0001c2f0: 6563 7574 6546 756e 6374 696f 6e28 7365  ecuteFunction(se
-0001c300: 6c66 2c20 6675 6e63 7469 6f6e 2c20 2a61  lf, function, *a
-0001c310: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
-0001c320: 2020 2020 2020 2020 7365 6c66 2e6c 6173          self.las
-0001c330: 745f 6865 6164 6572 732e 6170 7065 6e64  t_headers.append
-0001c340: 2861 7267 735b 345d 2e68 6561 6465 7273  (args[4].headers
-0001c350: 5b48 7474 7048 6561 6465 7273 2e50 6172  [HttpHeaders.Par
-0001c360: 7469 7469 6f6e 4b65 795d 0a20 2020 2020  titionKey].     
-0001c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c380: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001c390: 6620 4874 7470 4865 6164 6572 732e 5061  f HttpHeaders.Pa
-0001c3a0: 7274 6974 696f 6e4b 6579 2069 6e20 6172  rtitionKey in ar
-0001c3b0: 6773 5b34 5d2e 6865 6164 6572 7320 656c  gs[4].headers el
-0001c3c0: 7365 2027 2729 0a20 2020 2020 2020 2072  se '').        r
-0001c3d0: 6574 7572 6e20 7365 6c66 2e4f 7269 6769  eturn self.Origi
-0001c3e0: 6e61 6c45 7865 6375 7465 4675 6e63 7469  nalExecuteFuncti
-0001c3f0: 6f6e 2866 756e 6374 696f 6e2c 202a 6172  on(function, *ar
-0001c400: 6773 2c20 2a2a 6b77 6172 6773 290a 0a69  gs, **kwargs)..i
-0001c410: 6620 5f5f 6e61 6d65 5f5f 203d 3d20 275f  f __name__ == '_
-0001c420: 5f6d 6169 6e5f 5f27 3a0a 2020 2020 7472  _main__':.    tr
-0001c430: 793a 0a20 2020 2020 2020 2075 6e69 7474  y:.        unitt
-0001c440: 6573 742e 6d61 696e 2829 0a20 2020 2065  est.main().    e
-0001c450: 7863 6570 7420 5379 7374 656d 4578 6974  xcept SystemExit
-0001c460: 2061 7320 696e 7374 3a0a 2020 2020 2020   as inst:.      
-0001c470: 2020 6966 2069 6e73 742e 6172 6773 5b30    if inst.args[0
-0001c480: 5d20 6973 2054 7275 653a 2020 2320 7261  ] is True:  # ra
-0001c490: 6973 6564 2062 7920 7379 732e 6578 6974  ised by sys.exit
-0001c4a0: 2854 7275 6529 2077 6865 6e20 7465 7374  (True) when test
-0001c4b0: 7320 6661 696c 6564 0a20 2020 2020 2020  s failed.       
-0001c4c0: 2020 2020 2072 6169 7365 0a                   raise.
+00014090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140a0: 2020 2020 290a 2020 2020 2020 2020 7769      ).        wi
+000140b0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+000140c0: 6973 6573 2841 7a75 7265 4572 726f 7229  ises(AzureError)
+000140d0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000140e0: 636c 6965 6e74 2064 6f65 7320 6120 6765  client does a ge
+000140f0: 7444 6174 6162 6173 6541 6363 6f75 6e74  tDatabaseAccount
+00014100: 206f 6e20 696e 6974 6961 6c69 7a61 7469   on initializati
+00014110: 6f6e 2c20 7768 6963 6820 7769 6c6c 2074  on, which will t
+00014120: 696d 6520 6f75 740a 2020 2020 2020 2020  ime out.        
+00014130: 2020 2020 636f 736d 6f73 5f63 6c69 656e      cosmos_clien
+00014140: 742e 436f 736d 6f73 436c 6965 6e74 2843  t.CosmosClient(C
+00014150: 5255 4454 6573 7473 2e68 6f73 742c 2043  RUDTests.host, C
+00014160: 5255 4454 6573 7473 2e6d 6173 7465 724b  RUDTests.masterK
+00014170: 6579 2c20 2253 6573 7369 6f6e 222c 2063  ey, "Session", c
+00014180: 6f6e 6e65 6374 696f 6e5f 706f 6c69 6379  onnection_policy
+00014190: 3d63 6f6e 6e65 6374 696f 6e5f 706f 6c69  =connection_poli
+000141a0: 6379 290a 0a20 2020 2064 6566 2074 6573  cy)..    def tes
+000141b0: 745f 636c 6965 6e74 5f63 6f6e 6e65 6374  t_client_connect
+000141c0: 696f 6e5f 7265 7472 795f 636f 6e66 6967  ion_retry_config
+000141d0: 7572 6174 696f 6e28 7365 6c66 293a 0a20  uration(self):. 
+000141e0: 2020 2020 2020 2074 6f74 616c 5f74 696d         total_tim
+000141f0: 655f 666f 725f 7477 6f5f 7265 7472 6965  e_for_two_retrie
+00014200: 7320 3d20 7365 6c66 2e69 6e69 7469 616c  s = self.initial
+00014210: 697a 655f 636c 6965 6e74 5f77 6974 685f  ize_client_with_
+00014220: 636f 6e6e 6563 7469 6f6e 5f63 6f72 655f  connection_core_
+00014230: 7265 7472 795f 636f 6e66 6967 2832 290a  retry_config(2).
+00014240: 2020 2020 2020 2020 746f 7461 6c5f 7469          total_ti
+00014250: 6d65 5f66 6f72 5f74 6872 6565 5f72 6574  me_for_three_ret
+00014260: 7269 6573 203d 2073 656c 662e 696e 6974  ries = self.init
+00014270: 6961 6c69 7a65 5f63 6c69 656e 745f 7769  ialize_client_wi
+00014280: 7468 5f63 6f6e 6e65 6374 696f 6e5f 636f  th_connection_co
+00014290: 7265 5f72 6574 7279 5f63 6f6e 6669 6728  re_retry_config(
+000142a0: 3329 0a20 2020 2020 2020 2073 656c 662e  3).        self.
+000142b0: 6173 7365 7274 4772 6561 7465 7228 746f  assertGreater(to
+000142c0: 7461 6c5f 7469 6d65 5f66 6f72 5f74 6872  tal_time_for_thr
+000142d0: 6565 5f72 6574 7269 6573 2c20 746f 7461  ee_retries, tota
+000142e0: 6c5f 7469 6d65 5f66 6f72 5f74 776f 5f72  l_time_for_two_r
+000142f0: 6574 7269 6573 290a 0a0a 2020 2020 6465  etries)...    de
+00014300: 6620 696e 6974 6961 6c69 7a65 5f63 6c69  f initialize_cli
+00014310: 656e 745f 7769 7468 5f63 6f6e 6e65 6374  ent_with_connect
+00014320: 696f 6e5f 636f 7265 5f72 6574 7279 5f63  ion_core_retry_c
+00014330: 6f6e 6669 6728 7365 6c66 2c20 7265 7472  onfig(self, retr
+00014340: 6965 7329 3a0a 2020 2020 2020 2020 7374  ies):.        st
+00014350: 6172 745f 7469 6d65 203d 2074 696d 652e  art_time = time.
+00014360: 7469 6d65 2829 0a20 2020 2020 2020 2074  time().        t
+00014370: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00014380: 636f 736d 6f73 5f63 6c69 656e 742e 436f  cosmos_client.Co
+00014390: 736d 6f73 436c 6965 6e74 280a 2020 2020  smosClient(.    
+000143a0: 2020 2020 2020 2020 2020 2020 2268 7474              "htt
+000143b0: 7073 3a2f 2f6c 6f63 616c 686f 7374 3a39  ps://localhost:9
+000143c0: 3939 3922 2c0a 2020 2020 2020 2020 2020  999",.          
+000143d0: 2020 2020 2020 4352 5544 5465 7374 732e        CRUDTests.
+000143e0: 6d61 7374 6572 4b65 792c 0a20 2020 2020  masterKey,.     
+000143f0: 2020 2020 2020 2020 2020 2022 5365 7373             "Sess
+00014400: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
+00014410: 2020 2020 2020 7265 7472 795f 746f 7461        retry_tota
+00014420: 6c3d 7265 7472 6965 732c 0a20 2020 2020  l=retries,.     
+00014430: 2020 2020 2020 2020 2020 2072 6574 7279             retry
+00014440: 5f72 6561 643d 7265 7472 6965 732c 0a20  _read=retries,. 
+00014450: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00014460: 6574 7279 5f63 6f6e 6e65 6374 3d72 6574  etry_connect=ret
+00014470: 7269 6573 2c0a 2020 2020 2020 2020 2020  ries,.          
+00014480: 2020 2020 2020 7265 7472 795f 7374 6174        retry_stat
+00014490: 7573 3d72 6574 7269 6573 290a 2020 2020  us=retries).    
+000144a0: 2020 2020 2020 2020 7365 6c66 2e66 6169          self.fai
+000144b0: 6c28 290a 2020 2020 2020 2020 6578 6365  l().        exce
+000144c0: 7074 2041 7a75 7265 4572 726f 7220 6173  pt AzureError as
+000144d0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+000144e0: 656e 645f 7469 6d65 203d 2074 696d 652e  end_time = time.
+000144f0: 7469 6d65 2829 0a20 2020 2020 2020 2020  time().         
+00014500: 2020 2072 6574 7572 6e20 656e 645f 7469     return end_ti
+00014510: 6d65 202d 2073 7461 7274 5f74 696d 650a  me - start_time.
+00014520: 0a20 2020 2064 6566 2074 6573 745f 6162  .    def test_ab
+00014530: 736f 6c75 7465 5f63 6c69 656e 745f 7469  solute_client_ti
+00014540: 6d65 6f75 7428 7365 6c66 293a 0a20 2020  meout(self):.   
+00014550: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
+00014560: 7373 6572 7452 6169 7365 7328 6578 6365  ssertRaises(exce
+00014570: 7074 696f 6e73 2e43 6f73 6d6f 7343 6c69  ptions.CosmosCli
+00014580: 656e 7454 696d 656f 7574 4572 726f 7229  entTimeoutError)
+00014590: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+000145a0: 736d 6f73 5f63 6c69 656e 742e 436f 736d  smos_client.Cosm
+000145b0: 6f73 436c 6965 6e74 280a 2020 2020 2020  osClient(.      
+000145c0: 2020 2020 2020 2020 2020 2268 7474 7073            "https
+000145d0: 3a2f 2f6c 6f63 616c 686f 7374 3a39 3939  ://localhost:999
+000145e0: 3922 2c0a 2020 2020 2020 2020 2020 2020  9",.            
+000145f0: 2020 2020 4352 5544 5465 7374 732e 6d61      CRUDTests.ma
+00014600: 7374 6572 4b65 792c 0a20 2020 2020 2020  sterKey,.       
+00014610: 2020 2020 2020 2020 2022 5365 7373 696f           "Sessio
+00014620: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
+00014630: 2020 2020 7265 7472 795f 746f 7461 6c3d      retry_total=
+00014640: 332c 0a20 2020 2020 2020 2020 2020 2020  3,.             
+00014650: 2020 2074 696d 656f 7574 3d31 290a 0a20     timeout=1).. 
+00014660: 2020 2020 2020 2065 7272 6f72 5f72 6573         error_res
+00014670: 706f 6e73 6520 3d20 5365 7276 6963 6552  ponse = ServiceR
+00014680: 6573 706f 6e73 6545 7272 6f72 2822 5265  esponseError("Re
+00014690: 6164 2074 696d 656f 7574 2229 0a20 2020  ad timeout").   
+000146a0: 2020 2020 2074 696d 656f 7574 5f74 7261       timeout_tra
+000146b0: 6e73 706f 7274 203d 2054 696d 656f 7574  nsport = Timeout
+000146c0: 5472 616e 7370 6f72 7428 6572 726f 725f  Transport(error_
+000146d0: 7265 7370 6f6e 7365 290a 2020 2020 2020  response).      
+000146e0: 2020 636c 6965 6e74 203d 2063 6f73 6d6f    client = cosmo
+000146f0: 735f 636c 6965 6e74 2e43 6f73 6d6f 7343  s_client.CosmosC
+00014700: 6c69 656e 7428 0a20 2020 2020 2020 2020  lient(.         
+00014710: 2020 2073 656c 662e 686f 7374 2c20 7365     self.host, se
+00014720: 6c66 2e6d 6173 7465 724b 6579 2c20 2253  lf.masterKey, "S
+00014730: 6573 7369 6f6e 222c 2074 7261 6e73 706f  ession", transpo
+00014740: 7274 3d74 696d 656f 7574 5f74 7261 6e73  rt=timeout_trans
+00014750: 706f 7274 2c20 7061 7373 7468 726f 7567  port, passthroug
+00014760: 683d 5472 7565 290a 0a20 2020 2020 2020  h=True)..       
+00014770: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+00014780: 7452 6169 7365 7328 6578 6365 7074 696f  tRaises(exceptio
+00014790: 6e73 2e43 6f73 6d6f 7343 6c69 656e 7454  ns.CosmosClientT
+000147a0: 696d 656f 7574 4572 726f 7229 3a0a 2020  imeoutError):.  
+000147b0: 2020 2020 2020 2020 2020 636c 6965 6e74            client
+000147c0: 2e63 7265 6174 655f 6461 7461 6261 7365  .create_database
+000147d0: 5f69 665f 6e6f 745f 6578 6973 7473 2822  _if_not_exists("
+000147e0: 7465 7374 222c 2074 696d 656f 7574 3d32  test", timeout=2
+000147f0: 290a 0a20 2020 2020 2020 2073 7461 7475  )..        statu
+00014800: 735f 7265 7370 6f6e 7365 203d 2035 3030  s_response = 500
+00014810: 2020 2320 5573 6572 7320 636f 6e6e 6563    # Users connec
+00014820: 7469 6f6e 206c 6576 656c 2072 6574 7279  tion level retry
+00014830: 0a20 2020 2020 2020 2074 696d 656f 7574  .        timeout
+00014840: 5f74 7261 6e73 706f 7274 203d 2054 696d  _transport = Tim
+00014850: 656f 7574 5472 616e 7370 6f72 7428 7374  eoutTransport(st
+00014860: 6174 7573 5f72 6573 706f 6e73 6529 0a20  atus_response). 
+00014870: 2020 2020 2020 2063 6c69 656e 7420 3d20         client = 
+00014880: 636f 736d 6f73 5f63 6c69 656e 742e 436f  cosmos_client.Co
+00014890: 736d 6f73 436c 6965 6e74 280a 2020 2020  smosClient(.    
+000148a0: 2020 2020 2020 2020 7365 6c66 2e68 6f73          self.hos
+000148b0: 742c 2073 656c 662e 6d61 7374 6572 4b65  t, self.masterKe
+000148c0: 792c 2022 5365 7373 696f 6e22 2c20 7472  y, "Session", tr
+000148d0: 616e 7370 6f72 743d 7469 6d65 6f75 745f  ansport=timeout_
+000148e0: 7472 616e 7370 6f72 742c 2070 6173 7374  transport, passt
+000148f0: 6872 6f75 6768 3d54 7275 6529 0a20 2020  hrough=True).   
+00014900: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
+00014910: 7373 6572 7452 6169 7365 7328 6578 6365  ssertRaises(exce
+00014920: 7074 696f 6e73 2e43 6f73 6d6f 7343 6c69  ptions.CosmosCli
+00014930: 656e 7454 696d 656f 7574 4572 726f 7229  entTimeoutError)
+00014940: 3a0a 2020 2020 2020 2020 2020 2020 636c  :.            cl
+00014950: 6965 6e74 2e63 7265 6174 655f 6461 7461  ient.create_data
+00014960: 6261 7365 2822 7465 7374 222c 2074 696d  base("test", tim
+00014970: 656f 7574 3d32 290a 0a20 2020 2020 2020  eout=2)..       
+00014980: 2064 6174 6162 6173 6573 203d 2063 6c69   databases = cli
+00014990: 656e 742e 6c69 7374 5f64 6174 6162 6173  ent.list_databas
+000149a0: 6573 2874 696d 656f 7574 3d32 290a 2020  es(timeout=2).  
+000149b0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+000149c0: 6173 7365 7274 5261 6973 6573 2865 7863  assertRaises(exc
+000149d0: 6570 7469 6f6e 732e 436f 736d 6f73 436c  eptions.CosmosCl
+000149e0: 6965 6e74 5469 6d65 6f75 7445 7272 6f72  ientTimeoutError
+000149f0: 293a 0a20 2020 2020 2020 2020 2020 206c  ):.            l
+00014a00: 6973 7428 6461 7461 6261 7365 7329 0a0a  ist(databases)..
+00014a10: 2020 2020 2020 2020 7374 6174 7573 5f72          status_r
+00014a20: 6573 706f 6e73 6520 3d20 3432 3920 2023  esponse = 429  #
+00014a30: 2055 7365 7320 436f 736d 6f73 2063 7573   Uses Cosmos cus
+00014a40: 746f 6d20 7265 7472 790a 2020 2020 2020  tom retry.      
+00014a50: 2020 7469 6d65 6f75 745f 7472 616e 7370    timeout_transp
+00014a60: 6f72 7420 3d20 5469 6d65 6f75 7454 7261  ort = TimeoutTra
+00014a70: 6e73 706f 7274 2873 7461 7475 735f 7265  nsport(status_re
+00014a80: 7370 6f6e 7365 290a 2020 2020 2020 2020  sponse).        
+00014a90: 636c 6965 6e74 203d 2063 6f73 6d6f 735f  client = cosmos_
+00014aa0: 636c 6965 6e74 2e43 6f73 6d6f 7343 6c69  client.CosmosCli
+00014ab0: 656e 7428 0a20 2020 2020 2020 2020 2020  ent(.           
+00014ac0: 2073 656c 662e 686f 7374 2c20 7365 6c66   self.host, self
+00014ad0: 2e6d 6173 7465 724b 6579 2c20 2253 6573  .masterKey, "Ses
+00014ae0: 7369 6f6e 222c 2074 7261 6e73 706f 7274  sion", transport
+00014af0: 3d74 696d 656f 7574 5f74 7261 6e73 706f  =timeout_transpo
+00014b00: 7274 2c20 7061 7373 7468 726f 7567 683d  rt, passthrough=
+00014b10: 5472 7565 290a 2020 2020 2020 2020 7769  True).        wi
+00014b20: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+00014b30: 6973 6573 2865 7863 6570 7469 6f6e 732e  ises(exceptions.
+00014b40: 436f 736d 6f73 436c 6965 6e74 5469 6d65  CosmosClientTime
+00014b50: 6f75 7445 7272 6f72 293a 0a20 2020 2020  outError):.     
+00014b60: 2020 2020 2020 2063 6c69 656e 742e 6372         client.cr
+00014b70: 6561 7465 5f64 6174 6162 6173 655f 6966  eate_database_if
+00014b80: 5f6e 6f74 5f65 7869 7374 7328 2274 6573  _not_exists("tes
+00014b90: 7422 2c20 7469 6d65 6f75 743d 3229 0a0a  t", timeout=2)..
+00014ba0: 2020 2020 2020 2020 6461 7461 6261 7365          database
+00014bb0: 7320 3d20 636c 6965 6e74 2e6c 6973 745f  s = client.list_
+00014bc0: 6461 7461 6261 7365 7328 7469 6d65 6f75  databases(timeou
+00014bd0: 743d 3229 0a20 2020 2020 2020 2077 6974  t=2).        wit
+00014be0: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
+00014bf0: 7365 7328 6578 6365 7074 696f 6e73 2e43  ses(exceptions.C
+00014c00: 6f73 6d6f 7343 6c69 656e 7454 696d 656f  osmosClientTimeo
+00014c10: 7574 4572 726f 7229 3a0a 2020 2020 2020  utError):.      
+00014c20: 2020 2020 2020 6c69 7374 2864 6174 6162        list(datab
+00014c30: 6173 6573 290a 0a20 2020 2064 6566 2074  ases)..    def t
+00014c40: 6573 745f 7175 6572 795f 6974 6572 6162  est_query_iterab
+00014c50: 6c65 5f66 756e 6374 696f 6e61 6c69 7479  le_functionality
+00014c60: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00014c70: 6465 6620 5f5f 6372 6561 7465 5f72 6573  def __create_res
+00014c80: 6f75 7263 6573 2863 6c69 656e 7429 3a0a  ources(client):.
+00014c90: 2020 2020 2020 2020 2020 2020 2222 2243              """C
+00014ca0: 7265 6174 6573 2072 6573 6f75 7263 6573  reates resources
+00014cb0: 2066 6f72 2074 6869 7320 7465 7374 2e0a   for this test..
+00014cc0: 0a20 2020 2020 2020 2020 2020 203a 5061  .            :Pa
+00014cd0: 7261 6d65 7465 7273 3a0a 2020 2020 2020  rameters:.      
+00014ce0: 2020 2020 2020 2020 2020 2d20 6063 6c69            - `cli
+00014cf0: 656e 7460 3a20 636f 736d 6f73 5f63 6c69  ent`: cosmos_cli
+00014d00: 656e 745f 636f 6e6e 6563 7469 6f6e 2e43  ent_connection.C
+00014d10: 6f73 6d6f 7343 6c69 656e 7443 6f6e 6e65  osmosClientConne
+00014d20: 6374 696f 6e0a 0a20 2020 2020 2020 2020  ction..         
+00014d30: 2020 203a 5265 7475 726e 733a 0a20 2020     :Returns:.   
+00014d40: 2020 2020 2020 2020 2020 2020 2064 6963               dic
+00014d50: 740a 0a20 2020 2020 2020 2020 2020 2022  t..            "
+00014d60: 2222 0a20 2020 2020 2020 2020 2020 2063  "".            c
+00014d70: 6f6c 6c65 6374 696f 6e20 3d20 7365 6c66  ollection = self
+00014d80: 2e63 6f6e 6669 6773 2e63 7265 6174 655f  .configs.create_
+00014d90: 6d75 6c74 695f 7061 7274 6974 696f 6e5f  multi_partition_
+00014da0: 636f 6c6c 6563 7469 6f6e 5f77 6974 685f  collection_with_
+00014db0: 6375 7374 6f6d 5f70 6b5f 6966 5f6e 6f74  custom_pk_if_not
+00014dc0: 5f65 7869 7374 2873 656c 662e 636c 6965  _exist(self.clie
+00014dd0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
+00014de0: 646f 6331 203d 2063 6f6c 6c65 6374 696f  doc1 = collectio
+00014df0: 6e2e 6372 6561 7465 5f69 7465 6d28 626f  n.create_item(bo
+00014e00: 6479 3d7b 2769 6427 3a20 2764 6f63 3127  dy={'id': 'doc1'
+00014e10: 2c20 2770 726f 7031 273a 2027 7661 6c75  , 'prop1': 'valu
+00014e20: 6531 277d 290a 2020 2020 2020 2020 2020  e1'}).          
+00014e30: 2020 646f 6332 203d 2063 6f6c 6c65 6374    doc2 = collect
+00014e40: 696f 6e2e 6372 6561 7465 5f69 7465 6d28  ion.create_item(
+00014e50: 626f 6479 3d7b 2769 6427 3a20 2764 6f63  body={'id': 'doc
+00014e60: 3227 2c20 2770 726f 7031 273a 2027 7661  2', 'prop1': 'va
+00014e70: 6c75 6532 277d 290a 2020 2020 2020 2020  lue2'}).        
+00014e80: 2020 2020 646f 6333 203d 2063 6f6c 6c65      doc3 = colle
+00014e90: 6374 696f 6e2e 6372 6561 7465 5f69 7465  ction.create_ite
+00014ea0: 6d28 626f 6479 3d7b 2769 6427 3a20 2764  m(body={'id': 'd
+00014eb0: 6f63 3327 2c20 2770 726f 7031 273a 2027  oc3', 'prop1': '
+00014ec0: 7661 6c75 6533 277d 290a 2020 2020 2020  value3'}).      
+00014ed0: 2020 2020 2020 7265 736f 7572 6365 7320        resources 
+00014ee0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00014ef0: 2020 2020 2763 6f6c 6c27 3a20 636f 6c6c      'coll': coll
+00014f00: 6563 7469 6f6e 2c0a 2020 2020 2020 2020  ection,.        
+00014f10: 2020 2020 2020 2020 2764 6f63 3127 3a20          'doc1': 
+00014f20: 646f 6331 2c0a 2020 2020 2020 2020 2020  doc1,.          
+00014f30: 2020 2020 2020 2764 6f63 3227 3a20 646f        'doc2': do
+00014f40: 6332 2c0a 2020 2020 2020 2020 2020 2020  c2,.            
+00014f50: 2020 2020 2764 6f63 3327 3a20 646f 6333      'doc3': doc3
+00014f60: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
+00014f70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00014f80: 6e20 7265 736f 7572 6365 730a 0a20 2020  n resources..   
+00014f90: 2020 2020 2023 2056 616c 6964 6174 6520       # Validate 
+00014fa0: 5175 6572 7949 7465 7261 626c 6520 6279  QueryIterable by
+00014fb0: 2063 6f6e 7665 7274 696e 6720 6974 2074   converting it t
+00014fc0: 6f20 6120 6c69 7374 2e0a 2020 2020 2020  o a list..      
+00014fd0: 2020 7265 736f 7572 6365 7320 3d20 5f5f    resources = __
+00014fe0: 6372 6561 7465 5f72 6573 6f75 7263 6573  create_resources
+00014ff0: 2873 656c 662e 636c 6965 6e74 290a 2020  (self.client).  
+00015000: 2020 2020 2020 7265 7375 6c74 7320 3d20        results = 
+00015010: 7265 736f 7572 6365 735b 2763 6f6c 6c27  resources['coll'
+00015020: 5d2e 7265 6164 5f61 6c6c 5f69 7465 6d73  ].read_all_items
+00015030: 286d 6178 5f69 7465 6d5f 636f 756e 743d  (max_item_count=
+00015040: 3229 0a20 2020 2020 2020 2064 6f63 7320  2).        docs 
+00015050: 3d20 6c69 7374 2869 7465 7228 7265 7375  = list(iter(resu
+00015060: 6c74 7329 290a 2020 2020 2020 2020 7365  lts)).        se
+00015070: 6c66 2e61 7373 6572 7445 7175 616c 2833  lf.assertEqual(3
+00015080: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015090: 2020 2020 2020 2020 2020 206c 656e 2864             len(d
+000150a0: 6f63 7329 2c0a 2020 2020 2020 2020 2020  ocs),.          
+000150b0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000150c0: 5175 6572 7949 7465 7261 626c 6520 7368  QueryIterable sh
+000150d0: 6f75 6c64 2072 6574 7572 6e20 616c 6c20  ould return all 
+000150e0: 646f 6375 6d65 6e74 7327 202b 0a20 2020  documents' +.   
+000150f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015100: 2020 2020 2020 2720 7573 696e 6720 636f        ' using co
+00015110: 6e74 696e 7561 7469 6f6e 2729 0a20 2020  ntinuation').   
+00015120: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00015130: 4571 7561 6c28 7265 736f 7572 6365 735b  Equal(resources[
+00015140: 2764 6f63 3127 5d5b 2769 6427 5d2c 2064  'doc1']['id'], d
+00015150: 6f63 735b 305d 5b27 6964 275d 290a 2020  ocs[0]['id']).  
+00015160: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00015170: 7445 7175 616c 2872 6573 6f75 7263 6573  tEqual(resources
+00015180: 5b27 646f 6332 275d 5b27 6964 275d 2c20  ['doc2']['id'], 
+00015190: 646f 6373 5b31 5d5b 2769 6427 5d29 0a20  docs[1]['id']). 
+000151a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000151b0: 7274 4571 7561 6c28 7265 736f 7572 6365  rtEqual(resource
+000151c0: 735b 2764 6f63 3327 5d5b 2769 6427 5d2c  s['doc3']['id'],
+000151d0: 2064 6f63 735b 325d 5b27 6964 275d 290a   docs[2]['id']).
+000151e0: 0a20 2020 2020 2020 2023 2056 616c 6964  .        # Valid
+000151f0: 6174 6520 5175 6572 7949 7465 7261 626c  ate QueryIterabl
+00015200: 6520 6974 6572 6174 6f72 2077 6974 6820  e iterator with 
+00015210: 2766 6f72 272e 0a20 2020 2020 2020 2072  'for'..        r
+00015220: 6573 756c 7473 203d 2072 6573 6f75 7263  esults = resourc
+00015230: 6573 5b27 636f 6c6c 275d 2e72 6561 645f  es['coll'].read_
+00015240: 616c 6c5f 6974 656d 7328 6d61 785f 6974  all_items(max_it
+00015250: 656d 5f63 6f75 6e74 3d32 290a 2020 2020  em_count=2).    
+00015260: 2020 2020 636f 756e 7465 7220 3d20 300a      counter = 0.
+00015270: 2020 2020 2020 2020 2320 7465 7374 2051          # test Q
+00015280: 7565 7279 4974 6572 6162 6c65 2077 6974  ueryIterable wit
+00015290: 6820 2766 6f72 272e 0a20 2020 2020 2020  h 'for'..       
+000152a0: 2066 6f72 2064 6f63 2069 6e20 6974 6572   for doc in iter
+000152b0: 2872 6573 756c 7473 293a 0a20 2020 2020  (results):.     
+000152c0: 2020 2020 2020 2063 6f75 6e74 6572 202b         counter +
+000152d0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+000152e0: 6966 2063 6f75 6e74 6572 203d 3d20 313a  if counter == 1:
+000152f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015300: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00015310: 6c28 7265 736f 7572 6365 735b 2764 6f63  l(resources['doc
+00015320: 3127 5d5b 2769 6427 5d2c 0a20 2020 2020  1']['id'],.     
+00015330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015340: 2020 2020 2020 2020 2020 2020 646f 635b              doc[
+00015350: 2769 6427 5d2c 0a20 2020 2020 2020 2020  'id'],.         
+00015360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015370: 2020 2020 2020 2020 2766 6972 7374 2064          'first d
+00015380: 6f63 756d 656e 7420 7368 6f75 6c64 2062  ocument should b
+00015390: 6520 646f 6331 2729 0a20 2020 2020 2020  e doc1').       
+000153a0: 2020 2020 2065 6c69 6620 636f 756e 7465       elif counte
+000153b0: 7220 3d3d 2032 3a0a 2020 2020 2020 2020  r == 2:.        
+000153c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000153d0: 6572 7445 7175 616c 2872 6573 6f75 7263  ertEqual(resourc
+000153e0: 6573 5b27 646f 6332 275d 5b27 6964 275d  es['doc2']['id']
+000153f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015410: 2020 2064 6f63 5b27 6964 275d 2c0a 2020     doc['id'],.  
+00015420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015430: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00015440: 7365 636f 6e64 2064 6f63 756d 656e 7420  second document 
+00015450: 7368 6f75 6c64 2062 6520 646f 6332 2729  should be doc2')
+00015460: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00015470: 6620 636f 756e 7465 7220 3d3d 2033 3a0a  f counter == 3:.
+00015480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015490: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000154a0: 2872 6573 6f75 7263 6573 5b27 646f 6333  (resources['doc3
+000154b0: 275d 5b27 6964 275d 2c0a 2020 2020 2020  ']['id'],.      
+000154c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000154d0: 2020 2020 2020 2020 2020 2064 6f63 5b27             doc['
+000154e0: 6964 275d 2c0a 2020 2020 2020 2020 2020  id'],.          
+000154f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015500: 2020 2020 2020 2027 7468 6972 6420 646f         'third do
+00015510: 6375 6d65 6e74 2073 686f 756c 6420 6265  cument should be
+00015520: 2064 6f63 3327 290a 2020 2020 2020 2020   doc3').        
+00015530: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00015540: 2863 6f75 6e74 6572 2c20 3329 0a0a 2020  (counter, 3)..  
+00015550: 2020 2020 2020 2320 4765 7420 7175 6572        # Get quer
+00015560: 7920 7265 7375 6c74 7320 7061 6765 2062  y results page b
+00015570: 7920 7061 6765 2e0a 2020 2020 2020 2020  y page..        
+00015580: 7265 7375 6c74 7320 3d20 7265 736f 7572  results = resour
+00015590: 6365 735b 2763 6f6c 6c27 5d2e 7265 6164  ces['coll'].read
+000155a0: 5f61 6c6c 5f69 7465 6d73 286d 6178 5f69  _all_items(max_i
+000155b0: 7465 6d5f 636f 756e 743d 3229 0a0a 2020  tem_count=2)..  
+000155c0: 2020 2020 2020 7061 6765 5f69 7465 7220        page_iter 
+000155d0: 3d20 7265 7375 6c74 732e 6279 5f70 6167  = results.by_pag
+000155e0: 6528 290a 2020 2020 2020 2020 6669 7273  e().        firs
+000155f0: 745f 626c 6f63 6b20 3d20 6c69 7374 286e  t_block = list(n
+00015600: 6578 7428 7061 6765 5f69 7465 7229 290a  ext(page_iter)).
+00015610: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00015620: 6572 7445 7175 616c 2832 2c20 6c65 6e28  ertEqual(2, len(
+00015630: 6669 7273 745f 626c 6f63 6b29 2c20 2746  first_block), 'F
+00015640: 6972 7374 2062 6c6f 636b 2073 686f 756c  irst block shoul
+00015650: 6420 6861 7665 2032 2065 6e74 7269 6573  d have 2 entries
+00015660: 2e27 290a 2020 2020 2020 2020 7365 6c66  .').        self
+00015670: 2e61 7373 6572 7445 7175 616c 2872 6573  .assertEqual(res
+00015680: 6f75 7263 6573 5b27 646f 6331 275d 5b27  ources['doc1']['
+00015690: 6964 275d 2c20 6669 7273 745f 626c 6f63  id'], first_bloc
+000156a0: 6b5b 305d 5b27 6964 275d 290a 2020 2020  k[0]['id']).    
+000156b0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000156c0: 7175 616c 2872 6573 6f75 7263 6573 5b27  qual(resources['
+000156d0: 646f 6332 275d 5b27 6964 275d 2c20 6669  doc2']['id'], fi
+000156e0: 7273 745f 626c 6f63 6b5b 315d 5b27 6964  rst_block[1]['id
+000156f0: 275d 290a 2020 2020 2020 2020 7365 6c66  ']).        self
+00015700: 2e61 7373 6572 7445 7175 616c 2831 2c20  .assertEqual(1, 
+00015710: 6c65 6e28 6c69 7374 286e 6578 7428 7061  len(list(next(pa
+00015720: 6765 5f69 7465 7229 2929 2c20 2753 6563  ge_iter))), 'Sec
+00015730: 6f6e 6420 626c 6f63 6b20 7368 6f75 6c64  ond block should
+00015740: 2068 6176 6520 3120 656e 7472 792e 2729   have 1 entry.')
+00015750: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+00015760: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+00015770: 5374 6f70 4974 6572 6174 696f 6e29 3a0a  StopIteration):.
+00015780: 2020 2020 2020 2020 2020 2020 6e65 7874              next
+00015790: 2870 6167 655f 6974 6572 290a 0a20 2020  (page_iter)..   
+000157a0: 2064 6566 2074 6573 745f 7472 6967 6765   def test_trigge
+000157b0: 725f 6675 6e63 7469 6f6e 616c 6974 7928  r_functionality(
+000157c0: 7365 6c66 293a 0a20 2020 2020 2020 2074  self):.        t
+000157d0: 7269 6767 6572 735f 696e 5f63 6f6c 6c65  riggers_in_colle
+000157e0: 6374 696f 6e31 203d 205b 0a20 2020 2020  ction1 = [.     
+000157f0: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
+00015800: 2020 2020 2020 2020 2027 6964 273a 2027           'id': '
+00015810: 7431 272c 0a20 2020 2020 2020 2020 2020  t1',.           
+00015820: 2020 2020 2027 626f 6479 273a 2028 0a20       'body': (. 
+00015830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015840: 2020 2027 6675 6e63 7469 6f6e 2829 207b     'function() {
+00015850: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
+00015860: 2020 2020 2020 2020 2720 2020 2076 6172          '    var
+00015870: 2069 7465 6d20 3d20 6765 7443 6f6e 7465   item = getConte
+00015880: 7874 2829 2e67 6574 5265 7175 6573 7428  xt().getRequest(
+00015890: 292e 6765 7442 6f64 7928 293b 2720 2b0a  ).getBody();' +.
+000158a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158b0: 2020 2020 2720 2020 2069 7465 6d2e 6964      '    item.id
+000158c0: 203d 2069 7465 6d2e 6964 2e74 6f55 7070   = item.id.toUpp
+000158d0: 6572 4361 7365 2829 202b 205c 2774 315c  erCase() + \'t1\
+000158e0: 273b 2720 2b0a 2020 2020 2020 2020 2020  ';' +.          
+000158f0: 2020 2020 2020 2020 2020 2720 2020 2067            '    g
+00015900: 6574 436f 6e74 6578 7428 292e 6765 7452  etContext().getR
+00015910: 6571 7565 7374 2829 2e73 6574 426f 6479  equest().setBody
+00015920: 2869 7465 6d29 3b27 202b 0a20 2020 2020  (item);' +.     
+00015930: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00015940: 7d27 292c 0a20 2020 2020 2020 2020 2020  }'),.           
+00015950: 2020 2020 2027 7472 6967 6765 7254 7970       'triggerTyp
+00015960: 6527 3a20 646f 6375 6d65 6e74 732e 5472  e': documents.Tr
+00015970: 6967 6765 7254 7970 652e 5072 652c 0a20  iggerType.Pre,. 
+00015980: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00015990: 7472 6967 6765 724f 7065 7261 7469 6f6e  triggerOperation
+000159a0: 273a 2064 6f63 756d 656e 7473 2e54 7269  ': documents.Tri
+000159b0: 6767 6572 4f70 6572 6174 696f 6e2e 416c  ggerOperation.Al
+000159c0: 6c0a 2020 2020 2020 2020 2020 2020 7d2c  l.            },
+000159d0: 0a20 2020 2020 2020 2020 2020 207b 0a20  .            {. 
+000159e0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000159f0: 6964 273a 2027 7265 7370 6f6e 7365 3127  id': 'response1'
+00015a00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015a10: 2020 2762 6f64 7927 3a20 280a 2020 2020    'body': (.    
+00015a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a30: 2766 756e 6374 696f 6e28 2920 7b27 202b  'function() {' +
+00015a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015a50: 2020 2020 2027 2020 2020 7661 7220 7072       '    var pr
+00015a60: 6562 6f64 7920 3d20 6765 7443 6f6e 7465  ebody = getConte
+00015a70: 7874 2829 2e67 6574 5265 7175 6573 7428  xt().getRequest(
+00015a80: 292e 6765 7442 6f64 7928 293b 2720 2b0a  ).getBody();' +.
+00015a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015aa0: 2020 2020 2720 2020 2069 6620 2870 7265      '    if (pre
+00015ab0: 626f 6479 2e69 6420 213d 205c 2754 4553  body.id != \'TES
+00015ac0: 5449 4e47 2050 4f53 5420 5452 4947 4745  TING POST TRIGGE
+00015ad0: 5274 315c 2729 270a 2020 2020 2020 2020  Rt1\')'.        
+00015ae0: 2020 2020 2020 2020 2020 2020 2720 2020              '   
+00015af0: 2020 2020 2074 6872 6f77 205c 2769 6420       throw \'id 
+00015b00: 6d69 736d 6174 6368 5c27 3b27 202b 0a20  mismatch\';' +. 
+00015b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b20: 2020 2027 2020 2020 7661 7220 706f 7374     '    var post
+00015b30: 626f 6479 203d 2067 6574 436f 6e74 6578  body = getContex
+00015b40: 7428 292e 6765 7452 6573 706f 6e73 6528  t().getResponse(
+00015b50: 292e 6765 7442 6f64 7928 293b 2720 2b0a  ).getBody();' +.
+00015b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b70: 2020 2020 2720 2020 2069 6620 2870 6f73      '    if (pos
+00015b80: 7462 6f64 792e 6964 2021 3d20 5c27 5445  tbody.id != \'TE
+00015b90: 5354 494e 4720 504f 5354 2054 5249 4747  STING POST TRIGG
+00015ba0: 4552 7431 5c27 2927 0a20 2020 2020 2020  ERt1\')'.       
+00015bb0: 2020 2020 2020 2020 2020 2020 2027 2020               '  
+00015bc0: 2020 2020 2020 7468 726f 7720 5c27 6964        throw \'id
+00015bd0: 206d 6973 6d61 7463 685c 273b 270a 2020   mismatch\';'.  
+00015be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015bf0: 2020 277d 2729 2c0a 2020 2020 2020 2020    '}'),.        
+00015c00: 2020 2020 2020 2020 2774 7269 6767 6572          'trigger
+00015c10: 5479 7065 273a 2064 6f63 756d 656e 7473  Type': documents
+00015c20: 2e54 7269 6767 6572 5479 7065 2e50 6f73  .TriggerType.Pos
+00015c30: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00015c40: 2020 2027 7472 6967 6765 724f 7065 7261     'triggerOpera
+00015c50: 7469 6f6e 273a 2064 6f63 756d 656e 7473  tion': documents
+00015c60: 2e54 7269 6767 6572 4f70 6572 6174 696f  .TriggerOperatio
+00015c70: 6e2e 416c 6c0a 2020 2020 2020 2020 2020  n.All.          
+00015c80: 2020 7d2c 0a20 2020 2020 2020 2020 2020    },.           
+00015c90: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00015ca0: 2020 2027 6964 273a 2027 7265 7370 6f6e     'id': 'respon
+00015cb0: 7365 3227 2c0a 2020 2020 2020 2020 2020  se2',.          
+00015cc0: 2020 2020 2020 2320 6361 6e27 7420 6265        # can't be
+00015cd0: 2075 7365 6420 6265 6361 7573 6520 7365   used because se
+00015ce0: 7456 616c 7565 2069 7320 6375 7272 656e  tValue is curren
+00015cf0: 746c 7920 6469 7361 626c 6564 0a20 2020  tly disabled.   
+00015d00: 2020 2020 2020 2020 2020 2020 2027 626f               'bo
+00015d10: 6479 273a 2028 0a20 2020 2020 2020 2020  dy': (.         
+00015d20: 2020 2020 2020 2020 2020 2027 6675 6e63             'func
+00015d30: 7469 6f6e 2829 207b 2720 2b0a 2020 2020  tion() {' +.    
+00015d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d50: 2720 2020 2076 6172 2070 7265 646f 6320  '    var predoc 
+00015d60: 3d20 6765 7443 6f6e 7465 7874 2829 2e67  = getContext().g
+00015d70: 6574 5265 7175 6573 7428 292e 6765 7442  etRequest().getB
+00015d80: 6f64 7928 293b 2720 2b0a 2020 2020 2020  ody();' +.      
+00015d90: 2020 2020 2020 2020 2020 2020 2020 2720                ' 
+00015da0: 2020 2076 6172 2070 6f73 7464 6f63 203d     var postdoc =
+00015db0: 2067 6574 436f 6e74 6578 7428 292e 6765   getContext().ge
+00015dc0: 7452 6573 706f 6e73 6528 292e 6765 7442  tResponse().getB
+00015dd0: 6f64 7928 293b 2720 2b0a 2020 2020 2020  ody();' +.      
+00015de0: 2020 2020 2020 2020 2020 2020 2020 2720                ' 
+00015df0: 2020 2067 6574 436f 6e74 6578 7428 292e     getContext().
+00015e00: 6765 7452 6573 706f 6e73 6528 292e 7365  getResponse().se
+00015e10: 7456 616c 7565 2827 202b 0a20 2020 2020  tValue(' +.     
+00015e20: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00015e30: 2020 2020 2020 2020 5c27 7072 6564 6f63          \'predoc
+00015e40: 6e61 6d65 5c27 2c20 7072 6564 6f63 2e69  name\', predoc.i
+00015e50: 6420 2b20 5c27 7265 7370 6f6e 7365 325c  d + \'response2\
+00015e60: 2729 3b27 202b 0a20 2020 2020 2020 2020  ');' +.         
+00015e70: 2020 2020 2020 2020 2020 2027 2020 2020             '    
+00015e80: 6765 7443 6f6e 7465 7874 2829 2e67 6574  getContext().get
+00015e90: 5265 7370 6f6e 7365 2829 2e73 6574 5661  Response().setVa
+00015ea0: 6c75 6528 2720 2b0a 2020 2020 2020 2020  lue(' +.        
+00015eb0: 2020 2020 2020 2020 2020 2020 2720 2020              '   
+00015ec0: 2020 2020 205c 2770 6f73 7464 6f63 6e61       \'postdocna
+00015ed0: 6d65 5c27 2c20 706f 7374 646f 632e 6964  me\', postdoc.id
+00015ee0: 202b 205c 2772 6573 706f 6e73 6532 5c27   + \'response2\'
+00015ef0: 293b 2720 2b0a 2020 2020 2020 2020 2020  );' +.          
+00015f00: 2020 2020 2020 2020 2020 277d 2729 2c0a            '}'),.
+00015f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f20: 2774 7269 6767 6572 5479 7065 273a 2064  'triggerType': d
+00015f30: 6f63 756d 656e 7473 2e54 7269 6767 6572  ocuments.Trigger
+00015f40: 5479 7065 2e50 6f73 742c 0a20 2020 2020  Type.Post,.     
+00015f50: 2020 2020 2020 2020 2020 2027 7472 6967             'trig
+00015f60: 6765 724f 7065 7261 7469 6f6e 273a 2064  gerOperation': d
+00015f70: 6f63 756d 656e 7473 2e54 7269 6767 6572  ocuments.Trigger
+00015f80: 4f70 6572 6174 696f 6e2e 416c 6c2c 0a20  Operation.All,. 
+00015f90: 2020 2020 2020 2020 2020 207d 5d0a 2020             }].  
+00015fa0: 2020 2020 2020 7472 6967 6765 7273 5f69        triggers_i
+00015fb0: 6e5f 636f 6c6c 6563 7469 6f6e 3220 3d20  n_collection2 = 
+00015fc0: 5b0a 2020 2020 2020 2020 2020 2020 7b0a  [.            {.
+00015fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015fe0: 2769 6427 3a20 2274 3222 2c0a 2020 2020  'id': "t2",.    
+00015ff0: 2020 2020 2020 2020 2020 2020 2762 6f64              'bod
+00016000: 7927 3a20 2266 756e 6374 696f 6e28 2920  y': "function() 
+00016010: 7b20 7d22 2c20 2023 2074 7269 6767 6572  { }",  # trigger
+00016020: 2061 6c72 6561 6479 2073 7472 696e 6769   already stringi
+00016030: 6669 6564 0a20 2020 2020 2020 2020 2020  fied.           
+00016040: 2020 2020 2027 7472 6967 6765 7254 7970       'triggerTyp
+00016050: 6527 3a20 646f 6375 6d65 6e74 732e 5472  e': documents.Tr
+00016060: 6967 6765 7254 7970 652e 5072 652c 0a20  iggerType.Pre,. 
+00016070: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00016080: 7472 6967 6765 724f 7065 7261 7469 6f6e  triggerOperation
+00016090: 273a 2064 6f63 756d 656e 7473 2e54 7269  ': documents.Tri
+000160a0: 6767 6572 4f70 6572 6174 696f 6e2e 416c  ggerOperation.Al
+000160b0: 6c0a 2020 2020 2020 2020 2020 2020 7d2c  l.            },
+000160c0: 0a20 2020 2020 2020 2020 2020 207b 0a20  .            {. 
+000160d0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000160e0: 6964 273a 2022 7433 222c 0a20 2020 2020  id': "t3",.     
+000160f0: 2020 2020 2020 2020 2020 2027 626f 6479             'body
+00016100: 273a 2028 0a20 2020 2020 2020 2020 2020  ': (.           
+00016110: 2020 2020 2020 2020 2027 6675 6e63 7469           'functi
+00016120: 6f6e 2829 207b 2720 2b0a 2020 2020 2020  on() {' +.      
+00016130: 2020 2020 2020 2020 2020 2020 2020 2720                ' 
+00016140: 2020 2076 6172 2069 7465 6d20 3d20 6765     var item = ge
+00016150: 7443 6f6e 7465 7874 2829 2e67 6574 5265  tContext().getRe
+00016160: 7175 6573 7428 292e 6765 7442 6f64 7928  quest().getBody(
+00016170: 293b 2720 2b0a 2020 2020 2020 2020 2020  );' +.          
+00016180: 2020 2020 2020 2020 2020 2720 2020 2069            '    i
+00016190: 7465 6d2e 6964 203d 2069 7465 6d2e 6964  tem.id = item.id
+000161a0: 2e74 6f4c 6f77 6572 4361 7365 2829 202b  .toLowerCase() +
+000161b0: 205c 2774 335c 273b 2720 2b0a 2020 2020   \'t3\';' +.    
+000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161d0: 2720 2020 2067 6574 436f 6e74 6578 7428  '    getContext(
+000161e0: 292e 6765 7452 6571 7565 7374 2829 2e73  ).getRequest().s
+000161f0: 6574 426f 6479 2869 7465 6d29 3b27 202b  etBody(item);' +
+00016200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016210: 2020 2020 2027 7d27 292c 0a20 2020 2020       '}'),.     
+00016220: 2020 2020 2020 2020 2020 2027 7472 6967             'trig
+00016230: 6765 7254 7970 6527 3a20 646f 6375 6d65  gerType': docume
+00016240: 6e74 732e 5472 6967 6765 7254 7970 652e  nts.TriggerType.
+00016250: 5072 652c 0a20 2020 2020 2020 2020 2020  Pre,.           
+00016260: 2020 2020 2027 7472 6967 6765 724f 7065       'triggerOpe
+00016270: 7261 7469 6f6e 273a 2064 6f63 756d 656e  ration': documen
+00016280: 7473 2e54 7269 6767 6572 4f70 6572 6174  ts.TriggerOperat
+00016290: 696f 6e2e 416c 6c0a 2020 2020 2020 2020  ion.All.        
+000162a0: 2020 2020 7d5d 0a20 2020 2020 2020 2074      }].        t
+000162b0: 7269 6767 6572 735f 696e 5f63 6f6c 6c65  riggers_in_colle
+000162c0: 6374 696f 6e33 203d 205b 0a20 2020 2020  ction3 = [.     
+000162d0: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
+000162e0: 2020 2020 2020 2020 2027 6964 273a 2027           'id': '
+000162f0: 7472 6967 6765 724f 7054 7970 6527 2c0a  triggerOpType',.
+00016300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016310: 2762 6f64 7927 3a20 2766 756e 6374 696f  'body': 'functio
+00016320: 6e28 2920 7b20 7d27 2c0a 2020 2020 2020  n() { }',.      
+00016330: 2020 2020 2020 2020 2020 2774 7269 6767            'trigg
+00016340: 6572 5479 7065 273a 2064 6f63 756d 656e  erType': documen
+00016350: 7473 2e54 7269 6767 6572 5479 7065 2e50  ts.TriggerType.P
+00016360: 6f73 742c 0a20 2020 2020 2020 2020 2020  ost,.           
+00016370: 2020 2020 2027 7472 6967 6765 724f 7065       'triggerOpe
+00016380: 7261 7469 6f6e 273a 2064 6f63 756d 656e  ration': documen
+00016390: 7473 2e54 7269 6767 6572 4f70 6572 6174  ts.TriggerOperat
+000163a0: 696f 6e2e 4465 6c65 7465 2c0a 2020 2020  ion.Delete,.    
+000163b0: 2020 2020 2020 2020 7d5d 0a0a 2020 2020          }]..    
+000163c0: 2020 2020 6465 6620 5f5f 4372 6561 7465      def __Create
+000163d0: 5472 6967 6765 7273 2863 6f6c 6c65 6374  Triggers(collect
+000163e0: 696f 6e2c 2074 7269 6767 6572 7329 3a0a  ion, triggers):.
+000163f0: 2020 2020 2020 2020 2020 2020 2222 2243              """C
+00016400: 7265 6174 6573 2074 7269 6767 6572 732e  reates triggers.
+00016410: 0a0a 2020 2020 2020 2020 2020 2020 3a50  ..            :P
+00016420: 6172 616d 6574 6572 733a 0a20 2020 2020  arameters:.     
+00016430: 2020 2020 2020 2020 2020 202d 2060 636c             - `cl
+00016440: 6965 6e74 603a 2063 6f73 6d6f 735f 636c  ient`: cosmos_cl
+00016450: 6965 6e74 5f63 6f6e 6e65 6374 696f 6e2e  ient_connection.
+00016460: 436f 736d 6f73 436c 6965 6e74 436f 6e6e  CosmosClientConn
+00016470: 6563 7469 6f6e 0a20 2020 2020 2020 2020  ection.         
+00016480: 2020 2020 2020 202d 2060 636f 6c6c 6563         - `collec
+00016490: 7469 6f6e 603a 2064 6963 740a 0a20 2020  tion`: dict..   
+000164a0: 2020 2020 2020 2020 2022 2222 0a20 2020           """.   
+000164b0: 2020 2020 2020 2020 2066 6f72 2074 7269           for tri
+000164c0: 6767 6572 5f69 2069 6e20 7472 6967 6765  gger_i in trigge
+000164d0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+000164e0: 2020 2020 7472 6967 6765 7220 3d20 636f      trigger = co
+000164f0: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
+00016500: 2e63 7265 6174 655f 7472 6967 6765 7228  .create_trigger(
+00016510: 626f 6479 3d74 7269 6767 6572 5f69 290a  body=trigger_i).
+00016520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016530: 666f 7220 7072 6f70 6572 7479 2069 6e20  for property in 
+00016540: 7472 6967 6765 725f 693a 0a20 2020 2020  trigger_i:.     
+00016550: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00016560: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00016570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016580: 2020 2020 2020 2020 2074 7269 6767 6572           trigger
+00016590: 5b70 726f 7065 7274 795d 2c0a 2020 2020  [property],.    
+000165a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165b0: 2020 2020 7472 6967 6765 725f 695b 7072      trigger_i[pr
+000165c0: 6f70 6572 7479 5d2c 0a20 2020 2020 2020  operty],.       
+000165d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165e0: 2027 7072 6f70 6572 7479 207b 7072 6f70   'property {prop
+000165f0: 6572 7479 7d20 7368 6f75 6c64 206d 6174  erty} should mat
+00016600: 6368 272e 666f 726d 6174 2870 726f 7065  ch'.format(prope
+00016610: 7274 793d 7072 6f70 6572 7479 2929 0a0a  rty=property))..
+00016620: 2020 2020 2020 2020 2320 6372 6561 7465          # create
+00016630: 2064 6174 6162 6173 650a 2020 2020 2020   database.      
+00016640: 2020 6462 203d 2073 656c 662e 6461 7461    db = self.data
+00016650: 6261 7365 466f 7254 6573 740a 2020 2020  baseForTest.    
+00016660: 2020 2020 2320 6372 6561 7465 2063 6f6c      # create col
+00016670: 6c65 6374 696f 6e73 0a20 2020 2020 2020  lections.       
+00016680: 2070 6b64 203d 2050 6172 7469 7469 6f6e   pkd = Partition
+00016690: 4b65 7928 7061 7468 3d27 2f69 6427 2c20  Key(path='/id', 
+000166a0: 6b69 6e64 3d27 4861 7368 2729 0a20 2020  kind='Hash').   
+000166b0: 2020 2020 2063 6f6c 6c65 6374 696f 6e31       collection1
+000166c0: 203d 2064 622e 6372 6561 7465 5f63 6f6e   = db.create_con
+000166d0: 7461 696e 6572 2869 643d 2774 6573 745f  tainer(id='test_
+000166e0: 7472 6967 6765 725f 6675 6e63 7469 6f6e  trigger_function
+000166f0: 616c 6974 7920 3120 2720 2b20 7374 7228  ality 1 ' + str(
+00016700: 7575 6964 2e75 7569 6434 2829 292c 2070  uuid.uuid4()), p
+00016710: 6172 7469 7469 6f6e 5f6b 6579 3d50 6172  artition_key=Par
+00016720: 7469 7469 6f6e 4b65 7928 7061 7468 3d27  titionKey(path='
+00016730: 2f6b 6579 272c 206b 696e 643d 2748 6173  /key', kind='Has
+00016740: 6827 2929 0a20 2020 2020 2020 2063 6f6c  h')).        col
+00016750: 6c65 6374 696f 6e32 203d 2064 622e 6372  lection2 = db.cr
+00016760: 6561 7465 5f63 6f6e 7461 696e 6572 2869  eate_container(i
+00016770: 643d 2774 6573 745f 7472 6967 6765 725f  d='test_trigger_
+00016780: 6675 6e63 7469 6f6e 616c 6974 7920 3220  functionality 2 
+00016790: 2720 2b20 7374 7228 7575 6964 2e75 7569  ' + str(uuid.uui
+000167a0: 6434 2829 292c 2070 6172 7469 7469 6f6e  d4()), partition
+000167b0: 5f6b 6579 3d50 6172 7469 7469 6f6e 4b65  _key=PartitionKe
+000167c0: 7928 7061 7468 3d27 2f6b 6579 272c 206b  y(path='/key', k
+000167d0: 696e 643d 2748 6173 6827 2929 0a20 2020  ind='Hash')).   
+000167e0: 2020 2020 2063 6f6c 6c65 6374 696f 6e33       collection3
+000167f0: 203d 2064 622e 6372 6561 7465 5f63 6f6e   = db.create_con
+00016800: 7461 696e 6572 2869 643d 2774 6573 745f  tainer(id='test_
+00016810: 7472 6967 6765 725f 6675 6e63 7469 6f6e  trigger_function
+00016820: 616c 6974 7920 3320 2720 2b20 7374 7228  ality 3 ' + str(
+00016830: 7575 6964 2e75 7569 6434 2829 292c 2070  uuid.uuid4()), p
+00016840: 6172 7469 7469 6f6e 5f6b 6579 3d50 6172  artition_key=Par
+00016850: 7469 7469 6f6e 4b65 7928 7061 7468 3d27  titionKey(path='
+00016860: 2f6b 6579 272c 206b 696e 643d 2748 6173  /key', kind='Has
+00016870: 6827 2929 0a20 2020 2020 2020 2023 2063  h')).        # c
+00016880: 7265 6174 6520 7472 6967 6765 7273 0a20  reate triggers. 
+00016890: 2020 2020 2020 205f 5f43 7265 6174 6554         __CreateT
+000168a0: 7269 6767 6572 7328 636f 6c6c 6563 7469  riggers(collecti
+000168b0: 6f6e 312c 2074 7269 6767 6572 735f 696e  on1, triggers_in
+000168c0: 5f63 6f6c 6c65 6374 696f 6e31 290a 2020  _collection1).  
+000168d0: 2020 2020 2020 5f5f 4372 6561 7465 5472        __CreateTr
+000168e0: 6967 6765 7273 2863 6f6c 6c65 6374 696f  iggers(collectio
+000168f0: 6e32 2c20 7472 6967 6765 7273 5f69 6e5f  n2, triggers_in_
+00016900: 636f 6c6c 6563 7469 6f6e 3229 0a20 2020  collection2).   
+00016910: 2020 2020 205f 5f43 7265 6174 6554 7269       __CreateTri
+00016920: 6767 6572 7328 636f 6c6c 6563 7469 6f6e  ggers(collection
+00016930: 332c 2074 7269 6767 6572 735f 696e 5f63  3, triggers_in_c
+00016940: 6f6c 6c65 6374 696f 6e33 290a 2020 2020  ollection3).    
+00016950: 2020 2020 2320 6372 6561 7465 2064 6f63      # create doc
+00016960: 756d 656e 740a 2020 2020 2020 2020 7472  ument.        tr
+00016970: 6967 6765 7273 5f31 203d 206c 6973 7428  iggers_1 = list(
+00016980: 636f 6c6c 6563 7469 6f6e 312e 7363 7269  collection1.scri
+00016990: 7074 732e 6c69 7374 5f74 7269 6767 6572  pts.list_trigger
+000169a0: 7328 2929 0a20 2020 2020 2020 2073 656c  s()).        sel
+000169b0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+000169c0: 6e28 7472 6967 6765 7273 5f31 292c 2033  n(triggers_1), 3
+000169d0: 290a 2020 2020 2020 2020 646f 6375 6d65  ).        docume
+000169e0: 6e74 5f31 5f31 203d 2063 6f6c 6c65 6374  nt_1_1 = collect
+000169f0: 696f 6e31 2e63 7265 6174 655f 6974 656d  ion1.create_item
+00016a00: 280a 2020 2020 2020 2020 2020 2020 626f  (.            bo
+00016a10: 6479 3d7b 2769 6427 3a20 2764 6f63 3127  dy={'id': 'doc1'
+00016a20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016a30: 2020 2020 276b 6579 273a 2027 7661 6c75      'key': 'valu
+00016a40: 6527 7d2c 0a20 2020 2020 2020 2020 2020  e'},.           
+00016a50: 2070 7265 5f74 7269 6767 6572 5f69 6e63   pre_trigger_inc
+00016a60: 6c75 6465 3d27 7431 270a 2020 2020 2020  lude='t1'.      
+00016a70: 2020 290a 2020 2020 2020 2020 7365 6c66    ).        self
+00016a80: 2e61 7373 6572 7445 7175 616c 2864 6f63  .assertEqual(doc
+00016a90: 756d 656e 745f 315f 315b 2769 6427 5d2c  ument_1_1['id'],
+00016aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016ab0: 2020 2020 2020 2020 2020 2744 4f43 3174            'DOC1t
+00016ac0: 3127 2c0a 2020 2020 2020 2020 2020 2020  1',.            
+00016ad0: 2020 2020 2020 2020 2020 2020 2027 6964               'id
+00016ae0: 2073 686f 756c 6420 6265 2063 6170 6974   should be capit
+00016af0: 616c 697a 6564 2729 0a0a 2020 2020 2020  alized')..      
+00016b00: 2020 646f 6375 6d65 6e74 5f31 5f32 203d    document_1_2 =
+00016b10: 2063 6f6c 6c65 6374 696f 6e31 2e63 7265   collection1.cre
+00016b20: 6174 655f 6974 656d 280a 2020 2020 2020  ate_item(.      
+00016b30: 2020 2020 2020 626f 6479 3d7b 2769 6427        body={'id'
+00016b40: 3a20 2774 6573 7469 6e67 2070 6f73 7420  : 'testing post 
+00016b50: 7472 6967 6765 7227 2c20 276b 6579 273a  trigger', 'key':
+00016b60: 2027 7661 6c75 6527 7d2c 0a20 2020 2020   'value'},.     
+00016b70: 2020 2020 2020 2070 7265 5f74 7269 6767         pre_trigg
+00016b80: 6572 5f69 6e63 6c75 6465 3d27 7431 272c  er_include='t1',
+00016b90: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
+00016ba0: 745f 7472 6967 6765 725f 696e 636c 7564  t_trigger_includ
+00016bb0: 653d 2772 6573 706f 6e73 6531 272c 0a20  e='response1',. 
+00016bc0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00016bd0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00016be0: 6c28 646f 6375 6d65 6e74 5f31 5f32 5b27  l(document_1_2['
+00016bf0: 6964 275d 2c20 2754 4553 5449 4e47 2050  id'], 'TESTING P
+00016c00: 4f53 5420 5452 4947 4745 5274 3127 290a  OST TRIGGERt1').
+00016c10: 0a20 2020 2020 2020 2064 6f63 756d 656e  .        documen
+00016c20: 745f 315f 3320 3d20 636f 6c6c 6563 7469  t_1_3 = collecti
+00016c30: 6f6e 312e 6372 6561 7465 5f69 7465 6d28  on1.create_item(
+00016c40: 0a20 2020 2020 2020 2020 2020 2062 6f64  .            bod
+00016c50: 793d 7b27 6964 273a 2027 7265 7370 6f6e  y={'id': 'respon
+00016c60: 7365 6865 6164 6572 7327 2c20 276b 6579  seheaders', 'key
+00016c70: 273a 2027 7661 6c75 6527 7d2c 0a20 2020  ': 'value'},.   
+00016c80: 2020 2020 2020 2020 2070 7265 5f74 7269           pre_tri
+00016c90: 6767 6572 5f69 6e63 6c75 6465 3d27 7431  gger_include='t1
+00016ca0: 270a 2020 2020 2020 2020 290a 2020 2020  '.        ).    
+00016cb0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00016cc0: 7175 616c 2864 6f63 756d 656e 745f 315f  qual(document_1_
+00016cd0: 335b 2769 6427 5d2c 2022 5245 5350 4f4e  3['id'], "RESPON
+00016ce0: 5345 4845 4144 4552 5374 3122 290a 0a20  SEHEADERSt1").. 
+00016cf0: 2020 2020 2020 2074 7269 6767 6572 735f         triggers_
+00016d00: 3220 3d20 6c69 7374 2863 6f6c 6c65 6374  2 = list(collect
+00016d10: 696f 6e32 2e73 6372 6970 7473 2e6c 6973  ion2.scripts.lis
+00016d20: 745f 7472 6967 6765 7273 2829 290a 2020  t_triggers()).  
+00016d30: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00016d40: 7445 7175 616c 286c 656e 2874 7269 6767  tEqual(len(trigg
+00016d50: 6572 735f 3229 2c20 3229 0a20 2020 2020  ers_2), 2).     
+00016d60: 2020 2064 6f63 756d 656e 745f 325f 3120     document_2_1 
+00016d70: 3d20 636f 6c6c 6563 7469 6f6e 322e 6372  = collection2.cr
+00016d80: 6561 7465 5f69 7465 6d28 0a20 2020 2020  eate_item(.     
+00016d90: 2020 2020 2020 2062 6f64 793d 7b27 6964         body={'id
+00016da0: 273a 2027 646f 6332 272c 0a20 2020 2020  ': 'doc2',.     
+00016db0: 2020 2020 2020 2020 2020 2020 2027 6b65               'ke
+00016dc0: 7927 3a20 2776 616c 7565 3227 7d2c 0a20  y': 'value2'},. 
+00016dd0: 2020 2020 2020 2020 2020 2070 7265 5f74             pre_t
+00016de0: 7269 6767 6572 5f69 6e63 6c75 6465 3d27  rigger_include='
+00016df0: 7432 270a 2020 2020 2020 2020 290a 2020  t2'.        ).  
+00016e00: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00016e10: 7445 7175 616c 2864 6f63 756d 656e 745f  tEqual(document_
+00016e20: 325f 315b 2769 6427 5d2c 0a20 2020 2020  2_1['id'],.     
+00016e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e40: 2020 2020 2764 6f63 3227 2c0a 2020 2020      'doc2',.    
+00016e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e60: 2020 2020 2027 6964 2073 686f 756c 646e       'id shouldn
+00016e70: 5c27 7420 6368 616e 6765 2729 0a20 2020  \'t change').   
+00016e80: 2020 2020 2064 6f63 756d 656e 745f 325f       document_2_
+00016e90: 3220 3d20 636f 6c6c 6563 7469 6f6e 322e  2 = collection2.
+00016ea0: 6372 6561 7465 5f69 7465 6d28 0a20 2020  create_item(.   
+00016eb0: 2020 2020 2020 2020 2062 6f64 793d 7b27           body={'
+00016ec0: 6964 273a 2027 446f 6333 272c 0a20 2020  id': 'Doc3',.   
+00016ed0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00016ee0: 7072 6f70 273a 2027 656d 7074 7927 2c0a  prop': 'empty',.
+00016ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f00: 2020 276b 6579 273a 2027 7661 6c75 6532    'key': 'value2
+00016f10: 277d 2c0a 2020 2020 2020 2020 2020 2020  '},.            
+00016f20: 7072 655f 7472 6967 6765 725f 696e 636c  pre_trigger_incl
+00016f30: 7564 653d 2774 3327 290a 2020 2020 2020  ude='t3').      
+00016f40: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00016f50: 616c 2864 6f63 756d 656e 745f 325f 325b  al(document_2_2[
+00016f60: 2769 6427 5d2c 2027 646f 6333 7433 2729  'id'], 'doc3t3')
+00016f70: 0a0a 2020 2020 2020 2020 7472 6967 6765  ..        trigge
+00016f80: 7273 5f33 203d 206c 6973 7428 636f 6c6c  rs_3 = list(coll
+00016f90: 6563 7469 6f6e 332e 7363 7269 7074 732e  ection3.scripts.
+00016fa0: 6c69 7374 5f74 7269 6767 6572 7328 2929  list_triggers())
+00016fb0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00016fc0: 7365 7274 4571 7561 6c28 6c65 6e28 7472  sertEqual(len(tr
+00016fd0: 6967 6765 7273 5f33 292c 2031 290a 2020  iggers_3), 1).  
+00016fe0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+00016ff0: 6173 7365 7274 5261 6973 6573 2845 7863  assertRaises(Exc
+00017000: 6570 7469 6f6e 293a 0a20 2020 2020 2020  eption):.       
+00017010: 2020 2020 2063 6f6c 6c65 6374 696f 6e33       collection3
+00017020: 2e63 7265 6174 655f 6974 656d 280a 2020  .create_item(.  
+00017030: 2020 2020 2020 2020 2020 2020 2020 626f                bo
+00017040: 6479 3d7b 2769 6427 3a20 2744 6f63 6f70  dy={'id': 'Docop
+00017050: 7479 7065 272c 2027 6b65 7927 3a20 2776  type', 'key': 'v
+00017060: 616c 7565 3227 7d2c 0a20 2020 2020 2020  alue2'},.       
+00017070: 2020 2020 2020 2020 2070 6f73 745f 7472           post_tr
+00017080: 6967 6765 725f 696e 636c 7564 653d 2774  igger_include='t
+00017090: 7269 6767 6572 4f70 5479 7065 270a 2020  riggerOpType'.  
+000170a0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+000170b0: 2020 2020 2064 622e 6465 6c65 7465 5f63       db.delete_c
+000170c0: 6f6e 7461 696e 6572 2863 6f6c 6c65 6374  ontainer(collect
+000170d0: 696f 6e31 290a 2020 2020 2020 2020 6462  ion1).        db
+000170e0: 2e64 656c 6574 655f 636f 6e74 6169 6e65  .delete_containe
+000170f0: 7228 636f 6c6c 6563 7469 6f6e 3229 0a20  r(collection2). 
+00017100: 2020 2020 2020 2064 622e 6465 6c65 7465         db.delete
+00017110: 5f63 6f6e 7461 696e 6572 2863 6f6c 6c65  _container(colle
+00017120: 6374 696f 6e33 290a 0a20 2020 2064 6566  ction3)..    def
+00017130: 2074 6573 745f 7374 6f72 6564 5f70 726f   test_stored_pro
+00017140: 6365 6475 7265 5f66 756e 6374 696f 6e61  cedure_functiona
+00017150: 6c69 7479 2873 656c 6629 3a0a 2020 2020  lity(self):.    
+00017160: 2020 2020 2320 6372 6561 7465 2064 6174      # create dat
+00017170: 6162 6173 650a 2020 2020 2020 2020 6462  abase.        db
+00017180: 203d 2073 656c 662e 6461 7461 6261 7365   = self.database
+00017190: 466f 7254 6573 740a 2020 2020 2020 2020  ForTest.        
+000171a0: 2320 6372 6561 7465 2063 6f6c 6c65 6374  # create collect
+000171b0: 696f 6e0a 2020 2020 2020 2020 636f 6c6c  ion.        coll
+000171c0: 6563 7469 6f6e 203d 2073 656c 662e 636f  ection = self.co
+000171d0: 6e66 6967 732e 6372 6561 7465 5f6d 756c  nfigs.create_mul
+000171e0: 7469 5f70 6172 7469 7469 6f6e 5f63 6f6c  ti_partition_col
+000171f0: 6c65 6374 696f 6e5f 6966 5f6e 6f74 5f65  lection_if_not_e
+00017200: 7869 7374 2873 656c 662e 636c 6965 6e74  xist(self.client
+00017210: 290a 0a20 2020 2020 2020 2073 7072 6f63  )..        sproc
+00017220: 3120 3d20 7b0a 2020 2020 2020 2020 2020  1 = {.          
+00017230: 2020 2769 6427 3a20 2773 746f 7265 6450    'id': 'storedP
+00017240: 726f 6365 6475 7265 3127 202b 2073 7472  rocedure1' + str
+00017250: 2875 7569 642e 7575 6964 3428 2929 2c0a  (uuid.uuid4()),.
+00017260: 2020 2020 2020 2020 2020 2020 2762 6f64              'bod
+00017270: 7927 3a20 280a 2020 2020 2020 2020 2020  y': (.          
+00017280: 2020 2020 2020 2766 756e 6374 696f 6e20        'function 
+00017290: 2829 207b 2720 2b0a 2020 2020 2020 2020  () {' +.        
+000172a0: 2020 2020 2020 2020 2720 2066 6f72 2028          '  for (
+000172b0: 7661 7220 6920 3d20 303b 2069 203c 2031  var i = 0; i < 1
+000172c0: 3030 303b 2069 2b2b 2920 7b27 202b 0a20  000; i++) {' +. 
+000172d0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+000172e0: 2020 2020 7661 7220 6974 656d 203d 2067      var item = g
+000172f0: 6574 436f 6e74 6578 7428 292e 6765 7452  etContext().getR
+00017300: 6573 706f 6e73 6528 292e 6765 7442 6f64  esponse().getBod
+00017310: 7928 293b 2720 2b0a 2020 2020 2020 2020  y();' +.        
+00017320: 2020 2020 2020 2020 2720 2020 2069 6620          '    if 
+00017330: 2869 203e 2030 2026 2620 6974 656d 2021  (i > 0 && item !
+00017340: 3d20 6920 2d20 3129 2074 6872 6f77 205c  = i - 1) throw \
+00017350: 2762 6f64 7920 6d69 736d 6174 6368 5c27  'body mismatch\'
+00017360: 3b27 202b 0a20 2020 2020 2020 2020 2020  ;' +.           
+00017370: 2020 2020 2027 2020 2020 6765 7443 6f6e       '    getCon
+00017380: 7465 7874 2829 2e67 6574 5265 7370 6f6e  text().getRespon
+00017390: 7365 2829 2e73 6574 426f 6479 2869 293b  se().setBody(i);
+000173a0: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
+000173b0: 2020 2020 2720 207d 2720 2b0a 2020 2020      '  }' +.    
+000173c0: 2020 2020 2020 2020 2020 2020 277d 2729              '}')
+000173d0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+000173e0: 2020 2020 7265 7472 6965 7665 645f 7370      retrieved_sp
+000173f0: 726f 6320 3d20 636f 6c6c 6563 7469 6f6e  roc = collection
+00017400: 2e73 6372 6970 7473 2e63 7265 6174 655f  .scripts.create_
+00017410: 7374 6f72 6564 5f70 726f 6365 6475 7265  stored_procedure
+00017420: 2862 6f64 793d 7370 726f 6331 290a 2020  (body=sproc1).  
+00017430: 2020 2020 2020 7265 7375 6c74 203d 2063        result = c
+00017440: 6f6c 6c65 6374 696f 6e2e 7363 7269 7074  ollection.script
+00017450: 732e 6578 6563 7574 655f 7374 6f72 6564  s.execute_stored
+00017460: 5f70 726f 6365 6475 7265 280a 2020 2020  _procedure(.    
+00017470: 2020 2020 2020 2020 7370 726f 633d 7265          sproc=re
+00017480: 7472 6965 7665 645f 7370 726f 635b 2769  trieved_sproc['i
+00017490: 6427 5d2c 0a20 2020 2020 2020 2020 2020  d'],.           
+000174a0: 2070 6172 7469 7469 6f6e 5f6b 6579 3d31   partition_key=1
+000174b0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+000174c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000174d0: 7561 6c28 7265 7375 6c74 2c20 3939 3929  ual(result, 999)
+000174e0: 0a20 2020 2020 2020 2073 7072 6f63 3220  .        sproc2 
+000174f0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00017500: 2769 6427 3a20 2773 746f 7265 6450 726f  'id': 'storedPro
+00017510: 6365 6475 7265 3227 202b 2073 7472 2875  cedure2' + str(u
+00017520: 7569 642e 7575 6964 3428 2929 2c0a 2020  uid.uuid4()),.  
+00017530: 2020 2020 2020 2020 2020 2762 6f64 7927            'body'
+00017540: 3a20 280a 2020 2020 2020 2020 2020 2020  : (.            
+00017550: 2020 2020 2766 756e 6374 696f 6e20 2829      'function ()
+00017560: 207b 2720 2b0a 2020 2020 2020 2020 2020   {' +.          
+00017570: 2020 2020 2020 2720 2066 6f72 2028 7661        '  for (va
+00017580: 7220 6920 3d20 303b 2069 203c 2031 303b  r i = 0; i < 10;
+00017590: 2069 2b2b 2920 7b27 202b 0a20 2020 2020   i++) {' +.     
+000175a0: 2020 2020 2020 2020 2020 2027 2020 2020             '    
+000175b0: 6765 7443 6f6e 7465 7874 2829 2e67 6574  getContext().get
+000175c0: 5265 7370 6f6e 7365 2829 2e61 7070 656e  Response().appen
+000175d0: 6456 616c 7565 285c 2742 6f64 795c 272c  dValue(\'Body\',
+000175e0: 2069 293b 2720 2b0a 2020 2020 2020 2020   i);' +.        
+000175f0: 2020 2020 2020 2020 2720 207d 2720 2b0a          '  }' +.
+00017600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017610: 277d 2729 0a20 2020 2020 2020 207d 0a20  '}').        }. 
+00017620: 2020 2020 2020 2072 6574 7269 6576 6564         retrieved
+00017630: 5f73 7072 6f63 3220 3d20 636f 6c6c 6563  _sproc2 = collec
+00017640: 7469 6f6e 2e73 6372 6970 7473 2e63 7265  tion.scripts.cre
+00017650: 6174 655f 7374 6f72 6564 5f70 726f 6365  ate_stored_proce
+00017660: 6475 7265 2862 6f64 793d 7370 726f 6332  dure(body=sproc2
+00017670: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
+00017680: 203d 2063 6f6c 6c65 6374 696f 6e2e 7363   = collection.sc
+00017690: 7269 7074 732e 6578 6563 7574 655f 7374  ripts.execute_st
+000176a0: 6f72 6564 5f70 726f 6365 6475 7265 280a  ored_procedure(.
+000176b0: 2020 2020 2020 2020 2020 2020 7370 726f              spro
+000176c0: 633d 7265 7472 6965 7665 645f 7370 726f  c=retrieved_spro
+000176d0: 6332 5b27 6964 275d 2c0a 2020 2020 2020  c2['id'],.      
+000176e0: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+000176f0: 6b65 793d 310a 2020 2020 2020 2020 290a  key=1.        ).
+00017700: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00017710: 6572 7445 7175 616c 2869 6e74 2872 6573  ertEqual(int(res
+00017720: 756c 7429 2c20 3132 3334 3536 3738 3929  ult), 123456789)
+00017730: 0a20 2020 2020 2020 2073 7072 6f63 3320  .        sproc3 
+00017740: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00017750: 2769 6427 3a20 2773 746f 7265 6450 726f  'id': 'storedPro
+00017760: 6365 6475 7265 3327 202b 2073 7472 2875  cedure3' + str(u
+00017770: 7569 642e 7575 6964 3428 2929 2c0a 2020  uid.uuid4()),.  
+00017780: 2020 2020 2020 2020 2020 2762 6f64 7927            'body'
+00017790: 3a20 280a 2020 2020 2020 2020 2020 2020  : (.            
+000177a0: 2020 2020 2766 756e 6374 696f 6e20 2869      'function (i
+000177b0: 6e70 7574 2920 7b27 202b 0a20 2020 2020  nput) {' +.     
+000177c0: 2020 2020 2020 2020 2020 2027 2020 6765             '  ge
+000177d0: 7443 6f6e 7465 7874 2829 2e67 6574 5265  tContext().getRe
+000177e0: 7370 6f6e 7365 2829 2e73 6574 426f 6479  sponse().setBody
+000177f0: 2827 202b 0a20 2020 2020 2020 2020 2020  (' +.           
+00017800: 2020 2020 2027 2020 2020 2020 5c27 615c       '      \'a\
+00017810: 2720 2b20 696e 7075 742e 7465 6d70 293b  ' + input.temp);
+00017820: 2720 2b0a 2020 2020 2020 2020 2020 2020  ' +.            
+00017830: 2020 2020 277d 2729 0a20 2020 2020 2020      '}').       
+00017840: 207d 0a20 2020 2020 2020 2072 6574 7269   }.        retri
+00017850: 6576 6564 5f73 7072 6f63 3320 3d20 636f  eved_sproc3 = co
+00017860: 6c6c 6563 7469 6f6e 2e73 6372 6970 7473  llection.scripts
+00017870: 2e63 7265 6174 655f 7374 6f72 6564 5f70  .create_stored_p
+00017880: 726f 6365 6475 7265 2862 6f64 793d 7370  rocedure(body=sp
+00017890: 726f 6333 290a 2020 2020 2020 2020 7265  roc3).        re
+000178a0: 7375 6c74 203d 2063 6f6c 6c65 6374 696f  sult = collectio
+000178b0: 6e2e 7363 7269 7074 732e 6578 6563 7574  n.scripts.execut
+000178c0: 655f 7374 6f72 6564 5f70 726f 6365 6475  e_stored_procedu
+000178d0: 7265 280a 2020 2020 2020 2020 2020 2020  re(.            
+000178e0: 7370 726f 633d 7265 7472 6965 7665 645f  sproc=retrieved_
+000178f0: 7370 726f 6333 5b27 6964 275d 2c0a 2020  sproc3['id'],.  
+00017900: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+00017910: 3d7b 2774 656d 7027 3a20 2773 6f27 7d2c  ={'temp': 'so'},
+00017920: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00017930: 7469 7469 6f6e 5f6b 6579 3d31 0a20 2020  tition_key=1.   
+00017940: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
+00017950: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00017960: 7265 7375 6c74 2c20 2761 736f 2729 0a0a  result, 'aso')..
+00017970: 2020 2020 6465 6620 5f5f 5661 6c69 6461      def __Valida
+00017980: 7465 4f66 6665 7252 6573 706f 6e73 6542  teOfferResponseB
+00017990: 6f64 7928 7365 6c66 2c20 6f66 6665 722c  ody(self, offer,
+000179a0: 2065 7870 6563 7465 645f 636f 6c6c 5f6c   expected_coll_l
+000179b0: 696e 6b2c 2065 7870 6563 7465 645f 6f66  ink, expected_of
+000179c0: 6665 725f 7479 7065 293a 0a20 2020 2020  fer_type):.     
+000179d0: 2020 2023 2074 7970 653a 2028 4f66 6665     # type: (Offe
+000179e0: 722c 2073 7472 2c20 416e 7929 202d 3e20  r, str, Any) -> 
+000179f0: 4e6f 6e65 0a20 2020 2020 2020 2073 656c  None.        sel
+00017a00: 662e 6173 7365 7274 4973 4e6f 744e 6f6e  f.assertIsNotNon
+00017a10: 6528 6f66 6665 722e 7072 6f70 6572 7469  e(offer.properti
+00017a20: 6573 5b27 6964 275d 2c20 2749 6420 6361  es['id'], 'Id ca
+00017a30: 6e6e 6f74 2062 6520 6e75 6c6c 2e27 290a  nnot be null.').
+00017a40: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00017a50: 6572 7449 734e 6f74 4e6f 6e65 286f 6666  ertIsNotNone(off
+00017a60: 6572 2e70 726f 7065 7274 6965 732e 6765  er.properties.ge
+00017a70: 7428 275f 7269 6427 292c 2027 5265 736f  t('_rid'), 'Reso
+00017a80: 7572 6365 2049 6420 2852 6964 2920 6361  urce Id (Rid) ca
+00017a90: 6e6e 6f74 2062 6520 6e75 6c6c 2e27 290a  nnot be null.').
+00017aa0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00017ab0: 6572 7449 734e 6f74 4e6f 6e65 286f 6666  ertIsNotNone(off
+00017ac0: 6572 2e70 726f 7065 7274 6965 732e 6765  er.properties.ge
+00017ad0: 7428 275f 7365 6c66 2729 2c20 2753 656c  t('_self'), 'Sel
+00017ae0: 6620 4c69 6e6b 2063 616e 6e6f 7420 6265  f Link cannot be
+00017af0: 206e 756c 6c2e 2729 0a20 2020 2020 2020   null.').       
+00017b00: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
+00017b10: 744e 6f6e 6528 6f66 6665 722e 7072 6f70  tNone(offer.prop
+00017b20: 6572 7469 6573 2e67 6574 2827 7265 736f  erties.get('reso
+00017b30: 7572 6365 2729 2c20 2752 6573 6f75 7263  urce'), 'Resourc
+00017b40: 6520 4c69 6e6b 2063 616e 6e6f 7420 6265  e Link cannot be
+00017b50: 206e 756c 6c2e 2729 0a20 2020 2020 2020   null.').       
+00017b60: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
+00017b70: 286f 6666 6572 2e70 726f 7065 7274 6965  (offer.propertie
+00017b80: 735b 275f 7365 6c66 275d 2e66 696e 6428  s['_self'].find(
+00017b90: 6f66 6665 722e 7072 6f70 6572 7469 6573  offer.properties
+00017ba0: 5b27 6964 275d 2920 213d 202d 312c 0a20  ['id']) != -1,. 
+00017bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017bc0: 2020 2020 2020 2027 4f66 6665 7220 6964         'Offer id
+00017bd0: 206e 6f74 2063 6f6e 7461 696e 6564 2069   not contained i
+00017be0: 6e20 6f66 6665 7220 7365 6c66 206c 696e  n offer self lin
+00017bf0: 6b2e 2729 0a20 2020 2020 2020 2073 656c  k.').        sel
+00017c00: 662e 6173 7365 7274 4571 7561 6c28 6578  f.assertEqual(ex
+00017c10: 7065 6374 6564 5f63 6f6c 6c5f 6c69 6e6b  pected_coll_link
+00017c20: 2e73 7472 6970 2827 2f27 292c 206f 6666  .strip('/'), off
+00017c30: 6572 2e70 726f 7065 7274 6965 735b 2772  er.properties['r
+00017c40: 6573 6f75 7263 6527 5d2e 7374 7269 7028  esource'].strip(
+00017c50: 272f 2729 290a 2020 2020 2020 2020 6966  '/')).        if
+00017c60: 2028 6578 7065 6374 6564 5f6f 6666 6572   (expected_offer
+00017c70: 5f74 7970 6529 3a0a 2020 2020 2020 2020  _type):.        
+00017c80: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00017c90: 7175 616c 2865 7870 6563 7465 645f 6f66  qual(expected_of
+00017ca0: 6665 725f 7479 7065 2c20 6f66 6665 722e  fer_type, offer.
+00017cb0: 7072 6f70 6572 7469 6573 2e67 6574 2827  properties.get('
+00017cc0: 6f66 6665 7254 7970 6527 2929 0a0a 2020  offerType'))..  
+00017cd0: 2020 6465 6620 7465 7374 5f6f 6666 6572    def test_offer
+00017ce0: 5f72 6561 645f 616e 645f 7175 6572 7928  _read_and_query(
+00017cf0: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
+00017d00: 2043 7265 6174 6520 6461 7461 6261 7365   Create database
+00017d10: 2e0a 2020 2020 2020 2020 6462 203d 2073  ..        db = s
+00017d20: 656c 662e 6461 7461 6261 7365 466f 7254  elf.databaseForT
+00017d30: 6573 740a 0a20 2020 2020 2020 2023 2043  est..        # C
+00017d40: 7265 6174 6520 636f 6c6c 6563 7469 6f6e  reate collection
+00017d50: 2e0a 2020 2020 2020 2020 636f 6c6c 6563  ..        collec
+00017d60: 7469 6f6e 203d 2064 622e 6372 6561 7465  tion = db.create
+00017d70: 5f63 6f6e 7461 696e 6572 280a 2020 2020  _container(.    
+00017d80: 2020 2020 2020 2020 6964 3d27 7465 7374          id='test
+00017d90: 5f6f 6666 6572 5f72 6561 645f 616e 645f  _offer_read_and_
+00017da0: 7175 6572 7920 2720 2b20 7374 7228 7575  query ' + str(uu
+00017db0: 6964 2e75 7569 6434 2829 292c 0a20 2020  id.uuid4()),.   
+00017dc0: 2020 2020 2020 2020 2070 6172 7469 7469           partiti
+00017dd0: 6f6e 5f6b 6579 3d50 6172 7469 7469 6f6e  on_key=Partition
+00017de0: 4b65 7928 7061 7468 3d27 2f69 6427 2c20  Key(path='/id', 
+00017df0: 6b69 6e64 3d27 4861 7368 2729 0a20 2020  kind='Hash').   
+00017e00: 2020 2020 2029 0a20 2020 2020 2020 2023       ).        #
+00017e10: 2052 6561 6420 7468 6520 6f66 6665 722e   Read the offer.
+00017e20: 0a20 2020 2020 2020 2065 7870 6563 7465  .        expecte
+00017e30: 645f 6f66 6665 7220 3d20 636f 6c6c 6563  d_offer = collec
+00017e40: 7469 6f6e 2e67 6574 5f74 6872 6f75 6768  tion.get_through
+00017e50: 7075 7428 290a 2020 2020 2020 2020 636f  put().        co
+00017e60: 6c6c 6563 7469 6f6e 5f70 726f 7065 7274  llection_propert
+00017e70: 6965 7320 3d20 636f 6c6c 6563 7469 6f6e  ies = collection
+00017e80: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
+00017e90: 7365 6c66 2e5f 5f56 616c 6964 6174 654f  self.__ValidateO
+00017ea0: 6666 6572 5265 7370 6f6e 7365 426f 6479  fferResponseBody
+00017eb0: 2865 7870 6563 7465 645f 6f66 6665 722c  (expected_offer,
+00017ec0: 2063 6f6c 6c65 6374 696f 6e5f 7072 6f70   collection_prop
+00017ed0: 6572 7469 6573 2e67 6574 2827 5f73 656c  erties.get('_sel
+00017ee0: 6627 292c 204e 6f6e 6529 0a0a 2020 2020  f'), None)..    
+00017ef0: 2020 2020 2320 4e6f 7720 6465 6c65 7465      # Now delete
+00017f00: 2074 6865 2063 6f6c 6c65 6374 696f 6e2e   the collection.
+00017f10: 0a20 2020 2020 2020 2064 622e 6465 6c65  .        db.dele
+00017f20: 7465 5f63 6f6e 7461 696e 6572 2863 6f6e  te_container(con
+00017f30: 7461 696e 6572 3d63 6f6c 6c65 6374 696f  tainer=collectio
+00017f40: 6e29 0a20 2020 2020 2020 2023 2052 6561  n).        # Rea
+00017f50: 6469 6e67 2066 6169 6c73 2e0a 2020 2020  ding fails..    
+00017f60: 2020 2020 7365 6c66 2e5f 5f41 7373 6572      self.__Asser
+00017f70: 7448 5454 5046 6169 6c75 7265 5769 7468  tHTTPFailureWith
+00017f80: 5374 6174 7573 2853 7461 7475 7343 6f64  Status(StatusCod
+00017f90: 6573 2e4e 4f54 5f46 4f55 4e44 2c20 636f  es.NOT_FOUND, co
+00017fa0: 6c6c 6563 7469 6f6e 2e67 6574 5f74 6872  llection.get_thr
+00017fb0: 6f75 6768 7075 7429 0a0a 2020 2020 6465  oughput)..    de
+00017fc0: 6620 7465 7374 5f6f 6666 6572 5f72 6570  f test_offer_rep
+00017fd0: 6c61 6365 2873 656c 6629 3a0a 2020 2020  lace(self):.    
+00017fe0: 2020 2020 2320 4372 6561 7465 2064 6174      # Create dat
+00017ff0: 6162 6173 652e 0a20 2020 2020 2020 2064  abase..        d
+00018000: 6220 3d20 7365 6c66 2e64 6174 6162 6173  b = self.databas
+00018010: 6546 6f72 5465 7374 0a20 2020 2020 2020  eForTest.       
+00018020: 2023 2043 7265 6174 6520 636f 6c6c 6563   # Create collec
+00018030: 7469 6f6e 2e0a 2020 2020 2020 2020 636f  tion..        co
+00018040: 6c6c 6563 7469 6f6e 203d 2073 656c 662e  llection = self.
+00018050: 636f 6e66 6967 732e 6372 6561 7465 5f6d  configs.create_m
+00018060: 756c 7469 5f70 6172 7469 7469 6f6e 5f63  ulti_partition_c
+00018070: 6f6c 6c65 6374 696f 6e5f 6966 5f6e 6f74  ollection_if_not
+00018080: 5f65 7869 7374 2873 656c 662e 636c 6965  _exist(self.clie
+00018090: 6e74 290a 2020 2020 2020 2020 2320 5265  nt).        # Re
+000180a0: 6164 204f 6666 6572 0a20 2020 2020 2020  ad Offer.       
+000180b0: 2065 7870 6563 7465 645f 6f66 6665 7220   expected_offer 
+000180c0: 3d20 636f 6c6c 6563 7469 6f6e 2e67 6574  = collection.get
+000180d0: 5f74 6872 6f75 6768 7075 7428 290a 2020  _throughput().  
+000180e0: 2020 2020 2020 636f 6c6c 6563 7469 6f6e        collection
+000180f0: 5f70 726f 7065 7274 6965 7320 3d20 636f  _properties = co
+00018100: 6c6c 6563 7469 6f6e 2e72 6561 6428 290a  llection.read().
+00018110: 2020 2020 2020 2020 7365 6c66 2e5f 5f56          self.__V
+00018120: 616c 6964 6174 654f 6666 6572 5265 7370  alidateOfferResp
+00018130: 6f6e 7365 426f 6479 2865 7870 6563 7465  onseBody(expecte
+00018140: 645f 6f66 6665 722c 2063 6f6c 6c65 6374  d_offer, collect
+00018150: 696f 6e5f 7072 6f70 6572 7469 6573 2e67  ion_properties.g
+00018160: 6574 2827 5f73 656c 6627 292c 204e 6f6e  et('_self'), Non
+00018170: 6529 0a20 2020 2020 2020 2023 2052 6570  e).        # Rep
+00018180: 6c61 6365 2074 6865 206f 6666 6572 2e0a  lace the offer..
+00018190: 2020 2020 2020 2020 7265 706c 6163 6564          replaced
+000181a0: 5f6f 6666 6572 203d 2063 6f6c 6c65 6374  _offer = collect
+000181b0: 696f 6e2e 7265 706c 6163 655f 7468 726f  ion.replace_thro
+000181c0: 7567 6870 7574 2865 7870 6563 7465 645f  ughput(expected_
+000181d0: 6f66 6665 722e 6f66 6665 725f 7468 726f  offer.offer_thro
+000181e0: 7567 6870 7574 202b 2031 3030 290a 2020  ughput + 100).  
+000181f0: 2020 2020 2020 636f 6c6c 6563 7469 6f6e        collection
+00018200: 5f70 726f 7065 7274 6965 7320 3d20 636f  _properties = co
+00018210: 6c6c 6563 7469 6f6e 2e72 6561 6428 290a  llection.read().
+00018220: 2020 2020 2020 2020 7365 6c66 2e5f 5f56          self.__V
+00018230: 616c 6964 6174 654f 6666 6572 5265 7370  alidateOfferResp
+00018240: 6f6e 7365 426f 6479 2872 6570 6c61 6365  onseBody(replace
+00018250: 645f 6f66 6665 722c 2063 6f6c 6c65 6374  d_offer, collect
+00018260: 696f 6e5f 7072 6f70 6572 7469 6573 2e67  ion_properties.g
+00018270: 6574 2827 5f73 656c 6627 292c 204e 6f6e  et('_self'), Non
+00018280: 6529 0a20 2020 2020 2020 2023 2043 6865  e).        # Che
+00018290: 636b 2069 6620 7468 6520 7265 706c 6163  ck if the replac
+000182a0: 6564 206f 6666 6572 2069 7320 7768 6174  ed offer is what
+000182b0: 2077 6520 6578 7065 6374 2e0a 2020 2020   we expect..    
+000182c0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000182d0: 7175 616c 2865 7870 6563 7465 645f 6f66  qual(expected_of
+000182e0: 6665 722e 7072 6f70 6572 7469 6573 2e67  fer.properties.g
+000182f0: 6574 2827 636f 6e74 656e 7427 292e 6765  et('content').ge
+00018300: 7428 276f 6666 6572 5468 726f 7567 6870  t('offerThroughp
+00018310: 7574 2729 202b 2031 3030 2c0a 2020 2020  ut') + 100,.    
+00018320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018330: 2020 2020 2072 6570 6c61 6365 645f 6f66       replaced_of
+00018340: 6665 722e 7072 6f70 6572 7469 6573 2e67  fer.properties.g
+00018350: 6574 2827 636f 6e74 656e 7427 292e 6765  et('content').ge
+00018360: 7428 276f 6666 6572 5468 726f 7567 6870  t('offerThroughp
+00018370: 7574 2729 290a 2020 2020 2020 2020 7365  ut')).        se
+00018380: 6c66 2e61 7373 6572 7445 7175 616c 2865  lf.assertEqual(e
+00018390: 7870 6563 7465 645f 6f66 6665 722e 6f66  xpected_offer.of
+000183a0: 6665 725f 7468 726f 7567 6870 7574 202b  fer_throughput +
+000183b0: 2031 3030 2c0a 2020 2020 2020 2020 2020   100,.          
+000183c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000183d0: 6570 6c61 6365 645f 6f66 6665 722e 6f66  eplaced_offer.of
+000183e0: 6665 725f 7468 726f 7567 6870 7574 290a  fer_throughput).
+000183f0: 0a20 2020 2064 6566 2074 6573 745f 6461  .    def test_da
+00018400: 7461 6261 7365 5f61 6363 6f75 6e74 5f66  tabase_account_f
+00018410: 756e 6374 696f 6e61 6c69 7479 2873 656c  unctionality(sel
+00018420: 6629 3a0a 2020 2020 2020 2020 2320 5661  f):.        # Va
+00018430: 6c69 6461 7465 2064 6174 6162 6173 6520  lidate database 
+00018440: 6163 636f 756e 7420 6675 6e63 7469 6f6e  account function
+00018450: 616c 6974 792e 0a20 2020 2020 2020 2064  ality..        d
+00018460: 6174 6162 6173 655f 6163 636f 756e 7420  atabase_account 
+00018470: 3d20 7365 6c66 2e63 6c69 656e 742e 6765  = self.client.ge
+00018480: 745f 6461 7461 6261 7365 5f61 6363 6f75  t_database_accou
+00018490: 6e74 2829 0a20 2020 2020 2020 2073 656c  nt().        sel
+000184a0: 662e 6173 7365 7274 4571 7561 6c28 6461  f.assertEqual(da
+000184b0: 7461 6261 7365 5f61 6363 6f75 6e74 2e44  tabase_account.D
+000184c0: 6174 6162 6173 6573 4c69 6e6b 2c20 272f  atabasesLink, '/
+000184d0: 6462 732f 2729 0a20 2020 2020 2020 2073  dbs/').        s
+000184e0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000184f0: 6461 7461 6261 7365 5f61 6363 6f75 6e74  database_account
+00018500: 2e4d 6564 6961 4c69 6e6b 2c20 272f 6d65  .MediaLink, '/me
+00018510: 6469 612f 2729 0a20 2020 2020 2020 2069  dia/').        i
+00018520: 6620 2848 7474 7048 6561 6465 7273 2e4d  f (HttpHeaders.M
+00018530: 6178 4d65 6469 6153 746f 7261 6765 5573  axMediaStorageUs
+00018540: 6167 6549 6e4d 4220 696e 0a20 2020 2020  ageInMB in.     
+00018550: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018560: 636c 6965 6e74 2e63 6c69 656e 745f 636f  client.client_co
+00018570: 6e6e 6563 7469 6f6e 2e6c 6173 745f 7265  nnection.last_re
+00018580: 7370 6f6e 7365 5f68 6561 6465 7273 293a  sponse_headers):
+00018590: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000185a0: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+000185b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000185c0: 6174 6162 6173 655f 6163 636f 756e 742e  atabase_account.
+000185d0: 4d61 784d 6564 6961 5374 6f72 6167 6555  MaxMediaStorageU
+000185e0: 7361 6765 496e 4d42 2c0a 2020 2020 2020  sageInMB,.      
+000185f0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+00018600: 6c69 656e 742e 636c 6965 6e74 5f63 6f6e  lient.client_con
+00018610: 6e65 6374 696f 6e2e 6c61 7374 5f72 6573  nection.last_res
+00018620: 706f 6e73 655f 6865 6164 6572 735b 0a20  ponse_headers[. 
+00018630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018640: 2020 2048 7474 7048 6561 6465 7273 2e4d     HttpHeaders.M
+00018650: 6178 4d65 6469 6153 746f 7261 6765 5573  axMediaStorageUs
+00018660: 6167 6549 6e4d 425d 290a 2020 2020 2020  ageInMB]).      
+00018670: 2020 6966 2028 4874 7470 4865 6164 6572    if (HttpHeader
+00018680: 732e 4375 7272 656e 744d 6564 6961 5374  s.CurrentMediaSt
+00018690: 6f72 6167 6555 7361 6765 496e 4d42 2069  orageUsageInMB i
+000186a0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+000186b0: 2020 7365 6c66 2e63 6c69 656e 742e 636c    self.client.cl
+000186c0: 6965 6e74 5f63 6f6e 6e65 6374 696f 6e2e  ient_connection.
+000186d0: 6c61 7374 5f72 6573 706f 6e73 655f 6865  last_response_he
+000186e0: 6164 6572 7329 3a0a 2020 2020 2020 2020  aders):.        
+000186f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00018700: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
+00018710: 2020 2020 2020 6461 7461 6261 7365 5f61        database_a
+00018720: 6363 6f75 6e74 2e43 7572 7265 6e74 4d65  ccount.CurrentMe
+00018730: 6469 6153 746f 7261 6765 5573 6167 6549  diaStorageUsageI
+00018740: 6e4d 422c 0a20 2020 2020 2020 2020 2020  nMB,.           
+00018750: 2020 2020 2073 656c 662e 636c 6965 6e74       self.client
+00018760: 2e63 6c69 656e 745f 636f 6e6e 6563 7469  .client_connecti
+00018770: 6f6e 2e6c 6173 745f 7265 7370 6f6e 7365  on.last_response
+00018780: 5f68 6561 6465 7273 5b0a 2020 2020 2020  _headers[.      
+00018790: 2020 2020 2020 2020 2020 2020 2020 4874                Ht
+000187a0: 7470 4865 6164 6572 732e 4375 7272 656e  tpHeaders.Curren
+000187b0: 744d 6564 6961 5374 6f72 6167 6555 7361  tMediaStorageUsa
+000187c0: 6765 496e 4d42 5d29 0a20 2020 2020 2020  geInMB]).       
+000187d0: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
+000187e0: 744e 6f6e 6528 6461 7461 6261 7365 5f61  tNone(database_a
+000187f0: 6363 6f75 6e74 2e43 6f6e 7369 7374 656e  ccount.Consisten
+00018800: 6379 506f 6c69 6379 5b27 6465 6661 756c  cyPolicy['defaul
+00018810: 7443 6f6e 7369 7374 656e 6379 4c65 7665  tConsistencyLeve
+00018820: 6c27 5d29 0a0a 2020 2020 6465 6620 7465  l'])..    def te
+00018830: 7374 5f69 6e64 6578 5f70 726f 6772 6573  st_index_progres
+00018840: 735f 6865 6164 6572 7328 7365 6c66 293a  s_headers(self):
+00018850: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+00018860: 5f64 6220 3d20 7365 6c66 2e64 6174 6162  _db = self.datab
+00018870: 6173 6546 6f72 5465 7374 0a20 2020 2020  aseForTest.     
+00018880: 2020 2063 6f6e 7369 7374 656e 745f 636f     consistent_co
+00018890: 6c6c 203d 2063 7265 6174 6564 5f64 622e  ll = created_db.
+000188a0: 6372 6561 7465 5f63 6f6e 7461 696e 6572  create_container
+000188b0: 280a 2020 2020 2020 2020 2020 2020 6964  (.            id
+000188c0: 3d27 7465 7374 5f69 6e64 6578 5f70 726f  ='test_index_pro
+000188d0: 6772 6573 735f 6865 6164 6572 7320 636f  gress_headers co
+000188e0: 6e73 6973 7465 6e74 5f63 6f6c 6c20 2720  nsistent_coll ' 
+000188f0: 2b20 7374 7228 7575 6964 2e75 7569 6434  + str(uuid.uuid4
+00018900: 2829 292c 0a20 2020 2020 2020 2020 2020  ()),.           
+00018910: 2070 6172 7469 7469 6f6e 5f6b 6579 3d50   partition_key=P
+00018920: 6172 7469 7469 6f6e 4b65 7928 7061 7468  artitionKey(path
+00018930: 3d22 2f69 6422 2c20 6b69 6e64 3d27 4861  ="/id", kind='Ha
+00018940: 7368 2729 2c0a 2020 2020 2020 2020 290a  sh'),.        ).
+00018950: 2020 2020 2020 2020 6372 6561 7465 645f          created_
+00018960: 636f 6e74 6169 6e65 7220 3d20 6372 6561  container = crea
+00018970: 7465 645f 6462 2e67 6574 5f63 6f6e 7461  ted_db.get_conta
+00018980: 696e 6572 5f63 6c69 656e 7428 636f 6e74  iner_client(cont
+00018990: 6169 6e65 723d 636f 6e73 6973 7465 6e74  ainer=consistent
+000189a0: 5f63 6f6c 6c29 0a20 2020 2020 2020 2063  _coll).        c
+000189b0: 7265 6174 6564 5f63 6f6e 7461 696e 6572  reated_container
+000189c0: 2e72 6561 6428 706f 7075 6c61 7465 5f71  .read(populate_q
+000189d0: 756f 7461 5f69 6e66 6f3d 5472 7565 290a  uota_info=True).
+000189e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000189f0: 6572 7446 616c 7365 2848 7474 7048 6561  ertFalse(HttpHea
+00018a00: 6465 7273 2e4c 617a 7949 6e64 6578 696e  ders.LazyIndexin
+00018a10: 6750 726f 6772 6573 7320 696e 2063 7265  gProgress in cre
+00018a20: 6174 6564 5f64 622e 636c 6965 6e74 5f63  ated_db.client_c
+00018a30: 6f6e 6e65 6374 696f 6e2e 6c61 7374 5f72  onnection.last_r
+00018a40: 6573 706f 6e73 655f 6865 6164 6572 7329  esponse_headers)
+00018a50: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00018a60: 7365 7274 5472 7565 2848 7474 7048 6561  sertTrue(HttpHea
+00018a70: 6465 7273 2e49 6e64 6578 5472 616e 7366  ders.IndexTransf
+00018a80: 6f72 6d61 7469 6f6e 5072 6f67 7265 7373  ormationProgress
+00018a90: 2069 6e20 6372 6561 7465 645f 6462 2e63   in created_db.c
+00018aa0: 6c69 656e 745f 636f 6e6e 6563 7469 6f6e  lient_connection
+00018ab0: 2e6c 6173 745f 7265 7370 6f6e 7365 5f68  .last_response_h
+00018ac0: 6561 6465 7273 290a 0a20 2020 2020 2020  eaders)..       
+00018ad0: 206e 6f6e 655f 636f 6c6c 203d 2063 7265   none_coll = cre
+00018ae0: 6174 6564 5f64 622e 6372 6561 7465 5f63  ated_db.create_c
+00018af0: 6f6e 7461 696e 6572 280a 2020 2020 2020  ontainer(.      
+00018b00: 2020 2020 2020 6964 3d27 7465 7374 5f69        id='test_i
+00018b10: 6e64 6578 5f70 726f 6772 6573 735f 6865  ndex_progress_he
+00018b20: 6164 6572 7320 6e6f 6e65 5f63 6f6c 6c20  aders none_coll 
+00018b30: 2720 2b20 7374 7228 7575 6964 2e75 7569  ' + str(uuid.uui
+00018b40: 6434 2829 292c 0a20 2020 2020 2020 2020  d4()),.         
+00018b50: 2020 2069 6e64 6578 696e 675f 706f 6c69     indexing_poli
+00018b60: 6379 3d7b 0a20 2020 2020 2020 2020 2020  cy={.           
+00018b70: 2020 2020 2027 696e 6465 7869 6e67 4d6f       'indexingMo
+00018b80: 6465 273a 2064 6f63 756d 656e 7473 2e49  de': documents.I
+00018b90: 6e64 6578 696e 674d 6f64 652e 4e6f 496e  ndexingMode.NoIn
+00018ba0: 6465 782c 0a20 2020 2020 2020 2020 2020  dex,.           
+00018bb0: 2020 2020 2027 6175 746f 6d61 7469 6327       'automatic'
+00018bc0: 3a20 4661 6c73 650a 2020 2020 2020 2020  : False.        
+00018bd0: 2020 2020 7d2c 0a20 2020 2020 2020 2020      },.         
+00018be0: 2020 2070 6172 7469 7469 6f6e 5f6b 6579     partition_key
+00018bf0: 3d50 6172 7469 7469 6f6e 4b65 7928 7061  =PartitionKey(pa
+00018c00: 7468 3d22 2f69 6422 2c20 6b69 6e64 3d27  th="/id", kind='
+00018c10: 4861 7368 2729 0a20 2020 2020 2020 2029  Hash').        )
+00018c20: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+00018c30: 5f63 6f6e 7461 696e 6572 203d 2063 7265  _container = cre
+00018c40: 6174 6564 5f64 622e 6765 745f 636f 6e74  ated_db.get_cont
+00018c50: 6169 6e65 725f 636c 6965 6e74 2863 6f6e  ainer_client(con
+00018c60: 7461 696e 6572 3d6e 6f6e 655f 636f 6c6c  tainer=none_coll
+00018c70: 290a 2020 2020 2020 2020 6372 6561 7465  ).        create
+00018c80: 645f 636f 6e74 6169 6e65 722e 7265 6164  d_container.read
+00018c90: 2870 6f70 756c 6174 655f 7175 6f74 615f  (populate_quota_
+00018ca0: 696e 666f 3d54 7275 6529 0a20 2020 2020  info=True).     
+00018cb0: 2020 2073 656c 662e 6173 7365 7274 4661     self.assertFa
+00018cc0: 6c73 6528 4874 7470 4865 6164 6572 732e  lse(HttpHeaders.
+00018cd0: 4c61 7a79 496e 6465 7869 6e67 5072 6f67  LazyIndexingProg
+00018ce0: 7265 7373 2069 6e20 6372 6561 7465 645f  ress in created_
+00018cf0: 6462 2e63 6c69 656e 745f 636f 6e6e 6563  db.client_connec
+00018d00: 7469 6f6e 2e6c 6173 745f 7265 7370 6f6e  tion.last_respon
+00018d10: 7365 5f68 6561 6465 7273 290a 2020 2020  se_headers).    
+00018d20: 2020 2020 7365 6c66 2e61 7373 6572 7454      self.assertT
+00018d30: 7275 6528 4874 7470 4865 6164 6572 732e  rue(HttpHeaders.
+00018d40: 496e 6465 7854 7261 6e73 666f 726d 6174  IndexTransformat
+00018d50: 696f 6e50 726f 6772 6573 7320 696e 2063  ionProgress in c
+00018d60: 7265 6174 6564 5f64 622e 636c 6965 6e74  reated_db.client
+00018d70: 5f63 6f6e 6e65 6374 696f 6e2e 6c61 7374  _connection.last
+00018d80: 5f72 6573 706f 6e73 655f 6865 6164 6572  _response_header
+00018d90: 7329 0a0a 2020 2020 2020 2020 6372 6561  s)..        crea
+00018da0: 7465 645f 6462 2e64 656c 6574 655f 636f  ted_db.delete_co
+00018db0: 6e74 6169 6e65 7228 636f 6e73 6973 7465  ntainer(consiste
+00018dc0: 6e74 5f63 6f6c 6c29 0a20 2020 2020 2020  nt_coll).       
+00018dd0: 2063 7265 6174 6564 5f64 622e 6465 6c65   created_db.dele
+00018de0: 7465 5f63 6f6e 7461 696e 6572 286e 6f6e  te_container(non
+00018df0: 655f 636f 6c6c 290a 0a20 2020 2064 6566  e_coll)..    def
+00018e00: 2074 6573 745f 6964 5f76 616c 6964 6174   test_id_validat
+00018e10: 696f 6e28 7365 6c66 293a 0a20 2020 2020  ion(self):.     
+00018e20: 2020 2023 2049 6420 7368 6f75 6c64 6e27     # Id shouldn'
+00018e30: 7420 656e 6420 7769 7468 2073 7061 6365  t end with space
+00018e40: 2e0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+00018e50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018e60: 636c 6965 6e74 2e63 7265 6174 655f 6461  client.create_da
+00018e70: 7461 6261 7365 2869 643d 2769 645f 7769  tabase(id='id_wi
+00018e80: 7468 5f73 7061 6365 2027 290a 2020 2020  th_space ').    
+00018e90: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00018ea0: 6572 7446 616c 7365 2854 7275 6529 0a20  ertFalse(True). 
+00018eb0: 2020 2020 2020 2065 7863 6570 7420 5661         except Va
+00018ec0: 6c75 6545 7272 6f72 2061 7320 653a 0a20  lueError as e:. 
+00018ed0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018ee0: 6173 7365 7274 4571 7561 6c28 2749 6420  assertEqual('Id 
+00018ef0: 656e 6473 2077 6974 6820 6120 7370 6163  ends with a spac
+00018f00: 652e 272c 2065 2e61 7267 735b 305d 290a  e.', e.args[0]).
+00018f10: 2020 2020 2020 2020 2320 4964 2073 686f          # Id sho
+00018f20: 756c 646e 2774 2063 6f6e 7461 696e 2027  uldn't contain '
+00018f30: 2f27 2e0a 0a20 2020 2020 2020 2074 7279  /'...        try
+00018f40: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00018f50: 6c66 2e63 6c69 656e 742e 6372 6561 7465  lf.client.create
+00018f60: 5f64 6174 6162 6173 6528 6964 3d27 6964  _database(id='id
+00018f70: 5f77 6974 685f 696c 6c65 6761 6c2f 5f63  _with_illegal/_c
+00018f80: 6861 7227 290a 2020 2020 2020 2020 2020  har').          
+00018f90: 2020 7365 6c66 2e61 7373 6572 7446 616c    self.assertFal
+00018fa0: 7365 2854 7275 6529 0a20 2020 2020 2020  se(True).       
+00018fb0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
+00018fc0: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
+00018fd0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00018fe0: 4571 7561 6c28 2749 6420 636f 6e74 6169  Equal('Id contai
+00018ff0: 6e73 2069 6c6c 6567 616c 2063 6861 7273  ns illegal chars
+00019000: 2e27 2c20 652e 6172 6773 5b30 5d29 0a20  .', e.args[0]). 
+00019010: 2020 2020 2020 2023 2049 6420 7368 6f75         # Id shou
+00019020: 6c64 6e27 7420 636f 6e74 6169 6e20 275c  ldn't contain '\
+00019030: 5c27 2e0a 0a20 2020 2020 2020 2074 7279  \'...        try
+00019040: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00019050: 6c66 2e63 6c69 656e 742e 6372 6561 7465  lf.client.create
+00019060: 5f64 6174 6162 6173 6528 6964 3d27 6964  _database(id='id
+00019070: 5f77 6974 685f 696c 6c65 6761 6c5c 5c5f  _with_illegal\\_
+00019080: 6368 6172 2729 0a20 2020 2020 2020 2020  char').         
+00019090: 2020 2073 656c 662e 6173 7365 7274 4661     self.assertFa
+000190a0: 6c73 6528 5472 7565 290a 2020 2020 2020  lse(True).      
+000190b0: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
+000190c0: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+000190d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000190e0: 7445 7175 616c 2827 4964 2063 6f6e 7461  tEqual('Id conta
+000190f0: 696e 7320 696c 6c65 6761 6c20 6368 6172  ins illegal char
+00019100: 732e 272c 2065 2e61 7267 735b 305d 290a  s.', e.args[0]).
+00019110: 2020 2020 2020 2020 2320 4964 2073 686f          # Id sho
+00019120: 756c 646e 2774 2063 6f6e 7461 696e 2027  uldn't contain '
+00019130: 3f27 2e0a 0a20 2020 2020 2020 2074 7279  ?'...        try
+00019140: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00019150: 6c66 2e63 6c69 656e 742e 6372 6561 7465  lf.client.create
+00019160: 5f64 6174 6162 6173 6528 6964 3d27 6964  _database(id='id
+00019170: 5f77 6974 685f 696c 6c65 6761 6c3f 5f63  _with_illegal?_c
+00019180: 6861 7227 290a 2020 2020 2020 2020 2020  har').          
+00019190: 2020 7365 6c66 2e61 7373 6572 7446 616c    self.assertFal
+000191a0: 7365 2854 7275 6529 0a20 2020 2020 2020  se(True).       
+000191b0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
+000191c0: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
+000191d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000191e0: 4571 7561 6c28 2749 6420 636f 6e74 6169  Equal('Id contai
+000191f0: 6e73 2069 6c6c 6567 616c 2063 6861 7273  ns illegal chars
+00019200: 2e27 2c20 652e 6172 6773 5b30 5d29 0a20  .', e.args[0]). 
+00019210: 2020 2020 2020 2023 2049 6420 7368 6f75         # Id shou
+00019220: 6c64 6e27 7420 636f 6e74 6169 6e20 2723  ldn't contain '#
+00019230: 272e 0a0a 2020 2020 2020 2020 7472 793a  '...        try:
+00019240: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00019250: 662e 636c 6965 6e74 2e63 7265 6174 655f  f.client.create_
+00019260: 6461 7461 6261 7365 2869 643d 2769 645f  database(id='id_
+00019270: 7769 7468 5f69 6c6c 6567 616c 235f 6368  with_illegal#_ch
+00019280: 6172 2729 0a20 2020 2020 2020 2020 2020  ar').           
+00019290: 2073 656c 662e 6173 7365 7274 4661 6c73   self.assertFals
+000192a0: 6528 5472 7565 290a 2020 2020 2020 2020  e(True).        
+000192b0: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
+000192c0: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+000192d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000192e0: 7175 616c 2827 4964 2063 6f6e 7461 696e  qual('Id contain
+000192f0: 7320 696c 6c65 6761 6c20 6368 6172 732e  s illegal chars.
+00019300: 272c 2065 2e61 7267 735b 305d 290a 0a20  ', e.args[0]).. 
+00019310: 2020 2020 2020 2023 2049 6420 6361 6e20         # Id can 
+00019320: 6265 6769 6e20 7769 7468 2073 7061 6365  begin with space
+00019330: 0a20 2020 2020 2020 2064 6220 3d20 7365  .        db = se
+00019340: 6c66 2e63 6c69 656e 742e 6372 6561 7465  lf.client.create
+00019350: 5f64 6174 6162 6173 6528 6964 3d27 2069  _database(id=' i
+00019360: 645f 6265 6769 6e5f 7370 6163 6527 290a  d_begin_space').
+00019370: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00019380: 6572 7454 7275 6528 5472 7565 290a 0a20  ertTrue(True).. 
+00019390: 2020 2020 2020 2073 656c 662e 636c 6965         self.clie
+000193a0: 6e74 2e64 656c 6574 655f 6461 7461 6261  nt.delete_databa
+000193b0: 7365 2864 6174 6162 6173 653d 6462 290a  se(database=db).
+000193c0: 0a20 2020 2064 6566 2074 6573 745f 6964  .    def test_id
+000193d0: 5f63 6173 655f 7661 6c69 6461 7469 6f6e  _case_validation
+000193e0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000193f0: 2320 6372 6561 7465 2064 6174 6162 6173  # create databas
+00019400: 650a 2020 2020 2020 2020 6372 6561 7465  e.        create
+00019410: 645f 6462 203d 2073 656c 662e 6461 7461  d_db = self.data
+00019420: 6261 7365 466f 7254 6573 740a 0a20 2020  baseForTest..   
+00019430: 2020 2020 2075 7569 645f 7374 7269 6e67       uuid_string
+00019440: 203d 2073 7472 2875 7569 642e 7575 6964   = str(uuid.uuid
+00019450: 3428 2929 0a20 2020 2020 2020 2063 6f6c  4()).        col
+00019460: 6c65 6374 696f 6e5f 6964 3120 3d20 2773  lection_id1 = 's
+00019470: 616d 706c 6543 6f6c 6c65 6374 696f 6e20  ampleCollection 
+00019480: 2720 2b20 7575 6964 5f73 7472 696e 670a  ' + uuid_string.
+00019490: 2020 2020 2020 2020 636f 6c6c 6563 7469          collecti
+000194a0: 6f6e 5f69 6432 203d 2027 5361 6d70 6c65  on_id2 = 'Sample
+000194b0: 436f 6c6c 6563 7469 6f6e 2027 202b 2075  Collection ' + u
+000194c0: 7569 645f 7374 7269 6e67 0a0a 2020 2020  uid_string..    
+000194d0: 2020 2020 2320 5665 7269 6679 2074 6861      # Verify tha
+000194e0: 7420 6e6f 2063 6f6c 6c65 6374 696f 6e73  t no collections
+000194f0: 2065 7869 7374 0a20 2020 2020 2020 2063   exist.        c
+00019500: 6f6c 6c65 6374 696f 6e73 203d 206c 6973  ollections = lis
+00019510: 7428 6372 6561 7465 645f 6462 2e6c 6973  t(created_db.lis
+00019520: 745f 636f 6e74 6169 6e65 7273 2829 290a  t_containers()).
+00019530: 2020 2020 2020 2020 6e75 6d62 6572 5f6f          number_o
+00019540: 665f 6578 6973 7469 6e67 5f63 6f6c 6c65  f_existing_colle
+00019550: 6374 696f 6e73 203d 206c 656e 2863 6f6c  ctions = len(col
+00019560: 6c65 6374 696f 6e73 290a 0a20 2020 2020  lections)..     
+00019570: 2020 2023 2063 7265 6174 6520 3220 636f     # create 2 co
+00019580: 6c6c 6563 7469 6f6e 7320 7769 7468 2064  llections with d
+00019590: 6966 6665 7265 6e74 2063 6173 696e 6720  ifferent casing 
+000195a0: 6f66 2049 4473 0a20 2020 2020 2020 2023  of IDs.        #
+000195b0: 2070 6173 6361 6c43 6173 650a 2020 2020   pascalCase.    
+000195c0: 2020 2020 6372 6561 7465 645f 636f 6c6c      created_coll
+000195d0: 6563 7469 6f6e 3120 3d20 6372 6561 7465  ection1 = create
+000195e0: 645f 6462 2e63 7265 6174 655f 636f 6e74  d_db.create_cont
+000195f0: 6169 6e65 7228 0a20 2020 2020 2020 2020  ainer(.         
+00019600: 2020 2069 643d 636f 6c6c 6563 7469 6f6e     id=collection
+00019610: 5f69 6431 2c0a 2020 2020 2020 2020 2020  _id1,.          
+00019620: 2020 7061 7274 6974 696f 6e5f 6b65 793d    partition_key=
+00019630: 5061 7274 6974 696f 6e4b 6579 2870 6174  PartitionKey(pat
+00019640: 683d 272f 6964 272c 206b 696e 643d 2748  h='/id', kind='H
+00019650: 6173 6827 290a 2020 2020 2020 2020 290a  ash').        ).
+00019660: 0a20 2020 2020 2020 2023 2043 616d 656c  .        # Camel
+00019670: 4361 7365 0a20 2020 2020 2020 2063 7265  Case.        cre
+00019680: 6174 6564 5f63 6f6c 6c65 6374 696f 6e32  ated_collection2
+00019690: 203d 2063 7265 6174 6564 5f64 622e 6372   = created_db.cr
+000196a0: 6561 7465 5f63 6f6e 7461 696e 6572 280a  eate_container(.
+000196b0: 2020 2020 2020 2020 2020 2020 6964 3d63              id=c
+000196c0: 6f6c 6c65 6374 696f 6e5f 6964 322c 0a20  ollection_id2,. 
+000196d0: 2020 2020 2020 2020 2020 2070 6172 7469             parti
+000196e0: 7469 6f6e 5f6b 6579 3d50 6172 7469 7469  tion_key=Partiti
+000196f0: 6f6e 4b65 7928 7061 7468 3d27 2f69 6427  onKey(path='/id'
+00019700: 2c20 6b69 6e64 3d27 4861 7368 2729 0a20  , kind='Hash'). 
+00019710: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00019720: 2020 636f 6c6c 6563 7469 6f6e 7320 3d20    collections = 
+00019730: 6c69 7374 2863 7265 6174 6564 5f64 622e  list(created_db.
+00019740: 6c69 7374 5f63 6f6e 7461 696e 6572 7328  list_containers(
+00019750: 2929 0a0a 2020 2020 2020 2020 2320 7665  ))..        # ve
+00019760: 7269 6679 2069 6620 6120 746f 7461 6c20  rify if a total 
+00019770: 6f66 2032 2063 6f6c 6c65 6374 696f 6e73  of 2 collections
+00019780: 2067 6f74 2063 7265 6174 6564 0a20 2020   got created.   
+00019790: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000197a0: 4571 7561 6c28 6c65 6e28 636f 6c6c 6563  Equal(len(collec
+000197b0: 7469 6f6e 7329 2c20 6e75 6d62 6572 5f6f  tions), number_o
+000197c0: 665f 6578 6973 7469 6e67 5f63 6f6c 6c65  f_existing_colle
+000197d0: 6374 696f 6e73 202b 2032 290a 0a20 2020  ctions + 2)..   
+000197e0: 2020 2020 2023 2076 6572 6966 7920 7468       # verify th
+000197f0: 6174 2063 6f6c 6c65 6374 696f 6e73 2061  at collections a
+00019800: 7265 2063 7265 6174 6564 2077 6974 6820  re created with 
+00019810: 7370 6563 6966 6965 6420 4944 730a 2020  specified IDs.  
+00019820: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00019830: 7445 7175 616c 2863 6f6c 6c65 6374 696f  tEqual(collectio
+00019840: 6e5f 6964 312c 2063 7265 6174 6564 5f63  n_id1, created_c
+00019850: 6f6c 6c65 6374 696f 6e31 2e69 6429 0a20  ollection1.id). 
+00019860: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00019870: 7274 4571 7561 6c28 636f 6c6c 6563 7469  rtEqual(collecti
+00019880: 6f6e 5f69 6432 2c20 6372 6561 7465 645f  on_id2, created_
+00019890: 636f 6c6c 6563 7469 6f6e 322e 6964 290a  collection2.id).
+000198a0: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+000198b0: 5f64 622e 6465 6c65 7465 5f63 6f6e 7461  _db.delete_conta
+000198c0: 696e 6572 2863 7265 6174 6564 5f63 6f6c  iner(created_col
+000198d0: 6c65 6374 696f 6e31 290a 2020 2020 2020  lection1).      
+000198e0: 2020 6372 6561 7465 645f 6462 2e64 656c    created_db.del
+000198f0: 6574 655f 636f 6e74 6169 6e65 7228 6372  ete_container(cr
+00019900: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+00019910: 3229 0a0a 2020 2020 2354 4f44 4f3a 2066  2)..    #TODO: f
+00019920: 6978 2074 6573 740a 2020 2020 4070 7974  ix test.    @pyt
+00019930: 6573 742e 6d61 726b 2e73 6b69 700a 2020  est.mark.skip.  
+00019940: 2020 6465 6620 7465 7374 5f69 645f 756e    def test_id_un
+00019950: 6963 6f64 655f 7661 6c69 6461 7469 6f6e  icode_validation
+00019960: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00019970: 2320 6372 6561 7465 2064 6174 6162 6173  # create databas
+00019980: 650a 2020 2020 2020 2020 6372 6561 7465  e.        create
+00019990: 645f 6462 203d 2073 656c 662e 6461 7461  d_db = self.data
+000199a0: 6261 7365 466f 7254 6573 740a 0a20 2020  baseForTest..   
+000199b0: 2020 2020 2023 2075 6e69 636f 6465 2063       # unicode c
+000199c0: 6861 7273 2069 6e20 4869 6e64 6920 666f  hars in Hindi fo
+000199d0: 7220 4964 2077 6869 6368 2074 7261 6e73  r Id which trans
+000199e0: 6c61 7465 7320 746f 3a20 2248 696e 6469  lates to: "Hindi
+000199f0: 2069 7320 7468 6520 6e61 7469 6f6e 616c   is the national
+00019a00: 206c 616e 6775 6167 6520 6f66 2049 6e64   language of Ind
+00019a10: 6961 220a 2020 2020 2020 2020 636f 6c6c  ia".        coll
+00019a20: 6563 7469 6f6e 5f69 6431 203d 2075 27e0  ection_id1 = u'.
+00019a30: a4b9 e0a4 bfe0 a4a8 e0a5 8de0 a4a6 e0a5  ................
+00019a40: 8020 e0a4 ade0 a4be e0a4 b0e0 a4a4 20e0  . ............ .
+00019a50: a495 e0a5 8020 e0a4 b0e0 a4be e0a4 b7e0  ..... ..........
+00019a60: a58d e0a4 9fe0 a58d e0a4 b0e0 a580 e0a4  ................
+00019a70: af20 e0a4 ade0 a4be e0a4 b7e0 a4be 20e0  . ............ .
+00019a80: a4b9 e0a5 8827 2023 2063 7370 656c 6c3a  .....' # cspell:
+00019a90: 6469 7361 626c 652d 6c69 6e65 0a0a 2020  disable-line..  
+00019aa0: 2020 2020 2020 2320 5370 6563 6961 6c20        # Special 
+00019ab0: 6368 6172 7320 666f 7220 4964 0a20 2020  chars for Id.   
+00019ac0: 2020 2020 2063 6f6c 6c65 6374 696f 6e5f       collection_
+00019ad0: 6964 3220 3d20 2221 4024 255e 262a 2829  id2 = "!@$%^&*()
+00019ae0: 2d7e 6027 5f5b 5d7b 7d7c 3b3a 2c2e 3c3e  -~`'_[]{}|;:,.<>
+00019af0: 220a 0a20 2020 2020 2020 2023 2076 6572  "..        # ver
+00019b00: 6966 7920 7468 6174 2063 6f6c 6c65 6374  ify that collect
+00019b10: 696f 6e73 2061 7265 2063 7265 6174 6564  ions are created
+00019b20: 2077 6974 6820 7370 6563 6966 6965 6420   with specified 
+00019b30: 4944 730a 2020 2020 2020 2020 6372 6561  IDs.        crea
+00019b40: 7465 645f 636f 6c6c 6563 7469 6f6e 3120  ted_collection1 
+00019b50: 3d20 6372 6561 7465 645f 6462 2e63 7265  = created_db.cre
+00019b60: 6174 655f 636f 6e74 6169 6e65 7228 0a20  ate_container(. 
+00019b70: 2020 2020 2020 2020 2020 2069 643d 636f             id=co
+00019b80: 6c6c 6563 7469 6f6e 5f69 6431 2c0a 2020  llection_id1,.  
+00019b90: 2020 2020 2020 2020 2020 7061 7274 6974            partit
+00019ba0: 696f 6e5f 6b65 793d 5061 7274 6974 696f  ion_key=Partitio
+00019bb0: 6e4b 6579 2870 6174 683d 272f 6964 272c  nKey(path='/id',
+00019bc0: 206b 696e 643d 2748 6173 6827 290a 2020   kind='Hash').  
+00019bd0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00019be0: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
+00019bf0: 6f6e 3220 3d20 6372 6561 7465 645f 6462  on2 = created_db
+00019c00: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
+00019c10: 7228 0a20 2020 2020 2020 2020 2020 2069  r(.            i
+00019c20: 643d 636f 6c6c 6563 7469 6f6e 5f69 6432  d=collection_id2
+00019c30: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+00019c40: 7274 6974 696f 6e5f 6b65 793d 5061 7274  rtition_key=Part
+00019c50: 6974 696f 6e4b 6579 2870 6174 683d 272f  itionKey(path='/
+00019c60: 6964 272c 206b 696e 643d 2748 6173 6827  id', kind='Hash'
+00019c70: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
+00019c80: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00019c90: 4571 7561 6c28 636f 6c6c 6563 7469 6f6e  Equal(collection
+00019ca0: 5f69 6431 2c20 6372 6561 7465 645f 636f  _id1, created_co
+00019cb0: 6c6c 6563 7469 6f6e 312e 6964 290a 2020  llection1.id).  
+00019cc0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00019cd0: 7445 7175 616c 2863 6f6c 6c65 6374 696f  tEqual(collectio
+00019ce0: 6e5f 6964 322c 2063 7265 6174 6564 5f63  n_id2, created_c
+00019cf0: 6f6c 6c65 6374 696f 6e32 2e69 6429 0a20  ollection2.id). 
+00019d00: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00019d10: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
+00019d20: 6f6e 315f 7072 6f70 6572 7469 6573 203d  on1_properties =
+00019d30: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
+00019d40: 696f 6e31 2e72 6561 6428 290a 2020 2020  ion1.read().    
+00019d50: 2020 2020 6372 6561 7465 645f 636f 6c6c      created_coll
+00019d60: 6563 7469 6f6e 325f 7072 6f70 6572 7469  ection2_properti
+00019d70: 6573 203d 2063 7265 6174 6564 5f63 6f6c  es = created_col
+00019d80: 6c65 6374 696f 6e32 2e72 6561 6428 290a  lection2.read().
+00019d90: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+00019da0: 5f64 622e 636c 6965 6e74 5f63 6f6e 6e65  _db.client_conne
+00019db0: 6374 696f 6e2e 4465 6c65 7465 436f 6e74  ction.DeleteCont
+00019dc0: 6169 6e65 7228 6372 6561 7465 645f 636f  ainer(created_co
+00019dd0: 6c6c 6563 7469 6f6e 315f 7072 6f70 6572  llection1_proper
+00019de0: 7469 6573 5b27 5f73 656c 6627 5d29 0a20  ties['_self']). 
+00019df0: 2020 2020 2020 2063 7265 6174 6564 5f64         created_d
+00019e00: 622e 636c 6965 6e74 5f63 6f6e 6e65 6374  b.client_connect
+00019e10: 696f 6e2e 4465 6c65 7465 436f 6e74 6169  ion.DeleteContai
+00019e20: 6e65 7228 6372 6561 7465 645f 636f 6c6c  ner(created_coll
+00019e30: 6563 7469 6f6e 325f 7072 6f70 6572 7469  ection2_properti
+00019e40: 6573 5b27 5f73 656c 6627 5d29 0a0a 2020  es['_self'])..  
+00019e50: 2020 6465 6620 7465 7374 5f67 6574 5f72    def test_get_r
+00019e60: 6573 6f75 7263 655f 7769 7468 5f64 6963  esource_with_dic
+00019e70: 7469 6f6e 6172 795f 616e 645f 6f62 6a65  tionary_and_obje
+00019e80: 6374 2873 656c 6629 3a0a 2020 2020 2020  ct(self):.      
+00019e90: 2020 6372 6561 7465 645f 6462 203d 2073    created_db = s
+00019ea0: 656c 662e 6461 7461 6261 7365 466f 7254  elf.databaseForT
+00019eb0: 6573 740a 0a20 2020 2020 2020 2023 2072  est..        # r
+00019ec0: 6561 6420 6461 7461 6261 7365 2077 6974  ead database wit
+00019ed0: 6820 6964 0a20 2020 2020 2020 2072 6561  h id.        rea
+00019ee0: 645f 6462 203d 2073 656c 662e 636c 6965  d_db = self.clie
+00019ef0: 6e74 2e67 6574 5f64 6174 6162 6173 655f  nt.get_database_
+00019f00: 636c 6965 6e74 2863 7265 6174 6564 5f64  client(created_d
+00019f10: 622e 6964 290a 2020 2020 2020 2020 7365  b.id).        se
+00019f20: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00019f30: 6561 645f 6462 2e69 642c 2063 7265 6174  ead_db.id, creat
+00019f40: 6564 5f64 622e 6964 290a 0a20 2020 2020  ed_db.id)..     
+00019f50: 2020 2023 2072 6561 6420 6461 7461 6261     # read databa
+00019f60: 7365 2077 6974 6820 696e 7374 616e 6365  se with instance
+00019f70: 0a20 2020 2020 2020 2072 6561 645f 6462  .        read_db
+00019f80: 203d 2073 656c 662e 636c 6965 6e74 2e67   = self.client.g
+00019f90: 6574 5f64 6174 6162 6173 655f 636c 6965  et_database_clie
+00019fa0: 6e74 2863 7265 6174 6564 5f64 6229 0a20  nt(created_db). 
+00019fb0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00019fc0: 7274 4571 7561 6c28 7265 6164 5f64 622e  rtEqual(read_db.
+00019fd0: 6964 2c20 6372 6561 7465 645f 6462 2e69  id, created_db.i
+00019fe0: 6429 0a0a 2020 2020 2020 2020 2320 7265  d)..        # re
+00019ff0: 6164 2064 6174 6162 6173 6520 7769 7468  ad database with
+0001a000: 2070 726f 7065 7274 6965 730a 2020 2020   properties.    
+0001a010: 2020 2020 7265 6164 5f64 6220 3d20 7365      read_db = se
+0001a020: 6c66 2e63 6c69 656e 742e 6765 745f 6461  lf.client.get_da
+0001a030: 7461 6261 7365 5f63 6c69 656e 7428 6372  tabase_client(cr
+0001a040: 6561 7465 645f 6462 2e72 6561 6428 2929  eated_db.read())
+0001a050: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001a060: 7365 7274 4571 7561 6c28 7265 6164 5f64  sertEqual(read_d
+0001a070: 622e 6964 2c20 6372 6561 7465 645f 6462  b.id, created_db
+0001a080: 2e69 6429 0a0a 2020 2020 2020 2020 6372  .id)..        cr
+0001a090: 6561 7465 645f 636f 6e74 6169 6e65 7220  eated_container 
+0001a0a0: 3d20 7365 6c66 2e63 6f6e 6669 6773 2e63  = self.configs.c
+0001a0b0: 7265 6174 655f 6d75 6c74 695f 7061 7274  reate_multi_part
+0001a0c0: 6974 696f 6e5f 636f 6c6c 6563 7469 6f6e  ition_collection
+0001a0d0: 5f69 665f 6e6f 745f 6578 6973 7428 7365  _if_not_exist(se
+0001a0e0: 6c66 2e63 6c69 656e 7429 0a0a 2020 2020  lf.client)..    
+0001a0f0: 2020 2020 2320 7265 6164 2063 6f6e 7461      # read conta
+0001a100: 696e 6572 2077 6974 6820 6964 0a20 2020  iner with id.   
+0001a110: 2020 2020 2072 6561 645f 636f 6e74 6169       read_contai
+0001a120: 6e65 7220 3d20 6372 6561 7465 645f 6462  ner = created_db
+0001a130: 2e67 6574 5f63 6f6e 7461 696e 6572 5f63  .get_container_c
+0001a140: 6c69 656e 7428 6372 6561 7465 645f 636f  lient(created_co
+0001a150: 6e74 6169 6e65 722e 6964 290a 2020 2020  ntainer.id).    
+0001a160: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001a170: 7175 616c 2872 6561 645f 636f 6e74 6169  qual(read_contai
+0001a180: 6e65 722e 6964 2c20 6372 6561 7465 645f  ner.id, created_
+0001a190: 636f 6e74 6169 6e65 722e 6964 290a 0a20  container.id).. 
+0001a1a0: 2020 2020 2020 2023 2072 6561 6420 636f         # read co
+0001a1b0: 6e74 6169 6e65 7220 7769 7468 2069 6e73  ntainer with ins
+0001a1c0: 7461 6e63 650a 2020 2020 2020 2020 7265  tance.        re
+0001a1d0: 6164 5f63 6f6e 7461 696e 6572 203d 2063  ad_container = c
+0001a1e0: 7265 6174 6564 5f64 622e 6765 745f 636f  reated_db.get_co
+0001a1f0: 6e74 6169 6e65 725f 636c 6965 6e74 2863  ntainer_client(c
+0001a200: 7265 6174 6564 5f63 6f6e 7461 696e 6572  reated_container
+0001a210: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0001a220: 7373 6572 7445 7175 616c 2872 6561 645f  ssertEqual(read_
+0001a230: 636f 6e74 6169 6e65 722e 6964 2c20 6372  container.id, cr
+0001a240: 6561 7465 645f 636f 6e74 6169 6e65 722e  eated_container.
+0001a250: 6964 290a 0a20 2020 2020 2020 2023 2072  id)..        # r
+0001a260: 6561 6420 636f 6e74 6169 6e65 7220 7769  ead container wi
+0001a270: 7468 2070 726f 7065 7274 6965 730a 2020  th properties.  
+0001a280: 2020 2020 2020 6372 6561 7465 645f 7072        created_pr
+0001a290: 6f70 6572 7469 6573 203d 2063 7265 6174  operties = creat
+0001a2a0: 6564 5f63 6f6e 7461 696e 6572 2e72 6561  ed_container.rea
+0001a2b0: 6428 290a 2020 2020 2020 2020 7265 6164  d().        read
+0001a2c0: 5f63 6f6e 7461 696e 6572 203d 2063 7265  _container = cre
+0001a2d0: 6174 6564 5f64 622e 6765 745f 636f 6e74  ated_db.get_cont
+0001a2e0: 6169 6e65 725f 636c 6965 6e74 2863 7265  ainer_client(cre
+0001a2f0: 6174 6564 5f70 726f 7065 7274 6965 7329  ated_properties)
+0001a300: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001a310: 7365 7274 4571 7561 6c28 7265 6164 5f63  sertEqual(read_c
+0001a320: 6f6e 7461 696e 6572 2e69 642c 2063 7265  ontainer.id, cre
+0001a330: 6174 6564 5f63 6f6e 7461 696e 6572 2e69  ated_container.i
+0001a340: 6429 0a0a 2020 2020 2020 2020 6372 6561  d)..        crea
+0001a350: 7465 645f 6974 656d 203d 2063 7265 6174  ted_item = creat
+0001a360: 6564 5f63 6f6e 7461 696e 6572 2e63 7265  ed_container.cre
+0001a370: 6174 655f 6974 656d 287b 2769 6427 3a27  ate_item({'id':'
+0001a380: 3127 202b 2073 7472 2875 7569 642e 7575  1' + str(uuid.uu
+0001a390: 6964 3428 2929 7d29 0a0a 2020 2020 2020  id4())})..      
+0001a3a0: 2020 2320 7265 6164 2069 7465 6d20 7769    # read item wi
+0001a3b0: 7468 2069 640a 2020 2020 2020 2020 7265  th id.        re
+0001a3c0: 6164 5f69 7465 6d20 3d20 6372 6561 7465  ad_item = create
+0001a3d0: 645f 636f 6e74 6169 6e65 722e 7265 6164  d_container.read
+0001a3e0: 5f69 7465 6d28 6974 656d 3d63 7265 6174  _item(item=creat
+0001a3f0: 6564 5f69 7465 6d5b 2769 6427 5d2c 2070  ed_item['id'], p
+0001a400: 6172 7469 7469 6f6e 5f6b 6579 3d63 7265  artition_key=cre
+0001a410: 6174 6564 5f69 7465 6d5b 2769 6427 5d29  ated_item['id'])
+0001a420: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001a430: 7365 7274 4571 7561 6c28 7265 6164 5f69  sertEqual(read_i
+0001a440: 7465 6d5b 2769 6427 5d2c 2063 7265 6174  tem['id'], creat
+0001a450: 6564 5f69 7465 6d5b 2769 6427 5d29 0a0a  ed_item['id'])..
+0001a460: 2020 2020 2020 2020 2320 7265 6164 2069          # read i
+0001a470: 7465 6d20 7769 7468 2070 726f 7065 7274  tem with propert
+0001a480: 6965 730a 2020 2020 2020 2020 7265 6164  ies.        read
+0001a490: 5f69 7465 6d20 3d20 6372 6561 7465 645f  _item = created_
+0001a4a0: 636f 6e74 6169 6e65 722e 7265 6164 5f69  container.read_i
+0001a4b0: 7465 6d28 6974 656d 3d63 7265 6174 6564  tem(item=created
+0001a4c0: 5f69 7465 6d2c 2070 6172 7469 7469 6f6e  _item, partition
+0001a4d0: 5f6b 6579 3d63 7265 6174 6564 5f69 7465  _key=created_ite
+0001a4e0: 6d5b 2769 6427 5d29 0a20 2020 2020 2020  m['id']).       
+0001a4f0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0001a500: 6c28 7265 6164 5f69 7465 6d5b 2769 6427  l(read_item['id'
+0001a510: 5d2c 2063 7265 6174 6564 5f69 7465 6d5b  ], created_item[
+0001a520: 2769 6427 5d29 0a0a 2020 2020 2020 2020  'id'])..        
+0001a530: 6372 6561 7465 645f 7370 726f 6320 3d20  created_sproc = 
+0001a540: 6372 6561 7465 645f 636f 6e74 6169 6e65  created_containe
+0001a550: 722e 7363 7269 7074 732e 6372 6561 7465  r.scripts.create
+0001a560: 5f73 746f 7265 645f 7072 6f63 6564 7572  _stored_procedur
+0001a570: 6528 7b0a 2020 2020 2020 2020 2020 2020  e({.            
+0001a580: 2769 6427 3a20 2773 746f 7265 6450 726f  'id': 'storedPro
+0001a590: 6365 6475 7265 2720 2b20 7374 7228 7575  cedure' + str(uu
+0001a5a0: 6964 2e75 7569 6434 2829 292c 0a20 2020  id.uuid4()),.   
+0001a5b0: 2020 2020 2020 2020 2027 626f 6479 273a           'body':
+0001a5c0: 2027 6675 6e63 7469 6f6e 2028 2920 7b20   'function () { 
+0001a5d0: 7d27 0a20 2020 2020 2020 207d 290a 0a20  }'.        }).. 
+0001a5e0: 2020 2020 2020 2023 2072 6561 6420 7370         # read sp
+0001a5f0: 726f 6320 7769 7468 2069 640a 2020 2020  roc with id.    
+0001a600: 2020 2020 7265 6164 5f73 7072 6f63 203d      read_sproc =
+0001a610: 2063 7265 6174 6564 5f63 6f6e 7461 696e   created_contain
+0001a620: 6572 2e73 6372 6970 7473 2e67 6574 5f73  er.scripts.get_s
+0001a630: 746f 7265 645f 7072 6f63 6564 7572 6528  tored_procedure(
+0001a640: 6372 6561 7465 645f 7370 726f 635b 2769  created_sproc['i
+0001a650: 6427 5d29 0a20 2020 2020 2020 2073 656c  d']).        sel
+0001a660: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+0001a670: 6164 5f73 7072 6f63 5b27 6964 275d 2c20  ad_sproc['id'], 
+0001a680: 6372 6561 7465 645f 7370 726f 635b 2769  created_sproc['i
+0001a690: 6427 5d29 0a0a 2020 2020 2020 2020 2320  d'])..        # 
+0001a6a0: 7265 6164 2073 7072 6f63 2077 6974 6820  read sproc with 
+0001a6b0: 7072 6f70 6572 7469 6573 0a20 2020 2020  properties.     
+0001a6c0: 2020 2072 6561 645f 7370 726f 6320 3d20     read_sproc = 
+0001a6d0: 6372 6561 7465 645f 636f 6e74 6169 6e65  created_containe
+0001a6e0: 722e 7363 7269 7074 732e 6765 745f 7374  r.scripts.get_st
+0001a6f0: 6f72 6564 5f70 726f 6365 6475 7265 2863  ored_procedure(c
+0001a700: 7265 6174 6564 5f73 7072 6f63 290a 2020  reated_sproc).  
+0001a710: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001a720: 7445 7175 616c 2872 6561 645f 7370 726f  tEqual(read_spro
+0001a730: 635b 2769 6427 5d2c 2063 7265 6174 6564  c['id'], created
+0001a740: 5f73 7072 6f63 5b27 6964 275d 290a 0a20  _sproc['id']).. 
+0001a750: 2020 2020 2020 2063 7265 6174 6564 5f74         created_t
+0001a760: 7269 6767 6572 203d 2063 7265 6174 6564  rigger = created
+0001a770: 5f63 6f6e 7461 696e 6572 2e73 6372 6970  _container.scrip
+0001a780: 7473 2e63 7265 6174 655f 7472 6967 6765  ts.create_trigge
+0001a790: 7228 7b0a 2020 2020 2020 2020 2020 2020  r({.            
+0001a7a0: 2769 6427 3a20 2773 616d 706c 6520 7472  'id': 'sample tr
+0001a7b0: 6967 6765 7227 202b 2073 7472 2875 7569  igger' + str(uui
+0001a7c0: 642e 7575 6964 3428 2929 2c0a 2020 2020  d.uuid4()),.    
+0001a7d0: 2020 2020 2020 2020 2773 6572 7665 7253          'serverS
+0001a7e0: 6372 6970 7427 3a20 2766 756e 6374 696f  cript': 'functio
+0001a7f0: 6e28 2920 7b76 6172 2078 203d 2031 303b  n() {var x = 10;
+0001a800: 7d27 2c0a 2020 2020 2020 2020 2020 2020  }',.            
+0001a810: 2774 7269 6767 6572 5479 7065 273a 2064  'triggerType': d
+0001a820: 6f63 756d 656e 7473 2e54 7269 6767 6572  ocuments.Trigger
+0001a830: 5479 7065 2e50 7265 2c0a 2020 2020 2020  Type.Pre,.      
+0001a840: 2020 2020 2020 2774 7269 6767 6572 4f70        'triggerOp
+0001a850: 6572 6174 696f 6e27 3a20 646f 6375 6d65  eration': docume
+0001a860: 6e74 732e 5472 6967 6765 724f 7065 7261  nts.TriggerOpera
+0001a870: 7469 6f6e 2e41 6c6c 0a20 2020 2020 2020  tion.All.       
+0001a880: 207d 290a 0a20 2020 2020 2020 2023 2072   })..        # r
+0001a890: 6561 6420 7472 6967 6765 7220 7769 7468  ead trigger with
+0001a8a0: 2069 640a 2020 2020 2020 2020 7265 6164   id.        read
+0001a8b0: 5f74 7269 6767 6572 203d 2063 7265 6174  _trigger = creat
+0001a8c0: 6564 5f63 6f6e 7461 696e 6572 2e73 6372  ed_container.scr
+0001a8d0: 6970 7473 2e67 6574 5f74 7269 6767 6572  ipts.get_trigger
+0001a8e0: 2863 7265 6174 6564 5f74 7269 6767 6572  (created_trigger
+0001a8f0: 5b27 6964 275d 290a 2020 2020 2020 2020  ['id']).        
+0001a900: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0001a910: 2872 6561 645f 7472 6967 6765 725b 2769  (read_trigger['i
+0001a920: 6427 5d2c 2063 7265 6174 6564 5f74 7269  d'], created_tri
+0001a930: 6767 6572 5b27 6964 275d 290a 0a20 2020  gger['id'])..   
+0001a940: 2020 2020 2023 2072 6561 6420 7472 6967       # read trig
+0001a950: 6765 7220 7769 7468 2070 726f 7065 7274  ger with propert
+0001a960: 6965 730a 2020 2020 2020 2020 7265 6164  ies.        read
+0001a970: 5f74 7269 6767 6572 203d 2063 7265 6174  _trigger = creat
+0001a980: 6564 5f63 6f6e 7461 696e 6572 2e73 6372  ed_container.scr
+0001a990: 6970 7473 2e67 6574 5f74 7269 6767 6572  ipts.get_trigger
+0001a9a0: 2863 7265 6174 6564 5f74 7269 6767 6572  (created_trigger
+0001a9b0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0001a9c0: 7373 6572 7445 7175 616c 2872 6561 645f  ssertEqual(read_
+0001a9d0: 7472 6967 6765 725b 2769 6427 5d2c 2063  trigger['id'], c
+0001a9e0: 7265 6174 6564 5f74 7269 6767 6572 5b27  reated_trigger['
+0001a9f0: 6964 275d 290a 0a20 2020 2020 2020 2063  id'])..        c
+0001aa00: 7265 6174 6564 5f75 6466 203d 2063 7265  reated_udf = cre
+0001aa10: 6174 6564 5f63 6f6e 7461 696e 6572 2e73  ated_container.s
+0001aa20: 6372 6970 7473 2e63 7265 6174 655f 7573  cripts.create_us
+0001aa30: 6572 5f64 6566 696e 6564 5f66 756e 6374  er_defined_funct
+0001aa40: 696f 6e28 7b0a 2020 2020 2020 2020 2020  ion({.          
+0001aa50: 2020 2769 6427 3a20 2773 616d 706c 6520    'id': 'sample 
+0001aa60: 7564 6627 202b 2073 7472 2875 7569 642e  udf' + str(uuid.
+0001aa70: 7575 6964 3428 2929 2c0a 2020 2020 2020  uuid4()),.      
+0001aa80: 2020 2020 2020 2762 6f64 7927 3a20 2766        'body': 'f
+0001aa90: 756e 6374 696f 6e28 2920 7b76 6172 2078  unction() {var x
+0001aaa0: 203d 2031 303b 7d27 0a20 2020 2020 2020   = 10;}'.       
+0001aab0: 207d 290a 0a20 2020 2020 2020 2023 2072   })..        # r
+0001aac0: 6561 6420 7564 6620 7769 7468 2069 640a  ead udf with id.
+0001aad0: 2020 2020 2020 2020 7265 6164 5f75 6466          read_udf
+0001aae0: 203d 2063 7265 6174 6564 5f63 6f6e 7461   = created_conta
+0001aaf0: 696e 6572 2e73 6372 6970 7473 2e67 6574  iner.scripts.get
+0001ab00: 5f75 7365 725f 6465 6669 6e65 645f 6675  _user_defined_fu
+0001ab10: 6e63 7469 6f6e 2863 7265 6174 6564 5f75  nction(created_u
+0001ab20: 6466 5b27 6964 275d 290a 2020 2020 2020  df['id']).      
+0001ab30: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0001ab40: 616c 2863 7265 6174 6564 5f75 6466 5b27  al(created_udf['
+0001ab50: 6964 275d 2c20 7265 6164 5f75 6466 5b27  id'], read_udf['
+0001ab60: 6964 275d 290a 0a20 2020 2020 2020 2023  id'])..        #
+0001ab70: 2072 6561 6420 7564 6620 7769 7468 2070   read udf with p
+0001ab80: 726f 7065 7274 6965 730a 2020 2020 2020  roperties.      
+0001ab90: 2020 7265 6164 5f75 6466 203d 2063 7265    read_udf = cre
+0001aba0: 6174 6564 5f63 6f6e 7461 696e 6572 2e73  ated_container.s
+0001abb0: 6372 6970 7473 2e67 6574 5f75 7365 725f  cripts.get_user_
+0001abc0: 6465 6669 6e65 645f 6675 6e63 7469 6f6e  defined_function
+0001abd0: 2863 7265 6174 6564 5f75 6466 290a 2020  (created_udf).  
+0001abe0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001abf0: 7445 7175 616c 2863 7265 6174 6564 5f75  tEqual(created_u
+0001ac00: 6466 5b27 6964 275d 2c20 7265 6164 5f75  df['id'], read_u
+0001ac10: 6466 5b27 6964 275d 290a 0a20 2020 2020  df['id'])..     
+0001ac20: 2020 2063 7265 6174 6564 5f75 7365 7220     created_user 
+0001ac30: 3d20 6372 6561 7465 645f 6462 2e63 7265  = created_db.cre
+0001ac40: 6174 655f 7573 6572 287b 0a20 2020 2020  ate_user({.     
+0001ac50: 2020 2020 2020 2027 6964 273a 2027 7573         'id': 'us
+0001ac60: 6572 2720 2b20 7374 7228 7575 6964 2e75  er' + str(uuid.u
+0001ac70: 7569 6434 2829 290a 2020 2020 2020 2020  uid4()).        
+0001ac80: 7d29 0a0a 2020 2020 2020 2020 2320 7265  })..        # re
+0001ac90: 6164 2075 7365 7220 7769 7468 2069 640a  ad user with id.
+0001aca0: 2020 2020 2020 2020 7265 6164 5f75 7365          read_use
+0001acb0: 7220 3d20 6372 6561 7465 645f 6462 2e67  r = created_db.g
+0001acc0: 6574 5f75 7365 725f 636c 6965 6e74 2863  et_user_client(c
+0001acd0: 7265 6174 6564 5f75 7365 722e 6964 290a  reated_user.id).
+0001ace0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001acf0: 6572 7445 7175 616c 2872 6561 645f 7573  ertEqual(read_us
+0001ad00: 6572 2e69 642c 2063 7265 6174 6564 5f75  er.id, created_u
+0001ad10: 7365 722e 6964 290a 0a20 2020 2020 2020  ser.id)..       
+0001ad20: 2023 2072 6561 6420 7573 6572 2077 6974   # read user wit
+0001ad30: 6820 696e 7374 616e 6365 0a20 2020 2020  h instance.     
+0001ad40: 2020 2072 6561 645f 7573 6572 203d 2063     read_user = c
+0001ad50: 7265 6174 6564 5f64 622e 6765 745f 7573  reated_db.get_us
+0001ad60: 6572 5f63 6c69 656e 7428 6372 6561 7465  er_client(create
+0001ad70: 645f 7573 6572 290a 2020 2020 2020 2020  d_user).        
+0001ad80: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0001ad90: 2872 6561 645f 7573 6572 2e69 642c 2063  (read_user.id, c
+0001ada0: 7265 6174 6564 5f75 7365 722e 6964 290a  reated_user.id).
+0001adb0: 0a20 2020 2020 2020 2023 2072 6561 6420  .        # read 
+0001adc0: 7573 6572 2077 6974 6820 7072 6f70 6572  user with proper
+0001add0: 7469 6573 0a20 2020 2020 2020 2063 7265  ties.        cre
+0001ade0: 6174 6564 5f75 7365 725f 7072 6f70 6572  ated_user_proper
+0001adf0: 7469 6573 203d 2063 7265 6174 6564 5f75  ties = created_u
+0001ae00: 7365 722e 7265 6164 2829 0a20 2020 2020  ser.read().     
+0001ae10: 2020 2072 6561 645f 7573 6572 203d 2063     read_user = c
+0001ae20: 7265 6174 6564 5f64 622e 6765 745f 7573  reated_db.get_us
+0001ae30: 6572 5f63 6c69 656e 7428 6372 6561 7465  er_client(create
+0001ae40: 645f 7573 6572 5f70 726f 7065 7274 6965  d_user_propertie
+0001ae50: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+0001ae60: 6173 7365 7274 4571 7561 6c28 7265 6164  assertEqual(read
+0001ae70: 5f75 7365 722e 6964 2c20 6372 6561 7465  _user.id, create
+0001ae80: 645f 7573 6572 2e69 6429 0a0a 2020 2020  d_user.id)..    
+0001ae90: 2020 2020 6372 6561 7465 645f 7065 726d      created_perm
+0001aea0: 6973 7369 6f6e 203d 2063 7265 6174 6564  ission = created
+0001aeb0: 5f75 7365 722e 6372 6561 7465 5f70 6572  _user.create_per
+0001aec0: 6d69 7373 696f 6e28 7b0a 2020 2020 2020  mission({.      
+0001aed0: 2020 2020 2020 2769 6427 3a20 2761 6c6c        'id': 'all
+0001aee0: 2070 6572 6d69 7373 696f 6e27 202b 2073   permission' + s
+0001aef0: 7472 2875 7569 642e 7575 6964 3428 2929  tr(uuid.uuid4())
+0001af00: 2c0a 2020 2020 2020 2020 2020 2020 2770  ,.            'p
+0001af10: 6572 6d69 7373 696f 6e4d 6f64 6527 3a20  ermissionMode': 
+0001af20: 646f 6375 6d65 6e74 732e 5065 726d 6973  documents.Permis
+0001af30: 7369 6f6e 4d6f 6465 2e41 6c6c 2c0a 2020  sionMode.All,.  
+0001af40: 2020 2020 2020 2020 2020 2772 6573 6f75            'resou
+0001af50: 7263 6527 3a20 6372 6561 7465 645f 636f  rce': created_co
+0001af60: 6e74 6169 6e65 722e 636f 6e74 6169 6e65  ntainer.containe
+0001af70: 725f 6c69 6e6b 2c0a 2020 2020 2020 2020  r_link,.        
+0001af80: 2020 2020 2772 6573 6f75 7263 6550 6172      'resourcePar
+0001af90: 7469 7469 6f6e 4b65 7927 3a20 5b31 5d0a  titionKey': [1].
+0001afa0: 2020 2020 2020 2020 7d29 0a0a 2020 2020          })..    
+0001afb0: 2020 2020 2320 7265 6164 2070 6572 6d69      # read permi
+0001afc0: 7373 696f 6e20 7769 7468 2069 640a 2020  ssion with id.  
+0001afd0: 2020 2020 2020 7265 6164 5f70 6572 6d69        read_permi
+0001afe0: 7373 696f 6e20 3d20 6372 6561 7465 645f  ssion = created_
+0001aff0: 7573 6572 2e67 6574 5f70 6572 6d69 7373  user.get_permiss
+0001b000: 696f 6e28 6372 6561 7465 645f 7065 726d  ion(created_perm
+0001b010: 6973 7369 6f6e 2e69 6429 0a20 2020 2020  ission.id).     
+0001b020: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0001b030: 7561 6c28 7265 6164 5f70 6572 6d69 7373  ual(read_permiss
+0001b040: 696f 6e2e 6964 2c20 6372 6561 7465 645f  ion.id, created_
+0001b050: 7065 726d 6973 7369 6f6e 2e69 6429 0a0a  permission.id)..
+0001b060: 2020 2020 2020 2020 2320 7265 6164 2070          # read p
+0001b070: 6572 6d69 7373 696f 6e20 7769 7468 2069  ermission with i
+0001b080: 6e73 7461 6e63 650a 2020 2020 2020 2020  nstance.        
+0001b090: 7265 6164 5f70 6572 6d69 7373 696f 6e20  read_permission 
+0001b0a0: 3d20 6372 6561 7465 645f 7573 6572 2e67  = created_user.g
+0001b0b0: 6574 5f70 6572 6d69 7373 696f 6e28 6372  et_permission(cr
+0001b0c0: 6561 7465 645f 7065 726d 6973 7369 6f6e  eated_permission
+0001b0d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0001b0e0: 7373 6572 7445 7175 616c 2872 6561 645f  ssertEqual(read_
+0001b0f0: 7065 726d 6973 7369 6f6e 2e69 642c 2063  permission.id, c
+0001b100: 7265 6174 6564 5f70 6572 6d69 7373 696f  reated_permissio
+0001b110: 6e2e 6964 290a 0a20 2020 2020 2020 2023  n.id)..        #
+0001b120: 2072 6561 6420 7065 726d 6973 7369 6f6e   read permission
+0001b130: 2077 6974 6820 7072 6f70 6572 7469 6573   with properties
+0001b140: 0a20 2020 2020 2020 2072 6561 645f 7065  .        read_pe
+0001b150: 726d 6973 7369 6f6e 203d 2063 7265 6174  rmission = creat
+0001b160: 6564 5f75 7365 722e 6765 745f 7065 726d  ed_user.get_perm
+0001b170: 6973 7369 6f6e 2863 7265 6174 6564 5f70  ission(created_p
+0001b180: 6572 6d69 7373 696f 6e2e 7072 6f70 6572  ermission.proper
+0001b190: 7469 6573 290a 2020 2020 2020 2020 7365  ties).        se
+0001b1a0: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+0001b1b0: 6561 645f 7065 726d 6973 7369 6f6e 2e69  ead_permission.i
+0001b1c0: 642c 2063 7265 6174 6564 5f70 6572 6d69  d, created_permi
+0001b1d0: 7373 696f 6e2e 6964 290a 0a20 2020 2064  ssion.id)..    d
+0001b1e0: 6566 2074 6573 745f 6465 6c65 7465 5f61  ef test_delete_a
+0001b1f0: 6c6c 5f69 7465 6d73 5f62 795f 7061 7274  ll_items_by_part
+0001b200: 6974 696f 6e5f 6b65 7928 7365 6c66 293a  ition_key(self):
+0001b210: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
+0001b220: 6520 6461 7461 6261 7365 0a20 2020 2020  e database.     
+0001b230: 2020 2063 7265 6174 6564 5f64 6220 3d20     created_db = 
+0001b240: 7365 6c66 2e64 6174 6162 6173 6546 6f72  self.databaseFor
+0001b250: 5465 7374 0a0a 2020 2020 2020 2020 2320  Test..        # 
+0001b260: 6372 6561 7465 2063 6f6e 7461 696e 6572  create container
+0001b270: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+0001b280: 5f63 6f6c 6c65 6374 696f 6e20 3d20 6372  _collection = cr
+0001b290: 6561 7465 645f 6462 2e63 7265 6174 655f  eated_db.create_
+0001b2a0: 636f 6e74 6169 6e65 7228 0a20 2020 2020  container(.     
+0001b2b0: 2020 2020 2020 2069 643d 2774 6573 745f         id='test_
+0001b2c0: 6465 6c65 7465 5f61 6c6c 5f69 7465 6d73  delete_all_items
+0001b2d0: 5f62 795f 7061 7274 6974 696f 6e5f 6b65  _by_partition_ke
+0001b2e0: 7920 2720 2b20 7374 7228 7575 6964 2e75  y ' + str(uuid.u
+0001b2f0: 7569 6434 2829 292c 0a20 2020 2020 2020  uid4()),.       
+0001b300: 2020 2020 2070 6172 7469 7469 6f6e 5f6b       partition_k
+0001b310: 6579 3d50 6172 7469 7469 6f6e 4b65 7928  ey=PartitionKey(
+0001b320: 7061 7468 3d27 2f70 6b27 2c20 6b69 6e64  path='/pk', kind
+0001b330: 3d27 4861 7368 2729 0a20 2020 2020 2020  ='Hash').       
+0001b340: 2029 0a20 2020 2020 2020 2023 2043 7265   ).        # Cre
+0001b350: 6174 6520 7477 6f20 7061 7274 6974 696f  ate two partitio
+0001b360: 6e20 6b65 7973 0a20 2020 2020 2020 2070  n keys.        p
+0001b370: 6172 7469 7469 6f6e 5f6b 6579 3120 3d20  artition_key1 = 
+0001b380: 227b 7d2d 7b7d 222e 666f 726d 6174 2822  "{}-{}".format("
+0001b390: 5061 7274 6974 696f 6e20 4b65 7920 3122  Partition Key 1"
+0001b3a0: 2c20 7374 7228 7575 6964 2e75 7569 6434  , str(uuid.uuid4
+0001b3b0: 2829 2929 0a20 2020 2020 2020 2070 6172  ())).        par
+0001b3c0: 7469 7469 6f6e 5f6b 6579 3220 3d20 227b  tition_key2 = "{
+0001b3d0: 7d2d 7b7d 222e 666f 726d 6174 2822 5061  }-{}".format("Pa
+0001b3e0: 7274 6974 696f 6e20 4b65 7920 3222 2c20  rtition Key 2", 
+0001b3f0: 7374 7228 7575 6964 2e75 7569 6434 2829  str(uuid.uuid4()
+0001b400: 2929 0a0a 2020 2020 2020 2020 2320 6164  ))..        # ad
+0001b410: 6420 6974 656d 7320 666f 7220 7061 7274  d items for part
+0001b420: 6974 696f 6e20 6b65 7920 310a 2020 2020  ition key 1.    
+0001b430: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+0001b440: 6765 2831 2c20 3329 3a0a 2020 2020 2020  ge(1, 3):.      
+0001b450: 2020 2020 2020 6372 6561 7465 645f 636f        created_co
+0001b460: 6c6c 6563 7469 6f6e 2e75 7073 6572 745f  llection.upsert_
+0001b470: 6974 656d 280a 2020 2020 2020 2020 2020  item(.          
+0001b480: 2020 2020 2020 6469 6374 2869 643d 2269        dict(id="i
+0001b490: 7465 6d7b 7d22 2e66 6f72 6d61 7428 6929  tem{}".format(i)
+0001b4a0: 2c20 706b 3d70 6172 7469 7469 6f6e 5f6b  , pk=partition_k
+0001b4b0: 6579 3129 0a20 2020 2020 2020 2020 2020  ey1).           
+0001b4c0: 2029 0a0a 2020 2020 2020 2020 2320 6164   )..        # ad
+0001b4d0: 6420 6974 656d 7320 666f 7220 7061 7274  d items for part
+0001b4e0: 6974 696f 6e20 6b65 7920 320a 0a20 2020  ition key 2..   
+0001b4f0: 2020 2020 2070 6b32 5f69 7465 6d20 3d20       pk2_item = 
+0001b500: 6372 6561 7465 645f 636f 6c6c 6563 7469  created_collecti
+0001b510: 6f6e 2e75 7073 6572 745f 6974 656d 2864  on.upsert_item(d
+0001b520: 6963 7428 6964 3d22 6974 656d 7b7d 222e  ict(id="item{}".
+0001b530: 666f 726d 6174 2833 292c 2070 6b3d 7061  format(3), pk=pa
+0001b540: 7274 6974 696f 6e5f 6b65 7932 2929 0a0a  rtition_key2))..
+0001b550: 2020 2020 2020 2020 2320 6465 6c65 7465          # delete
+0001b560: 2061 6c6c 2069 7465 6d73 2066 6f72 2070   all items for p
+0001b570: 6172 7469 7469 6f6e 206b 6579 2031 0a20  artition key 1. 
+0001b580: 2020 2020 2020 2063 7265 6174 6564 5f63         created_c
+0001b590: 6f6c 6c65 6374 696f 6e2e 6465 6c65 7465  ollection.delete
+0001b5a0: 5f61 6c6c 5f69 7465 6d73 5f62 795f 7061  _all_items_by_pa
+0001b5b0: 7274 6974 696f 6e5f 6b65 7928 7061 7274  rtition_key(part
+0001b5c0: 6974 696f 6e5f 6b65 7931 290a 0a20 2020  ition_key1)..   
+0001b5d0: 2020 2020 2023 2063 6865 636b 2074 6861       # check tha
+0001b5e0: 7420 6f6e 6c79 2069 7465 6d73 2066 726f  t only items fro
+0001b5f0: 6d20 7061 7274 6974 696f 6e20 6b65 7920  m partition key 
+0001b600: 3120 6861 7665 2062 6565 6e20 6465 6c65  1 have been dele
+0001b610: 7465 640a 2020 2020 2020 2020 6974 656d  ted.        item
+0001b620: 7320 3d20 6c69 7374 2863 7265 6174 6564  s = list(created
+0001b630: 5f63 6f6c 6c65 6374 696f 6e2e 7265 6164  _collection.read
+0001b640: 5f61 6c6c 5f69 7465 6d73 2829 290a 0a20  _all_items()).. 
+0001b650: 2020 2020 2020 2023 2069 7465 6d73 2073         # items s
+0001b660: 686f 756c 6420 6f6e 6c79 2068 6176 6520  hould only have 
+0001b670: 3120 6974 656d 2061 6e64 2069 7420 7368  1 item and it sh
+0001b680: 6f75 6c64 2065 7175 616c 2070 6b32 5f69  ould equal pk2_i
+0001b690: 7465 6d0a 2020 2020 2020 2020 7365 6c66  tem.        self
+0001b6a0: 2e61 7373 6572 7444 6963 7445 7175 616c  .assertDictEqual
+0001b6b0: 2870 6b32 5f69 7465 6d2c 2069 7465 6d73  (pk2_item, items
+0001b6c0: 5b30 5d29 0a0a 2020 2020 2020 2020 2320  [0])..        # 
+0001b6d0: 6174 7465 6d70 7469 6e67 2074 6f20 6465  attempting to de
+0001b6e0: 6c65 7465 2061 206e 6f6e 2d65 7869 7374  lete a non-exist
+0001b6f0: 656e 7420 7061 7274 6974 696f 6e20 6b65  ent partition ke
+0001b700: 7920 6f72 2070 6173 7369 6e67 206e 6f6e  y or passing non
+0001b710: 6520 7368 6f75 6c64 206e 6f74 2064 656c  e should not del
+0001b720: 6574 650a 2020 2020 2020 2020 2320 616e  ete.        # an
+0001b730: 7974 6869 6e67 2061 6e64 206c 6561 7665  ything and leave
+0001b740: 2074 6869 6e67 7320 756e 6368 616e 6765   things unchange
+0001b750: 640a 2020 2020 2020 2020 6372 6561 7465  d.        create
+0001b760: 645f 636f 6c6c 6563 7469 6f6e 2e64 656c  d_collection.del
+0001b770: 6574 655f 616c 6c5f 6974 656d 735f 6279  ete_all_items_by
+0001b780: 5f70 6172 7469 7469 6f6e 5f6b 6579 284e  _partition_key(N
+0001b790: 6f6e 6529 0a0a 2020 2020 2020 2020 2320  one)..        # 
+0001b7a0: 6368 6563 6b20 7468 6174 206e 6f20 6368  check that no ch
+0001b7b0: 616e 6765 7320 7765 7265 206d 6164 6520  anges were made 
+0001b7c0: 6279 2063 6865 636b 696e 6720 6966 2074  by checking if t
+0001b7d0: 6865 206f 6e6c 7920 6974 656d 2069 7320  he only item is 
+0001b7e0: 7374 696c 6c20 7468 6572 650a 2020 2020  still there.    
+0001b7f0: 2020 2020 6974 656d 7320 3d20 6c69 7374      items = list
+0001b800: 2863 7265 6174 6564 5f63 6f6c 6c65 6374  (created_collect
+0001b810: 696f 6e2e 7265 6164 5f61 6c6c 5f69 7465  ion.read_all_ite
+0001b820: 6d73 2829 290a 0a20 2020 2020 2020 2023  ms())..        #
+0001b830: 2069 7465 6d73 2073 686f 756c 6420 6f6e   items should on
+0001b840: 6c79 2068 6176 6520 3120 6974 656d 2061  ly have 1 item a
+0001b850: 6e64 2069 7420 7368 6f75 6c64 2065 7175  nd it should equ
+0001b860: 616c 2070 6b32 5f69 7465 6d0a 2020 2020  al pk2_item.    
+0001b870: 2020 2020 7365 6c66 2e61 7373 6572 7444      self.assertD
+0001b880: 6963 7445 7175 616c 2870 6b32 5f69 7465  ictEqual(pk2_ite
+0001b890: 6d2c 2069 7465 6d73 5b30 5d29 0a0a 2020  m, items[0])..  
+0001b8a0: 2020 2020 2020 6372 6561 7465 645f 6462        created_db
+0001b8b0: 2e64 656c 6574 655f 636f 6e74 6169 6e65  .delete_containe
+0001b8c0: 7228 6372 6561 7465 645f 636f 6c6c 6563  r(created_collec
+0001b8d0: 7469 6f6e 290a 0a20 2020 2064 6566 2074  tion)..    def t
+0001b8e0: 6573 745f 7061 7463 685f 6f70 6572 6174  est_patch_operat
+0001b8f0: 696f 6e73 2873 656c 6629 3a0a 2020 2020  ions(self):.    
+0001b900: 2020 2020 6372 6561 7465 645f 636f 6e74      created_cont
+0001b910: 6169 6e65 7220 3d20 7365 6c66 2e64 6174  ainer = self.dat
+0001b920: 6162 6173 6546 6f72 5465 7374 2e63 7265  abaseForTest.cre
+0001b930: 6174 655f 636f 6e74 6169 6e65 725f 6966  ate_container_if
+0001b940: 5f6e 6f74 5f65 7869 7374 7328 6964 3d22  _not_exists(id="
+0001b950: 7061 7463 685f 636f 6e74 6169 6e65 7222  patch_container"
+0001b960: 2c20 7061 7274 6974 696f 6e5f 6b65 793d  , partition_key=
+0001b970: 5061 7274 6974 696f 6e4b 6579 2870 6174  PartitionKey(pat
+0001b980: 683d 222f 706b 2229 290a 0a20 2020 2020  h="/pk"))..     
+0001b990: 2020 2023 4372 6561 7465 2069 7465 6d20     #Create item 
+0001b9a0: 746f 2070 6174 6368 0a20 2020 2020 2020  to patch.       
+0001b9b0: 2069 7465 6d20 3d20 7b0a 2020 2020 2020   item = {.      
+0001b9c0: 2020 2020 2020 2269 6422 3a20 2270 6174        "id": "pat
+0001b9d0: 6368 5f69 7465 6d22 2c0a 2020 2020 2020  ch_item",.      
+0001b9e0: 2020 2020 2020 2270 6b22 3a20 2270 6174        "pk": "pat
+0001b9f0: 6368 5f69 7465 6d5f 706b 222c 0a20 2020  ch_item_pk",.   
+0001ba00: 2020 2020 2020 2020 2022 7072 6f70 223a           "prop":
+0001ba10: 2022 7072 6f70 3122 2c0a 2020 2020 2020   "prop1",.      
+0001ba20: 2020 2020 2020 2261 6464 7265 7373 223a        "address":
+0001ba30: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0001ba40: 2020 2022 6369 7479 223a 2022 5265 646d     "city": "Redm
+0001ba50: 6f6e 6422 0a20 2020 2020 2020 2020 2020  ond".           
+0001ba60: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
+0001ba70: 2263 6f6d 7061 6e79 223a 2022 4d69 6372  "company": "Micr
+0001ba80: 6f73 6f66 7422 2c0a 2020 2020 2020 2020  osoft",.        
+0001ba90: 2020 2020 226e 756d 6265 7222 3a20 337d      "number": 3}
+0001baa0: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+0001bab0: 5f63 6f6e 7461 696e 6572 2e63 7265 6174  _container.creat
+0001bac0: 655f 6974 656d 2869 7465 6d29 0a20 2020  e_item(item).   
+0001bad0: 2020 2020 2023 4465 6669 6e65 2061 6e64       #Define and
+0001bae0: 2072 756e 2070 6174 6368 206f 7065 7261   run patch opera
+0001baf0: 7469 6f6e 730a 2020 2020 2020 2020 6f70  tions.        op
+0001bb00: 6572 6174 696f 6e73 203d 205b 0a20 2020  erations = [.   
+0001bb10: 2020 2020 2020 2020 207b 226f 7022 3a20           {"op": 
+0001bb20: 2261 6464 222c 2022 7061 7468 223a 2022  "add", "path": "
+0001bb30: 2f63 6f6c 6f72 222c 2022 7661 6c75 6522  /color", "value"
+0001bb40: 3a20 2279 656c 6c6f 7722 7d2c 0a20 2020  : "yellow"},.   
+0001bb50: 2020 2020 2020 2020 207b 226f 7022 3a20           {"op": 
+0001bb60: 2272 656d 6f76 6522 2c20 2270 6174 6822  "remove", "path"
+0001bb70: 3a20 222f 7072 6f70 227d 2c0a 2020 2020  : "/prop"},.    
+0001bb80: 2020 2020 2020 2020 7b22 6f70 223a 2022          {"op": "
+0001bb90: 7265 706c 6163 6522 2c20 2270 6174 6822  replace", "path"
+0001bba0: 3a20 222f 636f 6d70 616e 7922 2c20 2276  : "/company", "v
+0001bbb0: 616c 7565 223a 2022 436f 736d 6f73 4442  alue": "CosmosDB
+0001bbc0: 227d 2c0a 2020 2020 2020 2020 2020 2020  "},.            
+0001bbd0: 7b22 6f70 223a 2022 7365 7422 2c20 2270  {"op": "set", "p
+0001bbe0: 6174 6822 3a20 222f 6164 6472 6573 732f  ath": "/address/
+0001bbf0: 6e65 775f 6369 7479 222c 2022 7661 6c75  new_city", "valu
+0001bc00: 6522 3a20 2241 746c 616e 7461 227d 2c0a  e": "Atlanta"},.
+0001bc10: 2020 2020 2020 2020 2020 2020 7b22 6f70              {"op
+0001bc20: 223a 2022 696e 6372 222c 2022 7061 7468  ": "incr", "path
+0001bc30: 223a 2022 2f6e 756d 6265 7222 2c20 2276  ": "/number", "v
+0001bc40: 616c 7565 223a 2037 7d2c 0a20 2020 2020  alue": 7},.     
+0001bc50: 2020 2020 2020 207b 226f 7022 3a20 226d         {"op": "m
+0001bc60: 6f76 6522 2c20 2266 726f 6d22 3a20 222f  ove", "from": "/
+0001bc70: 636f 6c6f 7222 2c20 2270 6174 6822 3a20  color", "path": 
+0001bc80: 222f 6661 766f 7269 7465 5f63 6f6c 6f72  "/favorite_color
+0001bc90: 227d 0a20 2020 2020 2020 205d 0a20 2020  "}.        ].   
+0001bca0: 2020 2020 2070 6174 6368 6564 5f69 7465       patched_ite
+0001bcb0: 6d20 3d20 6372 6561 7465 645f 636f 6e74  m = created_cont
+0001bcc0: 6169 6e65 722e 7061 7463 685f 6974 656d  ainer.patch_item
+0001bcd0: 2869 7465 6d3d 2270 6174 6368 5f69 7465  (item="patch_ite
+0001bce0: 6d22 2c20 7061 7274 6974 696f 6e5f 6b65  m", partition_ke
+0001bcf0: 793d 2270 6174 6368 5f69 7465 6d5f 706b  y="patch_item_pk
+0001bd00: 222c 2070 6174 6368 5f6f 7065 7261 7469  ", patch_operati
+0001bd10: 6f6e 733d 6f70 6572 6174 696f 6e73 290a  ons=operations).
+0001bd20: 2020 2020 2020 2020 2356 6572 6966 7920          #Verify 
+0001bd30: 7265 7375 6c74 7320 6672 6f6d 2070 6174  results from pat
+0001bd40: 6368 206f 7065 7261 7469 6f6e 730a 2020  ch operations.  
+0001bd50: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001bd60: 7454 7275 6528 7061 7463 6865 645f 6974  tTrue(patched_it
+0001bd70: 656d 2e67 6574 2822 636f 6c6f 7222 2920  em.get("color") 
+0001bd80: 6973 204e 6f6e 6529 0a20 2020 2020 2020  is None).       
+0001bd90: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
+0001bda0: 2870 6174 6368 6564 5f69 7465 6d2e 6765  (patched_item.ge
+0001bdb0: 7428 2270 726f 7022 2920 6973 204e 6f6e  t("prop") is Non
+0001bdc0: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+0001bdd0: 6173 7365 7274 4571 7561 6c28 7061 7463  assertEqual(patc
+0001bde0: 6865 645f 6974 656d 2e67 6574 2822 636f  hed_item.get("co
+0001bdf0: 6d70 616e 7922 292c 2022 436f 736d 6f73  mpany"), "Cosmos
+0001be00: 4442 2229 0a20 2020 2020 2020 2073 656c  DB").        sel
+0001be10: 662e 6173 7365 7274 4571 7561 6c28 7061  f.assertEqual(pa
+0001be20: 7463 6865 645f 6974 656d 2e67 6574 2822  tched_item.get("
+0001be30: 6164 6472 6573 7322 292e 6765 7428 226e  address").get("n
+0001be40: 6577 5f63 6974 7922 292c 2022 4174 6c61  ew_city"), "Atla
+0001be50: 6e74 6122 290a 2020 2020 2020 2020 7365  nta").        se
+0001be60: 6c66 2e61 7373 6572 7445 7175 616c 2870  lf.assertEqual(p
+0001be70: 6174 6368 6564 5f69 7465 6d2e 6765 7428  atched_item.get(
+0001be80: 226e 756d 6265 7222 292c 2031 3029 0a20  "number"), 10). 
+0001be90: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001bea0: 7274 4571 7561 6c28 7061 7463 6865 645f  rtEqual(patched_
+0001beb0: 6974 656d 2e67 6574 2822 6661 766f 7269  item.get("favori
+0001bec0: 7465 5f63 6f6c 6f72 2229 2c20 2279 656c  te_color"), "yel
+0001bed0: 6c6f 7722 290a 0a20 2020 2020 2020 2023  low")..        #
+0001bee0: 4e65 6761 7469 7665 2074 6573 7420 2d20  Negative test - 
+0001bef0: 6174 7465 6d70 7420 746f 2072 6570 6c61  attempt to repla
+0001bf00: 6365 206e 6f6e 2d65 7869 7374 656e 7420  ce non-existent 
+0001bf10: 6669 656c 640a 2020 2020 2020 2020 6f70  field.        op
+0001bf20: 6572 6174 696f 6e73 203d 205b 7b22 6f70  erations = [{"op
+0001bf30: 223a 2022 7265 706c 6163 6522 2c20 2270  ": "replace", "p
+0001bf40: 6174 6822 3a20 222f 7772 6f6e 675f 6669  ath": "/wrong_fi
+0001bf50: 656c 6422 2c20 2276 616c 7565 223a 2022  eld", "value": "
+0001bf60: 7772 6f6e 675f 7661 6c75 6522 7d5d 0a20  wrong_value"}]. 
+0001bf70: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0001bf80: 2020 2020 2020 2020 6372 6561 7465 645f          created_
+0001bf90: 636f 6e74 6169 6e65 722e 7061 7463 685f  container.patch_
+0001bfa0: 6974 656d 2869 7465 6d3d 2270 6174 6368  item(item="patch
+0001bfb0: 5f69 7465 6d22 2c20 7061 7274 6974 696f  _item", partitio
+0001bfc0: 6e5f 6b65 793d 2270 6174 6368 5f69 7465  n_key="patch_ite
+0001bfd0: 6d5f 706b 222c 2070 6174 6368 5f6f 7065  m_pk", patch_ope
+0001bfe0: 7261 7469 6f6e 733d 6f70 6572 6174 696f  rations=operatio
+0001bff0: 6e73 290a 2020 2020 2020 2020 6578 6365  ns).        exce
+0001c000: 7074 2065 7863 6570 7469 6f6e 732e 436f  pt exceptions.Co
+0001c010: 736d 6f73 4874 7470 5265 7370 6f6e 7365  smosHttpResponse
+0001c020: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
+0001c030: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001c040: 6572 7445 7175 616c 2865 2e73 7461 7475  ertEqual(e.statu
+0001c050: 735f 636f 6465 2c20 5374 6174 7573 436f  s_code, StatusCo
+0001c060: 6465 732e 4241 445f 5245 5155 4553 5429  des.BAD_REQUEST)
+0001c070: 0a0a 2020 2020 2020 2020 234e 6567 6174  ..        #Negat
+0001c080: 6976 6520 7465 7374 202d 2061 7474 656d  ive test - attem
+0001c090: 7074 2074 6f20 7265 6d6f 7665 206e 6f6e  pt to remove non
+0001c0a0: 2d65 7869 7374 656e 7420 6669 656c 640a  -existent field.
+0001c0b0: 2020 2020 2020 2020 6f70 6572 6174 696f          operatio
+0001c0c0: 6e73 203d 205b 7b22 6f70 223a 2022 7265  ns = [{"op": "re
+0001c0d0: 6d6f 7665 222c 2022 7061 7468 223a 2022  move", "path": "
+0001c0e0: 2f77 726f 6e67 5f66 6965 6c64 227d 5d0a  /wrong_field"}].
+0001c0f0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0001c100: 2020 2020 2020 2020 2063 7265 6174 6564           created
+0001c110: 5f63 6f6e 7461 696e 6572 2e70 6174 6368  _container.patch
+0001c120: 5f69 7465 6d28 6974 656d 3d22 7061 7463  _item(item="patc
+0001c130: 685f 6974 656d 222c 2070 6172 7469 7469  h_item", partiti
+0001c140: 6f6e 5f6b 6579 3d22 7061 7463 685f 6974  on_key="patch_it
+0001c150: 656d 5f70 6b22 2c20 7061 7463 685f 6f70  em_pk", patch_op
+0001c160: 6572 6174 696f 6e73 3d6f 7065 7261 7469  erations=operati
+0001c170: 6f6e 7329 0a20 2020 2020 2020 2065 7863  ons).        exc
+0001c180: 6570 7420 6578 6365 7074 696f 6e73 2e43  ept exceptions.C
+0001c190: 6f73 6d6f 7348 7474 7052 6573 706f 6e73  osmosHttpRespons
+0001c1a0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
+0001c1b0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0001c1c0: 7365 7274 4571 7561 6c28 652e 7374 6174  sertEqual(e.stat
+0001c1d0: 7573 5f63 6f64 652c 2053 7461 7475 7343  us_code, StatusC
+0001c1e0: 6f64 6573 2e42 4144 5f52 4551 5545 5354  odes.BAD_REQUEST
+0001c1f0: 290a 0a20 2020 2020 2020 2023 4e65 6761  )..        #Nega
+0001c200: 7469 7665 2074 6573 7420 2d20 6174 7465  tive test - atte
+0001c210: 6d70 7420 746f 2069 6e63 7265 6d65 6e74  mpt to increment
+0001c220: 206e 6f6e 2d6e 756d 6265 7220 6669 656c   non-number fiel
+0001c230: 640a 2020 2020 2020 2020 6f70 6572 6174  d.        operat
+0001c240: 696f 6e73 203d 205b 7b22 6f70 223a 2022  ions = [{"op": "
+0001c250: 696e 6372 222c 2022 7061 7468 223a 2022  incr", "path": "
+0001c260: 2f63 6f6d 7061 6e79 222c 2022 7661 6c75  /company", "valu
+0001c270: 6522 3a20 337d 5d0a 2020 2020 2020 2020  e": 3}].        
+0001c280: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001c290: 2063 7265 6174 6564 5f63 6f6e 7461 696e   created_contain
+0001c2a0: 6572 2e70 6174 6368 5f69 7465 6d28 6974  er.patch_item(it
+0001c2b0: 656d 3d22 7061 7463 685f 6974 656d 222c  em="patch_item",
+0001c2c0: 2070 6172 7469 7469 6f6e 5f6b 6579 3d22   partition_key="
+0001c2d0: 7061 7463 685f 6974 656d 5f70 6b22 2c20  patch_item_pk", 
+0001c2e0: 7061 7463 685f 6f70 6572 6174 696f 6e73  patch_operations
+0001c2f0: 3d6f 7065 7261 7469 6f6e 7329 0a20 2020  =operations).   
+0001c300: 2020 2020 2065 7863 6570 7420 6578 6365       except exce
+0001c310: 7074 696f 6e73 2e43 6f73 6d6f 7348 7474  ptions.CosmosHtt
+0001c320: 7052 6573 706f 6e73 6545 7272 6f72 2061  pResponseError a
+0001c330: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0001c340: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0001c350: 6c28 652e 7374 6174 7573 5f63 6f64 652c  l(e.status_code,
+0001c360: 2053 7461 7475 7343 6f64 6573 2e42 4144   StatusCodes.BAD
+0001c370: 5f52 4551 5545 5354 290a 0a20 2020 2020  _REQUEST)..     
+0001c380: 2020 2023 4e65 6761 7469 7665 2074 6573     #Negative tes
+0001c390: 7420 2d20 6174 7465 6d70 7420 746f 206d  t - attempt to m
+0001c3a0: 6f76 6520 6672 6f6d 206e 6f6e 2d65 7869  ove from non-exi
+0001c3b0: 7374 656e 7420 6669 656c 640a 2020 2020  stent field.    
+0001c3c0: 2020 2020 6f70 6572 6174 696f 6e73 203d      operations =
+0001c3d0: 205b 7b22 6f70 223a 2022 6d6f 7665 222c   [{"op": "move",
+0001c3e0: 2022 6672 6f6d 223a 2022 2f77 726f 6e67   "from": "/wrong
+0001c3f0: 5f66 6965 6c64 222c 2022 7061 7468 223a  _field", "path":
+0001c400: 2022 2f6f 7468 6572 5f66 6965 6c64 227d   "/other_field"}
+0001c410: 5d0a 2020 2020 2020 2020 7472 793a 0a20  ].        try:. 
+0001c420: 2020 2020 2020 2020 2020 2063 7265 6174             creat
+0001c430: 6564 5f63 6f6e 7461 696e 6572 2e70 6174  ed_container.pat
+0001c440: 6368 5f69 7465 6d28 6974 656d 3d22 7061  ch_item(item="pa
+0001c450: 7463 685f 6974 656d 222c 2070 6172 7469  tch_item", parti
+0001c460: 7469 6f6e 5f6b 6579 3d22 7061 7463 685f  tion_key="patch_
+0001c470: 6974 656d 5f70 6b22 2c20 7061 7463 685f  item_pk", patch_
+0001c480: 6f70 6572 6174 696f 6e73 3d6f 7065 7261  operations=opera
+0001c490: 7469 6f6e 7329 0a20 2020 2020 2020 2065  tions).        e
+0001c4a0: 7863 6570 7420 6578 6365 7074 696f 6e73  xcept exceptions
+0001c4b0: 2e43 6f73 6d6f 7348 7474 7052 6573 706f  .CosmosHttpRespo
+0001c4c0: 6e73 6545 7272 6f72 2061 7320 653a 0a20  nseError as e:. 
+0001c4d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001c4e0: 6173 7365 7274 4571 7561 6c28 652e 7374  assertEqual(e.st
+0001c4f0: 6174 7573 5f63 6f64 652c 2053 7461 7475  atus_code, Statu
+0001c500: 7343 6f64 6573 2e42 4144 5f52 4551 5545  sCodes.BAD_REQUE
+0001c510: 5354 290a 0a20 2020 2023 2054 656d 706f  ST)..    # Tempo
+0001c520: 7261 7269 6c79 2063 6f6d 6d65 6e74 696e  rarily commentin
+0001c530: 6720 616e 616c 7974 6963 616c 2073 746f  g analytical sto
+0001c540: 7261 6765 2074 6573 7473 2075 6e74 696c  rage tests until
+0001c550: 2065 6d75 6c61 746f 7220 7375 7070 6f72   emulator suppor
+0001c560: 7420 636f 6d65 732e 0a20 2020 2023 2064  t comes..    # d
+0001c570: 6566 2074 6573 745f 6372 6561 7465 5f63  ef test_create_c
+0001c580: 6f6e 7461 696e 6572 5f77 6974 685f 616e  ontainer_with_an
+0001c590: 616c 7974 6963 616c 5f73 746f 7265 5f6f  alytical_store_o
+0001c5a0: 6666 2873 656c 6629 3a0a 2020 2020 2320  ff(self):.    # 
+0001c5b0: 2020 2020 2320 646f 6e27 7420 7275 6e20      # don't run 
+0001c5c0: 7465 7374 2c20 666f 7220 7468 6520 7469  test, for the ti
+0001c5d0: 6d65 2062 6569 6e67 2c20 6966 2072 756e  me being, if run
+0001c5e0: 6e69 6e67 2061 6761 696e 7374 2074 6865  ning against the
+0001c5f0: 2065 6d75 6c61 746f 720a 2020 2020 2320   emulator.    # 
+0001c600: 2020 2020 6966 2027 6c6f 6361 6c68 6f73      if 'localhos
+0001c610: 7427 2069 6e20 7365 6c66 2e68 6f73 7420  t' in self.host 
+0001c620: 6f72 2027 3132 372e 302e 302e 3127 2069  or '127.0.0.1' i
+0001c630: 6e20 7365 6c66 2e68 6f73 743a 0a20 2020  n self.host:.   
+0001c640: 2023 2020 2020 2020 2020 2072 6574 7572   #         retur
+0001c650: 6e0a 0a20 2020 2023 2020 2020 2063 7265  n..    #     cre
+0001c660: 6174 6564 5f64 6220 3d20 7365 6c66 2e64  ated_db = self.d
+0001c670: 6174 6162 6173 6546 6f72 5465 7374 0a20  atabaseForTest. 
+0001c680: 2020 2023 2020 2020 2063 6f6c 6c65 6374     #     collect
+0001c690: 696f 6e5f 6964 203d 2027 7465 7374 5f63  ion_id = 'test_c
+0001c6a0: 7265 6174 655f 636f 6e74 6169 6e65 725f  reate_container_
+0001c6b0: 7769 7468 5f61 6e61 6c79 7469 6361 6c5f  with_analytical_
+0001c6c0: 7374 6f72 655f 6f66 665f 2720 2b20 7374  store_off_' + st
+0001c6d0: 7228 7575 6964 2e75 7569 6434 2829 290a  r(uuid.uuid4()).
+0001c6e0: 2020 2020 2320 2020 2020 636f 6c6c 6563      #     collec
+0001c6f0: 7469 6f6e 5f69 6e64 6578 696e 675f 706f  tion_indexing_po
+0001c700: 6c69 6379 203d 207b 2769 6e64 6578 696e  licy = {'indexin
+0001c710: 674d 6f64 6527 3a20 2763 6f6e 7369 7374  gMode': 'consist
+0001c720: 656e 7427 7d0a 2020 2020 2320 2020 2020  ent'}.    #     
+0001c730: 6372 6561 7465 645f 7265 636f 7264 6572  created_recorder
+0001c740: 203d 2052 6563 6f72 6444 6961 676e 6f73   = RecordDiagnos
+0001c750: 7469 6373 2829 0a20 2020 2023 2020 2020  tics().    #    
+0001c760: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
+0001c770: 696f 6e20 3d20 6372 6561 7465 645f 6462  ion = created_db
+0001c780: 2e63 7265 6174 655f 636f 6e74 6169 6e65  .create_containe
+0001c790: 7228 6964 3d63 6f6c 6c65 6374 696f 6e5f  r(id=collection_
+0001c7a0: 6964 2c0a 2020 2020 2320 2020 2020 2020  id,.    #       
+0001c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001c7e0: 6e64 6578 696e 675f 706f 6c69 6379 3d63  ndexing_policy=c
+0001c7f0: 6f6c 6c65 6374 696f 6e5f 696e 6465 7869  ollection_indexi
+0001c800: 6e67 5f70 6f6c 6963 792c 0a20 2020 2023  ng_policy,.    #
+0001c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c840: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+0001c850: 6b65 793d 5061 7274 6974 696f 6e4b 6579  key=PartitionKey
+0001c860: 2870 6174 683d 222f 706b 222c 206b 696e  (path="/pk", kin
+0001c870: 643d 2248 6173 6822 292c 200a 2020 2020  d="Hash"), .    
+0001c880: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0001c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8b0: 2020 2020 2020 2072 6573 706f 6e73 655f         response_
+0001c8c0: 686f 6f6b 3d63 7265 6174 6564 5f72 6563  hook=created_rec
+0001c8d0: 6f72 6465 7229 0a20 2020 2023 2020 2020  order).    #    
+0001c8e0: 2070 726f 7065 7274 6965 7320 3d20 6372   properties = cr
+0001c8f0: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+0001c900: 2e72 6561 6428 290a 2020 2020 2320 2020  .read().    #   
+0001c910: 2020 7474 6c5f 6b65 7920 3d20 2261 6e61    ttl_key = "ana
+0001c920: 6c79 7469 6361 6c53 746f 7261 6765 5474  lyticalStorageTt
+0001c930: 6c22 0a20 2020 2023 2020 2020 2073 656c  l".    #     sel
+0001c940: 662e 6173 7365 7274 5472 7565 2874 746c  f.assertTrue(ttl
+0001c950: 5f6b 6579 206e 6f74 2069 6e20 7072 6f70  _key not in prop
+0001c960: 6572 7469 6573 206f 7220 7072 6f70 6572  erties or proper
+0001c970: 7469 6573 5b74 746c 5f6b 6579 5d20 3d3d  ties[ttl_key] ==
+0001c980: 204e 6f6e 6529 0a0a 2020 2020 2320 6465   None)..    # de
+0001c990: 6620 7465 7374 5f63 7265 6174 655f 636f  f test_create_co
+0001c9a0: 6e74 6169 6e65 725f 7769 7468 5f61 6e61  ntainer_with_ana
+0001c9b0: 6c79 7469 6361 6c5f 7374 6f72 655f 6f6e  lytical_store_on
+0001c9c0: 2873 656c 6629 3a0a 2020 2020 2320 2020  (self):.    #   
+0001c9d0: 2020 2320 646f 6e27 7420 7275 6e20 7465    # don't run te
+0001c9e0: 7374 2c20 666f 7220 7468 6520 7469 6d65  st, for the time
+0001c9f0: 2062 6569 6e67 2c20 6966 2072 756e 6e69   being, if runni
+0001ca00: 6e67 2061 6761 696e 7374 2074 6865 2065  ng against the e
+0001ca10: 6d75 6c61 746f 720a 2020 2020 2320 2020  mulator.    #   
+0001ca20: 2020 6966 2027 6c6f 6361 6c68 6f73 7427    if 'localhost'
+0001ca30: 2069 6e20 7365 6c66 2e68 6f73 7420 6f72   in self.host or
+0001ca40: 2027 3132 372e 302e 302e 3127 2069 6e20   '127.0.0.1' in 
+0001ca50: 7365 6c66 2e68 6f73 743a 0a20 2020 2023  self.host:.    #
+0001ca60: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0001ca70: 0a20 2020 2023 2020 2020 2063 7265 6174  .    #     creat
+0001ca80: 6564 5f64 6220 3d20 7365 6c66 2e64 6174  ed_db = self.dat
+0001ca90: 6162 6173 6546 6f72 5465 7374 0a20 2020  abaseForTest.   
+0001caa0: 2023 2020 2020 2063 6f6c 6c65 6374 696f   #     collectio
+0001cab0: 6e5f 6964 203d 2027 7465 7374 5f63 7265  n_id = 'test_cre
+0001cac0: 6174 655f 636f 6e74 6169 6e65 725f 7769  ate_container_wi
+0001cad0: 7468 5f61 6e61 6c79 7469 6361 6c5f 7374  th_analytical_st
+0001cae0: 6f72 655f 6f6e 5f27 202b 2073 7472 2875  ore_on_' + str(u
+0001caf0: 7569 642e 7575 6964 3428 2929 0a20 2020  uid.uuid4()).   
+0001cb00: 2023 2020 2020 2063 6f6c 6c65 6374 696f   #     collectio
+0001cb10: 6e5f 696e 6465 7869 6e67 5f70 6f6c 6963  n_indexing_polic
+0001cb20: 7920 3d20 7b27 696e 6465 7869 6e67 4d6f  y = {'indexingMo
+0001cb30: 6465 273a 2027 636f 6e73 6973 7465 6e74  de': 'consistent
+0001cb40: 277d 0a20 2020 2023 2020 2020 2063 7265  '}.    #     cre
+0001cb50: 6174 6564 5f72 6563 6f72 6465 7220 3d20  ated_recorder = 
+0001cb60: 5265 636f 7264 4469 6167 6e6f 7374 6963  RecordDiagnostic
+0001cb70: 7328 290a 2020 2020 2320 2020 2020 6372  s().    #     cr
+0001cb80: 6561 7465 645f 636f 6c6c 6563 7469 6f6e  eated_collection
+0001cb90: 203d 2063 7265 6174 6564 5f64 622e 6372   = created_db.cr
+0001cba0: 6561 7465 5f63 6f6e 7461 696e 6572 2869  eate_container(i
+0001cbb0: 643d 636f 6c6c 6563 7469 6f6e 5f69 642c  d=collection_id,
+0001cbc0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbf0: 2020 2020 2020 2020 2020 2020 616e 616c              anal
+0001cc00: 7974 6963 616c 5f73 746f 7261 6765 5f74  ytical_storage_t
+0001cc10: 746c 3d2d 312c 0a20 2020 2023 2020 2020  tl=-1,.    #    
+0001cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc50: 2020 696e 6465 7869 6e67 5f70 6f6c 6963    indexing_polic
+0001cc60: 793d 636f 6c6c 6563 7469 6f6e 5f69 6e64  y=collection_ind
+0001cc70: 6578 696e 675f 706f 6c69 6379 2c0a 2020  exing_policy,.  
+0001cc80: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0001cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccb0: 2020 2020 2020 2020 2070 6172 7469 7469           partiti
+0001ccc0: 6f6e 5f6b 6579 3d50 6172 7469 7469 6f6e  on_key=Partition
+0001ccd0: 4b65 7928 7061 7468 3d22 2f70 6b22 2c20  Key(path="/pk", 
+0001cce0: 6b69 6e64 3d22 4861 7368 2229 2c20 0a20  kind="Hash"), . 
+0001ccf0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0001cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd20: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
+0001cd30: 7365 5f68 6f6f 6b3d 6372 6561 7465 645f  se_hook=created_
+0001cd40: 7265 636f 7264 6572 290a 2020 2020 2320  recorder).    # 
+0001cd50: 2020 2020 7072 6f70 6572 7469 6573 203d      properties =
+0001cd60: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
+0001cd70: 696f 6e2e 7265 6164 2829 0a20 2020 2023  ion.read().    #
+0001cd80: 2020 2020 2074 746c 5f6b 6579 203d 2022       ttl_key = "
+0001cd90: 616e 616c 7974 6963 616c 5374 6f72 6167  analyticalStorag
+0001cda0: 6554 746c 220a 2020 2020 2320 2020 2020  eTtl".    #     
+0001cdb0: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
+0001cdc0: 7474 6c5f 6b65 7920 696e 2070 726f 7065  ttl_key in prope
+0001cdd0: 7274 6965 7320 616e 6420 7072 6f70 6572  rties and proper
+0001cde0: 7469 6573 5b74 746c 5f6b 6579 5d20 3d3d  ties[ttl_key] ==
+0001cdf0: 202d 3129 0a0a 2020 2020 2320 6465 6620   -1)..    # def 
+0001ce00: 7465 7374 5f63 7265 6174 655f 636f 6e74  test_create_cont
+0001ce10: 6169 6e65 725f 6966 5f6e 6f74 5f65 7869  ainer_if_not_exi
+0001ce20: 7374 735f 7769 7468 5f61 6e61 6c79 7469  sts_with_analyti
+0001ce30: 6361 6c5f 7374 6f72 655f 6f6e 2873 656c  cal_store_on(sel
+0001ce40: 6629 3a0a 2020 2020 2320 2020 2020 2320  f):.    #     # 
+0001ce50: 646f 6e27 7420 7275 6e20 7465 7374 2c20  don't run test, 
+0001ce60: 666f 7220 7468 6520 7469 6d65 2062 6569  for the time bei
+0001ce70: 6e67 2c20 6966 2072 756e 6e69 6e67 2061  ng, if running a
+0001ce80: 6761 696e 7374 2074 6865 2065 6d75 6c61  gainst the emula
+0001ce90: 746f 720a 2020 2020 2320 2020 2020 6966  tor.    #     if
+0001cea0: 2027 6c6f 6361 6c68 6f73 7427 2069 6e20   'localhost' in 
+0001ceb0: 7365 6c66 2e68 6f73 7420 6f72 2027 3132  self.host or '12
+0001cec0: 372e 302e 302e 3127 2069 6e20 7365 6c66  7.0.0.1' in self
+0001ced0: 2e68 6f73 743a 0a20 2020 2023 2020 2020  .host:.    #    
+0001cee0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+0001cef0: 2023 2020 2020 2023 2066 6972 7374 2c20   #     # first, 
+0001cf00: 7472 7920 7768 656e 2077 6520 6b6e 6f77  try when we know
+0001cf10: 2074 6865 2063 6f6e 7461 696e 6572 2064   the container d
+0001cf20: 6f65 736e 2774 2065 7869 7374 2e0a 2020  oesn't exist..  
+0001cf30: 2020 2320 2020 2020 6372 6561 7465 645f    #     created_
+0001cf40: 6462 203d 2073 656c 662e 6461 7461 6261  db = self.databa
+0001cf50: 7365 466f 7254 6573 740a 2020 2020 2320  seForTest.    # 
+0001cf60: 2020 2020 636f 6c6c 6563 7469 6f6e 5f69      collection_i
+0001cf70: 6420 3d20 2774 6573 745f 6372 6561 7465  d = 'test_create
+0001cf80: 5f63 6f6e 7461 696e 6572 5f69 665f 6e6f  _container_if_no
+0001cf90: 745f 6578 6973 7473 5f77 6974 685f 616e  t_exists_with_an
+0001cfa0: 616c 7974 6963 616c 5f73 746f 7265 5f6f  alytical_store_o
+0001cfb0: 6e5f 2720 2b20 7374 7228 7575 6964 2e75  n_' + str(uuid.u
+0001cfc0: 7569 6434 2829 290a 2020 2020 2320 2020  uid4()).    #   
+0001cfd0: 2020 636f 6c6c 6563 7469 6f6e 5f69 6e64    collection_ind
+0001cfe0: 6578 696e 675f 706f 6c69 6379 203d 207b  exing_policy = {
+0001cff0: 2769 6e64 6578 696e 674d 6f64 6527 3a20  'indexingMode': 
+0001d000: 2763 6f6e 7369 7374 656e 7427 7d0a 2020  'consistent'}.  
+0001d010: 2020 2320 2020 2020 6372 6561 7465 645f    #     created_
+0001d020: 7265 636f 7264 6572 203d 2052 6563 6f72  recorder = Recor
+0001d030: 6444 6961 676e 6f73 7469 6373 2829 0a20  dDiagnostics(). 
+0001d040: 2020 2023 2020 2020 2063 7265 6174 6564     #     created
+0001d050: 5f63 6f6c 6c65 6374 696f 6e20 3d20 6372  _collection = cr
+0001d060: 6561 7465 645f 6462 2e63 7265 6174 655f  eated_db.create_
+0001d070: 636f 6e74 6169 6e65 725f 6966 5f6e 6f74  container_if_not
+0001d080: 5f65 7869 7374 7328 6964 3d63 6f6c 6c65  _exists(id=colle
+0001d090: 6374 696f 6e5f 6964 2c0a 2020 2020 2320  ction_id,.    # 
+0001d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0e0: 2020 2061 6e61 6c79 7469 6361 6c5f 7374     analytical_st
+0001d0f0: 6f72 6167 655f 7474 6c3d 2d31 2c0a 2020  orage_ttl=-1,.  
+0001d100: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0001d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d140: 2020 2020 2020 2069 6e64 6578 696e 675f         indexing_
+0001d150: 706f 6c69 6379 3d63 6f6c 6c65 6374 696f  policy=collectio
+0001d160: 6e5f 696e 6465 7869 6e67 5f70 6f6c 6963  n_indexing_polic
+0001d170: 792c 0a20 2020 2023 2020 2020 2020 2020  y,.    #        
+0001d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1b0: 2020 2020 2020 2020 2020 2020 7061 7274              part
+0001d1c0: 6974 696f 6e5f 6b65 793d 5061 7274 6974  ition_key=Partit
+0001d1d0: 696f 6e4b 6579 2870 6174 683d 222f 706b  ionKey(path="/pk
+0001d1e0: 222c 206b 696e 643d 2248 6173 6822 292c  ", kind="Hash"),
+0001d1f0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0001d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d230: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
+0001d240: 7365 5f68 6f6f 6b3d 6372 6561 7465 645f  se_hook=created_
+0001d250: 7265 636f 7264 6572 290a 2020 2020 2320  recorder).    # 
+0001d260: 2020 2020 7072 6f70 6572 7469 6573 203d      properties =
+0001d270: 2063 7265 6174 6564 5f63 6f6c 6c65 6374   created_collect
+0001d280: 696f 6e2e 7265 6164 2829 0a20 2020 2023  ion.read().    #
+0001d290: 2020 2020 2074 746c 5f6b 6579 203d 2022       ttl_key = "
+0001d2a0: 616e 616c 7974 6963 616c 5374 6f72 6167  analyticalStorag
+0001d2b0: 6554 746c 220a 2020 2020 2320 2020 2020  eTtl".    #     
+0001d2c0: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
+0001d2d0: 7474 6c5f 6b65 7920 696e 2070 726f 7065  ttl_key in prope
+0001d2e0: 7274 6965 7320 616e 6420 7072 6f70 6572  rties and proper
+0001d2f0: 7469 6573 5b74 746c 5f6b 6579 5d20 3d3d  ties[ttl_key] ==
+0001d300: 202d 3129 0a0a 2020 2020 2320 2020 2020   -1)..    #     
+0001d310: 2320 6e65 7874 2c20 7472 7920 7768 656e  # next, try when
+0001d320: 2077 6520 6b6e 6f77 2074 6865 2063 6f6e   we know the con
+0001d330: 7461 696e 6572 2044 4f45 5320 6578 6973  tainer DOES exis
+0001d340: 742e 2054 6869 7320 7761 7920 626f 7468  t. This way both
+0001d350: 2063 6f64 6520 7061 7468 7320 6172 6520   code paths are 
+0001d360: 7465 7374 6564 2e0a 2020 2020 2320 2020  tested..    #   
+0001d370: 2020 6372 6561 7465 645f 636f 6c6c 6563    created_collec
+0001d380: 7469 6f6e 203d 2063 7265 6174 6564 5f64  tion = created_d
+0001d390: 622e 6372 6561 7465 5f63 6f6e 7461 696e  b.create_contain
+0001d3a0: 6572 5f69 665f 6e6f 745f 6578 6973 7473  er_if_not_exists
+0001d3b0: 2869 643d 636f 6c6c 6563 7469 6f6e 5f69  (id=collection_i
+0001d3c0: 642c 0a20 2020 2023 2020 2020 2020 2020  d,.    #        
+0001d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d400: 2020 2020 2020 2020 2020 2020 616e 616c              anal
+0001d410: 7974 6963 616c 5f73 746f 7261 6765 5f74  ytical_storage_t
+0001d420: 746c 3d2d 312c 0a20 2020 2023 2020 2020  tl=-1,.    #    
+0001d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d470: 696e 6465 7869 6e67 5f70 6f6c 6963 793d  indexing_policy=
+0001d480: 636f 6c6c 6563 7469 6f6e 5f69 6e64 6578  collection_index
+0001d490: 696e 675f 706f 6c69 6379 2c0a 2020 2020  ing_policy,.    
+0001d4a0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0001d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4e0: 2020 2020 2070 6172 7469 7469 6f6e 5f6b       partition_k
+0001d4f0: 6579 3d50 6172 7469 7469 6f6e 4b65 7928  ey=PartitionKey(
+0001d500: 7061 7468 3d22 2f70 6b22 2c20 6b69 6e64  path="/pk", kind
+0001d510: 3d22 4861 7368 2229 2c0a 2020 2020 2320  ="Hash"),.    # 
+0001d520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d560: 2020 2072 6573 706f 6e73 655f 686f 6f6b     response_hook
+0001d570: 3d63 7265 6174 6564 5f72 6563 6f72 6465  =created_recorde
+0001d580: 7229 0a20 2020 2023 2020 2020 2070 726f  r).    #     pro
+0001d590: 7065 7274 6965 7320 3d20 6372 6561 7465  perties = create
+0001d5a0: 645f 636f 6c6c 6563 7469 6f6e 2e72 6561  d_collection.rea
+0001d5b0: 6428 290a 2020 2020 2320 2020 2020 7474  d().    #     tt
+0001d5c0: 6c5f 6b65 7920 3d20 2261 6e61 6c79 7469  l_key = "analyti
+0001d5d0: 6361 6c53 746f 7261 6765 5474 6c22 0a20  calStorageTtl". 
+0001d5e0: 2020 2023 2020 2020 2073 656c 662e 6173     #     self.as
+0001d5f0: 7365 7274 5472 7565 2874 746c 5f6b 6579  sertTrue(ttl_key
+0001d600: 2069 6e20 7072 6f70 6572 7469 6573 2061   in properties a
+0001d610: 6e64 2070 726f 7065 7274 6965 735b 7474  nd properties[tt
+0001d620: 6c5f 6b65 795d 203d 3d20 2d31 290a 0a20  l_key] == -1).. 
+0001d630: 2020 2064 6566 205f 4d6f 636b 4578 6563     def _MockExec
+0001d640: 7574 6546 756e 6374 696f 6e28 7365 6c66  uteFunction(self
+0001d650: 2c20 6675 6e63 7469 6f6e 2c20 2a61 7267  , function, *arg
+0001d660: 732c 202a 2a6b 7761 7267 7329 3a0a 2020  s, **kwargs):.  
+0001d670: 2020 2020 2020 7365 6c66 2e6c 6173 745f        self.last_
+0001d680: 6865 6164 6572 732e 6170 7065 6e64 2861  headers.append(a
+0001d690: 7267 735b 345d 2e68 6561 6465 7273 5b48  rgs[4].headers[H
+0001d6a0: 7474 7048 6561 6465 7273 2e50 6172 7469  ttpHeaders.Parti
+0001d6b0: 7469 6f6e 4b65 795d 0a20 2020 2020 2020  tionKey].       
+0001d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001d6e0: 4874 7470 4865 6164 6572 732e 5061 7274  HttpHeaders.Part
+0001d6f0: 6974 696f 6e4b 6579 2069 6e20 6172 6773  itionKey in args
+0001d700: 5b34 5d2e 6865 6164 6572 7320 656c 7365  [4].headers else
+0001d710: 2027 2729 0a20 2020 2020 2020 2072 6574   '').        ret
+0001d720: 7572 6e20 7365 6c66 2e4f 7269 6769 6e61  urn self.Origina
+0001d730: 6c45 7865 6375 7465 4675 6e63 7469 6f6e  lExecuteFunction
+0001d740: 2866 756e 6374 696f 6e2c 202a 6172 6773  (function, *args
+0001d750: 2c20 2a2a 6b77 6172 6773 290a 0a69 6620  , **kwargs)..if 
+0001d760: 5f5f 6e61 6d65 5f5f 203d 3d20 275f 5f6d  __name__ == '__m
+0001d770: 6169 6e5f 5f27 3a0a 2020 2020 7472 793a  ain__':.    try:
+0001d780: 0a20 2020 2020 2020 2075 6e69 7474 6573  .        unittes
+0001d790: 742e 6d61 696e 2829 0a20 2020 2065 7863  t.main().    exc
+0001d7a0: 6570 7420 5379 7374 656d 4578 6974 2061  ept SystemExit a
+0001d7b0: 7320 696e 7374 3a0a 2020 2020 2020 2020  s inst:.        
+0001d7c0: 6966 2069 6e73 742e 6172 6773 5b30 5d20  if inst.args[0] 
+0001d7d0: 6973 2054 7275 653a 2020 2320 7261 6973  is True:  # rais
+0001d7e0: 6564 2062 7920 7379 732e 6578 6974 2854  ed by sys.exit(T
+0001d7f0: 7275 6529 2077 6865 6e20 7465 7374 7320  rue) when tests 
+0001d800: 6661 696c 6564 0a20 2020 2020 2020 2020  failed.         
+0001d810: 2020 2072 6169 7365 0a                      raise.
```

## Comparing `azure-cosmos-4.3.1b1/test/test_globaldb.py` & `azure-cosmos-4.4.0b1/test/test_globaldb.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_session.py` & `azure-cosmos-4.4.0b1/test/test_session.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_routing_map.py` & `azure-cosmos-4.4.0b1/test/test_routing_map.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_proxy.py` & `azure-cosmos-4.4.0b1/test/test_proxy.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_diagnostics.py` & `azure-cosmos-4.4.0b1/test/test_diagnostics.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/conftest.py` & `azure-cosmos-4.4.0b1/test/conftest.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_query.py` & `azure-cosmos-4.4.0b1/test/test_query.py`

 * *Files 27% similar despite different names*

```diff
@@ -9,14 +9,15 @@
 from azure.cosmos.documents import _DistinctType
 import pytest
 import collections
 import test_config
 
 pytestmark = pytest.mark.cosmosEmulator
 
+
 @pytest.mark.usefixtures("teardown")
 class QueryTest(unittest.TestCase):
     """Test to ensure escaping of non-ascii characters from partition key"""
 
     config = test_config._test_config
     host = config.host
     masterKey = config.masterKey
@@ -47,26 +48,237 @@
             query=query,
             partition_key='pk'
         )
         iter_list = list(query_iterable)
         self.assertEqual(iter_list[0]['id'], doc_id)
 
     def test_query_change_feed_with_pk(self):
-        self.query_change_feed(True)
+        created_collection = self.created_db.create_container_if_not_exists("change_feed_test_" + str(uuid.uuid4()),
+                                                                            PartitionKey(path="/pk"))
+        # The test targets partition #3
+        partition_key = "pk"
+
+        # Read change feed without passing any options
+        query_iterable = created_collection.query_items_change_feed()
+        iter_list = list(query_iterable)
+        self.assertEqual(len(iter_list), 0)
+
+        # Read change feed from current should return an empty list
+        query_iterable = created_collection.query_items_change_feed(partition_key=partition_key)
+        iter_list = list(query_iterable)
+        self.assertEqual(len(iter_list), 0)
+        self.assertTrue('etag' in created_collection.client_connection.last_response_headers)
+        self.assertNotEqual(created_collection.client_connection.last_response_headers['etag'], '')
+
+        # Read change feed from beginning should return an empty list
+        query_iterable = created_collection.query_items_change_feed(
+            is_start_from_beginning=True,
+            partition_key=partition_key
+        )
+        iter_list = list(query_iterable)
+        self.assertEqual(len(iter_list), 0)
+        self.assertTrue('etag' in created_collection.client_connection.last_response_headers)
+        continuation1 = created_collection.client_connection.last_response_headers['etag']
+        self.assertNotEqual(continuation1, '')
+
+        # Create a document. Read change feed should return be able to read that document
+        document_definition = {'pk': 'pk', 'id': 'doc1'}
+        created_collection.create_item(body=document_definition)
+        query_iterable = created_collection.query_items_change_feed(
+            is_start_from_beginning=True,
+            partition_key=partition_key
+        )
+        iter_list = list(query_iterable)
+        self.assertEqual(len(iter_list), 1)
+        self.assertEqual(iter_list[0]['id'], 'doc1')
+        self.assertTrue('etag' in created_collection.client_connection.last_response_headers)
+        continuation2 = created_collection.client_connection.last_response_headers['etag']
+        self.assertNotEqual(continuation2, '')
+        self.assertNotEqual(continuation2, continuation1)
+
+        # Create two new documents. Verify that change feed contains the 2 new documents
+        # with page size 1 and page size 100
+        document_definition = {'pk': 'pk', 'id': 'doc2'}
+        created_collection.create_item(body=document_definition)
+        document_definition = {'pk': 'pk', 'id': 'doc3'}
+        created_collection.create_item(body=document_definition)
+
+        for pageSize in [1, 100]:
+            # verify iterator
+            query_iterable = created_collection.query_items_change_feed(
+                continuation=continuation2,
+                max_item_count=pageSize,
+                partition_key=partition_key
+            )
+            it = query_iterable.__iter__()
+            expected_ids = 'doc2.doc3.'
+            actual_ids = ''
+            for item in it:
+                actual_ids += item['id'] + '.'
+            self.assertEqual(actual_ids, expected_ids)
+
+            # verify by_page
+            # the options is not copied, therefore it need to be restored
+            query_iterable = created_collection.query_items_change_feed(
+                continuation=continuation2,
+                max_item_count=pageSize,
+                partition_key=partition_key
+            )
+            count = 0
+            expected_count = 2
+            all_fetched_res = []
+            for page in query_iterable.by_page():
+                fetched_res = list(page)
+                self.assertEqual(len(fetched_res), min(pageSize, expected_count - count))
+                count += len(fetched_res)
+                all_fetched_res.extend(fetched_res)
+
+            actual_ids = ''
+            for item in all_fetched_res:
+                actual_ids += item['id'] + '.'
+            self.assertEqual(actual_ids, expected_ids)
+
+        # verify reading change feed from the beginning
+        query_iterable = created_collection.query_items_change_feed(
+            is_start_from_beginning=True,
+            partition_key=partition_key
+        )
+        expected_ids = ['doc1', 'doc2', 'doc3']
+        it = query_iterable.__iter__()
+        for i in range(0, len(expected_ids)):
+            doc = next(it)
+            self.assertEqual(doc['id'], expected_ids[i])
+        self.assertTrue('etag' in created_collection.client_connection.last_response_headers)
+        continuation3 = created_collection.client_connection.last_response_headers['etag']
+
+        # verify reading empty change feed
+        query_iterable = created_collection.query_items_change_feed(
+            continuation=continuation3,
+            is_start_from_beginning=True,
+            partition_key=partition_key
+        )
+        iter_list = list(query_iterable)
+        self.assertEqual(len(iter_list), 0)
 
     def test_query_change_feed_with_pk_range_id(self):
-        self.query_change_feed(False)
+        created_collection = self.created_db.create_container_if_not_exists("change_feed_test_" + str(uuid.uuid4()),
+                                                                            PartitionKey(path="/pk"))
+        # The test targets partition #3
+        partition_key_range_id = 0
+        partitionParam = {"partition_key_range_id": partition_key_range_id}
 
+        # Read change feed without passing any options
+        query_iterable = created_collection.query_items_change_feed()
+        iter_list = list(query_iterable)
+        self.assertEqual(len(iter_list), 0)
+
+        # Read change feed from current should return an empty list
+        query_iterable = created_collection.query_items_change_feed(**partitionParam)
+        iter_list = list(query_iterable)
+        self.assertEqual(len(iter_list), 0)
+        self.assertTrue('etag' in created_collection.client_connection.last_response_headers)
+        self.assertNotEqual(created_collection.client_connection.last_response_headers['etag'], '')
+
+        # Read change feed from beginning should return an empty list
+        query_iterable = created_collection.query_items_change_feed(
+            is_start_from_beginning=True,
+            **partitionParam
+        )
+        iter_list = list(query_iterable)
+        self.assertEqual(len(iter_list), 0)
+        self.assertTrue('etag' in created_collection.client_connection.last_response_headers)
+        continuation1 = created_collection.client_connection.last_response_headers['etag']
+        self.assertNotEqual(continuation1, '')
+
+        # Create a document. Read change feed should return be able to read that document
+        document_definition = {'pk': 'pk', 'id': 'doc1'}
+        created_collection.create_item(body=document_definition)
+        query_iterable = created_collection.query_items_change_feed(
+            is_start_from_beginning=True,
+            **partitionParam
+        )
+        iter_list = list(query_iterable)
+        self.assertEqual(len(iter_list), 1)
+        self.assertEqual(iter_list[0]['id'], 'doc1')
+        self.assertTrue('etag' in created_collection.client_connection.last_response_headers)
+        continuation2 = created_collection.client_connection.last_response_headers['etag']
+        self.assertNotEqual(continuation2, '')
+        self.assertNotEqual(continuation2, continuation1)
+
+        # Create two new documents. Verify that change feed contains the 2 new documents
+        # with page size 1 and page size 100
+        document_definition = {'pk': 'pk', 'id': 'doc2'}
+        created_collection.create_item(body=document_definition)
+        document_definition = {'pk': 'pk', 'id': 'doc3'}
+        created_collection.create_item(body=document_definition)
+
+        for pageSize in [1, 100]:
+            # verify iterator
+            query_iterable = created_collection.query_items_change_feed(
+                continuation=continuation2,
+                max_item_count=pageSize,
+                **partitionParam
+            )
+            it = query_iterable.__iter__()
+            expected_ids = 'doc2.doc3.'
+            actual_ids = ''
+            for item in it:
+                actual_ids += item['id'] + '.'
+            self.assertEqual(actual_ids, expected_ids)
+
+            # verify by_page
+            # the options is not copied, therefore it need to be restored
+            query_iterable = created_collection.query_items_change_feed(
+                continuation=continuation2,
+                max_item_count=pageSize,
+                **partitionParam
+            )
+            count = 0
+            expected_count = 2
+            all_fetched_res = []
+            for page in query_iterable.by_page():
+                fetched_res = list(page)
+                self.assertEqual(len(fetched_res), min(pageSize, expected_count - count))
+                count += len(fetched_res)
+                all_fetched_res.extend(fetched_res)
+
+            actual_ids = ''
+            for item in all_fetched_res:
+                actual_ids += item['id'] + '.'
+            self.assertEqual(actual_ids, expected_ids)
+
+        # verify reading change feed from the beginning
+        query_iterable = created_collection.query_items_change_feed(
+            is_start_from_beginning=True,
+            **partitionParam
+        )
+        expected_ids = ['doc1', 'doc2', 'doc3']
+        it = query_iterable.__iter__()
+        for i in range(0, len(expected_ids)):
+            doc = next(it)
+            self.assertEqual(doc['id'], expected_ids[i])
+        self.assertTrue('etag' in created_collection.client_connection.last_response_headers)
+        continuation3 = created_collection.client_connection.last_response_headers['etag']
+
+        # verify reading empty change feed
+        query_iterable = created_collection.query_items_change_feed(
+            continuation=continuation3,
+            is_start_from_beginning=True,
+            **partitionParam
+        )
+        iter_list = list(query_iterable)
+        self.assertEqual(len(iter_list), 0)
     def query_change_feed(self, use_partition_key):
         created_collection = self.created_db.create_container_if_not_exists("change_feed_test_" + str(uuid.uuid4()),
                                                                             PartitionKey(path="/pk"))
         # The test targets partition #3
         partition_key = "pk"
         partition_key_range_id = 0
-        partitionParam = {"partition_key": partition_key} if use_partition_key else {"partition_key_range_id": partition_key_range_id}
+        partitionParam = {"partition_key": partition_key} if use_partition_key else {
+            "partition_key_range_id": partition_key_range_id}
 
         # Read change feed without passing any options
         query_iterable = created_collection.query_items_change_feed()
         iter_list = list(query_iterable)
         self.assertEqual(len(iter_list), 0)
 
         # Read change feed from current should return an empty list
@@ -163,15 +375,16 @@
             is_start_from_beginning=True,
             **partitionParam
         )
         iter_list = list(query_iterable)
         self.assertEqual(len(iter_list), 0)
 
     def test_populate_query_metrics(self):
-        created_collection = self.created_db.create_container_if_not_exists("query_metrics_test", PartitionKey(path="/pk"))
+        created_collection = self.created_db.create_container_if_not_exists("query_metrics_test",
+                                                                            PartitionKey(path="/pk"))
         doc_id = 'MyId' + str(uuid.uuid4())
         document_definition = {'pk': 'pk', 'id': doc_id}
         created_collection.create_item(body=document_definition)
 
         query = 'SELECT * from c'
         query_iterable = created_collection.query_items(
             query=query,
@@ -257,15 +470,16 @@
                                   order_by=['Ascending'],
                                   aggregate=[],
                                   select_value=True,
                                   offset=None,
                                   limit=None,
                                   distinct=_DistinctType.Ordered)
 
-    def _validate_query_plan(self, query, container_link, top, order_by, aggregate, select_value, offset, limit, distinct):
+    def _validate_query_plan(self, query, container_link, top, order_by, aggregate, select_value, offset, limit,
+                             distinct):
         query_plan_dict = self.client.client_connection._GetQueryPlanThroughGateway(query, container_link)
         query_execution_info = _PartitionedQueryExecutionInfo(query_plan_dict)
         self.assertTrue(query_execution_info.has_rewritten_query())
         self.assertEqual(query_execution_info.has_distinct_type(), distinct != "None")
         self.assertEqual(query_execution_info.get_distinct_type(), distinct)
         self.assertEqual(query_execution_info.has_top(), top is not None)
         self.assertEqual(query_execution_info.get_top(), top)
@@ -290,15 +504,16 @@
                 self.fail()
             except exceptions.CosmosHttpResponseError as e:
                 self.assertEqual(e.status_code, 400)
 
     def test_query_with_non_overlapping_pk_ranges(self):
         created_collection = self.created_db.create_container_if_not_exists(
             self.config.TEST_COLLECTION_MULTI_PARTITION_WITH_CUSTOM_PK_ID, PartitionKey(path="/pk"))
-        query_iterable = created_collection.query_items("select * from c where c.pk='1' or c.pk='2'", enable_cross_partition_query=True)
+        query_iterable = created_collection.query_items("select * from c where c.pk='1' or c.pk='2'",
+                                                        enable_cross_partition_query=True)
         self.assertListEqual(list(query_iterable), [])
 
     def test_offset_limit(self):
         created_collection = self.created_db.create_container_if_not_exists("offset_limit_test_" + str(uuid.uuid4()),
                                                                             PartitionKey(path="/pk"))
         values = []
         for i in range(10):
@@ -337,16 +552,18 @@
         different_field = "different_field"
 
         created_collection = created_database.create_container(
             id='collection with composite index ' + str(uuid.uuid4()),
             partition_key=PartitionKey(path="/pk", kind="Hash"),
             indexing_policy={
                 "compositeIndexes": [
-                    [{"path": "/" + pk_field, "order": "ascending"}, {"path": "/" + distinct_field, "order": "ascending"}],
-                    [{"path": "/" + distinct_field, "order": "ascending"}, {"path": "/" + pk_field, "order": "ascending"}]
+                    [{"path": "/" + pk_field, "order": "ascending"},
+                     {"path": "/" + distinct_field, "order": "ascending"}],
+                    [{"path": "/" + distinct_field, "order": "ascending"},
+                     {"path": "/" + pk_field, "order": "ascending"}]
                 ]
             }
         )
         documents = []
         for i in range(5):
             j = i
             while j > i - 5:
@@ -357,57 +574,70 @@
                 document_definition = {pk_field: i, 'id': str(uuid.uuid4())}
                 documents.append(created_collection.create_item(body=document_definition))
                 j -= 1
 
         padded_docs = self._pad_with_none(documents, distinct_field)
 
         self._validate_distinct(created_collection=created_collection,
-                                query='SELECT distinct c.%s from c ORDER BY c.%s' % (distinct_field, distinct_field),   # nosec
-                                results=self._get_distinct_docs(self._get_order_by_docs(padded_docs, distinct_field, None), distinct_field, None, True),
+                                query='SELECT distinct c.%s from c ORDER BY c.%s' % (distinct_field, distinct_field),
+                                # nosec
+                                results=self._get_distinct_docs(
+                                    self._get_order_by_docs(padded_docs, distinct_field, None), distinct_field, None,
+                                    True),
                                 is_select=False,
                                 fields=[distinct_field])
 
         self._validate_distinct(created_collection=created_collection,
-                                query='SELECT distinct c.%s, c.%s from c ORDER BY c.%s, c.%s' % (distinct_field, pk_field, pk_field, distinct_field),   # nosec
-                                results=self._get_distinct_docs(self._get_order_by_docs(padded_docs, pk_field, distinct_field), distinct_field, pk_field, True),
+                                query='SELECT distinct c.%s, c.%s from c ORDER BY c.%s, c.%s' % (
+                                    distinct_field, pk_field, pk_field, distinct_field),  # nosec
+                                results=self._get_distinct_docs(
+                                    self._get_order_by_docs(padded_docs, pk_field, distinct_field), distinct_field,
+                                    pk_field, True),
                                 is_select=False,
                                 fields=[distinct_field, pk_field])
 
         self._validate_distinct(created_collection=created_collection,
-                                query='SELECT distinct c.%s, c.%s from c ORDER BY c.%s, c.%s' % (distinct_field, pk_field, distinct_field, pk_field),   # nosec
-                                results=self._get_distinct_docs(self._get_order_by_docs(padded_docs, distinct_field, pk_field), distinct_field, pk_field, True),
+                                query='SELECT distinct c.%s, c.%s from c ORDER BY c.%s, c.%s' % (
+                                    distinct_field, pk_field, distinct_field, pk_field),  # nosec
+                                results=self._get_distinct_docs(
+                                    self._get_order_by_docs(padded_docs, distinct_field, pk_field), distinct_field,
+                                    pk_field, True),
                                 is_select=False,
                                 fields=[distinct_field, pk_field])
 
         self._validate_distinct(created_collection=created_collection,
-                                query='SELECT distinct value c.%s from c ORDER BY c.%s' % (distinct_field, distinct_field), # nosec
-                                results=self._get_distinct_docs(self._get_order_by_docs(padded_docs, distinct_field, None), distinct_field, None, True),
+                                query='SELECT distinct value c.%s from c ORDER BY c.%s' % (
+                                    distinct_field, distinct_field),  # nosec
+                                results=self._get_distinct_docs(
+                                    self._get_order_by_docs(padded_docs, distinct_field, None), distinct_field, None,
+                                    True),
                                 is_select=False,
                                 fields=[distinct_field])
 
         self._validate_distinct(created_collection=created_collection,  # returns {} and is right number
-                                query='SELECT distinct c.%s from c' % (distinct_field), # nosec
+                                query='SELECT distinct c.%s from c' % (distinct_field),  # nosec
                                 results=self._get_distinct_docs(padded_docs, distinct_field, None, False),
                                 is_select=True,
                                 fields=[distinct_field])
 
         self._validate_distinct(created_collection=created_collection,
-                                query='SELECT distinct c.%s, c.%s from c' % (distinct_field, pk_field), # nosec
+                                query='SELECT distinct c.%s, c.%s from c' % (distinct_field, pk_field),  # nosec
                                 results=self._get_distinct_docs(padded_docs, distinct_field, pk_field, False),
                                 is_select=True,
                                 fields=[distinct_field, pk_field])
 
         self._validate_distinct(created_collection=created_collection,
-                                query='SELECT distinct value c.%s from c' % (distinct_field),   # nosec
+                                query='SELECT distinct value c.%s from c' % (distinct_field),  # nosec
                                 results=self._get_distinct_docs(padded_docs, distinct_field, None, True),
                                 is_select=True,
                                 fields=[distinct_field])
 
         self._validate_distinct(created_collection=created_collection,
-                                query='SELECT distinct c.%s from c ORDER BY c.%s' % (different_field, different_field), # nosec
+                                query='SELECT distinct c.%s from c ORDER BY c.%s' % (different_field, different_field),
+                                # nosec
                                 results=[],
                                 is_select=True,
                                 fields=[different_field])
 
         self._validate_distinct(created_collection=created_collection,
                                 query='SELECT distinct c.%s from c' % different_field,  # nosec
                                 results=['None'],
@@ -569,28 +799,39 @@
             enable_cross_partition_query=True,
             max_item_count=1,
         )
 
         with self.assertRaises(ValueError):
             pager = query_iterable.by_page("fake_continuation_token")
 
-    def _validate_distinct_on_different_types_and_field_orders(self, collection, query, expected_results, get_mock_result):
+    def _validate_distinct_on_different_types_and_field_orders(self, collection, query, expected_results,
+                                                               get_mock_result):
         self.count = 0
         self.get_mock_result = get_mock_result
         query_iterable = collection.query_items(query, enable_cross_partition_query=True)
         results = list(query_iterable)
         for i in range(len(expected_results)):
             if isinstance(results[i], dict):
                 self.assertDictEqual(results[i], expected_results[i])
             elif isinstance(results[i], list):
                 self.assertListEqual(results[i], expected_results[i])
             else:
                 self.assertEqual(results[i], expected_results[i])
         self.count = 0
 
+    def test_value_max_query(self):
+        container = self.created_db.create_container_if_not_exists(
+            self.config.TEST_COLLECTION_MULTI_PARTITION_WITH_CUSTOM_PK_ID, PartitionKey(path="/pk"))
+        query = "Select value max(c.version) FROM c where c.isComplete = true and c.lookupVersion = @lookupVersion"
+        query_results = container.query_items(query, parameters=[
+            {"name": "@lookupVersion", "value": "console_csat"}  # cspell:disable-line
+        ], enable_cross_partition_query=True)
+
+        self.assertListEqual(list(query_results), [None])
+
     def _MockNextFunction(self):
         if self.count < len(self.payloads):
             item, result = self.get_mock_result(self.payloads, self.count)
             self.count += 1
             if item is not None:
                 return {'orderByItems': [{'item': item}], '_rid': 'fake_rid', 'payload': result}
             else:
```

## Comparing `azure-cosmos-4.3.1b1/test/test_partition_key.py` & `azure-cosmos-4.4.0b1/test/test_partition_key.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_location_cache.py` & `azure-cosmos-4.4.0b1/test/test_location_cache.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_multi_orderby.py` & `azure-cosmos-4.4.0b1/test/test_multi_orderby.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_retry_policy.py` & `azure-cosmos-4.4.0b1/test/test_retry_policy.py`

 * *Files 7% similar despite different names*

```diff
@@ -74,15 +74,15 @@
             test_config._test_config.TEST_COLLECTION_SINGLE_PARTITION_ID, PartitionKey(path="/id"))
         cls.retry_after_in_milliseconds = 1000
 
     def test_resource_throttle_retry_policy_default_retry_after(self):
         connection_policy = Test_retry_policy_tests.connectionPolicy
         connection_policy.RetryOptions = retry_options.RetryOptions(5)
 
-        self.OriginalExecuteFunction = _retry_utility.ExecuteFunction
+        self.original_execute_function = _retry_utility.ExecuteFunction
         try:
             _retry_utility.ExecuteFunction = self._MockExecuteFunction
 
             document_definition = { 'id': 'doc',
                                     'name': 'sample document',
                                     'key': 'value'}
 
@@ -90,21 +90,21 @@
                 self.created_collection.create_item(body=document_definition)
             except exceptions.CosmosHttpResponseError as e:
                 self.assertEqual(e.status_code, StatusCodes.TOO_MANY_REQUESTS)
                 self.assertEqual(connection_policy.RetryOptions.MaxRetryAttemptCount, self.created_collection.client_connection.last_response_headers[HttpHeaders.ThrottleRetryCount])
                 self.assertGreaterEqual(self.created_collection.client_connection.last_response_headers[HttpHeaders.ThrottleRetryWaitTimeInMs],
                                         connection_policy.RetryOptions.MaxRetryAttemptCount * self.retry_after_in_milliseconds)
         finally:
-            _retry_utility.ExecuteFunction = self.OriginalExecuteFunction
+            _retry_utility.ExecuteFunction = self.original_execute_function
 
     def test_resource_throttle_retry_policy_fixed_retry_after(self):
         connection_policy = Test_retry_policy_tests.connectionPolicy
         connection_policy.RetryOptions = retry_options.RetryOptions(5, 2000)
 
-        self.OriginalExecuteFunction = _retry_utility.ExecuteFunction
+        self.original_execute_function = _retry_utility.ExecuteFunction
         try:
             _retry_utility.ExecuteFunction = self._MockExecuteFunction
 
             document_definition = { 'id': 'doc',
                                     'name': 'sample document',
                                     'key': 'value'}
 
@@ -113,48 +113,48 @@
             except exceptions.CosmosHttpResponseError as e:
                 self.assertEqual(e.status_code, StatusCodes.TOO_MANY_REQUESTS)
                 self.assertEqual(connection_policy.RetryOptions.MaxRetryAttemptCount, self.created_collection.client_connection.last_response_headers[HttpHeaders.ThrottleRetryCount])
                 self.assertGreaterEqual(self.created_collection.client_connection.last_response_headers[HttpHeaders.ThrottleRetryWaitTimeInMs],
                                         connection_policy.RetryOptions.MaxRetryAttemptCount * connection_policy.RetryOptions.FixedRetryIntervalInMilliseconds)
 
         finally:
-            _retry_utility.ExecuteFunction = self.OriginalExecuteFunction
+            _retry_utility.ExecuteFunction = self.original_execute_function
 
     def test_resource_throttle_retry_policy_max_wait_time(self):
         connection_policy = Test_retry_policy_tests.connectionPolicy
         connection_policy.RetryOptions = retry_options.RetryOptions(5, 2000, 3)
 
-        self.OriginalExecuteFunction = _retry_utility.ExecuteFunction
+        self.original_execute_function = _retry_utility.ExecuteFunction
         try:
             _retry_utility.ExecuteFunction = self._MockExecuteFunction
 
             document_definition = { 'id': 'doc',
                                     'name': 'sample document',
                                     'key': 'value'}
 
             try:
                 self.created_collection.create_item(body=document_definition)
             except exceptions.CosmosHttpResponseError as e:
                 self.assertEqual(e.status_code, StatusCodes.TOO_MANY_REQUESTS)
                 self.assertGreaterEqual(self.created_collection.client_connection.last_response_headers[HttpHeaders.ThrottleRetryWaitTimeInMs],
                                         connection_policy.RetryOptions.MaxWaitTimeInSeconds * 1000)
         finally:
-            _retry_utility.ExecuteFunction = self.OriginalExecuteFunction
+            _retry_utility.ExecuteFunction = self.original_execute_function
 
     def test_resource_throttle_retry_policy_query(self):
         connection_policy = Test_retry_policy_tests.connectionPolicy
         connection_policy.RetryOptions = retry_options.RetryOptions(5)
 
         document_definition = { 'id': 'doc',
                                 'name': 'sample document',
                                 'key': 'value'}
 
         self.created_collection.create_item(body=document_definition)
 
-        self.OriginalExecuteFunction = _retry_utility.ExecuteFunction
+        self.original_execute_function = _retry_utility.ExecuteFunction
         try:
             _retry_utility.ExecuteFunction = self._MockExecuteFunction
 
             try:
                 list(self.created_collection.query_items(
                 {
                     'query': 'SELECT * FROM root r WHERE r.id=@id',
@@ -165,79 +165,77 @@
             except exceptions.CosmosHttpResponseError as e:
                 self.assertEqual(e.status_code, StatusCodes.TOO_MANY_REQUESTS)
                 self.assertEqual(connection_policy.RetryOptions.MaxRetryAttemptCount,
                                 self.created_collection.client_connection.last_response_headers[HttpHeaders.ThrottleRetryCount])
                 self.assertGreaterEqual(self.created_collection.client_connection.last_response_headers[HttpHeaders.ThrottleRetryWaitTimeInMs],
                                         connection_policy.RetryOptions.MaxRetryAttemptCount * self.retry_after_in_milliseconds)
         finally:
-            _retry_utility.ExecuteFunction = self.OriginalExecuteFunction
+            _retry_utility.ExecuteFunction = self.original_execute_function
 
     @pytest.mark.xfail
     def test_default_retry_policy_for_query(self):
         document_definition_1 = { 'id': 'doc1',
                                   'name': 'sample document',
                                   'key': 'value'}
         document_definition_2 = { 'id': 'doc2',
                                   'name': 'sample document',
                                   'key': 'value'}
 
         self.created_collection.create_item(body=document_definition_1)
         self.created_collection.create_item(body=document_definition_2)
-
+        self.original_execute_function = _retry_utility.ExecuteFunction
         try:
-            original_execute_function = _retry_utility.ExecuteFunction
-            mf = self.MockExecuteFunctionConnectionReset(original_execute_function)
+            mf = self.MockExecuteFunctionConnectionReset(self.original_execute_function)
             _retry_utility.ExecuteFunction = mf
 
             docs = self.created_collection.query_items(query="Select * from c", max_item_count=1, enable_cross_partition_query=True)
 
             result_docs = list(docs)
             self.assertEqual(result_docs[0]['id'], 'doc1')
             self.assertEqual(result_docs[1]['id'], 'doc2')
 
             # TODO: Differing result between live and emulator
             if 'localhost' in self.host or '127.0.0.1' in self.host:
                 self.assertEqual(mf.counter, 12)
             else:
                 self.assertEqual(mf.counter, 18)
         finally:
-            _retry_utility.ExecuteFunction = original_execute_function
+            _retry_utility.ExecuteFunction = self.original_execute_function
 
         self.created_collection.delete_item(item=result_docs[0], partition_key=result_docs[0]['id'])
         self.created_collection.delete_item(item=result_docs[1], partition_key=result_docs[1]['id'])
 
     def test_default_retry_policy_for_read(self):
         document_definition = { 'id': 'doc',
                                 'name': 'sample document',
                                 'key': 'value'}
 
         created_document = self.created_collection.create_item(body=document_definition)
-
+        self.original_execute_function = _retry_utility.ExecuteFunction
         try:
-            original_execute_function = _retry_utility.ExecuteFunction
-            mf = self.MockExecuteFunctionConnectionReset(original_execute_function)
+            mf = self.MockExecuteFunctionConnectionReset(self.original_execute_function)
             _retry_utility.ExecuteFunction = mf
 
             doc = self.created_collection.read_item(item=created_document['id'], partition_key=created_document['id'])
             self.assertEqual(doc['id'], 'doc')
             self.assertEqual(mf.counter, 3)
 
         finally:
-            _retry_utility.ExecuteFunction = original_execute_function
+            _retry_utility.ExecuteFunction = self.original_execute_function
 
         self.created_collection.delete_item(item=created_document, partition_key=created_document['id'])
 
     def test_default_retry_policy_for_create(self):
         document_definition = { 'id': 'doc',
                                 'name': 'sample document',
                                 'key': 'value'}
 
         try:
-            original_execute_function = _retry_utility.ExecuteFunction
-            mf = self.MockExecuteFunctionConnectionReset(original_execute_function)
+            self.original_execute_function = _retry_utility.ExecuteFunction
+            mf = self.MockExecuteFunctionConnectionReset(self.original_execute_function)
             _retry_utility.ExecuteFunction = mf
 
             created_document = {}
             try:
                 created_document = self.created_collection.create_item(body=document_definition)
             except exceptions.CosmosHttpResponseError as err:
                 self.assertEqual(err.status_code, 10054)
@@ -248,23 +246,52 @@
             # Counter ends up in three additional calls while doing create_item,
             # which are reads to the database and container before creating the item.
             # As such, even though the retry_utility does not retry for the create, the counter is affected by these.
             # TODO: Figure out a way to make the counter only take in the POST call it is looking for.
             mf.counter = mf.counter - 3
             self.assertEqual(mf.counter, 1)
         finally:
-            _retry_utility.ExecuteFunction = original_execute_function
+            _retry_utility.ExecuteFunction = self.original_execute_function
+
+    def test_timeout_failover_retry_policy_for_read(self):
+        document_definition = {'id': 'failoverDoc',
+                               'name': 'sample document',
+                               'key': 'value'}
+
+        created_document = self.created_collection.create_item(body=document_definition)
+        self.original_execute_function = _retry_utility.ExecuteFunction
+        try:
+            mf = self.MockExecuteFunctionTimeout(self.original_execute_function)
+            _retry_utility.ExecuteFunction = mf
+            try:
+                doc = self.created_collection.read_item(item=created_document['id'],
+                                                        partition_key=created_document['id'])
+                self.assertEqual(doc['id'], 'doc')
+            except exceptions.CosmosHttpResponseError as err:
+                self.assertEqual(err.status_code, 408)
+        finally:
+            _retry_utility.ExecuteFunction = self.original_execute_function
 
     def _MockExecuteFunction(self, function, *args, **kwargs):
         response = test_config.FakeResponse({HttpHeaders.RetryAfterInMilliseconds: self.retry_after_in_milliseconds})
         raise exceptions.CosmosHttpResponseError(
             status_code=StatusCodes.TOO_MANY_REQUESTS,
             message="Request rate is too large",
             response=response)
 
+    class MockExecuteFunctionTimeout(object):
+        def __init__(self, org_func):
+            self.org_func = org_func
+            self.counter = 0
+
+        def __call__(self, func, *args, **kwargs):
+            raise exceptions.CosmosHttpResponseError(
+                status_code=408,
+                message="Timeout",
+                response=test_config.FakeResponse({}))
 
     class MockExecuteFunctionConnectionReset(object):
 
         def __init__(self, org_func):
             self.org_func = org_func
             self.counter = 0
```

## Comparing `azure-cosmos-4.3.1b1/test/test_user_configs.py` & `azure-cosmos-4.4.0b1/test/test_user_configs.py`

 * *Files 3% similar despite different names*

```diff
@@ -64,14 +64,20 @@
         client_true = cosmos_client.CosmosClient(url=_test_config.host, credential=_test_config.masterKey,
                                                  consistency_level="Session", enable_endpoint_discovery=True)
 
         self.assertFalse(client_false.client_connection.connection_policy.EnableEndpointDiscovery)
         self.assertTrue(client_default.client_connection.connection_policy.EnableEndpointDiscovery)
         self.assertTrue(client_true.client_connection.connection_policy.EnableEndpointDiscovery)
 
+    def test_authentication_error(self):
+        try:
+            cosmos_client.CosmosClient(url=_test_config.host, credential="wrong_key")
+        except exceptions.CosmosHttpResponseError as e:
+            self.assertEqual(e.status_code, http_constants.StatusCodes.UNAUTHORIZED)
+
     def test_default_account_consistency(self):
         # These tests use the emulator, which has a default consistency of "Session".
         # If your account has a different level of consistency, make sure it's not the same as the custom_level below.
 
         # Seems like our live tests are unable to fetch _GetDatabaseAccount method on client initialization, so this
         # test will be disabled if not being ran with the emulator or live.
         # TODO: Look into the configuration running the tests in the pipeline - this is the reason we specify
```

## Comparing `azure-cosmos-4.3.1b1/test/test_cosmos_http_logging_policy.py` & `azure-cosmos-4.4.0b1/test/test_cosmos_http_logging_policy.py`

 * *Files 20% similar despite different names*

```diff
@@ -78,15 +78,15 @@
         cls.client_diagnostic = cosmos_client.CosmosClient(cls.host, cls.masterKey,
                                                            consistency_level="Session",
                                                            connection_policy=cls.connectionPolicy,
                                                            logger=cls.logger_diagnostic, enable_diagnostics_logging=True)
 
     def test_default_http_logging_policy(self):
         # Test if we can log into from creating a database
-        test_db = self.client_default.create_database(id="database_test")
+        self.client_default.create_database(id="database_test")
         assert all(m.levelname == 'INFO' for m in self.mock_handler_default.messages)
         messages_request = self.mock_handler_default.messages[0].message.split("\n")
         messages_response = self.mock_handler_default.messages[1].message.split("\n")
         assert messages_request[1] == "Request method: 'GET'"
         assert 'Request headers:' in messages_request[2]
         assert messages_request[11] == 'No body was attached to the request'
         assert messages_response[0] == 'Response status: 200'
@@ -95,44 +95,44 @@
         self.mock_handler_default.reset()
 
         # delete database
         self.client_default.delete_database("database_test")
 
     def test_cosmos_http_logging_policy(self):
         # Test if we can log into from creating a database
-        test_db = self.client_diagnostic.create_database(id="database_test")
+        self.client_diagnostic.create_database(id="database_test")
         assert all(m.levelname == 'INFO' for m in self.mock_handler_diagnostic.messages)
-        messages_request = self.mock_handler_diagnostic.messages[2].message.split("\n")
-        messages_response = self.mock_handler_diagnostic.messages[3].message.split("\n")
+        messages_request = self.mock_handler_diagnostic.messages[3].message.split("\n")
+        messages_response = self.mock_handler_diagnostic.messages[4].message.split("\n")
+        elapsed_time = self.mock_handler_diagnostic.messages[2].message.split("\n")
         assert "/dbs" in messages_request[0]
         assert messages_request[1] == "Request method: 'POST'"
         assert 'Request headers:' in messages_request[2]
         assert messages_request[13] == 'A body is sent with the request'
         assert messages_response[0] == 'Response status: 201'
-        assert messages_response[1] == 'Response status reason: Created'
-        assert "Elapsed Time:" in messages_response[2]
-        assert "Response headers" in messages_response[3]
+        assert "Elapsed time in seconds:" in elapsed_time[0]
+        assert "Response headers" in messages_response[1]
 
         self.mock_handler_diagnostic.reset()
         # now test in case of an error
         try:
-            test_db_error = self.client_diagnostic.create_database(id="database_test")
+            self.client_diagnostic.create_database(id="database_test")
         except:
             pass
         assert all(m.levelname == 'INFO' for m in self.mock_handler_diagnostic.messages)
         messages_request = self.mock_handler_diagnostic.messages[0].message.split("\n")
         messages_response = self.mock_handler_diagnostic.messages[1].message.split("\n")
+        elapsed_time = self.mock_handler_diagnostic.messages[2].message.split("\n")
         assert "/dbs" in messages_request[0]
         assert messages_request[1] == "Request method: 'POST'"
         assert 'Request headers:' in messages_request[2]
         assert messages_request[13] == 'A body is sent with the request'
         assert messages_response[0] == 'Response status: 409'
-        assert messages_response[1] == 'Response status reason: Conflict'
-        assert "Elapsed Time:" in messages_response[2]
-        assert "Response headers" in messages_response[14]
+        assert "Elapsed time in seconds:" in elapsed_time[0]
+        assert "Response headers" in messages_response[1]
 
         # delete database
         self.client_diagnostic.delete_database("database_test")
 
         self.mock_handler_diagnostic.reset()
```

## Comparing `azure-cosmos-4.3.1b1/test/test_headers.py` & `azure-cosmos-4.4.0b1/test/test_headers.py`

 * *Files 8% similar despite different names*

```diff
@@ -41,16 +41,16 @@
     dedicated_gateway_max_age_million = 1000000
     dedicated_gateway_max_age_negative = -1
 
     @classmethod
     def setUpClass(cls):
         cls.client = cosmos_client.CosmosClient(cls.host, cls.masterKey)
         cls.database = cls.client.create_database_if_not_exists(test_config._test_config.TEST_DATABASE_ID)
-        cls.container = cls.database.create_container(id=test_config._test_config.TEST_COLLECTION_MULTI_PARTITION_ID,
-                                                      partition_key=PartitionKey(path="/id"))
+        cls.container = cls.database.create_container_if_not_exists(
+            id=test_config._test_config.TEST_COLLECTION_MULTI_PARTITION_ID, partition_key=PartitionKey(path="/id"))
 
     def side_effect_dedicated_gateway_max_age_thousand(self, *args, **kwargs):
         # Extract request headers from args
         assert args[2]["x-ms-dedicatedgateway-max-age"] == self.dedicated_gateway_max_age_thousand
         raise StopIteration
 
     def side_effect_dedicated_gateway_max_age_million(self, *args, **kwargs):
```

## Comparing `azure-cosmos-4.3.1b1/test/test_aggregate.py` & `azure-cosmos-4.4.0b1/test/test_aggregate.py`

 * *Files 2% similar despite different names*

```diff
@@ -21,17 +21,14 @@
 
 from __future__ import print_function
 
 import unittest
 import uuid
 import pytest
 
-from six import with_metaclass
-from six.moves import xrange
-
 import azure.cosmos.cosmos_client as cosmos_client
 import azure.cosmos.documents as documents
 import test_config
 from azure.cosmos.exceptions import CosmosHttpResponseError
 from azure.cosmos.partition_key import PartitionKey
 
 pytestmark = pytest.mark.cosmosEmulator
@@ -74,24 +71,24 @@
         document_definitions = []
 
         values = [None, False, True, "abc", "cdfg", "opqrs", "ttttttt", "xyz", "oo", "ppp"]
         for value in values:
             d = {_config.PARTITION_KEY: value, 'id': str(uuid.uuid4())}
             document_definitions.append(d)
 
-        for i in xrange(_config.DOCS_WITH_SAME_PARTITION_KEY):
+        for i in range(_config.DOCS_WITH_SAME_PARTITION_KEY):
             d = {_config.PARTITION_KEY: _config.UNIQUE_PARTITION_KEY,
                  'resourceId': i,
                  _config.FIELD: i + 1,
                  'id': str(uuid.uuid4())}
             document_definitions.append(d)
 
         _config.docs_with_numeric_id = \
             _config.DOCUMENTS_COUNT - len(values) - _config.DOCS_WITH_SAME_PARTITION_KEY
-        for i in xrange(_config.docs_with_numeric_id):
+        for i in range(_config.docs_with_numeric_id):
             d = {_config.PARTITION_KEY: i + 1, 'id': str(uuid.uuid4())}
             document_definitions.append(d)
 
         _config.sum = _config.docs_with_numeric_id \
                       * (_config.docs_with_numeric_id + 1) / 2.0
 
         cls._insert_doc(cls.created_collection, document_definitions)
```

## Comparing `azure-cosmos-4.3.1b1/test/test_auto_scale.py` & `azure-cosmos-4.4.0b1/test/test_auto_scale.py`

 * *Files 5% similar despite different names*

```diff
@@ -41,19 +41,19 @@
             raise Exception(
                 "You must specify your Azure Cosmos account values for "
                 "'masterKey' and 'host' at the top of this class to run the "
                 "tests.")
 
         cls.client = cosmos_client.CosmosClient(cls.host, cls.masterKey, consistency_level="Session",
                                                 connection_policy=cls.connectionPolicy)
-        cls.created_database = cls.client.create_database(test_config._test_config.TEST_DATABASE_ID)
+        cls.created_database = cls.client.create_database_if_not_exists(test_config._test_config.TEST_DATABASE_ID)
 
     def test_auto_scale(self):
         created_container = self.created_database.create_container(
-            id='container_with_auto_scale_settings',
+            id='auto_scale',
             partition_key=PartitionKey(path="/id"),
             offer_throughput=ThroughputProperties(auto_scale_max_throughput=7000, auto_scale_increment_percent=0)
 
         )
         created_container_properties = created_container.get_throughput()
         # Testing the input value of the max_throughput
         self.assertEqual(
@@ -70,55 +70,58 @@
                 partition_key=PartitionKey(path="/id"),
                 offer_throughput=ThroughputProperties(auto_scale_max_throughput=-200, auto_scale_increment_percent=0))
         assert "Requested throughput -200 is less than required minimum throughput 1000" in str(e.value)
 
     def test_create_container_if_not_exist(self):
         # Testing auto_scale_settings for the create_container_if_not_exists method
         created_container = self.created_database.create_container_if_not_exists(
-            id='container_with_auto_scale_settings',
+            id='auto_scale_2',
             partition_key=PartitionKey(path="/id"),
             offer_throughput=ThroughputProperties(auto_scale_max_throughput=1000, auto_scale_increment_percent=3)
         )
         created_container_properties = created_container.get_throughput()
         # Testing the incorrect input value of the max_throughput
         self.assertNotEqual(
             created_container_properties.auto_scale_max_throughput, 2000)
         # Testing the input value of the increment_percentage
         self.assertEqual(
             created_container_properties.auto_scale_increment_percent, 3)
 
+        self.created_database.delete_container(created_container.id)
+
     def test_create_database(self):
         # Testing auto_scale_settings for the create_database method
-        created_database = self.client.create_database("db1", offer_throughput=ThroughputProperties(
+        created_database = self.client.create_database("db_auto_scale", offer_throughput=ThroughputProperties(
             auto_scale_max_throughput=5000,
             auto_scale_increment_percent=0))
         created_db_properties = created_database.get_throughput()
         # Testing the input value of the max_throughput
         self.assertEqual(
             created_db_properties.auto_scale_max_throughput, 5000)
         # Testing the input value of the increment_percentage
         self.assertEqual(
             created_db_properties.auto_scale_increment_percent, 0)
 
-        self.client.delete_database("db1")
+        self.client.delete_database("db_auto_scale")
 
     def test_create_database_if_not_exists(self):
         # Testing auto_scale_settings for the create_database_if_not_exists method
-        created_database = self.client.create_database_if_not_exists("db2", offer_throughput=ThroughputProperties(
-            auto_scale_max_throughput=9000,
-            auto_scale_increment_percent=11))
+        created_database = self.client.create_database_if_not_exists("db_auto_scale_2",
+                                                                     offer_throughput=ThroughputProperties(
+                                                                         auto_scale_max_throughput=9000,
+                                                                         auto_scale_increment_percent=11))
         created_db_properties = created_database.get_throughput()
         # Testing the input value of the max_throughput
         self.assertNotEqual(
             created_db_properties.auto_scale_max_throughput, 8000)
         # Testing the input value of the increment_percentage
         self.assertEqual(
             created_db_properties.auto_scale_increment_percent, 11)
 
-        self.client.delete_database("db2")
+        self.client.delete_database("db_auto_scale_2")
 
     def test_replace_throughput(self):
         created_container = self.created_database.create_container(
             id='container_with_replace_functionality',
             partition_key=PartitionKey(path="/id"),
             offer_throughput=ThroughputProperties(auto_scale_max_throughput=5000, auto_scale_increment_percent=0)
 
@@ -128,8 +131,8 @@
         created_container_properties = created_container.get_throughput()
         # Testing the input value of the replaced auto_scale settings
         self.assertEqual(
             created_container_properties.auto_scale_max_throughput, 7000)
         self.assertEqual(
             created_container_properties.auto_scale_increment_percent, 20)
 
-        self.client.delete_database(test_config._test_config.TEST_DATABASE_ID)
+        self.created_database.delete_container(created_container.id)
```

## Comparing `azure-cosmos-4.3.1b1/test/test_partition_split_query.py` & `azure-cosmos-4.4.0b1/test/test_partition_split_query.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_env.py` & `azure-cosmos-4.4.0b1/test/test_env.py`

 * *Files 2% similar despite different names*

```diff
@@ -21,14 +21,15 @@
 
 import unittest
 import pytest
 import azure.cosmos.cosmos_client as cosmos_client
 from azure.cosmos import PartitionKey
 import test_config
 import os
+import uuid
 
 pytestmark = pytest.mark.cosmosEmulator
 
 #IMPORTANT NOTES:
   
 #      Most test cases in this file create collections in your Azure Cosmos account.
 #      Collections are billing entities.  By running these test cases, you may incur monetary costs on your account.
@@ -68,15 +69,15 @@
     @classmethod
     def tearDownClass(cls):
         del os.environ['COSMOS_ENDPOINT']
         del os.environ['COSMOS_KEY']
 
     def test_insert(self):
         # create a document using the document definition
-        d = {'id': '1',
+        d = {'id': str(uuid.uuid4()),
                  'name': 'sample document',
                  'spam': 'eggs',
                  'cnt': '1',
                  'key': 'value',
                  'spam2': 'eggs',
                  }
```

## Comparing `azure-cosmos-4.3.1b1/test/test_globaldb_mock.py` & `azure-cosmos-4.4.0b1/test/test_globaldb_mock.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_media.py` & `azure-cosmos-4.4.0b1/test/test_media.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_integrated_cache.py` & `azure-cosmos-4.4.0b1/test/test_integrated_cache.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/cleanup.py` & `azure-cosmos-4.4.0b1/test/cleanup.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_session_container.py` & `azure-cosmos-4.4.0b1/test/test_session_container.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_encoding.py` & `azure-cosmos-4.4.0b1/test/test_encoding.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_query_execution_context.py` & `azure-cosmos-4.4.0b1/test/test_query_execution_context.py`

 * *Files 1% similar despite different names*

```diff
@@ -18,15 +18,14 @@
 #LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 #OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 #SOFTWARE.
 
 import unittest
 import uuid
 import pytest
-from six.moves import xrange
 import azure.cosmos.cosmos_client as cosmos_client
 from azure.cosmos._execution_context import base_execution_context as base_execution_context
 import azure.cosmos._base as base
 import test_config
 from azure.cosmos.partition_key import PartitionKey
 
 pytestmark = pytest.mark.cosmosEmulator
@@ -65,15 +64,15 @@
         cls.created_collection = cls.created_db.create_container(
             id='query_execution_context_tests_' + str(uuid.uuid4()),
             partition_key=PartitionKey(path='/id', kind='Hash')
         )
         cls.document_definitions = []
 
         # create a document using the document definition
-        for i in xrange(20):
+        for i in range(20):
             d = {'id': str(i),
                  'name': 'sample document',
                  'spam': 'eggs' + str(i),
                  'key': 'value'}
             cls.document_definitions.append(d)
         cls.insert_doc(cls.document_definitions)
 
@@ -161,15 +160,15 @@
         
         it = ex.__iter__()
         def invokeNext():
             return next(it)
                     
         results = {}            
         # validate that invocations of next() produces the same results as expected
-        for _ in xrange(expected_number_of_results):
+        for _ in range(expected_number_of_results):
             item = invokeNext()
             results[item['id']] = item
        
         self.assertEqual(len(results), expected_number_of_results)
        
         # after the result set is exhausted, invoking next must raise a StopIteration exception
         self.assertRaises(StopIteration, invokeNext)
```

## Comparing `azure-cosmos-4.3.1b1/test/test_client_user_agent.py` & `azure-cosmos-4.4.0b1/test/test_client_user_agent.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/test_multimaster.py` & `azure-cosmos-4.4.0b1/test/test_multimaster.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/routing/__init__.py` & `azure-cosmos-4.4.0b1/test/routing/__init__.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/routing/test_routing_map_provider.py` & `azure-cosmos-4.4.0b1/test/routing/test_routing_map_provider.py`

 * *Files identical despite different names*

## Comparing `azure-cosmos-4.3.1b1/test/routing/test_collection_routing_map.py` & `azure-cosmos-4.4.0b1/test/routing/test_collection_routing_map.py`

 * *Files identical despite different names*

